{"version":3,"sources":["../node_modules/@lit-labs/ssr-dom-shim/src/lib/element-internals.ts","../node_modules/@lit-labs/ssr-dom-shim/src/index.ts","../node_modules/@lit/reactive-element/src/css-tag.ts","../node_modules/@lit/reactive-element/src/reactive-element.ts","../node_modules/lit-html/src/lit-html.ts","../node_modules/lit-element/src/lit-element.ts","../node_modules/@lit/reactive-element/src/decorators/custom-element.ts","../node_modules/@lit/reactive-element/src/decorators/property.ts","../node_modules/lit-html/src/directive-helpers.ts","../node_modules/lit-html/src/directive.ts","../node_modules/lit-html/src/async-directive.ts","../node_modules/lit-html/src/directives/ref.ts","../src/components/video-selector.ts","../src/util/drawing.ts","../node_modules/@mediapipe/tasks-vision/vision_bundle.mjs","../node_modules/ixfx/bundle/chunk-51aI8Tpl.js","../node_modules/guards/dist/src/result.js","../node_modules/guards/dist/src/numbers.js","../node_modules/guards/dist/src/arrays.js","../node_modules/guards/dist/src/empty.js","../node_modules/guards/dist/src/function.js","../node_modules/guards/dist/src/object.js","../node_modules/guards/dist/src/range.js","../node_modules/guards/dist/src/string.js","../node_modules/guards/dist/src/index.js","../node_modules/core/dist/src/is-primitive.js","../node_modules/core/dist/src/records/circular.js","../node_modules/core/dist/src/to-string.js","../node_modules/core/dist/src/is-equal.js","../node_modules/core/dist/src/iterable-compare-values-shallow.js","../node_modules/core/dist/src/util/round.js","../node_modules/core/dist/src/interval-type.js","../node_modules/core/dist/src/comparers.js","../node_modules/core/dist/src/maps.js","../node_modules/core/dist/src/continuously.js","../node_modules/core/dist/src/elapsed.js","../node_modules/core/dist/src/promise-from-event.js","../node_modules/core/dist/src/sleep.js","../node_modules/process/dist/src/basic.js","../node_modules/arrays/dist/src/cycle.js","../node_modules/arrays/dist/src/at-wrap.js","../node_modules/arrays/dist/src/chunks.js","../node_modules/arrays/dist/src/util/to-string.js","../node_modules/arrays/dist/src/util/is-equal.js","../node_modules/arrays/dist/src/contains.js","../node_modules/arrays/dist/src/ensure-length.js","../node_modules/arrays/dist/src/equality.js","../node_modules/arrays/dist/src/filter.js","../node_modules/arrays/dist/src/flatten.js","../node_modules/arrays/dist/src/for-each.js","../node_modules/arrays/dist/src/frequency.js","../node_modules/arrays/dist/src/group-by.js","../node_modules/arrays/dist/src/unique.js","../node_modules/arrays/dist/src/insert-at.js","../node_modules/arrays/dist/src/interleave.js","../node_modules/arrays/dist/src/intersection.js","../node_modules/arrays/dist/src/merge-by-key.js","../node_modules/arrays/dist/src/pairwise.js","../node_modules/arrays/dist/src/random.js","../node_modules/arrays/dist/src/remove.js","../node_modules/arrays/dist/src/sample.js","../node_modules/arrays/dist/src/sort.js","../node_modules/arrays/dist/src/until.js","../node_modules/arrays/dist/src/without.js","../node_modules/arrays/dist/src/zip.js","../node_modules/arrays/dist/src/index.js","../node_modules/numbers/dist/src/apply-to-values.js","../node_modules/numbers/dist/src/numeric-arrays.js","../node_modules/numbers/dist/src/average-weighted.js","../node_modules/numbers/dist/src/clamp.js","../node_modules/numbers/dist/src/count.js","../node_modules/numbers/dist/src/difference.js","../node_modules/numbers/dist/src/guard.js","../node_modules/numbers/dist/src/filter.js","../node_modules/numbers/dist/src/flip.js","../node_modules/numbers/dist/src/generate.js","../node_modules/numbers/dist/src/round.js","../node_modules/numbers/dist/src/is-approx.js","../node_modules/numbers/dist/src/bipolar.js","../node_modules/numbers/dist/src/wrap.js","../node_modules/numbers/dist/src/pi-pi.js","../node_modules/numbers/dist/src/interpolate.js","../node_modules/numbers/dist/src/linear-space.js","../node_modules/numbers/dist/src/util/queue-mutable.js","../node_modules/numbers/dist/src/moving-average.js","../node_modules/numbers/dist/src/scale.js","../node_modules/numbers/dist/src/number-array-compute.js","../node_modules/numbers/dist/src/normalise.js","../node_modules/numbers/dist/src/proportion.js","../node_modules/numbers/dist/src/quantise.js","../node_modules/numbers/dist/src/range.js","../node_modules/numbers/dist/src/softmax.js","../node_modules/numbers/dist/src/track-simple.js","../node_modules/numbers/dist/src/index.js","../node_modules/core/dist/src/default-keyer.js","../node_modules/core/dist/src/text.js","../node_modules/iterables/dist/src/guard.js","../node_modules/iterables/dist/src/sync/slice.js","../node_modules/iterables/dist/src/sync/reduce.js","../node_modules/iterables/dist/src/sync.js","../node_modules/events/dist/src/map-of.js","../node_modules/events/dist/src/simple-event-emitter.js","../node_modules/events/dist/src/index.js","../node_modules/iterables/dist/src/async.js","../node_modules/iterables/dist/src/chain/utility.js","../node_modules/iterables/dist/src/util/dom.js","../node_modules/iterables/dist/src/chain/dom.js","../node_modules/iterables/dist/src/chain/links.js","../node_modules/iterables/dist/src/chain/from/array.js","../node_modules/iterables/dist/src/chain/from/event.js","../node_modules/iterables/dist/src/chain/from/function.js","../node_modules/iterables/dist/src/chain/from/iterable.js","../node_modules/iterables/dist/src/chain/from/ticks.js","../node_modules/iterables/dist/src/chain/from/index.js","../node_modules/iterables/dist/src/chain/add-to-array.js","../node_modules/iterables/dist/src/chain/as-array.js","../node_modules/iterables/dist/src/chain/as-callback.js","../node_modules/iterables/dist/src/chain/as-promise.js","../node_modules/iterables/dist/src/chain/as-value.js","../node_modules/iterables/dist/src/chain/combine-latest-to-array.js","../node_modules/iterables/dist/src/chain/combine-latest-to-object.js","../node_modules/iterables/dist/src/chain/lazy.js","../node_modules/iterables/dist/src/util/queueMutable.js","../node_modules/iterables/dist/src/chain/merge-flat.js","../node_modules/iterables/dist/src/chain/run.js","../node_modules/iterables/dist/src/chain/prepare.js","../node_modules/iterables/dist/src/chain/single.js","../node_modules/iterables/dist/src/chain/sync.js","../node_modules/iterables/dist/src/chain/index.js","../node_modules/iterables/dist/src/compare-values.js","../node_modules/iterables/dist/src/controller.js","../node_modules/iterables/dist/src/from-event.js","../node_modules/iterables/dist/src/numbers-compute.js","../node_modules/iterables/dist/src/index.js","../node_modules/collections/src/circular-array.ts","../node_modules/collections/src/queue/queue-fns.ts","../node_modules/collections/src/queue/queue-mutable.ts","../node_modules/collections/src/stack/StackFns.ts","../node_modules/collections/src/stack/StackMutable.ts","../node_modules/collections/src/tree/compare.ts","../node_modules/collections/src/tree/tree-mutable.ts","../node_modules/collections/src/tree/traverse-object.ts","../node_modules/collections/src/tree/pathed.ts","../node_modules/collections/src/tree/traversable-tree.ts","../node_modules/collections/src/tree/index.ts","../node_modules/collections/src/stack/StackImmutable.ts","../node_modules/collections/src/stack/index.ts","../node_modules/collections/src/set/set-mutable.ts","../node_modules/collections/src/set/SetImmutable.ts","../node_modules/collections/src/set/massive-set.ts","../node_modules/collections/src/set/index.ts","../node_modules/collections/src/queue/priority-mutable.ts","../node_modules/collections/src/queue/queue-immutable.ts","../node_modules/collections/src/queue/index.ts","../node_modules/collections/src/map/expiring-map.ts","../node_modules/collections/src/map/map-multi-fns.ts","../node_modules/collections/src/map/map-of-simple-base.ts","../node_modules/collections/src/map/map-of-simple-mutable.ts","../node_modules/collections/src/map/map-immutable-fns.ts","../node_modules/collections/src/map/map.ts","../node_modules/collections/src/map/map-mutable.ts","../node_modules/collections/src/map/map-of-multi-impl.ts","../node_modules/collections/src/map/map-of-set-mutable.ts","../node_modules/collections/src/map/map-of-circular-mutable.ts","../node_modules/collections/src/map/number-map.ts","../node_modules/collections/src/map/map-of-array-mutable.ts","../node_modules/collections/src/map/map-of-simple.ts","../node_modules/collections/src/map/index.ts","../node_modules/collections/src/table.ts","../node_modules/collections/src/graph/directed-graph.ts","../node_modules/collections/src/graph/undirected-graph.ts","../node_modules/collections/src/graph/index.ts","../node_modules/core/dist/src/records/map-object-keys.js","../node_modules/core/dist/src/records/compare.js","../node_modules/core/dist/src/records/clone-from-fields.js","../node_modules/core/dist/src/records/map-object.js","../node_modules/core/dist/src/records/traverse.js","../node_modules/core/dist/src/records/merge.js","../node_modules/core/dist/src/records/keys-to-numbers.js","../node_modules/core/dist/src/records/index.js","../node_modules/core/dist/src/key-value.js","../node_modules/core/dist/src/track-unique.js","../node_modules/.pnpm/json5@2.2.3/node_modules/json5/dist/index.js","../node_modules/core/dist/src/reactive-core.js","../node_modules/debug/dist/src/util.js","../node_modules/debug/dist/src/logger.js","../node_modules/debug/dist/src/fps-counter.js","../node_modules/debug/dist/src/error-message.js","../node_modules/debug/dist/src/index.js","../node_modules/core/dist/src/resolve-core.js","../node_modules/collections/dist/src/circular-array.js","../node_modules/collections/dist/src/queue/queue-fns.js","../node_modules/collections/dist/src/queue/queue-mutable.js","../node_modules/collections/dist/src/stack/StackFns.js","../node_modules/collections/dist/src/stack/StackMutable.js","../node_modules/collections/dist/src/tree/compare.js","../node_modules/collections/dist/src/tree/tree-mutable.js","../node_modules/collections/dist/src/tree/traverse-object.js","../node_modules/collections/dist/src/tree/pathed.js","../node_modules/collections/dist/src/tree/traversable-tree.js","../node_modules/collections/dist/src/tree/index.js","../node_modules/collections/dist/src/stack/StackImmutable.js","../node_modules/collections/dist/src/stack/index.js","../node_modules/collections/dist/src/set/set-mutable.js","../node_modules/collections/dist/src/set/SetImmutable.js","../node_modules/collections/dist/src/set/massive-set.js","../node_modules/collections/dist/src/set/index.js","../node_modules/collections/dist/src/queue/priority-mutable.js","../node_modules/collections/dist/src/queue/queue-immutable.js","../node_modules/collections/dist/src/queue/index.js","../node_modules/collections/dist/src/map/expiring-map.js","../node_modules/collections/dist/src/map/map-multi-fns.js","../node_modules/collections/dist/src/map/map-of-simple-base.js","../node_modules/collections/dist/src/map/map-of-simple-mutable.js","../node_modules/collections/dist/src/map/map-immutable-fns.js","../node_modules/collections/dist/src/map/map.js","../node_modules/collections/dist/src/map/map-mutable.js","../node_modules/collections/dist/src/map/map-of-multi-impl.js","../node_modules/collections/dist/src/map/map-of-set-mutable.js","../node_modules/collections/dist/src/map/map-of-circular-mutable.js","../node_modules/collections/dist/src/map/number-map.js","../node_modules/collections/dist/src/map/map-of-array-mutable.js","../node_modules/collections/dist/src/map/map-of-simple.js","../node_modules/collections/dist/src/map/index.js","../node_modules/collections/dist/src/table.js","../node_modules/collections/dist/src/graph/directed-graph.js","../node_modules/collections/dist/src/graph/undirected-graph.js","../node_modules/collections/dist/src/graph/index.js","../node_modules/collections/dist/src/index.js","../node_modules/flow/dist/src/behaviour-tree.js","../node_modules/flow/dist/src/delay.js","../node_modules/flow/dist/src/timeout.js","../node_modules/flow/dist/src/debounce.js","../node_modules/flow/dist/src/dispatch-list.js","../node_modules/flow/dist/src/every.js","../node_modules/flow/dist/src/execute.js","../node_modules/flow/dist/src/event-race.js","../node_modules/flow/dist/src/moving-average.js","../node_modules/flow/dist/src/pool.js","../node_modules/flow/dist/src/promise-with-resolvers.js","../node_modules/flow/dist/src/rate-minimum.js","../node_modules/flow/dist/src/repeat.js","../node_modules/flow/dist/src/req-resp-match.js","../node_modules/flow/dist/src/retry.js","../node_modules/flow/dist/src/run-once.js","../node_modules/flow/dist/src/sync-wait.js","../node_modules/flow/dist/src/task-queue-mutable.js","../node_modules/flow/dist/src/throttle.js","../node_modules/flow/dist/src/timer.js","../node_modules/flow/dist/src/update-outdated.js","../node_modules/flow/dist/src/wait-for-value.js","../node_modules/flow/dist/src/wait-for.js","../node_modules/flow/dist/src/state-machine/state-machine.js","../node_modules/flow/dist/src/state-machine/driver.js","../node_modules/flow/dist/src/state-machine/with-events.js","../node_modules/flow/dist/src/state-machine/index.js","../node_modules/flow/dist/src/index.js","../node_modules/random/dist/src/weighted-index.js","../node_modules/random/dist/src/arrays.js","../node_modules/random/dist/src/chance.js","../node_modules/random/dist/src/float-source.js","../node_modules/random/dist/src/non-zero.js","../node_modules/random/dist/src/gaussian.js","../node_modules/random/dist/src/guid.js","../node_modules/random/dist/src/util/count.js","../node_modules/random/dist/src/integer.js","../node_modules/random/dist/src/seeded.js","../node_modules/random/dist/src/string.js","../node_modules/random/dist/src/time.js","../node_modules/random/dist/src/util/clamp.js","../node_modules/random/dist/src/weighted-integer.js","../node_modules/random/dist/src/weighted.js","../node_modules/random/dist/src/index.js","../node_modules/trackers/dist/src/changes.js","../node_modules/trackers/dist/src/frequency-mutable.js","../node_modules/trackers/dist/src/tracker-base.js","../node_modules/trackers/dist/src/primitive-tracker.js","../node_modules/trackers/dist/src/number-tracker.js","../node_modules/trackers/dist/src/interval-tracker.js","../node_modules/trackers/dist/src/rate-tracker.js","../node_modules/trackers/dist/src/object-tracker.js","../node_modules/trackers/dist/src/tracked-value.js","../node_modules/trackers/dist/src/index.js","../node_modules/.pnpm/bezier-js@6.1.4/node_modules/bezier-js/src/utils.js","../node_modules/.pnpm/bezier-js@6.1.4/node_modules/bezier-js/src/poly-bezier.js","../node_modules/.pnpm/bezier-js@6.1.4/node_modules/bezier-js/src/bezier.js","../node_modules/geometry/dist/src/point/guard.js","../node_modules/geometry/dist/src/rect/guard.js","../node_modules/geometry/dist/src/rect/area.js","../node_modules/geometry/dist/src/rect/apply.js","../node_modules/geometry/dist/src/rect/cardinal.js","../node_modules/geometry/dist/src/rect/center.js","../node_modules/geometry/dist/src/rect/center-origin.js","../node_modules/geometry/dist/src/point/point-type.js","../node_modules/geometry/dist/src/rect/corners.js","../node_modules/geometry/dist/src/circle/guard.js","../node_modules/geometry/dist/src/circle/is-equal.js","../node_modules/geometry/dist/src/point/get-point-parameter.js","../node_modules/geometry/dist/src/point/sum.js","../node_modules/geometry/dist/src/point/subtract.js","../node_modules/geometry/dist/src/circle/intersections.js","../node_modules/geometry/dist/src/intersects.js","../node_modules/geometry/dist/src/rect/Intersects.js","../node_modules/geometry/dist/src/point/distance.js","../node_modules/geometry/dist/src/rect/distance.js","../node_modules/geometry/dist/src/rect/divide.js","../node_modules/geometry/dist/src/line/from-points.js","../node_modules/geometry/dist/src/line/join-points-to-lines.js","../node_modules/geometry/dist/src/rect/edges.js","../node_modules/geometry/dist/src/rect/empty.js","../node_modules/geometry/dist/src/rect/encompass.js","../node_modules/geometry/dist/src/rect/from-center.js","../node_modules/geometry/dist/src/rect/from-element.js","../node_modules/geometry/dist/src/rect/from-numbers.js","../node_modules/geometry/dist/src/rect/from-top-left.js","../node_modules/geometry/dist/src/rect/get-rect-positionedparameter.js","../node_modules/geometry/dist/src/point/is-equal.js","../node_modules/geometry/dist/src/rect/is-equal.js","../node_modules/geometry/dist/src/line/guard.js","../node_modules/geometry/dist/src/line/get-points-parameter.js","../node_modules/geometry/dist/src/line/length.js","../node_modules/geometry/dist/src/rect/lengths.js","../node_modules/geometry/dist/src/rect/max.js","../node_modules/geometry/dist/src/rect/multiply.js","../node_modules/geometry/dist/src/rect/nearest.js","../node_modules/geometry/dist/src/rect/placeholder.js","../node_modules/geometry/dist/src/rect/perimeter.js","../node_modules/geometry/dist/src/rect/normalise-by-rect.js","../node_modules/geometry/dist/src/rect/random.js","../node_modules/geometry/dist/src/rect/subtract.js","../node_modules/geometry/dist/src/rect/sum.js","../node_modules/geometry/dist/src/rect/to-array.js","../node_modules/geometry/dist/src/rect/index.js","../node_modules/geometry/dist/src/point/abs.js","../node_modules/geometry/dist/src/pi.js","../node_modules/geometry/dist/src/point/angle.js","../node_modules/geometry/dist/src/point/apply.js","../node_modules/geometry/dist/src/point/averager.js","../node_modules/geometry/dist/src/point/find-minimum.js","../node_modules/geometry/dist/src/point/bbox.js","../node_modules/geometry/dist/src/point/centroid.js","../node_modules/geometry/dist/src/point/clamp.js","../node_modules/geometry/dist/src/point/compare.js","../node_modules/geometry/dist/src/point/convex-hull.js","../node_modules/geometry/dist/src/circle/distance-center.js","../node_modules/geometry/dist/src/circle/distance-from-exterior.js","../node_modules/geometry/dist/src/point/distance-to-center.js","../node_modules/geometry/dist/src/point/distance-to-exterior.js","../node_modules/geometry/dist/src/point/divider.js","../node_modules/geometry/dist/src/point/to-array.js","../node_modules/geometry/dist/src/point/dot-product.js","../node_modules/geometry/dist/src/point/empty.js","../node_modules/geometry/dist/src/point/from.js","../node_modules/geometry/dist/src/line/reverse.js","../node_modules/geometry/dist/src/line/interpolate.js","../node_modules/geometry/dist/src/point/interpolate.js","../node_modules/geometry/dist/src/point/invert.js","../node_modules/geometry/dist/src/point/multiply.js","../node_modules/geometry/dist/src/point/magnitude.js","../node_modules/geometry/dist/src/point/most.js","../node_modules/geometry/dist/src/point/normalise.js","../node_modules/geometry/dist/src/point/normalise-by-rect.js","../node_modules/geometry/dist/src/point/pipeline.js","../node_modules/geometry/dist/src/polar/guard.js","../node_modules/geometry/dist/src/angles.js","../node_modules/geometry/dist/src/polar/angles.js","../node_modules/geometry/dist/src/polar/conversions.js","../node_modules/geometry/dist/src/polar/math.js","../node_modules/geometry/dist/src/point/To.js","../node_modules/geometry/dist/src/polar/ray.js","../node_modules/geometry/dist/src/polar/spiral.js","../node_modules/geometry/dist/src/polar/index.js","../node_modules/geometry/dist/src/vector.js","../node_modules/geometry/dist/src/line/nearest.js","../node_modules/geometry/dist/src/line/distance-single-line.js","../node_modules/geometry/dist/src/line/angles.js","../node_modules/geometry/dist/src/line/bbox.js","../node_modules/geometry/dist/src/line/divide.js","../node_modules/geometry/dist/src/line/from-numbers.js","../node_modules/geometry/dist/src/line/from-flat-array.js","../node_modules/geometry/dist/src/line/from-pivot.js","../node_modules/geometry/dist/src/line/midpoint.js","../node_modules/geometry/dist/src/line/relative-position.js","../node_modules/geometry/dist/src/line/sum.js","../node_modules/geometry/dist/src/line/rotate.js","../node_modules/geometry/dist/src/line/is-equal.js","../node_modules/geometry/dist/src/line/multiply.js","../node_modules/geometry/dist/src/line/subtract.js","../node_modules/geometry/dist/src/line/to-string.js","../node_modules/geometry/dist/src/line/to-path.js","../node_modules/geometry/dist/src/line/from-points-to-path.js","../node_modules/geometry/dist/src/line/index.js","../node_modules/geometry/dist/src/point/relation.js","../node_modules/geometry/dist/src/point/point-tracker.js","../node_modules/geometry/dist/src/point/progress-between.js","../node_modules/geometry/dist/src/point/project.js","../node_modules/geometry/dist/src/point/quantise.js","../node_modules/geometry/dist/src/point/random.js","../node_modules/geometry/dist/src/point/reduce.js","../node_modules/geometry/dist/src/point/rotate.js","../node_modules/geometry/dist/src/point/rotate-point-array.js","../node_modules/geometry/dist/src/point/round.js","../node_modules/geometry/dist/src/point/within-range.js","../node_modules/geometry/dist/src/point/wrap.js","../node_modules/geometry/dist/src/point/index.js","../node_modules/geometry/dist/src/arc/index.js","../node_modules/geometry/dist/src/bezier/guard.js","../node_modules/geometry/dist/src/bezier/index.js","../node_modules/geometry/dist/src/circle/area.js","../node_modules/geometry/dist/src/circle/bbox.js","../node_modules/geometry/dist/src/circle/center.js","../node_modules/geometry/dist/src/circle/exterior-points.js","../node_modules/geometry/dist/src/circle/interior-points.js","../node_modules/geometry/dist/src/circle/perimeter.js","../node_modules/geometry/dist/src/circle/interpolate.js","../node_modules/geometry/dist/src/circle/is-contained-by.js","../node_modules/geometry/dist/src/circle/intersecting.js","../node_modules/geometry/dist/src/circle/multiply.js","../node_modules/geometry/dist/src/circle/random.js","../node_modules/geometry/dist/src/circle/svg.js","../node_modules/geometry/dist/src/circle/to-path.js","../node_modules/geometry/dist/src/circle/to-positioned.js","../node_modules/geometry/dist/src/circle/index.js","../node_modules/geometry/dist/src/grid/inside.js","../node_modules/geometry/dist/src/grid/guards.js","../node_modules/geometry/dist/src/grid/apply-bounds.js","../node_modules/geometry/dist/src/grid/array-1d.js","../node_modules/geometry/dist/src/grid/array-2d.js","../node_modules/geometry/dist/src/grid/values.js","../node_modules/geometry/dist/src/grid/enumerators/cells.js","../node_modules/geometry/dist/src/grid/as.js","../node_modules/geometry/dist/src/grid/offset.js","../node_modules/geometry/dist/src/grid/directions.js","../node_modules/geometry/dist/src/grid/enumerators/index.js","../node_modules/geometry/dist/src/grid/geometry.js","../node_modules/geometry/dist/src/grid/indexing.js","../node_modules/geometry/dist/src/grid/is-equal.js","../node_modules/geometry/dist/src/grid/neighbour.js","../node_modules/geometry/dist/src/grid/to-array.js","../node_modules/geometry/dist/src/grid/to-string.js","../node_modules/geometry/dist/src/grid/visual.js","../node_modules/geometry/dist/src/grid/visitors/breadth.js","../node_modules/geometry/dist/src/grid/visitors/cell-neighbours.js","../node_modules/geometry/dist/src/grid/visitors/columns.js","../node_modules/geometry/dist/src/grid/visitors/depth.js","../node_modules/geometry/dist/src/grid/visitors/random.js","../node_modules/geometry/dist/src/grid/visitors/random-contiguous.js","../node_modules/geometry/dist/src/grid/visitors/rows.js","../node_modules/geometry/dist/src/grid/visitors/visitor.js","../node_modules/geometry/dist/src/grid/visitors/step.js","../node_modules/geometry/dist/src/grid/visitors/index.js","../node_modules/geometry/dist/src/grid/index.js","../node_modules/geometry/dist/src/path/start-end.js","../node_modules/geometry/dist/src/path/compound-path.js","../node_modules/geometry/dist/src/path/index.js","../node_modules/geometry/dist/src/triangle/create.js","../node_modules/geometry/dist/src/shape/arrow.js","../node_modules/geometry/dist/src/triangle/guard.js","../node_modules/geometry/dist/src/triangle/centroid.js","../node_modules/geometry/dist/src/shape/etc.js","../node_modules/geometry/dist/src/shape/is-intersecting.js","../node_modules/geometry/dist/src/shape/starburst.js","../node_modules/geometry/dist/src/shape/index.js","../node_modules/geometry/dist/src/waypoint.js","../node_modules/geometry/dist/src/circle-packing.js","../node_modules/geometry/dist/src/layout.js","../node_modules/geometry/dist/src/ellipse.js","../node_modules/geometry/dist/src/curve-simplification.js","../node_modules/geometry/dist/src/quad-tree.js","../node_modules/geometry/dist/src/scaler.js","../node_modules/geometry/dist/src/surface-points.js","../node_modules/geometry/dist/src/triangle/angles.js","../node_modules/geometry/dist/src/triangle/edges.js","../node_modules/geometry/dist/src/triangle/area.js","../node_modules/geometry/dist/src/triangle/barycentric.js","../node_modules/geometry/dist/src/triangle/bbox.js","../node_modules/geometry/dist/src/triangle/corners.js","../node_modules/geometry/dist/src/triangle/from.js","../node_modules/geometry/dist/src/triangle/perimeter.js","../node_modules/geometry/dist/src/triangle/inner-circle.js","../node_modules/geometry/dist/src/triangle/intersects.js","../node_modules/geometry/dist/src/triangle/lengths.js","../node_modules/geometry/dist/src/triangle/kinds.js","../node_modules/geometry/dist/src/triangle/math.js","../node_modules/geometry/dist/src/triangle/outer-circle.js","../node_modules/geometry/dist/src/triangle/rotate.js","../node_modules/geometry/dist/src/triangle/to.js","../node_modules/geometry/dist/src/triangle/equilateral.js","../node_modules/geometry/dist/src/triangle/right.js","../node_modules/geometry/dist/src/triangle/isosceles.js","../node_modules/geometry/dist/src/triangle/index.js","../node_modules/geometry/dist/src/index.js","../node_modules/dom/dist/src/resolve-el.js","../node_modules/dom/dist/src/data-table.js","../node_modules/dom/dist/src/drag-drop.js","../node_modules/dom/dist/src/forms.js","../node_modules/dom/dist/src/ts-util.js","../node_modules/dom/dist/src/css-variables.js","../node_modules/dom/dist/src/css.js","../node_modules/dom/dist/src/data-display.js","../node_modules/dom/dist/src/set-property.js","../node_modules/dom/dist/src/el.js","../node_modules/dom/dist/src/internal/debounce.js","../node_modules/dom/dist/src/element-sizing.js","../node_modules/dom/dist/src/error-handler.js","../node_modules/dom/dist/src/shadow-dom.js","../node_modules/dom/dist/src/log.js","../node_modules/dom/dist/src/inline-console.js","../node_modules/dom/dist/src/query.js","../node_modules/dom/dist/src/tabbed-panel.js","../node_modules/dom/dist/src/utility.js","../node_modules/dom/dist/src/index.js","../node_modules/visual/dist/src/drawing.js","../node_modules/.pnpm/colorizr@3.0.7/node_modules/colorizr/dist/index.mjs","../node_modules/visual/dist/src/colour/guards.js","../node_modules/visual/dist/src/colour/utility.js","../node_modules/visual/dist/src/colour/hsl.js","../node_modules/visual/dist/src/colour/oklch.js","../node_modules/visual/dist/src/colour/css-colours.js","../node_modules/visual/dist/src/colour/srgb.js","../node_modules/visual/dist/src/image-data-grid.js","../node_modules/visual/dist/src/canvas-helper.js","../node_modules/visual/dist/src/pi-pi.js","../node_modules/visual/dist/src/canvas-region.js","../node_modules/visual/dist/src/svg/apply.js","../node_modules/visual/dist/src/svg/bounds.js","../node_modules/visual/dist/src/svg/create.js","../node_modules/visual/dist/src/colour/generate.js","../node_modules/visual/dist/src/colour/math.js","../node_modules/visual/dist/src/colour/interpolate.js","../node_modules/visual/dist/src/colour/index.js","../node_modules/visual/dist/src/colour/conversion.js","../node_modules/visual/dist/src/svg/stroke.js","../node_modules/visual/dist/src/svg/markers.js","../node_modules/visual/dist/src/svg/path.js","../node_modules/visual/dist/src/svg/elements.js","../node_modules/visual/dist/src/svg/geometry.js","../node_modules/visual/dist/src/svg/remove.js","../node_modules/visual/dist/src/svg/helper.js","../node_modules/visual/dist/src/svg/index.js","../node_modules/visual/dist/src/pointer-visualise.js","../node_modules/visual/dist/src/convolve-2d.js","../node_modules/visual/dist/src/named-colour-palette.js","../node_modules/visual/dist/src/video.js","../node_modules/visual/dist/src/plot/bipolar-view.js","../node_modules/visual/dist/src/plot/cartesian.js","../node_modules/visual/dist/src/plot/DataSet.js","../node_modules/visual/dist/src/plot/cartesian-canvas-plot.js","../node_modules/visual/dist/src/plot/index.js","../node_modules/visual/dist/src/index.js","../node_modules/visual/src/drawing.ts","../node_modules/visual/src/colour/guards.ts","../node_modules/visual/src/colour/utility.ts","../node_modules/visual/src/colour/hsl.ts","../node_modules/visual/src/colour/oklch.ts","../node_modules/visual/src/colour/css-colours.ts","../node_modules/visual/src/colour/srgb.ts","../node_modules/visual/src/image-data-grid.ts","../node_modules/visual/src/canvas-helper.ts","../node_modules/visual/src/pi-pi.ts","../node_modules/visual/src/canvas-region.ts","../node_modules/visual/src/svg/apply.ts","../node_modules/visual/src/svg/bounds.ts","../node_modules/visual/src/svg/create.ts","../node_modules/visual/src/colour/generate.ts","../node_modules/visual/src/colour/math.ts","../node_modules/visual/src/colour/interpolate.ts","../node_modules/visual/src/colour/index.ts","../node_modules/visual/src/colour/conversion.ts","../node_modules/visual/src/svg/stroke.ts","../node_modules/visual/src/svg/markers.ts","../node_modules/visual/src/svg/path.ts","../node_modules/visual/src/svg/elements.ts","../node_modules/visual/src/svg/geometry.ts","../node_modules/visual/src/svg/remove.ts","../node_modules/visual/src/svg/helper.ts","../node_modules/visual/src/svg/index.ts","../node_modules/visual/src/pointer-visualise.ts","../node_modules/visual/src/convolve-2d.ts","../node_modules/visual/src/named-colour-palette.ts","../node_modules/visual/src/video.ts","../node_modules/visual/src/plot/bipolar-view.ts","../node_modules/visual/src/plot/cartesian.ts","../node_modules/visual/src/plot/DataSet.ts","../node_modules/visual/src/plot/cartesian-canvas-plot.ts","../node_modules/visual/src/plot/index.ts","../node_modules/visual/src/index.ts","../src/components/pose-overlay.ts","../src/util/log.ts","../src/recorder.ts","../src/components/vision-element.ts","../src/components/rec-panel.ts","../src/components/video-source.ts","../src/processor-modes.ts","../src/components/model-element.ts","../node_modules/geometry/src/pi.ts","../node_modules/geometry/src/angles.ts","../node_modules/geometry/src/point/guard.ts","../node_modules/geometry/src/point/get-point-parameter.ts","../node_modules/geometry/src/point/distance.ts","../node_modules/geometry/src/point/find-minimum.ts","../node_modules/geometry/src/rect/max.ts","../node_modules/geometry/src/point/bbox.ts","../node_modules/geometry/src/polar/guard.ts","../node_modules/geometry/src/polar/angles.ts","../node_modules/geometry/src/point/subtract.ts","../node_modules/geometry/src/point/empty.ts","../node_modules/geometry/src/polar/conversions.ts","../node_modules/geometry/src/polar/math.ts","../node_modules/geometry/src/point/point-type.ts","../node_modules/geometry/src/point/angle.ts","../node_modules/geometry/src/point/To.ts","../node_modules/geometry/src/polar/ray.ts","../node_modules/geometry/src/polar/spiral.ts","../node_modules/geometry/src/polar/index.ts","../node_modules/geometry/src/line/from-points.ts","../node_modules/geometry/src/arc/index.ts","../node_modules/geometry/src/line/guard.ts","../node_modules/geometry/src/line/get-points-parameter.ts","../node_modules/geometry/src/line/length.ts","../node_modules/geometry/src/line/reverse.ts","../node_modules/geometry/src/line/interpolate.ts","../node_modules/geometry/src/rect/guard.ts","../node_modules/geometry/src/rect/from-top-left.ts","../node_modules/geometry/src/bezier/guard.ts","../node_modules/geometry/src/bezier/index.ts","../node_modules/geometry/src/circle/guard.ts","../node_modules/geometry/src/circle/area.ts","../node_modules/geometry/src/rect/from-center.ts","../node_modules/geometry/src/circle/bbox.ts","../node_modules/geometry/src/circle/center.ts","../node_modules/geometry/src/circle/distance-center.ts","../node_modules/geometry/src/circle/distance-from-exterior.ts","../node_modules/geometry/src/circle/exterior-points.ts","../node_modules/geometry/src/circle/interior-points.ts","../node_modules/geometry/src/circle/perimeter.ts","../node_modules/geometry/src/circle/interpolate.ts","../node_modules/geometry/src/circle/is-equal.ts","../node_modules/geometry/src/point/sum.ts","../node_modules/geometry/src/circle/intersections.ts","../node_modules/geometry/src/intersects.ts","../node_modules/geometry/src/circle/is-contained-by.ts","../node_modules/geometry/src/point/is-equal.ts","../node_modules/geometry/src/circle/intersecting.ts","../node_modules/geometry/src/point/multiply.ts","../node_modules/geometry/src/circle/multiply.ts","../node_modules/geometry/src/circle/random.ts","../node_modules/geometry/src/circle/svg.ts","../node_modules/geometry/src/circle/to-path.ts","../node_modules/geometry/src/circle/to-positioned.ts","../node_modules/geometry/src/circle/index.ts","../node_modules/geometry/src/grid/inside.ts","../node_modules/geometry/src/grid/guards.ts","../node_modules/geometry/src/grid/apply-bounds.ts","../node_modules/geometry/src/grid/array-1d.ts","../node_modules/geometry/src/grid/array-2d.ts","../node_modules/geometry/src/grid/values.ts","../node_modules/geometry/src/grid/enumerators/cells.ts","../node_modules/geometry/src/grid/as.ts","../node_modules/geometry/src/grid/offset.ts","../node_modules/geometry/src/grid/directions.ts","../node_modules/geometry/src/grid/enumerators/index.ts","../node_modules/geometry/src/grid/geometry.ts","../node_modules/geometry/src/grid/indexing.ts","../node_modules/geometry/src/grid/is-equal.ts","../node_modules/geometry/src/grid/neighbour.ts","../node_modules/geometry/src/grid/to-array.ts","../node_modules/geometry/src/grid/to-string.ts","../node_modules/geometry/src/grid/visual.ts","../node_modules/geometry/src/grid/visitors/breadth.ts","../node_modules/geometry/src/grid/visitors/cell-neighbours.ts","../node_modules/geometry/src/grid/visitors/columns.ts","../node_modules/geometry/src/grid/visitors/depth.ts","../node_modules/geometry/src/grid/visitors/random.ts","../node_modules/geometry/src/grid/visitors/random-contiguous.ts","../node_modules/geometry/src/grid/visitors/rows.ts","../node_modules/geometry/src/grid/visitors/visitor.ts","../node_modules/geometry/src/grid/visitors/step.ts","../node_modules/geometry/src/grid/visitors/index.ts","../node_modules/geometry/src/grid/index.ts","../node_modules/geometry/src/point/normalise-by-rect.ts","../node_modules/geometry/src/line/nearest.ts","../node_modules/geometry/src/line/distance-single-line.ts","../node_modules/geometry/src/line/angles.ts","../node_modules/geometry/src/line/bbox.ts","../node_modules/geometry/src/point/divider.ts","../node_modules/geometry/src/line/divide.ts","../node_modules/geometry/src/line/from-numbers.ts","../node_modules/geometry/src/line/from-flat-array.ts","../node_modules/geometry/src/line/from-pivot.ts","../node_modules/geometry/src/line/midpoint.ts","../node_modules/geometry/src/line/relative-position.ts","../node_modules/geometry/src/line/sum.ts","../node_modules/geometry/src/point/abs.ts","../node_modules/geometry/src/point/apply.ts","../node_modules/geometry/src/point/averager.ts","../node_modules/geometry/src/point/centroid.ts","../node_modules/geometry/src/point/clamp.ts","../node_modules/geometry/src/point/compare.ts","../node_modules/geometry/src/point/convex-hull.ts","../node_modules/geometry/src/rect/Intersects.ts","../node_modules/geometry/src/rect/center.ts","../node_modules/geometry/src/rect/distance.ts","../node_modules/geometry/src/point/distance-to-center.ts","../node_modules/geometry/src/point/distance-to-exterior.ts","../node_modules/geometry/src/point/to-array.ts","../node_modules/geometry/src/point/dot-product.ts","../node_modules/geometry/src/point/from.ts","../node_modules/geometry/src/point/interpolate.ts","../node_modules/geometry/src/point/invert.ts","../node_modules/geometry/src/point/magnitude.ts","../node_modules/geometry/src/point/most.ts","../node_modules/geometry/src/point/normalise.ts","../node_modules/geometry/src/point/pipeline.ts","../node_modules/geometry/src/vector.ts","../node_modules/geometry/src/line/join-points-to-lines.ts","../node_modules/geometry/src/point/relation.ts","../node_modules/geometry/src/point/point-tracker.ts","../node_modules/geometry/src/point/progress-between.ts","../node_modules/geometry/src/point/project.ts","../node_modules/geometry/src/point/quantise.ts","../node_modules/geometry/src/point/random.ts","../node_modules/geometry/src/point/reduce.ts","../node_modules/geometry/src/point/rotate.ts","../node_modules/geometry/src/point/rotate-point-array.ts","../node_modules/geometry/src/point/round.ts","../node_modules/geometry/src/point/within-range.ts","../node_modules/geometry/src/point/wrap.ts","../node_modules/geometry/src/point/index.ts","../node_modules/geometry/src/line/rotate.ts","../node_modules/geometry/src/line/is-equal.ts","../node_modules/geometry/src/line/multiply.ts","../node_modules/geometry/src/line/subtract.ts","../node_modules/geometry/src/line/to-string.ts","../node_modules/geometry/src/line/to-path.ts","../node_modules/geometry/src/line/from-points-to-path.ts","../node_modules/geometry/src/line/index.ts","../node_modules/geometry/src/rect/corners.ts","../node_modules/geometry/src/path/start-end.ts","../node_modules/geometry/src/path/compound-path.ts","../node_modules/geometry/src/path/index.ts","../node_modules/geometry/src/rect/area.ts","../node_modules/geometry/src/rect/apply.ts","../node_modules/geometry/src/rect/cardinal.ts","../node_modules/geometry/src/rect/center-origin.ts","../node_modules/geometry/src/rect/divide.ts","../node_modules/geometry/src/rect/edges.ts","../node_modules/geometry/src/rect/empty.ts","../node_modules/geometry/src/rect/encompass.ts","../node_modules/geometry/src/rect/from-element.ts","../node_modules/geometry/src/rect/from-numbers.ts","../node_modules/geometry/src/rect/get-rect-positionedparameter.ts","../node_modules/geometry/src/rect/is-equal.ts","../node_modules/geometry/src/rect/lengths.ts","../node_modules/geometry/src/rect/multiply.ts","../node_modules/geometry/src/rect/nearest.ts","../node_modules/geometry/src/rect/placeholder.ts","../node_modules/geometry/src/rect/perimeter.ts","../node_modules/geometry/src/rect/normalise-by-rect.ts","../node_modules/geometry/src/rect/random.ts","../node_modules/geometry/src/rect/subtract.ts","../node_modules/geometry/src/rect/sum.ts","../node_modules/geometry/src/rect/to-array.ts","../node_modules/geometry/src/rect/index.ts","../node_modules/geometry/src/triangle/create.ts","../node_modules/geometry/src/shape/arrow.ts","../node_modules/geometry/src/triangle/guard.ts","../node_modules/geometry/src/triangle/centroid.ts","../node_modules/geometry/src/shape/etc.ts","../node_modules/geometry/src/shape/is-intersecting.ts","../node_modules/geometry/src/shape/starburst.ts","../node_modules/geometry/src/shape/index.ts","../node_modules/geometry/src/waypoint.ts","../node_modules/geometry/src/circle-packing.ts","../node_modules/geometry/src/layout.ts","../node_modules/geometry/src/ellipse.ts","../node_modules/geometry/src/curve-simplification.ts","../node_modules/geometry/src/quad-tree.ts","../node_modules/geometry/src/scaler.ts","../node_modules/geometry/src/surface-points.ts","../node_modules/geometry/src/triangle/angles.ts","../node_modules/geometry/src/triangle/edges.ts","../node_modules/geometry/src/triangle/area.ts","../node_modules/geometry/src/triangle/barycentric.ts","../node_modules/geometry/src/triangle/bbox.ts","../node_modules/geometry/src/triangle/corners.ts","../node_modules/geometry/src/triangle/from.ts","../node_modules/geometry/src/triangle/perimeter.ts","../node_modules/geometry/src/triangle/inner-circle.ts","../node_modules/geometry/src/triangle/intersects.ts","../node_modules/geometry/src/triangle/lengths.ts","../node_modules/geometry/src/triangle/kinds.ts","../node_modules/geometry/src/triangle/math.ts","../node_modules/geometry/src/triangle/outer-circle.ts","../node_modules/geometry/src/triangle/rotate.ts","../node_modules/geometry/src/triangle/to.ts","../node_modules/geometry/src/triangle/equilateral.ts","../node_modules/geometry/src/triangle/right.ts","../node_modules/geometry/src/triangle/isosceles.ts","../node_modules/geometry/src/triangle/index.ts","../node_modules/random/src/weighted-index.ts","../node_modules/random/src/arrays.ts","../node_modules/random/src/chance.ts","../node_modules/random/src/float-source.ts","../node_modules/random/src/non-zero.ts","../node_modules/random/src/gaussian.ts","../node_modules/random/src/guid.ts","../node_modules/random/src/util/count.ts","../node_modules/random/src/integer.ts","../node_modules/random/src/seeded.ts","../node_modules/random/src/string.ts","../node_modules/random/src/time.ts","../node_modules/random/src/util/clamp.ts","../node_modules/random/src/weighted-integer.ts","../node_modules/random/src/weighted.ts","../src/mediapipe/pose-matcher.ts","../src/mediapipe/makeModelPath.ts","../src/mediapipe/pose-detector.ts","../src/mediapipe/object-detector.ts","../src/mediapipe/face-detector.ts","../src/mediapipe/hand-detector.ts","../src/processing.ts","../src/util/text.ts","../src/sources/camera-sources.ts","../src/sources/record-player.ts","../src/sources/recording-sources.ts","../src/sources/video-element-source.ts","../src/sources/index.ts","../node_modules/@clinth/remote/src/Util.ts","../node_modules/@clinth/remote/src/BroadcasterBase.ts","../node_modules/@clinth/remote/src/util/Log.ts","../node_modules/@clinth/remote/src/BcBroadcast.ts","../node_modules/@clinth/remote/src/Broadcast.ts","../node_modules/@clinth/remote/src/LogicalNode.ts","../node_modules/@clinth/remote/src/PeeringSession.ts","../node_modules/@clinth/remote/src/util/ExpiringMap.ts","../node_modules/@clinth/remote/src/Peering.ts","../node_modules/@clinth/remote/src/RtcChannelFactory.ts","../node_modules/@clinth/remote/src/util/StatusDisplay.ts","../node_modules/@clinth/remote/src/util/Events.ts","../node_modules/@clinth/remote/src/ReconnectingWebsocket.ts","../node_modules/@clinth/remote/src/WebsocketBroadcast.ts","../node_modules/@clinth/remote/src/Manager.ts","../node_modules/@clinth/remote/src/index.ts","../src/dispatcher.ts","../src/ml-vision.ts","../src/client.ts","../src/util/search-params.ts"],"sourcesContent":["/**\n * @license\n * Copyright 2023 Google LLC\n * SPDX-License-Identifier: BSD-3-Clause\n */\n\ntype ARIAAttributeMap = {\n  [K in keyof ARIAMixin]: string;\n};\n\n/**\n * Map of ARIAMixin properties to attributes\n */\nexport const ariaMixinAttributes: ARIAAttributeMap = {\n  ariaAtomic: 'aria-atomic',\n  ariaAutoComplete: 'aria-autocomplete',\n  ariaBrailleLabel: 'aria-braillelabel',\n  ariaBrailleRoleDescription: 'aria-brailleroledescription',\n  ariaBusy: 'aria-busy',\n  ariaChecked: 'aria-checked',\n  ariaColCount: 'aria-colcount',\n  ariaColIndex: 'aria-colindex',\n  ariaColSpan: 'aria-colspan',\n  ariaCurrent: 'aria-current',\n  ariaDescription: 'aria-description',\n  ariaDisabled: 'aria-disabled',\n  ariaExpanded: 'aria-expanded',\n  ariaHasPopup: 'aria-haspopup',\n  ariaHidden: 'aria-hidden',\n  ariaInvalid: 'aria-invalid',\n  ariaKeyShortcuts: 'aria-keyshortcuts',\n  ariaLabel: 'aria-label',\n  ariaLevel: 'aria-level',\n  ariaLive: 'aria-live',\n  ariaModal: 'aria-modal',\n  ariaMultiLine: 'aria-multiline',\n  ariaMultiSelectable: 'aria-multiselectable',\n  ariaOrientation: 'aria-orientation',\n  ariaPlaceholder: 'aria-placeholder',\n  ariaPosInSet: 'aria-posinset',\n  ariaPressed: 'aria-pressed',\n  ariaReadOnly: 'aria-readonly',\n  ariaRequired: 'aria-required',\n  ariaRoleDescription: 'aria-roledescription',\n  ariaRowCount: 'aria-rowcount',\n  ariaRowIndex: 'aria-rowindex',\n  ariaRowSpan: 'aria-rowspan',\n  ariaSelected: 'aria-selected',\n  ariaSetSize: 'aria-setsize',\n  ariaSort: 'aria-sort',\n  ariaValueMax: 'aria-valuemax',\n  ariaValueMin: 'aria-valuemin',\n  ariaValueNow: 'aria-valuenow',\n  ariaValueText: 'aria-valuetext',\n  role: 'role',\n};\n\ntype ElementInternalsInterface = ElementInternals;\n\n// Shim the global element internals object\n// Methods should be fine as noops and properties can generally\n// be while on the server.\nexport const ElementInternalsShim = class ElementInternals\n  implements ElementInternalsInterface\n{\n  ariaAtomic = '';\n  ariaAutoComplete = '';\n  ariaBrailleLabel = '';\n  ariaBrailleRoleDescription = '';\n  ariaBusy = '';\n  ariaChecked = '';\n  ariaColCount = '';\n  ariaColIndex = '';\n  ariaColSpan = '';\n  ariaCurrent = '';\n  ariaDescription = '';\n  ariaDisabled = '';\n  ariaExpanded = '';\n  ariaHasPopup = '';\n  ariaHidden = '';\n  ariaInvalid = '';\n  ariaKeyShortcuts = '';\n  ariaLabel = '';\n  ariaLevel = '';\n  ariaLive = '';\n  ariaModal = '';\n  ariaMultiLine = '';\n  ariaMultiSelectable = '';\n  ariaOrientation = '';\n  ariaPlaceholder = '';\n  ariaPosInSet = '';\n  ariaPressed = '';\n  ariaReadOnly = '';\n  ariaRequired = '';\n  ariaRoleDescription = '';\n  ariaRowCount = '';\n  ariaRowIndex = '';\n  ariaRowSpan = '';\n  ariaSelected = '';\n  ariaSetSize = '';\n  ariaSort = '';\n  ariaValueMax = '';\n  ariaValueMin = '';\n  ariaValueNow = '';\n  ariaValueText = '';\n  role = '';\n  __host: HTMLElement;\n  get shadowRoot() {\n    // Grab the shadow root instance from the Element shim\n    // to ensure that the shadow root is always available\n    // to the internals instance even if the mode is 'closed'\n    return (this.__host as HTMLElement & {__shadowRoot: ShadowRoot})\n      .__shadowRoot;\n  }\n  constructor(_host: HTMLElement) {\n    this.__host = _host;\n  }\n  checkValidity() {\n    // TODO(augustjk) Consider actually implementing logic.\n    // See https://github.com/lit/lit/issues/3740\n    console.warn(\n      '`ElementInternals.checkValidity()` was called on the server.' +\n        'This method always returns true.'\n    );\n    return true;\n  }\n  form = null;\n  labels = [] as unknown as NodeListOf<HTMLLabelElement>;\n  reportValidity() {\n    return true;\n  }\n  setFormValue(): void {}\n  setValidity(): void {}\n  states = new Set<string>();\n  validationMessage = '';\n  validity = {} as ValidityState;\n  willValidate = true;\n};\n\nconst ElementInternalsShimWithRealType =\n  ElementInternalsShim as object as typeof ElementInternals;\nexport {ElementInternalsShimWithRealType as ElementInternals};\n\nexport const HYDRATE_INTERNALS_ATTR_PREFIX = 'hydrate-internals-';\n","/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: BSD-3-Clause\n */\nimport {ElementInternalsShim} from './lib/element-internals.js';\n\nexport {\n  ariaMixinAttributes,\n  ElementInternals,\n  HYDRATE_INTERNALS_ATTR_PREFIX,\n} from './lib/element-internals.js';\n\nconst attributes = new WeakMap<\n  InstanceType<typeof HTMLElementShim>,\n  Map<string, string>\n>();\nconst attributesForElement = (\n  element: InstanceType<typeof HTMLElementShim>\n) => {\n  let attrs = attributes.get(element);\n  if (attrs === undefined) {\n    attributes.set(element, (attrs = new Map()));\n  }\n  return attrs;\n};\n\n// The typings around the exports below are a little funky:\n//\n// 1. We want the `name` of the shim classes to match the real ones at runtime,\n//    hence e.g. `class Element`.\n// 2. We can't shadow the global types with a simple class declaration, because\n//    then we can't reference the global types for casting, hence e.g.\n//    `const ElementShim = class Element`.\n// 3. We want to export the classes typed as the real ones, hence e.g.\n//    `const ElementShimWithRealType = ElementShim as object as typeof Element;`.\n// 4. We want the exported names to match the real ones, hence e.g.\n//    `export {ElementShimWithRealType as Element}`.\nconst ElementShim = class Element {\n  get attributes() {\n    return Array.from(attributesForElement(this)).map(([name, value]) => ({\n      name,\n      value,\n    }));\n  }\n  private __shadowRootMode: null | ShadowRootMode = null;\n  protected __shadowRoot: null | ShadowRoot = null;\n  protected __internals: null | ElementInternals = null;\n\n  get shadowRoot() {\n    if (this.__shadowRootMode === 'closed') {\n      return null;\n    }\n    return this.__shadowRoot;\n  }\n  get localName() {\n    return (this.constructor as NamedCustomHTMLElementConstructor).__localName;\n  }\n  get tagName() {\n    return this.localName?.toUpperCase();\n  }\n  setAttribute(name: string, value: unknown): void {\n    // Emulate browser behavior that silently casts all values to string. E.g.\n    // `42` becomes `\"42\"` and `{}` becomes `\"[object Object]\"\"`.\n    attributesForElement(this).set(name, String(value));\n  }\n  removeAttribute(name: string) {\n    attributesForElement(this).delete(name);\n  }\n  toggleAttribute(name: string, force?: boolean): boolean {\n    // Steps reference https://dom.spec.whatwg.org/#dom-element-toggleattribute\n    if (this.hasAttribute(name)) {\n      // Step 5\n      if (force === undefined || !force) {\n        this.removeAttribute(name);\n        return false;\n      }\n    } else {\n      // Step 4\n      if (force === undefined || force) {\n        // Step 4.1\n        this.setAttribute(name, '');\n        return true;\n      } else {\n        // Step 4.2\n        return false;\n      }\n    }\n    // Step 6\n    return true;\n  }\n  hasAttribute(name: string) {\n    return attributesForElement(this).has(name);\n  }\n  attachShadow(init: ShadowRootInit): ShadowRoot {\n    const shadowRoot = {host: this} as object as ShadowRoot;\n    this.__shadowRootMode = init.mode;\n    if (init && init.mode === 'open') {\n      this.__shadowRoot = shadowRoot;\n    }\n    return shadowRoot;\n  }\n  attachInternals(): ElementInternals {\n    if (this.__internals !== null) {\n      throw new Error(\n        `Failed to execute 'attachInternals' on 'HTMLElement': ` +\n          `ElementInternals for the specified element was already attached.`\n      );\n    }\n    const internals = new ElementInternalsShim(this as unknown as HTMLElement);\n    this.__internals = internals;\n    return internals as ElementInternals;\n  }\n  getAttribute(name: string) {\n    const value = attributesForElement(this).get(name);\n    return value ?? null;\n  }\n};\nconst ElementShimWithRealType = ElementShim as object as typeof Element;\nexport {ElementShimWithRealType as Element};\n\nconst HTMLElementShim = class HTMLElement extends ElementShim {};\nconst HTMLElementShimWithRealType =\n  HTMLElementShim as object as typeof HTMLElement;\nexport {HTMLElementShimWithRealType as HTMLElement};\n\ninterface CustomHTMLElementConstructor {\n  new (): HTMLElement;\n  observedAttributes?: string[];\n}\n\ninterface NamedCustomHTMLElementConstructor\n  extends CustomHTMLElementConstructor {\n  __localName: string;\n}\n\ntype CustomElementRegistration = {\n  ctor: {new (): HTMLElement};\n  observedAttributes: string[];\n};\n\nconst CustomElementRegistryShim = class CustomElementRegistry {\n  private __definitions = new Map<string, CustomElementRegistration>();\n\n  define(name: string, ctor: CustomHTMLElementConstructor) {\n    if (this.__definitions.has(name)) {\n      if (process.env.NODE_ENV === 'development') {\n        console.warn(\n          `'CustomElementRegistry' already has \"${name}\" defined. ` +\n            `This may have been caused by live reload or hot module ` +\n            `replacement in which case it can be safely ignored.\\n` +\n            `Make sure to test your application with a production build as ` +\n            `repeat registrations will throw in production.`\n        );\n      } else {\n        throw new Error(\n          `Failed to execute 'define' on 'CustomElementRegistry': ` +\n            `the name \"${name}\" has already been used with this registry`\n        );\n      }\n    }\n    // Provide tagName and localName for the component.\n    (ctor as NamedCustomHTMLElementConstructor).__localName = name;\n    this.__definitions.set(name, {\n      ctor,\n      // Note it's important we read `observedAttributes` in case it is a getter\n      // with side-effects, as is the case in Lit, where it triggers class\n      // finalization.\n      //\n      // TODO(aomarks) To be spec compliant, we should also capture the\n      // registration-time lifecycle methods like `connectedCallback`. For them\n      // to be actually accessible to e.g. the Lit SSR element renderer, though,\n      // we'd need to introduce a new API for accessing them (since `get` only\n      // returns the constructor).\n      observedAttributes: ctor.observedAttributes ?? [],\n    });\n  }\n\n  get(name: string) {\n    const definition = this.__definitions.get(name);\n    return definition?.ctor;\n  }\n};\nconst CustomElementRegistryShimWithRealType =\n  CustomElementRegistryShim as object as typeof CustomElementRegistry;\nexport {CustomElementRegistryShimWithRealType as CustomElementRegistry};\n\nexport const customElements = new CustomElementRegistryShimWithRealType();\n","/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: BSD-3-Clause\n */\n\nconst NODE_MODE = false;\n\n// Allows minifiers to rename references to globalThis\nconst global = globalThis;\n\n/**\n * Whether the current browser supports `adoptedStyleSheets`.\n */\nexport const supportsAdoptingStyleSheets: boolean =\n  global.ShadowRoot &&\n  (global.ShadyCSS === undefined || global.ShadyCSS.nativeShadow) &&\n  'adoptedStyleSheets' in Document.prototype &&\n  'replace' in CSSStyleSheet.prototype;\n\n/**\n * A CSSResult or native CSSStyleSheet.\n *\n * In browsers that support constructible CSS style sheets, CSSStyleSheet\n * object can be used for styling along side CSSResult from the `css`\n * template tag.\n */\nexport type CSSResultOrNative = CSSResult | CSSStyleSheet;\n\nexport type CSSResultArray = Array<CSSResultOrNative | CSSResultArray>;\n\n/**\n * A single CSSResult, CSSStyleSheet, or an array or nested arrays of those.\n */\nexport type CSSResultGroup = CSSResultOrNative | CSSResultArray;\n\nconst constructionToken = Symbol();\n\nconst cssTagCache = new WeakMap<TemplateStringsArray, CSSStyleSheet>();\n\n/**\n * A container for a string of CSS text, that may be used to create a CSSStyleSheet.\n *\n * CSSResult is the return value of `css`-tagged template literals and\n * `unsafeCSS()`. In order to ensure that CSSResults are only created via the\n * `css` tag and `unsafeCSS()`, CSSResult cannot be constructed directly.\n */\nexport class CSSResult {\n  // This property needs to remain unminified.\n  ['_$cssResult$'] = true;\n  readonly cssText: string;\n  private _styleSheet?: CSSStyleSheet;\n  private _strings: TemplateStringsArray | undefined;\n\n  private constructor(\n    cssText: string,\n    strings: TemplateStringsArray | undefined,\n    safeToken: symbol\n  ) {\n    if (safeToken !== constructionToken) {\n      throw new Error(\n        'CSSResult is not constructable. Use `unsafeCSS` or `css` instead.'\n      );\n    }\n    this.cssText = cssText;\n    this._strings = strings;\n  }\n\n  // This is a getter so that it's lazy. In practice, this means stylesheets\n  // are not created until the first element instance is made.\n  get styleSheet(): CSSStyleSheet | undefined {\n    // If `supportsAdoptingStyleSheets` is true then we assume CSSStyleSheet is\n    // constructable.\n    let styleSheet = this._styleSheet;\n    const strings = this._strings;\n    if (supportsAdoptingStyleSheets && styleSheet === undefined) {\n      const cacheable = strings !== undefined && strings.length === 1;\n      if (cacheable) {\n        styleSheet = cssTagCache.get(strings);\n      }\n      if (styleSheet === undefined) {\n        (this._styleSheet = styleSheet = new CSSStyleSheet()).replaceSync(\n          this.cssText\n        );\n        if (cacheable) {\n          cssTagCache.set(strings, styleSheet);\n        }\n      }\n    }\n    return styleSheet;\n  }\n\n  toString(): string {\n    return this.cssText;\n  }\n}\n\ntype ConstructableCSSResult = CSSResult & {\n  new (\n    cssText: string,\n    strings: TemplateStringsArray | undefined,\n    safeToken: symbol\n  ): CSSResult;\n};\n\nconst textFromCSSResult = (value: CSSResultGroup | number) => {\n  // This property needs to remain unminified.\n  if ((value as CSSResult)['_$cssResult$'] === true) {\n    return (value as CSSResult).cssText;\n  } else if (typeof value === 'number') {\n    return value;\n  } else {\n    throw new Error(\n      `Value passed to 'css' function must be a 'css' function result: ` +\n        `${value}. Use 'unsafeCSS' to pass non-literal values, but take care ` +\n        `to ensure page security.`\n    );\n  }\n};\n\n/**\n * Wrap a value for interpolation in a {@linkcode css} tagged template literal.\n *\n * This is unsafe because untrusted CSS text can be used to phone home\n * or exfiltrate data to an attacker controlled site. Take care to only use\n * this with trusted input.\n */\nexport const unsafeCSS = (value: unknown) =>\n  new (CSSResult as ConstructableCSSResult)(\n    typeof value === 'string' ? value : String(value),\n    undefined,\n    constructionToken\n  );\n\n/**\n * A template literal tag which can be used with LitElement's\n * {@linkcode LitElement.styles} property to set element styles.\n *\n * For security reasons, only literal string values and number may be used in\n * embedded expressions. To incorporate non-literal values {@linkcode unsafeCSS}\n * may be used inside an expression.\n */\nexport const css = (\n  strings: TemplateStringsArray,\n  ...values: (CSSResultGroup | number)[]\n): CSSResult => {\n  const cssText =\n    strings.length === 1\n      ? strings[0]\n      : values.reduce(\n          (acc, v, idx) => acc + textFromCSSResult(v) + strings[idx + 1],\n          strings[0]\n        );\n  return new (CSSResult as ConstructableCSSResult)(\n    cssText,\n    strings,\n    constructionToken\n  );\n};\n\n/**\n * Applies the given styles to a `shadowRoot`. When Shadow DOM is\n * available but `adoptedStyleSheets` is not, styles are appended to the\n * `shadowRoot` to [mimic spec behavior](https://wicg.github.io/construct-stylesheets/#using-constructed-stylesheets).\n * Note, when shimming is used, any styles that are subsequently placed into\n * the shadowRoot should be placed *before* any shimmed adopted styles. This\n * will match spec behavior that gives adopted sheets precedence over styles in\n * shadowRoot.\n */\nexport const adoptStyles = (\n  renderRoot: ShadowRoot,\n  styles: Array<CSSResultOrNative>\n) => {\n  if (supportsAdoptingStyleSheets) {\n    (renderRoot as ShadowRoot).adoptedStyleSheets = styles.map((s) =>\n      s instanceof CSSStyleSheet ? s : s.styleSheet!\n    );\n  } else {\n    for (const s of styles) {\n      const style = document.createElement('style');\n      // eslint-disable-next-line @typescript-eslint/no-explicit-any\n      const nonce = (global as any)['litNonce'];\n      if (nonce !== undefined) {\n        style.setAttribute('nonce', nonce);\n      }\n      style.textContent = (s as CSSResult).cssText;\n      renderRoot.appendChild(style);\n    }\n  }\n};\n\nconst cssResultFromStyleSheet = (sheet: CSSStyleSheet) => {\n  let cssText = '';\n  for (const rule of sheet.cssRules) {\n    cssText += rule.cssText;\n  }\n  return unsafeCSS(cssText);\n};\n\nexport const getCompatibleStyle =\n  supportsAdoptingStyleSheets ||\n  (NODE_MODE && global.CSSStyleSheet === undefined)\n    ? (s: CSSResultOrNative) => s\n    : (s: CSSResultOrNative) =>\n        s instanceof CSSStyleSheet ? cssResultFromStyleSheet(s) : s;\n","/**\n * @license\n * Copyright 2017 Google LLC\n * SPDX-License-Identifier: BSD-3-Clause\n */\n\n/**\n * Use this module if you want to create your own base class extending\n * {@link ReactiveElement}.\n * @packageDocumentation\n */\n\nimport {\n  getCompatibleStyle,\n  adoptStyles,\n  CSSResultGroup,\n  CSSResultOrNative,\n} from './css-tag.js';\nimport type {\n  ReactiveController,\n  ReactiveControllerHost,\n} from './reactive-controller.js';\n\n// In the Node build, this import will be injected by Rollup:\n// import {HTMLElement, customElements} from '@lit-labs/ssr-dom-shim';\n\nexport * from './css-tag.js';\nexport type {\n  ReactiveController,\n  ReactiveControllerHost,\n} from './reactive-controller.js';\n\n/**\n * Removes the `readonly` modifier from properties in the union K.\n *\n * This is a safer way to cast a value to a type with a mutable version of a\n * readonly field, than casting to an interface with the field re-declared\n * because it preserves the type of all the fields and warns on typos.\n */\ntype Mutable<T, K extends keyof T> = Omit<T, K> & {\n  -readonly [P in keyof Pick<T, K>]: P extends K ? T[P] : never;\n};\n\n// TODO (justinfagnani): Add `hasOwn` here when we ship ES2022\nconst {\n  is,\n  defineProperty,\n  getOwnPropertyDescriptor,\n  getOwnPropertyNames,\n  getOwnPropertySymbols,\n  getPrototypeOf,\n} = Object;\n\nconst NODE_MODE = false;\n\n// Lets a minifier replace globalThis references with a minified name\nconst global = globalThis;\n\nif (NODE_MODE) {\n  global.customElements ??= customElements;\n}\n\nconst DEV_MODE = true;\n\nlet issueWarning: (code: string, warning: string) => void;\n\nconst trustedTypes = (global as unknown as {trustedTypes?: {emptyScript: ''}})\n  .trustedTypes;\n\n// Temporary workaround for https://crbug.com/993268\n// Currently, any attribute starting with \"on\" is considered to be a\n// TrustedScript source. Such boolean attributes must be set to the equivalent\n// trusted emptyScript value.\nconst emptyStringForBooleanAttribute = trustedTypes\n  ? (trustedTypes.emptyScript as unknown as '')\n  : '';\n\nconst polyfillSupport = DEV_MODE\n  ? global.reactiveElementPolyfillSupportDevMode\n  : global.reactiveElementPolyfillSupport;\n\nif (DEV_MODE) {\n  // Ensure warnings are issued only 1x, even if multiple versions of Lit\n  // are loaded.\n  const issuedWarnings: Set<string | undefined> = (global.litIssuedWarnings ??=\n    new Set());\n\n  // Issue a warning, if we haven't already.\n  issueWarning = (code: string, warning: string) => {\n    warning += ` See https://lit.dev/msg/${code} for more information.`;\n    if (!issuedWarnings.has(warning)) {\n      console.warn(warning);\n      issuedWarnings.add(warning);\n    }\n  };\n\n  issueWarning(\n    'dev-mode',\n    `Lit is in dev mode. Not recommended for production!`\n  );\n\n  // Issue polyfill support warning.\n  if (global.ShadyDOM?.inUse && polyfillSupport === undefined) {\n    issueWarning(\n      'polyfill-support-missing',\n      `Shadow DOM is being polyfilled via \\`ShadyDOM\\` but ` +\n        `the \\`polyfill-support\\` module has not been loaded.`\n    );\n  }\n}\n\n/**\n * Contains types that are part of the unstable debug API.\n *\n * Everything in this API is not stable and may change or be removed in the future,\n * even on patch releases.\n */\n// eslint-disable-next-line @typescript-eslint/no-namespace\nexport namespace ReactiveUnstable {\n  /**\n   * When Lit is running in dev mode and `window.emitLitDebugLogEvents` is true,\n   * we will emit 'lit-debug' events to window, with live details about the update and render\n   * lifecycle. These can be useful for writing debug tooling and visualizations.\n   *\n   * Please be aware that running with window.emitLitDebugLogEvents has performance overhead,\n   * making certain operations that are normally very cheap (like a no-op render) much slower,\n   * because we must copy data and dispatch events.\n   */\n  // eslint-disable-next-line @typescript-eslint/no-namespace\n  export namespace DebugLog {\n    export type Entry = Update;\n    export interface Update {\n      kind: 'update';\n    }\n  }\n}\n\ninterface DebugLoggingWindow {\n  // Even in dev mode, we generally don't want to emit these events, as that's\n  // another level of cost, so only emit them when DEV_MODE is true _and_ when\n  // window.emitLitDebugEvents is true.\n  emitLitDebugLogEvents?: boolean;\n}\n\n/**\n * Useful for visualizing and logging insights into what the Lit template system is doing.\n *\n * Compiled out of prod mode builds.\n */\nconst debugLogEvent = DEV_MODE\n  ? (event: ReactiveUnstable.DebugLog.Entry) => {\n      const shouldEmit = (global as unknown as DebugLoggingWindow)\n        .emitLitDebugLogEvents;\n      if (!shouldEmit) {\n        return;\n      }\n      global.dispatchEvent(\n        new CustomEvent<ReactiveUnstable.DebugLog.Entry>('lit-debug', {\n          detail: event,\n        })\n      );\n    }\n  : undefined;\n\n/*\n * When using Closure Compiler, JSCompiler_renameProperty(property, object) is\n * replaced at compile time by the munged name for object[property]. We cannot\n * alias this function, so we have to use a small shim that has the same\n * behavior when not compiling.\n */\n/*@__INLINE__*/\nconst JSCompiler_renameProperty = <P extends PropertyKey>(\n  prop: P,\n  _obj: unknown\n): P => prop;\n\n/**\n * Converts property values to and from attribute values.\n */\nexport interface ComplexAttributeConverter<Type = unknown, TypeHint = unknown> {\n  /**\n   * Called to convert an attribute value to a property\n   * value.\n   */\n  fromAttribute?(value: string | null, type?: TypeHint): Type;\n\n  /**\n   * Called to convert a property value to an attribute\n   * value.\n   *\n   * It returns unknown instead of string, to be compatible with\n   * https://github.com/WICG/trusted-types (and similar efforts).\n   */\n  toAttribute?(value: Type, type?: TypeHint): unknown;\n}\n\ntype AttributeConverter<Type = unknown, TypeHint = unknown> =\n  | ComplexAttributeConverter<Type>\n  | ((value: string | null, type?: TypeHint) => Type);\n\n/**\n * Defines options for a property accessor.\n */\nexport interface PropertyDeclaration<Type = unknown, TypeHint = unknown> {\n  /**\n   * When set to `true`, indicates the property is internal private state. The\n   * property should not be set by users. When using TypeScript, this property\n   * should be marked as `private` or `protected`, and it is also a common\n   * practice to use a leading `_` in the name. The property is not added to\n   * `observedAttributes`.\n   */\n  readonly state?: boolean;\n\n  /**\n   * Indicates how and whether the property becomes an observed attribute.\n   * If the value is `false`, the property is not added to `observedAttributes`.\n   * If true or absent, the lowercased property name is observed (e.g. `fooBar`\n   * becomes `foobar`). If a string, the string value is observed (e.g\n   * `attribute: 'foo-bar'`).\n   */\n  readonly attribute?: boolean | string;\n\n  /**\n   * Indicates the type of the property. This is used only as a hint for the\n   * `converter` to determine how to convert the attribute\n   * to/from a property.\n   */\n  readonly type?: TypeHint;\n\n  /**\n   * Indicates how to convert the attribute to/from a property. If this value\n   * is a function, it is used to convert the attribute value a the property\n   * value. If it's an object, it can have keys for `fromAttribute` and\n   * `toAttribute`. If no `toAttribute` function is provided and\n   * `reflect` is set to `true`, the property value is set directly to the\n   * attribute. A default `converter` is used if none is provided; it supports\n   * `Boolean`, `String`, `Number`, `Object`, and `Array`. Note,\n   * when a property changes and the converter is used to update the attribute,\n   * the property is never updated again as a result of the attribute changing,\n   * and vice versa.\n   */\n  readonly converter?: AttributeConverter<Type, TypeHint>;\n\n  /**\n   * Indicates if the property should reflect to an attribute.\n   * If `true`, when the property is set, the attribute is set using the\n   * attribute name determined according to the rules for the `attribute`\n   * property option and the value of the property converted using the rules\n   * from the `converter` property option.\n   */\n  readonly reflect?: boolean;\n\n  /**\n   * A function that indicates if a property should be considered changed when\n   * it is set. The function should take the `newValue` and `oldValue` and\n   * return `true` if an update should be requested.\n   */\n  hasChanged?(value: Type, oldValue: Type): boolean;\n\n  /**\n   * Indicates whether an accessor will be created for this property. By\n   * default, an accessor will be generated for this property that requests an\n   * update when set. If this flag is `true`, no accessor will be created, and\n   * it will be the user's responsibility to call\n   * `this.requestUpdate(propertyName, oldValue)` to request an update when\n   * the property changes.\n   */\n  readonly noAccessor?: boolean;\n\n  /**\n   * Whether this property is wrapping accessors. This is set by `@property`\n   * to control the initial value change and reflection logic.\n   *\n   * @internal\n   */\n  wrapped?: boolean;\n}\n\n/**\n * Map of properties to PropertyDeclaration options. For each property an\n * accessor is made, and the property is processed according to the\n * PropertyDeclaration options.\n */\nexport interface PropertyDeclarations {\n  readonly [key: string]: PropertyDeclaration;\n}\n\ntype PropertyDeclarationMap = Map<PropertyKey, PropertyDeclaration>;\n\ntype AttributeMap = Map<string, PropertyKey>;\n\n/**\n * A Map of property keys to values.\n *\n * Takes an optional type parameter T, which when specified as a non-any,\n * non-unknown type, will make the Map more strongly-typed, associating the map\n * keys with their corresponding value type on T.\n *\n * Use `PropertyValues<this>` when overriding ReactiveElement.update() and\n * other lifecycle methods in order to get stronger type-checking on keys\n * and values.\n */\n// This type is conditional so that if the parameter T is not specified, or\n// is `any`, the type will include `Map<PropertyKey, unknown>`. Since T is not\n// given in the uses of PropertyValues in this file, all uses here fallback to\n// meaning `Map<PropertyKey, unknown>`, but if a developer uses\n// `PropertyValues<this>` (or any other value for T) they will get a\n// strongly-typed Map type.\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nexport type PropertyValues<T = any> = T extends object\n  ? PropertyValueMap<T>\n  : Map<PropertyKey, unknown>;\n\n/**\n * Do not use, instead prefer {@linkcode PropertyValues}.\n */\n// This type must be exported such that JavaScript generated by the Google\n// Closure Compiler can import a type reference.\nexport interface PropertyValueMap<T> extends Map<PropertyKey, unknown> {\n  get<K extends keyof T>(k: K): T[K] | undefined;\n  set<K extends keyof T>(key: K, value: T[K]): this;\n  has<K extends keyof T>(k: K): boolean;\n  delete<K extends keyof T>(k: K): boolean;\n}\n\nexport const defaultConverter: ComplexAttributeConverter = {\n  toAttribute(value: unknown, type?: unknown): unknown {\n    switch (type) {\n      case Boolean:\n        value = value ? emptyStringForBooleanAttribute : null;\n        break;\n      case Object:\n      case Array:\n        // if the value is `null` or `undefined` pass this through\n        // to allow removing/no change behavior.\n        value = value == null ? value : JSON.stringify(value);\n        break;\n    }\n    return value;\n  },\n\n  fromAttribute(value: string | null, type?: unknown) {\n    let fromValue: unknown = value;\n    switch (type) {\n      case Boolean:\n        fromValue = value !== null;\n        break;\n      case Number:\n        fromValue = value === null ? null : Number(value);\n        break;\n      case Object:\n      case Array:\n        // Do *not* generate exception when invalid JSON is set as elements\n        // don't normally complain on being mis-configured.\n        // TODO(sorvell): Do generate exception in *dev mode*.\n        try {\n          // Assert to adhere to Bazel's \"must type assert JSON parse\" rule.\n          fromValue = JSON.parse(value!) as unknown;\n        } catch (e) {\n          fromValue = null;\n        }\n        break;\n    }\n    return fromValue;\n  },\n};\n\nexport interface HasChanged {\n  (value: unknown, old: unknown): boolean;\n}\n\n/**\n * Change function that returns true if `value` is different from `oldValue`.\n * This method is used as the default for a property's `hasChanged` function.\n */\nexport const notEqual: HasChanged = (value: unknown, old: unknown): boolean =>\n  !is(value, old);\n\nconst defaultPropertyDeclaration: PropertyDeclaration = {\n  attribute: true,\n  type: String,\n  converter: defaultConverter,\n  reflect: false,\n  hasChanged: notEqual,\n};\n\n/**\n * A string representing one of the supported dev mode warning categories.\n */\nexport type WarningKind =\n  | 'change-in-update'\n  | 'migration'\n  | 'async-perform-update';\n\nexport type Initializer = (element: ReactiveElement) => void;\n\n// Temporary, until google3 is on TypeScript 5.2\ndeclare global {\n  interface SymbolConstructor {\n    readonly metadata: unique symbol;\n  }\n}\n\n// Ensure metadata is enabled. TypeScript does not polyfill\n// Symbol.metadata, so we must ensure that it exists.\n(Symbol as {metadata: symbol}).metadata ??= Symbol('metadata');\n\ndeclare global {\n  // This is public global API, do not change!\n  // eslint-disable-next-line no-var\n  var litPropertyMetadata: WeakMap<\n    object,\n    Map<PropertyKey, PropertyDeclaration>\n  >;\n}\n\n// Map from a class's metadata object to property options\n// Note that we must use nullish-coalescing assignment so that we only use one\n// map even if we load multiple version of this module.\nglobal.litPropertyMetadata ??= new WeakMap<\n  object,\n  Map<PropertyKey, PropertyDeclaration>\n>();\n\n/**\n * Base element class which manages element properties and attributes. When\n * properties change, the `update` method is asynchronously called. This method\n * should be supplied by subclasses to render updates as desired.\n * @noInheritDoc\n */\nexport abstract class ReactiveElement\n  // In the Node build, this `extends` clause will be substituted with\n  // `(globalThis.HTMLElement ?? HTMLElement)`.\n  //\n  // This way, we will first prefer any global `HTMLElement` polyfill that the\n  // user has assigned, and then fall back to the `HTMLElement` shim which has\n  // been imported (see note at the top of this file about how this import is\n  // generated by Rollup). Note that the `HTMLElement` variable has been\n  // shadowed by this import, so it no longer refers to the global.\n  extends HTMLElement\n  implements ReactiveControllerHost\n{\n  // Note: these are patched in only in DEV_MODE.\n  /**\n   * Read or set all the enabled warning categories for this class.\n   *\n   * This property is only used in development builds.\n   *\n   * @nocollapse\n   * @category dev-mode\n   */\n  static enabledWarnings?: WarningKind[];\n\n  /**\n   * Enable the given warning category for this class.\n   *\n   * This method only exists in development builds, so it should be accessed\n   * with a guard like:\n   *\n   * ```ts\n   * // Enable for all ReactiveElement subclasses\n   * ReactiveElement.enableWarning?.('migration');\n   *\n   * // Enable for only MyElement and subclasses\n   * MyElement.enableWarning?.('migration');\n   * ```\n   *\n   * @nocollapse\n   * @category dev-mode\n   */\n  static enableWarning?: (warningKind: WarningKind) => void;\n\n  /**\n   * Disable the given warning category for this class.\n   *\n   * This method only exists in development builds, so it should be accessed\n   * with a guard like:\n   *\n   * ```ts\n   * // Disable for all ReactiveElement subclasses\n   * ReactiveElement.disableWarning?.('migration');\n   *\n   * // Disable for only MyElement and subclasses\n   * MyElement.disableWarning?.('migration');\n   * ```\n   *\n   * @nocollapse\n   * @category dev-mode\n   */\n  static disableWarning?: (warningKind: WarningKind) => void;\n\n  /**\n   * Adds an initializer function to the class that is called during instance\n   * construction.\n   *\n   * This is useful for code that runs against a `ReactiveElement`\n   * subclass, such as a decorator, that needs to do work for each\n   * instance, such as setting up a `ReactiveController`.\n   *\n   * ```ts\n   * const myDecorator = (target: typeof ReactiveElement, key: string) => {\n   *   target.addInitializer((instance: ReactiveElement) => {\n   *     // This is run during construction of the element\n   *     new MyController(instance);\n   *   });\n   * }\n   * ```\n   *\n   * Decorating a field will then cause each instance to run an initializer\n   * that adds a controller:\n   *\n   * ```ts\n   * class MyElement extends LitElement {\n   *   @myDecorator foo;\n   * }\n   * ```\n   *\n   * Initializers are stored per-constructor. Adding an initializer to a\n   * subclass does not add it to a superclass. Since initializers are run in\n   * constructors, initializers will run in order of the class hierarchy,\n   * starting with superclasses and progressing to the instance's class.\n   *\n   * @nocollapse\n   */\n  static addInitializer(initializer: Initializer) {\n    this.__prepare();\n    (this._initializers ??= []).push(initializer);\n  }\n\n  static _initializers?: Initializer[];\n\n  /*\n   * Due to closure compiler ES6 compilation bugs, @nocollapse is required on\n   * all static methods and properties with initializers.  Reference:\n   * - https://github.com/google/closure-compiler/issues/1776\n   */\n\n  /**\n   * Maps attribute names to properties; for example `foobar` attribute to\n   * `fooBar` property. Created lazily on user subclasses when finalizing the\n   * class.\n   * @nocollapse\n   */\n  private static __attributeToPropertyMap: AttributeMap;\n\n  /**\n   * Marks class as having been finalized, which includes creating properties\n   * from `static properties`, but does *not* include all properties created\n   * from decorators.\n   * @nocollapse\n   */\n  protected static finalized: true | undefined;\n\n  /**\n   * Memoized list of all element properties, including any superclass\n   * properties. Created lazily on user subclasses when finalizing the class.\n   *\n   * @nocollapse\n   * @category properties\n   */\n  static elementProperties: PropertyDeclarationMap;\n\n  /**\n   * User-supplied object that maps property names to `PropertyDeclaration`\n   * objects containing options for configuring reactive properties. When\n   * a reactive property is set the element will update and render.\n   *\n   * By default properties are public fields, and as such, they should be\n   * considered as primarily settable by element users, either via attribute or\n   * the property itself.\n   *\n   * Generally, properties that are changed by the element should be private or\n   * protected fields and should use the `state: true` option. Properties\n   * marked as `state` do not reflect from the corresponding attribute\n   *\n   * However, sometimes element code does need to set a public property. This\n   * should typically only be done in response to user interaction, and an event\n   * should be fired informing the user; for example, a checkbox sets its\n   * `checked` property when clicked and fires a `changed` event. Mutating\n   * public properties should typically not be done for non-primitive (object or\n   * array) properties. In other cases when an element needs to manage state, a\n   * private property set with the `state: true` option should be used. When\n   * needed, state properties can be initialized via public properties to\n   * facilitate complex interactions.\n   * @nocollapse\n   * @category properties\n   */\n  static properties: PropertyDeclarations;\n\n  /**\n   * Memoized list of all element styles.\n   * Created lazily on user subclasses when finalizing the class.\n   * @nocollapse\n   * @category styles\n   */\n  static elementStyles: Array<CSSResultOrNative> = [];\n\n  /**\n   * Array of styles to apply to the element. The styles should be defined\n   * using the {@linkcode css} tag function, via constructible stylesheets, or\n   * imported from native CSS module scripts.\n   *\n   * Note on Content Security Policy:\n   *\n   * Element styles are implemented with `<style>` tags when the browser doesn't\n   * support adopted StyleSheets. To use such `<style>` tags with the style-src\n   * CSP directive, the style-src value must either include 'unsafe-inline' or\n   * `nonce-<base64-value>` with `<base64-value>` replaced be a server-generated\n   * nonce.\n   *\n   * To provide a nonce to use on generated `<style>` elements, set\n   * `window.litNonce` to a server-generated nonce in your page's HTML, before\n   * loading application code:\n   *\n   * ```html\n   * <script>\n   *   // Generated and unique per request:\n   *   window.litNonce = 'a1b2c3d4';\n   * </script>\n   * ```\n   * @nocollapse\n   * @category styles\n   */\n  static styles?: CSSResultGroup;\n\n  /**\n   * Returns a list of attributes corresponding to the registered properties.\n   * @nocollapse\n   * @category attributes\n   */\n  static get observedAttributes() {\n    // Ensure we've created all properties\n    this.finalize();\n    // this.__attributeToPropertyMap is only undefined after finalize() in\n    // ReactiveElement itself. ReactiveElement.observedAttributes is only\n    // accessed with ReactiveElement as the receiver when a subclass or mixin\n    // calls super.observedAttributes\n    return (\n      this.__attributeToPropertyMap && [...this.__attributeToPropertyMap.keys()]\n    );\n  }\n\n  private __instanceProperties?: PropertyValues = undefined;\n\n  /**\n   * Creates a property accessor on the element prototype if one does not exist\n   * and stores a {@linkcode PropertyDeclaration} for the property with the\n   * given options. The property setter calls the property's `hasChanged`\n   * property option or uses a strict identity check to determine whether or not\n   * to request an update.\n   *\n   * This method may be overridden to customize properties; however,\n   * when doing so, it's important to call `super.createProperty` to ensure\n   * the property is setup correctly. This method calls\n   * `getPropertyDescriptor` internally to get a descriptor to install.\n   * To customize what properties do when they are get or set, override\n   * `getPropertyDescriptor`. To customize the options for a property,\n   * implement `createProperty` like this:\n   *\n   * ```ts\n   * static createProperty(name, options) {\n   *   options = Object.assign(options, {myOption: true});\n   *   super.createProperty(name, options);\n   * }\n   * ```\n   *\n   * @nocollapse\n   * @category properties\n   */\n  static createProperty(\n    name: PropertyKey,\n    options: PropertyDeclaration = defaultPropertyDeclaration\n  ) {\n    // If this is a state property, force the attribute to false.\n    if (options.state) {\n      (options as Mutable<PropertyDeclaration, 'attribute'>).attribute = false;\n    }\n    this.__prepare();\n    this.elementProperties.set(name, options);\n    if (!options.noAccessor) {\n      const key = DEV_MODE\n        ? // Use Symbol.for in dev mode to make it easier to maintain state\n          // when doing HMR.\n          Symbol.for(`${String(name)} (@property() cache)`)\n        : Symbol();\n      const descriptor = this.getPropertyDescriptor(name, key, options);\n      if (descriptor !== undefined) {\n        defineProperty(this.prototype, name, descriptor);\n      }\n    }\n  }\n\n  /**\n   * Returns a property descriptor to be defined on the given named property.\n   * If no descriptor is returned, the property will not become an accessor.\n   * For example,\n   *\n   * ```ts\n   * class MyElement extends LitElement {\n   *   static getPropertyDescriptor(name, key, options) {\n   *     const defaultDescriptor =\n   *         super.getPropertyDescriptor(name, key, options);\n   *     const setter = defaultDescriptor.set;\n   *     return {\n   *       get: defaultDescriptor.get,\n   *       set(value) {\n   *         setter.call(this, value);\n   *         // custom action.\n   *       },\n   *       configurable: true,\n   *       enumerable: true\n   *     }\n   *   }\n   * }\n   * ```\n   *\n   * @nocollapse\n   * @category properties\n   */\n  protected static getPropertyDescriptor(\n    name: PropertyKey,\n    key: string | symbol,\n    options: PropertyDeclaration\n  ): PropertyDescriptor | undefined {\n    const {get, set} = getOwnPropertyDescriptor(this.prototype, name) ?? {\n      get(this: ReactiveElement) {\n        return this[key as keyof typeof this];\n      },\n      set(this: ReactiveElement, v: unknown) {\n        (this as unknown as Record<string | symbol, unknown>)[key] = v;\n      },\n    };\n    if (DEV_MODE && get == null) {\n      if ('value' in (getOwnPropertyDescriptor(this.prototype, name) ?? {})) {\n        throw new Error(\n          `Field ${JSON.stringify(String(name))} on ` +\n            `${this.name} was declared as a reactive property ` +\n            `but it's actually declared as a value on the prototype. ` +\n            `Usually this is due to using @property or @state on a method.`\n        );\n      }\n      issueWarning(\n        'reactive-property-without-getter',\n        `Field ${JSON.stringify(String(name))} on ` +\n          `${this.name} was declared as a reactive property ` +\n          `but it does not have a getter. This will be an error in a ` +\n          `future version of Lit.`\n      );\n    }\n    return {\n      get(this: ReactiveElement) {\n        return get?.call(this);\n      },\n      set(this: ReactiveElement, value: unknown) {\n        const oldValue = get?.call(this);\n        set!.call(this, value);\n        this.requestUpdate(name, oldValue, options);\n      },\n      configurable: true,\n      enumerable: true,\n    };\n  }\n\n  /**\n   * Returns the property options associated with the given property.\n   * These options are defined with a `PropertyDeclaration` via the `properties`\n   * object or the `@property` decorator and are registered in\n   * `createProperty(...)`.\n   *\n   * Note, this method should be considered \"final\" and not overridden. To\n   * customize the options for a given property, override\n   * {@linkcode createProperty}.\n   *\n   * @nocollapse\n   * @final\n   * @category properties\n   */\n  static getPropertyOptions(name: PropertyKey) {\n    return this.elementProperties.get(name) ?? defaultPropertyDeclaration;\n  }\n\n  // Temporary, until google3 is on TypeScript 5.2\n  declare static [Symbol.metadata]: object & Record<PropertyKey, unknown>;\n\n  /**\n   * Initializes static own properties of the class used in bookkeeping\n   * for element properties, initializers, etc.\n   *\n   * Can be called multiple times by code that needs to ensure these\n   * properties exist before using them.\n   *\n   * This method ensures the superclass is finalized so that inherited\n   * property metadata can be copied down.\n   * @nocollapse\n   */\n  private static __prepare() {\n    if (\n      this.hasOwnProperty(JSCompiler_renameProperty('elementProperties', this))\n    ) {\n      // Already prepared\n      return;\n    }\n    // Finalize any superclasses\n    const superCtor = getPrototypeOf(this) as typeof ReactiveElement;\n    superCtor.finalize();\n\n    // Create own set of initializers for this class if any exist on the\n    // superclass and copy them down. Note, for a small perf boost, avoid\n    // creating initializers unless needed.\n    if (superCtor._initializers !== undefined) {\n      this._initializers = [...superCtor._initializers];\n    }\n    // Initialize elementProperties from the superclass\n    this.elementProperties = new Map(superCtor.elementProperties);\n  }\n\n  /**\n   * Finishes setting up the class so that it's ready to be registered\n   * as a custom element and instantiated.\n   *\n   * This method is called by the ReactiveElement.observedAttributes getter.\n   * If you override the observedAttributes getter, you must either call\n   * super.observedAttributes to trigger finalization, or call finalize()\n   * yourself.\n   *\n   * @nocollapse\n   */\n  protected static finalize() {\n    if (this.hasOwnProperty(JSCompiler_renameProperty('finalized', this))) {\n      return;\n    }\n    this.finalized = true;\n    this.__prepare();\n\n    // Create properties from the static properties block:\n    if (this.hasOwnProperty(JSCompiler_renameProperty('properties', this))) {\n      const props = this.properties;\n      const propKeys = [\n        ...getOwnPropertyNames(props),\n        ...getOwnPropertySymbols(props),\n      ] as Array<keyof typeof props>;\n      for (const p of propKeys) {\n        this.createProperty(p, props[p]);\n      }\n    }\n\n    // Create properties from standard decorator metadata:\n    const metadata = this[Symbol.metadata];\n    if (metadata !== null) {\n      const properties = litPropertyMetadata.get(metadata);\n      if (properties !== undefined) {\n        for (const [p, options] of properties) {\n          this.elementProperties.set(p, options);\n        }\n      }\n    }\n\n    // Create the attribute-to-property map\n    this.__attributeToPropertyMap = new Map();\n    for (const [p, options] of this.elementProperties) {\n      const attr = this.__attributeNameForProperty(p, options);\n      if (attr !== undefined) {\n        this.__attributeToPropertyMap.set(attr, p);\n      }\n    }\n\n    this.elementStyles = this.finalizeStyles(this.styles);\n\n    if (DEV_MODE) {\n      if (this.hasOwnProperty('createProperty')) {\n        issueWarning(\n          'no-override-create-property',\n          'Overriding ReactiveElement.createProperty() is deprecated. ' +\n            'The override will not be called with standard decorators'\n        );\n      }\n      if (this.hasOwnProperty('getPropertyDescriptor')) {\n        issueWarning(\n          'no-override-get-property-descriptor',\n          'Overriding ReactiveElement.getPropertyDescriptor() is deprecated. ' +\n            'The override will not be called with standard decorators'\n        );\n      }\n    }\n  }\n\n  /**\n   * Options used when calling `attachShadow`. Set this property to customize\n   * the options for the shadowRoot; for example, to create a closed\n   * shadowRoot: `{mode: 'closed'}`.\n   *\n   * Note, these options are used in `createRenderRoot`. If this method\n   * is customized, options should be respected if possible.\n   * @nocollapse\n   * @category rendering\n   */\n  static shadowRootOptions: ShadowRootInit = {mode: 'open'};\n\n  /**\n   * Takes the styles the user supplied via the `static styles` property and\n   * returns the array of styles to apply to the element.\n   * Override this method to integrate into a style management system.\n   *\n   * Styles are deduplicated preserving the _last_ instance in the list. This\n   * is a performance optimization to avoid duplicated styles that can occur\n   * especially when composing via subclassing. The last item is kept to try\n   * to preserve the cascade order with the assumption that it's most important\n   * that last added styles override previous styles.\n   *\n   * @nocollapse\n   * @category styles\n   */\n  protected static finalizeStyles(\n    styles?: CSSResultGroup\n  ): Array<CSSResultOrNative> {\n    const elementStyles = [];\n    if (Array.isArray(styles)) {\n      // Dedupe the flattened array in reverse order to preserve the last items.\n      // Casting to Array<unknown> works around TS error that\n      // appears to come from trying to flatten a type CSSResultArray.\n      const set = new Set((styles as Array<unknown>).flat(Infinity).reverse());\n      // Then preserve original order by adding the set items in reverse order.\n      for (const s of set) {\n        elementStyles.unshift(getCompatibleStyle(s as CSSResultOrNative));\n      }\n    } else if (styles !== undefined) {\n      elementStyles.push(getCompatibleStyle(styles));\n    }\n    return elementStyles;\n  }\n\n  /**\n   * Node or ShadowRoot into which element DOM should be rendered. Defaults\n   * to an open shadowRoot.\n   * @category rendering\n   */\n  readonly renderRoot!: HTMLElement | DocumentFragment;\n\n  /**\n   * Returns the property name for the given attribute `name`.\n   * @nocollapse\n   */\n  private static __attributeNameForProperty(\n    name: PropertyKey,\n    options: PropertyDeclaration\n  ) {\n    const attribute = options.attribute;\n    return attribute === false\n      ? undefined\n      : typeof attribute === 'string'\n      ? attribute\n      : typeof name === 'string'\n      ? name.toLowerCase()\n      : undefined;\n  }\n\n  // Initialize to an unresolved Promise so we can make sure the element has\n  // connected before first update.\n  private __updatePromise!: Promise<boolean>;\n\n  /**\n   * True if there is a pending update as a result of calling `requestUpdate()`.\n   * Should only be read.\n   * @category updates\n   */\n  isUpdatePending = false;\n\n  /**\n   * Is set to `true` after the first update. The element code cannot assume\n   * that `renderRoot` exists before the element `hasUpdated`.\n   * @category updates\n   */\n  hasUpdated = false;\n\n  /**\n   * Map with keys for any properties that have changed since the last\n   * update cycle with previous values.\n   *\n   * @internal\n   */\n  _$changedProperties!: PropertyValues;\n\n  /**\n   * Properties that should be reflected when updated.\n   */\n  private __reflectingProperties?: Set<PropertyKey>;\n\n  /**\n   * Name of currently reflecting property\n   */\n  private __reflectingProperty: PropertyKey | null = null;\n\n  /**\n   * Set of controllers.\n   */\n  private __controllers?: Set<ReactiveController>;\n\n  constructor() {\n    super();\n    this.__initialize();\n  }\n\n  /**\n   * Internal only override point for customizing work done when elements\n   * are constructed.\n   */\n  private __initialize() {\n    this.__updatePromise = new Promise<boolean>(\n      (res) => (this.enableUpdating = res)\n    );\n    this._$changedProperties = new Map();\n    // This enqueues a microtask that ust run before the first update, so it\n    // must be called before requestUpdate()\n    this.__saveInstanceProperties();\n    // ensures first update will be caught by an early access of\n    // `updateComplete`\n    this.requestUpdate();\n    (this.constructor as typeof ReactiveElement)._initializers?.forEach((i) =>\n      i(this)\n    );\n  }\n\n  /**\n   * Registers a `ReactiveController` to participate in the element's reactive\n   * update cycle. The element automatically calls into any registered\n   * controllers during its lifecycle callbacks.\n   *\n   * If the element is connected when `addController()` is called, the\n   * controller's `hostConnected()` callback will be immediately called.\n   * @category controllers\n   */\n  addController(controller: ReactiveController) {\n    (this.__controllers ??= new Set()).add(controller);\n    // If a controller is added after the element has been connected,\n    // call hostConnected. Note, re-using existence of `renderRoot` here\n    // (which is set in connectedCallback) to avoid the need to track a\n    // first connected state.\n    if (this.renderRoot !== undefined && this.isConnected) {\n      controller.hostConnected?.();\n    }\n  }\n\n  /**\n   * Removes a `ReactiveController` from the element.\n   * @category controllers\n   */\n  removeController(controller: ReactiveController) {\n    this.__controllers?.delete(controller);\n  }\n\n  /**\n   * Fixes any properties set on the instance before upgrade time.\n   * Otherwise these would shadow the accessor and break these properties.\n   * The properties are stored in a Map which is played back after the\n   * constructor runs. Note, on very old versions of Safari (<=9) or Chrome\n   * (<=41), properties created for native platform properties like (`id` or\n   * `name`) may not have default values set in the element constructor. On\n   * these browsers native properties appear on instances and therefore their\n   * default value will overwrite any element default (e.g. if the element sets\n   * this.id = 'id' in the constructor, the 'id' will become '' since this is\n   * the native platform default).\n   */\n  private __saveInstanceProperties() {\n    const instanceProperties = new Map<PropertyKey, unknown>();\n    const elementProperties = (this.constructor as typeof ReactiveElement)\n      .elementProperties;\n    for (const p of elementProperties.keys() as IterableIterator<keyof this>) {\n      if (this.hasOwnProperty(p)) {\n        instanceProperties.set(p, this[p]);\n        delete this[p];\n      }\n    }\n    if (instanceProperties.size > 0) {\n      this.__instanceProperties = instanceProperties;\n    }\n  }\n\n  /**\n   * Returns the node into which the element should render and by default\n   * creates and returns an open shadowRoot. Implement to customize where the\n   * element's DOM is rendered. For example, to render into the element's\n   * childNodes, return `this`.\n   *\n   * @return Returns a node into which to render.\n   * @category rendering\n   */\n  protected createRenderRoot(): HTMLElement | DocumentFragment {\n    const renderRoot =\n      this.shadowRoot ??\n      this.attachShadow(\n        (this.constructor as typeof ReactiveElement).shadowRootOptions\n      );\n    adoptStyles(\n      renderRoot,\n      (this.constructor as typeof ReactiveElement).elementStyles\n    );\n    return renderRoot;\n  }\n\n  /**\n   * On first connection, creates the element's renderRoot, sets up\n   * element styling, and enables updating.\n   * @category lifecycle\n   */\n  connectedCallback() {\n    // Create renderRoot before controllers `hostConnected`\n    (this as Mutable<typeof this, 'renderRoot'>).renderRoot ??=\n      this.createRenderRoot();\n    this.enableUpdating(true);\n    this.__controllers?.forEach((c) => c.hostConnected?.());\n  }\n\n  /**\n   * Note, this method should be considered final and not overridden. It is\n   * overridden on the element instance with a function that triggers the first\n   * update.\n   * @category updates\n   */\n  protected enableUpdating(_requestedUpdate: boolean) {}\n\n  /**\n   * Allows for `super.disconnectedCallback()` in extensions while\n   * reserving the possibility of making non-breaking feature additions\n   * when disconnecting at some point in the future.\n   * @category lifecycle\n   */\n  disconnectedCallback() {\n    this.__controllers?.forEach((c) => c.hostDisconnected?.());\n  }\n\n  /**\n   * Synchronizes property values when attributes change.\n   *\n   * Specifically, when an attribute is set, the corresponding property is set.\n   * You should rarely need to implement this callback. If this method is\n   * overridden, `super.attributeChangedCallback(name, _old, value)` must be\n   * called.\n   *\n   * See [using the lifecycle callbacks](https://developer.mozilla.org/en-US/docs/Web/Web_Components/Using_custom_elements#using_the_lifecycle_callbacks)\n   * on MDN for more information about the `attributeChangedCallback`.\n   * @category attributes\n   */\n  attributeChangedCallback(\n    name: string,\n    _old: string | null,\n    value: string | null\n  ) {\n    this._$attributeToProperty(name, value);\n  }\n\n  private __propertyToAttribute(name: PropertyKey, value: unknown) {\n    const elemProperties: PropertyDeclarationMap = (\n      this.constructor as typeof ReactiveElement\n    ).elementProperties;\n    const options = elemProperties.get(name)!;\n    const attr = (\n      this.constructor as typeof ReactiveElement\n    ).__attributeNameForProperty(name, options);\n    if (attr !== undefined && options.reflect === true) {\n      const converter =\n        (options.converter as ComplexAttributeConverter)?.toAttribute !==\n        undefined\n          ? (options.converter as ComplexAttributeConverter)\n          : defaultConverter;\n      const attrValue = converter.toAttribute!(value, options.type);\n      if (\n        DEV_MODE &&\n        (this.constructor as typeof ReactiveElement).enabledWarnings!.includes(\n          'migration'\n        ) &&\n        attrValue === undefined\n      ) {\n        issueWarning(\n          'undefined-attribute-value',\n          `The attribute value for the ${name as string} property is ` +\n            `undefined on element ${this.localName}. The attribute will be ` +\n            `removed, but in the previous version of \\`ReactiveElement\\`, ` +\n            `the attribute would not have changed.`\n        );\n      }\n      // Track if the property is being reflected to avoid\n      // setting the property again via `attributeChangedCallback`. Note:\n      // 1. this takes advantage of the fact that the callback is synchronous.\n      // 2. will behave incorrectly if multiple attributes are in the reaction\n      // stack at time of calling. However, since we process attributes\n      // in `update` this should not be possible (or an extreme corner case\n      // that we'd like to discover).\n      // mark state reflecting\n      this.__reflectingProperty = name;\n      if (attrValue == null) {\n        this.removeAttribute(attr);\n      } else {\n        this.setAttribute(attr, attrValue as string);\n      }\n      // mark state not reflecting\n      this.__reflectingProperty = null;\n    }\n  }\n\n  /** @internal */\n  _$attributeToProperty(name: string, value: string | null) {\n    const ctor = this.constructor as typeof ReactiveElement;\n    // Note, hint this as an `AttributeMap` so closure clearly understands\n    // the type; it has issues with tracking types through statics\n    const propName = (ctor.__attributeToPropertyMap as AttributeMap).get(name);\n    // Use tracking info to avoid reflecting a property value to an attribute\n    // if it was just set because the attribute changed.\n    if (propName !== undefined && this.__reflectingProperty !== propName) {\n      const options = ctor.getPropertyOptions(propName);\n      const converter =\n        typeof options.converter === 'function'\n          ? {fromAttribute: options.converter}\n          : options.converter?.fromAttribute !== undefined\n          ? options.converter\n          : defaultConverter;\n      // mark state reflecting\n      this.__reflectingProperty = propName;\n      this[propName as keyof this] = converter.fromAttribute!(\n        value,\n        options.type\n        // eslint-disable-next-line @typescript-eslint/no-explicit-any\n      ) as any;\n      // mark state not reflecting\n      this.__reflectingProperty = null;\n    }\n  }\n\n  /**\n   * Requests an update which is processed asynchronously. This should be called\n   * when an element should update based on some state not triggered by setting\n   * a reactive property. In this case, pass no arguments. It should also be\n   * called when manually implementing a property setter. In this case, pass the\n   * property `name` and `oldValue` to ensure that any configured property\n   * options are honored.\n   *\n   * @param name name of requesting property\n   * @param oldValue old value of requesting property\n   * @param options property options to use instead of the previously\n   *     configured options\n   * @category updates\n   */\n  requestUpdate(\n    name?: PropertyKey,\n    oldValue?: unknown,\n    options?: PropertyDeclaration\n  ): void {\n    // If we have a property key, perform property update steps.\n    if (name !== undefined) {\n      if (DEV_MODE && (name as unknown) instanceof Event) {\n        issueWarning(\n          ``,\n          `The requestUpdate() method was called with an Event as the property name. This is probably a mistake caused by binding this.requestUpdate as an event listener. Instead bind a function that will call it with no arguments: () => this.requestUpdate()`\n        );\n      }\n      options ??= (\n        this.constructor as typeof ReactiveElement\n      ).getPropertyOptions(name);\n      const hasChanged = options.hasChanged ?? notEqual;\n      const newValue = this[name as keyof this];\n      if (hasChanged(newValue, oldValue)) {\n        this._$changeProperty(name, oldValue, options);\n      } else {\n        // Abort the request if the property should not be considered changed.\n        return;\n      }\n    }\n    if (this.isUpdatePending === false) {\n      this.__updatePromise = this.__enqueueUpdate();\n    }\n  }\n\n  /**\n   * @internal\n   */\n  _$changeProperty(\n    name: PropertyKey,\n    oldValue: unknown,\n    options: PropertyDeclaration\n  ) {\n    // TODO (justinfagnani): Create a benchmark of Map.has() + Map.set(\n    // vs just Map.set()\n    if (!this._$changedProperties.has(name)) {\n      this._$changedProperties.set(name, oldValue);\n    }\n    // Add to reflecting properties set.\n    // Note, it's important that every change has a chance to add the\n    // property to `__reflectingProperties`. This ensures setting\n    // attribute + property reflects correctly.\n    if (options.reflect === true && this.__reflectingProperty !== name) {\n      (this.__reflectingProperties ??= new Set<PropertyKey>()).add(name);\n    }\n  }\n\n  /**\n   * Sets up the element to asynchronously update.\n   */\n  private async __enqueueUpdate() {\n    this.isUpdatePending = true;\n    try {\n      // Ensure any previous update has resolved before updating.\n      // This `await` also ensures that property changes are batched.\n      await this.__updatePromise;\n    } catch (e) {\n      // Refire any previous errors async so they do not disrupt the update\n      // cycle. Errors are refired so developers have a chance to observe\n      // them, and this can be done by implementing\n      // `window.onunhandledrejection`.\n      Promise.reject(e);\n    }\n    const result = this.scheduleUpdate();\n    // If `scheduleUpdate` returns a Promise, we await it. This is done to\n    // enable coordinating updates with a scheduler. Note, the result is\n    // checked to avoid delaying an additional microtask unless we need to.\n    if (result != null) {\n      await result;\n    }\n    return !this.isUpdatePending;\n  }\n\n  /**\n   * Schedules an element update. You can override this method to change the\n   * timing of updates by returning a Promise. The update will await the\n   * returned Promise, and you should resolve the Promise to allow the update\n   * to proceed. If this method is overridden, `super.scheduleUpdate()`\n   * must be called.\n   *\n   * For instance, to schedule updates to occur just before the next frame:\n   *\n   * ```ts\n   * override protected async scheduleUpdate(): Promise<unknown> {\n   *   await new Promise((resolve) => requestAnimationFrame(() => resolve()));\n   *   super.scheduleUpdate();\n   * }\n   * ```\n   * @category updates\n   */\n  protected scheduleUpdate(): void | Promise<unknown> {\n    const result = this.performUpdate();\n    if (\n      DEV_MODE &&\n      (this.constructor as typeof ReactiveElement).enabledWarnings!.includes(\n        'async-perform-update'\n      ) &&\n      typeof (result as unknown as Promise<unknown> | undefined)?.then ===\n        'function'\n    ) {\n      issueWarning(\n        'async-perform-update',\n        `Element ${this.localName} returned a Promise from performUpdate(). ` +\n          `This behavior is deprecated and will be removed in a future ` +\n          `version of ReactiveElement.`\n      );\n    }\n    return result;\n  }\n\n  /**\n   * Performs an element update. Note, if an exception is thrown during the\n   * update, `firstUpdated` and `updated` will not be called.\n   *\n   * Call `performUpdate()` to immediately process a pending update. This should\n   * generally not be needed, but it can be done in rare cases when you need to\n   * update synchronously.\n   *\n   * @category updates\n   */\n  protected performUpdate(): void {\n    // Abort any update if one is not pending when this is called.\n    // This can happen if `performUpdate` is called early to \"flush\"\n    // the update.\n    if (!this.isUpdatePending) {\n      return;\n    }\n    debugLogEvent?.({kind: 'update'});\n    if (!this.hasUpdated) {\n      // Create renderRoot before first update. This occurs in `connectedCallback`\n      // but is done here to support out of tree calls to `enableUpdating`/`performUpdate`.\n      (this as Mutable<typeof this, 'renderRoot'>).renderRoot ??=\n        this.createRenderRoot();\n      if (DEV_MODE) {\n        // Produce warning if any reactive properties on the prototype are\n        // shadowed by class fields. Instance fields set before upgrade are\n        // deleted by this point, so any own property is caused by class field\n        // initialization in the constructor.\n        const ctor = this.constructor as typeof ReactiveElement;\n        const shadowedProperties = [...ctor.elementProperties.keys()].filter(\n          (p) => this.hasOwnProperty(p) && p in getPrototypeOf(this)\n        );\n        if (shadowedProperties.length) {\n          throw new Error(\n            `The following properties on element ${this.localName} will not ` +\n              `trigger updates as expected because they are set using class ` +\n              `fields: ${shadowedProperties.join(', ')}. ` +\n              `Native class fields and some compiled output will overwrite ` +\n              `accessors used for detecting changes. See ` +\n              `https://lit.dev/msg/class-field-shadowing ` +\n              `for more information.`\n          );\n        }\n      }\n      // Mixin instance properties once, if they exist.\n      if (this.__instanceProperties) {\n        // TODO (justinfagnani): should we use the stored value? Could a new value\n        // have been set since we stored the own property value?\n        for (const [p, value] of this.__instanceProperties) {\n          this[p as keyof this] = value as this[keyof this];\n        }\n        this.__instanceProperties = undefined;\n      }\n      // Trigger initial value reflection and populate the initial\n      // changedProperties map, but only for the case of experimental\n      // decorators on accessors, which will not have already populated the\n      // changedProperties map. We can't know if these accessors had\n      // initializers, so we just set them anyway - a difference from\n      // experimental decorators on fields and standard decorators on\n      // auto-accessors.\n      // For context why experimentalDecorators with auto accessors are handled\n      // specifically also see:\n      // https://github.com/lit/lit/pull/4183#issuecomment-1711959635\n      const elementProperties = (this.constructor as typeof ReactiveElement)\n        .elementProperties;\n      if (elementProperties.size > 0) {\n        for (const [p, options] of elementProperties) {\n          if (\n            options.wrapped === true &&\n            !this._$changedProperties.has(p) &&\n            this[p as keyof this] !== undefined\n          ) {\n            this._$changeProperty(p, this[p as keyof this], options);\n          }\n        }\n      }\n    }\n    let shouldUpdate = false;\n    const changedProperties = this._$changedProperties;\n    try {\n      shouldUpdate = this.shouldUpdate(changedProperties);\n      if (shouldUpdate) {\n        this.willUpdate(changedProperties);\n        this.__controllers?.forEach((c) => c.hostUpdate?.());\n        this.update(changedProperties);\n      } else {\n        this.__markUpdated();\n      }\n    } catch (e) {\n      // Prevent `firstUpdated` and `updated` from running when there's an\n      // update exception.\n      shouldUpdate = false;\n      // Ensure element can accept additional updates after an exception.\n      this.__markUpdated();\n      throw e;\n    }\n    // The update is no longer considered pending and further updates are now allowed.\n    if (shouldUpdate) {\n      this._$didUpdate(changedProperties);\n    }\n  }\n\n  /**\n   * Invoked before `update()` to compute values needed during the update.\n   *\n   * Implement `willUpdate` to compute property values that depend on other\n   * properties and are used in the rest of the update process.\n   *\n   * ```ts\n   * willUpdate(changedProperties) {\n   *   // only need to check changed properties for an expensive computation.\n   *   if (changedProperties.has('firstName') || changedProperties.has('lastName')) {\n   *     this.sha = computeSHA(`${this.firstName} ${this.lastName}`);\n   *   }\n   * }\n   *\n   * render() {\n   *   return html`SHA: ${this.sha}`;\n   * }\n   * ```\n   *\n   * @category updates\n   */\n  protected willUpdate(_changedProperties: PropertyValues): void {}\n\n  // Note, this is an override point for polyfill-support.\n  // @internal\n  _$didUpdate(changedProperties: PropertyValues) {\n    this.__controllers?.forEach((c) => c.hostUpdated?.());\n    if (!this.hasUpdated) {\n      this.hasUpdated = true;\n      this.firstUpdated(changedProperties);\n    }\n    this.updated(changedProperties);\n    if (\n      DEV_MODE &&\n      this.isUpdatePending &&\n      (this.constructor as typeof ReactiveElement).enabledWarnings!.includes(\n        'change-in-update'\n      )\n    ) {\n      issueWarning(\n        'change-in-update',\n        `Element ${this.localName} scheduled an update ` +\n          `(generally because a property was set) ` +\n          `after an update completed, causing a new update to be scheduled. ` +\n          `This is inefficient and should be avoided unless the next update ` +\n          `can only be scheduled as a side effect of the previous update.`\n      );\n    }\n  }\n\n  private __markUpdated() {\n    this._$changedProperties = new Map();\n    this.isUpdatePending = false;\n  }\n\n  /**\n   * Returns a Promise that resolves when the element has completed updating.\n   * The Promise value is a boolean that is `true` if the element completed the\n   * update without triggering another update. The Promise result is `false` if\n   * a property was set inside `updated()`. If the Promise is rejected, an\n   * exception was thrown during the update.\n   *\n   * To await additional asynchronous work, override the `getUpdateComplete`\n   * method. For example, it is sometimes useful to await a rendered element\n   * before fulfilling this Promise. To do this, first await\n   * `super.getUpdateComplete()`, then any subsequent state.\n   *\n   * @return A promise of a boolean that resolves to true if the update completed\n   *     without triggering another update.\n   * @category updates\n   */\n  get updateComplete(): Promise<boolean> {\n    return this.getUpdateComplete();\n  }\n\n  /**\n   * Override point for the `updateComplete` promise.\n   *\n   * It is not safe to override the `updateComplete` getter directly due to a\n   * limitation in TypeScript which means it is not possible to call a\n   * superclass getter (e.g. `super.updateComplete.then(...)`) when the target\n   * language is ES5 (https://github.com/microsoft/TypeScript/issues/338).\n   * This method should be overridden instead. For example:\n   *\n   * ```ts\n   * class MyElement extends LitElement {\n   *   override async getUpdateComplete() {\n   *     const result = await super.getUpdateComplete();\n   *     await this._myChild.updateComplete;\n   *     return result;\n   *   }\n   * }\n   * ```\n   *\n   * @return A promise of a boolean that resolves to true if the update completed\n   *     without triggering another update.\n   * @category updates\n   */\n  protected getUpdateComplete(): Promise<boolean> {\n    return this.__updatePromise;\n  }\n\n  /**\n   * Controls whether or not `update()` should be called when the element requests\n   * an update. By default, this method always returns `true`, but this can be\n   * customized to control when to update.\n   *\n   * @param _changedProperties Map of changed properties with old values\n   * @category updates\n   */\n  protected shouldUpdate(_changedProperties: PropertyValues): boolean {\n    return true;\n  }\n\n  /**\n   * Updates the element. This method reflects property values to attributes.\n   * It can be overridden to render and keep updated element DOM.\n   * Setting properties inside this method will *not* trigger\n   * another update.\n   *\n   * @param _changedProperties Map of changed properties with old values\n   * @category updates\n   */\n  protected update(_changedProperties: PropertyValues) {\n    // The forEach() expression will only run when when __reflectingProperties is\n    // defined, and it returns undefined, setting __reflectingProperties to\n    // undefined\n    this.__reflectingProperties &&= this.__reflectingProperties.forEach((p) =>\n      this.__propertyToAttribute(p, this[p as keyof this])\n    ) as undefined;\n    this.__markUpdated();\n  }\n\n  /**\n   * Invoked whenever the element is updated. Implement to perform\n   * post-updating tasks via DOM APIs, for example, focusing an element.\n   *\n   * Setting properties inside this method will trigger the element to update\n   * again after this update cycle completes.\n   *\n   * @param _changedProperties Map of changed properties with old values\n   * @category updates\n   */\n  protected updated(_changedProperties: PropertyValues) {}\n\n  /**\n   * Invoked when the element is first updated. Implement to perform one time\n   * work on the element after update.\n   *\n   * ```ts\n   * firstUpdated() {\n   *   this.renderRoot.getElementById('my-text-area').focus();\n   * }\n   * ```\n   *\n   * Setting properties inside this method will trigger the element to update\n   * again after this update cycle completes.\n   *\n   * @param _changedProperties Map of changed properties with old values\n   * @category updates\n   */\n  protected firstUpdated(_changedProperties: PropertyValues) {}\n}\n// Assigned here to work around a jscompiler bug with static fields\n// when compiling to ES5.\n// https://github.com/google/closure-compiler/issues/3177\n(ReactiveElement as unknown as Record<string, unknown>)[\n  JSCompiler_renameProperty('elementProperties', ReactiveElement)\n] = new Map();\n(ReactiveElement as unknown as Record<string, unknown>)[\n  JSCompiler_renameProperty('finalized', ReactiveElement)\n] = new Map();\n\n// Apply polyfills if available\npolyfillSupport?.({ReactiveElement});\n\n// Dev mode warnings...\nif (DEV_MODE) {\n  // Default warning set.\n  ReactiveElement.enabledWarnings = [\n    'change-in-update',\n    'async-perform-update',\n  ];\n  const ensureOwnWarnings = function (ctor: typeof ReactiveElement) {\n    if (\n      !ctor.hasOwnProperty(JSCompiler_renameProperty('enabledWarnings', ctor))\n    ) {\n      ctor.enabledWarnings = ctor.enabledWarnings!.slice();\n    }\n  };\n  ReactiveElement.enableWarning = function (\n    this: typeof ReactiveElement,\n    warning: WarningKind\n  ) {\n    ensureOwnWarnings(this);\n    if (!this.enabledWarnings!.includes(warning)) {\n      this.enabledWarnings!.push(warning);\n    }\n  };\n  ReactiveElement.disableWarning = function (\n    this: typeof ReactiveElement,\n    warning: WarningKind\n  ) {\n    ensureOwnWarnings(this);\n    const i = this.enabledWarnings!.indexOf(warning);\n    if (i >= 0) {\n      this.enabledWarnings!.splice(i, 1);\n    }\n  };\n}\n\n// IMPORTANT: do not change the property name or the assignment expression.\n// This line will be used in regexes to search for ReactiveElement usage.\n(global.reactiveElementVersions ??= []).push('2.0.4');\nif (DEV_MODE && global.reactiveElementVersions.length > 1) {\n  issueWarning!(\n    'multiple-versions',\n    `Multiple versions of Lit loaded. Loading multiple versions ` +\n      `is not recommended.`\n  );\n}\n","/**\n * @license\n * Copyright 2017 Google LLC\n * SPDX-License-Identifier: BSD-3-Clause\n */\n\n// IMPORTANT: these imports must be type-only\nimport type {Directive, DirectiveResult, PartInfo} from './directive.js';\nimport type {TrustedHTML, TrustedTypesWindow} from 'trusted-types/lib';\n\nconst DEV_MODE = true;\nconst ENABLE_EXTRA_SECURITY_HOOKS = true;\nconst ENABLE_SHADYDOM_NOPATCH = true;\nconst NODE_MODE = false;\n\n// Allows minifiers to rename references to globalThis\nconst global = globalThis;\n\n/**\n * Contains types that are part of the unstable debug API.\n *\n * Everything in this API is not stable and may change or be removed in the future,\n * even on patch releases.\n */\n// eslint-disable-next-line @typescript-eslint/no-namespace\nexport namespace LitUnstable {\n  /**\n   * When Lit is running in dev mode and `window.emitLitDebugLogEvents` is true,\n   * we will emit 'lit-debug' events to window, with live details about the update and render\n   * lifecycle. These can be useful for writing debug tooling and visualizations.\n   *\n   * Please be aware that running with window.emitLitDebugLogEvents has performance overhead,\n   * making certain operations that are normally very cheap (like a no-op render) much slower,\n   * because we must copy data and dispatch events.\n   */\n  // eslint-disable-next-line @typescript-eslint/no-namespace\n  export namespace DebugLog {\n    export type Entry =\n      | TemplatePrep\n      | TemplateInstantiated\n      | TemplateInstantiatedAndUpdated\n      | TemplateUpdating\n      | BeginRender\n      | EndRender\n      | CommitPartEntry\n      | SetPartValue;\n    export interface TemplatePrep {\n      kind: 'template prep';\n      template: Template;\n      strings: TemplateStringsArray;\n      clonableTemplate: HTMLTemplateElement;\n      parts: TemplatePart[];\n    }\n    export interface BeginRender {\n      kind: 'begin render';\n      id: number;\n      value: unknown;\n      container: HTMLElement | DocumentFragment;\n      options: RenderOptions | undefined;\n      part: ChildPart | undefined;\n    }\n    export interface EndRender {\n      kind: 'end render';\n      id: number;\n      value: unknown;\n      container: HTMLElement | DocumentFragment;\n      options: RenderOptions | undefined;\n      part: ChildPart;\n    }\n    export interface TemplateInstantiated {\n      kind: 'template instantiated';\n      template: Template | CompiledTemplate;\n      instance: TemplateInstance;\n      options: RenderOptions | undefined;\n      fragment: Node;\n      parts: Array<Part | undefined>;\n      values: unknown[];\n    }\n    export interface TemplateInstantiatedAndUpdated {\n      kind: 'template instantiated and updated';\n      template: Template | CompiledTemplate;\n      instance: TemplateInstance;\n      options: RenderOptions | undefined;\n      fragment: Node;\n      parts: Array<Part | undefined>;\n      values: unknown[];\n    }\n    export interface TemplateUpdating {\n      kind: 'template updating';\n      template: Template | CompiledTemplate;\n      instance: TemplateInstance;\n      options: RenderOptions | undefined;\n      parts: Array<Part | undefined>;\n      values: unknown[];\n    }\n    export interface SetPartValue {\n      kind: 'set part';\n      part: Part;\n      value: unknown;\n      valueIndex: number;\n      values: unknown[];\n      templateInstance: TemplateInstance;\n    }\n\n    export type CommitPartEntry =\n      | CommitNothingToChildEntry\n      | CommitText\n      | CommitNode\n      | CommitAttribute\n      | CommitProperty\n      | CommitBooleanAttribute\n      | CommitEventListener\n      | CommitToElementBinding;\n\n    export interface CommitNothingToChildEntry {\n      kind: 'commit nothing to child';\n      start: ChildNode;\n      end: ChildNode | null;\n      parent: Disconnectable | undefined;\n      options: RenderOptions | undefined;\n    }\n\n    export interface CommitText {\n      kind: 'commit text';\n      node: Text;\n      value: unknown;\n      options: RenderOptions | undefined;\n    }\n\n    export interface CommitNode {\n      kind: 'commit node';\n      start: Node;\n      parent: Disconnectable | undefined;\n      value: Node;\n      options: RenderOptions | undefined;\n    }\n\n    export interface CommitAttribute {\n      kind: 'commit attribute';\n      element: Element;\n      name: string;\n      value: unknown;\n      options: RenderOptions | undefined;\n    }\n\n    export interface CommitProperty {\n      kind: 'commit property';\n      element: Element;\n      name: string;\n      value: unknown;\n      options: RenderOptions | undefined;\n    }\n\n    export interface CommitBooleanAttribute {\n      kind: 'commit boolean attribute';\n      element: Element;\n      name: string;\n      value: boolean;\n      options: RenderOptions | undefined;\n    }\n\n    export interface CommitEventListener {\n      kind: 'commit event listener';\n      element: Element;\n      name: string;\n      value: unknown;\n      oldListener: unknown;\n      options: RenderOptions | undefined;\n      // True if we're removing the old event listener (e.g. because settings changed, or value is nothing)\n      removeListener: boolean;\n      // True if we're adding a new event listener (e.g. because first render, or settings changed)\n      addListener: boolean;\n    }\n\n    export interface CommitToElementBinding {\n      kind: 'commit to element binding';\n      element: Element;\n      value: unknown;\n      options: RenderOptions | undefined;\n    }\n  }\n}\n\ninterface DebugLoggingWindow {\n  // Even in dev mode, we generally don't want to emit these events, as that's\n  // another level of cost, so only emit them when DEV_MODE is true _and_ when\n  // window.emitLitDebugEvents is true.\n  emitLitDebugLogEvents?: boolean;\n}\n\n/**\n * Useful for visualizing and logging insights into what the Lit template system is doing.\n *\n * Compiled out of prod mode builds.\n */\nconst debugLogEvent = DEV_MODE\n  ? (event: LitUnstable.DebugLog.Entry) => {\n      const shouldEmit = (global as unknown as DebugLoggingWindow)\n        .emitLitDebugLogEvents;\n      if (!shouldEmit) {\n        return;\n      }\n      global.dispatchEvent(\n        new CustomEvent<LitUnstable.DebugLog.Entry>('lit-debug', {\n          detail: event,\n        }),\n      );\n    }\n  : undefined;\n// Used for connecting beginRender and endRender events when there are nested\n// renders when errors are thrown preventing an endRender event from being\n// called.\nlet debugLogRenderId = 0;\n\nlet issueWarning: (code: string, warning: string) => void;\n\nif (DEV_MODE) {\n  global.litIssuedWarnings ??= new Set();\n\n  // Issue a warning, if we haven't already.\n  issueWarning = (code: string, warning: string) => {\n    warning += code\n      ? ` See https://lit.dev/msg/${code} for more information.`\n      : '';\n    if (!global.litIssuedWarnings!.has(warning)) {\n      console.warn(warning);\n      global.litIssuedWarnings!.add(warning);\n    }\n  };\n\n  issueWarning(\n    'dev-mode',\n    `Lit is in dev mode. Not recommended for production!`,\n  );\n}\n\nconst wrap =\n  ENABLE_SHADYDOM_NOPATCH &&\n  global.ShadyDOM?.inUse &&\n  global.ShadyDOM?.noPatch === true\n    ? (global.ShadyDOM!.wrap as <T extends Node>(node: T) => T)\n    : <T extends Node>(node: T) => node;\n\nconst trustedTypes = (global as unknown as TrustedTypesWindow).trustedTypes;\n\n/**\n * Our TrustedTypePolicy for HTML which is declared using the html template\n * tag function.\n *\n * That HTML is a developer-authored constant, and is parsed with innerHTML\n * before any untrusted expressions have been mixed in. Therefor it is\n * considered safe by construction.\n */\nconst policy = trustedTypes\n  ? trustedTypes.createPolicy('lit-html', {\n      createHTML: (s) => s,\n    })\n  : undefined;\n\n/**\n * Used to sanitize any value before it is written into the DOM. This can be\n * used to implement a security policy of allowed and disallowed values in\n * order to prevent XSS attacks.\n *\n * One way of using this callback would be to check attributes and properties\n * against a list of high risk fields, and require that values written to such\n * fields be instances of a class which is safe by construction. Closure's Safe\n * HTML Types is one implementation of this technique (\n * https://github.com/google/safe-html-types/blob/master/doc/safehtml-types.md).\n * The TrustedTypes polyfill in API-only mode could also be used as a basis\n * for this technique (https://github.com/WICG/trusted-types).\n *\n * @param node The HTML node (usually either a #text node or an Element) that\n *     is being written to. Note that this is just an exemplar node, the write\n *     may take place against another instance of the same class of node.\n * @param name The name of an attribute or property (for example, 'href').\n * @param type Indicates whether the write that's about to be performed will\n *     be to a property or a node.\n * @return A function that will sanitize this class of writes.\n */\nexport type SanitizerFactory = (\n  node: Node,\n  name: string,\n  type: 'property' | 'attribute',\n) => ValueSanitizer;\n\n/**\n * A function which can sanitize values that will be written to a specific kind\n * of DOM sink.\n *\n * See SanitizerFactory.\n *\n * @param value The value to sanitize. Will be the actual value passed into\n *     the lit-html template literal, so this could be of any type.\n * @return The value to write to the DOM. Usually the same as the input value,\n *     unless sanitization is needed.\n */\nexport type ValueSanitizer = (value: unknown) => unknown;\n\nconst identityFunction: ValueSanitizer = (value: unknown) => value;\nconst noopSanitizer: SanitizerFactory = (\n  _node: Node,\n  _name: string,\n  _type: 'property' | 'attribute',\n) => identityFunction;\n\n/** Sets the global sanitizer factory. */\nconst setSanitizer = (newSanitizer: SanitizerFactory) => {\n  if (!ENABLE_EXTRA_SECURITY_HOOKS) {\n    return;\n  }\n  if (sanitizerFactoryInternal !== noopSanitizer) {\n    throw new Error(\n      `Attempted to overwrite existing lit-html security policy.` +\n        ` setSanitizeDOMValueFactory should be called at most once.`,\n    );\n  }\n  sanitizerFactoryInternal = newSanitizer;\n};\n\n/**\n * Only used in internal tests, not a part of the public API.\n */\nconst _testOnlyClearSanitizerFactoryDoNotCallOrElse = () => {\n  sanitizerFactoryInternal = noopSanitizer;\n};\n\nconst createSanitizer: SanitizerFactory = (node, name, type) => {\n  return sanitizerFactoryInternal(node, name, type);\n};\n\n// Added to an attribute name to mark the attribute as bound so we can find\n// it easily.\nconst boundAttributeSuffix = '$lit$';\n\n// This marker is used in many syntactic positions in HTML, so it must be\n// a valid element name and attribute name. We don't support dynamic names (yet)\n// but this at least ensures that the parse tree is closer to the template\n// intention.\nconst marker = `lit$${Math.random().toFixed(9).slice(2)}$`;\n\n// String used to tell if a comment is a marker comment\nconst markerMatch = '?' + marker;\n\n// Text used to insert a comment marker node. We use processing instruction\n// syntax because it's slightly smaller, but parses as a comment node.\nconst nodeMarker = `<${markerMatch}>`;\n\nconst d =\n  NODE_MODE && global.document === undefined\n    ? ({\n        createTreeWalker() {\n          return {};\n        },\n      } as unknown as Document)\n    : document;\n\n// Creates a dynamic marker. We never have to search for these in the DOM.\nconst createMarker = () => d.createComment('');\n\n// https://tc39.github.io/ecma262/#sec-typeof-operator\ntype Primitive = null | undefined | boolean | number | string | symbol | bigint;\nconst isPrimitive = (value: unknown): value is Primitive =>\n  value === null || (typeof value != 'object' && typeof value != 'function');\nconst isArray = Array.isArray;\nconst isIterable = (value: unknown): value is Iterable<unknown> =>\n  isArray(value) ||\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  typeof (value as any)?.[Symbol.iterator] === 'function';\n\nconst SPACE_CHAR = `[ \\t\\n\\f\\r]`;\nconst ATTR_VALUE_CHAR = `[^ \\t\\n\\f\\r\"'\\`<>=]`;\nconst NAME_CHAR = `[^\\\\s\"'>=/]`;\n\n// These regexes represent the five parsing states that we care about in the\n// Template's HTML scanner. They match the *end* of the state they're named\n// after.\n// Depending on the match, we transition to a new state. If there's no match,\n// we stay in the same state.\n// Note that the regexes are stateful. We utilize lastIndex and sync it\n// across the multiple regexes used. In addition to the five regexes below\n// we also dynamically create a regex to find the matching end tags for raw\n// text elements.\n\n/**\n * End of text is: `<` followed by:\n *   (comment start) or (tag) or (dynamic tag binding)\n */\nconst textEndRegex = /<(?:(!--|\\/[^a-zA-Z])|(\\/?[a-zA-Z][^>\\s]*)|(\\/?$))/g;\nconst COMMENT_START = 1;\nconst TAG_NAME = 2;\nconst DYNAMIC_TAG_NAME = 3;\n\nconst commentEndRegex = /-->/g;\n/**\n * Comments not started with <!--, like </{, can be ended by a single `>`\n */\nconst comment2EndRegex = />/g;\n\n/**\n * The tagEnd regex matches the end of the \"inside an opening\" tag syntax\n * position. It either matches a `>`, an attribute-like sequence, or the end\n * of the string after a space (attribute-name position ending).\n *\n * See attributes in the HTML spec:\n * https://www.w3.org/TR/html5/syntax.html#elements-attributes\n *\n * \" \\t\\n\\f\\r\" are HTML space characters:\n * https://infra.spec.whatwg.org/#ascii-whitespace\n *\n * So an attribute is:\n *  * The name: any character except a whitespace character, (\"), ('), \">\",\n *    \"=\", or \"/\". Note: this is different from the HTML spec which also excludes control characters.\n *  * Followed by zero or more space characters\n *  * Followed by \"=\"\n *  * Followed by zero or more space characters\n *  * Followed by:\n *    * Any character except space, ('), (\"), \"<\", \">\", \"=\", (`), or\n *    * (\") then any non-(\"), or\n *    * (') then any non-(')\n */\nconst tagEndRegex = new RegExp(\n  `>|${SPACE_CHAR}(?:(${NAME_CHAR}+)(${SPACE_CHAR}*=${SPACE_CHAR}*(?:${ATTR_VALUE_CHAR}|(\"|')|))|$)`,\n  'g',\n);\nconst ENTIRE_MATCH = 0;\nconst ATTRIBUTE_NAME = 1;\nconst SPACES_AND_EQUALS = 2;\nconst QUOTE_CHAR = 3;\n\nconst singleQuoteAttrEndRegex = /'/g;\nconst doubleQuoteAttrEndRegex = /\"/g;\n/**\n * Matches the raw text elements.\n *\n * Comments are not parsed within raw text elements, so we need to search their\n * text content for marker strings.\n */\nconst rawTextElement = /^(?:script|style|textarea|title)$/i;\n\n/** TemplateResult types */\nconst HTML_RESULT = 1;\nconst SVG_RESULT = 2;\nconst MATHML_RESULT = 3;\n\ntype ResultType = typeof HTML_RESULT | typeof SVG_RESULT | typeof MATHML_RESULT;\n\n// TemplatePart types\n// IMPORTANT: these must match the values in PartType\nconst ATTRIBUTE_PART = 1;\nconst CHILD_PART = 2;\nconst PROPERTY_PART = 3;\nconst BOOLEAN_ATTRIBUTE_PART = 4;\nconst EVENT_PART = 5;\nconst ELEMENT_PART = 6;\nconst COMMENT_PART = 7;\n\n/**\n * The return type of the template tag functions, {@linkcode html} and\n * {@linkcode svg} when it hasn't been compiled by @lit-labs/compiler.\n *\n * A `TemplateResult` object holds all the information about a template\n * expression required to render it: the template strings, expression values,\n * and type of template (html or svg).\n *\n * `TemplateResult` objects do not create any DOM on their own. To create or\n * update DOM you need to render the `TemplateResult`. See\n * [Rendering](https://lit.dev/docs/components/rendering) for more information.\n *\n */\nexport type UncompiledTemplateResult<T extends ResultType = ResultType> = {\n  // This property needs to remain unminified.\n  ['_$litType$']: T;\n  strings: TemplateStringsArray;\n  values: unknown[];\n};\n\n/**\n * This is a template result that may be either uncompiled or compiled.\n *\n * In the future, TemplateResult will be this type. If you want to explicitly\n * note that a template result is potentially compiled, you can reference this\n * type and it will continue to behave the same through the next major version\n * of Lit. This can be useful for code that wants to prepare for the next\n * major version of Lit.\n */\nexport type MaybeCompiledTemplateResult<T extends ResultType = ResultType> =\n  | UncompiledTemplateResult<T>\n  | CompiledTemplateResult;\n\n/**\n * The return type of the template tag functions, {@linkcode html} and\n * {@linkcode svg}.\n *\n * A `TemplateResult` object holds all the information about a template\n * expression required to render it: the template strings, expression values,\n * and type of template (html or svg).\n *\n * `TemplateResult` objects do not create any DOM on their own. To create or\n * update DOM you need to render the `TemplateResult`. See\n * [Rendering](https://lit.dev/docs/components/rendering) for more information.\n *\n * In Lit 4, this type will be an alias of\n * MaybeCompiledTemplateResult, so that code will get type errors if it assumes\n * that Lit templates are not compiled. When deliberately working with only\n * one, use either {@linkcode CompiledTemplateResult} or\n * {@linkcode UncompiledTemplateResult} explicitly.\n */\nexport type TemplateResult<T extends ResultType = ResultType> =\n  UncompiledTemplateResult<T>;\n\nexport type HTMLTemplateResult = TemplateResult<typeof HTML_RESULT>;\n\nexport type SVGTemplateResult = TemplateResult<typeof SVG_RESULT>;\n\nexport type MathMLTemplateResult = TemplateResult<typeof MATHML_RESULT>;\n\n/**\n * A TemplateResult that has been compiled by @lit-labs/compiler, skipping the\n * prepare step.\n */\nexport interface CompiledTemplateResult {\n  // This is a factory in order to make template initialization lazy\n  // and allow ShadyRenderOptions scope to be passed in.\n  // This property needs to remain unminified.\n  ['_$litType$']: CompiledTemplate;\n  values: unknown[];\n}\n\nexport interface CompiledTemplate extends Omit<Template, 'el'> {\n  // el is overridden to be optional. We initialize it on first render\n  el?: HTMLTemplateElement;\n\n  // The prepared HTML string to create a template element from.\n  // The type is a TemplateStringsArray to guarantee that the value came from\n  // source code, preventing a JSON injection attack.\n  h: TemplateStringsArray;\n}\n\n/**\n * Generates a template literal tag function that returns a TemplateResult with\n * the given result type.\n */\nconst tag =\n  <T extends ResultType>(type: T) =>\n  (strings: TemplateStringsArray, ...values: unknown[]): TemplateResult<T> => {\n    // Warn against templates octal escape sequences\n    // We do this here rather than in render so that the warning is closer to the\n    // template definition.\n    if (DEV_MODE && strings.some((s) => s === undefined)) {\n      console.warn(\n        'Some template strings are undefined.\\n' +\n          'This is probably caused by illegal octal escape sequences.',\n      );\n    }\n    if (DEV_MODE) {\n      // Import static-html.js results in a circular dependency which g3 doesn't\n      // handle. Instead we know that static values must have the field\n      // `_$litStatic$`.\n      if (\n        values.some((val) => (val as {_$litStatic$: unknown})?.['_$litStatic$'])\n      ) {\n        issueWarning(\n          '',\n          `Static values 'literal' or 'unsafeStatic' cannot be used as values to non-static templates.\\n` +\n            `Please use the static 'html' tag function. See https://lit.dev/docs/templates/expressions/#static-expressions`,\n        );\n      }\n    }\n    return {\n      // This property needs to remain unminified.\n      ['_$litType$']: type,\n      strings,\n      values,\n    };\n  };\n\n/**\n * Interprets a template literal as an HTML template that can efficiently\n * render to and update a container.\n *\n * ```ts\n * const header = (title: string) => html`<h1>${title}</h1>`;\n * ```\n *\n * The `html` tag returns a description of the DOM to render as a value. It is\n * lazy, meaning no work is done until the template is rendered. When rendering,\n * if a template comes from the same expression as a previously rendered result,\n * it's efficiently updated instead of replaced.\n */\nexport const html = tag(HTML_RESULT);\n\n/**\n * Interprets a template literal as an SVG fragment that can efficiently render\n * to and update a container.\n *\n * ```ts\n * const rect = svg`<rect width=\"10\" height=\"10\"></rect>`;\n *\n * const myImage = html`\n *   <svg viewBox=\"0 0 10 10\" xmlns=\"http://www.w3.org/2000/svg\">\n *     ${rect}\n *   </svg>`;\n * ```\n *\n * The `svg` *tag function* should only be used for SVG fragments, or elements\n * that would be contained **inside** an `<svg>` HTML element. A common error is\n * placing an `<svg>` *element* in a template tagged with the `svg` tag\n * function. The `<svg>` element is an HTML element and should be used within a\n * template tagged with the {@linkcode html} tag function.\n *\n * In LitElement usage, it's invalid to return an SVG fragment from the\n * `render()` method, as the SVG fragment will be contained within the element's\n * shadow root and thus not be properly contained within an `<svg>` HTML\n * element.\n */\nexport const svg = tag(SVG_RESULT);\n\n/**\n * Interprets a template literal as MathML fragment that can efficiently render\n * to and update a container.\n *\n * ```ts\n * const num = mathml`<mn>1</mn>`;\n *\n * const eq = html`\n *   <math>\n *     ${num}\n *   </math>`;\n * ```\n *\n * The `mathml` *tag function* should only be used for MathML fragments, or\n * elements that would be contained **inside** a `<math>` HTML element. A common\n * error is placing a `<math>` *element* in a template tagged with the `mathml`\n * tag function. The `<math>` element is an HTML element and should be used\n * within a template tagged with the {@linkcode html} tag function.\n *\n * In LitElement usage, it's invalid to return an MathML fragment from the\n * `render()` method, as the MathML fragment will be contained within the\n * element's shadow root and thus not be properly contained within a `<math>`\n * HTML element.\n */\nexport const mathml = tag(MATHML_RESULT);\n\n/**\n * A sentinel value that signals that a value was handled by a directive and\n * should not be written to the DOM.\n */\nexport const noChange = Symbol.for('lit-noChange');\n\n/**\n * A sentinel value that signals a ChildPart to fully clear its content.\n *\n * ```ts\n * const button = html`${\n *  user.isAdmin\n *    ? html`<button>DELETE</button>`\n *    : nothing\n * }`;\n * ```\n *\n * Prefer using `nothing` over other falsy values as it provides a consistent\n * behavior between various expression binding contexts.\n *\n * In child expressions, `undefined`, `null`, `''`, and `nothing` all behave the\n * same and render no nodes. In attribute expressions, `nothing` _removes_ the\n * attribute, while `undefined` and `null` will render an empty string. In\n * property expressions `nothing` becomes `undefined`.\n */\nexport const nothing = Symbol.for('lit-nothing');\n\n/**\n * The cache of prepared templates, keyed by the tagged TemplateStringsArray\n * and _not_ accounting for the specific template tag used. This means that\n * template tags cannot be dynamic - they must statically be one of html, svg,\n * or attr. This restriction simplifies the cache lookup, which is on the hot\n * path for rendering.\n */\nconst templateCache = new WeakMap<TemplateStringsArray, Template>();\n\n/**\n * Object specifying options for controlling lit-html rendering. Note that\n * while `render` may be called multiple times on the same `container` (and\n * `renderBefore` reference node) to efficiently update the rendered content,\n * only the options passed in during the first render are respected during\n * the lifetime of renders to that unique `container` + `renderBefore`\n * combination.\n */\nexport interface RenderOptions {\n  /**\n   * An object to use as the `this` value for event listeners. It's often\n   * useful to set this to the host component rendering a template.\n   */\n  host?: object;\n  /**\n   * A DOM node before which to render content in the container.\n   */\n  renderBefore?: ChildNode | null;\n  /**\n   * Node used for cloning the template (`importNode` will be called on this\n   * node). This controls the `ownerDocument` of the rendered DOM, along with\n   * any inherited context. Defaults to the global `document`.\n   */\n  creationScope?: {importNode(node: Node, deep?: boolean): Node};\n  /**\n   * The initial connected state for the top-level part being rendered. If no\n   * `isConnected` option is set, `AsyncDirective`s will be connected by\n   * default. Set to `false` if the initial render occurs in a disconnected tree\n   * and `AsyncDirective`s should see `isConnected === false` for their initial\n   * render. The `part.setConnected()` method must be used subsequent to initial\n   * render to change the connected state of the part.\n   */\n  isConnected?: boolean;\n}\n\nconst walker = d.createTreeWalker(\n  d,\n  129 /* NodeFilter.SHOW_{ELEMENT|COMMENT} */,\n);\n\nlet sanitizerFactoryInternal: SanitizerFactory = noopSanitizer;\n\n//\n// Classes only below here, const variable declarations only above here...\n//\n// Keeping variable declarations and classes together improves minification.\n// Interfaces and type aliases can be interleaved freely.\n//\n\n// Type for classes that have a `_directive` or `_directives[]` field, used by\n// `resolveDirective`\nexport interface DirectiveParent {\n  _$parent?: DirectiveParent;\n  _$isConnected: boolean;\n  __directive?: Directive;\n  __directives?: Array<Directive | undefined>;\n}\n\nfunction trustFromTemplateString(\n  tsa: TemplateStringsArray,\n  stringFromTSA: string,\n): TrustedHTML {\n  // A security check to prevent spoofing of Lit template results.\n  // In the future, we may be able to replace this with Array.isTemplateObject,\n  // though we might need to make that check inside of the html and svg\n  // functions, because precompiled templates don't come in as\n  // TemplateStringArray objects.\n  if (!isArray(tsa) || !tsa.hasOwnProperty('raw')) {\n    let message = 'invalid template strings array';\n    if (DEV_MODE) {\n      message = `\n          Internal Error: expected template strings to be an array\n          with a 'raw' field. Faking a template strings array by\n          calling html or svg like an ordinary function is effectively\n          the same as calling unsafeHtml and can lead to major security\n          issues, e.g. opening your code up to XSS attacks.\n          If you're using the html or svg tagged template functions normally\n          and still seeing this error, please file a bug at\n          https://github.com/lit/lit/issues/new?template=bug_report.md\n          and include information about your build tooling, if any.\n        `\n        .trim()\n        .replace(/\\n */g, '\\n');\n    }\n    throw new Error(message);\n  }\n  return policy !== undefined\n    ? policy.createHTML(stringFromTSA)\n    : (stringFromTSA as unknown as TrustedHTML);\n}\n\n/**\n * Returns an HTML string for the given TemplateStringsArray and result type\n * (HTML or SVG), along with the case-sensitive bound attribute names in\n * template order. The HTML contains comment markers denoting the `ChildPart`s\n * and suffixes on bound attributes denoting the `AttributeParts`.\n *\n * @param strings template strings array\n * @param type HTML or SVG\n * @return Array containing `[html, attrNames]` (array returned for terseness,\n *     to avoid object fields since this code is shared with non-minified SSR\n *     code)\n */\nconst getTemplateHtml = (\n  strings: TemplateStringsArray,\n  type: ResultType,\n): [TrustedHTML, Array<string>] => {\n  // Insert makers into the template HTML to represent the position of\n  // bindings. The following code scans the template strings to determine the\n  // syntactic position of the bindings. They can be in text position, where\n  // we insert an HTML comment, attribute value position, where we insert a\n  // sentinel string and re-write the attribute name, or inside a tag where\n  // we insert the sentinel string.\n  const l = strings.length - 1;\n  // Stores the case-sensitive bound attribute names in the order of their\n  // parts. ElementParts are also reflected in this array as undefined\n  // rather than a string, to disambiguate from attribute bindings.\n  const attrNames: Array<string> = [];\n  let html =\n    type === SVG_RESULT ? '<svg>' : type === MATHML_RESULT ? '<math>' : '';\n\n  // When we're inside a raw text tag (not it's text content), the regex\n  // will still be tagRegex so we can find attributes, but will switch to\n  // this regex when the tag ends.\n  let rawTextEndRegex: RegExp | undefined;\n\n  // The current parsing state, represented as a reference to one of the\n  // regexes\n  let regex = textEndRegex;\n\n  for (let i = 0; i < l; i++) {\n    const s = strings[i];\n    // The index of the end of the last attribute name. When this is\n    // positive at end of a string, it means we're in an attribute value\n    // position and need to rewrite the attribute name.\n    // We also use a special value of -2 to indicate that we encountered\n    // the end of a string in attribute name position.\n    let attrNameEndIndex = -1;\n    let attrName: string | undefined;\n    let lastIndex = 0;\n    let match!: RegExpExecArray | null;\n\n    // The conditions in this loop handle the current parse state, and the\n    // assignments to the `regex` variable are the state transitions.\n    while (lastIndex < s.length) {\n      // Make sure we start searching from where we previously left off\n      regex.lastIndex = lastIndex;\n      match = regex.exec(s);\n      if (match === null) {\n        break;\n      }\n      lastIndex = regex.lastIndex;\n      if (regex === textEndRegex) {\n        if (match[COMMENT_START] === '!--') {\n          regex = commentEndRegex;\n        } else if (match[COMMENT_START] !== undefined) {\n          // We started a weird comment, like </{\n          regex = comment2EndRegex;\n        } else if (match[TAG_NAME] !== undefined) {\n          if (rawTextElement.test(match[TAG_NAME])) {\n            // Record if we encounter a raw-text element. We'll switch to\n            // this regex at the end of the tag.\n            rawTextEndRegex = new RegExp(`</${match[TAG_NAME]}`, 'g');\n          }\n          regex = tagEndRegex;\n        } else if (match[DYNAMIC_TAG_NAME] !== undefined) {\n          if (DEV_MODE) {\n            throw new Error(\n              'Bindings in tag names are not supported. Please use static templates instead. ' +\n                'See https://lit.dev/docs/templates/expressions/#static-expressions',\n            );\n          }\n          regex = tagEndRegex;\n        }\n      } else if (regex === tagEndRegex) {\n        if (match[ENTIRE_MATCH] === '>') {\n          // End of a tag. If we had started a raw-text element, use that\n          // regex\n          regex = rawTextEndRegex ?? textEndRegex;\n          // We may be ending an unquoted attribute value, so make sure we\n          // clear any pending attrNameEndIndex\n          attrNameEndIndex = -1;\n        } else if (match[ATTRIBUTE_NAME] === undefined) {\n          // Attribute name position\n          attrNameEndIndex = -2;\n        } else {\n          attrNameEndIndex = regex.lastIndex - match[SPACES_AND_EQUALS].length;\n          attrName = match[ATTRIBUTE_NAME];\n          regex =\n            match[QUOTE_CHAR] === undefined\n              ? tagEndRegex\n              : match[QUOTE_CHAR] === '\"'\n                ? doubleQuoteAttrEndRegex\n                : singleQuoteAttrEndRegex;\n        }\n      } else if (\n        regex === doubleQuoteAttrEndRegex ||\n        regex === singleQuoteAttrEndRegex\n      ) {\n        regex = tagEndRegex;\n      } else if (regex === commentEndRegex || regex === comment2EndRegex) {\n        regex = textEndRegex;\n      } else {\n        // Not one of the five state regexes, so it must be the dynamically\n        // created raw text regex and we're at the close of that element.\n        regex = tagEndRegex;\n        rawTextEndRegex = undefined;\n      }\n    }\n\n    if (DEV_MODE) {\n      // If we have a attrNameEndIndex, which indicates that we should\n      // rewrite the attribute name, assert that we're in a valid attribute\n      // position - either in a tag, or a quoted attribute value.\n      console.assert(\n        attrNameEndIndex === -1 ||\n          regex === tagEndRegex ||\n          regex === singleQuoteAttrEndRegex ||\n          regex === doubleQuoteAttrEndRegex,\n        'unexpected parse state B',\n      );\n    }\n\n    // We have four cases:\n    //  1. We're in text position, and not in a raw text element\n    //     (regex === textEndRegex): insert a comment marker.\n    //  2. We have a non-negative attrNameEndIndex which means we need to\n    //     rewrite the attribute name to add a bound attribute suffix.\n    //  3. We're at the non-first binding in a multi-binding attribute, use a\n    //     plain marker.\n    //  4. We're somewhere else inside the tag. If we're in attribute name\n    //     position (attrNameEndIndex === -2), add a sequential suffix to\n    //     generate a unique attribute name.\n\n    // Detect a binding next to self-closing tag end and insert a space to\n    // separate the marker from the tag end:\n    const end =\n      regex === tagEndRegex && strings[i + 1].startsWith('/>') ? ' ' : '';\n    html +=\n      regex === textEndRegex\n        ? s + nodeMarker\n        : attrNameEndIndex >= 0\n          ? (attrNames.push(attrName!),\n            s.slice(0, attrNameEndIndex) +\n              boundAttributeSuffix +\n              s.slice(attrNameEndIndex)) +\n            marker +\n            end\n          : s + marker + (attrNameEndIndex === -2 ? i : end);\n  }\n\n  const htmlResult: string | TrustedHTML =\n    html +\n    (strings[l] || '<?>') +\n    (type === SVG_RESULT ? '</svg>' : type === MATHML_RESULT ? '</math>' : '');\n\n  // Returned as an array for terseness\n  return [trustFromTemplateString(strings, htmlResult), attrNames];\n};\n\n/** @internal */\nexport type {Template};\nclass Template {\n  /** @internal */\n  el!: HTMLTemplateElement;\n\n  parts: Array<TemplatePart> = [];\n\n  constructor(\n    // This property needs to remain unminified.\n    {strings, ['_$litType$']: type}: UncompiledTemplateResult,\n    options?: RenderOptions,\n  ) {\n    let node: Node | null;\n    let nodeIndex = 0;\n    let attrNameIndex = 0;\n    const partCount = strings.length - 1;\n    const parts = this.parts;\n\n    // Create template element\n    const [html, attrNames] = getTemplateHtml(strings, type);\n    this.el = Template.createElement(html, options);\n    walker.currentNode = this.el.content;\n\n    // Re-parent SVG or MathML nodes into template root\n    if (type === SVG_RESULT || type === MATHML_RESULT) {\n      const wrapper = this.el.content.firstChild!;\n      wrapper.replaceWith(...wrapper.childNodes);\n    }\n\n    // Walk the template to find binding markers and create TemplateParts\n    while ((node = walker.nextNode()) !== null && parts.length < partCount) {\n      if (node.nodeType === 1) {\n        if (DEV_MODE) {\n          const tag = (node as Element).localName;\n          // Warn if `textarea` includes an expression and throw if `template`\n          // does since these are not supported. We do this by checking\n          // innerHTML for anything that looks like a marker. This catches\n          // cases like bindings in textarea there markers turn into text nodes.\n          if (\n            /^(?:textarea|template)$/i!.test(tag) &&\n            (node as Element).innerHTML.includes(marker)\n          ) {\n            const m =\n              `Expressions are not supported inside \\`${tag}\\` ` +\n              `elements. See https://lit.dev/msg/expression-in-${tag} for more ` +\n              `information.`;\n            if (tag === 'template') {\n              throw new Error(m);\n            } else issueWarning('', m);\n          }\n        }\n        // TODO (justinfagnani): for attempted dynamic tag names, we don't\n        // increment the bindingIndex, and it'll be off by 1 in the element\n        // and off by two after it.\n        if ((node as Element).hasAttributes()) {\n          for (const name of (node as Element).getAttributeNames()) {\n            if (name.endsWith(boundAttributeSuffix)) {\n              const realName = attrNames[attrNameIndex++];\n              const value = (node as Element).getAttribute(name)!;\n              const statics = value.split(marker);\n              const m = /([.?@])?(.*)/.exec(realName)!;\n              parts.push({\n                type: ATTRIBUTE_PART,\n                index: nodeIndex,\n                name: m[2],\n                strings: statics,\n                ctor:\n                  m[1] === '.'\n                    ? PropertyPart\n                    : m[1] === '?'\n                      ? BooleanAttributePart\n                      : m[1] === '@'\n                        ? EventPart\n                        : AttributePart,\n              });\n              (node as Element).removeAttribute(name);\n            } else if (name.startsWith(marker)) {\n              parts.push({\n                type: ELEMENT_PART,\n                index: nodeIndex,\n              });\n              (node as Element).removeAttribute(name);\n            }\n          }\n        }\n        // TODO (justinfagnani): benchmark the regex against testing for each\n        // of the 3 raw text element names.\n        if (rawTextElement.test((node as Element).tagName)) {\n          // For raw text elements we need to split the text content on\n          // markers, create a Text node for each segment, and create\n          // a TemplatePart for each marker.\n          const strings = (node as Element).textContent!.split(marker);\n          const lastIndex = strings.length - 1;\n          if (lastIndex > 0) {\n            (node as Element).textContent = trustedTypes\n              ? (trustedTypes.emptyScript as unknown as '')\n              : '';\n            // Generate a new text node for each literal section\n            // These nodes are also used as the markers for node parts\n            // We can't use empty text nodes as markers because they're\n            // normalized when cloning in IE (could simplify when\n            // IE is no longer supported)\n            for (let i = 0; i < lastIndex; i++) {\n              (node as Element).append(strings[i], createMarker());\n              // Walk past the marker node we just added\n              walker.nextNode();\n              parts.push({type: CHILD_PART, index: ++nodeIndex});\n            }\n            // Note because this marker is added after the walker's current\n            // node, it will be walked to in the outer loop (and ignored), so\n            // we don't need to adjust nodeIndex here\n            (node as Element).append(strings[lastIndex], createMarker());\n          }\n        }\n      } else if (node.nodeType === 8) {\n        const data = (node as Comment).data;\n        if (data === markerMatch) {\n          parts.push({type: CHILD_PART, index: nodeIndex});\n        } else {\n          let i = -1;\n          while ((i = (node as Comment).data.indexOf(marker, i + 1)) !== -1) {\n            // Comment node has a binding marker inside, make an inactive part\n            // The binding won't work, but subsequent bindings will\n            parts.push({type: COMMENT_PART, index: nodeIndex});\n            // Move to the end of the match\n            i += marker.length - 1;\n          }\n        }\n      }\n      nodeIndex++;\n    }\n\n    if (DEV_MODE) {\n      // If there was a duplicate attribute on a tag, then when the tag is\n      // parsed into an element the attribute gets de-duplicated. We can detect\n      // this mismatch if we haven't precisely consumed every attribute name\n      // when preparing the template. This works because `attrNames` is built\n      // from the template string and `attrNameIndex` comes from processing the\n      // resulting DOM.\n      if (attrNames.length !== attrNameIndex) {\n        throw new Error(\n          `Detected duplicate attribute bindings. This occurs if your template ` +\n            `has duplicate attributes on an element tag. For example ` +\n            `\"<input ?disabled=\\${true} ?disabled=\\${false}>\" contains a ` +\n            `duplicate \"disabled\" attribute. The error was detected in ` +\n            `the following template: \\n` +\n            '`' +\n            strings.join('${...}') +\n            '`',\n        );\n      }\n    }\n\n    // We could set walker.currentNode to another node here to prevent a memory\n    // leak, but every time we prepare a template, we immediately render it\n    // and re-use the walker in new TemplateInstance._clone().\n    debugLogEvent &&\n      debugLogEvent({\n        kind: 'template prep',\n        template: this,\n        clonableTemplate: this.el,\n        parts: this.parts,\n        strings,\n      });\n  }\n\n  // Overridden via `litHtmlPolyfillSupport` to provide platform support.\n  /** @nocollapse */\n  static createElement(html: TrustedHTML, _options?: RenderOptions) {\n    const el = d.createElement('template');\n    el.innerHTML = html as unknown as string;\n    return el;\n  }\n}\n\nexport interface Disconnectable {\n  _$parent?: Disconnectable;\n  _$disconnectableChildren?: Set<Disconnectable>;\n  // Rather than hold connection state on instances, Disconnectables recursively\n  // fetch the connection state from the RootPart they are connected in via\n  // getters up the Disconnectable tree via _$parent references. This pushes the\n  // cost of tracking the isConnected state to `AsyncDirectives`, and avoids\n  // needing to pass all Disconnectables (parts, template instances, and\n  // directives) their connection state each time it changes, which would be\n  // costly for trees that have no AsyncDirectives.\n  _$isConnected: boolean;\n}\n\nfunction resolveDirective(\n  part: ChildPart | AttributePart | ElementPart,\n  value: unknown,\n  parent: DirectiveParent = part,\n  attributeIndex?: number,\n): unknown {\n  // Bail early if the value is explicitly noChange. Note, this means any\n  // nested directive is still attached and is not run.\n  if (value === noChange) {\n    return value;\n  }\n  let currentDirective =\n    attributeIndex !== undefined\n      ? (parent as AttributePart).__directives?.[attributeIndex]\n      : (parent as ChildPart | ElementPart | Directive).__directive;\n  const nextDirectiveConstructor = isPrimitive(value)\n    ? undefined\n    : // This property needs to remain unminified.\n      (value as DirectiveResult)['_$litDirective$'];\n  if (currentDirective?.constructor !== nextDirectiveConstructor) {\n    // This property needs to remain unminified.\n    currentDirective?.['_$notifyDirectiveConnectionChanged']?.(false);\n    if (nextDirectiveConstructor === undefined) {\n      currentDirective = undefined;\n    } else {\n      currentDirective = new nextDirectiveConstructor(part as PartInfo);\n      currentDirective._$initialize(part, parent, attributeIndex);\n    }\n    if (attributeIndex !== undefined) {\n      ((parent as AttributePart).__directives ??= [])[attributeIndex] =\n        currentDirective;\n    } else {\n      (parent as ChildPart | Directive).__directive = currentDirective;\n    }\n  }\n  if (currentDirective !== undefined) {\n    value = resolveDirective(\n      part,\n      currentDirective._$resolve(part, (value as DirectiveResult).values),\n      currentDirective,\n      attributeIndex,\n    );\n  }\n  return value;\n}\n\nexport type {TemplateInstance};\n/**\n * An updateable instance of a Template. Holds references to the Parts used to\n * update the template instance.\n */\nclass TemplateInstance implements Disconnectable {\n  _$template: Template;\n  _$parts: Array<Part | undefined> = [];\n\n  /** @internal */\n  _$parent: ChildPart;\n  /** @internal */\n  _$disconnectableChildren?: Set<Disconnectable> = undefined;\n\n  constructor(template: Template, parent: ChildPart) {\n    this._$template = template;\n    this._$parent = parent;\n  }\n\n  // Called by ChildPart parentNode getter\n  get parentNode() {\n    return this._$parent.parentNode;\n  }\n\n  // See comment in Disconnectable interface for why this is a getter\n  get _$isConnected() {\n    return this._$parent._$isConnected;\n  }\n\n  // This method is separate from the constructor because we need to return a\n  // DocumentFragment and we don't want to hold onto it with an instance field.\n  _clone(options: RenderOptions | undefined) {\n    const {\n      el: {content},\n      parts: parts,\n    } = this._$template;\n    const fragment = (options?.creationScope ?? d).importNode(content, true);\n    walker.currentNode = fragment;\n\n    let node = walker.nextNode()!;\n    let nodeIndex = 0;\n    let partIndex = 0;\n    let templatePart = parts[0];\n\n    while (templatePart !== undefined) {\n      if (nodeIndex === templatePart.index) {\n        let part: Part | undefined;\n        if (templatePart.type === CHILD_PART) {\n          part = new ChildPart(\n            node as HTMLElement,\n            node.nextSibling,\n            this,\n            options,\n          );\n        } else if (templatePart.type === ATTRIBUTE_PART) {\n          part = new templatePart.ctor(\n            node as HTMLElement,\n            templatePart.name,\n            templatePart.strings,\n            this,\n            options,\n          );\n        } else if (templatePart.type === ELEMENT_PART) {\n          part = new ElementPart(node as HTMLElement, this, options);\n        }\n        this._$parts.push(part);\n        templatePart = parts[++partIndex];\n      }\n      if (nodeIndex !== templatePart?.index) {\n        node = walker.nextNode()!;\n        nodeIndex++;\n      }\n    }\n    // We need to set the currentNode away from the cloned tree so that we\n    // don't hold onto the tree even if the tree is detached and should be\n    // freed.\n    walker.currentNode = d;\n    return fragment;\n  }\n\n  _update(values: Array<unknown>) {\n    let i = 0;\n    for (const part of this._$parts) {\n      if (part !== undefined) {\n        debugLogEvent &&\n          debugLogEvent({\n            kind: 'set part',\n            part,\n            value: values[i],\n            valueIndex: i,\n            values,\n            templateInstance: this,\n          });\n        if ((part as AttributePart).strings !== undefined) {\n          (part as AttributePart)._$setValue(values, part as AttributePart, i);\n          // The number of values the part consumes is part.strings.length - 1\n          // since values are in between template spans. We increment i by 1\n          // later in the loop, so increment it by part.strings.length - 2 here\n          i += (part as AttributePart).strings!.length - 2;\n        } else {\n          part._$setValue(values[i]);\n        }\n      }\n      i++;\n    }\n  }\n}\n\n/*\n * Parts\n */\ntype AttributeTemplatePart = {\n  readonly type: typeof ATTRIBUTE_PART;\n  readonly index: number;\n  readonly name: string;\n  readonly ctor: typeof AttributePart;\n  readonly strings: ReadonlyArray<string>;\n};\ntype ChildTemplatePart = {\n  readonly type: typeof CHILD_PART;\n  readonly index: number;\n};\ntype ElementTemplatePart = {\n  readonly type: typeof ELEMENT_PART;\n  readonly index: number;\n};\ntype CommentTemplatePart = {\n  readonly type: typeof COMMENT_PART;\n  readonly index: number;\n};\n\n/**\n * A TemplatePart represents a dynamic part in a template, before the template\n * is instantiated. When a template is instantiated Parts are created from\n * TemplateParts.\n */\ntype TemplatePart =\n  | ChildTemplatePart\n  | AttributeTemplatePart\n  | ElementTemplatePart\n  | CommentTemplatePart;\n\nexport type Part =\n  | ChildPart\n  | AttributePart\n  | PropertyPart\n  | BooleanAttributePart\n  | ElementPart\n  | EventPart;\n\nexport type {ChildPart};\nclass ChildPart implements Disconnectable {\n  readonly type = CHILD_PART;\n  readonly options: RenderOptions | undefined;\n  _$committedValue: unknown = nothing;\n  /** @internal */\n  __directive?: Directive;\n  /** @internal */\n  _$startNode: ChildNode;\n  /** @internal */\n  _$endNode: ChildNode | null;\n  private _textSanitizer: ValueSanitizer | undefined;\n  /** @internal */\n  _$parent: Disconnectable | undefined;\n  /**\n   * Connection state for RootParts only (i.e. ChildPart without _$parent\n   * returned from top-level `render`). This field is unused otherwise. The\n   * intention would be clearer if we made `RootPart` a subclass of `ChildPart`\n   * with this field (and a different _$isConnected getter), but the subclass\n   * caused a perf regression, possibly due to making call sites polymorphic.\n   * @internal\n   */\n  __isConnected: boolean;\n\n  // See comment in Disconnectable interface for why this is a getter\n  get _$isConnected() {\n    // ChildParts that are not at the root should always be created with a\n    // parent; only RootChildNode's won't, so they return the local isConnected\n    // state\n    return this._$parent?._$isConnected ?? this.__isConnected;\n  }\n\n  // The following fields will be patched onto ChildParts when required by\n  // AsyncDirective\n  /** @internal */\n  _$disconnectableChildren?: Set<Disconnectable> = undefined;\n  /** @internal */\n  _$notifyConnectionChanged?(\n    isConnected: boolean,\n    removeFromParent?: boolean,\n    from?: number,\n  ): void;\n  /** @internal */\n  _$reparentDisconnectables?(parent: Disconnectable): void;\n\n  constructor(\n    startNode: ChildNode,\n    endNode: ChildNode | null,\n    parent: TemplateInstance | ChildPart | undefined,\n    options: RenderOptions | undefined,\n  ) {\n    this._$startNode = startNode;\n    this._$endNode = endNode;\n    this._$parent = parent;\n    this.options = options;\n    // Note __isConnected is only ever accessed on RootParts (i.e. when there is\n    // no _$parent); the value on a non-root-part is \"don't care\", but checking\n    // for parent would be more code\n    this.__isConnected = options?.isConnected ?? true;\n    if (ENABLE_EXTRA_SECURITY_HOOKS) {\n      // Explicitly initialize for consistent class shape.\n      this._textSanitizer = undefined;\n    }\n  }\n\n  /**\n   * The parent node into which the part renders its content.\n   *\n   * A ChildPart's content consists of a range of adjacent child nodes of\n   * `.parentNode`, possibly bordered by 'marker nodes' (`.startNode` and\n   * `.endNode`).\n   *\n   * - If both `.startNode` and `.endNode` are non-null, then the part's content\n   * consists of all siblings between `.startNode` and `.endNode`, exclusively.\n   *\n   * - If `.startNode` is non-null but `.endNode` is null, then the part's\n   * content consists of all siblings following `.startNode`, up to and\n   * including the last child of `.parentNode`. If `.endNode` is non-null, then\n   * `.startNode` will always be non-null.\n   *\n   * - If both `.endNode` and `.startNode` are null, then the part's content\n   * consists of all child nodes of `.parentNode`.\n   */\n  get parentNode(): Node {\n    let parentNode: Node = wrap(this._$startNode).parentNode!;\n    const parent = this._$parent;\n    if (\n      parent !== undefined &&\n      parentNode?.nodeType === 11 /* Node.DOCUMENT_FRAGMENT */\n    ) {\n      // If the parentNode is a DocumentFragment, it may be because the DOM is\n      // still in the cloned fragment during initial render; if so, get the real\n      // parentNode the part will be committed into by asking the parent.\n      parentNode = (parent as ChildPart | TemplateInstance).parentNode;\n    }\n    return parentNode;\n  }\n\n  /**\n   * The part's leading marker node, if any. See `.parentNode` for more\n   * information.\n   */\n  get startNode(): Node | null {\n    return this._$startNode;\n  }\n\n  /**\n   * The part's trailing marker node, if any. See `.parentNode` for more\n   * information.\n   */\n  get endNode(): Node | null {\n    return this._$endNode;\n  }\n\n  _$setValue(value: unknown, directiveParent: DirectiveParent = this): void {\n    if (DEV_MODE && this.parentNode === null) {\n      throw new Error(\n        `This \\`ChildPart\\` has no \\`parentNode\\` and therefore cannot accept a value. This likely means the element containing the part was manipulated in an unsupported way outside of Lit's control such that the part's marker nodes were ejected from DOM. For example, setting the element's \\`innerHTML\\` or \\`textContent\\` can do this.`,\n      );\n    }\n    value = resolveDirective(this, value, directiveParent);\n    if (isPrimitive(value)) {\n      // Non-rendering child values. It's important that these do not render\n      // empty text nodes to avoid issues with preventing default <slot>\n      // fallback content.\n      if (value === nothing || value == null || value === '') {\n        if (this._$committedValue !== nothing) {\n          debugLogEvent &&\n            debugLogEvent({\n              kind: 'commit nothing to child',\n              start: this._$startNode,\n              end: this._$endNode,\n              parent: this._$parent,\n              options: this.options,\n            });\n          this._$clear();\n        }\n        this._$committedValue = nothing;\n      } else if (value !== this._$committedValue && value !== noChange) {\n        this._commitText(value);\n      }\n      // This property needs to remain unminified.\n    } else if ((value as TemplateResult)['_$litType$'] !== undefined) {\n      this._commitTemplateResult(value as TemplateResult);\n    } else if ((value as Node).nodeType !== undefined) {\n      if (DEV_MODE && this.options?.host === value) {\n        this._commitText(\n          `[probable mistake: rendered a template's host in itself ` +\n            `(commonly caused by writing \\${this} in a template]`,\n        );\n        console.warn(\n          `Attempted to render the template host`,\n          value,\n          `inside itself. This is almost always a mistake, and in dev mode `,\n          `we render some warning text. In production however, we'll `,\n          `render it, which will usually result in an error, and sometimes `,\n          `in the element disappearing from the DOM.`,\n        );\n        return;\n      }\n      this._commitNode(value as Node);\n    } else if (isIterable(value)) {\n      this._commitIterable(value);\n    } else {\n      // Fallback, will render the string representation\n      this._commitText(value);\n    }\n  }\n\n  private _insert<T extends Node>(node: T) {\n    return wrap(wrap(this._$startNode).parentNode!).insertBefore(\n      node,\n      this._$endNode,\n    );\n  }\n\n  private _commitNode(value: Node): void {\n    if (this._$committedValue !== value) {\n      this._$clear();\n      if (\n        ENABLE_EXTRA_SECURITY_HOOKS &&\n        sanitizerFactoryInternal !== noopSanitizer\n      ) {\n        const parentNodeName = this._$startNode.parentNode?.nodeName;\n        if (parentNodeName === 'STYLE' || parentNodeName === 'SCRIPT') {\n          let message = 'Forbidden';\n          if (DEV_MODE) {\n            if (parentNodeName === 'STYLE') {\n              message =\n                `Lit does not support binding inside style nodes. ` +\n                `This is a security risk, as style injection attacks can ` +\n                `exfiltrate data and spoof UIs. ` +\n                `Consider instead using css\\`...\\` literals ` +\n                `to compose styles, and do dynamic styling with ` +\n                `css custom properties, ::parts, <slot>s, ` +\n                `and by mutating the DOM rather than stylesheets.`;\n            } else {\n              message =\n                `Lit does not support binding inside script nodes. ` +\n                `This is a security risk, as it could allow arbitrary ` +\n                `code execution.`;\n            }\n          }\n          throw new Error(message);\n        }\n      }\n      debugLogEvent &&\n        debugLogEvent({\n          kind: 'commit node',\n          start: this._$startNode,\n          parent: this._$parent,\n          value: value,\n          options: this.options,\n        });\n      this._$committedValue = this._insert(value);\n    }\n  }\n\n  private _commitText(value: unknown): void {\n    // If the committed value is a primitive it means we called _commitText on\n    // the previous render, and we know that this._$startNode.nextSibling is a\n    // Text node. We can now just replace the text content (.data) of the node.\n    if (\n      this._$committedValue !== nothing &&\n      isPrimitive(this._$committedValue)\n    ) {\n      const node = wrap(this._$startNode).nextSibling as Text;\n      if (ENABLE_EXTRA_SECURITY_HOOKS) {\n        if (this._textSanitizer === undefined) {\n          this._textSanitizer = createSanitizer(node, 'data', 'property');\n        }\n        value = this._textSanitizer(value);\n      }\n      debugLogEvent &&\n        debugLogEvent({\n          kind: 'commit text',\n          node,\n          value,\n          options: this.options,\n        });\n      (node as Text).data = value as string;\n    } else {\n      if (ENABLE_EXTRA_SECURITY_HOOKS) {\n        const textNode = d.createTextNode('');\n        this._commitNode(textNode);\n        // When setting text content, for security purposes it matters a lot\n        // what the parent is. For example, <style> and <script> need to be\n        // handled with care, while <span> does not. So first we need to put a\n        // text node into the document, then we can sanitize its content.\n        if (this._textSanitizer === undefined) {\n          this._textSanitizer = createSanitizer(textNode, 'data', 'property');\n        }\n        value = this._textSanitizer(value);\n        debugLogEvent &&\n          debugLogEvent({\n            kind: 'commit text',\n            node: textNode,\n            value,\n            options: this.options,\n          });\n        textNode.data = value as string;\n      } else {\n        this._commitNode(d.createTextNode(value as string));\n        debugLogEvent &&\n          debugLogEvent({\n            kind: 'commit text',\n            node: wrap(this._$startNode).nextSibling as Text,\n            value,\n            options: this.options,\n          });\n      }\n    }\n    this._$committedValue = value;\n  }\n\n  private _commitTemplateResult(\n    result: TemplateResult | CompiledTemplateResult,\n  ): void {\n    // This property needs to remain unminified.\n    const {values, ['_$litType$']: type} = result;\n    // If $litType$ is a number, result is a plain TemplateResult and we get\n    // the template from the template cache. If not, result is a\n    // CompiledTemplateResult and _$litType$ is a CompiledTemplate and we need\n    // to create the <template> element the first time we see it.\n    const template: Template | CompiledTemplate =\n      typeof type === 'number'\n        ? this._$getTemplate(result as UncompiledTemplateResult)\n        : (type.el === undefined &&\n            (type.el = Template.createElement(\n              trustFromTemplateString(type.h, type.h[0]),\n              this.options,\n            )),\n          type);\n\n    if ((this._$committedValue as TemplateInstance)?._$template === template) {\n      debugLogEvent &&\n        debugLogEvent({\n          kind: 'template updating',\n          template,\n          instance: this._$committedValue as TemplateInstance,\n          parts: (this._$committedValue as TemplateInstance)._$parts,\n          options: this.options,\n          values,\n        });\n      (this._$committedValue as TemplateInstance)._update(values);\n    } else {\n      const instance = new TemplateInstance(template as Template, this);\n      const fragment = instance._clone(this.options);\n      debugLogEvent &&\n        debugLogEvent({\n          kind: 'template instantiated',\n          template,\n          instance,\n          parts: instance._$parts,\n          options: this.options,\n          fragment,\n          values,\n        });\n      instance._update(values);\n      debugLogEvent &&\n        debugLogEvent({\n          kind: 'template instantiated and updated',\n          template,\n          instance,\n          parts: instance._$parts,\n          options: this.options,\n          fragment,\n          values,\n        });\n      this._commitNode(fragment);\n      this._$committedValue = instance;\n    }\n  }\n\n  // Overridden via `litHtmlPolyfillSupport` to provide platform support.\n  /** @internal */\n  _$getTemplate(result: UncompiledTemplateResult) {\n    let template = templateCache.get(result.strings);\n    if (template === undefined) {\n      templateCache.set(result.strings, (template = new Template(result)));\n    }\n    return template;\n  }\n\n  private _commitIterable(value: Iterable<unknown>): void {\n    // For an Iterable, we create a new InstancePart per item, then set its\n    // value to the item. This is a little bit of overhead for every item in\n    // an Iterable, but it lets us recurse easily and efficiently update Arrays\n    // of TemplateResults that will be commonly returned from expressions like:\n    // array.map((i) => html`${i}`), by reusing existing TemplateInstances.\n\n    // If value is an array, then the previous render was of an\n    // iterable and value will contain the ChildParts from the previous\n    // render. If value is not an array, clear this part and make a new\n    // array for ChildParts.\n    if (!isArray(this._$committedValue)) {\n      this._$committedValue = [];\n      this._$clear();\n    }\n\n    // Lets us keep track of how many items we stamped so we can clear leftover\n    // items from a previous render\n    const itemParts = this._$committedValue as ChildPart[];\n    let partIndex = 0;\n    let itemPart: ChildPart | undefined;\n\n    for (const item of value) {\n      if (partIndex === itemParts.length) {\n        // If no existing part, create a new one\n        // TODO (justinfagnani): test perf impact of always creating two parts\n        // instead of sharing parts between nodes\n        // https://github.com/lit/lit/issues/1266\n        itemParts.push(\n          (itemPart = new ChildPart(\n            this._insert(createMarker()),\n            this._insert(createMarker()),\n            this,\n            this.options,\n          )),\n        );\n      } else {\n        // Reuse an existing part\n        itemPart = itemParts[partIndex];\n      }\n      itemPart._$setValue(item);\n      partIndex++;\n    }\n\n    if (partIndex < itemParts.length) {\n      // itemParts always have end nodes\n      this._$clear(\n        itemPart && wrap(itemPart._$endNode!).nextSibling,\n        partIndex,\n      );\n      // Truncate the parts array so _value reflects the current state\n      itemParts.length = partIndex;\n    }\n  }\n\n  /**\n   * Removes the nodes contained within this Part from the DOM.\n   *\n   * @param start Start node to clear from, for clearing a subset of the part's\n   *     DOM (used when truncating iterables)\n   * @param from  When `start` is specified, the index within the iterable from\n   *     which ChildParts are being removed, used for disconnecting directives in\n   *     those Parts.\n   *\n   * @internal\n   */\n  _$clear(\n    start: ChildNode | null = wrap(this._$startNode).nextSibling,\n    from?: number,\n  ) {\n    this._$notifyConnectionChanged?.(false, true, from);\n    while (start && start !== this._$endNode) {\n      const n = wrap(start!).nextSibling;\n      (wrap(start!) as Element).remove();\n      start = n;\n    }\n  }\n  /**\n   * Implementation of RootPart's `isConnected`. Note that this method\n   * should only be called on `RootPart`s (the `ChildPart` returned from a\n   * top-level `render()` call). It has no effect on non-root ChildParts.\n   * @param isConnected Whether to set\n   * @internal\n   */\n  setConnected(isConnected: boolean) {\n    if (this._$parent === undefined) {\n      this.__isConnected = isConnected;\n      this._$notifyConnectionChanged?.(isConnected);\n    } else if (DEV_MODE) {\n      throw new Error(\n        'part.setConnected() may only be called on a ' +\n          'RootPart returned from render().',\n      );\n    }\n  }\n}\n\n/**\n * A top-level `ChildPart` returned from `render` that manages the connected\n * state of `AsyncDirective`s created throughout the tree below it.\n */\nexport interface RootPart extends ChildPart {\n  /**\n   * Sets the connection state for `AsyncDirective`s contained within this root\n   * ChildPart.\n   *\n   * lit-html does not automatically monitor the connectedness of DOM rendered;\n   * as such, it is the responsibility of the caller to `render` to ensure that\n   * `part.setConnected(false)` is called before the part object is potentially\n   * discarded, to ensure that `AsyncDirective`s have a chance to dispose of\n   * any resources being held. If a `RootPart` that was previously\n   * disconnected is subsequently re-connected (and its `AsyncDirective`s should\n   * re-connect), `setConnected(true)` should be called.\n   *\n   * @param isConnected Whether directives within this tree should be connected\n   * or not\n   */\n  setConnected(isConnected: boolean): void;\n}\n\nexport type {AttributePart};\nclass AttributePart implements Disconnectable {\n  readonly type:\n    | typeof ATTRIBUTE_PART\n    | typeof PROPERTY_PART\n    | typeof BOOLEAN_ATTRIBUTE_PART\n    | typeof EVENT_PART = ATTRIBUTE_PART;\n  readonly element: HTMLElement;\n  readonly name: string;\n  readonly options: RenderOptions | undefined;\n\n  /**\n   * If this attribute part represents an interpolation, this contains the\n   * static strings of the interpolation. For single-value, complete bindings,\n   * this is undefined.\n   */\n  readonly strings?: ReadonlyArray<string>;\n  /** @internal */\n  _$committedValue: unknown | Array<unknown> = nothing;\n  /** @internal */\n  __directives?: Array<Directive | undefined>;\n  /** @internal */\n  _$parent: Disconnectable;\n  /** @internal */\n  _$disconnectableChildren?: Set<Disconnectable> = undefined;\n\n  protected _sanitizer: ValueSanitizer | undefined;\n\n  get tagName() {\n    return this.element.tagName;\n  }\n\n  // See comment in Disconnectable interface for why this is a getter\n  get _$isConnected() {\n    return this._$parent._$isConnected;\n  }\n\n  constructor(\n    element: HTMLElement,\n    name: string,\n    strings: ReadonlyArray<string>,\n    parent: Disconnectable,\n    options: RenderOptions | undefined,\n  ) {\n    this.element = element;\n    this.name = name;\n    this._$parent = parent;\n    this.options = options;\n    if (strings.length > 2 || strings[0] !== '' || strings[1] !== '') {\n      this._$committedValue = new Array(strings.length - 1).fill(new String());\n      this.strings = strings;\n    } else {\n      this._$committedValue = nothing;\n    }\n    if (ENABLE_EXTRA_SECURITY_HOOKS) {\n      this._sanitizer = undefined;\n    }\n  }\n\n  /**\n   * Sets the value of this part by resolving the value from possibly multiple\n   * values and static strings and committing it to the DOM.\n   * If this part is single-valued, `this._strings` will be undefined, and the\n   * method will be called with a single value argument. If this part is\n   * multi-value, `this._strings` will be defined, and the method is called\n   * with the value array of the part's owning TemplateInstance, and an offset\n   * into the value array from which the values should be read.\n   * This method is overloaded this way to eliminate short-lived array slices\n   * of the template instance values, and allow a fast-path for single-valued\n   * parts.\n   *\n   * @param value The part value, or an array of values for multi-valued parts\n   * @param valueIndex the index to start reading values from. `undefined` for\n   *   single-valued parts\n   * @param noCommit causes the part to not commit its value to the DOM. Used\n   *   in hydration to prime attribute parts with their first-rendered value,\n   *   but not set the attribute, and in SSR to no-op the DOM operation and\n   *   capture the value for serialization.\n   *\n   * @internal\n   */\n  _$setValue(\n    value: unknown | Array<unknown>,\n    directiveParent: DirectiveParent = this,\n    valueIndex?: number,\n    noCommit?: boolean,\n  ) {\n    const strings = this.strings;\n\n    // Whether any of the values has changed, for dirty-checking\n    let change = false;\n\n    if (strings === undefined) {\n      // Single-value binding case\n      value = resolveDirective(this, value, directiveParent, 0);\n      change =\n        !isPrimitive(value) ||\n        (value !== this._$committedValue && value !== noChange);\n      if (change) {\n        this._$committedValue = value;\n      }\n    } else {\n      // Interpolation case\n      const values = value as Array<unknown>;\n      value = strings[0];\n\n      let i, v;\n      for (i = 0; i < strings.length - 1; i++) {\n        v = resolveDirective(this, values[valueIndex! + i], directiveParent, i);\n\n        if (v === noChange) {\n          // If the user-provided value is `noChange`, use the previous value\n          v = (this._$committedValue as Array<unknown>)[i];\n        }\n        change ||=\n          !isPrimitive(v) || v !== (this._$committedValue as Array<unknown>)[i];\n        if (v === nothing) {\n          value = nothing;\n        } else if (value !== nothing) {\n          value += (v ?? '') + strings[i + 1];\n        }\n        // We always record each value, even if one is `nothing`, for future\n        // change detection.\n        (this._$committedValue as Array<unknown>)[i] = v;\n      }\n    }\n    if (change && !noCommit) {\n      this._commitValue(value);\n    }\n  }\n\n  /** @internal */\n  _commitValue(value: unknown) {\n    if (value === nothing) {\n      (wrap(this.element) as Element).removeAttribute(this.name);\n    } else {\n      if (ENABLE_EXTRA_SECURITY_HOOKS) {\n        if (this._sanitizer === undefined) {\n          this._sanitizer = sanitizerFactoryInternal(\n            this.element,\n            this.name,\n            'attribute',\n          );\n        }\n        value = this._sanitizer(value ?? '');\n      }\n      debugLogEvent &&\n        debugLogEvent({\n          kind: 'commit attribute',\n          element: this.element,\n          name: this.name,\n          value,\n          options: this.options,\n        });\n      (wrap(this.element) as Element).setAttribute(\n        this.name,\n        (value ?? '') as string,\n      );\n    }\n  }\n}\n\nexport type {PropertyPart};\nclass PropertyPart extends AttributePart {\n  override readonly type = PROPERTY_PART;\n\n  /** @internal */\n  override _commitValue(value: unknown) {\n    if (ENABLE_EXTRA_SECURITY_HOOKS) {\n      if (this._sanitizer === undefined) {\n        this._sanitizer = sanitizerFactoryInternal(\n          this.element,\n          this.name,\n          'property',\n        );\n      }\n      value = this._sanitizer(value);\n    }\n    debugLogEvent &&\n      debugLogEvent({\n        kind: 'commit property',\n        element: this.element,\n        name: this.name,\n        value,\n        options: this.options,\n      });\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    (this.element as any)[this.name] = value === nothing ? undefined : value;\n  }\n}\n\nexport type {BooleanAttributePart};\nclass BooleanAttributePart extends AttributePart {\n  override readonly type = BOOLEAN_ATTRIBUTE_PART;\n\n  /** @internal */\n  override _commitValue(value: unknown) {\n    debugLogEvent &&\n      debugLogEvent({\n        kind: 'commit boolean attribute',\n        element: this.element,\n        name: this.name,\n        value: !!(value && value !== nothing),\n        options: this.options,\n      });\n    (wrap(this.element) as Element).toggleAttribute(\n      this.name,\n      !!value && value !== nothing,\n    );\n  }\n}\n\ntype EventListenerWithOptions = EventListenerOrEventListenerObject &\n  Partial<AddEventListenerOptions>;\n\n/**\n * An AttributePart that manages an event listener via add/removeEventListener.\n *\n * This part works by adding itself as the event listener on an element, then\n * delegating to the value passed to it. This reduces the number of calls to\n * add/removeEventListener if the listener changes frequently, such as when an\n * inline function is used as a listener.\n *\n * Because event options are passed when adding listeners, we must take case\n * to add and remove the part as a listener when the event options change.\n */\nexport type {EventPart};\nclass EventPart extends AttributePart {\n  override readonly type = EVENT_PART;\n\n  constructor(\n    element: HTMLElement,\n    name: string,\n    strings: ReadonlyArray<string>,\n    parent: Disconnectable,\n    options: RenderOptions | undefined,\n  ) {\n    super(element, name, strings, parent, options);\n\n    if (DEV_MODE && this.strings !== undefined) {\n      throw new Error(\n        `A \\`<${element.localName}>\\` has a \\`@${name}=...\\` listener with ` +\n          'invalid content. Event listeners in templates must have exactly ' +\n          'one expression and no surrounding text.',\n      );\n    }\n  }\n\n  // EventPart does not use the base _$setValue/_resolveValue implementation\n  // since the dirty checking is more complex\n  /** @internal */\n  override _$setValue(\n    newListener: unknown,\n    directiveParent: DirectiveParent = this,\n  ) {\n    newListener =\n      resolveDirective(this, newListener, directiveParent, 0) ?? nothing;\n    if (newListener === noChange) {\n      return;\n    }\n    const oldListener = this._$committedValue;\n\n    // If the new value is nothing or any options change we have to remove the\n    // part as a listener.\n    const shouldRemoveListener =\n      (newListener === nothing && oldListener !== nothing) ||\n      (newListener as EventListenerWithOptions).capture !==\n        (oldListener as EventListenerWithOptions).capture ||\n      (newListener as EventListenerWithOptions).once !==\n        (oldListener as EventListenerWithOptions).once ||\n      (newListener as EventListenerWithOptions).passive !==\n        (oldListener as EventListenerWithOptions).passive;\n\n    // If the new value is not nothing and we removed the listener, we have\n    // to add the part as a listener.\n    const shouldAddListener =\n      newListener !== nothing &&\n      (oldListener === nothing || shouldRemoveListener);\n\n    debugLogEvent &&\n      debugLogEvent({\n        kind: 'commit event listener',\n        element: this.element,\n        name: this.name,\n        value: newListener,\n        options: this.options,\n        removeListener: shouldRemoveListener,\n        addListener: shouldAddListener,\n        oldListener,\n      });\n    if (shouldRemoveListener) {\n      this.element.removeEventListener(\n        this.name,\n        this,\n        oldListener as EventListenerWithOptions,\n      );\n    }\n    if (shouldAddListener) {\n      // Beware: IE11 and Chrome 41 don't like using the listener as the\n      // options object. Figure out how to deal w/ this in IE11 - maybe\n      // patch addEventListener?\n      this.element.addEventListener(\n        this.name,\n        this,\n        newListener as EventListenerWithOptions,\n      );\n    }\n    this._$committedValue = newListener;\n  }\n\n  handleEvent(event: Event) {\n    if (typeof this._$committedValue === 'function') {\n      this._$committedValue.call(this.options?.host ?? this.element, event);\n    } else {\n      (this._$committedValue as EventListenerObject).handleEvent(event);\n    }\n  }\n}\n\nexport type {ElementPart};\nclass ElementPart implements Disconnectable {\n  readonly type = ELEMENT_PART;\n\n  /** @internal */\n  __directive?: Directive;\n\n  // This is to ensure that every Part has a _$committedValue\n  _$committedValue: undefined;\n\n  /** @internal */\n  _$parent!: Disconnectable;\n\n  /** @internal */\n  _$disconnectableChildren?: Set<Disconnectable> = undefined;\n\n  options: RenderOptions | undefined;\n\n  constructor(\n    public element: Element,\n    parent: Disconnectable,\n    options: RenderOptions | undefined,\n  ) {\n    this._$parent = parent;\n    this.options = options;\n  }\n\n  // See comment in Disconnectable interface for why this is a getter\n  get _$isConnected() {\n    return this._$parent._$isConnected;\n  }\n\n  _$setValue(value: unknown): void {\n    debugLogEvent &&\n      debugLogEvent({\n        kind: 'commit to element binding',\n        element: this.element,\n        value,\n        options: this.options,\n      });\n    resolveDirective(this, value);\n  }\n}\n\n/**\n * END USERS SHOULD NOT RELY ON THIS OBJECT.\n *\n * Private exports for use by other Lit packages, not intended for use by\n * external users.\n *\n * We currently do not make a mangled rollup build of the lit-ssr code. In order\n * to keep a number of (otherwise private) top-level exports mangled in the\n * client side code, we export a _$LH object containing those members (or\n * helper methods for accessing private fields of those members), and then\n * re-export them for use in lit-ssr. This keeps lit-ssr agnostic to whether the\n * client-side code is being used in `dev` mode or `prod` mode.\n *\n * This has a unique name, to disambiguate it from private exports in\n * lit-element, which re-exports all of lit-html.\n *\n * @private\n */\nexport const _$LH = {\n  // Used in lit-ssr\n  _boundAttributeSuffix: boundAttributeSuffix,\n  _marker: marker,\n  _markerMatch: markerMatch,\n  _HTML_RESULT: HTML_RESULT,\n  _getTemplateHtml: getTemplateHtml,\n  // Used in tests and private-ssr-support\n  _TemplateInstance: TemplateInstance,\n  _isIterable: isIterable,\n  _resolveDirective: resolveDirective,\n  _ChildPart: ChildPart,\n  _AttributePart: AttributePart,\n  _BooleanAttributePart: BooleanAttributePart,\n  _EventPart: EventPart,\n  _PropertyPart: PropertyPart,\n  _ElementPart: ElementPart,\n};\n\n// Apply polyfills if available\nconst polyfillSupport = DEV_MODE\n  ? global.litHtmlPolyfillSupportDevMode\n  : global.litHtmlPolyfillSupport;\npolyfillSupport?.(Template, ChildPart);\n\n// IMPORTANT: do not change the property name or the assignment expression.\n// This line will be used in regexes to search for lit-html usage.\n(global.litHtmlVersions ??= []).push('3.2.0');\nif (DEV_MODE && global.litHtmlVersions.length > 1) {\n  issueWarning!(\n    'multiple-versions',\n    `Multiple versions of Lit loaded. ` +\n      `Loading multiple versions is not recommended.`,\n  );\n}\n\n/**\n * Renders a value, usually a lit-html TemplateResult, to the container.\n *\n * This example renders the text \"Hello, Zoe!\" inside a paragraph tag, appending\n * it to the container `document.body`.\n *\n * ```js\n * import {html, render} from 'lit';\n *\n * const name = \"Zoe\";\n * render(html`<p>Hello, ${name}!</p>`, document.body);\n * ```\n *\n * @param value Any [renderable\n *   value](https://lit.dev/docs/templates/expressions/#child-expressions),\n *   typically a {@linkcode TemplateResult} created by evaluating a template tag\n *   like {@linkcode html} or {@linkcode svg}.\n * @param container A DOM container to render to. The first render will append\n *   the rendered value to the container, and subsequent renders will\n *   efficiently update the rendered value if the same result type was\n *   previously rendered there.\n * @param options See {@linkcode RenderOptions} for options documentation.\n * @see\n * {@link https://lit.dev/docs/libraries/standalone-templates/#rendering-lit-html-templates| Rendering Lit HTML Templates}\n */\nexport const render = (\n  value: unknown,\n  container: HTMLElement | DocumentFragment,\n  options?: RenderOptions,\n): RootPart => {\n  if (DEV_MODE && container == null) {\n    // Give a clearer error message than\n    //     Uncaught TypeError: Cannot read properties of null (reading\n    //     '_$litPart$')\n    // which reads like an internal Lit error.\n    throw new TypeError(`The container to render into may not be ${container}`);\n  }\n  const renderId = DEV_MODE ? debugLogRenderId++ : 0;\n  const partOwnerNode = options?.renderBefore ?? container;\n  // This property needs to remain unminified.\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  let part: ChildPart = (partOwnerNode as any)['_$litPart$'];\n  debugLogEvent &&\n    debugLogEvent({\n      kind: 'begin render',\n      id: renderId,\n      value,\n      container,\n      options,\n      part,\n    });\n  if (part === undefined) {\n    const endNode = options?.renderBefore ?? null;\n    // This property needs to remain unminified.\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    (partOwnerNode as any)['_$litPart$'] = part = new ChildPart(\n      container.insertBefore(createMarker(), endNode),\n      endNode,\n      undefined,\n      options ?? {},\n    );\n  }\n  part._$setValue(value);\n  debugLogEvent &&\n    debugLogEvent({\n      kind: 'end render',\n      id: renderId,\n      value,\n      container,\n      options,\n      part,\n    });\n  return part as RootPart;\n};\n\nif (ENABLE_EXTRA_SECURITY_HOOKS) {\n  render.setSanitizer = setSanitizer;\n  render.createSanitizer = createSanitizer;\n  if (DEV_MODE) {\n    render._testOnlyClearSanitizerFactoryDoNotCallOrElse =\n      _testOnlyClearSanitizerFactoryDoNotCallOrElse;\n  }\n}\n","/**\n * @license\n * Copyright 2017 Google LLC\n * SPDX-License-Identifier: BSD-3-Clause\n */\n\n/**\n * The main LitElement module, which defines the {@linkcode LitElement} base\n * class and related APIs.\n *\n * LitElement components can define a template and a set of observed\n * properties. Changing an observed property triggers a re-render of the\n * element.\n *\n * Import {@linkcode LitElement} and {@linkcode html} from this module to\n * create a component:\n *\n *  ```js\n * import {LitElement, html} from 'lit-element';\n *\n * class MyElement extends LitElement {\n *\n *   // Declare observed properties\n *   static get properties() {\n *     return {\n *       adjective: {}\n *     }\n *   }\n *\n *   constructor() {\n *     this.adjective = 'awesome';\n *   }\n *\n *   // Define the element's template\n *   render() {\n *     return html`<p>your ${adjective} template here</p>`;\n *   }\n * }\n *\n * customElements.define('my-element', MyElement);\n * ```\n *\n * `LitElement` extends {@linkcode ReactiveElement} and adds lit-html\n * templating. The `ReactiveElement` class is provided for users that want to\n * build their own custom element base classes that don't use lit-html.\n *\n * @packageDocumentation\n */\nimport {PropertyValues, ReactiveElement} from '@lit/reactive-element';\nimport {render, RenderOptions, noChange, RootPart} from 'lit-html';\nexport * from '@lit/reactive-element';\nexport * from 'lit-html';\n\nimport {LitUnstable} from 'lit-html';\nimport {ReactiveUnstable} from '@lit/reactive-element';\n\n/**\n * Contains types that are part of the unstable debug API.\n *\n * Everything in this API is not stable and may change or be removed in the future,\n * even on patch releases.\n */\n// eslint-disable-next-line @typescript-eslint/no-namespace\nexport namespace Unstable {\n  /**\n   * When Lit is running in dev mode and `window.emitLitDebugLogEvents` is true,\n   * we will emit 'lit-debug' events to window, with live details about the update and render\n   * lifecycle. These can be useful for writing debug tooling and visualizations.\n   *\n   * Please be aware that running with window.emitLitDebugLogEvents has performance overhead,\n   * making certain operations that are normally very cheap (like a no-op render) much slower,\n   * because we must copy data and dispatch events.\n   */\n  // eslint-disable-next-line @typescript-eslint/no-namespace\n  export namespace DebugLog {\n    export type Entry =\n      | LitUnstable.DebugLog.Entry\n      | ReactiveUnstable.DebugLog.Entry;\n  }\n}\n/*\n * When using Closure Compiler, JSCompiler_renameProperty(property, object) is\n * replaced at compile time by the munged name for object[property]. We cannot\n * alias this function, so we have to use a small shim that has the same\n * behavior when not compiling.\n */\n/*@__INLINE__*/\nconst JSCompiler_renameProperty = <P extends PropertyKey>(\n  prop: P,\n  _obj: unknown\n): P => prop;\n\nconst DEV_MODE = true;\n\nlet issueWarning: (code: string, warning: string) => void;\n\nif (DEV_MODE) {\n  // Ensure warnings are issued only 1x, even if multiple versions of Lit\n  // are loaded.\n  const issuedWarnings: Set<string | undefined> =\n    (globalThis.litIssuedWarnings ??= new Set());\n\n  // Issue a warning, if we haven't already.\n  issueWarning = (code: string, warning: string) => {\n    warning += ` See https://lit.dev/msg/${code} for more information.`;\n    if (!issuedWarnings.has(warning)) {\n      console.warn(warning);\n      issuedWarnings.add(warning);\n    }\n  };\n}\n\n/**\n * Base element class that manages element properties and attributes, and\n * renders a lit-html template.\n *\n * To define a component, subclass `LitElement` and implement a\n * `render` method to provide the component's template. Define properties\n * using the {@linkcode LitElement.properties properties} property or the\n * {@linkcode property} decorator.\n */\nexport class LitElement extends ReactiveElement {\n  // This property needs to remain unminified.\n  static ['_$litElement$'] = true;\n\n  /**\n   * @category rendering\n   */\n  readonly renderOptions: RenderOptions = {host: this};\n\n  private __childPart: RootPart | undefined = undefined;\n\n  /**\n   * @category rendering\n   */\n  protected override createRenderRoot() {\n    const renderRoot = super.createRenderRoot();\n    // When adoptedStyleSheets are shimmed, they are inserted into the\n    // shadowRoot by createRenderRoot. Adjust the renderBefore node so that\n    // any styles in Lit content render before adoptedStyleSheets. This is\n    // important so that adoptedStyleSheets have precedence over styles in\n    // the shadowRoot.\n    this.renderOptions.renderBefore ??= renderRoot!.firstChild as ChildNode;\n    return renderRoot;\n  }\n\n  /**\n   * Updates the element. This method reflects property values to attributes\n   * and calls `render` to render DOM via lit-html. Setting properties inside\n   * this method will *not* trigger another update.\n   * @param changedProperties Map of changed properties with old values\n   * @category updates\n   */\n  protected override update(changedProperties: PropertyValues) {\n    // Setting properties in `render` should not trigger an update. Since\n    // updates are allowed after super.update, it's important to call `render`\n    // before that.\n    const value = this.render();\n    if (!this.hasUpdated) {\n      this.renderOptions.isConnected = this.isConnected;\n    }\n    super.update(changedProperties);\n    this.__childPart = render(value, this.renderRoot, this.renderOptions);\n  }\n\n  /**\n   * Invoked when the component is added to the document's DOM.\n   *\n   * In `connectedCallback()` you should setup tasks that should only occur when\n   * the element is connected to the document. The most common of these is\n   * adding event listeners to nodes external to the element, like a keydown\n   * event handler added to the window.\n   *\n   * ```ts\n   * connectedCallback() {\n   *   super.connectedCallback();\n   *   addEventListener('keydown', this._handleKeydown);\n   * }\n   * ```\n   *\n   * Typically, anything done in `connectedCallback()` should be undone when the\n   * element is disconnected, in `disconnectedCallback()`.\n   *\n   * @category lifecycle\n   */\n  override connectedCallback() {\n    super.connectedCallback();\n    this.__childPart?.setConnected(true);\n  }\n\n  /**\n   * Invoked when the component is removed from the document's DOM.\n   *\n   * This callback is the main signal to the element that it may no longer be\n   * used. `disconnectedCallback()` should ensure that nothing is holding a\n   * reference to the element (such as event listeners added to nodes external\n   * to the element), so that it is free to be garbage collected.\n   *\n   * ```ts\n   * disconnectedCallback() {\n   *   super.disconnectedCallback();\n   *   window.removeEventListener('keydown', this._handleKeydown);\n   * }\n   * ```\n   *\n   * An element may be re-connected after being disconnected.\n   *\n   * @category lifecycle\n   */\n  override disconnectedCallback() {\n    super.disconnectedCallback();\n    this.__childPart?.setConnected(false);\n  }\n\n  /**\n   * Invoked on each update to perform rendering tasks. This method may return\n   * any value renderable by lit-html's `ChildPart` - typically a\n   * `TemplateResult`. Setting properties inside this method will *not* trigger\n   * the element to update.\n   * @category rendering\n   */\n  protected render(): unknown {\n    return noChange;\n  }\n}\n\n/**\n * Ensure this class is marked as `finalized` as an optimization ensuring\n * it will not needlessly try to `finalize`.\n *\n * Note this property name is a string to prevent breaking Closure JS Compiler\n * optimizations. See @lit/reactive-element for more information.\n */\n(LitElement as unknown as Record<string, unknown>)[\n  JSCompiler_renameProperty('finalized', LitElement)\n] = true;\n\n// Install hydration if available\nglobalThis.litElementHydrateSupport?.({LitElement});\n\n// Apply polyfills if available\nconst polyfillSupport = DEV_MODE\n  ? globalThis.litElementPolyfillSupportDevMode\n  : globalThis.litElementPolyfillSupport;\npolyfillSupport?.({LitElement});\n\n/**\n * END USERS SHOULD NOT RELY ON THIS OBJECT.\n *\n * Private exports for use by other Lit packages, not intended for use by\n * external users.\n *\n * We currently do not make a mangled rollup build of the lit-ssr code. In order\n * to keep a number of (otherwise private) top-level exports  mangled in the\n * client side code, we export a _$LE object containing those members (or\n * helper methods for accessing private fields of those members), and then\n * re-export them for use in lit-ssr. This keeps lit-ssr agnostic to whether the\n * client-side code is being used in `dev` mode or `prod` mode.\n *\n * This has a unique name, to disambiguate it from private exports in\n * lit-html, since this module re-exports all of lit-html.\n *\n * @private\n */\nexport const _$LE = {\n  _$attributeToProperty: (\n    el: LitElement,\n    name: string,\n    value: string | null\n  ) => {\n    // eslint-disable-next-line\n    (el as any)._$attributeToProperty(name, value);\n  },\n  // eslint-disable-next-line\n  _$changedProperties: (el: LitElement) => (el as any)._$changedProperties,\n};\n\n// IMPORTANT: do not change the property name or the assignment expression.\n// This line will be used in regexes to search for LitElement usage.\n(globalThis.litElementVersions ??= []).push('4.1.0');\nif (DEV_MODE && globalThis.litElementVersions.length > 1) {\n  issueWarning!(\n    'multiple-versions',\n    `Multiple versions of Lit loaded. Loading multiple versions ` +\n      `is not recommended.`\n  );\n}\n","/**\n * @license\n * Copyright 2017 Google LLC\n * SPDX-License-Identifier: BSD-3-Clause\n */\n\n/*\n * IMPORTANT: For compatibility with tsickle and the Closure JS compiler, all\n * property decorators (but not class decorators) in this file that have\n * an @ExportDecoratedItems annotation must be defined as a regular function,\n * not an arrow function.\n */\n\nimport type {Constructor} from './base.js';\n\n/**\n * Allow for custom element classes with private constructors\n */\ntype CustomElementClass = Omit<typeof HTMLElement, 'new'>;\n\nexport type CustomElementDecorator = {\n  // legacy\n  (cls: CustomElementClass): void;\n\n  // standard\n  (\n    target: CustomElementClass,\n    context: ClassDecoratorContext<Constructor<HTMLElement>>\n  ): void;\n};\n\n/**\n * Class decorator factory that defines the decorated class as a custom element.\n *\n * ```js\n * @customElement('my-element')\n * class MyElement extends LitElement {\n *   render() {\n *     return html``;\n *   }\n * }\n * ```\n * @category Decorator\n * @param tagName The tag name of the custom element to define.\n */\nexport const customElement =\n  (tagName: string): CustomElementDecorator =>\n  (\n    classOrTarget: CustomElementClass | Constructor<HTMLElement>,\n    context?: ClassDecoratorContext<Constructor<HTMLElement>>\n  ) => {\n    if (context !== undefined) {\n      context.addInitializer(() => {\n        customElements.define(\n          tagName,\n          classOrTarget as CustomElementConstructor\n        );\n      });\n    } else {\n      customElements.define(tagName, classOrTarget as CustomElementConstructor);\n    }\n  };\n","/**\n * @license\n * Copyright 2017 Google LLC\n * SPDX-License-Identifier: BSD-3-Clause\n */\n\n/*\n * IMPORTANT: For compatibility with tsickle and the Closure JS compiler, all\n * property decorators (but not class decorators) in this file that have\n * an @ExportDecoratedItems annotation must be defined as a regular function,\n * not an arrow function.\n */\n\nimport {\n  type PropertyDeclaration,\n  type ReactiveElement,\n  defaultConverter,\n  notEqual,\n} from '../reactive-element.js';\nimport type {Interface} from './base.js';\n\nconst DEV_MODE = true;\n\nlet issueWarning: (code: string, warning: string) => void;\n\nif (DEV_MODE) {\n  // Ensure warnings are issued only 1x, even if multiple versions of Lit\n  // are loaded.\n  const issuedWarnings: Set<string | undefined> =\n    (globalThis.litIssuedWarnings ??= new Set());\n\n  // Issue a warning, if we haven't already.\n  issueWarning = (code: string, warning: string) => {\n    warning += ` See https://lit.dev/msg/${code} for more information.`;\n    if (!issuedWarnings.has(warning)) {\n      console.warn(warning);\n      issuedWarnings.add(warning);\n    }\n  };\n}\n\n// Overloads for property decorator so that TypeScript can infer the correct\n// return type when a decorator is used as an accessor decorator or a setter\n// decorator.\nexport type PropertyDecorator = {\n  // accessor decorator signature\n  <C extends Interface<ReactiveElement>, V>(\n    target: ClassAccessorDecoratorTarget<C, V>,\n    context: ClassAccessorDecoratorContext<C, V>\n  ): ClassAccessorDecoratorResult<C, V>;\n\n  // setter decorator signature\n  <C extends Interface<ReactiveElement>, V>(\n    target: (value: V) => void,\n    context: ClassSetterDecoratorContext<C, V>\n  ): (this: C, value: V) => void;\n\n  // legacy decorator signature\n  (\n    protoOrDescriptor: Object,\n    name: PropertyKey,\n    descriptor?: PropertyDescriptor\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  ): any;\n};\n\nconst legacyProperty = (\n  options: PropertyDeclaration | undefined,\n  proto: Object,\n  name: PropertyKey\n) => {\n  const hasOwnProperty = proto.hasOwnProperty(name);\n  (proto.constructor as typeof ReactiveElement).createProperty(\n    name,\n    hasOwnProperty ? {...options, wrapped: true} : options\n  );\n  // For accessors (which have a descriptor on the prototype) we need to\n  // return a descriptor, otherwise TypeScript overwrites the descriptor we\n  // define in createProperty() with the original descriptor. We don't do this\n  // for fields, which don't have a descriptor, because this could overwrite\n  // descriptor defined by other decorators.\n  return hasOwnProperty\n    ? Object.getOwnPropertyDescriptor(proto, name)\n    : undefined;\n};\n\n// This is duplicated from a similar variable in reactive-element.ts, but\n// actually makes sense to have this default defined with the decorator, so\n// that different decorators could have different defaults.\nconst defaultPropertyDeclaration: PropertyDeclaration = {\n  attribute: true,\n  type: String,\n  converter: defaultConverter,\n  reflect: false,\n  hasChanged: notEqual,\n};\n\n// Temporary type, until google3 is on TypeScript 5.2\ntype StandardPropertyContext<C, V> = (\n  | ClassAccessorDecoratorContext<C, V>\n  | ClassSetterDecoratorContext<C, V>\n) & {metadata: object};\n\n/**\n * Wraps a class accessor or setter so that `requestUpdate()` is called with the\n * property name and old value when the accessor is set.\n */\nexport const standardProperty = <C extends Interface<ReactiveElement>, V>(\n  options: PropertyDeclaration = defaultPropertyDeclaration,\n  target: ClassAccessorDecoratorTarget<C, V> | ((value: V) => void),\n  context: StandardPropertyContext<C, V>\n): ClassAccessorDecoratorResult<C, V> | ((this: C, value: V) => void) => {\n  const {kind, metadata} = context;\n\n  if (DEV_MODE && metadata == null) {\n    issueWarning(\n      'missing-class-metadata',\n      `The class ${target} is missing decorator metadata. This ` +\n        `could mean that you're using a compiler that supports decorators ` +\n        `but doesn't support decorator metadata, such as TypeScript 5.1. ` +\n        `Please update your compiler.`\n    );\n  }\n\n  // Store the property options\n  let properties = globalThis.litPropertyMetadata.get(metadata);\n  if (properties === undefined) {\n    globalThis.litPropertyMetadata.set(metadata, (properties = new Map()));\n  }\n  properties.set(context.name, options);\n\n  if (kind === 'accessor') {\n    // Standard decorators cannot dynamically modify the class, so we can't\n    // replace a field with accessors. The user must use the new `accessor`\n    // keyword instead.\n    const {name} = context;\n    return {\n      set(this: ReactiveElement, v: V) {\n        const oldValue = (\n          target as ClassAccessorDecoratorTarget<C, V>\n        ).get.call(this as unknown as C);\n        (target as ClassAccessorDecoratorTarget<C, V>).set.call(\n          this as unknown as C,\n          v\n        );\n        this.requestUpdate(name, oldValue, options);\n      },\n      init(this: ReactiveElement, v: V): V {\n        if (v !== undefined) {\n          this._$changeProperty(name, undefined, options);\n        }\n        return v;\n      },\n    } as unknown as ClassAccessorDecoratorResult<C, V>;\n  } else if (kind === 'setter') {\n    const {name} = context;\n    return function (this: ReactiveElement, value: V) {\n      const oldValue = this[name as keyof ReactiveElement];\n      (target as (value: V) => void).call(this, value);\n      this.requestUpdate(name, oldValue, options);\n    } as unknown as (this: C, value: V) => void;\n  }\n  throw new Error(`Unsupported decorator location: ${kind}`);\n};\n\n/**\n * A class field or accessor decorator which creates a reactive property that\n * reflects a corresponding attribute value. When a decorated property is set\n * the element will update and render. A {@linkcode PropertyDeclaration} may\n * optionally be supplied to configure property features.\n *\n * This decorator should only be used for public fields. As public fields,\n * properties should be considered as primarily settable by element users,\n * either via attribute or the property itself.\n *\n * Generally, properties that are changed by the element should be private or\n * protected fields and should use the {@linkcode state} decorator.\n *\n * However, sometimes element code does need to set a public property. This\n * should typically only be done in response to user interaction, and an event\n * should be fired informing the user; for example, a checkbox sets its\n * `checked` property when clicked and fires a `changed` event. Mutating public\n * properties should typically not be done for non-primitive (object or array)\n * properties. In other cases when an element needs to manage state, a private\n * property decorated via the {@linkcode state} decorator should be used. When\n * needed, state properties can be initialized via public properties to\n * facilitate complex interactions.\n *\n * ```ts\n * class MyElement {\n *   @property({ type: Boolean })\n *   clicked = false;\n * }\n * ```\n * @category Decorator\n * @ExportDecoratedItems\n */\nexport function property(options?: PropertyDeclaration): PropertyDecorator {\n  return <C extends Interface<ReactiveElement>, V>(\n    protoOrTarget:\n      | object\n      | ClassAccessorDecoratorTarget<C, V>\n      | ((value: V) => void),\n    nameOrContext:\n      | PropertyKey\n      | ClassAccessorDecoratorContext<C, V>\n      | ClassSetterDecoratorContext<C, V>\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  ): any => {\n    return (\n      typeof nameOrContext === 'object'\n        ? standardProperty<C, V>(\n            options,\n            protoOrTarget as\n              | ClassAccessorDecoratorTarget<C, V>\n              | ((value: V) => void),\n            nameOrContext as StandardPropertyContext<C, V>\n          )\n        : legacyProperty(\n            options,\n            protoOrTarget as Object,\n            nameOrContext as PropertyKey\n          )\n    ) as PropertyDecorator;\n  };\n}\n","/**\n * @license\n * Copyright 2020 Google LLC\n * SPDX-License-Identifier: BSD-3-Clause\n */\n\nimport {\n  _$LH,\n  Part,\n  DirectiveParent,\n  CompiledTemplateResult,\n  MaybeCompiledTemplateResult,\n  UncompiledTemplateResult,\n} from './lit-html.js';\nimport {\n  DirectiveResult,\n  DirectiveClass,\n  PartInfo,\n  AttributePartInfo,\n} from './directive.js';\ntype Primitive = null | undefined | boolean | number | string | symbol | bigint;\n\nconst {_ChildPart: ChildPart} = _$LH;\n\ntype ChildPart = InstanceType<typeof ChildPart>;\n\nconst ENABLE_SHADYDOM_NOPATCH = true;\n\nconst wrap =\n  ENABLE_SHADYDOM_NOPATCH &&\n  window.ShadyDOM?.inUse &&\n  window.ShadyDOM?.noPatch === true\n    ? window.ShadyDOM!.wrap\n    : (node: Node) => node;\n\n/**\n * Tests if a value is a primitive value.\n *\n * See https://tc39.github.io/ecma262/#sec-typeof-operator\n */\nexport const isPrimitive = (value: unknown): value is Primitive =>\n  value === null || (typeof value != 'object' && typeof value != 'function');\n\nexport const TemplateResultType = {\n  HTML: 1,\n  SVG: 2,\n  MATHML: 3,\n} as const;\n\nexport type TemplateResultType =\n  (typeof TemplateResultType)[keyof typeof TemplateResultType];\n\ntype IsTemplateResult = {\n  (val: unknown): val is MaybeCompiledTemplateResult;\n  <T extends TemplateResultType>(\n    val: unknown,\n    type: T,\n  ): val is UncompiledTemplateResult<T>;\n};\n\n/**\n * Tests if a value is a TemplateResult or a CompiledTemplateResult.\n */\nexport const isTemplateResult: IsTemplateResult = (\n  value: unknown,\n  type?: TemplateResultType,\n): value is UncompiledTemplateResult =>\n  type === undefined\n    ? // This property needs to remain unminified.\n      (value as UncompiledTemplateResult)?.['_$litType$'] !== undefined\n    : (value as UncompiledTemplateResult)?.['_$litType$'] === type;\n\n/**\n * Tests if a value is a CompiledTemplateResult.\n */\nexport const isCompiledTemplateResult = (\n  value: unknown,\n): value is CompiledTemplateResult => {\n  return (value as CompiledTemplateResult)?.['_$litType$']?.h != null;\n};\n\n/**\n * Tests if a value is a DirectiveResult.\n */\nexport const isDirectiveResult = (value: unknown): value is DirectiveResult =>\n  // This property needs to remain unminified.\n  (value as DirectiveResult)?.['_$litDirective$'] !== undefined;\n\n/**\n * Retrieves the Directive class for a DirectiveResult\n */\nexport const getDirectiveClass = (value: unknown): DirectiveClass | undefined =>\n  // This property needs to remain unminified.\n  (value as DirectiveResult)?.['_$litDirective$'];\n\n/**\n * Tests whether a part has only a single-expression with no strings to\n * interpolate between.\n *\n * Only AttributePart and PropertyPart can have multiple expressions.\n * Multi-expression parts have a `strings` property and single-expression\n * parts do not.\n */\nexport const isSingleExpression = (part: PartInfo) =>\n  (part as AttributePartInfo).strings === undefined;\n\nconst createMarker = () => document.createComment('');\n\n/**\n * Inserts a ChildPart into the given container ChildPart's DOM, either at the\n * end of the container ChildPart, or before the optional `refPart`.\n *\n * This does not add the part to the containerPart's committed value. That must\n * be done by callers.\n *\n * @param containerPart Part within which to add the new ChildPart\n * @param refPart Part before which to add the new ChildPart; when omitted the\n *     part added to the end of the `containerPart`\n * @param part Part to insert, or undefined to create a new part\n */\nexport const insertPart = (\n  containerPart: ChildPart,\n  refPart?: ChildPart,\n  part?: ChildPart,\n): ChildPart => {\n  const container = wrap(containerPart._$startNode).parentNode!;\n\n  const refNode =\n    refPart === undefined ? containerPart._$endNode : refPart._$startNode;\n\n  if (part === undefined) {\n    const startNode = wrap(container).insertBefore(createMarker(), refNode);\n    const endNode = wrap(container).insertBefore(createMarker(), refNode);\n    part = new ChildPart(\n      startNode,\n      endNode,\n      containerPart,\n      containerPart.options,\n    );\n  } else {\n    const endNode = wrap(part._$endNode!).nextSibling;\n    const oldParent = part._$parent;\n    const parentChanged = oldParent !== containerPart;\n    if (parentChanged) {\n      part._$reparentDisconnectables?.(containerPart);\n      // Note that although `_$reparentDisconnectables` updates the part's\n      // `_$parent` reference after unlinking from its current parent, that\n      // method only exists if Disconnectables are present, so we need to\n      // unconditionally set it here\n      part._$parent = containerPart;\n      // Since the _$isConnected getter is somewhat costly, only\n      // read it once we know the subtree has directives that need\n      // to be notified\n      let newConnectionState;\n      if (\n        part._$notifyConnectionChanged !== undefined &&\n        (newConnectionState = containerPart._$isConnected) !==\n          oldParent!._$isConnected\n      ) {\n        part._$notifyConnectionChanged(newConnectionState);\n      }\n    }\n    if (endNode !== refNode || parentChanged) {\n      let start: Node | null = part._$startNode;\n      while (start !== endNode) {\n        const n: Node | null = wrap(start!).nextSibling;\n        wrap(container).insertBefore(start!, refNode);\n        start = n;\n      }\n    }\n  }\n\n  return part;\n};\n\n/**\n * Sets the value of a Part.\n *\n * Note that this should only be used to set/update the value of user-created\n * parts (i.e. those created using `insertPart`); it should not be used\n * by directives to set the value of the directive's container part. Directives\n * should return a value from `update`/`render` to update their part state.\n *\n * For directives that require setting their part value asynchronously, they\n * should extend `AsyncDirective` and call `this.setValue()`.\n *\n * @param part Part to set\n * @param value Value to set\n * @param index For `AttributePart`s, the index to set\n * @param directiveParent Used internally; should not be set by user\n */\nexport const setChildPartValue = <T extends ChildPart>(\n  part: T,\n  value: unknown,\n  directiveParent: DirectiveParent = part,\n): T => {\n  part._$setValue(value, directiveParent);\n  return part;\n};\n\n// A sentinel value that can never appear as a part value except when set by\n// live(). Used to force a dirty-check to fail and cause a re-render.\nconst RESET_VALUE = {};\n\n/**\n * Sets the committed value of a ChildPart directly without triggering the\n * commit stage of the part.\n *\n * This is useful in cases where a directive needs to update the part such\n * that the next update detects a value change or not. When value is omitted,\n * the next update will be guaranteed to be detected as a change.\n *\n * @param part\n * @param value\n */\nexport const setCommittedValue = (part: Part, value: unknown = RESET_VALUE) =>\n  (part._$committedValue = value);\n\n/**\n * Returns the committed value of a ChildPart.\n *\n * The committed value is used for change detection and efficient updates of\n * the part. It can differ from the value set by the template or directive in\n * cases where the template value is transformed before being committed.\n *\n * - `TemplateResult`s are committed as a `TemplateInstance`\n * - Iterables are committed as `Array<ChildPart>`\n * - All other types are committed as the template value or value returned or\n *   set by a directive.\n *\n * @param part\n */\nexport const getCommittedValue = (part: ChildPart) => part._$committedValue;\n\n/**\n * Removes a ChildPart from the DOM, including any of its content.\n *\n * @param part The Part to remove\n */\nexport const removePart = (part: ChildPart) => {\n  part._$notifyConnectionChanged?.(false, true);\n  let start: ChildNode | null = part._$startNode;\n  const end: ChildNode | null = wrap(part._$endNode!).nextSibling;\n  while (start !== end) {\n    const n: ChildNode | null = wrap(start!).nextSibling;\n    (wrap(start!) as ChildNode).remove();\n    start = n;\n  }\n};\n\nexport const clearPart = (part: ChildPart) => {\n  part._$clear();\n};\n","/**\n * @license\n * Copyright 2017 Google LLC\n * SPDX-License-Identifier: BSD-3-Clause\n */\n\nimport {Disconnectable, Part} from './lit-html.js';\n\nexport {\n  AttributePart,\n  BooleanAttributePart,\n  ChildPart,\n  ElementPart,\n  EventPart,\n  Part,\n  PropertyPart,\n} from './lit-html.js';\n\nexport interface DirectiveClass {\n  new (part: PartInfo): Directive;\n}\n\n/**\n * This utility type extracts the signature of a directive class's render()\n * method so we can use it for the type of the generated directive function.\n */\nexport type DirectiveParameters<C extends Directive> = Parameters<C['render']>;\n\n/**\n * A generated directive function doesn't evaluate the directive, but just\n * returns a DirectiveResult object that captures the arguments.\n */\nexport interface DirectiveResult<C extends DirectiveClass = DirectiveClass> {\n  /**\n   * This property needs to remain unminified.\n   * @internal\n   */\n  ['_$litDirective$']: C;\n  /** @internal */\n  values: DirectiveParameters<InstanceType<C>>;\n}\n\nexport const PartType = {\n  ATTRIBUTE: 1,\n  CHILD: 2,\n  PROPERTY: 3,\n  BOOLEAN_ATTRIBUTE: 4,\n  EVENT: 5,\n  ELEMENT: 6,\n} as const;\n\nexport type PartType = (typeof PartType)[keyof typeof PartType];\n\nexport interface ChildPartInfo {\n  readonly type: typeof PartType.CHILD;\n}\n\nexport interface AttributePartInfo {\n  readonly type:\n    | typeof PartType.ATTRIBUTE\n    | typeof PartType.PROPERTY\n    | typeof PartType.BOOLEAN_ATTRIBUTE\n    | typeof PartType.EVENT;\n  readonly strings?: ReadonlyArray<string>;\n  readonly name: string;\n  readonly tagName: string;\n}\n\nexport interface ElementPartInfo {\n  readonly type: typeof PartType.ELEMENT;\n}\n\n/**\n * Information about the part a directive is bound to.\n *\n * This is useful for checking that a directive is attached to a valid part,\n * such as with directive that can only be used on attribute bindings.\n */\nexport type PartInfo = ChildPartInfo | AttributePartInfo | ElementPartInfo;\n\n/**\n * Creates a user-facing directive function from a Directive class. This\n * function has the same parameters as the directive's render() method.\n */\nexport const directive =\n  <C extends DirectiveClass>(c: C) =>\n  (...values: DirectiveParameters<InstanceType<C>>): DirectiveResult<C> => ({\n    // This property needs to remain unminified.\n    ['_$litDirective$']: c,\n    values,\n  });\n\n/**\n * Base class for creating custom directives. Users should extend this class,\n * implement `render` and/or `update`, and then pass their subclass to\n * `directive`.\n */\nexport abstract class Directive implements Disconnectable {\n  //@internal\n  __part!: Part;\n  //@internal\n  __attributeIndex: number | undefined;\n  //@internal\n  __directive?: Directive;\n\n  //@internal\n  _$parent!: Disconnectable;\n\n  // These will only exist on the AsyncDirective subclass\n  //@internal\n  _$disconnectableChildren?: Set<Disconnectable>;\n  // This property needs to remain unminified.\n  //@internal\n  ['_$notifyDirectiveConnectionChanged']?(isConnected: boolean): void;\n\n  constructor(_partInfo: PartInfo) {}\n\n  // See comment in Disconnectable interface for why this is a getter\n  get _$isConnected() {\n    return this._$parent._$isConnected;\n  }\n\n  /** @internal */\n  _$initialize(\n    part: Part,\n    parent: Disconnectable,\n    attributeIndex: number | undefined,\n  ) {\n    this.__part = part;\n    this._$parent = parent;\n    this.__attributeIndex = attributeIndex;\n  }\n  /** @internal */\n  _$resolve(part: Part, props: Array<unknown>): unknown {\n    return this.update(part, props);\n  }\n\n  abstract render(...props: Array<unknown>): unknown;\n\n  update(_part: Part, props: Array<unknown>): unknown {\n    return this.render(...props);\n  }\n}\n","/**\n * @license\n * Copyright 2017 Google LLC\n * SPDX-License-Identifier: BSD-3-Clause\n */\n\n/**\n * Overview:\n *\n * This module is designed to add support for an async `setValue` API and\n * `disconnected` callback to directives with the least impact on the core\n * runtime or payload when that feature is not used.\n *\n * The strategy is to introduce a `AsyncDirective` subclass of\n * `Directive` that climbs the \"parent\" tree in its constructor to note which\n * branches of lit-html's \"logical tree\" of data structures contain such\n * directives and thus need to be crawled when a subtree is being cleared (or\n * manually disconnected) in order to run the `disconnected` callback.\n *\n * The \"nodes\" of the logical tree include Parts, TemplateInstances (for when a\n * TemplateResult is committed to a value of a ChildPart), and Directives; these\n * all implement a common interface called `DisconnectableChild`. Each has a\n * `_$parent` reference which is set during construction in the core code, and a\n * `_$disconnectableChildren` field which is initially undefined.\n *\n * The sparse tree created by means of the `AsyncDirective` constructor\n * crawling up the `_$parent` tree and placing a `_$disconnectableChildren` Set\n * on each parent that includes each child that contains a\n * `AsyncDirective` directly or transitively via its children. In order to\n * notify connection state changes and disconnect (or reconnect) a tree, the\n * `_$notifyConnectionChanged` API is patched onto ChildParts as a directive\n * climbs the parent tree, which is called by the core when clearing a part if\n * it exists. When called, that method iterates over the sparse tree of\n * Set<DisconnectableChildren> built up by AsyncDirectives, and calls\n * `_$notifyDirectiveConnectionChanged` on any directives that are encountered\n * in that tree, running the required callbacks.\n *\n * A given \"logical tree\" of lit-html data-structures might look like this:\n *\n *  ChildPart(N1) _$dC=[D2,T3]\n *   ._directive\n *     AsyncDirective(D2)\n *   ._value // user value was TemplateResult\n *     TemplateInstance(T3) _$dC=[A4,A6,N10,N12]\n *      ._$parts[]\n *        AttributePart(A4) _$dC=[D5]\n *         ._directives[]\n *           AsyncDirective(D5)\n *        AttributePart(A6) _$dC=[D7,D8]\n *         ._directives[]\n *           AsyncDirective(D7)\n *           Directive(D8) _$dC=[D9]\n *            ._directive\n *              AsyncDirective(D9)\n *        ChildPart(N10) _$dC=[D11]\n *         ._directive\n *           AsyncDirective(D11)\n *         ._value\n *           string\n *        ChildPart(N12) _$dC=[D13,N14,N16]\n *         ._directive\n *           AsyncDirective(D13)\n *         ._value // user value was iterable\n *           Array<ChildPart>\n *             ChildPart(N14) _$dC=[D15]\n *              ._value\n *                string\n *             ChildPart(N16) _$dC=[D17,T18]\n *              ._directive\n *                AsyncDirective(D17)\n *              ._value // user value was TemplateResult\n *                TemplateInstance(T18) _$dC=[A19,A21,N25]\n *                 ._$parts[]\n *                   AttributePart(A19) _$dC=[D20]\n *                    ._directives[]\n *                      AsyncDirective(D20)\n *                   AttributePart(A21) _$dC=[22,23]\n *                    ._directives[]\n *                      AsyncDirective(D22)\n *                      Directive(D23) _$dC=[D24]\n *                       ._directive\n *                         AsyncDirective(D24)\n *                   ChildPart(N25) _$dC=[D26]\n *                    ._directive\n *                      AsyncDirective(D26)\n *                    ._value\n *                      string\n *\n * Example 1: The directive in ChildPart(N12) updates and returns `nothing`. The\n * ChildPart will _clear() itself, and so we need to disconnect the \"value\" of\n * the ChildPart (but not its directive). In this case, when `_clear()` calls\n * `_$notifyConnectionChanged()`, we don't iterate all of the\n * _$disconnectableChildren, rather we do a value-specific disconnection: i.e.\n * since the _value was an Array<ChildPart> (because an iterable had been\n * committed), we iterate the array of ChildParts (N14, N16) and run\n * `setConnected` on them (which does recurse down the full tree of\n * `_$disconnectableChildren` below it, and also removes N14 and N16 from N12's\n * `_$disconnectableChildren`). Once the values have been disconnected, we then\n * check whether the ChildPart(N12)'s list of `_$disconnectableChildren` is empty\n * (and would remove it from its parent TemplateInstance(T3) if so), but since\n * it would still contain its directive D13, it stays in the disconnectable\n * tree.\n *\n * Example 2: In the course of Example 1, `setConnected` will reach\n * ChildPart(N16); in this case the entire part is being disconnected, so we\n * simply iterate all of N16's `_$disconnectableChildren` (D17,T18) and\n * recursively run `setConnected` on them. Note that we only remove children\n * from `_$disconnectableChildren` for the top-level values being disconnected\n * on a clear; doing this bookkeeping lower in the tree is wasteful since it's\n * all being thrown away.\n *\n * Example 3: If the LitElement containing the entire tree above becomes\n * disconnected, it will run `childPart.setConnected()` (which calls\n * `childPart._$notifyConnectionChanged()` if it exists); in this case, we\n * recursively run `setConnected()` over the entire tree, without removing any\n * children from `_$disconnectableChildren`, since this tree is required to\n * re-connect the tree, which does the same operation, simply passing\n * `isConnected: true` down the tree, signaling which callback to run.\n */\n\nimport {AttributePart, ChildPart, Disconnectable, Part} from './lit-html.js';\nimport {isSingleExpression} from './directive-helpers.js';\nimport {Directive, PartInfo, PartType} from './directive.js';\nexport * from './directive.js';\n\nconst DEV_MODE = true;\n\n/**\n * Recursively walks down the tree of Parts/TemplateInstances/Directives to set\n * the connected state of directives and run `disconnected`/ `reconnected`\n * callbacks.\n *\n * @return True if there were children to disconnect; false otherwise\n */\nconst notifyChildrenConnectedChanged = (\n  parent: Disconnectable,\n  isConnected: boolean,\n): boolean => {\n  const children = parent._$disconnectableChildren;\n  if (children === undefined) {\n    return false;\n  }\n  for (const obj of children) {\n    // The existence of `_$notifyDirectiveConnectionChanged` is used as a \"brand\" to\n    // disambiguate AsyncDirectives from other DisconnectableChildren\n    // (as opposed to using an instanceof check to know when to call it); the\n    // redundancy of \"Directive\" in the API name is to avoid conflicting with\n    // `_$notifyConnectionChanged`, which exists `ChildParts` which are also in\n    // this list\n    // Disconnect Directive (and any nested directives contained within)\n    // This property needs to remain unminified.\n    (obj as AsyncDirective)['_$notifyDirectiveConnectionChanged']?.(\n      isConnected,\n      false,\n    );\n    // Disconnect Part/TemplateInstance\n    notifyChildrenConnectedChanged(obj, isConnected);\n  }\n  return true;\n};\n\n/**\n * Removes the given child from its parent list of disconnectable children, and\n * if the parent list becomes empty as a result, removes the parent from its\n * parent, and so forth up the tree when that causes subsequent parent lists to\n * become empty.\n */\nconst removeDisconnectableFromParent = (obj: Disconnectable) => {\n  let parent, children;\n  do {\n    if ((parent = obj._$parent) === undefined) {\n      break;\n    }\n    children = parent._$disconnectableChildren!;\n    children.delete(obj);\n    obj = parent;\n  } while (children?.size === 0);\n};\n\nconst addDisconnectableToParent = (obj: Disconnectable) => {\n  // Climb the parent tree, creating a sparse tree of children needing\n  // disconnection\n  for (let parent; (parent = obj._$parent); obj = parent) {\n    let children = parent._$disconnectableChildren;\n    if (children === undefined) {\n      parent._$disconnectableChildren = children = new Set();\n    } else if (children.has(obj)) {\n      // Once we've reached a parent that already contains this child, we\n      // can short-circuit\n      break;\n    }\n    children.add(obj);\n    installDisconnectAPI(parent);\n  }\n};\n\n/**\n * Changes the parent reference of the ChildPart, and updates the sparse tree of\n * Disconnectable children accordingly.\n *\n * Note, this method will be patched onto ChildPart instances and called from\n * the core code when parts are moved between different parents.\n */\nfunction reparentDisconnectables(this: ChildPart, newParent: Disconnectable) {\n  if (this._$disconnectableChildren !== undefined) {\n    removeDisconnectableFromParent(this);\n    this._$parent = newParent;\n    addDisconnectableToParent(this);\n  } else {\n    this._$parent = newParent;\n  }\n}\n\n/**\n * Sets the connected state on any directives contained within the committed\n * value of this part (i.e. within a TemplateInstance or iterable of\n * ChildParts) and runs their `disconnected`/`reconnected`s, as well as within\n * any directives stored on the ChildPart (when `valueOnly` is false).\n *\n * `isClearingValue` should be passed as `true` on a top-level part that is\n * clearing itself, and not as a result of recursively disconnecting directives\n * as part of a `clear` operation higher up the tree. This both ensures that any\n * directive on this ChildPart that produced a value that caused the clear\n * operation is not disconnected, and also serves as a performance optimization\n * to avoid needless bookkeeping when a subtree is going away; when clearing a\n * subtree, only the top-most part need to remove itself from the parent.\n *\n * `fromPartIndex` is passed only in the case of a partial `_clear` running as a\n * result of truncating an iterable.\n *\n * Note, this method will be patched onto ChildPart instances and called from the\n * core code when parts are cleared or the connection state is changed by the\n * user.\n */\nfunction notifyChildPartConnectedChanged(\n  this: ChildPart,\n  isConnected: boolean,\n  isClearingValue = false,\n  fromPartIndex = 0,\n) {\n  const value = this._$committedValue;\n  const children = this._$disconnectableChildren;\n  if (children === undefined || children.size === 0) {\n    return;\n  }\n  if (isClearingValue) {\n    if (Array.isArray(value)) {\n      // Iterable case: Any ChildParts created by the iterable should be\n      // disconnected and removed from this ChildPart's disconnectable\n      // children (starting at `fromPartIndex` in the case of truncation)\n      for (let i = fromPartIndex; i < value.length; i++) {\n        notifyChildrenConnectedChanged(value[i], false);\n        removeDisconnectableFromParent(value[i]);\n      }\n    } else if (value != null) {\n      // TemplateInstance case: If the value has disconnectable children (will\n      // only be in the case that it is a TemplateInstance), we disconnect it\n      // and remove it from this ChildPart's disconnectable children\n      notifyChildrenConnectedChanged(value as Disconnectable, false);\n      removeDisconnectableFromParent(value as Disconnectable);\n    }\n  } else {\n    notifyChildrenConnectedChanged(this, isConnected);\n  }\n}\n\n/**\n * Patches disconnection API onto ChildParts.\n */\nconst installDisconnectAPI = (obj: Disconnectable) => {\n  if ((obj as ChildPart).type == PartType.CHILD) {\n    (obj as ChildPart)._$notifyConnectionChanged ??=\n      notifyChildPartConnectedChanged;\n    (obj as ChildPart)._$reparentDisconnectables ??= reparentDisconnectables;\n  }\n};\n\n/**\n * An abstract `Directive` base class whose `disconnected` method will be\n * called when the part containing the directive is cleared as a result of\n * re-rendering, or when the user calls `part.setConnected(false)` on\n * a part that was previously rendered containing the directive (as happens\n * when e.g. a LitElement disconnects from the DOM).\n *\n * If `part.setConnected(true)` is subsequently called on a\n * containing part, the directive's `reconnected` method will be called prior\n * to its next `update`/`render` callbacks. When implementing `disconnected`,\n * `reconnected` should also be implemented to be compatible with reconnection.\n *\n * Note that updates may occur while the directive is disconnected. As such,\n * directives should generally check the `this.isConnected` flag during\n * render/update to determine whether it is safe to subscribe to resources\n * that may prevent garbage collection.\n */\nexport abstract class AsyncDirective extends Directive {\n  // As opposed to other Disconnectables, AsyncDirectives always get notified\n  // when the RootPart connection changes, so the public `isConnected`\n  // is a locally stored variable initialized via its part's getter and synced\n  // via `_$notifyDirectiveConnectionChanged`. This is cheaper than using\n  // the _$isConnected getter, which has to look back up the tree each time.\n  /**\n   * The connection state for this Directive.\n   */\n  isConnected!: boolean;\n\n  // @internal\n  override _$disconnectableChildren?: Set<Disconnectable> = undefined;\n  /**\n   * Initialize the part with internal fields\n   * @param part\n   * @param parent\n   * @param attributeIndex\n   */\n  override _$initialize(\n    part: Part,\n    parent: Disconnectable,\n    attributeIndex: number | undefined,\n  ) {\n    super._$initialize(part, parent, attributeIndex);\n    addDisconnectableToParent(this);\n    this.isConnected = part._$isConnected;\n  }\n  // This property needs to remain unminified.\n  /**\n   * Called from the core code when a directive is going away from a part (in\n   * which case `shouldRemoveFromParent` should be true), and from the\n   * `setChildrenConnected` helper function when recursively changing the\n   * connection state of a tree (in which case `shouldRemoveFromParent` should\n   * be false).\n   *\n   * @param isConnected\n   * @param isClearingDirective - True when the directive itself is being\n   *     removed; false when the tree is being disconnected\n   * @internal\n   */\n  override ['_$notifyDirectiveConnectionChanged'](\n    isConnected: boolean,\n    isClearingDirective = true,\n  ) {\n    if (isConnected !== this.isConnected) {\n      this.isConnected = isConnected;\n      if (isConnected) {\n        this.reconnected?.();\n      } else {\n        this.disconnected?.();\n      }\n    }\n    if (isClearingDirective) {\n      notifyChildrenConnectedChanged(this, isConnected);\n      removeDisconnectableFromParent(this);\n    }\n  }\n\n  /**\n   * Sets the value of the directive's Part outside the normal `update`/`render`\n   * lifecycle of a directive.\n   *\n   * This method should not be called synchronously from a directive's `update`\n   * or `render`.\n   *\n   * @param directive The directive to update\n   * @param value The value to set\n   */\n  setValue(value: unknown) {\n    if (isSingleExpression(this.__part as unknown as PartInfo)) {\n      this.__part._$setValue(value, this);\n    } else {\n      // this.__attributeIndex will be defined in this case, but\n      // assert it in dev mode\n      if (DEV_MODE && this.__attributeIndex === undefined) {\n        throw new Error(`Expected this.__attributeIndex to be a number`);\n      }\n      const newValues = [...(this.__part._$committedValue as Array<unknown>)];\n      newValues[this.__attributeIndex!] = value;\n      (this.__part as AttributePart)._$setValue(newValues, this, 0);\n    }\n  }\n\n  /**\n   * User callbacks for implementing logic to release any resources/subscriptions\n   * that may have been retained by this directive. Since directives may also be\n   * re-connected, `reconnected` should also be implemented to restore the\n   * working state of the directive prior to the next render.\n   */\n  protected disconnected() {}\n  protected reconnected() {}\n}\n","/**\n * @license\n * Copyright 2020 Google LLC\n * SPDX-License-Identifier: BSD-3-Clause\n */\nimport {nothing, ElementPart} from '../lit-html.js';\nimport {directive, AsyncDirective} from '../async-directive.js';\n\n/**\n * Creates a new Ref object, which is container for a reference to an element.\n */\nexport const createRef = <T = Element>() => new Ref<T>();\n\n/**\n * An object that holds a ref value.\n */\nclass Ref<T = Element> {\n  /**\n   * The current Element value of the ref, or else `undefined` if the ref is no\n   * longer rendered.\n   */\n  readonly value?: T;\n}\n\nexport type {Ref};\n\ninterface RefInternal {\n  value: Element | undefined;\n}\n\n// When callbacks are used for refs, this map tracks the last value the callback\n// was called with, for ensuring a directive doesn't clear the ref if the ref\n// has already been rendered to a new spot. It is double-keyed on both the\n// context (`options.host`) and the callback, since we auto-bind class methods\n// to `options.host`.\nconst lastElementForContextAndCallback = new WeakMap<\n  object,\n  WeakMap<Function, Element | undefined>\n>();\n\nexport type RefOrCallback<T = Element> = Ref<T> | ((el: T | undefined) => void);\n\nclass RefDirective extends AsyncDirective {\n  private _element?: Element;\n  private _ref?: RefOrCallback;\n  private _context?: object;\n\n  render(_ref?: RefOrCallback) {\n    return nothing;\n  }\n\n  override update(part: ElementPart, [ref]: Parameters<this['render']>) {\n    const refChanged = ref !== this._ref;\n    if (refChanged && this._ref !== undefined) {\n      // The ref passed to the directive has changed;\n      // unset the previous ref's value\n      this._updateRefValue(undefined);\n    }\n    if (refChanged || this._lastElementForRef !== this._element) {\n      // We either got a new ref or this is the first render;\n      // store the ref/element & update the ref value\n      this._ref = ref;\n      this._context = part.options?.host;\n      this._updateRefValue((this._element = part.element));\n    }\n    return nothing;\n  }\n\n  private _updateRefValue(element: Element | undefined) {\n    if (!this.isConnected) {\n      element = undefined;\n    }\n    if (typeof this._ref === 'function') {\n      // If the current ref was called with a previous value, call with\n      // `undefined`; We do this to ensure callbacks are called in a consistent\n      // way regardless of whether a ref might be moving up in the tree (in\n      // which case it would otherwise be called with the new value before the\n      // previous one unsets it) and down in the tree (where it would be unset\n      // before being set). Note that element lookup is keyed by\n      // both the context and the callback, since we allow passing unbound\n      // functions that are called on options.host, and we want to treat\n      // these as unique \"instances\" of a function.\n      const context = this._context ?? globalThis;\n      let lastElementForCallback =\n        lastElementForContextAndCallback.get(context);\n      if (lastElementForCallback === undefined) {\n        lastElementForCallback = new WeakMap();\n        lastElementForContextAndCallback.set(context, lastElementForCallback);\n      }\n      if (lastElementForCallback.get(this._ref) !== undefined) {\n        this._ref.call(this._context, undefined);\n      }\n      lastElementForCallback.set(this._ref, element);\n      // Call the ref with the new element value\n      if (element !== undefined) {\n        this._ref.call(this._context, element);\n      }\n    } else {\n      (this._ref as RefInternal)!.value = element;\n    }\n  }\n\n  private get _lastElementForRef() {\n    return typeof this._ref === 'function'\n      ? lastElementForContextAndCallback\n          .get(this._context ?? globalThis)\n          ?.get(this._ref)\n      : this._ref?.value;\n  }\n\n  override disconnected() {\n    // Only clear the box if our element is still the one in it (i.e. another\n    // directive instance hasn't rendered its element to it before us); that\n    // only happens in the event of the directive being cleared (not via manual\n    // disconnection)\n    if (this._lastElementForRef === this._element) {\n      this._updateRefValue(undefined);\n    }\n  }\n\n  override reconnected() {\n    // If we were manually disconnected, we can safely put our element back in\n    // the box, since no rendering could have occurred to change its state\n    this._updateRefValue(this._element);\n  }\n}\n\n/**\n * Sets the value of a Ref object or calls a ref callback with the element it's\n * bound to.\n *\n * A Ref object acts as a container for a reference to an element. A ref\n * callback is a function that takes an element as its only argument.\n *\n * The ref directive sets the value of the Ref object or calls the ref callback\n * during rendering, if the referenced element changed.\n *\n * Note: If a ref callback is rendered to a different element position or is\n * removed in a subsequent render, it will first be called with `undefined`,\n * followed by another call with the new element it was rendered to (if any).\n *\n * ```js\n * // Using Ref object\n * const inputRef = createRef();\n * render(html`<input ${ref(inputRef)}>`, container);\n * inputRef.value.focus();\n *\n * // Using callback\n * const callback = (inputElement) => inputElement.focus();\n * render(html`<input ${ref(callback)}>`, container);\n * ```\n */\nexport const ref = directive(RefDirective);\n\n/**\n * The type of the class that powers this directive. Necessary for naming the\n * directive's return type.\n */\nexport type {RefDirective};\n","import { LitElement, html, css } from 'lit';\nimport { customElement, property } from 'lit/decorators.js';\nimport type { SourceData } from '../types.js';\nimport { createRef, type Ref, ref } from 'lit/directives/ref.js';\nimport type { SourcesState } from '../sources/index.js';\n\n@customElement('video-selector')\nexport class VideoSelector extends LitElement {\n  static override styles = css`\n    :host {\n      display:block;\n      background-color: hsla(0,0%,30%,0.5);\n    }\n    #contents {\n      padding: 0.5rem;\n    }\n    input {\n      display: none;\n    }\n    #toolbar {\n      margin-bottom: 0.5rem;\n    }\n  `;\n\n  @property()\n  source: SourceData | undefined;\n\n  @property()\n  playing = false;\n\n  @property()\n  cameras: SourceData[] = []\n\n  #fileInputEl: Ref<HTMLInputElement> = createRef();\n  #selectEl: Ref<HTMLSelectElement> = createRef();\n\n  override render() {\n    const source = this.source;\n    let sel = ``;\n    if (source) {\n      if (source.kind === `camera`) {\n        const first = this.cameras[ 0 ];\n        if (source.id === `` && first) {\n          sel = first.id;\n        } else {\n          sel = source.id;\n        }\n      }\n    }\n\n\n    const cameras = this.cameras.length === 0 ? html`` : html`\n          ${ this.cameras.map(d => html`<option .source=${ d } ?selected=${ d.id === sel } value=${ d.id }>${ d.label }</option>`) }`\n\n    return html`\n    <div id=\"contents\">\n      <div id=\"toolbar\"><button @click=${ this.onStartStopClick }>${ this.playing ? `Stop` : `Start` }</button></div>\n      <select ${ ref(this.#selectEl) } @change=${ this.onCameraSelectChange }>\n        ${ cameras }\n      </select>\n      <input @change=${ this.onFileChange } ${ ref(this.#fileInputEl) } id=\"fileInput\" type=\"file\" accept=\"video/*\" />\n      <button @click=${ this.onFileSelect }>File</button>\n    </div>\n    `;\n  }\n\n  getSelected(): SourceData | undefined {\n    const el = this.#selectEl.value;\n    if (!el) return;\n    const item = el.item(el.selectedIndex);\n    if (!item) return;\n    return (item as any).source as SourceData;\n  }\n\n  /**\n * Start stop source & processing\n */\n  onStartStopClick() {\n    this.dispatchEvent(new CustomEvent(`startstop`, { detail: this.getSelected() }));\n  }\n\n  onFileSelect() {\n    this.#fileInputEl.value?.click();\n  }\n\n  notifySourceState(state: SourcesState) {\n    this.playing = state === `started`;\n  }\n\n  onFileChange(event: Event) {\n    const target = event.target as HTMLInputElement;\n    if (!target) return;\n    if (!target.files) return;\n    const files = target.files;\n    if (files.length === 0) return;\n\n    const url = URL.createObjectURL(files[ 0 ] as unknown as MediaSource);\n    const s: SourceData = {\n      id: url,\n      label: `file`,\n      kind: `file`\n    };\n\n    this.dispatchEvent(new CustomEvent(`change`, {\n      detail: s\n    }));\n  }\n\n  /**\n   * User has selected a camera\n   * @param event\n   * @returns \n   */\n  onCameraSelectChange(event: Event) {\n    const t = event.target as HTMLSelectElement;\n    const opt = t.item(t.selectedIndex);\n    if (!opt) return;\n    const value = opt.value;\n    this.source = {\n      kind: `camera`,\n      label: opt.innerText,\n      id: value\n    }\n    this.dispatchEvent(new CustomEvent(`change`, { detail: this.source }));\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    // @ts-ignore\n    'video-selector': VideoSelector;\n  }\n}\n","import type { Point } from \"ixfx/geometry.js\";\n\nconst PiPi = Math.PI * 2;\n\nexport const traceLine = (ctx: CanvasRenderingContext2D, ...points: Array<Point | undefined>) => {\n  if (points.length < 2) return;\n  ctx.moveTo(points[ 0 ]!.x, points[ 0 ]!.y);\n  for (let i = 1; i < points.length; i++) {\n    if (points[ i ] === undefined) continue;\n    ctx.lineTo(points[ i ]!.x, points[ i ]!.y);\n  }\n}\n\nexport const drawDot = (ctx: CanvasRenderingContext2D, point: Point, radius: number, fillStyle?: string, label?: string, labelFillStyle?: string) => {\n  ctx.beginPath();\n  ctx.arc(point.x, point.y, radius, 0, PiPi, false);\n  if (fillStyle) {\n    ctx.fillStyle = fillStyle;\n  }\n  ctx.fill();\n\n  if (label) {\n    if (labelFillStyle) ctx.fillStyle = labelFillStyle;\n    ctx.fillText(label, point.x + radius, point.y - radius);\n  }\n}\n\nconst toAbsolute = (el: HTMLCanvasElement) => (pt: Point) => {\n  return { x: pt.x * el.width, y: pt.y * el.height }\n}\n\nconst vpScale = (el: HTMLCanvasElement) => {\n  const s = Math.min(el.width, el.height);\n  return (v: number) => {\n    return v * s;\n  }\n}\n\nexport const wrap = (el: HTMLCanvasElement) => {\n  const ctx = el.getContext(`2d`);\n  if (!ctx) throw new Error(`Context unavailable`);\n\n  const abs = toAbsolute(el);\n\n  const dot = (point: Point, radius: number, fillStyle?: string, label?: string, labelFillStyle?: string) => {\n    drawDot(ctx, abs(point), scale(radius), fillStyle, label, labelFillStyle);\n  }\n\n  const clear = () => {\n    ctx.clearRect(0, 0, el.width, el.height);\n  }\n\n  const fill = (style?: string) => {\n    if (style) ctx.fillStyle = style;\n    ctx.fillRect(0, 0, el.width, el.height);\n  }\n\n  const line = (a: Point, b: Point, width: number) => {\n    a = abs(a);\n    b = abs(b);\n    width = scale(width);\n    ctx.beginPath();\n    ctx.moveTo(a.x, a.y);\n    ctx.lineTo(b.x, b.y);\n    ctx.lineWidth = width;\n    ctx.stroke();\n    ctx.closePath();\n  }\n\n  const joinPoints = (width: number, ...points: Array<Point>) => {\n    width = scale(width);\n    ctx.beginPath();\n    for (let i = 0; i < points.length; i++) {\n      const pt = abs(points[ i ]!);\n      if (i === 0) {\n        ctx.moveTo(pt.x, pt.y);\n      } else {\n        ctx.lineTo(pt.x, pt.y);\n      }\n    }\n    ctx.lineWidth = width;\n    ctx.stroke();\n    ctx.closePath();\n  }\n\n  const scale = vpScale(el);\n\n  const testPattern = () => {\n    ctx.beginPath();\n    ctx.strokeStyle = `red`;\n    ctx.lineWidth = 2;\n    traceLine(ctx, { x: 0, y: 0 }, { x: el.width, y: el.height });\n    traceLine(ctx, { x: 0, y: el.height }, { x: el.width, y: 0 });\n    ctx.stroke();\n  }\n\n  const text = (text: string, point: Point, style?: string) => {\n    point = abs(point);\n    if (style) ctx.fillStyle = style;\n    ctx.fillText(text, point.x, point.y);\n  }\n  return { dot, abs, clear, testPattern, scale, line, joinPoints, fill, text, ctx }\n\n}\n\nexport type Typewriter = ReturnType<typeof typewriter>;\n\nexport const typewriter = (ctx: CanvasRenderingContext2D, x = 0, y = 0) => {\n  const measure = (msg: string) => {\n    const m = ctx.measureText(msg);\n    return {\n      width: m.width,\n      height: m.fontBoundingBoxAscent + m.fontBoundingBoxDescent\n    }\n  }\n\n  const move = (toX: number, toY: number) => {\n    x = toX;\n    y = toY;\n  }\n\n  const line = (msg: string, colour?: string) => {\n    const r = measure(msg);\n    if (colour) ctx.fillStyle = colour;\n    ctx.fillText(msg, x, y);\n    y += r.height;\n  }\n\n  const word = (msg: string, colour?: string) => {\n    const r = measure(msg);\n    if (colour) ctx.fillStyle = colour;\n    ctx.fillText(msg, x, y);\n    x += r.width;\n  }\n\n  return { line, word, move }\n}\n\nexport type Wrapper = ReturnType<typeof wrap>;\n","var t=\"undefined\"!=typeof self?self:{};function e(e){t:{for(var n=[\"CLOSURE_FLAGS\"],r=t,i=0;i<n.length;i++)if(null==(r=r[n[i]])){n=null;break t}n=r}return null!=(e=n&&n[e])&&e}function n(){throw Error(\"Invalid UTF8\")}function r(t,e){return e=String.fromCharCode.apply(null,e),null==t?e:t+e}let i,s;const o=\"undefined\"!=typeof TextDecoder;let a;const h=\"undefined\"!=typeof TextEncoder;function c(t){if(h)t=(a||=new TextEncoder).encode(t);else{let n=0;const r=new Uint8Array(3*t.length);for(let i=0;i<t.length;i++){var e=t.charCodeAt(i);if(128>e)r[n++]=e;else{if(2048>e)r[n++]=e>>6|192;else{if(55296<=e&&57343>=e){if(56319>=e&&i<t.length){const s=t.charCodeAt(++i);if(56320<=s&&57343>=s){e=1024*(e-55296)+s-56320+65536,r[n++]=e>>18|240,r[n++]=e>>12&63|128,r[n++]=e>>6&63|128,r[n++]=63&e|128;continue}i--}e=65533}r[n++]=e>>12|224,r[n++]=e>>6&63|128}r[n++]=63&e|128}}t=n===r.length?r:r.subarray(0,n)}return t}var u,l=e(610401301),d=e(188588736);const f=t.navigator;function p(t){return!!l&&(!!u&&u.brands.some((({brand:e})=>e&&-1!=e.indexOf(t))))}function g(e){var n;return(n=t.navigator)&&(n=n.userAgent)||(n=\"\"),-1!=n.indexOf(e)}function m(){return!!l&&(!!u&&0<u.brands.length)}function y(){return m()?p(\"Chromium\"):(g(\"Chrome\")||g(\"CriOS\"))&&!(!m()&&g(\"Edge\"))||g(\"Silk\")}function _(t){return _[\" \"](t),t}u=f&&f.userAgentData||null,_[\" \"]=function(){};var v=!m()&&(g(\"Trident\")||g(\"MSIE\"));!g(\"Android\")||y(),y(),g(\"Safari\")&&(y()||!m()&&g(\"Coast\")||!m()&&g(\"Opera\")||!m()&&g(\"Edge\")||(m()?p(\"Microsoft Edge\"):g(\"Edg/\"))||m()&&p(\"Opera\"));var E={},w=null;function T(t){var e=t.length,n=3*e/4;n%3?n=Math.floor(n):-1!=\"=.\".indexOf(t[e-1])&&(n=-1!=\"=.\".indexOf(t[e-2])?n-2:n-1);var r=new Uint8Array(n),i=0;return function(t,e){function n(e){for(;r<t.length;){var n=t.charAt(r++),i=w[n];if(null!=i)return i;if(!/^[\\s\\xa0]*$/.test(n))throw Error(\"Unknown base64 encoding at char: \"+n)}return e}A();for(var r=0;;){var i=n(-1),s=n(0),o=n(64),a=n(64);if(64===a&&-1===i)break;e(i<<2|s>>4),64!=o&&(e(s<<4&240|o>>2),64!=a&&e(o<<6&192|a))}}(t,(function(t){r[i++]=t})),i!==n?r.subarray(0,i):r}function A(){if(!w){w={};for(var t=\"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789\".split(\"\"),e=[\"+/=\",\"+/\",\"-_=\",\"-_.\",\"-_\"],n=0;5>n;n++){var r=t.concat(e[n].split(\"\"));E[n]=r;for(var i=0;i<r.length;i++){var s=r[i];void 0===w[s]&&(w[s]=i)}}}}var b=\"undefined\"!=typeof Uint8Array,k=!v&&\"function\"==typeof btoa;function x(t){if(!k){var e;void 0===e&&(e=0),A(),e=E[e];var n=Array(Math.floor(t.length/3)),r=e[64]||\"\";let h=0,c=0;for(;h<t.length-2;h+=3){var i=t[h],s=t[h+1],o=t[h+2],a=e[i>>2];i=e[(3&i)<<4|s>>4],s=e[(15&s)<<2|o>>6],o=e[63&o],n[c++]=a+i+s+o}switch(a=0,o=r,t.length-h){case 2:o=e[(15&(a=t[h+1]))<<2]||r;case 1:t=t[h],n[c]=e[t>>2]+e[(3&t)<<4|a>>4]+o+r}return n.join(\"\")}for(e=\"\",n=0,r=t.length-10240;n<r;)e+=String.fromCharCode.apply(null,t.subarray(n,n+=10240));return e+=String.fromCharCode.apply(null,n?t.subarray(n):t),btoa(e)}const S=/[-_.]/g,L={\"-\":\"+\",_:\"/\",\".\":\"=\"};function F(t){return L[t]||\"\"}function R(t){if(!k)return T(t);S.test(t)&&(t=t.replace(S,F)),t=atob(t);const e=new Uint8Array(t.length);for(let n=0;n<t.length;n++)e[n]=t.charCodeAt(n);return e}function M(t){return b&&null!=t&&t instanceof Uint8Array}let P;function C(){return P||=new Uint8Array(0)}var O={};let I;function U(t){if(t!==O)throw Error(\"illegal external caller\")}function D(){return I||=new B(null,O)}function N(t){U(O);var e=t.g;return null==(e=null==e||M(e)?e:\"string\"==typeof e?R(e):null)?e:t.g=e}var B=class{constructor(t,e){if(U(e),this.g=t,null!=t&&0===t.length)throw Error(\"ByteString should be constructed with non-empty values\")}h(){const t=N(this);return t?new Uint8Array(t):C()}};function G(t,e){return Error(`Invalid wire type: ${t} (at position ${e})`)}function j(){return Error(\"Failed to read varint, encoding is invalid.\")}function V(t,e){return Error(`Tried to read past the end of the data ${e} > ${t}`)}function X(t){if(\"string\"==typeof t)return{buffer:R(t),P:!1};if(Array.isArray(t))return{buffer:new Uint8Array(t),P:!1};if(t.constructor===Uint8Array)return{buffer:t,P:!1};if(t.constructor===ArrayBuffer)return{buffer:new Uint8Array(t),P:!1};if(t.constructor===B)return{buffer:N(t)||C(),P:!0};if(t instanceof Uint8Array)return{buffer:new Uint8Array(t.buffer,t.byteOffset,t.byteLength),P:!1};throw Error(\"Type not convertible to a Uint8Array, expected a Uint8Array, an ArrayBuffer, a base64 encoded string, a ByteString or an Array of numbers\")}function H(){return\"function\"==typeof BigInt}const W=\"function\"==typeof Uint8Array.prototype.slice;let z,K=0,Y=0;function $(t){const e=0>t;let n=(t=Math.abs(t))>>>0;if(t=Math.floor((t-n)/4294967296),e){const[e,r]=rt(n,t);t=r,n=e}K=n>>>0,Y=t>>>0}function q(t){const e=z||=new DataView(new ArrayBuffer(8));e.setFloat32(0,+t,!0),Y=0,K=e.getUint32(0,!0)}function J(t,e){return 4294967296*e+(t>>>0)}function Z(t,e){const n=2147483648&e;return n&&(e=~e>>>0,0==(t=1+~t>>>0)&&(e=e+1>>>0)),t=J(t,e),n?-t:t}function Q(t,e){if(t>>>=0,2097151>=(e>>>=0))var n=\"\"+(4294967296*e+t);else H()?n=\"\"+(BigInt(e)<<BigInt(32)|BigInt(t)):(t=(16777215&t)+6777216*(n=16777215&(t>>>24|e<<8))+6710656*(e=e>>16&65535),n+=8147497*e,e*=2,1e7<=t&&(n+=Math.floor(t/1e7),t%=1e7),1e7<=n&&(e+=Math.floor(n/1e7),n%=1e7),n=e+tt(n)+tt(t));return n}function tt(t){return t=String(t),\"0000000\".slice(t.length)+t}function et(){var t=K,e=Y;if(2147483648&e)if(H())t=\"\"+(BigInt(0|e)<<BigInt(32)|BigInt(t>>>0));else{const[n,r]=rt(t,e);t=\"-\"+Q(n,r)}else t=Q(t,e);return t}function nt(t){if(16>t.length)$(Number(t));else if(H())t=BigInt(t),K=Number(t&BigInt(4294967295))>>>0,Y=Number(t>>BigInt(32)&BigInt(4294967295));else{const e=+(\"-\"===t[0]);Y=K=0;const n=t.length;for(let r=e,i=(n-e)%6+e;i<=n;r=i,i+=6){const e=Number(t.slice(r,i));Y*=1e6,K=1e6*K+e,4294967296<=K&&(Y+=Math.trunc(K/4294967296),Y>>>=0,K>>>=0)}if(e){const[t,e]=rt(K,Y);K=t,Y=e}}}function rt(t,e){return e=~e,t?t=1+~t:e+=1,[t,e]}function it(t,e){let n,r=0,i=0,s=0;const o=t.h;let a=t.g;do{n=o[a++],r|=(127&n)<<s,s+=7}while(32>s&&128&n);for(32<s&&(i|=(127&n)>>4),s=3;32>s&&128&n;s+=7)n=o[a++],i|=(127&n)<<s;if(dt(t,a),128>n)return e(r>>>0,i>>>0);throw j()}function st(t){let e=0,n=t.g;const r=n+10,i=t.h;for(;n<r;){const r=i[n++];if(e|=r,0==(128&r))return dt(t,n),!!(127&e)}throw j()}function ot(t){const e=t.h;let n=t.g,r=e[n++],i=127&r;if(128&r&&(r=e[n++],i|=(127&r)<<7,128&r&&(r=e[n++],i|=(127&r)<<14,128&r&&(r=e[n++],i|=(127&r)<<21,128&r&&(r=e[n++],i|=r<<28,128&r&&128&e[n++]&&128&e[n++]&&128&e[n++]&&128&e[n++]&&128&e[n++])))))throw j();return dt(t,n),i}function at(t){return ot(t)>>>0}function ht(t){var e=t.h;const n=t.g,r=e[n],i=e[n+1],s=e[n+2];return e=e[n+3],dt(t,t.g+4),(r<<0|i<<8|s<<16|e<<24)>>>0}function ct(t){var e=ht(t);t=2*(e>>31)+1;const n=e>>>23&255;return e&=8388607,255==n?e?NaN:1/0*t:0==n?t*Math.pow(2,-149)*e:t*Math.pow(2,n-150)*(e+Math.pow(2,23))}function ut(t){return ot(t)}function lt(t,e,{ca:n=!1}={}){t.ca=n,e&&(e=X(e),t.h=e.buffer,t.m=e.P,t.j=0,t.l=t.h.length,t.g=t.j)}function dt(t,e){if(t.g=e,e>t.l)throw V(t.l,e)}function ft(t,e){if(0>e)throw Error(`Tried to read a negative byte length: ${e}`);const n=t.g,r=n+e;if(r>t.l)throw V(e,t.l-n);return t.g=r,n}function pt(t,e){if(0==e)return D();var n=ft(t,e);return t.ca&&t.m?n=t.h.subarray(n,n+e):(t=t.h,n=n===(e=n+e)?C():W?t.slice(n,e):new Uint8Array(t.subarray(n,e))),0==n.length?D():new B(n,O)}var gt=[];function mt(t){var e=t.g;if(e.g==e.l)return!1;t.l=t.g.g;var n=at(t.g);if(e=n>>>3,!(0<=(n&=7)&&5>=n))throw G(n,t.l);if(1>e)throw Error(`Invalid field number: ${e} (at position ${t.l})`);return t.m=e,t.h=n,!0}function yt(t){switch(t.h){case 0:0!=t.h?yt(t):st(t.g);break;case 1:dt(t=t.g,t.g+8);break;case 2:if(2!=t.h)yt(t);else{var e=at(t.g);dt(t=t.g,t.g+e)}break;case 5:dt(t=t.g,t.g+4);break;case 3:for(e=t.m;;){if(!mt(t))throw Error(\"Unmatched start-group tag: stream EOF\");if(4==t.h){if(t.m!=e)throw Error(\"Unmatched end-group tag\");break}yt(t)}break;default:throw G(t.h,t.l)}}function _t(t,e,n){const r=t.g.l,i=at(t.g),s=t.g.g+i;let o=s-r;if(0>=o&&(t.g.l=s,n(e,t,void 0,void 0,void 0),o=s-t.g.g),o)throw Error(`Message parsing ended unexpectedly. Expected to read ${i} bytes, instead read ${i-o} bytes, either the data ended unexpectedly or the message misreported its own length`);return t.g.g=s,t.g.l=r,e}function vt(t){var e=at(t.g),a=ft(t=t.g,e);if(t=t.h,o){var h,c=t;(h=s)||(h=s=new TextDecoder(\"utf-8\",{fatal:!0})),e=a+e,c=0===a&&e===c.length?c:c.subarray(a,e);try{var u=h.decode(c)}catch(t){if(void 0===i){try{h.decode(new Uint8Array([128]))}catch(t){}try{h.decode(new Uint8Array([97])),i=!0}catch(t){i=!1}}throw!i&&(s=void 0),t}}else{e=(u=a)+e,a=[];let i,s=null;for(;u<e;){var l=t[u++];128>l?a.push(l):224>l?u>=e?n():(i=t[u++],194>l||128!=(192&i)?(u--,n()):a.push((31&l)<<6|63&i)):240>l?u>=e-1?n():(i=t[u++],128!=(192&i)||224===l&&160>i||237===l&&160<=i||128!=(192&(h=t[u++]))?(u--,n()):a.push((15&l)<<12|(63&i)<<6|63&h)):244>=l?u>=e-2?n():(i=t[u++],128!=(192&i)||0!=i-144+(l<<28)>>30||128!=(192&(h=t[u++]))||128!=(192&(c=t[u++]))?(u--,n()):(l=(7&l)<<18|(63&i)<<12|(63&h)<<6|63&c,l-=65536,a.push(55296+(l>>10&1023),56320+(1023&l)))):n(),8192<=a.length&&(s=r(s,a),a.length=0)}u=r(s,a)}return u}function Et(t){const e=at(t.g);return pt(t.g,e)}function wt(t,e,n){var r=at(t.g);for(r=t.g.g+r;t.g.g<r;)n.push(e(t.g))}var Tt=[];function At(t){return t?/^\\d+$/.test(t)?(nt(t),new bt(K,Y)):null:kt||=new bt(0,0)}var bt=class{constructor(t,e){this.h=t>>>0,this.g=e>>>0}};let kt;function xt(t){return t?/^-?\\d+$/.test(t)?(nt(t),new St(K,Y)):null:Lt||=new St(0,0)}var St=class{constructor(t,e){this.h=t>>>0,this.g=e>>>0}};let Lt;function Ft(t,e,n){for(;0<n||127<e;)t.g.push(127&e|128),e=(e>>>7|n<<25)>>>0,n>>>=7;t.g.push(e)}function Rt(t,e){for(;127<e;)t.g.push(127&e|128),e>>>=7;t.g.push(e)}function Mt(t,e){if(0<=e)Rt(t,e);else{for(let n=0;9>n;n++)t.g.push(127&e|128),e>>=7;t.g.push(1)}}function Pt(t,e){t.g.push(e>>>0&255),t.g.push(e>>>8&255),t.g.push(e>>>16&255),t.g.push(e>>>24&255)}function Ct(t,e){0!==e.length&&(t.l.push(e),t.h+=e.length)}function Ot(t,e,n){Rt(t.g,8*e+n)}function It(t,e){return Ot(t,e,2),e=t.g.end(),Ct(t,e),e.push(t.h),e}function Ut(t,e){var n=e.pop();for(n=t.h+t.g.length()-n;127<n;)e.push(127&n|128),n>>>=7,t.h++;e.push(n),t.h++}function Dt(t,e,n){Ot(t,e,2),Rt(t.g,n.length),Ct(t,t.g.end()),Ct(t,n)}function Nt(t,e,n,r){null!=n&&(e=It(t,e),r(n,t),Ut(t,e))}class Bt{constructor(t,e,n,r){this.g=t,this.h=e,this.l=n,this.pa=r}}function Gt(t){return Array.prototype.slice.call(t)}function jt(t){return\"function\"==typeof Symbol&&\"symbol\"==typeof Symbol()?Symbol():t}var Vt=jt(),Xt=jt(\"0di\"),Ht=jt(\"2ex\"),Wt=jt(\"0dg\"),zt=Vt?(t,e)=>{t[Vt]|=e}:(t,e)=>{void 0!==t.g?t.g|=e:Object.defineProperties(t,{g:{value:e,configurable:!0,writable:!0,enumerable:!1}})},Kt=Vt?(t,e)=>{t[Vt]&=~e}:(t,e)=>{void 0!==t.g&&(t.g&=~e)};function Yt(t,e,n){return n?t|e:t&~e}var $t=Vt?t=>0|t[Vt]:t=>0|t.g,qt=Vt?t=>t[Vt]:t=>t.g,Jt=Vt?(t,e)=>(t[Vt]=e,t):(t,e)=>(void 0!==t.g?t.g=e:Object.defineProperties(t,{g:{value:e,configurable:!0,writable:!0,enumerable:!1}}),t);function Zt(t){return zt(t,34),t}function Qt(t,e){Jt(e,-14591&(0|t))}function te(t,e){Jt(e,-14557&(34|t))}function ee(t){return 0===(t=t>>14&1023)?536870912:t}var ne,re={},ie={};function se(t){return!(!t||\"object\"!=typeof t||t.Ja!==ie)}function oe(t){return null!==t&&\"object\"==typeof t&&!Array.isArray(t)&&t.constructor===Object}function ae(t,e,n){if(null!=t)if(\"string\"==typeof t)t=t?new B(t,O):D();else if(t.constructor!==B)if(M(t))t=t.length?new B(n?t:new Uint8Array(t),O):D();else{if(!e)throw Error();t=void 0}return t}function he(t,e,n){if(!Array.isArray(t)||t.length)return!1;const r=$t(t);return!!(1&r)||!(!e||!(Array.isArray(e)?e.includes(n):e.has(n)))&&(Jt(t,1|r),!0)}const ce=[];function ue(t){if(2&t)throw Error()}Jt(ce,55),ne=Object.freeze(ce);class le{constructor(t,e,n){this.l=0,this.g=t,this.h=e,this.m=n}next(){if(this.l<this.g.length){const t=this.g[this.l++];return{done:!1,value:this.h?this.h.call(this.m,t):t}}return{done:!0,value:void 0}}[Symbol.iterator](){return new le(this.g,this.h,this.m)}}let de,fe,pe;function ge(t,e){(e=de?e[de]:void 0)&&(t[de]=Gt(e))}function me(t,e){t.__closure__error__context__984382||(t.__closure__error__context__984382={}),t.__closure__error__context__984382.severity=e}function ye(){const e=Error();me(e,\"incident\"),function(e){t.setTimeout((()=>{throw e}),0)}(e)}function _e(t){return me(t=Error(t),\"warning\"),t}function ve(t){return null==t||\"number\"==typeof t?t:\"NaN\"===t||\"Infinity\"===t||\"-Infinity\"===t?Number(t):void 0}function Ee(t){return null==t||\"boolean\"==typeof t?t:\"number\"==typeof t?!!t:void 0}Object.freeze(new class{}),Object.freeze(new class{});const we=/^-?([1-9][0-9]*|0)(\\.[0-9]+)?$/;function Te(t){const e=typeof t;return\"number\"===e?Number.isFinite(t):\"string\"===e&&we.test(t)}function Ae(t){if(null==t)return t;if(\"string\"==typeof t){if(!t)return;t=+t}return\"number\"==typeof t&&Number.isFinite(t)?0|t:void 0}function be(t){if(null==t)return t;if(\"string\"==typeof t){if(!t)return;t=+t}return\"number\"==typeof t&&Number.isFinite(t)?t>>>0:void 0}function ke(t){return\"-\"!==t[0]&&(20>t.length||20===t.length&&184467>Number(t.substring(0,6)))}function xe(t){return\"-\"===t[0]?20>t.length||20===t.length&&-922337<Number(t.substring(0,7)):19>t.length||19===t.length&&922337>Number(t.substring(0,6))}function Se(t){return t=Math.trunc(t),Number.isSafeInteger(t)||($(t),t=Z(K,Y)),t}function Le(t){var e=Math.trunc(Number(t));return Number.isSafeInteger(e)?String(e):(-1!==(e=t.indexOf(\".\"))&&(t=t.substring(0,e)),xe(t)||(nt(t),t=et()),t)}function Fe(t){return null==t?t:Te(t)?\"number\"==typeof t?Se(t):Le(t):void 0}function Re(t){if(\"string\"!=typeof t)throw Error();return t}function Me(t){if(null!=t&&\"string\"!=typeof t)throw Error();return t}function Pe(t){return null==t||\"string\"==typeof t?t:void 0}function Ce(t,e,n,r){if(null!=t&&\"object\"==typeof t&&t.X===re)return t;if(!Array.isArray(t))return n?2&r?(t=e[Xt])?e=t:(Zt((t=new e).s),e=e[Xt]=t):e=new e:e=void 0,e;let i=n=$t(t);return 0===i&&(i|=32&r),i|=2&r,i!==n&&Jt(t,i),new e(t)}function Oe(t,e,n){if(e){var r=!!r;if(!Te(e=t))throw _e(\"int64\");\"string\"==typeof e?r=Le(e):r?(r=Math.trunc(e),Number.isSafeInteger(r)?r=String(r):xe(e=String(r))?r=e:($(r),r=et())):r=Se(e)}else r=Fe(t);return\"string\"==typeof(n=null==(t=r)?n?0:void 0:t)&&(r=+n,Number.isSafeInteger(r))?r:n}let Ie,Ue,De;function Ne(t){switch(typeof t){case\"boolean\":return Ue||=[0,void 0,!0];case\"number\":return 0<t?void 0:0===t?De||=[0,void 0]:[-t,void 0];case\"string\":return[0,t];case\"object\":return t}}function Be(t,e){return Ge(t,e[0],e[1])}function Ge(t,e,n){if(null==t&&(t=Ie),Ie=void 0,null==t){var r=96;n?(t=[n],r|=512):t=[],e&&(r=-16760833&r|(1023&e)<<14)}else{if(!Array.isArray(t))throw Error(\"narr\");if(2048&(r=$t(t)))throw Error(\"farr\");if(64&r)return t;if(r|=64,n&&(r|=512,n!==t[0]))throw Error(\"mid\");t:{const i=(n=t).length;if(i){const t=i-1;if(oe(n[t])){if(1024<=(e=t-(+!!(512&(r|=256))-1)))throw Error(\"pvtlmt\");r=-16760833&r|(1023&e)<<14;break t}}if(e){if(1024<(e=Math.max(e,i-(+!!(512&r)-1))))throw Error(\"spvt\");r=-16760833&r|(1023&e)<<14}}}return Jt(t,r),t}const je={};let Ve=function(){try{return _(new class extends Map{constructor(){super()}}),!1}catch{return!0}}();class Xe{constructor(){this.g=new Map}get(t){return this.g.get(t)}set(t,e){return this.g.set(t,e),this.size=this.g.size,this}delete(t){return t=this.g.delete(t),this.size=this.g.size,t}clear(){this.g.clear(),this.size=this.g.size}has(t){return this.g.has(t)}entries(){return this.g.entries()}keys(){return this.g.keys()}values(){return this.g.values()}forEach(t,e){return this.g.forEach(t,e)}[Symbol.iterator](){return this.entries()}}const He=Ve?(Object.setPrototypeOf(Xe.prototype,Map.prototype),Object.defineProperties(Xe.prototype,{size:{value:0,configurable:!0,enumerable:!0,writable:!0}}),Xe):class extends Map{constructor(){super()}};function We(t){return t}function ze(t){if(2&t.N)throw Error(\"Cannot mutate an immutable Map\")}var Ke=class extends He{constructor(t,e,n=We,r=We){super();let i=$t(t);i|=64,Jt(t,i),this.N=i,this.U=e,this.S=n,this.Z=this.U?Ye:r;for(let s=0;s<t.length;s++){const o=t[s],a=n(o[0],!1,!0);let h=o[1];e?void 0===h&&(h=null):h=r(o[1],!1,!0,void 0,void 0,i),super.set(a,h)}}oa(t=$e){if(0!==this.size)return this.Y(t)}Y(t=$e){const e=[],n=super.entries();for(var r;!(r=n.next()).done;)(r=r.value)[0]=t(r[0]),r[1]=t(r[1]),e.push(r);return e}clear(){ze(this),super.clear()}delete(t){return ze(this),super.delete(this.S(t,!0,!1))}entries(){var t=this.na();return new le(t,qe,this)}keys(){return this.Ia()}values(){var t=this.na();return new le(t,Ke.prototype.get,this)}forEach(t,e){super.forEach(((n,r)=>{t.call(e,this.get(r),r,this)}))}set(t,e){return ze(this),null==(t=this.S(t,!0,!1))?this:null==e?(super.delete(t),this):super.set(t,this.Z(e,!0,!0,this.U,!1,this.N))}Oa(t){const e=this.S(t[0],!1,!0);t=t[1],t=this.U?void 0===t?null:t:this.Z(t,!1,!0,void 0,!1,this.N),super.set(e,t)}has(t){return super.has(this.S(t,!1,!1))}get(t){t=this.S(t,!1,!1);const e=super.get(t);if(void 0!==e){var n=this.U;return n?((n=this.Z(e,!1,!0,n,this.ta,this.N))!==e&&super.set(t,n),n):e}}na(){return Array.from(super.keys())}Ia(){return super.keys()}[Symbol.iterator](){return this.entries()}};function Ye(t,e,n,r,i,s){return t=Ce(t,r,n,s),i&&(t=an(t)),t}function $e(t){return t}function qe(t){return[t,this.get(t)]}let Je;function Ze(){return Je||=new Ke(Zt([]),void 0,void 0,void 0,je)}function Qe(t,e,n,r,i){if(null!=t){if(Array.isArray(t))t=he(t,void 0,0)?void 0:i&&2&$t(t)?t:tn(t,e,n,void 0!==r,i);else if(oe(t)){const s={};for(let o in t)s[o]=Qe(t[o],e,n,r,i);t=s}else t=e(t,r);return t}}function tn(t,e,n,r,i){const s=r||n?$t(t):0;r=r?!!(32&s):void 0;const o=Gt(t);for(let t=0;t<o.length;t++)o[t]=Qe(o[t],e,n,r,i);return n&&(ge(o,t),n(s,o)),o}function en(t){return Qe(t,nn,void 0,void 0,!1)}function nn(t){return t.X===re?t.toJSON():t instanceof Ke?t.oa(en):function(t){switch(typeof t){case\"number\":return isFinite(t)?t:String(t);case\"boolean\":return t?1:0;case\"object\":if(t)if(Array.isArray(t)){if(he(t,void 0,0))return}else{if(M(t))return x(t);if(t instanceof B){const e=t.g;return null==e?\"\":\"string\"==typeof e?e:t.g=x(e)}if(t instanceof Ke)return t.oa()}}return t}(t)}function rn(t,e,n=te){if(null!=t){if(b&&t instanceof Uint8Array)return e?t:new Uint8Array(t);if(Array.isArray(t)){var r=$t(t);return 2&r||(e&&=0===r||!!(32&r)&&!(64&r||!(16&r)),t=e?Jt(t,-12293&(34|r)):tn(t,rn,4&r?te:n,!0,!0)),t}return t.X===re?(n=t.s,t=2&(r=qt(n))?t:sn(t,n,r,!0)):t instanceof Ke&&!(2&t.N)&&(n=Zt(t.Y(rn)),t=new Ke(n,t.U,t.S,t.Z)),t}}function sn(t,e,n,r){return t=t.constructor,Ie=e=on(e,n,r),e=new t(e),Ie=void 0,e}function on(t,e,n){const r=n||2&e?te:Qt,i=!!(32&e);return t=function(t,e,n){const r=Gt(t);var i=r.length;const s=256&e?r[i-1]:void 0;for(i+=s?-1:0,e=512&e?1:0;e<i;e++)r[e]=n(r[e]);if(s){e=r[e]={};for(const t in s)e[t]=n(s[t])}return ge(r,t),r}(t,e,(t=>rn(t,i,r))),zt(t,32|(n?2:0)),t}function an(t){const e=t.s,n=qt(e);return 2&n?sn(t,e,n,!1):t}function hn(t,e,n,r){return!(4&e)||null!=n&&(!r&&0===n&&(4096&e||8192&e)&&5>(t.constructor[Wt]=1+(0|t.constructor[Wt]))&&ye(),0!==n&&!(n&e))}function cn(t,e){return ln(t=t.s,qt(t),e)}function un(t,e,n,r){if(!(0>(e=r+(+!!(512&e)-1))||e>=t.length||e>=n))return t[e]}function ln(t,e,n,r){if(-1===n)return null;const i=ee(e);if(!(n>=i)){var s=t.length;return r&&256&e&&null!=(r=t[s-1][n])?(un(t,e,i,n)&&null!=Ht&&(4<=(e=(t=pe??={})[Ht]||0)||(t[Ht]=e+1,ye())),r):un(t,e,i,n)}return 256&e?t[t.length-1][n]:void 0}function dn(t,e,n,r){const i=t.s;let s=qt(i);return ue(s),fn(i,s,e,n,r),t}function fn(t,e,n,r,i){const s=ee(e);if(n>=s||i){let o=e;if(256&e)i=t[t.length-1];else{if(null==r)return o;i=t[s+(+!!(512&e)-1)]={},o|=256}return i[n]=r,n<s&&(t[n+(+!!(512&e)-1)]=void 0),o!==e&&Jt(t,o),o}return t[n+(+!!(512&e)-1)]=r,256&e&&(n in(t=t[t.length-1])&&delete t[n]),e}function pn(t,e,n,r,i){var s=2&e;let o=ln(t,e,n,i);Array.isArray(o)||(o=ne);const a=!(2&r);r=!(1&r);const h=!!(32&e);let c=$t(o);return 0!==c||!h||s||a?1&c||(c|=1,Jt(o,c)):(c|=33,Jt(o,c)),s?(t=!1,2&c||(Zt(o),t=!!(4&c)),(r||t)&&Object.freeze(o)):(s=!!(2&c)||!!(2048&c),r&&s?(o=Gt(o),r=1,h&&!a&&(r|=32),Jt(o,r),fn(t,e,n,o,i)):a&&32&c&&!s&&Kt(o,32)),o}function gn(t,e){t=t.s;let n=qt(t);const r=ln(t,n,e),i=ve(r);return null!=i&&i!==r&&fn(t,n,e,i),i}function mn(t){t=t.s;let e=qt(t);const n=ln(t,e,1),r=ae(n,!0,!!(34&e));return null!=r&&r!==n&&fn(t,e,1,r),r}function yn(t,e,n){const r=t.s;let i=qt(r);const s=2&i?1:2;let o=_n(r,i,e);var a=$t(o);if(hn(t,a,void 0,!1)){(4&a||Object.isFrozen(o))&&(o=Gt(o),a=In(a,i),i=fn(r,i,e,o));let s=t=0;for(;t<o.length;t++){const e=n(o[t]);null!=e&&(o[s++]=e)}s<t&&(o.length=s),a=Yt(a=vn(a,i),20,!0),a=Yt(a,4096,!1),a=Yt(a,8192,!1),Jt(o,a),2&a&&Object.freeze(o)}return En(a)||(n=a,(a=(t=1===s||4===s&&!!(32&a))?Yt(a,2,!0):Un(a,i,!1))!==n&&Jt(o,a),t&&Object.freeze(o)),2===s&&En(a)&&(o=Gt(o),a=Un(a=In(a,i),i,!1),Jt(o,a),fn(r,i,e,o)),o}function _n(t,e,n){return t=ln(t,e,n),Array.isArray(t)?t:ne}function vn(t,e){return 0===t&&(t=In(t,e)),Yt(t,1,!0)}function En(t){return!!(2&t)&&!!(4&t)||!!(2048&t)}function wn(t){t=Gt(t);for(let e=0;e<t.length;e++){const n=t[e]=Gt(t[e]);Array.isArray(n[1])&&(n[1]=Zt(n[1]))}return t}function Tn(t,e,n){{const a=t.s;let h=qt(a);if(ue(h),null==n)fn(a,h,e);else{var r,i=$t(n),s=i,o=!!(2&i)||Object.isFrozen(n);if((r=!o)&&(r=!1),hn(t,i))for(i=21,o&&(n=Gt(n),s=0,i=Un(i=In(i,h),h,!0)),t=0;t<n.length;t++)n[t]=Re(n[t]);r&&(n=Gt(n),s=0,i=Un(i=In(i,h),h,!0)),i!==s&&Jt(n,i),fn(a,h,e,n)}}}function An(t,e,n,r){t=t.s;let i=qt(t);ue(i),fn(t,i,e,(\"0\"===r?0===Number(n):n===r)?void 0:n)}function bn(t,e,n,r){const i=qt(t);ue(i),t=pn(t,i,e,2),r=n(r,!!(4&(e=$t(t)))&&!!(4096&e)),t.push(r)}function kn(t){return t}function xn(t,e){return Sn(t=t.s,qt(t),ws)===e?e:-1}function Sn(t,e,n){let r=0;for(let i=0;i<n.length;i++){const s=n[i];null!=ln(t,e,s)&&(0!==r&&(e=fn(t,e,r)),r=s)}return r}function Ln(t,e,n,r){let i=qt(t);ue(i);const s=ln(t,i,n,r);let o;if(null!=s&&s.X===re)return(e=an(s))!==s&&fn(t,i,n,e,r),e.s;if(Array.isArray(s)){const t=$t(s);o=2&t?on(s,t,!1):s,o=Be(o,e)}else o=Be(void 0,e);return o!==s&&fn(t,i,n,o,r),o}function Fn(t,e,n,r){t=t.s;let i=qt(t);const s=ln(t,i,n,r);return(e=Ce(s,e,!1,i))!==s&&null!=e&&fn(t,i,n,e,r),e}function Rn(t,e,n,r=!1){if(null==(e=Fn(t,e,n,r)))return e;t=t.s;let i=qt(t);if(!(2&i)){const s=an(e);s!==e&&fn(t,i,n,e=s,r)}return e}function Mn(t,e,n,r,i,s){var o=2,a=!!(2&e);o=a?1:o,i=!!i,s&&=!a,a=_n(t,e,r);var h=$t(a);const c=!!(4&h);if(!c){var u=a,l=e;const t=!!(2&(h=vn(h,e)));t&&(l=Yt(l,2,!0));let r=!t,i=!0,s=0,o=0;for(;s<u.length;s++){const e=Ce(u[s],n,!1,l);if(e instanceof n){if(!t){const t=!!(2&$t(e.s));r&&=!t,i&&=t}u[o++]=e}}o<s&&(u.length=o),h=Yt(h,4,!0),h=Yt(h,16,i),h=Yt(h,8,r),Jt(u,h),t&&Object.freeze(u)}if(s&&!(8&h||!a.length&&(1===o||4===o&&32&h))){for(En(h)&&(a=Gt(a),h=In(h,e),e=fn(t,e,r,a)),n=a,s=h,u=0;u<n.length;u++)(h=n[u])!==(l=an(h))&&(n[u]=l);s=Yt(s,8,!0),s=Yt(s,16,!n.length),Jt(n,s),h=s}return En(h)||(n=h,(h=(s=1===o||4===o&&!!(32&h))?Yt(h,!a.length||16&h&&(!c||32&h)?2:2048,!0):Un(h,e,i))!==n&&Jt(a,h),s&&Object.freeze(a)),2===o&&En(h)&&(a=Gt(a),h=Un(h=In(h,e),e,i),Jt(a,h),fn(t,e,r,a)),a}function Pn(t,e,n){t=t.s;const r=qt(t);return Mn(t,r,e,n,!1,!(2&r))}function Cn(t,e,n,r,i){return null==r&&(r=void 0),dn(t,n,r,i)}function On(t,e,n,r){null==r&&(r=void 0),t=t.s;let i=qt(t);ue(i),(n=Sn(t,i,n))&&n!==e&&null!=r&&(i=fn(t,i,n)),fn(t,i,e,r)}function In(t,e){return t=Yt(t,2,!!(2&e)),t=Yt(t,32,!0),Yt(t,2048,!1)}function Un(t,e,n){return 32&e&&n||(t=Yt(t,32,!1)),t}function Dn(t,e,n,r){t=t.s;const i=qt(t);ue(i),e=Mn(t,i,n,e,!0),n=null!=r?r:new n,e.push(n),2&$t(n.s)?Kt(e,8):Kt(e,16)}function Nn(t,e){return Ae(cn(t,e))}function Bn(t,e){return t??e}function Gn(t,e){return Bn(gn(t,e),0)}function jn(t,e){return Bn(Pe(cn(t,e)),\"\")}function Vn(t,e,n){if(null!=n&&\"boolean\"!=typeof n)throw t=typeof n,Error(`Expected boolean but got ${\"object\"!=t?t:n?Array.isArray(n)?\"array\":t:\"null\"}: ${n}`);dn(t,e,n)}function Xn(t,e,n){if(null!=n){if(\"number\"!=typeof n)throw _e(\"int32\");if(!Number.isFinite(n))throw _e(\"int32\");n|=0}dn(t,e,n)}function Hn(t,e,n){if(null!=n&&\"number\"!=typeof n)throw Error(`Value of float/double field must be a number, found ${typeof n}: ${n}`);dn(t,e,n)}function Wn(t,e,n){e.g?e.m(t,e.g,e.h,n,!0):e.m(t,e.h,n,!0)}Ke.prototype.toJSON=void 0,Ke.prototype.Ja=ie;var zn=class{constructor(t,e){this.s=Ge(t,e)}toJSON(){return Kn(this,tn(this.s,nn,void 0,void 0,!1),!0)}l(){var t=ko;return t.g?t.l(this,t.g,t.h,!0):t.l(this,t.h,t.defaultValue,!0)}clone(){const t=this.s;return sn(this,t,qt(t),!1)}P(){return!!(2&$t(this.s))}};function Kn(t,e,n){var r=d?void 0:t.constructor.B;const i=qt(n?t.s:e);if(!(t=e.length))return e;let s,o;if(oe(n=e[t-1])){t:{var a=n;let t={},e=!1;for(var h in a){let n=a[h];if(Array.isArray(n)){let t=n;(he(n,r,+h)||se(n)&&0===n.size)&&(n=null),n!=t&&(e=!0)}null!=n?t[h]=n:e=!0}if(e){for(var c in t){a=t;break t}a=null}}a!=n&&(s=!0),t--}for(h=+!!(512&i)-1;0<t&&(n=e[c=t-1],c-=h,null==n||he(n,r,c)||se(n)&&0===n.size);t--)o=!0;return s||o?(e=Array.prototype.slice.call(e,0,t),a&&e.push(a),e):e}function Yn(t){return Array.isArray(t)?t[0]instanceof Bt?t:[$r,t]:[t,void 0]}function $n(t,e){if(Array.isArray(e)){var n=$t(e);if(4&n)return e;for(var r=0,i=0;r<e.length;r++){const n=t(e[r]);null!=n&&(e[i++]=n)}return i<r&&(e.length=i),Jt(e,-12289&(5|n)),2&n&&Object.freeze(e),e}}zn.prototype.X=re,zn.prototype.toString=function(){return Kn(this,this.s,!1).toString()};const qn=Symbol();function Jn(t){let e=t[qn];if(!e){const n=sr(t),r=yr(t),i=r.l;e=i?(t,e)=>i(t,e,r):(t,e)=>{for(;mt(e)&&4!=e.h;){var i=e.m,s=r[i];if(!s){var o=r.ea;o&&(o=o[i])&&(s=r[i]=Zn(o))}s&&s(e,t,i)||(i=(s=e).l,yt(s),s.ia?s=void 0:(o=s.g.g-i,s.g.g=i,s=pt(s.g,o)),i=t,s&&(de||=Symbol(),(o=i[de])?o.push(s):i[de]=[s]))}n===tr||n===er||n.j||(t[fe||=Symbol()]=n)},t[qn]=e}return e}function Zn(t){const e=(t=Yn(t))[0].g;if(t=t[1]){const n=Jn(t),r=yr(t).T;return(t,i,s)=>e(t,i,s,r,n)}return e}class Qn{}let tr,er;const nr=Symbol();function rr(t,e,n){const r=n[1];let i;if(r){const n=r[nr];i=n?n.T:Ne(r[0]),t[e]=n??r}i&&i===Ue?(t.g||(t.g=new Set)).add(e):n[0]&&(t.h||(t.h=new Set)).add(e)}function ir(t,e){return[t.l,!e||0<e[0]?void 0:e]}function sr(t){var e=t[nr];if(e)return e;if(!(e=ar(t,t[nr]=new Qn,ir,ir,rr)).ea&&!e.h&&!e.g){let n=!0;for(let t in e)isNaN(t)||(n=!1);n?(Ne(t[0])===Ue?er?e=er:((e=new Qn).T=Ne(!0),e=er=e):e=tr||=new Qn,e=t[nr]=e):e.j=!0}return e}function or(t,e,n){t[e]=n}function ar(t,e,n,r,i=or){e.T=Ne(t[0]);let s=0;var o=t[++s];o&&o.constructor===Object&&(e.ea=o,\"function\"==typeof(o=t[++s])&&(e.l=o,e.m=t[++s],o=t[++s]));const a={};for(;Array.isArray(o)&&\"number\"==typeof o[0]&&0<o[0];){for(var h=0;h<o.length;h++)a[o[h]]=o;o=t[++s]}for(h=1;void 0!==o;){let l;\"number\"==typeof o&&(h+=o,o=t[++s]);var c=void 0;if(o instanceof Bt?l=o:(l=qr,s--),l.pa){o=t[++s],c=t;var u=s;\"function\"==typeof o&&(o=o(),c[u]=o),c=o}for(u=h+1,\"number\"==typeof(o=t[++s])&&0>o&&(u-=o,o=t[++s]);h<u;h++){const t=a[h];i(e,h,c?r(l,c,t):n(l,t))}}return e}const hr=Symbol();function cr(t){let e=t[hr];if(!e){const n=fr(t);e=(t,e)=>Er(t,e,n),t[hr]=e}return e}const ur=Symbol();function lr(t){return t.h}function dr(t,e){let n,r;const i=t.h;return(t,s,o)=>i(t,s,o,r||=fr(e).T,n||=cr(e))}function fr(t){let e=t[ur];return e||(e=ar(t,t[ur]={},lr,dr),_r(t),e)}const pr=Symbol();function gr(t,e){const n=t.g;return e?(t,r,i)=>n(t,r,i,e):n}function mr(t,e,n){const r=t.g;let i,s;return(t,o,a)=>r(t,o,a,s||=yr(e).T,i||=Jn(e),n)}function yr(t){let e=t[pr];return e||(sr(t),e=ar(t,t[pr]={},gr,mr),_r(t),e)}function _r(t){pr in t&&nr in t&&ur in t&&(t.length=0)}function vr(t,e){var n=t[e];if(n)return n;if((n=t.ea)&&(n=n[e])){var r=(n=Yn(n))[0].h;if(n=n[1]){const e=cr(n),i=fr(n).T;n=(n=t.m)?n(i,e):(t,n,s)=>r(t,n,s,i,e)}else n=r;return t[e]=n}}function Er(t,e,n){for(var r=qt(t),i=+!!(512&r)-1,s=t.length,o=512&r?1:0,a=s+(256&r?-1:0);o<a;o++){const r=t[o];if(null==r)continue;const s=o-i,a=vr(n,s);a&&a(e,r,s)}if(256&r){r=t[s-1];for(let t in r)i=+t,Number.isNaN(i)||null!=(s=r[t])&&(a=vr(n,i))&&a(e,s,i)}if(t=de?t[de]:void 0)for(Ct(e,e.g.end()),n=0;n<t.length;n++)Ct(e,N(t[n])||C())}function wr(t,e){return new Bt(t,e,!1,!1)}function Tr(t,e){return new Bt(t,e,!0,!1)}function Ar(t,e){return new Bt(t,e,!1,!0)}function br(t,e,n){fn(t,qt(t),e,n)}var kr=Ar((function(t,e,n,r,i){return 2===t.h&&(t=_t(t,Be([void 0,void 0],r),i),ue(r=qt(e)),(i=ln(e,r,n))instanceof Ke?0!=(2&i.N)?((i=i.Y()).push(t),fn(e,r,n,i)):i.Oa(t):Array.isArray(i)?(2&$t(i)&&fn(e,r,n,i=wn(i)),i.push(t)):fn(e,r,n,[t]),!0)}),(function(t,e,n,r,i){if(e instanceof Ke)e.forEach(((e,s)=>{Nt(t,n,Be([s,e],r),i)}));else if(Array.isArray(e))for(let s=0;s<e.length;s++){const o=e[s];Array.isArray(o)&&Nt(t,n,Be(o,r),i)}}));function xr(t,e,n){t:if(null!=e){if(Te(e)){if(\"string\"==typeof e){e=Le(e);break t}if(\"number\"==typeof e){e=Se(e);break t}}e=void 0}null!=e&&(\"string\"==typeof e&&xt(e),null!=e&&(Ot(t,n,0),\"number\"==typeof e?(t=t.g,$(e),Ft(t,K,Y)):(n=xt(e),Ft(t.g,n.h,n.g))))}function Sr(t,e,n){null!=(e=Ae(e))&&null!=e&&(Ot(t,n,0),Mt(t.g,e))}function Lr(t,e,n){null!=(e=Ee(e))&&(Ot(t,n,0),t.g.g.push(e?1:0))}function Fr(t,e,n){null!=(e=Pe(e))&&Dt(t,n,c(e))}function Rr(t,e,n,r,i){Nt(t,n,e instanceof zn?e.s:Array.isArray(e)?Be(e,r):void 0,i)}function Mr(t,e,n){null!=(e=null==e||\"string\"==typeof e||M(e)||e instanceof B?e:void 0)&&Dt(t,n,X(e).buffer)}function Pr(t,e,n){return(5===t.h||2===t.h)&&(e=pn(e,qt(e),n,2,!1),2==t.h?wt(t,ct,e):e.push(ct(t.g)),!0)}var Cr,Or=wr((function(t,e,n){if(1!==t.h)return!1;var r=t.g;t=ht(r);const i=ht(r);r=2*(i>>31)+1;const s=i>>>20&2047;return t=4294967296*(1048575&i)+t,br(e,n,2047==s?t?NaN:1/0*r:0==s?r*Math.pow(2,-1074)*t:r*Math.pow(2,s-1075)*(t+4503599627370496)),!0}),(function(t,e,n){null!=(e=ve(e))&&(Ot(t,n,1),t=t.g,(n=z||=new DataView(new ArrayBuffer(8))).setFloat64(0,+e,!0),K=n.getUint32(0,!0),Y=n.getUint32(4,!0),Pt(t,K),Pt(t,Y))})),Ir=wr((function(t,e,n){return 5===t.h&&(br(e,n,ct(t.g)),!0)}),(function(t,e,n){null!=(e=ve(e))&&(Ot(t,n,5),t=t.g,q(e),Pt(t,K))})),Ur=Tr(Pr,(function(t,e,n){if(null!=(e=$n(ve,e)))for(let o=0;o<e.length;o++){var r=t,i=n,s=e[o];null!=s&&(Ot(r,i,5),r=r.g,q(s),Pt(r,K))}})),Dr=Tr(Pr,(function(t,e,n){if(null!=(e=$n(ve,e))&&e.length){Ot(t,n,2),Rt(t.g,4*e.length);for(let r=0;r<e.length;r++)n=t.g,q(e[r]),Pt(n,K)}})),Nr=wr((function(t,e,n){return 0===t.h&&(br(e,n,it(t.g,Z)),!0)}),xr),Br=wr((function(t,e,n){return 0===t.h&&(br(e,n,0===(t=it(t.g,Z))?void 0:t),!0)}),xr),Gr=wr((function(t,e,n){return 0===t.h&&(br(e,n,it(t.g,J)),!0)}),(function(t,e,n){t:if(null!=e){if(Te(e)){if(\"string\"==typeof e){var r=Math.trunc(Number(e));Number.isSafeInteger(r)&&0<=r?e=String(r):(-1!==(r=e.indexOf(\".\"))&&(e=e.substring(0,r)),ke(e)||(nt(e),e=Q(K,Y)));break t}if(\"number\"==typeof e){e=0<=(e=Math.trunc(e))&&Number.isSafeInteger(e)?e:function(t){if(0>t){$(t);const e=Q(K,Y);return t=Number(e),Number.isSafeInteger(t)?t:e}return ke(String(t))?t:($(t),J(K,Y))}(e);break t}}e=void 0}null!=e&&(\"string\"==typeof e&&At(e),null!=e&&(Ot(t,n,0),\"number\"==typeof e?(t=t.g,$(e),Ft(t,K,Y)):(n=At(e),Ft(t.g,n.h,n.g))))})),jr=wr((function(t,e,n){return 0===t.h&&(br(e,n,ot(t.g)),!0)}),Sr),Vr=Tr((function(t,e,n){return(0===t.h||2===t.h)&&(e=pn(e,qt(e),n,2,!1),2==t.h?wt(t,ot,e):e.push(ot(t.g)),!0)}),(function(t,e,n){if(null!=(e=$n(Ae,e))&&e.length){n=It(t,n);for(let n=0;n<e.length;n++)Mt(t.g,e[n]);Ut(t,n)}})),Xr=wr((function(t,e,n){return 0===t.h&&(br(e,n,0===(t=ot(t.g))?void 0:t),!0)}),Sr),Hr=wr((function(t,e,n){return 0===t.h&&(br(e,n,st(t.g)),!0)}),Lr),Wr=wr((function(t,e,n){return 0===t.h&&(br(e,n,!1===(t=st(t.g))?void 0:t),!0)}),Lr),zr=Tr((function(t,e,n){return 2===t.h&&(bn(e,n,kn,t=vt(t)),!0)}),(function(t,e,n){if(null!=(e=$n(Pe,e)))for(let o=0;o<e.length;o++){var r=t,i=n,s=e[o];null!=s&&Dt(r,i,c(s))}})),Kr=wr((function(t,e,n){return 2===t.h&&(br(e,n,\"\"===(t=vt(t))?void 0:t),!0)}),Fr),Yr=wr((function(t,e,n){return 2===t.h&&(br(e,n,vt(t)),!0)}),Fr),$r=Ar((function(t,e,n,r,i){return 2===t.h&&(_t(t,Ln(e,r,n,!0),i),!0)}),Rr),qr=Ar((function(t,e,n,r,i){return 2===t.h&&(_t(t,Ln(e,r,n),i),!0)}),Rr);Cr=new Bt((function(t,e,n,r,i){if(2!==t.h)return!1;r=Be(void 0,r);let s=qt(e);ue(s);let o=pn(e,s,n,3);return s=qt(e),4&$t(o)&&(o=Gt(o),Jt(o,-2079&(1|$t(o))),fn(e,s,n,o)),o.push(r),_t(t,r,i),!0}),(function(t,e,n,r,i){if(Array.isArray(e))for(let s=0;s<e.length;s++)Rr(t,e[s],n,r,i)}),!0,!0);var Jr=Ar((function(t,e,n,r,i,s){if(2!==t.h)return!1;let o=qt(e);return ue(o),(s=Sn(e,o,s))&&n!==s&&fn(e,o,s),_t(t,e=Ln(e,r,n),i),!0}),Rr),Zr=wr((function(t,e,n){return 2===t.h&&(br(e,n,Et(t)),!0)}),Mr),Qr=Tr((function(t,e,n){return(0===t.h||2===t.h)&&(e=pn(e,qt(e),n,2,!1),2==t.h?wt(t,at,e):e.push(at(t.g)),!0)}),(function(t,e,n){if(null!=(e=$n(be,e)))for(let o=0;o<e.length;o++){var r=t,i=n,s=e[o];null!=s&&(Ot(r,i,0),Rt(r.g,s))}})),ti=wr((function(t,e,n){return 0===t.h&&(br(e,n,ot(t.g)),!0)}),(function(t,e,n){null!=(e=Ae(e))&&(e=parseInt(e,10),Ot(t,n,0),Mt(t.g,e))})),ei=Tr((function(t,e,n){return(0===t.h||2===t.h)&&(e=pn(e,qt(e),n,2,!1),2==t.h?wt(t,ut,e):e.push(ot(t.g)),!0)}),(function(t,e,n){if(null!=(e=$n(Ae,e))&&e.length){n=It(t,n);for(let n=0;n<e.length;n++)Mt(t.g,e[n]);Ut(t,n)}}));class ni{constructor(t,e){this.h=t,this.g=e,this.l=Rn,this.m=Cn,this.defaultValue=void 0}}function ri(t,e){return new ni(t,e)}function ii(t,e){return(n,r)=>{if(Tt.length){const t=Tt.pop();t.o(r),lt(t.g,n,r),n=t}else n=new class{constructor(t,e){if(gt.length){const n=gt.pop();lt(n,t,e),t=n}else t=new class{constructor(t,e){this.h=null,this.m=!1,this.g=this.l=this.j=0,lt(this,t,e)}clear(){this.h=null,this.m=!1,this.g=this.l=this.j=0,this.ca=!1}}(t,e);this.g=t,this.l=this.g.g,this.h=this.m=-1,this.o(e)}o({ia:t=!1}={}){this.ia=t}}(n,r);try{const r=new t,s=r.s;Jn(e)(s,n);var i=r}finally{n.g.clear(),n.m=-1,n.h=-1,100>Tt.length&&Tt.push(n)}return i}}function si(t){return function(){const e=new class{constructor(){this.l=[],this.h=0,this.g=new class{constructor(){this.g=[]}length(){return this.g.length}end(){const t=this.g;return this.g=[],t}}}};Er(this.s,e,fr(t)),Ct(e,e.g.end());const n=new Uint8Array(e.h),r=e.l,i=r.length;let s=0;for(let t=0;t<i;t++){const e=r[t];n.set(e,s),s+=e.length}return e.l=[n],n}}var oi=class extends zn{constructor(t){super(t)}},ai=[0,Kr,wr((function(t,e,n){return 2===t.h&&(br(e,n,(t=Et(t))===D()?void 0:t),!0)}),(function(t,e,n){if(null!=e){if(e instanceof zn){const r=e.Qa;return void(r&&(e=r(e),null!=e&&Dt(t,n,X(e).buffer)))}if(Array.isArray(e))return}Mr(t,e,n)}))],hi=[0,Yr],ci=[0,jr,ti,Hr,-1,Vr,ti,-1],ui=[0,Hr,-1],li=class extends zn{constructor(){super()}};li.B=[6];var di=[0,Hr,Yr,Hr,ti,-1,ei,Yr,-1,ui,ti],fi=[0,Yr,-2],pi=class extends zn{constructor(){super()}},gi=[0],mi=[0,jr,Hr,-4],yi=class extends zn{constructor(t){super(t,2)}},_i={},vi=[-2,_i,Hr];_i[336783863]=[0,Yr,Hr,-1,jr,[0,[1,2,3,4,5,6],Jr,gi,Jr,di,Jr,fi,Jr,mi,Jr,ci,Jr,[0,Yr]],hi,Hr,[0,[1,3],[2,4],Jr,[0,Vr],-1,Jr,[0,zr],-1,Cr,[0,Yr,-1]],Yr];var Ei=[0,Kr,Wr],wi=[0,Br,-1,Wr,-3,Br,Vr,Kr,Xr,Br,-1,Wr,Xr,Wr,-2,Kr],Ti=[-1,{}],Ai=[0,Yr,1,Ti],bi=[0,Yr,zr,Ti];function ki(t,e){An(t,2,Me(e),\"\")}function xi(t,e){bn(t.s,3,Re,e)}function Si(t,e){bn(t.s,4,Re,e)}var Li=class extends zn{constructor(t){super(t,500)}o(t){return Cn(this,0,7,t)}};Li.B=[3,4,5,6,8,13,17,1005];var Fi=[-500,Kr,-1,zr,-3,vi,Cr,ai,Xr,-1,Ai,bi,Cr,Ei,Kr,wi,Xr,zr,987,zr],Ri=[0,Kr,-1,Ti],Mi=[-500,Yr,-1,[-1,{}],998,Yr],Pi=[-500,Yr,zr,-1,[-2,{},Hr],997,zr,-1],Ci=[-500,Yr,zr,Ti,998,zr];function Oi(t,e){Dn(t,1,Li,e)}function Ii(t,e){bn(t.s,10,Re,e)}function Ui(t,e){bn(t.s,15,Re,e)}var Di=class extends zn{constructor(t){super(t,500)}o(t){return Cn(this,0,1001,t)}};Di.B=[1,6,7,9,10,15,16,17,14,1002];var Ni=[-500,Cr,Fi,4,Cr,Mi,Cr,Pi,Xr,Cr,Ci,zr,Xr,Ai,bi,Cr,Ri,zr,-2,wi,Kr,-1,Wr,979,Ti,Cr,ai],Bi=ii(Di,Ni);Di.prototype.g=si(Ni);var Gi=[0,Cr,[0,jr,-2]],ji=class extends zn{constructor(t){super(t)}},Vi=[0,jr,Ir,Yr,-1],Xi=class extends zn{constructor(t){super(t)}g(){return Pn(this,ji,1)}};Xi.B=[1];var Hi=[0,Cr,Vi],Wi=ii(Xi,Hi),zi=[0,jr,Ir],Ki=[0,jr,-1,Gi],Yi=class extends zn{constructor(t){super(t)}},$i=[0,jr,-3],qi=[0,Ir,-3],Ji=class extends zn{constructor(t){super(t)}},Zi=[0,Ir,-1,Yr,Ir],Qi=class extends zn{constructor(t){super(t)}h(){return Rn(this,Yi,2)}g(){return Pn(this,Ji,5)}};Qi.B=[5];var ts=[0,ti,$i,qi,Ki,Cr,Zi],es=class extends zn{constructor(t){super(t)}};es.B=[1,2,3,8,9];var ns=ii(es,[0,zr,Vr,Dr,ts,Yr,-1,Nr,Cr,zi,zr,Nr]),rs=class extends zn{constructor(t){super(t)}},is=[0,Ir,-4],ss=class extends zn{constructor(t){super(t)}};ss.B=[1];var os=ii(ss,[0,Cr,is]),as=class extends zn{constructor(t){super(t)}},hs=[0,Ir,-4],cs=class extends zn{constructor(t){super(t)}};cs.B=[1];var us=ii(cs,[0,Cr,hs]),ls=class extends zn{constructor(t){super(t)}};ls.B=[3];var ds=[0,jr,-1,Dr,ti],fs=class extends zn{constructor(){super()}};fs.prototype.g=si([0,Ir,-4,Nr]);var ps=class extends zn{constructor(t){super(t)}},gs=[0,1,jr,Yr,Hi],ms=class extends zn{constructor(t){super(t)}};ms.B=[1];var ys=ii(ms,[0,Cr,gs,Nr]),_s=class extends zn{constructor(t){super(t)}};_s.B=[1];var vs=class extends zn{constructor(t){super(t)}qa(){const t=mn(this);return null==t?D():t}},Es=class extends zn{constructor(t){super(t)}},ws=[1,2],Ts=[0,ws,Jr,[0,Dr],Jr,[0,Zr],jr,Yr],As=class extends zn{constructor(t){super(t)}};As.B=[1];var bs=ii(As,[0,Cr,Ts,Nr]),ks=class extends zn{constructor(t){super(t)}};ks.B=[4,5];var xs=[0,Yr,jr,Ir,zr,-1],Ss=class extends zn{constructor(t){super(t)}},Ls=[0,Hr,-1],Fs=class extends zn{constructor(t){super(t)}},Rs=[1,2,3,4,5],Ms=class extends zn{constructor(t){super(t)}g(){return null!=mn(this)}h(){return null!=Pe(cn(this,2))}},Ps=[0,Zr,Yr,[0,jr,Nr,-1],[0,Gr,Nr]],Cs=class extends zn{constructor(t){super(t)}g(){return Ee(cn(this,2))??!1}},Os=[0,Ps,Hr,[0,Rs,Jr,mi,Jr,di,Jr,ci,Jr,gi,Jr,fi],ti],Is=class extends zn{constructor(t){super(t)}},Us=[0,Os,Ir,-1,jr],Ds=ri(502141897,Is);_i[502141897]=Us;var Ns=[0,Ps];_i[512499200]=Ns;var Bs=[0,Ns];_i[515723506]=Bs;var Gs=ii(class extends zn{constructor(t){super(t)}},[0,[0,ti,-1,Ur,Qr],ds]),js=[0,Os];_i[508981768]=js;var Vs=class extends zn{constructor(t){super(t)}},Xs=[0,Os,Ir,js,Hr],Hs=class extends zn{constructor(t){super(t)}},Ws=[0,Os,Us,Xs,Ir,Bs];_i[508968149]=Xs;var zs=ri(508968150,Hs);_i[508968150]=Ws;var Ks=class extends zn{constructor(t){super(t)}},Ys=ri(513916220,Ks);_i[513916220]=[0,Os,Ws,jr];var $s=class extends zn{constructor(t){super(t)}h(){return Rn(this,ks,2)}g(){dn(this,2)}},qs=[0,Os,xs];_i[478825465]=qs;var Js=[0,Os];_i[478825422]=Js;var Zs=class extends zn{constructor(t){super(t)}},Qs=[0,Os,Js,qs,-1],to=class extends zn{constructor(t){super(t)}},eo=[0,Os,Ir,jr],no=class extends zn{constructor(t){super(t)}},ro=[0,Os,Ir],io=class extends zn{constructor(t){super(t)}},so=[0,Os,eo,ro,Ir],oo=class extends zn{constructor(t){super(t)}},ao=[0,Os,so,Qs];_i[463370452]=Qs,_i[464864288]=eo,_i[474472470]=ro;var ho=ri(462713202,io);_i[462713202]=so;var co=ri(479097054,oo);_i[479097054]=ao;var uo=class extends zn{constructor(t){super(t)}},lo=[0,Os],fo=class extends zn{constructor(t){super(t)}},po=[0,Os,Ir,-1,jr];_i[514774813]=po;var go=class extends zn{constructor(t){super(t)}},mo=[0,Os,Ir,Hr];_i[518928384]=mo;var yo=class extends zn{constructor(){super()}};yo.prototype.g=si([0,Os,ro,lo,Us,Xs,po,mo]);var _o=class extends zn{constructor(t){super(t)}},vo=ri(456383383,_o);_i[456383383]=[0,Os,xs];var Eo=class extends zn{constructor(t){super(t)}},wo=ri(476348187,Eo);_i[476348187]=[0,Os,Ls];var To=class extends zn{constructor(t){super(t)}},Ao=[0,ti,-1],bo=class extends zn{constructor(t){super(t)}};bo.B=[3];var ko=ri(458105876,class extends zn{constructor(t){super(t)}g(){var t=this.s;const e=qt(t);var n=2&e;return t=function(t,e,n){var r=bo;const i=2&e;let s=!1;if(null==n){if(i)return Ze();n=[]}else if(n.constructor===Ke){if(0==(2&n.N)||i)return n;n=n.Y()}else Array.isArray(n)?s=!!(2&$t(n)):n=[];if(i){if(!n.length)return Ze();s||(s=!0,Zt(n))}else s&&(s=!1,n=wn(n));return s||(64&$t(n)?Kt(n,32):32&e&&zt(n,32)),fn(t,e,2,r=new Ke(n,r,Oe,void 0),!1),r}(t,e,ln(t,e,2)),null==t||!n&&bo&&(t.ta=!0),n=t}});_i[458105876]=[0,Ao,kr,[!0,Nr,[0,Yr,-1,zr]]];var xo=class extends zn{constructor(t){super(t)}},So=ri(458105758,xo);_i[458105758]=[0,Os,Yr,Ao];var Lo=class extends zn{constructor(t){super(t)}};Lo.B=[5,6];var Fo=ri(443442058,Lo);_i[443442058]=[0,Os,Yr,jr,Ir,zr,-1];var Ro=class extends zn{constructor(t){super(t)}},Mo=ri(516587230,Ro);function Po(t,e){return e=e?e.clone():new ks,void 0!==t.displayNamesLocale?dn(e,1,Me(t.displayNamesLocale)):void 0===t.displayNamesLocale&&dn(e,1),void 0!==t.maxResults?Xn(e,2,t.maxResults):\"maxResults\"in t&&dn(e,2),void 0!==t.scoreThreshold?Hn(e,3,t.scoreThreshold):\"scoreThreshold\"in t&&dn(e,3),void 0!==t.categoryAllowlist?Tn(e,4,t.categoryAllowlist):\"categoryAllowlist\"in t&&dn(e,4),void 0!==t.categoryDenylist?Tn(e,5,t.categoryDenylist):\"categoryDenylist\"in t&&dn(e,5),e}function Co(t,e=-1,n=\"\"){return{categories:t.map((t=>({index:Bn(Nn(t,1),0)??-1,score:Gn(t,2)??0,categoryName:jn(t,3)??\"\",displayName:jn(t,4)??\"\"}))),headIndex:e,headName:n}}function Oo(t){var e=yn(t,3,ve),n=yn(t,2,Ae),r=yn(t,1,Pe),i=yn(t,9,Pe);const s={categories:[],keypoints:[]};for(let t=0;t<e.length;t++)s.categories.push({score:e[t],index:n[t]??-1,categoryName:r[t]??\"\",displayName:i[t]??\"\"});if((e=Rn(t,Qi,4)?.h())&&(s.boundingBox={originX:Nn(e,1)??0,originY:Nn(e,2)??0,width:Nn(e,3)??0,height:Nn(e,4)??0,angle:0}),Rn(t,Qi,4)?.g().length)for(const e of Rn(t,Qi,4).g())s.keypoints.push({x:gn(e,1)??0,y:gn(e,2)??0,score:gn(e,4)??0,label:Pe(cn(e,3))??\"\"});return s}function Io(t){const e=[];for(const n of Pn(t,as,1))e.push({x:Gn(n,1)??0,y:Gn(n,2)??0,z:Gn(n,3)??0,visibility:Gn(n,4)??0});return e}function Uo(t){const e=[];for(const n of Pn(t,rs,1))e.push({x:Gn(n,1)??0,y:Gn(n,2)??0,z:Gn(n,3)??0,visibility:Gn(n,4)??0});return e}function Do(t){return Array.from(t,(t=>127<t?t-256:t))}function No(t,e){if(t.length!==e.length)throw Error(`Cannot compute cosine similarity between embeddings of different sizes (${t.length} vs. ${e.length}).`);let n=0,r=0,i=0;for(let s=0;s<t.length;s++)n+=t[s]*e[s],r+=t[s]*t[s],i+=e[s]*e[s];if(0>=r||0>=i)throw Error(\"Cannot compute cosine similarity on embedding with 0 norm.\");return n/Math.sqrt(r*i)}let Bo;_i[516587230]=[0,Os,po,mo,Ir];const Go=new Uint8Array([0,97,115,109,1,0,0,0,1,5,1,96,0,1,123,3,2,1,0,10,10,1,8,0,65,0,253,15,253,98,11]);async function jo(){if(void 0===Bo)try{await WebAssembly.instantiate(Go),Bo=!0}catch{Bo=!1}return Bo}async function Vo(t,e=\"\"){const n=await jo()?\"wasm_internal\":\"wasm_nosimd_internal\";return{wasmLoaderPath:`${e}/${t}_${n}.js`,wasmBinaryPath:`${e}/${t}_${n}.wasm`}}var Xo=class{};function Ho(){var t=navigator;return\"undefined\"!=typeof OffscreenCanvas&&(!function(t=navigator){return(t=t.userAgent).includes(\"Safari\")&&!t.includes(\"Chrome\")}(t)||!!((t=t.userAgent.match(/Version\\/([\\d]+).*Safari/))&&1<=t.length&&17<=Number(t[1])))}async function Wo(t){if(\"function\"!=typeof importScripts){const e=document.createElement(\"script\");return e.src=t.toString(),e.crossOrigin=\"anonymous\",new Promise(((t,n)=>{e.addEventListener(\"load\",(()=>{t()}),!1),e.addEventListener(\"error\",(t=>{n(t)}),!1),document.body.appendChild(e)}))}importScripts(t.toString())}function zo(t){return void 0!==t.videoWidth?[t.videoWidth,t.videoHeight]:void 0!==t.naturalWidth?[t.naturalWidth,t.naturalHeight]:void 0!==t.displayWidth?[t.displayWidth,t.displayHeight]:[t.width,t.height]}function Ko(t,e,n){t.m||console.error(\"No wasm multistream support detected: ensure dependency inclusion of :gl_graph_runner_internal_multi_input target\"),n(e=t.i.stringToNewUTF8(e)),t.i._free(e)}function Yo(t,e,n){if(!t.i.canvas)throw Error(\"No OpenGL canvas configured.\");if(n?t.i._bindTextureToStream(n):t.i._bindTextureToCanvas(),!(n=t.i.canvas.getContext(\"webgl2\")||t.i.canvas.getContext(\"webgl\")))throw Error(\"Failed to obtain WebGL context from the provided canvas. `getContext()` should only be invoked with `webgl` or `webgl2`.\");t.i.gpuOriginForWebTexturesIsBottomLeft&&n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,!0),n.texImage2D(n.TEXTURE_2D,0,n.RGBA,n.RGBA,n.UNSIGNED_BYTE,e),t.i.gpuOriginForWebTexturesIsBottomLeft&&n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,!1);const[r,i]=zo(e);return!t.l||r===t.i.canvas.width&&i===t.i.canvas.height||(t.i.canvas.width=r,t.i.canvas.height=i),[r,i]}function $o(t,e,n){t.m||console.error(\"No wasm multistream support detected: ensure dependency inclusion of :gl_graph_runner_internal_multi_input target\");const r=new Uint32Array(e.length);for(let n=0;n<e.length;n++)r[n]=t.i.stringToNewUTF8(e[n]);e=t.i._malloc(4*r.length),t.i.HEAPU32.set(r,e>>2),n(e);for(const e of r)t.i._free(e);t.i._free(e)}function qo(t,e,n){t.i.simpleListeners=t.i.simpleListeners||{},t.i.simpleListeners[e]=n}function Jo(t,e,n){let r=[];t.i.simpleListeners=t.i.simpleListeners||{},t.i.simpleListeners[e]=(t,e,i)=>{e?(n(r,i),r=[]):r.push(t)}}Xo.forVisionTasks=function(t){return Vo(\"vision\",t)},Xo.forTextTasks=function(t){return Vo(\"text\",t)},Xo.forGenAiExperimentalTasks=function(t){return Vo(\"genai_experimental\",t)},Xo.forGenAiTasks=function(t){return Vo(\"genai\",t)},Xo.forAudioTasks=function(t){return Vo(\"audio\",t)},Xo.isSimdSupported=function(){return jo()};async function Zo(t,e,n,r){return t=await(async(t,e,n,r,i)=>{if(e&&await Wo(e),!self.ModuleFactory)throw Error(\"ModuleFactory not set.\");if(n&&(await Wo(n),!self.ModuleFactory))throw Error(\"ModuleFactory not set.\");return self.Module&&i&&((e=self.Module).locateFile=i.locateFile,i.mainScriptUrlOrBlob&&(e.mainScriptUrlOrBlob=i.mainScriptUrlOrBlob)),i=await self.ModuleFactory(self.Module||i),self.ModuleFactory=self.Module=void 0,new t(i,r)})(t,n.wasmLoaderPath,n.assetLoaderPath,e,{locateFile:t=>t.endsWith(\".wasm\")?n.wasmBinaryPath.toString():n.assetBinaryPath&&t.endsWith(\".data\")?n.assetBinaryPath.toString():t}),await t.o(r),t}function Qo(t,e){const n=Rn(t.baseOptions,Ms,1)||new Ms;\"string\"==typeof e?(dn(n,2,Me(e)),dn(n,1)):e instanceof Uint8Array&&(dn(n,1,ae(e,!1,!1)),dn(n,2)),Cn(t.baseOptions,0,1,n)}function ta(t){try{const e=t.K.length;if(1===e)throw Error(t.K[0].message);if(1<e)throw Error(\"Encountered multiple errors: \"+t.K.map((t=>t.message)).join(\", \"))}finally{t.K=[]}}function ea(t,e){t.J=Math.max(t.J,e)}function na(t,e){t.C=new Li,ki(t.C,\"PassThroughCalculator\"),xi(t.C,\"free_memory\"),Si(t.C,\"free_memory_unused_out\"),Ii(e,\"free_memory\"),Oi(e,t.C)}function ra(t,e){xi(t.C,e),Si(t.C,e+\"_unused_out\")}function ia(t){t.g.addBoolToStream(!0,\"free_memory\",t.J)}var sa=class{constructor(t){this.g=t,this.K=[],this.J=0,this.g.setAutoRenderToScreen(!1)}l(t,e=!0){if(e){const e=t.baseOptions||{};if(t.baseOptions?.modelAssetBuffer&&t.baseOptions?.modelAssetPath)throw Error(\"Cannot set both baseOptions.modelAssetPath and baseOptions.modelAssetBuffer\");if(!(Rn(this.baseOptions,Ms,1)?.g()||Rn(this.baseOptions,Ms,1)?.h()||t.baseOptions?.modelAssetBuffer||t.baseOptions?.modelAssetPath))throw Error(\"Either baseOptions.modelAssetPath or baseOptions.modelAssetBuffer must be set\");if(function(t,e){let n=Rn(t.baseOptions,Fs,3);if(!n){var r=n=new Fs,i=new pi;On(r,4,Rs,i)}\"delegate\"in e&&(\"GPU\"===e.delegate?(e=n,r=new li,On(e,2,Rs,r)):(e=n,r=new pi,On(e,4,Rs,r))),Cn(t.baseOptions,0,3,n)}(this,e),e.modelAssetPath)return fetch(e.modelAssetPath.toString()).then((t=>{if(t.ok)return t.arrayBuffer();throw Error(`Failed to fetch model: ${e.modelAssetPath} (${t.status})`)})).then((t=>{try{this.g.i.FS_unlink(\"/model.dat\")}catch{}this.g.i.FS_createDataFile(\"/\",\"model.dat\",new Uint8Array(t),!0,!1,!1),Qo(this,\"/model.dat\"),this.m(),this.L()}));if(e.modelAssetBuffer instanceof Uint8Array)Qo(this,e.modelAssetBuffer);else if(e.modelAssetBuffer)return async function(t){const e=[];for(var n=0;;){const{done:r,value:i}=await t.read();if(r)break;e.push(i),n+=i.length}if(0===e.length)return new Uint8Array(0);if(1===e.length)return e[0];t=new Uint8Array(n),n=0;for(const r of e)t.set(r,n),n+=r.length;return t}(e.modelAssetBuffer).then((t=>{Qo(this,t),this.m(),this.L()}))}return this.m(),this.L(),Promise.resolve()}L(){}fa(){let t;if(this.g.fa((e=>{t=Bi(e)})),!t)throw Error(\"Failed to retrieve CalculatorGraphConfig\");return t}setGraph(t,e){this.g.attachErrorListener(((t,e)=>{this.K.push(Error(e))})),this.g.Ma(),this.g.setGraph(t,e),this.C=void 0,ta(this)}finishProcessing(){this.g.finishProcessing(),ta(this)}close(){this.C=void 0,this.g.closeGraph()}};function oa(t,e){if(!t)throw Error(`Unable to obtain required WebGL resource: ${e}`);return t}sa.prototype.close=sa.prototype.close,function(e,n){e=e.split(\".\");var r,i=t;e[0]in i||void 0===i.execScript||i.execScript(\"var \"+e[0]);for(;e.length&&(r=e.shift());)e.length||void 0===n?i=i[r]&&i[r]!==Object.prototype[r]?i[r]:i[r]={}:i[r]=n}(\"TaskRunner\",sa);class aa{constructor(t,e,n,r){this.g=t,this.h=e,this.m=n,this.l=r}bind(){this.g.bindVertexArray(this.h)}close(){this.g.deleteVertexArray(this.h),this.g.deleteBuffer(this.m),this.g.deleteBuffer(this.l)}}function ha(t,e,n){const r=t.g;if(n=oa(r.createShader(n),\"Failed to create WebGL shader\"),r.shaderSource(n,e),r.compileShader(n),!r.getShaderParameter(n,r.COMPILE_STATUS))throw Error(`Could not compile WebGL shader: ${r.getShaderInfoLog(n)}`);return r.attachShader(t.h,n),n}function ca(t,e){const n=t.g,r=oa(n.createVertexArray(),\"Failed to create vertex array\");n.bindVertexArray(r);const i=oa(n.createBuffer(),\"Failed to create buffer\");n.bindBuffer(n.ARRAY_BUFFER,i),n.enableVertexAttribArray(t.K),n.vertexAttribPointer(t.K,2,n.FLOAT,!1,0,0),n.bufferData(n.ARRAY_BUFFER,new Float32Array([-1,-1,-1,1,1,1,1,-1]),n.STATIC_DRAW);const s=oa(n.createBuffer(),\"Failed to create buffer\");return n.bindBuffer(n.ARRAY_BUFFER,s),n.enableVertexAttribArray(t.J),n.vertexAttribPointer(t.J,2,n.FLOAT,!1,0,0),n.bufferData(n.ARRAY_BUFFER,new Float32Array(e?[0,1,0,0,1,0,1,1]:[0,0,0,1,1,1,1,0]),n.STATIC_DRAW),n.bindBuffer(n.ARRAY_BUFFER,null),n.bindVertexArray(null),new aa(n,r,i,s)}function ua(t,e){if(t.g){if(e!==t.g)throw Error(\"Cannot change GL context once initialized\")}else t.g=e}function la(t,e,n,r){return ua(t,e),t.h||(t.m(),t.D()),n?(t.v||(t.v=ca(t,!0)),n=t.v):(t.A||(t.A=ca(t,!1)),n=t.A),e.useProgram(t.h),n.bind(),t.l(),t=r(),n.g.bindVertexArray(null),t}function da(t,e,n){return ua(t,e),t=oa(e.createTexture(),\"Failed to create texture\"),e.bindTexture(e.TEXTURE_2D,t),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,n??e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,n??e.LINEAR),e.bindTexture(e.TEXTURE_2D,null),t}function fa(t,e,n){ua(t,e),t.u||(t.u=oa(e.createFramebuffer(),\"Failed to create framebuffe.\")),e.bindFramebuffer(e.FRAMEBUFFER,t.u),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,n,0)}function pa(t){t.g?.bindFramebuffer(t.g.FRAMEBUFFER,null)}var ga=class{H(){return\"\\n  precision mediump float;\\n  varying vec2 vTex;\\n  uniform sampler2D inputTexture;\\n  void main() {\\n    gl_FragColor = texture2D(inputTexture, vTex);\\n  }\\n \"}m(){const t=this.g;if(this.h=oa(t.createProgram(),\"Failed to create WebGL program\"),this.ba=ha(this,\"\\n  attribute vec2 aVertex;\\n  attribute vec2 aTex;\\n  varying vec2 vTex;\\n  void main(void) {\\n    gl_Position = vec4(aVertex, 0.0, 1.0);\\n    vTex = aTex;\\n  }\",t.VERTEX_SHADER),this.aa=ha(this,this.H(),t.FRAGMENT_SHADER),t.linkProgram(this.h),!t.getProgramParameter(this.h,t.LINK_STATUS))throw Error(`Error during program linking: ${t.getProgramInfoLog(this.h)}`);this.K=t.getAttribLocation(this.h,\"aVertex\"),this.J=t.getAttribLocation(this.h,\"aTex\")}D(){}l(){}close(){if(this.h){const t=this.g;t.deleteProgram(this.h),t.deleteShader(this.ba),t.deleteShader(this.aa)}this.u&&this.g.deleteFramebuffer(this.u),this.A&&this.A.close(),this.v&&this.v.close()}};var ma=class extends ga{H(){return\"\\n  precision mediump float;\\n  uniform sampler2D backgroundTexture;\\n  uniform sampler2D maskTexture;\\n  uniform sampler2D colorMappingTexture;\\n  varying vec2 vTex;\\n  void main() {\\n    vec4 backgroundColor = texture2D(backgroundTexture, vTex);\\n    float category = texture2D(maskTexture, vTex).r;\\n    vec4 categoryColor = texture2D(colorMappingTexture, vec2(category, 0.0));\\n    gl_FragColor = mix(backgroundColor, categoryColor, categoryColor.a);\\n  }\\n \"}D(){const t=this.g;t.activeTexture(t.TEXTURE1),this.C=da(this,t,t.LINEAR),t.activeTexture(t.TEXTURE2),this.j=da(this,t,t.NEAREST)}m(){super.m();const t=this.g;this.M=oa(t.getUniformLocation(this.h,\"backgroundTexture\"),\"Uniform location\"),this.V=oa(t.getUniformLocation(this.h,\"colorMappingTexture\"),\"Uniform location\"),this.L=oa(t.getUniformLocation(this.h,\"maskTexture\"),\"Uniform location\")}l(){super.l();const t=this.g;t.uniform1i(this.L,0),t.uniform1i(this.M,1),t.uniform1i(this.V,2)}close(){this.C&&this.g.deleteTexture(this.C),this.j&&this.g.deleteTexture(this.j),super.close()}},ya=class extends ga{H(){return\"\\n  precision mediump float;\\n  uniform sampler2D maskTexture;\\n  uniform sampler2D defaultTexture;\\n  uniform sampler2D overlayTexture;\\n  varying vec2 vTex;\\n  void main() {\\n    float confidence = texture2D(maskTexture, vTex).r;\\n    vec4 defaultColor = texture2D(defaultTexture, vTex);\\n    vec4 overlayColor = texture2D(overlayTexture, vTex);\\n    // Apply the alpha from the overlay and merge in the default color\\n    overlayColor = mix(defaultColor, overlayColor, overlayColor.a);\\n    gl_FragColor = mix(defaultColor, overlayColor, confidence);\\n  }\\n \"}D(){const t=this.g;t.activeTexture(t.TEXTURE1),this.j=da(this,t),t.activeTexture(t.TEXTURE2),this.C=da(this,t)}m(){super.m();const t=this.g;this.L=oa(t.getUniformLocation(this.h,\"defaultTexture\"),\"Uniform location\"),this.M=oa(t.getUniformLocation(this.h,\"overlayTexture\"),\"Uniform location\"),this.I=oa(t.getUniformLocation(this.h,\"maskTexture\"),\"Uniform location\")}l(){super.l();const t=this.g;t.uniform1i(this.I,0),t.uniform1i(this.L,1),t.uniform1i(this.M,2)}close(){this.j&&this.g.deleteTexture(this.j),this.C&&this.g.deleteTexture(this.C),super.close()}};function _a(t,e){switch(e){case 0:return t.g.find((t=>t instanceof Uint8Array));case 1:return t.g.find((t=>t instanceof Float32Array));case 2:return t.g.find((t=>\"undefined\"!=typeof WebGLTexture&&t instanceof WebGLTexture));default:throw Error(`Type is not supported: ${e}`)}}function va(t){var e=_a(t,1);if(!e){if(e=_a(t,0))e=new Float32Array(e).map((t=>t/255));else{e=new Float32Array(t.width*t.height);const r=wa(t);var n=Aa(t);if(fa(n,r,Ea(t)),\"iPad Simulator;iPhone Simulator;iPod Simulator;iPad;iPhone;iPod\".split(\";\").includes(navigator.platform)||navigator.userAgent.includes(\"Mac\")&&\"ontouchend\"in self.document){n=new Float32Array(t.width*t.height*4),r.readPixels(0,0,t.width,t.height,r.RGBA,r.FLOAT,n);for(let t=0,r=0;t<e.length;++t,r+=4)e[t]=n[r]}else r.readPixels(0,0,t.width,t.height,r.RED,r.FLOAT,e)}t.g.push(e)}return e}function Ea(t){let e=_a(t,2);if(!e){const n=wa(t);e=ba(t);const r=va(t),i=Ta(t);n.texImage2D(n.TEXTURE_2D,0,i,t.width,t.height,0,n.RED,n.FLOAT,r),ka(t)}return e}function wa(t){if(!t.canvas)throw Error(\"Conversion to different image formats require that a canvas is passed when initializing the image.\");return t.h||(t.h=oa(t.canvas.getContext(\"webgl2\"),\"You cannot use a canvas that is already bound to a different type of rendering context.\")),t.h}function Ta(t){if(t=wa(t),!xa)if(t.getExtension(\"EXT_color_buffer_float\")&&t.getExtension(\"OES_texture_float_linear\")&&t.getExtension(\"EXT_float_blend\"))xa=t.R32F;else{if(!t.getExtension(\"EXT_color_buffer_half_float\"))throw Error(\"GPU does not fully support 4-channel float32 or float16 formats\");xa=t.R16F}return xa}function Aa(t){return t.l||(t.l=new ga),t.l}function ba(t){const e=wa(t);e.viewport(0,0,t.width,t.height),e.activeTexture(e.TEXTURE0);let n=_a(t,2);return n||(n=da(Aa(t),e,t.m?e.LINEAR:e.NEAREST),t.g.push(n),t.j=!0),e.bindTexture(e.TEXTURE_2D,n),n}function ka(t){t.h.bindTexture(t.h.TEXTURE_2D,null)}var xa,Sa=class{constructor(t,e,n,r,i,s,o){this.g=t,this.m=e,this.j=n,this.canvas=r,this.l=i,this.width=s,this.height=o,this.j&&(0===--La&&console.error(\"You seem to be creating MPMask instances without invoking .close(). This leaks resources.\"))}Ha(){return!!_a(this,0)}la(){return!!_a(this,1)}R(){return!!_a(this,2)}ka(){return(e=_a(t=this,0))||(e=va(t),e=new Uint8Array(e.map((t=>255*t))),t.g.push(e)),e;var t,e}ja(){return va(this)}O(){return Ea(this)}clone(){const t=[];for(const e of this.g){let n;if(e instanceof Uint8Array)n=new Uint8Array(e);else if(e instanceof Float32Array)n=new Float32Array(e);else{if(!(e instanceof WebGLTexture))throw Error(`Type is not supported: ${e}`);{const t=wa(this),e=Aa(this);t.activeTexture(t.TEXTURE1),n=da(e,t,this.m?t.LINEAR:t.NEAREST),t.bindTexture(t.TEXTURE_2D,n);const r=Ta(this);t.texImage2D(t.TEXTURE_2D,0,r,this.width,this.height,0,t.RED,t.FLOAT,null),t.bindTexture(t.TEXTURE_2D,null),fa(e,t,n),la(e,t,!1,(()=>{ba(this),t.clearColor(0,0,0,0),t.clear(t.COLOR_BUFFER_BIT),t.drawArrays(t.TRIANGLE_FAN,0,4),ka(this)})),pa(e),ka(this)}}t.push(n)}return new Sa(t,this.m,this.R(),this.canvas,this.l,this.width,this.height)}close(){this.j&&wa(this).deleteTexture(_a(this,2)),La=-1}};Sa.prototype.close=Sa.prototype.close,Sa.prototype.clone=Sa.prototype.clone,Sa.prototype.getAsWebGLTexture=Sa.prototype.O,Sa.prototype.getAsFloat32Array=Sa.prototype.ja,Sa.prototype.getAsUint8Array=Sa.prototype.ka,Sa.prototype.hasWebGLTexture=Sa.prototype.R,Sa.prototype.hasFloat32Array=Sa.prototype.la,Sa.prototype.hasUint8Array=Sa.prototype.Ha;var La=250;const Fa={color:\"white\",lineWidth:4,radius:6};function Ra(t){return{...Fa,fillColor:(t=t||{}).color,...t}}function Ma(t,e){return t instanceof Function?t(e):t}function Pa(t,e,n){return Math.max(Math.min(e,n),Math.min(Math.max(e,n),t))}function Ca(t){if(!t.l)throw Error(\"CPU rendering requested but CanvasRenderingContext2D not provided.\");return t.l}function Oa(t){if(!t.j)throw Error(\"GPU rendering requested but WebGL2RenderingContext not provided.\");return t.j}function Ia(t,e,n){if(e.R())n(e.O());else{const r=e.la()?e.ja():e.ka();t.m=t.m??new ga;const i=Oa(t);n((t=new Sa([r],e.m,!1,i.canvas,t.m,e.width,e.height)).O()),t.close()}}function Ua(t,e,n,r){const i=function(t){return t.g||(t.g=new ma),t.g}(t),s=Oa(t),o=Array.isArray(n)?new ImageData(new Uint8ClampedArray(n),1,1):n;la(i,s,!0,(()=>{!function(t,e,n,r){const i=t.g;if(i.activeTexture(i.TEXTURE0),i.bindTexture(i.TEXTURE_2D,e),i.activeTexture(i.TEXTURE1),i.bindTexture(i.TEXTURE_2D,t.C),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,i.RGBA,i.UNSIGNED_BYTE,n),t.I&&function(t,e){if(t!==e)return!1;t=t.entries(),e=e.entries();for(const[r,i]of t){t=r;const s=i;var n=e.next();if(n.done)return!1;const[o,a]=n.value;if(n=a,t!==o||s[0]!==n[0]||s[1]!==n[1]||s[2]!==n[2]||s[3]!==n[3])return!1}return!!e.next().done}(t.I,r))i.activeTexture(i.TEXTURE2),i.bindTexture(i.TEXTURE_2D,t.j);else{t.I=r;const e=Array(1024).fill(0);r.forEach(((t,n)=>{if(4!==t.length)throw Error(`Color at index ${n} is not a four-channel value.`);e[4*n]=t[0],e[4*n+1]=t[1],e[4*n+2]=t[2],e[4*n+3]=t[3]})),i.activeTexture(i.TEXTURE2),i.bindTexture(i.TEXTURE_2D,t.j),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,256,1,0,i.RGBA,i.UNSIGNED_BYTE,new Uint8Array(e))}}(i,e,o,r),s.clearColor(0,0,0,0),s.clear(s.COLOR_BUFFER_BIT),s.drawArrays(s.TRIANGLE_FAN,0,4);const t=i.g;t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,null),t.activeTexture(t.TEXTURE1),t.bindTexture(t.TEXTURE_2D,null),t.activeTexture(t.TEXTURE2),t.bindTexture(t.TEXTURE_2D,null)}))}function Da(t,e,n,r){const i=Oa(t),s=function(t){return t.h||(t.h=new ya),t.h}(t),o=Array.isArray(n)?new ImageData(new Uint8ClampedArray(n),1,1):n,a=Array.isArray(r)?new ImageData(new Uint8ClampedArray(r),1,1):r;la(s,i,!0,(()=>{var t=s.g;t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,e),t.activeTexture(t.TEXTURE1),t.bindTexture(t.TEXTURE_2D,s.j),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,o),t.activeTexture(t.TEXTURE2),t.bindTexture(t.TEXTURE_2D,s.C),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,a),i.clearColor(0,0,0,0),i.clear(i.COLOR_BUFFER_BIT),i.drawArrays(i.TRIANGLE_FAN,0,4),i.bindTexture(i.TEXTURE_2D,null),(t=s.g).activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,null),t.activeTexture(t.TEXTURE1),t.bindTexture(t.TEXTURE_2D,null),t.activeTexture(t.TEXTURE2),t.bindTexture(t.TEXTURE_2D,null)}))}var Na=class{constructor(t,e){t instanceof CanvasRenderingContext2D||t instanceof OffscreenCanvasRenderingContext2D?(this.l=t,this.j=e):this.j=t}Aa(t,e){if(t){var n=Ca(this);e=Ra(e),n.save();var r=n.canvas,i=0;for(const s of t)n.fillStyle=Ma(e.fillColor,{index:i,from:s}),n.strokeStyle=Ma(e.color,{index:i,from:s}),n.lineWidth=Ma(e.lineWidth,{index:i,from:s}),(t=new Path2D).arc(s.x*r.width,s.y*r.height,Ma(e.radius,{index:i,from:s}),0,2*Math.PI),n.fill(t),n.stroke(t),++i;n.restore()}}za(t,e,n){if(t&&e){var r=Ca(this);n=Ra(n),r.save();var i=r.canvas,s=0;for(const o of e){r.beginPath(),e=t[o.start];const a=t[o.end];e&&a&&(r.strokeStyle=Ma(n.color,{index:s,from:e,to:a}),r.lineWidth=Ma(n.lineWidth,{index:s,from:e,to:a}),r.moveTo(e.x*i.width,e.y*i.height),r.lineTo(a.x*i.width,a.y*i.height)),++s,r.stroke()}r.restore()}}wa(t,e){const n=Ca(this);e=Ra(e),n.save(),n.beginPath(),n.lineWidth=Ma(e.lineWidth,{}),n.strokeStyle=Ma(e.color,{}),n.fillStyle=Ma(e.fillColor,{}),n.moveTo(t.originX,t.originY),n.lineTo(t.originX+t.width,t.originY),n.lineTo(t.originX+t.width,t.originY+t.height),n.lineTo(t.originX,t.originY+t.height),n.lineTo(t.originX,t.originY),n.stroke(),n.fill(),n.restore()}xa(t,e,n=[0,0,0,255]){this.l?function(t,e,n,r){const i=Oa(t);Ia(t,e,(e=>{Ua(t,e,n,r),(e=Ca(t)).drawImage(i.canvas,0,0,e.canvas.width,e.canvas.height)}))}(this,t,n,e):Ua(this,t.O(),n,e)}ya(t,e,n){this.l?function(t,e,n,r){const i=Oa(t);Ia(t,e,(e=>{Da(t,e,n,r),(e=Ca(t)).drawImage(i.canvas,0,0,e.canvas.width,e.canvas.height)}))}(this,t,e,n):Da(this,t.O(),e,n)}close(){this.g?.close(),this.g=void 0,this.h?.close(),this.h=void 0,this.m?.close(),this.m=void 0}};function Ba(t,e){switch(e){case 0:return t.g.find((t=>t instanceof ImageData));case 1:return t.g.find((t=>\"undefined\"!=typeof ImageBitmap&&t instanceof ImageBitmap));case 2:return t.g.find((t=>\"undefined\"!=typeof WebGLTexture&&t instanceof WebGLTexture));default:throw Error(`Type is not supported: ${e}`)}}function Ga(t){var e=Ba(t,0);if(!e){e=Va(t);const n=Xa(t),r=new Uint8Array(t.width*t.height*4);fa(n,e,ja(t)),e.readPixels(0,0,t.width,t.height,e.RGBA,e.UNSIGNED_BYTE,r),pa(n),e=new ImageData(new Uint8ClampedArray(r.buffer),t.width,t.height),t.g.push(e)}return e}function ja(t){let e=Ba(t,2);if(!e){const n=Va(t);e=Ha(t);const r=Ba(t,1)||Ga(t);n.texImage2D(n.TEXTURE_2D,0,n.RGBA,n.RGBA,n.UNSIGNED_BYTE,r),Wa(t)}return e}function Va(t){if(!t.canvas)throw Error(\"Conversion to different image formats require that a canvas is passed when iniitializing the image.\");return t.h||(t.h=oa(t.canvas.getContext(\"webgl2\"),\"You cannot use a canvas that is already bound to a different type of rendering context.\")),t.h}function Xa(t){return t.l||(t.l=new ga),t.l}function Ha(t){const e=Va(t);e.viewport(0,0,t.width,t.height),e.activeTexture(e.TEXTURE0);let n=Ba(t,2);return n||(n=da(Xa(t),e),t.g.push(n),t.m=!0),e.bindTexture(e.TEXTURE_2D,n),n}function Wa(t){t.h.bindTexture(t.h.TEXTURE_2D,null)}function za(t){const e=Va(t);return la(Xa(t),e,!0,(()=>function(t,e){const n=t.canvas;if(n.width===t.width&&n.height===t.height)return e();const r=n.width,i=n.height;return n.width=t.width,n.height=t.height,t=e(),n.width=r,n.height=i,t}(t,(()=>{if(e.bindFramebuffer(e.FRAMEBUFFER,null),e.clearColor(0,0,0,0),e.clear(e.COLOR_BUFFER_BIT),e.drawArrays(e.TRIANGLE_FAN,0,4),!(t.canvas instanceof OffscreenCanvas))throw Error(\"Conversion to ImageBitmap requires that the MediaPipe Tasks is initialized with an OffscreenCanvas\");return t.canvas.transferToImageBitmap()}))))}Na.prototype.close=Na.prototype.close,Na.prototype.drawConfidenceMask=Na.prototype.ya,Na.prototype.drawCategoryMask=Na.prototype.xa,Na.prototype.drawBoundingBox=Na.prototype.wa,Na.prototype.drawConnectors=Na.prototype.za,Na.prototype.drawLandmarks=Na.prototype.Aa,Na.lerp=function(t,e,n,r,i){return Pa(r*(1-(t-e)/(n-e))+i*(1-(n-t)/(n-e)),r,i)},Na.clamp=Pa;var Ka=class{constructor(t,e,n,r,i,s,o){this.g=t,this.j=e,this.m=n,this.canvas=r,this.l=i,this.width=s,this.height=o,(this.j||this.m)&&(0===--Ya&&console.error(\"You seem to be creating MPImage instances without invoking .close(). This leaks resources.\"))}Ga(){return!!Ba(this,0)}ma(){return!!Ba(this,1)}R(){return!!Ba(this,2)}Ea(){return Ga(this)}Da(){var t=Ba(this,1);return t||(ja(this),Ha(this),t=za(this),Wa(this),this.g.push(t),this.j=!0),t}O(){return ja(this)}clone(){const t=[];for(const e of this.g){let n;if(e instanceof ImageData)n=new ImageData(e.data,this.width,this.height);else if(e instanceof WebGLTexture){const t=Va(this),e=Xa(this);t.activeTexture(t.TEXTURE1),n=da(e,t),t.bindTexture(t.TEXTURE_2D,n),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,this.width,this.height,0,t.RGBA,t.UNSIGNED_BYTE,null),t.bindTexture(t.TEXTURE_2D,null),fa(e,t,n),la(e,t,!1,(()=>{Ha(this),t.clearColor(0,0,0,0),t.clear(t.COLOR_BUFFER_BIT),t.drawArrays(t.TRIANGLE_FAN,0,4),Wa(this)})),pa(e),Wa(this)}else{if(!(e instanceof ImageBitmap))throw Error(`Type is not supported: ${e}`);ja(this),Ha(this),n=za(this),Wa(this)}t.push(n)}return new Ka(t,this.ma(),this.R(),this.canvas,this.l,this.width,this.height)}close(){this.j&&Ba(this,1).close(),this.m&&Va(this).deleteTexture(Ba(this,2)),Ya=-1}};Ka.prototype.close=Ka.prototype.close,Ka.prototype.clone=Ka.prototype.clone,Ka.prototype.getAsWebGLTexture=Ka.prototype.O,Ka.prototype.getAsImageBitmap=Ka.prototype.Da,Ka.prototype.getAsImageData=Ka.prototype.Ea,Ka.prototype.hasWebGLTexture=Ka.prototype.R,Ka.prototype.hasImageBitmap=Ka.prototype.ma,Ka.prototype.hasImageData=Ka.prototype.Ga;var Ya=250;function $a(...t){return t.map((([t,e])=>({start:t,end:e})))}const qa=function(t){return class extends t{Ma(){this.i._registerModelResourcesGraphService()}}}((Ja=class{constructor(t,e){this.l=!0,this.i=t,this.g=null,this.h=0,this.m=\"function\"==typeof this.i._addIntToInputStream,void 0!==e?this.i.canvas=e:Ho()?this.i.canvas=new OffscreenCanvas(1,1):(console.warn(\"OffscreenCanvas not supported and GraphRunner constructor glCanvas parameter is undefined. Creating backup canvas.\"),this.i.canvas=document.createElement(\"canvas\"))}async initializeGraph(t){const e=await(await fetch(t)).arrayBuffer();t=!(t.endsWith(\".pbtxt\")||t.endsWith(\".textproto\")),this.setGraph(new Uint8Array(e),t)}setGraphFromString(t){this.setGraph((new TextEncoder).encode(t),!1)}setGraph(t,e){const n=t.length,r=this.i._malloc(n);this.i.HEAPU8.set(t,r),e?this.i._changeBinaryGraph(n,r):this.i._changeTextGraph(n,r),this.i._free(r)}configureAudio(t,e,n,r,i){this.i._configureAudio||console.warn('Attempting to use configureAudio without support for input audio. Is build dep \":gl_graph_runner_audio\" missing?'),Ko(this,r||\"input_audio\",(r=>{Ko(this,i=i||\"audio_header\",(i=>{this.i._configureAudio(r,i,t,e,n)}))}))}setAutoResizeCanvas(t){this.l=t}setAutoRenderToScreen(t){this.i._setAutoRenderToScreen(t)}setGpuBufferVerticalFlip(t){this.i.gpuOriginForWebTexturesIsBottomLeft=t}fa(t){qo(this,\"__graph_config__\",(e=>{t(e)})),Ko(this,\"__graph_config__\",(t=>{this.i._getGraphConfig(t,void 0)})),delete this.i.simpleListeners.__graph_config__}attachErrorListener(t){this.i.errorListener=t}attachEmptyPacketListener(t,e){this.i.emptyPacketListeners=this.i.emptyPacketListeners||{},this.i.emptyPacketListeners[t]=e}addAudioToStream(t,e,n){this.addAudioToStreamWithShape(t,0,0,e,n)}addAudioToStreamWithShape(t,e,n,r,i){const s=4*t.length;this.h!==s&&(this.g&&this.i._free(this.g),this.g=this.i._malloc(s),this.h=s),this.i.HEAPF32.set(t,this.g/4),Ko(this,r,(t=>{this.i._addAudioToInputStream(this.g,e,n,t,i)}))}addGpuBufferToStream(t,e,n){Ko(this,e,(e=>{const[r,i]=Yo(this,t,e);this.i._addBoundTextureToStream(e,r,i,n)}))}addBoolToStream(t,e,n){Ko(this,e,(e=>{this.i._addBoolToInputStream(t,e,n)}))}addDoubleToStream(t,e,n){Ko(this,e,(e=>{this.i._addDoubleToInputStream(t,e,n)}))}addFloatToStream(t,e,n){Ko(this,e,(e=>{this.i._addFloatToInputStream(t,e,n)}))}addIntToStream(t,e,n){Ko(this,e,(e=>{this.i._addIntToInputStream(t,e,n)}))}addUintToStream(t,e,n){Ko(this,e,(e=>{this.i._addUintToInputStream(t,e,n)}))}addStringToStream(t,e,n){Ko(this,e,(e=>{Ko(this,t,(t=>{this.i._addStringToInputStream(t,e,n)}))}))}addStringRecordToStream(t,e,n){Ko(this,e,(e=>{$o(this,Object.keys(t),(r=>{$o(this,Object.values(t),(i=>{this.i._addFlatHashMapToInputStream(r,i,Object.keys(t).length,e,n)}))}))}))}addProtoToStream(t,e,n,r){Ko(this,n,(n=>{Ko(this,e,(e=>{const i=this.i._malloc(t.length);this.i.HEAPU8.set(t,i),this.i._addProtoToInputStream(i,t.length,e,n,r),this.i._free(i)}))}))}addEmptyPacketToStream(t,e){Ko(this,t,(t=>{this.i._addEmptyPacketToInputStream(t,e)}))}addBoolVectorToStream(t,e,n){Ko(this,e,(e=>{const r=this.i._allocateBoolVector(t.length);if(!r)throw Error(\"Unable to allocate new bool vector on heap.\");for(const e of t)this.i._addBoolVectorEntry(r,e);this.i._addBoolVectorToInputStream(r,e,n)}))}addDoubleVectorToStream(t,e,n){Ko(this,e,(e=>{const r=this.i._allocateDoubleVector(t.length);if(!r)throw Error(\"Unable to allocate new double vector on heap.\");for(const e of t)this.i._addDoubleVectorEntry(r,e);this.i._addDoubleVectorToInputStream(r,e,n)}))}addFloatVectorToStream(t,e,n){Ko(this,e,(e=>{const r=this.i._allocateFloatVector(t.length);if(!r)throw Error(\"Unable to allocate new float vector on heap.\");for(const e of t)this.i._addFloatVectorEntry(r,e);this.i._addFloatVectorToInputStream(r,e,n)}))}addIntVectorToStream(t,e,n){Ko(this,e,(e=>{const r=this.i._allocateIntVector(t.length);if(!r)throw Error(\"Unable to allocate new int vector on heap.\");for(const e of t)this.i._addIntVectorEntry(r,e);this.i._addIntVectorToInputStream(r,e,n)}))}addUintVectorToStream(t,e,n){Ko(this,e,(e=>{const r=this.i._allocateUintVector(t.length);if(!r)throw Error(\"Unable to allocate new unsigned int vector on heap.\");for(const e of t)this.i._addUintVectorEntry(r,e);this.i._addUintVectorToInputStream(r,e,n)}))}addStringVectorToStream(t,e,n){Ko(this,e,(e=>{const r=this.i._allocateStringVector(t.length);if(!r)throw Error(\"Unable to allocate new string vector on heap.\");for(const e of t)Ko(this,e,(t=>{this.i._addStringVectorEntry(r,t)}));this.i._addStringVectorToInputStream(r,e,n)}))}addBoolToInputSidePacket(t,e){Ko(this,e,(e=>{this.i._addBoolToInputSidePacket(t,e)}))}addDoubleToInputSidePacket(t,e){Ko(this,e,(e=>{this.i._addDoubleToInputSidePacket(t,e)}))}addFloatToInputSidePacket(t,e){Ko(this,e,(e=>{this.i._addFloatToInputSidePacket(t,e)}))}addIntToInputSidePacket(t,e){Ko(this,e,(e=>{this.i._addIntToInputSidePacket(t,e)}))}addUintToInputSidePacket(t,e){Ko(this,e,(e=>{this.i._addUintToInputSidePacket(t,e)}))}addStringToInputSidePacket(t,e){Ko(this,e,(e=>{Ko(this,t,(t=>{this.i._addStringToInputSidePacket(t,e)}))}))}addProtoToInputSidePacket(t,e,n){Ko(this,n,(n=>{Ko(this,e,(e=>{const r=this.i._malloc(t.length);this.i.HEAPU8.set(t,r),this.i._addProtoToInputSidePacket(r,t.length,e,n),this.i._free(r)}))}))}addBoolVectorToInputSidePacket(t,e){Ko(this,e,(e=>{const n=this.i._allocateBoolVector(t.length);if(!n)throw Error(\"Unable to allocate new bool vector on heap.\");for(const e of t)this.i._addBoolVectorEntry(n,e);this.i._addBoolVectorToInputSidePacket(n,e)}))}addDoubleVectorToInputSidePacket(t,e){Ko(this,e,(e=>{const n=this.i._allocateDoubleVector(t.length);if(!n)throw Error(\"Unable to allocate new double vector on heap.\");for(const e of t)this.i._addDoubleVectorEntry(n,e);this.i._addDoubleVectorToInputSidePacket(n,e)}))}addFloatVectorToInputSidePacket(t,e){Ko(this,e,(e=>{const n=this.i._allocateFloatVector(t.length);if(!n)throw Error(\"Unable to allocate new float vector on heap.\");for(const e of t)this.i._addFloatVectorEntry(n,e);this.i._addFloatVectorToInputSidePacket(n,e)}))}addIntVectorToInputSidePacket(t,e){Ko(this,e,(e=>{const n=this.i._allocateIntVector(t.length);if(!n)throw Error(\"Unable to allocate new int vector on heap.\");for(const e of t)this.i._addIntVectorEntry(n,e);this.i._addIntVectorToInputSidePacket(n,e)}))}addUintVectorToInputSidePacket(t,e){Ko(this,e,(e=>{const n=this.i._allocateUintVector(t.length);if(!n)throw Error(\"Unable to allocate new unsigned int vector on heap.\");for(const e of t)this.i._addUintVectorEntry(n,e);this.i._addUintVectorToInputSidePacket(n,e)}))}addStringVectorToInputSidePacket(t,e){Ko(this,e,(e=>{const n=this.i._allocateStringVector(t.length);if(!n)throw Error(\"Unable to allocate new string vector on heap.\");for(const e of t)Ko(this,e,(t=>{this.i._addStringVectorEntry(n,t)}));this.i._addStringVectorToInputSidePacket(n,e)}))}attachBoolListener(t,e){qo(this,t,e),Ko(this,t,(t=>{this.i._attachBoolListener(t)}))}attachBoolVectorListener(t,e){Jo(this,t,e),Ko(this,t,(t=>{this.i._attachBoolVectorListener(t)}))}attachIntListener(t,e){qo(this,t,e),Ko(this,t,(t=>{this.i._attachIntListener(t)}))}attachIntVectorListener(t,e){Jo(this,t,e),Ko(this,t,(t=>{this.i._attachIntVectorListener(t)}))}attachUintListener(t,e){qo(this,t,e),Ko(this,t,(t=>{this.i._attachUintListener(t)}))}attachUintVectorListener(t,e){Jo(this,t,e),Ko(this,t,(t=>{this.i._attachUintVectorListener(t)}))}attachDoubleListener(t,e){qo(this,t,e),Ko(this,t,(t=>{this.i._attachDoubleListener(t)}))}attachDoubleVectorListener(t,e){Jo(this,t,e),Ko(this,t,(t=>{this.i._attachDoubleVectorListener(t)}))}attachFloatListener(t,e){qo(this,t,e),Ko(this,t,(t=>{this.i._attachFloatListener(t)}))}attachFloatVectorListener(t,e){Jo(this,t,e),Ko(this,t,(t=>{this.i._attachFloatVectorListener(t)}))}attachStringListener(t,e){qo(this,t,e),Ko(this,t,(t=>{this.i._attachStringListener(t)}))}attachStringVectorListener(t,e){Jo(this,t,e),Ko(this,t,(t=>{this.i._attachStringVectorListener(t)}))}attachProtoListener(t,e,n){qo(this,t,e),Ko(this,t,(t=>{this.i._attachProtoListener(t,n||!1)}))}attachProtoVectorListener(t,e,n){Jo(this,t,e),Ko(this,t,(t=>{this.i._attachProtoVectorListener(t,n||!1)}))}attachAudioListener(t,e,n){this.i._attachAudioListener||console.warn('Attempting to use attachAudioListener without support for output audio. Is build dep \":gl_graph_runner_audio_out\" missing?'),qo(this,t,((t,n)=>{t=new Float32Array(t.buffer,t.byteOffset,t.length/4),e(t,n)})),Ko(this,t,(t=>{this.i._attachAudioListener(t,n||!1)}))}finishProcessing(){this.i._waitUntilIdle()}closeGraph(){this.i._closeGraph(),this.i.simpleListeners=void 0,this.i.emptyPacketListeners=void 0}},class extends Ja{get ha(){return this.i}sa(t,e,n){Ko(this,e,(e=>{const[r,i]=Yo(this,t,e);this.ha._addBoundTextureAsImageToStream(e,r,i,n)}))}W(t,e){qo(this,t,e),Ko(this,t,(t=>{this.ha._attachImageListener(t)}))}da(t,e){Jo(this,t,e),Ko(this,t,(t=>{this.ha._attachImageVectorListener(t)}))}}));var Ja,Za=class extends qa{};async function Qa(t,e,n){return async function(t,e,n,r){return Zo(t,e,n,r)}(t,n.canvas??(Ho()?void 0:document.createElement(\"canvas\")),e,n)}function th(t,e,n,r){if(t.V){const s=new fs;if(n?.regionOfInterest){if(!t.ra)throw Error(\"This task doesn't support region-of-interest.\");var i=n.regionOfInterest;if(i.left>=i.right||i.top>=i.bottom)throw Error(\"Expected RectF with left < right and top < bottom.\");if(0>i.left||0>i.top||1<i.right||1<i.bottom)throw Error(\"Expected RectF values to be in [0,1].\");Hn(s,1,(i.left+i.right)/2),Hn(s,2,(i.top+i.bottom)/2),Hn(s,4,i.right-i.left),Hn(s,3,i.bottom-i.top)}else Hn(s,1,.5),Hn(s,2,.5),Hn(s,4,1),Hn(s,3,1);if(n?.rotationDegrees){if(0!=n?.rotationDegrees%90)throw Error(\"Expected rotation to be a multiple of 90.\");if(Hn(s,5,-Math.PI*n.rotationDegrees/180),0!=n?.rotationDegrees%180){const[t,r]=zo(e);n=Gn(s,3)*r/t,i=Gn(s,4)*t/r,Hn(s,4,n),Hn(s,3,i)}}t.g.addProtoToStream(s.g(),\"mediapipe.NormalizedRect\",t.V,r)}t.g.sa(e,t.ba,r??performance.now()),t.finishProcessing()}function eh(t,e,n){if(t.baseOptions?.g())throw Error(\"Task is not initialized with image mode. 'runningMode' must be set to 'IMAGE'.\");th(t,e,n,t.J+1)}function nh(t,e,n,r){if(!t.baseOptions?.g())throw Error(\"Task is not initialized with video mode. 'runningMode' must be set to 'VIDEO'.\");th(t,e,n,r)}function rh(t,e,n,r){var i=e.data;const s=e.width,o=s*(e=e.height);if((i instanceof Uint8Array||i instanceof Float32Array)&&i.length!==o)throw Error(\"Unsupported channel count: \"+i.length/o);return t=new Sa([i],n,!1,t.g.i.canvas,t.M,s,e),r?t.clone():t}var ih=class extends sa{constructor(t,e,n,r){super(t),this.g=t,this.ba=e,this.V=n,this.ra=r,this.M=new ga}l(t,e=!0){if(\"runningMode\"in t&&Vn(this.baseOptions,2,!!t.runningMode&&\"IMAGE\"!==t.runningMode),void 0!==t.canvas&&this.g.i.canvas!==t.canvas)throw Error(\"You must create a new task to reset the canvas.\");return super.l(t,e)}close(){this.M.close(),super.close()}};ih.prototype.close=ih.prototype.close;var sh=class extends ih{constructor(t,e){super(new Za(t,e),\"image_in\",\"norm_rect_in\",!1),this.j={detections:[]},Cn(t=this.h=new Is,0,1,e=new Cs),Hn(this.h,2,.5),Hn(this.h,3,.3)}get baseOptions(){return Rn(this.h,Cs,1)}set baseOptions(t){Cn(this.h,0,1,t)}o(t){return\"minDetectionConfidence\"in t&&Hn(this.h,2,t.minDetectionConfidence??.5),\"minSuppressionThreshold\"in t&&Hn(this.h,3,t.minSuppressionThreshold??.3),this.l(t)}F(t,e){return this.j={detections:[]},eh(this,t,e),this.j}G(t,e,n){return this.j={detections:[]},nh(this,t,n,e),this.j}m(){var t=new Di;Ii(t,\"image_in\"),Ii(t,\"norm_rect_in\"),Ui(t,\"detections\");const e=new yi;Wn(e,Ds,this.h);const n=new Li;ki(n,\"mediapipe.tasks.vision.face_detector.FaceDetectorGraph\"),xi(n,\"IMAGE:image_in\"),xi(n,\"NORM_RECT:norm_rect_in\"),Si(n,\"DETECTIONS:detections\"),n.o(e),Oi(t,n),this.g.attachProtoVectorListener(\"detections\",((t,e)=>{for(const e of t)t=ns(e),this.j.detections.push(Oo(t));ea(this,e)})),this.g.attachEmptyPacketListener(\"detections\",(t=>{ea(this,t)})),t=t.g(),this.setGraph(new Uint8Array(t),!0)}};sh.prototype.detectForVideo=sh.prototype.G,sh.prototype.detect=sh.prototype.F,sh.prototype.setOptions=sh.prototype.o,sh.createFromModelPath=async function(t,e){return Qa(sh,t,{baseOptions:{modelAssetPath:e}})},sh.createFromModelBuffer=function(t,e){return Qa(sh,t,{baseOptions:{modelAssetBuffer:e}})},sh.createFromOptions=function(t,e){return Qa(sh,t,e)};var oh=$a([61,146],[146,91],[91,181],[181,84],[84,17],[17,314],[314,405],[405,321],[321,375],[375,291],[61,185],[185,40],[40,39],[39,37],[37,0],[0,267],[267,269],[269,270],[270,409],[409,291],[78,95],[95,88],[88,178],[178,87],[87,14],[14,317],[317,402],[402,318],[318,324],[324,308],[78,191],[191,80],[80,81],[81,82],[82,13],[13,312],[312,311],[311,310],[310,415],[415,308]),ah=$a([263,249],[249,390],[390,373],[373,374],[374,380],[380,381],[381,382],[382,362],[263,466],[466,388],[388,387],[387,386],[386,385],[385,384],[384,398],[398,362]),hh=$a([276,283],[283,282],[282,295],[295,285],[300,293],[293,334],[334,296],[296,336]),ch=$a([474,475],[475,476],[476,477],[477,474]),uh=$a([33,7],[7,163],[163,144],[144,145],[145,153],[153,154],[154,155],[155,133],[33,246],[246,161],[161,160],[160,159],[159,158],[158,157],[157,173],[173,133]),lh=$a([46,53],[53,52],[52,65],[65,55],[70,63],[63,105],[105,66],[66,107]),dh=$a([469,470],[470,471],[471,472],[472,469]),fh=$a([10,338],[338,297],[297,332],[332,284],[284,251],[251,389],[389,356],[356,454],[454,323],[323,361],[361,288],[288,397],[397,365],[365,379],[379,378],[378,400],[400,377],[377,152],[152,148],[148,176],[176,149],[149,150],[150,136],[136,172],[172,58],[58,132],[132,93],[93,234],[234,127],[127,162],[162,21],[21,54],[54,103],[103,67],[67,109],[109,10]),ph=[...oh,...ah,...hh,...uh,...lh,...fh],gh=$a([127,34],[34,139],[139,127],[11,0],[0,37],[37,11],[232,231],[231,120],[120,232],[72,37],[37,39],[39,72],[128,121],[121,47],[47,128],[232,121],[121,128],[128,232],[104,69],[69,67],[67,104],[175,171],[171,148],[148,175],[118,50],[50,101],[101,118],[73,39],[39,40],[40,73],[9,151],[151,108],[108,9],[48,115],[115,131],[131,48],[194,204],[204,211],[211,194],[74,40],[40,185],[185,74],[80,42],[42,183],[183,80],[40,92],[92,186],[186,40],[230,229],[229,118],[118,230],[202,212],[212,214],[214,202],[83,18],[18,17],[17,83],[76,61],[61,146],[146,76],[160,29],[29,30],[30,160],[56,157],[157,173],[173,56],[106,204],[204,194],[194,106],[135,214],[214,192],[192,135],[203,165],[165,98],[98,203],[21,71],[71,68],[68,21],[51,45],[45,4],[4,51],[144,24],[24,23],[23,144],[77,146],[146,91],[91,77],[205,50],[50,187],[187,205],[201,200],[200,18],[18,201],[91,106],[106,182],[182,91],[90,91],[91,181],[181,90],[85,84],[84,17],[17,85],[206,203],[203,36],[36,206],[148,171],[171,140],[140,148],[92,40],[40,39],[39,92],[193,189],[189,244],[244,193],[159,158],[158,28],[28,159],[247,246],[246,161],[161,247],[236,3],[3,196],[196,236],[54,68],[68,104],[104,54],[193,168],[168,8],[8,193],[117,228],[228,31],[31,117],[189,193],[193,55],[55,189],[98,97],[97,99],[99,98],[126,47],[47,100],[100,126],[166,79],[79,218],[218,166],[155,154],[154,26],[26,155],[209,49],[49,131],[131,209],[135,136],[136,150],[150,135],[47,126],[126,217],[217,47],[223,52],[52,53],[53,223],[45,51],[51,134],[134,45],[211,170],[170,140],[140,211],[67,69],[69,108],[108,67],[43,106],[106,91],[91,43],[230,119],[119,120],[120,230],[226,130],[130,247],[247,226],[63,53],[53,52],[52,63],[238,20],[20,242],[242,238],[46,70],[70,156],[156,46],[78,62],[62,96],[96,78],[46,53],[53,63],[63,46],[143,34],[34,227],[227,143],[123,117],[117,111],[111,123],[44,125],[125,19],[19,44],[236,134],[134,51],[51,236],[216,206],[206,205],[205,216],[154,153],[153,22],[22,154],[39,37],[37,167],[167,39],[200,201],[201,208],[208,200],[36,142],[142,100],[100,36],[57,212],[212,202],[202,57],[20,60],[60,99],[99,20],[28,158],[158,157],[157,28],[35,226],[226,113],[113,35],[160,159],[159,27],[27,160],[204,202],[202,210],[210,204],[113,225],[225,46],[46,113],[43,202],[202,204],[204,43],[62,76],[76,77],[77,62],[137,123],[123,116],[116,137],[41,38],[38,72],[72,41],[203,129],[129,142],[142,203],[64,98],[98,240],[240,64],[49,102],[102,64],[64,49],[41,73],[73,74],[74,41],[212,216],[216,207],[207,212],[42,74],[74,184],[184,42],[169,170],[170,211],[211,169],[170,149],[149,176],[176,170],[105,66],[66,69],[69,105],[122,6],[6,168],[168,122],[123,147],[147,187],[187,123],[96,77],[77,90],[90,96],[65,55],[55,107],[107,65],[89,90],[90,180],[180,89],[101,100],[100,120],[120,101],[63,105],[105,104],[104,63],[93,137],[137,227],[227,93],[15,86],[86,85],[85,15],[129,102],[102,49],[49,129],[14,87],[87,86],[86,14],[55,8],[8,9],[9,55],[100,47],[47,121],[121,100],[145,23],[23,22],[22,145],[88,89],[89,179],[179,88],[6,122],[122,196],[196,6],[88,95],[95,96],[96,88],[138,172],[172,136],[136,138],[215,58],[58,172],[172,215],[115,48],[48,219],[219,115],[42,80],[80,81],[81,42],[195,3],[3,51],[51,195],[43,146],[146,61],[61,43],[171,175],[175,199],[199,171],[81,82],[82,38],[38,81],[53,46],[46,225],[225,53],[144,163],[163,110],[110,144],[52,65],[65,66],[66,52],[229,228],[228,117],[117,229],[34,127],[127,234],[234,34],[107,108],[108,69],[69,107],[109,108],[108,151],[151,109],[48,64],[64,235],[235,48],[62,78],[78,191],[191,62],[129,209],[209,126],[126,129],[111,35],[35,143],[143,111],[117,123],[123,50],[50,117],[222,65],[65,52],[52,222],[19,125],[125,141],[141,19],[221,55],[55,65],[65,221],[3,195],[195,197],[197,3],[25,7],[7,33],[33,25],[220,237],[237,44],[44,220],[70,71],[71,139],[139,70],[122,193],[193,245],[245,122],[247,130],[130,33],[33,247],[71,21],[21,162],[162,71],[170,169],[169,150],[150,170],[188,174],[174,196],[196,188],[216,186],[186,92],[92,216],[2,97],[97,167],[167,2],[141,125],[125,241],[241,141],[164,167],[167,37],[37,164],[72,38],[38,12],[12,72],[38,82],[82,13],[13,38],[63,68],[68,71],[71,63],[226,35],[35,111],[111,226],[101,50],[50,205],[205,101],[206,92],[92,165],[165,206],[209,198],[198,217],[217,209],[165,167],[167,97],[97,165],[220,115],[115,218],[218,220],[133,112],[112,243],[243,133],[239,238],[238,241],[241,239],[214,135],[135,169],[169,214],[190,173],[173,133],[133,190],[171,208],[208,32],[32,171],[125,44],[44,237],[237,125],[86,87],[87,178],[178,86],[85,86],[86,179],[179,85],[84,85],[85,180],[180,84],[83,84],[84,181],[181,83],[201,83],[83,182],[182,201],[137,93],[93,132],[132,137],[76,62],[62,183],[183,76],[61,76],[76,184],[184,61],[57,61],[61,185],[185,57],[212,57],[57,186],[186,212],[214,207],[207,187],[187,214],[34,143],[143,156],[156,34],[79,239],[239,237],[237,79],[123,137],[137,177],[177,123],[44,1],[1,4],[4,44],[201,194],[194,32],[32,201],[64,102],[102,129],[129,64],[213,215],[215,138],[138,213],[59,166],[166,219],[219,59],[242,99],[99,97],[97,242],[2,94],[94,141],[141,2],[75,59],[59,235],[235,75],[24,110],[110,228],[228,24],[25,130],[130,226],[226,25],[23,24],[24,229],[229,23],[22,23],[23,230],[230,22],[26,22],[22,231],[231,26],[112,26],[26,232],[232,112],[189,190],[190,243],[243,189],[221,56],[56,190],[190,221],[28,56],[56,221],[221,28],[27,28],[28,222],[222,27],[29,27],[27,223],[223,29],[30,29],[29,224],[224,30],[247,30],[30,225],[225,247],[238,79],[79,20],[20,238],[166,59],[59,75],[75,166],[60,75],[75,240],[240,60],[147,177],[177,215],[215,147],[20,79],[79,166],[166,20],[187,147],[147,213],[213,187],[112,233],[233,244],[244,112],[233,128],[128,245],[245,233],[128,114],[114,188],[188,128],[114,217],[217,174],[174,114],[131,115],[115,220],[220,131],[217,198],[198,236],[236,217],[198,131],[131,134],[134,198],[177,132],[132,58],[58,177],[143,35],[35,124],[124,143],[110,163],[163,7],[7,110],[228,110],[110,25],[25,228],[356,389],[389,368],[368,356],[11,302],[302,267],[267,11],[452,350],[350,349],[349,452],[302,303],[303,269],[269,302],[357,343],[343,277],[277,357],[452,453],[453,357],[357,452],[333,332],[332,297],[297,333],[175,152],[152,377],[377,175],[347,348],[348,330],[330,347],[303,304],[304,270],[270,303],[9,336],[336,337],[337,9],[278,279],[279,360],[360,278],[418,262],[262,431],[431,418],[304,408],[408,409],[409,304],[310,415],[415,407],[407,310],[270,409],[409,410],[410,270],[450,348],[348,347],[347,450],[422,430],[430,434],[434,422],[313,314],[314,17],[17,313],[306,307],[307,375],[375,306],[387,388],[388,260],[260,387],[286,414],[414,398],[398,286],[335,406],[406,418],[418,335],[364,367],[367,416],[416,364],[423,358],[358,327],[327,423],[251,284],[284,298],[298,251],[281,5],[5,4],[4,281],[373,374],[374,253],[253,373],[307,320],[320,321],[321,307],[425,427],[427,411],[411,425],[421,313],[313,18],[18,421],[321,405],[405,406],[406,321],[320,404],[404,405],[405,320],[315,16],[16,17],[17,315],[426,425],[425,266],[266,426],[377,400],[400,369],[369,377],[322,391],[391,269],[269,322],[417,465],[465,464],[464,417],[386,257],[257,258],[258,386],[466,260],[260,388],[388,466],[456,399],[399,419],[419,456],[284,332],[332,333],[333,284],[417,285],[285,8],[8,417],[346,340],[340,261],[261,346],[413,441],[441,285],[285,413],[327,460],[460,328],[328,327],[355,371],[371,329],[329,355],[392,439],[439,438],[438,392],[382,341],[341,256],[256,382],[429,420],[420,360],[360,429],[364,394],[394,379],[379,364],[277,343],[343,437],[437,277],[443,444],[444,283],[283,443],[275,440],[440,363],[363,275],[431,262],[262,369],[369,431],[297,338],[338,337],[337,297],[273,375],[375,321],[321,273],[450,451],[451,349],[349,450],[446,342],[342,467],[467,446],[293,334],[334,282],[282,293],[458,461],[461,462],[462,458],[276,353],[353,383],[383,276],[308,324],[324,325],[325,308],[276,300],[300,293],[293,276],[372,345],[345,447],[447,372],[352,345],[345,340],[340,352],[274,1],[1,19],[19,274],[456,248],[248,281],[281,456],[436,427],[427,425],[425,436],[381,256],[256,252],[252,381],[269,391],[391,393],[393,269],[200,199],[199,428],[428,200],[266,330],[330,329],[329,266],[287,273],[273,422],[422,287],[250,462],[462,328],[328,250],[258,286],[286,384],[384,258],[265,353],[353,342],[342,265],[387,259],[259,257],[257,387],[424,431],[431,430],[430,424],[342,353],[353,276],[276,342],[273,335],[335,424],[424,273],[292,325],[325,307],[307,292],[366,447],[447,345],[345,366],[271,303],[303,302],[302,271],[423,266],[266,371],[371,423],[294,455],[455,460],[460,294],[279,278],[278,294],[294,279],[271,272],[272,304],[304,271],[432,434],[434,427],[427,432],[272,407],[407,408],[408,272],[394,430],[430,431],[431,394],[395,369],[369,400],[400,395],[334,333],[333,299],[299,334],[351,417],[417,168],[168,351],[352,280],[280,411],[411,352],[325,319],[319,320],[320,325],[295,296],[296,336],[336,295],[319,403],[403,404],[404,319],[330,348],[348,349],[349,330],[293,298],[298,333],[333,293],[323,454],[454,447],[447,323],[15,16],[16,315],[315,15],[358,429],[429,279],[279,358],[14,15],[15,316],[316,14],[285,336],[336,9],[9,285],[329,349],[349,350],[350,329],[374,380],[380,252],[252,374],[318,402],[402,403],[403,318],[6,197],[197,419],[419,6],[318,319],[319,325],[325,318],[367,364],[364,365],[365,367],[435,367],[367,397],[397,435],[344,438],[438,439],[439,344],[272,271],[271,311],[311,272],[195,5],[5,281],[281,195],[273,287],[287,291],[291,273],[396,428],[428,199],[199,396],[311,271],[271,268],[268,311],[283,444],[444,445],[445,283],[373,254],[254,339],[339,373],[282,334],[334,296],[296,282],[449,347],[347,346],[346,449],[264,447],[447,454],[454,264],[336,296],[296,299],[299,336],[338,10],[10,151],[151,338],[278,439],[439,455],[455,278],[292,407],[407,415],[415,292],[358,371],[371,355],[355,358],[340,345],[345,372],[372,340],[346,347],[347,280],[280,346],[442,443],[443,282],[282,442],[19,94],[94,370],[370,19],[441,442],[442,295],[295,441],[248,419],[419,197],[197,248],[263,255],[255,359],[359,263],[440,275],[275,274],[274,440],[300,383],[383,368],[368,300],[351,412],[412,465],[465,351],[263,467],[467,466],[466,263],[301,368],[368,389],[389,301],[395,378],[378,379],[379,395],[412,351],[351,419],[419,412],[436,426],[426,322],[322,436],[2,164],[164,393],[393,2],[370,462],[462,461],[461,370],[164,0],[0,267],[267,164],[302,11],[11,12],[12,302],[268,12],[12,13],[13,268],[293,300],[300,301],[301,293],[446,261],[261,340],[340,446],[330,266],[266,425],[425,330],[426,423],[423,391],[391,426],[429,355],[355,437],[437,429],[391,327],[327,326],[326,391],[440,457],[457,438],[438,440],[341,382],[382,362],[362,341],[459,457],[457,461],[461,459],[434,430],[430,394],[394,434],[414,463],[463,362],[362,414],[396,369],[369,262],[262,396],[354,461],[461,457],[457,354],[316,403],[403,402],[402,316],[315,404],[404,403],[403,315],[314,405],[405,404],[404,314],[313,406],[406,405],[405,313],[421,418],[418,406],[406,421],[366,401],[401,361],[361,366],[306,408],[408,407],[407,306],[291,409],[409,408],[408,291],[287,410],[410,409],[409,287],[432,436],[436,410],[410,432],[434,416],[416,411],[411,434],[264,368],[368,383],[383,264],[309,438],[438,457],[457,309],[352,376],[376,401],[401,352],[274,275],[275,4],[4,274],[421,428],[428,262],[262,421],[294,327],[327,358],[358,294],[433,416],[416,367],[367,433],[289,455],[455,439],[439,289],[462,370],[370,326],[326,462],[2,326],[326,370],[370,2],[305,460],[460,455],[455,305],[254,449],[449,448],[448,254],[255,261],[261,446],[446,255],[253,450],[450,449],[449,253],[252,451],[451,450],[450,252],[256,452],[452,451],[451,256],[341,453],[453,452],[452,341],[413,464],[464,463],[463,413],[441,413],[413,414],[414,441],[258,442],[442,441],[441,258],[257,443],[443,442],[442,257],[259,444],[444,443],[443,259],[260,445],[445,444],[444,260],[467,342],[342,445],[445,467],[459,458],[458,250],[250,459],[289,392],[392,290],[290,289],[290,328],[328,460],[460,290],[376,433],[433,435],[435,376],[250,290],[290,392],[392,250],[411,416],[416,433],[433,411],[341,463],[463,464],[464,341],[453,464],[464,465],[465,453],[357,465],[465,412],[412,357],[343,412],[412,399],[399,343],[360,363],[363,440],[440,360],[437,399],[399,456],[456,437],[420,456],[456,363],[363,420],[401,435],[435,288],[288,401],[372,383],[383,353],[353,372],[339,255],[255,249],[249,339],[448,261],[261,255],[255,448],[133,243],[243,190],[190,133],[133,155],[155,112],[112,133],[33,246],[246,247],[247,33],[33,130],[130,25],[25,33],[398,384],[384,286],[286,398],[362,398],[398,414],[414,362],[362,463],[463,341],[341,362],[263,359],[359,467],[467,263],[263,249],[249,255],[255,263],[466,467],[467,260],[260,466],[75,60],[60,166],[166,75],[238,239],[239,79],[79,238],[162,127],[127,139],[139,162],[72,11],[11,37],[37,72],[121,232],[232,120],[120,121],[73,72],[72,39],[39,73],[114,128],[128,47],[47,114],[233,232],[232,128],[128,233],[103,104],[104,67],[67,103],[152,175],[175,148],[148,152],[119,118],[118,101],[101,119],[74,73],[73,40],[40,74],[107,9],[9,108],[108,107],[49,48],[48,131],[131,49],[32,194],[194,211],[211,32],[184,74],[74,185],[185,184],[191,80],[80,183],[183,191],[185,40],[40,186],[186,185],[119,230],[230,118],[118,119],[210,202],[202,214],[214,210],[84,83],[83,17],[17,84],[77,76],[76,146],[146,77],[161,160],[160,30],[30,161],[190,56],[56,173],[173,190],[182,106],[106,194],[194,182],[138,135],[135,192],[192,138],[129,203],[203,98],[98,129],[54,21],[21,68],[68,54],[5,51],[51,4],[4,5],[145,144],[144,23],[23,145],[90,77],[77,91],[91,90],[207,205],[205,187],[187,207],[83,201],[201,18],[18,83],[181,91],[91,182],[182,181],[180,90],[90,181],[181,180],[16,85],[85,17],[17,16],[205,206],[206,36],[36,205],[176,148],[148,140],[140,176],[165,92],[92,39],[39,165],[245,193],[193,244],[244,245],[27,159],[159,28],[28,27],[30,247],[247,161],[161,30],[174,236],[236,196],[196,174],[103,54],[54,104],[104,103],[55,193],[193,8],[8,55],[111,117],[117,31],[31,111],[221,189],[189,55],[55,221],[240,98],[98,99],[99,240],[142,126],[126,100],[100,142],[219,166],[166,218],[218,219],[112,155],[155,26],[26,112],[198,209],[209,131],[131,198],[169,135],[135,150],[150,169],[114,47],[47,217],[217,114],[224,223],[223,53],[53,224],[220,45],[45,134],[134,220],[32,211],[211,140],[140,32],[109,67],[67,108],[108,109],[146,43],[43,91],[91,146],[231,230],[230,120],[120,231],[113,226],[226,247],[247,113],[105,63],[63,52],[52,105],[241,238],[238,242],[242,241],[124,46],[46,156],[156,124],[95,78],[78,96],[96,95],[70,46],[46,63],[63,70],[116,143],[143,227],[227,116],[116,123],[123,111],[111,116],[1,44],[44,19],[19,1],[3,236],[236,51],[51,3],[207,216],[216,205],[205,207],[26,154],[154,22],[22,26],[165,39],[39,167],[167,165],[199,200],[200,208],[208,199],[101,36],[36,100],[100,101],[43,57],[57,202],[202,43],[242,20],[20,99],[99,242],[56,28],[28,157],[157,56],[124,35],[35,113],[113,124],[29,160],[160,27],[27,29],[211,204],[204,210],[210,211],[124,113],[113,46],[46,124],[106,43],[43,204],[204,106],[96,62],[62,77],[77,96],[227,137],[137,116],[116,227],[73,41],[41,72],[72,73],[36,203],[203,142],[142,36],[235,64],[64,240],[240,235],[48,49],[49,64],[64,48],[42,41],[41,74],[74,42],[214,212],[212,207],[207,214],[183,42],[42,184],[184,183],[210,169],[169,211],[211,210],[140,170],[170,176],[176,140],[104,105],[105,69],[69,104],[193,122],[122,168],[168,193],[50,123],[123,187],[187,50],[89,96],[96,90],[90,89],[66,65],[65,107],[107,66],[179,89],[89,180],[180,179],[119,101],[101,120],[120,119],[68,63],[63,104],[104,68],[234,93],[93,227],[227,234],[16,15],[15,85],[85,16],[209,129],[129,49],[49,209],[15,14],[14,86],[86,15],[107,55],[55,9],[9,107],[120,100],[100,121],[121,120],[153,145],[145,22],[22,153],[178,88],[88,179],[179,178],[197,6],[6,196],[196,197],[89,88],[88,96],[96,89],[135,138],[138,136],[136,135],[138,215],[215,172],[172,138],[218,115],[115,219],[219,218],[41,42],[42,81],[81,41],[5,195],[195,51],[51,5],[57,43],[43,61],[61,57],[208,171],[171,199],[199,208],[41,81],[81,38],[38,41],[224,53],[53,225],[225,224],[24,144],[144,110],[110,24],[105,52],[52,66],[66,105],[118,229],[229,117],[117,118],[227,34],[34,234],[234,227],[66,107],[107,69],[69,66],[10,109],[109,151],[151,10],[219,48],[48,235],[235,219],[183,62],[62,191],[191,183],[142,129],[129,126],[126,142],[116,111],[111,143],[143,116],[118,117],[117,50],[50,118],[223,222],[222,52],[52,223],[94,19],[19,141],[141,94],[222,221],[221,65],[65,222],[196,3],[3,197],[197,196],[45,220],[220,44],[44,45],[156,70],[70,139],[139,156],[188,122],[122,245],[245,188],[139,71],[71,162],[162,139],[149,170],[170,150],[150,149],[122,188],[188,196],[196,122],[206,216],[216,92],[92,206],[164,2],[2,167],[167,164],[242,141],[141,241],[241,242],[0,164],[164,37],[37,0],[11,72],[72,12],[12,11],[12,38],[38,13],[13,12],[70,63],[63,71],[71,70],[31,226],[226,111],[111,31],[36,101],[101,205],[205,36],[203,206],[206,165],[165,203],[126,209],[209,217],[217,126],[98,165],[165,97],[97,98],[237,220],[220,218],[218,237],[237,239],[239,241],[241,237],[210,214],[214,169],[169,210],[140,171],[171,32],[32,140],[241,125],[125,237],[237,241],[179,86],[86,178],[178,179],[180,85],[85,179],[179,180],[181,84],[84,180],[180,181],[182,83],[83,181],[181,182],[194,201],[201,182],[182,194],[177,137],[137,132],[132,177],[184,76],[76,183],[183,184],[185,61],[61,184],[184,185],[186,57],[57,185],[185,186],[216,212],[212,186],[186,216],[192,214],[214,187],[187,192],[139,34],[34,156],[156,139],[218,79],[79,237],[237,218],[147,123],[123,177],[177,147],[45,44],[44,4],[4,45],[208,201],[201,32],[32,208],[98,64],[64,129],[129,98],[192,213],[213,138],[138,192],[235,59],[59,219],[219,235],[141,242],[242,97],[97,141],[97,2],[2,141],[141,97],[240,75],[75,235],[235,240],[229,24],[24,228],[228,229],[31,25],[25,226],[226,31],[230,23],[23,229],[229,230],[231,22],[22,230],[230,231],[232,26],[26,231],[231,232],[233,112],[112,232],[232,233],[244,189],[189,243],[243,244],[189,221],[221,190],[190,189],[222,28],[28,221],[221,222],[223,27],[27,222],[222,223],[224,29],[29,223],[223,224],[225,30],[30,224],[224,225],[113,247],[247,225],[225,113],[99,60],[60,240],[240,99],[213,147],[147,215],[215,213],[60,20],[20,166],[166,60],[192,187],[187,213],[213,192],[243,112],[112,244],[244,243],[244,233],[233,245],[245,244],[245,128],[128,188],[188,245],[188,114],[114,174],[174,188],[134,131],[131,220],[220,134],[174,217],[217,236],[236,174],[236,198],[198,134],[134,236],[215,177],[177,58],[58,215],[156,143],[143,124],[124,156],[25,110],[110,7],[7,25],[31,228],[228,25],[25,31],[264,356],[356,368],[368,264],[0,11],[11,267],[267,0],[451,452],[452,349],[349,451],[267,302],[302,269],[269,267],[350,357],[357,277],[277,350],[350,452],[452,357],[357,350],[299,333],[333,297],[297,299],[396,175],[175,377],[377,396],[280,347],[347,330],[330,280],[269,303],[303,270],[270,269],[151,9],[9,337],[337,151],[344,278],[278,360],[360,344],[424,418],[418,431],[431,424],[270,304],[304,409],[409,270],[272,310],[310,407],[407,272],[322,270],[270,410],[410,322],[449,450],[450,347],[347,449],[432,422],[422,434],[434,432],[18,313],[313,17],[17,18],[291,306],[306,375],[375,291],[259,387],[387,260],[260,259],[424,335],[335,418],[418,424],[434,364],[364,416],[416,434],[391,423],[423,327],[327,391],[301,251],[251,298],[298,301],[275,281],[281,4],[4,275],[254,373],[373,253],[253,254],[375,307],[307,321],[321,375],[280,425],[425,411],[411,280],[200,421],[421,18],[18,200],[335,321],[321,406],[406,335],[321,320],[320,405],[405,321],[314,315],[315,17],[17,314],[423,426],[426,266],[266,423],[396,377],[377,369],[369,396],[270,322],[322,269],[269,270],[413,417],[417,464],[464,413],[385,386],[386,258],[258,385],[248,456],[456,419],[419,248],[298,284],[284,333],[333,298],[168,417],[417,8],[8,168],[448,346],[346,261],[261,448],[417,413],[413,285],[285,417],[326,327],[327,328],[328,326],[277,355],[355,329],[329,277],[309,392],[392,438],[438,309],[381,382],[382,256],[256,381],[279,429],[429,360],[360,279],[365,364],[364,379],[379,365],[355,277],[277,437],[437,355],[282,443],[443,283],[283,282],[281,275],[275,363],[363,281],[395,431],[431,369],[369,395],[299,297],[297,337],[337,299],[335,273],[273,321],[321,335],[348,450],[450,349],[349,348],[359,446],[446,467],[467,359],[283,293],[293,282],[282,283],[250,458],[458,462],[462,250],[300,276],[276,383],[383,300],[292,308],[308,325],[325,292],[283,276],[276,293],[293,283],[264,372],[372,447],[447,264],[346,352],[352,340],[340,346],[354,274],[274,19],[19,354],[363,456],[456,281],[281,363],[426,436],[436,425],[425,426],[380,381],[381,252],[252,380],[267,269],[269,393],[393,267],[421,200],[200,428],[428,421],[371,266],[266,329],[329,371],[432,287],[287,422],[422,432],[290,250],[250,328],[328,290],[385,258],[258,384],[384,385],[446,265],[265,342],[342,446],[386,387],[387,257],[257,386],[422,424],[424,430],[430,422],[445,342],[342,276],[276,445],[422,273],[273,424],[424,422],[306,292],[292,307],[307,306],[352,366],[366,345],[345,352],[268,271],[271,302],[302,268],[358,423],[423,371],[371,358],[327,294],[294,460],[460,327],[331,279],[279,294],[294,331],[303,271],[271,304],[304,303],[436,432],[432,427],[427,436],[304,272],[272,408],[408,304],[395,394],[394,431],[431,395],[378,395],[395,400],[400,378],[296,334],[334,299],[299,296],[6,351],[351,168],[168,6],[376,352],[352,411],[411,376],[307,325],[325,320],[320,307],[285,295],[295,336],[336,285],[320,319],[319,404],[404,320],[329,330],[330,349],[349,329],[334,293],[293,333],[333,334],[366,323],[323,447],[447,366],[316,15],[15,315],[315,316],[331,358],[358,279],[279,331],[317,14],[14,316],[316,317],[8,285],[285,9],[9,8],[277,329],[329,350],[350,277],[253,374],[374,252],[252,253],[319,318],[318,403],[403,319],[351,6],[6,419],[419,351],[324,318],[318,325],[325,324],[397,367],[367,365],[365,397],[288,435],[435,397],[397,288],[278,344],[344,439],[439,278],[310,272],[272,311],[311,310],[248,195],[195,281],[281,248],[375,273],[273,291],[291,375],[175,396],[396,199],[199,175],[312,311],[311,268],[268,312],[276,283],[283,445],[445,276],[390,373],[373,339],[339,390],[295,282],[282,296],[296,295],[448,449],[449,346],[346,448],[356,264],[264,454],[454,356],[337,336],[336,299],[299,337],[337,338],[338,151],[151,337],[294,278],[278,455],[455,294],[308,292],[292,415],[415,308],[429,358],[358,355],[355,429],[265,340],[340,372],[372,265],[352,346],[346,280],[280,352],[295,442],[442,282],[282,295],[354,19],[19,370],[370,354],[285,441],[441,295],[295,285],[195,248],[248,197],[197,195],[457,440],[440,274],[274,457],[301,300],[300,368],[368,301],[417,351],[351,465],[465,417],[251,301],[301,389],[389,251],[394,395],[395,379],[379,394],[399,412],[412,419],[419,399],[410,436],[436,322],[322,410],[326,2],[2,393],[393,326],[354,370],[370,461],[461,354],[393,164],[164,267],[267,393],[268,302],[302,12],[12,268],[312,268],[268,13],[13,312],[298,293],[293,301],[301,298],[265,446],[446,340],[340,265],[280,330],[330,425],[425,280],[322,426],[426,391],[391,322],[420,429],[429,437],[437,420],[393,391],[391,326],[326,393],[344,440],[440,438],[438,344],[458,459],[459,461],[461,458],[364,434],[434,394],[394,364],[428,396],[396,262],[262,428],[274,354],[354,457],[457,274],[317,316],[316,402],[402,317],[316,315],[315,403],[403,316],[315,314],[314,404],[404,315],[314,313],[313,405],[405,314],[313,421],[421,406],[406,313],[323,366],[366,361],[361,323],[292,306],[306,407],[407,292],[306,291],[291,408],[408,306],[291,287],[287,409],[409,291],[287,432],[432,410],[410,287],[427,434],[434,411],[411,427],[372,264],[264,383],[383,372],[459,309],[309,457],[457,459],[366,352],[352,401],[401,366],[1,274],[274,4],[4,1],[418,421],[421,262],[262,418],[331,294],[294,358],[358,331],[435,433],[433,367],[367,435],[392,289],[289,439],[439,392],[328,462],[462,326],[326,328],[94,2],[2,370],[370,94],[289,305],[305,455],[455,289],[339,254],[254,448],[448,339],[359,255],[255,446],[446,359],[254,253],[253,449],[449,254],[253,252],[252,450],[450,253],[252,256],[256,451],[451,252],[256,341],[341,452],[452,256],[414,413],[413,463],[463,414],[286,441],[441,414],[414,286],[286,258],[258,441],[441,286],[258,257],[257,442],[442,258],[257,259],[259,443],[443,257],[259,260],[260,444],[444,259],[260,467],[467,445],[445,260],[309,459],[459,250],[250,309],[305,289],[289,290],[290,305],[305,290],[290,460],[460,305],[401,376],[376,435],[435,401],[309,250],[250,392],[392,309],[376,411],[411,433],[433,376],[453,341],[341,464],[464,453],[357,453],[453,465],[465,357],[343,357],[357,412],[412,343],[437,343],[343,399],[399,437],[344,360],[360,440],[440,344],[420,437],[437,456],[456,420],[360,420],[420,363],[363,360],[361,401],[401,288],[288,361],[265,372],[372,353],[353,265],[390,339],[339,249],[249,390],[339,448],[448,255],[255,339]);function mh(t){t.u={faceLandmarks:[],faceBlendshapes:[],facialTransformationMatrixes:[]}}var yh=class extends ih{constructor(t,e){super(new Za(t,e),\"image_in\",\"norm_rect\",!1),this.u={faceLandmarks:[],faceBlendshapes:[],facialTransformationMatrixes:[]},this.outputFacialTransformationMatrixes=this.outputFaceBlendshapes=!1,Cn(t=this.h=new Hs,0,1,e=new Cs),this.H=new Vs,Cn(this.h,0,3,this.H),this.j=new Is,Cn(this.h,0,2,this.j),Xn(this.j,4,1),Hn(this.j,2,.5),Hn(this.H,2,.5),Hn(this.h,4,.5)}get baseOptions(){return Rn(this.h,Cs,1)}set baseOptions(t){Cn(this.h,0,1,t)}o(t){return\"numFaces\"in t&&Xn(this.j,4,t.numFaces??1),\"minFaceDetectionConfidence\"in t&&Hn(this.j,2,t.minFaceDetectionConfidence??.5),\"minTrackingConfidence\"in t&&Hn(this.h,4,t.minTrackingConfidence??.5),\"minFacePresenceConfidence\"in t&&Hn(this.H,2,t.minFacePresenceConfidence??.5),\"outputFaceBlendshapes\"in t&&(this.outputFaceBlendshapes=!!t.outputFaceBlendshapes),\"outputFacialTransformationMatrixes\"in t&&(this.outputFacialTransformationMatrixes=!!t.outputFacialTransformationMatrixes),this.l(t)}F(t,e){return mh(this),eh(this,t,e),this.u}G(t,e,n){return mh(this),nh(this,t,n,e),this.u}m(){var t=new Di;Ii(t,\"image_in\"),Ii(t,\"norm_rect\"),Ui(t,\"face_landmarks\");const e=new yi;Wn(e,zs,this.h);const n=new Li;ki(n,\"mediapipe.tasks.vision.face_landmarker.FaceLandmarkerGraph\"),xi(n,\"IMAGE:image_in\"),xi(n,\"NORM_RECT:norm_rect\"),Si(n,\"NORM_LANDMARKS:face_landmarks\"),n.o(e),Oi(t,n),this.g.attachProtoVectorListener(\"face_landmarks\",((t,e)=>{for(const e of t)t=us(e),this.u.faceLandmarks.push(Io(t));ea(this,e)})),this.g.attachEmptyPacketListener(\"face_landmarks\",(t=>{ea(this,t)})),this.outputFaceBlendshapes&&(Ui(t,\"blendshapes\"),Si(n,\"BLENDSHAPES:blendshapes\"),this.g.attachProtoVectorListener(\"blendshapes\",((t,e)=>{if(this.outputFaceBlendshapes)for(const e of t)t=Wi(e),this.u.faceBlendshapes.push(Co(t.g()??[]));ea(this,e)})),this.g.attachEmptyPacketListener(\"blendshapes\",(t=>{ea(this,t)}))),this.outputFacialTransformationMatrixes&&(Ui(t,\"face_geometry\"),Si(n,\"FACE_GEOMETRY:face_geometry\"),this.g.attachProtoVectorListener(\"face_geometry\",((t,e)=>{if(this.outputFacialTransformationMatrixes)for(const e of t)(t=Rn(Gs(e),ls,2))&&this.u.facialTransformationMatrixes.push({rows:Bn(Nn(t,1),0)??0,columns:Bn(Nn(t,2),0)??0,data:yn(t,3,ve).slice()??[]});ea(this,e)})),this.g.attachEmptyPacketListener(\"face_geometry\",(t=>{ea(this,t)}))),t=t.g(),this.setGraph(new Uint8Array(t),!0)}};yh.prototype.detectForVideo=yh.prototype.G,yh.prototype.detect=yh.prototype.F,yh.prototype.setOptions=yh.prototype.o,yh.createFromModelPath=function(t,e){return Qa(yh,t,{baseOptions:{modelAssetPath:e}})},yh.createFromModelBuffer=function(t,e){return Qa(yh,t,{baseOptions:{modelAssetBuffer:e}})},yh.createFromOptions=function(t,e){return Qa(yh,t,e)},yh.FACE_LANDMARKS_LIPS=oh,yh.FACE_LANDMARKS_LEFT_EYE=ah,yh.FACE_LANDMARKS_LEFT_EYEBROW=hh,yh.FACE_LANDMARKS_LEFT_IRIS=ch,yh.FACE_LANDMARKS_RIGHT_EYE=uh,yh.FACE_LANDMARKS_RIGHT_EYEBROW=lh,yh.FACE_LANDMARKS_RIGHT_IRIS=dh,yh.FACE_LANDMARKS_FACE_OVAL=fh,yh.FACE_LANDMARKS_CONTOURS=ph,yh.FACE_LANDMARKS_TESSELATION=gh;var _h=class extends ih{constructor(t,e){super(new Za(t,e),\"image_in\",\"norm_rect\",!0),Cn(t=this.j=new Ks,0,1,e=new Cs)}get baseOptions(){return Rn(this.j,Cs,1)}set baseOptions(t){Cn(this.j,0,1,t)}o(t){return super.l(t)}Pa(t,e,n){const r=\"function\"!=typeof e?e:{};if(this.h=\"function\"==typeof e?e:n,eh(this,t,r??{}),!this.h)return this.u}m(){var t=new Di;Ii(t,\"image_in\"),Ii(t,\"norm_rect\"),Ui(t,\"stylized_image\");const e=new yi;Wn(e,Ys,this.j);const n=new Li;ki(n,\"mediapipe.tasks.vision.face_stylizer.FaceStylizerGraph\"),xi(n,\"IMAGE:image_in\"),xi(n,\"NORM_RECT:norm_rect\"),Si(n,\"STYLIZED_IMAGE:stylized_image\"),n.o(e),Oi(t,n),this.g.W(\"stylized_image\",((t,e)=>{var n=!this.h,r=t.data,i=t.width;const s=i*(t=t.height);if(r instanceof Uint8Array)if(r.length===3*s){const e=new Uint8ClampedArray(4*s);for(let t=0;t<s;++t)e[4*t]=r[3*t],e[4*t+1]=r[3*t+1],e[4*t+2]=r[3*t+2],e[4*t+3]=255;r=new ImageData(e,i,t)}else{if(r.length!==4*s)throw Error(\"Unsupported channel count: \"+r.length/s);r=new ImageData(new Uint8ClampedArray(r.buffer,r.byteOffset,r.length),i,t)}else if(!(r instanceof WebGLTexture))throw Error(`Unsupported format: ${r.constructor.name}`);i=new Ka([r],!1,!1,this.g.i.canvas,this.M,i,t),this.u=n=n?i.clone():i,this.h&&this.h(n),ea(this,e)})),this.g.attachEmptyPacketListener(\"stylized_image\",(t=>{this.u=null,this.h&&this.h(null),ea(this,t)})),t=t.g(),this.setGraph(new Uint8Array(t),!0)}};_h.prototype.stylize=_h.prototype.Pa,_h.prototype.setOptions=_h.prototype.o,_h.createFromModelPath=function(t,e){return Qa(_h,t,{baseOptions:{modelAssetPath:e}})},_h.createFromModelBuffer=function(t,e){return Qa(_h,t,{baseOptions:{modelAssetBuffer:e}})},_h.createFromOptions=function(t,e){return Qa(_h,t,e)};var vh=$a([0,1],[1,2],[2,3],[3,4],[0,5],[5,6],[6,7],[7,8],[5,9],[9,10],[10,11],[11,12],[9,13],[13,14],[14,15],[15,16],[13,17],[0,17],[17,18],[18,19],[19,20]);function Eh(t){t.gestures=[],t.landmarks=[],t.worldLandmarks=[],t.handedness=[]}function wh(t){return 0===t.gestures.length?{gestures:[],landmarks:[],worldLandmarks:[],handedness:[],handednesses:[]}:{gestures:t.gestures,landmarks:t.landmarks,worldLandmarks:t.worldLandmarks,handedness:t.handedness,handednesses:t.handedness}}function Th(t,e=!0){const n=[];for(const i of t){var r=Wi(i);t=[];for(const n of r.g())r=e&&null!=Nn(n,1)?Bn(Nn(n,1),0):-1,t.push({score:Gn(n,2)??0,index:r,categoryName:jn(n,3)??\"\",displayName:jn(n,4)??\"\"});n.push(t)}return n}var Ah=class extends ih{constructor(t,e){super(new Za(t,e),\"image_in\",\"norm_rect\",!1),this.gestures=[],this.landmarks=[],this.worldLandmarks=[],this.handedness=[],Cn(t=this.v=new oo,0,1,e=new Cs),this.A=new io,Cn(this.v,0,2,this.A),this.u=new no,Cn(this.A,0,3,this.u),this.h=new to,Cn(this.A,0,2,this.h),this.j=new Zs,Cn(this.v,0,3,this.j),Hn(this.h,2,.5),Hn(this.A,4,.5),Hn(this.u,2,.5)}get baseOptions(){return Rn(this.v,Cs,1)}set baseOptions(t){Cn(this.v,0,1,t)}o(t){if(Xn(this.h,3,t.numHands??1),\"minHandDetectionConfidence\"in t&&Hn(this.h,2,t.minHandDetectionConfidence??.5),\"minTrackingConfidence\"in t&&Hn(this.A,4,t.minTrackingConfidence??.5),\"minHandPresenceConfidence\"in t&&Hn(this.u,2,t.minHandPresenceConfidence??.5),t.cannedGesturesClassifierOptions){var e=new $s,n=e,r=Po(t.cannedGesturesClassifierOptions,Rn(this.j,$s,3)?.h());Cn(n,0,2,r),Cn(this.j,0,3,e)}else void 0===t.cannedGesturesClassifierOptions&&Rn(this.j,$s,3)?.g();return t.customGesturesClassifierOptions?(Cn(n=e=new $s,0,2,r=Po(t.customGesturesClassifierOptions,Rn(this.j,$s,4)?.h())),Cn(this.j,0,4,e)):void 0===t.customGesturesClassifierOptions&&Rn(this.j,$s,4)?.g(),this.l(t)}Ka(t,e){return Eh(this),eh(this,t,e),wh(this)}La(t,e,n){return Eh(this),nh(this,t,n,e),wh(this)}m(){var t=new Di;Ii(t,\"image_in\"),Ii(t,\"norm_rect\"),Ui(t,\"hand_gestures\"),Ui(t,\"hand_landmarks\"),Ui(t,\"world_hand_landmarks\"),Ui(t,\"handedness\");const e=new yi;Wn(e,co,this.v);const n=new Li;ki(n,\"mediapipe.tasks.vision.gesture_recognizer.GestureRecognizerGraph\"),xi(n,\"IMAGE:image_in\"),xi(n,\"NORM_RECT:norm_rect\"),Si(n,\"HAND_GESTURES:hand_gestures\"),Si(n,\"LANDMARKS:hand_landmarks\"),Si(n,\"WORLD_LANDMARKS:world_hand_landmarks\"),Si(n,\"HANDEDNESS:handedness\"),n.o(e),Oi(t,n),this.g.attachProtoVectorListener(\"hand_landmarks\",((t,e)=>{for(const e of t){t=us(e);const n=[];for(const e of Pn(t,as,1))n.push({x:Gn(e,1)??0,y:Gn(e,2)??0,z:Gn(e,3)??0,visibility:Gn(e,4)??0});this.landmarks.push(n)}ea(this,e)})),this.g.attachEmptyPacketListener(\"hand_landmarks\",(t=>{ea(this,t)})),this.g.attachProtoVectorListener(\"world_hand_landmarks\",((t,e)=>{for(const e of t){t=os(e);const n=[];for(const e of Pn(t,rs,1))n.push({x:Gn(e,1)??0,y:Gn(e,2)??0,z:Gn(e,3)??0,visibility:Gn(e,4)??0});this.worldLandmarks.push(n)}ea(this,e)})),this.g.attachEmptyPacketListener(\"world_hand_landmarks\",(t=>{ea(this,t)})),this.g.attachProtoVectorListener(\"hand_gestures\",((t,e)=>{this.gestures.push(...Th(t,!1)),ea(this,e)})),this.g.attachEmptyPacketListener(\"hand_gestures\",(t=>{ea(this,t)})),this.g.attachProtoVectorListener(\"handedness\",((t,e)=>{this.handedness.push(...Th(t)),ea(this,e)})),this.g.attachEmptyPacketListener(\"handedness\",(t=>{ea(this,t)})),t=t.g(),this.setGraph(new Uint8Array(t),!0)}};function bh(t){return{landmarks:t.landmarks,worldLandmarks:t.worldLandmarks,handednesses:t.handedness,handedness:t.handedness}}Ah.prototype.recognizeForVideo=Ah.prototype.La,Ah.prototype.recognize=Ah.prototype.Ka,Ah.prototype.setOptions=Ah.prototype.o,Ah.createFromModelPath=function(t,e){return Qa(Ah,t,{baseOptions:{modelAssetPath:e}})},Ah.createFromModelBuffer=function(t,e){return Qa(Ah,t,{baseOptions:{modelAssetBuffer:e}})},Ah.createFromOptions=function(t,e){return Qa(Ah,t,e)},Ah.HAND_CONNECTIONS=vh;var kh=class extends ih{constructor(t,e){super(new Za(t,e),\"image_in\",\"norm_rect\",!1),this.landmarks=[],this.worldLandmarks=[],this.handedness=[],Cn(t=this.j=new io,0,1,e=new Cs),this.u=new no,Cn(this.j,0,3,this.u),this.h=new to,Cn(this.j,0,2,this.h),Xn(this.h,3,1),Hn(this.h,2,.5),Hn(this.u,2,.5),Hn(this.j,4,.5)}get baseOptions(){return Rn(this.j,Cs,1)}set baseOptions(t){Cn(this.j,0,1,t)}o(t){return\"numHands\"in t&&Xn(this.h,3,t.numHands??1),\"minHandDetectionConfidence\"in t&&Hn(this.h,2,t.minHandDetectionConfidence??.5),\"minTrackingConfidence\"in t&&Hn(this.j,4,t.minTrackingConfidence??.5),\"minHandPresenceConfidence\"in t&&Hn(this.u,2,t.minHandPresenceConfidence??.5),this.l(t)}F(t,e){return this.landmarks=[],this.worldLandmarks=[],this.handedness=[],eh(this,t,e),bh(this)}G(t,e,n){return this.landmarks=[],this.worldLandmarks=[],this.handedness=[],nh(this,t,n,e),bh(this)}m(){var t=new Di;Ii(t,\"image_in\"),Ii(t,\"norm_rect\"),Ui(t,\"hand_landmarks\"),Ui(t,\"world_hand_landmarks\"),Ui(t,\"handedness\");const e=new yi;Wn(e,ho,this.j);const n=new Li;ki(n,\"mediapipe.tasks.vision.hand_landmarker.HandLandmarkerGraph\"),xi(n,\"IMAGE:image_in\"),xi(n,\"NORM_RECT:norm_rect\"),Si(n,\"LANDMARKS:hand_landmarks\"),Si(n,\"WORLD_LANDMARKS:world_hand_landmarks\"),Si(n,\"HANDEDNESS:handedness\"),n.o(e),Oi(t,n),this.g.attachProtoVectorListener(\"hand_landmarks\",((t,e)=>{for(const e of t)t=us(e),this.landmarks.push(Io(t));ea(this,e)})),this.g.attachEmptyPacketListener(\"hand_landmarks\",(t=>{ea(this,t)})),this.g.attachProtoVectorListener(\"world_hand_landmarks\",((t,e)=>{for(const e of t)t=os(e),this.worldLandmarks.push(Uo(t));ea(this,e)})),this.g.attachEmptyPacketListener(\"world_hand_landmarks\",(t=>{ea(this,t)})),this.g.attachProtoVectorListener(\"handedness\",((t,e)=>{var n=this.handedness,r=n.push;const i=[];for(const e of t){t=Wi(e);const n=[];for(const e of t.g())n.push({score:Gn(e,2)??0,index:Bn(Nn(e,1),0)??-1,categoryName:jn(e,3)??\"\",displayName:jn(e,4)??\"\"});i.push(n)}r.call(n,...i),ea(this,e)})),this.g.attachEmptyPacketListener(\"handedness\",(t=>{ea(this,t)})),t=t.g(),this.setGraph(new Uint8Array(t),!0)}};kh.prototype.detectForVideo=kh.prototype.G,kh.prototype.detect=kh.prototype.F,kh.prototype.setOptions=kh.prototype.o,kh.createFromModelPath=function(t,e){return Qa(kh,t,{baseOptions:{modelAssetPath:e}})},kh.createFromModelBuffer=function(t,e){return Qa(kh,t,{baseOptions:{modelAssetBuffer:e}})},kh.createFromOptions=function(t,e){return Qa(kh,t,e)},kh.HAND_CONNECTIONS=vh;var xh=$a([0,1],[1,2],[2,3],[3,7],[0,4],[4,5],[5,6],[6,8],[9,10],[11,12],[11,13],[13,15],[15,17],[15,19],[15,21],[17,19],[12,14],[14,16],[16,18],[16,20],[16,22],[18,20],[11,23],[12,24],[23,24],[23,25],[24,26],[25,27],[26,28],[27,29],[28,30],[29,31],[30,32],[27,31],[28,32]);function Sh(t){t.h={faceLandmarks:[],faceBlendshapes:[],poseLandmarks:[],poseWorldLandmarks:[],poseSegmentationMasks:[],leftHandLandmarks:[],leftHandWorldLandmarks:[],rightHandLandmarks:[],rightHandWorldLandmarks:[]}}function Lh(t){try{if(!t.I)return t.h;t.I(t.h)}finally{ia(t)}}function Fh(t,e){t=us(t),e.push(Io(t))}var Rh=class extends ih{constructor(t,e){super(new Za(t,e),\"input_frames_image\",null,!1),this.h={faceLandmarks:[],faceBlendshapes:[],poseLandmarks:[],poseWorldLandmarks:[],poseSegmentationMasks:[],leftHandLandmarks:[],leftHandWorldLandmarks:[],rightHandLandmarks:[],rightHandWorldLandmarks:[]},this.outputPoseSegmentationMasks=this.outputFaceBlendshapes=!1,Cn(t=this.A=new yo,0,1,e=new Cs),this.u=new no,Cn(this.A,0,2,this.u),this.aa=new uo,Cn(this.A,0,3,this.aa),this.j=new Is,Cn(this.A,0,4,this.j),this.H=new Vs,Cn(this.A,0,5,this.H),this.v=new fo,Cn(this.A,0,6,this.v),this.D=new go,Cn(this.A,0,7,this.D),Hn(this.j,2,.5),Hn(this.j,3,.3),Hn(this.H,2,.5),Hn(this.v,2,.5),Hn(this.v,3,.3),Hn(this.D,2,.5),Hn(this.u,2,.5)}get baseOptions(){return Rn(this.A,Cs,1)}set baseOptions(t){Cn(this.A,0,1,t)}o(t){return\"minFaceDetectionConfidence\"in t&&Hn(this.j,2,t.minFaceDetectionConfidence??.5),\"minFaceSuppressionThreshold\"in t&&Hn(this.j,3,t.minFaceSuppressionThreshold??.3),\"minFacePresenceConfidence\"in t&&Hn(this.H,2,t.minFacePresenceConfidence??.5),\"outputFaceBlendshapes\"in t&&(this.outputFaceBlendshapes=!!t.outputFaceBlendshapes),\"minPoseDetectionConfidence\"in t&&Hn(this.v,2,t.minPoseDetectionConfidence??.5),\"minPoseSuppressionThreshold\"in t&&Hn(this.v,3,t.minPoseSuppressionThreshold??.3),\"minPosePresenceConfidence\"in t&&Hn(this.D,2,t.minPosePresenceConfidence??.5),\"outputPoseSegmentationMasks\"in t&&(this.outputPoseSegmentationMasks=!!t.outputPoseSegmentationMasks),\"minHandLandmarksConfidence\"in t&&Hn(this.u,2,t.minHandLandmarksConfidence??.5),this.l(t)}F(t,e,n){const r=\"function\"!=typeof e?e:{};return this.I=\"function\"==typeof e?e:n,Sh(this),eh(this,t,r),Lh(this)}G(t,e,n,r){const i=\"function\"!=typeof n?n:{};return this.I=\"function\"==typeof n?n:r,Sh(this),nh(this,t,i,e),Lh(this)}m(){var t=new Di;Ii(t,\"input_frames_image\"),Ui(t,\"pose_landmarks\"),Ui(t,\"pose_world_landmarks\"),Ui(t,\"face_landmarks\"),Ui(t,\"left_hand_landmarks\"),Ui(t,\"left_hand_world_landmarks\"),Ui(t,\"right_hand_landmarks\"),Ui(t,\"right_hand_world_landmarks\");const e=new yi,n=new oi;An(n,1,Me(\"type.googleapis.com/mediapipe.tasks.vision.holistic_landmarker.proto.HolisticLandmarkerGraphOptions\"),\"\"),function(t,e){if(null!=e)if(Array.isArray(e))dn(t,2,tn(e,nn,void 0,void 0,!1));else{if(!(\"string\"==typeof e||e instanceof B||M(e)))throw Error(\"invalid value in Any.value field: \"+e+\" expected a ByteString, a base64 encoded string, a Uint8Array or a jspb array\");An(t,2,ae(e,!1,!1),D())}}(n,this.A.g());const r=new Li;ki(r,\"mediapipe.tasks.vision.holistic_landmarker.HolisticLandmarkerGraph\"),Dn(r,8,oi,n),xi(r,\"IMAGE:input_frames_image\"),Si(r,\"POSE_LANDMARKS:pose_landmarks\"),Si(r,\"POSE_WORLD_LANDMARKS:pose_world_landmarks\"),Si(r,\"FACE_LANDMARKS:face_landmarks\"),Si(r,\"LEFT_HAND_LANDMARKS:left_hand_landmarks\"),Si(r,\"LEFT_HAND_WORLD_LANDMARKS:left_hand_world_landmarks\"),Si(r,\"RIGHT_HAND_LANDMARKS:right_hand_landmarks\"),Si(r,\"RIGHT_HAND_WORLD_LANDMARKS:right_hand_world_landmarks\"),r.o(e),Oi(t,r),na(this,t),this.g.attachProtoListener(\"pose_landmarks\",((t,e)=>{Fh(t,this.h.poseLandmarks),ea(this,e)})),this.g.attachEmptyPacketListener(\"pose_landmarks\",(t=>{ea(this,t)})),this.g.attachProtoListener(\"pose_world_landmarks\",((t,e)=>{var n=this.h.poseWorldLandmarks;t=os(t),n.push(Uo(t)),ea(this,e)})),this.g.attachEmptyPacketListener(\"pose_world_landmarks\",(t=>{ea(this,t)})),this.outputPoseSegmentationMasks&&(Si(r,\"POSE_SEGMENTATION_MASK:pose_segmentation_mask\"),ra(this,\"pose_segmentation_mask\"),this.g.W(\"pose_segmentation_mask\",((t,e)=>{this.h.poseSegmentationMasks=[rh(this,t,!0,!this.I)],ea(this,e)})),this.g.attachEmptyPacketListener(\"pose_segmentation_mask\",(t=>{this.h.poseSegmentationMasks=[],ea(this,t)}))),this.g.attachProtoListener(\"face_landmarks\",((t,e)=>{Fh(t,this.h.faceLandmarks),ea(this,e)})),this.g.attachEmptyPacketListener(\"face_landmarks\",(t=>{ea(this,t)})),this.outputFaceBlendshapes&&(Ui(t,\"extra_blendshapes\"),Si(r,\"FACE_BLENDSHAPES:extra_blendshapes\"),this.g.attachProtoListener(\"extra_blendshapes\",((t,e)=>{var n=this.h.faceBlendshapes;this.outputFaceBlendshapes&&(t=Wi(t),n.push(Co(t.g()??[]))),ea(this,e)})),this.g.attachEmptyPacketListener(\"extra_blendshapes\",(t=>{ea(this,t)}))),this.g.attachProtoListener(\"left_hand_landmarks\",((t,e)=>{Fh(t,this.h.leftHandLandmarks),ea(this,e)})),this.g.attachEmptyPacketListener(\"left_hand_landmarks\",(t=>{ea(this,t)})),this.g.attachProtoListener(\"left_hand_world_landmarks\",((t,e)=>{var n=this.h.leftHandWorldLandmarks;t=os(t),n.push(Uo(t)),ea(this,e)})),this.g.attachEmptyPacketListener(\"left_hand_world_landmarks\",(t=>{ea(this,t)})),this.g.attachProtoListener(\"right_hand_landmarks\",((t,e)=>{Fh(t,this.h.rightHandLandmarks),ea(this,e)})),this.g.attachEmptyPacketListener(\"right_hand_landmarks\",(t=>{ea(this,t)})),this.g.attachProtoListener(\"right_hand_world_landmarks\",((t,e)=>{var n=this.h.rightHandWorldLandmarks;t=os(t),n.push(Uo(t)),ea(this,e)})),this.g.attachEmptyPacketListener(\"right_hand_world_landmarks\",(t=>{ea(this,t)})),t=t.g(),this.setGraph(new Uint8Array(t),!0)}};Rh.prototype.detectForVideo=Rh.prototype.G,Rh.prototype.detect=Rh.prototype.F,Rh.prototype.setOptions=Rh.prototype.o,Rh.createFromModelPath=function(t,e){return Qa(Rh,t,{baseOptions:{modelAssetPath:e}})},Rh.createFromModelBuffer=function(t,e){return Qa(Rh,t,{baseOptions:{modelAssetBuffer:e}})},Rh.createFromOptions=function(t,e){return Qa(Rh,t,e)},Rh.HAND_CONNECTIONS=vh,Rh.POSE_CONNECTIONS=xh,Rh.FACE_LANDMARKS_LIPS=oh,Rh.FACE_LANDMARKS_LEFT_EYE=ah,Rh.FACE_LANDMARKS_LEFT_EYEBROW=hh,Rh.FACE_LANDMARKS_LEFT_IRIS=ch,Rh.FACE_LANDMARKS_RIGHT_EYE=uh,Rh.FACE_LANDMARKS_RIGHT_EYEBROW=lh,Rh.FACE_LANDMARKS_RIGHT_IRIS=dh,Rh.FACE_LANDMARKS_FACE_OVAL=fh,Rh.FACE_LANDMARKS_CONTOURS=ph,Rh.FACE_LANDMARKS_TESSELATION=gh;var Mh=class extends ih{constructor(t,e){super(new Za(t,e),\"input_image\",\"norm_rect\",!0),this.j={classifications:[]},Cn(t=this.h=new _o,0,1,e=new Cs)}get baseOptions(){return Rn(this.h,Cs,1)}set baseOptions(t){Cn(this.h,0,1,t)}o(t){return Cn(this.h,0,2,Po(t,Rn(this.h,ks,2))),this.l(t)}ua(t,e){return this.j={classifications:[]},eh(this,t,e),this.j}va(t,e,n){return this.j={classifications:[]},nh(this,t,n,e),this.j}m(){var t=new Di;Ii(t,\"input_image\"),Ii(t,\"norm_rect\"),Ui(t,\"classifications\");const e=new yi;Wn(e,vo,this.h);const n=new Li;ki(n,\"mediapipe.tasks.vision.image_classifier.ImageClassifierGraph\"),xi(n,\"IMAGE:input_image\"),xi(n,\"NORM_RECT:norm_rect\"),Si(n,\"CLASSIFICATIONS:classifications\"),n.o(e),Oi(t,n),this.g.attachProtoListener(\"classifications\",((t,e)=>{this.j=function(t){const e={classifications:Pn(t,ps,1).map((t=>Co(Rn(t,Xi,4)?.g()??[],Bn(Nn(t,2),0),jn(t,3))))};return null!=Fe(cn(t,2))&&(e.timestampMs=Bn(Fe(cn(t,2)),0)),e}(ys(t)),ea(this,e)})),this.g.attachEmptyPacketListener(\"classifications\",(t=>{ea(this,t)})),t=t.g(),this.setGraph(new Uint8Array(t),!0)}};Mh.prototype.classifyForVideo=Mh.prototype.va,Mh.prototype.classify=Mh.prototype.ua,Mh.prototype.setOptions=Mh.prototype.o,Mh.createFromModelPath=function(t,e){return Qa(Mh,t,{baseOptions:{modelAssetPath:e}})},Mh.createFromModelBuffer=function(t,e){return Qa(Mh,t,{baseOptions:{modelAssetBuffer:e}})},Mh.createFromOptions=function(t,e){return Qa(Mh,t,e)};var Ph=class extends ih{constructor(t,e){super(new Za(t,e),\"image_in\",\"norm_rect\",!0),this.h=new Eo,this.embeddings={embeddings:[]},Cn(t=this.h,0,1,e=new Cs)}get baseOptions(){return Rn(this.h,Cs,1)}set baseOptions(t){Cn(this.h,0,1,t)}o(t){var e=this.h,n=Rn(this.h,Ss,2);return n=n?n.clone():new Ss,void 0!==t.l2Normalize?Vn(n,1,t.l2Normalize):\"l2Normalize\"in t&&dn(n,1),void 0!==t.quantize?Vn(n,2,t.quantize):\"quantize\"in t&&dn(n,2),Cn(e,0,2,n),this.l(t)}Ba(t,e){return eh(this,t,e),this.embeddings}Ca(t,e,n){return nh(this,t,n,e),this.embeddings}m(){var t=new Di;Ii(t,\"image_in\"),Ii(t,\"norm_rect\"),Ui(t,\"embeddings_out\");const e=new yi;Wn(e,wo,this.h);const n=new Li;ki(n,\"mediapipe.tasks.vision.image_embedder.ImageEmbedderGraph\"),xi(n,\"IMAGE:image_in\"),xi(n,\"NORM_RECT:norm_rect\"),Si(n,\"EMBEDDINGS:embeddings_out\"),n.o(e),Oi(t,n),this.g.attachProtoListener(\"embeddings_out\",((t,e)=>{t=bs(t),this.embeddings=function(t){return{embeddings:Pn(t,Es,1).map((t=>{const e={headIndex:Bn(Nn(t,3),0)??-1,headName:jn(t,4)??\"\"};if(void 0!==Fn(t,_s,xn(t,1)))t=yn(t=Rn(t,_s,xn(t,1)),1,ve),e.floatEmbedding=t.slice();else{const n=new Uint8Array(0);e.quantizedEmbedding=Rn(t,vs,xn(t,2))?.qa()?.h()??n}return e})),timestampMs:Bn(Fe(cn(t,2)),0)}}(t),ea(this,e)})),this.g.attachEmptyPacketListener(\"embeddings_out\",(t=>{ea(this,t)})),t=t.g(),this.setGraph(new Uint8Array(t),!0)}};Ph.cosineSimilarity=function(t,e){if(t.floatEmbedding&&e.floatEmbedding)t=No(t.floatEmbedding,e.floatEmbedding);else{if(!t.quantizedEmbedding||!e.quantizedEmbedding)throw Error(\"Cannot compute cosine similarity between quantized and float embeddings.\");t=No(Do(t.quantizedEmbedding),Do(e.quantizedEmbedding))}return t},Ph.prototype.embedForVideo=Ph.prototype.Ca,Ph.prototype.embed=Ph.prototype.Ba,Ph.prototype.setOptions=Ph.prototype.o,Ph.createFromModelPath=function(t,e){return Qa(Ph,t,{baseOptions:{modelAssetPath:e}})},Ph.createFromModelBuffer=function(t,e){return Qa(Ph,t,{baseOptions:{modelAssetBuffer:e}})},Ph.createFromOptions=function(t,e){return Qa(Ph,t,e)};var Ch=class{constructor(t,e,n){this.confidenceMasks=t,this.categoryMask=e,this.qualityScores=n}close(){this.confidenceMasks?.forEach((t=>{t.close()})),this.categoryMask?.close()}};function Oh(t){t.categoryMask=void 0,t.confidenceMasks=void 0,t.qualityScores=void 0}function Ih(t){try{const e=new Ch(t.confidenceMasks,t.categoryMask,t.qualityScores);if(!t.j)return e;t.j(e)}finally{ia(t)}}Ch.prototype.close=Ch.prototype.close;var Uh=class extends ih{constructor(t,e){super(new Za(t,e),\"image_in\",\"norm_rect\",!1),this.u=[],this.outputCategoryMask=!1,this.outputConfidenceMasks=!0,this.h=new xo,this.v=new To,Cn(this.h,0,3,this.v),Cn(t=this.h,0,1,e=new Cs)}get baseOptions(){return Rn(this.h,Cs,1)}set baseOptions(t){Cn(this.h,0,1,t)}o(t){return void 0!==t.displayNamesLocale?dn(this.h,2,Me(t.displayNamesLocale)):\"displayNamesLocale\"in t&&dn(this.h,2),\"outputCategoryMask\"in t&&(this.outputCategoryMask=t.outputCategoryMask??!1),\"outputConfidenceMasks\"in t&&(this.outputConfidenceMasks=t.outputConfidenceMasks??!0),super.l(t)}L(){!function(t){const e=Pn(t.fa(),Li,1).filter((t=>jn(t,1).includes(\"mediapipe.tasks.TensorsToSegmentationCalculator\")));if(t.u=[],1<e.length)throw Error(\"The graph has more than one mediapipe.tasks.TensorsToSegmentationCalculator.\");1===e.length&&(Rn(e[0],yi,7)?.l()?.g()??new Map).forEach(((e,n)=>{t.u[Number(n)]=jn(e,1)}))}(this)}ga(t,e,n){const r=\"function\"!=typeof e?e:{};return this.j=\"function\"==typeof e?e:n,Oh(this),eh(this,t,r),Ih(this)}Na(t,e,n,r){const i=\"function\"!=typeof n?n:{};return this.j=\"function\"==typeof n?n:r,Oh(this),nh(this,t,i,e),Ih(this)}Fa(){return this.u}m(){var t=new Di;Ii(t,\"image_in\"),Ii(t,\"norm_rect\");const e=new yi;Wn(e,So,this.h);const n=new Li;ki(n,\"mediapipe.tasks.vision.image_segmenter.ImageSegmenterGraph\"),xi(n,\"IMAGE:image_in\"),xi(n,\"NORM_RECT:norm_rect\"),n.o(e),Oi(t,n),na(this,t),this.outputConfidenceMasks&&(Ui(t,\"confidence_masks\"),Si(n,\"CONFIDENCE_MASKS:confidence_masks\"),ra(this,\"confidence_masks\"),this.g.da(\"confidence_masks\",((t,e)=>{this.confidenceMasks=t.map((t=>rh(this,t,!0,!this.j))),ea(this,e)})),this.g.attachEmptyPacketListener(\"confidence_masks\",(t=>{this.confidenceMasks=[],ea(this,t)}))),this.outputCategoryMask&&(Ui(t,\"category_mask\"),Si(n,\"CATEGORY_MASK:category_mask\"),ra(this,\"category_mask\"),this.g.W(\"category_mask\",((t,e)=>{this.categoryMask=rh(this,t,!1,!this.j),ea(this,e)})),this.g.attachEmptyPacketListener(\"category_mask\",(t=>{this.categoryMask=void 0,ea(this,t)}))),Ui(t,\"quality_scores\"),Si(n,\"QUALITY_SCORES:quality_scores\"),this.g.attachFloatVectorListener(\"quality_scores\",((t,e)=>{this.qualityScores=t,ea(this,e)})),this.g.attachEmptyPacketListener(\"quality_scores\",(t=>{this.categoryMask=void 0,ea(this,t)})),t=t.g(),this.setGraph(new Uint8Array(t),!0)}};Uh.prototype.getLabels=Uh.prototype.Fa,Uh.prototype.segmentForVideo=Uh.prototype.Na,Uh.prototype.segment=Uh.prototype.ga,Uh.prototype.setOptions=Uh.prototype.o,Uh.createFromModelPath=function(t,e){return Qa(Uh,t,{baseOptions:{modelAssetPath:e}})},Uh.createFromModelBuffer=function(t,e){return Qa(Uh,t,{baseOptions:{modelAssetBuffer:e}})},Uh.createFromOptions=function(t,e){return Qa(Uh,t,e)};var Dh=class{constructor(t,e,n){this.confidenceMasks=t,this.categoryMask=e,this.qualityScores=n}close(){this.confidenceMasks?.forEach((t=>{t.close()})),this.categoryMask?.close()}};Dh.prototype.close=Dh.prototype.close;var Nh=class extends zn{constructor(t){super(t)}},Bh=[0,jr,-2],Gh=[0,Or,-3,Hr],jh=[0,Or,-3,Hr,Or,-1],Vh=[0,jh],Xh=[0,Vh,Bh],Hh=[0,jh,Bh],Wh=[0,jh,jr,-1],zh=[0,Wh,Bh],Kh=[0,Or,-3,Hr,Bh,-1],Yh=[0,Or,-3,Hr,ti],$h=class extends zn{constructor(t){super(t)}},qh=[0,Or,-1,Hr],Jh=class extends zn{constructor(){super()}};Jh.B=[1];var Zh=class extends zn{constructor(t){super(t)}},Qh=[1,2,3,4,5,6,7,8,9,10,14,15],tc=[0,Qh,Jr,jh,Jr,Hh,Jr,Vh,Jr,Xh,Jr,qh,Jr,Yh,Jr,Gh,Jr,[0,Yr,Or,-2,Hr,jr,Hr,-1,2,Or,Bh],Jr,Wh,Jr,zh,Or,Bh,Yr,Jr,Kh,Jr,[0,Cr,qh]],ec=[0,Yr,jr,-1,Hr],nc=class extends zn{constructor(){super()}};nc.B=[1],nc.prototype.g=si([0,Cr,tc,Yr,ec]);var rc=class extends ih{constructor(t,e){super(new Za(t,e),\"image_in\",\"norm_rect_in\",!1),this.outputCategoryMask=!1,this.outputConfidenceMasks=!0,this.h=new xo,this.v=new To,Cn(this.h,0,3,this.v),Cn(t=this.h,0,1,e=new Cs)}get baseOptions(){return Rn(this.h,Cs,1)}set baseOptions(t){Cn(this.h,0,1,t)}o(t){return\"outputCategoryMask\"in t&&(this.outputCategoryMask=t.outputCategoryMask??!1),\"outputConfidenceMasks\"in t&&(this.outputConfidenceMasks=t.outputConfidenceMasks??!0),super.l(t)}ga(t,e,n,r){const i=\"function\"!=typeof n?n:{};this.j=\"function\"==typeof n?n:r,this.qualityScores=this.categoryMask=this.confidenceMasks=void 0,n=this.J+1,r=new nc;const s=new Zh;var o=new Nh;if(Xn(o,1,255),Cn(s,0,12,o),e.keypoint&&e.scribble)throw Error(\"Cannot provide both keypoint and scribble.\");if(e.keypoint){var a=new $h;Vn(a,3,!0),Hn(a,1,e.keypoint.x),Hn(a,2,e.keypoint.y),On(s,5,Qh,a)}else{if(!e.scribble)throw Error(\"Must provide either a keypoint or a scribble.\");for(a of(o=new Jh,e.scribble))Vn(e=new $h,3,!0),Hn(e,1,a.x),Hn(e,2,a.y),Dn(o,1,$h,e);On(s,15,Qh,o)}Dn(r,1,Zh,s),this.g.addProtoToStream(r.g(),\"drishti.RenderData\",\"roi_in\",n),eh(this,t,i);t:{try{const t=new Dh(this.confidenceMasks,this.categoryMask,this.qualityScores);if(!this.j){var h=t;break t}this.j(t)}finally{ia(this)}h=void 0}return h}m(){var t=new Di;Ii(t,\"image_in\"),Ii(t,\"roi_in\"),Ii(t,\"norm_rect_in\");const e=new yi;Wn(e,So,this.h);const n=new Li;ki(n,\"mediapipe.tasks.vision.interactive_segmenter.InteractiveSegmenterGraph\"),xi(n,\"IMAGE:image_in\"),xi(n,\"ROI:roi_in\"),xi(n,\"NORM_RECT:norm_rect_in\"),n.o(e),Oi(t,n),na(this,t),this.outputConfidenceMasks&&(Ui(t,\"confidence_masks\"),Si(n,\"CONFIDENCE_MASKS:confidence_masks\"),ra(this,\"confidence_masks\"),this.g.da(\"confidence_masks\",((t,e)=>{this.confidenceMasks=t.map((t=>rh(this,t,!0,!this.j))),ea(this,e)})),this.g.attachEmptyPacketListener(\"confidence_masks\",(t=>{this.confidenceMasks=[],ea(this,t)}))),this.outputCategoryMask&&(Ui(t,\"category_mask\"),Si(n,\"CATEGORY_MASK:category_mask\"),ra(this,\"category_mask\"),this.g.W(\"category_mask\",((t,e)=>{this.categoryMask=rh(this,t,!1,!this.j),ea(this,e)})),this.g.attachEmptyPacketListener(\"category_mask\",(t=>{this.categoryMask=void 0,ea(this,t)}))),Ui(t,\"quality_scores\"),Si(n,\"QUALITY_SCORES:quality_scores\"),this.g.attachFloatVectorListener(\"quality_scores\",((t,e)=>{this.qualityScores=t,ea(this,e)})),this.g.attachEmptyPacketListener(\"quality_scores\",(t=>{this.categoryMask=void 0,ea(this,t)})),t=t.g(),this.setGraph(new Uint8Array(t),!0)}};rc.prototype.segment=rc.prototype.ga,rc.prototype.setOptions=rc.prototype.o,rc.createFromModelPath=function(t,e){return Qa(rc,t,{baseOptions:{modelAssetPath:e}})},rc.createFromModelBuffer=function(t,e){return Qa(rc,t,{baseOptions:{modelAssetBuffer:e}})},rc.createFromOptions=function(t,e){return Qa(rc,t,e)};var ic=class extends ih{constructor(t,e){super(new Za(t,e),\"input_frame_gpu\",\"norm_rect\",!1),this.j={detections:[]},Cn(t=this.h=new Lo,0,1,e=new Cs)}get baseOptions(){return Rn(this.h,Cs,1)}set baseOptions(t){Cn(this.h,0,1,t)}o(t){return void 0!==t.displayNamesLocale?dn(this.h,2,Me(t.displayNamesLocale)):\"displayNamesLocale\"in t&&dn(this.h,2),void 0!==t.maxResults?Xn(this.h,3,t.maxResults):\"maxResults\"in t&&dn(this.h,3),void 0!==t.scoreThreshold?Hn(this.h,4,t.scoreThreshold):\"scoreThreshold\"in t&&dn(this.h,4),void 0!==t.categoryAllowlist?Tn(this.h,5,t.categoryAllowlist):\"categoryAllowlist\"in t&&dn(this.h,5),void 0!==t.categoryDenylist?Tn(this.h,6,t.categoryDenylist):\"categoryDenylist\"in t&&dn(this.h,6),this.l(t)}F(t,e){return this.j={detections:[]},eh(this,t,e),this.j}G(t,e,n){return this.j={detections:[]},nh(this,t,n,e),this.j}m(){var t=new Di;Ii(t,\"input_frame_gpu\"),Ii(t,\"norm_rect\"),Ui(t,\"detections\");const e=new yi;Wn(e,Fo,this.h);const n=new Li;ki(n,\"mediapipe.tasks.vision.ObjectDetectorGraph\"),xi(n,\"IMAGE:input_frame_gpu\"),xi(n,\"NORM_RECT:norm_rect\"),Si(n,\"DETECTIONS:detections\"),n.o(e),Oi(t,n),this.g.attachProtoVectorListener(\"detections\",((t,e)=>{for(const e of t)t=ns(e),this.j.detections.push(Oo(t));ea(this,e)})),this.g.attachEmptyPacketListener(\"detections\",(t=>{ea(this,t)})),t=t.g(),this.setGraph(new Uint8Array(t),!0)}};ic.prototype.detectForVideo=ic.prototype.G,ic.prototype.detect=ic.prototype.F,ic.prototype.setOptions=ic.prototype.o,ic.createFromModelPath=async function(t,e){return Qa(ic,t,{baseOptions:{modelAssetPath:e}})},ic.createFromModelBuffer=function(t,e){return Qa(ic,t,{baseOptions:{modelAssetBuffer:e}})},ic.createFromOptions=function(t,e){return Qa(ic,t,e)};var sc=class{constructor(t,e,n){this.landmarks=t,this.worldLandmarks=e,this.segmentationMasks=n}close(){this.segmentationMasks?.forEach((t=>{t.close()}))}};function oc(t){t.landmarks=[],t.worldLandmarks=[],t.segmentationMasks=void 0}function ac(t){try{const e=new sc(t.landmarks,t.worldLandmarks,t.segmentationMasks);if(!t.j)return e;t.j(e)}finally{ia(t)}}sc.prototype.close=sc.prototype.close;var hc=class extends ih{constructor(t,e){super(new Za(t,e),\"image_in\",\"norm_rect\",!1),this.landmarks=[],this.worldLandmarks=[],this.outputSegmentationMasks=!1,Cn(t=this.h=new Ro,0,1,e=new Cs),this.D=new go,Cn(this.h,0,3,this.D),this.v=new fo,Cn(this.h,0,2,this.v),Xn(this.v,4,1),Hn(this.v,2,.5),Hn(this.D,2,.5),Hn(this.h,4,.5)}get baseOptions(){return Rn(this.h,Cs,1)}set baseOptions(t){Cn(this.h,0,1,t)}o(t){return\"numPoses\"in t&&Xn(this.v,4,t.numPoses??1),\"minPoseDetectionConfidence\"in t&&Hn(this.v,2,t.minPoseDetectionConfidence??.5),\"minTrackingConfidence\"in t&&Hn(this.h,4,t.minTrackingConfidence??.5),\"minPosePresenceConfidence\"in t&&Hn(this.D,2,t.minPosePresenceConfidence??.5),\"outputSegmentationMasks\"in t&&(this.outputSegmentationMasks=t.outputSegmentationMasks??!1),this.l(t)}F(t,e,n){const r=\"function\"!=typeof e?e:{};return this.j=\"function\"==typeof e?e:n,oc(this),eh(this,t,r),ac(this)}G(t,e,n,r){const i=\"function\"!=typeof n?n:{};return this.j=\"function\"==typeof n?n:r,oc(this),nh(this,t,i,e),ac(this)}m(){var t=new Di;Ii(t,\"image_in\"),Ii(t,\"norm_rect\"),Ui(t,\"normalized_landmarks\"),Ui(t,\"world_landmarks\"),Ui(t,\"segmentation_masks\");const e=new yi;Wn(e,Mo,this.h);const n=new Li;ki(n,\"mediapipe.tasks.vision.pose_landmarker.PoseLandmarkerGraph\"),xi(n,\"IMAGE:image_in\"),xi(n,\"NORM_RECT:norm_rect\"),Si(n,\"NORM_LANDMARKS:normalized_landmarks\"),Si(n,\"WORLD_LANDMARKS:world_landmarks\"),n.o(e),Oi(t,n),na(this,t),this.g.attachProtoVectorListener(\"normalized_landmarks\",((t,e)=>{this.landmarks=[];for(const e of t)t=us(e),this.landmarks.push(Io(t));ea(this,e)})),this.g.attachEmptyPacketListener(\"normalized_landmarks\",(t=>{this.landmarks=[],ea(this,t)})),this.g.attachProtoVectorListener(\"world_landmarks\",((t,e)=>{this.worldLandmarks=[];for(const e of t)t=os(e),this.worldLandmarks.push(Uo(t));ea(this,e)})),this.g.attachEmptyPacketListener(\"world_landmarks\",(t=>{this.worldLandmarks=[],ea(this,t)})),this.outputSegmentationMasks&&(Si(n,\"SEGMENTATION_MASK:segmentation_masks\"),ra(this,\"segmentation_masks\"),this.g.da(\"segmentation_masks\",((t,e)=>{this.segmentationMasks=t.map((t=>rh(this,t,!0,!this.j))),ea(this,e)})),this.g.attachEmptyPacketListener(\"segmentation_masks\",(t=>{this.segmentationMasks=[],ea(this,t)}))),t=t.g(),this.setGraph(new Uint8Array(t),!0)}};hc.prototype.detectForVideo=hc.prototype.G,hc.prototype.detect=hc.prototype.F,hc.prototype.setOptions=hc.prototype.o,hc.createFromModelPath=function(t,e){return Qa(hc,t,{baseOptions:{modelAssetPath:e}})},hc.createFromModelBuffer=function(t,e){return Qa(hc,t,{baseOptions:{modelAssetBuffer:e}})},hc.createFromOptions=function(t,e){return Qa(hc,t,e)},hc.POSE_CONNECTIONS=xh;export{Na as DrawingUtils,sh as FaceDetector,yh as FaceLandmarker,_h as FaceStylizer,Xo as FilesetResolver,Ah as GestureRecognizer,kh as HandLandmarker,Rh as HolisticLandmarker,Mh as ImageClassifier,Ph as ImageEmbedder,Uh as ImageSegmenter,Ch as ImageSegmenterResult,rc as InteractiveSegmenter,Dh as InteractiveSegmenterResult,Ka as MPImage,Sa as MPMask,ic as ObjectDetector,hc as PoseLandmarker,ih as VisionTaskRunner};\n//# sourceMappingURL=vision_bundle_mjs.js.map\n","//#region rolldown:runtime\nvar __create = Object.create;\nvar __defProp = Object.defineProperty;\nvar __getOwnPropDesc = Object.getOwnPropertyDescriptor;\nvar __getOwnPropNames = Object.getOwnPropertyNames;\nvar __getProtoOf = Object.getPrototypeOf;\nvar __hasOwnProp = Object.prototype.hasOwnProperty;\nvar __commonJS = (cb, mod) => function() {\n\treturn mod || (0, cb[__getOwnPropNames(cb)[0]])((mod = { exports: {} }).exports, mod), mod.exports;\n};\nvar __export = (target, all) => {\n\tfor (var name in all) __defProp(target, name, {\n\t\tget: all[name],\n\t\tenumerable: true\n\t});\n};\nvar __copyProps = (to, from, except, desc) => {\n\tif (from && typeof from === \"object\" || typeof from === \"function\") for (var keys = __getOwnPropNames(from), i = 0, n = keys.length, key; i < n; i++) {\n\t\tkey = keys[i];\n\t\tif (!__hasOwnProp.call(to, key) && key !== except) __defProp(to, key, {\n\t\t\tget: ((k) => from[k]).bind(null, key),\n\t\t\tenumerable: !(desc = __getOwnPropDesc(from, key)) || desc.enumerable\n\t\t});\n\t}\n\treturn to;\n};\nvar __toESM = (mod, isNodeMode, target) => (target = mod != null ? __create(__getProtoOf(mod)) : {}, __copyProps(isNodeMode || !mod || !mod.__esModule ? __defProp(target, \"default\", {\n\tvalue: mod,\n\tenumerable: true\n}) : target, mod));\n\n//#endregion\nexport { __commonJS, __export, __toESM };","export const getErrorMessage = (ex) => {\n    if (typeof ex === `string`)\n        return ex;\n    if (ex instanceof Error) {\n        return ex.message;\n    }\n    return ex;\n};\n/**\n * Throws an error if any result is a failure.\n * Error message will be the combined from all errors.\n * @param results\n * @returns\n */\nexport const throwIfFailed = (...results) => {\n    const failed = results.filter(r => resultIsError(r)); // as ResultError<any>[];\n    if (failed.length === 0)\n        return;\n    const messages = failed.map(f => resultErrorToString(f));\n    throw new Error(messages.join(`, `));\n};\n/**\n * If any of `results` is an error, throws it, otherwise ignored.\n * @param results\n * @returns _true_ or throws\n */\nexport function resultThrow(...results) {\n    for (const r of results) {\n        const rr = typeof r === `object` ? r : r();\n        if (rr === undefined)\n            continue;\n        if (rr.success)\n            continue;\n        throw resultToError(rr);\n    }\n    return true;\n}\nexport function resultThrowSingle(result) {\n    if (result.success)\n        return true;\n    throw resultToError(result);\n}\n/**\n * Returns the first failed result, or _undefined_ if there are no fails\n * @param results\n * @returns\n */\nexport const resultFirstFail_ = (...results) => {\n    for (const r of results) {\n        const rr = typeof r === `object` ? r : r();\n        if (rr === undefined)\n            continue;\n        if (!rr.success)\n            return rr;\n    }\n};\n/**\n * Returns _true_ if `result` is an error\n * @param result\n * @returns\n */\nexport function resultIsError(result) {\n    if (typeof result !== `object`)\n        return false;\n    return !result.success;\n}\n/**\n * Returns _true_ if `result` is OK and has a value\n * @param result\n * @returns\n */\nexport function resultIsOk(result) {\n    if (typeof result !== `object`)\n        return false;\n    return result.success;\n}\n/**\n * Gets the result as an Error\n * @param result\n * @returns\n */\nexport function resultToError(result) {\n    if (typeof result.error === `string`) {\n        throw new Error(result.error, { cause: result.info });\n    }\n    if (result.error instanceof Error)\n        throw result.error;\n    return new Error(JSON.stringify(result.error), { cause: result.info });\n}\n/**\n * Unwraps the result, returning its value if OK.\n * If not, an exception is thrown.\n * @param result\n * @returns\n */\nexport function resultToValue(result) {\n    if (resultIsOk(result)) {\n        return result.value;\n    }\n    throw resultToError(result);\n}\n/**\n * Returns the error as a string.\n * @param result\n * @returns\n */\nexport function resultErrorToString(result) {\n    if (result.error instanceof Error)\n        return getErrorMessage(result.error);\n    if (typeof result.error === `string`)\n        return result.error;\n    return JSON.stringify(result.error);\n}\n/**\n * Returns a {@link ResultError} using 'error' as the message.\n * @param error\n * @param info\n * @returns\n */\nexport function errorResult(error, info) {\n    return {\n        success: false,\n        error,\n        info\n    };\n}\n/**\n * Returns first failed result or final value.\n * @param results\n * @returns\n */\nexport const resultsCollate = (...results) => {\n    let rr;\n    for (const r of results) {\n        rr = typeof r === `object` ? r : r();\n        if (rr === undefined)\n            continue;\n        if (!rr.success)\n            return rr;\n    }\n    if (!rr)\n        throw new Error(`No results`);\n    return rr;\n};\n/**\n * If `result` is an error, calls `callback`, passing the error.\n * Otherwise does nothing\n * @param result\n * @param callback\n */\nexport const resultWithFail = (result, callback) => {\n    if (resultIsError(result)) {\n        callback(result);\n    }\n};\n","import { resultsCollate } from \"./result.js\";\n/**\n * Returns true if `x` is a power of two\n * @param x\n * @returns True if `x` is a power of two\n */\nexport const isPowerOfTwo = (x) => Math.log2(x) % 1 === 0;\n/**\n * Returns `fallback` if `v` is NaN, otherwise returns `v`.\n *\n * Throws if `v` is not a number type, null or undefined\n * @param v\n * @param fallback\n * @returns\n */\nexport const ifNaN = (v, fallback) => {\n    if (typeof v !== `number`) {\n        throw new TypeError(`v is not a number. Got: ${typeof v}`);\n    }\n    if (Number.isNaN(v))\n        return fallback;\n    return v;\n};\n/**\n * Parses `value` as an integer, returning it if it meets the `range` criteria.\n * If not, `defaultValue` is returned.\n *\n * ```js\n * const i = integerParse('10', 'positive');    // 10\n * const i = integerParse('10.5', 'positive');  // 10\n * const i = integerParse('0', 'nonZero', 100); // 100\n * ```\n *\n * NaN is returned if criteria does not match and no default is given\n * ```js\n * const i = integerParse('10', 'negative');    // NaN\n * ```\n *\n * @param value\n * @param range\n * @param defaultValue\n * @returns\n */\nexport const integerParse = (value, range = ``, defaultValue = Number.NaN) => {\n    if (typeof value === `undefined`)\n        return defaultValue;\n    if (value === null)\n        return defaultValue;\n    try {\n        const parsed = Number.parseInt(typeof value === `number` ? value.toString() : value);\n        const r = integerTest(parsed, range, `parsed`);\n        return r.success ? parsed : defaultValue;\n    }\n    catch {\n        return defaultValue;\n    }\n};\n/**\n * Checks if `t` is not a number or within specified range.\n * Returns `[false, reason:string]` if invalid or `[true]` if valid.\n *\n * Alternatives: {@link integerTest} for additional integer check, {@link percentTest} for percentage-range.\n *\n * * (empty, default): must be a number type and not NaN.\n * * finite: must be a number, not NaN and not infinite\n * * positive: must be at least zero\n * * negative: must be zero or lower\n * * aboveZero: must be above zero\n * * belowZero: must be below zero\n * * percentage: must be within 0-1, inclusive\n * * nonZero: can be anything except zero\n * * bipolar: can be -1 to 1, inclusive\n * @param value Value to check\n * @param parameterName Name of parameter (for more helpful exception messages)\n * @param range Range to enforce\n * @returns\n */\nexport const numberTest = (value, range = ``, parameterName = `?`, info) => {\n    if (value === null)\n        return { success: false, error: `Parameter '${parameterName}' is null`, info };\n    if (typeof value === `undefined`) {\n        return { success: false, error: `Parameter '${parameterName}' is undefined`, info };\n    }\n    if (Number.isNaN(value)) {\n        return { success: false, error: `Parameter '${parameterName}' is NaN`, info };\n    }\n    if (typeof value !== `number`) {\n        return { success: false, error: `Parameter '${parameterName}' is not a number (${JSON.stringify(value)})`, info };\n    }\n    switch (range) {\n        case `finite`: {\n            if (!Number.isFinite(value)) {\n                return { success: false, error: `Parameter '${parameterName} must be finite (Got: ${value})`, info };\n            }\n            break;\n        }\n        case `positive`: {\n            if (value < 0) {\n                return { success: false, error: `Parameter '${parameterName}' must be at least zero (${value})`, info };\n            }\n            break;\n        }\n        case `negative`: {\n            if (value > 0) {\n                return { success: false, error: `Parameter '${parameterName}' must be zero or lower (${value})`, info };\n            }\n            break;\n        }\n        case `aboveZero`: {\n            if (value <= 0) {\n                return {\n                    success: false, error: `Parameter '${parameterName}' must be above zero (${value})`, info\n                };\n            }\n            break;\n        }\n        case `belowZero`: {\n            if (value >= 0) {\n                return { success: false, error: `Parameter '${parameterName}' must be below zero (${value})`, info };\n            }\n            break;\n        }\n        case `percentage`: {\n            if (value > 1 || value < 0) {\n                return {\n                    success: false, error: `Parameter '${parameterName}' must be in percentage range (0 to 1). (${value})`, info\n                };\n            }\n            break;\n        }\n        case `nonZero`: {\n            if (value === 0) {\n                return { success: false, error: `Parameter '${parameterName}' must non-zero. (${value})`, info };\n            }\n            break;\n        }\n        case `bipolar`: {\n            if (value > 1 || value < -1) {\n                return { success: false, error: `Parameter '${parameterName}' must be in bipolar percentage range (-1 to 1). (${value})`, info };\n            }\n            break;\n        }\n    }\n    return { success: true, value, info };\n};\n/**\n * Checks if `t` is not a number or within specified range.\n * Throws if invalid. Use {@link numberTest} to test without throwing.\n *\n* * (empty, default): must be a number type and not NaN.\n* * positive: must be at least zero\n* * negative: must be zero or lower\n* * aboveZero: must be above zero\n* * belowZero: must be below zero\n* * percentage: must be within 0-1, inclusive\n* * nonZero: can be anything except zero\n* * bipolar: can be -1 to 1, inclusive\n*\n * Alternatives: {@link integerTest} for additional integer check, {@link percentTest} for percentage-range.\n * @param value Value to test\n * @param range Range\n * @param parameterName Name of parameter\n */\n// export const throwNumberTest = (value?: unknown,\n//   range: NumberGuardRange = ``,\n//   parameterName = `?`) => {\n//   throwFromResult(numberTest(value, range, parameterName));\n// }\n/**\n * Compares two numbers with a given number of decimal places\n * ```js\n * a: 10.123 b: 10.1    decimals: 1 = true\n * a: 10.123 b: 10.2    decimals: 0 = true\n * a: 10.123 b: 10.14   decimals: 1 = true\n * a: 10.123 b: 10.14   decimals: 2 = false\n * ``\n * @param a\n * @param b\n * @param decimals How many decimals to include\n * @returns\n */\nexport const numberDecimalTest = (a, b, decimals = 3) => {\n    if (decimals === 0) {\n        a = Math.floor(a);\n        b = Math.floor(b);\n        if (a === b)\n            return { success: true, value: a };\n        return { success: false, error: `A is not identical to B` };\n    }\n    const mult = Math.pow(10, decimals);\n    const aa = Math.floor(a * mult);\n    const bb = Math.floor(b * mult);\n    if (aa !== bb)\n        return { success: false, error: `A is not close enough to B. A: ${a} B: ${b} Decimals: ${decimals}` };\n    return { success: true, value: a };\n};\n/**\n * Returns test of `value` being in the range of 0-1.\n * Equiv to `number(value, `percentage`);`\n *\n * This is the same as calling ```number(t, `percentage`)```\n * @param value Value to check\n * @param parameterName Param name for customising exception message\n * @returns\n */\nexport const percentTest = (value, parameterName = `?`, info) => numberTest(value, `percentage`, parameterName, info);\n// export const throwPercentTest = (value: number, parameterName = `?`) => {\n//   throwFromResult(percentTest(value, parameterName));\n//}\n/**\n * Checks if `value` an integer and meets additional criteria.\n * See {@link numberTest} for guard details, or use that if integer checking is not required.\n *\n * Note:\n * * `bipolar` will mean -1, 0 or 1.\n * * positive: must be at least zero\n * * negative: must be zero or lower\n * * aboveZero: must be above zero\n * * belowZero: must be below zero\n * * percentage: must be within 0-1, inclusive\n * * nonZero: can be anything except zero\n * @param value Value to check\n * @param parameterName Param name for customising exception message\n * @param range Guard specifier.\n */\nexport const integerTest = (value, range = ``, parameterName = `?`) => {\n    return resultsCollate(numberTest(value, range, parameterName), () => {\n        if (!Number.isInteger(value)) {\n            return { success: false, error: `Param '${parameterName}' is not an integer` };\n        }\n        return { success: true, value: value };\n    });\n};\nexport const integerArrayTest = (numbers) => {\n    for (const v of numbers) {\n        if (Math.abs(v) % 1 !== 0)\n            return { success: false, error: `Value is not an integer: ${v}` };\n    }\n    return { success: true, value: numbers };\n};\n/**\n * Returns _true_ if `value` is an integer in number or string form\n * @param value\n * @returns\n */\nexport const isInteger = (value) => {\n    if (typeof value === `string`)\n        value = Number.parseFloat(value);\n    const r = integerTest(value);\n    return r.success;\n};\n// export const throwIntegerTest = (value: number | undefined,\n//   range: NumberGuardRange = ``,\n//   parameterName = `?`) => {\n//   throwFromResult(integerTest(value, range, parameterName));\n// }\nexport const numberInclusiveRangeTest = (value, min, max, parameterName = `?`) => {\n    if (typeof value !== `number`) {\n        return { success: false, error: `Param '${parameterName}' is not a number type. Got type: '${typeof value}' value: '${JSON.stringify(value)}'` };\n    }\n    if (Number.isNaN(value)) {\n        return { success: false, error: `Param '${parameterName}' is not within range ${min}-${max}. Got: NaN` };\n    }\n    if (Number.isFinite(value)) {\n        if (value < min) {\n            return { success: false, error: `Param '${parameterName}' is below range ${min}-${max}. Got: ${value}` };\n        }\n        else if (value > max) {\n            return { success: false, error: `Param '${parameterName}' is above range ${min}-${max}. Got: ${value}` };\n        }\n        return { success: true, value };\n    }\n    else {\n        return { success: false, error: `Param '${parameterName}' is not within range ${min}-${max}. Got: infinite` };\n    }\n};\n// export const throwNumberInclusiveRangeTest = (value: number | undefined, min: number, max: number, parameterName = `?`) => {\n//   const r = numberInclusiveRangeTest(value, min, max, parameterName);\n//   if (r[ 0 ]) return;\n//   throw new Error(r[ 1 ]);\n// }\n","import { integerTest, numberInclusiveRangeTest } from \"./numbers.js\";\nimport { resultsCollate, resultThrow } from \"./result.js\";\n/**\n * Throws an error if parameter is not an array\n * @param value\n * @param parameterName\n */\nexport const arrayTest = (value, parameterName = `?`) => {\n    if (!Array.isArray(value)) {\n        return { success: false, error: `Parameter '${parameterName}' is expected to be an array'` };\n    }\n    return { success: true, value };\n};\n// export const throwArrayTest = (value: unknown, parameterName = `?`) => {\n//   resultThrow(arrayTest(value, parameterName));\n// }\n/**\n * Throws if `index` is an invalid array index for `array`, and if\n * `array` itself is not a valid array.\n * @param array\n * @param index\n */\nexport const arrayIndexTest = (array, index, name = `index`) => {\n    return resultsCollate(arrayTest(array), integerTest(index, `positive`, name), numberInclusiveRangeTest(index, 0, array.length - 1, name));\n};\n/**\n * Returns true if parameter is an array of strings\n * @param value\n * @returns\n */\nexport const arrayStringsTest = (value) => {\n    if (!Array.isArray(value))\n        return { success: false, error: `Value is not an array` };\n    if (value.some((v) => typeof v !== `string`)) {\n        return { success: false, error: `Contains something not a string` };\n    }\n    return { success: true, value };\n};\n// export const guardArray = <V>(array: ArrayLike<V>, name = `?`) => {\n//   if (array === undefined) {\n//     throw new TypeError(`Param '${ name }' is undefined. Expected array.`);\n//   }\n//   if (array === null) {\n//     throw new TypeError(`Param '${ name }' is null. Expected array.`);\n//   }\n//   if (!Array.isArray(array)) {\n//     throw new TypeError(`Param '${ name }' not an array as expected`);\n//   }\n// };\n","export const nullUndefTest = (value, parameterName = `?`) => {\n    if (typeof value === `undefined`) {\n        return { success: false, error: `${parameterName} param is undefined` };\n    }\n    if (value === null)\n        return { success: false, error: `${parameterName} param is null` };\n    return { success: true, value };\n};\n// export const throwNullUndef = (value: any, parameterName = `?`) => {\n//   const r = nullUndef(value, parameterName);\n//   if (r[ 0 ]) return;\n//   throw new Error(r[ 1 ]);\n// }\nexport const isDefined = (argument) => argument !== undefined;\n","export const isFunction = (object) => object instanceof Function;\n// eslint-disable-next-line @typescript-eslint/no-unsafe-function-type\nexport const functionTest = (value, parameterName = `?`) => {\n    if (value === undefined)\n        return { success: false, error: `Param '${parameterName}' is undefined. Expected: function.` };\n    if (value === null)\n        return { success: false, error: `Param '${parameterName}' is null. Expected: function.` };\n    if (typeof value !== `function`)\n        return { success: false, error: `Param '${parameterName}' is type '${typeof value}'. Expected: function` };\n    return { success: true, value };\n};\n// export const throwFunctionTest = (value: unknown, parameterName = `?`) => {\n//   const [ ok, message ] = functionTest(value, parameterName);\n//   if (ok) return;\n//   throw new TypeError(message);\n// }\n","/**\n * Tests_if `value` is a plain object\n *\n * ```js\n * isPlainObject(`text`); // false\n * isPlainObject(document); // false\n * isPlainObject({ hello: `there` }); // true\n * ```\n * @param value\n * @returns\n */\nexport const testPlainObject = (value) => {\n    if (typeof value !== `object` || value === null)\n        return { success: false, error: `Value is null or not object type` };\n    const prototype = Object.getPrototypeOf(value);\n    const t = (prototype === null || prototype === Object.prototype || Object.getPrototypeOf(prototype) === null) && !(Symbol.toStringTag in value) && !(Symbol.iterator in value);\n    if (t)\n        return { success: true, value };\n    return { success: false, error: `Fancy object` };\n};\n/**\n * Tests if `value` is primitive value (bigint,number,string or boolean) or plain object\n * @param value\n * @returns\n */\nexport const testPlainObjectOrPrimitive = (value) => {\n    const t = typeof value;\n    if (t === `symbol`)\n        return { success: false, error: `Symbol type` };\n    if (t === `function`)\n        return { success: false, error: `Function type` };\n    if (t === `bigint`)\n        return { success: true, value: value };\n    if (t === `number`)\n        return { success: true, value: value };\n    if (t === `string`)\n        return { success: true, value: value };\n    if (t === `boolean`)\n        return { success: true, value: value };\n    return testPlainObject(value);\n};\n","import { integerArrayTest } from \"./numbers.js\";\nimport { resultsCollate } from \"./result.js\";\nexport const rangeIntegerTest = (v, expected) => {\n    return resultsCollate(rangeTest(v, expected), integerArrayTest(v));\n};\n/**\n * Inclusive range 4-6 = 4, 5, 6\n * Exclusive range 4-6 = 5\n *\n * @param numbers\n * @param expected\n * @returns\n */\nexport const rangeTest = (numbers, expected) => {\n    for (const v of numbers) {\n        if (expected.minExclusive !== undefined) {\n            if (v <= expected.minExclusive) {\n                return { success: false, error: `Value '${v}' must be higher than minExclusive: '${expected.minExclusive}'` };\n            }\n        }\n        if (expected.minInclusive !== undefined) {\n            if (v < expected.minInclusive) {\n                return { success: false, error: `Value '${v}' must be equal or higher than minInclusive: '${expected.minInclusive}'` };\n            }\n        }\n        if (expected.maxExclusive !== undefined) {\n            if (v >= expected.maxExclusive) {\n                return { success: false, error: `Value '${v}' must be less than maxExclusive: '${expected.maxExclusive}'` };\n            }\n        }\n        if (expected.maxInclusive !== undefined) {\n            if (v > expected.maxInclusive) {\n                return { success: false, error: `Value '${v}' must be equal or less than maxInclusive: '${expected.maxInclusive}'` };\n            }\n        }\n    }\n    return { success: true, value: numbers };\n};\n","/**\n * Throws an error if parameter is not an string\n * @param value\n * @param parameterName\n */\nexport const stringTest = (value, range = ``, parameterName = `?`) => {\n    if (typeof value !== `string`)\n        return { success: false, error: `Param '${parameterName} is not type string. Got: ${typeof value}` };\n    switch (range) {\n        case `non-empty`:\n            if (value.length === 0)\n                return { success: false, error: `Param '${parameterName} is empty` };\n            break;\n    }\n    return { success: true, value };\n};\n// export const throwStringTest = (value: unknown, range: StringGuardRange = ``, parameterName = `?`) => {\n//   throwFromResult(stringTest(value, range, parameterName));\n// }\n","export * from './arrays.js';\nexport * from './empty.js';\nexport * from './function.js';\nexport * from './numbers.js';\nexport * from './object.js';\nexport * from './range.js';\nexport * from './result.js';\nexport * from './string.js';\nexport * from './types.js';\n","/**\n * Returns _true_ if `value` is number, string, bigint or boolean.\n * Returns _false_ if `value` is an object, null, undefined\n *\n * Use {@link isPrimitiveOrObject} to also return true if `value` is an object.\n * @param value Value to check\n * @returns _True_ if value is number, string, bigint or boolean.\n */\nexport function isPrimitive(value) {\n    if (typeof value === `number`)\n        return true;\n    if (typeof value === `string`)\n        return true;\n    if (typeof value === `bigint`)\n        return true;\n    if (typeof value === `boolean`)\n        return true;\n    return false;\n}\n/**\n * Returns _true_ if `value` is number, string, bigint, boolean or an object\n *\n * Use {@link isPrimitive} to not include objects.\n * @param value\n * @returns\n */\nexport function isPrimitiveOrObject(value) {\n    if (isPrimitive(value))\n        return true;\n    if (typeof value === `object`)\n        return true;\n    return false;\n}\n","export const removeCircularReferences = (value, replaceWith = null, seen = new WeakSet(), path = ``) => {\n    if (value === null)\n        return value;\n    if (typeof value !== `object`)\n        throw new TypeError(`Param 'value' must be an object. Got type: ${typeof value}`);\n    seen.add(value);\n    const entries = Object.entries(value);\n    for (const entry of entries) {\n        if (entry[1] === null)\n            continue;\n        if (typeof entry[1] !== `object`)\n            continue;\n        if (seen.has(entry[1])) {\n            //value[ entry[0] ] = replaceWith;\n            entry[1] = replaceWith;\n            continue;\n        }\n        entry[1] = removeCircularReferences(entry[1], replaceWith, seen, `${entry[0]}.`);\n    }\n    return Object.fromEntries(entries);\n};\n","// Via Vuejs\nimport { removeCircularReferences } from \"./records/circular.js\";\n// eslint-disable-next-line @typescript-eslint/unbound-method\nconst objectToString = Object.prototype.toString;\nconst toTypeString = (value) => objectToString.call(value);\n/**\n * Returns _true_ if `value` is a Map type\n * @param value\n * @returns\n */\nexport const isMap = (value) => toTypeString(value) === `[object Map]`;\n/**\n * Returns _true_ if `value` is a Set type\n * @param value\n * @returns\n */\nexport const isSet = (value) => toTypeString(value) === `[object Set]`;\n/**\n * A default converter to string that uses JSON.stringify if its an object, or the thing itself if it's a string\n */\nexport const toStringDefault = (itemToMakeStringFor) => typeof itemToMakeStringFor === `string`\n    ? itemToMakeStringFor\n    : JSON.stringify(itemToMakeStringFor);\n/**\n * Converts a value to string form.\n * For simple objects, .toString() is used, other JSON.stringify is used.\n * It is meant for creating debugging output or 'hash' versions of objects, and does\n * not necessarily maintain full fidelity of the input\n * @param value\n * @returns\n */\nexport const defaultToString = (value) => {\n    //ECMA specification: http://www.ecma-international.org/ecma-262/6.0/#sec-tostring\n    if (value === null)\n        return `null`;\n    if (typeof value === `boolean` || typeof value === `number`) {\n        return value.toString();\n    }\n    if (typeof value === `string`)\n        return value;\n    if (typeof value === `symbol`)\n        throw new TypeError(`Symbol cannot be converted to string`);\n    try {\n        const s = JSON.stringify(value);\n        return s;\n    }\n    catch (error) {\n        // Circular maybe\n        if (typeof value === `object`) {\n            return JSON.stringify(removeCircularReferences(value, `(circular)`));\n        }\n        else {\n            throw error;\n        }\n    }\n};\n","import { toStringDefault } from \"./to-string.js\";\n/**\n * If input is a string, it is returned.\n * Otherwise, it returns the result of JSON.stringify() with fields ordered.\n *\n * This allows for more consistent comparisons when object field orders are different but values the same.\n * @param itemToMakeStringFor\n * @returns\n */\nexport const toStringOrdered = (itemToMakeStringFor) => {\n    if (typeof itemToMakeStringFor === `string`)\n        return itemToMakeStringFor;\n    const allKeys = new Set();\n    JSON.stringify(itemToMakeStringFor, (key, value) => (allKeys.add(key), value));\n    return JSON.stringify(itemToMakeStringFor, [...allKeys].sort());\n};\n/**\n * Default comparer function is equiv to checking `a === b`.\n * Use {@link isEqualValueDefault} to compare by value, via comparing JSON string representation.\n */\nexport const isEqualDefault = (a, b) => a === b;\n/**\n * Comparer returns true if string representation of `a` and `b` are equal.\n * Use {@link isEqualDefault} to compare using === semantics\n * Uses `toStringDefault` to generate a string representation (via `JSON.stringify`).\n *\n * Returns _false_ if the ordering of fields is different, even though values are identical:\n * ```js\n * isEqualValueDefault({ a: 10, b: 20}, { b: 20, a: 10 }); // false\n * ```\n *\n * Use {@link isEqualValueIgnoreOrder} to ignore order (with an overhead of additional processing).\n * ```js\n * isEqualValueIgnoreOrder({ a: 10, b: 20}, { b: 20, a: 10 }); // true\n * ```\n *\n * Use {@link isEqualValuePartial} to partially match `b` against `a`.\n * @returns True if the contents of `a` and `b` are equal\n */\nexport const isEqualValueDefault = (a, b) => {\n    //  UNIT TESTED\n    if (a === b)\n        return true; // Object references are the same, or string values are the same\n    return toStringDefault(a) === toStringDefault(b); // String representations are the same\n};\n/**\n * Returns _true_ if `a` contains the values of `b`. `a` may contain other values, but we\n * only check against what is in `b`. `a` and `b` must both be simple objects.\n *\n * ```js\n * const obj = {\n *  name: `Elle`,\n *  size: 100,\n *  colour: {\n *    red: 0.5,\n *    green: 0.1,\n *    blue: 0.2\n *  }\n * }\n *\n * isEqualValuePartial(obj, { name: `Elle` }); // true\n * isEqualValuePartial(obj, { name: { colour: red: { 0.5, green: 0.1  }} }); // true\n *\n * isEqualValuePartial(obj, { name: `Ellen` });     // false\n * isEqualValuePartial(obj, { lastname: `Elle` });  // false\n * ```\n * @param a\n * @param b\n * @param fieldComparer\n * @returns\n */\nexport const isEqualValuePartial = (a, b, fieldComparer) => {\n    if (typeof a !== `object`)\n        throw new Error(`Param 'a' expected to be object`);\n    if (typeof b !== `object`)\n        throw new Error(`Param 'b' expected to be object`);\n    if (Object.is(a, b))\n        return true;\n    const comparer = fieldComparer ?? isEqualValuePartial;\n    for (const entryB of Object.entries(b)) {\n        const valueOnAKeyFromB = a[entryB[0]];\n        const valueB = entryB[1];\n        if (typeof valueOnAKeyFromB === `object` && typeof valueB === `object`) {\n            if (!comparer(valueOnAKeyFromB, valueB)) {\n                return false;\n            }\n        }\n        else {\n            if (valueOnAKeyFromB !== valueB) {\n                return false;\n            }\n        }\n    }\n    return true;\n};\n/**\n * Comparer returns true if string representation of `a` and `b` are equal, regardless of field ordering.\n * Uses `toStringOrdered` to generate a string representation (via JSON.stringify`).\n *\n * ```js\n * isEqualValueIgnoreOrder({ a: 10, b: 20}, { b: 20, a: 10 }); // true\n * isEqualValue({ a: 10, b: 20}, { b: 20, a: 10 }); // false, fields are different order\n * ```\n *\n * There is an overhead to ordering fields. Use {@link isEqualValueDefault} if it's not possible that field ordering will change.\n * @returns True if the contents of `a` and `b` are equal\n * @typeParam T - Type of objects being compared\n */\nexport const isEqualValueIgnoreOrder = (a, b) => {\n    //  UNIT TESTED\n    if (a === b)\n        return true; // Object references are the same, or string values are the same\n    return toStringOrdered(a) === toStringOrdered(b); // String representations are the same\n};\n/**\n * Returns _true_ if Object.entries() is empty for `value`\n * @param value\n * @returns\n */\nexport const isEmptyEntries = (value) => [...Object.entries(value)].length === 0;\n/**\n * Returns _true_ if `a` and `b` are equal based on their JSON representations.\n * `path` is ignored.\n * @param a\n * @param b\n * @param path\n * @returns\n */\nexport const isEqualContextString = (a, b, _path) => {\n    return JSON.stringify(a) === JSON.stringify(b);\n};\n","import { isEqualDefault } from \"./is-equal.js\";\n/**\n * Compares the values of two iterables, returning a list\n * of items they have in common and those unique in `a` or `b`.\n * Ignores ordering of values, and is NOT recursive.\n *\n * ```js\n * const a = ['apples', 'oranges', 'pears' ]\n * const b = ['pears', 'kiwis', 'bananas' ];\n *\n * const r = compareValuesShallow(a, b);\n * r.shared;  // [ 'pears' ]\n * r.a;       // [ 'apples', 'oranges' ]\n * r.b;       // [ 'kiwis', 'bananas' ]\n * ```\n *\n * By default uses === semantics for comparison.\n * @param a\n * @param b\n * @param eq\n * @returns\n */\nexport const compareIterableValuesShallow = (a, b, eq = (isEqualDefault)) => {\n    const shared = [];\n    const aUnique = [];\n    const bUnique = [];\n    for (const elementOfA of a) {\n        let seenInB = false;\n        // Does B contain this thing from A?\n        for (const elementOfB of b) {\n            if (eq(elementOfA, elementOfB)) {\n                seenInB = true;\n                break;\n            }\n        }\n        if (seenInB) {\n            // Common in A & B\n            shared.push(elementOfA);\n        }\n        else {\n            // No, it's only found in A\n            aUnique.push(elementOfA);\n        }\n    }\n    for (const elementOfB of b) {\n        let seenInA = false;\n        // Does A contain this thing from B?\n        for (const elementOfA of a) {\n            if (eq(elementOfB, elementOfA)) {\n                seenInA = true;\n            }\n        }\n        if (!seenInA) {\n            // No, something unique to B\n            bUnique.push(elementOfB);\n        }\n    }\n    // Are the two iterables the same?\n    const isSame = aUnique.length === 0 && bUnique.length === 0;\n    return {\n        shared,\n        isSame,\n        a: aUnique,\n        b: bUnique\n    };\n};\n","import { integerTest, resultThrow } from \"@ixfx/guards\";\n/**\n * Rounds a number.\n *\n * If one parameter is given, it's the decimal places,\n * and a rounding function is returned:\n * ```js\n * const r = round(2);\n * r(10.12355); // 10.12\n * ```\n *\n * If two parameters are given, the first is decimal places,\n * the second the value to round.\n * ```js\n * round(2, 10.12355); // 10.12\n * ```\n * @param decimalPlaces\n * @returns\n */\nexport function round(a, b, roundUp) {\n    resultThrow(integerTest(a, `positive`, `decimalPlaces`));\n    const up = (typeof b === `boolean`) ? b : (roundUp ?? false);\n    let rounder;\n    if (a === 0) {\n        rounder = Math.round;\n    }\n    else {\n        const p = Math.pow(10, a);\n        if (up) {\n            rounder = (v) => Math.ceil(v * p) / p;\n        }\n        else {\n            rounder = (v) => Math.floor(v * p) / p;\n        }\n    }\n    if (typeof b === `number`)\n        return rounder(b);\n    return rounder;\n}\n","import { numberTest } from '@ixfx/guards';\nimport { round } from './util/round.js';\n// export function intervalToMs(interval: Interval | undefined): number | undefined;\n// export function intervalToMs(\n//   interval: Interval | undefined,\n//   defaultNumber: number\n// ): number;\n/**\n * Return the millisecond value of an Interval.\n *\n * ```js\n * intervalToMs(100); // 100\n * intervalToMs({ millis: 100 }); // 100\n * ```\n *\n * Use `defaultNumber` to return a default in the case of\n * _undefined_ or invalid input.\n *\n * ```js\n * intervalToMs(undefined);      // throws error\n * intervalToMs(undefined, 100); // 100\n * ```\n *\n * If no default is provided, an exception is thrown.\n * @param interval Interval\n * @param defaultNumber Default value if `interval` is _undefined_ or invalid\n * @returns Milliseconds\n */\nexport function intervalToMs(interval, defaultNumber) {\n    if (isInterval(interval)) {\n        // Number given, must be millis?\n        if (typeof interval === `number`)\n            return interval;\n        let ms = interval.millis ?? 0;\n        ms += (interval.hours ?? 0) * 60 * 60 * 1000;\n        ms += (interval.mins ?? 0) * 60 * 1000;\n        ms += (interval.secs ?? 0) * 1000;\n        return ms;\n    }\n    else {\n        if (typeof defaultNumber !== `undefined`)\n            return defaultNumber;\n        throw new Error(`Not a valid interval: ${JSON.stringify(interval)}`);\n    }\n}\n/**\n * Returns _true_ if `interval` matches the {@link Interval} type.\n * @param interval\n * @returns _True_ if `interval` is an {@link Interval}.\n */\nexport function isInterval(interval) {\n    if (typeof interval === `undefined`)\n        return false;\n    if (interval === null)\n        return false;\n    if (typeof interval === `number`) {\n        if (Number.isNaN(interval))\n            return false;\n        if (!Number.isFinite(interval))\n            return false;\n        return true;\n    }\n    if (typeof interval !== `object`)\n        return false;\n    const hasMillis = `millis` in interval;\n    const hasSecs = `secs` in interval;\n    const hasMins = `mins` in interval;\n    const hasHours = `hours` in interval;\n    if (hasMillis && !numberTest(interval.millis).success)\n        return false;\n    if (hasSecs && !numberTest(interval.secs).success)\n        return false;\n    if (hasMins && !numberTest(interval.mins).success)\n        return false;\n    if (hasHours && !numberTest(interval.hours).success)\n        return false;\n    if (hasMillis || hasSecs || hasHours || hasMins)\n        return true;\n    return false;\n}\n/**\n * Returns a human-readable representation\n * of some elapsed milliseconds\n *\n * @example\n * ```js\n * elapsedToHumanString(10);      // `10ms`\n * elapsedToHumanString(2000);    // `2s`\n * elapsedToHumanString(65*1000); // `1mins`\n * ```\n * @param millisOrFunction Milliseconds as a number, {@link Interval} or function that resolve to a number\n * @param rounding Rounding (default: 2)\n * @returns\n */\nexport const elapsedToHumanString = (millisOrFunction, rounding = 2) => {\n    let interval = 0;\n    if (typeof millisOrFunction === `function`) {\n        const intervalResult = millisOrFunction();\n        return elapsedToHumanString(intervalResult);\n    }\n    else if (typeof millisOrFunction === `number`) {\n        interval = millisOrFunction;\n    }\n    else if (typeof millisOrFunction === `object`) {\n        interval = intervalToMs(interval);\n    }\n    let ms = intervalToMs(interval);\n    if (typeof ms === `undefined`)\n        return `(undefined)`;\n    if (ms < 1000)\n        return `${round(rounding, ms)}ms`;\n    ms /= 1000;\n    if (ms < 120)\n        return `${ms.toFixed(1)}secs`;\n    ms /= 60;\n    if (ms < 60)\n        return `${ms.toFixed(2)}mins`;\n    ms /= 60;\n    return `${ms.toFixed(2)}hrs`;\n};\n","import { defaultToString } from \"./to-string.js\";\n/**\n * Sort numbers in ascending order.\n *\n * ```js\n * [10, 4, 5, 0].sort(numericComparer);\n * // Yields: [0, 4, 5, 10]\n * [10, 4, 5, 0].sort(comparerInverse(numericComparer));\n * // Yields: [ 10, 5, 4, 0]\n * ```\n *\n * Returns:\n * * 0: values are equal\n * * negative: `a` should be before `b`\n * * positive: `a` should come after `b`\n * @param a\n * @param b\n * @returns\n */\nexport const numericComparer = (a, b) => {\n    //  Unit tested\n    if (a === b)\n        return 0;\n    if (a > b)\n        return 1;\n    return -1;\n};\n/**\n * Default sort comparer, following same sematics as Array.sort.\n * Consider using {@link defaultComparer} to get more logical sorting of numbers.\n *\n * Note: numbers are sorted in alphabetical order, eg:\n * ```js\n * [ 10, 20, 5, 100 ].sort(jsComparer); // same as .sort()\n * // Yields: [10, 100, 20, 5]\n * ```\n *\n * Returns -1 if x is less than y\n * Returns 1 if x is greater than y\n * Returns 0 if x is the same as y\n * @param x\n * @param y\n * @returns\n */\nexport const jsComparer = (x, y) => {\n    //  Unit tested\n    // Via https://stackoverflow.com/questions/47334234/how-to-implement-array-prototype-sort-default-compare-function\n    if (x === undefined && y === undefined)\n        return 0;\n    if (x === undefined)\n        return 1;\n    if (y === undefined)\n        return -1;\n    const xString = defaultToString(x);\n    const yString = defaultToString(y);\n    if (xString < yString)\n        return -1;\n    if (xString > yString)\n        return 1;\n    return 0;\n};\n/**\n * Inverts the source comparer.\n * @param comparer\n * @returns\n */\nexport const comparerInverse = (comparer) => {\n    return (x, y) => {\n        const v = comparer(x, y);\n        return v * -1;\n    };\n};\n/**\n * Compares numbers by numeric value, otherwise uses the default\n * logic of string comparison.\n *\n * Is an ascending sort:\n * * b, a, c -> a, b, c\n * * 10, 5, 100 -> 5, 10, 100\n *\n * Returns -1 if x is less than y\n * Returns 1 if x is greater than y\n * Returns 0 if x is the same as y\n * @param x\n * @param y\n * @see {@link comparerInverse} Inverted order\n * @returns\n */\nexport const defaultComparer = (x, y) => {\n    if (typeof x === `number` && typeof y === `number`) {\n        return numericComparer(x, y);\n    }\n    return jsComparer(x, y);\n};\n","import { defaultComparer } from './comparers.js';\nimport { isEqualDefault } from './is-equal.js';\nimport { toStringDefault, } from './to-string.js';\n/**\n * Gets the closest integer key to `target` in `data`.\n * * Requires map to have numbers as keys, not strings\n * * Math.round is used for rounding `target`.\n *\n * Examples:\n * ```js\n * // Assuming numeric keys 1, 2, 3, 4 exist:\n * getClosestIntegerKey(map, 3);    // 3\n * getClosestIntegerKey(map, 3.1);  // 3\n * getClosestIntegerKey(map, 3.5);  // 4\n * getClosestIntegerKey(map, 3.6);  // 4\n * getClosestIntegerKey(map, 100);  // 4\n * getClosestIntegerKey(map, -100); // 1\n * ```\n * @param data Map\n * @param target Target value\n * @returns\n */\nexport const getClosestIntegerKey = (data, target) => {\n    target = Math.round(target);\n    if (data.has(target)) {\n        return target;\n    }\n    else {\n        let offset = 1;\n        while (offset < 1000) {\n            if (data.has(target - offset))\n                return target - offset;\n            else if (data.has(target + offset))\n                return target + offset;\n            offset++;\n        }\n        throw new Error(`Could not find target ${target.toString()}`);\n    }\n};\n/**\n * Returns the first value in `data` that matches a key from `keys`.\n * ```js\n * // Iterate, yielding: `a.b.c.d`, `b.c.d`, `c.d`, `d`\n * const keys = Text.segmentsFromEnd(`a.b.c.d`);\n * // Gets first value that matches a key (starting from most precise)\n * const value = findBySomeKey(data, keys);\n * ```\n * @param data\n * @param keys\n * @returns\n */\nexport const findBySomeKey = (data, keys) => {\n    for (const key of keys) {\n        if (data.has(key))\n            return data.get(key);\n    }\n};\n/**\n * Returns true if map contains `value` under `key`, using `comparer` function. Use {@link hasAnyValue} if you don't care\n * what key value might be under.\n *\n * Having a comparer function is useful to check by value rather than object reference.\n *\n * @example Find key value based on string equality\n * ```js\n * hasKeyValue(map,`hello`, `samantha`, (a, b) => a === b);\n * ```\n * @param map Map to search\n * @param key Key to search\n * @param value Value to search\n * @param comparer Function to determine match. By default uses === comparison.\n * @returns True if key is found\n */\nexport const hasKeyValue = (map, key, value, comparer = isEqualDefault) => {\n    if (!map.has(key))\n        return false;\n    const values = [...map.values()];\n    return values.some((v) => comparer(v, value));\n};\n/**\n * Deletes all key/values from map where value matches `value`,\n * with optional comparer. Mutates map.\n *\n * ```js\n * // Compare fruits based on their colour property\n * const colourComparer = (a, b) => a.colour === b.colour;\n *\n * // Deletes all values where .colour = `red`\n * deleteByValueCompareMutate(map, { colour: `red` }, colourComparer);\n * ```\n * @param map\n * @param value\n * @param comparer Uses === equality by default. Use isEqualValueDefault to compare by value\n */\nexport const deleteByValueCompareMutate = (map, value, comparer = isEqualDefault) => {\n    for (const entry of map.entries()) {\n        if (comparer(entry[1], value)) {\n            map.delete(entry[0]);\n        }\n    }\n};\n/**\n * Finds first entry by iterable value. Expects a map with an iterable as values.\n *\n * ```js\n * const map = new Map();\n * map.set('hello', 'a');\n * map.set('there', 'b');\n *\n * const entry = findEntryByPredicate(map, (value, key) => {\n *  return (value === 'b');\n * });\n * // Entry is: ['there', 'b']\n * ```\n *\n * An alternative is {@link findEntryByValue} to search by value.\n * @param map Map to search\n * @param predicate Filter function returns true when there is a match of value\n * @returns Entry, or _undefined_ if `filter` function never returns _true_\n */\nexport const findEntryByPredicate = (map, predicate) => {\n    for (const entry of map.entries()) {\n        if (predicate(entry[1], entry[0]))\n            return entry;\n    }\n};\n/**\n * Finds first entry by value.\n *\n * ```js\n * const map = new Map();\n * map.set('hello', 'a');\n * map.set('there', 'b');\n *\n * const entry = findEntryByValue(map, 'b');\n * // Entry is: ['there', 'b']\n * ```\n *\n * Uses JS's === comparison by default. Consider using `isEqualValueDefault` to match by value.\n * An alternative is {@link findEntryByValue} to search by predicate function.\n * @param map Map to search\n * @param value Value to seek\n * @param isEqual Filter function which checks equality. Uses JS comparer by default.\n * @returns Entry, or _undefined_ if `value` not found.\n */\nexport const findEntryByValue = (map, value, isEqual = isEqualDefault) => {\n    for (const entry of map.entries()) {\n        if (isEqual(entry[1], value))\n            return entry;\n    }\n};\n/**\n * Adds items to a map only if their key doesn't already exist\n *\n * Uses provided {@link ToString} function to create keys for items. Item is only added if it doesn't already exist.\n * Thus the older item wins out, versus normal `Map.set` where the newest wins.\n *\n * Returns a copy of the input map.\n * @example\n * ```js\n * const map = new Map();\n * const peopleArray = [ _some people objects..._];\n * addKeepingExisting(map, p => p.name, ...peopleArray);\n * ```\n * @param set\n * @param hasher\n * @param values\n * @returns\n */\n// export const addKeepingExisting = <V>(\n//   set: ReadonlyMap<string, V> | undefined,\n//   hasher: ToString<V>,\n//   ...values: readonly V[]\n// ) => {\n//   const s = set === undefined ? new Map() : new Map(set);\n//   for (const v of values) {\n//     const hashResult = hasher(v);\n//     if (s.has(hashResult)) continue;\n//     s.set(hashResult, v);\n//   }\n//   return s;\n// };\n/**\n * Mutates `map`, adding each value to it using a\n * function to produce a key. Use {@link addValue} for an immutable version.\n * ```\n * const map = new Map();\n * addValueMutate(map, v=>v.name, { name:`Jane`, size:10 }, { name:`Bob`, size: 9 });\n * // Map consists of entries:\n * // [ `Jane`, { name:`Jane`, size:10 } ],\n * // [ `Bob` { name:`Bob`, size: 9 } ]\n * ```\n *\n * Uses {@link addValueMutator} under the hood.\n * @param map Map to modify. If _undefined_, a new map is created\n * @param hasher Function to generate a string key for a given object value\n * @param values Values to add\n * @param collisionPolicy What to do if the key already exists\n * @returns Map instance\n */\nexport const addValueMutate = (map, hasher, collisionPolicy, ...values) => {\n    const m = map ?? new Map();\n    const f = addValueMutator(m, hasher, collisionPolicy);\n    f(...values);\n    return m;\n};\n/**\n * Adds values to a map, returning a new, modified copy and leaving the original\n * intact.\n *\n * Use {@link addValueMutate} for a mutable\n * @param map Map to start with, or _undefined_ to automatically create a map\n * @param hasher Function to create keys for values\n * @param collisionPolicy What to do if a key already exists\n * @param values Values to add\n * @returns A new map containing values\n */\nexport const addValue = (map, hasher, collisionPolicy, ...values) => {\n    const m = map === undefined ? new Map() : new Map(map);\n    for (const v of values) {\n        const hashResult = hasher(v);\n        if (collisionPolicy !== `overwrite`) {\n            if (m.has(hashResult)) {\n                if (collisionPolicy === `throw`)\n                    throw new Error(`Key '${hashResult}' already in map`);\n                if (collisionPolicy === `skip`)\n                    continue;\n            }\n        }\n        m.set(hashResult, v);\n    }\n    return m;\n};\n/**\n * Returns a function that adds values to a map, using a hashing function to produce a key.\n * Use {@link addValueMutate} if you don't need a reusable function.\n *\n * ```js\n * const map = new Map(); // Create map\n * const mutate = addValueMutator(map, v=>v.name); // Create a mutator using default 'overwrite' policy\n * mutate( { name:`Bob`, size:10 }, { name: `Alice`, size: 2 }); // Add values to map\n * mutate( {name: `Bob`, size: 11 }); // Change the value stored under key `Bob`.\n * map.get(`Bob`); // { name: `Bob`, size: 11 }\n * ```\n *\n * The 'collision policy' determines what to do if the key already exists. The default behaviour\n * is to overwrite the key, just as Map.set would.\n * ```js\n * const map = new Map();\n * const mutate = addValueMutator(map, v=>v.name, `skip`);\n * mutate( { name:`Bob`,size:10 }, { name: `Alice`, size: 2 }); // Add values to map\n * mutate( { name:`Bob`, size: 20 }); // This value would be skipped because map already contains 'Bob'\n * map.get(`Bob`); // { name: `Bob`, size: 10 }\n * ```\n *\n * @param map Map to modify\n * @param hasher Hashing function to make a key for a value\n * @param collisionPolicy What to do if a value is already stored under a key\n * @returns Function\n */\nexport const addValueMutator = (map, hasher, collisionPolicy = `overwrite`) => {\n    return (...values) => {\n        for (const v of values) {\n            const hashResult = hasher(v);\n            if (collisionPolicy !== `overwrite`) {\n                if (map.has(hashResult)) {\n                    if (collisionPolicy === `throw`)\n                        throw new Error(`Key '${hashResult}' already in map`);\n                    if (collisionPolicy === `skip`)\n                        continue;\n                }\n            }\n            map.set(hashResult, v);\n        }\n        return map;\n    };\n};\n/**\n * Returns a array of entries from a map, sorted by value.\n *\n * ```js\n * const m = new Map();\n * m.set(`4491`, { name: `Bob` });\n * m.set(`2319`, { name: `Alice` });\n *\n * // Compare by name\n * const comparer = (a, b) => defaultComparer(a.name, b.name);\n *\n * // Get sorted values\n * const sorted = Maps.sortByValue(m, comparer);\n * ```\n *\n * `sortByValue` takes a comparison function that should return -1, 0 or 1 to indicate order of `a` to `b`.\n * @param map\n * @param comparer\n * @returns\n */\nexport const sortByValue = (map, comparer) => {\n    const f = comparer ?? defaultComparer;\n    return [...map.entries()].sort((a, b) => f(a[1], b[1]));\n};\n/**\n * Returns an array of entries from a map, sorted by a property of the value\n *\n * ```js\n * const m = new Map();\n * m.set(`4491`, { name: `Bob` });\n * m.set(`2319`, { name: `Alice` });\n * const sorted = sortByValueProperty(m, `name`);\n * ```\n * @param map Map to sort\n * @param property Property of value\n * @param compareFunction Comparer. If unspecified, uses a default.\n */\nexport const sortByValueProperty = (map, property, compareFunction) => {\n    const cfn = typeof compareFunction === `undefined` ? defaultComparer : compareFunction;\n    return [...map.entries()].sort((aE, bE) => {\n        const a = aE[1];\n        const b = bE[1];\n        return cfn(a[property], b[property]);\n    });\n};\n/**\n * Returns _true_ if any key contains `value`, based on the provided `comparer` function. Use {@link hasKeyValue}\n * if you only want to find a value under a certain key.\n *\n * Having a comparer function is useful to check by value rather than object reference.\n * @example Finds value where name is 'samantha', regardless of other properties\n * ```js\n * hasAnyValue(map, {name:`samantha`}, (a, b) => a.name === b.name);\n * ```\n *\n * Works by comparing `value` against all values contained in `map` for equality using the provided `comparer`.\n *\n * @param map Map to search\n * @param value Value to find\n * @param comparer Function that determines matching. Should return true if `a` and `b` are considered equal.\n * @returns True if value is found\n */\nexport const hasAnyValue = (map, value, comparer) => {\n    const entries = [...map.entries()];\n    return entries.some((kv) => comparer(kv[1], value));\n};\n/**\n * Returns values where `predicate` returns true.\n *\n * If you just want the first match, use `find`\n *\n * @example All people over thirty\n * ```js\n * // for-of loop\n * for (const v of filterValues(people, person => person.age > 30)) {\n *\n * }\n * // If you want an array\n * const overThirty = Array.from(filterValues(people, person => person.age > 30));\n * ```\n * @param map Map\n * @param predicate Filtering predicate\n * @returns Values that match predicate\n */\nexport function* filterValues(map, predicate) {\n    for (const v of map.values()) {\n        if (predicate(v))\n            yield v;\n    }\n}\n//export const filter = <V>(map:ReadonlyMap<string, V>, predicate:(v:V) => boolean):ReadonlyArray<V> => Array.from(map.values()).filter(predicate);\n/**\n * Copies data to an array\n * @param map\n * @returns\n */\nexport const toArray = (map) => [...map.values()];\n/**\n * Returns a Map from an iterable. By default throws an exception\n * if iterable contains duplicate values.\n *\n * ```js\n * const data = [\n *  { fruit: `granny-smith`, family: `apple`, colour: `green` },\n *  { fruit: `mango`, family: `stone-fruit`, colour: `orange` }\n * ];\n * const map = fromIterable(data, v => v.fruit);\n * map.get(`granny-smith`); // { fruit: `granny-smith`, family: `apple`, colour: `green` }\n * ```\n * @param data Input data\n * @param keyFunction Function which returns a string id. By default uses the JSON value of the object.\n * @param collisionPolicy By default, values with same key overwrite previous (`overwrite`)\n * @returns\n */\nexport const fromIterable = (data, keyFunction = (toStringDefault), collisionPolicy = `overwrite`) => {\n    const m = new Map();\n    for (const d of data) {\n        const key = keyFunction(d);\n        if (m.has(key)) {\n            if (collisionPolicy === `throw`)\n                throw new Error(`Key '${key}' is already used and new data will overwrite it. `);\n            if (collisionPolicy === `skip`)\n                continue;\n        }\n        m.set(key, d);\n    }\n    return m;\n};\n/**\n * Returns a Map from an object, or array of objects.\n * Assumes the top-level properties of the object is the key.\n *\n * ```js\n * const data = {\n *  Sally: { name: `Sally`, colour: `red` },\n *  Bob: { name: `Bob`, colour: `pink` }\n * };\n * const map = fromObject(data);\n * map.get(`Sally`); // { name: `Sally`, colour: `red` }\n * ```\n *\n * To add an object to an existing map, use {@link addObjectEntriesMutate}.\n * @param data\n * @returns\n */\nexport const fromObject = (data) => {\n    const map = new Map();\n    if (Array.isArray(data)) {\n        for (const d of data)\n            addObjectEntriesMutate(map, d);\n    }\n    else {\n        addObjectEntriesMutate(map, data);\n    }\n    return map;\n};\n/**\n * Adds an object to an existing map, mutating it.\n * It assumes a structure where each top-level property is a key:\n *\n * ```js\n * const data = {\n *  Sally: { colour: `red` },\n *  Bob:   { colour: `pink` }\n * };\n * const map = new Map();\n * addObjectEntriesMutate(map, data);\n *\n * map.get(`Sally`); // { name: `Sally`, colour: `red` }\n * ```\n *\n * To create a new map from an object, use {@link fromObject} instead.\n * @param map\n * @param data\n */\nexport const addObjectEntriesMutate = (map, data) => {\n    const entries = Object.entries(data);\n    for (const [key, value] of entries) {\n        map.set(key, value);\n    }\n};\n/**\n * Returns the first found value that matches `predicate` or _undefined_.\n * To get an entry see {@link findEntryByPredicate}\n *\n * Use {@link some} if you don't care about the value, just whether it appears.\n * Use {@link filterValue} to get all value(s) that match `predicate`.\n *\n * @example First person over thirty\n * ```js\n * const overThirty = findValue(people, person => person.age > 30);\n * ```\n * @param map Map to search\n * @param predicate Function that returns true for a matching value\n * @returns Found value or _undefined_\n */\nexport const findValue = (map, predicate) => [...map.values()].find(v => predicate(v));\n/**\n * Returns _true_ if `predicate` yields _true_ for any value in `map`.\n * Use {@link findValue} if you want the matched value.\n * ```js\n * const map = new Map();\n * map.set(`fruit`, `apple`);\n * map.set(`colour`, `red`);\n * Maps.some(map, v => v === `red`);    // true\n * Maps.some(map, v => v === `orange`); // false\n * ```\n * @param map\n * @param predicate\n * @returns\n */\nexport const some = (map, predicate) => [...map.values()].some(v => predicate(v));\n/**\n * Converts a map to a simple object, transforming from type `T` to `K` as it does so. If no transforms are needed, use {@link toObject}.\n *\n * ```js\n * const map = new Map();\n * map.set(`name`, `Alice`);\n * map.set(`pet`, `dog`);\n *\n * const o = mapToObjectTransform(map, v => {\n *  ...v,\n *  registered: true\n * });\n *\n * // Yields: { name: `Alice`, pet: `dog`, registered: true }\n * ```\n *\n * If the goal is to create a new map with transformed values, use {@link transformMap}.\n * @param m\n * @param valueTransform\n * @typeParam T Value type of input map\n * @typeParam K Value type of destination map\n * @returns\n */\nexport const mapToObjectTransform = (m, valueTransform) => [...m].reduce((object, [key, value]) => {\n    const t = valueTransform(value);\n    object[key] = t;\n    return object;\n}, {});\n/**\n * Zips together an array of keys and values into an object. Requires that\n * `keys` and `values` are the same length.\n *\n * @example\n * ```js\n * const o = zipKeyValue([`a`, `b`, `c`], [0, 1, 2])\n * Yields: { a: 0, b: 1, c: 2}\n *```\n * @param keys String keys\n * @param values Values\n * @typeParam V Type of values\n * @return Object with keys and values\n */\nexport const zipKeyValue = (keys, values) => {\n    if (keys.length !== values.length) {\n        throw new Error(`Keys and values arrays should be same length`);\n    }\n    return Object.fromEntries(keys.map((k, index) => [k, values[index]]));\n};\n//#region Functions by Kees C. Bakker\n// Functions by Kees C. Bakker\n// https://keestalkstech.com/2021/10/having-fun-grouping-arrays-into-maps-with-typescript/\n/**\n * Like `Array.map`, but for a Map. Transforms from Map<K,V> to Map<K,R>, returning as a new Map.\n *\n * @example\n * ```js\n * const mapOfStrings = new Map();\n * mapOfStrings.set(`a`, `10`);\n * mapOfStrings.get(`a`); // Yields `10` (a string)\n *\n * // Convert a map of string->string to string->number\n * const mapOfInts = transformMap(mapOfStrings, (value, key) => parseInt(value));\n *\n * mapOfInts.get(`a`); // Yields 10 (a proper number)\n * ```\n *\n * If you want to combine values into a single object, consider instead  {@link mapToObjectTransform}.\n * @param source\n * @param transformer\n * @typeParam K Type of keys (generally a string)\n * @typeParam V Type of input map values\n * @typeParam R Type of output map values\n * @returns\n */\nexport const transformMap = (source, transformer) => new Map(Array.from(source, (v) => [v[0], transformer(v[1], v[0])]));\n/**\n * Converts a `Map` to a plain object, useful for serializing to JSON.\n * To convert back to a map use {@link fromObject}.\n *\n * @example\n * ```js\n * const map = new Map();\n * map.set(`Sally`, { name: `Sally`, colour: `red` });\n * map.set(`Bob`, { name: `Bob`, colour: `pink });\n *\n * const objects = Maps.toObject(map);\n * // Yields: {\n * //  Sally: { name: `Sally`, colour: `red` },\n * //  Bob: { name: `Bob`, colour: `pink` }\n * // }\n * ```\n * @param m\n * @returns\n */\nexport const toObject = (m) => [...m].reduce((object, [key, value]) => {\n    object[key] = value;\n    return object;\n}, {});\n/**\n * Converts Map to Array with a provided `transformer` function. Useful for plucking out certain properties\n * from contained values and for creating a new map based on transformed values from an input map.\n *\n * @example Get an array of ages from a map of Person objects\n * ```js\n * const person = { age: 29, name: `John`};\n * map.set(person.name, person);\n *\n * const ages = mapToArray(map, (key, person) => person.age);\n * // [29, ...]\n * ```\n *\n * In the above example, the `transformer` function returns a number, but it could\n * just as well return a transformed version of the input:\n *\n * ```js\n * // Return with random heights and uppercased name\n * mapToArray(map, (key, person) => ({\n *  ...person,\n *  height: Math.random(),\n *  name: person.name.toUpperCase();\n * }))\n * // Yields:\n * // [{height: 0.12, age: 29, name: \"JOHN\"}, ...]\n * ```\n * @param m\n * @param transformer A function that takes a key and item, returning a new item.\n * @returns\n */\nexport const mapToArray = (m, transformer) => [...m.entries()].map((x) => transformer(x[0], x[1]));\n/**\n * Merges maps left to right, using the provided\n * `reconcile` function to choose a winner when keys overlap.\n *\n * There's also @ixfx/arrays/mergeByKey if you don't already have a map.\n *\n * For example, if we have the map A:\n * 1 => `A-1`, 2 => `A-2`, 3 => `A-3`\n *\n * And map B:\n * 1 => `B-1`, 2 => `B-2`, 4 => `B-4`\n *\n * If they are merged with the reconile function:\n * ```js\n * const reconcile = (a, b) => b.replace(`-`, `!`);\n * const output = mergeByKey(reconcile, mapA, mapB);\n * ```\n *\n * The final result will be:\n *\n * 1 => `B!1`, 2 => `B!2`, 3 => `A-3`, 4 => `B-4`\n *\n * In this toy example, it's obvious how the reconciler transforms\n * data where the keys overlap. For the keys that do not overlap -\n * 3 and 4 in this example - they are copied unaltered.\n *\n * A practical use for `mergeByKey` has been in smoothing keypoints\n * from a TensorFlow pose. In this case, we want to smooth new keypoints\n * with older keypoints. But if a keypoint is not present, for it to be\n * passed through.\n *\n * @param reconcile\n * @param maps\n */\nexport const mergeByKey = (reconcile, ...maps) => {\n    const result = new Map();\n    for (const m of maps) {\n        for (const [mk, mv] of m) {\n            let v = result.get(mk);\n            v = v ? reconcile(v, mv) : mv;\n            result.set(mk, v);\n        }\n    }\n    return result;\n};\n/**\n * @inheritDoc getOrGenerate\n * @param map\n * @param fn\n * @returns\n */\nexport const getOrGenerateSync = (map, fn) => (key, args) => {\n    let value = map.get(key);\n    if (value !== undefined)\n        return value;\n    value = fn(key, args);\n    map.set(key, value);\n    return value;\n};\n/**\n * Returns a function that fetches a value from a map, or generates and sets it if not present.\n * Undefined is never returned, because if `fn` yields that, an error is thrown.\n *\n * See {@link getOrGenerateSync} for a synchronous version.\n *\n * ```\n * const m = getOrGenerate(new Map(), (key) => {\n *  return key.toUppercase();\n * });\n *\n * // Not contained in map, so it will run the uppercase function,\n * // setting the value to the key 'hello'.\n * const v = await m(`hello`);  // Yields 'HELLO'\n * const v1 = await m(`hello`); // Value exists, so it is returned ('HELLO')\n * ```\n *\n */\nexport const getOrGenerate = (map, fn) => async (key, args) => {\n    let value = map.get(key);\n    if (value !== undefined)\n        return value; //Promise.resolve(value);\n    value = await fn(key, args);\n    if (value === undefined)\n        throw new Error(`fn returned undefined`);\n    map.set(key, value);\n    return value;\n};\n","import { integerTest, resultThrow } from '@ixfx/guards';\nimport { intervalToMs } from '@ixfx/core';\n/**\n * Returns a {@link Continuously} that continually executes `callback` at `interval` rate.\n *\n * By default, first the sleep period happens and then the callback happens.\n *\n * Call `start` to begin/reset loop. The looping stops when `cancel` is called, or when `callback` returns _false_.\n *\n * @example\n * Animation loop\n * ```js\n * const draw = () => {\n *  // Draw on canvas\n * }\n *\n * // Run draw() synchronised with monitor refresh rate via `window.requestAnimationFrame`\n * continuously(draw).start();\n * ```\n *\n * @example\n * With delay\n * ```js\n * const fn = () => {\n *  // Runs after one minute\n * }\n * const c = continuously(fn, { mins: 1 } );\n * c.start(); // Runs `fn` every minute\n * ```\n *\n * @example\n * Control a 'continuously'\n * ```js\n * c.cancel();   // Stop the loop, cancelling any up-coming calls to `fn`\n * c.elapsedMs;  // How many milliseconds have elapsed since start\n * c.ticks;      // How many iterations of loop since start\n * c.interval;   // Get/set speed of loop. Change kicks-in at next loop.\n *               // Use .start() to reset to new interval immediately\n * ```\n *\n * Asynchronous callback functions are supported too:\n * ```js\n * continuously(async () => { ..});\n * ```\n *\n * The `callback` function can receive a few arguments:\n *\n * ```js\n * continuously( (ticks, elapsedMs) => {\n *  // ticks: how many times loop has run\n *  // elapsedMs:  how long since last loop\n * }).start();\n * ```\n *\n * If the callback explicitly returns _false_, the loop will be cancelled.\n *\n * ```js\n * continuously(ticks => {\n *  // Stop after 100 iterations\n *  if (ticks > 100) return false;\n * }).start();\n * ```\n *\n * You can intercept the logic for calls to `start()` with `onStartCalled`. It can determine\n * whether the `start()` proceeds, if the loop is cancelled, or the whole thing disposed,\n * so it can't run any longer.\n *\n * ```js\n * continuously(callback, intervalMs, {\n *  onStartCalled:(ticks, elapsedMs) => {\n *    // Cancel the loop after 1000ms has elapsed\n *    if (elapsedMs > 1000) return `cancel`;\n *  }\n * }).start();\n * ```\n *\n * To run `callback` *before* the sleep happens, set `fireBeforeWait`:\n * ```js\n * continuously(callback, intervalMs, { fireBeforeWait: true });\n * ```\n * @param callback - Function to run. If it returns _false_, loop exits.\n * @param options - {@link ContinuouslyOpts ContinuouslyOpts}\n * @param interval - Speed of loop (default: 0)\n * @returns Instance to control looping.\n * @see Flow.timeout if you want to trigger something once.\n */\nexport const continuously = (callback, interval = 0, options = {}) => {\n    let intervalMs = intervalToMs(interval, 0);\n    resultThrow(integerTest(intervalMs, `positive`, `interval`));\n    const fireBeforeWait = options.fireBeforeWait ?? false;\n    const onStartCalled = options.onStartCalled;\n    const signal = options.signal;\n    let disposed = false;\n    let runState = `idle`;\n    let startCount = 0;\n    let startCountTotal = 0;\n    let startedAt = performance.now();\n    let intervalUsed = interval ?? 0;\n    let cancelled = false;\n    let currentTimer;\n    const deschedule = () => {\n        if (currentTimer === undefined)\n            return;\n        globalThis.clearTimeout(currentTimer);\n        currentTimer = undefined;\n        startCount = 0;\n        startedAt = Number.NaN;\n    };\n    const schedule = (scheduledCallback) => {\n        if (intervalMs === 0) {\n            if (typeof requestAnimationFrame === `undefined`) {\n                currentTimer = globalThis.setTimeout(scheduledCallback, 0);\n            }\n            else {\n                currentTimer = undefined;\n                requestAnimationFrame(scheduledCallback);\n            }\n        }\n        else {\n            currentTimer = globalThis.setTimeout(scheduledCallback, intervalMs);\n        }\n    };\n    const cancel = () => {\n        if (cancelled)\n            return;\n        cancelled = true;\n        if (runState === `idle`)\n            return; // No need to cancel\n        runState = `idle`;\n        deschedule();\n    };\n    const loop = async () => {\n        if (signal?.aborted) {\n            runState = `idle`;\n        }\n        if (runState === `idle`)\n            return;\n        runState = `running`;\n        startCount++;\n        startCountTotal++;\n        const valueOrPromise = callback(startCount, performance.now() - startedAt);\n        const value = typeof valueOrPromise === `object` ? (await valueOrPromise) : valueOrPromise;\n        if (cancelled) {\n            return;\n        }\n        runState = `scheduled`;\n        // Didn't get a value, exit out\n        if (value !== undefined && !value) {\n            cancel();\n            return;\n        }\n        if (cancelled)\n            return; // has been cancelled\n        // eslint-disable-next-line @typescript-eslint/no-misused-promises\n        schedule(loop);\n    };\n    const start = () => {\n        if (disposed)\n            throw new Error(`Disposed`);\n        cancelled = false;\n        if (onStartCalled !== undefined) {\n            // A function governs whether to allow .start() to go ahead\n            const doWhat = onStartCalled(startCount, performance.now() - startedAt);\n            switch (doWhat) {\n                case `cancel`: {\n                    cancel();\n                    return;\n                }\n                case `reset`: {\n                    reset();\n                    return;\n                }\n                case `dispose`: {\n                    disposed = true;\n                    cancel();\n                    return;\n                }\n                // No default\n            }\n        }\n        if (runState === `idle`) {\n            // Start running\n            startCount = 0;\n            startedAt = performance.now();\n            runState = `scheduled`;\n            if (fireBeforeWait) {\n                void loop(); // Exec first, then wait\n            }\n            else {\n                // eslint-disable-next-line @typescript-eslint/no-misused-promises\n                schedule(loop); // Wait first, then exec\n            }\n        } // else: already running, ignore\n    };\n    const reset = () => {\n        if (disposed)\n            throw new Error(`Disposed`);\n        cancelled = false;\n        startCount = 0;\n        startedAt = Number.NaN;\n        // Cancel scheduled iteration\n        if (runState !== `idle`) {\n            cancel();\n        }\n        start();\n    };\n    return {\n        start,\n        reset,\n        cancel,\n        get interval() {\n            return intervalUsed;\n        },\n        get runState() {\n            return runState;\n        },\n        get startCountTotal() {\n            return startCountTotal;\n        },\n        get startCount() {\n            return startCount;\n        },\n        set interval(interval) {\n            const ms = intervalToMs(interval, 0);\n            resultThrow(integerTest(ms, `positive`, `interval`));\n            intervalMs = ms;\n            intervalUsed = interval;\n        },\n        get isDisposed() {\n            return disposed;\n        },\n        get elapsedMs() {\n            return performance.now() - startedAt;\n        },\n    };\n};\n","//import { intervalToMs, type Interval } from './IntervalType.js';\n//import { elapsedMillisecondsAbsolute, relative } from './Timer.js';\n/**\n * Returns elapsed time since the initial call.\n *\n * ```js\n * // Record start\n * const elapsed = elapsedSince();\n *\n * // Get elapsed time in millis\n * // since Elapsed.since()\n * elapsed(); // Yields number\n * ```\n *\n * If you want to initialise a stopwatch, but not yet start it, consider:\n * ```js\n * // Init\n * let state = {\n *  clicked: Stopwatch.infinity()\n * };\n *\n * state.click(); // Returns a giant value\n *\n * // Later, when click happens:\n * state = { click: elapsedSince() }\n * ```\n *\n * See also:\n * * {@link elapsedOnce} if you want to measure a single period, and stop it.\n * * {@link elapsedInterval} time _between_ calls\n * @returns\n */\nexport const elapsedSince = () => {\n    const start = performance.now();\n    return () => {\n        return performance.now() - start;\n    };\n};\n/**\n * Returns the interval between the start and each subsequent call.\n *\n * ```js\n * const interval = elapsedInterval();\n * interval(); // Time from elapsedInterval()\n * interval(); // Time since last interval() call\n * ```\n *\n * See also:\n * * {@link elapsedSince}: time since first call\n * * {@link elapsedOnce}: time between two events\n * @returns\n */\nexport const elapsedInterval = () => {\n    let start = performance.now();\n    return () => {\n        const now = performance.now();\n        const x = now - start;\n        start = now;\n        return x;\n    };\n};\n/**\n * Returns elapsed time since initial call, however\n * unlike {@link elapsedSince}, timer stops when first invoked.\n *\n * ```js\n * const elapsed = elapsedOnce();\n * // ...do stuff\n * elapsed(); // Yields time since elapsedOnce() was called\n * // ...do more stuff\n * elapsed(); // Is still the same number as above\n * ```\n *\n * See also:\n * * {@link elapsedSince}: elapsed time\n * * {@link elapsedInterval}: time _between_ calls\n * @returns\n */\nexport const elapsedOnce = () => {\n    const start = Date.now();\n    let stoppedAt = 0;\n    return () => {\n        if (stoppedAt === 0) {\n            stoppedAt = Date.now() - start;\n        }\n        return stoppedAt;\n    };\n};\n/**\n * Returns a function that reports an 'infinite' elapsed time.\n * this can be useful as an initialiser for `elapsedSince` et al.\n *\n * ```js\n * // Init clicked to be an infinite time\n * let clicked = elapsedInfinity();\n *\n * document.addEventListener('click', () => {\n *  // Now that click has happened, we can assign it properly\n *  clicked = Stopwatch.since();\n * });\n * ```\n * @returns\n */\nexport const elapsedInfinity = () => {\n    return () => {\n        return Number.POSITIVE_INFINITY;\n    };\n};\n","export const promiseFromEvent = (target, name) => {\n    return new Promise(resolve => {\n        const handler = (...args) => {\n            target.removeEventListener(name, handler);\n            if (Array.isArray(args) && args.length === 1)\n                resolve(args[0]);\n            else\n                resolve(args);\n        };\n        target.addEventListener(name, handler);\n    });\n};\n","import { numberTest, resultThrow } from '@ixfx/guards';\nimport { intervalToMs } from './interval-type.js';\nif (typeof window === `undefined` || !(`requestAnimationFrame` in window)) {\n    if (typeof window === `undefined`) {\n        // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n        // @ts-expect-error\n        globalThis.requestAnimationFrame = (callback) => {\n            setTimeout(callback, 1);\n        };\n    }\n}\n/**\n * Returns after timeout period.\n *\n * @example In an async function\n * ```js\n * console.log(`Hello`);\n * await sleep(1000);\n * console.log(`There`); // Prints one second after\n * ```\n *\n * @example As a promise\n * ```js\n * console.log(`Hello`);\n * sleep({ millis: 1000 })\n *  .then(() => console.log(`There`)); // Prints one second after\n * ```\n *\n * If a timeout of 0 is given, `requestAnimationFrame` is used instead of `setTimeout`.\n *\n * `Flow.delay()` and {@link sleep} are similar. `Flow.delay()` takes a parameter of what code to execute after the timeout, while `sleep()` just resolves after the timeout.\n *\n * A value can be provided, which is returned on awaking:\n * ```js\n * const v = await sleep({ seconds: 1, value: `hello`);\n * // v = `hello`\n * ```\n *\n * Provide an AbortSignal to cancel the sleep and throwing an exception\n * so code after the sleep doesn't happen.\n *\n * ```js\n * const ac = new AbortController();\n * setTimeout(() => { ac.abort(); }, 1000); // Abort after 1s\n *\n * // Sleep for 1min\n * await sleep({ minutes: 1, signal: ac.signal });\n * console.log(`Awake`); // This line doesn't get called because an exception is thrown when aborting\n * ```\n * @param optsOrMillis Milliseconds to sleep, or options\n * @return\n */\nexport const sleep = (optsOrMillis) => {\n    const timeoutMs = intervalToMs(optsOrMillis, 1);\n    const signal = optsOrMillis.signal;\n    const value = optsOrMillis.value;\n    resultThrow(numberTest(timeoutMs, `positive`, `timeoutMs`));\n    if (timeoutMs === 0) {\n        return new Promise((resolve) => requestAnimationFrame((_) => {\n            resolve(value);\n        }));\n    }\n    else {\n        return new Promise((resolve, reject) => {\n            const onAbortSignal = () => {\n                clearTimeout(t);\n                if (signal) {\n                    signal.removeEventListener(`abort`, onAbortSignal);\n                    reject(new Error(signal.reason));\n                }\n                else {\n                    reject(new Error(`Cancelled`));\n                }\n            };\n            if (signal) {\n                signal.addEventListener(`abort`, onAbortSignal);\n            }\n            const t = setTimeout(() => {\n                signal?.removeEventListener(`abort`, onAbortSignal);\n                if (signal?.aborted) {\n                    reject(new Error(signal.reason));\n                    return;\n                }\n                resolve(value);\n            }, timeoutMs);\n        });\n    }\n};\n/**\n * Delays until `predicate` returns true.\n * Can be useful for synchronising with other async activities.\n * ```js\n * // Delay until 'count' reaches 5\n * await sleepWhile(() => count >= 5, 100);\n * ```\n * @param predicate\n * @param checkInterval\n */\nexport const sleepWhile = async (predicate, checkInterval = 100) => {\n    while (predicate()) {\n        await sleep(checkInterval);\n    }\n};\n","/**\n * Outputs the current largest-seen value\n * @returns\n */\nexport const max = () => {\n    let max = Number.MIN_SAFE_INTEGER;\n    const compute = (value) => {\n        const valueArray = Array.isArray(value) ? value : [value];\n        for (const subValue of valueArray) {\n            if (typeof subValue !== `number`)\n                break;\n            max = Math.max(subValue, max);\n        }\n        return max;\n    };\n    return compute;\n};\n/**\n * Outputs the current smallest-seen value\n * @returns\n */\nexport const min = () => {\n    let min = Number.MAX_SAFE_INTEGER;\n    const compute = (value) => {\n        const valueArray = Array.isArray(value) ? value : [value];\n        for (const subValue of valueArray) {\n            if (typeof subValue !== `number`)\n                break;\n            min = Math.min(subValue, min);\n        }\n        return min;\n    };\n    return compute;\n};\n/**\n * Returns a sum of values\n * @returns\n */\nexport const sum = () => {\n    let t = 0;\n    const compute = (value) => {\n        const valueArray = Array.isArray(value) ? value : [value];\n        for (const subValue of valueArray) {\n            if (typeof subValue !== `number`)\n                continue;\n            t += subValue;\n        }\n        return t;\n    };\n    return compute;\n};\n/**\n * Returns the current average of input values\n * @returns\n */\nexport const average = () => {\n    let total = 0;\n    let tally = 0;\n    const compute = (value) => {\n        const valueArray = Array.isArray(value) ? value : [value];\n        for (const subValue of valueArray) {\n            if (typeof subValue !== `number`)\n                continue;\n            tally++;\n            total += subValue;\n        }\n        return total / tally;\n    };\n    return compute;\n};\n/**\n * Returns the tally (ie number of) values\n * @param countArrayItems\n * @returns\n */\nexport const tally = (countArrayItems) => {\n    let t = 0;\n    const compute = (value) => {\n        if (countArrayItems) {\n            if (Array.isArray(value))\n                t += value.length;\n            else\n                t++;\n        }\n        else {\n            t++;\n        }\n        return t;\n    };\n    return compute;\n};\n/**\n * Returns the 'best' value seen so far as determined by a ranking function.\n * This is similar to min/max but usable for objects.\n * @param r\n * @param options\n * @returns\n */\nexport function rank(r, options = {}) {\n    const includeType = options.includeType;\n    const emitEqualRanked = options.emitEqualRanked ?? false;\n    const emitRepeatHighest = options.emitRepeatHighest ?? false;\n    let best;\n    return (value) => {\n        if (includeType && typeof value !== includeType)\n            return;\n        if (best === undefined) {\n            best = value;\n            return best;\n        }\n        else {\n            const result = r(value, best);\n            //console.log(`result: ${ result } value: ${ JSON.stringify(value) } best: ${ JSON.stringify(best) }`);\n            if (result == `a`) {\n                // New value is the current best\n                best = value;\n                return best;\n            }\n            else if (result === `eq` && emitEqualRanked) {\n                // New value is same rank as previous, but we have flag on\n                return best;\n            }\n            else if (emitRepeatHighest) {\n                // Emit current highest due to flag\n                return best;\n            }\n        }\n    };\n}\n","import { arrayTest, throwIfFailed } from \"@ixfx/guards\";\n/**\n * Returns a function that cycles through the contents of an array. By default starts at index 0.\n *\n * ```js\n * const c = arrayCycle([`apples`, `oranges`, `pears`]);\n * c.current; // `apples`\n * c.next();  // `oranges`\n * c.next();  // `pears`\n * c.next();  // `apples`\n * c.prev();  // `pears`\n * ```\n *\n * You can select an item by index or value:\n * ```\n * c.select(1); // `oranges`\n * c.select(`pears`); // `pears`\n * ```\n *\n * Other features:\n * ```js\n * c.current;   // Current value\n * c.toArray(); // Copy of array being cycled over\n * ```\n *\n * Additional info:\n * * Selecting by value uses === semantics.\n * * Works with a copy of input array\n * @param options Array to cycle over\n * @returns\n */\nexport const cycle = (options) => {\n    throwIfFailed(arrayTest(options, `options`));\n    const opts = [...options];\n    let index = 0;\n    const next = () => {\n        index++;\n        if (index === opts.length)\n            index = 0;\n        return value();\n    };\n    // eslint-disable-next-line unicorn/prevent-abbreviations\n    const prev = () => {\n        index--;\n        if (index === -1)\n            index = opts.length - 1;\n        return value();\n    };\n    const value = () => {\n        // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n        return opts.at(index);\n    };\n    const select = (indexOrValue) => {\n        if (typeof indexOrValue === `number`) {\n            index = indexOrValue;\n        }\n        else {\n            const found = opts.indexOf(indexOrValue);\n            if (found === -1)\n                throw new Error(`Could not find value`);\n            index = found;\n        }\n    };\n    const toArray = () => [...opts];\n    return { toArray, next, prev, get current() { return value(); }, select };\n};\n","import { numberTest, resultThrow } from \"@ixfx/guards\";\n/**\n * Similar to Javascript's in-built Array.at function, but allows offsets\n * to wrap.\n *\n * @remarks\n * ```js\n * const test = [1,2,3,4,5,6];\n * atWrap(0);   // 1\n * atWrap(-1);  // 6\n * atWrap(-6);  // 1\n * ```\n *\n * These values would return _undefined_ using Array.at since its beyond\n * the length of the array\n * ```js\n * atWrap(6);   // 1\n * atWrap(-7);  // 6\n * ```\n * @param array Array\n * @param index Index\n * @returns\n */\nexport const atWrap = (array, index) => {\n    resultThrow(numberTest(index, ``, `index`));\n    if (!Array.isArray(array))\n        throw new Error(`Param 'array' is not an array`);\n    index = index % array.length;\n    return array.at(index);\n};\n","/**\n * Return `array` broken up into chunks of `size` values\n *\n * ```js\n * chunks([1,2,3,4,5,6,7,8,9,10], 3);\n * // Yields: [[1, 2, 3], [4, 5, 6], [7, 8, 9], [10]]\n * ```\n * @param array\n * @param size\n * @returns\n */\nimport { arrayTest, integerTest, throwIfFailed } from \"@ixfx/guards\";\nexport function chunks(array, size) {\n    throwIfFailed(integerTest(size, \"aboveZero\", `size`), arrayTest(array, `array`));\n    // https://surma.github.io/underdash/\n    const output = [];\n    for (let index = 0; index < array.length; index += size) {\n        output.push(array.slice(index, index + size));\n    }\n    return output;\n}\n","/**\n * A default converter to string that uses JSON.stringify if its an object, or the thing itself if it's a string\n */\nexport const toStringDefault = (itemToMakeStringFor) => typeof itemToMakeStringFor === `string`\n    ? itemToMakeStringFor\n    : JSON.stringify(itemToMakeStringFor);\n","import { toStringDefault } from \"./to-string.js\";\n/**\n * If input is a string, it is returned.\n * Otherwise, it returns the result of JSON.stringify() with fields ordered.\n *\n * This allows for more consistent comparisons when object field orders are different but values the same.\n * @param itemToMakeStringFor\n * @returns\n */\n// export const toStringOrdered = (itemToMakeStringFor: unknown) => {\n//   if (typeof itemToMakeStringFor === `string`) return itemToMakeStringFor;\n//   const allKeys = new Set<string>();\n//   JSON.stringify(itemToMakeStringFor, (key: string, value: unknown) => (allKeys.add(key), value));\n//   return JSON.stringify(itemToMakeStringFor, [ ...allKeys ].sort());\n// }\n/**\n * Default comparer function is equiv to checking `a === b`.\n * Use {@link isEqualValueDefault} to compare by value, via comparing JSON string representation.\n */\nexport const isEqualDefault = (a, b) => a === b;\n/**\n * Comparer returns true if string representation of `a` and `b` are equal.\n * Use {@link isEqualDefault} to compare using === semantics\n * Uses `toStringDefault` to generate a string representation (via `JSON.stringify`).\n *\n * Returns _false_ if the ordering of fields is different, even though values are identical:\n * ```js\n * isEqualValueDefault({ a: 10, b: 20}, { b: 20, a: 10 }); // false\n * ```\n *\n * Use {@link isEqualValueIgnoreOrder} to ignore order (with an overhead of additional processing).\n * ```js\n * isEqualValueIgnoreOrder({ a: 10, b: 20}, { b: 20, a: 10 }); // true\n * ```\n *\n * Use {@link isEqualValuePartial} to partially match `b` against `a`.\n * @returns True if the contents of `a` and `b` are equal\n */\nexport const isEqualValueDefault = (a, b) => {\n    //  UNIT TESTED\n    if (a === b)\n        return true; // Object references are the same, or string values are the same\n    return toStringDefault(a) === toStringDefault(b); // String representations are the same\n};\n/**\n * Returns _true_ if `a` contains the values of `b`. `a` may contain other values, but we\n * only check against what is in `b`. `a` and `b` must both be simple objects.\n *\n * ```js\n * const obj = {\n *  name: `Elle`,\n *  size: 100,\n *  colour: {\n *    red: 0.5,\n *    green: 0.1,\n *    blue: 0.2\n *  }\n * }\n *\n * isEqualValuePartial(obj, { name: `Elle` }); // true\n * isEqualValuePartial(obj, { name: { colour: red: { 0.5, green: 0.1  }} }); // true\n *\n * isEqualValuePartial(obj, { name: `Ellen` });     // false\n * isEqualValuePartial(obj, { lastname: `Elle` });  // false\n * ```\n * @param a\n * @param b\n * @param fieldComparer\n * @returns\n */\nexport const isEqualValuePartial = (a, b, fieldComparer) => {\n    if (typeof a !== `object`)\n        throw new Error(`Param 'a' expected to be object`);\n    if (typeof b !== `object`)\n        throw new Error(`Param 'b' expected to be object`);\n    if (Object.is(a, b))\n        return true;\n    const comparer = fieldComparer ?? isEqualValuePartial;\n    for (const entryB of Object.entries(b)) {\n        const valueOnAKeyFromB = a[entryB[0]];\n        const valueB = entryB[1];\n        if (typeof valueOnAKeyFromB === `object` && typeof valueB === `object`) {\n            if (!comparer(valueOnAKeyFromB, valueB)) {\n                return false;\n            }\n        }\n        else {\n            if (valueOnAKeyFromB !== valueB) {\n                return false;\n            }\n        }\n    }\n    return true;\n};\n/**\n * Comparer returns true if string representation of `a` and `b` are equal, regardless of field ordering.\n * Uses `toStringOrdered` to generate a string representation (via JSON.stringify`).\n *\n * ```js\n * isEqualValueIgnoreOrder({ a: 10, b: 20}, { b: 20, a: 10 }); // true\n * isEqualValue({ a: 10, b: 20}, { b: 20, a: 10 }); // false, fields are different order\n * ```\n *\n * There is an overhead to ordering fields. Use {@link isEqualValueDefault} if it's not possible that field ordering will change.\n * @returns True if the contents of `a` and `b` are equal\n * @typeParam T - Type of objects being compared\n */\n// export const isEqualValueIgnoreOrder = <T>(a: T, b: T): boolean => {\n//   //  UNIT TESTED\n//   if (a === b) return true; // Object references are the same, or string values are the same\n//   return toStringOrdered(a) === toStringOrdered(b); // String representations are the same\n// };\n/**\n * Returns _true_ if Object.entries() is empty for `value`\n * @param value\n * @returns\n */\nexport const isEmptyEntries = (value) => [...Object.entries(value)].length === 0;\n/**\n * Returns _true_ if `a` and `b` are equal based on their JSON representations.\n * `path` parameter is ignored.\n * @param a\n * @param b\n * @param path\n * @returns\n */\nexport const isEqualContextString = (a, b, _path) => {\n    return JSON.stringify(a) === JSON.stringify(b);\n};\n","import { isEqualDefault } from \"./util/is-equal.js\";\nimport { toStringDefault } from \"./util/to-string.js\";\n/**\n * Returns _true_ if all value in `needles` is contained in `haystack`.\n *\n * ```js\n * const a = ['apples','oranges','pears','mandarins'];\n * const b = ['pears', 'apples'];\n * contains(a, b); // True\n *\n * const c = ['pears', 'bananas'];\n * contains(a, b); // False ('bananas' does not exist in a)\n * ```\n *\n * If `needles` is empty, `contains` will return true.\n * @param haystack Array to search\n * @param needles Things to look for\n * @param eq\n */\nexport const contains = (haystack, needles, eq = (isEqualDefault)) => {\n    if (!Array.isArray(haystack)) {\n        throw new TypeError(`Expects haystack parameter to be an array`);\n    }\n    if (!Array.isArray(needles)) {\n        throw new TypeError(`Expects needles parameter to be an array. Got: ${typeof needles}`);\n    }\n    for (const needle of needles) {\n        let found = false;\n        for (const element of haystack) {\n            // eslint-disable-next-line @typescript-eslint/no-unsafe-argument\n            if (eq(needle, element)) {\n                found = true;\n                break;\n            }\n        }\n        if (!found) {\n            return false;\n        }\n    }\n    return true;\n};\n/**\n * Returns _true_ if array contains duplicate values.\n *\n * ```js\n * containsDuplicateValues(['a','b','a']); // True\n * containsDuplicateValues([\n *  { name: 'Apple' },\n *  { name: 'Apple' }\n * ]); // True\n * ```\n *\n * Uses JSON.toString() by default to compare values.\n *\n * See also:\n * * {@link unique}: Get unique set of values in an array\n * * {@link containsDuplicateInstances}: Compare based on reference, rather than value\n * * {@link containsDuplicateValues}: Returns _true_ if every item in array is the same\n * @param data Array to examine\n * @param keyFunction Function to generate key string for object, uses JSON.stringify by default.\n * @returns\n */\nexport const containsDuplicateValues = (data, keyFunction = (toStringDefault)) => {\n    if (typeof data !== `object`)\n        throw new Error(`Param 'data' is expected to be an Iterable. Got type: ${typeof data}`);\n    const set = new Set();\n    for (const v of data) {\n        const string_ = keyFunction(v);\n        if (set.has(string_))\n            return true;\n        set.add(string_);\n    }\n    return false;\n};\n/**\n * Returns _true_ if array contains duplicate instances based on `===` equality checking\n * Use {@link containsDuplicateValues} if you'd rather compare by value.\n * @param array\n * @returns\n */\nexport const containsDuplicateInstances = (array) => {\n    if (!Array.isArray(array))\n        throw new Error(`Parameter needs to be an array`);\n    for (let index = 0; index < array.length; index++) {\n        for (let x = 0; x < array.length; x++) {\n            if (index === x)\n                continue;\n            if (array[index] === array[x])\n                return true;\n        }\n    }\n    return false;\n};\n","/**\n * Returns a copy of an array with specified length - padded or truncated as needed.\n *\n * If the input array is too short, it will be expanded based on the `expand` strategy:\n *  - 'undefined': fill with _undefined_ (default)\n *  - 'repeat': repeat array elements, starting from position 0\n *  - 'first': repeat with first element from `data`\n *  - 'last': repeat with last element from `data`\n *\n * Truncate:\n * ```js\n * ensureLength([1,2,3], 2); // [1,2]\n * ```\n *\n * Padded:\n * ```js\n * ensureLength([1,2,3], 5, `undefined`); // [1,2,3,undefined,undefined]\n * ensureLength([1,2,3], 5, `repeat`);    // [1,2,3,1,2]\n * ensureLength([1,2,3], 5, `first`);     // [1,2,3,1,1]\n * ensureLength([1,2,3], 5, `last`);      // [1,2,3,3,3]\n * ```\n * @param data Input array to expand\n * @param length Desired length\n * @param expandStrategy Expand strategy\n * @param truncateStrategy Truncation strategy. By default removes from end ('from-end')\n * @typeParam V Type of array\n */\nexport function ensureLength(data, length, expandStrategy = `undefined`, truncateStrategy = `from-end`) {\n    if (data === undefined)\n        throw new Error(`Data undefined`);\n    if (!Array.isArray(data))\n        throw new Error(`data is not an array`);\n    if (data.length === length)\n        return [...data];\n    if (data.length > length) {\n        if (truncateStrategy === `from-end`) {\n            return data.slice(0, length);\n        }\n        else {\n            return data.slice(data.length - length);\n        }\n    }\n    const d = [...data];\n    const add = length - d.length;\n    for (let index = 0; index < add; index++) {\n        switch (expandStrategy) {\n            case `undefined`: {\n                // @ts-expect-error all fine .....\n                d.push(undefined);\n                break;\n            }\n            case `repeat`: {\n                d.push(data[index % data.length]);\n                break;\n            }\n            case `first`: {\n                d.push(data[0]);\n                break;\n            }\n            case `last`: {\n                // @ts-expect-error all fine .....\n                d.push(data.at(-1));\n                break;\n            }\n            // No default\n        }\n    }\n    return d;\n}\n;\n","import { isEqualDefault, isEqualValueDefault } from \"./util/is-equal.js\";\nimport { arrayTest, resultThrow } from \"@ixfx/guards\";\n/**\n * Returns _true_ if the two arrays have the same items at same indexes.\n *\n * Returns _false_ if arrays are of different length.\n * By default uses === semantics for equality checking.\n *\n * ```js\n * isEqual([ 1, 2, 3], [ 1, 2, 3 ]); // true\n * isEqual([ 1, 2, 3], [ 3, 2, 1 ]); // false\n * ```\n *\n * Compare by value\n * ```js\n * isEqual(a, b, isEqualValueDefault);\n * ```\n *\n * Custom compare, eg based on `name` field:\n * ```js\n * isEqual(a, b, (compareA, compareB) => compareA.name === compareB.name);\n * ```\n * @param arrayA\n * @param arrayB\n * @param equality Function to compare values\n */\nexport const isEqual = (arrayA, arrayB, equality = (isEqualDefault)) => {\n    // TODO: 'eq' function could be a key-generating function too\n    resultThrow(arrayTest(arrayA, `arrayA`), arrayTest(arrayB, `arrayB`));\n    if (arrayA.length !== arrayB.length)\n        return false;\n    for (let indexA = 0; indexA < arrayA.length; indexA++) {\n        if (!(equality(arrayA[indexA], arrayB[indexA])))\n            return false;\n    }\n    return true;\n};\n/**\n * Returns _true_ if all values in the array are the same. Uses value-based equality checking by default.\n *\n * @example Using default equality function\n * ```js\n * const a1 = [ 10, 10, 10 ];\n * containsIdenticalValues(a1); // True\n *\n * const a2 = [ { name:`Jane` }, { name:`John` } ];\n * containsIdenticalValues(a2); // True, even though object references are different\n * ```\n *\n * If we want to compare by value for objects that aren't readily\n * converted to JSON, you need to provide a function:\n *\n * ```js\n * containsIdenticalValues(someArray, (a, b) => {\n *  return (a.eventType === b.eventType);\n * });\n * ```\n *\n * Returns _true_ if `array` is empty.\n * @param array Array\n * @param equality Equality checker. Uses string-conversion checking by default\n * @returns\n */\nexport const containsIdenticalValues = (array, equality) => {\n    // TODO: 'equality' function could be a key-generating function too\n    if (!Array.isArray(array))\n        throw new Error(`Param 'array' is not an array.`);\n    if (array.length === 0)\n        return true;\n    const eq = equality ?? isEqualValueDefault;\n    const a = array[0];\n    const r = array.some((v) => !eq(a, v));\n    if (r)\n        return false;\n    return true;\n};\n","import { arrayIndexTest, arrayTest, resultThrow } from \"@ixfx/guards\";\n/**\n * Returns two separate arrays of everything that `filter` returns _true_,\n * and everything it returns _false_ on.\n *\n * Same idea as the in-built Array.filter, but that only returns values for one case.\n *\n * ```js\n * const [ matching, nonMatching ] = filterAB(data, v => v.enabled);\n * // `matching` is a list of items from `data` where .enabled is true\n * // `nonMatching` is a list of items from `data` where .enabled is false\n * ```\n * @param data Array of data to filter\n * @param filter Function which returns _true_ to add items to the A list, or _false_ for items to add to the B list\n * @returns Array of two elements. The first is items that match `filter`, the second is items that do not.\n */\nexport const filterAB = (data, filter) => {\n    const a = [];\n    const b = [];\n    for (const datum of data) {\n        if (filter(datum))\n            a.push(datum);\n        else\n            b.push(datum);\n    }\n    return [a, b];\n};\n/**\n * Yields elements from `array` that match a given `predicate`, and moreover are between\n * the given `startIndex` (inclusive) and `endIndex` (exclusive).\n *\n * While this can be done with in the in-built `array.filter` function, it will\n * needlessly iterate through the whole array. It also avoids another alternative\n * of slicing the array before using `filter`.\n *\n * ```js\n * // Return 'registered' people between and including array indexes 5-10\n * const filtered = [...filterBetween(people, person => person.registered, 5, 10)];\n * ```\n * @param array Array to filter\n * @param predicate Filter function\n * @param startIndex Start index (defaults to 0)\n * @param endIndex End index (by default runs until end)\n */\nexport function* filterBetween(array, predicate, startIndex, endIndex) {\n    resultThrow(arrayTest(array, `array`));\n    if (typeof startIndex === `undefined`)\n        startIndex = 0;\n    if (typeof endIndex === `undefined`)\n        endIndex = array.length; //- 1;\n    resultThrow(arrayIndexTest(array, startIndex, `startIndex`));\n    resultThrow(arrayIndexTest(array, endIndex - 1, `endIndex`));\n    for (let index = startIndex; index < endIndex; index++) {\n        if (predicate(array[index], index, array))\n            yield array[index]; //t.push(array[ index ]);\n    }\n}\n;\n","/**\n * Returns a 'flattened' copy of array, un-nesting arrays one level\n * ```js\n * flatten([1, [2, 3], [[4]] ]);\n * // Yields: [ 1, 2, 3, [4]];\n * ```\n * @param array\n * @returns\n */\nexport const flatten = (array) => [...array].flat();\n","/**\n * Returns the array.map() output, or a value if `array`\n * is not an array or empty.\n *\n * ```js\n * mapWithEmptyFallback([1,2,3], v => v+2, 100); // Yields: [3,4,5]\n * mapWithEmptyFallback([], v=>v+2, 100); // Yields: [100]\n * mapWithEmptyFallback({}, v=>v+2, [100]); // Yields: [100]\n * ```\n *\n * If the fallback value is an array, it is returned as an\n * array if needed. If it's a single value, it is wrapped as an array.\n * @param array Array of values\n * @param fn Function to use for mapping values\n * @param fallback Fallback single value or array of values\n * @returns\n */\nexport const mapWithEmptyFallback = (array, fn, fallback) => {\n    if (typeof array !== `object` || !Array.isArray(array) || array.length === 0) {\n        if (Array.isArray(fallback))\n            return fallback;\n        return [fallback];\n    }\n    return array.map(fn);\n};\n","/**\n * Computes the frequency of values by a grouping function.\n *\n * ```js\n * const data = [1,2,3,4,5,6,7,8,9,10];\n * // Returns 'odd' or 'even' for an input value\n *\n * const groupBy = v => v % 2 === 0 ? `even`:`odd`;\n *\n * const data = frequencyByGroup(groupBy, data);\n * // Yields map with:\n * //  key: 'even', value: 5\n * //  key: 'odd', value: 5\n * @param groupBy\n * @param data\n * @returns\n */\nexport const frequencyByGroup = (groupBy, data) => {\n    if (!Array.isArray(data))\n        throw new TypeError(`Param 'array' is expected to be an array. Got type: '${typeof data}'`);\n    const store = new Map();\n    for (const value of data) {\n        const group = groupBy(value);\n        if (typeof group !== `string` && typeof group !== `number`) {\n            throw new TypeError(`groupBy function is expected to return type string or number. Got type: '${typeof group}' for value: '${value}'`);\n        }\n        let groupValue = store.get(group);\n        groupValue ??= 0;\n        groupValue++;\n        store.set(group, groupValue);\n    }\n    return store;\n};\n","/**\n * Groups data by a function `grouper`, returning data as a map with string\n * keys and array values. Multiple values can be assigned to the same group.\n *\n * `grouper` must yield a string designated group for a given item.\n *\n * @example\n * ```js\n * const data = [\n *  { age: 39, city: `London` },\n *  { age: 14, city: `Copenhagen` },\n *  { age: 23, city: `Stockholm` },\n *  { age: 56, city: `London` }\n * ];\n *\n * // Whatever the function returns will be the designated group\n * // for an item\n * const map = Arrays.groupBy(data, item => item.city);\n * ```\n *\n * This yields a Map with keys London, Stockholm and Copenhagen, and the corresponding values.\n *\n * ```\n * London: [{ age: 39, city: `London` }, { age: 56, city: `London` }]\n * Stockhom: [{ age: 23, city: `Stockholm` }]\n * Copenhagen: [{ age: 14, city: `Copenhagen` }]\n * ```\n * @param array Array to group\n * @param grouper Function that returns a key for a given item\n * @typeParam K Type of key to group by. Typically string.\n * @typeParam V Type of values\n * @returns Map\n */\nexport const groupBy = (array, grouper) => {\n    const map = new Map();\n    for (const a of array) {\n        const key = grouper(a);\n        let existing = map.get(key);\n        if (!existing) {\n            existing = [];\n            map.set(key, existing);\n        }\n        existing.push(a);\n    }\n    return map;\n};\n","import { isEqualDefault } from \"./util/is-equal.js\";\nimport { toStringDefault } from \"./util/to-string.js\";\n//import { additionalValues } from \"../iterables/sync/AdditionalValues.js\";\n/**\n * Combines the values of one or more arrays, removing duplicates.\n * ```js\n * const v = Arrays.uniqueDeep([ [1, 2, 3, 4], [ 3, 4, 5, 6] ]);\n * // [ 1, 2, 3, 4, 5, 6]\n * ```\n *\n * A single array can be provided as well:\n * ```js\n * const v = Arrays.uniqueDeep([ 1, 2, 3, 1, 2, 3 ]);\n * // [ 1, 2, 3 ]\n * ```\n *\n * By default uses Javascript's default equality checking\n *\n * See also:\n * * {@link intersection}: Overlap between two arrays\n * * Iterables.additionalValues: Yield values from an iterable not present in the other\n * * {@link containsDuplicateValues}: Returns true if array contains duplicates\n * @param arrays\n * @param comparer\n * @returns\n */\nexport const uniqueDeep = (arrays, comparer = (isEqualDefault)) => {\n    const t = [];\n    const contains = (v) => {\n        for (const tValue of t) {\n            if (comparer(tValue, v))\n                return true;\n        }\n        return false;\n    };\n    const flattened = arrays.flat(10);\n    for (const v of flattened) {\n        if (!contains(v))\n            t.push(v);\n    }\n    return t;\n};\n/**\n * Combines the values of one or more arrays, removing duplicates.\n * Compares based on a string representation of object. Uses a Set\n * to avoid unnecessary comparisons, perhaps faster than `uniqueDeep`.\n *\n * ```js\n * const v = Arrays.unique([ [1, 2, 3, 4], [ 3, 4, 5, 6] ]);\n * // [ 1, 2, 3, 4, 5, 6]\n * ```\n *\n * A single array can be provided as well:\n * ```js\n * const v = Arrays.unique([ 1, 2, 3, 1, 2, 3 ]);\n * // [ 1, 2, 3 ]\n * ```\n *\n * By default uses JSON.toString() to compare values.\n *\n * See also:\n * * {@link intersection}: Overlap between two arrays\n * * Iterables.additionalValues: Yield values from an iterable not present in the other\n * * {@link containsDuplicateValues}: Returns true if array contains duplicates\n * @param arrays Array (or array of arrays) to examine\n * @param toString Function to convert values to a string for comparison purposes. By default uses JSON formatting.\n * @returns\n */\nexport const unique = (arrays, toString = toStringDefault) => {\n    const matching = new Set();\n    const t = [];\n    const flattened = arrays.flat(10);\n    for (const a of flattened) {\n        const stringRepresentation = toString(a);\n        if (matching.has(stringRepresentation))\n            continue;\n        matching.add(stringRepresentation);\n        t.push(a);\n    }\n    return t;\n};\n","import { arrayIndexTest, arrayTest, integerTest, throwIfFailed } from \"@ixfx/guards\";\n/**\n * Inserts `values` at position `index`, shuffling remaining\n * items further down and returning changed result.\n *\n * Does not modify the input array.\n *\n * ```js\n * const data = [ 1, 2, 3 ]\n *\n * // Inserts 20,30,40 at index 1\n * Arrays.insertAt(data, 1, 20, 30, 40);\n *\n * // Yields: 1, 20, 30, 40, 2, 3\n * ```\n * @param data\n * @param index\n * @param values\n * @returns\n */\nexport const insertAt = (data, index, ...values) => {\n    throwIfFailed(arrayTest(data, `data`), arrayIndexTest(data, index, `index`));\n    // Adding at end\n    if (index === data.length - 1) {\n        return [...data, ...values];\n    }\n    // Adding at beginning\n    if (index === 0) {\n        return [...values, ...data];\n    }\n    return [...data.slice(0, index), ...values, ...data.slice(index)];\n};\n","import { containsIdenticalValues } from \"./equality.js\";\n/**\n * Returns an interleaving of two or more arrays. All arrays must be the same length.\n *\n * ```js\n * const a = [`a`, `b`, `c`];\n * const b = [`1`, `2`, `3`];\n * const c = Arrays.interleave(a, b);\n * // Yields:\n * // [`a`, `1`, `b`, `2`, `c`, `3`]\n * ```\n * @param arrays\n * @returns\n */\nexport const interleave = (...arrays) => {\n    if (arrays.some((a) => !Array.isArray(a))) {\n        throw new Error(`All parameters must be an array`);\n    }\n    const lengths = arrays.map(a => a.length);\n    if (!containsIdenticalValues(lengths)) {\n        throw new Error(`Arrays must be of same length`);\n    }\n    const returnValue = [];\n    const length = lengths[0];\n    for (let index = 0; index < length; index++) {\n        for (const array of arrays) {\n            returnValue.push(array[index]);\n        }\n    }\n    return returnValue;\n};\n","import { isEqualDefault } from \"./util/is-equal.js\";\n/**\n * Returns the _intersection_ of two arrays: the elements that are in common.\n *\n * ```js\n * intersection([1, 2, 3], [2, 4, 6]);\n// returns [2]\n * ```\n * See also:\n * * {@link unique}: Unique set of items amongst one or more arrays\n * @param arrayA\n * @param arrayB\n * @param equality\n * @returns\n */\nexport const intersection = (arrayA, arrayB, equality = isEqualDefault) => arrayA.filter((valueFromA) => arrayB.some((valueFromB) => equality(valueFromA, valueFromB)));\n","/**\n * Merges arrays left to right, using the provided\n * `reconcile` function to choose a winner when keys overlap.\n *\n * There's also Core.Maps.mergeByKey if the input data is in Map form.\n *\n * For example, if we have the array A:\n * [`A-1`, `A-2`, `A-3`]\n *\n * And array B:\n * [`B-1`, `B-2`, `B-4`]\n *\n * And with the key function:\n * ```js\n * // Make a key for value based on last char\n * const keyFn = (v) => v.substr(-1, 1);\n * ```\n *\n * If they are merged with the reconile function:\n * ```js\n * const reconcile = (a, b) => b.replace(`-`, `!`);\n * const output = mergeByKey(keyFn, reconcile, arrayA, arrayB);\n * ```\n *\n * The final result will be:\n *\n * [`B!1`, `B!2`, `A-3`, `B-4`]\n *\n * In this toy example, it's obvious how the reconciler transforms\n * data where the keys overlap. For the keys that do not overlap -\n * 3 and 4 in this example - they are copied unaltered.\n *\n * A practical use for `mergeByKey` has been in smoothing keypoints\n * from a TensorFlow pose. In this case, we want to smooth new keypoints\n * with older keypoints. But if a keypoint is not present, for it to be\n * passed through.\n *\n * @param keyFunction Function to generate a unique key for data\n * @param reconcile Returns value to decide 'winner' when keys conflict.\n * @param arrays Arrays of data to merge\n */\nexport const mergeByKey = (keyFunction, reconcile, ...arrays) => {\n    const result = new Map();\n    for (const m of arrays) {\n        for (const mv of m) {\n            if (mv === undefined)\n                continue;\n            const mk = keyFunction(mv);\n            let v = result.get(mk);\n            v = v ? reconcile(v, mv) : mv;\n            result.set(mk, v);\n        }\n    }\n    return [...result.values()];\n};\n","import { resultThrow, arrayTest } from \"@ixfx/guards\";\n/**\n * Yields pairs made up of overlapping items from the input array.\n *\n * Throws an error if there are less than two entries.\n *\n * ```js\n * pairwise([1, 2, 3, 4, 5]);\n * Yields:\n * [ [1,2], [2,3], [3,4], [4,5] ]\n * ```\n * @param values\n */\nexport function* pairwise(values) {\n    resultThrow(arrayTest(values, `values`));\n    if (values.length < 2)\n        throw new Error(`Array needs to have at least two entries. Length: ${values.length}`);\n    for (let index = 1; index < values.length; index++) {\n        yield [values[index - 1], values[index]];\n    }\n}\n/**\n * Reduces in a pairwise fashion.\n *\n * Eg, if we have input array of [1, 2, 3, 4, 5], the\n * `reducer` fn will run with 1,2 as parameters, then 2,3, then 3,4 etc.\n * ```js\n * const values = [1, 2, 3, 4, 5]\n * reducePairwise(values, (acc, a, b) => {\n *  return acc + (b - a);\n * }, 0);\n * ```\n *\n * If input array has less than two elements, the initial value is returned.\n *\n * ```js\n * const reducer = (acc:string, a:string, b:string) => acc + `[${a}-${b}]`;\n * const result = reducePairwise(`a b c d e f g`.split(` `), reducer, `!`);\n * Yields: `![a-b][b-c][c-d][d-e][e-f][f-g]`\n * ```\n * @param array\n * @param reducer\n * @param initial\n * @returns\n */\nexport const pairwiseReduce = (array, reducer, initial) => {\n    resultThrow(arrayTest(array, `arr`));\n    if (array.length < 2)\n        return initial;\n    for (let index = 0; index < array.length - 1; index++) {\n        initial = reducer(initial, array[index], array[index + 1]);\n    }\n    return initial;\n};\n","import { arrayTest, resultThrow } from \"@ixfx/guards\";\n/**\n * Returns a shuffled copy of the input array.\n * @example\n * ```js\n * const d = [1, 2, 3, 4];\n * const s = shuffle(d);\n * // d: [1, 2, 3, 4], s: [3, 1, 2, 4]\n * ```\n *\n * It can be useful to randomly access each item from an array exactly once:\n * ```js\n * for (const value of shuffle(inputArray)) {\n *  // Do something with the value...\n * }\n * ```\n * @param dataToShuffle Input array\n * @param rand Random generator. `Math.random` by default.\n * @returns Copy with items moved around randomly\n * @typeParam V - Type of array items\n */\nexport const shuffle = (dataToShuffle, rand = Math.random) => {\n    resultThrow(arrayTest(dataToShuffle, `dataToShuffle`));\n    const array = [...dataToShuffle];\n    for (let index = array.length - 1; index > 0; index--) {\n        const index_ = Math.floor(rand() * (index + 1));\n        [array[index], array[index_]] = [array[index_], array[index]];\n    }\n    return array;\n};\n/**\n * Returns a random element of an array\n *\n * ```js\n * const v = [`blue`, `red`, `orange`];\n * randomElement(v); // Yields `blue`, `red` or `orange`\n * ```\n *\n * Note that repeated calls might yield the same value\n * multiple times. If you want to random unique values, consider using {@link shuffle}.\n *\n * See also:\n * * {@link randomIndex} if you want a random index rather than value.\n *\n * @param array\n * @param rand Random generator. `Math.random` by default.\n * @returns\n */\nexport const randomElement = (array, rand = Math.random) => {\n    resultThrow(arrayTest(array, `array`));\n    return array[Math.floor(rand() * array.length)];\n};\n/**\n * Returns a random array index.\n *\n * ```js\n * const v = [`blue`, `red`, `orange`];\n * randomIndex(v); // Yields 0, 1 or 2\n * ```\n *\n * Use {@link randomElement} if you want a value from `array`, not index.\n *\n * @param array Array\n * @param rand Random generator. `Math.random` by default.\n * @returns\n */\nexport const randomIndex = (array, rand = Math.random) => Math.floor(rand() * array.length);\n","import { arrayIndexTest, resultThrow } from \"@ixfx/guards\";\n/**\n * Removes an element at `index` index from `data`, returning the resulting array without modifying the original.\n *\n * ```js\n * const v = [ 100, 20, 50 ];\n * const vv = Arrays.remove(2);\n *\n * Yields:\n *  v: [ 100, 20, 50 ]\n * vv: [ 100, 20 ]\n * ```\n *\n * Consider {@link without} if you want to remove an item by value.\n *\n * Throws an exception if `index` is outside the range of `data` array.\n * @param data Input array\n * @param index Index to remove\n * @typeParam V Type of array\n * @returns\n */\nexport const remove = (data, index) => {\n    if (!Array.isArray(data)) {\n        throw new TypeError(`'data' parameter should be an array`);\n    }\n    resultThrow(arrayIndexTest(data, index, `index`));\n    return [...data.slice(0, index), ...data.slice(index + 1)];\n};\n","import { resultThrow, integerTest } from '@ixfx/guards';\n/**\n * Samples values from an array.\n *\n * If `amount` is less or equal to 1, it's treated as a percentage to sample.\n * Otherwise it's treated as every _n_th value to sample.\n *\n * @example\n * By percentage - get half of the items\n * ```\n * const list = [1,2,3,4,5,6,7,8,9,10];\n * const sub = Arrays.sample(list, 0.5);\n * // Yields: [2, 4, 6, 8, 10]\n * ```\n *\n * @example\n * By steps - every third value\n * ```\n * const list = [1,2,3,4,5,6,7,8,9,10];\n * const sub = Arrays.sample(list, 3);\n * // Yields:\n * // [3, 6, 9]\n * ```\n * @param array Array to sample\n * @param amount Amount, given as a percentage (0..1) or the number of interval (ie 3 for every third item)\n * @returns\n */\nexport const sample = (array, amount) => {\n    if (!Array.isArray(array))\n        throw new TypeError(`Param 'array' is not actually an array. Got type: ${typeof array}`);\n    let subsampleSteps = 1;\n    if (amount <= 1) {\n        // Subsample based on a percentage\n        const numberOfItems = array.length * amount;\n        subsampleSteps = Math.round(array.length / numberOfItems);\n    }\n    else {\n        subsampleSteps = amount;\n    }\n    resultThrow(integerTest(subsampleSteps, `positive`, `amount`));\n    if (subsampleSteps > array.length - 1) {\n        throw new Error(`Subsample steps exceeds array length`);\n    }\n    const r = [];\n    for (let index = subsampleSteps - 1; index < array.length; index += subsampleSteps) {\n        r.push(array[index]);\n    }\n    return r;\n};\n","import { arrayTest, resultThrow } from '@ixfx/guards';\n/**\n * Sorts an array of objects in ascending order\n * by the given property name, assuming it is a number.\n *\n * ```js\n * const data = [\n *  { size: 10, colour: `red` },\n *  { size: 20, colour: `blue` },\n *  { size: 5, colour: `pink` }\n * ];\n * const sorted = Arrays.sortByNumericProperty(data, `size`);\n *\n * Yields items ascending order:\n * [ { size: 5, colour: `pink` }, { size: 10, colour: `red` }, { size: 20, colour: `blue` } ]\n * ```\n * @param data\n * @param propertyName\n */\nexport const sortByNumericProperty = (data, propertyName) => [...data].sort((a, b) => {\n    resultThrow(arrayTest(data, `data`));\n    const av = a[propertyName];\n    const bv = b[propertyName];\n    if (av < bv)\n        return -1;\n    if (av > bv)\n        return 1;\n    return 0;\n});\n/**\n * Sorts an array of objects by some named property.\n *\n * ```js\n * const data = [\n *  { size: 10, colour: `red` },\n *  { size: 20, colour: `blue` },\n *  { size: 5, colour: `pink` }\n * ];\n * sortByProperty(data, `colour`);\n *\n * Yields [\n *  { size: 20, colour: `blue` },\n *  { size: 5, colour: `pink` }\n *  { size: 10, colour: `red` },\n * ]\n * ```\n *\n * You can also provide a custom comparer that is passed property values.\n * This function should return 0 if values are equal, 1 if `a > b` and -1 if `a < b`.\n * @param data\n * @param propertyName\n * @returns\n */\nexport const sortByProperty = (data, propertyName, comparer) => [...data].sort((a, b) => {\n    resultThrow(arrayTest(data, `data`));\n    const av = a[propertyName];\n    const bv = b[propertyName];\n    if (comparer === undefined) {\n        if (av < bv)\n            return -1;\n        if (av > bv)\n            return 1;\n        return 0;\n    }\n    else {\n        return comparer(av, bv);\n    }\n});\n","/**\n * Yields all items in the input array for as long as `predicate` returns true.\n *\n * `predicate` yields arrays of `[stop:boolean, acc:A]`. The first value\n * is _true_ when the iteration should stop, and the `acc` is the accumulated value.\n * This allows `until` to be used to carry over some state from item to item.\n *\n * @example Stop when we hit an item with value of 3\n * ```js\n * const v = [...until([1,2,3,4,5], v => v === 3];\n * // [ 1, 2 ]\n * ```\n *\n * @example Stop when we reach a total, using 0 as initial value\n * ```js\n * // Stop when accumulated value reaches 6\n * const v = Arrays.until[1,2,3,4,5], (v, acc) => [acc >= 7, v+acc], 0);\n * // [1, 2, 3]\n * ```\n * @param data\n * @param predicate\n * @returns\n */\nexport function* until(data, predicate, initial) {\n    let total = initial;\n    for (const datum of data) {\n        const r = predicate(datum, total);\n        if (typeof r === `boolean`) {\n            if (r)\n                break;\n        }\n        else {\n            const [stop, accumulator] = r;\n            if (stop)\n                break;\n            total = accumulator;\n        }\n        yield datum;\n    }\n}\n;\n","import { isEqualDefault } from \"./util/is-equal.js\";\n/**\n * Returns a copy of an input array with _undefined_ values removed.\n * @param data\n * @returns\n */\nexport const withoutUndefined = (data) => {\n    return data.filter(v => v !== undefined);\n};\n/**\n * Returns an array with value(s) omitted.\n *\n * If value is not found, result will be a copy of input.\n * Value checking is completed via the provided `comparer` function.\n * By default checking whether `a === b`. To compare based on value, use the `isEqualValueDefault` comparer.\n *\n * @example\n * ```js\n * const data = [100, 20, 40];\n * const filtered = without(data, 20); // [100, 40]\n * ```\n *\n * @example Using value-based comparison\n * ```js\n * const data = [{ name: `Alice` }, { name:`Sam` }];\n *\n * // This wouldn't work as expected, because the default comparer uses instance,\n * // not value:\n * without(data, { name: `Alice` });\n *\n * // So instead we can use a value comparer:\n * without(data, { name:`Alice` }, isEqualValueDefault);\n * ```\n *\n * @example Use a function\n * ```js\n * const data = [ { name: `Alice` }, { name:`Sam` }];\n * without(data, { name:`ALICE` }, (a, b) => {\n *  return (a.name.toLowerCase() === b.name.toLowerCase());\n * });\n * ```\n *\n * Consider {@link remove} to remove an item by index.\n *\n * @typeParam V - Type of array items\n * @param sourceArray Source array\n * @param toRemove Value(s) to remove\n * @param comparer Comparison function. If not provided `isEqualDefault` is used, which compares using `===`\n * @return Copy of array without value.\n */\nexport const without = (sourceArray, toRemove, comparer = isEqualDefault) => {\n    if (Array.isArray(toRemove)) {\n        const returnArray = [];\n        for (const source of sourceArray) {\n            if (!toRemove.some(v => comparer(source, v))) {\n                returnArray.push(source);\n            }\n        }\n        return returnArray;\n    }\n    else {\n        return sourceArray.filter((v) => !comparer(v, toRemove));\n    }\n};\n","import { containsIdenticalValues } from \"./equality.js\";\n/**\n * Zip combines the elements of two or more arrays based on their index.\n *\n * ```js\n * const a = [1,2,3];\n * const b = [`red`, `blue`, `green`];\n *\n * const c = Arrays.zip(a, b);\n * // Yields:\n * // [\n * //   [1, `red`],\n * //   [2, `blue`],\n * //   [3, `green`]\n * // ]\n * ```\n *\n * Typically the arrays you zip together are all about the same logical item. Eg, in the above example\n * perhaps `a` is size and `b` is colour. So thing #1 (at array index 0) is a red thing of size 1. Before\n * zipping we'd access it by `a[0]` and `b[0]`. After zipping, we'd have c[0], which is array of [1, `red`].\n * @param arrays\n * @returns Zipped together array\n */\nexport const zip = (...arrays) => {\n    if (arrays.some((a) => !Array.isArray(a))) {\n        throw new Error(`All parameters must be an array`);\n    }\n    const lengths = arrays.map((a) => a.length);\n    if (!containsIdenticalValues(lengths)) {\n        throw new Error(`Arrays must be of same length`);\n    }\n    const returnValue = [];\n    const length = lengths[0];\n    for (let index = 0; index < length; index++) {\n        returnValue.push(arrays.map((a) => a[index]));\n    }\n    return returnValue;\n};\n","export * from './cycle.js';\nexport * from './at-wrap.js';\nexport * from './chunks.js';\nexport * from './contains.js';\nexport * from './ensure-length.js';\nexport * from './equality.js';\nexport * from './filter.js';\nexport * from './flatten.js';\nexport * from './for-each.js';\nexport * from './frequency.js';\nexport * from './group-by.js';\nexport * from './unique.js';\nexport * from './insert-at.js';\nexport * from './interleave.js';\nexport * from './intersection.js';\nexport * from './merge-by-key.js';\nexport * from './pairwise.js';\nexport * from './random.js';\nexport * from './remove.js';\nexport * from './sample.js';\nexport * from './sort.js';\nexport * from './unique.js';\nexport * from './until.js';\nexport * from './without.js';\nexport * from './zip.js';\n","/**\n * Apples `fn` to every key of `obj` which is numeric.\n * ```js\n * const o = {\n *  name: 'john',\n *  x: 10,\n *  y: 20\n * };\n * const o2 = applyToValues(o, (v) => v * 2);\n *\n * // Yields: { name: 'john', x: 20, y: 40 }\n * ```\n * @param object\n * @param apply\n * @returns\n */\nexport const applyToValues = (object, apply) => {\n    const o = { ...object };\n    for (const [key, value] of Object.entries(object)) {\n        if (typeof value === `number`) {\n            // Run number through function\n            //eslint-disable-next-line functional/immutable-data\n            o[key] = apply(value);\n        }\n        else {\n            // Copy value\n            //eslint-disable-next-line functional/immutable-data,@typescript-eslint/no-unsafe-assignment\n            o[key] = value;\n        }\n    }\n    return o;\n};\n","/**\n * Applies a function `fn` to the elements of an array, weighting them based on their relative position.\n *\n * ```js\n * // Six items\n * weight([1,1,1,1,1,1], Modulation.gaussian());\n *\n * // Yields:\n * // [0.02, 0.244, 0.85, 0.85, 0.244, 0.02]\n * ```\n *\n * `fn` is expected to map (0..1) => (0..1), such as an easing function. The input to the\n * `fn` is the relative position of an element. Thus the first element will be 0, the middle 0.5 and so on.\n * The output of `fn` is then multiplied by the original value.\n *\n * In the below example (which is also the default if `fn` is not specified), the relative position is\n * how values are weighted:\n *\n * ```js\n * weight([1,1,1,1,1,1], (relativePos) => relativePos);\n * // Yields:\n * // [0, 0.2, 0.4, 0.6, 0.8, 1]\n * ```\n *\n * Throws TypeError if `data` is not an array or for any element not a number.\n * @param data Array of numbers\n * @param fn Returns a weighting based on the given relative position. If unspecified, `(x) => x` is used.\n */\nexport const weight = (data, fn) => {\n    if (!Array.isArray(data))\n        throw new TypeError(`Param 'data' is expected to be an array. Got type: ${typeof data}`);\n    const weightingFunction = fn ?? ((x) => x);\n    return data.map((value, index) => {\n        if (typeof value !== `number`)\n            throw new TypeError(`Param 'data' contains non-number at index: '${index}'. Type: '${typeof value}' value: '${value}'`);\n        const relativePos = index / (data.length - 1);\n        const weightForPosition = weightingFunction(relativePos);\n        if (typeof weightForPosition !== `number`)\n            throw new TypeError(`Weighting function returned type '${typeof weightForPosition}' rather than number for input: '${relativePos}'`);\n        const finalResult = value * weightForPosition;\n        //console.log(`finalResult: ${ finalResult.toFixed(2) } rel: ${ relativePos.toFixed(2) } weightForPosition: ${ weightForPosition.toFixed(2) } input: ${ value } index: ${ index }`);\n        return finalResult;\n    });\n};\n/**\n * Returns an array of all valid numbers from `data`\n *\n * @param data\n * @returns\n */\nexport const validNumbers = (data) => data.filter((d) => typeof d === `number` && !Number.isNaN(d));\n/**\n * Returns the dot product of arbitrary-sized arrays. Assumed they are of the same length.\n * @param values\n * @returns\n */\nexport const dotProduct = (values) => {\n    let r = 0;\n    const length = values[0].length;\n    for (let index = 0; index < length; index++) {\n        let t = 0;\n        for (const [p, value] of values.entries()) {\n            if (p === 0)\n                t = value[index];\n            else {\n                t *= value[index];\n            }\n        }\n        r += t;\n    }\n    return r;\n};\n/**\n * Calculates the average of all numbers in an array.\n * Array items which aren't a valid number are ignored and do not factor into averaging.\n *\n * Use {@link numberArrayCompute} if you want min, max and total as well.\n *\n * @example\n * ```js\n * // Average of a list\n * const avg = Numbers.average([1, 1.4, 0.9, 0.1]);\n *\n * // Average of a variable\n * const data = [100,200];\n * Numbers.average(data);\n * ```\n *\n * @see {@link averageWeighted} To weight items based on position in array\n * @param data Data to average.\n * @returns Average of array\n */\nexport const average = (data) => {\n    //  UNIT TESTED\n    if (data === undefined)\n        throw new Error(`data parameter is undefined`);\n    const valid = validNumbers(data);\n    const total = valid.reduce((accumulator, v) => accumulator + v, 0);\n    return total / valid.length;\n};\n/**\n * Returns the minimum number out of `data`.\n * Undefined and non-numbers are silently ignored.\n *\n * ```js\n * Numbers.min([10, 20, 0]); // Yields 0\n * ```\n * @param data\n * @returns Minimum number\n */\nexport const min = (data) => Math.min(...validNumbers(data));\n/**\n * Returns the index of the largest value.\n * ```js\n * const v = [ 10, 40, 5 ];\n * Numbers.maxIndex(v); // Yields 1\n * ```\n * @param data Array of numbers\n * @returns Index of largest value\n */\nexport const maxIndex = (data) => data.reduce((bestIndex, value, index, array) => value > array[bestIndex] ? index : bestIndex, 0);\n/**\n * Returns the index of the smallest value.\n *\n * ```js\n * const v = [ 10, 40, 5 ];\n * Numbers.minIndex(v); // Yields 2\n * ```\n * @param data Array of numbers\n * @returns Index of smallest value\n */\nexport const minIndex = (...data) => data.reduce((bestIndex, value, index, array) => value < array[bestIndex] ? index : bestIndex, 0);\n/**\n * Returns the maximum number out of `data`.\n * Undefined and non-numbers are silently ignored.\n *\n * ```js\n * Numbers.max(100, 200, 50); // 200\n * ```\n * @param data List of numbers\n * @returns Maximum number\n */\nexport const max = (data) => Math.max(...validNumbers(data));\n/**\n * Returns the total of `data`.\n * Undefined and non-numbers are silently ignored.\n *\n * ```js\n * Numbers.total([1, 2, 3]); // 6\n * ```\n * @param data Array of numbers\n * @returns Total\n */\nexport const total = (data) => data.reduce((previous, current) => {\n    if (typeof current !== `number`)\n        return previous;\n    if (Number.isNaN(current))\n        return previous;\n    if (!Number.isFinite(current))\n        return previous;\n    return previous + current;\n}, 0);\n/**\n * Returns the maximum out of `data` without pre-filtering for speed.\n *\n * For most uses, {@link max} should suffice.\n *\n * ```js\n * Numbers.maxFast([ 10, 0, 4 ]); // 10\n * ```\n * @param data\n * @returns Maximum\n */\nexport const maxFast = (data) => {\n    let m = Number.MIN_SAFE_INTEGER;\n    for (const datum of data) {\n        m = Math.max(m, datum);\n    }\n    return m;\n};\n/**\n * Returns the total of `data` without pre-filtering for speed.\n *\n * For most uses, {@link total} should suffice.\n *\n * ```js\n * Numbers.totalFast([ 10, 0, 4 ]); // 14\n * ```\n * @param data\n * @returns Maximum\n */\nexport const totalFast = (data) => {\n    let m = 0;\n    for (const datum of data) {\n        m += datum;\n    }\n    return m;\n};\n/**\n * Returns the maximum out of `data` without pre-filtering for speed.\n *\n * For most uses, {@link max} should suffice.\n *\n * ```js\n * Numbers.minFast([ 10, 0, 100 ]); // 0\n * ```\n * @param data\n * @returns Maximum\n */\nexport const minFast = (data) => {\n    let m = Number.MIN_SAFE_INTEGER;\n    for (const datum of data) {\n        m = Math.min(m, datum);\n    }\n    return m;\n};\n","import { zip } from '@ixfx/arrays';\nimport { weight } from './numeric-arrays.js';\n/**\n * Computes an average of an array with a set of weights applied.\n *\n * Weights can be provided as an array, expected to be on 0..1 scale, with indexes\n * matched up to input data. Ie. data at index 2 will be weighed by index 2 in the weightings array.\n *\n * ```js\n * // All items weighted evenly\n * averageWeighted([1,2,3], [1,1,1]); // 2\n *\n * // First item has full weight, second half, third quarter\n * averageWeighted([1,2,3], [1, 0.5, 0.25]); // 1.57\n *\n * // With reversed weighting of [0.25,0.5,1] value is 2.42\n * ```\n *\n * A function can alternatively be provided to compute the weighting based on array index, via {@link weight}.\n *\n * ```js\n * averageWeighted[1,2,3], Random.gaussian()); // 2.0\n * ```\n *\n * This is the same as:\n *\n * ```js\n * const data = [1,2,3];\n * const w = weight(data, Random.gaussian());\n * const avg = averageWeighted(data, w); // 2.0\n * ```\n * @param data Data to average\n * @param weightings Array of weightings that match up to data array, or an easing function\n * @see {@link average} Compute averages without weighting.\n */\nexport const averageWeighted = (data, weightings) => {\n    if (typeof weightings === `function`)\n        weightings = weight(data, weightings);\n    const ww = zip(data, weightings);\n    const [totalV, totalW] = ww.reduce((accumulator, v) => [accumulator[0] + v[0] * v[1], accumulator[1] + v[1]], [0, 0]);\n    return totalV / totalW;\n};\n","/**\n * Clamps a value between min and max (both inclusive)\n * Defaults to a 0-1 range, useful for percentages.\n *\n * @example Usage\n * ```js\n * // 0.5 - just fine, within default of 0 to 1\n * clamp(0.5);\n * // 1 - above default max of 1\n * clamp(1.5);\n * // 0 - below range\n * clamp(-50, 0, 100);\n * // 50 - within range\n * clamp(50, 0, 50);\n * ```\n *\n * For clamping integer ranges, consider {@link clampIndex }\n * For clamping `{ x, y }` points, consider {@link https://api.ixfx.fun/_ixfx/geometry/Points/clamp/ @ixfx/geometry/Points.clamp}.\n * For clamping bipolar values: {@link Bipolar.clamp}\n * @param value Value to clamp\n * @param min value (inclusive)\n * @param max value (inclusive)\n * @returns Clamped value\n */\nexport const clamp = (value, min = 0, max = 1) => {\n    //  UNIT TESTED\n    if (Number.isNaN(value))\n        throw new Error(`Param 'value' is NaN`);\n    if (Number.isNaN(min))\n        throw new Error(`Param 'min' is NaN`);\n    if (Number.isNaN(max))\n        throw new Error(`Param 'max' is NaN`);\n    if (value < min)\n        return min;\n    if (value > max)\n        return max;\n    return value;\n};\n/**\n * Returns a function that clamps values.\n *\n * ```js\n * const c = clamper(0,100);\n * c(50);   // 50\n * c(101); // 100\n * c(-5);  // 0\n * ```\n * @param min Minimum value. Default: 0\n * @param max Maximum value. Default: 1\n */\nexport const clamper = (min = 0, max = 1) => {\n    if (Number.isNaN(min))\n        throw new Error(`Param 'min' is NaN`);\n    if (Number.isNaN(max))\n        throw new Error(`Param 'max' is NaN`);\n    return (v) => {\n        if (v > max)\n            return max;\n        if (v < min)\n            return min;\n        return v;\n    };\n};\n/**\n * Clamps integer `v` between 0 (inclusive) and array length or length (exclusive).\n * Returns value then will always be at least zero, and a valid array index.\n *\n * @example Usage\n * ```js\n * // Array of length 4\n * const myArray = [`a`, `b`, `c`, `d`];\n * clampIndex(0, myArray);    // 0\n * clampIndex(5, 3); // 2\n * ```\n *\n * Throws an error if `v` is not an integer.\n *\n * For some data it makes sense that data might 'wrap around' if it exceeds the\n * range. For example rotation angle. Consider using {@link wrap} for this.\n *\n * @param v Value to clamp (must be an interger)\n * @param arrayOrLength Array, or length of bounds (must be an integer)\n * @returns Clamped value, minimum will be 0, maximum will be one less than `length`.\n */\nexport const clampIndex = (v, arrayOrLength) => {\n    //  UNIT TESTED\n    if (!Number.isInteger(v)) {\n        throw new TypeError(`v parameter must be an integer (${v})`);\n    }\n    const length = Array.isArray(arrayOrLength)\n        ? arrayOrLength.length\n        : arrayOrLength;\n    if (!Number.isInteger(length)) {\n        throw new TypeError(`length parameter must be an integer (${length}, ${typeof length})`);\n    }\n    v = Math.round(v);\n    if (v < 0)\n        return 0;\n    if (v >= length)\n        return length - 1;\n    return v;\n};\n/**\n * Returns the largest value, ignoring the sign of numbers\n *\n * ```js\n * maxAbs(1, 5);    // 5\n * maxAbs(-10, 5);  // -10 (since sign is ignored)\n * ```\n * @param values\n * @returns\n */\nexport const maxAbs = (...values) => {\n    let index = -1;\n    let maxA = Number.MIN_SAFE_INTEGER;\n    for (let index_ = 0; index_ < values.length; index_++) {\n        const vA = Math.abs(values[index_]);\n        if (vA > maxA) {\n            maxA = vA;\n            index = index_;\n        }\n    }\n    return values[index];\n};\n","import { integerTest, resultThrow } from \"@ixfx/guards\";\n/**\n * Yields `amount` integers, counting by one from zero. If a negative amount is used,\n * count decreases. If `offset` is provided, this is added to the return result.\n * @example\n * ```js\n * const a = [...count(5)]; // Yields five numbers: [0,1,2,3,4]\n * const b = [...count(-5)]; // Yields five numbers: [0,-1,-2,-3,-4]\n * for (const v of count(5, 5)) {\n *  // Yields: 5, 6, 7, 8, 9\n * }\n * const c = [...count(5,1)]; // Yields [1,2,3,4,5]\n * ```\n *\n * @example Used with forEach\n * ```js\n * // Prints `Hi` 5x\n * forEach(count(5), () => // do something);\n * ```\n *\n * If you want to accumulate return values, consider using Flow.repeat.\n *\n * @example Run some code every 100ms, 10 times:\n * ```js\n * import { interval } from '@ixfx/flow.js'\n * import { count } from '@ixfx/numbers.js'\n * const counter = count(10);\n * for await (const v of interval(counter, { fixedIntervalMs: 100 })) {\n *  // Do something\n * }\n * ```\n * @param amount Number of integers to yield\n * @param offset Added to result\n */\nexport function* count(amount, offset = 0) {\n    resultThrow(integerTest(amount, ``, `amount`), integerTest(offset, ``, `offset`));\n    if (amount === 0)\n        return;\n    let index = 0;\n    do {\n        yield (amount < 0 ? -index + offset : index + offset);\n    } while (index++ < Math.abs(amount) - 1);\n}\n;\n","/**\n * Returns the difference from the `initial` value. Defaults to absolute difference.\n * ```js\n * const rel = differenceFromFixed(100);\n * rel(100); // 0\n * rel(150); // 50\n * rel(50);  // 50\n * ```\n *\n * 'numerical' gives sign:\n * ```js\n * const rel = differenceFromFixed(100, `numerical`);\n * rel(100); // 0\n * rel(150); // 50\n * rel(50); // -50\n * ```\n *\n * 'relative' gives proportion to initial\n * ```js\n * const rel = differenceFromFixed(100, `relative`);\n * rel(100); // 0\n * rel(150); // 0.5\n * rel(10);  // 0.90\n * ```\n *\n * Using 'relativeSigned', we get negative relative result\n * when value is below the initial value.\n *\n * Use {@link differenceFromLast} to compare against the last value,\n * rather than the same fixed value.\n * @param {number} initial Value to compare against\n * @returns Difference from initial value\n */\nexport const differenceFromFixed = (initial, kind = `absolute`) => (value) => differenceFrom(kind, value, initial);\n/**\n * Returns a function which yields difference compared to last value.\n *\n * If no initial value is provided, the first difference will be returned as 0.\n *\n * Difference can be returned in various formats:\n * * 'absolute': numerical difference, without sign\n * * 'numerical': numerical difference, with sign, so you can see if difference is higher or lower\n * * 'relative': difference divided by last value, giving a proportional difference. Unsigned.\n * * 'relativeSigned': as above, but with sign\n *\n * Use {@link differenceFromFixed} to compare against a fixed value instead of the last value.\n *\n * ```js\n * let d = differenceFromLast(`absolute`);\n * d(10); // 0\n * d(11); // 1\n * d(10); // 1\n * ```\n *\n * ```js\n * let d = differenceFromLast(`numerical`);\n * d(10); // 0\n * d(11); // 1\n * d(10); // -1\n * ```\n *\n * ```js\n * let d = differenceFromLast(`relative`);\n * d(10); // 0\n * d(11); // 0.1\n * d(10); // 0.1\n * ```\n * ```js\n * let d = differenceFromLast(`relativeSigned`);\n * d(10); // 0\n * d(11); // 0.1\n * d(10); // -0.1\n * ```\n *\n * An initial value can be provided, eg:\n * ```js\n * let d = differenceFromLast(`absolute`, 10);\n * d(11); // 1\n * ```\n * @param kind Kind of output value\n * @param initialValue Optional initial value\n * @returns\n */\nexport const differenceFromLast = (kind = `absolute`, initialValue = Number.NaN) => {\n    let lastValue = initialValue;\n    return (value) => {\n        const x = differenceFrom(kind, value, lastValue);\n        lastValue = value;\n        return x;\n    };\n};\n//   const compute = (v: number) => {\n//     if (Number.isNaN(lastValue)) {\n//       lastValue = v;\n//       return 0;\n//     }\n//     const d = v - lastValue;\n//     let r = 0;\n//     if (kind === `absolute`) {\n//       r = Math.abs(d);\n//     } else if (kind === `numerical`) {\n//       r = d;\n//     } else if (kind === `relative`) {\n//       r = Math.abs(d / lastValue);\n//     } else if (kind === `relativeSigned`) {\n//       r = d / lastValue;\n//     } else throw new TypeError(`Unknown kind: '${ kind }' Expected: 'absolute', 'relative', 'relativeSigned' or 'numerical'`);\n//     lastValue = v;\n//     return r;\n//   }\n//   return compute;\n// }\nconst differenceFrom = (kind = `absolute`, value, from) => {\n    if (Number.isNaN(from)) {\n        return 0;\n    }\n    const d = value - from;\n    let r = 0;\n    if (kind === `absolute`) {\n        r = Math.abs(d);\n    }\n    else if (kind === `numerical`) {\n        r = d;\n    }\n    else if (kind === `relative`) {\n        r = Math.abs(d / from);\n    }\n    else if (kind === `relativeSigned`) {\n        r = d / from;\n    }\n    else\n        throw new TypeError(`Unknown kind: '${kind}' Expected: 'absolute', 'relative', 'relativeSigned' or 'numerical'`);\n    return r;\n};\n","/**\n * Returns true if `possibleNumber` is a number and not NaN\n * @param possibleNumber\n * @returns\n */\nexport const isValid = (possibleNumber) => {\n    if (typeof possibleNumber !== `number`)\n        return false;\n    if (Number.isNaN(possibleNumber))\n        return false;\n    return true;\n};\n","import { isValid } from './guard.js';\n/**\n * Filters an iterator of values, only yielding\n * those that are valid numbers\n *\n * ```js\n * const data = [true, 10, '5', { x: 5 }];\n * for (const n of Numbers.filterIterable(data)) {\n *  // 10\n * }\n * ```\n * @param it\n */\nexport function* filterIterable(it) {\n    for (const v of it) {\n        if (isValid(v))\n            yield v;\n    }\n}\n/**\n * Returns a function that yields _true_ if a value\n * is at least `threshold`\n * ```js\n * const t = thresholdAtLeast(50);\n * t(50); // true\n * t(0);  // false\n * t(55); // true\n * ```\n * @param threshold\n * @returns\n */\nexport const thresholdAtLeast = (threshold) => {\n    return (v) => {\n        return v >= threshold;\n    };\n};\n/**\n * Returns a function that yields _true_\n * if a number is at least _min_ and no greater than _max_\n *\n * ```js\n * const t = rangeInclusive(50, 100);\n * t(40); // false\n * t(50); // true\n * t(60); // true\n * t(100); // true\n * t(101);  // false\n * ```\n * @param min\n * @param max\n * @returns\n */\nexport const rangeInclusive = (min, max) => {\n    return (v) => {\n        return v >= min && v <= max;\n    };\n};\n","import { numberTest, resultThrow } from \"@ixfx/guards\";\n/**\n * Flips a percentage-scale number: `1 - v`.\n *\n * The utility of this function is that it sanity-checks\n * that `v` is in 0..1 scale.\n *\n * ```js\n * flip(1);   // 0\n * flip(0.5); // 0.5\n * flip(0);   // 1\n * ```\n * @param v\n * @returns\n */\nexport const flip = (v) => {\n    if (typeof v === `function`)\n        v = v();\n    resultThrow(numberTest(v, `percentage`, `v`));\n    return 1 - v;\n};\n","import { numberTest, resultThrow } from \"@ixfx/guards\";\n/**\n * Generates a range of numbers, starting from `start` and counting by `interval`.\n * If `end` is provided, generator stops when reached.\n *\n * Unlike {@link numericRange}, numbers might contain rounding errors\n *\n * ```js\n * for (const c of numericRangeRaw(10, 100)) {\n *  // 100, 110, 120 ...\n * }\n * ```\n * @param interval Interval between numbers\n * @param start Start\n * @param end End (if undefined, range never ends)\n */\nexport const numericRangeRaw = function* (interval, start = 0, end, repeating = false) {\n    if (interval <= 0)\n        throw new Error(`Interval is expected to be above zero`);\n    if (typeof end === `undefined`)\n        end = Number.MAX_SAFE_INTEGER;\n    let v = start;\n    do {\n        while (v < end) {\n            yield v;\n            v += interval;\n        }\n    } while (repeating);\n};\n/**\n * Generates a range of numbers, with a given interval.\n *\n * @example For-loop\n * ```\n * let loopForever = numericRange(0.1); // By default starts at 0 and counts upwards forever\n * for (v of loopForever) {\n *  console.log(v);\n * }\n * ```\n *\n * @example If you want more control over when/where incrementing happens...\n * ```js\n * let percent = numericRange(0.1, 0, 1);\n *\n * let percentResult = percent.next().value;\n * ```\n *\n * Note that computations are internally rounded to avoid floating point math issues. So if the `interval` is very small (eg thousandths), specify a higher rounding\n * number.\n *\n * @param interval Interval between numbers\n * @param start Start. Defaults to 0\n * @param end End (if undefined, range never ends)\n * @param repeating Range loops from start indefinately. Default _false_\n * @param rounding A rounding that matches the interval avoids floating-point math hikinks. Eg if the interval is 0.1, use a rounding of 10\n */\nexport const numericRange = function* (interval, start = 0, end, repeating = false, rounding) {\n    resultThrow(numberTest(interval, `nonZero`));\n    const negativeInterval = interval < 0;\n    if (end === undefined) {\n        /* no op */\n    }\n    else {\n        if (negativeInterval && start < end) {\n            throw new Error(`Interval of ${interval.toString()} will never go from ${start.toString()} to ${end.toString()}`);\n        }\n        if (!negativeInterval && start > end) {\n            throw new Error(`Interval of ${interval.toString()} will never go from ${start.toString()} to ${end.toString()}`);\n        }\n    }\n    rounding = rounding ?? 1000;\n    if (end === undefined)\n        end = Number.MAX_SAFE_INTEGER;\n    else\n        end *= rounding;\n    interval = interval * rounding;\n    do {\n        let v = start * rounding;\n        while ((!negativeInterval && v <= end) || (negativeInterval && v >= end)) {\n            yield v / rounding;\n            v += interval;\n        }\n    } while (repeating);\n};\n/**\n * Yields numeric range between 0.0-1.0.\n *\n * ```\n * // Yields: [0, 0.2, 0.4, 0.6, 0.8, 1]\n * const a = [...numericPercent(0.2)];\n *\n * // Repeating flag set to true:\n * for (const v of numericPercent(0.2, true)) {\n *  // Infinite loop. V loops back to 0 after hitting 1\n * }\n * ```\n *\n * If `repeating` is true, it loops back to 0 after reaching 1\n * @param interval Interval (default: 0.01, ie. 1%)\n * @param repeating Whether generator should loop (default: false)\n * @param start Start (default: 0)\n * @param end End (default: 1)\n * @returns\n */\nexport const numericPercent = function (interval = 0.01, repeating = false, start = 0, end = 1) {\n    resultThrow(numberTest(interval, `percentage`, `interval`), numberTest(start, `percentage`, `start`), numberTest(end, `percentage`, `end`));\n    return numericRange(interval, start, end, repeating);\n};\n","import { integerTest, resultThrow } from \"@ixfx/guards\";\n/**\n * Rounds a number.\n *\n * If one parameter is given, it's the decimal places,\n * and a rounding function is returned:\n * ```js\n * const r = round(2);\n * r(10.12355); // 10.12\n * ```\n *\n * If two parameters are given, the first is decimal places,\n * the second the value to round.\n * ```js\n * round(2, 10.12355); // 10.12\n * ```\n * @param decimalPlaces\n * @returns\n */\nexport function round(a, b, roundUp) {\n    resultThrow(integerTest(a, `positive`, `decimalPlaces`));\n    const up = (typeof b === `boolean`) ? b : (roundUp ?? false);\n    let rounder;\n    if (a === 0) {\n        rounder = Math.round;\n    }\n    else {\n        const p = Math.pow(10, a);\n        if (up) {\n            rounder = (v) => Math.ceil(v * p) / p;\n        }\n        else {\n            rounder = (v) => Math.floor(v * p) / p;\n        }\n    }\n    if (typeof b === `number`)\n        return rounder(b);\n    return rounder;\n}\n","import { numberTest, resultThrow } from \"@ixfx/guards\";\nimport { round } from \"./round.js\";\n/**\n * Checks if a value is within range of a base value\n *\n * ```js\n * // Check if 101 is within 10% of 100\n * isApprox(0.1, 100, 101);\n *\n * // Gets a function to compare some value of 10% range to 100\n * const c = isApprox(0.1,100);\n * c(101);\n *\n * // Gets a function to compare some base value and value to 10% range\n * const c = isApprox(0.1);\n * c(100, 101);\n * ```\n *\n * Throws an error if range or base values are NaN.\n * If value being checked is NaN or infinity, _false_ is returned.\n * @param rangePercent\n * @param baseValue\n * @param v\n * @returns\n */\nexport function isApprox(rangePercent, baseValue, v) {\n    resultThrow(numberTest(rangePercent, `percentage`, `rangePercent`));\n    // Round percentages to avoid floating point nonsense\n    const range = Math.floor(rangePercent * 100);\n    const test = (base, value) => {\n        try {\n            if (typeof value !== `number`)\n                return false;\n            if (Number.isNaN(value))\n                return false;\n            if (!Number.isFinite(value))\n                return false;\n            // Round value\n            const diff = Math.abs(value - base);\n            const relative = base === 0 ? Math.floor(diff * 100) : Math.floor((diff / base) * 100);\n            //console.log(`v: ${ value } base: ${ base } rel: ${ relative } range: ${ range } diff: ${ diff }`);\n            return relative <= range;\n        }\n        catch {\n            return false;\n        }\n    };\n    if (baseValue === undefined)\n        return test;\n    resultThrow(numberTest(baseValue, ``, `baseValue`));\n    if (v === undefined) {\n        return (value) => test(baseValue, value);\n    }\n    else {\n        return test(baseValue, v);\n    }\n}\n// export const isCloseTo = (a: number, b: number, precision = 3):Result<number,string> => {\n//   const aa = a.toPrecision(precision);\n//   const bb = b.toPrecision(precision);\n//   if (aa !== bb) return [ false, `A is not close enough to B. A: ${ a } B: ${ b } Precision: ${ precision }` ];\n//   else return [ true ];\n// }\n/**\n * Yields a function that checks if a value is close to any target value\n * ```js\n * const c = isCloseToAny(1, 10, 20, 30, 40);\n * c(11); // True - within 1 range of 10\n * c(19); // True - within 1 range of 20\n * c(0);  // False\n * ```\n *\n * Returned function accepts multiple values, returning\n * _true_ if any of them are within range\n * ```js\n * c(0, 1, 11); // Would return true based on 11\n * ```\n * @param allowedRangeAbsolute\n * @param targets\n * @returns\n */\nexport const isCloseToAny = (allowedRangeAbsolute, ...targets) => {\n    const targetsMin = targets.map(t => t - allowedRangeAbsolute);\n    const targetsMax = targets.map(t => t + allowedRangeAbsolute);\n    return (...values) => {\n        for (const v of values) {\n            for (let index = 0; index < targets.length; index++) {\n                if (v >= targetsMin[index] && v <= targetsMax[index])\n                    return true;\n            }\n        }\n        return false;\n    };\n};\n","//import { floatSource,type RandomOptions, type RandomSource } from '@ixfx/random';\nimport { numberTest, resultThrow } from '@ixfx/guards';\nimport { interpolate, scaler as numberScaler, scale as numberScale } from '@ixfx/numbers';\n/**\n * Wrapper for bipolar-based values. Immutable.\n * All functions will clamp to keep it in legal range.\n *\n * ```js\n * let v = immutable(); // Starts with 0 by default\n * v = v.add(0.1);      // v.value is 0.1\n * v = v.inverse();     // v.value is -0.1\n * v = v.multiply(0.2); // v.value is -0.02\n *\n * v = immutable(1);\n * v = v.towardZero(0.1); // 0.9\n * v = v.interpolate(0.1, 1);\n * ```\n *\n * Wrapped values can be coerced into number:\n * ```js\n * const v = immutable(1);\n * const x = +v+10;\n * // x = 11\n * ```\n * @param startingValueOrBipolar Initial numeric value or BipolarWrapper instance\n * @returns\n */\nexport const immutable = (startingValueOrBipolar = 0) => {\n    if (typeof startingValueOrBipolar === `undefined`)\n        throw new Error(`Start value is undefined`);\n    const startingValue = (typeof startingValueOrBipolar === `number`) ? startingValueOrBipolar : startingValueOrBipolar.value;\n    if (startingValue > 1)\n        throw new Error(`Start value cannot be larger than 1`);\n    if (startingValue < -1)\n        throw new Error(`Start value cannot be smaller than -1`);\n    if (Number.isNaN(startingValue))\n        throw new Error(`Start value is NaN`);\n    const v = startingValue;\n    return {\n        [Symbol.toPrimitive](hint) {\n            if (hint === `number`)\n                return v;\n            else if (hint === `string`)\n                return v.toString();\n            return true;\n        },\n        value: v,\n        towardZero: (amt) => {\n            return immutable(towardZero(v, amt));\n        },\n        add: (amt) => {\n            return immutable(clamp(v + amt));\n        },\n        multiply: (amt) => {\n            return immutable(clamp(v * amt));\n        },\n        inverse: () => {\n            return immutable(-v);\n        },\n        interpolate: (amt, b) => {\n            return immutable(clamp(interpolate(amt, v, b)));\n        },\n        asScalar: (max = 1, min = 0) => {\n            return toScalar(v, max, min);\n        }\n    };\n};\n/**\n * Converts bipolar value to a scalar. That is, converts from\n * -1..1 range to 0..1.\n *\n * ```js\n * Bipolar.toScalar(-1); // 0.0\n * Bipolar.toScalar( 0); // 0.5\n * Bipolar.toScalar( 1); // 1.0\n * ```\n *\n * Range can be changed:\n * ```js\n * Bipolar.toScalar(0, 100); // Uses 0..100 scale, so output is 50\n * Bipolar.toScalar(0, 100, 50); // Uses 50..1000 scale, so output is 75\n * ```\n *\n * Throws an error if `bipolarValue` is not a number or NaN\n * @param bipolarValue Value to convert to scalar\n * @returns Scalar value on 0..1 range.\n */\nexport const toScalar = (bipolarValue, max = 1, min = 0) => {\n    if (typeof bipolarValue !== `number`)\n        throw new Error(`Expected v to be a number. Got: ${typeof bipolarValue}`);\n    if (Number.isNaN(bipolarValue))\n        throw new Error(`Parameter is NaN`);\n    return numberScale(bipolarValue, -1, 1, min, max);\n};\n/**\n * Makes a scalar into a bipolar value.\n *\n * That is, input range is 0..1, output range is -1...1\n *\n * ```js\n * Bipolar.fromScalar(1);   // 1\n * Bipolar.fromScalar(0);   // -1\n * Bipolar.fromScalar(0.5); // 0\n * ```\n *\n * Throws an error if `scalarValue` is outside 0..1 scale.\n * @param scalarValue Scalar value to convert\n * @returns Bipolar value on -1..1 scale\n */\nexport const fromScalar = (scalarValue) => {\n    resultThrow(numberTest(scalarValue, `percentage`, `v`));\n    return (scalarValue * 2) - 1;\n};\n/**\n * Scale & clamp value to bipolar range (-1..1).\n * ```js\n * // Scale 100 on 0..100 scale\n * Bipolar.scale(100, 0, 100); // 1\n * Bipolar.scale(50, 0, 100);  // 0\n * Bipolar.scale(0, 0, 100);   // -1\n * ```\n *\n * Return value is clamped.\n * @param inputValue Value to scale\n * @param inMin Minimum of scale\n * @param inMax Maximum of scale\n * @returns Bipolar value on -1..1 scale\n */\nexport const scale = (inputValue, inMin, inMax) => {\n    return clamp(numberScaler(inMin, inMax, -1, 1)(inputValue));\n};\n/**\n * Scale a number to bipolar range (-1..1). Not clamped, so we might exceed range.\n *\n * ```js\n * // Scale 100 on 0..100 scale\n * Bipolar.scaleUnclamped(100, 0, 100); // 1\n * Bipolar.scaleUnclamped(50, 0, 100);  // 0\n * Bipolar.scaleUnclamped(0, 0, 100);   // -1\n * ```\n *\n * @param inputValue Value to scale\n * @param inMin Minimum of scale\n * @param inMax Maximum of scale\n * @returns Bipolar value on -1..1 scale\n */\nexport const scaleUnclamped = (inputValue, inMin, inMax) => {\n    return numberScaler(inMin, inMax, -1, 1)(inputValue);\n};\n/**\n * Clamp a bipolar value\n * ```js\n * Bipolar.clamp(-1);   // -1\n * Bipolar.clamp(-1.1); // -1\n * ```\n *\n * Throws an error if `bipolarValue` is not a number or NaN.\n * @param bipolarValue Value to clamp\n * @returns Clamped value on -1..1 scale\n */\nexport const clamp = (bipolarValue) => {\n    if (typeof bipolarValue !== `number`)\n        throw new Error(`Param 'bipolarValue' must be a number. Got: ${typeof bipolarValue}`);\n    if (Number.isNaN(bipolarValue))\n        throw new Error(`Param 'bipolarValue' is NaN`);\n    if (bipolarValue > 1)\n        return 1;\n    if (bipolarValue < -1)\n        return -1;\n    return bipolarValue;\n};\n/**\n * Pushes a bipolar value toward zero by `amount`.\n * Return value is clamped on bipolar range of -1..1\n *\n * ```js\n * Bipolar.towardZero(-1, 0.1); // -0.9\n * Bipolar.towardZero( 1, 0.1); //  0.9\n * Bipolar.towardZero( 0, 0.1); //  0.0\n * Bipolar.towardZero( 1, 1.1); //  0.0\n * ```\n *\n * If `amount` is greater than 1, 0 is returned.\n * Throws an error if `bipolarValue` or `amount` are not numbers.\n * Throws an error if `amount` is below zero.\n * @param bipolarValue Bipolar value to nudge toward zero\n * @param amount Amount to nudge by\n * @returns Bipolar value -1...1\n */\nexport const towardZero = (bipolarValue, amount) => {\n    if (typeof bipolarValue !== `number`)\n        throw new Error(`Parameter 'v' must be a number. Got: ${typeof bipolarValue}`);\n    if (typeof amount !== `number`)\n        throw new Error(`Parameter 'amt' must be a number. Got: ${typeof amount}`);\n    if (amount < 0)\n        throw new Error(`Parameter 'amt' must be positive`);\n    if (bipolarValue < 0) {\n        bipolarValue += amount;\n        if (bipolarValue > 0)\n            bipolarValue = 0;\n    }\n    else if (bipolarValue > 0) {\n        bipolarValue -= amount;\n        if (bipolarValue < 0)\n            bipolarValue = 0;\n    }\n    return bipolarValue;\n};\n","/* eslint-disable unicorn/prevent-abbreviations */\nimport { numberTest, integerTest, resultThrow } from '@ixfx/guards';\n/**\n * Wraps an integer number within a specified range, defaulting to degrees (0-360). Use {@link wrap} for floating-point wrapping.\n *\n * This is useful for calculations involving degree angles and hue, which wrap from 0-360.\n * Eg: to add 200 to 200, we don't want 400, but 40.\n *\n * ```js\n * const v = wrapInteger(200+200, 0, 360); // 40\n * ```\n *\n * Or if we minus 100 from 10, we don't want -90 but 270\n * ```js\n * const v = wrapInteger(10-100, 0, 360); // 270\n * ```\n *\n * `wrapInteger` uses 0-360 as a default range, so both of these\n * examples could just as well be:\n *\n * ```js\n * wrapInteger(200+200);  // 40\n * wrapInteger(10-100);  // 270\n * ```\n *\n * Non-zero starting points can be used. A range of 20-70:\n * ```js\n * const v = wrapInteger(-20, 20, 70); // 50\n * ```\n *\n * Note that the minimum value is inclusive, while the maximum is _exclusive_.\n * So with the default range of 0-360, 360 is never reached:\n *\n * ```js\n * wrapInteger(360); // 0\n * wrapInteger(361); // 1\n * ```\n *\n * If you just want to lock values to a range without wrapping, consider {@link clamp}.\n *\n * @param v Value to wrap\n * @param min Integer minimum of range (default: 0). Inclusive\n * @param max Integer maximum of range (default: 360). Exlusive\n * @returns\n */\nexport const wrapInteger = (v, min = 0, max = 360) => {\n    resultThrow(integerTest(v, undefined, `v`), integerTest(min, undefined, `min`), integerTest(max, undefined, `max`));\n    if (v === min)\n        return min;\n    if (v === max)\n        return min; // Wraps\n    if (v > 0 && v < min)\n        v += min;\n    v -= min;\n    max -= min;\n    v = v % max;\n    if (v < 0)\n        v = max - Math.abs(v) + min;\n    return v + min;\n};\n/**\n * Wraps floating point numbers to be within a range (default: 0..1). Use {@link wrapInteger} if you want to wrap integer values.\n *\n * This logic makes sense for some things like rotation angle.\n *\n * If you just want to lock values to a range without wrapping, consider {@link clamp}.\n *\n * ```js\n * wrap(1.2);   // 0.2\n * wrap(2);     // 1.0\n * wrap(-0.2); // 0.8\n * ```\n *\n * A range can be provided too:\n * ```js\n * wrap(30, 20, 50);  \t // 30\n * wrap(60, 20, 50);    //  30\n * ```\n * @param v\n * @param min\n * @param max\n * @returns\n */\nexport const wrap = (v, min = 0, max = 1) => {\n    resultThrow(numberTest(v, ``, `min`), numberTest(min, ``, `min`), numberTest(max, ``, `max`));\n    if (v === min)\n        return min;\n    if (v === max)\n        return min; // Wraps\n    while (v <= min || v >= max) {\n        if (v === max)\n            break;\n        if (v === min)\n            break;\n        if (v > max) {\n            v = min + (v - max);\n        }\n        else if (v < min) {\n            v = max - (min - v);\n        }\n    }\n    return v;\n};\n/**\n * Performs a calculation within a wrapping number range. This is a lower-level function.\n * See also: {@link wrapInteger} for simple wrapping within a range.\n *\n * `min` and `max` define the start and end of the valid range, inclusive. Eg for hue degrees it'd be 0, 360.\n * `a` and `b` is the range you want to work in.\n *\n * For example, let's say you want to get the middle point between a hue of 30 and a hue of 330 (ie warmer colours):\n * ```js\n * wrapRange(0,360, (distance) => {\n *  // for a:0 and b:330, distance would be 90 from 30 degrees to 330 (via zero)\n *  return distance * 0.5; // eg return middle point\n * }, 30, 330);\n * ```\n *\n * The return value of the callback should be in the range of 0-distance. `wrapRange` will subsequently\n * conform it to the `min` and `max` range before it's returned to the caller.\n *\n * @param a Output start (eg. 60)\n * @param b Output end (eg 300)\n * @param min Range start (eg 0)\n * @param max Range end (eg 360)\n * @param fn Returns a computed value from 0 to `distance`.\n * @returns\n */\nexport const wrapRange = (min, max, fn, a, b) => {\n    let r = 0;\n    const distF = Math.abs(b - a);\n    // When b is wrapped forwards\n    const distFwrap = Math.abs(max - a + b);\n    // When b is wrapped backwards (10, 300)\n    const distBWrap = Math.abs(a + (360 - b));\n    const distMin = Math.min(distF, distFwrap, distBWrap);\n    if (distMin === distBWrap) {\n        // (10, 300) = 70\n        r = a - fn(distMin);\n    }\n    else if (distMin === distFwrap) {\n        // (300, 60) = 120\n        r = a + fn(distMin);\n    }\n    else {\n        // Forwards or backwards without wrapping\n        if (a > b) {\n            // (240,120) -- backwards\n            r = a - fn(distMin);\n        }\n        else {\n            // (120,240) -- forwards\n            r = a + fn(distMin);\n        }\n    }\n    return wrapInteger(r, min, max);\n};\n","export const piPi = Math.PI * 2;\n","import { wrap } from './wrap.js';\nimport { numberTest, resultThrow } from '@ixfx/guards';\nimport { clamp } from './clamp.js';\nimport { piPi } from './pi-pi.js';\n/**\n * Interpolates between `a` and `b` by `amount`. Aka `lerp`.\n *\n * [ixfx Guide on Interpolation](https://ixfx.fun/data/interpolation/overview/)\n *\n * @example Get the halfway point between 30 and 60\n * ```js\n * interpolate(0.5, 30, 60);\n * ```\n *\n * See also {@link interpolatorStepped} and {@link https://api.ixfx.fun/_ixfx/modulation/interpolatorInterval/} for functions\n * which help to manage progression from A->B over steps or interval.\n *\n * Usually interpolation amount is on a 0...1 scale, inclusive. What is the interpolation result\n * if this scale is exceeded? By default it is clamped to 0..1, so the return value is always between `a` and `b` (inclusive).\n *\n * Alternatively, set the `limits` option to process `amount`:\n * * 'wrap': wrap amount, eg 1.5 is the same as 0.5, 2 is the same as 1\n * * 'ignore': allow exceeding values. eg 1.5 will yield b*1.5.\n * * 'clamp': default behaviour of clamping interpolation amount to 0..1\n *\n * Interpolation can be non-linear using 'easing' option or 'transform' funciton.\n * ```js\n * interpolate(0.1, 0, 100, { easing: `quadIn` });\n * ```\n * There are a few variations when calling `interpolate`, depending on what parameters are fixed.\n * * `interpolate(amount)`: returns a function that needs a & b\n * * `interpolate(a, b)`:  returns a function that needs the interpolation amount\n */\nexport function interpolate(pos1, pos2, pos3, pos4) {\n    let amountProcess;\n    let limits = `clamp`;\n    const handleAmount = (amount) => {\n        if (amountProcess)\n            amount = amountProcess(amount);\n        if (limits === undefined || limits === `clamp`) {\n            amount = clamp(amount);\n        }\n        else if (limits === `wrap`) {\n            if (amount > 1)\n                amount = amount % 1;\n            else if (amount < 0) {\n                amount = 1 + (amount % 1);\n            }\n        }\n        return amount;\n    };\n    const doTheEase = (_amt, _a, _b) => {\n        resultThrow(numberTest(_a, ``, `a`), numberTest(_b, ``, `b`), numberTest(_amt, ``, `amount`));\n        _amt = handleAmount(_amt);\n        return (1 - _amt) * _a + _amt * _b;\n    };\n    const readOpts = (o = {}) => {\n        if (o.transform) {\n            if (typeof o.transform !== `function`)\n                throw new Error(`Param 'transform' is expected to be a function. Got: ${typeof o.transform}`);\n            amountProcess = o.transform;\n        }\n        limits = o.limits ?? `clamp`;\n    };\n    const rawEase = (_amt, _a, _b) => (1 - _amt) * _a + _amt * _b;\n    if (typeof pos1 !== `number`)\n        throw new TypeError(`First param is expected to be a number. Got: ${typeof pos1}`);\n    if (typeof pos2 === `number`) {\n        let a;\n        let b;\n        if (pos3 === undefined || typeof pos3 === `object`) {\n            //interpolate(a: number, b: number, options?: Partial<InterpolateOptions>): (amount: number) => number;\n            a = pos1;\n            b = pos2;\n            readOpts(pos3);\n            return (amount) => doTheEase(amount, a, b);\n        }\n        else if (typeof pos3 === `number`) {\n            //interpolate(amount: number, a: number, b: number, options?: Partial<InterpolateOptions>): number;\n            a = pos2;\n            b = pos3;\n            readOpts(pos4);\n            return doTheEase(pos1, a, b);\n        }\n        else {\n            throw new Error(`Values for 'a' and 'b' not defined`);\n        }\n    }\n    else if (pos2 === undefined || typeof pos2 === `object`) {\n        //interpolate(amount: number, options?: Partial<InterpolateOptions>): (a:number,b:number)=>number;\n        const amount = handleAmount(pos1);\n        readOpts(pos2);\n        resultThrow(numberTest(amount, ``, `amount`));\n        return (aValue, bValue) => rawEase(amount, aValue, bValue);\n    }\n}\n;\n/**\n * Returns a function that interpolates from A to B.\n * It steps through the interpolation with each call to the returned function.\n * This means that the `incrementAmount` will hinge on the rate\n * at which the function is called. Alternatively, consider {@link https://api.ixfx.fun/_ixfx/modulation/interpolatorInterval/}\n * which steps on the basis of clock time.\n *\n * ```js\n * // Interpolate from 0..1 by 0.01\n * const v = interpolatorStepped(0.01, 100, 200);\n * v(); // Each call returns a value closer to target\n * // Eg: 100, 110, 120, 130 ...\n * ```\n *\n * Under the hood, it calls `interpolate` with an amount that\n * increases by `incrementAmount` each time.\n *\n * When calling `v()` to step the interpolator, you can also pass\n * in new B and A values. Note that the order is swapped: the B (target) is provided first, and\n * then optionally A.\n *\n * ```js\n * const v = interpolatorStepped(0.1, 100, 200); // Interpolate 100->200\n * v(300, 200); // Retarget to 200->300 and return result\n * v(150); // Retarget 200->150 and return result\n * ```\n *\n * This allows you to maintain the current interpolation progress.\n * @param incrementAmount Amount to increment by\n * @param a Start value. Default: 0\n * @param b End value. Default: 1\n * @param startInterpolationAt Starting interpolation amount. Default: 0\n * @param options Options for interpolation\n * @returns\n */\nexport const interpolatorStepped = (incrementAmount, a = 0, b = 1, startInterpolationAt = 0, options) => {\n    let amount = startInterpolationAt;\n    return (retargetB, retargetA) => {\n        if (retargetB !== undefined)\n            b = retargetB;\n        if (retargetA !== undefined)\n            a = retargetA;\n        if (amount >= 1)\n            return b;\n        const value = interpolate(amount, a, b, options);\n        amount += incrementAmount;\n        return value;\n    };\n};\n/**\n * Interpolate between angles `a` and `b` by `amount`. Angles are in radians.\n *\n * ```js\n * interpolateAngle(0.5, Math.PI, Math.PI/2);\n * ```\n * @param amount\n * @param aRadians Start angle (radian)\n * @param bRadians End angle (radian)\n * @returns\n */\nexport const interpolateAngle = (amount, aRadians, bRadians, options) => {\n    const t = wrap(bRadians - aRadians, 0, piPi);\n    return interpolate(amount, aRadians, aRadians + (t > Math.PI ? t - piPi : t), options);\n};\n","import { numberTest, resultThrow } from \"@ixfx/guards\";\nimport { round } from \"./round.js\";\n/**\n * Generates a `step`-length series of values between `start` and `end` (inclusive).\n * Each value will be equally spaced.\n *\n * ```js\n * for (const v of linearSpace(1, 5, 6)) {\n *  // Yields: [ 1, 1.8, 2.6, 3.4, 4.2, 5 ]\n * }\n * ```\n *\n * Numbers can be produced from large to small as well\n * ```js\n * const values = [...linearSpace(10, 5, 3)];\n * // Yields: [10, 7.5, 5]\n * ```\n * @param start Start number (inclusive)\n * @param end  End number (inclusive)\n * @param steps How many steps to make from start -> end\n * @param precision Number of decimal points to round to\n */\nexport function* linearSpace(start, end, steps, precision) {\n    resultThrow(numberTest(start, ``, `start`), numberTest(end, ``, `end`), numberTest(steps, ``, `steps`));\n    const r = precision ? round(precision) : (v) => v;\n    const step = (end - start) / (steps - 1);\n    resultThrow(numberTest(step, ``, `step`));\n    if (!Number.isFinite(step)) {\n        throw new TypeError(`Calculated step value is infinite`);\n    }\n    for (let index = 0; index < steps; index++) {\n        const v = start + step * index;\n        yield r(v);\n    }\n}\n","export class BasicQueueMutable {\n    #store = [];\n    enqueue(data) {\n        this.#store.push(data);\n    }\n    dequeue() {\n        return this.#store.shift();\n    }\n    get data() {\n        return this.#store;\n    }\n    get size() {\n        return this.#store.length;\n    }\n}\n","import { numberTest, resultThrow } from \"@ixfx/guards\";\nimport { BasicQueueMutable } from \"./util/queue-mutable.js\";\nimport { averageWeighted } from \"./average-weighted.js\";\nimport { average } from \"./numeric-arrays.js\";\nconst PiPi = Math.PI * 2;\n/**\n * A moving average calculator (exponential weighted moving average) which does not keep track of\n * previous samples. Less accurate, but uses less system resources.\n *\n * The `scaling` parameter determines smoothing. A value of `1` means that\n * the latest value is used as the average - that is, no smoothing. Higher numbers\n * introduce progressively more smoothing by weighting the accumulated prior average more heavily.\n *\n * ```\n * const ma = movingAverageLight(); // default scaling of 3\n * ma(50);  // 50\n * ma(100); // 75\n * ma(75);  // 75\n * ma(0);   // 50\n * ```\n *\n * Note that the final average of 50 is pretty far from the last value of 0. To make it more responsive,\n * we could use a lower scaling factor: `movingAverageLight(2)`. This yields a final average of `37.5` instead.\n *\n * @param scaling Scaling factor. 1 is no smoothing. Default: 3\n * @returns Function that adds to average.\n */\nexport const movingAverageLight = (scaling = 3) => {\n    resultThrow(numberTest(scaling, `aboveZero`, `scaling`));\n    let average = 0;\n    let count = 0;\n    return (v) => {\n        const r = numberTest(v, ``, `v`);\n        if (r.success && v !== undefined) {\n            // Valid number\n            count++;\n            average = average + (v - average) / Math.min(count, scaling);\n        }\n        return average;\n    };\n};\n/**\n * Creates a moving average for a set number of `samples`.\n * It returns a function which in turn yields an average value.\n *\n * Moving average are useful for computing the average over a recent set of numbers.\n * A lower number of samples produces a computed value that is lower-latency yet more jittery.\n * A higher number of samples produces a smoother computed value which takes longer to respond to\n * changes in data.\n *\n * Sample size is considered with respect to the level of latency/smoothness trade-off, and also\n * the rate at which new data is added to the moving average.\n *\n *\n * ```js\n * const ma = movingAverage(10);\n * ma(10); // 10\n * ma(5);  // 7.5\n * ```\n *\n * A weighting function can be provided to shape how the average is\n * calculated - eg privileging the most recent data over older data.\n * It uses `Arrays.averageWeighted` under the hood.\n *\n * ```js\n * import { movingAverage } from '@ixfx/numbers.js';\n * import { gaussian } from '@ixfx/modulation.js';\n *\n * // Give more weight to data in middle of sampling window\n * const ma = movingAverage(100, gaussian());\n * ```\n *\n * Because it keeps track of `samples` previous data, there is a memory impact. A lighter version is {@link movingAverageLight} which does not keep a buffer of prior data, but can't be as easily fine-tuned.\n * @param samples Number of samples to compute average from\n * @param weighter Optional weighting function\n * @returns\n */\nexport const movingAverage = (samples = 100, weighter) => {\n    const q = new BasicQueueMutable();\n    return (v) => {\n        const r = numberTest(v);\n        if (r.success && v !== undefined) {\n            q.enqueue(v);\n            while (q.size > samples) {\n                q.dequeue();\n            }\n        }\n        return weighter === undefined ? average(q.data) : averageWeighted(q.data, weighter);\n    };\n};\n// export const movingAverageTimed = (\n//   updateRateMs = 200,\n//   value = 0,\n//   scaling = 3\n// ): MovingAverage => {\n//   throwNumberTest(scaling, `aboveZero`, `scaling`);\n//   throwNumberTest(updateRateMs, `aboveZero`, `decayRateMs`);\n//   const mal = movingAverageLight(scaling);\n//   //eslint-disable-next-line functional/no-let\n//   let timer = 0;\n//   const reschedule = () => {\n//     if (timer !== 0) clearTimeout(timer);\n//     // eslint-disable-next-line @typescript-eslint/prefer-ts-expect-error\n//     // @ts-ignore\n//     timer = setTimeout(decay, updateRateMs) as number;\n//   };\n//   const decay = () => {\n//     mal.add(value);\n//     if (!mal.isDisposed) setTimeout(decay, updateRateMs);\n//   };\n//   const ma: MovingAverage = {\n//     add(v: number) {\n//       reschedule();\n//       return mal.add(v);\n//     },\n//     dispose() {\n//       mal.dispose();\n//     },\n//     clear: function (): void {\n//       mal.clear();\n//     },\n//     compute: function (): number {\n//       return mal.compute();\n//     },\n//     isDisposed: false,\n//   };\n//   return ma;\n// };\nconst smoothingFactor = (timeDelta, cutoff) => {\n    const r = PiPi * cutoff * timeDelta;\n    return r / (r + 1);\n};\nconst exponentialSmoothing = (smoothingFactor, value, previous) => {\n    return smoothingFactor * value + (1 - smoothingFactor) * previous;\n};\n/**\n * Noise filtering\n *\n * Algorithm: https://gery.casiez.net/1euro/\n *\n * Based on [Jaan Tollander de Balsch's implementation](https://jaantollander.com/post/noise-filtering-using-one-euro-filter/)\n * @param cutoffMin Default: 1\n * @param speedCoefficient Default: 0\n * @param cutoffDefault Default: 1\n */\nexport const noiseFilter = (cutoffMin = 1, speedCoefficient = 0, cutoffDefault = 1) => {\n    let previousValue = 0;\n    let derivativeLast = 0;\n    let timestampLast = 0;\n    const compute = (value, timestamp) => {\n        timestamp ??= performance.now();\n        const timeDelta = timestamp - timestampLast;\n        // Filtered derivative\n        const s = smoothingFactor(timeDelta, cutoffDefault);\n        const valueDelta = (value - previousValue) / timeDelta;\n        const derivative = exponentialSmoothing(s, valueDelta, derivativeLast);\n        // Filtered signal\n        const cutoff = cutoffMin + speedCoefficient * Math.abs(derivative);\n        const a = smoothingFactor(timeDelta, cutoff);\n        const smoothed = exponentialSmoothing(a, value, previousValue);\n        previousValue = smoothed;\n        derivativeLast = derivative;\n        timestampLast = timestamp;\n        return smoothed;\n    };\n    return compute;\n};\n","import { clamp, clamper } from './clamp.js';\nimport { numberTest, resultThrow } from '@ixfx/guards';\n/**\n * Scales `v` from an input range to an output range (aka `map`)\n *\n * For example, if a sensor's useful range is 100-500, scale it to a percentage:\n *\n * ```js\n *\n * scale(sensorReading, 100, 500, 0, 1);\n * ```\n *\n * `scale` defaults to a percentage-range output, so you can get away with:\n * ```js\n * scale(sensorReading, 100, 500);\n * ```\n *\n * If `v` is outside of the input range, it will likewise be outside of the output range.\n * Use {@link scaleClamped} to clip value to range.\n *\n * If inMin and inMax are equal, outMax will be returned.\n *\n * An easing function can be provided for non-linear scaling. In this case\n * the input value is 'pre scaled' using the function before it is applied to the\n * output range.\n *\n * ```js\n * scale(sensorReading, 100, 500, 0, 1, Easings.gaussian());\n * ```\n * @param v Value to scale\n * @param inMin Input minimum\n * @param inMax Input maximum\n * @param outMin Output minimum. If not specified, 0\n * @param outMax Output maximum. If not specified, 1\n * @param easing Easing function\n * @returns Scaled value\n */\nexport const scale = (v, inMin, inMax, outMin, outMax, easing) => scaler(inMin, inMax, outMin, outMax, easing)(v);\n/**\n * Returns a scaling function\n * @param inMin Input minimum\n * @param inMax Input maximum\n * @param outMin Output minimum. If not specified, 0\n * @param outMax Output maximum. If not specified, 1\n * @param easing Easing function\n * @param clamped If true, value is clamped. Default: false\n * @returns\n */\nexport const scaler = (inMin, inMax, outMin, outMax, easing, clamped) => {\n    resultThrow(numberTest(inMin, `finite`, `inMin`), numberTest(inMax, `finite`, `inMax`));\n    const oMax = outMax ?? 1;\n    const oMin = outMin ?? 0;\n    const clampFunction = clamped ? clamper(outMin, outMax) : undefined;\n    return (v) => {\n        if (inMin === inMax)\n            return oMax;\n        let a = (v - inMin) / (inMax - inMin);\n        if (easing !== undefined)\n            a = easing(a);\n        const x = a * (oMax - oMin) + oMin;\n        if (clampFunction)\n            return clampFunction(x);\n        return x;\n    };\n};\n/**\n * Returns a 'null' scaler that does nothing - the input value is returned as output.\n * @returns\n */\nexport const scalerNull = () => (v) => v;\n/**\n * As {@link scale}, but result is clamped to be\n * within `outMin` and `outMax`.\n *\n * @param v\n * @param inMin\n * @param inMax\n * @param outMin 1 by default\n * @param outMax 0 by default d\n * @param easing\n * @returns\n */\nexport const scaleClamped = (v, inMin, inMax, outMin, outMax, easing) => {\n    if (typeof outMax === `undefined`)\n        outMax = 1;\n    if (typeof outMin === `undefined`)\n        outMin = 0;\n    if (inMin === inMax)\n        return outMax;\n    const x = scale(v, inMin, inMax, outMin, outMax, easing);\n    return clamp(x, outMin, outMax);\n};\n/**\n * Scales an input percentage to a new percentage range.\n *\n * If you have an input percentage (0-1), `scalePercentageOutput` maps it to an\n * _output_ percentage of `outMin`-`outMax`.\n *\n * ```js\n * // Scales 50% to a range of 0-10%\n * scalePercentages(0.5, 0, 0.10); // 0.05 - 5%\n * ```\n *\n * An error is thrown if any parameter is outside of percentage range. This added\n * safety is useful for catching bugs. Otherwise, you could just as well call\n * `scale(percentage, 0, 1, outMin, outMax)`.\n *\n * If you want to scale some input range to percentage output range, just use `scale`:\n * ```js\n * // Yields 0.5\n * scale(2.5, 0, 5);\n * ```\n * @param percentage Input value, within percentage range\n * @param outMin Output minimum, between 0-1\n * @param outMax Output maximum, between 0-1\n * @returns Scaled value between outMin-outMax.\n */\nexport const scalePercentages = (percentage, outMin, outMax = 1) => {\n    resultThrow(numberTest(percentage, `percentage`, `v`), numberTest(outMin, `percentage`, `outMin`), numberTest(outMax, `percentage`, `outMax`));\n    return scale(percentage, 0, 1, outMin, outMax);\n};\n/**\n * Scales an input percentage value to an output range\n * If you have an input percentage (0-1), `scalePercent` maps it to an output range of `outMin`-`outMax`.\n * ```js\n * scalePercent(0.5, 10, 20); // 15\n * ```\n *\n * @see {@link scalerPercent} Returns a function\n * @param v Value to scale\n * @param outMin Minimum for output\n * @param outMax Maximum for output\n * @returns\n */\nexport const scalePercent = (v, outMin, outMax) => scalerPercent(outMin, outMax)(v);\n/**\n * Returns a function that scales an input percentage value to an output range\n * @see {@link scalePercent} Calculates value\n * @param outMin\n * @param outMax\n * @returns Function that takes a single argument\n */\nexport const scalerPercent = (outMin, outMax) => {\n    return (v) => {\n        resultThrow(numberTest(v, `percentage`, `v`));\n        return scale(v, 0, 1, outMin, outMax);\n    };\n};\n/**\n * Returns a two-way scaler\n * ```js\n * // Input range 0..100, output range 0..1\n * const s = scalerTwoWay(0,100,0,1);\n *\n * // Scale from input to output\n * s.out(50); // 0.5\n *\n * // Scale from output range to input\n * s.in(1); // 100\n * ```\n * @param inMin\n * @param inMax\n * @param outMin\n * @param outMax\n * @returns\n */\nexport const scalerTwoWay = (inMin, inMax, outMin = 0, outMax = 1, clamped = false, easing) => {\n    const toOut = scaler(inMin, inMax, outMin, outMax, easing, clamped);\n    const toIn = scaler(outMin, outMax, inMin, inMax, easing, clamped);\n    return { out: toOut, in: toIn };\n};\n","/**\n * Calculate the min, max, total, average and count of input array `data`.\n * ```js\n * const { total, min, max, avg, count } = numberArrayCompute([ 1, 2, 3 ]);\n * ```\n * @param data\n * @param opts\n * @returns\n */\nexport const numberArrayCompute = (data, opts = {}) => {\n    if (data.length === 0) {\n        return {\n            total: Number.NaN,\n            min: Number.NaN,\n            max: Number.NaN,\n            avg: Number.NaN,\n            count: Number.NaN\n        };\n    }\n    const nonNumbers = opts.nonNumbers ?? `throw`;\n    let total = 0;\n    let min = Number.MAX_SAFE_INTEGER;\n    let max = Number.MIN_SAFE_INTEGER;\n    let count = 0;\n    for (let index = 0; index < data.length; index++) {\n        let value = data[index];\n        if (typeof value !== `number`) {\n            if (nonNumbers === `ignore`)\n                continue;\n            if (nonNumbers === `throw`)\n                throw new Error(`Param 'data' contains a non-number at index: ${index.toString()}`);\n            if (nonNumbers === `nan`)\n                value = Number.NaN;\n        }\n        if (Number.isNaN(value))\n            continue;\n        if (value !== undefined) {\n            min = Math.min(min, value);\n            max = Math.max(max, value);\n            total += value;\n            count++;\n        }\n    }\n    return {\n        total, max, min, count,\n        avg: total / count\n    };\n};\n","import { scale } from './scale.js';\nimport { numberTest, resultThrow } from \"@ixfx/guards\";\nimport { clamp } from './clamp.js';\nimport { numberArrayCompute } from './number-array-compute.js';\n/**\n * A more advanced form of {@link stream}.\n *\n * With this version\n * @example\n * ```js\n * const s = Normalise.streamWithContext();\n * s.seen(2);    // 1 (because 2 is highest seen)\n * s.seen(1);    // 0 (because 1 is the lowest so far)\n * s.seen(1.5);  // 0.5 (50% of range 1-2)\n * s.seen(0.5);  // 0 (because it's the new lowest)\n * ```\n *\n * And the more advanced features\n * ```js\n * s.min / s.max / s.range\n * s.reset();\n * s.reset(10, 100);\n * ```\n * @returns\n */\nexport const streamWithContext = (minDefault, maxDefault) => {\n    let min = minDefault ?? Number.MAX_SAFE_INTEGER;\n    let max = maxDefault ?? Number.MIN_SAFE_INTEGER;\n    resultThrow(numberTest(min), numberTest(max));\n    return {\n        seen: (v) => {\n            resultThrow(numberTest(v));\n            min = Math.min(min, v);\n            max = Math.max(max, v);\n            return scale(v, min, max);\n        },\n        reset: (minDefault, maxDefault) => {\n            min = minDefault ?? Number.MAX_SAFE_INTEGER;\n            max = maxDefault ?? Number.MIN_SAFE_INTEGER;\n        },\n        get min() {\n            return min;\n        },\n        get max() {\n            return max;\n        },\n        get range() {\n            return Math.abs(max - min);\n        }\n    };\n};\n/**\n * Normalises numbers, adjusting min/max as new values are processed. Return values will be in the range of 0-1 (inclusive).\n *\n * [ixfx Guide on Normalising](https://ixfx.fun/cleaning/normal/)\n *\n * Use {@link streamWithContext} if you want to be able to check the min/max or reset the normaliser.\n *\n * @example\n * ```js\n * const s = Normalise.stream();\n * s(2);    // 1 (because 2 is highest seen)\n * s(1);    // 0 (because 1 is the lowest so far)\n * s(1.5);  // 0.5 (50% of range 1-2)\n * s(0.5);  // 0 (because it's the new lowest)\n * ```\n *\n * Since normalisation is being adjusted as new min/max are encountered, it might\n * be that value normalised to 1 at one time is different to what normalises to 1\n * at a later time.\n *\n * If you already know what to expect of the number range, passing in `minDefault`\n * and `maxDefault` primes the normalisation.\n * ```js\n * const s = Normalise.stream();\n * s(5); // 1, because it's the highest seen\n *\n * // With priming:\n * const s = Normalise.stream(0, 10);\n * s(5); // 0.5, because we're expecting range 0-10\n * ```\n *\n * If a value exceeds the default range, normalisation adjusts.\n * Errors are thrown if min/max defaults are NaN or if one attempts to\n * normalise NaN.\n * @returns\n */\nexport const stream = (minDefault, maxDefault) => {\n    const c = streamWithContext(minDefault, maxDefault);\n    return c.seen;\n};\n/**\n * Normalises an array.\n *\n * This version returns additional context of the normalisation, alternatively use {@link array}\n *\n * ```js\n * const c = arrayWithContext(someValues);\n * c.values;    // Array of normalised values\n * c.original;  // Original input array\n * c.min / c.max / c.range\n * ```\n * @param values Values\n * @param minForced If provided, this will be min value used\n * @param maxForced If provided, this will be the max value used\n */\nexport const arrayWithContext = (values, minForced, maxForced) => {\n    if (!Array.isArray(values)) {\n        throw new TypeError(`Param 'values' should be an array. Got: ${typeof values}`);\n    }\n    const mma = numberArrayCompute(values);\n    const min = minForced ?? mma.min;\n    const max = maxForced ?? mma.max;\n    return {\n        values: values.map((v) => clamp(scale(v, min, max))),\n        original: values,\n        min, max,\n        range: Math.abs(max - min)\n    };\n};\n/**\n * Normalises an array. By default uses the actual min/max of the array\n * as the normalisation range.\n *\n * [ixfx Guide on Normalising](https://ixfx.fun/cleaning/normal/)\n *\n * Use {@link arrayWithContext} to get back the min/max/range and original values\n *\n * ```js\n * // Yields: [0.5, 0.1, 0.0, 0.9, 1]\n * Normalise.array([5,1,0,9,10]);\n * ```\n *\n * `minForced` and/or `maxForced` can\n * be provided to use an arbitrary range.\n * ```js\n * // Forced range 0-100\n * // Yields: [0.05, 0.01, 0.0, 0.09, 0.10]\n * Normalise.array([5,1,0,9,10], 0, 100);\n * ```\n *\n * Return values are clamped to always be 0-1, inclusive.\n *\n * @param values Values\n * @param minForced If provided, this will be min value used\n * @param maxForced If provided, this will be the max value used\n */\nexport const array = (values, minForced, maxForced) => {\n    const c = arrayWithContext(values, minForced, maxForced);\n    return c.values;\n};\n","import { numberTest, resultThrow } from \"@ixfx/guards\";\n/**\n * Scales a percentage-scale number, ie: `v * t`.\n *\n * The utility of this function is that it sanity-checks that\n * both parameters are in the 0..1 scale.\n *\n * Parameters can also be a function that takes no parameters\n * and returns a number. It will be invoked when `proportion` is called.\n * @param v Value\n * @param t Scale amount\n * @returns Scaled value\n */\nexport const proportion = (v, t) => {\n    if (typeof v === `function`)\n        v = v();\n    if (typeof t === `function`)\n        t = t();\n    resultThrow(numberTest(v, `percentage`, `v`), numberTest(t, `percentage`, `t`));\n    return v * t;\n};\n","import { integerTest, numberTest, resultThrow } from \"@ixfx/guards\";\n/**\n * Rounds `v` by `every`. Middle values are rounded up by default.\n *\n * ```js\n * quantiseEvery(11, 10);  // 10\n * quantiseEvery(25, 10);  // 30\n * quantiseEvery(0, 10);   // 0\n * quantiseEvery(4, 10);   // 0\n * quantiseEvery(100, 10); // 100\n * ```\n *\n * Also works with decimals\n * ```js\n * quantiseEvery(1.123, 0.1); // 1.1\n * quantiseEvery(1.21, 0.1);  // 1.2\n * ```\n *\n * @param v Value to quantise\n * @param every Number to quantise to\n * @param middleRoundsUp If _true_ (default), the exact middle rounds up to next step.\n * @returns\n */\nexport const quantiseEvery = (v, every, middleRoundsUp = true) => {\n    const everyString = every.toString();\n    const decimal = everyString.indexOf(`.`);\n    let multiplier = 1;\n    if (decimal >= 0) {\n        const d = everyString.substring(decimal + 1).length;\n        multiplier = 10 * d;\n        every = Math.floor(multiplier * every);\n        v = v * multiplier;\n    }\n    resultThrow(numberTest(v, ``, `v`), integerTest(every, ``, `every`));\n    let div = v / every;\n    const divModule = div % 1;\n    div = Math.floor(div);\n    if ((divModule === 0.5 && middleRoundsUp) || divModule > 0.5)\n        div++;\n    const vv = (every * div) / multiplier;\n    return vv;\n};\n","import { scaler } from \"./scale.js\";\n/**\n * Computes min/max based on a new value and previous range.\n * Returns existing object reference if value is within existing range.\n *\n * If `value` is not a number, by default it will be ignored. Use the 'nonNumberHandling' param to set it\n * to throw an error instead if you want to catch that\n * @param value Value to compare against range\n * @param previous Previous range\n * @param nonNumberHandling 'skip' (default), non numbers are ignored; 'error' an error is thrown\n * @returns\n */\nexport function rangeMergeValue(value, previous, nonNumberHandling = `skip`) {\n    if (typeof value === `number`) {\n        if (Number.isNaN(value) || !Number.isFinite(value)) {\n            if (nonNumberHandling === `error`)\n                throw new TypeError(`Param 'value' is NaN or infinite, and nonNumberHandling is set to 'error'`);\n            return previous;\n        }\n        // Skip creating an object if it's in range\n        if (value >= previous.min && value <= previous.max)\n            return previous;\n        // Return new range\n        return {\n            min: Math.min(value, previous.min),\n            max: Math.max(value, previous.max),\n        };\n    }\n    else if (nonNumberHandling === `error`) {\n        throw new TypeError(`Param 'value' is not a number (type: '${typeof value}') and nonNumberHandling is set to 'error'`);\n    }\n    return previous;\n}\n/**\n * Returns a function that scales values in a range, by default on 0..1 scale.\n * ```js\n * const range = { min: 10, max: 20 }\n * const s = rangeScaler(range);\n * s(15); // 0.5\n * ```\n * @param range Range to scale on\n * @param outMax Output range max. Default: 1\n * @param outMin Output range min. Default: 0\n * @param easing Easing function: Default: none\n * @param clamped Whether input values should be clamped if they exceed range. Default: true\n * @returns\n */\nexport function rangeScaler(range, outMax = 1, outMin = 0, easing, clamped = true) {\n    return scaler(range.min, range.max, outMin, outMax, easing, clamped);\n}\n/**\n * Expands a range to encompass a new range.\n * Returns `existingRange` if `newRange` is within it.\n * @param newRange\n * @param existingRange\n * @returns\n */\nexport function rangeMergeRange(newRange, existingRange) {\n    if (newRange.max <= existingRange.max && newRange.min >= existingRange.min)\n        return existingRange;\n    return {\n        min: Math.min(newRange.min, existingRange.min),\n        max: Math.max(newRange.max, existingRange.max)\n    };\n}\n/**\n * Returns an empty range:\n * ```js\n * {\n *  min: Number.MAX_SAFE_INTEGER,\n *  max: Number.MIN_SAFE_INTEGER\n * }\n * ```\n * @returns\n */\nexport const rangeInit = () => ({ min: Number.MAX_SAFE_INTEGER, max: Number.MIN_SAFE_INTEGER });\n/**\n * Returns _true_ if ranges `a` and `b` have identical min/max values.\n * Returns _false_ if not, or if either/both values are _undefined_\n * @param a\n * @param b\n * @returns\n */\nexport const rangeIsEqual = (a, b) => {\n    if (typeof a === `undefined`)\n        return false;\n    if (typeof b === `undefined`)\n        return false;\n    return (a.max === b.max && a.min === b.min);\n};\n/**\n * Returns _true_ if range 'a' is within or same as range 'b'.\n * Returns _false_ if not or if either/both ranges are _undefined_\n * @param a\n * @param b\n * @returns\n */\nexport const rangeIsWithin = (a, b) => {\n    if (typeof a === `undefined`)\n        return false;\n    if (typeof b === `undefined`)\n        return false;\n    if (a.min >= b.min && a.max <= b.max)\n        return true;\n    return false;\n};\n/**\n * Keeps track of min/max values.\n *\n * ```js\n * const s = rangeStream();\n * s.seen(10);  // { min: 10, max: 10}\n * s.seen(5);   // { min:5, max: 10}\n * ```\n *\n * When calling `seen`, non-numbers, or non-finite numbers are silently ignored.\n *\n * ```js\n * s.reset();   // Reset\n * s.min/s.max; // Current min/max\n * s.range;     // Current { min, max }\n * ```\n * @param initWith\n * @returns\n */\nexport const rangeStream = (initWith = rangeInit()) => {\n    let { min, max } = initWith;\n    const seen = (v) => {\n        if (typeof v === `number`) {\n            if (!Number.isNaN(v) && Number.isFinite(v)) {\n                min = Math.min(min, v);\n                max = Math.max(max, v);\n            }\n        }\n        return { min, max };\n    };\n    const reset = () => {\n        min = Number.MAX_SAFE_INTEGER;\n        max = Number.MIN_SAFE_INTEGER;\n    };\n    return {\n        seen, reset,\n        get range() {\n            return { min, max };\n        },\n        get min() {\n            return min;\n        },\n        get max() {\n            return max;\n        }\n    };\n};\n/**\n * Iterates over `values` finding the min/max.\n * By default non-numbers, as well as NaN and infinite values are skipped.\n * @param values\n * @param nonNumberHandling\n * @returns\n */\nexport function rangeCompute(values, nonNumberHandling = `skip`) {\n    let min = Number.MAX_SAFE_INTEGER;\n    let max = Number.MIN_SAFE_INTEGER;\n    let position = 0;\n    for (const v of values) {\n        if (typeof v === `number`) {\n            if (Number.isNaN(v) || !Number.isFinite(v)) {\n                if (nonNumberHandling === `error`)\n                    throw new Error(`Value NaN or infinite at position: ${position}`);\n                continue;\n            }\n        }\n        else {\n            if (nonNumberHandling === `error`)\n                throw new Error(`Contains non number value. Type: '${typeof v}' Position: ${position}`);\n            continue;\n        }\n        if (v < min)\n            min = v;\n        if (v > max)\n            max = v;\n        position++;\n    }\n    return { min, max };\n}\n","/**\n * Via: https://gist.github.com/cyphunk/6c255fa05dd30e69f438a930faeb53fe\n * @param logits\n * @returns\n */\nexport const softmax = (logits) => {\n    const maxLogit = logits.reduce((a, b) => Math.max(a, b), Number.NEGATIVE_INFINITY);\n    const scores = logits.map((l) => Math.exp(l - maxLogit));\n    const denom = scores.reduce((a, b) => a + b);\n    return scores.map((s) => s / denom);\n};\n","export const trackSimple = () => {\n    let count = 0;\n    let min = Number.MAX_SAFE_INTEGER;\n    let max = Number.MIN_SAFE_INTEGER;\n    let total = 0;\n    const seen = (v) => {\n        min = Math.min(v, min);\n        max = Math.max(v, max);\n        total += v;\n        count++;\n    };\n    const reset = () => {\n        count = 0;\n        min = Number.MAX_SAFE_INTEGER;\n        max = Number.MIN_SAFE_INTEGER;\n        total = 0;\n    };\n    const rangeToString = (digits = 2) => {\n        return `${min.toFixed(2)} - ${max.toFixed(2)}`;\n    };\n    return {\n        seen, reset, rangeToString,\n        get avg() {\n            return total / count;\n        },\n        get min() {\n            return min;\n        },\n        get max() {\n            return max;\n        },\n        get total() {\n            return total;\n        },\n        get count() {\n            return count;\n        }\n    };\n};\n","export * from './apply-to-values.js';\nexport * from './average-weighted.js';\nexport * from './clamp.js';\nexport * from './count.js';\nexport * from './difference.js';\nexport * from './filter.js';\nexport * from './flip.js';\nexport * from './generate.js';\nexport * from './guard.js';\nexport * from './is-approx.js';\nexport * as Bipolar from './bipolar.js';\nexport * from './interpolate.js';\nexport * from './linear-space.js';\nexport * from './moving-average.js';\nexport * as Normalise from './normalise.js';\nexport * from './number-array-compute.js';\nexport * from './numeric-arrays.js';\nexport * from './proportion.js';\nexport * from './quantise.js';\nexport * from './range.js';\nexport * from './round.js';\nexport * from './scale.js';\nexport * from './softmax.js';\nexport * from './track-simple.js';\nexport * from './wrap.js';\nexport * from './types.js';\n","/**\n * If values are strings, uses that as the key.\n * Otherwise uses `JSON.stringify`.\n * @param a\n * @returns\n */\nexport const defaultKeyer = (a) => {\n    return typeof a === `string` ? a : JSON.stringify(a);\n};\n","import { integerTest, resultThrow } from '@ixfx/guards';\n//export { string as random } from './random/String.js';\n//import { afterMatch, beforeAfterMatch, beforeMatch } from '../Text.js';\n/**\n * Returns chunks of `source`, broken up by `delimiter` (default '.').\n *\n * Whittles down from whole string to last token.\n *\n * If `delimiter` is not found, no results are yielded.\n *\n * ```js\n * stringSegmentsWholeToEnd(`a.b.c.d`);\n * // Yields:\n * // `a.b.c.d`\n * // `b.c.d`\n * // `c.d`\n * // `d`\n * ```\n * @param source\n * @param delimiter\n */\nexport function* stringSegmentsWholeToEnd(source, delimiter = `.`) {\n    while (source.length > 0) {\n        yield source;\n        const trimmed = afterMatch(source, delimiter);\n        if (trimmed === source) {\n            // Delimiter not found\n            break;\n        }\n        source = trimmed;\n    }\n}\n/**\n * Returns chunks of `source`, broken up by `delimiter` (default '.').\n *\n * Starts with last token, builds to whole.\n *\n * If `delimiter` is not found, no results are yielded.\n *\n * ````js\n * stringSegmentsLastToWhole(`a.b.c.d`);\n * // Yields:\n * // `d`\n * // `c.d`\n * // `b.c.d`\n * // `a.b.c.d`\n * ```\n * @param source\n * @param delimiter\n */\nexport function* stringSegmentsLastToWhole(source, delimiter = `.`) {\n    let accumulator = ``;\n    const orig = source;\n    while (source.length > 0) {\n        const ba = beforeAfterMatch(source, delimiter, { fromEnd: true, ifNoMatch: `original` });\n        if (ba[0] === ba[1] && ba[1] === source) {\n            // Delimiter not found\n            break;\n        }\n        const v = ba[1] + accumulator;\n        yield v;\n        accumulator = delimiter + v;\n        source = ba[0];\n    }\n    yield orig;\n}\n/**\n * Returns chunks of `source`, broken up by `delimiter` (default '.').\n *\n * We start with the first token and build up until end.\n *\n * If `delimiter` is not found, no results are yielded.\n *\n * ```js\n * stringSegmentsFirstToWhole(`a.b.c.d`);\n * // Yields:\n * // `a`\n * // `a.b`\n * // `a.b.c`\n * // `a.b.c.d`\n * ```\n * @param source\n * @param delimiter\n */\nexport function* stringSegmentsFirstToWhole(source, delimiter = `.`) {\n    let accumulator = ``;\n    const orig = source;\n    while (source.length > 0) {\n        const ba = beforeAfterMatch(source, delimiter, { ifNoMatch: `original` });\n        if (ba[0] === source && ba[1] === source)\n            break;\n        accumulator += ba[0];\n        yield accumulator;\n        accumulator += delimiter;\n        source = ba[1];\n    }\n    yield orig;\n}\n/**\n * Returns chunks of `source`, broken up by `delimiter` (default '.').\n *\n * We start with whole string and whittle down to starting token.\n *\n * If `delimiter` is not found, no results are yielded.\n *\n * ```js\n * stringSegmentsWholeToFirst(`a.b.c.d`);\n * // Yields:\n * // `a.b.c.d`\n * // `a.b.c`,\n * // `a.b`,\n * // `a`,\n * ```\n * @param source\n * @param delimiter\n */\nexport function* stringSegmentsWholeToFirst(source, delimiter = `.`) {\n    while (source.length > 0) {\n        yield source;\n        const b = beforeMatch(source, delimiter, { ifNoMatch: `original`, fromEnd: true });\n        if (b === source)\n            break;\n        source = b;\n    }\n}\n/**\n * Given a long string, abbreviates it with ...\n * ```js\n * abbreviate(`This is something`, 7); // `This is...`\n * ```\n *\n * If `source` is under `maxLength` the original is returned.\n * @param source\n * @param maxLength Maximum length. Defaults to 20\n * @returns\n */\nexport const abbreviate = (source, maxLength = 15) => {\n    resultThrow(integerTest(maxLength, `aboveZero`, `maxLength`));\n    if (typeof source !== `string`)\n        throw new Error(`Parameter 'source' is not a string`);\n    if (source.length > maxLength && source.length > 3) {\n        if (maxLength > 15) {\n            const chunk = Math.round((maxLength - 2) / 2);\n            return source.slice(0, chunk) + `...` + source.slice(-chunk);\n        }\n        return source.slice(0, maxLength) + `...`;\n    }\n    return source;\n};\n/**\n * Uses JSON.toString() on `source`, but abbreviates result.\n * @param source Object to stringify\n * @param maxLength Default 20\n * @returns\n */\nexport const toStringAbbreviate = (source, maxLength = 20) => {\n    if (source === undefined)\n        return `(undefined)`;\n    if (source === null)\n        return `(null)`;\n    return abbreviate(JSON.stringify(source), maxLength);\n};\n/**\n * Returns source text that is between `start` and `end` match strings. Returns _undefined_ if start/end is not found.\n *\n * ```js\n * // Yields ` orange `;\n * between(`apple orange melon`, `apple`, `melon`);\n * ```\n * @param source Source text\n * @param start Start match\n * @param end If undefined, the `start` string will be looked for\n * @param lastEndMatch If true, looks for the last match of `end` (default). If false, looks for the first match.\n * @returns\n */\nexport const between = (source, start, end, lastEndMatch = true) => {\n    //  Unit tested\n    const startPos = source.indexOf(start);\n    if (startPos < 0)\n        return;\n    if (typeof end === `undefined`)\n        end = start;\n    const endPos = lastEndMatch\n        ? source.lastIndexOf(end)\n        : source.indexOf(end, startPos + 1);\n    if (endPos < 0)\n        return;\n    return source.slice(startPos + 1, endPos);\n};\n/**\n * Like {@link between}, but also returns the source string without the start/end match and what's between.\n * ```js\n * const [src,between] = betweenChomp('hello [there] friend', '[', ']');\n * // src: 'hello  friend'\n * // between: 'there'\n * ```\n * @param source\n * @param start\n * @param end\n * @param lastEndMatch\n * @returns\n */\nexport const betweenChomp = (source, start, end, lastEndMatch = true) => {\n    //  Unit tested\n    if (typeof source !== `string`)\n        throw new Error(`Parameter 'source' is not a string`);\n    if (typeof start !== `string`)\n        throw new Error(`Parameter 'start' is not a string`);\n    if (end !== undefined && typeof end !== `string`)\n        throw new Error(`Parameter 'end' is not a string`);\n    const startPos = source.indexOf(start);\n    if (startPos < 0)\n        return [source, undefined];\n    if (typeof end === `undefined`)\n        end = start;\n    const endPos = lastEndMatch\n        ? source.lastIndexOf(end)\n        : source.indexOf(end, startPos + 1);\n    if (endPos < 0)\n        return [source, undefined];\n    const between = source.slice(startPos + 1, endPos);\n    const sourceResult = source.slice(0, startPos) + source.slice(endPos + 1);\n    return [sourceResult, between];\n};\n/**\n * Returns first position of the given character code, or -1 if not found.\n * @param source Source string\n * @param code Code to seek\n * @param start Start index, 0 by default\n * @param end End index (inclusive), source.length-1 by default\n * @returns Found position, or -1 if not found\n */\nexport const indexOfCharCode = (source, code, start = 0, end = source.length - 1) => {\n    for (let index = start; index <= end; index++) {\n        if (source.codePointAt(index) === code)\n            return index;\n    }\n    return -1;\n};\n/**\n * Returns `source` with a given number of characters removed from start position.\n *\n * ```js\n * // Remove three characters starting at position 1\n * omitChars(`hello there`, 1, 3); // ie. removes 'ell'\n * // Yields: `ho there`\n * ```\n * @param source\n * @param removeStart Start point to remove\n * @param removeLength Number of characters to remove\n * @returns\n */\nexport const omitChars = (source, removeStart, removeLength) => source.slice(0, removeStart) +\n    source.slice(removeStart + removeLength);\n/**\n * Splits a string into `length`-size chunks.\n *\n * If `length` is greater than the length of `source`, a single element array is returned with source.\n * The final array element may be smaller if we ran out of characters.\n *\n * ```js\n * splitByLength(`hello there`, 2);\n * // Yields:\n * // [`he`, `ll`, `o `, `th`, `er`, `e`]\n * ```\n * @param source Source string\n * @param length Length of each chunk\n * @returns\n */\nexport const splitByLength = (source, length) => {\n    resultThrow(integerTest(length, `aboveZero`, `length`));\n    if (source === null)\n        throw new Error(`source parameter null`);\n    if (typeof source !== `string`) {\n        throw new TypeError(`source parameter not a string`);\n    }\n    //  Unit tested\n    const chunks = Math.ceil(source.length / length);\n    const returnValue = [];\n    let start = 0;\n    for (let c = 0; c < chunks; c++) {\n        returnValue.push(source.slice(start, start + length));\n        start += length;\n    }\n    return returnValue;\n};\n// export const afterMatch = (\n//   source: string,\n//   match: string,\n//   options: MatchOptions = {}\n// ): string => {\n//   if (source === undefined) throw new Error(`Param 'source' is undefined`);\n//   //   Unit tested\n//   const startPos = options.startPos ?? undefined;\n//   const fromEnd = options.fromEnd ?? false;\n//   const m = fromEnd\n//     ? source.lastIndexOf(match, startPos)\n//     : source.indexOf(match, startPos);\n//   if (m < 0) return source;\n//   return source.slice(Math.max(0, m + match.length));\n// };\n/**\n * Returns all the text in `source` that precedes (and does not include) `match`. If not found, `source` is returned.\n *\n * See also: {@link beforeMatch}, {@link beforeAfterMatch}.\n *\n * ```js\n * afterMatch(`Hello. There`, `.`); // ' There'\n * afterMatch(`Hello, there', `,`); // 'Hello, there'\n * ```\n *\n * If `source` is _undefined_, an error is thrown.\n * @param source\n * @param match\n * @param options\n * @returns\n */\nexport const beforeMatch = (source, match, options = {}) => {\n    const ba = beforeAfterMatch(source, match, options);\n    return ba[0];\n};\n/**\n * Returns all the text in `source` that follows `match`. If not found, `source` is returned.\n *\n * See also: {@link beforeMatch}, {@link beforeAfterMatch}.\n *\n * ```js\n * afterMatch(`Hello. There`, `.`); // ' There'\n * afterMatch(`Hello, there', `,`); // 'Hello, there'\n * ```\n *\n * If `source` is _undefined_, an error is thrown.\n * @param source\n * @param match\n * @param options\n * @returns\n */\nexport const afterMatch = (source, match, options = {}) => {\n    const ba = beforeAfterMatch(source, match, options);\n    return ba[1];\n};\n/**\n * Returns the text that is before and after `match`.\n *\n * See also: {@link beforeMatch}, {@link afterMatch}.\n *\n * If `match` is at the end of start of `source`, after or before might be an empty string.\n * @param source\n * @param match\n * @param options\n * @returns\n */\nexport const beforeAfterMatch = (source, match, options = {}) => {\n    if (source === undefined)\n        throw new Error(`Param 'source' is undefined`);\n    let fallback = options.fallback;\n    const ifNoMatch = options.ifNoMatch ?? (fallback ? `fallback` : `original`);\n    if (ifNoMatch === `original`)\n        fallback = source;\n    if (ifNoMatch === `fallback` && fallback === undefined)\n        throw new Error(`Fallback must be provided`);\n    const startPos = options.startPos ?? undefined;\n    const fromEnd = options.fromEnd ?? false;\n    const m = fromEnd\n        ? source.lastIndexOf(match, startPos)\n        : source.indexOf(match, startPos);\n    if (m < 0 && ifNoMatch === `throw`)\n        throw new Error(`Match '${match}' not found in source.`);\n    if (m < 0 && ifNoMatch === `original`)\n        return [source, source];\n    if (m < 0 && ifNoMatch === `fallback`) {\n        // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n        return [fallback, fallback];\n    }\n    return [\n        source.slice(0, m),\n        source.slice(Math.max(0, m + match.length))\n    ];\n};\n/**\n * 'Unwraps' a string, removing one or more 'wrapper' strings that it starts and ends with.\n * Only removes when a matching end is found.\n * ```js\n * unwrap(\"'hello'\", \"'\");        // hello\n * // No mataching end 'a', so nothing happens\n * unwrap(\"apple\", \"a\");          // apple\n * unwrap(\"wow\", \"w\");            // o\n * unwrap(`\"'blah'\"`, '\"', \"'\");  // blah\n * ```\n * @param source\n * @param wrappers\n * @returns\n */\nexport const unwrap = (source, ...wrappers) => {\n    let matched = false;\n    do {\n        matched = false;\n        for (const w of wrappers) {\n            if (source.startsWith(w) && source.endsWith(w)) {\n                source = source.slice(w.length, source.length - w.length * 2 + 1);\n                matched = true;\n            }\n        }\n    } while (matched);\n    return source;\n};\n/**\n * Calculates the span, defined in {@link Range} indexes, that includes `start` through to `end` character positions.\n *\n * After using {@link splitRanges} to split text, `lineSpan` is used to associate some text coordinates with ranges.\n *\n * @param ranges Ranges\n * @param start Start character position, in source text reference\n * @param end End character position, in source text reference\n * @returns Span\n */\nexport const lineSpan = (ranges, start, end) => {\n    let s = -1;\n    let endPos = -1;\n    for (const [index, r] of ranges.entries()) {\n        s = index;\n        if (r.text.length === 0)\n            continue;\n        if (start < r.end) {\n            break;\n        }\n    }\n    for (let index = s; index < ranges.length; index++) {\n        const r = ranges[index];\n        endPos = index;\n        if (end === r.end) {\n            endPos = index + 1;\n            break;\n        }\n        if (end < r.end) {\n            break;\n        }\n    }\n    return { length: endPos - s, start: s, end: endPos };\n};\n/**\n * Splits a source string into ranges:\n * ```js\n * const ranges = splitRanges(\"hello;there;fella\", \";\");\n * ```\n *\n * Each range consists of:\n * ```js\n * {\n *  text: string  - the text of range\n *  start: number - start pos of range, wrt to source\n *  end: number   - end pos of range, wrt to source\n *  index: number - index of range (starting at 0)\n * }\n * ```\n * @param source\n * @param split\n * @returns\n */\nexport const splitRanges = (source, split) => {\n    let start = 0;\n    let text = ``;\n    const ranges = [];\n    let index = 0;\n    for (let index_ = 0; index_ < source.length; index_++) {\n        if (source.indexOf(split, index_) === index_) {\n            const end = index_;\n            ranges.push({\n                text,\n                start,\n                end,\n                index,\n            });\n            start = end + 1;\n            text = ``;\n            index++;\n        }\n        else {\n            text += source.charAt(index_);\n        }\n    }\n    if (start < source.length) {\n        ranges.push({ text, start, index, end: source.length });\n    }\n    return ranges;\n};\n/**\n * Counts the number of times one of `chars` appears at the front of\n * a string, contiguously.\n *\n * ```js\n * countCharsFromStart(`  hi`, ` `); // 2\n * countCharsFromStart(`hi  `, ` `); // 0\n * countCharsFromStart(`  hi  `, ` `); // 2\n * ```\n * @param source\n * @param chars\n * @returns\n */\nexport const countCharsFromStart = (source, ...chars) => {\n    let counted = 0;\n    for (let index = 0; index < source.length; index++) {\n        if (chars.includes(source.charAt(index))) {\n            counted++;\n        }\n        else {\n            break;\n        }\n    }\n    return counted;\n};\n/**\n * Returns _true_ if `source` starts and ends with `start` and `end`. Case-sensitive.\n * If _end_ is omitted, the the `start` value will be used.\n *\n * ```js\n * startsEnds(`This is a string`, `This`, `string`); // True\n * startsEnds(`This is a string`, `is`, `a`); // False\n * starsEnds(`test`, `t`); // True, starts and ends with 't'\n * ```\n * @param source String to search within\n * @param start Start\n * @param end End (if omitted, start will be looked for at end as well)\n * @returns True if source starts and ends with provided values.\n */\nexport const startsEnds = (source, start, end = start) => source.startsWith(start) && source.endsWith(end);\nexport const htmlEntities = (source) => source.replaceAll(/[&<>\\u00A0-\\u9999]/g, (index) => `&#${index.codePointAt(0)};`);\n/**\n * Simple wilcard matching. Use '*' in `pattern` to denote any number of characters.\n * ```js\n * // Must start with 'cat'\n * wildcard(`cat*`,`caterpillar`); // true\n * // Must end with 'cat'\n * wildcat(`*cat`, `bobcat`);  // true\n * // 'cat' anywhere in string\n * wildcard(`*cat*`, `see cat run`); // true\n * ```\n * @param pattern\n * @returns\n */\nexport const wildcard = (pattern) => {\n    // Based on source: https://stackoverflow.com/questions/26246601/wildcard-string-comparison-in-javascript\n    // for this solution to work on any string, no matter what characters it has\n    const escapeRegex = (value) => value.replaceAll(/([!$()*+./:=?[\\\\\\]^{|}])/g, `\\\\$1`);\n    // \".\"  => Find a single character, except newline or line terminator\n    // \".*\" => Matches any string that contains zero or more characters\n    pattern = pattern.split(`*`).map(m => escapeRegex(m)).join(`.*`);\n    // \"^\"  => Matches any string with the following at the beginning of it\n    // \"$\"  => Matches any string with that in front at the end of it\n    pattern = `^` + pattern + `$`;\n    // Create a regular expression object for matching string\n    const regex = new RegExp(pattern);\n    return (value) => {\n        // Returns true if it finds a match, otherwse it returns false\n        return regex.test(value);\n    };\n};\n","export const isAsyncIterable = (v) => {\n    if (typeof v !== `object`)\n        return false;\n    if (v === null)\n        return false;\n    return Symbol.asyncIterator in v;\n};\nexport const isIterable = (v) => {\n    if (typeof v !== `object`)\n        return false;\n    if (v === null)\n        return false;\n    return Symbol.iterator in v;\n};\n","export function* slice(it, start = 0, end = Number.POSITIVE_INFINITY) {\n    if (end < start)\n        throw new Error(`Param 'end' should be more than 'start'`);\n    if (start < 0)\n        throw new Error(`Param 'start' should be at least 0`);\n    let index = 0;\n    for (const v of it) {\n        if (index < start) {\n            index++;\n            continue;\n        }\n        if (index > end) {\n            break;\n        }\n        yield v;\n        index++;\n    }\n}\n","export function reduce(it, f, start) {\n    // https://surma.github.io/underdash/\n    for (const v of it)\n        start = f(start, v);\n    return start;\n}\n","import { toStringDefault } from '@ixfx/core';\nimport { intervalToMs } from '@ixfx/core';\nimport { isIterable } from './guard.js';\nexport { slice } from './sync/slice.js';\nexport { reduce } from './sync/reduce.js';\nexport function* uniqueByValue(input, toString = toStringDefault, seen = new Set()) {\n    for (const v of input) {\n        const key = toString(v);\n        if (seen.has(key))\n            continue;\n        seen.add(key);\n        yield v;\n    }\n}\n/**\n * Calls `callback` whenever the generator produces a value.\n *\n * When using `asCallback`, call it with `await` to let generator\n * run its course before continuing:\n * ```js\n * await asCallback(tick({ interval:1000, loops:5 }), x => {\n *  // Gets called 5 times, with 1000ms interval\n * });\n * console.log(`Hi`); // Prints after 5 seconds\n * ```\n *\n * Or if you skip the `await`, code continues and callback will still run:\n * ```js\n * asCallback(tick({ interval: 1000, loops: 5}), x => {\n *  // Gets called 5 times, with 1000ms interval\n * });\n * console.log(`Hi`); // Prints immediately\n * ```\n * @param input\n * @param callback\n */\nexport function asCallback(input, callback, onDone) {\n    for (const value of input) {\n        callback(value);\n    }\n    if (onDone)\n        onDone();\n}\n/**\n * Returns a function that yields a value from a generator.\n * ```js\n * const spring = yieldNumber(Oscillators.spring());\n *\n * spring(); // latest value\n * ```\n *\n * Instead of:\n * ```js\n * const spring = Oscillators.spring();\n *\n * spring.next().value\n * ```\n *\n * A `defaultValue` can be provided if the source generator returns undefined:\n * ```js\n * const spring = yieldNumber(Oscillators.spring(), 0);\n * spring(); // Returns 0 if the generator returns undefined\n * ```\n * @param generator\n * @param defaultValue\n * @returns\n */\nexport function yieldNumber(generator, defaultValue) {\n    return () => {\n        const v = generator.next().value;\n        if (v === undefined)\n            return defaultValue;\n        return v;\n    };\n}\n/**\n * Return first value from an iterable, or _undefined_ if\n * no values are generated\n * @param it\n * @returns\n */\nexport function first(it) {\n    for (const value of it) {\n        return value;\n    }\n}\n/**\n * Returns last value from an iterable, or _undefined_\n * if no values are generated\n * @param it\n */\nexport function last(it) {\n    let returnValue;\n    for (const value of it) {\n        returnValue = value;\n    }\n    return returnValue;\n}\n/**\n * Yields chunks of the iterable `it` such that the end of a chunk is the\n * start of the next chunk.\n *\n * Eg, with the input [1,2,3,4,5] and a size of 2, we would get back\n * [1,2], [2,3], [3,4], [4,5].\n *\n *\n * @param it\n * @param size\n * @returns\n */\nexport function* chunksOverlapping(it, size) {\n    if (size <= 1)\n        throw new Error(`Size should be at least 2`);\n    //eslint-disable-next-line functional/no-let\n    let buffer = [];\n    for (const v of it) {\n        //eslint-disable-next-line functional/immutable-data\n        buffer.push(v);\n        if (buffer.length === size) {\n            yield buffer;\n            //eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n            buffer = [buffer.at(-1)];\n        }\n    }\n    if (buffer.length <= 1)\n        return;\n    if (buffer.length > 0)\n        yield buffer;\n}\nexport function* chunks(it, size) {\n    //eslint-disable-next-line functional/no-let\n    let buffer = [];\n    for (const v of it) {\n        //eslint-disable-next-line functional/immutable-data\n        buffer.push(v);\n        if (buffer.length === size) {\n            yield buffer;\n            buffer = [];\n        }\n    }\n    if (buffer.length > 0)\n        yield buffer;\n}\nexport function* concat(...its) {\n    for (const it of its)\n        yield* it;\n}\nexport function* dropWhile(it, f) {\n    for (const v of it) {\n        if (!f(v)) {\n            yield v;\n        }\n    }\n}\n/**\n* Loops over a generator until it finishes, calling `callback`.\n* Useful if you don't care about the value generator produces, just the number of loops.\n*\n* ```js\n* until(count(5), () => {\n* // do something 5 times\n* });\n* ```\n*\n* If you want the value from the generator, use a `for of` loop as usual.\n* If `callback` explicitly returns _false_, the generator is aborted.\n* @param it Generator to run\n* @param callback Code to call for each iteration\n*/\n// eslint-disable-next-line @typescript-eslint/no-invalid-void-type\nexport const until = (it, callback) => {\n    for (const _ of it) {\n        const value = callback();\n        if (typeof value === `boolean` && !value)\n            break;\n    }\n};\nexport const next = (it) => {\n    return () => {\n        const r = it.next();\n        if (r.done)\n            return;\n        return r.value;\n    };\n};\n/**\n * Returns true if items in two iterables are equal, as\n * determined by the `equality` function.\n * @param it1\n * @param it2\n * @param equality\n * @returns\n */\nexport function equals(it1, it2, equality) {\n    //it1 = it1[Symbol.iterator]();\n    //it2 = it2[Symbol.iterator]();\n    while (true) {\n        const index1 = it1.next(), index2 = it2.next();\n        if (equality !== undefined) {\n            if (!equality(index1.value, index2.value))\n                return false;\n        }\n        else if (index1.value !== index2.value)\n            return false;\n        if (index1.done ?? index2.done)\n            return index1.done && index2.done;\n    }\n}\nexport function every(it, f) {\n    for (const v of it) {\n        const result = f(v);\n        if (!result)\n            return false;\n    }\n    return true;\n}\nexport function* fill(it, v) {\n    // https://surma.github.io/underdash/\n    for (const _ of it)\n        yield v;\n}\n/**\n * Iterates over `iterator` (iterable/array), calling `fn` for each value.\n * If `fn` returns _false_, iterator cancels.\n *\n * Over the default JS `forEach` function, this one allows you to exit the\n * iteration early.\n *\n * @example\n * ```js\n * import { Sync } from \"@ixfx/iterables.js\"\n * Sync.forEach(count(5), () => console.log(`Hi`));  // Prints `Hi` 5x\n * Sync.forEach(count(5), i => console.log(i));      // Prints 0 1 2 3 4\n * Sync.forEach([0,1,2,3,4], i => console.log(i));   // Prints 0 1 2 3 4\n * ```\n *\n * Use {@link forEach} if you want to use an async `iterator` and async `fn`.\n *\n * Alternatives:\n * * {@link https://api.ixfx.fun/_ixfx/flow/repeat/ @ixfx/flow.repeat}/{@link https://api.ixfx.fun/_ixfx/flow/repeatSync/ @ixfx/flow.repeatSync}: if you want to call something a given number of times and get the result\n * @param iterator Iterable or array\n * @typeParam T Type of iterable's values\n * @param fn Function to call for each item. If function returns _false_, iteration cancels\n */\nexport function forEach(iterator, fn) {\n    for (const v of iterator) {\n        const result = fn(v);\n        if (typeof result === `boolean` && !result)\n            break;\n    }\n}\n/**\n * ```js\n * filter([1, 2, 3, 4], e => e % 2 == 0);\n * returns [2, 4]\n * ```\n * @param it\n * @param f\n */\nexport function* filter(it, f) {\n    // https://surma.github.io/underdash/\n    for (const v of it) {\n        if (!f(v))\n            continue;\n        yield v;\n    }\n}\nexport function find(it, f) {\n    // https://surma.github.io/underdash/\n    for (const v of it) {\n        if (f(v))\n            return v;\n    }\n}\nexport function* flatten(it) {\n    // https://surma.github.io/underdash/\n    for (const v of it) {\n        if (typeof v === `object`) {\n            if (Array.isArray(v)) {\n                for (const vv of v)\n                    yield vv;\n            }\n            else if (isIterable(v)) {\n                for (const vv of v) {\n                    yield vv;\n                }\n            }\n        }\n        else {\n            yield v;\n        }\n    }\n}\n/**\n * Maps an iterable of type `V` to type `X`.\n * ```js\n * map([1, 2, 3], e => e*e)\n * returns [1, 4, 9]\n * ```\n * @param it\n * @param f\n */\nexport function* map(it, f) {\n    // https://surma.github.io/underdash/\n    for (const v of it) {\n        yield f(v);\n    }\n}\nexport function* max(it, gt = (a, b) => a > b) {\n    let max;\n    for (const v of it) {\n        if (max === undefined) {\n            max = v;\n            yield max;\n            continue;\n        }\n        if (gt(v, max)) {\n            max = v;\n            yield max;\n        }\n    }\n    return max;\n}\nexport function* min(it, gt = (a, b) => a > b) {\n    let min;\n    for (const v of it) {\n        if (min === undefined) {\n            min = v;\n            yield min;\n        }\n        if (gt(min, v)) {\n            min = v;\n            yield min;\n        }\n    }\n}\nexport function some(it, f) {\n    // https://surma.github.io/underdash/\n    for (const v of it) {\n        if (f(v))\n            return true;\n    }\n    return false;\n}\n// export function* takeWhile<V>(it: Iterable<V>, f: (v: V) => boolean) {\n//   // https://surma.github.io/underdash/\n//   for (const v of it) {\n//     if (!f(v)) return;\n//     yield v;\n//   }\n// }\nexport function* repeat(genCreator, repeatsOrSignal) {\n    const repeats = typeof repeatsOrSignal === `number` ? repeatsOrSignal : Number.POSITIVE_INFINITY;\n    const signal = typeof repeatsOrSignal === `number` ? undefined : repeatsOrSignal;\n    let count = repeats;\n    while (true) {\n        for (const v of genCreator()) {\n            yield v;\n            if (signal?.aborted)\n                break;\n        }\n        if (Number.isFinite(repeats)) {\n            count--;\n            if (count === 0)\n                break;\n        }\n        if (signal?.aborted)\n            break;\n    }\n}\nexport function* unique(iterable) {\n    // Adapted from https://surma.github.io/underdash/\n    const buffer = [];\n    let itera = [];\n    itera = Array.isArray(iterable) ? iterable : [iterable];\n    for (const it of itera) {\n        for (const v of it) {\n            if (buffer.includes(v))\n                continue;\n            buffer.push(v);\n            yield v;\n        }\n    }\n}\n/**\n * Combine same-positioned items from several iterables\n * ```js\n * zip( [1, 2, 3], [4, 5, 6], [7, 8, 9] );\n * Yields: [ [1, 4, 7], [2, 5, 8], [3, 6, 9] ]\n * ```\n * @param its\n * @returns\n */\nexport function* zip(...its) {\n    // https://surma.github.io/underdash/\n    const iits = its.map((it) => it[Symbol.iterator]());\n    while (true) {\n        const vs = iits.map((it) => it.next());\n        if (vs.some((v) => v.done))\n            return;\n        yield vs.map((v) => v.value);\n    }\n}\nexport function* fromIterable(iterable) {\n    for (const v of iterable) {\n        yield v;\n    }\n}\n/**\n * Returns an array of values from an iterator.\n *\n * ```js\n * const data = await toArray(adsrIterable(opts, 10));\n * ```\n *\n * Note: If the iterator is infinite, be sure to provide a limit via the options or the function\n * will never return.\n *\n * @param it Asynchronous iterable\n * @param options Options when converting to array.\n * @returns\n */\nexport function toArray(it, options = {}) {\n    const result = [];\n    const started = Date.now();\n    const whileFunction = options.while;\n    const maxItems = options.limit ?? Number.POSITIVE_INFINITY;\n    const maxElapsed = intervalToMs(options.elapsed, Number.POSITIVE_INFINITY);\n    for (const v of it) {\n        if (whileFunction) {\n            if (!whileFunction(result.length))\n                break;\n        }\n        if (result.length >= maxItems)\n            break;\n        if (Date.now() - started > maxElapsed)\n            break;\n        result.push(v);\n    }\n    return result;\n}\n/**\n * Yield values from `array`, one at a time.\n * Use `interval` to add time between each item.\n * The first item is yielded without delay.\n * @param array Array of values\n */\nexport function* fromArray(array) {\n    for (const v of array) {\n        yield v;\n    }\n}\n","export class MapOfSimple {\n    #store = new Map();\n    /**\n     * Gets a copy of the underlying array storing values at `key`, or an empty array if\n     * key does not exist\n     * @param key\n     * @returns\n     */\n    get(key) {\n        const arr = this.#store.get(key);\n        if (!arr)\n            return [];\n        return [...arr];\n    }\n    /**\n     * Returns the number of values stored under `key`\n     * @param key\n     * @returns\n     */\n    size(key) {\n        const arr = this.#store.get(key);\n        if (!arr)\n            return 0;\n        return arr.length;\n    }\n    /**\n     * Iterate over all values contained under `key`\n     * @param key\n     * @returns\n     */\n    *iterateKey(key) {\n        const arr = this.#store.get(key);\n        if (!arr)\n            return;\n        yield* arr.values();\n    }\n    /**\n     * Iterate all values, regardless of key\n     */\n    *iterateValues() {\n        for (const key of this.#store.keys()) {\n            yield* this.iterateKey(key);\n        }\n    }\n    /**\n     * Iterate all keys\n     */\n    *iterateKeys() {\n        yield* this.#store.keys();\n    }\n    addKeyedValues(key, ...values) {\n        let arr = this.#store.get(key);\n        if (!arr) {\n            arr = [];\n            this.#store.set(key, arr);\n        }\n        arr.push(...values);\n    }\n    deleteKeyValue(key, value) {\n        const arr = this.#store.get(key);\n        if (!arr)\n            return false;\n        const arrCopy = arr.filter(v => v !== value);\n        if (arrCopy.length === arr.length)\n            return false;\n        this.#store.set(key, arrCopy);\n        return true;\n    }\n    clear() {\n        this.#store.clear();\n    }\n}\n","import { MapOfSimple } from \"./map-of.js\";\nexport class SimpleEventEmitter {\n    #listeners = new MapOfSimple();\n    #disposed = false;\n    dispose() {\n        if (this.#disposed)\n            return;\n        this.clearEventListeners();\n    }\n    get isDisposed() {\n        return this.#disposed;\n    }\n    /**\n     * Fire event\n     * @param type Type of event\n     * @param args Arguments for event\n     * @returns\n     */\n    fireEvent(type, args) {\n        if (this.#disposed)\n            throw new Error(`Disposed`);\n        //console.log(`Firing ${ type as string }. Listeners: ${ this.#listeners.size(type as string) }`);\n        for (const l of this.#listeners.iterateKey(type)) {\n            l(args, this);\n        }\n    }\n    /**\n     * Adds event listener.\n     *\n     * @throws Error if emitter is disposed\n     * @typeParam K - Events\n     * @param name Event name\n     * @param listener Event handler\n     */\n    addEventListener(name, listener) {\n        if (this.#disposed)\n            throw new Error(`Disposed`);\n        this.#listeners.addKeyedValues(name, listener);\n    }\n    /**\n     * Remove event listener\n     *\n     * @param listener\n     */\n    removeEventListener(type, listener) {\n        if (this.#disposed)\n            return;\n        // listener: Listener<Events>): void {\n        this.#listeners.deleteKeyValue(type, listener);\n    }\n    /**\n     * Clear all event listeners\n     * @private\n     */\n    clearEventListeners() {\n        if (this.#disposed)\n            return;\n        this.#listeners.clear();\n    }\n}\n","export { SimpleEventEmitter } from './simple-event-emitter.js';\nexport * from './types.js';\n","import { intervalToMs, toStringDefault } from '@ixfx/core';\nimport { sleep } from '@ixfx/core';\nimport { isAsyncIterable, isIterable } from './guard.js';\n/**\n * Yield values from `array`, one at a time.\n * Use `interval` to add time between each item.\n * The first item is yielded without delay.\n *\n * @param array Array of values\n * @param interval Interval (defaults: 1ms)\n */\nexport async function* fromArray(array, interval = 1) {\n    for (const v of array) {\n        yield v;\n        await sleep(interval);\n    }\n}\n/**\n * Yield values from `iterable`, one at a time.\n * Use `interval` to add time between each item.\n * The first item is yielded without delay.\n * @param iterable Iterable or AsyncIterable\n * @param [interval=1] Interval to wait between yield\n */\nexport async function* fromIterable(iterable, interval = 1) {\n    for await (const v of iterable) {\n        yield v;\n        await sleep(interval);\n    }\n}\nexport async function* chunks(it, size) {\n    // Source: https://surma.github.io/underdash/\n    let buffer = [];\n    for await (const v of it) {\n        buffer.push(v);\n        if (buffer.length === size) {\n            yield buffer;\n            buffer = [];\n        }\n    }\n    if (buffer.length > 0)\n        yield buffer;\n}\nexport async function* concat(...its) {\n    // Source: https://surma.github.io/underdash/\n    for await (const it of its)\n        yield* it;\n}\nexport async function* dropWhile(it, f) {\n    for await (const v of it) {\n        if (!f(v)) {\n            yield v;\n        }\n    }\n}\n/**\n * Loops over a generator until it finishes, calling `callback`.\n * Useful if you don't care about the value generator produces, just the number of loops.\n *\n * In this version, we do a `for await of` over `gen`, and also `await callback()`.\n\n * ```js\n * await until(count(5), () => {\n * // do something 5 times\n * });\n * ```\n *\n * If you want the value from the generator, use a `for of` loop as usual.\n *\n * If `callback` explicitly returns _false_, the generator is aborted.\n * @param it Generator to run\n * @param callback Code to call for each iteration\n */\n// eslint-disable-next-line @typescript-eslint/no-invalid-void-type\nexport const until = async (it, callback) => {\n    for await (const _ of it) {\n        const value = await callback();\n        if (typeof value === `boolean` && !value)\n            break;\n    }\n};\n/**\n * This generator will repeat another generator up until some condition. This is the version\n * that can handle async generators.\n *\n * For example, {@link https://api.ixfx.fun/_ixfx/numbers/count/ @ixfx/numbers.count} will count from 0..number and then finish:\n * ```js\n * import { count } from '@ixfx/numbers'\n * for (const v of count(5)) {\n *  // v: 0, 1, 2, 3, 4\n * }\n * ```\n *\n * But what if we want to repeat the count? We have to provide a function to create the generator,\n * rather than using the generator directly, since it's \"one time use\"\n * ```js\n * for await (const v of repeat(() => count(5))) {\n *  // v: 0, 1, 2, 3, 4, 0, 1, 2, 3, 4, 0, ...\n *  // warning: never ends\n * }\n * ```\n *\n * Limiting the number of repeats can be done by passing in extra parameters\n * ```js\n * repeat(generator, { count: 5} ); // Iterate over `generator` five times\n * ```\n *\n * ```js\n * const ac = new AbortController();\n * repeat(generator, { signal: ac.signal }); // Pass in signal\n * ...\n * ac.abort(); // Trigger signal at some point\n * ```\n * @param genCreator\n * @param repeatsOrSignal\n */\nexport const repeat = async function* (genCreator, repeatsOrSignal) {\n    const repeats = typeof repeatsOrSignal === `number` ? repeatsOrSignal : Number.POSITIVE_INFINITY;\n    const signal = typeof repeatsOrSignal === `number` ? undefined : repeatsOrSignal;\n    let count = repeats;\n    while (true) {\n        for await (const v of genCreator()) {\n            yield v;\n            if (signal?.aborted)\n                break;\n        }\n        if (Number.isFinite(repeats)) {\n            count--;\n            if (count === 0)\n                break;\n        }\n        if (signal?.aborted)\n            break;\n    }\n};\n/**\n * Returns true if items in two iterables are equal, as\n * determined by the `equality` function.\n * Order matters. It compares items at the same 'step' of each iterable.\n * @param it1\n * @param it2\n * @param equality\n * @returns\n */\nexport async function equals(it1, it2, equality) {\n    // https://surma.github.io/underdash/\n    const iit1 = it1[Symbol.asyncIterator](); // it1[ Symbol.iterator ]();\n    const iit2 = it2[Symbol.asyncIterator]();\n    while (true) {\n        const index1 = await iit1.next();\n        const index2 = await iit2.next();\n        if (equality !== undefined) {\n            if (!equality(index1.value, index2.value))\n                return false;\n        }\n        else if (index1.value !== index2.value)\n            return false;\n        if (index1.done ?? index2.done)\n            return index1.done && index2.done;\n    }\n}\nexport async function every(it, f) {\n    for await (const v of it) {\n        const result = await f(v);\n        if (!result)\n            return false;\n    }\n    return true;\n}\nexport async function* fill(it, v) {\n    // https://surma.github.io/underdash/\n    for await (const _ of it)\n        yield v;\n}\n/**\n * Filters an iterable, only yielding items which match `f`.\n *\n * ```js\n * filter([1, 2, 3, 4], e => e % 2 == 0);\n * returns [2, 4]\n * ```\n * @param it\n * @param f\n */\nexport async function* filter(it, f) {\n    // https://surma.github.io/underdash/\n    for await (const v of it) {\n        if (!await f(v))\n            continue;\n        yield v;\n    }\n}\nexport async function find(it, f) {\n    // https://surma.github.io/underdash/\n    for await (const v of it) {\n        if (await f(v))\n            return v;\n    }\n}\nexport async function* flatten(it) {\n    // https://surma.github.io/underdash/\n    for await (const v of it) {\n        if (typeof v === `object`) {\n            if (Array.isArray(v)) {\n                for (const vv of v)\n                    yield vv;\n            }\n            else if (isAsyncIterable(v)) {\n                for await (const vv of v) {\n                    yield vv;\n                }\n            }\n            else if (isIterable(v)) {\n                for (const vv of v) {\n                    yield vv;\n                }\n            }\n        }\n        else {\n            yield v;\n        }\n    }\n}\n/**\n * Iterates over an async iterable or array, calling `fn` for each value, with optional\n * interval between each loop. If the async `fn` returns _false_, iterator cancels.\n *\n * ```\n * import { forEach } from \"@ixfx/flow.js\"\n * // Prints items from array every second\n * await forEach([0,1,2,3], i => console.log(i), 1000);\n * ```\n *\n * ```\n * // Retry up to five times, with 5 seconds between each attempt\n * await forEach(count(5), i=> {\n *  try {\n *    await doSomething();\n *    return false; // Succeeded, exit early\n *  } catch (ex) {\n *    console.log(ex);\n *    return true; // Keep trying\n *  }\n * }, 5000);\n * ```\n * @param iterator Iterable thing to loop over\n * @param fn Function to invoke on each item. If it returns _false_ loop ends.\n * @param options Options\n * @typeParam V Type of iterable\n */\nexport const forEach = async function (iterator, fn, options = {}) {\n    const interval = options.interval;\n    if (Array.isArray(iterator)) {\n        // Handle array\n        for (const x of iterator) {\n            const r = await fn(x);\n            if (typeof r === `boolean` && !r)\n                break;\n            if (interval)\n                await sleep(interval);\n        }\n    }\n    else {\n        // Handle an async iterator\n        for await (const x of iterator) {\n            const r = await fn(x);\n            if (typeof r === `boolean` && !r)\n                break;\n            if (interval)\n                await sleep(interval);\n        }\n    }\n};\n// export async function forEach<V>(it: AsyncIterable<V>, f: (v: V) => void | boolean | Promise<boolean | void>) {\n//   // https://surma.github.io/underdash/\n//   for await (const v of it) {\n//     const result = await f(v);\n//     if (typeof result === `boolean` && !result) break;\n//   }\n// }\n/**\n * Returns last value from an iterable, or _undefined_\n * if no values are generated\n * @param it\n */\nexport async function last(it, opts = {}) {\n    const abort = opts.abort;\n    let returnValue;\n    for await (const value of it) {\n        if (abort?.aborted)\n            return undefined;\n        returnValue = value;\n    }\n    return returnValue;\n}\n/**\n * Maps an iterable through function `f`\n * ```js\n * // For every input value, multiply it by itself\n * map([1, 2, 3], e => e*e)\n * // Yields: 1, 4, 9\n * ```\n *\n * It can also be used to transform types:\n * ```js\n * map([1, 2, 3], e => { value: e });\n * // Yields: { value: 1 }, { value: 2 }, { value: 3 }\n * ```\n * @param it\n * @param f\n */\nexport async function* map(it, f) {\n    // https://surma.github.io/underdash/\n    for await (const v of it) {\n        yield f(v);\n    }\n}\nexport async function* max(it, gt = ((a, b) => a > b)) {\n    let max;\n    for await (const v of it) {\n        if (max === undefined) {\n            max = v;\n            yield (max);\n            continue;\n        }\n        // If V is bigger than max, we have a new max\n        if (gt(v, max)) {\n            max = v;\n            yield v;\n        }\n    }\n}\n/**\n * Returns the minimum seen of an iterable as it changes.\n * Streaming result: works with endless iterables.\n *\n * Note that `gt` function returns true if A is _greater_ than B, even\n * though we're looking for the minimum.\n *\n * ```js\n * // Rank objects based on 'v' value\n * const rank = (a,b) => a.v > b.v;\n * min([\n *  {i:0,v:1},\n *  {i:1,v:9},\n *  {i:2,v:-2}\n * ], rank);\n * // Yields: {i:2, v:1}, {i:2,v:-2}\n * ```\n * @param it Iterable\n * @param gt Should return _true_ if `a` is greater than `b`.\n * @returns\n */\nexport async function* min(it, gt = (a, b) => a > b) {\n    let min;\n    for await (const v of it) {\n        if (min === undefined) {\n            min = v;\n            yield min;\n            continue;\n        }\n        // If min is bigger than V, V is the new min\n        if (gt(min, v)) {\n            min = v;\n            yield v;\n        }\n    }\n    return min;\n}\nexport async function reduce(it, f, start) {\n    // https://surma.github.io/underdash/\n    for await (const v of it)\n        start = f(start, v);\n    return start;\n}\n/**\n * Calls `callback` whenever the async generator produces a value.\n *\n * When using `asCallback`, call it with `await` to let generator\n * run its course before continuing:\n * ```js\n * await asCallback(tick({ interval:1000, loops:5 }), x => {\n *  // Gets called 5 times, with 1000ms interval\n * });\n * console.log(`Hi`); // Prints after 5 seconds\n * ```\n *\n * Or if you skip the `await`, code continues and callback will still run:\n * ```js\n * asCallback(tick({ interval: 1000, loops: 5}), x => {\n *  // Gets called 5 times, with 1000ms interval\n * });\n * console.log(`Hi`); // Prints immediately\n * ```\n * @param input\n * @param callback\n */\nexport async function asCallback(input, callback, onDone) {\n    for await (const value of input) {\n        callback(value);\n    }\n    if (onDone)\n        onDone();\n}\nexport async function* slice(it, start = 0, end = Number.POSITIVE_INFINITY) {\n    console.log(`Async slice start: ${start}`);\n    // https://surma.github.io/underdash/\n    const iit = it[Symbol.asyncIterator]();\n    if (end < start)\n        throw new Error(`Param 'end' should be more than 'start'`);\n    for (; start > 0; start--, end--)\n        await iit.next();\n    for await (const v of it) {\n        if (end-- > 0) {\n            yield v;\n        }\n        else {\n            break;\n        }\n    }\n}\n/**\n * Enumerates over an input iterable, with a delay between items.\n * @param it\n * @param delay\n */\nexport async function* withDelay(it, delay) {\n    for (const v of it) {\n        await sleep(delay);\n        yield v;\n    }\n}\n/***\n * Returns the next IteratorResult,\n * throwing an error if it does not happen\n * within `interval` (default: 1s)\n */\nexport async function nextWithTimeout(it, options) {\n    const ms = intervalToMs(options, 1000);\n    const value = await Promise.race([\n        (async () => {\n            await sleep({ millis: ms, signal: options.signal });\n            return undefined;\n        })(),\n        (async () => {\n            return await it.next();\n        })()\n    ]);\n    if (value === undefined)\n        throw new Error(`Timeout`);\n    return value;\n}\nexport async function some(it, f) {\n    // https://surma.github.io/underdash/\n    for await (const v of it) {\n        if (await f(v))\n            return true;\n    }\n    return false;\n}\n// export async function* takeWhile<V>(\n//   it: AsyncIterable<V>,\n//   f: (v: V) => boolean\n// ) {\n//   // https://surma.github.io/underdash/\n//   for await (const v of it) {\n//     if (!f(v)) return;\n//     yield v;\n//   }\n// }\n/**\n * Returns an array of values from an iterator.\n *\n * ```js\n * const data = await toArray(adsrIterable(opts, 10));\n * ```\n *\n * Note: If the iterator is infinite, be sure to provide limits via the options.\n * ```js\n * // Return maximum five items\n * const data = await toArray(iterable, { limit: 5 });\n * // Return results for a maximum of 5 seconds\n * const data = await toArray(iterable, { elapsed: 5000 });\n * ```\n * Note that limits are ORed, `toArray` will finish if either of them is true.\n *\n * @param it Asynchronous iterable\n * @param options Options when converting to array\n * @returns\n */\nexport async function toArray(it, options = {}) {\n    // https://2ality.com/2016/10/asynchronous-iteration.html\n    const result = [];\n    const iterator = it[Symbol.asyncIterator]();\n    const started = Date.now();\n    const maxItems = options.limit ?? Number.POSITIVE_INFINITY;\n    const whileFunction = options.while;\n    const maxElapsed = intervalToMs(options.elapsed, Number.POSITIVE_INFINITY);\n    while (result.length < maxItems && (Date.now() - started < maxElapsed)) {\n        if (whileFunction) {\n            if (!whileFunction(result.length))\n                break;\n        }\n        const r = await iterator.next();\n        if (r.done)\n            break;\n        //eslint-disable-next-line functional/immutable-data\n        result.push(r.value);\n    }\n    return result;\n}\nexport async function* unique(iterable) {\n    const buffer = [];\n    const itera = Array.isArray(iterable) ? iterable : [iterable];\n    for await (const it of itera) {\n        for await (const v of it) {\n            if (buffer.includes(v))\n                continue;\n            buffer.push(v);\n            yield v;\n        }\n    }\n}\nexport async function* uniqueByValue(input, toString = toStringDefault, seen = new Set()) {\n    for await (const v of input) {\n        const key = toString(v);\n        if (seen.has(key))\n            continue;\n        seen.add(key);\n        yield v;\n    }\n}\n/**\n * Returns unique items from iterables, given a particular key function\n * ```js\n * unique([{i:0,v:2},{i:1,v:3},{i:2,v:2}], e => e.v);\n * Yields:  [{i:0,v:2},{i:1,v:3}]\n * @param it\n * @param f\n */\n// export async function* unique<V>(\n//   it: AsyncIterable<V>,\n//   f: (id: V) => V = (id) => id\n// ) {\n//   // https://surma.github.io/underdash/\n//   const buffer: Array<V> = [];\n//   for await (const v of it) {\n//     const fv = f(v);\n//     if (buffer.includes(fv)) continue;\n//     buffer.push(fv);\n//     yield v;\n//   }\n// }\n/**\n * Combine same-positioned items from several iterables\n * ```js\n * zip( [1, 2, 3], [4, 5, 6], [7, 8, 9] );\n * Yields: [ [1, 4, 7], [2, 5, 8], [3, 6, 9] ]\n * ```\n * @param its\n * @returns\n */\nexport async function* zip(...its) {\n    // https://surma.github.io/underdash/\n    const iits = its.map((it) => it[Symbol.asyncIterator]());\n    while (true) {\n        const vs = await Promise.all(iits.map((it) => it.next()));\n        if (vs.some((v) => v.done))\n            return;\n        yield vs.map((v) => v.value);\n    }\n}\n","import * as Async from \"../async.js\";\nimport { isAsyncIterable } from \"../index.js\";\nimport { sleep } from \"@ixfx/core\";\nexport function isGenFactoryNoInput(c) {\n    if (!(`_type` in c))\n        return false;\n    // eslint-disable-next-line @typescript-eslint/no-unsafe-member-access\n    if (c._type === `GenFactoryNoInput`)\n        return true;\n    return false;\n}\n/**\n * Wrap the primitive value as generator\n * @param value\n */\nfunction* primitiveToGenerator(value) {\n    yield value;\n}\n/**\n * Wrap the primitive value as an async generator\n * @param value\n */\nasync function* primitiveToAsyncGenerator(value) {\n    yield value;\n    await sleep(1);\n}\n/**\n * Resolve the array, data or function to a Generator\n * @param input\n * @returns\n */\nexport function resolveToGen(input) {\n    if (Array.isArray(input)) {\n        const a = input.values();\n        // eslint-disable-next-line @typescript-eslint/no-unsafe-member-access\n        a._name = `arrayInput`;\n        return a;\n    }\n    else if (typeof input === `number` || typeof input === `boolean` || typeof input === `string`) {\n        // Assumes V is primitive\n        return primitiveToGenerator(input);\n    }\n    else if (typeof input === `function`) {\n        return input();\n    }\n    return input;\n}\n/**\n * Resolve the data, primitive or function to an AsyncGenerator\n * @param input\n * @returns\n */\nexport function resolveToAsyncGen(input) {\n    if (input === undefined)\n        return;\n    if (Array.isArray(input)) {\n        return Async.fromArray(input);\n    }\n    else if (typeof input === `number` || typeof input === `boolean` || typeof input === `string`) {\n        // Assumes V is primitive\n        return primitiveToAsyncGenerator(input);\n    }\n    else if (typeof input === `function`) {\n        return input();\n    }\n    else if (isAsyncIterable(input)) {\n        return input;\n    }\n    return Async.fromIterable(input);\n}\n","export function resolveEl(elOrQuery) {\n    if (typeof elOrQuery === `string`) {\n        const el = document.querySelector(elOrQuery);\n        if (!el)\n            throw new Error(`Element not found '${elOrQuery}'`);\n        return el;\n    }\n    return elOrQuery;\n}\n","import { toStringDefault } from \"@ixfx/core\";\nimport { resolveToGen } from \"./utility.js\";\nimport { resolveEl } from \"../util/dom.js\";\nconst createMap = (key) => {\n    const keyFunction = key ?? ((value) => value);\n    const map = new Map();\n    return {\n        has(key) {\n            return map.has(keyFunction(key));\n        },\n        get(key) {\n            return map.get(keyFunction(key));\n        },\n        set(key, value) {\n            //console.log(`Chains.Dom.createMap: key: ${ keyFunction(key) } value: ${ value }`);\n            map.set(keyFunction(key), value);\n        },\n        entries() {\n            return map.entries();\n        },\n        delete(key) {\n            map.delete(key);\n        }\n    };\n};\n/**\n * Creates a HTML element per value. By default compares\n * values by `JSON.stringify`. Set `byReference:true` to\n * compare values based on reference. Or provide a toString\n * function via `key`.\n *\n * ```js\n * // Generate a random number between 0...4 every second\n * const looper = Generators.interval(() => Math.floor(Math.random()*5), 1000);\n *\n * // Make a chain\n * const ch = Chains.run(\n *  looper,\n *  Chains.Links.delay({before:1000}),\n *  Chains.Dom.perValue()\n * );\n *\n * setTimeout(async () => {\n *    for await (const v of ch) {\n *      const {el,value} = v;\n *      el.textContent = `${value} - ${Date.now().toString()}`;\n *    }\n *    console.log(`ch iteration done`);\n *  });\n * ```\n */\nexport function perValue(options = {}) {\n    const byReference = options.byReference;\n    const tagName = options.tagName ?? `div`;\n    if (byReference && options.key)\n        throw new Error(`byReference and key options are mutually exclusive`);\n    const keyFunction = byReference ? undefined : options.key ?? toStringDefault;\n    const map = createMap(keyFunction);\n    const parentElementOrQuery = options.parentEl ?? document.body;\n    const parentEl = resolveEl(parentElementOrQuery);\n    const usedElements = new Set();\n    async function* perValue(input) {\n        for await (const value of resolveToGen(input)) {\n            let el = map.get(value);\n            if (!el) {\n                el = document.createElement(tagName);\n                map.set(value, el);\n                if (options.beforeInsert)\n                    options.beforeInsert(el);\n                parentEl.append(el);\n                if (options.afterInsert)\n                    options.afterInsert(el);\n            }\n            usedElements.add(el);\n            yield { el, value };\n        }\n        // Remove unused elements\n        for (const [id, el] of map.entries()) {\n            if (usedElements.has(el))\n                continue;\n            if (options.beforeRemove)\n                options.beforeRemove(el);\n            el.remove();\n            map.delete(id);\n        }\n    }\n    perValue._name = `dom.perValue`;\n    return perValue;\n}\n//export type Link<In, Out> = (input: GenOrData<In>) => AsyncGenerator<Out>;\n/**\n * From an input stream of strings, yields an output of HTMLElememnts\n * @param options\n * @returns\n */\nexport function query(options = {}) {\n    const baseElement = options.baseElement ?? document;\n    async function* query(input) {\n        const gen = resolveToGen(input);\n        for await (const value of gen) {\n            for (const element of baseElement.querySelectorAll(value)) {\n                yield element;\n            }\n        }\n    }\n    query._name = `dom.query`;\n    return query;\n}\n","import { intervalToMs, sleep, elapsedSince } from \"@ixfx/core\";\nimport { integerTest, resultThrow } from \"@ixfx/guards\";\nimport { resolveToGen } from \"./utility.js\";\nimport * as BasicProcessors from \"@ixfx/process/basic\";\n/**\n * Transform values from one type to another. Just like a map function.\n * @param transformer\n * @returns\n */\nexport function transform(transformer) {\n    async function* transform(input) {\n        input = resolveToGen(input);\n        for await (const value of input) {\n            yield transformer(value);\n        }\n    }\n    transform._name = `transform`;\n    return transform;\n}\n/**\n * Take `limit` number of results from the stream, before closing\n * @param limit\n * @returns\n */\nexport function take(limit) {\n    async function* take(input) {\n        input = resolveToGen(input);\n        let yielded = 0;\n        for await (const value of input) {\n            if (++yielded > limit)\n                break;\n            yield value;\n        }\n    }\n    take._name = `take`;\n    return take;\n}\n/**\n * Takes an array of values, flattening to a single one\n * using the provided `reducer` function.\n *\n * ```js\n * // Create a chain that flattens values\n * const reduce = Chains.reduce(values => Math.max(...values));\n * // Feed it a single input (an array), get a single output back:\n * const result = await Chains.single(reduce, [ 1, 2, 3]); // 3\n * ```\n * @param reducer Function to reduce array of values to a single value\n * @returns\n */\nexport function reduce(reducer) {\n    async function* reduce(input) {\n        input = resolveToGen(input);\n        for await (const value of input) {\n            yield reducer(value);\n        }\n    }\n    reduce._name = `reduce`;\n    return reduce;\n}\n/**\n * Allow values through until a duration has elapsed. After\n * that, the chain stops.\n * @param elapsed\n * @returns\n */\nexport function duration(elapsed) {\n    const durationMs = intervalToMs(elapsed, 0);\n    async function* duration(input) {\n        input = resolveToGen(input);\n        const elapsed = elapsedSince();\n        for await (const value of input) {\n            if (elapsed() > durationMs)\n                break;\n            yield value;\n        }\n    }\n    duration._name = `duration`;\n    return duration;\n}\n/**\n * Add delay before/after values are emitted from the input stream.\n * @param options\n * @returns\n */\nexport function delay(options) {\n    const before = intervalToMs(options.before, 0);\n    const after = intervalToMs(options.after, 0);\n    async function* delay(input) {\n        input = resolveToGen(input);\n        for await (const value of input) {\n            if (before > 0) {\n                await sleep(before);\n            }\n            yield value;\n            if (after > 0) {\n                await sleep(after);\n            }\n        }\n    }\n    delay._name = `delay`;\n    return delay;\n}\n/**\n * Ensure a minimum length of time between values.\n * Values being produced too quickly are dropped.\n *\n * In the following example, only three values will be let through.\n * ```js\n * const chain = Chains.run(\n *  // Produce values every 10ms for 350ms\n *  Chains.From.timestamp({ interval: 10, elapsed: 350 }),\n *  // Only let a value through every 100ms\n *  Chains.Links.debounce(100)\n * );\n * ```\n * @param rate\n * @returns\n */\nexport function debounce(rate) {\n    const rateMs = intervalToMs(rate, 0);\n    async function* debounce(input) {\n        input = resolveToGen(input);\n        let elapsed = elapsedSince();\n        for await (const value of input) {\n            if (elapsed() < rateMs)\n                continue;\n            yield value;\n            elapsed = elapsedSince();\n        }\n    }\n    debounce._name = `debounce`;\n    return debounce;\n}\n/**\n * Returns a running tally of how many items have been\n * emitted from the input source.\n * ```js\n * const ch = Chains.run(\n *  Chains.From.timestamp({ interval: 100 }),\n *  Chains.Links.tally()\n * );\n *\n * for await (const v of ch) {\n *   // Produces: 1, 2, 3 ... every 100ms\n * }\n * ```\n * This is different than {@link sum} which adds up numeric values.\n * By default it adds up individual array items\n * @returns\n */\nexport function tally(countArrayItems = true) {\n    async function* tally(input) {\n        input = resolveToGen(input);\n        const p = BasicProcessors.tally(countArrayItems);\n        for await (const v of input) {\n            yield p(v);\n        }\n    }\n    tally._name = `tally`;\n    return tally;\n}\n/**\n * Returns the smallest value from the input.\n * Can work with numbers or number[] as input.\n * Non-numeric data is filtered out.\n * @returns\n */\nexport function min() {\n    async function* min(input) {\n        input = resolveToGen(input);\n        const p = BasicProcessors.min();\n        for await (const value of input) {\n            const x = p(value);\n            if (x === undefined)\n                continue;\n            yield x;\n        }\n    }\n    min._name = `min`;\n    return min;\n}\n/**\n * Returns the largest value from the input.\n * - Non-numeric data is filtered out.\n * - Looks inside of numeric arrays.\n * @returns\n */\nexport function max() {\n    async function* max(input) {\n        input = resolveToGen(input);\n        const p = BasicProcessors.max();\n        for await (const value of input) {\n            const x = p(value);\n            if (x === undefined)\n                continue;\n            yield x;\n        }\n    }\n    max._name = `max`;\n    return max;\n}\n// export function max(): Link<number | Array<number>, number> {\n//   async function* max(input: GenOrData<number | Array<number>>): AsyncGenerator<number> {\n//     input = resolveToGen(input);\n//     let max = Number.MIN_SAFE_INTEGER;\n//     for await (const value of input) {\n//       const valueArray = Array.isArray(value) ? value : [ value ];\n//       for (const subValue of valueArray) {\n//         if (typeof subValue !== `number`) break;\n//         max = Math.max(subValue, max);\n//         yield max;\n//       }\n//     }\n//   }\n//   max._name = `max`;\n//   return max;\n// }\n/**\n * Emits the currently ranked 'highest' value from a stream. Only\n * values exceeding the current highest are emitted.\n *\n * eg, if we are ranking on numerical value, an input stream of:\n * ```\n * 4, 1, 6, 10, 2, 4\n * ```\n *\n * Results in the output stream of:\n * ```\n * 4, 6, 10\n * ```\n *\n * @example\n * ```js\n * // Rank based on a field\n * Chains.Links.rank((a,b) => {\n *  if (a.size > b.size) return `a`; // Signals the first param is highest\n *  if (a.size < b.size) return `b`; // Signals the second param is highest\n *  return `eq`;\n * });\n * ```\n * @param options\n * @returns\n */\nexport function rank(r, options = {}) {\n    async function* rank(input) {\n        input = resolveToGen(input);\n        //let best: In | undefined;\n        const p = BasicProcessors.rank(r, options);\n        for await (const value of input) {\n            const x = p(value);\n            if (x === undefined)\n                continue;\n            yield x;\n        }\n    }\n    rank._name = `rank`;\n    return rank;\n}\n/**\n * Emits the highest-ranked value from amongst an array of values.\n *\n * By default, it tracks the highest-ranked _between_ arrays.\n *\n * For example:\n * ```js\n * // Input\n * [ [4,5,6], [1,2,3] ]\n * // Outputs:\n * [ 6 ]\n * ```\n *\n * This behaviour can be modified with an option to only compare _within_ arrays.\n * ```\n * // Input\n * [ [4,5,6], [1,2,3] ]\n * // Output:\n * [ 6, 3 ]\n * ```\n *\n * Uses the `rank` option to determine which is more highly ranked.\n * ```js\n * Chains.Links.rankArray(\n *  (a, b) => {\n *    if (a > b) return `a`; // a is higher\n *    else if (b > a) return `b`; // b is higher\n *    return `eq`; // same\n *  }\n * )\n * ```\n * @param options\n * @returns\n */\nexport function rankArray(r, options = {}) {\n    const includeType = options.includeType;\n    const emitEqualRanked = options.emitEqualRanked ?? false;\n    const emitRepeatHighest = options.emitRepeatHighest ?? false;\n    const withinArrays = options.withinArrays ?? false;\n    async function* rankArray(input) {\n        input = resolveToGen(input);\n        let best;\n        for await (const value of input) {\n            let emit = false;\n            if (withinArrays)\n                best = undefined; // Reset\n            for (const subValue of value) {\n                if (includeType && typeof subValue !== includeType)\n                    continue;\n                if (best === undefined) {\n                    best = subValue;\n                    emit = true;\n                }\n                else {\n                    const result = r(subValue, best);\n                    if (result == `a`) {\n                        // New value is the current best\n                        best = subValue;\n                        emit = true;\n                    }\n                    else if (result === `eq` && emitEqualRanked) {\n                        // New value is same rank as previous, but we have flag on\n                        emit = true;\n                    }\n                    else if (emitRepeatHighest) {\n                        // Emit current highest due to flag\n                        emit = true;\n                    }\n                }\n            }\n            if (emit && best)\n                yield best;\n        }\n    }\n    rankArray._name = `rankArray`;\n    return rankArray;\n}\n/**\n * Returns the average from the input.\n * Non-numeric values are filtered out.\n * @returns\n */\nexport function average() {\n    async function* average(input) {\n        input = resolveToGen(input);\n        const p = BasicProcessors.average();\n        for await (const value of input) {\n            const x = p(value);\n            if (x === undefined)\n                continue;\n            yield x;\n        }\n    }\n    average._name = `average`;\n    return average;\n}\n/**\n * Returns the total of the numeric values.\n * Non-numeric values are filtered out.\n * @returns\n */\nexport function sum() {\n    async function* total(input) {\n        input = resolveToGen(input);\n        const p = BasicProcessors.sum();\n        for await (const value of input) {\n            const x = p(value);\n            if (x === undefined)\n                continue;\n            yield x;\n        }\n    }\n    total._name = `total`;\n    return total;\n}\n/**\n * Chunks an input stream into `size` chunks.\n *\n * Eg, with a chunk size of 3, the input stream of:\n *  1, 2, 3, 4, 5, 6\n * Yields:\n *  [ 1, 2, 3 ], [ 4, 5, 6 ]\n *\n * If `returnRemainders` is _true_ (default), any left over values are returned even if\n * it's less than `size`.\n * @param size\n * @param returnRemainders If true (default) left over data that didn't make a full chunk is also returned\n * @returns\n */\nexport function chunk(size, returnRemainders = true) {\n    resultThrow(integerTest(size, `aboveZero`, `size`));\n    async function* chunk(input) {\n        input = resolveToGen(input);\n        let buffer = [];\n        for await (const value of input) {\n            buffer.push(value);\n            if (buffer.length >= size) {\n                yield buffer;\n                buffer = [];\n            }\n        }\n        if (returnRemainders && buffer.length > 0)\n            yield buffer;\n    }\n    chunk._name = `chunk`;\n    return chunk;\n}\n/**\n * Filters the input source, only allowing through\n * data for which `predicate` returns _true_\n *\n * {@link drop}, on the other hand excludes values for which predicate is _true_\n * @param predicate\n * @returns\n */\nexport function filter(predicate) {\n    async function* filter(input) {\n        input = resolveToGen(input);\n        for await (const value of input) {\n            if (predicate(value)) {\n                yield value;\n            }\n        }\n    }\n    filter._name = `filter`;\n    return filter;\n}\n/**\n * Drops all values from input stream for which `predicate` returns _true_\n *\n * {@link filter}, on the other hand includes values where the predicate is _true_\n * @param predicate\n * @returns\n */\nexport function drop(predicate) {\n    async function* drop(input) {\n        input = resolveToGen(input);\n        for await (const value of input) {\n            if (!predicate(value)) {\n                yield value;\n            }\n        }\n    }\n    drop._name = `drop`;\n    return drop;\n}\n","import { sleep } from \"@ixfx/core\";\n/**\n * Creates a chain from an array, reading values at a given interval\n * @param it\n * @param delay\n * @returns\n */\nexport function array(it, delay = 5) {\n    async function* fromArray() {\n        for (const v of it) {\n            await sleep(delay);\n            yield v;\n        }\n    }\n    fromArray._name = `fromArray`;\n    fromArray._type = `GenFactoryNoInput`;\n    return fromArray;\n}\n","import { promiseFromEvent } from \"@ixfx/core\";\n/**\n * Create an iterable from an event\n * @param target Event source (eg HTML element)\n * @param name Name of event (eg. 'pointermove')\n * @returns\n */\nexport function event(target, name) {\n    async function* event() {\n        // eslint-disable-next-line @typescript-eslint/no-unnecessary-condition\n        while (true) {\n            yield await promiseFromEvent(target, name);\n        }\n    }\n    event._name = `event`;\n    event._type = `GenFactoryNoInput`;\n    return event;\n}\n//https://stackoverflow.com/questions/51045136/how-can-i-use-a-event-emitter-as-an-async-generator\n","/**\n * Produce a value from a callback. When\n * the callback returns _undefined_ it is considered done.\n *\n * ```js\n * const callback = () => Math.random();\n *\n * const f = Chains.From.func(callback);\n * for await (const v of f) {\n *  // v is a new random number\n * }\n * ```\n *\n * In the context of a chain:\n * ```js\n * let produced = 0;\n * const chain = Chains.chain<number, string>(\n *  // Produce incrementing numbers\n *  Chains.From.func(() => produced++),\n *  // Convert to `x:0`, `x:1` ...\n *  Chains.transform(v => `x:${ v }`),\n *  // Take first 5 results\n *  Chains.cap(5)\n * );\n * const data = await Chains.asArray(chain);\n * ```\n * @param callback\n * @returns\n */\nexport function func(callback) {\n    async function* fromFunction() {\n        // eslint-disable-next-line @typescript-eslint/no-unnecessary-condition\n        while (true) {\n            const v = await callback();\n            if (typeof v === `undefined`)\n                break;\n            yield v;\n        }\n    }\n    fromFunction._name = `fromFunction`;\n    fromFunction._type = `GenFactoryNoInput`;\n    return fromFunction;\n}\n","/**\n * Creates a chain from an interable\n * @param it\n * @returns\n */\nexport function iterable(it) {\n    async function* fromIterable() {\n        for await (const v of it) {\n            yield v;\n        }\n    }\n    fromIterable._name = `fromIterable`;\n    fromIterable._type = `GenFactoryNoInput`;\n    return fromIterable;\n}\n","import { elapsedSince, intervalToMs, sleep } from \"@ixfx/core\";\n/**\n * Generate timestamp values at `interval` rate. By default it runs forever.\n * Use `loops` or `elapsed` to set upper limit on how long it should run.\n *\n * ```js\n * const c = Chains.From.timestamp({ interval: 1000 });\n * ```\n * Options:\n * - `asClockTime`: If _true_, yielded value will be clock time rather than elapsed milliseconds\n * @param options\n * @returns\n */\nexport function timestamp(options) {\n    const intervalMs = intervalToMs(options.interval, 0);\n    const asClockTime = options.asClockTime ?? false;\n    const loops = options.loops ?? Number.MAX_SAFE_INTEGER;\n    let looped = 0;\n    const durationTime = intervalToMs(options.elapsed, Number.MAX_SAFE_INTEGER);\n    async function* ts() {\n        const elapsed = elapsedSince();\n        while (looped < loops && elapsed() < durationTime) {\n            yield asClockTime ? Date.now() : elapsed();\n            // Adjust sleep period so timing errors don't accumulate\n            const expectedTimeDiff = (looped * intervalMs) - elapsed();\n            await sleep(Math.max(0, intervalMs + expectedTimeDiff));\n            looped++;\n        }\n    }\n    ts._name = `timestamp`;\n    ts._type = `GenFactoryNoInput`;\n    return ts;\n}\n","export * from './array.js';\nexport * from './event.js';\nexport * from './function.js';\nexport * from './iterable.js';\nexport * from './ticks.js';\n","/**\n * Adds values to the provided array as they are produced,\n * mutating array.\n *\n * ```js\n * const data = [];\n * addToArray(data, tick({ interval: 1000, loops: 5 }));\n * // Execution continues immediately, with `data` mutated over time\n * ```\n * @param valueToWrap\n * @param array\n */\nexport async function addToArray(array, valueToWrap) {\n    const outputType = (typeof valueToWrap === `function`) ? valueToWrap() : valueToWrap;\n    for await (const value of outputType) {\n        array.push(value);\n    }\n}\n","import { toArray as AsyncToArray } from \"../async.js\";\n/**\n * Async function that returns the chain as an array of values\n * ```js\n * const values = await asArray(tick( { interval: 1000, loops: 5 }));\n * // After 5 seconds, values will be a set of timestamps.\n * ```\n *\n * If the chain is infinite, be sure to specify limits:\n * ```js\n * // Stop after we have five items\n * const values = await asArray(chain, { limit: 5 });\n * // Stop after 5 seconds has elapsed\n * const values = await asArray(chain, { elapsed: 5000 });\n * ```\n * @param valueToWrap\n * @returns\n */\nexport async function asArray(valueToWrap, options = {}) {\n    const outputType = (typeof valueToWrap === `function`) ? valueToWrap() : valueToWrap;\n    return AsyncToArray(outputType, options);\n}\n","/**\n * Calls `callback` whenever the chain/generator produces a value.\n *\n * When using `asCallback`, call it with `await` to let generator\n * run its course before continuing:\n * ```js\n * await asCallback(tick({ interval:1000, loops:5 }), x => {\n *  // Gets called 5 times, with 1000ms interval\n * });\n * console.log(`Hi`); // Prints after 5 seconds\n * ```\n *\n * Or if you skip the `await`, code continues and callback will still run:\n * ```js\n * asCallback(tick({ interval: 1000, loops: 5}), x => {\n *  // Gets called 5 times, with 1000ms interval\n * });\n * console.log(`Hi`); // Prints immediately\n * ```\n * @param valueToWrap\n * @param callback\n */\nexport async function asCallback(valueToWrap, callback, onDone) {\n    const outputType = (typeof valueToWrap === `function`) ? valueToWrap() : valueToWrap;\n    for await (const value of outputType) {\n        callback(value);\n    }\n    if (onDone)\n        onDone();\n}\n","/**\n * Treats the chain/generator as a promise\n *\n * ```js\n * const ticker = asPromise(tick({ interval: 1000 }));\n * const x = await ticker(); //  Waits for 1000ms before giving a value\n * ```\n *\n * This will only ever return one value. To return multiple values, it's necessary\n * to call `asPromise` and `await` the result in a loop.\n * @param valueToWrap\n * @returns\n */\nexport function asPromise(valueToWrap) {\n    let lastValue;\n    const outputType = (typeof valueToWrap === `function`) ? valueToWrap() : valueToWrap;\n    async function asPromise() {\n        const v = await outputType.next();\n        if (v.done)\n            return;\n        lastValue = v.value;\n        return lastValue;\n    }\n    return asPromise;\n}\n","/**\n * Returns the most recent value from the chain/generator, or\n * `initialValue` (defaulting to _undefined_) if no value\n * has been emitted yet.\n *\n * ```js\n * const ticker = asValue(tick({ interval: 1000 }));\n * x = ticker(); // Get the most recent value\n * ```\n *\n * Every time it's called, it fetches a new value from the generator, assuming\n * it isn't already awaiting a result.\n *\n * In the meantime, the last value (or `initialValue`) is returned.\n * @param valueToWrap Value to wrap\n * @param initialValue Initial value\n * @returns\n */\nexport function asValue(valueToWrap, initialValue) {\n    let lastValue = initialValue;\n    let awaiting = false;\n    const outputType = (typeof valueToWrap === `function`) ? valueToWrap() : valueToWrap;\n    function asValue() {\n        if (!awaiting) {\n            awaiting = true;\n            outputType.next().then(v => {\n                // eslint-disable-next-line @typescript-eslint/no-unsafe-assignment\n                lastValue = v.value;\n                awaiting = false;\n            }).catch((error) => {\n                awaiting = false;\n                throw error;\n            });\n        }\n        return lastValue;\n    }\n    return asValue;\n}\n","import { isEqual } from \"@ixfx/arrays\";\nimport { resolveToGen } from \"./utility.js\";\n/**\n * Monitors sources, storing as they happen to an array.\n * Whenever a new value is emitted, the whole array is sent out, containing current\n * values from each source, or _undefined_ if not yet emitted.\n *\n * The tempo of this stream will be set by the fastest source stream.\n * See {@link syncToArray} to have pace determined by slowest source, and only\n * send when each source has produce a new value compared to last time.\n *\n * Set `onSourceDone` to choose behaviour if a source stops. The default is\n * 'break', meaning the whole combined stream stops.\n *\n * If a source completes and onSourceDone = 'allow', the option\n * 'finalValue' sets the logic for what values get returned for the source.\n * By default the setting is 'undefined', thus _undefined_ results. 'last' will be the last (old) value\n * from that source.\n */\nexport async function* combineLatestToArray(sources, options = {}) {\n    const onSourceDone = options.onSourceDone ?? `break`;\n    const finalValue = options.finalValue ?? `undefined`;\n    const afterEmit = options.afterEmit ?? `last`;\n    const inputs = sources.map((source, index) => ({ waiting: undefined, index, gen: resolveToGen(source), done: false, lastValue: undefined }));\n    const isDone = () => !inputs.some(v => !v.done);\n    const isWaiting = () => inputs.some(v => v.waiting !== undefined);\n    const allEmpty = (d) => !d.some(v => v !== undefined);\n    let lastEmitted = [];\n    // eslint-disable-next-line @typescript-eslint/no-unnecessary-condition\n    while (true) {\n        const promises = [];\n        for (const input of inputs) {\n            //console.log(`  ${ input.index } done: ${ input.done } waiting: ${ input.waiting !== undefined } last: ${ input.lastValue }`);\n            if (input.done)\n                continue;\n            if (input.waiting !== undefined) {\n                promises.push(input.waiting);\n                continue;\n            }\n            const p = Promise.resolve((async () => {\n                if (input.done)\n                    return input;\n                const v = await input.gen.next();\n                input.waiting = undefined;\n                if (v.done) {\n                    input.done = true;\n                    if (finalValue === `undefined`)\n                        input.lastValue = undefined;\n                }\n                else {\n                    // eslint-disable-next-line @typescript-eslint/no-unsafe-assignment\n                    input.lastValue = v.value;\n                }\n                return input;\n            })());\n            input.waiting = p;\n            promises.push(p);\n        }\n        // eslint-disable-next-line @typescript-eslint/no-unsafe-assignment\n        const won = await Promise.race(promises);\n        if (`done` in won) {\n            // eslint-disable-next-line @typescript-eslint/no-unsafe-member-access\n            if (won.done && onSourceDone === `break`)\n                break;\n        }\n        else {\n            throw new Error(`Missing 'done' property`);\n        }\n        // eslint-disable-next-line @typescript-eslint/no-unsafe-return\n        const d = inputs.map(v => v.lastValue);\n        if (d.length === 0) {\n            return;\n        }\n        const dataEmpty = allEmpty(d);\n        if (dataEmpty && !isWaiting()) {\n            return;\n        }\n        if (!isEqual(lastEmitted, d) && !dataEmpty) {\n            lastEmitted = d;\n            yield d;\n        }\n        if (afterEmit === `undefined`) {\n            for (const input of inputs) {\n                if (input.waiting !== undefined)\n                    continue;\n                input.lastValue = undefined;\n            }\n        }\n        if (isDone()) {\n            break;\n        }\n    }\n}\n","import { isEqualValueIgnoreOrder } from \"@ixfx/core\";\nimport { resolveToGen } from \"./utility.js\";\nimport * as MapFns from \"@ixfx/core/maps\";\n/**\n * Monitors sources, storing as they happen to an object.\n * Whenever a new value is emitted, the object is sent out, containing current\n * values from each source, or _undefined_ if not yet emitted.\n *\n * The tempo of this stream will be set by the fastest source stream.\n * See {@link syncToObject} to have pace determined by slowest source, and only\n * send when each source has produce a new value compared to last time.\n *\n * Set `onSourceDone` to choose behaviour if a source stops. By default it\n * is 'break', meaning the whole merged stream stops.\n *\n * If a source completes and onSourceDone = 'allow', the option\n * 'finalValue' sets the logic for what values get returned for the source.\n * By default the setting is 'undefined', thus _undefined_ results. 'last' will be the last (old) value\n * from that source.\n */\nexport async function* combineLatestToObject(sources, options = {}) {\n    const onSourceDone = options.onSourceDone ?? `break`;\n    const finalValue = options.finalValue ?? `undefined`;\n    const afterEmit = options.afterEmit ?? `last`;\n    const states = new Map();\n    for (const [key, value] of Object.entries(sources)) {\n        states.set(key, {\n            gen: resolveToGen(value),\n            done: false,\n            lastValue: undefined,\n            waiting: undefined,\n            key\n        });\n    }\n    const isDone = () => !MapFns.some(states, v => !v.done);\n    const isWaiting = () => MapFns.some(states, v => v.waiting !== undefined);\n    const allEmpty = (d) => {\n        for (const v of Object.values(d)) {\n            if (v !== undefined)\n                return false;\n        }\n        return true;\n    };\n    const getData = () => {\n        const r = {};\n        for (const [key, state] of states) {\n            // eslint-disable-next-line @typescript-eslint/no-unsafe-assignment, @typescript-eslint/no-unsafe-member-access\n            r[key] = state.lastValue;\n        }\n        return r;\n    };\n    let lastEmitted;\n    // eslint-disable-next-line @typescript-eslint/no-unnecessary-condition\n    while (true) {\n        const promises = [];\n        for (const input of states.values()) {\n            //console.log(`  ${ input.key } done: ${ input.done } waiting: ${ input.waiting !== undefined } last: ${ input.lastValue }`);\n            if (input.done)\n                continue;\n            if (input.waiting !== undefined) {\n                promises.push(input.waiting);\n                continue;\n            }\n            const p = Promise.resolve((async () => {\n                if (input.done)\n                    return input;\n                const v = await input.gen.next();\n                input.waiting = undefined;\n                if (v.done) {\n                    input.done = true;\n                    if (finalValue === `undefined`)\n                        input.lastValue = undefined;\n                }\n                else {\n                    // eslint-disable-next-line @typescript-eslint/no-unsafe-assignment\n                    input.lastValue = v.value;\n                }\n                return input;\n            })());\n            input.waiting = p;\n            promises.push(p);\n        }\n        // eslint-disable-next-line @typescript-eslint/no-unsafe-assignment\n        const won = await Promise.race(promises);\n        if (`done` in won) {\n            // eslint-disable-next-line @typescript-eslint/no-unsafe-member-access\n            if (won.done && onSourceDone === `break`)\n                break;\n        }\n        else {\n            throw new Error(`Result missing 'done' property`);\n        }\n        const d = getData();\n        //console.log(`d`, d);\n        // if (isEqualValueIgnoreOrder(d, {} as any)) {\n        //   console.log(`keys is empty`);\n        //   return;\n        // }\n        const dataEmpty = allEmpty(d);\n        if (dataEmpty && !isWaiting()) {\n            //console.log(`dataEmpty and not waiting`);\n            return;\n        }\n        if (!isEqualValueIgnoreOrder(lastEmitted, d) && !dataEmpty) {\n            //console.log(` -- emitting!`);\n            lastEmitted = d;\n            yield d;\n        }\n        if (afterEmit === `undefined`) {\n            for (const input of states.values()) {\n                if (input.waiting !== undefined)\n                    continue;\n                input.lastValue = undefined;\n            }\n        }\n        if (isDone()) {\n            break;\n        }\n    }\n}\n","import { func as fromFunction } from \"./from/function.js\";\nimport { isGenFactoryNoInput, resolveToAsyncGen } from \"./utility.js\";\nimport * as L from './links.js';\nimport { Async } from \"../index.js\";\nconst getLinkName = (c) => {\n    //return c._name;\n    return c._name ?? c.name;\n};\nexport function lazy() {\n    const chained = [];\n    let dataToUse;\n    const asGenerator = (data) => {\n        if (data === undefined)\n            data = dataToUse;\n        let d = resolveToAsyncGen(data);\n        for (const c of chained) {\n            if (d === undefined) {\n                if (isGenFactoryNoInput(c)) {\n                    d = c();\n                }\n                else {\n                    throw new Error(`Function '${getLinkName(c)}' requires input. Provide it to the function, or call 'input' earlier.`);\n                }\n            }\n            else {\n                d = c(d);\n            }\n        }\n        return d;\n    };\n    const w = {\n        rankArray: (r, options) => {\n            chained.push(L.rankArray(r, options));\n            return w;\n        },\n        rank: (r, options) => {\n            chained.push(L.rank(r, options));\n            return w;\n        },\n        transform: (transformer) => {\n            chained.push(L.transform(transformer));\n            return w;\n        },\n        reduce: (reducer) => {\n            chained.push(L.reduce(reducer));\n            return w;\n        },\n        drop: (predicate) => {\n            chained.push(L.drop(predicate));\n            return w;\n        },\n        delay: (options) => {\n            chained.push(L.delay(options));\n            return w;\n        },\n        duration: (elapsed) => {\n            chained.push(L.duration(elapsed));\n            return w;\n        },\n        debounce: (rate) => {\n            chained.push(L.debounce(rate));\n            return w;\n        },\n        fromFunction: (callback) => {\n            chained.push(fromFunction(callback));\n            return w;\n        },\n        take: (limit) => {\n            chained.push(L.take(limit));\n            return w;\n        },\n        chunk: (size, returnRemainders = true) => {\n            chained.push(L.chunk(size, returnRemainders));\n            return w;\n        },\n        filter: (predicate) => {\n            chained.push(L.filter(v => predicate(v)));\n            return w;\n        },\n        min: () => {\n            chained.push(L.min());\n            return w;\n        },\n        max: () => {\n            chained.push(L.max());\n            return w;\n        },\n        average: () => {\n            chained.push(L.average());\n            return w;\n        },\n        sum: () => {\n            chained.push(L.sum());\n            return w;\n        },\n        tally: (countArrayItems) => {\n            chained.push(L.tally(countArrayItems));\n            return w;\n        },\n        input(data) {\n            dataToUse = data;\n            return w;\n        },\n        asGenerator,\n        asAsync(data) {\n            let d = data ?? dataToUse;\n            for (const c of chained) {\n                if (d === undefined && isGenFactoryNoInput(c)) {\n                    d = c();\n                }\n                else if (d === undefined) {\n                    throw new Error(`Function '${getLinkName(c)}' needs input. Pass in data calling 'asAsync', or call 'input' earlier`);\n                }\n                else {\n                    d = c(d);\n                }\n            }\n            return w;\n        },\n        asArray: async (data) => {\n            const g = asGenerator(data);\n            return await Async.toArray(g);\n        },\n        firstOutput: async (data) => {\n            const g = asGenerator(data);\n            const v = await g.next();\n            return v.value;\n        },\n        lastOutput: async (data) => {\n            const g = asGenerator(data);\n            let lastValue;\n            for await (const v of g) {\n                lastValue = v;\n            }\n            return lastValue;\n        },\n    };\n    return w;\n}\n","export class QueueMutable {\n    #store = [];\n    enqueue(data) {\n        this.#store.push(data);\n    }\n    dequeue() {\n        return this.#store.shift();\n    }\n}\n","import { sleep } from \"@ixfx/core\";\nimport { QueueMutable } from \"../util/queueMutable.js\";\nimport { resolveToAsyncGen } from \"./utility.js\";\n/**\n * Merge values from several sources into one stream, interleaving values.\n * When all streams are complete it finishes.\n *\n * Alternatively:\n * - {@link combineLatestToArray}/{@link combineLatestToObject} emits snapshots of all the generators, as quickly as the fastest one\n * - {@link syncToArray}/{@link syncToObject} which releases a set of results when all inputs have emitted a value\n * @param sources\n */\nexport async function* mergeFlat(...sources) {\n    const sourcesInput = sources.map(source => resolveToAsyncGen(source));\n    const buffer = new QueueMutable();\n    let completed = 0;\n    const schedule = async (source) => {\n        if (source === undefined) {\n            completed++;\n            return;\n        }\n        const x = await source.next();\n        if (x.done) {\n            completed++;\n        }\n        else {\n            buffer.enqueue(x.value);\n            // eslint-disable-next-line @typescript-eslint/no-misused-promises\n            setTimeout(() => schedule(source), 1);\n        }\n    };\n    for (const source of sourcesInput) {\n        // eslint-disable-next-line @typescript-eslint/no-misused-promises\n        setTimeout(() => schedule(source), 1);\n    }\n    const loopSpeed = 10;\n    let loopFactor = 1;\n    while (completed < sourcesInput.length) {\n        const d = buffer.dequeue();\n        if (d === undefined) {\n            // Grow loop factor up to 10\n            loopFactor = Math.min(loopFactor + 1, 10);\n        }\n        else {\n            yield d;\n            // Reset loop factor\n            loopFactor = 1;\n        }\n        await sleep(loopSpeed * loopFactor);\n    }\n}\n","import { resolveToGen } from \"./utility.js\";\n/**\n * Chain functions together. First argument is the source.\n * `runN` takes any number of chain functions. Use {@link run} if\n * possible, because it has improved type hinting.\n *\n * @example Process an array of strings. Transforming into\n * integers, and then filtering only even numbers.\n * ```js\n * const ch = Chains.runN(\n *  [ `1`, `2`, `3`, `4`, `5`, `6`, `7`, `8`, `9`, `10` ],\n *  Chains.transform<string, number>(v => Number.parseInt(v)),\n *  Chains.filter(v => v % 2 === 0)\n *);\n * const output = await Async.toArray(ch2);\n * // [ 2, 4, 6, 8, 10 ]\n * ```\n *\n * @example Grab the x/y coordinate from pointermove\n * ```js\n * const c1 = Chains.run(\n *  Chains.fromEvent(window, `pointermove`),\n *  Chains.Links.transform(event => ({ x: event.x, y: event.y }))\n * );\n *\n * // Eg: print out data as it comes in\n * Iterables.forEach(c1, coord => {\n *   console.log(coord);\n * });\n * // Execution continues immediately\n * ```\n * @param functions\n * @returns\n */\nexport async function* runN(...functions) {\n    let input;\n    for (const fnOrData of functions) {\n        input = typeof fnOrData === `function` ? fnOrData(input ?? []) : resolveToGen(fnOrData);\n    }\n    if (input === undefined)\n        return;\n    for await (const v of input) {\n        yield v;\n    }\n}\n/**\n * Chain functions together. First argument is the source.\n * Use {@link runN} if you want to chain more links than is possible here,\n * at the cost of poorer type hinting.\n *\n * @example Process an array of strings. Transforming into\n * integers, and then filtering only even numbers.\n * ```js\n * const ch = Chains.run(\n *  [ `1`, `2`, `3`, `4`, `5`, `6`, `7`, `8`, `9`, `10` ],\n *  Chains.transform(v => Number.parseInt(v)),\n *  Chains.filter(v => v % 2 === 0)\n *);\n * const output = await Async.toArray(ch2);\n * // [ 2, 4, 6, 8, 10 ]\n * ```\n *\n * @example Grab the x/y coordinate from pointermove\n * ```js\n * const c1 = Chains.run(\n *  Chains.fromEvent(window, `pointermove`),\n *  Chains.Links.transform(event => ({ x: event.x, y: event.y }))\n * );\n *\n * // Eg: print out data as it comes in\n * Iterables.forEach(c1, coord => {\n *   console.log(coord);\n * });\n * // Execution continues immediately\n * ```\n * @param gen\n * @param l0\n * @param l1\n * @param l2\n * @param l3\n * @returns\n */\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\nexport async function* run(gen, l0, l1, l2, l3, l4, l5) {\n    let input;\n    // eslint-disable-next-line prefer-rest-params\n    const functions = arguments;\n    for (const fnOrData of functions) {\n        if (typeof fnOrData === `function`) {\n            // eslint-disable-next-line @typescript-eslint/no-unsafe-call, @typescript-eslint/no-unsafe-assignment\n            input = fnOrData(input ?? []);\n        }\n        else {\n            // eslint-disable-next-line @typescript-eslint/no-unsafe-argument\n            input = resolveToGen(fnOrData);\n        }\n    }\n    if (input === undefined)\n        return;\n    for await (const v of input) {\n        yield v;\n    }\n}\n","import { runN } from \"./run.js\";\n/**\n * Prepare a chain, allowing you to provide a source at execution time.\n * ```js\n * const chain = Chains.prepare(\n *  Chains.transform<string,number>( v => Number.parseInt(v) ),\n *  Chains.filter<number>(v => v % 2 === 0)\n * );\n *\n * // Run it with provided source\n * for await (const v of chain([`1`, `2`, `3`])) {\n *\n * }\n * ```\n * @param functions\n * @returns\n */\nexport function prepare(...functions) {\n    const r = (source) => {\n        return runN(source, ...functions);\n    };\n    return r;\n}\n// const chain = combine(\n//   Chains.Links.transform(v => Number.parseInt(v)),\n//   Chains.Links.filter(v => v % 2 === 0)\n// );\n// const read = chain(Chains.From.array([ 1, 2, 3 ], 100));\n","/**\n * Input a single value to the chain, return a single result\n *\n *\n * ```js\n * // Create chain link\n * const f = Chains.Links.flatten<string, string>(data => data.join(`-`));\n * // Input a single value (an array)\n * const r1 = await Chains.single(f, [ `a`, `b`, `c` ]);\n * // r1 = `a-b-c`\n * ```\n * @param f\n * @param input\n * @returns\n */\nexport async function single(f, input) {\n    const iterator = await f([input]).next();\n    return iterator.value;\n}\n","import { intervalToMs } from \"@ixfx/core\";\nimport * as Async from \"../async.js\";\nimport { resolveToGen } from \"./utility.js\";\n// export function syncToObject<const T extends Record<string, GenOrData<any>>>(reactiveSources: T, options: Partial<SyncOptions> = {}): AsyncGenerator<GenValueTypeObject<T>> {\n//   const keys = Object.keys(reactiveSources)\n//   const values = Object.values(reactiveSources);\n//   const s = syncToArray(values, options);\n//   const st = transform(s, (streamValues) => {\n//     return zipKeyValue(keys, streamValues);\n//   });\n//   return st as AsyncGenerator<GenValueTypeObject<T>>;\n// }\n/**\n * Waits for all sources to produce a value, sending the combined results as an array.\n * After sending, it waits again for each source to send at least one value.\n *\n * Use {@link syncToObject} to output objects based on labelled sources rather than an array of values.\n *\n * Pace will be set by the slowest source. Alternatively, use {@link combineLatestToArray} where the rate is determined by fastest source.\n *\n * Only complete results are sent. For example if source A & B finish and\n * source C is still producing values, synchronisation is not possible\n * because A & B stopped producing values. Thus the stream will terminate\n * after `maximumWait` (2 seconds). Newer values from C are lost.\n */\nexport async function* syncToArray(sources, options = {}) {\n    const onSourceDone = options.onSourceDone ?? `break`;\n    //const ac = new AbortController();\n    const maximumWaitMs = intervalToMs(options.maximumWait, 2000);\n    const finalValue = options.finalValue ?? `undefined`;\n    const inputs = sources.map(source => ({ seq: 0, lastValue: undefined, gen: resolveToGen(source), done: false }));\n    const nextWithTimeoutOpts = {\n        millis: maximumWaitMs\n    };\n    let seq = 0;\n    const isAllDone = () => !inputs.some(v => !v.done);\n    let go = true;\n    while (go) {\n        seq++;\n        for (const input of inputs) {\n            if (input.done) {\n                input.seq = seq;\n                continue;\n            }\n            // Read source, with a timeout\n            const v = await Async.nextWithTimeout(input.gen, nextWithTimeoutOpts);\n            // Input has finished\n            if (v.done) {\n                input.done = true;\n                input.seq = seq;\n                if (finalValue === `undefined`) {\n                    input.lastValue = undefined;\n                }\n                if (onSourceDone === `break`) {\n                    return;\n                }\n            }\n            else {\n                // Stash away value\n                // eslint-disable-next-line @typescript-eslint/no-unsafe-assignment\n                input.lastValue = v.value;\n                input.seq = seq;\n            }\n        }\n        // eslint-disable-next-line @typescript-eslint/no-unnecessary-condition\n        if (go) {\n            // Return the set of data\n            const d = inputs.filter(v => v.seq === seq).map(v => v.lastValue);\n            if (d.length === 0)\n                return;\n            if (!d.some(v => typeof v !== `undefined`))\n                return;\n            yield d;\n        }\n        if (isAllDone())\n            go = false;\n    }\n    // let somethingProduced = true;\n    // while (somethingProduced) {\n    //   let data = [];\n    //   for (let index = 0; index < sourcesInput.length; index++) {\n    //     // eslint-disable-next-line unicorn/no-null\n    //     data[ index ] = null;\n    //   }\n    //   somethingProduced = false;\n    //   // Request the next value from each source\n    //   for (const [ index, source ] of sourcesInput.entries()) {\n    //     const v = await source.next();\n    //     if (!v.done) {\n    //       data[ index ] = v.value;\n    //       somethingProduced = true;\n    //     }\n    //   }\n    //   if (somethingProduced) {\n    //     // Send data\n    //     yield data;\n    //     data = [];\n    //   }\n    // }\n}\n","export * as Dom from './dom.js';\nexport * as Links from './links.js';\nexport * as From from './from/index.js';\nexport * from './add-to-array.js';\nexport * from './as-array.js';\nexport * from './as-callback.js';\nexport * from './as-promise.js';\nexport * from './as-value.js';\nexport * from './combine-latest-to-array.js';\nexport * from './combine-latest-to-object.js';\nexport * from './lazy.js';\nexport * from './merge-flat.js';\nexport * from './prepare.js';\nexport * from './run.js';\nexport * from './single.js';\nexport * from './sync.js';\nexport * from './types.js';\nexport * from './utility.js';\n","import { compareIterableValuesShallow, isEqualDefault } from \"@ixfx/core\";\n/**\n * Returns the 'max' of some iterable using the provided scoring function.\n * It only yields a value when iterator finishes.\n * @param iterable\n * @param scorer\n * @returns\n */\nexport const maxScore = (iterable, scorer) => {\n    let highestValue;\n    let highestScore = Number.MIN_SAFE_INTEGER;\n    for (const value of iterable) {\n        const score = scorer(value);\n        if (score >= highestScore) {\n            highestScore = score;\n            highestValue = value;\n        }\n    }\n    return highestValue;\n};\n/**\n * Returns the 'min' of some iterable using the provided scoring function.\n * It only yields a value when iterator finishes.\n * @param iterable\n * @param scorer\n * @returns\n */\nexport const minScore = (iterable, scorer) => {\n    let lowestValue;\n    let lowestScore = Number.MAX_SAFE_INTEGER;\n    for (const value of iterable) {\n        const score = scorer(value);\n        if (score <= lowestScore) {\n            lowestScore = score;\n            lowestValue = value;\n        }\n    }\n    return lowestValue;\n};\n/**\n * Returns _true_ if all values in iterables are equal, regardless\n * of their position. Uses === equality semantics by default.\n *\n * Is NOT recursive.\n *\n * @example Default equality checking\n * ```js\n * const a = ['apples','oranges','pears'];\n * const b = ['pears','oranges','apples'];\n * hasEqualValuesShallow(a, b); // True\n * ```\n *\n * @example Custom equality checking\n * ```js\n * const a = [ { name: 'John' }];\n * const b = [ { name: 'John' }];\n * // False, since object identies are different\n * hasEqualValuesShallow(a, b);\n * // True, since now we're comparing by value\n * hasEqualValuesShallow(a, b, (aa,bb) => aa.name === bb.name);\n * ```\n * @param iterableA First iterable to check\n * @param iterableB Iterable to compare against\n * @param eq Equality function, uses === by default\n */\nexport const hasEqualValuesShallow = (iterableA, iterableB, eq) => {\n    const returnValue = compareIterableValuesShallow(iterableA, iterableB, eq);\n    return returnValue.a.length === 0 && returnValue.b.length === 0;\n};\n","import { intervalToMs } from \"@ixfx/core\";\nimport { continuously } from \"@ixfx/core/continuously\";\n/**\n * Retrieve values from an iterator, passing them to a callback.\n * Allows iterator to be started, paused, or restarted and an optional delay between reading items from iterator.\n * @param options\n * @returns\n */\nexport const iteratorController = (options) => {\n    const delayMs = intervalToMs(options.delay, 10);\n    let gen;\n    const onValue = options.onValue;\n    let state = `stopped`;\n    const loop = continuously(async () => {\n        if (gen) {\n            const r = await gen.next();\n            if (r.done) {\n                state = `stopped`;\n                return false;\n            }\n            const r2 = onValue(r.value);\n            if (typeof r2 === `boolean`) {\n                if (!r2) {\n                    state = `stopped`;\n                }\n                return r2;\n            }\n            return true;\n        }\n        else {\n            state = `stopped`;\n            return false;\n        }\n    }, delayMs);\n    const cancel = () => {\n        if (state === `stopped`)\n            return;\n        gen = undefined;\n        loop.cancel();\n        state = `stopped`;\n    };\n    const pause = () => {\n        if (state === `paused`)\n            return;\n        loop.cancel();\n        state = `paused`;\n    };\n    const start = () => {\n        if (state === `running`)\n            return;\n        if (!gen) {\n            remake();\n        }\n        state = `running`;\n        loop.start();\n    };\n    const remake = () => {\n        if (options.iterator) {\n            gen = options.iterator();\n        }\n        else {\n            throw new Error(`No source iterator`);\n        }\n    };\n    const restart = () => {\n        remake();\n        start();\n    };\n    return {\n        start, cancel, restart, pause,\n        get state() {\n            return state;\n        }\n    };\n};\n","export const fromEvent = (eventSource, eventType) => {\n    const pullQueue = [];\n    const pushQueue = [];\n    let done = false;\n    const pushValue = (args) => {\n        if (pullQueue.length > 0) {\n            //eslint-disable-next-line @typescript-eslint/no-unsafe-assignment\n            const resolver = pullQueue.shift();\n            // eslint-disable-next-line @typescript-eslint/no-unsafe-call\n            resolver(...args);\n        }\n        else {\n            pushQueue.push(args);\n        }\n    };\n    const pullValue = () => new Promise((resolve) => {\n        if (pushQueue.length > 0) {\n            // eslint-disable-next-line @typescript-eslint/no-unsafe-assignment\n            const arguments_ = pushQueue.shift();\n            // @ts-expect-error\n            resolve(...arguments_);\n        }\n        else {\n            pullQueue.push(resolve);\n        }\n    });\n    const handler = (...arguments_) => {\n        pushValue(arguments_);\n    };\n    eventSource.addEventListener(eventType, handler);\n    const r = {\n        next: async () => {\n            if (done)\n                return { done: true, value: undefined };\n            return {\n                done: false,\n                value: await pullValue(),\n            };\n        },\n        //eslint-disable-next-line @typescript-eslint/require-await\n        return: async () => {\n            done = true;\n            eventSource.removeEventListener(eventType, handler);\n            return { done: true, value: undefined };\n        },\n        //eslint-disable-next-line @typescript-eslint/require-await\n        throw: async (error) => {\n            done = true;\n            return {\n                done: true,\n                value: Promise.reject(new Error(error)),\n            };\n        },\n    };\n    return r;\n};\n","import { numberArrayCompute } from \"@ixfx/numbers\";\nimport { isIterable } from \"./guard.js\";\n/**\n * Returns the min, max, avg and total of the array or iterable.\n * Any values that are invalid are silently skipped over.\n *\n * ```js\n * const v = [ 10, 2, 4.2, 99 ];\n * const mma = numbersCompute(v);\n * // Yields: { min: 2, max: 99, total: 115.2, avg: 28.8 }\n * ```\n *\n * Use {@link https://api.ixfx.fun/_ixfx/numbers/average/ @ixfx/numbers.average}, {@link https://api.ixfx.fun/_ixfx/numbers/max/ @ixfx/numbers.max}, {@link https://api.ixfx.fun/_ixfx/numbers/min/ @ixfx/numbers.min} or {@link https://api.ixfx.fun/_ixfx/numbers/total/ @ixfx/numers.total} if you only need one of these.\n *\n * A start and end range can be provided if the calculation should be restricted to a part\n * of the input array. By default the whole array is used.\n *\n * It's also possible to use an iterable as input.\n * ```js\n * import { count } from '@ixfx/numbers';\n * numbersCompute(count(5,1)); // Averages 1,2,3,4,5\n * ```\n *\n * Returns `NaN` if the input data is empty.\n * @param data\n * @param options Allows restriction of range that is examined\n * @returns `{min, max, avg, total}`\n */\nexport const numbersCompute = (data, options = {}) => {\n    if (typeof data === `undefined`)\n        throw new Error(`Param 'data' is undefined`);\n    if (Array.isArray(data)) {\n        return numberArrayCompute(data, options);\n    }\n    if (isIterable(data)) {\n        return numbersComputeIterable(data, options);\n    }\n    throw new Error(`Param 'data' is neither an array nor iterable`);\n};\nfunction numbersComputeIterable(data, options = {}) {\n    // if (typeof options.startIndex !== `undefined` || typeof options.endIndex !== `undefined`) {\n    //   data = slice(data, options.startIndex, options.endIndex);\n    // }\n    let total = 0;\n    const nonNumbers = options.nonNumbers ?? `ignore`;\n    let min = Number.MAX_SAFE_INTEGER;\n    let max = Number.MIN_SAFE_INTEGER;\n    let count = 0;\n    for (let v of data) {\n        if (typeof v !== `number` || Number.isNaN(v)) {\n            if (nonNumbers === `throw`)\n                throw new TypeError(`Data contains something not a number. Got type '${typeof v}'`);\n            if (nonNumbers === `nan`)\n                v = Number.NaN;\n            if (nonNumbers === `ignore`)\n                continue;\n        }\n        total += v;\n        count++;\n        min = Math.min(min, v);\n        max = Math.max(max, v);\n    }\n    return {\n        avg: total / count,\n        total, max, min, count\n    };\n}\nexport function computeAverage(data, options = {}) {\n    let count = 0;\n    let total = 0;\n    const nonNumbers = options.nonNumbers ?? `ignore`;\n    for (let d of data) {\n        if (typeof d !== `number` || Number.isNaN(d)) {\n            if (nonNumbers === `throw`)\n                throw new TypeError(`Data contains something not a number. Got type '${typeof d}'`);\n            if (nonNumbers === `nan`)\n                d = Number.NaN;\n            if (nonNumbers === `ignore`)\n                continue;\n        }\n        total += d;\n        count++;\n    }\n    return total / count;\n}\n","import * as Async from './async.js';\nimport * as Sync from './sync.js';\nexport * as Async from './async.js';\nexport * as Sync from './sync.js';\nexport * as Chains from './chain/index.js';\nexport { combineLatestToArray } from './chain/combine-latest-to-array.js';\nexport { combineLatestToObject } from './chain/combine-latest-to-object.js';\nexport * from './compare-values.js';\nexport * from './controller.js';\nexport * from './from-event.js';\nexport * from './guard.js';\nexport * from './types.js';\nimport { isAsyncIterable } from './guard.js';\n//import * as Chains from './chain/index.js';\n// import type { Interval } from '../flow/IntervalType.js';\nimport { toStringDefault } from '@ixfx/core';\nexport * from './numbers-compute.js';\n/**\n * Returns a stream of minimum values.\n *\n * Streaming result: works with endless iterables.\n *\n * ```js\n * min([\n *  {i:0,v:1},\n *  {i:1,v:9},\n *  {i:2,v:-2}\n * ], (a, b) => a.v > b.v);\n * // Yields: {i:2, v:1}, {i:2,v:-2}\n * ```\n * @param it Iterable\n * @param gt Should return _true_ if `a` is greater than `b`.\n * @returns Yields minimum values\n */\nexport function min(it, gt = (a, b) => a > b) {\n    return isAsyncIterable(it) ? Async.min(it, gt) : Sync.min(it, gt);\n}\n/**\n * Returns the maximum value of an iterable as it changes.\n * Streaming result: works with endless iterables.\n *\n * ```js\n * // Rank values by their 'v' field\n * const rank = (a,b) => a.v > b.v;\n *\n * min([\n *  {i:0,v:1},\n *  {i:1,v:9},\n *  {i:2,v:-2}\n * ], rank);\n * // Yields: {i:0,v:1}, {i:1,v:9}\n * ```\n * @param it Iterable\n * @param gt Should return _true_ if `a` is greater than `b`.\n * @returns Iterable of maximum values\n */\nexport function max(it, gt = (a, b) => a > b) {\n    return isAsyncIterable(it) ? Async.max(it, gt) : Sync.max(it, gt);\n}\n/**\n * Drops elements that do not meet the predicate `f`.\n * Streaming result: works with endless iterables.\n *\n * ```js\n * dropWhile([1, 2, 3, 4], e => e < 3);\n * returns [3, 4]\n * ```\n * @param it\n * @param f\n */\nexport function dropWhile(it, f) {\n    return isAsyncIterable(it) ? Async.dropWhile(it, f) : Sync.dropWhile(it, f);\n}\n/**\n* Loops over a generator until it finishes, calling `callback`.\n* Useful if you don't care about the value generator produces, just the number of loops.\n*\n* ```js\n* until(count(5), () => {\n* // do something 5 times\n* });\n* ```\n*\n* If you want the value from the generator, use a `for of` loop as usual.\n* If `callback` explicitly returns _false_, the generator is aborted.\n*\n* This does not work for infinite generators, `callback` will never be called.\n* @param it Generator to run\n* @param callback Code to call for each iteration\n*/\nexport function until(it, callback) {\n    if (isAsyncIterable(it)) {\n        return Async.until(it, callback);\n    }\n    else {\n        Sync.until(it, callback);\n    }\n}\n/**\n * Breaks an iterable into array chunks\n *\n * Streaming: works with infinite iterables.\n *\n * ```js\n * chunks([1,2,3,4,5,6,7,8,9,10], 3);\n * // Yields [[1, 2, 3], [4, 5, 6], [7, 8, 9], [10]]\n * ```\n * @param it\n * @param size\n */\nexport function chunks(it, size) {\n    return isAsyncIterable(it) ? Async.chunks(it, size) : Sync.chunks(it, size);\n}\n/**\n * Filters an iterable, only yielding items which match `f`.\n *\n * ```js\n * filter([1, 2, 3, 4], e => e % 2 == 0);\n * returns [2, 4]\n * ```\n *\n * When using async iterables, `f` can be async as well.\n * @param it\n * @param f\n */\nexport function filter(it, f) {\n    return isAsyncIterable(it) ? Async.filter(it, f) : Sync.filter(it, f);\n}\n/**\n * Yields `v` for each item within `it`.\n *\n * ```js\n * fill([1, 2, 3], 0);\n * // Yields: [0, 0, 0]\n * ```\n *\n * This is like a `map` where we return a fixed value, ignoring the input.\n * @param it\n * @param v\n */\nexport function fill(it, v) {\n    return isAsyncIterable(it) ? Async.fill(it, v) : Sync.fill(it, v);\n}\n/**\n * Return concatenation of iterators.\n *\n * Non-streaming: If one of the input iterables is endless, the other ones won't\n * be processed.\n * @param its\n */\nexport function concat(...its) {\n    return isAsyncIterable(its[0]) ? Async.concat(...its) : Sync.concat(...its);\n}\n/**\n * Returns first item from iterable `it` that matches predicate `f`\n * ```js\n * find([1, 2, 3, 4], e => e > 2);\n * // Yields: 3\n * ```\n *\n * When using async iterables, `f` can be async as well.\n * @param it\n * @param f\n * @returns\n */\nexport function find(it, f) {\n    return isAsyncIterable(it) ? Async.find(it, f) : Sync.find(it, f);\n}\n/**\n * Execute function `f` for each item in iterable.\n * If `f` returns _false_, iteration stops.\n * ```js\n * forEach(iterable, v => {\n *  // do something with value\n * });\n * ```\n *\n * When using an async iterable, `fn` can also be async.\n * @param it Iterable or array\n * @param fn Function to execute\n */\n// eslint-disable-next-line @typescript-eslint/no-invalid-void-type\nexport function forEach(it, fn, options = {}) {\n    if (isAsyncIterable(it)) {\n        return Async.forEach(it, fn, options);\n    }\n    else {\n        Sync.forEach(it, fn);\n    }\n}\n/**\n * Maps an iterable through function `f`\n * ```js\n * // For every input value, multiply it by itself\n * map([1, 2, 3], e => e*e)\n * // Yields: 1, 4, 9\n * ```\n *\n * It can also be used to transform types:\n * ```js\n * map([1, 2, 3], e => { value: e });\n * // Yields: { value: 1 }, { value: 2 }, { value: 3 }\n * ```\n * @param it\n * @param f\n */\nexport function map(it, f) {\n    return isAsyncIterable(it) ? Async.map(it, f) : Sync.map(it, f);\n}\n/**\n * Yield values from `array`, one at a time.\n * Use `interval` to add time between each item.\n * The first item is yielded without delay.\n *\n * @param array Array of values\n * @param interval Interval (defaults: 1ms)\n */\nexport function fromArray(array, interval) {\n    return interval === undefined ? Sync.fromArray(array) : Async.fromArray(array, interval);\n}\n/**\n * Returns a 'flattened' copy of array, un-nesting arrays one level.\n * Streaming: works with unlimited iterables.\n * ```js\n * flatten([1, [2, 3], [[4]]]);\n * // Yields: [1, 2, 3, [4]];\n * ```\n * @param it\n */\nexport function flatten(it) {\n    return isAsyncIterable(it) ? Async.flatten(it) : Sync.flatten(it);\n}\n/**\n * Returns true the first time `f` returns true. Useful for spotting any occurrence of\n * data, and exiting quickly\n * ```js\n * some([1, 2, 3, 4], e => e % 3 === 0);\n * // Yields: true\n * ```\n * @param it Iterable\n * @param f Filter function\n * @returns\n */\nexport function some(it, f) {\n    return isAsyncIterable(it) ? Async.some(it, f) : Sync.some(it, f);\n}\n/**\n * Returns the last item of an iterable, or _undefined_ if it yields no results.\n * @param it\n * @returns\n */\nexport function last(it) {\n    return isAsyncIterable(it) ? Async.last(it) : Sync.last(it);\n}\n/**\n * Reduce for iterables\n * ```js\n * reduce([1, 2, 3], (acc, cur) => acc + cur, 0);\n * // Yields: 6\n * ```\n * @param it Iterable\n * @param f Function\n * @param start Start value\n * @returns\n */\nexport function reduce(it, f, start) {\n    return isAsyncIterable(it) ? Async.reduce(it, f, start) : Sync.reduce(it, f, start);\n}\n/**\n * Returns a section from an iterable.\n *\n * 'end' is the end index, not the number of items.\n *\n * ```js\n * // Return five items from step 10\n * slice(it, 10, 15);\n * ```\n * @param it Iterable\n * @param start Start step\n * @param end Exclusive end step (or until completion)\n */\nexport function slice(it, start = 0, end = Number.POSITIVE_INFINITY) {\n    return isAsyncIterable(it) ? Async.slice(it, start, end) : Sync.slice(it, start, end);\n}\n/**\n * Returns unique items from an iterable or\n * array of iterables.\n *\n * ```js\n * const data = [ 'apples', 'oranges' ]\n * const data2 = [ 'oranges', 'pears' ]\n * const unique = [...unique([data,data2]];\n * // Yields: [ 'apples', 'oranges', 'pears' ]\n * ```\n *\n * Uses object reference to compare values.\n * Use {@link uniqueByValue} if this doesn't suffice.\n * @param iterable Iterable, or array of iterables\n */\nexport function unique(iterable) {\n    if (Array.isArray(iterable)) {\n        if (iterable.length === 0)\n            return Sync.fromArray([]);\n        return isAsyncIterable(iterable[0]) ? Async.unique(iterable) : Sync.unique(iterable);\n    }\n    else if (isAsyncIterable(iterable)) {\n        return Async.unique(iterable);\n    }\n    else {\n        return Sync.unique(iterable);\n    }\n}\n/**\n * Filters the `input` iterable, only yielding unique values. Use {@link unique} to compare\n * by object reference instead.\n *\n * Streaming: Works with unbounded iterables.\n *\n * ```js\n * const d = ['a', 'b', 'c', 'b', 'd' ];\n * for (const v of uniqueByValue(d)) {\n *  // Yields: 'a', 'b', 'c', 'd'\n * // (extra 'b' is skipped)\n * }\n * ```\n *\n * By default, JSON.stringify is used to create a string representing value. These are added\n * to a Set of strings, which is how we keep track of uniqueness. If the value is already a string it is used as-is.\n *\n * This allows you to have custom logic for what determines uniqueness. Eg, using a single field\n * of an object as an identifier:\n *\n * ```js\n * const people = [\n *  { name: `Mary`, size: 20 }, { name: `Abdul`, size: 19 }, { name: `Mary`, size: 5 }\n * ]\n * for (const v of uniqueByValue(d, v=>v.name)) {\n *  // Yields: { name: `Mary`, size: 20 }, { name: `Abdul`, size: 19 }\n *  // Second 'Mary' is skipped because name is the same, even though size field is different.\n * }\n * ```\n *\n * If you want to keep track of the set of keys, or prime it with some existing data, provide a Set instance:\n * ```js\n * const unique = new Set();\n * unique.add(`b`);\n * const d = [`a`, `b`, `c`];\n * for (const v of uniqueByValue(d, toStringDefault, unique)) {\n *  // Yields: `a`, `c`\n *  // `b` is skipped because it was already in set\n * }\n * // After completion, `unique` contains `a`, `b` and `c`.\n * ```\n *\n * Creating your own Set is useful for tracking unique values across several calls to `uniqueByValue`.\n * @param input\n * @param seen\n * @param toString\n */\nexport function* uniqueByValue(input, toString = toStringDefault, seen = new Set()) {\n    yield* isAsyncIterable(input) ? Async.uniqueByValue(input, toString, seen) : Sync.uniqueByValue(input, toString, seen);\n}\n/**\n * Returns an array of values from an iterator.\n *\n * ```js\n * const data = await toArray(adsrIterable(opts, 10));\n * ```\n *\n * Note: If the iterator is infinite, be sure to provide a `count` or the function\n * will never return.\n *\n * @param it Asynchronous iterable\n * @param count Number of items to return, by default all.\n * @returns\n */\nexport function toArray(it, options = {}) {\n    return isAsyncIterable(it) ? Async.toArray(it, options) : Sync.toArray(it, options);\n}\n/**\n * Returns _true_ if `f` returns _true_ for\n * every item in iterable.\n *\n * Streaming: If an infinite iterable is used, function will never return value.\n * @param it\n * @param f\n * @returns\n */\nexport function every(it, f) {\n    return isAsyncIterable(it) ? Async.every(it, f) : Sync.every(it, f);\n}\n/**\n * Returns _true_ if items in two iterables are equal, as\n * determined by the `equality` function.\n * Order matters. It compares items at the same 'step' of each iterable.\n * @param it1\n * @param it2\n * @param equality\n * @returns\n */\nexport function equals(it1, it2, equality) {\n    const as = isAsyncIterable(it1) && isAsyncIterable(it2);\n    return as ? Async.equals(it1, it2, equality) : Sync.equals(it1, it2, equality);\n}\n/**\n * Combine same-positioned items from several iterables\n * ```js\n * zip( [1, 2, 3], [4, 5, 6], [7, 8, 9] );\n * Yields: [ [1, 4, 7], [2, 5, 8], [3, 6, 9] ]\n * ```\n * @param its\n * @returns\n */\nexport function zip(...its) {\n    if (its.length === 0)\n        return Sync.fromArray([]);\n    return isAsyncIterable(its[0]) ? Async.zip(...its) : Sync.zip(...its);\n}\n/**\n * Yield values from `iterable`, one at a time.\n * Use `interval` to add time between each item.\n * The first item is yielded without delay.\n * @param iterable Iterable or AsyncIterable\n * @param [interval=1] Interval to wait between yield\n */\nexport function fromIterable(iterable, interval) {\n    if (isAsyncIterable(iterable) || interval !== undefined)\n        return Async.fromIterable(iterable, interval);\n    return Sync.fromIterable(iterable);\n}\n/**\n * Access `callback` as an iterable:\n * ```js\n * const fn = () => Math.random();\n * for (const v of fromFunction(fn)) {\n *  // Generate infinite random numbers\n * }\n * ```\n *\n * Use {@link fromFunctionAwaited} to await `callback`.\n * @param callback Function that generates a value\n */\nexport function* fromFunction(callback) {\n    while (true) {\n        const v = callback();\n        yield v;\n    }\n}\n/**\n * Access awaited `callback` as an iterable:\n * ```js\n * const fn = () => Math.random();\n * for await (const v of fromFunctionAwaited(fn)) {\n *  // Generate infinite random numbers\n * }\n * ```\n *\n * `callback` can be async, result is awaited.\n * This requires the use of `for await`.\n * Use {@link fromFunction} otherwise;\n * @param callback\n */\nexport async function* fromFunctionAwaited(callback) {\n    while (true) {\n        const v = await callback();\n        yield v;\n    }\n}\n/**\n * Calls `callback` whenever the generator produces a value.\n *\n * When using `asCallback`, call it with `await` to let generator\n * run its course before continuing:\n * ```js\n * await asCallback(tick({ interval:1000, loops:5 }), x => {\n *  // Gets called 5 times, with 1000ms interval\n * });\n * console.log(`Hi`); // Prints after 5 seconds\n * ```\n *\n * Or if you skip the `await`, code continues and callback will still run:\n * ```js\n * asCallback(tick({ interval: 1000, loops: 5}), x => {\n *  // Gets called 5 times, with 1000ms interval\n * });\n * console.log(`Hi`); // Prints immediately\n * ```\n * @param input\n * @param callback\n */\nexport function asCallback(input, callback, onDone) {\n    if (isAsyncIterable(input)) {\n        return Async.asCallback(input, callback);\n    }\n    else {\n        Sync.asCallback(input, callback);\n        return;\n    }\n}\n","import { integerTest, resultThrow } from \"@ixfx/guards\";\n\n\n// eslint-disable-next-line @typescript-eslint/consistent-type-definitions\nexport interface ICircularArray<V> extends Array<V> {\n  /**\n   * Returns true if the array has filled to capacity and is now\n   * recycling array indexes.\n   */\n  get isFull(): boolean;\n\n  /**\n   * Returns a new Circular with item added\n   *\n   * Items are added at `pointer` position, which automatically cycles through available array indexes.\n   *\n   * @param value Thing to add\n   * @returns Circular with item added\n   */\n  add(value: V): ICircularArray<V>;\n\n  get length(): number;\n\n  /**\n   * Returns the current add position of array.\n   */\n  get pointer(): number;\n}\n\n/**\n * A circular array keeps a maximum number of values, overwriting older values as needed. Immutable.\n *\n * `CircularArray` extends the regular JS array. Only use `add` to change the array if you want\n * to keep the `CircularArray` behaviour.\n *\n * @example Basic functions\n * ```js\n * let a = new CircularArray(10);\n * a = a.add(`hello`);  // Because it's immutable, capture the return result of `add`\n * a.isFull;            // True if circular array is full\n * a.pointer;           // The current position in array it will write to\n * ```\n *\n * Since it extends the regular JS array, you can access items as usual:\n * @example Accessing\n * ```js\n * let a = new CircularArray(10);\n * ... add some stuff ..\n * a.forEach(item => // do something with item);\n * ```\n * @param capacity Maximum capacity before recycling array entries\n * @return Circular array\n */\nexport class CircularArray<V> extends Array {\n  #capacity: number;\n  #pointer: number;\n\n  constructor(capacity = 0) {\n    super();\n    // Allowed to create with capacity zero\n    resultThrow(integerTest(capacity, `positive`, `capacity`));\n\n    // Can't throw because .filter won't use ctor proprly\n    this.#capacity = capacity;\n    this.#pointer = 0;\n  }\n\n  /**\n   * Add to array\n   * @param value Thing to add\n   * @returns \n   */\n  add(value: V): CircularArray<V> {\n    const ca = CircularArray.from(this) as CircularArray<V>;\n    ca[ this.#pointer ] = value;\n    ca.#capacity = this.#capacity;\n    if (this.#capacity > 0) {\n      ca.#pointer =\n        this.#pointer + 1 === this.#capacity ? 0 : this.#pointer + 1;\n    } else {\n      ca.#pointer = this.#pointer + 1;\n    }\n    return ca;\n  }\n\n  get pointer(): number {\n    return this.#pointer;\n  }\n\n  get isFull(): boolean {\n    if (this.#capacity === 0) return false;\n    return this.length === this.#capacity;\n  }\n}\n","import type { QueueOpts } from './queue-types.js';\n\nexport const debug = (opts: QueueOpts<any>, message: string): void => {\n  opts.debug ? console.log(`queue:${ message }`) : undefined;\n};\n\nexport const trimQueue = <V>(\n  opts: QueueOpts<V>,\n  queue: ReadonlyArray<V>,\n  toAdd: ReadonlyArray<V>\n): ReadonlyArray<V> => {\n  const potentialLength = queue.length + toAdd.length;\n  const capacity = opts.capacity ?? potentialLength;\n  const toRemove = potentialLength - capacity;\n  const policy = opts.discardPolicy ?? `additions`;\n  // debug(\n  //   opts,\n  //   `queueLen: ${queue.length} potentialLen: ${potentialLength} toRemove: ${toRemove} policy: ${policy} toAdd.length: ${toAdd.length} capacity: ${capacity}`\n  // );\n  // debug(opts, `to add: ${JSON.stringify(toAdd)}`);\n\n  switch (policy) {\n    // Only add what we can from toAdd\n    case `additions`: {\n      // debug(\n      //   opts,\n      //   `trimQueue:DiscardAdditions: queueLen: ${queue.length} slice: ${\n      //     potentialLength - capacity\n      //   } toAddLen: ${toAdd.length} nowFull: ${queue.length === opts.capacity}`\n      // );\n      if (queue.length === 0) return toAdd.slice(0, toAdd.length - toRemove);\n      // eslint-disable-next-line unicorn/prefer-ternary\n      if (queue.length === opts.capacity) {\n        return queue; // Completely full\n      } else {\n        // Only add some from the new array (from the front)\n        return [ ...queue, ...toAdd.slice(0, toRemove - 1) ];\n      }\n    }\n    // Remove from rear of queue (last index) before adding new things\n    case `newer`: {\n      if (toRemove >= queue.length) {\n        // New items will completely flush out old\n        //debug(opts, `slice start: ${toAdd.length - capacity}`);\n        if (queue.length === 0) {\n          // Special case when queue starts off empty\n          // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n          return [ ...toAdd.slice(0, capacity - 1), toAdd.at(-1)! ];\n        }\n        return toAdd.slice(\n          Math.max(0, toAdd.length - capacity),\n          Math.min(toAdd.length, capacity) + 1\n        );\n        //debug(opts, `Final value: ${JSON.stringify(tmp)}`);\n        //return tmp;\n      } else {\n        // Keep some of the old\n        // const toAddFinal = toAdd.slice(\n        //   0,\n        //   Math.min(toAdd.length, capacity - toRemove + 1)\n        // );\n        // Cap 5, queue 5, toAdd: 10.\n        const countToAdd = Math.max(1, toAdd.length - queue.length);\n        const toAddFinal = toAdd.slice(toAdd.length - countToAdd, toAdd.length);\n        const toKeep = queue.slice(0, Math.min(queue.length, capacity - 1)); //toRemove);\n        // debug(\n        //   opts,\n        //   `trimQueue: countToAdd: ${countToAdd} qLen: ${\n        //     queue.length\n        //   } capacity: ${capacity} toRemove: ${toRemove} keeping: ${JSON.stringify(\n        //     toKeep\n        //   )} from orig: ${JSON.stringify(queue)} toAddFinal: ${JSON.stringify(\n        //     toAddFinal\n        //   )}`\n        // );\n        const t = [ ...toKeep, ...toAddFinal ];\n        //debug(opts, `final: ${JSON.stringify(t)}`);\n        return t;\n      }\n    }\n    // Remove from the front of the queue (0 index). ie. older items are discarded\n    case `older`: {\n      // If queue is A, B and toAdd is C, D this yields A, B, C, D\n      return [ ...queue, ...toAdd ].slice(toRemove);\n    }\n    default: {\n      // eslint-disable-next-line @typescript-eslint/restrict-template-expressions\n      throw new Error(`Unknown overflow policy ${ policy }`);\n    }\n  }\n};\n\n/**\n * Adds to the back of the queue (last array index)\n * Last item of `toAdd` will potentially be the new end of the queue (depending on capacity limit and overflow policy)\n * @typeParam V - Type of values\n * @param {QueueOpts} opts\n * @param {V[]} queue\n * @param {...V[]} toAdd\n * @returns {V[]}\n */\nexport const enqueue = <V>(\n  opts: QueueOpts<V>,\n  queue: ReadonlyArray<V>,\n  ...toAdd: ReadonlyArray<V>\n): ReadonlyArray<V> => {\n  if (opts === undefined) throw new Error(`opts parameter undefined`);\n\n  const potentialLength = queue.length + toAdd.length;\n  const overSize = opts.capacity && potentialLength > opts.capacity;\n\n  const toReturn = overSize\n    ? trimQueue(opts, queue, toAdd)\n    : [ ...queue, ...toAdd ];\n  if (opts.capacity && toReturn.length !== opts.capacity && overSize) {\n    throw new Error(\n      `Bug! Expected return to be at capacity. Return len: ${ toReturn.length\n      } capacity: ${ opts.capacity } opts: ${ JSON.stringify(opts) }`\n    );\n  }\n  if (!opts.capacity && toReturn.length !== potentialLength) {\n    throw new Error(\n      `Bug! Return length not expected. Return len: ${ toReturn.length\n      } expected: ${ potentialLength } opts: ${ JSON.stringify(opts) }`\n    );\n  }\n  return toReturn;\n};\n\n// Remove from front of queue (0 index)\nexport const dequeue = <V>(\n  opts: QueueOpts<V>,\n  queue: ReadonlyArray<V>\n): ReadonlyArray<V> => {\n  if (queue.length === 0) throw new Error(`Queue is empty`);\n  return queue.slice(1);\n};\n\n/**\n * Returns front of queue (oldest item), or undefined if queue is empty\n *\n * @typeParam V - Type of values stored\n * @param {QueueOpts} opts\n * @param {V[]} queue\n * @returns {(V | undefined)}\n */\nexport const peek = <V>(\n  opts: QueueOpts<V>,\n  queue: ReadonlyArray<V>\n): V | undefined => queue[ 0 ];\n\nexport const isEmpty = <V>(opts: QueueOpts<V>, queue: ReadonlyArray<V>): boolean =>\n  queue.length === 0;\n\nexport const isFull = <V>(\n  opts: QueueOpts<V>,\n  queue: ReadonlyArray<V>\n): boolean => {\n  if (opts.capacity) {\n    return queue.length >= opts.capacity;\n  }\n  return false;\n};\n","import { type IQueueMutable, type IQueueMutableWithEvents, type QueueMutableEvents } from './iqueue-mutable.js';\nimport { enqueue, peek, dequeue, isEmpty, isFull } from './queue-fns.js';\nimport { type QueueOpts } from './queue-types.js';\nimport { isEqualDefault, type IsEqual } from '@ixfx/core';\nimport { SimpleEventEmitter } from '@ixfx/events'; //'../../Events.js';\n\n/**\n * Mutable queue that fires events when manipulated.\n * \n * Queues are useful if you want to treat 'older' or 'newer'\n * items differently. _Enqueing_ adds items at the back of the queue, while\n * _dequeing_ removes items from the front (ie. the oldest).\n *\n * ```js\n * const q = Queues.mutable();       // Create\n * q.enqueue(`a`, `b`);     // Add two strings\n * const front = q.dequeue();  // `a` is at the front of queue (oldest)\n * ```\n *\n * @example Cap size to 5 items, throwing away newest items already in queue.\n * ```js\n * const q = Queues.mutable({capacity: 5, discardPolicy: `newer`});\n * ```\n *\n * Events can be used to monitor data flows.\n * * 'enqueue': fires when item(s) are added\n * * 'dequeue': fires when an item is dequeued from front\n * * 'removed': fires when an item is dequeued, queue is cleared or .removeWhere is used to trim queue\n * \n * Each of the event handlers return the state of the queue as the 'finalData'\n * field.\n * \n * ```js\n * q.addEventListener(`enqueue`, e => {\n *  // e.added, e.finalData\n * });\n * q.addEventListener(`removed`, e => {\n *  // e.removed, e.finalData\n * });\n * q.addEventListener(`dequeue`, e=> {\n *  // e.removed, e.finalData\n * })\n * ```\n * @typeParam V - Data type of items\n */\nexport class QueueMutable<V> extends SimpleEventEmitter<QueueMutableEvents<V>> implements IQueueMutable<V> {\n  readonly options: QueueOpts<V>;\n  data: readonly V[];\n  eq: IsEqual<V>;\n\n  constructor(opts: QueueOpts<V> = {}, data: readonly V[] = []) {\n    super();\n    if (opts === undefined) throw new Error(`opts parameter undefined`);\n    this.options = opts;\n    this.data = data;\n    this.eq = opts.eq ?? isEqualDefault;\n  }\n\n  clear() {\n    const copy = [ ...this.data ];\n    this.data = [];\n    this.fireEvent(`removed`, { finalData: this.data, removed: copy });\n    this.onClear();\n  }\n\n  /**\n   * Called when all data is cleared\n   */\n  protected onClear() { /** no-op */\n  }\n\n  at(index: number): V {\n    if (index >= this.data.length) throw new Error(`Index outside bounds of queue`);\n    const v = this.data.at(index);\n    if (v === undefined) throw new Error(`Index appears to be outside range of queue`);\n    return v;\n  }\n\n  enqueue(...toAdd: readonly V[]): number {\n    this.data = enqueue(this.options, this.data, ...toAdd);\n    const length = this.data.length;\n    this.onEnqueue(this.data, toAdd);\n    return length;\n  }\n\n  protected onEnqueue(result: readonly V[], attemptedToAdd: readonly V[]) {\n    this.fireEvent(`enqueue`, { added: attemptedToAdd, finalData: result });\n  }\n\n  dequeue(): V | undefined {\n    const v = peek(this.options, this.data);\n    if (v === undefined) return;\n    /* eslint-disable-next-line functional/immutable-data */\n    this.data = dequeue(this.options, this.data);\n    this.fireEvent(`dequeue`, { removed: v, finalData: this.data });\n    this.onRemoved([ v ], this.data);\n    return v;\n  }\n\n  protected onRemoved(removed: readonly V[], finalData: readonly V[]) {\n    this.fireEvent(`removed`, { removed, finalData });\n  }\n\n  /**\n   * Removes values that match `predicate`.\n   * @param predicate \n   * @returns Returns number of items removed.\n   */\n  removeWhere(predicate: (item: V) => boolean): number {\n    const countPre = this.data.length;\n    const toRemove = this.data.filter(v => predicate(v));\n    if (toRemove.length === 0) return 0;\n    this.data = this.data.filter((element) => !predicate(element));\n    this.onRemoved(toRemove, this.data);\n    return countPre - this.data.length;\n  }\n\n  /**\n * Return a copy of the array\n * @returns \n */\n  toArray(): V[] {\n    return [ ...this.data ];\n  }\n\n  get isEmpty(): boolean {\n    return isEmpty(this.options, this.data);\n  }\n\n  get isFull(): boolean {\n    return isFull(this.options, this.data);\n  }\n\n  get length(): number {\n    return this.data.length;\n  }\n\n  get peek(): V | undefined {\n    return peek(this.options, this.data);\n  }\n}\n\n/**\n * Creates a new QueueMutable\n * @param options \n * @param startingItems \n * @returns \n */\nexport function mutable<V>(\n  options: QueueOpts<V> = {},\n  ...startingItems: readonly V[]\n): IQueueMutableWithEvents<V> {\n  return new QueueMutable({ ...options }, [ ...startingItems ]);\n}\n\n","import type { StackOpts } from './Types.js';\n\nexport const trimStack = <V>(\n  opts: StackOpts,\n  stack: ReadonlyArray<V>,\n  toAdd: ReadonlyArray<V>\n): ReadonlyArray<V> => {\n  const potentialLength = stack.length + toAdd.length;\n  const policy = opts.discardPolicy ?? `additions`;\n  const capacity = opts.capacity ?? potentialLength;\n  const toRemove = potentialLength - capacity;\n  if (opts.debug) {\n    console.log(\n      `Stack.push: stackLen: ${ stack.length } potentialLen: ${ potentialLength } toRemove: ${ toRemove } policy: ${ policy }`\n    );\n  }\n  switch (policy) {\n    case `additions`: {\n      if (opts.debug) {\n        console.log(\n          `Stack.push:DiscardAdditions: stackLen: ${ stack.length } slice: ${ potentialLength - capacity\n          } toAddLen: ${ toAdd.length }`\n        );\n      }\n\n      // eslint-disable-next-line unicorn/prefer-ternary\n      if (stack.length === opts.capacity) {\n        return stack; // Completely full\n      } else {\n        // Only add some from the new array\n        return [ ...stack, ...toAdd.slice(0, toAdd.length - toRemove) ];\n      }\n    }\n    case `newer`: {\n      if (toRemove >= stack.length) {\n        // New items will completely flush out old\n        return toAdd.slice(\n          Math.max(0, toAdd.length - capacity),\n          Math.min(toAdd.length, capacity) + 1\n        );\n      } else {\n        // Keep some of the old (from 0)\n        //if (opts.debug) console.log(` orig: ${JSON.stringify(stack)}`);\n        if (opts.debug) {\n          console.log(` from orig: ${ JSON.stringify(stack.slice(0, stack.length - toRemove)) }`);\n        }\n        return [\n          ...stack.slice(0, stack.length - toRemove),\n          ...toAdd.slice(0, Math.min(toAdd.length, capacity - toRemove + 1)),\n        ];\n      }\n    }\n    case `older`: {\n      // Oldest item in stack is position 0\n      return [ ...stack, ...toAdd ].slice(toRemove);\n    }\n    default: {\n      // eslint-disable-next-line @typescript-eslint/restrict-template-expressions\n      throw new Error(`Unknown discard policy ${ policy }`);\n    }\n  }\n};\n\n// Add to top (last index)\nexport const push = <V>(\n  opts: StackOpts,\n  stack: ReadonlyArray<V>,\n  ...toAdd: ReadonlyArray<V>\n): ReadonlyArray<V> => {\n  // If stack is A, B and toAdd is C, D this yields A, B, C, D\n  //const mutated = [...stack, ...toAdd];\n  const potentialLength = stack.length + toAdd.length;\n\n  const overSize = opts.capacity && potentialLength > opts.capacity;\n  const toReturn = overSize\n    ? trimStack(opts, stack, toAdd)\n    : [ ...stack, ...toAdd ];\n  return toReturn;\n};\n\n// Remove from top (last index)\nexport const pop = <V>(\n  opts: StackOpts,\n  stack: ReadonlyArray<V>\n): ReadonlyArray<V> => {\n  if (stack.length === 0) throw new Error(`Stack is empty`);\n  return stack.slice(0, - 1);\n};\n\n/**\n * Peek at the top of the stack (end of array)\n *\n * @typeParam V - Type of stored items\n * @param {StackOpts} opts\n * @param {V[]} stack\n * @returns {(V | undefined)}\n */\nexport const peek = <V>(\n  opts: StackOpts,\n  stack: ReadonlyArray<V>\n): V | undefined => stack.at(-1);\n\nexport const isEmpty = <V>(opts: StackOpts, stack: ReadonlyArray<V>): boolean =>\n  stack.length === 0;\n\nexport const isFull = <V>(\n  opts: StackOpts,\n  stack: ReadonlyArray<V>\n): boolean => {\n  if (opts.capacity) {\n    return stack.length >= opts.capacity;\n  }\n  return false;\n};\n","// -------------------------\n// Mutable\n// -------------------------\n\nimport type { IStackMutable } from './IStackMutable.js';\nimport { push, peek, pop, isEmpty, isFull } from './StackFns.js';\nimport type { StackOpts } from './Types.js';\n\n/**\n * Creates a stack. Mutable. Use {@link StackImmutable} for an immutable alternative.\n *\n * @example Basic usage\n * ```js\n * // Create\n * const s = new StackMutable();\n * // Add one or more items\n * s.push(1, 2, 3, 4);\n *\n * // See what's on top\n * s.peek;  // 4\n *\n * // Remove the top-most, and return it\n * s.pop();   // 4\n *\n * // Now there's a new top-most element\n * s.peek;  // 3\n * ```\n */\nexport class StackMutable<V> implements IStackMutable<V> {\n  readonly opts: StackOpts;\n  data: readonly V[];\n\n  constructor(opts: StackOpts = {}, data: readonly V[] = []) {\n    this.opts = opts;\n    this.data = data;\n  }\n\n  /**\n   * Push data onto the stack.\n   * If `toAdd` is empty, nothing happens\n   * @param toAdd Data to add\n   * @returns Length of stack\n   */\n  push(...toAdd: readonly V[]): number {\n    if (toAdd.length === 0) return this.data.length;\n    this.data = push(this.opts, this.data, ...toAdd);\n    return this.data.length;\n  }\n\n  forEach(fn: (v: V) => void): void {\n    this.data.forEach(fn);\n  }\n\n  forEachFromTop(fn: (v: V) => void): void {\n    [ ...this.data ].reverse().forEach(fn);\n  }\n\n  pop(): V | undefined {\n    const v = peek(this.opts, this.data);\n    this.data = pop(this.opts, this.data);\n    return v;\n  }\n\n  get isEmpty(): boolean {\n    return isEmpty(this.opts, this.data);\n  }\n\n  get isFull(): boolean {\n    return isFull(this.opts, this.data);\n  }\n\n  get peek(): V | undefined {\n    return peek(this.opts, this.data);\n  }\n\n  get length(): number {\n    return this.data.length;\n  }\n}\n\n/**\n * Creates a stack. Mutable. Use {@link Stacks.immutable} for an immutable alternative.\n *\n * @example Basic usage\n * ```js\n * // Create\n * const s = Stacks.mutable();\n * // Add one or more items\n * s.push(1, 2, 3, 4);\n *\n * // See what's on top\n * s.peek;  // 4\n *\n * // Remove the top-most, and return it\n * s.pop();   // 4\n *\n * // Now there's a new top-most element\n * s.peek;  // 3\n * ```\n */\nexport const mutable = <V>(\n  opts: StackOpts = {},\n  ...startingItems: readonly V[]\n): IStackMutable<V> => new StackMutable({ ...opts }, [ ...startingItems ]);\n","import { type IsEqual, isEqualValueIgnoreOrder } from \"@ixfx/core\";\nimport * as TreeMutable from './tree-mutable.js';\nimport type { TreeNode, TraversableTree } from './types.js';\n\nexport type DiffAnnotation<T> = {\n  /**\n   * In the case of changes, this is old value\n   */\n  a: TraversableTree<T>\n  /**\n   * In the case of changes, this is the new value\n   */\n  b: TraversableTree<T>\n  /**\n   * If true, this node's value has been modified\n   */\n  valueChanged: boolean\n  /**\n   * If true, one of the child values has changed\n   */\n  childChanged: boolean\n  /**\n   * List of new children\n   */\n  added: TraversableTree<T>[]\n  /**\n   * List of removed children\n   */\n  removed: TraversableTree<T>[]\n}\n\nexport type DiffNode<T> = TreeNode<DiffAnnotation<T>> & {\n  toString: () => string\n};\n\nexport const compare = <T>(a: TraversableTree<T>, b: TraversableTree<T>, eq: IsEqual<T> = isEqualValueIgnoreOrder, parent?: DiffNode<T>): DiffNode<T> => {\n  const valueEqual = valueOrIdentityEqual(a, b, eq);\n  // if (!valueEqual) {\n  //   nsole.log(`changed compare a: ${ toStringSingle(a) } b: ${ toStringSingle(b) }`);\n  // }\n  const childrenCompare = compareChildren(a, b, eq);\n\n  const diff: DiffAnnotation<T> = {\n    valueChanged: !valueEqual, a, b,\n    added: childrenCompare.added,\n    removed: childrenCompare.removed,\n    childChanged: false\n  }\n  const diffNode: DiffNode<T> = {\n    value: diff,\n    childrenStore: [],\n    parent\n  }\n\n  const childrenDiff = childrenCompare.identical.map(c => compare(c[ 0 ], c[ 1 ], eq, diffNode));\n  // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n  const someChildChange = hasChange(diff) || childrenDiff.some(v => hasChange(v.value!));\n  TreeMutable.setChildren(diffNode, childrenDiff);\n  //diffNode.childrenStore = childrenDiff;\n\n  diffNode.toString = () => toString(diffNode, 0);\n  // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n  diffNode.value!.childChanged = someChildChange;\n  TreeMutable.throwTreeTest(diffNode);\n\n  return diffNode;\n}\n\nconst hasChange = (vv: DiffAnnotation<any>): boolean => {\n  if (vv === undefined) return false;\n  if (vv.valueChanged) return true;\n  if (vv.childChanged) return true;\n  if (vv.added.length > 0) return true;\n  if (vv.removed.length > 0) return true;\n  return false;\n}\n\n\nconst compareChildren = <T>(a: TraversableTree<T>, b: TraversableTree<T>, eq: IsEqual<T> = isEqualValueIgnoreOrder) => {\n  const childrenOfA = [ ...a.children() ];\n  const childrenOfB = [ ...b.children() ];\n\n  const identical: [ a: TraversableTree<T>, b: TraversableTree<T> ][] = []\n  const removed: TraversableTree<T>[] = [];\n  for (const childA of childrenOfA) {\n    let foundIndex = -1;\n    for (const [ index, childOfB ] of childrenOfB.entries()) {\n      const d = valueOrIdentityEqual(childA, childOfB, eq);\n      if (d) {\n        identical.push([ childA, childOfB ]);\n        foundIndex = index;\n        break;\n      }\n    }\n    if (foundIndex === -1) {\n      // A's child not found in B's children\n      removed.push(childA);\n    } else {\n      // Found, remove it from list of B's children\n      childrenOfB.splice(foundIndex, 1);\n    }\n  }\n  const added = [ ...childrenOfB ];\n  return { added, identical, removed }\n}\n\nconst valueOrIdentityEqual = <T>(a: TraversableTree<T>, b: TraversableTree<T>, eq: IsEqual<T>): boolean => {\n  if (a.getIdentity() === b.getIdentity()) return true;\n  if (eq(a.getValue(), b.getValue())) return true;\n  return false;\n}\n\nconst toStringSingle = <T>(n: TraversableTree<T>): string => {\n  return JSON.stringify(n.getValue());\n}\n\nconst toString = <T>(n: DiffNode<T>, indent = 0): string => {\n  if (n === undefined) return `(undefined)`;\n  let t = toStringDiff(n.value, indent);\n  for (const c of n.childrenStore) {\n    t += toString(c, indent + 2);\n  }\n  return t;\n}\n\nconst toStringDiff = <T>(n: DiffAnnotation<T> | undefined, indent: number): string => {\n  const spaces = ` `.repeat(indent);\n  if (n === undefined) return `${ spaces }(undefined)`;\n  const t: string[] = [];\n  t.push(`a: ${ toStringSingle(n.a) } b: ${ toStringSingle(n.b) }`);\n  if (n.valueChanged) t.push(`Value changed. Child changed: ${ n.childChanged }`);\n  else t.push(`Value unchanged. Child changed: ${ n.childChanged }`);\n\n  if (n.added.length > 0) {\n    t.push(`Added:`);\n    for (const c of n.added) {\n      t.push(` - ` + toStringSingle(c));\n    }\n  }\n  if (n.removed.length > 0) {\n    t.push(`Removed: ${ n.removed.length }`);\n    for (const c of n.removed) {\n      t.push(` - ` + toStringSingle(c));\n    }\n  }\n  t.push(`----\\n`)\n  return t.map(line => spaces + line).join(`\\n`);\n}","import { isEqualDefault, type IsEqual } from \"@ixfx/core\"\nimport { without } from '@ixfx/arrays';\nimport { containsDuplicateInstances } from \"@ixfx/arrays\";\nimport { QueueMutable } from \"../queue/queue-mutable.js\"\nimport { StackMutable } from \"../stack/StackMutable.js\"\nimport { compare as treeCompare } from './compare.js';\nimport { toStringAbbreviate } from \"@ixfx/core/text\";\nimport type { LabelledSingleValue, TreeNode, SimplifiedNode, TraversableTree, WrappedNode } from \"./types.js\"\n\n/**\n * Compares two nodes.\n * \n * By default uses `isEqualValueIgnoreOrder` to compare nodes. This means\n * values of nodes will be compared, ignoring the order of fields.\n * @param a \n * @param b \n * @param eq Comparison function. Uses `isEqualValueIgnoreOrder` by default.\n * @returns Compare results\n */\nexport const compare = <T>(a: TreeNode<T>, b: TreeNode<T>, eq?: IsEqual<T>) => {\n  return treeCompare(asDynamicTraversable(a), asDynamicTraversable(b), eq);\n}\n\n/**\n * Converts `TreeNode` to `SimplifiedNode`, removing the 'parent' fields.\n * This can be useful because if you have the whole tree, the parent field\n * is redundant and because it makes circular references can make dumping to console etc more troublesome.\n * \n * Recursive: strips parentage of all children and so on too.\n * @param node \n * @returns \n */\nexport const stripParentage = <T>(node: TreeNode<T>): SimplifiedNode<T> => {\n  const n: SimplifiedNode<T> = {\n    value: node.value,\n    childrenStore: node.childrenStore.map(c => stripParentage(c))\n  }\n  return n;\n}\n\nconst unwrapped = <T>(node: TreeNode<T> | WrappedNode<T>) => (`wraps` in node) ? node.wraps : node;\nconst wrapped = <T>(node: TreeNode<T> | WrappedNode<T>) => (`wraps` in node) ? node : wrap(node);\n\n/**\n * Wraps node `n` for a more object-oriented means of access.\n * It will wrap child nodes on demand. For this reason, WrappedNode object\n * identity is not stable\n * @param n Node to wrap\n * @returns \n */\nexport const wrap = <T>(n: TreeNode<T>): WrappedNode<T> => {\n  return {\n    *children() {\n      for (const c of n.childrenStore) {\n        yield wrap(c)\n      }\n    },\n    getValue: () => n.value as T,\n    getIdentity: () => n,\n    *queryValue(value: T): IterableIterator<WrappedNode<T>> {\n      for (const v of queryByValue(value, unwrapped(n))) {\n        yield wrap(v);\n      }\n    },\n    *queryParentsValue<T>(child: TreeNode<T> | WrappedNode<T>, value: T, eq?: IsEqual<T>): IterableIterator<WrappedNode<T>> {\n      for (const v of queryParentsValue(unwrapped(child), value, eq)) {\n        yield wrap(v);\n      }\n    },\n    *parentsValues<T>(child: TreeNode<T> | WrappedNode<T>): IterableIterator<T> {\n      yield* parentsValues(unwrapped(child));\n    },\n    findParentsValue<T>(child: TreeNode<T>, value: T, eq: IsEqual<T>): WrappedNode<T> | undefined {\n      const n = findParentsValue(child, value, eq);\n      if (n !== undefined) return wrap(n);\n    },\n    getParent: () => n.parent === undefined ? undefined : wrap(n.parent),\n    hasParent: (parent: WrappedNode<T> | TreeNode<T>): boolean => {\n      return hasParent(n, unwrapped(parent));\n    },\n    hasAnyParent: (parent: WrappedNode<T> | TreeNode<T>): boolean => {\n      return hasAnyParent(n, unwrapped(parent));\n    },\n    hasChild: (child: WrappedNode<T> | TreeNode<T>): boolean => {\n      return hasChild(unwrapped(child), n);\n    },\n    hasAnyChild: (child: WrappedNode<T> | TreeNode<T>): boolean => {\n      return hasAnyChild(unwrapped(child), n);\n    },\n    remove: () => {\n      remove(n);\n    },\n    addValue: (value: T): WrappedNode<T> => {\n      const nodeValue = addValue(value, n);\n      return wrap(nodeValue);\n    },\n    add: (child: WrappedNode<T> | TreeNode<T>): WrappedNode<T> => {\n      add(unwrapped(child), n);\n      return wrapped(child);\n    },\n    wraps: n\n  }\n}\n\n/**\n * Removes `child` from the tree structure it is in.\n * It removes `child` from its parent. Any sub-children of `child` still remain connected.\n * @param child \n * @returns \n */\nexport const remove = <T>(child: TreeNode<T>) => {\n  const p = child.parent;\n  if (p === undefined) return;\n  child.parent = undefined;\n  p.childrenStore = without(p.childrenStore, child);\n};\n\n/**\n * Depth-first iteration of the children of `node`\n * @param node \n * @returns \n */\nexport function* depthFirst<T>(node: TreeNode<T>): IterableIterator<TreeNode<T>> {\n  if (!root) return;\n  const stack = new StackMutable<TreeNode<T>>();\n  stack.push(...node.childrenStore);\n  let entry: TreeNode<T> | undefined = stack.pop();\n  while (entry) {\n    yield entry;\n    if (entry) {\n      stack.push(...entry.childrenStore);\n    }\n    if (stack.isEmpty) break;\n    entry = stack.pop();\n  }\n}\n\n/**\n * Breadth-first iteration of the children of `node`\n * @param node \n * @returns \n */\nexport function* breadthFirst<T>(node: TreeNode<T>): IterableIterator<TreeNode<T>> {\n  if (!node) return;\n  const queue = new QueueMutable<TreeNode<T>>();\n  queue.enqueue(...node.childrenStore);\n  let entry: TreeNode<T> | undefined = queue.dequeue();\n  while (entry) {\n    yield entry;\n    if (entry) {\n      queue.enqueue(...entry.childrenStore);\n    }\n    if (queue.isEmpty) break;\n    entry = queue.dequeue();\n  }\n}\n\n/**\n * Validates the tree from `root` downwards.\n * @param root \n * @param seen \n * @returns \n */\nexport function treeTest<T>(root: TreeNode<T>, seen: TreeNode<T>[] = []): [ ok: boolean, msg: string, node: TreeNode<T> ] {\n  if (root.parent === root) return [ false, `Root has itself as parent`, root ];\n  if (seen.includes(root)) return [ false, `Same node instance is appearing further in tree`, root ];\n  seen.push(root);\n  if (containsDuplicateInstances(root.childrenStore)) return [ false, `Children list contains duplicates`, root ];\n\n  for (const c of root.childrenStore) {\n    if (c.parent !== root) return [ false, `Member of childrenStore does not have .parent set`, c ];\n    if (hasAnyChild(root, c)) return [ false, `Child has parent as its own child`, c ];\n    const v = treeTest(c, seen);\n    if (!v[ 0 ]) return v;\n  }\n  return [ true, ``, root ];\n}\n\n/**\n * Throws an exception if `root` fails tree validation\n * @param root \n * @returns \n */\nexport function throwTreeTest<T>(root: TreeNode<T>) {\n  const v = treeTest(root);\n  if (v[ 0 ]) return;\n  throw new Error(`${ v[ 1 ] } Node: ${ toStringAbbreviate(v[ 2 ].value, 30) }`, { cause: v[ 2 ] })\n}\n\n/**\n * Iterate over direct children of `root`, yielding {@link TreeNode} instances.\n * Use {@link childrenValues} to iterate over child values\n * @param root \n */\nexport function* children<T>(root: TreeNode<T>): IterableIterator<TreeNode<T>> {\n  for (const c of root.childrenStore) {\n    yield c;\n  }\n}\n\n/**\n * Iterate over the value ofdirect children of `root`.\n * Use {@link children} if you want to iterate over {@link TreeNode} instances instead.\n * @param root \n */\nexport function* childrenValues<T>(root: TreeNode<T>): IterableIterator<T> {\n  for (const c of root.childrenStore) {\n    if (typeof c.value !== `undefined`) yield c.value;\n  }\n}\n\n/**\n * Iterate over all parents of `root`. First result is the immediate parent.\n * @param root \n */\nexport function* parents<T>(root: TreeNode<T>): IterableIterator<TreeNode<T>> {\n  let p = root.parent;\n  while (p) {\n    yield p;\n    p = p.parent;\n  }\n}\n\n/**\n * Returns the depth of `node`. A root node (ie. with no parents) has a depth of 0.\n * @param node \n * @returns \n */\nexport function nodeDepth(node: TreeNode<any>): number {\n  const p = [ ...parents(node) ];\n  return p.length;\n}\n\nexport const hasChild = <T>(child: TreeNode<T>, parent: TreeNode<T>) => {\n  for (const c of parent.childrenStore) {\n    if (c === child) return true;\n  }\n  return false;\n}\n\n/**\n * Returns the first immediate child of `parent` that matches `value`.\n * \n * Use {@link queryByValue} if you want all matching children.\n * @param value \n * @param parent \n * @param eq \n * @returns \n */\nexport const findChildByValue = <T>(value: T, parent: TreeNode<T>, eq: IsEqual<T> = isEqualDefault): TreeNode<T> | undefined => {\n  for (const c of parent.childrenStore) {\n    if (eq(value, c.value as T)) return c;\n  }\n}\n\n/**\n * Yield all immediate children of `parent` that match `value`.\n * \n * Use {@link findChildByValue} if you only want the first matching child.\n * @param value \n * @param parent \n * @param eq \n */\nexport function* queryByValue<T>(value: T, parent: TreeNode<T>, eq: IsEqual<T> = isEqualDefault): IterableIterator<TreeNode<T>> {\n  for (const c of parent.childrenStore) {\n    if (eq(value, c.value as T)) yield c;\n  }\n}\n\n/**\n * Returns _true_ if `prospectiveChild` is some child node of `parent`,\n * anywhere in the tree structure.\n * \n * Use {@link hasChild} to only check immediate children.\n * @param prospectiveChild \n * @param parent \n * @returns \n */\nexport const hasAnyChild = <T>(prospectiveChild: TreeNode<T>, parent: TreeNode<T>) => {\n  for (const c of breadthFirst(parent)) {\n    if (c === prospectiveChild) return true;\n  }\n  return false;\n}\n\nexport const findAnyChildByValue = <T>(value: T, parent: TreeNode<T>, eq: IsEqual<T> = isEqualDefault) => {\n  for (const c of breadthFirst(parent)) {\n    if (eq(c.value as T, value)) return c;\n  }\n}\n\nexport const getRoot = <T>(node: TreeNode<T>): TreeNode<T> => {\n  if (node.parent) return getRoot(node.parent);\n  return node;\n}\n\n/**\n * Returns _true_ if `prospectiveParent` is any ancestor\n * parent of `child`.\n * \n * Use {@link hasParent} to only check immediate parent.\n * @param child \n * @param prospectiveParent \n * @returns \n */\nexport const hasAnyParent = <T>(child: TreeNode<T>, prospectiveParent: TreeNode<T>) => {\n  for (const p of parents(child)) {\n    if (p === prospectiveParent) return true;\n  }\n  return false;\n}\n\n/**\n * Yields the node value of each parent of `child`.\n * _undefined_ values are not returned.\n * \n * Use {@link queryParentsValue} to search for a particular value\n * @param child \n * @returns \n */\nexport function* parentsValues<T>(child: TreeNode<T>) {\n  for (const p of parents(child)) {\n    if (typeof p.value !== `undefined`) {\n      yield p.value;\n    }\n  }\n  return false;\n}\n\n/**\n * Yields all parents of `child` that have a given value.\n * Use {@link findParentsValue} to find the first match only.\n * @param child \n * @param value \n * @param eq \n * @returns \n */\nexport function* queryParentsValue<T>(child: TreeNode<T>, value: T, eq: IsEqual<T> = isEqualDefault) {\n  for (const p of parents(child)) {\n    if (typeof p.value !== `undefined`) {\n      if (eq(p.value, value)) yield p;\n    }\n  }\n  return false;\n}\n\n/**\n * Returns the first parent that has a given value.\n * @param child \n * @param value \n * @param eq \n * @returns \n */\nexport function findParentsValue<T>(child: TreeNode<T>, value: T, eq: IsEqual<T> = isEqualDefault) {\n  for (const p of queryParentsValue(child, value, eq)) {\n    return p;\n  }\n}\n/**\n * Returns _true_ if `prospectiveParent` is the immediate\n * parent of `child`.\n * \n * Use {@link hasAnyParent} to check for any ancestor parent.\n * @param child \n * @param prospectiveParent \n * @returns \n */\nexport const hasParent = <T>(child: TreeNode<T>, prospectiveParent: TreeNode<T>) => {\n  return child.parent === prospectiveParent;\n}\n\n\n/**\n * Computes the maximum depth of the tree.\n * That is, how many steps down from `node` it can go.\n * If a tree is: root -> childA -> subChildB\n * ```js\n * // Yields 2, since there are at max two steps down from root\n * computeMaxDepth(root); \n * ```\n * @param node \n * @returns \n */\nexport const computeMaxDepth = <T>(node: TreeNode<T>) => {\n  return computeMaxDepthImpl(node, 0);\n}\n\nconst computeMaxDepthImpl = <T>(node: TreeNode<T>, startingDepth = 0) => {\n  let depth = startingDepth;\n  for (const c of node.childrenStore) {\n    depth = Math.max(depth, computeMaxDepthImpl(c, startingDepth + 1));\n  }\n  return depth;\n}\n\nexport const add = <T>(child: TreeNode<T>, parent: TreeNode<T>) => {\n  throwAttemptedChild(child, parent);\n  //if (hasAnyChild(parent, child)) throw new Error(`Parent already contains child`);\n  //if (hasAnyParent(child, parent)) throw new Error(`Child already has parent`);\n  const p = child.parent;\n  parent.childrenStore = [ ...parent.childrenStore, child ];\n  child.parent = parent;\n  if (p) {\n    p.childrenStore = without(p.childrenStore, child);\n  }\n}\n\nexport const addValue = <T>(value: T | undefined, parent: TreeNode<T>) => {\n  return createNode(value, parent);\n}\n\n/**\n * Creates the root for a tree, with an optional `value`.\n * Use {@link rootWrapped} if you want a more object-oriented mode of access.\n * @param value \n * @returns \n */\nexport const root = <T>(value?: T) => {\n  return createNode(value);\n}\n\nexport const fromPlainObject = (value: Record<string, any>, label = ``, parent?: TreeNode<any>, seen: any[] = []): TreeNode<LabelledSingleValue<any>> => {\n  const entries = Object.entries(value);\n  parent = parent === undefined ? root() : addValue<LabelledSingleValue<any>>({ label, value }, parent);\n  for (const entry of entries) {\n    const value = entry[ 1 ];\n    // Avoid circular references\n    if (seen.includes(value)) continue;\n    seen.push(value);\n\n    if (typeof entry[ 1 ] === `object`) {\n      fromPlainObject(value, entry[ 0 ], parent, seen);\n    } else {\n      addValue<LabelledSingleValue<any>>({ label: entry[ 0 ], value: value }, parent);\n    }\n  }\n  return parent;\n}\n\n/**\n * Creates a tree, returning it as a {@link WrappedNode} for object-oriented access.\n * Use {@link Trees.Mutable.root} alternatively.\n * @param value \n * @returns \n */\nexport const rootWrapped = <T>(value: T | undefined) => {\n  return wrap(createNode(value));\n}\n\n/**\n * Creates a `TreeNode` instance with a given value and parent.\n * Parent node, if specified, has its `childrenStore` property changed to include new child.\n * @param value \n * @param parent \n * @returns \n */\nexport const createNode = <T>(value: T | undefined, parent?: TreeNode<T>): TreeNode<T> => {\n  const n: TreeNode<T> = {\n    childrenStore: [],\n    parent: parent,\n    value: value\n  }\n  if (parent !== undefined) {\n    parent.childrenStore = [ ...parent.childrenStore, n ];\n  }\n  return n;\n}\n\nexport const childrenLength = <T>(node: TreeNode<T>): number => {\n  return node.childrenStore.length;\n}\n\nexport const value = <T>(node: TreeNode<T>): T | undefined => {\n  return node.value;\n}\n\n/**\n * Projects `node` as a dynamic traversable.\n * Dynamic in the sense that it creates the traversable project for nodes on demand.\n * A consequence is that node identities are not stable.\n * @param node \n * @returns \n */\nexport const asDynamicTraversable = <T>(node: TreeNode<T>): TraversableTree<T> => {\n  const t: TraversableTree<T> = {\n    *children() {\n      for (const c of node.childrenStore) {\n        yield asDynamicTraversable(c);\n      }\n    },\n    getParent() {\n      if (node.parent === undefined) return;\n      return asDynamicTraversable(node.parent);\n    },\n    getValue(): any {\n      return node.value;\n    },\n    getIdentity() {\n      return node;\n    },\n  }\n  return t;\n}\n\nconst throwAttemptedChild = <T>(c: TreeNode<T>, parent: TreeNode<T>) => {\n  if (parent === c) throw new Error(`Cannot add self as child`);\n  if (c.parent === parent) return; // skip if it's already a child\n  if (hasAnyParent(parent, c)) throw new Error(`Child contains parent (1)`, { cause: c });\n  if (hasAnyParent(c, parent)) throw new Error(`Parent already contains child`, { cause: c });\n  if (hasAnyChild(parent, c)) throw new Error(`Child contains parent (2)`, { cause: c });\n}\n\nexport const setChildren = <T>(parent: TreeNode<T>, children: TreeNode<T>[]) => {\n  // Verify children are legit\n  for (const c of children) {\n    throwAttemptedChild(c, parent);\n  }\n\n  parent.childrenStore = [ ...children ];\n  for (const c of children) {\n    c.parent = parent;\n  }\n}\n\nexport const toStringDeep = <T>(node: TreeNode<T>, indent = 0): string => {\n  const t = `${ `  `.repeat(indent) } + ${ node.value ? JSON.stringify(node.value) : `-` }`;\n  return node.childrenStore.length > 0 ? (\n    t +\n    `\\n` +\n    node.childrenStore.map((d) => toStringDeep(d, indent + 1)).join(`\\n`)\n  ) : t;\n}\n\nexport function* followValue<T>(root: TreeNode<T>, continuePredicate: (nodeValue: T, depth: number) => boolean, depth = 1): IterableIterator<T | undefined> {\n  for (const c of root.childrenStore) {\n    const value = c.value;\n    if (value === undefined) continue;\n    if (continuePredicate(value, depth)) {\n      yield c.value;\n      yield* followValue(c, continuePredicate, depth + 1);\n    }\n  }\n}\n\n// export function* followNode<T>(root: Node<T>, continuePredicate: (nodeValue: T | undefined, depth: number) => boolean, depth = 1): IterableIterator<Node<T>> {\n//   for (const c of root.childrenStore) {\n//     if (continuePredicate(c.value, depth)) {\n//       yield c;\n//       yield* followNode(c, continuePredicate, depth + 1);\n//     }\n//   }\n// }","import { toStringAbbreviate } from '@ixfx/core/text';\nimport { nullUndefTest, resultThrow } from '@ixfx/guards' //'../../util/GuardEmpty.js';\nimport { last } from '@ixfx/iterables/sync';\nimport * as TreeArrayBacked from './tree-mutable.js';\nimport { isPrimitive } from '@ixfx/core'; //'../../util/IsPrimitive.js';\nimport type { TraversableTree, TreeNode, SimplifiedNode, TraverseObjectEntry, TraverseObjectEntryStatic, TraverseObjectEntryWithAncestors, TraverseObjectPathOpts, WrappedNode } from './types.js';\n\n\n/**\n * Helper function to get a 'friendly' string representation of an array of {@link TraverseObjectEntry}.\n * @param entries \n * @returns \n */\nexport function prettyPrintEntries(entries: readonly TraverseObjectEntry[]) {\n  if (entries.length === 0) return `(empty)`;\n  let t = ``;\n  for (const [ index, entry ] of entries.entries()) {\n    t += `  `.repeat(index);\n    t += entry.name + ` = ` + JSON.stringify(entry.leafValue) + `\\n`;\n  }\n  return t;\n}\n\n/**\n * Returns a human-friendly debug string for a tree-like structure\n * ```js\n * console.log(Trees.prettyPrint(obj));\n * ```\n * @param indent\n * @param node\n * @param options\n * @returns\n */\nexport const prettyPrint = (\n  node: object,\n  indent = 0,\n  options: Partial<ChildrenOptions> = {}\n): string => {\n  resultThrow(nullUndefTest(node, `node`));\n  const defaultName = options.name ?? `node`;\n  const entry = getNamedEntry(node, defaultName);\n  const t = `${ `  `.repeat(indent) } + name: ${ entry.name } value: ${ JSON.stringify(entry.leafValue) }`;\n  const childrenAsArray = [ ...children(node, options) ];\n  return childrenAsArray.length > 0 ? (\n    t +\n    `\\n` +\n    childrenAsArray.map((d) => prettyPrint(d.leafValue as object, indent + 1, { ...options, name: d.name })).join(`\\n`)\n  ) : t;\n};\n\n/**\n * Returns a debug string representation of the node (recursive)\n * @param node \n * @param indent \n * @returns \n */\nexport const toStringDeep = (node: TreeNode<TraverseObjectEntry | TraverseObjectEntryStatic>, indent = 0) => {\n  let t = ` `.repeat(indent) + ` ${ node.value?.name }`;\n  if (node.value !== undefined) {\n    if (`sourceValue` in node.value && `leafValue` in node.value) {\n      let sourceValue = toStringAbbreviate(node.value.sourceValue, 20);\n      const leafValue = toStringAbbreviate(node.value.leafValue, 20);\n      sourceValue = sourceValue === leafValue ? `` : `source: ` + sourceValue;\n      t += ` = ${ leafValue } ${ sourceValue }`\n    } else if (`sourceValue` in node.value && node.value.sourceValue !== undefined) t += ` = ${ node.value.sourceValue }`;\n\n    if (`ancestors` in node.value) {\n\n      t += ` (ancestors: ${ (node.value.ancestors).join(`, `) })`;\n    }\n  }\n  t += `\\n`\n  for (const c of node.childrenStore) {\n    t += toStringDeep(c, indent + 1);\n  }\n  return t;\n}\n\nexport type ChildrenOptions = Readonly<{\n  /**\n   * If set, only uses leaves or branches. 'none' means there is no filter.\n   */\n  filter: `none` | `leaves` | `branches`\n  /**\n   * Default name to use. This is necessary in some cases, eg a root object.\n   */\n  name: string\n}>;\n\n/**\n * Yields the direct (ie. non-recursive) children of a tree-like object as a pairing\n * of node name and value. Supports basic objects, Maps and arrays.\n * \n * To iterate recursively, consider {@link depthFirst}\n * \n * Each child is returned in an {@link TraverseObjectEntry} structure:\n * ```typescript\n * type Entry = Readonly<{\n *  // Property name\n *  name: string, \n *  // Value of property, as if you called `object[propertyName]`\n *  sourceValue: any,\n *  // Branch nodes will have _undefined_, leaf nodes will contain the value\n *  leafValue: any \n * }>;\n * ```\n * \n * For example, iterating over a flat object:\n * ```js\n * const verySimpleObject = { field: `hello`, flag: true }\n * const kids = [ ...children(verySimpleObject) ];\n * // Yields:\n * // [ { name: \"field\", sourceValue: `hello`, leafValue: `hello` },\n * //  { name: \"flag\", sourceValue: true, leafValue: true } ]\n * ```\n * \n * For objects containing objects:\n * ```js\n * const lessSimpleObject = { field: `hello`, flag: true, colour: { `red`, opacity: 0.5 } }\n * const kids = [ ...children(verySimpleObject) ];\n * // Yields as before, plus:\n * //  { name: \"colour\", sourceValue: { name: 'red', opacity: 0.5 }, leafValue: undefined }\n * ```\n * \n * Note that 'sourceValue' always contains the property value, as if you \n * access it via `object[propName]`. 'leafValue' only contains the value if it's a leaf\n * node.\n * \n * Arrays are assigned a name based on index.\n * @example Arrays\n * ```js\n * const colours = [ { r: 1, g: 0, b: 0 }, { r: 0, g: 1, b: 0 }, { r: 0, g: 0, b: 1 } ];\n * // Children: \n * // [\n * //  { name: \"array[0]\", value: {r:1,g:0,b:0} },\n * //  { name: \"array[1]\", value: {r:0,g:1,b:0} },\n * //  { name: \"array[2]\", value: {r:0,g:0,b:1} },\n * // ]\n * ```\n * \n * Pass in `options.name` (eg 'colours') to have names generated as 'colours[0]', etc.\n * Options can also be used to filter children. By default all direct children are returned.\n * @param node \n * @param options  \n */\nexport function* children(\n  node: object,\n  options: Partial<ChildrenOptions> = {}\n): IterableIterator<TraverseObjectEntry> {\n  resultThrow(nullUndefTest(node, `node`));\n\n  const filteringOption = options.filter ?? `none`;\n\n  const filterByValue = (v: any): [ filter: boolean, isPrimitive: boolean ] => {\n    if (filteringOption === `none`) return [ true, isPrimitive(v) ];\n    else if (filteringOption === `leaves` && isPrimitive(v)) return [ true, true ];\n    else if (filteringOption === `branches` && !isPrimitive(v)) return [ true, false ];\n    return [ false, isPrimitive(v) ];\n  }\n\n  if (Array.isArray(node)) {\n    //if (options.name === undefined) defaultName = `array`;\n    for (const [ index, element ] of node.entries()) {\n      const f = filterByValue(element);\n      if (f[ 0 ]) {\n        yield { name: index.toString(), _kind: `entry`, sourceValue: element, leafValue: f[ 1 ] ? element : undefined };\n        //yield { name: defaultName + `[` + index.toString() + `]`, sourceValue: element, leafValue: f[ 1 ] ? element : undefined };\n      }\n    }\n  } else if (typeof node === `object`) {\n    const entriesIter = (`entries` in node) ? (node as any as Map<any, any>).entries() : Object.entries(node);\n    for (const [ name, value ] of entriesIter) {\n      //console.log(`children name: ${ name } type: ${ typeof value } isPrim: ${ isPrimitive(value) } filter: ${ filter }`);\n      const [ filter, isPrimitive ] = filterByValue(value);\n      if (filter) {\n        yield { name: name, _kind: `entry`, sourceValue: value, leafValue: isPrimitive ? value : undefined };\n      }\n    }\n  }\n}\n\nexport function* depthFirst(node: object, options: Partial<ChildrenOptions> = {}, ancestors: string[] = []): IterableIterator<TraverseObjectEntryWithAncestors> {\n  for (const c of children(node, options)) {\n    //onsole.log(`depthFirst name: ${ c.name } leafValue: ${ toStringAbbreviate(c.leafValue) }`)\n    yield { ...c, ancestors: [ ...ancestors ], _kind: `entry-ancestors` };\n    yield* depthFirst(c.sourceValue as object, options, [ ...ancestors, c.name ]);\n  }\n}\n\n/**\n * Finds a given direct child by name\n * @param name\n * @param node\n * @returns\n */\nfunction childByName(\n  name: string,\n  node: object\n): TraverseObjectEntry | undefined {\n  for (const d of children(node)) {\n    if (d.name === name) return d;\n  }\n}\n\n/**\n * Returns the closest matching entry, tracing `path` in an array, Map or simple object.\n * Returns an entry with _undefined_ value at the point where tracing stopped.\n * Use {@link traceByPath} to step through all the segments.\n *\n * ```js\n  * const people = {\n    *  jane: {\n *   address: {\n *    postcode: 1000,\n    *    street: 'West St',\n    *    city: 'Blahville'\n *   },\n * colour: 'red'\n  *  }\n * }\n * Trees.getByPath('jane.address.postcode', people); // '.' default separator\n * // ['postcode', 1000]\n * Trees.getByPath('jane.address.country.state', people);\n * // ['country', undefined] - since full path could not be resolved.\n * ```\n * @param path Path, eg `jane.address.postcode`\n * @param node Node to look within\n * @param options Options for parsing path. By default '.' is used as a separator\n * @returns\n */\nexport function getByPath(\n  path: string,\n  node: object,\n  options: TraverseObjectPathOpts = {}\n): TraverseObjectEntryWithAncestors {\n  //  Unit tested\n  const v = last(traceByPath(path, node, options));\n  if (!v) throw new Error(`Could not trace path: ${ path } `);\n  return v;\n}\n\n/**\n * Enumerates over children of `node` towards the node named in `path`.\n * This is useful if you want to get the interim steps to the target node.\n * \n * Use {@link getByPath} if you don't care about interim steps.\n *\n * ```js\n  * const people = {\n    *  jane: {\n *   address: {\n *    postcode: 1000,\n    *    street: 'West St',\n    *    city: 'Blahville'\n *   },\n * colour: 'red'\n  *  }\n * }\n * for (const p of Trees.traceByPath('jane.address.street', people)) {\n * // { name: \"jane\", value: { address: { postcode: 1000,street: 'West St', city: 'Blahville' }, colour: 'red'} },\n * // { name: \"address\", value: { postcode: 1000, street: 'West St', city: 'Blahville' } },\n * // { name: \"street\", value: \"West St\" } }\n * }\n * ```\n *\n * Results stop when the path can't be followed any further.\n * The last entry will have a name of the last sought path segment, and _undefined_ as its value.\n * \n * @param path Path to traverse\n * @param node Starting node\n * @param options Options for path traversal logic\n * @returns\n */\nexport function* traceByPath(\n  path: string,\n  node: object,\n  options: TraverseObjectPathOpts = {}\n): Iterable<TraverseObjectEntryWithAncestors> {\n  resultThrow(\n    nullUndefTest(path, `path`),\n    nullUndefTest(node, `node`)\n  );\n\n  const separator = options.separator ?? `.`;\n  // const allowArrayIndexes = opts.allowArrayIndexes ?? true;\n  const pathSplit = path.split(separator);\n\n  const ancestors: string[] = [];\n  for (const p of pathSplit) {\n    const entry = childByName(p, node);\n    //onsole.log(`traceByPath: entry: ${ entry?.name } path: '${ path }' p: '${ p }' source: ${ JSON.stringify(entry?.sourceValue) }`);\n    // if (allowArrayIndexes) {\n    //   const [ withoutBrackets, arrayIndexString ] = betweenChomp(p, `[`, `]`);\n    //   //onsole.log(`  withoutBrackets: ${ withoutBrackets } str: ${ arrayIndexString } without: ${ withoutBrackets }`);\n    //   const arrayIndex = integerParse(arrayIndexString, `positive`, -1);\n    //   if (arrayIndex >= 0) {\n    //     // Get array by name without the []\n    //     entry = childByName(withoutBrackets, node);\n    //     //onsole.log(`  entry: ${ entry?.name }`);\n    //     if (entry && Array.isArray(entry.sourceValue)) {\n    //       // Result was array as expected\n    //       entry = { name: p, sourceValue: entry.sourceValue[ arrayIndex ], leafValue: entry.sourceValue[ arrayIndex ] };\n    //     }\n    //   }\n    // }\n\n    if (!entry) {\n      yield { name: p, sourceValue: undefined, leafValue: undefined, ancestors, _kind: `entry-ancestors` };\n      return;\n    }\n    node = entry.sourceValue;\n    yield { ...entry, ancestors: [ ...ancestors ], _kind: `entry-ancestors` };\n    ancestors.push(p);\n  }\n}\n\n/**\n * Returns a projection of `node` as a dynamic traversable.\n * This means that the tree structure is dynamically created as last-minute as possible.\n * \n * The type when calling `getValue()` is {@link TraverseObjectEntryStatic}:\n * ```typescript\n * type EntryStatic = Readonly<{ \n *  name: string,\n *  value: any\n *  ancestors: string[] \n * }>\n * ```\n * \n * Note that the object identity of TraversableTree return results is not stable.\n * This is because they are created on-the-fly by reading fields of `node`.\n * \n * ```js\n * const c1 = [ ...asDynamicTraversable(someObject).children() ];\n * const c2 = [ ...asDynamicTraversable(someObject).children() ];\n * \n * // Object identity is not the same\n * c1[ 0 ] === c1[ 0 ]; // false\n * \n * // ...even though its referring to the same value\n * c1[ 0 ].getValue() === c1[ 0 ].getValue(); // true\n * ```\n * \n * Instead .getIdentity() to get a stable identity:\n * ```js\n * c1[ 0 ].getIdentity() === c2[ 0 ].getIdentity(); // true\n * ```\n * \n * @example\n * ```js\n * import { Trees } from \"https://unpkg.com/@ixfx/collections/bundle\"\n * const myObj = { name: `Pedro`, size: 45, colour: `orange` };\n * const root = Trees.FromObject.asDynamicTraversable(myObj);\n * for (const v of Trees.Traverse.breadthFirst(root)) {\n * // v.getValue() yields:\n * // { name: 'name', sourceValue: 'Pedro' ...}, \n * // { name: 'size', sourceValue: 45 ... }\n * // ...\n * }\n * ```\n * @param node Object to read\n * @param options Options when creating traversable\n * @param ancestors Do not use\n * @param parent Do not use\n * @returns \n */\nexport const asDynamicTraversable = (node: object, options: Partial<ChildrenOptions> = {}, ancestors: string[] = [], parent?: TraversableTree<TraverseObjectEntryStatic>): TraversableTree<TraverseObjectEntryStatic> => {\n  const name = options.name ?? `object`;\n  const t: TraversableTree<TraverseObjectEntryStatic> = {\n    *children() {\n      for (const { name: childName, sourceValue, leafValue } of children(node, options)) {\n        yield asDynamicTraversable(sourceValue as object, { ...options, name: childName }, [ ...ancestors, name ], t);\n      }\n    },\n    getParent() {\n      return parent;\n    },\n    getValue() {\n      return { name, sourceValue: node, ancestors, _kind: `entry-static` };\n    },\n    getIdentity() {\n      return node;\n    }\n  }\n  return t;\n}\n\n/**\n * Reads all fields and sub-fields of `node`, returning as a 'wrapped' tree structure.\n * @param node \n * @param options \n * @returns \n */\nexport const createWrapped = (node: object, options: Partial<CreateOptions>): WrappedNode<any> => {\n  return TreeArrayBacked.wrap(create(node, options));\n};\n\nexport type CreateOptions = {\n  name: string\n  /**\n   * If _true_, only leaf nodes have values. This avoids repetition (important\n   * when comparing trees), with semantics being in the tree itself.\n   * \n   * When _false_ (default) values get decomposed down the tree. This\n   * makes it easy to get all the data for a branch of the tree.\n   * \n   * \n   * Eg if storing { person: { address { state: `qld` } } }\n   * When _true_, the tree would be:\n   * ```\n   * person, value: undefined\n   *  + address, value: undefined\n   *    + state, value: 'qld'\n   * ```\n   * But when _false_, the tree would be:\n   * ```\n   * person, value: { address: { state: `qld } }\n   *  + address, value: { state: `qld` }\n   *    + state, value: `qld`\n   * ```\n   */\n  valuesAtLeaves: boolean\n}\n\n/**\n * Reads all fields and sub-fields of `node`, returning as a basic tree structure.\n * The structure is a snapshot of the object. If the object changes afterwards, the tree will\n * remain the same.\n * \n * Alternatively, consider {@link asDynamicTraversable} which reads the object dynamically.\n * @example\n * ```js\n * import { Trees } from \"https://unpkg.com/@ixfx/collections/bundle\"\n * const myObj = { name: `Pedro`, size: 45, colour: `orange` };\n * const root = Trees.FromObject.create(myObj);\n * for (const v of Trees.Traverse.breadthFirst(root)) {\n * // v.getValue() yields:\n * // { name: 'name', sourceValue: 'Pedro' ...}, \n * // { name: 'size', sourceValue: 45 ... }\n * // ...\n * }\n * ```\n * @param node \n * @param options \n * @returns \n */\nexport const create = (node: object, options: Partial<CreateOptions> = {}): TreeNode<TraverseObjectEntryStatic> => {\n  const valuesAtLeaves = options.valuesAtLeaves ?? false;\n\n  const valueFor = valuesAtLeaves ? (v: any) => { if (isPrimitive(v)) return v; } : (v: any) => v;\n  return createImpl(node, valueFor(node), options, []);\n}\n\nconst createImpl = <T extends object>(sourceValue: T, leafValue: T, options: Partial<CreateOptions> = {}, ancestors: string[]): TreeNode<TraverseObjectEntryStatic> => {\n  const defaultName = options.name ?? `object_ci`;\n  //onsole.log(`createImpl name: ${ defaultName } leafValue: ${ JSON.stringify(leafValue) }`);\n  const r = TreeArrayBacked.root<TraverseObjectEntryStatic>({ name: defaultName, sourceValue: leafValue, ancestors: [ ...ancestors ], _kind: `entry-static` });\n  ancestors = [ ...ancestors, defaultName ];\n  for (const c of children(sourceValue, options)) {\n    const v = options.valuesAtLeaves ? c.leafValue : c.sourceValue;\n    TreeArrayBacked.add(createImpl(c.sourceValue, v, { ...options, name: c.name }, ancestors), r);\n  }\n  return r;\n}\n\n/**\n * Returns a copy of `node` with its (and all its children's) parent information removed.\n * @param node \n * @param options \n * @returns \n */\nexport const createSimplified = (node: object, options: Partial<CreateOptions> = {}): SimplifiedNode<TraverseObjectEntryStatic> => {\n  return TreeArrayBacked.stripParentage(create(node, options));\n}\n\n/**\n * Generates a name for a node.\n * Uses the 'name' property if it exists, otherwise uses `defaultName`\n * @param node\n * @param defaultName\n * @returns\n */\nfunction getNamedEntry(node: object, defaultName = ``): TraverseObjectEntry {\n  if (`name` in node && `leafValue` in node && `sourceValue` in node) return {\n    name: node.name as string,\n    _kind: `entry`,\n    leafValue: node.leafValue,\n    sourceValue: node.sourceValue\n  };\n  if (`name` in node) {\n    return { name: node.name as string, leafValue: node, sourceValue: node, _kind: `entry` };\n  }\n  return { name: defaultName, leafValue: node, sourceValue: node, _kind: `entry` };\n}\n\n// /**\n//  * Depth-first traversal over object, array, Map or TreeNode\n//  * @param root\n//  * @returns\n//  */\n// export function* depthFirst(root: object): IterableIterator<Entry> {\n//   if (!root) return;\n//   const stack = new StackMutable<Entry>();\n//   //eslint-disable-next-line functional/immutable-data\n//   stack.push(getEntry(root, `root`));\n//   //eslint-disable-next-line functional/no-let,functional/immutable-data\n//   let entry = stack.pop();\n//   while (entry) {\n//     yield entry;\n//     if (entry) {\n//       //eslint-disable-next-line functional/immutable-data\n//       stack.push(...directChildren(entry.value, entry.name));\n//     }\n//     if (stack.isEmpty) break;\n//     //eslint-disable-next-line functional/immutable-data\n//     entry = stack.pop();\n//   }\n// }\n\n// /**\n//  * Breadth-first traversal over object, array, Map or TreeNode\n//  * @param root\n//  * @returns\n//  */\n// export function* breadthFirst(root: object): IterableIterator<Entry> {\n//   if (!root) return;\n//   const queue = new QueueMutable<Entry>();\n//   queue.enqueue(getEntry(root, `root`));\n//   //eslint-disable-next-line functional/no-let\n//   let entry = queue.dequeue();\n//   while (entry) {\n//     yield entry;\n//     if (entry) {\n//       queue.enqueue(...directChildren(entry.value, entry.name));\n//     }\n//     if (queue.isEmpty) break;\n//     entry = queue.dequeue();\n//   }\n// }\n\n\n// export const fromUnknown = (node: object, name: string, parents: Array<TreeNode<any>> = []): TreeNode<any> => {\n//   const parentsWithUs = [ ...parents ];\n//   const enumerator = Array.isArray(node) ? enumerateArrayChildren : enumerateObjectChildren;\n\n//   const thisNode: TreeNode<any> = {\n//     getLengthChildren() {\n//       return [ ...enumerator(node, parentsWithUs, name) ].length\n//     },\n//     *children() {\n//       for (const c of enumerator(node, parentsWithUs, name)) {\n//         yield c;\n//       }\n//     },\n//     parents() {\n//       return parents.values()\n//     },\n//     name: name,\n//     value: node\n//   }\n//   parentsWithUs.push(thisNode);\n//   return thisNode;\n// }\n\n// function* enumerateObjectChildren(node: object, name: string): IterableIterator<Entry> {\n//   if (`entries` in node) {\n//     for (const entry of (node as any as Map<any, any>)) {\n//       yield fromUnknown(entry[ 1 ], entry[ 0 ], parents);\n//     }\n//   } else {\n//     for (const entry of Object.entries(node)) {\n//       yield fromUnknown(entry[ 1 ], entry[ 0 ], parents);\n//     }\n//   }\n// }\n\n// function* enumerateArrayChildren(node: object, parents: Array<TreeNode<any>>, name: string): IterableIterator<TreeNode<any>> {\n//   const nodeArray = node as Array<any>;\n\n//   // eslint-disable-next-line unicorn/no-for-loop\n//   for (let index = 0; index < nodeArray.length; index++) {\n//     yield fromUnknown(nodeArray[ index ], name + `[ ` + index.toString() + ` ]`, parents);\n//   }\n// }","import * as TreeArrayBacked from \"./tree-mutable.js\";\nimport type { LabelledValue, LabelledNode, TreeNode } from \"./types.js\";\n/**\n * Options for parsing a path\n */\nexport type PathOpts = Readonly<{\n  /**\n   * Separator for path, eg '.'\n   */\n  separator: string;\n  /**\n   * If two values are stored at same path, what to do? Default: overwrite\n   * * overwrite: last-write wins\n   * * ignore: first-write wins\n   * * allow: allow multiple values\n   */\n  duplicates: `overwrite` | `allow` | `ignore`\n}>;\n\n\n\n/**\n * Creates a wrapper for working with 'pathed' trees.\n * An example is a filesystem.\n * \n * ```js\n * const t = create();\n * // Store a value. Path implies a structure of\n * //   c -> users -> admin\n * // ...which is autoatically created\n * t.add({x:10}, `c.users.admin`);\n * \n * t.add({x:20}, `c.users.guest`);\n * // Tree will now be:\n * // c-> users -> admin\n * //            -> guest\n * \n * t.getValue(`c.users.guest`); // { x:20 }\n * ```\n * \n * By default only a single value can be stored at a path.\n * Set options to allow this:\n * ```js\n * const t = create({ duplicates: `allow` });\n * t.add({x:10}, `c.users.admin`);\n * t.add({x:20}, `c.users.admin`);\n * t.getValue(`c.users.admin`);   // Throws an error because there are multiple values\n * t.getValues(`c.users.admin`);  // [ {x:10}, {x:20 } ]\n * ```\n * @param pathOpts \n * @returns \n */\nexport const create = <T>(pathOpts: Partial<PathOpts> = {}) => {\n  let root: TreeNode<LabelledValue<T>> | undefined;\n\n  const add = (value: T, path: string) => {\n    const n = addValueByPath(value, path, root, pathOpts);\n    if (root === undefined) {\n      root = TreeArrayBacked.getRoot(n);\n    }\n  }\n\n  const prettyPrint = () => {\n    if (root === undefined) return `(empty)`;\n    return TreeArrayBacked.toStringDeep(root);\n  }\n\n  const getValue = (path: string): T | undefined => {\n    if (root === undefined) return;\n    return valueByPath(path, root, pathOpts);\n  }\n\n  const remove = (path: string): boolean => {\n    if (root === undefined) return false;\n    return removeByPath(path, root, pathOpts);\n  }\n\n  const hasPath = (path: string): boolean => {\n    if (root === undefined) return false;\n    const c = findChildByPath(path, root, pathOpts);\n    return c !== undefined;\n  }\n\n  const getNode = (path: string): LabelledNode<T> | undefined => {\n    if (root === undefined) return;\n    const c = findChildByPath(path, root, pathOpts);\n    return c;\n  }\n\n  const childrenLength = (path: string): number => {\n    if (root === undefined) return 0;\n    const c = findChildByPath(path, root, pathOpts);\n    if (c === undefined) return 0;\n    return c.childrenStore.length;\n  }\n\n  const getValues = (path: string): T[] => {\n    if (root === undefined) return [];\n    return valuesByPath(path, root, pathOpts);\n  }\n\n  const getRoot = () => {\n    return root;\n  }\n  const clearValues = (path: string): boolean => {\n    if (root === undefined) return false;\n    return clearValuesByPath(path, root, pathOpts);\n  }\n  return { getRoot, add, prettyPrint, remove, getValue, getValues, hasPath, childrenLength, getNode, clearValues }\n}\n\n/**\n * Adds a value by a string path, with '.' as a the default delimiter\n * Automatically generates intermediate nodes.\n *\n * ```js\n * const root = addValueByPath({}, 'c');\n * addValueByPath({x:'blah'}, 'c.users.admin', root);\n * ```\n *\n * Creates the structure:\n * ```\n * c          value: { }            label: c\n * + users    value: undefined      label: users\n *  + admin   value: { x: 'blah' }  label: admin\n * ```\n * \n * By default, multiple values under same key are overwritten, with the most recent winning.\n * @param value\n * @param path\n * @param pathOpts\n */\nexport const addValueByPath = <T>(value: T, path: string, node?: LabelledNode<T>, pathOpts: Partial<PathOpts> = {}): LabelledNode<T> => {\n  const separator = pathOpts.separator ?? `.`;\n  const duplicatePath = pathOpts.duplicates ?? `overwrite`;\n  const split = path.split(separator);\n  let count = 0;\n  for (const p of split) {\n    const lastEntry = count === split.length - 1;\n    //onsole.log(`p: ${ p }`);\n    const found = findChildByLabel(p, node);\n    if (found === undefined) {\n      //onsole.log(`  - not found`);\n      const labelled: LabelledValue<T> = {\n        value: (lastEntry ? value : undefined),\n        label: p\n      };\n      node = TreeArrayBacked.createNode(labelled, node);\n    } else {\n      node = found;\n      if (lastEntry) {\n        switch (duplicatePath) {\n          case `ignore`: {\n            break;\n          }\n          case `allow`: {\n            const existing = getValuesFromNode(node);\n            node.value = {\n              values: [ ...existing, value ],\n              label: p\n            }\n            break;\n          }\n          case `overwrite`: {\n            node.value = {\n              value,\n              label: p\n            }\n            break;\n          }\n        }\n      } else {\n        //onsole.log(`  - found!`, found.value);\n        node = found;\n      }\n    }\n    count++;\n  }\n  if (node === undefined) throw new Error(`Could not create tree`);\n  return node;\n}\n\nexport const removeByPath = <T>(path: string, root: LabelledNode<T>, pathOpts: Partial<PathOpts> = {}): boolean => {\n  if (root === undefined) return false;\n  const c = findChildByPath(path, root, pathOpts);\n  if (c === undefined) return false;\n  TreeArrayBacked.remove(c);\n  return true;\n}\n\nexport const clearValuesByPath = <T>(path: string, root: LabelledNode<T>, pathOpts: Partial<PathOpts> = {}): boolean => {\n  if (root === undefined) return false;\n  const c = findChildByPath(path, root, pathOpts);\n  if (c === undefined) return false;\n  c.value = {\n    label: c.value?.label ?? ``,\n    value: undefined\n  }\n  return true;\n}\nexport const childrenLengthByPath = <T>(path: string, node: LabelledNode<T>, pathOpts: Partial<PathOpts> = {}): number => {\n  if (node === undefined) return 0;\n  const c = findChildByPath(path, node, pathOpts);\n  if (c === undefined) return 0;\n  return c.childrenStore.length;\n}\n/**\n * Searches direct children, returning the node that has the given `label`\n * @param label\n * @returns\n */\nconst findChildByLabel = <T>(label: string, node: LabelledNode<T> | undefined): LabelledNode<T> | undefined => {\n  if (node === undefined) return undefined;\n  if (label === undefined) throw new Error(`Parameter 'label' cannot be undefined`);\n  if (node.value?.label === label) return node;\n  for (const c of node.childrenStore) {\n    if (c.value?.label === label) return c;\n  }\n}\n\nexport const valueByPath = <T>(path: string, node: LabelledNode<T>, pathOpts: Partial<PathOpts> = {}): T | undefined => {\n  const values = valuesByPath(path, node, pathOpts);\n  if (values.length === 0) return undefined;\n  if (values.length > 1) throw new Error(`Multiple values at path. Use getValues instead`);\n  return values[ 0 ];\n}\n\nconst getValuesFromNode = <T>(c: LabelledNode<T>): T[] => {\n  if (c.value === undefined) return [];\n  if (`values` in c.value) return c.value.values;\n  if (`value` in c.value) {\n    if (c.value.value === undefined) return [];\n    return [ c.value.value ];\n  }\n  return [];\n}\n\nconst findChildByPath = <T>(path: string, node: LabelledNode<T>, pathOpts: Partial<PathOpts> = {}) => {\n  const separator = pathOpts.separator ?? `.`;\n  const split = path.split(separator);\n  let c: LabelledNode<T> | undefined = node;\n  for (const p of split) {\n    c = findChildByLabel(p, c);\n    if (c === undefined) {\n      return;\n    }\n  }\n  return c;\n}\n\nexport const valuesByPath = <T>(path: string, node: LabelledNode<T>, pathOpts: Partial<PathOpts> = {}): T[] => {\n  const separator = pathOpts.separator ?? `.`;\n  const split = path.split(separator);\n  let c: LabelledNode<T> | undefined = node;\n  for (const p of split) {\n    //onsole.log(`getValue p: ${ p }`);\n    c = findChildByLabel(p, c);\n    if (c === undefined) {\n      //onsole.log(`getValue  - could not find. node: ${ JSON.stringify(node.value) }`);\n      return [];\n    }\n  }\n  return getValuesFromNode(c);\n}","import { toStringAbbreviate } from \"@ixfx/core/text\";\nimport { isEqualDefault, type IsEqual } from \"@ixfx/core\"; //\"../../util/IsEqual.js\";\nimport { QueueMutable } from \"../queue/queue-mutable.js\";\nimport { StackMutable } from \"../stack/StackMutable.js\";\nimport { isTraversable } from \"./index.js\";\nimport type { TraversableTree, TreeNode } from \"./types.js\";\n\nexport const childrenLength = <T>(tree: TraversableTree<T>): number => {\n  return [ ...tree.children() ].length;\n}\n\n/**\n * Returns _true_ if `child` is parented at any level (grand-parented etc) by `possibleParent`\n * @param child Child being sought\n * @param possibleParent Possible parent of child\n * @param eq Equality comparison function {@link isEqualDefault} used by default\n * @returns\n */\nexport const hasAnyParent = <T extends TraversableTree<TV> | TreeNode<TV>, TV>(\n  child: T,\n  possibleParent: T,\n  eq?: IsEqual<T>\n): boolean => {\n  return hasParent(child, possibleParent, eq, Number.MAX_SAFE_INTEGER);\n};\n\nexport const hasAnyParentValue = <T extends TraversableTree<TV> | TreeNode<TV>, TV>(\n  child: T,\n  possibleParentValue: TV,\n  eq?: IsEqual<TV>\n): boolean => {\n  if (typeof child === `undefined`) throw new TypeError(`Param 'child' is undefined`);\n\n  return hasParentValue<T, TV>(child, possibleParentValue, eq, Number.MAX_SAFE_INTEGER);\n};\n\nexport const findAnyParentByValue = <TValue>(\n  child: TraversableTree<TValue>,\n  possibleParentValue: TValue,\n  eq?: IsEqual<TValue>\n): TraversableTree<TValue> | undefined => {\n  return findParentByValue(child, possibleParentValue, eq, Number.MAX_SAFE_INTEGER);\n};\n\n/**\n * Returns _true_ if `child` exists within `possibleParent`. By default it only looks at the immediate\n * parent (maxDepth: 0). Use Number.MAX_SAFE_INTEGER for searching recursively upwards (or {@link hasAnyParent})\n * @param child Child being sought\n * @param possibleParent Possible parent of child\n * @param maxDepth Max depth of traversal. Default of 0 only looks for immediate parent.\n * @param eq Equality comparison function. {@link isEqualDefault} used by default.\n * @returns\n */\nexport const hasParent = <T extends TraversableTree<TV> | TreeNode<TV>, TV>(\n  child: T,\n  possibleParent: T,\n  eq: IsEqual<T> = isEqualDefault<T>,\n  maxDepth = 0\n): boolean => {\n  if (maxDepth < 0) return false;\n  const isChildTrav = isTraversable(child);\n  const isParentTrav = isTraversable(possibleParent);\n  const p = (isChildTrav ? child.getParent() : child.parent) as T;\n  if (typeof p === `undefined`) return false;\n  if (eq(p, possibleParent)) return true;\n\n\n  const pId = isChildTrav ? (p as TraversableTree<TV>).getIdentity() : (p as TreeNode<TV>).value;\n\n  const ppId = isParentTrav ? (possibleParent).getIdentity() : (possibleParent as any as TreeNode<TV>).value;\n\n  // eslint-disable-next-line @typescript-eslint/no-unsafe-argument\n  if (eq(pId, ppId)) return true;\n  //if (eq(p.getIdentity(), possibleParent.getIdentity())) return true;\n  return hasParent(p, possibleParent, eq, maxDepth - 1);\n};\n\n/**\n * Checks if a child node has a parent with a certain value\n * Note: by default only checks immediate parent. Set maxDepth to a large value to recurse\n * \n * Uses `getValue()` on the parent if that function exists.\n * @param child Node to start looking from\n * @param possibleParentValue Value to seek\n * @param eq Equality checker\n * @param maxDepth Defaults to 0, so it only checks immediate parent\n * @returns \n */\nexport const hasParentValue = <T extends TraversableTree<TV> | TreeNode<TV>, TV>(\n  child: T,\n  possibleParentValue: TV,\n  eq: IsEqual<TV> = isEqualDefault<TV>,\n  maxDepth = 0\n): boolean => {\n  if (child === undefined) throw new Error(`Param 'child' is undefined`);\n  if (maxDepth < 0) {\n    return false;\n  }\n  const p = `getParent` in child ? child.getParent() : child.parent;\n  if (p === undefined) {\n    return false;\n  }\n  const value = `getValue` in p ? p.getValue() : p.value;\n\n  if (eq(value!, possibleParentValue)) return true;\n  return hasParentValue(p, possibleParentValue, eq, maxDepth - 1);\n};\n\nexport const findParentByValue = <T extends TraversableTree<TV> | TreeNode<TV>, TV>(\n  child: T,\n  possibleParentValue: TV,\n  eq: IsEqual<TV> = isEqualDefault<TV>,\n  maxDepth = 0\n): T | undefined => {\n  if (maxDepth < 0) return;\n  const p = (`getParent` in child ? child.getParent() : child.parent) as T | undefined;\n  if (p === undefined) return;\n  const value = `getValue` in p ? p.getValue() : p.value;\n\n  if (eq(value!, possibleParentValue)) return p;\n  return findParentByValue(p, possibleParentValue, eq, maxDepth - 1);\n};\n\n/**\n * Returns _true_ if `prospectiveChild` can be legally added to `parent`.\n * _False_ is returned if:\n *  * `parent` and `prospectiveChild` are equal\n *  * `parent` already contains `prospectiveChild`\n *  * `prospectiveChild` has `parent` as its own child\n *\n * Throws an error if `parent` or `prospectiveChild` is null/undefined.\n * @param parent Parent to add to\n * @param prospectiveChild Prospective child\n * @param eq Equality function\n */\nexport const couldAddChild = <T>(\n  parent: TraversableTree<T>,\n  prospectiveChild: TraversableTree<T>,\n  eq: IsEqual<TraversableTree<T>> = isEqualDefault\n) => {\n\n  if (eq(parent, prospectiveChild)) throw new Error(`Child equals parent`);\n  if (hasAnyChild(parent, prospectiveChild, eq)) {\n    throw new Error(`Circular. Parent already has child`);\n  }\n  if (hasAnyChild(prospectiveChild, parent, eq)) {\n    throw new Error(`Prospective child has parent as child relation`);\n  }\n};\n\n/**\n * Returns _true_ if _possibleChild_ is contained within _parent_ tree.\n * That is, it is any sub-child.\n * @param parent Parent tree\n * @param possibleChild Sought child\n * @param eq Equality function, or {@link isEqualDefault} if undefined.\n * @returns\n */\nexport const hasAnyChild = <T extends TraversableTree<TV> | TreeNode<TV>, TV>(\n  parent: T,\n  possibleChild: T,\n  eq: IsEqual<T> = isEqualDefault\n): boolean => {\n  return hasChild(parent, possibleChild, eq, Number.MAX_SAFE_INTEGER);\n};\n\nexport const hasAnyChildValue = <T>(\n  parent: TraversableTree<T>,\n  possibleChildValue: T,\n  eq: IsEqual<T> = isEqualDefault\n): boolean => {\n  return hasChildValue(parent, possibleChildValue, eq, Number.MAX_SAFE_INTEGER);\n};\n\n/**\n * Returns _true_ if _possibleChild_ is contained within _maxDepth_ children\n * of _parent_ node. By default only looks at immediate children (maxDepth = 0).\n *\n * ```js\n * // Just check parentNode for childNode\n * Trees.hasChild(parentNode, childNode);\n * // See if parentNode or parentNode's parents have childNode\n * Trees.hasChild(parentNode, childNode, 1);\n * // Use custom equality function, in this case comparing on name field\n * Trees.hasChild(parentNode, childNode, 0, (a, b) => a.name === b.name);\n * ```\n * @param parent Parent tree\n * @param possibleChild Sought child\n * @param maxDepth Maximum depth. 0 for immediate children, Number.MAX_SAFE_INTEGER for boundless\n * @param eq Equality function, or {@link isEqualDefault} if undefined.\n * @returns\n */\nexport const hasChild = <T extends TraversableTree<TV> | TreeNode<TV>, TV>(\n  parent: T,\n  possibleChild: T,\n  eq: IsEqual<T> = isEqualDefault,\n  maxDepth = 0\n): boolean => {\n\n  if (maxDepth < 0) return false;\n  if (eq(parent, possibleChild)) return true;\n  const pId = `getIdentity` in parent ? parent.getIdentity() : parent.value;\n  const pcId = `getIdentity` in possibleChild ? possibleChild.getIdentity() : possibleChild.value;\n  if (eq(pId, pcId)) return true;\n  for (const c of breadthFirst(parent, maxDepth)) {\n    const cId = `getIdentity` in c ? c.getIdentity() : c.value;\n    if (eq(c, possibleChild)) return true;\n    if (eq(cId, pcId)) return true;\n  }\n  return false;\n};\n\nexport const hasChildValue = <T>(\n  parent: TraversableTree<T>,\n  possibleValue: T,\n  eq: IsEqual<T> = isEqualDefault,\n  maxDepth = 0\n): boolean => {\n\n  if (maxDepth < 0) return false;\n\n  if (eq(parent.getValue(), possibleValue)) return true;\n  for (const c of breadthFirst(parent, maxDepth)) {\n    const v = c.getValue();\n    if (eq(v, possibleValue)) return true;\n  }\n  return false;\n};\n\n/**\n * Iterates over siblings of `node`.\n * \n * Other iteration options:\n * * {@link breadthFirst}: Children, breadth-first\n * * {@link depthFirst}: Children, depth-first\n * * {@link parents}: Chain of parents, starting with immediate parent\n * * {@link siblings}: Nodes with same parent\n * @param node Node to begin from\n * @returns \n */\nexport function* siblings<T>(node: TraversableTree<T>): IterableIterator<TraversableTree<T>> {\n  const p = node.getParent();\n  if (p === undefined) return;\n  for (const s of p.children()) {\n    if (s === node) continue;\n    yield s;\n  }\n}\n\n// export function parents<T>(node: TreeNode<T>): IterableIterator<TreeNode<T>>;\n// export function parents<T>(node: TraversableTree<T>): IterableIterator<TraversableTree<T>>;\n\n/**\n * Iterates over parents of `node`, starting with immediate parent\n * \n * Other iteration options:\n * * {@link breadthFirst}: Children, breadth-first\n * * {@link depthFirst}: Children, depth-first\n * * {@link parents}: Chain of parents, starting with immediate parent\n * * {@link siblings}: Nodes with same parent\n * @param node Node to begin from\n * @returns \n */\nexport function* parents<T extends TraversableTree<TV> | TreeNode<TV>, TV>(node: T): IterableIterator<T> {\n  if (isTraversable(node)) {\n    let p = node.getParent();\n    while (p !== undefined) {\n      yield p as T;\n      p = p.getParent();\n    }\n  } else {\n    let p = node.parent;\n    while (p !== undefined) {\n      yield p as T;\n      p = p.parent\n    }\n  }\n}\n\n// export function findAnyChildByValue<TValue>(parent: TraversableTree<TValue>,\n//   possibleValue: TValue,\n//   eq?: IsEqual<TValue>\n// ): TraversableTree<TValue> | undefined;\n// export function findAnyChildByValue<TValue>(parent: TreeNode<TValue>,\n//   possibleValue: TValue,\n//   eq?: IsEqual<TValue>\n// ): TreeNode<TValue> | undefined;\n\n/**\n * Descends `parent`, breadth-first, looking for a particular value.\n * Returns _undefined_ if not found.\n * @param parent \n * @param possibleValue \n * @param eq \n * @returns \n */\nexport function findAnyChildByValue<T extends TraversableTree<TV> | TreeNode<TV>, TV>(parent: T,\n  possibleValue: TV,\n  eq: IsEqual<TV> = isEqualDefault\n): T | undefined {\n  return findChildByValue(parent, possibleValue, eq, Number.MAX_SAFE_INTEGER);\n};\n\n// export function findChildByValue<T extends TraversableTree<TV> | TreeNode<TV>, TV>(parent: T,\n//   possibleValue: TV,\n//   eq?: IsEqual<TV>,\n//   maxDepth?: number\n// ): TraversableTree<TV> | undefined;\n\n// export function findChildByValue<TValue>(parent: TreeNode<TValue>,\n//   possibleValue: TValue,\n//   eq?: IsEqual<TValue>,\n//   maxDepth?: number\n// ): TreeNode<TValue> | undefined;\n\n/**\n * Searches breadth-first for `possibleValue` under and including `parent`.\n * `maxDepth` sets he maximum level to which the tree is searched.\n * @param parent \n * @param possibleValue \n * @param eq \n * @param maxDepth \n * @returns \n */\nexport function findChildByValue<T extends TraversableTree<TV> | TreeNode<TV>, TV>(parent: T,\n  possibleValue: TV,\n  eq: IsEqual<TV> = isEqualDefault,\n  maxDepth = 0\n): T | undefined {\n\n  if (maxDepth < 0) return;\n  const isTraver = isTraversable(parent);\n  if (isTraver) {\n    if (eq(parent.getValue(), possibleValue)) return parent;\n  } else {\n    if (eq(parent.value!, possibleValue)) return parent;\n  }\n\n  for (const d of breadthFirst<T, TV>(parent, maxDepth)) {\n    // This child matches\n    if (isTraver) {\n      if (eq((d as TraversableTree<TV>).getValue(), possibleValue)) return d;\n    } else {\n      if (eq((d as TreeNode<TV>).value!, possibleValue)) return d;\n    }\n  }\n  return;\n};\n\n/**\n * Iterates over children of `root`, depth-first.\n * \n * Other iteration options:\n * * {@link breadthFirst}: Children, breadth-first\n * * {@link depthFirst}: Children, depth-first\n * * {@link parents}: Chain of parents, starting with immediate parent\n * * {@link siblings}: Nodes with same parent\n * @param root Root node \n * @returns \n */\nexport function* depthFirst<T extends TraversableTree<TV> | TreeNode<TV>, TV>(root: T): Generator<T> {\n  if (!root) return;\n  const stack = new StackMutable<T>();\n  let entry: T | undefined = root;\n  while (entry) {\n    const entries = isTraversable(entry) ?\n      [ ...entry.children() ] as T[] :\n      [ ...entry.childrenStore ] as T[]\n    stack.push(...entries);\n    if (stack.isEmpty) break;\n    entry = stack.pop();\n    if (entry) yield entry;\n  }\n}\n//export function breadthFirst<T>(root: TraversableTree<T>, depth?: number): IterableIterator<TraversableTree<T>>;\n//export function breadthFirst<T>(root: TreeNode<T>, depth?: number): IterableIterator<TreeNode<T>>;\n\n/**\n * Iterates over the children of `root`, breadth-first\n * \n * Other iteration options:\n * * {@link breadthFirst}: Children, breadth-first\n * * {@link depthFirst}: Children, depth-first\n * * {@link parents}: Chain of parents, starting with immediate parent\n * * {@link siblings}: Nodes with same parent\n * \n * @example Traversing over a simple object\n * ```js\n * import { Trees } from \"https://unpkg.com/@ixfx/collections/bundle\"\n * const myObj = { name: `Pedro`, size: 45, colour: `orange` };\n * const root = Trees.FromObject.asDynamicTraversable(myObj);\n * for (const v of Trees.Traverse.breadthFirst(root)) {\n * // v.getValue() yields:\n * // { name: 'name', sourceValue: 'Pedro' ...}, \n * // { name: 'size', sourceValue: 45 ... }\n * // ...\n * }\n * ```\n * @param root Root node\n * @param depth How many levels to traverse \n * @returns \n */\nexport function* breadthFirst<T extends TraversableTree<TV> | TreeNode<TV>, TV>(root: T, depth = Number.MAX_SAFE_INTEGER): IterableIterator<T> {\n  if (!root) return;\n  const isTrav = isTraversable(root);\n  const queue = isTrav ? new QueueMutable<TraversableTree<T>>() : new QueueMutable<TreeNode<T>>();\n\n  let entry: T | undefined = root;\n  while (entry) {\n    if (depth < 0) return;\n    if (entry !== undefined) {\n      const kids = `childrenStore` in entry ? entry.childrenStore : entry.children();\n      for (const c of kids) {\n        yield c as any;\n        queue.enqueue(c as any);\n      }\n    }\n    entry = queue.dequeue() as any as T;\n    depth--;\n  }\n}\n\n/**\n * Applies `predicate` to `root` and all its child nodes, returning the node where\n * `predicate` yields _true_.\n * Use {@link findByValue} to find a node by its value\n * @param root \n * @param predicate \n * @param order Iterate children by breadth or depth. Default 'breadth'\n * @returns \n */\nexport function find<T>(root: TraversableTree<T>, predicate: (node: TraversableTree<T>) => boolean, order: `breadth` | `depth` = `breadth`): TraversableTree<T> | undefined {\n  if (predicate(root)) return root;\n  const iter = order === `breadth` ? breadthFirst : depthFirst;\n  for (const c of iter(root)) {\n    if (predicate(c)) return c;\n  }\n}\n\n/**\n * Applies `predicate` to `root` and all its child nodes, returning the node value for\n * `predicate` yields _true_.\n * Use {@link find} to filter by nodes rather than values\n * \n * ```js\n * const n = findByValue(root, (v) => v.name === 'Bob');\n * ```\n * @param root \n * @param predicate \n * @param order Iterate children by breadth or depth. Default 'breadth'\n * @returns \n */\nexport function findByValue<T>(root: TraversableTree<T>, predicate: (nodeValue: T) => boolean, order: `breadth` | `depth` = `breadth`): TraversableTree<T> | undefined {\n  if (predicate(root.getValue())) return root;\n  const iter = order === `breadth` ? breadthFirst : depthFirst;\n\n  for (const c of iter(root)) {\n    if (predicate(c.getValue())) return c;\n  }\n}\n\n/**\n * Search through children in a path-like manner.\n * \n * It finds the first child of `root` that matches `continuePredicate`. \n * The function gets passed a depth of 1 to begin with. It recurses, looking for the next sub-child, etc.\n * \n * If it can't find a child, it stops.\n * \n * This is different to 'find' functions, which exhaustively search all possible child nodes, regardless of position in tree.\n * \n * ```js\n * const path = 'a.aa.aaa'.split('.');\n * const pred = (nodeValue, depth) => {\n *  if (nodeValue === path[0]) {\n *    path.shift(); // Remove first element\n *    return true;\n *  }\n *  return false;\n * }\n * \n * // Assuming we have a tree of string values:\n * // a\n * //   - aa\n * //       - aaa\n * //   - ab\n * // b\n * //   - ba\n * for (const c of follow(tree, pred)) {\n *  // Returns nodes: a, aa and then aaa\n * }\n * ```\n * @param root \n * @param continuePredicate \n * @param depth \n */\nexport function* followValue<T>(root: TraversableTree<T>, continuePredicate: (nodeValue: T, depth: number) => boolean, depth = 1): IterableIterator<T> {\n  for (const c of root.children()) {\n    if (continuePredicate(c.getValue(), depth)) {\n      yield c.getValue();\n      yield* followValue(c, continuePredicate, depth + 1);\n    }\n  }\n}\n\nexport function toStringDeep<T>(node: TraversableTree<T>, depth = 0) {\n  if (node === undefined) return `(undefined)`;\n  if (node === null) return `(null)`;\n  const v = node.getValue();\n  let type: string = typeof v;\n  if (Array.isArray(v)) type = `array`;\n  let t = `  `.repeat(depth) + `value: ${ JSON.stringify(v) } (${ type })\\n`;\n  for (const n of node.children()) {\n    t += toStringDeep(n, depth + 1);\n  }\n  return t;\n}\n\nexport function toString(...nodes: TraversableTree<any>[]) {\n  let t = ``;\n  for (const node of nodes) {\n    const v = node.getValue();\n    const vString = toStringAbbreviate(v);\n    const children = [ ...node.children() ];\n    const parent = node.getParent();\n    let type: string = typeof v;\n    if (Array.isArray(v)) type = `array`;\n    t += `value: ${ vString } (${ type }) kids: ${ children.length } parented: ${ parent ? `y` : `n` }\\n`;\n  }\n  return t;\n}","import { asDynamicTraversable as ObjectToTraversable } from './traverse-object.js';\nimport { asDynamicTraversable as TreeNodeToTraversable } from './tree-mutable.js';\nimport type { TraversableTree, TreeNode } from './types.js';\n\nexport * as Mutable from './tree-mutable.js';\nexport * as Pathed from './pathed.js'\nexport * as FromObject from './traverse-object.js';\nexport * as Traverse from './traversable-tree.js';\nexport * from './compare.js';\nexport type * from './types.js';\n\n/**\n * Makes a 'traversable' to move around a {@link TreeNode}, an existing {@link TraversableTree} or a plain object.\n * \n * @param node \n * @returns \n */\nexport const toTraversable = <T>(node: TreeNode<T> | TraversableTree<T> | object) => {\n  if (isTraversable(node)) return node;\n  if (isTreeNode(node)) return TreeNodeToTraversable(node);\n  if (typeof node === `object`) return ObjectToTraversable(node);\n  throw new Error(`Parameter 'node' not convertible`);\n}\n\n/**\n * Checks whether `node` is of type {@link TreeNode}.\n * \n * Checks for: parent, childrenStore and value defined on `node`.\n * @param node \n * @returns \n */\nexport const isTreeNode = (node: any): node is TreeNode<any> => {\n  if (`parent` in node && `childrenStore` in node && `value` in node) {\n    if (Array.isArray(node.childrenStore)) return true;\n  }\n  return false;\n}\n\n/**\n * Checks if `node` is of type {@link TraversableTree}.\n * \n * Checks by looking for: children, getParent, getValue and getIdentity defined on `node`.\n * @param node \n * @returns \n */\nexport const isTraversable = (node: any): node is TraversableTree<any> => {\n  return (`children` in node && `getParent` in node && `getValue` in node && `getIdentity` in node);\n}","// -------------------------\n// Immutable\n// -------------------------\nimport type { IStackImmutable } from './IStackImmutable.js';\nimport { push, pop, isEmpty, isFull, peek } from './StackFns.js';\nimport type { StackOpts } from './Types.js';\n\nexport class StackImmutable<V> implements IStackImmutable<V> {\n  private readonly opts: StackOpts;\n  /* eslint-disable-next-line functional/prefer-readonly-type */\n  readonly data: ReadonlyArray<V>;\n\n  constructor(opts: StackOpts = {}, data: ReadonlyArray<V> = []) {\n    this.opts = opts;\n    this.data = data;\n  }\n\n  push(...toAdd: ReadonlyArray<V>): StackImmutable<V> {\n    return new StackImmutable<V>(\n      this.opts,\n      push(this.opts, this.data, ...toAdd)\n    );\n  }\n\n  pop(): IStackImmutable<V> {\n    return new StackImmutable<V>(this.opts, pop(this.opts, this.data));\n  }\n\n  forEach(fn: (v: V) => void): void {\n    this.data.forEach(fn);\n  }\n\n  forEachFromTop(fn: (v: V) => void): void {\n    [ ...this.data ].reverse().forEach(fn);\n  }\n\n  get isEmpty(): boolean {\n    return isEmpty(this.opts, this.data);\n  }\n\n  get isFull(): boolean {\n    return isFull(this.opts, this.data);\n  }\n\n  get peek(): V | undefined {\n    return peek(this.opts, this.data);\n  }\n\n  get length(): number {\n    return this.data.length;\n  }\n}\n\n/**\n * Returns a stack. Immutable. Use {@link Stacks.mutable} for a mutable alternative.\n *\n * The basic usage is `push`/`pop` to add/remove, returning the modified stack. Use the\n * property `peek` to see what's on top.\n *\n * @example Basic usage\n * ```js\n * // Create\n * let s = stack();\n * // Add one or more items\n * s = s.push(1, 2, 3, 4);\n * // See what's at the top of the stack\n * s.peek;      // 4\n *\n * // Remove from the top of the stack, returning\n * // a new stack without item\n * s = s.pop();\n * s.peek;        // 3\n * ```\n * @param options Options\n * @param startingItems List of items to add to stack. Items will be pushed 'left to right', ie array index 0 will be bottom of the stack.\n */\nexport const immutable = <V>(\n  options: StackOpts = {},\n  ...startingItems: ReadonlyArray<V>\n): IStackImmutable<V> => new StackImmutable({ ...options }, [ ...startingItems ]);\n","export * from './IStack.js';\nexport * from './IStackMutable.js';\nexport * from './IStackImmutable.js';\nexport * from './StackImmutable.js';\nexport * from './StackMutable.js';\nexport type * from './Types.js';\nexport * from './StackFns.js';","//  UNIT TESTED\nimport { defaultKeyer, type ToString } from '@ixfx/core';\nimport { SimpleEventEmitter } from '@ixfx/events';//'../../Events.js';\nimport { type ISetMutable } from './ISetMutable.js';\nimport { type ValueSetEventMap } from './Types.js';\n\n/**\n * Creates a {@link ISetMutable}.\n * @param keyString Function that produces a key based on a value. If unspecified, uses `JSON.stringify`\n * @returns\n */\nexport const mutable = <V>(\n  keyString?: ToString<V>\n): ISetMutable<V> => new SetStringMutable(keyString);\n\n/**\n * Mutable string set\n */\nexport class SetStringMutable<V>\n  extends SimpleEventEmitter<ValueSetEventMap<V>>\n  implements ISetMutable<V> {\n  //  UNIT TESTED\n  /* eslint-disable functional/prefer-readonly-type */\n  store = new Map<string, V>();\n  keyString: ToString<V>;\n\n  /**\n   * Constructor\n   * @param keyString Function which returns a string version of added items. If unspecified `JSON.stringify`\n   */\n  constructor(keyString: ToString<V> | undefined) {\n    super();\n    this.keyString = keyString ?? defaultKeyer<V>;\n  }\n\n  /**\n   * Number of items stored in set\n   */\n  get size() {\n    return this.store.size;\n  }\n\n  /**\n   * Adds one or more items to set. `add` event is fired for each item\n   * @param values items to add\n   */\n  add(...values: V[]): boolean {\n    //eslint-disable-next-line functional/no-let\n    let somethingAdded = false;\n    for (const value of values) {\n      const isUpdated = this.has(value);\n      this.store.set(this.keyString(value), value);\n      super.fireEvent(`add`, { value: value, updated: isUpdated });\n      if (!isUpdated) somethingAdded = true;\n    }\n    return somethingAdded;\n  }\n\n  /**\n   * Returns values from set as an iterable\n   * @returns\n   */\n  //eslint-disable-next-line functional/prefer-tacit\n  values() {\n    return this.store.values();\n  }\n\n  /**\n   * Clear items from set\n   */\n  clear() {\n    this.store.clear();\n    super.fireEvent(`clear`, true);\n  }\n\n  /**\n   * Delete value from set.\n   * @param v Value to delete\n  * @returns _True_ if item was found and removed\n   */\n  delete(v: V): boolean {\n    const isDeleted = this.store.delete(this.keyString(v));\n    if (isDeleted) super.fireEvent(`delete`, v);\n    return isDeleted;\n  }\n\n  /**\n   * Returns _true_ if item exists in set\n   * @param v\n   * @returns\n   */\n  has(v: V): boolean {\n    return this.store.has(this.keyString(v));\n  }\n\n  /**\n   * Returns array copy of set\n   * @returns Array copy of set\n   */\n  toArray(): V[] {\n    return [ ...this.store.values() ];\n  }\n}\n","import { defaultKeyer, type ToString, toStringDefault } from '@ixfx/core';\nimport { type ISetImmutable } from './ISetImmutable.js';\n\nexport class SetStringImmutable<V> implements ISetImmutable<V> {\n  private store: Map<string, V>;\n  private keyString;\n\n  //eslint-disable-next-line functional/prefer-immutable-types\n  constructor(keyString?: ToString<V>, map?: Map<string, V>) {\n    this.store = map ?? new Map<string, V>();\n    this.keyString = keyString ?? defaultKeyer<V>;\n  }\n\n  get size(): number {\n    return this.store.size;\n  }\n\n  add(...values: readonly V[]): ISetImmutable<V> {\n    const s = new Map<string, V>(this.store);\n    for (const v of values) {\n      const key = this.keyString(v);\n      s.set(key, v);\n    }\n    return new SetStringImmutable<V>(this.keyString, s);\n  }\n\n  delete(v: V): ISetImmutable<V> {\n    const s = new Map<string, V>(this.store);\n    const key = this.keyString(v);\n    if (s.delete(key)) return new SetStringImmutable(this.keyString, s);\n    return this;\n  }\n\n  has(v: V): boolean {\n    const key = this.keyString(v);\n    return this.store.has(key);\n  }\n\n  toArray(): V[] {\n    return [ ...this.store.values() ];\n  }\n\n  *values() {\n    yield* this.store.values();\n  }\n}\n\n/**\n * Immutable set that uses a `keyString` function to determine uniqueness\n *\n * @param keyString Function that produces a key based on a value. If unspecified, uses `JSON.stringify`.\n * @returns\n */\nexport const immutable = <V>(\n  keyString: ToString<V> = toStringDefault\n): ISetImmutable<V> => new SetStringImmutable(keyString);\n","/**\n * MassiveSet supports semantics similar to Set, but without the\n * limitation on how much data is stored.\n * \n * It only supports strings, and stores data in a hierarchy.\n * \n * ```js\n * const set = new MassiveSet(); // maxDepth=1 default\n * set.add(`test`);\n * set.add(`bloorp`);\n * ```\n * \n * In the above example, it will create a subtree for the first letter\n * of each key, putting the value underneath it. So we'd get a sub\n * MassiveSet for every key starting with 't' and every one starting with 'b'.\n * \n * If `maxDepth` was 2, we'd get the same two top-level nodes, but then\n * another sub-node based on the _second_ character of the value.\n * \n * It's not a very smart data-structure since it does no self-balancing\n * or tuning.\n */\nexport class MassiveSet {\n  #depth\n  #maxDepth;\n  children = new Map<string, MassiveSet>();\n  values: Array<string> = [];\n\n  constructor(maxDepth = 1, depth = 0) {\n    this.#depth = depth;\n    this.#maxDepth = maxDepth;\n  }\n\n  /**\n   * Returns the number of values stored in just this level of the set\n   * @returns \n   */\n  sizeLocal() {\n    return this.values.length;\n  }\n\n  /**\n   * Returns the number of branches at this node\n   * Use {@link sizeChildrenDeep} to count all branches recursively\n   * @returns \n   */\n  sizeChildren() {\n    return [ ...this.children.values() ].length;\n  }\n\n  sizeChildrenDeep() {\n    let t = this.sizeChildren();\n    for (const c of this.children.values()) {\n      t += c.sizeChildrenDeep();\n    }\n    return t;\n  }\n\n  /**\n   * Returns the total number of values stored in the set\n   */\n  size() {\n    let x = this.values.length;\n    for (const set of this.children.values()) {\n      x += set.size();\n    }\n    return x;\n  }\n\n  add(value: string) {\n    if (typeof value !== `string`) throw new Error(`Param 'value' must be a string. Got: ${ typeof value }`);\n\n    if (value.length === 0) throw new Error(`Param 'value' is empty`);\n\n    const destination = this.#getChild(value, true);\n    if (destination === this) {\n      if (!this.hasLocal(value)) {\n        this.values.push(value);\n      }\n      return;\n    }\n\n    if (!destination) throw new Error(`Could not create child set for: ${ value }`);\n    destination.add(value);\n  }\n\n  remove(value: string): boolean {\n    if (typeof value !== `string`) throw new Error(`Param 'value' must be a string. Got: ${ typeof value }`);\n    if (value.length === 0) throw new Error(`Param 'value' is empty`);\n\n    const destination = this.#getChild(value, false);\n    if (destination === undefined) return false;\n    if (destination === this) {\n      if (this.hasLocal(value)) {\n        this.values = this.values.filter(v => v !== value);\n        return true;\n      }\n      return false; // Not found\n    }\n    return destination.remove(value);\n  }\n\n  debugDump() {\n    const r = this.#dumpToArray();\n    for (const rr of r) {\n      console.log(rr);\n    }\n  }\n\n  #dumpToArray(depth = 0) {\n    const r: Array<string> = [];\n    r.push(`Depth: ${ this.#depth } Max: ${ this.#maxDepth }`);\n    for (const [ key, value ] of this.children.entries()) {\n      const dumped = value.#dumpToArray(depth + 1);\n      r.push(` key: ${ key }`);\n      for (const d of dumped) {\n        r.push(` `.repeat(depth + 1) + d);\n      }\n    }\n\n    r.push(`Values: (${ this.values.length })`);\n    for (const v of this.values) {\n      r.push(` ${ v }`);\n    }\n    return r.map(line => ` `.repeat(depth) + line);\n  }\n\n  #getChild(value: string, create: boolean) {\n    if (value === undefined) throw new Error(`Param 'value' undefined`);\n    if (this.#depth === this.#maxDepth) return this;\n    if (value.length <= this.#depth) return this;\n    const k = value[ this.#depth ];\n    if (k === undefined) throw new Error(`Logic error. Depth: ${ this.#depth } Len: ${ value.length }`);\n    let child = this.children.get(k);\n    if (child === undefined && create) {\n      child = new MassiveSet(this.#maxDepth, this.#depth + 1);\n      this.children.set(k, child);\n    }\n    return child;\n  }\n\n  /**\n   * Returns _true_ if `value` stored on this node\n   * @param value \n   * @returns \n   */\n  hasLocal(value: string) {\n    for (const v of this.values) {\n      if (v === value) return true;\n    }\n    return false;\n  }\n\n  has(value: string): boolean {\n    if (typeof value !== `string`) return false;\n\n    const destination = this.#getChild(value, false);\n    if (destination === undefined) return false;\n    if (destination === this) return this.hasLocal(value);\n    return destination.has(value);\n  }\n}","\n\nexport * from './set-mutable.js';\nexport * from './SetImmutable.js';\nexport { type ISetMutable } from './ISetMutable.js';\nexport { type ISetImmutable } from './ISetImmutable.js';\nexport * from './massive-set.js';\nexport type * from './Types.js';","import { numberTest, resultThrow } from \"@ixfx/guards\";\nimport { isEqualDefault, type IsEqual } from \"@ixfx/core\";\nimport { max as IterablesMax, min as IterablesMin, last as IterablesLast } from \"@ixfx/iterables\";\nimport type { IPriorityQueueMutable, PriorityItem } from \"./ipriority-queue-mutable.js\";\nimport { QueueMutable } from \"./queue-mutable.js\";\nimport type { QueueOpts } from \"./queue-types.js\";\n\n/**\n * Simple priority queue implementation.\n * Higher numbers mean higher priority.\n * \n * ```js\n * const pm = new PriorityMutable();\n * \n * // Add items with a priority (higher numeric value = higher value)\n * pm.enqueueWithPriority(`hello`, 4);\n * pm.enqueueWithPriotity(`there`, 1);\n * \n * ```\n */\nexport class PriorityMutable<V> extends QueueMutable<PriorityItem<V>> implements IPriorityQueueMutable<V> {\n  constructor(opts: QueueOpts<PriorityItem<V>> = {}) {\n    if (opts.eq === undefined) {\n      opts = {\n        ...opts,\n        eq: (a, b) => {\n          return isEqualDefault(a.item, b.item);\n        }\n      }\n    }\n    super(opts);\n  }\n\n  /**\n   * Adds an item with a given priority\n   * @param item Item\n   * @param priority Priority (higher numeric value means higher priority)\n   */\n  enqueueWithPriority(item: V, priority: number) {\n    resultThrow(numberTest(priority, `positive`));\n    super.enqueue({ item, priority });\n  }\n\n  changePriority(item: V, priority: number, addIfMissing = false, eq?: IsEqual<V>) {\n    if (item === undefined) throw new Error(`Item cannot be undefined`);\n    let toDelete: PriorityItem<V> | undefined;\n    for (const d of this.data) {\n      if (eq) {\n        if (eq(d.item, item)) {\n          toDelete = d;\n          break;\n        }\n      } else {\n        if (this.eq(d, { item, priority: 0 })) {\n          toDelete = d;\n          break;\n        }\n      }\n    }\n    if (toDelete === undefined && !addIfMissing) throw new Error(`Item not found in priority queue. Item: ${ JSON.stringify(item) }`);\n    if (toDelete !== undefined) {\n      this.removeWhere(item => toDelete === item)\n    }\n    this.enqueueWithPriority(item, priority);\n  }\n\n  dequeueMax(): V | undefined {\n    //const m = IterablesLast(IterablesMax(this.data, v => v.priority));\n    const m = IterablesLast(IterablesMax(this.data, (a, b) => a.priority >= b.priority));\n\n    if (m === undefined) return;\n    this.removeWhere(item => item === m);\n    return m.item;\n  }\n\n  dequeueMin(): V | undefined {\n    const m = IterablesLast(IterablesMax(this.data, (a, b) => a.priority >= b.priority));\n    //const m = IterablesLast(IterablesMin(this.data, (a,b) => a.priority >= b.priority));\n    if (m === undefined) return;\n    this.removeWhere(item => item.item === m);\n    return m.item;\n  }\n\n  peekMax(): V | undefined {\n    const m = IterablesLast(IterablesMax(this.data, (a, b) => a.priority >= b.priority));\n    //const m = IterablesLast(IterablesMax(this.data, v => v.priority));\n    if (m === undefined) return;\n    return m.item;\n  }\n\n  peekMin(): V | undefined {\n    //const m = IterablesLast<V>(IterablesMin(this.data, (a,b) => a.priority >= b.priority));\n    const m = IterablesLast(IterablesMin(this.data, (a, b) => a.priority >= b.priority));\n    if (m === undefined) return;\n    return m.item;\n  }\n}\n\n/**\n * Creates a {@link PriorityMutable} queue.\n * \n * Options:\n * * eq: Equality function\n * * capacity: limit on number of items\n * * discardPolicy: what to do if capacity is reached\n * @param opts \n * @returns \n */\nexport function priority<V>(\n  opts: QueueOpts<PriorityItem<V>> = {}\n): IPriorityQueueMutable<V> {\n  return new PriorityMutable(opts);\n}","import type { IQueueImmutable } from './iqueue-immutable.js';\nimport { peek, isFull, isEmpty, enqueue, dequeue } from './queue-fns.js';\nimport { type QueueOpts } from './queue-types.js';\n\n// -------------------------------\n// Immutable\n// -------------------------------\nexport class QueueImmutable<V> implements IQueueImmutable<V> {\n  readonly opts: QueueOpts<V>;\n  #data: readonly V[];\n\n  /**\n   * Creates an instance of Queue.\n   * @param {QueueOpts} opts Options foor queue\n   * @param {V[]} data Initial data. Index 0 is front of queue\n   */\n  constructor(opts: QueueOpts<V> = {}, data: readonly V[] = []) {\n    if (opts === undefined) throw new Error(`opts parameter undefined`);\n\n    this.opts = opts;\n    this.#data = data;\n  }\n\n  forEach(fn: (v: V) => void) {\n    //eslint-disable-next-line functional/no-let\n    for (let index = this.#data.length - 1; index >= 0; index--) {\n      fn(this.#data[ index ]);\n    }\n  }\n\n  forEachFromFront(fn: (v: V) => void) {\n    // From front of queue\n\n    this.#data.forEach(item => { fn(item) }); //(vv) => fn(vv));\n  }\n\n  enqueue(...toAdd: readonly V[] | V[]): QueueImmutable<V> {\n    return new QueueImmutable<V>(\n      this.opts,\n      enqueue(this.opts, this.#data, ...toAdd)\n    );\n  }\n\n  dequeue(): QueueImmutable<V> {\n    return new QueueImmutable<V>(this.opts, dequeue(this.opts, this.#data));\n  }\n\n  get isEmpty(): boolean {\n    return isEmpty(this.opts, this.#data);\n  }\n\n  get isFull(): boolean {\n    return isFull(this.opts, this.#data);\n  }\n\n  get length(): number {\n    return this.#data.length;\n  }\n\n  get peek(): V | undefined {\n    return peek(this.opts, this.#data);\n  }\n\n  toArray() {\n    return [ ...this.#data ];\n  }\n}\n\n/**\n * Returns an immutable queue. Queues are useful if you want to treat 'older' or 'newer'\n * items differently. _Enqueing_ adds items at the back of the queue, while\n * _dequeing_ removes items from the front (ie. the oldest).\n *\n * ```js\n * let q = Queues.immutable();           // Create\n * q = q.enqueue(`a`, `b`);   // Add two strings\n * const front = q.peek();    // `a` is at the front of queue (oldest)\n * q = q.dequeue();           // q now just consists of `b`\n * ```\n * @example Cap size to 5 items, throwing away newest items already in queue.\n * ```js\n * const q = Queues.immutable({capacity: 5, discardPolicy: `newer`});\n * ```\n *\n * @typeParam V - Type of values stored\n * @param options\n * @param startingItems Index 0 is the front of the queue\n * @returns A new queue\n */\nexport const immutable = <V>(\n  options: QueueOpts<V> = {},\n  ...startingItems: readonly V[]\n): IQueueImmutable<V> => {\n  options = { ...options }; // Make a copy of options\n  return new QueueImmutable(options, [ ...startingItems ]); // Make a copy of array so it can't be modified\n};\n","export type * from './ipriority-queue-mutable.js';\nexport type * from './iqueue-immutable.js';\nexport type * from './iqueue-mutable.js';\nexport * from './priority-mutable.js';\nexport { immutable, QueueImmutable } from './queue-immutable.js';\nexport { mutable, QueueMutable } from './queue-mutable.js';\nexport type * from './queue-types.js';\n//export * from './Responsive.js';\nexport * from './queue-fns.js';","import { SimpleEventEmitter } from '@ixfx/events';\nimport { sortByValueProperty } from '@ixfx/core/maps';\nimport { intervalToMs, type Interval } from '@ixfx/core';\nimport { integerTest, resultThrow } from '@ixfx/guards';\n\n/**\n * Expiring map options\n */\nexport type Opts = {\n  /**\n   * Capacity limit\n   */\n  readonly capacity?: number;\n  /**\n   * Policy for evicting items if capacity is reached\n   */\n  readonly evictPolicy?: `none` | `oldestGet` | `oldestSet`;\n  /**\n   * Automatic deletion policy.\n   * none: no automatic deletion (default)\n   * get/set: interval based on last get/set\n   * either: if either interval has elapsed\n   */\n  readonly autoDeletePolicy?: `none` | `get` | `set` | `either`;\n  /**\n   * Automatic deletion interval\n   */\n  readonly autoDeleteElapsedMs?: number;\n};\n\ntype Item<V> = {\n  readonly value: V;\n  readonly lastSet: number;\n  readonly lastGet: number;\n};\n\n/**\n * Event from the ExpiringMap\n */\nexport type ExpiringMapEvent<K, V> = {\n  readonly key: K;\n  readonly value: V;\n};\n\nexport type ExpiringMapEvents<K, V> = {\n  /**\n   * Fires when an item is removed due to eviction\n   * or automatic expiry\n   */\n  readonly expired: ExpiringMapEvent<K, V>;\n  /**\n   * Fires when a item with a new key is added\n   */\n  readonly newKey: ExpiringMapEvent<K, V>;\n\n  /**\n   * Fires when an item is manually removed,\n   * removed due to eviction or automatic expiry\n   */\n  readonly removed: ExpiringMapEvent<K, V>;\n};\n\n/**\n * Create a ExpiringMap instance\n * @param options Options when creating map\n * @returns\n */\nexport const create = <K, V>(options: Opts = {}): ExpiringMap<K, V> =>\n  new ExpiringMap(options);\n/***\n * A map that can have a capacity limit. The elapsed time for each get/set\n * operation is maintained allowing for items to be automatically removed.\n * `has()` does not affect the last access time.\n *\n * By default, it uses the `none` eviction policy, meaning that when full\n * an error will be thrown if attempting to add new keys.\n *\n * Eviction policies:\n * `oldestGet` removes the item that hasn't been accessed the longest,\n * `oldestSet` removes the item that hasn't been updated the longest.\n *\n * ```js\n * const map = new ExpiringMap();\n * map.set(`fruit`, `apple`);\n *\n * // Remove all entries that were set more than 100ms ago\n * map.deleteWithElapsed(100, `set`);\n * // Remove all entries that were last accessed more than 100ms ago\n * map.deleteWithElapsed(100, `get`);\n * // Returns the elapsed time since `fruit` was last accessed\n * map.elapsedGet(`fruit`);\n * // Returns the elapsed time since `fruit` was last set\n * map.elapsedSet(`fruit`);\n * ```\n *\n * Last set/get time for a key can be manually reset using {@link touch}.\n *\n *\n * Events:\n * * 'expired': when an item is automatically removed.\n * * 'removed': when an item is manually or automatically removed.\n * * 'newKey': when a new key is added\n *\n * ```js\n * map.addEventListener(`expired`, evt => {\n *  const { key, value } = evt;\n * });\n * ```\n * The map can automatically remove items based on elapsed intervals.\n *\n * @example\n * Automatically delete items that haven't been accessed for one second\n * ```js\n * const map = new ExpiringMap({\n *  autoDeleteElapsed: 1000,\n *  autoDeletePolicy: `get`\n * });\n * ```\n *\n * @example\n * Automatically delete the oldest item if we reach a capacity limit\n * ```js\n * const map = new ExpiringMap({\n *  capacity: 5,\n *  evictPolicy: `oldestSet`\n * });\n * ```\n * @typeParam K - Type of keys\n * @typeParam V - Type of values\n */\nexport class ExpiringMap<K, V> extends SimpleEventEmitter<\n  ExpiringMapEvents<K, V>\n> {\n  private capacity: number;\n  private store: Map<K, Item<V>>;\n  //private keyCount: number;\n  private evictPolicy;\n\n  private autoDeleteElapsedMs: number;\n  private autoDeletePolicy;\n  private autoDeleteTimer: ReturnType<typeof setInterval> | undefined;\n  private disposed = false;\n  constructor(opts: Opts = {}) {\n    super();\n    this.capacity = opts.capacity ?? -1;\n\n    resultThrow(integerTest(this.capacity, `nonZero`, `capacity`));\n    this.store = new Map();\n    //this.keyCount = 0;\n\n    if (opts.evictPolicy && this.capacity <= 0) {\n      throw new Error(`evictPolicy is set, but no capacity limit is set`);\n    }\n    this.evictPolicy = opts.evictPolicy ?? `none`;\n    this.autoDeleteElapsedMs = opts.autoDeleteElapsedMs ?? -1;\n    this.autoDeletePolicy = opts.autoDeletePolicy ?? `none`;\n\n    if (this.autoDeleteElapsedMs > 0) {\n      this.autoDeleteTimer = setInterval(\n        () => { this.#maintain(); },\n        Math.max(1000, this.autoDeleteElapsedMs * 2)\n      );\n    }\n  }\n\n  dispose() {\n    if (this.disposed) return;\n    this.disposed = true;\n    if (this.autoDeleteTimer) {\n      clearInterval(this.autoDeleteTimer)\n      this.autoDeleteTimer = undefined;\n    }\n  }\n  /**\n   * Returns the number of keys being stored.\n   */\n  get keyLength() {\n    return this.store.size;// keyCount;\n  }\n\n  *entries(): IterableIterator<[ k: K, v: V ]> {\n    for (const entry of this.store.entries()) {\n      yield [ entry[ 0 ], entry[ 1 ].value ];\n    }\n  }\n\n  *values(): IterableIterator<V> {\n    for (const v of this.store.values()) {\n      yield v.value;\n    }\n  }\n\n  *keys(): IterableIterator<K> {\n    yield* this.store.keys();\n  }\n\n  /**\n   * Returns the elapsed time since `key`\n   * was set. Returns _undefined_ if `key`\n   * does not exist\n   */\n  elapsedSet(key: K): number | undefined {\n    const v = this.store.get(key);\n    if (typeof v === `undefined`) return;\n    return Date.now() - v.lastSet;\n  }\n\n  /**\n   * Returns the elapsed time since `key`\n   * was accessed. Returns _undefined_ if `key`\n   * does not exist\n   */\n  elapsedGet(key: K): number | undefined {\n    const v = this.store.get(key);\n    if (typeof v === `undefined`) return;\n    return Date.now() - v.lastGet;\n  }\n\n  /**\n   * Returns true if `key` is stored.\n   * Does not affect the key's last access time.\n   * @param key\n   * @returns\n   */\n  has(key: K): boolean {\n    return this.store.has(key);\n  }\n\n  /**\n   * Gets an item from the map by key, returning\n   * undefined if not present\n   * @param key Key\n   * @returns Value, or undefined\n   */\n  get(key: K): V | undefined {\n    const v = this.store.get(key);\n    if (v) {\n      if (this.autoDeletePolicy === `either` || this.autoDeletePolicy === `get`) {\n        this.store.set(key, {\n          ...v,\n          lastGet: performance.now(),\n        });\n      }\n      return v.value;\n    }\n  }\n\n  /**\n   * Deletes the value under `key`, if present.\n   *\n   * Returns _true_ if something was removed.\n   * @param key\n   * @returns\n   */\n  delete(key: K): boolean {\n    const value = this.store.get(key);\n    if (!value) return false;\n    const d = this.store.delete(key);\n    //this.keyCount = this.keyCount - 1;\n    this.fireEvent(`removed`, {\n      key,\n      value: value.value,\n    });\n    return d;\n  }\n\n  /**\n   * Clears the contents of the map.\n   * Note: does not fire `removed` event\n   */\n  clear() {\n    this.store.clear();\n  }\n\n  /**\n   * Updates the lastSet/lastGet time for a value\n   * under `k`.\n   *\n   * Returns false if key was not found\n   * @param key\n   * @returns\n   */\n  touch(key: K): boolean {\n    const v = this.store.get(key);\n    if (!v) return false;\n    this.store.set(key, {\n      ...v,\n      lastSet: Date.now(),\n      lastGet: Date.now(),\n    });\n    return true;\n  }\n\n  private findEvicteeKey(): K | undefined {\n    if (this.evictPolicy === `none`) return;\n    let sortBy = ``;\n    if (this.evictPolicy === `oldestGet`) sortBy = `lastGet`;\n    else if (this.evictPolicy === `oldestSet`) sortBy = `lastSet`;\n    else throw new Error(`Unknown eviction policy ${ this.evictPolicy }`);\n    const sorted = sortByValueProperty(this.store, sortBy);\n    return sorted[ 0 ][ 0 ];\n  }\n\n  #maintain() {\n    if (this.autoDeletePolicy === `none`) return;\n    this.deleteWithElapsed(this.autoDeleteElapsedMs, this.autoDeletePolicy);\n  }\n\n  /**\n   * Deletes all values where elapsed time has past\n   * for get/set or either.\n   * ```js\n   * // Delete all keys (and associated values) not accessed for a minute\n   * em.deleteWithElapsed({mins:1}, `get`);\n   * // Delete things that were set 1s ago\n   * em.deleteWithElapsed(1000, `set`);\n   * ```\n   * \n   * @param interval Interval\n   * @param property Basis for deletion 'get','set' or 'either'\n   * @returns Items removed\n   */\n  deleteWithElapsed(\n    interval: Interval,\n    property: `get` | `set` | `either`\n  ): [ k: K, v: V ][] {\n    const entries = [ ...this.store.entries() ];\n    const prune: [ k: K, v: V ][] = [];\n    const intervalMs = intervalToMs(interval, 1000);\n    const now = performance.now();\n    for (const entry of entries) {\n      const elapsedGet = now - entry[ 1 ].lastGet;\n      const elapsedSet = now - entry[ 1 ].lastSet;\n      const elapsed =\n        property === `get`\n          ? elapsedGet\n          : (property === `set`\n            ? elapsedSet\n            : Math.max(elapsedGet, elapsedSet));\n      if (elapsed >= intervalMs) {\n        prune.push([ entry[ 0 ], entry[ 1 ].value ]);\n      }\n    }\n\n    for (const entry of prune) {\n      this.store.delete(entry[ 0 ]);\n      //this.keyCount = this.keyCount - 1;\n      const eventArguments = {\n        key: entry[ 0 ],\n        value: entry[ 1 ],\n      };\n      this.fireEvent(`expired`, eventArguments);\n      this.fireEvent(`removed`, eventArguments);\n    }\n    return prune;\n  }\n\n  /**\n   * Sets the `key` to be `value`.\n   *\n   * If the key already exists, it is updated.\n   *\n   * If the map is full, according to its capacity,\n   * another value is selected for removal.\n   * @param key\n   * @param value\n   * @returns\n   */\n  set(key: K, value: V) {\n    const existing = this.store.get(key);\n\n    if (existing) {\n      // Update set time\n      this.store.set(key, {\n        ...existing,\n        lastSet: performance.now(),\n      });\n      return;\n    }\n\n    // New key\n    if (this.keyLength === this.capacity && this.capacity > 0) {\n      // Evict first\n      const key = this.findEvicteeKey();\n      if (!key) {\n        throw new Error(`ExpiringMap full (capacity: ${ this.capacity })`);\n      }\n      const existing = this.store.get(key);\n      this.store.delete(key);\n      //this.keyCount = this.keyCount - 1;\n      if (existing) {\n        const eventArguments = { key, value: existing.value };\n        this.fireEvent(`expired`, eventArguments);\n        this.fireEvent(`removed`, eventArguments);\n      }\n    }\n\n    //this.keyCount++;\n    this.store.set(key, {\n      lastGet: 0,\n      lastSet: performance.now(),\n      value: value,\n    });\n\n    this.fireEvent(`newKey`, { key, value });\n  }\n}\n","//  UNIT TESTED\n\nimport { type IsEqual, isEqualDefault } from '@ixfx/core';\nimport type { IMapOf } from './imap-of.js';\nimport type { IWithEntries } from '@ixfx/core';\n\n/**\n * Finds first entry by iterable value. Expects a map with an iterable as values.\n *\n * ```js\n * const map = new Map();\n * map.set('hello', ['a', 'b', 'c']);\n * map.set('there', ['d', 'e', 'f']);\n *\n * const entry = firstEntry(map, (value, key) => {\n *  return (value === 'e');\n * });\n * // Entry is: ['there', ['d', 'e', 'f']]\n * ```\n *\n * An alternative is {@link firstEntryByValue} to search by value.\n * @param map Map to search\n * @param predicate Filter function returns true when there is a match of value\n * @returns Entry, or _undefined_ if `filter` function never returns _true_\n */\nexport const firstEntry = <K, V>(\n  map: IWithEntries<K, Iterable<V>>,\n  predicate: (value: V, key: K) => boolean\n): readonly [ key: K, value: Iterable<V> ] | undefined => {\n  for (const e of map.entries()) {\n    const value = e[ 1 ];\n    for (const subValue of value) {\n      if (predicate(subValue, e[ 0 ])) return e;\n    }\n  }\n};\n\n/**\n * Returns the size of the largest key, or 0 if empty.\n */\nexport const lengthMax = <V>(map: IMapOf<V>): number => {\n  //eslint-disable-next-line functional/no-let\n  let largest: readonly [ string, number ] = [ '', 0 ];\n  for (const e of map.keysAndCounts()) {\n    if (e[ 1 ] > largest[ 1 ]) {\n      largest = e;\n    }\n  }\n  return largest[ 1 ];\n};\n\n/**\n * Finds first entry by iterable value. Expects a map with an iterable as values.\n *\n * ```js\n * const map = new Map();\n * map.set('hello', ['a', 'b', 'c']);\n * map.set('there', ['d', 'e', 'f']);\n *\n * const entry = firstEntryByValue(map, 'e');\n * // Entry is: ['there', ['d', 'e', 'f']]\n * ```\n *\n * An alternative is {@link firstEntry} to search by predicate function.\n * @param map Map to search\n * @param value Value to seek\n * @param isEqual Filter function which checks equality. Uses JS comparer by default.\n * @returns Entry, or _undefined_ if `value` not found.\n */\nexport const firstEntryByValue = <K, V>(\n  map: IWithEntries<K, Iterable<V>>,\n  value: V,\n  isEqual: IsEqual<V> = isEqualDefault\n): readonly [ key: K, value: Iterable<V> ] | undefined => {\n  for (const e of map.entries()) {\n    const value_ = e[ 1 ];\n    for (const subValue of value_) {\n      if (isEqual(subValue, value)) return e;\n    }\n  }\n};\n","import { defaultKeyer, type IsEqual, isEqualDefault } from '@ixfx/core';\nimport { firstEntryByValue } from './map-multi-fns.js';\n\nexport class MapOfSimpleBase<V> {\n  protected map: Map<string, readonly V[]>;\n  protected readonly groupBy;\n  protected valueEq;\n\n  /**\n   * Constructor\n   * @param groupBy Creates keys for values when using `addValue`. By default uses JSON.stringify\n   * @param valueEq Compare values. By default uses JS logic for equality\n   */\n  constructor(\n    groupBy: (value: V) => string = defaultKeyer,\n    valueEq: IsEqual<V> = isEqualDefault<V>,\n    initial: [ string, readonly V[] ][] = []\n  ) {\n    this.groupBy = groupBy;\n    this.valueEq = valueEq;\n    this.map = new Map(initial);\n  }\n\n  /**\n   * Returns _true_ if `key` exists\n   * @param key\n   * @returns\n   */\n  has(key: string): boolean {\n    return this.map.has(key);\n  }\n\n  /**\n   * Returns _true_ if `value` exists under `key`.\n   * @param key Key\n   * @param value Value to seek under `key`\n   * @returns _True_ if `value` exists under `key`.\n   */\n  hasKeyValue(key: string, value: V): boolean {\n    const values = this.map.get(key);\n    if (!values) return false;\n    for (const v of values) {\n      if (this.valueEq(v, value)) return true;\n    }\n    return false;\n  }\n\n  /**\n   * Debug dump of contents\n   * @returns\n   */\n  debugString(): string {\n    let r = ``;\n    const keys = [ ...this.map.keys() ];\n    keys.every((k) => {\n      const v = this.map.get(k);\n      if (v === undefined) return;\n      r += k + ` (${ v.length }) = ${ JSON.stringify(v) }\\r\\n`;\n    });\n    return r;\n  }\n\n  /**\n   * Return number of values stored under `key`.\n   * Returns 0 if `key` is not found.\n   * @param key\n   * @returns\n   */\n  count(key: string): number {\n    const values = this.map.get(key);\n    if (!values) return 0;\n    return values.length;\n  }\n\n\n  /**\n * Returns first key that contains `value`\n * @param value \n * @param eq \n * @returns \n */\n  firstKeyByValue(value: V, eq: IsEqual<V> = isEqualDefault) {\n    const entry = firstEntryByValue(this, value, eq);\n    if (entry) return entry[ 0 ];\n  }\n\n  /**\n   * Iterate over all entries\n   */\n  *entriesFlat(): IterableIterator<[ key: string, value: V ]> {\n    for (const key of this.map.keys()) {\n      for (const value of this.map.get(key)!) {\n        yield [ key, value ];\n      }\n    }\n  }\n\n  /**\n   * Iterate over keys and array of values for that key\n   */\n  *entries(): IterableIterator<[ key: string, value: V[] ]> {\n    for (const [ k, v ] of this.map.entries()) {\n      yield [ k, [ ...v ] ];\n    }\n  }\n\n\n  /**\n   * Get all values under `key`\n   * @param key\n   * @returns\n   */\n  *get(key: string): IterableIterator<V> {\n    const m = this.map.get(key);\n    if (!m) return;\n    yield* m.values();\n  }\n\n  /**\n   * Iterate over all keys\n   */\n  *keys(): IterableIterator<string> {\n    yield* this.map.keys();\n  }\n\n  /**\n   * Iterate over all values (regardless of key).\n   * Use {@link values} to iterate over a set of values per key\n   */\n  *valuesFlat(): IterableIterator<V> {\n    for (const entries of this.map) {\n      yield* entries[ 1 ];\n    }\n  }\n\n  /**\n   * Yields the values for each key in sequence, returning an array.\n   * Use {@link valuesFlat} to iterate over all keys regardless of key.\n   */\n  *values(): IterableIterator<readonly V[]> {\n    for (const entries of this.map) {\n      yield entries[ 1 ];\n    }\n  }\n  /**\n   * Iterate over keys and length of values stored under keys\n   */\n  *keysAndCounts(): IterableIterator<[ string, number ]> {\n    for (const entries of this.map) {\n      yield [ entries[ 0 ], entries[ 1 ].length ];\n    }\n  }\n\n  /**\n   * Returns the count of keys.\n   */\n  get lengthKeys() {\n    return this.map.size;\n  }\n\n  /**\n  * _True_ if empty\n  */\n  get isEmpty(): boolean {\n    return this.map.size === 0;\n  }\n\n}\n","import { defaultKeyer, type IsEqual, isEqualDefault } from '@ixfx/core';\nimport type { IMapOfMutable } from './imap-of-mutable.js';\nimport { MapOfSimpleBase } from './map-of-simple-base.js';\n\n/**\n * A simple mutable map of arrays, without events. It can store multiple values\n * under the same key.\n *\n * For a fancier approaches, consider ofArrayMutable, ofCircularMutable or ofSetMutable.\n *\n * @example\n * ```js\n * const m = mapOfSimpleMutable();\n * m.add(`hello`, 1, 2, 3); // Adds numbers under key `hello`\n * m.delete(`hello`);       // Deletes everything under `hello`\n *\n * const hellos = m.get(`hello`); // Get list of items under `hello`\n * ```\n *\n * Constructor takes a `groupBy` parameter, which yields a string key for a value. This is the\n * basis by which values are keyed when using `addValues`.\n *\n * Constructor takes a `valueEq` parameter, which compares values. This is used when checking\n * if a value exists under a key, for example.\n * @typeParam V - Type of items\n */\nexport class MapOfSimpleMutable<V>\n  extends MapOfSimpleBase<V>\n  implements IMapOfMutable<V> {\n\n  addKeyedValues(key: string, ...values: readonly V[]) {\n    const existing = this.map.get(key);\n    if (existing === undefined) {\n      this.map.set(key, values);\n    } else {\n      this.map.set(key, [ ...existing, ...values ]);\n    }\n  }\n\n  /**\n   * Set `values` to `key`.\n   * Previous data stored under `key` is thrown away.\n   * @param key \n   * @param values \n   */\n  setValues(key: string, values: readonly V[]) {\n    this.map.set(key, values);\n  }\n\n  /**\n   * Adds a value, automatically extracting a key via the\n   * `groupBy` function assigned in the constructor options.\n   * @param values Adds several values\n   */\n  addValue(...values: readonly V[]) {\n    for (const v of values) {\n      const key = this.groupBy(v);\n      this.addKeyedValues(key, v);\n    }\n  }\n\n  /**\n   * Delete `value` under a particular `key`\n   * @param key\n   * @param value\n   * @returns _True_ if `value` was found under `key`\n   */\n  deleteKeyValue(key: string, value: V): boolean {\n    const existing = this.map.get(key);\n    if (existing === undefined) return false;\n    const without = existing.filter((existingValue) => !this.valueEq(existingValue, value));\n    this.map.set(key, without);\n    return without.length < existing.length;\n  }\n\n  /**\n   * Deletes `value` regardless of key.\n   *\n   * Uses the constructor-defined equality function.\n   * @param value Value to delete\n   * @returns\n   */\n  deleteByValue(value: V): boolean {\n    let del = false;\n    const entries = [ ...this.map.entries() ];\n    for (const keyEntries of entries) {\n      for (const values of keyEntries[ 1 ]) {\n        if (this.valueEq(values, value)) {\n          del = true;\n          this.deleteKeyValue(keyEntries[ 0 ], value);\n        }\n      }\n    }\n    return del;\n  }\n\n  /**\n   * Deletes all values under `key`,\n   * @param key\n   * @returns _True_ if `key` was found and values stored\n   */\n  delete(key: string): boolean {\n    const values = this.map.get(key);\n    if (!values) return false;\n    if (values.length === 0) return false;\n    this.map.delete(key);\n    return true;\n  }\n\n  /**\n   * Clear contents\n   */\n  clear() {\n    this.map.clear();\n  }\n}\n\n/**\n * A simple mutable map of arrays, without events. It can store multiple values\n * under the same key.\n *\n * For a fancier approaches, consider {@link ofArrayMutable}, {@link ofCircularMutable} or {@link ofSetMutable}.\n *\n * @example\n * ```js\n * const m = mapOfSimpleMutable();\n * m.add(`hello`, 1, 2, 3); // Adds numbers under key `hello`\n * m.delete(`hello`);       // Deletes everything under `hello`\n *\n * const hellos = m.get(`hello`); // Get list of items under `hello`\n * ```\n *\n * @typeParam V - Type of items\n * @returns New instance\n */\nexport const ofSimpleMutable = <V>(\n  groupBy: (value: V) => string = defaultKeyer,\n  valueEq: IsEqual<V> = isEqualDefault<V>\n): IMapOfMutable<V> => new MapOfSimpleMutable<V>(groupBy, valueEq);\n","import type { ArrayKeys, EitherKey, ObjectKeys } from '../types.js';\n\n/**\n * Adds an array o [k,v] to the map, returning a new instance\n * @param map Initial data\n * @param data Data to add\n * @returns New map with data added\n */\nconst addArray = <K, V>(\n  map: ReadonlyMap<K, V>,\n  data: ArrayKeys<K, V>\n): ReadonlyMap<K, V> => {\n  const x = new Map<K, V>(map.entries());\n  for (const d of data) {\n    if (d[ 0 ] === undefined) throw new Error(`key cannot be undefined`);\n    if (d[ 1 ] === undefined) throw new Error(`value cannot be undefined`);\n    x.set(d[ 0 ], d[ 1 ]);\n  }\n  return x;\n};\n\n/**\n * Adds objects to the map, returning a new instance\n * @param map Initial data\n * @param data Data to add\n * @returns A new map with data added\n */\nconst addObjects = <K, V>(\n  map: ReadonlyMap<K, V>,\n  data: ObjectKeys<K, V>\n): ReadonlyMap<K, V> => {\n  const x = new Map<K, V>(map.entries());\n  for (const d of data) {\n    if (d.key === undefined) throw new Error(`key cannot be undefined`);\n    if (d.value === undefined) throw new Error(`value cannot be undefined`);\n\n    x.set(d.key, d.value);\n  }\n  return x;\n};\n\n/**\n * Returns true if map contains key\n *\n * @example\n * ```js\n * if (has(map, `London`)) ...\n * ```\n * @param map Map to search\n * @param key Key to find\n * @returns True if map contains key\n */\nexport const has = <K, V>(map: ReadonlyMap<K, V>, key: K): boolean =>\n  map.has(key);\n\n/**\n * Adds data to a map, returning the new map.\n *\n * Can add items in the form of [key,value] or {key, value}.\n * @example These all produce the same result\n * ```js\n * map.set(`hello`, `samantha`);\n * map.add([`hello`, `samantha`]);\n * map.add({key: `hello`, value: `samantha`})\n * ```\n * @param map Initial data\n * @param data One or more data to add in the form of [key,value] or {key, value}\n * @returns New map with data added\n */\nexport const add = <K, V>(\n  map: ReadonlyMap<K, V>,\n  ...data: EitherKey<K, V>\n): ReadonlyMap<K, V> => {\n  if (map === undefined) throw new Error(`map parameter is undefined`);\n  if (data === undefined) throw new Error(`data parameter i.s undefined`);\n  if (data.length === 0) return map;\n\n  const firstRecord = data[ 0 ];\n  const isObject =\n    typeof (firstRecord as { readonly key: K; readonly value: V }).key !==\n    `undefined` &&\n    typeof (firstRecord as { readonly key: K; readonly value: V }).value !==\n    `undefined`; //(typeof (data[0] as {readonly key:K}).key !== undefined && typeof (data[0] as {readonly value:V}).value !== undefined);\n  return isObject\n    ? addObjects(map, data as ObjectKeys<K, V>)\n    : addArray(map, data as ArrayKeys<K, V>);\n};\n\n/**\n * Sets data in a copy of the initial map\n * @param map Initial map\n * @param key Key\n * @param value Value to  set\n * @returns New map with data set\n */\nexport const set = <K, V>(map: ReadonlyMap<K, V>, key: K, value: V) => {\n  const x = new Map<K, V>(map.entries());\n  x.set(key, value);\n  return x;\n};\n\n/**\n * Delete a key from the map, returning a new map\n * @param map Initial data\n * @param key\n * @returns New map with data deleted\n */\nexport const del = <K, V>(\n  map: ReadonlyMap<K, V>,\n  key: K\n): ReadonlyMap<K, V> => {\n  const x = new Map<K, V>(map.entries());\n  x.delete(key);\n  return x;\n};\n","import { type EitherKey } from '../types.js';\nimport type { IMapBase } from './imap-base.js';\nimport { add, del, set } from './map-immutable-fns.js';\n\n/**\n * An immutable map. Rather than changing the map, functions like `add` and `delete`\n * return a new map reference which must be captured.\n *\n * Immutable data is useful because as it gets passed around your code, it never\n * changes from underneath you. You have what you have.\n *\n * @example\n * ```js\n * let m = map(); // Create\n * let m2 = m.set(`hello`, `samantha`);\n * // m is still empty, only m2 contains a value.\n * ```\n *\n * @typeParam K - Type of map keys. Typically `string`\n * @typeParam V - Type of stored values\n */\n//eslint-disable-next-line @typescript-eslint/consistent-type-definitions\nexport interface IMapImmutable<K, V> extends IMapBase<K, V> {\n  /**\n   * Adds one or more items, returning the changed map.\n   *\n   * Can add items in the form of `[key,value]` or `{key, value}`.\n   * @example These all produce the same result\n   * ```js\n   * map.set(`hello`, `samantha`);\n   * map.add([`hello`, `samantha`]);\n   * map.add({key: `hello`, value: `samantha`})\n   * ```\n   * @param itemsToAdd\n   */\n  add(...itemsToAdd: EitherKey<K, V>): IMapImmutable<K, V>;\n  /**\n   * Deletes an item by key, returning the changed map\n   * @param key\n   */\n  delete(key: K): IMapImmutable<K, V>;\n  /**\n   * Returns an empty map\n   */\n  clear(): IMapImmutable<K, V>;\n\n\n  /**\n   * Sets `key` to be `value`, overwriting anything existing.\n   * Returns a new map with added key.\n   * @param key\n   * @param value\n   */\n  set(key: K, value: V): IMapImmutable<K, V>;\n\n}\n\n/**\n * Returns an {@link IMapImmutable}.\n * Use {@link Maps.mutable} as a mutable alternatve.\n *\n * @example Basic usage\n * ```js\n * // Creating\n * let m = map();\n * // Add\n * m = m.set(\"name\", \"sally\");\n * // Recall\n * m.get(\"name\");\n * ```\n *\n * @example Enumerating\n * ```js\n * for (const [key, value] of map.entries()) {\n *  console.log(`${key} = ${value}`);\n * }\n * ```\n *\n * @example Overview\n * ```js\n * // Create\n * let m = map();\n * // Add as array or key & value pair\n * m = m.add([\"name\" , \"sally\"]);\n * m = m.add({ key: \"name\", value: \"sally\" });\n * // Add using the more typical set\n * m = m.set(\"name\", \"sally\");\n * m.get(\"name\");   // \"sally\";\n * m.has(\"age\");    // false\n * m.has(\"name\");   // true\n * m.isEmpty;       // false\n * m = m.delete(\"name\");\n * m.entries();     // Iterator of key value pairs\n * ```\n *\n * Since it is immutable, `add()`, `delete()` and `clear()` return a new version with change.\n *\n * @param dataOrMap Optional initial data in the form of an array of `{ key: value }` or `[ key, value ]`\n */\nexport const immutable = <K, V>(\n  dataOrMap?: ReadonlyMap<K, V> | EitherKey<K, V>\n): IMapImmutable<K, V> => {\n  if (dataOrMap === undefined) return immutable([]);\n  if (Array.isArray(dataOrMap)) return immutable<K, V>(add(new Map(), ...dataOrMap));\n\n  const data = dataOrMap as ReadonlyMap<K, V>;\n  return {\n    add: (...itemsToAdd: EitherKey<K, V>) => {\n      const s = add(data, ...itemsToAdd);\n      return immutable(s);\n    },\n    set: (key: K, value: V) => {\n      const s = set(data, key, value);\n      return immutable(s);\n    },\n    get: (key: K) => data.get(key),\n    delete: (key: K) => immutable(del(data, key)),\n    // eslint-disable-next-line @typescript-eslint/no-unused-vars\n    clear: () => immutable(),\n    has: (key: K) => data.has(key),\n    entries: () => data.entries(),\n    values: () => data.values(),\n    isEmpty: () => data.size === 0,\n  };\n};\n","import { type EitherKey } from '../types.js';\nimport type { IMapBase } from './imap-base.js';\nimport { add, del, set, has } from './map-immutable-fns.js';\n\n/**\n * A mutable map.\n *\n * It is a wrapper around the in-built Map type, but adds roughly the same API as {@link IMapImmutable}.\n *\n * @typeParam K - Type of map keys. Typically `string`\n * @typeParam V - Type of stored values\n */\n//eslint-disable-next-line @typescript-eslint/consistent-type-definitions\nexport interface IMapMutable<K, V> extends IMapBase<K, V> {\n  /**\n   * Adds one or more items to map\n   *\n   * Can add items in the form of [key,value] or `{key, value}`.\n   * @example These all produce the same result\n   * ```js\n   * map.set(`hello`, `samantha`);\n   * map.add([`hello`, `samantha`]);\n   * map.add({key: `hello`, value: `samantha`})\n   * ```\n   * @param itemsToAdd\n   * @param itemsToAdd\n   */\n  add(...itemsToAdd: EitherKey<K, V>): void;\n  /**\n   * Sets a value to a specified key\n   * @param key\n   * @param value\n   */\n  set(key: K, value: V): void;\n  /**\n   * Deletes an item by key\n   * @param key\n   */\n  delete(key: K): void;\n  /**\n   * Clears map\n   */\n  clear(): void;\n}\n\n/**\n * Returns a {@link IMapMutable} (which just wraps the in-built Map)\n * Use {@link Maps.immutable} for the immutable alternative.\n *\n * @example Basic usage\n * ```js\n * const m = mapMutable();\n * // Add one or more entries\n * m.add([\"name\", \"sally\"]);\n * // Alternatively:\n * m.set(\"name\", \"sally\");\n * // Recall\n * m.get(\"name\");           // \"sally\"\n * m.delete(\"name\");\n * m.isEmpty; // True\n * m.clear();\n * ```\n * @param data Optional initial data in the form of an array of `{ key: value }` or `[ key, value ]`\n */\nexport const mutable = <K, V>(...data: EitherKey<K, V>): IMapMutable<K, V> => {\n  // eslint-disable-next-line functional/no-let\n  let m = add(new Map<K, V>(), ...data);\n  return {\n    add: (...data: EitherKey<K, V>) => {\n      m = add(m, ...data);\n    },\n    delete: (key: K) => {\n      m = del(m, key);\n    },\n    clear: () => {\n      m = add(new Map<K, V>());\n    },\n    set: (key: K, value: V): void => {\n      m = set(m, key, value);\n    },\n    get: (key: K): V | undefined => m.get(key),\n    entries: () => m.entries(),\n    values: () => m.values(),\n    isEmpty: () => m.size === 0,\n    has: (key: K) => has(m, key),\n  };\n};\n","import {\n  type IsEqual,\n  isEqualDefault\n} from '@ixfx/core';\nimport type {\n  MapArrayEvents,\n  IMapOfMutableExtended,\n} from './imap-of-mutable-extended.js';\nimport type { MapMultiOpts, MultiValue } from './map-multi.js';\nimport { SimpleEventEmitter } from '@ixfx/events';\nimport type { IMapOf } from './imap-of.js';\nimport { toStringDefault, type ToString } from '@ixfx/core';\n\n/**\n * @internal\n */\nexport class MapOfMutableImpl<V, M>\n  extends SimpleEventEmitter<MapArrayEvents<V>>\n  implements IMapOfMutableExtended<V, M> {\n  readonly #map = new Map<string, M>();\n  readonly groupBy: ToString<V>;\n  readonly type: MultiValue<V, M>;\n\n  constructor(type: MultiValue<V, M>, opts: MapMultiOpts<V> = {}) {\n    super();\n    this.type = type;\n    this.groupBy = opts.groupBy ?? toStringDefault;\n  }\n\n  /**\n   * Returns the type name. For in-built implementations, it will be one of: array, set or circular\n   */\n  get typeName() {\n    return this.type.name;\n  }\n\n  /**\n   * Returns the number of keys\n   */\n  get lengthKeys(): number {\n    return this.#map.size;\n  }\n\n  /**\n   * Returns the length of the longest child list\n   */\n  get lengthMax() {\n    let m = 0;\n    for (const v of this.#map.values()) {\n      m = Math.max(m, this.type.count(v));\n    }\n    return m;\n  }\n\n  debugString(): string {\n    const keys = [ ...this.#map.keys() ];\n    let r = `Keys: ${ keys.join(`, `) }\\r\\n`;\n    for (const k of keys) {\n      const v = this.#map.get(k);\n      if (v === undefined) {\n        r += ` - ${ k } (undefined)\\r\\n`\n      } else {\n        const asArray = this.type.toArray(v);\n        if (asArray !== undefined) {\n          r += ` - ${ k } (${ this.type.count(v) }) = ${ JSON.stringify(\n            asArray\n          ) }\\r\\n`;\n        }\n      }\n    };\n    return r;\n  }\n\n  get isEmpty(): boolean {\n    return this.#map.size === 0;\n  }\n\n  clear() {\n    this.#map.clear();\n    super.fireEvent(`clear`, true);\n  }\n\n  addKeyedValues(key: string, ...values: V[]) {\n    const set = this.#map.get(key);\n    if (set === undefined) {\n      this.#map.set(key, this.type.addKeyedValues(undefined, values));\n      super.fireEvent(`addedKey`, { key: key });\n      super.fireEvent(`addedValues`, { values: values });\n    } else {\n      this.#map.set(key, this.type.addKeyedValues(set, values));\n      super.fireEvent(`addedValues`, { values: values });\n    }\n  }\n  set(key: string, values: V[]) {\n    this.addKeyedValues(key, ...values);\n    return this;\n  }\n\n  addValue(...values: readonly V[]) {\n    for (const v of values) this.addKeyedValues(this.groupBy(v), v);\n  }\n\n  hasKeyValue(key: string, value: V, eq: IsEqual<V>): boolean {\n    const m = this.#map.get(key);\n    if (m === undefined) return false;\n    return this.type.has(m, value, eq);\n  }\n\n  has(key: string): boolean {\n    return this.#map.has(key);\n  }\n\n  deleteKeyValue(key: string, value: V): boolean {\n    const a = this.#map.get(key);\n    if (a === undefined) return false;\n    return this.deleteKeyValueFromMap(a, key, value);\n  }\n\n  private deleteKeyValueFromMap(map: M, key: string, value: V): boolean {\n    const preCount = this.type.count(map);\n    const filtered = this.type.without(map, value);\n    const postCount = filtered.length;\n    this.#map.set(key, this.type.addKeyedValues(undefined, filtered));\n    return preCount > postCount;\n  }\n\n  deleteByValue(value: V): boolean {\n    let something = false;\n    [ ...this.#map.keys() ].filter((key) => {\n      const a = this.#map.get(key);\n      if (!a) throw new Error(`Bug: map could not be accessed`);\n      if (this.deleteKeyValueFromMap(a, key, value)) {\n        something = true; // note that something was deleted\n\n        // If key is empty, delete it\n        if (this.count(key) === 0) this.delete(key);\n      }\n    });\n    return something;\n  }\n\n  delete(key: string): boolean {\n    const a = this.#map.get(key);\n    if (a === undefined) return false;\n    this.#map.delete(key);\n    this.fireEvent(`deleteKey`, { key: key });\n    return true;\n  }\n\n  firstKeyByValue(\n    value: V,\n    eq: IsEqual<V> = isEqualDefault\n  ): string | undefined {\n    const keys = [ ...this.#map.keys() ];\n    const found = keys.find((key) => {\n      const a = this.#map.get(key);\n      if (a === undefined) throw new Error(`Bug: map could not be accessed`);\n      const r = this.type.has(a, value, eq);\n      return r;\n    });\n    return found;\n  }\n\n  count(key: string): number {\n    const entry = this.#map.get(key);\n    if (entry === undefined) return 0;\n    return this.type.count(entry);\n  }\n\n  /**\n   * Iterates over values stored under `key`\n   * An empty array is returned if there are no values\n   */\n  *get(key: string): IterableIterator<V> {\n    const m = this.#map.get(key);\n    if (m === undefined) return;\n    yield* this.type.iterable(m);\n  }\n\n  /**\n   * Iterate over the values stored under `key`.\n   * If key does not exist, iteration is essentially a no-op\n   * @param key\n   * @returns\n   */\n  *valuesFor(key: string) {\n    const m = this.#map.get(key);\n    if (m === undefined) return;\n    yield* this.type.iterable(m);\n  }\n\n  getSource(key: string): M | undefined {\n    return this.#map.get(key);\n  }\n\n  *keys(): IterableIterator<string> {\n    yield* this.#map.keys();\n    //return Array.from(this.#map.keys());\n  }\n\n  *entriesFlat(): IterableIterator<[ key: string, value: V ]> {\n    for (const entry of this.#map.entries()) {\n      for (const v of this.type.iterable(entry[ 1 ])) {\n        yield [ entry[ 0 ], v ];\n      }\n    }\n  }\n\n  *valuesFlat(): IterableIterator<V> {\n    for (const entry of this.#map.entries()) {\n      yield* this.type.iterable(entry[ 1 ]);\n    }\n  }\n\n  *entries(): IterableIterator<[ key: string, value: V[] ]> {\n    for (const [ k, v ] of this.#map.entries()) {\n      const temporary = [ ...this.type.iterable(v) ];\n      yield [ k, temporary ];\n    }\n  }\n\n  *keysAndCounts(): IterableIterator<[ string, number ]> {\n    for (const key of this.keys()) {\n      yield [ key, this.count(key) ];\n    }\n  }\n\n  merge(other: IMapOf<V>) {\n    for (const key of other.keys()) {\n      const data = other.get(key);\n      this.addKeyedValues(key, ...data);\n    }\n  }\n\n  get size() {\n    return this.#map.size;\n  }\n\n\n  get [ Symbol.toStringTag ]() {\n    return this.#map[ Symbol.toStringTag ];\n  }\n}\n","import { toStringDefault } from '@ixfx/core';\nimport { without } from '@ixfx/arrays';\nimport type { MapSetOpts, MultiValue } from './map-multi.js';\nimport { MapOfMutableImpl } from './map-of-multi-impl.js';\nimport {\n  hasAnyValue as mapHasAnyValue,\n  toArray as mapToArray,\n  findValue as mapFindValue,\n  filterValues as mapFilterValues,\n  addValue as mapAddValue\n} from '@ixfx/core/maps';\nimport type { IMapOfMutableExtended } from './imap-of-mutable-extended.js';\n\n/**\n * Returns a {@link IMapOfMutableExtended} that uses a set to hold values.\n * This means that only unique values are stored under each key. By default it\n * uses the JSON representation to compare items.\n *\n * Options: `{ hash: toStringFn } }`\n *\n * `hash` is Util.ToString function: `(object) => string`. By default it uses\n * `JSON.stringify`.\n *\n * @example Only storing the newest three items per key\n * ```js\n * const map = ofSetMutable();\n * map.addKeyedValues(`hello`, [1, 2, 3, 1, 2, 3]);\n * const hello = map.get(`hello`); // [1, 2, 3]\n * ```\n *\n * @example\n * ```js\n * const hash = (v) => v.name; // Use name as the key\n * const map = ofSetMutable({hash});\n * map.addValue({age:40, name: `Mary`});\n * map.addValue({age:29, name: `Mary`}); // Value ignored as same name exists\n * ```\n * @param options\n * @returns\n */\nexport const ofSetMutable = <V>(\n  options?: MapSetOpts<V>\n): IMapOfMutableExtended<V, ReadonlyMap<string, V>> => {\n  const hash = options?.hash ?? toStringDefault;\n  const comparer = (a: V, b: V) => hash(a) === hash(b);\n\n  const t: MultiValue<V, ReadonlyMap<string, V>> = {\n    get name() {\n      return `set`;\n    },\n    iterable: (source) => source.values(),\n    addKeyedValues: (dest, values) => mapAddValue(dest, hash, `skip`, ...values),\n    count: (source) => source.size,\n    find: (source, predicate) => mapFindValue(source, predicate),\n    filter: (source, predicate) => mapFilterValues(source, predicate),\n    toArray: (source) => mapToArray(source),\n    has: (source, value) => mapHasAnyValue(source, value, comparer),\n    without: (source, value) => without(mapToArray(source), value, comparer),\n  };\n  const m = new MapOfMutableImpl<V, ReadonlyMap<string, V>>(t, options);\n  return m;\n};\n","import { isEqualDefault } from '@ixfx/core';\nimport { CircularArray, type ICircularArray } from '../circular-array.js';\nimport type { MapMultiOpts, MultiValue } from './map-multi.js';\nimport { MapOfMutableImpl } from './map-of-multi-impl.js';\nimport type { IMapOfMutableExtended } from './imap-of-mutable-extended.js';\n\nexport type MapCircularOpts<V> = MapMultiOpts<V> & {\n  readonly capacity: number;\n};\n\n/**\n * Returns a {@link IMapOfMutableExtended} that uses a {@link ICircularArray} to hold values. Mutable.\n * This means that the number of values stored under each key will be limited to the defined\n * capacity.\n *\n * Required option:\n * * `capacity`: how many items to hold\n *\n * @example Only store the most recent three items per key\n * ```js\n * const map = ofCircularMutable({capacity: 3});\n * map.add(`hello`, [1, 2, 3, 4, 5]);\n * const hello = map.get(`hello`); // [3, 4, 5]\n * ```\n *\n *\n * @param options\n * @returns\n */\nexport const ofCircularMutable = <V>(\n  options: MapCircularOpts<V>\n): IMapOfMutableExtended<V, ICircularArray<V>> => {\n  const comparer = isEqualDefault;\n\n  const t: MultiValue<V, ICircularArray<V>> = {\n    get name() {\n      return `circular`;\n    },\n    addKeyedValues: (destination, values) => {\n      let ca: ICircularArray<V> = destination ?? new CircularArray<V>(options.capacity);\n      for (const v of values) {\n        ca = ca.add(v as V);\n      }\n      return ca;\n    },\n    count: (source) => source.length,\n    find: (source, predicate) => source.find(predicate),\n    filter: (source, predicate) => source.filter(predicate),\n    toArray: (source) => source,\n    iterable: (source) => source.values(),\n    has: (source, value) =>\n      source.find((v) => comparer(v, value)) !== undefined,\n    without: (source, value) => source.filter((v) => !comparer(v, value)),\n  };\n  return new MapOfMutableImpl<V, ICircularArray<V>>(t, options);\n};\n","/**\n * Simple map for numbers.\n * \n * Keys not present in map return the `defaultValue` given in the constructor\n * ```js\n * // All keys default to zero.\n * const map = new NumberMap();\n * map.get(`hello`); // 0\n * ```\n * \n * To check if a key is present, use `has`:\n * ```js\n * map.has(`hello`); // false\n * ```\n * \n * Math:\n * ```js\n * // Adds 1 by default to value of `hello`\n * map.add(`hello`);         // 1\n * map.multiply(`hello`, 2); // 2 \n * \n * // Reset key to default value\n * map.reset(`hello`); // 0\n * ```\n * \n * Different default value:\n * ```js\n * const map = new NumberMap(10);\n * map.get(`hello`); // 10\n * ```\n * \n * Regular `set` works as well:\n * ```js\n * map.set(`hello`, 5);\n * map.add(`hello`, 2); // 7\n * ```\n */\nexport class NumberMap<K> extends Map<K, number> {\n  readonly defaultValue: number;\n\n  constructor(defaultValue = 0) {\n    super();\n    this.defaultValue = defaultValue;\n  }\n\n  get(key: K): number {\n    const v = super.get(key);\n    if (v === undefined) return this.defaultValue;\n    return v;\n  }\n\n  reset(key: K): number {\n    super.set(key, this.defaultValue);\n    return this.defaultValue;\n  }\n\n  multiply(key: K, amount: number): number {\n    const v = super.get(key);\n    let value = v ?? this.defaultValue;\n    value *= amount;\n    super.set(key, value);\n    return value;\n  }\n\n  add(key: K, amount = 1): number {\n    const v = super.get(key);\n    let value = v ?? this.defaultValue;\n    value += amount;\n    super.set(key, value);\n    return value;\n  }\n\n  subtract(key: K, amount = 1): number {\n    const v = super.get(key);\n    let value = v ?? this.defaultValue;\n    value -= amount;\n    super.set(key, value);\n    return value;\n  }\n}","import type { ToString } from '@ixfx/core';\nimport { type IsEqual, isEqualDefault } from '@ixfx/core';\nimport { type IMapOfMutableExtended } from './imap-of-mutable-extended.js';\nimport { type MapMultiOpts, type MultiValue } from './map-multi.js';\nimport { MapOfMutableImpl } from './map-of-multi-impl.js';\n\n/**\n * Map of array options\n */\nexport type MapArrayOpts<V> = MapMultiOpts<V> & {\n  /**\n   * Comparer to use\n   */\n  readonly comparer?: IsEqual<V>;\n  /**\n   * Key function\n   */\n  readonly convertToString?: ToString<V>;\n};\n\n/**\n * Returns a {@link IMapOfMutableExtended} to allow storing multiple values under a key, unlike a regular Map.\n * @example\n * ```js\n * const map = ofArrayMutable();\n * map.addKeyedValues(`hello`, [1,2,3,4]); // Adds series of numbers under key `hello`\n *\n * const hello = map.get(`hello`); // Get back values\n * ```\n *\n * Takes options:\n * * `comparer`: {@link IsEqual}\n * * `toString`: Util.ToString\n *\n * A custom Util.ToString function can be provided as the `convertToString` opion. This is then used when checking value equality (`has`, `without`)\n * ```js\n * const map = ofArrayMutable({ convertToString:(v) => v.name}); // Compare values based on their `name` field;\n * ```\n *\n * Alternatively, a {@link IsEqual} function can be used:\n * ```js\n * const map = ofArrayMutable({comparer: (a, b) => a.name === b.name });\n * ```\n * @param options Optiosn for mutable array\n * @typeParam V - Data type of items\n * @returns {@link IMapOfMutableExtended}\n */\nexport const ofArrayMutable = <V>(\n  options: MapArrayOpts<V> = {}\n): IMapOfMutableExtended<V, readonly V[]> => {\n  // const toStringFunction = opts.toString === undefined ?  \n  // const comparer =\n  //   opts.comparer === undefined\n  //     ? (opts.toString === undefined\n  //       ? (a: V, b: V) => opts.toString(a) === opts.toString(b)\n  //       : isEqualDefault)\n  //     : opts.comparer;\n  // const convertToStringComparer = opts.convertToString === undefined ? undefined : (a: V, b: V) => {\n  //   const r = opts.convertToString(a) === opts.convertToString(b)\n  //   console.log(`ofArrayMutable toString comparer: r: ${ r } a: ${ a } b: ${ b }`);\n  //   console.log(`ofArrayMutable toString comparer: a: ${ opts.toString(a) } b: ${ opts.toString(b) }`);\n  //   return r;\n  // };\n\n  const convertToString = options.convertToString;\n  const toStringFunction: IsEqual<V> = typeof convertToString === `undefined` ? isEqualDefault : (a: V, b: V) => convertToString(a) === convertToString(b)\n\n  const comparer = options.comparer ?? toStringFunction;\n\n  const t: MultiValue<V, readonly V[]> = {\n    get name() {\n      return `array`;\n    },\n    addKeyedValues: (destination, values) => {\n      if (destination === undefined) return [ ...values ];\n      return [ ...destination, ...values ];\n    },\n    iterable: (source) => source.values(),\n    count: (source) => source.length,\n    find: (source, predicate) => source.find(f => predicate(f)),\n    filter: (source, predicate) => source.filter(f => predicate(f)),\n    toArray: (source) => source,\n    has: (source, value) => source.some((v) => comparer(v, value)),\n    without: (source, value) => source.filter((v) => !comparer(v, value)),\n    //[Symbol.iterator]: (source) => source[Symbol.iterator]()\n  };\n  const m = new MapOfMutableImpl<V, readonly V[]>(t, options);\n  return m;\n};\n","import type { ToString, IsEqual } from '@ixfx/core';\nimport type { IMapOf } from './imap-of.js';\nimport type { IMapOfImmutable } from './imap-of-immutable.js';\nimport { defaultKeyer, isEqualDefault } from '@ixfx/core';\nimport { MapOfSimpleBase } from './map-of-simple-base.js';\n\n/**\n * Simple immutable MapOf\n */\nexport class MapOfSimple<V>\n  extends MapOfSimpleBase<V>\n  implements IMapOf<V>, IMapOfImmutable<V> {\n  addKeyedValues(key: string, ...values: readonly V[]): IMapOfImmutable<V> {\n    //const asEntries = values.map(v => [key, v]) as [string, V[]][];\n    //return this.addBatch(asEntries);\n    return this.addBatch([ [ key, values ] ]);\n  }\n\n  addValue(...values: readonly V[]): IMapOfImmutable<V> {\n    const asEntries = values.map((v) => [ this.groupBy(v), v ]) as [\n      string,\n      V[]\n    ][];\n    return this.addBatch(asEntries);\n  }\n\n  //eslint-disable-next-line functional/prefer-immutable-types\n  addBatch(entries: [ key: string, value: readonly V[] ][]): IMapOfImmutable<V> {\n    // Deep copy Map\n    const temporary = new Map<string, V[]>(\n      [ ...this.map.entries() ].map((e) => [ e[ 0 ], [ ...e[ 1 ] ] ])\n    );\n\n    for (const [ key, list ] of entries) {\n      // Does key exist already\n      const existingList = temporary.get(key);\n      if (typeof existingList === `undefined`) {\n        // No, use the batch input as the data for this key\n        // @ts-expect-error\n        temporary.set(key, list);\n      } else {\n        // Yes\n        existingList.push(...list);\n      }\n    }\n    return new MapOfSimple<V>(this.groupBy, this.valueEq, [ ...temporary.entries() ]);\n  }\n\n  clear(): IMapOfImmutable<V> {\n    return new MapOfSimple<V>(this.groupBy, this.valueEq);\n  }\n\n  deleteKeyValue(_key: string, _value: V): IMapOfImmutable<V> {\n    throw new Error(`Method not implemented.`);\n  }\n\n  deleteByValue(value: V, eq?: IsEqual<V>): IMapOfImmutable<V> {\n    const entries = [ ...this.map.entries() ];\n    const eqFunction = eq ?? this.valueEq;\n    const x = entries.map((entry) => {\n      const key = entry[ 0 ];\n      const values = entry[ 1 ].filter((vv) => !eqFunction(vv, value)) as readonly V[];\n      return [ key, values ] as [ string, V[] ];\n    });\n    return new MapOfSimple<V>(this.groupBy, this.valueEq, x);\n  }\n\n  delete(key: string): IMapOfImmutable<V> {\n    const entries = [ ...this.map.entries() ].filter((e) => e[ 0 ] !== key);\n    return new MapOfSimple<V>(this.groupBy, this.valueEq, entries);\n  }\n}\n\n/**\n * A simple immutable map of arrays, without events. It can store multiple values\n * under the same key.\n *\n * For a fancier approaches, consider {@link ofArrayMutable}, {@link ofCircularMutable} or {@link ofSetMutable}.\n *\n * @example\n * ```js\n * let m = mapSimple();\n * m = m.add(`hello`, 1, 2, 3); // Adds numbers under key `hello`\n * m = m.delete(`hello`);       // Deletes everything under `hello`\n *\n * const hellos = m.get(`hello`); // Get list of items under `hello`\n * ```\n *\n * @typeParam V - Type of items\n * @returns New instance\n */\nexport const ofSimple = <V>(\n  groupBy: ToString<V> = defaultKeyer,\n  valueEq: IsEqual<V> = isEqualDefault<V>\n): IMapOfImmutable<V> => new MapOfSimple<V>(groupBy, valueEq);\n","export { create as expiringMap, ExpiringMap } from './expiring-map.js';\nexport type {\n  ExpiringMapEvent,\n  ExpiringMapEvents,\n  Opts as ExpiringMapOpts,\n} from './expiring-map.js';\n\nexport * from './map-of-simple-mutable.js';\nexport type { IMapOf } from './imap-of.js';\nexport { immutable, type IMapImmutable } from './map.js';\nexport { mutable, type IMapMutable } from './map-mutable.js';\nexport { ofSetMutable } from './map-of-set-mutable.js';\nexport { ofCircularMutable } from './map-of-circular-mutable.js';\nexport type { MapCircularOpts } from './map-of-circular-mutable.js';\nexport type { IMapOfMutable } from './imap-of-mutable.js';\nexport type { IMapOfImmutable } from './imap-of-immutable.js';\nexport type { MapArrayOpts } from './map-of-array-mutable.js';\nexport { NumberMap } from './number-map.js';\nexport * from './map-multi.js';\n\n// Re-export from core\nexport * from '@ixfx/core/maps';\n\n//export type { IDictionary as IMappish, IWithEntries } from '../../data/maps/IMappish.js';\n\n","import { resultIsError, type Result } from \"@ixfx/guards\";\nimport type { TableRow, TableValue } from \"./types.js\";\n\n\n/**\n * Stores values in a table of rows (vertical) and columns (horizontal)\n */\nexport class Table<V> {\n  rows: TableRow<V>[] = [];\n  rowLabels: string[] = [];\n  colLabels: string[] = [];\n  /**\n   * Keep track of widest row\n   */\n  columnMaxLength = 0;\n\n  /**\n   * Gets the label for a given column index,\n   * returning _undefined_ if not found.\n   * \n   * Case-sensitive\n   * @param label Label to seek\n   * @returns Index of column, or _undefined_ if not found\n   */\n  getColumnLabelIndex(label: string): number | undefined {\n    for (const [ index, l ] of this.colLabels.entries()) {\n      if (l === label) return index;\n    }\n  }\n\n  /**\n   * Gets the label for a given row index,\n   * returning _undefined_ if not found.\n   * \n   * Case-sensitive\n   * @param label Label to seek\n   * @returns Index of row, or _undefined_ if not found\n   */\n  getRowLabelIndex(label: string): number | undefined {\n    for (const [ index, l ] of this.rowLabels.entries()) {\n      if (l === label) return index;\n    }\n  }\n  /**\n   * Dumps the values of the table to the console\n   */\n  print() {\n    console.table([ ...this.rowsWithLabelsObject() ]);\n  }\n\n\n\n  /**\n   * Return a copy of table as nested array\n   * \n   * ```js\n   * const t = new Table();\n   * // add stuff\n   * // ...\n   * const m = t.asArray();\n   * for (const row of m) {\n   *  for (const colValue of row) {\n   *    // iterate over all column values for this row\n   *  }\n   * }\n   * ```\n   * \n   * Alternative: get value at row Y and column X\n   * ```js\n   * const value = m[y][x];\n   * ```\n   * @returns \n   */\n  asArray(): (V | undefined)[][] {\n    const r: (V | undefined)[][] = [];\n    for (const row of this.rows) {\n      if (row === undefined) r.push([]);\n      else r.push([ ...row ]);\n    }\n    return r;\n  }\n\n  /**\n   * Return the number of rows\n   */\n  get rowCount() {\n    return this.rows.length;\n  }\n\n  /**\n   * Return the maximum number of columns in any row\n   */\n  get columnCount() {\n    return this.columnMaxLength;\n    // const lengths = this.rows.map(row => row.length);\n    // return Math.max(...lengths);\n  }\n\n  /**\n   * Iterates over the table row-wise, in object format.\n   * @see {@link rowsWithLabelsArray} to get rows in array format\n   */\n  *rowsWithLabelsObject() {\n    for (let index = 0; index < this.rows.length; index++) {\n      const labelledRow = this.getRowWithLabelsObject(index);\n      yield labelledRow;\n    }\n  }\n\n  /**\n   * Iterates over each row, including the labels if available\n   * @see {@link rowsWithLabelsObject} to get rows in object format\n   */\n  *rowsWithLabelsArray() {\n    for (let index = 0; index < this.rows.length; index++) {\n      const labelledRow = this.getRowWithLabelsArray(index);\n      yield labelledRow;\n    }\n  }\n\n  /**\n   * Assign labels to columns\n   * @param labels \n   */\n  labelColumns(...labels: string[]) {\n    this.colLabels = labels;\n  }\n\n  /**\n   * Assign label to a specific column\n   * First column has an index of 0\n   * @param columnIndex \n   * @param label \n   */\n  labelColumn(columnIndex: number, label: string) {\n    this.colLabels[ columnIndex ] = label;\n  }\n\n  /**\n   * Label rows\n   * @param labels Labels \n   */\n  labelRows(...labels: string[]) {\n    this.rowLabels = labels;\n  }\n\n  /**\n   * Assign label to a specific row\n   * First row has an index of 0\n   * @param rowIndex \n   * @param label \n   */\n  labelRow(rowIndex: number, label: string) {\n    this.rowLabels[ rowIndex ] = label;\n  }\n\n  /**\n   * Adds a new row\n   * @param data Columns\n   */\n  appendRow(...data: TableValue<V>[]): TableRow<V> {\n    this.columnMaxLength = Math.max(this.columnMaxLength, data.length);\n    this.rows.push(data);\n    return data;\n  }\n\n  /**\n   * Gets a row along with labels, as an array\n   * @param rowIndex \n   * @returns \n   */\n  getRowWithLabelsArray(rowIndex: number): [ label: string | undefined, value: V | undefined ][] | undefined {\n    const row = this.rows.at(rowIndex);\n    if (row === undefined) return undefined;\n    return row.map((value, index) => [ this.colLabels.at(index), value ]);\n  }\n\n  /**\n   * Return a row of objects. Keys use the column labels.\n   * \n   * ```js\n   * const row = table.getRowWithLabelsObject(10);\n   * // eg:\n   * // [{ colour: red, size: 10}, { colour: blue, size: 20 }]\n   * ```\n   * @param rowIndex \n   * @returns \n   */\n  getRowWithLabelsObject(rowIndex: number): object | undefined {\n    const row = this.rows.at(rowIndex);\n    if (row === undefined) return undefined;\n    const object = {};\n    for (let index = 0; index < this.colLabels.length; index++) {\n      const label = this.colLabels.at(index) ?? index.toString();\n      object[ label ] = row[ index ];\n    }\n    return object;\n  }\n\n  /**\n   * Gets or creates a row at given position\n   * @param row Index or label of row \n   * @returns \n   */\n  #getOrCreateRawRow(row: number | string): Result<\n    TableRow<V>,\n    `row-label-notfound` | `row-index-invalid`> {\n    const index = typeof row === `number` ? row : this.getRowLabelIndex(row);\n    // Couldn't lookup label\n    if (index === undefined) return { success: false, error: `row-label-notfound` };\n\n    // Bad index\n    if (index < 0) return { success: false, error: `row-index-invalid` }\n\n    // Within existing set of rows\n    if (index < this.rows.length) {\n      return { success: true, value: this.rows[ index ] };\n    }\n\n    const newRow = [];\n    this.rows[ index ] = newRow;\n\n    return { success: true, value: newRow };\n  }\n\n  /**\n   * Gets a copy of values at given row, specified by index or label\n   * @param row \n   * @returns Returns row or throws an error if label or index not found \n   */\n  row(row: number | string): readonly (V | undefined)[] | undefined {\n    const r = this.#getRowRaw(row);\n    if (resultIsError(r)) {\n      throw new Error(r.error);\n    }\n    return [ ...r.value ]\n  }\n\n  /**\n   * Set the value of row,columm.\n   * Row is created if it doesn't exist, with the other column values being _undefined_\n   * @param row Index or label \n   * @param column Column \n   * @param value Value to set at row,column\n   */\n  set(row: number | string, column: number | string, value: V | undefined) {\n    const result = this.#getOrCreateRawRow(row);\n    if (resultIsError(result)) throw new Error(result.error);\n\n    // Have an array that corresponds to row\n    const r = result.value;\n    const columnIndex = typeof column === `number` ? column : this.getColumnLabelIndex(column);\n    if (typeof columnIndex === `undefined`) throw new Error(`Column label '${ column }' not found or is invalid`);\n\n    if (columnIndex < 0) throw new Error(`Column index invalid (less than zero)`);\n\n    // Already have needed columns\n    r[ columnIndex ] = value;\n  }\n\n  /**\n   * Gets the value at a specified row and column.\n   * Throws an error if coordinates are out of range or missing.\n   * @param row Row index or label\n   * @param column Column index or label\n   * @returns \n   */\n  get(row: number | string, column: number | string): TableValue<V> {\n    const rowR = this.#getRowRaw(row);\n    if (resultIsError(rowR)) throw new Error(rowR.error);\n\n    const colR = this.#getColumnRaw(rowR.value, column);\n    if (resultIsError(colR)) throw new Error(colR.error);\n\n    return colR.value.value;\n  }\n\n  #getRowRaw(row: number | string): Result<TableRow<V>, `row-label-notfound` | `row-invalid` | `row-index-out-of-range`> {\n    let index: number | undefined = 0;\n    if (typeof row === `number`) {\n      index = row;\n    } else {\n      index = this.getRowLabelIndex(row);\n      if (typeof index !== `number`) return { error: `row-label-notfound`, success: false };\n    }\n    if (typeof index !== `number`) return { error: `row-invalid`, success: false };\n\n    if (index < 0 || index >= this.rows.length) return { error: `row-index-out-of-range`, success: false };\n    return { success: true, value: this.rows[ index ] };\n  }\n\n  #getColumnRaw(row: TableRow<V>, column: number | string): Result<{ index: number, value: V | undefined }, `col-label-notfound` | `col-index-out-of-range`> {\n    const colIndex = typeof column === `number` ? column : this.getColumnLabelIndex(column);\n    if (typeof colIndex !== `number`) return { success: false, error: `col-label-notfound` };\n    if (colIndex < 0 || colIndex >= row.length) return { success: false, error: `col-index-out-of-range` };\n    return {\n      success: true, value: { index: colIndex, value: row[ colIndex ] }\n    };\n  }\n\n  /**\n   * Set all the columns of a row to a specified value.\n   *\n   * By default, sets the number of columns corresponding to\n   * the table's maximum column length. To set an arbitrary\n   * length of the row, use `length`\n   * @param row Index or label of row\n   * @param length How wide the row is. If unset, uses the current maximum width of rows.\n   * @param value Value to set\n   */\n  setRow(row: number | string, value: V | undefined, length?: number): TableRow<V> {\n    // Get or create a row\n    const rowResult = this.#getOrCreateRawRow(row);\n    if (resultIsError(rowResult)) throw new Error(rowResult.error);\n\n    // Set value within row\n    const r = rowResult.value;\n    const width = typeof length === `number` ? length : this.columnMaxLength;\n    for (let columnNumber = 0; columnNumber < width; columnNumber++) {\n      r[ columnNumber ] = value;\n    }\n    return r;\n  }\n}","/* eslint-disable @typescript-eslint/no-non-null-assertion */\nimport { StackMutable } from \"../stack/StackMutable.js\"\nimport { QueueMutable } from \"../queue/queue-mutable.js\"\nimport { PriorityMutable } from \"../queue/priority-mutable.js\"\nimport { immutable as immutableMap, type IMapImmutable } from \"../map/map.js\"\nimport { NumberMap } from \"../map/number-map.js\"\nimport * as Sync from \"@ixfx/iterables/sync\"\nimport { Table } from \"../table.js\"\nimport { resultThrow, stringTest, type Result } from \"@ixfx/guards\"\n\nexport type DistanceCompute = (graph: DirectedGraph, edge: Edge) => number;\n\n/**\n * Vertex. These are the _nodes_ of the graph. Immutable.\n * \n * They keep track of all of their outgoing edges, and\n * a unique id.\n * \n * Ids are used for accessing/updating vertices as well as in the\n * {@link Edge} type. They must be unique.\n */\nexport type Vertex = Readonly<{\n  out: readonly Edge[]\n  id: string\n}>\n\n/**\n * Edge. Immutable.\n * \n * Only encodes the destination vertex. The from\n * is known since edges are stored on the from vertex.\n */\nexport type Edge = Readonly<{\n  /**\n   * Vertex id edge connects to (ie. destination)\n   */\n  id: string,\n  /**\n   * Optional weight of edge\n   */\n  weight?: number\n}>\n\n/**\n * Create a vertex with given id\n * @param id \n * @returns \n */\nexport const createVertex = (id: string): Vertex => {\n  return {\n    id,\n    out: []\n  }\n}\n\n/**\n * Options for connecting vertices\n */\nexport type ConnectOptions = Readonly<{\n  /**\n   * From, or source of connection\n   */\n  from: string\n  /**\n   * To, or destination of connection. Can be multiple vertices for quick use\n   */\n  to: string | string[]\n  /**\n   * If true, edges in opposite direction are made as well\n   */\n  bidi?: boolean\n  /**\n   * Weight for this connection (optional)\n   */\n  weight?: number\n}>\n\n/**\n * Directed graph. Immutable.\n * \n * Consists of {@link Vertex|vertices}, which all have zero or more outgoing {@link Edge|Edges}.\n */\nexport type DirectedGraph = Readonly<{\n  vertices: IMapImmutable<string, Vertex>\n}>\n\n/**\n * Returns _true_ if graph contains `key`.\n * \n * ```js\n * // Same as\n * g.vertices.has(key)\n * ```\n * @param graph\n * @param key \n * @returns \n */\nexport function hasKey(graph: DirectedGraph, key: string): boolean {\n  resultThrow(graphTest(graph));\n  return graph.vertices.has(key);\n}\n\n/**\n * Returns {@link Vertex} under `key`, or _undefined_\n * if not found.\n * \n * ```js\n * // Same as\n * g.vertices.get(key)\n * ```\n * @param graph \n * @param key \n * @returns \n */\nexport function get(graph: DirectedGraph, key: string): Vertex | undefined {\n  resultThrow(graphTest(graph));\n\n  resultThrow(stringTest(key, `non-empty`, `key`));\n  return graph.vertices.get(key);\n\n}\n\n// export function fromAdjacenyMatrix(m: Array<Array<boolean>>): DirectedGraph {\n//   let g = graph();\n//   for (const row of m) {\n//     connect(g, { from, to })\n//   }\n//   return g;\n// }\n\n/**\n * Returns the graph connections as an adjacency matrix\n * @param graph \n * @returns \n */\nexport function toAdjacencyMatrix(graph: DirectedGraph): Table<boolean> {\n  resultThrow(graphTest(graph));\n\n  const v = [ ...graph.vertices.values() ];\n  //const m: Array<Array<boolean>> = [];\n  const table = new Table<boolean>();\n  table.labelColumns(...v.map(vv => vv.id));\n  table.labelRows(...v.map(vv => vv.id));\n\n  // const row: Array<boolean> = [];\n  // for (let index = 0; index < v.length; index++) {\n  //   row[ index ] = false;\n  // }\n\n  // eslint-disable-next-line unicorn/prevent-abbreviations\n  for (let i = 0; i < v.length; i++) {\n    //m[ i ] = [ ...row ];\n    table.setRow(i, false, v.length);\n    const ii = v[ i ];\n    // eslint-disable-next-line unicorn/prevent-abbreviations\n    for (const [ j, jj ] of v.entries()) {\n      if (ii.out.some(o => o.id === jj.id)) {\n        //m[ i ][ j ] = true;\n        table.set(i, j, true);\n      }\n    }\n  }\n  return table;\n}\n\n/**\n * Return a string representation of the graph for debug inspection\n * @param graph \n * @returns \n */\nexport const dumpGraph = (graph: DirectedGraph | Iterable<Vertex>): string => {\n  const lines = debugGraphToArray(graph);\n  return lines.join(`\\n`);\n}\n\n/**\n * Return an array of a debug-print of every vertex.\n * @param graph \n * @returns \n */\nconst debugGraphToArray = (graph: DirectedGraph | Iterable<Vertex>): string[] => {\n\n  const r: string[] = [];\n  const vertices = (`vertices` in graph) ? graph.vertices.values() : graph;\n\n  for (const v of vertices) {\n    // eslint-disable-next-line unicorn/prevent-abbreviations\n    const str = debugDumpVertex(v);\n    r.push(...str.map(line => ` ${ line }`));\n  }\n  return r;\n}\n\n\n/**\n * Returns the weight of an edge, or 1 if undefined.\n * @param graph\n * @param edge \n * @returns \n */\nexport const distance = (graph: DirectedGraph, edge: Edge): number => {\n  if (edge.weight !== undefined) return edge.weight;\n  return 1;\n}\n\n/**\n * Iterate over all the edges in the graph\n * @param graph \n */\nexport function* edges(graph: DirectedGraph) {\n  resultThrow(graphTest(graph));\n\n  const vertices = [ ...graph.vertices.values() ];\n  for (const vertex of vertices) {\n    for (const edge of vertex.out) {\n      yield edge;\n    }\n  }\n}\n\n/**\n * Iterate over all the vertices of the graph\n * @param graph \n */\nexport function* vertices(graph: DirectedGraph) {\n  resultThrow(graphTest(graph));\n\n  const vertices = [ ...graph.vertices.values() ];\n  for (const vertex of vertices) {\n    yield vertex;\n  }\n}\n\nfunction graphTest(g: DirectedGraph, parameterName = `graph`): Result<DirectedGraph, string> {\n  if (g === undefined) return { success: false, error: `Param '${ parameterName }' is undefined. Expected Graph` };\n  if (g === null) return { success: false, error: `Param '${ parameterName }' is null. Expected Graph` };\n  if (typeof g === `object`) {\n    if (!(`vertices` in g)) return {\n      success: false, error: `Param '${ parameterName }.vertices' does not exist. Is it a Graph type?`\n    };\n  } else {\n    return { success: false, error: `Param '${ parameterName } is type '${ typeof g }'. Expected an object Graph` };\n  }\n  return { success: true, value: g };\n}\n\n// function throwGraphTest(g: DirectedGraph, parameterName = `graph`) {\n//   const r = testGraph(g, parameterName);\n//   if (r[ 0 ]) return;\n//   throw new Error(r[ 1 ] as string)\n// }\n\n/**\n * Iterate over all the vertices connected to `context` vertex\n * @param graph Graph\n * @param context id or Vertex.\n * @returns \n */\nexport function* adjacentVertices(graph: DirectedGraph, context: Vertex | string | undefined) {\n  resultThrow(graphTest(graph));\n  if (context === undefined) return;\n  const vertex = typeof context === `string` ? graph.vertices.get(context) : context;\n  if (vertex === undefined) throw new Error(`Vertex not found ${ JSON.stringify(context) }`);\n\n  for (const edge of vertex.out) {\n    const edgeV = graph.vertices.get(edge.id);\n    if (edgeV === undefined) throw new Error(`Could not find vertex: ${ edge.id }`);\n    yield edgeV;\n  }\n}\n\n/**\n * Returns _true_ if `vertex` has an outgoing connection to\n * the supplied id or vertex.\n * \n * If `vertex` is undefined, _false_ is returned.\n * @param vertex From vertex\n * @param outIdOrVertex To vertex\n * @returns \n */\nexport const vertexHasOut = (vertex: Vertex, outIdOrVertex: string | Vertex): boolean => {\n  if (vertex === undefined) return false;\n  const outId = typeof outIdOrVertex === `string` ? outIdOrVertex : outIdOrVertex.id;\n  return vertex.out.some(edge => edge.id === outId);\n}\n\n/**\n * Returns _true_ if `vertex` has no outgoing connections\n * @param graph \n * @param vertex \n * @returns \n */\nexport const hasNoOuts = (graph: DirectedGraph, vertex: string | Vertex): boolean => {\n  resultThrow(graphTest(graph));\n  const context = typeof vertex === `string` ? graph.vertices.get(vertex) : vertex;\n  if (context === undefined) return false;\n  return context.out.length === 0;\n}\n\n/**\n * Returns _true_ if `vertex` only has the given list of vertices.\n * Returns _false_ early if the length of the list does not match up with `vertex.out`\n * @param graph \n * @param vertex \n * @param outIdOrVertex \n * @returns \n */\nexport const hasOnlyOuts = (graph: DirectedGraph, vertex: string | Vertex, ...outIdOrVertex: (string | Vertex)[]): boolean => {\n  resultThrow(graphTest(graph));\n\n  const context = resolveVertex(graph, vertex);\n  const outs = outIdOrVertex.map(o => resolveVertex(graph, o));\n\n  if (outs.length !== context.out.length) {\n    //console.log(`length mismatch. context: ${ JSON.stringify(context.out) } out ${ JSON.stringify(outIdOrVertex) }`);\n    return false;\n  }\n  for (const out of outs) {\n    //console.log(`Testing ${ context.id } -> ${ out.id }`);\n    if (!hasOut(graph, context, out)) {\n      //console.log(`  no`);\n      return false;\n    }\n  }\n  return true;\n}\n\n/**\n * Returns _true_ if `vertex` has an outgoing connection to the given vertex.\n * @param graph \n * @param vertex \n * @param outIdOrVertex \n * @returns \n */\nexport const hasOut = (graph: DirectedGraph, vertex: string | Vertex, outIdOrVertex: string | Vertex): boolean => {\n  resultThrow(graphTest(graph));\n\n  const context = resolveVertex(graph, vertex);\n  const outId = typeof outIdOrVertex === `string` ? outIdOrVertex : outIdOrVertex.id;\n  return context.out.some(edge => edge.id === outId);\n}\n\n// export const hasIn = (graph: Graph, contextIdOrVertex: string | Vertex, id: string): boolean => {\n//   const context = typeof contextIdOrVertex === `string` ? graph.vertices.get(contextIdOrVertex) : contextIdOrVertex;\n\n//   if (context === undefined) return false;\n//   if (context.in === undefined) return false;\n//   return context.in.some(edge => edge.id === id);\n// }\n\n/**\n * Gets a vertex by id, creating it if it does not exist.\n * @param graph \n * @param id \n * @returns \n */\nexport const getOrCreate = (graph: DirectedGraph, id: string): Readonly<{ graph: DirectedGraph, vertex: Vertex }> => {\n  resultThrow(graphTest(graph));\n\n  const v = graph.vertices.get(id);\n  if (v !== undefined) return { graph, vertex: v };\n\n  const vv = createVertex(id);\n  const gg = updateGraphVertex(graph, vv);\n  return { graph: gg, vertex: vv };\n}\n\n/**\n * Gets a vertex by id, throwing an error if it does not exist\n * @param graph \n * @param id \n * @returns \n */\nexport const getOrFail = (graph: DirectedGraph, id: string): Vertex => {\n  resultThrow(graphTest(graph));\n\n  const v = graph.vertices.get(id);\n  if (v === undefined) throw new Error(`Vertex '${ id }' not found in graph`);\n  return v;\n}\n\n/**\n * Updates a vertex by returning a mutated graph\n * @param graph Graph\n * @param vertex Newly changed vertex\n * @returns \n */\nexport const updateGraphVertex = (graph: DirectedGraph, vertex: Vertex): DirectedGraph => {\n  resultThrow(graphTest(graph));\n\n  const gr = {\n    ...graph,\n    vertices: graph.vertices.set(vertex.id, vertex)\n  }\n  return gr;\n}\n\n/**\n * Default distance computer. Uses `weight` property of edge, or `1` if not found.\n * @param graph \n * @param edge \n * @returns \n */\nexport const distanceDefault = (graph: DirectedGraph, edge: Edge): number => {\n  if (edge.weight !== undefined) return edge.weight;\n  return 1;\n}\n\n/**\n * Returns a mutation of `graph`, with a given edge removed.\n * \n * If edge was not there, original graph is returned.\n * @param graph \n * @param from \n * @param to \n * @returns \n */\nexport function disconnect(graph: DirectedGraph, from: string | Vertex, to: string | Vertex): DirectedGraph {\n  resultThrow(graphTest(graph));\n\n  const fromV = resolveVertex(graph, from);\n  const toV = resolveVertex(graph, to);\n\n  return hasOut(graph, fromV, toV) ? updateGraphVertex(graph, {\n    ...fromV,\n    out: fromV.out.filter(t => t.id !== toV.id)\n  }) : graph;\n}\n\n/**\n * Make a connection between two vertices with a given weight.\n * It returns the new graph as wll as the created edge.\n * @param graph \n * @param from \n * @param to \n * @param weight \n * @returns \n */\nexport function connectTo(graph: DirectedGraph, from: string, to: string, weight?: number): { graph: DirectedGraph, edge: Edge } {\n  resultThrow(graphTest(graph));\n\n  const fromResult = getOrCreate(graph, from);\n  graph = fromResult.graph;\n  const toResult = getOrCreate(graph, to);\n  graph = toResult.graph;\n\n  const edge: Edge = {\n    id: to,\n    weight\n  }\n\n  if (!hasOut(graph, fromResult.vertex, toResult.vertex)) {\n    graph = updateGraphVertex(graph, {\n      ...fromResult.vertex,\n      // Add new edge to list of edges for this node\n      out: [ ...fromResult.vertex.out, edge ]\n    });\n  }\n  return { graph, edge }\n}\n\n/**\n * Connect from -> to. Same as {@link connectWithEdges}, but this version just returns the graph.\n * \n * By default unidirectional, meaning a connection is made only from->to. Use `bidi` option to set a bidirection connection, adding also to->from.\n * \n * Returns a result of `{ graph, edges }`, where `graph` is the new {@link DirectedGraph} and `edges`\n * is an array of {@link Edge Edges}. One for unidirectional, or two for bidirectional.\n * @param graph \n * @param options \n * @returns \n */\nexport function connect(graph: DirectedGraph, options: ConnectOptions): DirectedGraph {\n  if (typeof graph !== `object`) throw new TypeError(`Param 'graph' is expected to be a DirectedGraph object. Got: ${ typeof graph }`);\n  if (typeof options !== `object`) throw new TypeError(`Param 'options' is expected to be ConnectOptions object. Got: ${ typeof options }`);\n\n  const result = connectWithEdges(graph, options);\n  return result.graph;\n}\n\n/**\n * Connect from -> to. Same as {@link connect} except you get back the edges as well. \n * \n * By default unidirectional, meaning a connection is made only from->to. Use `bidi` option to set a bidirection connection, adding also to->from.\n * \n * Returns a result of `{ graph, edges }`, where `graph` is the new {@link DirectedGraph} and `edges`\n * is an array of {@link Edge Edges}. One for unidirectional, or two for bidirectional.\n * @param graph \n * @param options \n * @returns \n */\nexport function connectWithEdges(graph: DirectedGraph, options: ConnectOptions): { graph: DirectedGraph, edges: Edge[] } {\n  resultThrow(graphTest(graph));\n\n  const { to, weight, from } = options;\n  const bidi = options.bidi ?? false;\n  const toList = Array.isArray(to) ? to : [ to ];\n\n  const edges: Edge[] = []\n  // Connect from -> to\n  for (const toSingle of toList) {\n    const result = connectTo(graph, from, toSingle, weight);\n    graph = result.graph;\n    edges.push(result.edge);\n  }\n\n  if (!bidi) return { graph, edges };\n\n  // Bidirectional connection\n  // Connect to -> from\n  for (const toSingle of toList) {\n    const result = connectTo(graph, toSingle, from, weight);\n    graph = result.graph;\n    edges.push(result.edge);\n  }\n  return { graph, edges };\n}\n\n/**\n * Returns an array of debug-representations for the given vertex.\n * @param v \n * @returns \n */\nconst debugDumpVertex = (v: Vertex): string[] => {\n  const r = [\n    v.id\n  ]\n  const stringForEdge = (edge: Edge) => edge.weight === undefined ? edge.id : `${ edge.id } (${ edge.weight })`\n\n  // for (const edge of v.in) {\n  //   r.push(` <- ${ stringForEdge(edge) }`);\n  // }\n  for (const edge of v.out) {\n    r.push(` -> ${ stringForEdge(edge) }`);\n  }\n  if (v.out.length === 0) r[ 0 ] += ` (terminal)`;\n\n  return r;\n}\n\n/**\n * Returns _true_ if a->b or b->a\n * @param graph \n * @param a \n * @param b \n * @returns \n */\nexport function areAdjacent(graph: DirectedGraph, a: Vertex, b: Vertex) {\n  resultThrow(graphTest(graph));\n\n  if (hasOut(graph, a, b.id)) return true;\n  if (hasOut(graph, b, a.id)) return true;\n}\n\n/**\n * Resolves the id or vertex into a Vertex.\n * throws an error if vertex is not found\n * @param graph \n * @param idOrVertex \n * @returns \n */\nfunction resolveVertex(graph: DirectedGraph, idOrVertex: string | Vertex): Vertex {\n  resultThrow(graphTest(graph));\n\n  if (idOrVertex === undefined) throw new Error(`Param 'idOrVertex' is undefined. Expected string or Vertex`);\n\n  const v = typeof idOrVertex === `string` ? graph.vertices.get(idOrVertex) : idOrVertex;\n  if (v === undefined) throw new Error(`Id not found ${ idOrVertex as string }`);\n  return v;\n}\n\n/**\n * Iterates over vertices from a starting vertex in an bread-first-search\n * @param graph \n * @param startIdOrVertex \n * @param targetIdOrVertex \n * @returns \n */\nexport function* bfs(graph: DirectedGraph, startIdOrVertex: string | Vertex, targetIdOrVertex?: string | Vertex) {\n  resultThrow(graphTest(graph));\n\n  const start = resolveVertex(graph, startIdOrVertex);\n  const target = targetIdOrVertex === undefined ? undefined : resolveVertex(graph, targetIdOrVertex);\n\n  const queue = new QueueMutable<Vertex>();\n  const seen = new Set<string>();\n  queue.enqueue(start);\n  while (!queue.isEmpty) {\n    const v = queue.dequeue()!;\n    yield v;\n    if (target !== undefined && target === v) return;\n    for (const edge of adjacentVertices(graph, v)) {\n      if (!seen.has(edge.id)) {\n        seen.add(edge.id);\n        queue.enqueue(resolveVertex(graph, edge.id));\n      }\n    }\n  }\n}\n\n/**\n * Iterates over vertices from a starting vertex in an depth-first-search\n * @param graph \n * @param startIdOrVertex \n */\nexport function* dfs(graph: DirectedGraph, startIdOrVertex: string | Vertex) {\n  resultThrow(graphTest(graph));\n\n  const source = resolveVertex(graph, startIdOrVertex);\n\n  const s = new StackMutable<Vertex>();\n  const seen = new Set<string>();\n  s.push(source);\n  while (!s.isEmpty) {\n    const v = s.pop();\n    if (v === undefined) continue;\n    if (!seen.has(v.id)) {\n      seen.add(v.id);\n      yield v;\n      for (const edge of v.out) {\n        const destination = graph.vertices.get(edge.id);\n        if (destination) {\n          s.push(destination);\n        }\n      }\n    }\n  }\n}\n\n/**\n * Compute shortest distance from the source vertex to the rest of the graph.\n * @param graph \n * @param sourceOrId \n * @returns \n */\nexport const pathDijkstra = (graph: DirectedGraph, sourceOrId: Vertex | string) => {\n  resultThrow(graphTest(graph));\n\n  const source = typeof sourceOrId === `string` ? graph.vertices.get(sourceOrId) : sourceOrId;\n  if (source === undefined) throw new Error(`source vertex not found`);\n\n  const distances = new Map<string, number>();\n  const previous = new Map<string, Vertex | null>();\n\n  distances.set(source.id, 0);\n\n  const pq = new PriorityMutable<string>();\n\n  const vertices = [ ...graph.vertices.values() ];\n  for (const v of vertices) {\n    if (v.id !== source.id) {\n      distances.set(v.id, Number.MAX_SAFE_INTEGER);\n\n      previous.set(v.id, null);\n    }\n    pq.enqueueWithPriority(v.id, Number.MAX_SAFE_INTEGER);\n  }\n\n  while (!pq.isEmpty) {\n    const u = pq.dequeueMin();\n    if (u === undefined) throw new Error(`Bug. Queue unexpectedly empty`);\n    const vertexU = graph.vertices.get(u)!;\n    for (const neighbour of vertexU.out) {\n      //const vertexNeigbour = graph.vertices.get(neighbour.to)!;\n      const alt = distances.get(u)! + distance(graph, neighbour);\n      if (alt < distances.get(neighbour.id)!) {\n        distances.set(neighbour.id, alt);\n        previous.set(neighbour.id, vertexU);\n        pq.changePriority(neighbour.id, alt, true);\n      }\n    }\n  }\n\n  const pathTo = (id: string): Edge[] => {\n    const path: Edge[] = [];\n    while (true) {\n      if (id === source.id) break;\n      const v = previous.get(id);\n      if (v === undefined || v === null) throw new Error(`Id not present: ${ id }`);\n      path.push({ id, weight: distances.get(id) });\n      id = v.id;\n    }\n    return path;\n  }\n  return {\n    distances, previous, pathTo\n  }\n}\n\n/**\n * Clones the graph. Uses shallow clone, because it's all immutable\n * @param graph \n * @returns \n */\nexport const clone = (graph: DirectedGraph): DirectedGraph => {\n  resultThrow(graphTest(graph));\n\n  const g: DirectedGraph = {\n    vertices: immutableMap<string, Vertex>([ ...graph.vertices.entries() ])\n  }\n  return g;\n}\n\n/**\n * Create a graph\n * ```js\n * let g = graph();\n * ```\n * \n * Can optionally provide initial connections:\n * ```js\n * let g = graph(\n *  { from: `a`, to: `b` },\n *  { from: `b`, to: `c` }\n * )\n * ```\n * @param initialConnections \n * @returns \n */\nexport const graph = (...initialConnections: ConnectOptions[]): DirectedGraph => {\n  let g: DirectedGraph = {\n    vertices: immutableMap()\n  }\n  for (const ic of initialConnections) {\n    g = connect(g, ic);\n  }\n  return g;\n}\n\n/**\n * Internal type for Tarjan algorithm\n */\ntype TarjanVertex = Vertex & {\n  lowlink: number\n  index: number\n  onStack: boolean\n}\n\n/**\n * Returns _true_ if the graph contains is acyclic - that is, it has no loops\n * @param graph \n */\nexport function isAcyclic(graph: DirectedGraph): boolean {\n  resultThrow(graphTest(graph));\n\n  const cycles = getCycles(graph);\n  return cycles.length === 0;\n}\n\n/**\n * Topological sort using Kahn's algorithm.\n * Returns a new graph that is sorted\n * @param graph \n */\nexport function topologicalSort(graph: DirectedGraph): DirectedGraph {\n  resultThrow(graphTest(graph));\n\n  const indegrees = new NumberMap(0);\n\n  // Increment indegrees for each edge leading to a vertex\n  for (const edge of edges(graph)) {\n    indegrees.add(edge.id, 1);\n  }\n\n  // Enqueue all vertices with an indegree of 0\n  const queue = new QueueMutable<Vertex>();\n  let vertexCount = 0;\n  for (const vertex of vertices(graph)) {\n    if (indegrees.get(vertex.id) === 0) {\n      queue.enqueue(vertex);\n    }\n    vertexCount++;\n  }\n\n  const topOrder: Vertex[] = [];\n  while (!queue.isEmpty) {\n    // Add to topological order\n    const u = queue.dequeue()!;\n    topOrder.push(u);\n\n    // Iterate through neighbours\n    for (const neighbour of u.out) {\n      const result = indegrees.subtract(neighbour.id, 1);\n      if (result === 0) {\n        queue.enqueue(graph.vertices.get(neighbour.id)!);\n      }\n    }\n  }\n\n  if (topOrder.length !== vertexCount) {\n    throw new Error(`Graph contains cycles`);\n  }\n  return graphFromVertices(topOrder);\n}\n\n/**\n * Create a graph from an iterable of vertices\n * @param vertices \n * @returns \n */\nexport function graphFromVertices(vertices: Iterable<Vertex>): DirectedGraph {\n\n  const keyValues = Sync.map(vertices, f => {\n    return [ f.id, f ] as [ string, Vertex ]\n  });\n  const m = immutableMap<string, Vertex>([ ...keyValues ]);\n  return {\n    vertices: m\n  }\n}\n\n/**\n * Get all the cycles ('strongly-connected-components') within the graph\n * [Read more](https://en.wikipedia.org/wiki/Strongly_connected_component)\n * @param graph \n * @returns \n */\nexport function getCycles(graph: DirectedGraph): Vertex[][] {\n  resultThrow(graphTest(graph));\n\n  let index = 0;\n  const stack = new StackMutable<TarjanVertex>();\n  const vertices = new Map<string, TarjanVertex>();\n  const scc: Vertex[][] = [];\n\n  for (const v of graph.vertices.values()) {\n    vertices.set(v.id, {\n      ...v,\n      lowlink: Number.NaN,\n      index: Number.NaN,\n      onStack: false\n    });\n  }\n\n  const strongConnect = (vertex: TarjanVertex) => {\n    vertex.index = index;\n    vertex.lowlink = index;\n    index++;\n    stack.push(vertex);\n    vertex.onStack = true;\n\n    for (const edge of vertex.out) {\n      const edgeV = vertices.get(edge.id)!;\n      if (Number.isNaN(edgeV.index)) {\n        strongConnect(edgeV);\n        vertex.lowlink = Math.min(vertex.lowlink, edgeV.lowlink);\n      } else if (edgeV.onStack) {\n        vertex.lowlink = Math.min(vertex.lowlink, edgeV.lowlink);\n      }\n    }\n\n    if (vertex.lowlink === vertex.index) {\n      const stronglyConnected: Vertex[] = [];\n      let w: TarjanVertex | undefined;\n      while (vertex !== w) {\n        w = stack.pop()!;\n        w.onStack = false;\n        stronglyConnected.push({ id: w.id, out: w.out });\n\n      }\n      if (stronglyConnected.length > 1)\n        scc.push(stronglyConnected);\n    }\n  }\n\n  for (const v of vertices.values()) {\n    if (Number.isNaN(v.index)) {\n      strongConnect(v);\n    }\n  }\n  return scc;\n}\n\n/**\n * Returns a new graph which is transitively reduced.\n * That is, redundant edges are removed\n * @param graph \n * @returns \n */\nexport function transitiveReduction(graph: DirectedGraph) {\n  resultThrow(graphTest(graph));\n\n  for (const u of vertices(graph)) {\n    for (const v of adjacentVertices(graph, u)) {\n      for (const v1 of dfs(graph, v)) {\n        if (v.id === v1.id) continue;\n        if (hasOut(graph, u, v1)) {\n          const g = disconnect(graph, u, v1);\n          return transitiveReduction(g);\n        }\n      }\n    }\n  }\n  return graph;\n}","\nimport { immutable as immutableMap, type IMapImmutable } from \"../map/map.js\"\nimport { Table } from \"../table.js\"\n\nexport type Vertex = Readonly<{\n  id: string\n}>\n\nexport type Edge = Readonly<{\n  a: string,\n  b: string,\n  weight?: number\n}>\n\nexport type Graph = Readonly<{\n  edges: readonly Edge[],\n  vertices: IMapImmutable<string, Vertex>\n}>\n\nexport type ConnectOptions = Readonly<{\n  a: string\n  b: string | string[]\n  weight?: number\n}>\n\nexport const createVertex = (id: string): Vertex => {\n  return {\n    id\n  }\n}\n\nexport const updateGraphVertex = (graph: Graph, vertex: Vertex): Graph => {\n  const gr = {\n    ...graph,\n    vertices: graph.vertices.set(vertex.id, vertex)\n  }\n  return gr;\n}\n\nexport const getOrCreate = (graph: Graph, id: string): Readonly<{ graph: Graph, vertex: Vertex }> => {\n  const v = graph.vertices.get(id);\n  if (v !== undefined) return { graph, vertex: v };\n\n  const vv = createVertex(id);\n  const gg = updateGraphVertex(graph, vv);\n  return { graph: gg, vertex: vv };\n}\n\nfunction resolveVertex(graph: Graph, idOrVertex: string | Vertex): Vertex {\n  if (idOrVertex === undefined) throw new Error(`Param 'idOrVertex' is undefined. Expected string or Vertex`);\n  if (graph === undefined) throw new Error(`Param 'graph' is undefined. Expected Graph`);\n  const v = typeof idOrVertex === `string` ? graph.vertices.get(idOrVertex) : idOrVertex;\n  if (v === undefined) throw new Error(`Id not found ${ idOrVertex as string }`);\n  return v;\n}\n\n/**\n * Returns _true/false_ if there is a connection between `a` and `b` in `graph`.\n * Use {@link getConnection} if you want to the edge.\n * @param graph Graph to search \n * @param a\n * @param b\n * @returns _true_ if edge exists \n */\nexport const hasConnection = (graph: Graph, a: string | Vertex, b: string | Vertex): boolean => {\n  const edge = getConnection(graph, a, b);\n  return edge !== undefined;\n}\n\n/**\n * Gets the connection, if it exists between `a` and `b` in `graph`.\n * If it doesn't exist, _undefined_ is returned.\n * Use {@link hasConnection} for a simple true/false if edge exists.\n * @param graph Graph\n * @param a \n * @param b \n * @returns \n */\nexport const getConnection = (graph: Graph, a: string | Vertex, b: string | Vertex): Edge | undefined => {\n  if (a === undefined) throw new Error(`Param 'a' is undefined. Expected string or Vertex`);\n  if (b === undefined) throw new Error(`Param 'b' is undefined. Expected string or Vertex`);\n  if (graph === undefined) throw new Error(`Param 'graph' is undefined. Expected Graph`);\n\n  const aa = resolveVertex(graph, a);\n  const bb = resolveVertex(graph, b);\n  for (const edge of graph.edges) {\n    if (edge.a == aa.id && edge.b === bb.id) return edge;\n    if (edge.a == bb.id && edge.b === aa.id) return edge;\n  }\n  return;\n}\n\n/**\n * Connects A with B, returning the changed graph and created edge.\n * If the connection already exists, the original graph & edge is returned.\n * @param graph \n * @param a \n * @param b \n * @param weight \n * @returns \n */\nexport function connectTo(graph: Graph, a: string, b: string, weight?: number): { graph: Graph, edge: Edge } {\n  const aResult = getOrCreate(graph, a);\n  graph = aResult.graph;\n  const bResult = getOrCreate(graph, b);\n  graph = bResult.graph;\n\n  let edge = getConnection(graph, a, b);\n  if (edge !== undefined) return { graph, edge };\n  edge = {\n    a,\n    b,\n    weight\n  }\n\n  const graphChanged: Graph = {\n    ...graph,\n    edges: [ ...graph.edges, edge ]\n  }\n  return { graph: graphChanged, edge }\n}\n\n\n/**\n * Makes a connection between `options.a` and one or more nodes in `options.b`.\n * Same as {@link connectWithEdges} but only the {@link Graph} is returned.\n * \n * ```js\n * let g = graph(); // Create an empty graph\n * // Make a connection between `red` and `orange`\n * g = connect(g, { a: `red`, b: `orange` });\n * \n * // Make a connection between `red` and `orange as well as `red` and `yellow`.\n * g = connect(g, { a: `red`, b: [`orange`, `yellow`] })\n * ```\n * @param graph Initial graph\n * @param options Options\n */\nexport function connect(graph: Graph, options: ConnectOptions): Graph {\n  const result = connectWithEdges(graph, options);\n  return result.graph;\n}\n\n/**\n * Makes a connection between `options.a` and one or more nodes in `options.b`.\n * Same as {@link connect} but graph and edges are returned.\n * \n * ```js\n * let g = graph(); // Create an empty graph\n * \n * // Make a connection between `red` and `orange`\n * result = connectWithEdges(g, { a: `red`, b: `orange` });\n * \n * // Make a connection between `red` and `orange as well as `red` and `yellow`.\n * result = connectWithEdges(g, { a: `red`, b: [`orange`, `yellow`] })\n * ```\n * @param graph Initial graph\n * @param options Options\n */\nexport function connectWithEdges(graph: Graph, options: ConnectOptions): { graph: Graph, edges: Edge[] } {\n  const { a, weight, b } = options;\n  const destinations = Array.isArray(b) ? b : [ b ];\n  const edges: Edge[] = [];\n  for (const destination of destinations) {\n    const result = connectTo(graph, a, destination, weight);\n    graph = result.graph;\n    edges.push(result.edge);\n  }\n\n  return { graph, edges };\n}\n\nexport const graph = (...initialConnections: ConnectOptions[]): Graph => {\n  let g: Graph = {\n    vertices: immutableMap(),\n    edges: []\n  }\n  for (const ic of initialConnections) {\n    g = connect(g, ic);\n  }\n  return g;\n}\n\nexport function toAdjacencyMatrix(graph: Graph): Table<boolean> {\n  const v = [ ...graph.vertices.values() ];\n\n  const table = new Table<boolean>();\n  table.labelColumns(...v.map(vv => vv.id));\n  table.labelRows(...v.map(vv => vv.id));\n\n  // eslint-disable-next-line unicorn/prevent-abbreviations\n  for (let i = 0; i < v.length; i++) {\n    table.setRow(i, false, v.length);\n\n    const ii = v[ i ];\n    // eslint-disable-next-line unicorn/prevent-abbreviations\n    for (const [ j, jj ] of v.entries()) {\n      const connected = hasConnection(graph, ii, jj);\n      if (connected) {\n        table.set(i, j, true);\n      }\n    }\n  }\n  return table;\n}\n\n/**\n * Return a string representation of the graph for debug inspection\n * @param graph \n * @returns \n */\nexport const dumpGraph = (graph: Graph): string => {\n  const lines = debugGraphToArray(graph);\n  return lines.join(`\\n`);\n}\n\n/**\n * Return an array of a debug-print of every vertex.\n * @param graph \n * @returns \n */\nconst debugGraphToArray = (graph: Graph): string[] => {\n  const r: string[] = [];\n\n  r.push(`Vertices: ${ [ ...graph.vertices.values() ].map(v => v.id).join(`, `) }`);\n\n  r.push(`Edges:`);\n  for (const edge of graph.edges) {\n    r.push(stringForEdge(edge));\n  }\n  return r;\n}\n\nconst stringForEdge = (edge: Edge) => {\n  const weight = edge.weight ? ` (${ edge.weight })` : ``;\n  return `${ edge.a } <-> ${ edge.b }${ weight }`\n}\n\n/**\n * Iterate over all the vertices connectd to `context` vertex\n * @param graph Graph\n * @param context id or Vertex\n * @returns \n */\nexport function* adjacentVertices(graph: Graph, context: Vertex | string | undefined) {\n  if (context === undefined) return;\n  const vertex = typeof context === `string` ? graph.vertices.get(context) : context;\n  if (vertex === undefined) throw new Error(`Vertex not found ${ JSON.stringify(context) }`);\n\n  for (const edge of graph.edges) {\n    if (edge.a === context) yield resolveVertex(graph, edge.b);\n    else if (edge.b === context) yield resolveVertex(graph, edge.a);\n  }\n}\n\nexport function* edgesForVertex(graph: Graph, context: Vertex | string | undefined) {\n  if (context === undefined) return;\n  const vertex = typeof context === `string` ? graph.vertices.get(context) : context;\n  if (vertex === undefined) throw new Error(`Vertex not found ${ JSON.stringify(context) }`);\n\n  for (const edge of graph.edges) {\n    if (edge.a === context) yield edge;\n    else if (edge.b === context) yield edge;\n  }\n}","/**\n * Directed graphs\n * \n * Graph _vertices_ (ie. nodes) connect to each other along _edges_.\n * This is 'directed' in that connections are not necessarily mutual.\n * A can connect to B without B connecting to A.\n * \n * Connections can have an optional weight, defaulting to 1.\n * \n * @example Creating a directed graph A connects to B and C; B connects to C. C has edges.\n * ```js\n * let g = Directed.graph(\n *  { from: `a`, to: [`b`, `c`] },\n *  { from: `b`, to: `c` }\n*  );\n* ```\n* \n* Graphs do not store data directly, only the relation between vertices. Each vertex has an id,\n* so to associate data, use a map along with the graph.\n*\n*/\nexport * as Directed from './directed-graph.js';\n\n/**\n * Undirected graphs\n * \n * Graph _vertices_ (ie. nodes) connect to each other along _edges_.\n * Unlike a directed graph, nodes are always mutually connected.\n * \n * @example Creating an undirected graph where vertex 0 connects to 1, 2 & 3; 2 connects to 1\n * ```js\n * let g = Undirected.graph(\n *    { a: `0`, b: [ `1`, `2`, `3` ] },\n *    { a: `2`, b: `1` }\n *  );\n* ```\n* \n* Graphs do not store data directly, only the relation between vertices. Each vertex has an id,\n* so to associate data, use a map along with the graph.\n*\n*/\nexport * as Undirected from './undirected-graph.js';","/**\n * Maps the keys of an object, returning a transformed object.\n * ```js\n * const input = {\n *  hello: `there`,\n *  chap: `chappie`\n * }\n *\n * mapObjectKeys(input, key => key.toUppercase());\n *\n * // Yields: { HELLO: `there`, CHAP: `chappie` }\n * ```\n * @param object\n * @param mapFunction\n * @returns\n */\nexport const mapObjectKeys = (object, mapFunction) => {\n    const destinationObject = {};\n    for (const entries of Object.entries(object)) {\n        const key = mapFunction(entries[0]);\n        destinationObject[key] = entries[1];\n    }\n    return destinationObject;\n};\n","import { compareIterableValuesShallow, isEqualDefault } from '@ixfx/core';\nimport { mapObjectKeys } from './map-object-keys.js';\n/**\n * Compares the keys of two objects, returning a set of those in\n * common, and those in either A or B exclusively.\n * ```js\n * const a = { colour: `red`, intensity: 5 };\n * const b = { colour: `pink`, size: 10 };\n * const c = compareObjectKeys(a, b);\n * // c.shared = [ `colour` ]\n * // c.a = [ `intensity` ]\n * // c.b = [ `size`  ]\n * ```\n * @param a\n * @param b\n * @returns\n */\nexport const compareObjectKeys = (a, b) => {\n    const c = compareIterableValuesShallow(Object.keys(a), Object.keys(b));\n    return c;\n};\n/**\n * Returns the changed fields from A -> B. It's assumed that A and B have the same shape.\n * ie. returns an object that only consists of fields which have changed in B compared to A.\n *\n * ```js\n * const a = { msg: `hi`, v: 10 };\n *\n * changedObjectDataFields(a, { msg: `hi`,   v: 10 }); // {}\n * changedObjectDataFields(a, { msg: `hi!!`, v: 10 }); // { msg: `hi!!` }\n * changedObjectDataFields(a, { msg: `hi!!` });       // { msg: `hi!!`, v: undefined }\n * ```\n *\n * If B has additional or removed fields, this is considered an error.\n *\n * If a field is an array, the whole array is returned, rather than a diff.\n * @param a\n * @param b\n */\nexport const changedObjectDataFields = (a, b) => {\n    const r = compareObjectData(a, b, true);\n    if (Object.entries(r.added).length > 0)\n        throw new Error(`Shape of data has changed`);\n    if (Object.entries(r.removed).length > 0)\n        throw new Error(`Shape of data has changed`);\n    const output = compareResultToObject(r, b);\n    return output;\n};\nconst compareResultToObject = (r, b) => {\n    const output = {};\n    if (r.isArray) {\n        return b;\n    }\n    for (const entry of Object.entries(r.changed)) {\n        output[entry[0]] = entry[1];\n    }\n    for (const entry of Object.entries(r.added)) {\n        output[entry[0]] = entry[1];\n    }\n    for (const childEntry of Object.entries(r.children)) {\n        const childResult = childEntry[1];\n        if (childResult.hasChanged) {\n            // eslint-disable-next-line @typescript-eslint/no-unsafe-argument\n            output[childEntry[0]] = compareResultToObject(childResult, b[childEntry[0]]);\n        }\n    }\n    return output;\n};\n/**\n * Produces a {@link CompareChangeSet} between two arrays.\n *\n * @param a Earlier array to compare\n * @param b Later array to compare\n * @param eq Equality comparison for values\n * @returns Change set.\n */\nexport const compareArrays = (a, b, eq = (isEqualDefault)) => {\n    if (!Array.isArray(a))\n        throw new Error(`Param 'a' is not an array`);\n    if (!Array.isArray(b))\n        throw new Error(`Param 'b' is not an array`);\n    const c = compareObjectData(a, b, false, eq);\n    if (!c.isArray)\n        throw new Error(`Change set does not have arrays as parameters`);\n    const convert = (key) => {\n        if (key.startsWith(`_`)) {\n            return Number.parseInt(key.slice(1));\n        }\n        else\n            throw new Error(`Unexpected key '${key}'`);\n    };\n    const cc = {\n        ...c,\n        added: mapObjectKeys(c.added, convert),\n        changed: mapObjectKeys(c.changed, convert),\n        removed: c.removed.map(v => convert(v)),\n        summary: c.summary.map(value => {\n            return [value[0], convert(value[1]), value[2]];\n        })\n    };\n    return cc;\n};\n/**\n * Compares A to B. Assumes they are simple objects, essentially key-value pairs, where the\n * values are primitive values or other simple objects. It also works with arrays.\n *\n * Uses === equality semantics by default.\n * @param a\n * @param b\n */\nexport const compareObjectData = (a, b, assumeSameShape = false, eq = isEqualDefault) => {\n    a ??= {};\n    b ??= {};\n    const entriesA = Object.entries(a);\n    const entriesB = Object.entries(b);\n    const scannedKeys = new Set();\n    const changed = {};\n    const added = {};\n    const children = {};\n    const removed = [];\n    const isArray = Array.isArray(a);\n    const summary = new Array();\n    let hasChanged = false;\n    // Look for existing entries of A that are modified\n    for (const entry of entriesA) {\n        const outputKey = isArray ? `_${entry[0]}` : entry[0];\n        const aValue = entry[1];\n        const bValue = b[entry[0]];\n        scannedKeys.add(entry[0]);\n        if (bValue === undefined) {\n            // B does not have a key from A\n            hasChanged = true;\n            if (assumeSameShape && !isArray) {\n                // If we're assuming it's the same shape, then _undefined_ is actually the value\n                changed[outputKey] = bValue;\n                summary.push([`mutate`, outputKey, bValue]);\n            }\n            else {\n                // Key removed\n                removed.push(outputKey);\n                summary.push([`del`, outputKey, aValue]);\n            }\n            continue;\n        }\n        if (typeof aValue === `object`) {\n            const r = compareObjectData(aValue, bValue, assumeSameShape, eq);\n            if (r.hasChanged)\n                hasChanged = true;\n            children[outputKey] = r;\n            const childSummary = r.summary.map(sum => { return [sum[0], outputKey + `.` + sum[1], sum[2]]; });\n            summary.push(...childSummary);\n        }\n        else {\n            if (!eq(aValue, bValue)) {\n                changed[outputKey] = bValue;\n                hasChanged = true;\n                summary.push([`mutate`, outputKey, bValue]);\n            }\n        }\n    }\n    // Look for entries in B that weren't in A\n    if (!assumeSameShape || isArray) {\n        for (const entry of entriesB) {\n            const key = isArray ? `_${entry[0]}` : entry[0];\n            if (scannedKeys.has(entry[0]))\n                continue;\n            added[key] = entry[1];\n            hasChanged = true;\n            summary.push([`add`, key, entry[1]]);\n        }\n    }\n    return {\n        changed, added, removed, children, hasChanged, isArray, summary\n    };\n};\n","import { testPlainObjectOrPrimitive } from \"@ixfx/guards\";\nexport const cloneFromFields = (source) => {\n    const entries = [];\n    for (const field in source) {\n        const value = (source)[field];\n        if (testPlainObjectOrPrimitive(value)) {\n            entries.push([field, value]);\n        }\n    }\n    return Object.fromEntries(entries);\n};\n","/**\n * Maps the top-level properties of an object through a map function.\n * That is, run each of the values of an object through a function,\n * setting the result onto the same key structure as original.\n *\n * It is NOT recursive.\n *\n * The mapping function gets a single args object, consisting of `{ value, field, index }`,\n * where 'value' is the value of the field, 'field' the name, and 'index' a numeric count.\n * @example Double the value of all fields\n * ```js\n * const rect = { width: 100, height: 250 };\n * const doubled = mapObjectShallow(rect, args => {\n *  return args.value*2;\n * });\n * // Yields: { width: 200, height: 500 }\n * ```\n *\n * Since the map callback gets the name of the property, it can do context-dependent things.\n * ```js\n * const rect = { width: 100, height: 250, colour: 'red' }\n * const doubled = mapObjectShallow(rect, args => {\n *  if (args.field === 'width') return args.value*3;\n *  else if (typeof args.value === 'number') return args.value*2;\n *  return args.value;\n * });\n * // Yields: { width: 300, height: 500, colour: 'red' }\n * ```\n * In addition to bulk processing, it allows remapping of property types.\n *\n * In terms of type-safety, the mapped properties are assumed to have the\n * same type.\n *\n * ```js\n * const o = {\n *  x: 10,\n *  y: 20,\n *  width: 200,\n *  height: 200\n * }\n *\n * // Make each property use an averager instead\n * const oAvg = mapObjectShallow(o, args => {\n *  return movingAverage(10);\n * });\n *\n * // Instead of { x:number, y:number... }, we now have { x:movingAverage(), y:movingAverage()... }\n * // Add a value to the averager\n * oAvg.x.add(20);\n * ```\n */\nexport const mapObjectShallow = (object, mapFunction) => {\n    const entries = Object.entries(object);\n    const mapped = entries.map(([sourceField, sourceFieldValue], index) => [\n        sourceField,\n        mapFunction({ value: sourceFieldValue, field: sourceField, index, path: sourceField }),\n    ]);\n    return Object.fromEntries(mapped);\n};\n/**\n * Maps the contents of `data` using `mapper` as a structured set of map functions.\n * ```js\n * const a = {\n *  person: {\n *    size: 20\n *  }\n *  hello: `there`\n * }\n * mapObjectByObject(a, {\n *  person: {\n *    size: (value, context) => {\n *      return value * 2\n *    }\n *  }\n * });\n * // Yields: { person: { size: 40 }, hello: `there` }\n * ```\n * @param data\n * @param mapper\n * @returns\n */\nexport function mapObjectByObject(data, mapper) {\n    const entries = Object.entries(data);\n    for (const entry of entries) {\n        if (entry[0] in mapper) {\n            const m = mapper[entry[0]];\n            entry[1] = (typeof m === `object`) ?\n                mapObjectByObject(entry[1], m) :\n                m(entry[1], data);\n        }\n    }\n    return Object.fromEntries(entries);\n}\n","import { resultThrow, nullUndefTest } from '@ixfx/guards';\nimport { isPrimitive } from '../is-primitive.js';\n/**\n * Helper function to get a 'friendly' string representation of an array of {@link RecordEntry}.\n * @param entries\n * @returns\n */\nexport function prettyPrintEntries(entries) {\n    if (entries.length === 0)\n        return `(empty)`;\n    let t = ``;\n    for (const [index, entry] of entries.entries()) {\n        t += `  `.repeat(index);\n        t += entry.name + ` = ` + JSON.stringify(entry.nodeValue) + `\\n`;\n    }\n    return t;\n}\n/**\n * Returns a human-friendly debug string for a tree-like structure\n * ```js\n * console.log(Trees.prettyPrint(obj));\n * ```\n * @param indent\n * @param node\n * @param options\n * @returns\n */\nexport const recordEntryPrettyPrint = (node, indent = 0, options = {}) => {\n    resultThrow(nullUndefTest(node, `node`));\n    const defaultName = options.name ?? `node`;\n    const entry = getNamedRecordEntry(node, defaultName);\n    const t = `${`  `.repeat(indent)} + name: ${entry.name} value: ${JSON.stringify(entry.nodeValue)}`;\n    const childrenAsArray = [...recordChildren(node, options)];\n    return childrenAsArray.length > 0 ? (t +\n        `\\n` +\n        childrenAsArray.map((d) => recordEntryPrettyPrint(d.nodeValue, indent + 1, { ...options, name: d.name })).join(`\\n`)) : t;\n};\n/**\n * Returns the direct children of a tree-like object as a pairing\n * of node name and value. Supports basic objects, Maps and arrays.\n *\n * Sub-children are included as an object blob.\n *\n * @example Simple object\n * ```js\n * const o = {\n *  colour: {\n *    r: 0.5, g: 0.5, b: 0.5\n *  }\n * };\n *\n * const children = [ ...Trees.children(o) ];\n * // Children:\n * // [\n * //  { name: \"colour\", value: { b: 0.5, g: 0.5, r: 0.5 } }\n * // ]\n * const subChildren = [ ...Trees.children(o.colour) ];\n * // [ { name: \"r\", value: 0.5 }, { name: \"g\", value: 0.5 }, { name: \"b\", value: 0.5 } ]\n * ```\n *\n * Arrays are assigned a name based on index.\n * @example Arrays\n * ```js\n * const colours = [ { r: 1, g: 0, b: 0 }, { r: 0, g: 1, b: 0 }, { r: 0, g: 0, b: 1 } ];\n * // Children:\n * // [\n * //  { name: \"array[0]\", value: {r:1,g:0,b:0} },\n * //  { name: \"array[1]\", value: {r:0,g:1,b:0} },\n * //  { name: \"array[2]\", value: {r:0,g:0,b:1} },\n * // ]\n * ```\n *\n * Pass in `options.name` (eg 'colours') to have names generated as 'colours[0]', etc.\n * Options can also be used to filter children. By default all direct children are returned.\n * @param node\n * @param options\n */\nexport function* recordChildren(node, options = {}) {\n    resultThrow(nullUndefTest(node, `node`));\n    const filter = options.filter ?? `none`;\n    const filterByValue = (v) => {\n        if (filter === `none`)\n            return [true, isPrimitive(v)];\n        else if (filter === `leaves` && isPrimitive(v))\n            return [true, true];\n        else if (filter === `branches` && !isPrimitive(v))\n            return [true, false];\n        return [false, isPrimitive(v)];\n    };\n    if (Array.isArray(node)) {\n        //if (options.name === undefined) defaultName = `array`;\n        for (const [index, element] of node.entries()) {\n            const f = filterByValue(element);\n            if (f[0]) {\n                yield { name: index.toString(), sourceValue: element, nodeValue: f[1] ? element : undefined };\n                //yield { name: defaultName + `[` + index.toString() + `]`, sourceValue: element, nodeValue: f[ 1 ] ? element : undefined };\n            }\n        }\n    }\n    else if (typeof node === `object`) {\n        const entriesIter = (`entries` in node) ? node.entries() : Object.entries(node);\n        for (const [name, value] of entriesIter) {\n            //onsole.log(`children name: ${ name } type: ${ typeof value } isPrim: ${ isPrimitive(value) } filter: ${ filter }`);\n            const f = filterByValue(value);\n            if (f[0]) {\n                yield { name: name, sourceValue: value, nodeValue: f[1] ? value : undefined };\n            }\n        }\n    }\n}\nexport function* recordEntriesDepthFirst(node, options = {}, ancestors = []) {\n    for (const c of recordChildren(node, options)) {\n        //onsole.log(`depthFirst name: ${ c.name } nodeValue: ${ toStringAbbreviate(c.nodeValue) }`)\n        yield { ...c, ancestors: [...ancestors] };\n        yield* recordEntriesDepthFirst(c.sourceValue, options, [...ancestors, c.name]);\n    }\n}\n/**\n * Finds a given direct child by name\n * @param name\n * @param node\n * @returns\n */\nfunction recordEntryChildByName(name, node) {\n    for (const d of recordChildren(node)) {\n        if (d.name === name)\n            return d;\n    }\n}\n/**\n * Returns the closest matching entry, tracing `path` in an array, Map or simple object.\n * Returns an entry with _undefined_ value at the point where tracing stopped.\n * Use {@link traceRecordEntryByPath} to step through all the segments.\n *\n * ```js\n  * const people = {\n    *  jane: {\n *   address: {\n *    postcode: 1000,\n    *    street: 'West St',\n    *    city: 'Blahville'\n *   },\n * colour: 'red'\n  *  }\n * }\n * Trees.getByPath('jane.address.postcode', people); // '.' default separator\n * // ['postcode', 1000]\n * Trees.getByPath('jane.address.country.state', people);\n * // ['country', undefined] - since full path could not be resolved.\n * ```\n * @param path Path, eg `jane.address.postcode`\n * @param node Node to look within\n * @param options Options for parsing path. By default '.' is used as a separator\n * @returns\n */\nexport function getRecordEntryByPath(path, node, options = {}) {\n    const paths = [...traceRecordEntryByPath(path, node, options)];\n    if (paths.length === 0)\n        throw new Error(`Could not trace path: ${path} `);\n    return paths.at(-1);\n}\n/**\n * Enumerates over children of `node` towards the node named in `path`.\n * This is useful if you want to get the interim steps to the target node.\n *\n * Use {@link getRecordEntryByPath} if you don't care about interim steps.\n *\n * ```js\n * const people = {\n *  jane: {\n *   address: {\n *    postcode: 1000,\n *    street: 'West St',\n *    city: 'Blahville'\n *   },\n * colour: 'red'\n *  }\n * }\n * for (const p of Trees.traceByPath('jane.address.street', people)) {\n * // { name: \"jane\", value: { address: { postcode: 1000,street: 'West St', city: 'Blahville' }, colour: 'red'} },\n * // { name: \"address\", value: { postcode: 1000, street: 'West St', city: 'Blahville' } },\n * // { name: \"street\", value: \"West St\" } }\n * }\n * ```\n *\n * Results stop when the path can't be followed any further.\n * The last entry will have a name of the last sought path segment, and _undefined_ as its value.\n *\n * @param path Path to traverse\n * @param node Starting node\n * @param options Options for path traversal logic\n * @returns\n */\nexport function* traceRecordEntryByPath(path, node, options = {}) {\n    resultThrow(nullUndefTest(path, `path`), nullUndefTest(node, `node`));\n    const separator = options.separator ?? `.`;\n    const pathSplit = path.split(separator);\n    const ancestors = [];\n    for (const p of pathSplit) {\n        const entry = recordEntryChildByName(p, node);\n        if (!entry) {\n            yield { name: p, sourceValue: undefined, nodeValue: undefined, ancestors };\n            return;\n        }\n        node = entry.sourceValue;\n        yield { ...entry, ancestors: [...ancestors] };\n        ancestors.push(p);\n    }\n}\n/**\n * Generates a name for a node.\n * Uses the 'name' property if it exists, otherwise uses `defaultName`\n * @param node\n * @param defaultName\n * @returns\n */\nfunction getNamedRecordEntry(node, defaultName = ``) {\n    if (`name` in node && `nodeValue` in node && `sourceValue` in node)\n        return node;\n    if (`name` in node) {\n        return { name: node.name, nodeValue: node, sourceValue: node };\n    }\n    return { name: defaultName, nodeValue: node, sourceValue: node };\n}\n","// Source: https://stackoverflow.com/questions/49682569/typescript-merge-object-types\n// jcalz 2021-09-09\nexport function mergeObjects(...a) {\n    return Object.assign({}, ...a);\n}\n","/**\n * Returns a copy of `object` with integer numbers as keys instead of whatever it has.\n * ```js\n * keysToNumbers({ '1': true }); // Yields: { 1: true }\n * ```\n *\n * The `onInvalidKey` sets how to handle keys that cannot be converted to integers.\n * * 'throw' (default): throws an exception\n * * 'ignore': that key & value is ignored\n * * 'keep': uses the string key instead\n *\n *\n * ```js\n * keysToNumber({ hello: 'there' }, `ignore`); // Yields: {  }\n * keysToNumber({ hello: 'there' }, `throw`);  // Exception\n * keysToNumber({ hello: 'there' }, `keep`);   // Yields: { hello: 'there' }\n * ```\n *\n * Floating-point numbers will be converted to integer by rounding.\n * ```js\n * keysToNumbers({ '2.4': 'hello' }); // Yields: { 2: 'hello' }\n * ```\n * @param object\n * @param onInvalidKey\n * @returns\n */\nexport const keysToNumbers = (object, onInvalidKey = `throw`) => {\n    const returnObject = {};\n    for (const entry of Object.entries(object)) {\n        const asNumber = Number.parseInt(entry[0]);\n        if (Number.isNaN(asNumber)) {\n            switch (onInvalidKey) {\n                case `throw`: {\n                    throw new TypeError(`Cannot convert key '${entry[0]}' to an integer`);\n                }\n                case `ignore`: {\n                    continue;\n                }\n                case `keep`: {\n                    // eslint-disable-next-line @typescript-eslint/no-explicit-any, @typescript-eslint/no-unsafe-member-access\n                    returnObject[entry[0]] = entry[1];\n                    continue;\n                }\n                default: {\n                    throw new Error(`Param 'onInvalidKey' should be: 'throw', 'ignore' or 'keep'.`);\n                }\n            }\n        }\n        returnObject[asNumber] = entry[1];\n    }\n    return returnObject;\n};\n","export * from './compare.js';\nexport * from './clone-from-fields.js';\nexport * from './map-object.js';\nexport * from './map-object-keys.js';\nexport * from './traverse.js';\nexport * from './merge.js';\nexport * from './keys-to-numbers.js';\n","//import { minMaxAvg as arrayMinMaxAvg } from '../../ixfx/src/numbers-compute.js';\nimport { defaultComparer } from './comparers.js';\nconst sorterByValueIndex = (index, reverse = false) => {\n    return (values) => {\n        const s = values.toSorted((a, b) => {\n            return defaultComparer(a[index], b[index]);\n        });\n        if (reverse)\n            return s.reverse();\n        return s;\n    };\n};\nexport const keyValueSorter = (sortStyle) => {\n    switch (sortStyle) {\n        case `value`: {\n            return sorterByValueIndex(1, false);\n        }\n        case `value-reverse`: {\n            return sorterByValueIndex(1, true);\n        }\n        case `key`: {\n            return sorterByValueIndex(0, false);\n        }\n        case `key-reverse`: {\n            return sorterByValueIndex(0, true);\n        }\n        default: {\n            throw new Error(`Unknown sorting value '${sortStyle}'. Expecting: value, value-reverse, key or key-reverse`);\n        }\n    }\n};\n// export const minMaxAvg = (entries: readonly KeyValue[], conversionFunction?: (v: KeyValue) => number) => {\n//   const converter = conversionFunction ?? ((v: KeyValue) => v[ 1 ] as number);\n//   const values = entries.map<number>(entry => converter(entry));\n//   return arrayMinMaxAvg(values);\n// };\n","import { toStringDefault } from \"@ixfx/core\";\n/**\n * Tracks unique values. Returns _true_ if value is unique.\n * Alternatively: {@link uniqueInstances}\n *\n * ```js\n * const t = unique();\n * t(`hello`); // true\n * t(`hello`); // false\n * ```\n *\n * Uses JSON.stringify to compare anything which is not a string.\n *\n * Provide a custom function to convert to string to track uniqueness\n * for more complicated objects.\n *\n * ```js\n * const t = unique(p => p.name);\n * t({ name:`John`, level:2 }); // true\n *\n * // Since we're judging uniques by name only\n * t({ name:`John`, level:3 }); // false\n * ```\n *\n * Return function throws an error if `value` is null or undefined.\n * @returns\n */\nexport const unique = (toString = toStringDefault) => {\n    const set = new Set();\n    return (value) => {\n        if (value === null)\n            throw new TypeError(`Param 'value' cannot be null`);\n        if (value === undefined)\n            throw new TypeError(`Param 'value' cannot be undefined`);\n        const asString = (typeof value === `string`) ? value : toString(value);\n        if (set.has(asString))\n            return false;\n        set.add(asString);\n        return true;\n    };\n};\n/**\n * Tracks unique object instances. Returns _true_ if value is unique.\n * Alternatively: {@link unique} to track by value.\n */\nexport const uniqueInstances = () => {\n    const set = new Set();\n    return (value) => {\n        if (value === null)\n            throw new TypeError(`Param 'value' cannot be null`);\n        if (value === undefined)\n            throw new TypeError(`Param 'value' cannot be undefined`);\n        if (set.has(value))\n            return false;\n        set.add(value);\n        return true;\n    };\n};\n","(function (global, factory) {\n\ttypeof exports === 'object' && typeof module !== 'undefined' ? module.exports = factory() :\n\ttypeof define === 'function' && define.amd ? define(factory) :\n\t(global.JSON5 = factory());\n}(this, (function () { 'use strict';\n\n\tfunction createCommonjsModule(fn, module) {\n\t\treturn module = { exports: {} }, fn(module, module.exports), module.exports;\n\t}\n\n\tvar _global = createCommonjsModule(function (module) {\n\t// https://github.com/zloirock/core-js/issues/86#issuecomment-115759028\n\tvar global = module.exports = typeof window != 'undefined' && window.Math == Math\n\t  ? window : typeof self != 'undefined' && self.Math == Math ? self\n\t  // eslint-disable-next-line no-new-func\n\t  : Function('return this')();\n\tif (typeof __g == 'number') { __g = global; } // eslint-disable-line no-undef\n\t});\n\n\tvar _core = createCommonjsModule(function (module) {\n\tvar core = module.exports = { version: '2.6.5' };\n\tif (typeof __e == 'number') { __e = core; } // eslint-disable-line no-undef\n\t});\n\tvar _core_1 = _core.version;\n\n\tvar _isObject = function (it) {\n\t  return typeof it === 'object' ? it !== null : typeof it === 'function';\n\t};\n\n\tvar _anObject = function (it) {\n\t  if (!_isObject(it)) { throw TypeError(it + ' is not an object!'); }\n\t  return it;\n\t};\n\n\tvar _fails = function (exec) {\n\t  try {\n\t    return !!exec();\n\t  } catch (e) {\n\t    return true;\n\t  }\n\t};\n\n\t// Thank's IE8 for his funny defineProperty\n\tvar _descriptors = !_fails(function () {\n\t  return Object.defineProperty({}, 'a', { get: function () { return 7; } }).a != 7;\n\t});\n\n\tvar document = _global.document;\n\t// typeof document.createElement is 'object' in old IE\n\tvar is = _isObject(document) && _isObject(document.createElement);\n\tvar _domCreate = function (it) {\n\t  return is ? document.createElement(it) : {};\n\t};\n\n\tvar _ie8DomDefine = !_descriptors && !_fails(function () {\n\t  return Object.defineProperty(_domCreate('div'), 'a', { get: function () { return 7; } }).a != 7;\n\t});\n\n\t// 7.1.1 ToPrimitive(input [, PreferredType])\n\n\t// instead of the ES6 spec version, we didn't implement @@toPrimitive case\n\t// and the second argument - flag - preferred type is a string\n\tvar _toPrimitive = function (it, S) {\n\t  if (!_isObject(it)) { return it; }\n\t  var fn, val;\n\t  if (S && typeof (fn = it.toString) == 'function' && !_isObject(val = fn.call(it))) { return val; }\n\t  if (typeof (fn = it.valueOf) == 'function' && !_isObject(val = fn.call(it))) { return val; }\n\t  if (!S && typeof (fn = it.toString) == 'function' && !_isObject(val = fn.call(it))) { return val; }\n\t  throw TypeError(\"Can't convert object to primitive value\");\n\t};\n\n\tvar dP = Object.defineProperty;\n\n\tvar f = _descriptors ? Object.defineProperty : function defineProperty(O, P, Attributes) {\n\t  _anObject(O);\n\t  P = _toPrimitive(P, true);\n\t  _anObject(Attributes);\n\t  if (_ie8DomDefine) { try {\n\t    return dP(O, P, Attributes);\n\t  } catch (e) { /* empty */ } }\n\t  if ('get' in Attributes || 'set' in Attributes) { throw TypeError('Accessors not supported!'); }\n\t  if ('value' in Attributes) { O[P] = Attributes.value; }\n\t  return O;\n\t};\n\n\tvar _objectDp = {\n\t\tf: f\n\t};\n\n\tvar _propertyDesc = function (bitmap, value) {\n\t  return {\n\t    enumerable: !(bitmap & 1),\n\t    configurable: !(bitmap & 2),\n\t    writable: !(bitmap & 4),\n\t    value: value\n\t  };\n\t};\n\n\tvar _hide = _descriptors ? function (object, key, value) {\n\t  return _objectDp.f(object, key, _propertyDesc(1, value));\n\t} : function (object, key, value) {\n\t  object[key] = value;\n\t  return object;\n\t};\n\n\tvar hasOwnProperty = {}.hasOwnProperty;\n\tvar _has = function (it, key) {\n\t  return hasOwnProperty.call(it, key);\n\t};\n\n\tvar id = 0;\n\tvar px = Math.random();\n\tvar _uid = function (key) {\n\t  return 'Symbol('.concat(key === undefined ? '' : key, ')_', (++id + px).toString(36));\n\t};\n\n\tvar _library = false;\n\n\tvar _shared = createCommonjsModule(function (module) {\n\tvar SHARED = '__core-js_shared__';\n\tvar store = _global[SHARED] || (_global[SHARED] = {});\n\n\t(module.exports = function (key, value) {\n\t  return store[key] || (store[key] = value !== undefined ? value : {});\n\t})('versions', []).push({\n\t  version: _core.version,\n\t  mode: _library ? 'pure' : 'global',\n\t  copyright: ' 2019 Denis Pushkarev (zloirock.ru)'\n\t});\n\t});\n\n\tvar _functionToString = _shared('native-function-to-string', Function.toString);\n\n\tvar _redefine = createCommonjsModule(function (module) {\n\tvar SRC = _uid('src');\n\n\tvar TO_STRING = 'toString';\n\tvar TPL = ('' + _functionToString).split(TO_STRING);\n\n\t_core.inspectSource = function (it) {\n\t  return _functionToString.call(it);\n\t};\n\n\t(module.exports = function (O, key, val, safe) {\n\t  var isFunction = typeof val == 'function';\n\t  if (isFunction) { _has(val, 'name') || _hide(val, 'name', key); }\n\t  if (O[key] === val) { return; }\n\t  if (isFunction) { _has(val, SRC) || _hide(val, SRC, O[key] ? '' + O[key] : TPL.join(String(key))); }\n\t  if (O === _global) {\n\t    O[key] = val;\n\t  } else if (!safe) {\n\t    delete O[key];\n\t    _hide(O, key, val);\n\t  } else if (O[key]) {\n\t    O[key] = val;\n\t  } else {\n\t    _hide(O, key, val);\n\t  }\n\t// add fake Function#toString for correct work wrapped methods / constructors with methods like LoDash isNative\n\t})(Function.prototype, TO_STRING, function toString() {\n\t  return typeof this == 'function' && this[SRC] || _functionToString.call(this);\n\t});\n\t});\n\n\tvar _aFunction = function (it) {\n\t  if (typeof it != 'function') { throw TypeError(it + ' is not a function!'); }\n\t  return it;\n\t};\n\n\t// optional / simple context binding\n\n\tvar _ctx = function (fn, that, length) {\n\t  _aFunction(fn);\n\t  if (that === undefined) { return fn; }\n\t  switch (length) {\n\t    case 1: return function (a) {\n\t      return fn.call(that, a);\n\t    };\n\t    case 2: return function (a, b) {\n\t      return fn.call(that, a, b);\n\t    };\n\t    case 3: return function (a, b, c) {\n\t      return fn.call(that, a, b, c);\n\t    };\n\t  }\n\t  return function (/* ...args */) {\n\t    return fn.apply(that, arguments);\n\t  };\n\t};\n\n\tvar PROTOTYPE = 'prototype';\n\n\tvar $export = function (type, name, source) {\n\t  var IS_FORCED = type & $export.F;\n\t  var IS_GLOBAL = type & $export.G;\n\t  var IS_STATIC = type & $export.S;\n\t  var IS_PROTO = type & $export.P;\n\t  var IS_BIND = type & $export.B;\n\t  var target = IS_GLOBAL ? _global : IS_STATIC ? _global[name] || (_global[name] = {}) : (_global[name] || {})[PROTOTYPE];\n\t  var exports = IS_GLOBAL ? _core : _core[name] || (_core[name] = {});\n\t  var expProto = exports[PROTOTYPE] || (exports[PROTOTYPE] = {});\n\t  var key, own, out, exp;\n\t  if (IS_GLOBAL) { source = name; }\n\t  for (key in source) {\n\t    // contains in native\n\t    own = !IS_FORCED && target && target[key] !== undefined;\n\t    // export native or passed\n\t    out = (own ? target : source)[key];\n\t    // bind timers to global for call from export context\n\t    exp = IS_BIND && own ? _ctx(out, _global) : IS_PROTO && typeof out == 'function' ? _ctx(Function.call, out) : out;\n\t    // extend global\n\t    if (target) { _redefine(target, key, out, type & $export.U); }\n\t    // export\n\t    if (exports[key] != out) { _hide(exports, key, exp); }\n\t    if (IS_PROTO && expProto[key] != out) { expProto[key] = out; }\n\t  }\n\t};\n\t_global.core = _core;\n\t// type bitmap\n\t$export.F = 1;   // forced\n\t$export.G = 2;   // global\n\t$export.S = 4;   // static\n\t$export.P = 8;   // proto\n\t$export.B = 16;  // bind\n\t$export.W = 32;  // wrap\n\t$export.U = 64;  // safe\n\t$export.R = 128; // real proto method for `library`\n\tvar _export = $export;\n\n\t// 7.1.4 ToInteger\n\tvar ceil = Math.ceil;\n\tvar floor = Math.floor;\n\tvar _toInteger = function (it) {\n\t  return isNaN(it = +it) ? 0 : (it > 0 ? floor : ceil)(it);\n\t};\n\n\t// 7.2.1 RequireObjectCoercible(argument)\n\tvar _defined = function (it) {\n\t  if (it == undefined) { throw TypeError(\"Can't call method on  \" + it); }\n\t  return it;\n\t};\n\n\t// true  -> String#at\n\t// false -> String#codePointAt\n\tvar _stringAt = function (TO_STRING) {\n\t  return function (that, pos) {\n\t    var s = String(_defined(that));\n\t    var i = _toInteger(pos);\n\t    var l = s.length;\n\t    var a, b;\n\t    if (i < 0 || i >= l) { return TO_STRING ? '' : undefined; }\n\t    a = s.charCodeAt(i);\n\t    return a < 0xd800 || a > 0xdbff || i + 1 === l || (b = s.charCodeAt(i + 1)) < 0xdc00 || b > 0xdfff\n\t      ? TO_STRING ? s.charAt(i) : a\n\t      : TO_STRING ? s.slice(i, i + 2) : (a - 0xd800 << 10) + (b - 0xdc00) + 0x10000;\n\t  };\n\t};\n\n\tvar $at = _stringAt(false);\n\t_export(_export.P, 'String', {\n\t  // 21.1.3.3 String.prototype.codePointAt(pos)\n\t  codePointAt: function codePointAt(pos) {\n\t    return $at(this, pos);\n\t  }\n\t});\n\n\tvar codePointAt = _core.String.codePointAt;\n\n\tvar max = Math.max;\n\tvar min = Math.min;\n\tvar _toAbsoluteIndex = function (index, length) {\n\t  index = _toInteger(index);\n\t  return index < 0 ? max(index + length, 0) : min(index, length);\n\t};\n\n\tvar fromCharCode = String.fromCharCode;\n\tvar $fromCodePoint = String.fromCodePoint;\n\n\t// length should be 1, old FF problem\n\t_export(_export.S + _export.F * (!!$fromCodePoint && $fromCodePoint.length != 1), 'String', {\n\t  // 21.1.2.2 String.fromCodePoint(...codePoints)\n\t  fromCodePoint: function fromCodePoint(x) {\n\t    var arguments$1 = arguments;\n\t // eslint-disable-line no-unused-vars\n\t    var res = [];\n\t    var aLen = arguments.length;\n\t    var i = 0;\n\t    var code;\n\t    while (aLen > i) {\n\t      code = +arguments$1[i++];\n\t      if (_toAbsoluteIndex(code, 0x10ffff) !== code) { throw RangeError(code + ' is not a valid code point'); }\n\t      res.push(code < 0x10000\n\t        ? fromCharCode(code)\n\t        : fromCharCode(((code -= 0x10000) >> 10) + 0xd800, code % 0x400 + 0xdc00)\n\t      );\n\t    } return res.join('');\n\t  }\n\t});\n\n\tvar fromCodePoint = _core.String.fromCodePoint;\n\n\t// This is a generated file. Do not edit.\n\tvar Space_Separator = /[\\u1680\\u2000-\\u200A\\u202F\\u205F\\u3000]/;\n\tvar ID_Start = /[\\xAA\\xB5\\xBA\\xC0-\\xD6\\xD8-\\xF6\\xF8-\\u02C1\\u02C6-\\u02D1\\u02E0-\\u02E4\\u02EC\\u02EE\\u0370-\\u0374\\u0376\\u0377\\u037A-\\u037D\\u037F\\u0386\\u0388-\\u038A\\u038C\\u038E-\\u03A1\\u03A3-\\u03F5\\u03F7-\\u0481\\u048A-\\u052F\\u0531-\\u0556\\u0559\\u0561-\\u0587\\u05D0-\\u05EA\\u05F0-\\u05F2\\u0620-\\u064A\\u066E\\u066F\\u0671-\\u06D3\\u06D5\\u06E5\\u06E6\\u06EE\\u06EF\\u06FA-\\u06FC\\u06FF\\u0710\\u0712-\\u072F\\u074D-\\u07A5\\u07B1\\u07CA-\\u07EA\\u07F4\\u07F5\\u07FA\\u0800-\\u0815\\u081A\\u0824\\u0828\\u0840-\\u0858\\u0860-\\u086A\\u08A0-\\u08B4\\u08B6-\\u08BD\\u0904-\\u0939\\u093D\\u0950\\u0958-\\u0961\\u0971-\\u0980\\u0985-\\u098C\\u098F\\u0990\\u0993-\\u09A8\\u09AA-\\u09B0\\u09B2\\u09B6-\\u09B9\\u09BD\\u09CE\\u09DC\\u09DD\\u09DF-\\u09E1\\u09F0\\u09F1\\u09FC\\u0A05-\\u0A0A\\u0A0F\\u0A10\\u0A13-\\u0A28\\u0A2A-\\u0A30\\u0A32\\u0A33\\u0A35\\u0A36\\u0A38\\u0A39\\u0A59-\\u0A5C\\u0A5E\\u0A72-\\u0A74\\u0A85-\\u0A8D\\u0A8F-\\u0A91\\u0A93-\\u0AA8\\u0AAA-\\u0AB0\\u0AB2\\u0AB3\\u0AB5-\\u0AB9\\u0ABD\\u0AD0\\u0AE0\\u0AE1\\u0AF9\\u0B05-\\u0B0C\\u0B0F\\u0B10\\u0B13-\\u0B28\\u0B2A-\\u0B30\\u0B32\\u0B33\\u0B35-\\u0B39\\u0B3D\\u0B5C\\u0B5D\\u0B5F-\\u0B61\\u0B71\\u0B83\\u0B85-\\u0B8A\\u0B8E-\\u0B90\\u0B92-\\u0B95\\u0B99\\u0B9A\\u0B9C\\u0B9E\\u0B9F\\u0BA3\\u0BA4\\u0BA8-\\u0BAA\\u0BAE-\\u0BB9\\u0BD0\\u0C05-\\u0C0C\\u0C0E-\\u0C10\\u0C12-\\u0C28\\u0C2A-\\u0C39\\u0C3D\\u0C58-\\u0C5A\\u0C60\\u0C61\\u0C80\\u0C85-\\u0C8C\\u0C8E-\\u0C90\\u0C92-\\u0CA8\\u0CAA-\\u0CB3\\u0CB5-\\u0CB9\\u0CBD\\u0CDE\\u0CE0\\u0CE1\\u0CF1\\u0CF2\\u0D05-\\u0D0C\\u0D0E-\\u0D10\\u0D12-\\u0D3A\\u0D3D\\u0D4E\\u0D54-\\u0D56\\u0D5F-\\u0D61\\u0D7A-\\u0D7F\\u0D85-\\u0D96\\u0D9A-\\u0DB1\\u0DB3-\\u0DBB\\u0DBD\\u0DC0-\\u0DC6\\u0E01-\\u0E30\\u0E32\\u0E33\\u0E40-\\u0E46\\u0E81\\u0E82\\u0E84\\u0E87\\u0E88\\u0E8A\\u0E8D\\u0E94-\\u0E97\\u0E99-\\u0E9F\\u0EA1-\\u0EA3\\u0EA5\\u0EA7\\u0EAA\\u0EAB\\u0EAD-\\u0EB0\\u0EB2\\u0EB3\\u0EBD\\u0EC0-\\u0EC4\\u0EC6\\u0EDC-\\u0EDF\\u0F00\\u0F40-\\u0F47\\u0F49-\\u0F6C\\u0F88-\\u0F8C\\u1000-\\u102A\\u103F\\u1050-\\u1055\\u105A-\\u105D\\u1061\\u1065\\u1066\\u106E-\\u1070\\u1075-\\u1081\\u108E\\u10A0-\\u10C5\\u10C7\\u10CD\\u10D0-\\u10FA\\u10FC-\\u1248\\u124A-\\u124D\\u1250-\\u1256\\u1258\\u125A-\\u125D\\u1260-\\u1288\\u128A-\\u128D\\u1290-\\u12B0\\u12B2-\\u12B5\\u12B8-\\u12BE\\u12C0\\u12C2-\\u12C5\\u12C8-\\u12D6\\u12D8-\\u1310\\u1312-\\u1315\\u1318-\\u135A\\u1380-\\u138F\\u13A0-\\u13F5\\u13F8-\\u13FD\\u1401-\\u166C\\u166F-\\u167F\\u1681-\\u169A\\u16A0-\\u16EA\\u16EE-\\u16F8\\u1700-\\u170C\\u170E-\\u1711\\u1720-\\u1731\\u1740-\\u1751\\u1760-\\u176C\\u176E-\\u1770\\u1780-\\u17B3\\u17D7\\u17DC\\u1820-\\u1877\\u1880-\\u1884\\u1887-\\u18A8\\u18AA\\u18B0-\\u18F5\\u1900-\\u191E\\u1950-\\u196D\\u1970-\\u1974\\u1980-\\u19AB\\u19B0-\\u19C9\\u1A00-\\u1A16\\u1A20-\\u1A54\\u1AA7\\u1B05-\\u1B33\\u1B45-\\u1B4B\\u1B83-\\u1BA0\\u1BAE\\u1BAF\\u1BBA-\\u1BE5\\u1C00-\\u1C23\\u1C4D-\\u1C4F\\u1C5A-\\u1C7D\\u1C80-\\u1C88\\u1CE9-\\u1CEC\\u1CEE-\\u1CF1\\u1CF5\\u1CF6\\u1D00-\\u1DBF\\u1E00-\\u1F15\\u1F18-\\u1F1D\\u1F20-\\u1F45\\u1F48-\\u1F4D\\u1F50-\\u1F57\\u1F59\\u1F5B\\u1F5D\\u1F5F-\\u1F7D\\u1F80-\\u1FB4\\u1FB6-\\u1FBC\\u1FBE\\u1FC2-\\u1FC4\\u1FC6-\\u1FCC\\u1FD0-\\u1FD3\\u1FD6-\\u1FDB\\u1FE0-\\u1FEC\\u1FF2-\\u1FF4\\u1FF6-\\u1FFC\\u2071\\u207F\\u2090-\\u209C\\u2102\\u2107\\u210A-\\u2113\\u2115\\u2119-\\u211D\\u2124\\u2126\\u2128\\u212A-\\u212D\\u212F-\\u2139\\u213C-\\u213F\\u2145-\\u2149\\u214E\\u2160-\\u2188\\u2C00-\\u2C2E\\u2C30-\\u2C5E\\u2C60-\\u2CE4\\u2CEB-\\u2CEE\\u2CF2\\u2CF3\\u2D00-\\u2D25\\u2D27\\u2D2D\\u2D30-\\u2D67\\u2D6F\\u2D80-\\u2D96\\u2DA0-\\u2DA6\\u2DA8-\\u2DAE\\u2DB0-\\u2DB6\\u2DB8-\\u2DBE\\u2DC0-\\u2DC6\\u2DC8-\\u2DCE\\u2DD0-\\u2DD6\\u2DD8-\\u2DDE\\u2E2F\\u3005-\\u3007\\u3021-\\u3029\\u3031-\\u3035\\u3038-\\u303C\\u3041-\\u3096\\u309D-\\u309F\\u30A1-\\u30FA\\u30FC-\\u30FF\\u3105-\\u312E\\u3131-\\u318E\\u31A0-\\u31BA\\u31F0-\\u31FF\\u3400-\\u4DB5\\u4E00-\\u9FEA\\uA000-\\uA48C\\uA4D0-\\uA4FD\\uA500-\\uA60C\\uA610-\\uA61F\\uA62A\\uA62B\\uA640-\\uA66E\\uA67F-\\uA69D\\uA6A0-\\uA6EF\\uA717-\\uA71F\\uA722-\\uA788\\uA78B-\\uA7AE\\uA7B0-\\uA7B7\\uA7F7-\\uA801\\uA803-\\uA805\\uA807-\\uA80A\\uA80C-\\uA822\\uA840-\\uA873\\uA882-\\uA8B3\\uA8F2-\\uA8F7\\uA8FB\\uA8FD\\uA90A-\\uA925\\uA930-\\uA946\\uA960-\\uA97C\\uA984-\\uA9B2\\uA9CF\\uA9E0-\\uA9E4\\uA9E6-\\uA9EF\\uA9FA-\\uA9FE\\uAA00-\\uAA28\\uAA40-\\uAA42\\uAA44-\\uAA4B\\uAA60-\\uAA76\\uAA7A\\uAA7E-\\uAAAF\\uAAB1\\uAAB5\\uAAB6\\uAAB9-\\uAABD\\uAAC0\\uAAC2\\uAADB-\\uAADD\\uAAE0-\\uAAEA\\uAAF2-\\uAAF4\\uAB01-\\uAB06\\uAB09-\\uAB0E\\uAB11-\\uAB16\\uAB20-\\uAB26\\uAB28-\\uAB2E\\uAB30-\\uAB5A\\uAB5C-\\uAB65\\uAB70-\\uABE2\\uAC00-\\uD7A3\\uD7B0-\\uD7C6\\uD7CB-\\uD7FB\\uF900-\\uFA6D\\uFA70-\\uFAD9\\uFB00-\\uFB06\\uFB13-\\uFB17\\uFB1D\\uFB1F-\\uFB28\\uFB2A-\\uFB36\\uFB38-\\uFB3C\\uFB3E\\uFB40\\uFB41\\uFB43\\uFB44\\uFB46-\\uFBB1\\uFBD3-\\uFD3D\\uFD50-\\uFD8F\\uFD92-\\uFDC7\\uFDF0-\\uFDFB\\uFE70-\\uFE74\\uFE76-\\uFEFC\\uFF21-\\uFF3A\\uFF41-\\uFF5A\\uFF66-\\uFFBE\\uFFC2-\\uFFC7\\uFFCA-\\uFFCF\\uFFD2-\\uFFD7\\uFFDA-\\uFFDC]|\\uD800[\\uDC00-\\uDC0B\\uDC0D-\\uDC26\\uDC28-\\uDC3A\\uDC3C\\uDC3D\\uDC3F-\\uDC4D\\uDC50-\\uDC5D\\uDC80-\\uDCFA\\uDD40-\\uDD74\\uDE80-\\uDE9C\\uDEA0-\\uDED0\\uDF00-\\uDF1F\\uDF2D-\\uDF4A\\uDF50-\\uDF75\\uDF80-\\uDF9D\\uDFA0-\\uDFC3\\uDFC8-\\uDFCF\\uDFD1-\\uDFD5]|\\uD801[\\uDC00-\\uDC9D\\uDCB0-\\uDCD3\\uDCD8-\\uDCFB\\uDD00-\\uDD27\\uDD30-\\uDD63\\uDE00-\\uDF36\\uDF40-\\uDF55\\uDF60-\\uDF67]|\\uD802[\\uDC00-\\uDC05\\uDC08\\uDC0A-\\uDC35\\uDC37\\uDC38\\uDC3C\\uDC3F-\\uDC55\\uDC60-\\uDC76\\uDC80-\\uDC9E\\uDCE0-\\uDCF2\\uDCF4\\uDCF5\\uDD00-\\uDD15\\uDD20-\\uDD39\\uDD80-\\uDDB7\\uDDBE\\uDDBF\\uDE00\\uDE10-\\uDE13\\uDE15-\\uDE17\\uDE19-\\uDE33\\uDE60-\\uDE7C\\uDE80-\\uDE9C\\uDEC0-\\uDEC7\\uDEC9-\\uDEE4\\uDF00-\\uDF35\\uDF40-\\uDF55\\uDF60-\\uDF72\\uDF80-\\uDF91]|\\uD803[\\uDC00-\\uDC48\\uDC80-\\uDCB2\\uDCC0-\\uDCF2]|\\uD804[\\uDC03-\\uDC37\\uDC83-\\uDCAF\\uDCD0-\\uDCE8\\uDD03-\\uDD26\\uDD50-\\uDD72\\uDD76\\uDD83-\\uDDB2\\uDDC1-\\uDDC4\\uDDDA\\uDDDC\\uDE00-\\uDE11\\uDE13-\\uDE2B\\uDE80-\\uDE86\\uDE88\\uDE8A-\\uDE8D\\uDE8F-\\uDE9D\\uDE9F-\\uDEA8\\uDEB0-\\uDEDE\\uDF05-\\uDF0C\\uDF0F\\uDF10\\uDF13-\\uDF28\\uDF2A-\\uDF30\\uDF32\\uDF33\\uDF35-\\uDF39\\uDF3D\\uDF50\\uDF5D-\\uDF61]|\\uD805[\\uDC00-\\uDC34\\uDC47-\\uDC4A\\uDC80-\\uDCAF\\uDCC4\\uDCC5\\uDCC7\\uDD80-\\uDDAE\\uDDD8-\\uDDDB\\uDE00-\\uDE2F\\uDE44\\uDE80-\\uDEAA\\uDF00-\\uDF19]|\\uD806[\\uDCA0-\\uDCDF\\uDCFF\\uDE00\\uDE0B-\\uDE32\\uDE3A\\uDE50\\uDE5C-\\uDE83\\uDE86-\\uDE89\\uDEC0-\\uDEF8]|\\uD807[\\uDC00-\\uDC08\\uDC0A-\\uDC2E\\uDC40\\uDC72-\\uDC8F\\uDD00-\\uDD06\\uDD08\\uDD09\\uDD0B-\\uDD30\\uDD46]|\\uD808[\\uDC00-\\uDF99]|\\uD809[\\uDC00-\\uDC6E\\uDC80-\\uDD43]|[\\uD80C\\uD81C-\\uD820\\uD840-\\uD868\\uD86A-\\uD86C\\uD86F-\\uD872\\uD874-\\uD879][\\uDC00-\\uDFFF]|\\uD80D[\\uDC00-\\uDC2E]|\\uD811[\\uDC00-\\uDE46]|\\uD81A[\\uDC00-\\uDE38\\uDE40-\\uDE5E\\uDED0-\\uDEED\\uDF00-\\uDF2F\\uDF40-\\uDF43\\uDF63-\\uDF77\\uDF7D-\\uDF8F]|\\uD81B[\\uDF00-\\uDF44\\uDF50\\uDF93-\\uDF9F\\uDFE0\\uDFE1]|\\uD821[\\uDC00-\\uDFEC]|\\uD822[\\uDC00-\\uDEF2]|\\uD82C[\\uDC00-\\uDD1E\\uDD70-\\uDEFB]|\\uD82F[\\uDC00-\\uDC6A\\uDC70-\\uDC7C\\uDC80-\\uDC88\\uDC90-\\uDC99]|\\uD835[\\uDC00-\\uDC54\\uDC56-\\uDC9C\\uDC9E\\uDC9F\\uDCA2\\uDCA5\\uDCA6\\uDCA9-\\uDCAC\\uDCAE-\\uDCB9\\uDCBB\\uDCBD-\\uDCC3\\uDCC5-\\uDD05\\uDD07-\\uDD0A\\uDD0D-\\uDD14\\uDD16-\\uDD1C\\uDD1E-\\uDD39\\uDD3B-\\uDD3E\\uDD40-\\uDD44\\uDD46\\uDD4A-\\uDD50\\uDD52-\\uDEA5\\uDEA8-\\uDEC0\\uDEC2-\\uDEDA\\uDEDC-\\uDEFA\\uDEFC-\\uDF14\\uDF16-\\uDF34\\uDF36-\\uDF4E\\uDF50-\\uDF6E\\uDF70-\\uDF88\\uDF8A-\\uDFA8\\uDFAA-\\uDFC2\\uDFC4-\\uDFCB]|\\uD83A[\\uDC00-\\uDCC4\\uDD00-\\uDD43]|\\uD83B[\\uDE00-\\uDE03\\uDE05-\\uDE1F\\uDE21\\uDE22\\uDE24\\uDE27\\uDE29-\\uDE32\\uDE34-\\uDE37\\uDE39\\uDE3B\\uDE42\\uDE47\\uDE49\\uDE4B\\uDE4D-\\uDE4F\\uDE51\\uDE52\\uDE54\\uDE57\\uDE59\\uDE5B\\uDE5D\\uDE5F\\uDE61\\uDE62\\uDE64\\uDE67-\\uDE6A\\uDE6C-\\uDE72\\uDE74-\\uDE77\\uDE79-\\uDE7C\\uDE7E\\uDE80-\\uDE89\\uDE8B-\\uDE9B\\uDEA1-\\uDEA3\\uDEA5-\\uDEA9\\uDEAB-\\uDEBB]|\\uD869[\\uDC00-\\uDED6\\uDF00-\\uDFFF]|\\uD86D[\\uDC00-\\uDF34\\uDF40-\\uDFFF]|\\uD86E[\\uDC00-\\uDC1D\\uDC20-\\uDFFF]|\\uD873[\\uDC00-\\uDEA1\\uDEB0-\\uDFFF]|\\uD87A[\\uDC00-\\uDFE0]|\\uD87E[\\uDC00-\\uDE1D]/;\n\tvar ID_Continue = /[\\xAA\\xB5\\xBA\\xC0-\\xD6\\xD8-\\xF6\\xF8-\\u02C1\\u02C6-\\u02D1\\u02E0-\\u02E4\\u02EC\\u02EE\\u0300-\\u0374\\u0376\\u0377\\u037A-\\u037D\\u037F\\u0386\\u0388-\\u038A\\u038C\\u038E-\\u03A1\\u03A3-\\u03F5\\u03F7-\\u0481\\u0483-\\u0487\\u048A-\\u052F\\u0531-\\u0556\\u0559\\u0561-\\u0587\\u0591-\\u05BD\\u05BF\\u05C1\\u05C2\\u05C4\\u05C5\\u05C7\\u05D0-\\u05EA\\u05F0-\\u05F2\\u0610-\\u061A\\u0620-\\u0669\\u066E-\\u06D3\\u06D5-\\u06DC\\u06DF-\\u06E8\\u06EA-\\u06FC\\u06FF\\u0710-\\u074A\\u074D-\\u07B1\\u07C0-\\u07F5\\u07FA\\u0800-\\u082D\\u0840-\\u085B\\u0860-\\u086A\\u08A0-\\u08B4\\u08B6-\\u08BD\\u08D4-\\u08E1\\u08E3-\\u0963\\u0966-\\u096F\\u0971-\\u0983\\u0985-\\u098C\\u098F\\u0990\\u0993-\\u09A8\\u09AA-\\u09B0\\u09B2\\u09B6-\\u09B9\\u09BC-\\u09C4\\u09C7\\u09C8\\u09CB-\\u09CE\\u09D7\\u09DC\\u09DD\\u09DF-\\u09E3\\u09E6-\\u09F1\\u09FC\\u0A01-\\u0A03\\u0A05-\\u0A0A\\u0A0F\\u0A10\\u0A13-\\u0A28\\u0A2A-\\u0A30\\u0A32\\u0A33\\u0A35\\u0A36\\u0A38\\u0A39\\u0A3C\\u0A3E-\\u0A42\\u0A47\\u0A48\\u0A4B-\\u0A4D\\u0A51\\u0A59-\\u0A5C\\u0A5E\\u0A66-\\u0A75\\u0A81-\\u0A83\\u0A85-\\u0A8D\\u0A8F-\\u0A91\\u0A93-\\u0AA8\\u0AAA-\\u0AB0\\u0AB2\\u0AB3\\u0AB5-\\u0AB9\\u0ABC-\\u0AC5\\u0AC7-\\u0AC9\\u0ACB-\\u0ACD\\u0AD0\\u0AE0-\\u0AE3\\u0AE6-\\u0AEF\\u0AF9-\\u0AFF\\u0B01-\\u0B03\\u0B05-\\u0B0C\\u0B0F\\u0B10\\u0B13-\\u0B28\\u0B2A-\\u0B30\\u0B32\\u0B33\\u0B35-\\u0B39\\u0B3C-\\u0B44\\u0B47\\u0B48\\u0B4B-\\u0B4D\\u0B56\\u0B57\\u0B5C\\u0B5D\\u0B5F-\\u0B63\\u0B66-\\u0B6F\\u0B71\\u0B82\\u0B83\\u0B85-\\u0B8A\\u0B8E-\\u0B90\\u0B92-\\u0B95\\u0B99\\u0B9A\\u0B9C\\u0B9E\\u0B9F\\u0BA3\\u0BA4\\u0BA8-\\u0BAA\\u0BAE-\\u0BB9\\u0BBE-\\u0BC2\\u0BC6-\\u0BC8\\u0BCA-\\u0BCD\\u0BD0\\u0BD7\\u0BE6-\\u0BEF\\u0C00-\\u0C03\\u0C05-\\u0C0C\\u0C0E-\\u0C10\\u0C12-\\u0C28\\u0C2A-\\u0C39\\u0C3D-\\u0C44\\u0C46-\\u0C48\\u0C4A-\\u0C4D\\u0C55\\u0C56\\u0C58-\\u0C5A\\u0C60-\\u0C63\\u0C66-\\u0C6F\\u0C80-\\u0C83\\u0C85-\\u0C8C\\u0C8E-\\u0C90\\u0C92-\\u0CA8\\u0CAA-\\u0CB3\\u0CB5-\\u0CB9\\u0CBC-\\u0CC4\\u0CC6-\\u0CC8\\u0CCA-\\u0CCD\\u0CD5\\u0CD6\\u0CDE\\u0CE0-\\u0CE3\\u0CE6-\\u0CEF\\u0CF1\\u0CF2\\u0D00-\\u0D03\\u0D05-\\u0D0C\\u0D0E-\\u0D10\\u0D12-\\u0D44\\u0D46-\\u0D48\\u0D4A-\\u0D4E\\u0D54-\\u0D57\\u0D5F-\\u0D63\\u0D66-\\u0D6F\\u0D7A-\\u0D7F\\u0D82\\u0D83\\u0D85-\\u0D96\\u0D9A-\\u0DB1\\u0DB3-\\u0DBB\\u0DBD\\u0DC0-\\u0DC6\\u0DCA\\u0DCF-\\u0DD4\\u0DD6\\u0DD8-\\u0DDF\\u0DE6-\\u0DEF\\u0DF2\\u0DF3\\u0E01-\\u0E3A\\u0E40-\\u0E4E\\u0E50-\\u0E59\\u0E81\\u0E82\\u0E84\\u0E87\\u0E88\\u0E8A\\u0E8D\\u0E94-\\u0E97\\u0E99-\\u0E9F\\u0EA1-\\u0EA3\\u0EA5\\u0EA7\\u0EAA\\u0EAB\\u0EAD-\\u0EB9\\u0EBB-\\u0EBD\\u0EC0-\\u0EC4\\u0EC6\\u0EC8-\\u0ECD\\u0ED0-\\u0ED9\\u0EDC-\\u0EDF\\u0F00\\u0F18\\u0F19\\u0F20-\\u0F29\\u0F35\\u0F37\\u0F39\\u0F3E-\\u0F47\\u0F49-\\u0F6C\\u0F71-\\u0F84\\u0F86-\\u0F97\\u0F99-\\u0FBC\\u0FC6\\u1000-\\u1049\\u1050-\\u109D\\u10A0-\\u10C5\\u10C7\\u10CD\\u10D0-\\u10FA\\u10FC-\\u1248\\u124A-\\u124D\\u1250-\\u1256\\u1258\\u125A-\\u125D\\u1260-\\u1288\\u128A-\\u128D\\u1290-\\u12B0\\u12B2-\\u12B5\\u12B8-\\u12BE\\u12C0\\u12C2-\\u12C5\\u12C8-\\u12D6\\u12D8-\\u1310\\u1312-\\u1315\\u1318-\\u135A\\u135D-\\u135F\\u1380-\\u138F\\u13A0-\\u13F5\\u13F8-\\u13FD\\u1401-\\u166C\\u166F-\\u167F\\u1681-\\u169A\\u16A0-\\u16EA\\u16EE-\\u16F8\\u1700-\\u170C\\u170E-\\u1714\\u1720-\\u1734\\u1740-\\u1753\\u1760-\\u176C\\u176E-\\u1770\\u1772\\u1773\\u1780-\\u17D3\\u17D7\\u17DC\\u17DD\\u17E0-\\u17E9\\u180B-\\u180D\\u1810-\\u1819\\u1820-\\u1877\\u1880-\\u18AA\\u18B0-\\u18F5\\u1900-\\u191E\\u1920-\\u192B\\u1930-\\u193B\\u1946-\\u196D\\u1970-\\u1974\\u1980-\\u19AB\\u19B0-\\u19C9\\u19D0-\\u19D9\\u1A00-\\u1A1B\\u1A20-\\u1A5E\\u1A60-\\u1A7C\\u1A7F-\\u1A89\\u1A90-\\u1A99\\u1AA7\\u1AB0-\\u1ABD\\u1B00-\\u1B4B\\u1B50-\\u1B59\\u1B6B-\\u1B73\\u1B80-\\u1BF3\\u1C00-\\u1C37\\u1C40-\\u1C49\\u1C4D-\\u1C7D\\u1C80-\\u1C88\\u1CD0-\\u1CD2\\u1CD4-\\u1CF9\\u1D00-\\u1DF9\\u1DFB-\\u1F15\\u1F18-\\u1F1D\\u1F20-\\u1F45\\u1F48-\\u1F4D\\u1F50-\\u1F57\\u1F59\\u1F5B\\u1F5D\\u1F5F-\\u1F7D\\u1F80-\\u1FB4\\u1FB6-\\u1FBC\\u1FBE\\u1FC2-\\u1FC4\\u1FC6-\\u1FCC\\u1FD0-\\u1FD3\\u1FD6-\\u1FDB\\u1FE0-\\u1FEC\\u1FF2-\\u1FF4\\u1FF6-\\u1FFC\\u203F\\u2040\\u2054\\u2071\\u207F\\u2090-\\u209C\\u20D0-\\u20DC\\u20E1\\u20E5-\\u20F0\\u2102\\u2107\\u210A-\\u2113\\u2115\\u2119-\\u211D\\u2124\\u2126\\u2128\\u212A-\\u212D\\u212F-\\u2139\\u213C-\\u213F\\u2145-\\u2149\\u214E\\u2160-\\u2188\\u2C00-\\u2C2E\\u2C30-\\u2C5E\\u2C60-\\u2CE4\\u2CEB-\\u2CF3\\u2D00-\\u2D25\\u2D27\\u2D2D\\u2D30-\\u2D67\\u2D6F\\u2D7F-\\u2D96\\u2DA0-\\u2DA6\\u2DA8-\\u2DAE\\u2DB0-\\u2DB6\\u2DB8-\\u2DBE\\u2DC0-\\u2DC6\\u2DC8-\\u2DCE\\u2DD0-\\u2DD6\\u2DD8-\\u2DDE\\u2DE0-\\u2DFF\\u2E2F\\u3005-\\u3007\\u3021-\\u302F\\u3031-\\u3035\\u3038-\\u303C\\u3041-\\u3096\\u3099\\u309A\\u309D-\\u309F\\u30A1-\\u30FA\\u30FC-\\u30FF\\u3105-\\u312E\\u3131-\\u318E\\u31A0-\\u31BA\\u31F0-\\u31FF\\u3400-\\u4DB5\\u4E00-\\u9FEA\\uA000-\\uA48C\\uA4D0-\\uA4FD\\uA500-\\uA60C\\uA610-\\uA62B\\uA640-\\uA66F\\uA674-\\uA67D\\uA67F-\\uA6F1\\uA717-\\uA71F\\uA722-\\uA788\\uA78B-\\uA7AE\\uA7B0-\\uA7B7\\uA7F7-\\uA827\\uA840-\\uA873\\uA880-\\uA8C5\\uA8D0-\\uA8D9\\uA8E0-\\uA8F7\\uA8FB\\uA8FD\\uA900-\\uA92D\\uA930-\\uA953\\uA960-\\uA97C\\uA980-\\uA9C0\\uA9CF-\\uA9D9\\uA9E0-\\uA9FE\\uAA00-\\uAA36\\uAA40-\\uAA4D\\uAA50-\\uAA59\\uAA60-\\uAA76\\uAA7A-\\uAAC2\\uAADB-\\uAADD\\uAAE0-\\uAAEF\\uAAF2-\\uAAF6\\uAB01-\\uAB06\\uAB09-\\uAB0E\\uAB11-\\uAB16\\uAB20-\\uAB26\\uAB28-\\uAB2E\\uAB30-\\uAB5A\\uAB5C-\\uAB65\\uAB70-\\uABEA\\uABEC\\uABED\\uABF0-\\uABF9\\uAC00-\\uD7A3\\uD7B0-\\uD7C6\\uD7CB-\\uD7FB\\uF900-\\uFA6D\\uFA70-\\uFAD9\\uFB00-\\uFB06\\uFB13-\\uFB17\\uFB1D-\\uFB28\\uFB2A-\\uFB36\\uFB38-\\uFB3C\\uFB3E\\uFB40\\uFB41\\uFB43\\uFB44\\uFB46-\\uFBB1\\uFBD3-\\uFD3D\\uFD50-\\uFD8F\\uFD92-\\uFDC7\\uFDF0-\\uFDFB\\uFE00-\\uFE0F\\uFE20-\\uFE2F\\uFE33\\uFE34\\uFE4D-\\uFE4F\\uFE70-\\uFE74\\uFE76-\\uFEFC\\uFF10-\\uFF19\\uFF21-\\uFF3A\\uFF3F\\uFF41-\\uFF5A\\uFF66-\\uFFBE\\uFFC2-\\uFFC7\\uFFCA-\\uFFCF\\uFFD2-\\uFFD7\\uFFDA-\\uFFDC]|\\uD800[\\uDC00-\\uDC0B\\uDC0D-\\uDC26\\uDC28-\\uDC3A\\uDC3C\\uDC3D\\uDC3F-\\uDC4D\\uDC50-\\uDC5D\\uDC80-\\uDCFA\\uDD40-\\uDD74\\uDDFD\\uDE80-\\uDE9C\\uDEA0-\\uDED0\\uDEE0\\uDF00-\\uDF1F\\uDF2D-\\uDF4A\\uDF50-\\uDF7A\\uDF80-\\uDF9D\\uDFA0-\\uDFC3\\uDFC8-\\uDFCF\\uDFD1-\\uDFD5]|\\uD801[\\uDC00-\\uDC9D\\uDCA0-\\uDCA9\\uDCB0-\\uDCD3\\uDCD8-\\uDCFB\\uDD00-\\uDD27\\uDD30-\\uDD63\\uDE00-\\uDF36\\uDF40-\\uDF55\\uDF60-\\uDF67]|\\uD802[\\uDC00-\\uDC05\\uDC08\\uDC0A-\\uDC35\\uDC37\\uDC38\\uDC3C\\uDC3F-\\uDC55\\uDC60-\\uDC76\\uDC80-\\uDC9E\\uDCE0-\\uDCF2\\uDCF4\\uDCF5\\uDD00-\\uDD15\\uDD20-\\uDD39\\uDD80-\\uDDB7\\uDDBE\\uDDBF\\uDE00-\\uDE03\\uDE05\\uDE06\\uDE0C-\\uDE13\\uDE15-\\uDE17\\uDE19-\\uDE33\\uDE38-\\uDE3A\\uDE3F\\uDE60-\\uDE7C\\uDE80-\\uDE9C\\uDEC0-\\uDEC7\\uDEC9-\\uDEE6\\uDF00-\\uDF35\\uDF40-\\uDF55\\uDF60-\\uDF72\\uDF80-\\uDF91]|\\uD803[\\uDC00-\\uDC48\\uDC80-\\uDCB2\\uDCC0-\\uDCF2]|\\uD804[\\uDC00-\\uDC46\\uDC66-\\uDC6F\\uDC7F-\\uDCBA\\uDCD0-\\uDCE8\\uDCF0-\\uDCF9\\uDD00-\\uDD34\\uDD36-\\uDD3F\\uDD50-\\uDD73\\uDD76\\uDD80-\\uDDC4\\uDDCA-\\uDDCC\\uDDD0-\\uDDDA\\uDDDC\\uDE00-\\uDE11\\uDE13-\\uDE37\\uDE3E\\uDE80-\\uDE86\\uDE88\\uDE8A-\\uDE8D\\uDE8F-\\uDE9D\\uDE9F-\\uDEA8\\uDEB0-\\uDEEA\\uDEF0-\\uDEF9\\uDF00-\\uDF03\\uDF05-\\uDF0C\\uDF0F\\uDF10\\uDF13-\\uDF28\\uDF2A-\\uDF30\\uDF32\\uDF33\\uDF35-\\uDF39\\uDF3C-\\uDF44\\uDF47\\uDF48\\uDF4B-\\uDF4D\\uDF50\\uDF57\\uDF5D-\\uDF63\\uDF66-\\uDF6C\\uDF70-\\uDF74]|\\uD805[\\uDC00-\\uDC4A\\uDC50-\\uDC59\\uDC80-\\uDCC5\\uDCC7\\uDCD0-\\uDCD9\\uDD80-\\uDDB5\\uDDB8-\\uDDC0\\uDDD8-\\uDDDD\\uDE00-\\uDE40\\uDE44\\uDE50-\\uDE59\\uDE80-\\uDEB7\\uDEC0-\\uDEC9\\uDF00-\\uDF19\\uDF1D-\\uDF2B\\uDF30-\\uDF39]|\\uD806[\\uDCA0-\\uDCE9\\uDCFF\\uDE00-\\uDE3E\\uDE47\\uDE50-\\uDE83\\uDE86-\\uDE99\\uDEC0-\\uDEF8]|\\uD807[\\uDC00-\\uDC08\\uDC0A-\\uDC36\\uDC38-\\uDC40\\uDC50-\\uDC59\\uDC72-\\uDC8F\\uDC92-\\uDCA7\\uDCA9-\\uDCB6\\uDD00-\\uDD06\\uDD08\\uDD09\\uDD0B-\\uDD36\\uDD3A\\uDD3C\\uDD3D\\uDD3F-\\uDD47\\uDD50-\\uDD59]|\\uD808[\\uDC00-\\uDF99]|\\uD809[\\uDC00-\\uDC6E\\uDC80-\\uDD43]|[\\uD80C\\uD81C-\\uD820\\uD840-\\uD868\\uD86A-\\uD86C\\uD86F-\\uD872\\uD874-\\uD879][\\uDC00-\\uDFFF]|\\uD80D[\\uDC00-\\uDC2E]|\\uD811[\\uDC00-\\uDE46]|\\uD81A[\\uDC00-\\uDE38\\uDE40-\\uDE5E\\uDE60-\\uDE69\\uDED0-\\uDEED\\uDEF0-\\uDEF4\\uDF00-\\uDF36\\uDF40-\\uDF43\\uDF50-\\uDF59\\uDF63-\\uDF77\\uDF7D-\\uDF8F]|\\uD81B[\\uDF00-\\uDF44\\uDF50-\\uDF7E\\uDF8F-\\uDF9F\\uDFE0\\uDFE1]|\\uD821[\\uDC00-\\uDFEC]|\\uD822[\\uDC00-\\uDEF2]|\\uD82C[\\uDC00-\\uDD1E\\uDD70-\\uDEFB]|\\uD82F[\\uDC00-\\uDC6A\\uDC70-\\uDC7C\\uDC80-\\uDC88\\uDC90-\\uDC99\\uDC9D\\uDC9E]|\\uD834[\\uDD65-\\uDD69\\uDD6D-\\uDD72\\uDD7B-\\uDD82\\uDD85-\\uDD8B\\uDDAA-\\uDDAD\\uDE42-\\uDE44]|\\uD835[\\uDC00-\\uDC54\\uDC56-\\uDC9C\\uDC9E\\uDC9F\\uDCA2\\uDCA5\\uDCA6\\uDCA9-\\uDCAC\\uDCAE-\\uDCB9\\uDCBB\\uDCBD-\\uDCC3\\uDCC5-\\uDD05\\uDD07-\\uDD0A\\uDD0D-\\uDD14\\uDD16-\\uDD1C\\uDD1E-\\uDD39\\uDD3B-\\uDD3E\\uDD40-\\uDD44\\uDD46\\uDD4A-\\uDD50\\uDD52-\\uDEA5\\uDEA8-\\uDEC0\\uDEC2-\\uDEDA\\uDEDC-\\uDEFA\\uDEFC-\\uDF14\\uDF16-\\uDF34\\uDF36-\\uDF4E\\uDF50-\\uDF6E\\uDF70-\\uDF88\\uDF8A-\\uDFA8\\uDFAA-\\uDFC2\\uDFC4-\\uDFCB\\uDFCE-\\uDFFF]|\\uD836[\\uDE00-\\uDE36\\uDE3B-\\uDE6C\\uDE75\\uDE84\\uDE9B-\\uDE9F\\uDEA1-\\uDEAF]|\\uD838[\\uDC00-\\uDC06\\uDC08-\\uDC18\\uDC1B-\\uDC21\\uDC23\\uDC24\\uDC26-\\uDC2A]|\\uD83A[\\uDC00-\\uDCC4\\uDCD0-\\uDCD6\\uDD00-\\uDD4A\\uDD50-\\uDD59]|\\uD83B[\\uDE00-\\uDE03\\uDE05-\\uDE1F\\uDE21\\uDE22\\uDE24\\uDE27\\uDE29-\\uDE32\\uDE34-\\uDE37\\uDE39\\uDE3B\\uDE42\\uDE47\\uDE49\\uDE4B\\uDE4D-\\uDE4F\\uDE51\\uDE52\\uDE54\\uDE57\\uDE59\\uDE5B\\uDE5D\\uDE5F\\uDE61\\uDE62\\uDE64\\uDE67-\\uDE6A\\uDE6C-\\uDE72\\uDE74-\\uDE77\\uDE79-\\uDE7C\\uDE7E\\uDE80-\\uDE89\\uDE8B-\\uDE9B\\uDEA1-\\uDEA3\\uDEA5-\\uDEA9\\uDEAB-\\uDEBB]|\\uD869[\\uDC00-\\uDED6\\uDF00-\\uDFFF]|\\uD86D[\\uDC00-\\uDF34\\uDF40-\\uDFFF]|\\uD86E[\\uDC00-\\uDC1D\\uDC20-\\uDFFF]|\\uD873[\\uDC00-\\uDEA1\\uDEB0-\\uDFFF]|\\uD87A[\\uDC00-\\uDFE0]|\\uD87E[\\uDC00-\\uDE1D]|\\uDB40[\\uDD00-\\uDDEF]/;\n\n\tvar unicode = {\n\t\tSpace_Separator: Space_Separator,\n\t\tID_Start: ID_Start,\n\t\tID_Continue: ID_Continue\n\t};\n\n\tvar util = {\n\t    isSpaceSeparator: function isSpaceSeparator (c) {\n\t        return typeof c === 'string' && unicode.Space_Separator.test(c)\n\t    },\n\n\t    isIdStartChar: function isIdStartChar (c) {\n\t        return typeof c === 'string' && (\n\t            (c >= 'a' && c <= 'z') ||\n\t        (c >= 'A' && c <= 'Z') ||\n\t        (c === '$') || (c === '_') ||\n\t        unicode.ID_Start.test(c)\n\t        )\n\t    },\n\n\t    isIdContinueChar: function isIdContinueChar (c) {\n\t        return typeof c === 'string' && (\n\t            (c >= 'a' && c <= 'z') ||\n\t        (c >= 'A' && c <= 'Z') ||\n\t        (c >= '0' && c <= '9') ||\n\t        (c === '$') || (c === '_') ||\n\t        (c === '\\u200C') || (c === '\\u200D') ||\n\t        unicode.ID_Continue.test(c)\n\t        )\n\t    },\n\n\t    isDigit: function isDigit (c) {\n\t        return typeof c === 'string' && /[0-9]/.test(c)\n\t    },\n\n\t    isHexDigit: function isHexDigit (c) {\n\t        return typeof c === 'string' && /[0-9A-Fa-f]/.test(c)\n\t    },\n\t};\n\n\tvar source;\n\tvar parseState;\n\tvar stack;\n\tvar pos;\n\tvar line;\n\tvar column;\n\tvar token;\n\tvar key;\n\tvar root;\n\n\tvar parse = function parse (text, reviver) {\n\t    source = String(text);\n\t    parseState = 'start';\n\t    stack = [];\n\t    pos = 0;\n\t    line = 1;\n\t    column = 0;\n\t    token = undefined;\n\t    key = undefined;\n\t    root = undefined;\n\n\t    do {\n\t        token = lex();\n\n\t        // This code is unreachable.\n\t        // if (!parseStates[parseState]) {\n\t        //     throw invalidParseState()\n\t        // }\n\n\t        parseStates[parseState]();\n\t    } while (token.type !== 'eof')\n\n\t    if (typeof reviver === 'function') {\n\t        return internalize({'': root}, '', reviver)\n\t    }\n\n\t    return root\n\t};\n\n\tfunction internalize (holder, name, reviver) {\n\t    var value = holder[name];\n\t    if (value != null && typeof value === 'object') {\n\t        if (Array.isArray(value)) {\n\t            for (var i = 0; i < value.length; i++) {\n\t                var key = String(i);\n\t                var replacement = internalize(value, key, reviver);\n\t                if (replacement === undefined) {\n\t                    delete value[key];\n\t                } else {\n\t                    Object.defineProperty(value, key, {\n\t                        value: replacement,\n\t                        writable: true,\n\t                        enumerable: true,\n\t                        configurable: true,\n\t                    });\n\t                }\n\t            }\n\t        } else {\n\t            for (var key$1 in value) {\n\t                var replacement$1 = internalize(value, key$1, reviver);\n\t                if (replacement$1 === undefined) {\n\t                    delete value[key$1];\n\t                } else {\n\t                    Object.defineProperty(value, key$1, {\n\t                        value: replacement$1,\n\t                        writable: true,\n\t                        enumerable: true,\n\t                        configurable: true,\n\t                    });\n\t                }\n\t            }\n\t        }\n\t    }\n\n\t    return reviver.call(holder, name, value)\n\t}\n\n\tvar lexState;\n\tvar buffer;\n\tvar doubleQuote;\n\tvar sign;\n\tvar c;\n\n\tfunction lex () {\n\t    lexState = 'default';\n\t    buffer = '';\n\t    doubleQuote = false;\n\t    sign = 1;\n\n\t    for (;;) {\n\t        c = peek();\n\n\t        // This code is unreachable.\n\t        // if (!lexStates[lexState]) {\n\t        //     throw invalidLexState(lexState)\n\t        // }\n\n\t        var token = lexStates[lexState]();\n\t        if (token) {\n\t            return token\n\t        }\n\t    }\n\t}\n\n\tfunction peek () {\n\t    if (source[pos]) {\n\t        return String.fromCodePoint(source.codePointAt(pos))\n\t    }\n\t}\n\n\tfunction read () {\n\t    var c = peek();\n\n\t    if (c === '\\n') {\n\t        line++;\n\t        column = 0;\n\t    } else if (c) {\n\t        column += c.length;\n\t    } else {\n\t        column++;\n\t    }\n\n\t    if (c) {\n\t        pos += c.length;\n\t    }\n\n\t    return c\n\t}\n\n\tvar lexStates = {\n\t    default: function default$1 () {\n\t        switch (c) {\n\t        case '\\t':\n\t        case '\\v':\n\t        case '\\f':\n\t        case ' ':\n\t        case '\\u00A0':\n\t        case '\\uFEFF':\n\t        case '\\n':\n\t        case '\\r':\n\t        case '\\u2028':\n\t        case '\\u2029':\n\t            read();\n\t            return\n\n\t        case '/':\n\t            read();\n\t            lexState = 'comment';\n\t            return\n\n\t        case undefined:\n\t            read();\n\t            return newToken('eof')\n\t        }\n\n\t        if (util.isSpaceSeparator(c)) {\n\t            read();\n\t            return\n\t        }\n\n\t        // This code is unreachable.\n\t        // if (!lexStates[parseState]) {\n\t        //     throw invalidLexState(parseState)\n\t        // }\n\n\t        return lexStates[parseState]()\n\t    },\n\n\t    comment: function comment () {\n\t        switch (c) {\n\t        case '*':\n\t            read();\n\t            lexState = 'multiLineComment';\n\t            return\n\n\t        case '/':\n\t            read();\n\t            lexState = 'singleLineComment';\n\t            return\n\t        }\n\n\t        throw invalidChar(read())\n\t    },\n\n\t    multiLineComment: function multiLineComment () {\n\t        switch (c) {\n\t        case '*':\n\t            read();\n\t            lexState = 'multiLineCommentAsterisk';\n\t            return\n\n\t        case undefined:\n\t            throw invalidChar(read())\n\t        }\n\n\t        read();\n\t    },\n\n\t    multiLineCommentAsterisk: function multiLineCommentAsterisk () {\n\t        switch (c) {\n\t        case '*':\n\t            read();\n\t            return\n\n\t        case '/':\n\t            read();\n\t            lexState = 'default';\n\t            return\n\n\t        case undefined:\n\t            throw invalidChar(read())\n\t        }\n\n\t        read();\n\t        lexState = 'multiLineComment';\n\t    },\n\n\t    singleLineComment: function singleLineComment () {\n\t        switch (c) {\n\t        case '\\n':\n\t        case '\\r':\n\t        case '\\u2028':\n\t        case '\\u2029':\n\t            read();\n\t            lexState = 'default';\n\t            return\n\n\t        case undefined:\n\t            read();\n\t            return newToken('eof')\n\t        }\n\n\t        read();\n\t    },\n\n\t    value: function value () {\n\t        switch (c) {\n\t        case '{':\n\t        case '[':\n\t            return newToken('punctuator', read())\n\n\t        case 'n':\n\t            read();\n\t            literal('ull');\n\t            return newToken('null', null)\n\n\t        case 't':\n\t            read();\n\t            literal('rue');\n\t            return newToken('boolean', true)\n\n\t        case 'f':\n\t            read();\n\t            literal('alse');\n\t            return newToken('boolean', false)\n\n\t        case '-':\n\t        case '+':\n\t            if (read() === '-') {\n\t                sign = -1;\n\t            }\n\n\t            lexState = 'sign';\n\t            return\n\n\t        case '.':\n\t            buffer = read();\n\t            lexState = 'decimalPointLeading';\n\t            return\n\n\t        case '0':\n\t            buffer = read();\n\t            lexState = 'zero';\n\t            return\n\n\t        case '1':\n\t        case '2':\n\t        case '3':\n\t        case '4':\n\t        case '5':\n\t        case '6':\n\t        case '7':\n\t        case '8':\n\t        case '9':\n\t            buffer = read();\n\t            lexState = 'decimalInteger';\n\t            return\n\n\t        case 'I':\n\t            read();\n\t            literal('nfinity');\n\t            return newToken('numeric', Infinity)\n\n\t        case 'N':\n\t            read();\n\t            literal('aN');\n\t            return newToken('numeric', NaN)\n\n\t        case '\"':\n\t        case \"'\":\n\t            doubleQuote = (read() === '\"');\n\t            buffer = '';\n\t            lexState = 'string';\n\t            return\n\t        }\n\n\t        throw invalidChar(read())\n\t    },\n\n\t    identifierNameStartEscape: function identifierNameStartEscape () {\n\t        if (c !== 'u') {\n\t            throw invalidChar(read())\n\t        }\n\n\t        read();\n\t        var u = unicodeEscape();\n\t        switch (u) {\n\t        case '$':\n\t        case '_':\n\t            break\n\n\t        default:\n\t            if (!util.isIdStartChar(u)) {\n\t                throw invalidIdentifier()\n\t            }\n\n\t            break\n\t        }\n\n\t        buffer += u;\n\t        lexState = 'identifierName';\n\t    },\n\n\t    identifierName: function identifierName () {\n\t        switch (c) {\n\t        case '$':\n\t        case '_':\n\t        case '\\u200C':\n\t        case '\\u200D':\n\t            buffer += read();\n\t            return\n\n\t        case '\\\\':\n\t            read();\n\t            lexState = 'identifierNameEscape';\n\t            return\n\t        }\n\n\t        if (util.isIdContinueChar(c)) {\n\t            buffer += read();\n\t            return\n\t        }\n\n\t        return newToken('identifier', buffer)\n\t    },\n\n\t    identifierNameEscape: function identifierNameEscape () {\n\t        if (c !== 'u') {\n\t            throw invalidChar(read())\n\t        }\n\n\t        read();\n\t        var u = unicodeEscape();\n\t        switch (u) {\n\t        case '$':\n\t        case '_':\n\t        case '\\u200C':\n\t        case '\\u200D':\n\t            break\n\n\t        default:\n\t            if (!util.isIdContinueChar(u)) {\n\t                throw invalidIdentifier()\n\t            }\n\n\t            break\n\t        }\n\n\t        buffer += u;\n\t        lexState = 'identifierName';\n\t    },\n\n\t    sign: function sign$1 () {\n\t        switch (c) {\n\t        case '.':\n\t            buffer = read();\n\t            lexState = 'decimalPointLeading';\n\t            return\n\n\t        case '0':\n\t            buffer = read();\n\t            lexState = 'zero';\n\t            return\n\n\t        case '1':\n\t        case '2':\n\t        case '3':\n\t        case '4':\n\t        case '5':\n\t        case '6':\n\t        case '7':\n\t        case '8':\n\t        case '9':\n\t            buffer = read();\n\t            lexState = 'decimalInteger';\n\t            return\n\n\t        case 'I':\n\t            read();\n\t            literal('nfinity');\n\t            return newToken('numeric', sign * Infinity)\n\n\t        case 'N':\n\t            read();\n\t            literal('aN');\n\t            return newToken('numeric', NaN)\n\t        }\n\n\t        throw invalidChar(read())\n\t    },\n\n\t    zero: function zero () {\n\t        switch (c) {\n\t        case '.':\n\t            buffer += read();\n\t            lexState = 'decimalPoint';\n\t            return\n\n\t        case 'e':\n\t        case 'E':\n\t            buffer += read();\n\t            lexState = 'decimalExponent';\n\t            return\n\n\t        case 'x':\n\t        case 'X':\n\t            buffer += read();\n\t            lexState = 'hexadecimal';\n\t            return\n\t        }\n\n\t        return newToken('numeric', sign * 0)\n\t    },\n\n\t    decimalInteger: function decimalInteger () {\n\t        switch (c) {\n\t        case '.':\n\t            buffer += read();\n\t            lexState = 'decimalPoint';\n\t            return\n\n\t        case 'e':\n\t        case 'E':\n\t            buffer += read();\n\t            lexState = 'decimalExponent';\n\t            return\n\t        }\n\n\t        if (util.isDigit(c)) {\n\t            buffer += read();\n\t            return\n\t        }\n\n\t        return newToken('numeric', sign * Number(buffer))\n\t    },\n\n\t    decimalPointLeading: function decimalPointLeading () {\n\t        if (util.isDigit(c)) {\n\t            buffer += read();\n\t            lexState = 'decimalFraction';\n\t            return\n\t        }\n\n\t        throw invalidChar(read())\n\t    },\n\n\t    decimalPoint: function decimalPoint () {\n\t        switch (c) {\n\t        case 'e':\n\t        case 'E':\n\t            buffer += read();\n\t            lexState = 'decimalExponent';\n\t            return\n\t        }\n\n\t        if (util.isDigit(c)) {\n\t            buffer += read();\n\t            lexState = 'decimalFraction';\n\t            return\n\t        }\n\n\t        return newToken('numeric', sign * Number(buffer))\n\t    },\n\n\t    decimalFraction: function decimalFraction () {\n\t        switch (c) {\n\t        case 'e':\n\t        case 'E':\n\t            buffer += read();\n\t            lexState = 'decimalExponent';\n\t            return\n\t        }\n\n\t        if (util.isDigit(c)) {\n\t            buffer += read();\n\t            return\n\t        }\n\n\t        return newToken('numeric', sign * Number(buffer))\n\t    },\n\n\t    decimalExponent: function decimalExponent () {\n\t        switch (c) {\n\t        case '+':\n\t        case '-':\n\t            buffer += read();\n\t            lexState = 'decimalExponentSign';\n\t            return\n\t        }\n\n\t        if (util.isDigit(c)) {\n\t            buffer += read();\n\t            lexState = 'decimalExponentInteger';\n\t            return\n\t        }\n\n\t        throw invalidChar(read())\n\t    },\n\n\t    decimalExponentSign: function decimalExponentSign () {\n\t        if (util.isDigit(c)) {\n\t            buffer += read();\n\t            lexState = 'decimalExponentInteger';\n\t            return\n\t        }\n\n\t        throw invalidChar(read())\n\t    },\n\n\t    decimalExponentInteger: function decimalExponentInteger () {\n\t        if (util.isDigit(c)) {\n\t            buffer += read();\n\t            return\n\t        }\n\n\t        return newToken('numeric', sign * Number(buffer))\n\t    },\n\n\t    hexadecimal: function hexadecimal () {\n\t        if (util.isHexDigit(c)) {\n\t            buffer += read();\n\t            lexState = 'hexadecimalInteger';\n\t            return\n\t        }\n\n\t        throw invalidChar(read())\n\t    },\n\n\t    hexadecimalInteger: function hexadecimalInteger () {\n\t        if (util.isHexDigit(c)) {\n\t            buffer += read();\n\t            return\n\t        }\n\n\t        return newToken('numeric', sign * Number(buffer))\n\t    },\n\n\t    string: function string () {\n\t        switch (c) {\n\t        case '\\\\':\n\t            read();\n\t            buffer += escape();\n\t            return\n\n\t        case '\"':\n\t            if (doubleQuote) {\n\t                read();\n\t                return newToken('string', buffer)\n\t            }\n\n\t            buffer += read();\n\t            return\n\n\t        case \"'\":\n\t            if (!doubleQuote) {\n\t                read();\n\t                return newToken('string', buffer)\n\t            }\n\n\t            buffer += read();\n\t            return\n\n\t        case '\\n':\n\t        case '\\r':\n\t            throw invalidChar(read())\n\n\t        case '\\u2028':\n\t        case '\\u2029':\n\t            separatorChar(c);\n\t            break\n\n\t        case undefined:\n\t            throw invalidChar(read())\n\t        }\n\n\t        buffer += read();\n\t    },\n\n\t    start: function start () {\n\t        switch (c) {\n\t        case '{':\n\t        case '[':\n\t            return newToken('punctuator', read())\n\n\t        // This code is unreachable since the default lexState handles eof.\n\t        // case undefined:\n\t        //     return newToken('eof')\n\t        }\n\n\t        lexState = 'value';\n\t    },\n\n\t    beforePropertyName: function beforePropertyName () {\n\t        switch (c) {\n\t        case '$':\n\t        case '_':\n\t            buffer = read();\n\t            lexState = 'identifierName';\n\t            return\n\n\t        case '\\\\':\n\t            read();\n\t            lexState = 'identifierNameStartEscape';\n\t            return\n\n\t        case '}':\n\t            return newToken('punctuator', read())\n\n\t        case '\"':\n\t        case \"'\":\n\t            doubleQuote = (read() === '\"');\n\t            lexState = 'string';\n\t            return\n\t        }\n\n\t        if (util.isIdStartChar(c)) {\n\t            buffer += read();\n\t            lexState = 'identifierName';\n\t            return\n\t        }\n\n\t        throw invalidChar(read())\n\t    },\n\n\t    afterPropertyName: function afterPropertyName () {\n\t        if (c === ':') {\n\t            return newToken('punctuator', read())\n\t        }\n\n\t        throw invalidChar(read())\n\t    },\n\n\t    beforePropertyValue: function beforePropertyValue () {\n\t        lexState = 'value';\n\t    },\n\n\t    afterPropertyValue: function afterPropertyValue () {\n\t        switch (c) {\n\t        case ',':\n\t        case '}':\n\t            return newToken('punctuator', read())\n\t        }\n\n\t        throw invalidChar(read())\n\t    },\n\n\t    beforeArrayValue: function beforeArrayValue () {\n\t        if (c === ']') {\n\t            return newToken('punctuator', read())\n\t        }\n\n\t        lexState = 'value';\n\t    },\n\n\t    afterArrayValue: function afterArrayValue () {\n\t        switch (c) {\n\t        case ',':\n\t        case ']':\n\t            return newToken('punctuator', read())\n\t        }\n\n\t        throw invalidChar(read())\n\t    },\n\n\t    end: function end () {\n\t        // This code is unreachable since it's handled by the default lexState.\n\t        // if (c === undefined) {\n\t        //     read()\n\t        //     return newToken('eof')\n\t        // }\n\n\t        throw invalidChar(read())\n\t    },\n\t};\n\n\tfunction newToken (type, value) {\n\t    return {\n\t        type: type,\n\t        value: value,\n\t        line: line,\n\t        column: column,\n\t    }\n\t}\n\n\tfunction literal (s) {\n\t    for (var i = 0, list = s; i < list.length; i += 1) {\n\t        var c = list[i];\n\n\t        var p = peek();\n\n\t        if (p !== c) {\n\t            throw invalidChar(read())\n\t        }\n\n\t        read();\n\t    }\n\t}\n\n\tfunction escape () {\n\t    var c = peek();\n\t    switch (c) {\n\t    case 'b':\n\t        read();\n\t        return '\\b'\n\n\t    case 'f':\n\t        read();\n\t        return '\\f'\n\n\t    case 'n':\n\t        read();\n\t        return '\\n'\n\n\t    case 'r':\n\t        read();\n\t        return '\\r'\n\n\t    case 't':\n\t        read();\n\t        return '\\t'\n\n\t    case 'v':\n\t        read();\n\t        return '\\v'\n\n\t    case '0':\n\t        read();\n\t        if (util.isDigit(peek())) {\n\t            throw invalidChar(read())\n\t        }\n\n\t        return '\\0'\n\n\t    case 'x':\n\t        read();\n\t        return hexEscape()\n\n\t    case 'u':\n\t        read();\n\t        return unicodeEscape()\n\n\t    case '\\n':\n\t    case '\\u2028':\n\t    case '\\u2029':\n\t        read();\n\t        return ''\n\n\t    case '\\r':\n\t        read();\n\t        if (peek() === '\\n') {\n\t            read();\n\t        }\n\n\t        return ''\n\n\t    case '1':\n\t    case '2':\n\t    case '3':\n\t    case '4':\n\t    case '5':\n\t    case '6':\n\t    case '7':\n\t    case '8':\n\t    case '9':\n\t        throw invalidChar(read())\n\n\t    case undefined:\n\t        throw invalidChar(read())\n\t    }\n\n\t    return read()\n\t}\n\n\tfunction hexEscape () {\n\t    var buffer = '';\n\t    var c = peek();\n\n\t    if (!util.isHexDigit(c)) {\n\t        throw invalidChar(read())\n\t    }\n\n\t    buffer += read();\n\n\t    c = peek();\n\t    if (!util.isHexDigit(c)) {\n\t        throw invalidChar(read())\n\t    }\n\n\t    buffer += read();\n\n\t    return String.fromCodePoint(parseInt(buffer, 16))\n\t}\n\n\tfunction unicodeEscape () {\n\t    var buffer = '';\n\t    var count = 4;\n\n\t    while (count-- > 0) {\n\t        var c = peek();\n\t        if (!util.isHexDigit(c)) {\n\t            throw invalidChar(read())\n\t        }\n\n\t        buffer += read();\n\t    }\n\n\t    return String.fromCodePoint(parseInt(buffer, 16))\n\t}\n\n\tvar parseStates = {\n\t    start: function start () {\n\t        if (token.type === 'eof') {\n\t            throw invalidEOF()\n\t        }\n\n\t        push();\n\t    },\n\n\t    beforePropertyName: function beforePropertyName () {\n\t        switch (token.type) {\n\t        case 'identifier':\n\t        case 'string':\n\t            key = token.value;\n\t            parseState = 'afterPropertyName';\n\t            return\n\n\t        case 'punctuator':\n\t            // This code is unreachable since it's handled by the lexState.\n\t            // if (token.value !== '}') {\n\t            //     throw invalidToken()\n\t            // }\n\n\t            pop();\n\t            return\n\n\t        case 'eof':\n\t            throw invalidEOF()\n\t        }\n\n\t        // This code is unreachable since it's handled by the lexState.\n\t        // throw invalidToken()\n\t    },\n\n\t    afterPropertyName: function afterPropertyName () {\n\t        // This code is unreachable since it's handled by the lexState.\n\t        // if (token.type !== 'punctuator' || token.value !== ':') {\n\t        //     throw invalidToken()\n\t        // }\n\n\t        if (token.type === 'eof') {\n\t            throw invalidEOF()\n\t        }\n\n\t        parseState = 'beforePropertyValue';\n\t    },\n\n\t    beforePropertyValue: function beforePropertyValue () {\n\t        if (token.type === 'eof') {\n\t            throw invalidEOF()\n\t        }\n\n\t        push();\n\t    },\n\n\t    beforeArrayValue: function beforeArrayValue () {\n\t        if (token.type === 'eof') {\n\t            throw invalidEOF()\n\t        }\n\n\t        if (token.type === 'punctuator' && token.value === ']') {\n\t            pop();\n\t            return\n\t        }\n\n\t        push();\n\t    },\n\n\t    afterPropertyValue: function afterPropertyValue () {\n\t        // This code is unreachable since it's handled by the lexState.\n\t        // if (token.type !== 'punctuator') {\n\t        //     throw invalidToken()\n\t        // }\n\n\t        if (token.type === 'eof') {\n\t            throw invalidEOF()\n\t        }\n\n\t        switch (token.value) {\n\t        case ',':\n\t            parseState = 'beforePropertyName';\n\t            return\n\n\t        case '}':\n\t            pop();\n\t        }\n\n\t        // This code is unreachable since it's handled by the lexState.\n\t        // throw invalidToken()\n\t    },\n\n\t    afterArrayValue: function afterArrayValue () {\n\t        // This code is unreachable since it's handled by the lexState.\n\t        // if (token.type !== 'punctuator') {\n\t        //     throw invalidToken()\n\t        // }\n\n\t        if (token.type === 'eof') {\n\t            throw invalidEOF()\n\t        }\n\n\t        switch (token.value) {\n\t        case ',':\n\t            parseState = 'beforeArrayValue';\n\t            return\n\n\t        case ']':\n\t            pop();\n\t        }\n\n\t        // This code is unreachable since it's handled by the lexState.\n\t        // throw invalidToken()\n\t    },\n\n\t    end: function end () {\n\t        // This code is unreachable since it's handled by the lexState.\n\t        // if (token.type !== 'eof') {\n\t        //     throw invalidToken()\n\t        // }\n\t    },\n\t};\n\n\tfunction push () {\n\t    var value;\n\n\t    switch (token.type) {\n\t    case 'punctuator':\n\t        switch (token.value) {\n\t        case '{':\n\t            value = {};\n\t            break\n\n\t        case '[':\n\t            value = [];\n\t            break\n\t        }\n\n\t        break\n\n\t    case 'null':\n\t    case 'boolean':\n\t    case 'numeric':\n\t    case 'string':\n\t        value = token.value;\n\t        break\n\n\t    // This code is unreachable.\n\t    // default:\n\t    //     throw invalidToken()\n\t    }\n\n\t    if (root === undefined) {\n\t        root = value;\n\t    } else {\n\t        var parent = stack[stack.length - 1];\n\t        if (Array.isArray(parent)) {\n\t            parent.push(value);\n\t        } else {\n\t            Object.defineProperty(parent, key, {\n\t                value: value,\n\t                writable: true,\n\t                enumerable: true,\n\t                configurable: true,\n\t            });\n\t        }\n\t    }\n\n\t    if (value !== null && typeof value === 'object') {\n\t        stack.push(value);\n\n\t        if (Array.isArray(value)) {\n\t            parseState = 'beforeArrayValue';\n\t        } else {\n\t            parseState = 'beforePropertyName';\n\t        }\n\t    } else {\n\t        var current = stack[stack.length - 1];\n\t        if (current == null) {\n\t            parseState = 'end';\n\t        } else if (Array.isArray(current)) {\n\t            parseState = 'afterArrayValue';\n\t        } else {\n\t            parseState = 'afterPropertyValue';\n\t        }\n\t    }\n\t}\n\n\tfunction pop () {\n\t    stack.pop();\n\n\t    var current = stack[stack.length - 1];\n\t    if (current == null) {\n\t        parseState = 'end';\n\t    } else if (Array.isArray(current)) {\n\t        parseState = 'afterArrayValue';\n\t    } else {\n\t        parseState = 'afterPropertyValue';\n\t    }\n\t}\n\n\t// This code is unreachable.\n\t// function invalidParseState () {\n\t//     return new Error(`JSON5: invalid parse state '${parseState}'`)\n\t// }\n\n\t// This code is unreachable.\n\t// function invalidLexState (state) {\n\t//     return new Error(`JSON5: invalid lex state '${state}'`)\n\t// }\n\n\tfunction invalidChar (c) {\n\t    if (c === undefined) {\n\t        return syntaxError((\"JSON5: invalid end of input at \" + line + \":\" + column))\n\t    }\n\n\t    return syntaxError((\"JSON5: invalid character '\" + (formatChar(c)) + \"' at \" + line + \":\" + column))\n\t}\n\n\tfunction invalidEOF () {\n\t    return syntaxError((\"JSON5: invalid end of input at \" + line + \":\" + column))\n\t}\n\n\t// This code is unreachable.\n\t// function invalidToken () {\n\t//     if (token.type === 'eof') {\n\t//         return syntaxError(`JSON5: invalid end of input at ${line}:${column}`)\n\t//     }\n\n\t//     const c = String.fromCodePoint(token.value.codePointAt(0))\n\t//     return syntaxError(`JSON5: invalid character '${formatChar(c)}' at ${line}:${column}`)\n\t// }\n\n\tfunction invalidIdentifier () {\n\t    column -= 5;\n\t    return syntaxError((\"JSON5: invalid identifier character at \" + line + \":\" + column))\n\t}\n\n\tfunction separatorChar (c) {\n\t    console.warn((\"JSON5: '\" + (formatChar(c)) + \"' in strings is not valid ECMAScript; consider escaping\"));\n\t}\n\n\tfunction formatChar (c) {\n\t    var replacements = {\n\t        \"'\": \"\\\\'\",\n\t        '\"': '\\\\\"',\n\t        '\\\\': '\\\\\\\\',\n\t        '\\b': '\\\\b',\n\t        '\\f': '\\\\f',\n\t        '\\n': '\\\\n',\n\t        '\\r': '\\\\r',\n\t        '\\t': '\\\\t',\n\t        '\\v': '\\\\v',\n\t        '\\0': '\\\\0',\n\t        '\\u2028': '\\\\u2028',\n\t        '\\u2029': '\\\\u2029',\n\t    };\n\n\t    if (replacements[c]) {\n\t        return replacements[c]\n\t    }\n\n\t    if (c < ' ') {\n\t        var hexString = c.charCodeAt(0).toString(16);\n\t        return '\\\\x' + ('00' + hexString).substring(hexString.length)\n\t    }\n\n\t    return c\n\t}\n\n\tfunction syntaxError (message) {\n\t    var err = new SyntaxError(message);\n\t    err.lineNumber = line;\n\t    err.columnNumber = column;\n\t    return err\n\t}\n\n\tvar stringify = function stringify (value, replacer, space) {\n\t    var stack = [];\n\t    var indent = '';\n\t    var propertyList;\n\t    var replacerFunc;\n\t    var gap = '';\n\t    var quote;\n\n\t    if (\n\t        replacer != null &&\n\t        typeof replacer === 'object' &&\n\t        !Array.isArray(replacer)\n\t    ) {\n\t        space = replacer.space;\n\t        quote = replacer.quote;\n\t        replacer = replacer.replacer;\n\t    }\n\n\t    if (typeof replacer === 'function') {\n\t        replacerFunc = replacer;\n\t    } else if (Array.isArray(replacer)) {\n\t        propertyList = [];\n\t        for (var i = 0, list = replacer; i < list.length; i += 1) {\n\t            var v = list[i];\n\n\t            var item = (void 0);\n\n\t            if (typeof v === 'string') {\n\t                item = v;\n\t            } else if (\n\t                typeof v === 'number' ||\n\t                v instanceof String ||\n\t                v instanceof Number\n\t            ) {\n\t                item = String(v);\n\t            }\n\n\t            if (item !== undefined && propertyList.indexOf(item) < 0) {\n\t                propertyList.push(item);\n\t            }\n\t        }\n\t    }\n\n\t    if (space instanceof Number) {\n\t        space = Number(space);\n\t    } else if (space instanceof String) {\n\t        space = String(space);\n\t    }\n\n\t    if (typeof space === 'number') {\n\t        if (space > 0) {\n\t            space = Math.min(10, Math.floor(space));\n\t            gap = '          '.substr(0, space);\n\t        }\n\t    } else if (typeof space === 'string') {\n\t        gap = space.substr(0, 10);\n\t    }\n\n\t    return serializeProperty('', {'': value})\n\n\t    function serializeProperty (key, holder) {\n\t        var value = holder[key];\n\t        if (value != null) {\n\t            if (typeof value.toJSON5 === 'function') {\n\t                value = value.toJSON5(key);\n\t            } else if (typeof value.toJSON === 'function') {\n\t                value = value.toJSON(key);\n\t            }\n\t        }\n\n\t        if (replacerFunc) {\n\t            value = replacerFunc.call(holder, key, value);\n\t        }\n\n\t        if (value instanceof Number) {\n\t            value = Number(value);\n\t        } else if (value instanceof String) {\n\t            value = String(value);\n\t        } else if (value instanceof Boolean) {\n\t            value = value.valueOf();\n\t        }\n\n\t        switch (value) {\n\t        case null: return 'null'\n\t        case true: return 'true'\n\t        case false: return 'false'\n\t        }\n\n\t        if (typeof value === 'string') {\n\t            return quoteString(value, false)\n\t        }\n\n\t        if (typeof value === 'number') {\n\t            return String(value)\n\t        }\n\n\t        if (typeof value === 'object') {\n\t            return Array.isArray(value) ? serializeArray(value) : serializeObject(value)\n\t        }\n\n\t        return undefined\n\t    }\n\n\t    function quoteString (value) {\n\t        var quotes = {\n\t            \"'\": 0.1,\n\t            '\"': 0.2,\n\t        };\n\n\t        var replacements = {\n\t            \"'\": \"\\\\'\",\n\t            '\"': '\\\\\"',\n\t            '\\\\': '\\\\\\\\',\n\t            '\\b': '\\\\b',\n\t            '\\f': '\\\\f',\n\t            '\\n': '\\\\n',\n\t            '\\r': '\\\\r',\n\t            '\\t': '\\\\t',\n\t            '\\v': '\\\\v',\n\t            '\\0': '\\\\0',\n\t            '\\u2028': '\\\\u2028',\n\t            '\\u2029': '\\\\u2029',\n\t        };\n\n\t        var product = '';\n\n\t        for (var i = 0; i < value.length; i++) {\n\t            var c = value[i];\n\t            switch (c) {\n\t            case \"'\":\n\t            case '\"':\n\t                quotes[c]++;\n\t                product += c;\n\t                continue\n\n\t            case '\\0':\n\t                if (util.isDigit(value[i + 1])) {\n\t                    product += '\\\\x00';\n\t                    continue\n\t                }\n\t            }\n\n\t            if (replacements[c]) {\n\t                product += replacements[c];\n\t                continue\n\t            }\n\n\t            if (c < ' ') {\n\t                var hexString = c.charCodeAt(0).toString(16);\n\t                product += '\\\\x' + ('00' + hexString).substring(hexString.length);\n\t                continue\n\t            }\n\n\t            product += c;\n\t        }\n\n\t        var quoteChar = quote || Object.keys(quotes).reduce(function (a, b) { return (quotes[a] < quotes[b]) ? a : b; });\n\n\t        product = product.replace(new RegExp(quoteChar, 'g'), replacements[quoteChar]);\n\n\t        return quoteChar + product + quoteChar\n\t    }\n\n\t    function serializeObject (value) {\n\t        if (stack.indexOf(value) >= 0) {\n\t            throw TypeError('Converting circular structure to JSON5')\n\t        }\n\n\t        stack.push(value);\n\n\t        var stepback = indent;\n\t        indent = indent + gap;\n\n\t        var keys = propertyList || Object.keys(value);\n\t        var partial = [];\n\t        for (var i = 0, list = keys; i < list.length; i += 1) {\n\t            var key = list[i];\n\n\t            var propertyString = serializeProperty(key, value);\n\t            if (propertyString !== undefined) {\n\t                var member = serializeKey(key) + ':';\n\t                if (gap !== '') {\n\t                    member += ' ';\n\t                }\n\t                member += propertyString;\n\t                partial.push(member);\n\t            }\n\t        }\n\n\t        var final;\n\t        if (partial.length === 0) {\n\t            final = '{}';\n\t        } else {\n\t            var properties;\n\t            if (gap === '') {\n\t                properties = partial.join(',');\n\t                final = '{' + properties + '}';\n\t            } else {\n\t                var separator = ',\\n' + indent;\n\t                properties = partial.join(separator);\n\t                final = '{\\n' + indent + properties + ',\\n' + stepback + '}';\n\t            }\n\t        }\n\n\t        stack.pop();\n\t        indent = stepback;\n\t        return final\n\t    }\n\n\t    function serializeKey (key) {\n\t        if (key.length === 0) {\n\t            return quoteString(key, true)\n\t        }\n\n\t        var firstChar = String.fromCodePoint(key.codePointAt(0));\n\t        if (!util.isIdStartChar(firstChar)) {\n\t            return quoteString(key, true)\n\t        }\n\n\t        for (var i = firstChar.length; i < key.length; i++) {\n\t            if (!util.isIdContinueChar(String.fromCodePoint(key.codePointAt(i)))) {\n\t                return quoteString(key, true)\n\t            }\n\t        }\n\n\t        return key\n\t    }\n\n\t    function serializeArray (value) {\n\t        if (stack.indexOf(value) >= 0) {\n\t            throw TypeError('Converting circular structure to JSON5')\n\t        }\n\n\t        stack.push(value);\n\n\t        var stepback = indent;\n\t        indent = indent + gap;\n\n\t        var partial = [];\n\t        for (var i = 0; i < value.length; i++) {\n\t            var propertyString = serializeProperty(String(i), value);\n\t            partial.push((propertyString !== undefined) ? propertyString : 'null');\n\t        }\n\n\t        var final;\n\t        if (partial.length === 0) {\n\t            final = '[]';\n\t        } else {\n\t            if (gap === '') {\n\t                var properties = partial.join(',');\n\t                final = '[' + properties + ']';\n\t            } else {\n\t                var separator = ',\\n' + indent;\n\t                var properties$1 = partial.join(separator);\n\t                final = '[\\n' + indent + properties$1 + ',\\n' + stepback + ']';\n\t            }\n\t        }\n\n\t        stack.pop();\n\t        indent = stepback;\n\t        return final\n\t    }\n\t};\n\n\tvar JSON5 = {\n\t    parse: parse,\n\t    stringify: stringify,\n\t};\n\n\tvar lib = JSON5;\n\n\tvar es5 = lib;\n\n\treturn es5;\n\n})));\n","/**\n * Returns _true_ if `rx` is a Reactive\n * @param rx\n * @returns\n */\nexport const isReactive = (rx) => {\n    if (typeof rx !== `object`)\n        return false;\n    if (rx === null)\n        return false;\n    return (`on` in rx && `onValue` in rx);\n};\n/**\n * Returns _true_ if `rx` has a last value\n *\n * Judged seeing if `.last()` exists on `rx`.\n * @param rx Reactive\n * @returns\n */\nexport const hasLast = (rx) => {\n    if (!isReactive(rx))\n        return false;\n    if (`last` in rx) {\n        // eslint-disable-next-line @typescript-eslint/no-unsafe-call\n        const v = rx.last();\n        if (v !== undefined)\n            return true;\n    }\n    return false;\n};\n","export const getOrGenerateSync = (map, fn) => (key, args) => {\n    let value = map.get(key);\n    if (value !== undefined)\n        return value;\n    value = fn(key, args);\n    map.set(key, value);\n    return value;\n};\n","import { getOrGenerateSync } from \"./util.js\";\n/**\n * Returns a console logging function which prefixes messages. This is\n * useful for tracing messages from different components. Each prefix\n * is assigned a colour, further helping to distinguish messages.\n *\n * Use {@link logSet} to get a bundled set.\n *\n * ```\n * // Initialise once\n * const log = logger(`a`);\n * const error = logger(`a`, `error`);\n * const warn = logger(`a`, `warn);\n *\n * // And then use\n * log(`Hello`);    // console.log(`a Hello`);\n * error(`Uh-oh`);  // console.error(`a Uh-oh`);\n * warn(`Eek!`);    // console.warn(`a Eeek!`);\n * ```\n *\n * Provide the `colourKey` parameter to make log messages\n * be coloured the same, even though the prefix is different.\n * ```js\n * // Both loggers will use the same colour because they\n * // share the colour key `system`\n * const log = logger(`a`,`log`,`system`);\n * const log2 = logger(`b`, `log`, `system`);\n * ```\n * @param prefix\n * @param kind\n * @param colourKey Optional key to colour log lines by instead of prefix\n * @returns\n */\nexport const logger = (prefix, kind = `log`, colourKey) => (m) => {\n    if (m === undefined) {\n        m = `(undefined)`;\n    }\n    else if (typeof m === `object`) {\n        m = JSON.stringify(m);\n    }\n    const colour = colourKey ?? prefix;\n    switch (kind) {\n        case `log`: {\n            console.log(`%c${prefix} ${m}`, `color: ${logColours(colour)}`);\n            break;\n        }\n        case `warn`: {\n            console.warn(prefix, m);\n            break;\n        }\n        case `error`: {\n            console.error(prefix, m);\n            break;\n        }\n    }\n};\n/**\n* Returns a bundled collection of {@link logger}s\n*\n* ```js\n* const con = logSet(`a`);\n* con.log(`Hello`);  // console.log(`a Hello`);\n* con.warn(`Uh-oh`); // console.warn(`a Uh-oh`);\n* con.error(`Eek!`); // console.error(`a Eek!`);\n* ```\n*\n* By default each prefix is assigned a colour. To use\n* another logic, provide the `colourKey` parameter.\n*\n* ```js\n* // Both set of loggers will use same colour\n* const con = logSet(`a`, true, `system`);\n* const con2 = logSet(`b`, true, `system`);\n* ```\n* @param prefix Prefix for log messages\n* @param verbose True by default. If false, log() messages are a no-op\n* @param colourKey If specified, log messages will be coloured by this key instead of prefix (default)\n* @returns\n*/\nexport const logSet = (prefix, verbose = true, colourKey) => {\n    if (verbose) {\n        return {\n            log: logger(prefix, `log`, colourKey),\n            warn: logger(prefix, `warn`, colourKey),\n            error: logger(prefix, `error`, colourKey),\n        };\n    }\n    return {\n        log: (_) => {\n            /** no-op */\n        },\n        warn: logger(prefix, `warn`, colourKey),\n        error: logger(prefix, `error`, colourKey),\n    };\n};\n/**\n * Resolve a LogOption to a function\n * @param l\n * @returns\n */\nexport const resolveLogOption = (l, defaults = {}) => {\n    if (l === undefined || (typeof l === `boolean` && !l)) {\n        return (_) => {\n            /** no-op */\n        };\n    }\n    const defaultCat = defaults.category ?? ``;\n    const defaultKind = defaults.kind ?? undefined;\n    if (typeof l === `boolean`) {\n        return (messageOrString) => {\n            const m = typeof messageOrString === `string` ? { msg: messageOrString } : messageOrString;\n            const kind = m.kind ?? defaultKind;\n            const category = m.category ?? defaultCat;\n            let message = m.msg;\n            if (category)\n                message = `[${category}] ${message}`;\n            switch (kind) {\n                case `error`: {\n                    console.error(message);\n                    break;\n                }\n                case `warn`: {\n                    console.warn(message);\n                    break;\n                }\n                case `info`: {\n                    console.info(message);\n                    break;\n                }\n                default: {\n                    console.log(message);\n                }\n            }\n        };\n    }\n    return l;\n};\nlet logColourCount = 0;\nexport const logColours = getOrGenerateSync(new Map(), () => {\n    const hue = ++logColourCount * 137.508; // use golden angle approximation\n    return `hsl(${hue},50%,75%)`;\n});\n","/**\n * Calculates frames per second.\n *\n * Returns a function which needs to be called at the end of each frame.\n *\n * ```js\n * const fps = fpsCounter();\n *\n * function loop() {\n *  fps(); // Calculate fps\n *  window.requestAnimationFrame(loop);\n * }\n *\n * loop();\n * ```\n * @param autoDisplay If true (default), prints out the FPS to the console\n * @param computeAfterFrames Calculates after this many frames. Higher numbers smoothes the value somewhat\n * @returns\n */\nexport const fpsCounter = (autoDisplay = true, computeAfterFrames = 500) => {\n    let count = 0;\n    let lastFps = 0;\n    let countStart = performance.now();\n    return () => {\n        if (count++ >= computeAfterFrames) {\n            const elapsed = performance.now() - countStart;\n            countStart = performance.now();\n            count = 0;\n            lastFps = Math.floor((computeAfterFrames / elapsed) * 1000);\n            if (autoDisplay)\n                console.log(`fps: ${lastFps}`);\n        }\n        return lastFps;\n    };\n};\n","/**\n * Returns a string representation of an error\n * @param ex\n * @returns\n */\nexport const getErrorMessage = (ex) => {\n    if (typeof ex === `string`)\n        return ex;\n    if (ex instanceof Error) {\n        return ex.message;\n    }\n    return ex;\n};\n","export * from './types.js';\nexport * from './logger.js';\nexport * from './fps-counter.js';\nexport * from './error-message.js';\n","import { getErrorMessage } from \"@ixfx/debug\";\nimport { hasLast, isReactive } from \"./reactive-core.js\";\n/**\n * Resolves the input to a concrete value.\n *\n * The input can be:\n * * primitive value (string, boolean, number, object)\n * * a/sync function\n * * a/sync generator/iterator\n * * ReactiveNonInitial\n *\n * Examples:\n * ```js\n * await resolve(10);       // 10\n * await resolve(() => 10); // 10\n * await resole(async () => {\n *  sleep(100);\n *  return 10;\n * });                // 10\n * ```\n *\n * If the input is a function, any arguments given to `resolve` are passed to it as a spread.\n *\n * Resolve is not recursive. If the input is an object, it will be returned, even\n * though its properties may be resolvable. Use {@link resolveFields} if you want to handle this case.\n * @param resolvable Input to resolve\n * @param args Additional arguments to pass to function-resolvables.\n * @returns\n */\nexport async function resolve(resolvable, ...args) {\n    if (typeof resolvable === `object`) {\n        if (`next` in resolvable) {\n            const tag = resolvable[Symbol.toStringTag];\n            if (tag === `Generator` || tag == `Array Iterator`) {\n                const v = resolvable.next();\n                if (`done` in v && `value` in v)\n                    return v.value;\n                return v;\n            }\n            else if (tag === `AsyncGenerator`) {\n                const v = await resolvable.next();\n                //console.log(`  hasDone: ${ `done` in v } value:`, v);\n                if (`done` in v && `value` in v)\n                    return v.value;\n                return v;\n            }\n            else {\n                throw new Error(`Object has 'next' prop, but does not have 'AsyncGenerator', 'Generator' or 'Array Iterator' string tag symbol. Got: '${tag}'`);\n            }\n        }\n        else if (isReactive(resolvable)) {\n            // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n            if (hasLast(resolvable))\n                return resolvable.last();\n            throw new Error(`Reactive does not have last value`);\n        }\n        else {\n            // Some regular object\n            return resolvable;\n        }\n    }\n    else if (typeof resolvable === `function`) {\n        const v = await resolvable(...args);\n        return v;\n    }\n    else {\n        // Primitive value?\n        return resolvable;\n    }\n}\n/**\n * For the given input, attempts to 'resolve' it. See {@link resolve} for details and asynchronous version.\n * @param resolvable\n * @param args\n * @returns\n */\nexport function resolveSync(resolvable, ...args) {\n    if (typeof resolvable === `object`) {\n        if (`next` in resolvable) {\n            const tag = resolvable[Symbol.toStringTag];\n            if (tag === `Generator` || tag == `Array Iterator`) {\n                const v = resolvable.next();\n                if (`done` in v && `value` in v)\n                    return v.value;\n                return v;\n            }\n            else if (tag === `AsyncGenerator`) {\n                throw new Error(`resolveSync cannot work with an async generator`);\n            }\n            else {\n                throw new Error(`Object has 'next' prop, but does not have 'Generator' or 'Array Iterator' string tag symbol. Got: '${tag}'`);\n            }\n        }\n        else if (isReactive(resolvable)) {\n            // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n            if (hasLast(resolvable))\n                return resolvable.last();\n            throw new Error(`Reactive does not have last value`);\n        }\n        else {\n            // Some regular object\n            return resolvable;\n        }\n    }\n    else if (typeof resolvable === `function`) {\n        return resolvable(...args);\n    }\n    else {\n        // Primitive value?\n        return resolvable;\n    }\n}\n/**\n * Resolves a value as per {@link resolve}, however f an error is thrown\n * or the resolution results in _undefined_\n * or NaN, the fallback value is returned instead.\n *\n * `null` is an allowed return value.\n *\n * ```js\n * // Function returns undefined 50% of the time or 0\n * const fn = () => {\n *  if (Math.random() >= 0.5) return; // undefined\n *  return 0;\n * }\n * const r = resolveWithFallback(fn, 1);\n * const value = r(); // Always 0 or 1\n * ```\n *\n * See also {@link resolveWithFallbackSync}\n * @param p Thing to resolve\n * @param options Fallback value if an error happens, undefined or NaN\n * @param args\n * @returns\n */\nexport async function resolveWithFallback(p, options, ...args) {\n    let errored = false;\n    let fallbackValue = options.value;\n    const overrideWithLast = options.overrideWithLast ?? false;\n    if (fallbackValue === undefined)\n        throw new Error(`Param 'options.value' is undefined`);\n    try {\n        const r = await resolve(p, ...args);\n        if (typeof r === `undefined`)\n            return fallbackValue;\n        if (typeof r === `number` && Number.isNaN(r))\n            return fallbackValue;\n        if (overrideWithLast)\n            fallbackValue = r;\n        return r;\n    }\n    catch (error) {\n        if (!errored) {\n            errored = true;\n            console.warn(`resolveWithFallback swallowed an error. Additional errors not reported.`, getErrorMessage(error));\n        }\n        return fallbackValue;\n    }\n}\n/**\n * Resolves a 'resolvable', using a fallback value if it results to _undefined_ or _NaN_. _null_ is allowed.\n *\n * See also {@link resolveWithFallback} for the asynchronous version.\n *\n * Options:\n * * value: Fallback value\n * * overrideWithLast: If true, uses the previously-valid value as the replacement fallback (default: false)\n * @param p\n * @param options\n * @param args\n * @returns\n */\nexport function resolveWithFallbackSync(p, options, ...args) {\n    let errored = false;\n    let fallbackValue = options.value;\n    const overrideWithLast = options.overrideWithLast ?? false;\n    if (fallbackValue === undefined)\n        throw new Error(`Param 'options.value' is undefined`);\n    try {\n        const r = resolveSync(p, ...args);\n        if (typeof r === `undefined`)\n            return fallbackValue;\n        if (typeof r === `number` && Number.isNaN(r))\n            return fallbackValue;\n        if (overrideWithLast)\n            fallbackValue = r;\n        return r;\n    }\n    catch (error) {\n        if (!errored) {\n            errored = true;\n            console.warn(`resolveWithFallbackSync swallowed an error. Additional errors not reported.`, getErrorMessage(error));\n        }\n        return fallbackValue;\n    }\n}\n","import { integerTest, resultThrow } from \"@ixfx/guards\";\n/**\n * A circular array keeps a maximum number of values, overwriting older values as needed. Immutable.\n *\n * `CircularArray` extends the regular JS array. Only use `add` to change the array if you want\n * to keep the `CircularArray` behaviour.\n *\n * @example Basic functions\n * ```js\n * let a = new CircularArray(10);\n * a = a.add(`hello`);  // Because it's immutable, capture the return result of `add`\n * a.isFull;            // True if circular array is full\n * a.pointer;           // The current position in array it will write to\n * ```\n *\n * Since it extends the regular JS array, you can access items as usual:\n * @example Accessing\n * ```js\n * let a = new CircularArray(10);\n * ... add some stuff ..\n * a.forEach(item => // do something with item);\n * ```\n * @param capacity Maximum capacity before recycling array entries\n * @return Circular array\n */\nexport class CircularArray extends Array {\n    #capacity;\n    #pointer;\n    constructor(capacity = 0) {\n        super();\n        // Allowed to create with capacity zero\n        resultThrow(integerTest(capacity, `positive`, `capacity`));\n        // Can't throw because .filter won't use ctor proprly\n        this.#capacity = capacity;\n        this.#pointer = 0;\n    }\n    /**\n     * Add to array\n     * @param value Thing to add\n     * @returns\n     */\n    add(value) {\n        const ca = CircularArray.from(this);\n        ca[this.#pointer] = value;\n        ca.#capacity = this.#capacity;\n        if (this.#capacity > 0) {\n            ca.#pointer =\n                this.#pointer + 1 === this.#capacity ? 0 : this.#pointer + 1;\n        }\n        else {\n            ca.#pointer = this.#pointer + 1;\n        }\n        return ca;\n    }\n    get pointer() {\n        return this.#pointer;\n    }\n    get isFull() {\n        if (this.#capacity === 0)\n            return false;\n        return this.length === this.#capacity;\n    }\n}\n","export const debug = (opts, message) => {\n    opts.debug ? console.log(`queue:${message}`) : undefined;\n};\nexport const trimQueue = (opts, queue, toAdd) => {\n    const potentialLength = queue.length + toAdd.length;\n    const capacity = opts.capacity ?? potentialLength;\n    const toRemove = potentialLength - capacity;\n    const policy = opts.discardPolicy ?? `additions`;\n    // debug(\n    //   opts,\n    //   `queueLen: ${queue.length} potentialLen: ${potentialLength} toRemove: ${toRemove} policy: ${policy} toAdd.length: ${toAdd.length} capacity: ${capacity}`\n    // );\n    // debug(opts, `to add: ${JSON.stringify(toAdd)}`);\n    switch (policy) {\n        // Only add what we can from toAdd\n        case `additions`: {\n            // debug(\n            //   opts,\n            //   `trimQueue:DiscardAdditions: queueLen: ${queue.length} slice: ${\n            //     potentialLength - capacity\n            //   } toAddLen: ${toAdd.length} nowFull: ${queue.length === opts.capacity}`\n            // );\n            if (queue.length === 0)\n                return toAdd.slice(0, toAdd.length - toRemove);\n            // eslint-disable-next-line unicorn/prefer-ternary\n            if (queue.length === opts.capacity) {\n                return queue; // Completely full\n            }\n            else {\n                // Only add some from the new array (from the front)\n                return [...queue, ...toAdd.slice(0, toRemove - 1)];\n            }\n        }\n        // Remove from rear of queue (last index) before adding new things\n        case `newer`: {\n            if (toRemove >= queue.length) {\n                // New items will completely flush out old\n                //debug(opts, `slice start: ${toAdd.length - capacity}`);\n                if (queue.length === 0) {\n                    // Special case when queue starts off empty\n                    // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n                    return [...toAdd.slice(0, capacity - 1), toAdd.at(-1)];\n                }\n                return toAdd.slice(Math.max(0, toAdd.length - capacity), Math.min(toAdd.length, capacity) + 1);\n                //debug(opts, `Final value: ${JSON.stringify(tmp)}`);\n                //return tmp;\n            }\n            else {\n                // Keep some of the old\n                // const toAddFinal = toAdd.slice(\n                //   0,\n                //   Math.min(toAdd.length, capacity - toRemove + 1)\n                // );\n                // Cap 5, queue 5, toAdd: 10.\n                const countToAdd = Math.max(1, toAdd.length - queue.length);\n                const toAddFinal = toAdd.slice(toAdd.length - countToAdd, toAdd.length);\n                const toKeep = queue.slice(0, Math.min(queue.length, capacity - 1)); //toRemove);\n                // debug(\n                //   opts,\n                //   `trimQueue: countToAdd: ${countToAdd} qLen: ${\n                //     queue.length\n                //   } capacity: ${capacity} toRemove: ${toRemove} keeping: ${JSON.stringify(\n                //     toKeep\n                //   )} from orig: ${JSON.stringify(queue)} toAddFinal: ${JSON.stringify(\n                //     toAddFinal\n                //   )}`\n                // );\n                const t = [...toKeep, ...toAddFinal];\n                //debug(opts, `final: ${JSON.stringify(t)}`);\n                return t;\n            }\n        }\n        // Remove from the front of the queue (0 index). ie. older items are discarded\n        case `older`: {\n            // If queue is A, B and toAdd is C, D this yields A, B, C, D\n            return [...queue, ...toAdd].slice(toRemove);\n        }\n        default: {\n            // eslint-disable-next-line @typescript-eslint/restrict-template-expressions\n            throw new Error(`Unknown overflow policy ${policy}`);\n        }\n    }\n};\n/**\n * Adds to the back of the queue (last array index)\n * Last item of `toAdd` will potentially be the new end of the queue (depending on capacity limit and overflow policy)\n * @typeParam V - Type of values\n * @param {QueueOpts} opts\n * @param {V[]} queue\n * @param {...V[]} toAdd\n * @returns {V[]}\n */\nexport const enqueue = (opts, queue, ...toAdd) => {\n    if (opts === undefined)\n        throw new Error(`opts parameter undefined`);\n    const potentialLength = queue.length + toAdd.length;\n    const overSize = opts.capacity && potentialLength > opts.capacity;\n    const toReturn = overSize\n        ? trimQueue(opts, queue, toAdd)\n        : [...queue, ...toAdd];\n    if (opts.capacity && toReturn.length !== opts.capacity && overSize) {\n        throw new Error(`Bug! Expected return to be at capacity. Return len: ${toReturn.length} capacity: ${opts.capacity} opts: ${JSON.stringify(opts)}`);\n    }\n    if (!opts.capacity && toReturn.length !== potentialLength) {\n        throw new Error(`Bug! Return length not expected. Return len: ${toReturn.length} expected: ${potentialLength} opts: ${JSON.stringify(opts)}`);\n    }\n    return toReturn;\n};\n// Remove from front of queue (0 index)\nexport const dequeue = (opts, queue) => {\n    if (queue.length === 0)\n        throw new Error(`Queue is empty`);\n    return queue.slice(1);\n};\n/**\n * Returns front of queue (oldest item), or undefined if queue is empty\n *\n * @typeParam V - Type of values stored\n * @param {QueueOpts} opts\n * @param {V[]} queue\n * @returns {(V | undefined)}\n */\nexport const peek = (opts, queue) => queue[0];\nexport const isEmpty = (opts, queue) => queue.length === 0;\nexport const isFull = (opts, queue) => {\n    if (opts.capacity) {\n        return queue.length >= opts.capacity;\n    }\n    return false;\n};\n","import {} from './iqueue-mutable.js';\nimport { enqueue, peek, dequeue, isEmpty, isFull } from './queue-fns.js';\nimport {} from './queue-types.js';\nimport { isEqualDefault } from '@ixfx/core';\nimport { SimpleEventEmitter } from '@ixfx/events'; //'../../Events.js';\n/**\n * Mutable queue that fires events when manipulated.\n *\n * Queues are useful if you want to treat 'older' or 'newer'\n * items differently. _Enqueing_ adds items at the back of the queue, while\n * _dequeing_ removes items from the front (ie. the oldest).\n *\n * ```js\n * const q = Queues.mutable();       // Create\n * q.enqueue(`a`, `b`);     // Add two strings\n * const front = q.dequeue();  // `a` is at the front of queue (oldest)\n * ```\n *\n * @example Cap size to 5 items, throwing away newest items already in queue.\n * ```js\n * const q = Queues.mutable({capacity: 5, discardPolicy: `newer`});\n * ```\n *\n * Events can be used to monitor data flows.\n * * 'enqueue': fires when item(s) are added\n * * 'dequeue': fires when an item is dequeued from front\n * * 'removed': fires when an item is dequeued, queue is cleared or .removeWhere is used to trim queue\n *\n * Each of the event handlers return the state of the queue as the 'finalData'\n * field.\n *\n * ```js\n * q.addEventListener(`enqueue`, e => {\n *  // e.added, e.finalData\n * });\n * q.addEventListener(`removed`, e => {\n *  // e.removed, e.finalData\n * });\n * q.addEventListener(`dequeue`, e=> {\n *  // e.removed, e.finalData\n * })\n * ```\n * @typeParam V - Data type of items\n */\nexport class QueueMutable extends SimpleEventEmitter {\n    options;\n    data;\n    eq;\n    constructor(opts = {}, data = []) {\n        super();\n        if (opts === undefined)\n            throw new Error(`opts parameter undefined`);\n        this.options = opts;\n        this.data = data;\n        this.eq = opts.eq ?? isEqualDefault;\n    }\n    clear() {\n        const copy = [...this.data];\n        this.data = [];\n        this.fireEvent(`removed`, { finalData: this.data, removed: copy });\n        this.onClear();\n    }\n    /**\n     * Called when all data is cleared\n     */\n    onClear() {\n    }\n    at(index) {\n        if (index >= this.data.length)\n            throw new Error(`Index outside bounds of queue`);\n        const v = this.data.at(index);\n        if (v === undefined)\n            throw new Error(`Index appears to be outside range of queue`);\n        return v;\n    }\n    enqueue(...toAdd) {\n        this.data = enqueue(this.options, this.data, ...toAdd);\n        const length = this.data.length;\n        this.onEnqueue(this.data, toAdd);\n        return length;\n    }\n    onEnqueue(result, attemptedToAdd) {\n        this.fireEvent(`enqueue`, { added: attemptedToAdd, finalData: result });\n    }\n    dequeue() {\n        const v = peek(this.options, this.data);\n        if (v === undefined)\n            return;\n        /* eslint-disable-next-line functional/immutable-data */\n        this.data = dequeue(this.options, this.data);\n        this.fireEvent(`dequeue`, { removed: v, finalData: this.data });\n        this.onRemoved([v], this.data);\n        return v;\n    }\n    onRemoved(removed, finalData) {\n        this.fireEvent(`removed`, { removed, finalData });\n    }\n    /**\n     * Removes values that match `predicate`.\n     * @param predicate\n     * @returns Returns number of items removed.\n     */\n    removeWhere(predicate) {\n        const countPre = this.data.length;\n        const toRemove = this.data.filter(v => predicate(v));\n        if (toRemove.length === 0)\n            return 0;\n        this.data = this.data.filter((element) => !predicate(element));\n        this.onRemoved(toRemove, this.data);\n        return countPre - this.data.length;\n    }\n    /**\n   * Return a copy of the array\n   * @returns\n   */\n    toArray() {\n        return [...this.data];\n    }\n    get isEmpty() {\n        return isEmpty(this.options, this.data);\n    }\n    get isFull() {\n        return isFull(this.options, this.data);\n    }\n    get length() {\n        return this.data.length;\n    }\n    get peek() {\n        return peek(this.options, this.data);\n    }\n}\n/**\n * Creates a new QueueMutable\n * @param options\n * @param startingItems\n * @returns\n */\nexport function mutable(options = {}, ...startingItems) {\n    return new QueueMutable({ ...options }, [...startingItems]);\n}\n","export const trimStack = (opts, stack, toAdd) => {\n    const potentialLength = stack.length + toAdd.length;\n    const policy = opts.discardPolicy ?? `additions`;\n    const capacity = opts.capacity ?? potentialLength;\n    const toRemove = potentialLength - capacity;\n    if (opts.debug) {\n        console.log(`Stack.push: stackLen: ${stack.length} potentialLen: ${potentialLength} toRemove: ${toRemove} policy: ${policy}`);\n    }\n    switch (policy) {\n        case `additions`: {\n            if (opts.debug) {\n                console.log(`Stack.push:DiscardAdditions: stackLen: ${stack.length} slice: ${potentialLength - capacity} toAddLen: ${toAdd.length}`);\n            }\n            // eslint-disable-next-line unicorn/prefer-ternary\n            if (stack.length === opts.capacity) {\n                return stack; // Completely full\n            }\n            else {\n                // Only add some from the new array\n                return [...stack, ...toAdd.slice(0, toAdd.length - toRemove)];\n            }\n        }\n        case `newer`: {\n            if (toRemove >= stack.length) {\n                // New items will completely flush out old\n                return toAdd.slice(Math.max(0, toAdd.length - capacity), Math.min(toAdd.length, capacity) + 1);\n            }\n            else {\n                // Keep some of the old (from 0)\n                //if (opts.debug) console.log(` orig: ${JSON.stringify(stack)}`);\n                if (opts.debug) {\n                    console.log(` from orig: ${JSON.stringify(stack.slice(0, stack.length - toRemove))}`);\n                }\n                return [\n                    ...stack.slice(0, stack.length - toRemove),\n                    ...toAdd.slice(0, Math.min(toAdd.length, capacity - toRemove + 1)),\n                ];\n            }\n        }\n        case `older`: {\n            // Oldest item in stack is position 0\n            return [...stack, ...toAdd].slice(toRemove);\n        }\n        default: {\n            // eslint-disable-next-line @typescript-eslint/restrict-template-expressions\n            throw new Error(`Unknown discard policy ${policy}`);\n        }\n    }\n};\n// Add to top (last index)\nexport const push = (opts, stack, ...toAdd) => {\n    // If stack is A, B and toAdd is C, D this yields A, B, C, D\n    //const mutated = [...stack, ...toAdd];\n    const potentialLength = stack.length + toAdd.length;\n    const overSize = opts.capacity && potentialLength > opts.capacity;\n    const toReturn = overSize\n        ? trimStack(opts, stack, toAdd)\n        : [...stack, ...toAdd];\n    return toReturn;\n};\n// Remove from top (last index)\nexport const pop = (opts, stack) => {\n    if (stack.length === 0)\n        throw new Error(`Stack is empty`);\n    return stack.slice(0, -1);\n};\n/**\n * Peek at the top of the stack (end of array)\n *\n * @typeParam V - Type of stored items\n * @param {StackOpts} opts\n * @param {V[]} stack\n * @returns {(V | undefined)}\n */\nexport const peek = (opts, stack) => stack.at(-1);\nexport const isEmpty = (opts, stack) => stack.length === 0;\nexport const isFull = (opts, stack) => {\n    if (opts.capacity) {\n        return stack.length >= opts.capacity;\n    }\n    return false;\n};\n","// -------------------------\n// Mutable\n// -------------------------\nimport { push, peek, pop, isEmpty, isFull } from './StackFns.js';\n/**\n * Creates a stack. Mutable. Use {@link StackImmutable} for an immutable alternative.\n *\n * @example Basic usage\n * ```js\n * // Create\n * const s = new StackMutable();\n * // Add one or more items\n * s.push(1, 2, 3, 4);\n *\n * // See what's on top\n * s.peek;  // 4\n *\n * // Remove the top-most, and return it\n * s.pop();   // 4\n *\n * // Now there's a new top-most element\n * s.peek;  // 3\n * ```\n */\nexport class StackMutable {\n    opts;\n    data;\n    constructor(opts = {}, data = []) {\n        this.opts = opts;\n        this.data = data;\n    }\n    /**\n     * Push data onto the stack.\n     * If `toAdd` is empty, nothing happens\n     * @param toAdd Data to add\n     * @returns Length of stack\n     */\n    push(...toAdd) {\n        if (toAdd.length === 0)\n            return this.data.length;\n        this.data = push(this.opts, this.data, ...toAdd);\n        return this.data.length;\n    }\n    forEach(fn) {\n        this.data.forEach(fn);\n    }\n    forEachFromTop(fn) {\n        [...this.data].reverse().forEach(fn);\n    }\n    pop() {\n        const v = peek(this.opts, this.data);\n        this.data = pop(this.opts, this.data);\n        return v;\n    }\n    get isEmpty() {\n        return isEmpty(this.opts, this.data);\n    }\n    get isFull() {\n        return isFull(this.opts, this.data);\n    }\n    get peek() {\n        return peek(this.opts, this.data);\n    }\n    get length() {\n        return this.data.length;\n    }\n}\n/**\n * Creates a stack. Mutable. Use {@link Stacks.immutable} for an immutable alternative.\n *\n * @example Basic usage\n * ```js\n * // Create\n * const s = Stacks.mutable();\n * // Add one or more items\n * s.push(1, 2, 3, 4);\n *\n * // See what's on top\n * s.peek;  // 4\n *\n * // Remove the top-most, and return it\n * s.pop();   // 4\n *\n * // Now there's a new top-most element\n * s.peek;  // 3\n * ```\n */\nexport const mutable = (opts = {}, ...startingItems) => new StackMutable({ ...opts }, [...startingItems]);\n","import { isEqualValueIgnoreOrder } from \"@ixfx/core\";\nimport * as TreeMutable from './tree-mutable.js';\nexport const compare = (a, b, eq = isEqualValueIgnoreOrder, parent) => {\n    const valueEqual = valueOrIdentityEqual(a, b, eq);\n    // if (!valueEqual) {\n    //   nsole.log(`changed compare a: ${ toStringSingle(a) } b: ${ toStringSingle(b) }`);\n    // }\n    const childrenCompare = compareChildren(a, b, eq);\n    const diff = {\n        valueChanged: !valueEqual, a, b,\n        added: childrenCompare.added,\n        removed: childrenCompare.removed,\n        childChanged: false\n    };\n    const diffNode = {\n        value: diff,\n        childrenStore: [],\n        parent\n    };\n    const childrenDiff = childrenCompare.identical.map(c => compare(c[0], c[1], eq, diffNode));\n    // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n    const someChildChange = hasChange(diff) || childrenDiff.some(v => hasChange(v.value));\n    TreeMutable.setChildren(diffNode, childrenDiff);\n    //diffNode.childrenStore = childrenDiff;\n    diffNode.toString = () => toString(diffNode, 0);\n    // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n    diffNode.value.childChanged = someChildChange;\n    TreeMutable.throwTreeTest(diffNode);\n    return diffNode;\n};\nconst hasChange = (vv) => {\n    if (vv === undefined)\n        return false;\n    if (vv.valueChanged)\n        return true;\n    if (vv.childChanged)\n        return true;\n    if (vv.added.length > 0)\n        return true;\n    if (vv.removed.length > 0)\n        return true;\n    return false;\n};\nconst compareChildren = (a, b, eq = isEqualValueIgnoreOrder) => {\n    const childrenOfA = [...a.children()];\n    const childrenOfB = [...b.children()];\n    const identical = [];\n    const removed = [];\n    for (const childA of childrenOfA) {\n        let foundIndex = -1;\n        for (const [index, childOfB] of childrenOfB.entries()) {\n            const d = valueOrIdentityEqual(childA, childOfB, eq);\n            if (d) {\n                identical.push([childA, childOfB]);\n                foundIndex = index;\n                break;\n            }\n        }\n        if (foundIndex === -1) {\n            // A's child not found in B's children\n            removed.push(childA);\n        }\n        else {\n            // Found, remove it from list of B's children\n            childrenOfB.splice(foundIndex, 1);\n        }\n    }\n    const added = [...childrenOfB];\n    return { added, identical, removed };\n};\nconst valueOrIdentityEqual = (a, b, eq) => {\n    if (a.getIdentity() === b.getIdentity())\n        return true;\n    if (eq(a.getValue(), b.getValue()))\n        return true;\n    return false;\n};\nconst toStringSingle = (n) => {\n    return JSON.stringify(n.getValue());\n};\nconst toString = (n, indent = 0) => {\n    if (n === undefined)\n        return `(undefined)`;\n    let t = toStringDiff(n.value, indent);\n    for (const c of n.childrenStore) {\n        t += toString(c, indent + 2);\n    }\n    return t;\n};\nconst toStringDiff = (n, indent) => {\n    const spaces = ` `.repeat(indent);\n    if (n === undefined)\n        return `${spaces}(undefined)`;\n    const t = [];\n    t.push(`a: ${toStringSingle(n.a)} b: ${toStringSingle(n.b)}`);\n    if (n.valueChanged)\n        t.push(`Value changed. Child changed: ${n.childChanged}`);\n    else\n        t.push(`Value unchanged. Child changed: ${n.childChanged}`);\n    if (n.added.length > 0) {\n        t.push(`Added:`);\n        for (const c of n.added) {\n            t.push(` - ` + toStringSingle(c));\n        }\n    }\n    if (n.removed.length > 0) {\n        t.push(`Removed: ${n.removed.length}`);\n        for (const c of n.removed) {\n            t.push(` - ` + toStringSingle(c));\n        }\n    }\n    t.push(`----\\n`);\n    return t.map(line => spaces + line).join(`\\n`);\n};\n","import { isEqualDefault } from \"@ixfx/core\";\nimport { without } from '@ixfx/arrays';\nimport { containsDuplicateInstances } from \"@ixfx/arrays\";\nimport { QueueMutable } from \"../queue/queue-mutable.js\";\nimport { StackMutable } from \"../stack/StackMutable.js\";\nimport { compare as treeCompare } from './compare.js';\nimport { toStringAbbreviate } from \"@ixfx/core/text\";\n/**\n * Compares two nodes.\n *\n * By default uses `isEqualValueIgnoreOrder` to compare nodes. This means\n * values of nodes will be compared, ignoring the order of fields.\n * @param a\n * @param b\n * @param eq Comparison function. Uses `isEqualValueIgnoreOrder` by default.\n * @returns Compare results\n */\nexport const compare = (a, b, eq) => {\n    return treeCompare(asDynamicTraversable(a), asDynamicTraversable(b), eq);\n};\n/**\n * Converts `TreeNode` to `SimplifiedNode`, removing the 'parent' fields.\n * This can be useful because if you have the whole tree, the parent field\n * is redundant and because it makes circular references can make dumping to console etc more troublesome.\n *\n * Recursive: strips parentage of all children and so on too.\n * @param node\n * @returns\n */\nexport const stripParentage = (node) => {\n    const n = {\n        value: node.value,\n        childrenStore: node.childrenStore.map(c => stripParentage(c))\n    };\n    return n;\n};\nconst unwrapped = (node) => (`wraps` in node) ? node.wraps : node;\nconst wrapped = (node) => (`wraps` in node) ? node : wrap(node);\n/**\n * Wraps node `n` for a more object-oriented means of access.\n * It will wrap child nodes on demand. For this reason, WrappedNode object\n * identity is not stable\n * @param n Node to wrap\n * @returns\n */\nexport const wrap = (n) => {\n    return {\n        *children() {\n            for (const c of n.childrenStore) {\n                yield wrap(c);\n            }\n        },\n        getValue: () => n.value,\n        getIdentity: () => n,\n        *queryValue(value) {\n            for (const v of queryByValue(value, unwrapped(n))) {\n                yield wrap(v);\n            }\n        },\n        *queryParentsValue(child, value, eq) {\n            for (const v of queryParentsValue(unwrapped(child), value, eq)) {\n                yield wrap(v);\n            }\n        },\n        *parentsValues(child) {\n            yield* parentsValues(unwrapped(child));\n        },\n        findParentsValue(child, value, eq) {\n            const n = findParentsValue(child, value, eq);\n            if (n !== undefined)\n                return wrap(n);\n        },\n        getParent: () => n.parent === undefined ? undefined : wrap(n.parent),\n        hasParent: (parent) => {\n            return hasParent(n, unwrapped(parent));\n        },\n        hasAnyParent: (parent) => {\n            return hasAnyParent(n, unwrapped(parent));\n        },\n        hasChild: (child) => {\n            return hasChild(unwrapped(child), n);\n        },\n        hasAnyChild: (child) => {\n            return hasAnyChild(unwrapped(child), n);\n        },\n        remove: () => {\n            remove(n);\n        },\n        addValue: (value) => {\n            const nodeValue = addValue(value, n);\n            return wrap(nodeValue);\n        },\n        add: (child) => {\n            add(unwrapped(child), n);\n            return wrapped(child);\n        },\n        wraps: n\n    };\n};\n/**\n * Removes `child` from the tree structure it is in.\n * It removes `child` from its parent. Any sub-children of `child` still remain connected.\n * @param child\n * @returns\n */\nexport const remove = (child) => {\n    const p = child.parent;\n    if (p === undefined)\n        return;\n    child.parent = undefined;\n    p.childrenStore = without(p.childrenStore, child);\n};\n/**\n * Depth-first iteration of the children of `node`\n * @param node\n * @returns\n */\nexport function* depthFirst(node) {\n    if (!root)\n        return;\n    const stack = new StackMutable();\n    stack.push(...node.childrenStore);\n    let entry = stack.pop();\n    while (entry) {\n        yield entry;\n        if (entry) {\n            stack.push(...entry.childrenStore);\n        }\n        if (stack.isEmpty)\n            break;\n        entry = stack.pop();\n    }\n}\n/**\n * Breadth-first iteration of the children of `node`\n * @param node\n * @returns\n */\nexport function* breadthFirst(node) {\n    if (!node)\n        return;\n    const queue = new QueueMutable();\n    queue.enqueue(...node.childrenStore);\n    let entry = queue.dequeue();\n    while (entry) {\n        yield entry;\n        if (entry) {\n            queue.enqueue(...entry.childrenStore);\n        }\n        if (queue.isEmpty)\n            break;\n        entry = queue.dequeue();\n    }\n}\n/**\n * Validates the tree from `root` downwards.\n * @param root\n * @param seen\n * @returns\n */\nexport function treeTest(root, seen = []) {\n    if (root.parent === root)\n        return [false, `Root has itself as parent`, root];\n    if (seen.includes(root))\n        return [false, `Same node instance is appearing further in tree`, root];\n    seen.push(root);\n    if (containsDuplicateInstances(root.childrenStore))\n        return [false, `Children list contains duplicates`, root];\n    for (const c of root.childrenStore) {\n        if (c.parent !== root)\n            return [false, `Member of childrenStore does not have .parent set`, c];\n        if (hasAnyChild(root, c))\n            return [false, `Child has parent as its own child`, c];\n        const v = treeTest(c, seen);\n        if (!v[0])\n            return v;\n    }\n    return [true, ``, root];\n}\n/**\n * Throws an exception if `root` fails tree validation\n * @param root\n * @returns\n */\nexport function throwTreeTest(root) {\n    const v = treeTest(root);\n    if (v[0])\n        return;\n    throw new Error(`${v[1]} Node: ${toStringAbbreviate(v[2].value, 30)}`, { cause: v[2] });\n}\n/**\n * Iterate over direct children of `root`, yielding {@link TreeNode} instances.\n * Use {@link childrenValues} to iterate over child values\n * @param root\n */\nexport function* children(root) {\n    for (const c of root.childrenStore) {\n        yield c;\n    }\n}\n/**\n * Iterate over the value ofdirect children of `root`.\n * Use {@link children} if you want to iterate over {@link TreeNode} instances instead.\n * @param root\n */\nexport function* childrenValues(root) {\n    for (const c of root.childrenStore) {\n        if (typeof c.value !== `undefined`)\n            yield c.value;\n    }\n}\n/**\n * Iterate over all parents of `root`. First result is the immediate parent.\n * @param root\n */\nexport function* parents(root) {\n    let p = root.parent;\n    while (p) {\n        yield p;\n        p = p.parent;\n    }\n}\n/**\n * Returns the depth of `node`. A root node (ie. with no parents) has a depth of 0.\n * @param node\n * @returns\n */\nexport function nodeDepth(node) {\n    const p = [...parents(node)];\n    return p.length;\n}\nexport const hasChild = (child, parent) => {\n    for (const c of parent.childrenStore) {\n        if (c === child)\n            return true;\n    }\n    return false;\n};\n/**\n * Returns the first immediate child of `parent` that matches `value`.\n *\n * Use {@link queryByValue} if you want all matching children.\n * @param value\n * @param parent\n * @param eq\n * @returns\n */\nexport const findChildByValue = (value, parent, eq = isEqualDefault) => {\n    for (const c of parent.childrenStore) {\n        if (eq(value, c.value))\n            return c;\n    }\n};\n/**\n * Yield all immediate children of `parent` that match `value`.\n *\n * Use {@link findChildByValue} if you only want the first matching child.\n * @param value\n * @param parent\n * @param eq\n */\nexport function* queryByValue(value, parent, eq = isEqualDefault) {\n    for (const c of parent.childrenStore) {\n        if (eq(value, c.value))\n            yield c;\n    }\n}\n/**\n * Returns _true_ if `prospectiveChild` is some child node of `parent`,\n * anywhere in the tree structure.\n *\n * Use {@link hasChild} to only check immediate children.\n * @param prospectiveChild\n * @param parent\n * @returns\n */\nexport const hasAnyChild = (prospectiveChild, parent) => {\n    for (const c of breadthFirst(parent)) {\n        if (c === prospectiveChild)\n            return true;\n    }\n    return false;\n};\nexport const findAnyChildByValue = (value, parent, eq = isEqualDefault) => {\n    for (const c of breadthFirst(parent)) {\n        if (eq(c.value, value))\n            return c;\n    }\n};\nexport const getRoot = (node) => {\n    if (node.parent)\n        return getRoot(node.parent);\n    return node;\n};\n/**\n * Returns _true_ if `prospectiveParent` is any ancestor\n * parent of `child`.\n *\n * Use {@link hasParent} to only check immediate parent.\n * @param child\n * @param prospectiveParent\n * @returns\n */\nexport const hasAnyParent = (child, prospectiveParent) => {\n    for (const p of parents(child)) {\n        if (p === prospectiveParent)\n            return true;\n    }\n    return false;\n};\n/**\n * Yields the node value of each parent of `child`.\n * _undefined_ values are not returned.\n *\n * Use {@link queryParentsValue} to search for a particular value\n * @param child\n * @returns\n */\nexport function* parentsValues(child) {\n    for (const p of parents(child)) {\n        if (typeof p.value !== `undefined`) {\n            yield p.value;\n        }\n    }\n    return false;\n}\n/**\n * Yields all parents of `child` that have a given value.\n * Use {@link findParentsValue} to find the first match only.\n * @param child\n * @param value\n * @param eq\n * @returns\n */\nexport function* queryParentsValue(child, value, eq = isEqualDefault) {\n    for (const p of parents(child)) {\n        if (typeof p.value !== `undefined`) {\n            if (eq(p.value, value))\n                yield p;\n        }\n    }\n    return false;\n}\n/**\n * Returns the first parent that has a given value.\n * @param child\n * @param value\n * @param eq\n * @returns\n */\nexport function findParentsValue(child, value, eq = isEqualDefault) {\n    for (const p of queryParentsValue(child, value, eq)) {\n        return p;\n    }\n}\n/**\n * Returns _true_ if `prospectiveParent` is the immediate\n * parent of `child`.\n *\n * Use {@link hasAnyParent} to check for any ancestor parent.\n * @param child\n * @param prospectiveParent\n * @returns\n */\nexport const hasParent = (child, prospectiveParent) => {\n    return child.parent === prospectiveParent;\n};\n/**\n * Computes the maximum depth of the tree.\n * That is, how many steps down from `node` it can go.\n * If a tree is: root -> childA -> subChildB\n * ```js\n * // Yields 2, since there are at max two steps down from root\n * computeMaxDepth(root);\n * ```\n * @param node\n * @returns\n */\nexport const computeMaxDepth = (node) => {\n    return computeMaxDepthImpl(node, 0);\n};\nconst computeMaxDepthImpl = (node, startingDepth = 0) => {\n    let depth = startingDepth;\n    for (const c of node.childrenStore) {\n        depth = Math.max(depth, computeMaxDepthImpl(c, startingDepth + 1));\n    }\n    return depth;\n};\nexport const add = (child, parent) => {\n    throwAttemptedChild(child, parent);\n    //if (hasAnyChild(parent, child)) throw new Error(`Parent already contains child`);\n    //if (hasAnyParent(child, parent)) throw new Error(`Child already has parent`);\n    const p = child.parent;\n    parent.childrenStore = [...parent.childrenStore, child];\n    child.parent = parent;\n    if (p) {\n        p.childrenStore = without(p.childrenStore, child);\n    }\n};\nexport const addValue = (value, parent) => {\n    return createNode(value, parent);\n};\n/**\n * Creates the root for a tree, with an optional `value`.\n * Use {@link rootWrapped} if you want a more object-oriented mode of access.\n * @param value\n * @returns\n */\nexport const root = (value) => {\n    return createNode(value);\n};\nexport const fromPlainObject = (value, label = ``, parent, seen = []) => {\n    const entries = Object.entries(value);\n    parent = parent === undefined ? root() : addValue({ label, value }, parent);\n    for (const entry of entries) {\n        const value = entry[1];\n        // Avoid circular references\n        if (seen.includes(value))\n            continue;\n        seen.push(value);\n        if (typeof entry[1] === `object`) {\n            fromPlainObject(value, entry[0], parent, seen);\n        }\n        else {\n            addValue({ label: entry[0], value: value }, parent);\n        }\n    }\n    return parent;\n};\n/**\n * Creates a tree, returning it as a {@link WrappedNode} for object-oriented access.\n * Use {@link Trees.Mutable.root} alternatively.\n * @param value\n * @returns\n */\nexport const rootWrapped = (value) => {\n    return wrap(createNode(value));\n};\n/**\n * Creates a `TreeNode` instance with a given value and parent.\n * Parent node, if specified, has its `childrenStore` property changed to include new child.\n * @param value\n * @param parent\n * @returns\n */\nexport const createNode = (value, parent) => {\n    const n = {\n        childrenStore: [],\n        parent: parent,\n        value: value\n    };\n    if (parent !== undefined) {\n        parent.childrenStore = [...parent.childrenStore, n];\n    }\n    return n;\n};\nexport const childrenLength = (node) => {\n    return node.childrenStore.length;\n};\nexport const value = (node) => {\n    return node.value;\n};\n/**\n * Projects `node` as a dynamic traversable.\n * Dynamic in the sense that it creates the traversable project for nodes on demand.\n * A consequence is that node identities are not stable.\n * @param node\n * @returns\n */\nexport const asDynamicTraversable = (node) => {\n    const t = {\n        *children() {\n            for (const c of node.childrenStore) {\n                yield asDynamicTraversable(c);\n            }\n        },\n        getParent() {\n            if (node.parent === undefined)\n                return;\n            return asDynamicTraversable(node.parent);\n        },\n        getValue() {\n            return node.value;\n        },\n        getIdentity() {\n            return node;\n        },\n    };\n    return t;\n};\nconst throwAttemptedChild = (c, parent) => {\n    if (parent === c)\n        throw new Error(`Cannot add self as child`);\n    if (c.parent === parent)\n        return; // skip if it's already a child\n    if (hasAnyParent(parent, c))\n        throw new Error(`Child contains parent (1)`, { cause: c });\n    if (hasAnyParent(c, parent))\n        throw new Error(`Parent already contains child`, { cause: c });\n    if (hasAnyChild(parent, c))\n        throw new Error(`Child contains parent (2)`, { cause: c });\n};\nexport const setChildren = (parent, children) => {\n    // Verify children are legit\n    for (const c of children) {\n        throwAttemptedChild(c, parent);\n    }\n    parent.childrenStore = [...children];\n    for (const c of children) {\n        c.parent = parent;\n    }\n};\nexport const toStringDeep = (node, indent = 0) => {\n    const t = `${`  `.repeat(indent)} + ${node.value ? JSON.stringify(node.value) : `-`}`;\n    return node.childrenStore.length > 0 ? (t +\n        `\\n` +\n        node.childrenStore.map((d) => toStringDeep(d, indent + 1)).join(`\\n`)) : t;\n};\nexport function* followValue(root, continuePredicate, depth = 1) {\n    for (const c of root.childrenStore) {\n        const value = c.value;\n        if (value === undefined)\n            continue;\n        if (continuePredicate(value, depth)) {\n            yield c.value;\n            yield* followValue(c, continuePredicate, depth + 1);\n        }\n    }\n}\n// export function* followNode<T>(root: Node<T>, continuePredicate: (nodeValue: T | undefined, depth: number) => boolean, depth = 1): IterableIterator<Node<T>> {\n//   for (const c of root.childrenStore) {\n//     if (continuePredicate(c.value, depth)) {\n//       yield c;\n//       yield* followNode(c, continuePredicate, depth + 1);\n//     }\n//   }\n// }\n","import { toStringAbbreviate } from '@ixfx/core/text';\nimport { nullUndefTest, resultThrow } from '@ixfx/guards'; //'../../util/GuardEmpty.js';\nimport { last } from '@ixfx/iterables/sync';\nimport * as TreeArrayBacked from './tree-mutable.js';\nimport { isPrimitive } from '@ixfx/core'; //'../../util/IsPrimitive.js';\n/**\n * Helper function to get a 'friendly' string representation of an array of {@link TraverseObjectEntry}.\n * @param entries\n * @returns\n */\nexport function prettyPrintEntries(entries) {\n    if (entries.length === 0)\n        return `(empty)`;\n    let t = ``;\n    for (const [index, entry] of entries.entries()) {\n        t += `  `.repeat(index);\n        t += entry.name + ` = ` + JSON.stringify(entry.leafValue) + `\\n`;\n    }\n    return t;\n}\n/**\n * Returns a human-friendly debug string for a tree-like structure\n * ```js\n * console.log(Trees.prettyPrint(obj));\n * ```\n * @param indent\n * @param node\n * @param options\n * @returns\n */\nexport const prettyPrint = (node, indent = 0, options = {}) => {\n    resultThrow(nullUndefTest(node, `node`));\n    const defaultName = options.name ?? `node`;\n    const entry = getNamedEntry(node, defaultName);\n    const t = `${`  `.repeat(indent)} + name: ${entry.name} value: ${JSON.stringify(entry.leafValue)}`;\n    const childrenAsArray = [...children(node, options)];\n    return childrenAsArray.length > 0 ? (t +\n        `\\n` +\n        childrenAsArray.map((d) => prettyPrint(d.leafValue, indent + 1, { ...options, name: d.name })).join(`\\n`)) : t;\n};\n/**\n * Returns a debug string representation of the node (recursive)\n * @param node\n * @param indent\n * @returns\n */\nexport const toStringDeep = (node, indent = 0) => {\n    let t = ` `.repeat(indent) + ` ${node.value?.name}`;\n    if (node.value !== undefined) {\n        if (`sourceValue` in node.value && `leafValue` in node.value) {\n            let sourceValue = toStringAbbreviate(node.value.sourceValue, 20);\n            const leafValue = toStringAbbreviate(node.value.leafValue, 20);\n            sourceValue = sourceValue === leafValue ? `` : `source: ` + sourceValue;\n            t += ` = ${leafValue} ${sourceValue}`;\n        }\n        else if (`sourceValue` in node.value && node.value.sourceValue !== undefined)\n            t += ` = ${node.value.sourceValue}`;\n        if (`ancestors` in node.value) {\n            t += ` (ancestors: ${(node.value.ancestors).join(`, `)})`;\n        }\n    }\n    t += `\\n`;\n    for (const c of node.childrenStore) {\n        t += toStringDeep(c, indent + 1);\n    }\n    return t;\n};\n/**\n * Yields the direct (ie. non-recursive) children of a tree-like object as a pairing\n * of node name and value. Supports basic objects, Maps and arrays.\n *\n * To iterate recursively, consider {@link depthFirst}\n *\n * Each child is returned in an {@link TraverseObjectEntry} structure:\n * ```typescript\n * type Entry = Readonly<{\n *  // Property name\n *  name: string,\n *  // Value of property, as if you called `object[propertyName]`\n *  sourceValue: any,\n *  // Branch nodes will have _undefined_, leaf nodes will contain the value\n *  leafValue: any\n * }>;\n * ```\n *\n * For example, iterating over a flat object:\n * ```js\n * const verySimpleObject = { field: `hello`, flag: true }\n * const kids = [ ...children(verySimpleObject) ];\n * // Yields:\n * // [ { name: \"field\", sourceValue: `hello`, leafValue: `hello` },\n * //  { name: \"flag\", sourceValue: true, leafValue: true } ]\n * ```\n *\n * For objects containing objects:\n * ```js\n * const lessSimpleObject = { field: `hello`, flag: true, colour: { `red`, opacity: 0.5 } }\n * const kids = [ ...children(verySimpleObject) ];\n * // Yields as before, plus:\n * //  { name: \"colour\", sourceValue: { name: 'red', opacity: 0.5 }, leafValue: undefined }\n * ```\n *\n * Note that 'sourceValue' always contains the property value, as if you\n * access it via `object[propName]`. 'leafValue' only contains the value if it's a leaf\n * node.\n *\n * Arrays are assigned a name based on index.\n * @example Arrays\n * ```js\n * const colours = [ { r: 1, g: 0, b: 0 }, { r: 0, g: 1, b: 0 }, { r: 0, g: 0, b: 1 } ];\n * // Children:\n * // [\n * //  { name: \"array[0]\", value: {r:1,g:0,b:0} },\n * //  { name: \"array[1]\", value: {r:0,g:1,b:0} },\n * //  { name: \"array[2]\", value: {r:0,g:0,b:1} },\n * // ]\n * ```\n *\n * Pass in `options.name` (eg 'colours') to have names generated as 'colours[0]', etc.\n * Options can also be used to filter children. By default all direct children are returned.\n * @param node\n * @param options\n */\nexport function* children(node, options = {}) {\n    resultThrow(nullUndefTest(node, `node`));\n    const filteringOption = options.filter ?? `none`;\n    const filterByValue = (v) => {\n        if (filteringOption === `none`)\n            return [true, isPrimitive(v)];\n        else if (filteringOption === `leaves` && isPrimitive(v))\n            return [true, true];\n        else if (filteringOption === `branches` && !isPrimitive(v))\n            return [true, false];\n        return [false, isPrimitive(v)];\n    };\n    if (Array.isArray(node)) {\n        //if (options.name === undefined) defaultName = `array`;\n        for (const [index, element] of node.entries()) {\n            const f = filterByValue(element);\n            if (f[0]) {\n                yield { name: index.toString(), _kind: `entry`, sourceValue: element, leafValue: f[1] ? element : undefined };\n                //yield { name: defaultName + `[` + index.toString() + `]`, sourceValue: element, leafValue: f[ 1 ] ? element : undefined };\n            }\n        }\n    }\n    else if (typeof node === `object`) {\n        const entriesIter = (`entries` in node) ? node.entries() : Object.entries(node);\n        for (const [name, value] of entriesIter) {\n            //console.log(`children name: ${ name } type: ${ typeof value } isPrim: ${ isPrimitive(value) } filter: ${ filter }`);\n            const [filter, isPrimitive] = filterByValue(value);\n            if (filter) {\n                yield { name: name, _kind: `entry`, sourceValue: value, leafValue: isPrimitive ? value : undefined };\n            }\n        }\n    }\n}\nexport function* depthFirst(node, options = {}, ancestors = []) {\n    for (const c of children(node, options)) {\n        //onsole.log(`depthFirst name: ${ c.name } leafValue: ${ toStringAbbreviate(c.leafValue) }`)\n        yield { ...c, ancestors: [...ancestors], _kind: `entry-ancestors` };\n        yield* depthFirst(c.sourceValue, options, [...ancestors, c.name]);\n    }\n}\n/**\n * Finds a given direct child by name\n * @param name\n * @param node\n * @returns\n */\nfunction childByName(name, node) {\n    for (const d of children(node)) {\n        if (d.name === name)\n            return d;\n    }\n}\n/**\n * Returns the closest matching entry, tracing `path` in an array, Map or simple object.\n * Returns an entry with _undefined_ value at the point where tracing stopped.\n * Use {@link traceByPath} to step through all the segments.\n *\n * ```js\n  * const people = {\n    *  jane: {\n *   address: {\n *    postcode: 1000,\n    *    street: 'West St',\n    *    city: 'Blahville'\n *   },\n * colour: 'red'\n  *  }\n * }\n * Trees.getByPath('jane.address.postcode', people); // '.' default separator\n * // ['postcode', 1000]\n * Trees.getByPath('jane.address.country.state', people);\n * // ['country', undefined] - since full path could not be resolved.\n * ```\n * @param path Path, eg `jane.address.postcode`\n * @param node Node to look within\n * @param options Options for parsing path. By default '.' is used as a separator\n * @returns\n */\nexport function getByPath(path, node, options = {}) {\n    //  Unit tested\n    const v = last(traceByPath(path, node, options));\n    if (!v)\n        throw new Error(`Could not trace path: ${path} `);\n    return v;\n}\n/**\n * Enumerates over children of `node` towards the node named in `path`.\n * This is useful if you want to get the interim steps to the target node.\n *\n * Use {@link getByPath} if you don't care about interim steps.\n *\n * ```js\n  * const people = {\n    *  jane: {\n *   address: {\n *    postcode: 1000,\n    *    street: 'West St',\n    *    city: 'Blahville'\n *   },\n * colour: 'red'\n  *  }\n * }\n * for (const p of Trees.traceByPath('jane.address.street', people)) {\n * // { name: \"jane\", value: { address: { postcode: 1000,street: 'West St', city: 'Blahville' }, colour: 'red'} },\n * // { name: \"address\", value: { postcode: 1000, street: 'West St', city: 'Blahville' } },\n * // { name: \"street\", value: \"West St\" } }\n * }\n * ```\n *\n * Results stop when the path can't be followed any further.\n * The last entry will have a name of the last sought path segment, and _undefined_ as its value.\n *\n * @param path Path to traverse\n * @param node Starting node\n * @param options Options for path traversal logic\n * @returns\n */\nexport function* traceByPath(path, node, options = {}) {\n    resultThrow(nullUndefTest(path, `path`), nullUndefTest(node, `node`));\n    const separator = options.separator ?? `.`;\n    // const allowArrayIndexes = opts.allowArrayIndexes ?? true;\n    const pathSplit = path.split(separator);\n    const ancestors = [];\n    for (const p of pathSplit) {\n        const entry = childByName(p, node);\n        //onsole.log(`traceByPath: entry: ${ entry?.name } path: '${ path }' p: '${ p }' source: ${ JSON.stringify(entry?.sourceValue) }`);\n        // if (allowArrayIndexes) {\n        //   const [ withoutBrackets, arrayIndexString ] = betweenChomp(p, `[`, `]`);\n        //   //onsole.log(`  withoutBrackets: ${ withoutBrackets } str: ${ arrayIndexString } without: ${ withoutBrackets }`);\n        //   const arrayIndex = integerParse(arrayIndexString, `positive`, -1);\n        //   if (arrayIndex >= 0) {\n        //     // Get array by name without the []\n        //     entry = childByName(withoutBrackets, node);\n        //     //onsole.log(`  entry: ${ entry?.name }`);\n        //     if (entry && Array.isArray(entry.sourceValue)) {\n        //       // Result was array as expected\n        //       entry = { name: p, sourceValue: entry.sourceValue[ arrayIndex ], leafValue: entry.sourceValue[ arrayIndex ] };\n        //     }\n        //   }\n        // }\n        if (!entry) {\n            yield { name: p, sourceValue: undefined, leafValue: undefined, ancestors, _kind: `entry-ancestors` };\n            return;\n        }\n        node = entry.sourceValue;\n        yield { ...entry, ancestors: [...ancestors], _kind: `entry-ancestors` };\n        ancestors.push(p);\n    }\n}\n/**\n * Returns a projection of `node` as a dynamic traversable.\n * This means that the tree structure is dynamically created as last-minute as possible.\n *\n * The type when calling `getValue()` is {@link TraverseObjectEntryStatic}:\n * ```typescript\n * type EntryStatic = Readonly<{\n *  name: string,\n *  value: any\n *  ancestors: string[]\n * }>\n * ```\n *\n * Note that the object identity of TraversableTree return results is not stable.\n * This is because they are created on-the-fly by reading fields of `node`.\n *\n * ```js\n * const c1 = [ ...asDynamicTraversable(someObject).children() ];\n * const c2 = [ ...asDynamicTraversable(someObject).children() ];\n *\n * // Object identity is not the same\n * c1[ 0 ] === c1[ 0 ]; // false\n *\n * // ...even though its referring to the same value\n * c1[ 0 ].getValue() === c1[ 0 ].getValue(); // true\n * ```\n *\n * Instead .getIdentity() to get a stable identity:\n * ```js\n * c1[ 0 ].getIdentity() === c2[ 0 ].getIdentity(); // true\n * ```\n *\n * @example\n * ```js\n * import { Trees } from \"https://unpkg.com/@ixfx/collections/bundle\"\n * const myObj = { name: `Pedro`, size: 45, colour: `orange` };\n * const root = Trees.FromObject.asDynamicTraversable(myObj);\n * for (const v of Trees.Traverse.breadthFirst(root)) {\n * // v.getValue() yields:\n * // { name: 'name', sourceValue: 'Pedro' ...},\n * // { name: 'size', sourceValue: 45 ... }\n * // ...\n * }\n * ```\n * @param node Object to read\n * @param options Options when creating traversable\n * @param ancestors Do not use\n * @param parent Do not use\n * @returns\n */\nexport const asDynamicTraversable = (node, options = {}, ancestors = [], parent) => {\n    const name = options.name ?? `object`;\n    const t = {\n        *children() {\n            for (const { name: childName, sourceValue, leafValue } of children(node, options)) {\n                yield asDynamicTraversable(sourceValue, { ...options, name: childName }, [...ancestors, name], t);\n            }\n        },\n        getParent() {\n            return parent;\n        },\n        getValue() {\n            return { name, sourceValue: node, ancestors, _kind: `entry-static` };\n        },\n        getIdentity() {\n            return node;\n        }\n    };\n    return t;\n};\n/**\n * Reads all fields and sub-fields of `node`, returning as a 'wrapped' tree structure.\n * @param node\n * @param options\n * @returns\n */\nexport const createWrapped = (node, options) => {\n    return TreeArrayBacked.wrap(create(node, options));\n};\n/**\n * Reads all fields and sub-fields of `node`, returning as a basic tree structure.\n * The structure is a snapshot of the object. If the object changes afterwards, the tree will\n * remain the same.\n *\n * Alternatively, consider {@link asDynamicTraversable} which reads the object dynamically.\n * @example\n * ```js\n * import { Trees } from \"https://unpkg.com/@ixfx/collections/bundle\"\n * const myObj = { name: `Pedro`, size: 45, colour: `orange` };\n * const root = Trees.FromObject.create(myObj);\n * for (const v of Trees.Traverse.breadthFirst(root)) {\n * // v.getValue() yields:\n * // { name: 'name', sourceValue: 'Pedro' ...},\n * // { name: 'size', sourceValue: 45 ... }\n * // ...\n * }\n * ```\n * @param node\n * @param options\n * @returns\n */\nexport const create = (node, options = {}) => {\n    const valuesAtLeaves = options.valuesAtLeaves ?? false;\n    const valueFor = valuesAtLeaves ? (v) => { if (isPrimitive(v))\n        return v; } : (v) => v;\n    return createImpl(node, valueFor(node), options, []);\n};\nconst createImpl = (sourceValue, leafValue, options = {}, ancestors) => {\n    const defaultName = options.name ?? `object_ci`;\n    //onsole.log(`createImpl name: ${ defaultName } leafValue: ${ JSON.stringify(leafValue) }`);\n    const r = TreeArrayBacked.root({ name: defaultName, sourceValue: leafValue, ancestors: [...ancestors], _kind: `entry-static` });\n    ancestors = [...ancestors, defaultName];\n    for (const c of children(sourceValue, options)) {\n        const v = options.valuesAtLeaves ? c.leafValue : c.sourceValue;\n        TreeArrayBacked.add(createImpl(c.sourceValue, v, { ...options, name: c.name }, ancestors), r);\n    }\n    return r;\n};\n/**\n * Returns a copy of `node` with its (and all its children's) parent information removed.\n * @param node\n * @param options\n * @returns\n */\nexport const createSimplified = (node, options = {}) => {\n    return TreeArrayBacked.stripParentage(create(node, options));\n};\n/**\n * Generates a name for a node.\n * Uses the 'name' property if it exists, otherwise uses `defaultName`\n * @param node\n * @param defaultName\n * @returns\n */\nfunction getNamedEntry(node, defaultName = ``) {\n    if (`name` in node && `leafValue` in node && `sourceValue` in node)\n        return {\n            name: node.name,\n            _kind: `entry`,\n            leafValue: node.leafValue,\n            sourceValue: node.sourceValue\n        };\n    if (`name` in node) {\n        return { name: node.name, leafValue: node, sourceValue: node, _kind: `entry` };\n    }\n    return { name: defaultName, leafValue: node, sourceValue: node, _kind: `entry` };\n}\n// /**\n//  * Depth-first traversal over object, array, Map or TreeNode\n//  * @param root\n//  * @returns\n//  */\n// export function* depthFirst(root: object): IterableIterator<Entry> {\n//   if (!root) return;\n//   const stack = new StackMutable<Entry>();\n//   //eslint-disable-next-line functional/immutable-data\n//   stack.push(getEntry(root, `root`));\n//   //eslint-disable-next-line functional/no-let,functional/immutable-data\n//   let entry = stack.pop();\n//   while (entry) {\n//     yield entry;\n//     if (entry) {\n//       //eslint-disable-next-line functional/immutable-data\n//       stack.push(...directChildren(entry.value, entry.name));\n//     }\n//     if (stack.isEmpty) break;\n//     //eslint-disable-next-line functional/immutable-data\n//     entry = stack.pop();\n//   }\n// }\n// /**\n//  * Breadth-first traversal over object, array, Map or TreeNode\n//  * @param root\n//  * @returns\n//  */\n// export function* breadthFirst(root: object): IterableIterator<Entry> {\n//   if (!root) return;\n//   const queue = new QueueMutable<Entry>();\n//   queue.enqueue(getEntry(root, `root`));\n//   //eslint-disable-next-line functional/no-let\n//   let entry = queue.dequeue();\n//   while (entry) {\n//     yield entry;\n//     if (entry) {\n//       queue.enqueue(...directChildren(entry.value, entry.name));\n//     }\n//     if (queue.isEmpty) break;\n//     entry = queue.dequeue();\n//   }\n// }\n// export const fromUnknown = (node: object, name: string, parents: Array<TreeNode<any>> = []): TreeNode<any> => {\n//   const parentsWithUs = [ ...parents ];\n//   const enumerator = Array.isArray(node) ? enumerateArrayChildren : enumerateObjectChildren;\n//   const thisNode: TreeNode<any> = {\n//     getLengthChildren() {\n//       return [ ...enumerator(node, parentsWithUs, name) ].length\n//     },\n//     *children() {\n//       for (const c of enumerator(node, parentsWithUs, name)) {\n//         yield c;\n//       }\n//     },\n//     parents() {\n//       return parents.values()\n//     },\n//     name: name,\n//     value: node\n//   }\n//   parentsWithUs.push(thisNode);\n//   return thisNode;\n// }\n// function* enumerateObjectChildren(node: object, name: string): IterableIterator<Entry> {\n//   if (`entries` in node) {\n//     for (const entry of (node as any as Map<any, any>)) {\n//       yield fromUnknown(entry[ 1 ], entry[ 0 ], parents);\n//     }\n//   } else {\n//     for (const entry of Object.entries(node)) {\n//       yield fromUnknown(entry[ 1 ], entry[ 0 ], parents);\n//     }\n//   }\n// }\n// function* enumerateArrayChildren(node: object, parents: Array<TreeNode<any>>, name: string): IterableIterator<TreeNode<any>> {\n//   const nodeArray = node as Array<any>;\n//   // eslint-disable-next-line unicorn/no-for-loop\n//   for (let index = 0; index < nodeArray.length; index++) {\n//     yield fromUnknown(nodeArray[ index ], name + `[ ` + index.toString() + ` ]`, parents);\n//   }\n// }\n","import * as TreeArrayBacked from \"./tree-mutable.js\";\n/**\n * Creates a wrapper for working with 'pathed' trees.\n * An example is a filesystem.\n *\n * ```js\n * const t = create();\n * // Store a value. Path implies a structure of\n * //   c -> users -> admin\n * // ...which is autoatically created\n * t.add({x:10}, `c.users.admin`);\n *\n * t.add({x:20}, `c.users.guest`);\n * // Tree will now be:\n * // c-> users -> admin\n * //            -> guest\n *\n * t.getValue(`c.users.guest`); // { x:20 }\n * ```\n *\n * By default only a single value can be stored at a path.\n * Set options to allow this:\n * ```js\n * const t = create({ duplicates: `allow` });\n * t.add({x:10}, `c.users.admin`);\n * t.add({x:20}, `c.users.admin`);\n * t.getValue(`c.users.admin`);   // Throws an error because there are multiple values\n * t.getValues(`c.users.admin`);  // [ {x:10}, {x:20 } ]\n * ```\n * @param pathOpts\n * @returns\n */\nexport const create = (pathOpts = {}) => {\n    let root;\n    const add = (value, path) => {\n        const n = addValueByPath(value, path, root, pathOpts);\n        if (root === undefined) {\n            root = TreeArrayBacked.getRoot(n);\n        }\n    };\n    const prettyPrint = () => {\n        if (root === undefined)\n            return `(empty)`;\n        return TreeArrayBacked.toStringDeep(root);\n    };\n    const getValue = (path) => {\n        if (root === undefined)\n            return;\n        return valueByPath(path, root, pathOpts);\n    };\n    const remove = (path) => {\n        if (root === undefined)\n            return false;\n        return removeByPath(path, root, pathOpts);\n    };\n    const hasPath = (path) => {\n        if (root === undefined)\n            return false;\n        const c = findChildByPath(path, root, pathOpts);\n        return c !== undefined;\n    };\n    const getNode = (path) => {\n        if (root === undefined)\n            return;\n        const c = findChildByPath(path, root, pathOpts);\n        return c;\n    };\n    const childrenLength = (path) => {\n        if (root === undefined)\n            return 0;\n        const c = findChildByPath(path, root, pathOpts);\n        if (c === undefined)\n            return 0;\n        return c.childrenStore.length;\n    };\n    const getValues = (path) => {\n        if (root === undefined)\n            return [];\n        return valuesByPath(path, root, pathOpts);\n    };\n    const getRoot = () => {\n        return root;\n    };\n    const clearValues = (path) => {\n        if (root === undefined)\n            return false;\n        return clearValuesByPath(path, root, pathOpts);\n    };\n    return { getRoot, add, prettyPrint, remove, getValue, getValues, hasPath, childrenLength, getNode, clearValues };\n};\n/**\n * Adds a value by a string path, with '.' as a the default delimiter\n * Automatically generates intermediate nodes.\n *\n * ```js\n * const root = addValueByPath({}, 'c');\n * addValueByPath({x:'blah'}, 'c.users.admin', root);\n * ```\n *\n * Creates the structure:\n * ```\n * c          value: { }            label: c\n * + users    value: undefined      label: users\n *  + admin   value: { x: 'blah' }  label: admin\n * ```\n *\n * By default, multiple values under same key are overwritten, with the most recent winning.\n * @param value\n * @param path\n * @param pathOpts\n */\nexport const addValueByPath = (value, path, node, pathOpts = {}) => {\n    const separator = pathOpts.separator ?? `.`;\n    const duplicatePath = pathOpts.duplicates ?? `overwrite`;\n    const split = path.split(separator);\n    let count = 0;\n    for (const p of split) {\n        const lastEntry = count === split.length - 1;\n        //onsole.log(`p: ${ p }`);\n        const found = findChildByLabel(p, node);\n        if (found === undefined) {\n            //onsole.log(`  - not found`);\n            const labelled = {\n                value: (lastEntry ? value : undefined),\n                label: p\n            };\n            node = TreeArrayBacked.createNode(labelled, node);\n        }\n        else {\n            node = found;\n            if (lastEntry) {\n                switch (duplicatePath) {\n                    case `ignore`: {\n                        break;\n                    }\n                    case `allow`: {\n                        const existing = getValuesFromNode(node);\n                        node.value = {\n                            values: [...existing, value],\n                            label: p\n                        };\n                        break;\n                    }\n                    case `overwrite`: {\n                        node.value = {\n                            value,\n                            label: p\n                        };\n                        break;\n                    }\n                }\n            }\n            else {\n                //onsole.log(`  - found!`, found.value);\n                node = found;\n            }\n        }\n        count++;\n    }\n    if (node === undefined)\n        throw new Error(`Could not create tree`);\n    return node;\n};\nexport const removeByPath = (path, root, pathOpts = {}) => {\n    if (root === undefined)\n        return false;\n    const c = findChildByPath(path, root, pathOpts);\n    if (c === undefined)\n        return false;\n    TreeArrayBacked.remove(c);\n    return true;\n};\nexport const clearValuesByPath = (path, root, pathOpts = {}) => {\n    if (root === undefined)\n        return false;\n    const c = findChildByPath(path, root, pathOpts);\n    if (c === undefined)\n        return false;\n    c.value = {\n        label: c.value?.label ?? ``,\n        value: undefined\n    };\n    return true;\n};\nexport const childrenLengthByPath = (path, node, pathOpts = {}) => {\n    if (node === undefined)\n        return 0;\n    const c = findChildByPath(path, node, pathOpts);\n    if (c === undefined)\n        return 0;\n    return c.childrenStore.length;\n};\n/**\n * Searches direct children, returning the node that has the given `label`\n * @param label\n * @returns\n */\nconst findChildByLabel = (label, node) => {\n    if (node === undefined)\n        return undefined;\n    if (label === undefined)\n        throw new Error(`Parameter 'label' cannot be undefined`);\n    if (node.value?.label === label)\n        return node;\n    for (const c of node.childrenStore) {\n        if (c.value?.label === label)\n            return c;\n    }\n};\nexport const valueByPath = (path, node, pathOpts = {}) => {\n    const values = valuesByPath(path, node, pathOpts);\n    if (values.length === 0)\n        return undefined;\n    if (values.length > 1)\n        throw new Error(`Multiple values at path. Use getValues instead`);\n    return values[0];\n};\nconst getValuesFromNode = (c) => {\n    if (c.value === undefined)\n        return [];\n    if (`values` in c.value)\n        return c.value.values;\n    if (`value` in c.value) {\n        if (c.value.value === undefined)\n            return [];\n        return [c.value.value];\n    }\n    return [];\n};\nconst findChildByPath = (path, node, pathOpts = {}) => {\n    const separator = pathOpts.separator ?? `.`;\n    const split = path.split(separator);\n    let c = node;\n    for (const p of split) {\n        c = findChildByLabel(p, c);\n        if (c === undefined) {\n            return;\n        }\n    }\n    return c;\n};\nexport const valuesByPath = (path, node, pathOpts = {}) => {\n    const separator = pathOpts.separator ?? `.`;\n    const split = path.split(separator);\n    let c = node;\n    for (const p of split) {\n        //onsole.log(`getValue p: ${ p }`);\n        c = findChildByLabel(p, c);\n        if (c === undefined) {\n            //onsole.log(`getValue  - could not find. node: ${ JSON.stringify(node.value) }`);\n            return [];\n        }\n    }\n    return getValuesFromNode(c);\n};\n","import { toStringAbbreviate } from \"@ixfx/core/text\";\nimport { isEqualDefault } from \"@ixfx/core\"; //\"../../util/IsEqual.js\";\nimport { QueueMutable } from \"../queue/queue-mutable.js\";\nimport { StackMutable } from \"../stack/StackMutable.js\";\nimport { isTraversable } from \"./index.js\";\nexport const childrenLength = (tree) => {\n    return [...tree.children()].length;\n};\n/**\n * Returns _true_ if `child` is parented at any level (grand-parented etc) by `possibleParent`\n * @param child Child being sought\n * @param possibleParent Possible parent of child\n * @param eq Equality comparison function {@link isEqualDefault} used by default\n * @returns\n */\nexport const hasAnyParent = (child, possibleParent, eq) => {\n    return hasParent(child, possibleParent, eq, Number.MAX_SAFE_INTEGER);\n};\nexport const hasAnyParentValue = (child, possibleParentValue, eq) => {\n    if (typeof child === `undefined`)\n        throw new TypeError(`Param 'child' is undefined`);\n    return hasParentValue(child, possibleParentValue, eq, Number.MAX_SAFE_INTEGER);\n};\nexport const findAnyParentByValue = (child, possibleParentValue, eq) => {\n    return findParentByValue(child, possibleParentValue, eq, Number.MAX_SAFE_INTEGER);\n};\n/**\n * Returns _true_ if `child` exists within `possibleParent`. By default it only looks at the immediate\n * parent (maxDepth: 0). Use Number.MAX_SAFE_INTEGER for searching recursively upwards (or {@link hasAnyParent})\n * @param child Child being sought\n * @param possibleParent Possible parent of child\n * @param maxDepth Max depth of traversal. Default of 0 only looks for immediate parent.\n * @param eq Equality comparison function. {@link isEqualDefault} used by default.\n * @returns\n */\nexport const hasParent = (child, possibleParent, eq = (isEqualDefault), maxDepth = 0) => {\n    if (maxDepth < 0)\n        return false;\n    const isChildTrav = isTraversable(child);\n    const isParentTrav = isTraversable(possibleParent);\n    const p = (isChildTrav ? child.getParent() : child.parent);\n    if (typeof p === `undefined`)\n        return false;\n    if (eq(p, possibleParent))\n        return true;\n    const pId = isChildTrav ? p.getIdentity() : p.value;\n    const ppId = isParentTrav ? (possibleParent).getIdentity() : possibleParent.value;\n    // eslint-disable-next-line @typescript-eslint/no-unsafe-argument\n    if (eq(pId, ppId))\n        return true;\n    //if (eq(p.getIdentity(), possibleParent.getIdentity())) return true;\n    return hasParent(p, possibleParent, eq, maxDepth - 1);\n};\n/**\n * Checks if a child node has a parent with a certain value\n * Note: by default only checks immediate parent. Set maxDepth to a large value to recurse\n *\n * Uses `getValue()` on the parent if that function exists.\n * @param child Node to start looking from\n * @param possibleParentValue Value to seek\n * @param eq Equality checker\n * @param maxDepth Defaults to 0, so it only checks immediate parent\n * @returns\n */\nexport const hasParentValue = (child, possibleParentValue, eq = (isEqualDefault), maxDepth = 0) => {\n    if (child === undefined)\n        throw new Error(`Param 'child' is undefined`);\n    if (maxDepth < 0) {\n        return false;\n    }\n    const p = `getParent` in child ? child.getParent() : child.parent;\n    if (p === undefined) {\n        return false;\n    }\n    const value = `getValue` in p ? p.getValue() : p.value;\n    if (eq(value, possibleParentValue))\n        return true;\n    return hasParentValue(p, possibleParentValue, eq, maxDepth - 1);\n};\nexport const findParentByValue = (child, possibleParentValue, eq = (isEqualDefault), maxDepth = 0) => {\n    if (maxDepth < 0)\n        return;\n    const p = (`getParent` in child ? child.getParent() : child.parent);\n    if (p === undefined)\n        return;\n    const value = `getValue` in p ? p.getValue() : p.value;\n    if (eq(value, possibleParentValue))\n        return p;\n    return findParentByValue(p, possibleParentValue, eq, maxDepth - 1);\n};\n/**\n * Returns _true_ if `prospectiveChild` can be legally added to `parent`.\n * _False_ is returned if:\n *  * `parent` and `prospectiveChild` are equal\n *  * `parent` already contains `prospectiveChild`\n *  * `prospectiveChild` has `parent` as its own child\n *\n * Throws an error if `parent` or `prospectiveChild` is null/undefined.\n * @param parent Parent to add to\n * @param prospectiveChild Prospective child\n * @param eq Equality function\n */\nexport const couldAddChild = (parent, prospectiveChild, eq = isEqualDefault) => {\n    if (eq(parent, prospectiveChild))\n        throw new Error(`Child equals parent`);\n    if (hasAnyChild(parent, prospectiveChild, eq)) {\n        throw new Error(`Circular. Parent already has child`);\n    }\n    if (hasAnyChild(prospectiveChild, parent, eq)) {\n        throw new Error(`Prospective child has parent as child relation`);\n    }\n};\n/**\n * Returns _true_ if _possibleChild_ is contained within _parent_ tree.\n * That is, it is any sub-child.\n * @param parent Parent tree\n * @param possibleChild Sought child\n * @param eq Equality function, or {@link isEqualDefault} if undefined.\n * @returns\n */\nexport const hasAnyChild = (parent, possibleChild, eq = isEqualDefault) => {\n    return hasChild(parent, possibleChild, eq, Number.MAX_SAFE_INTEGER);\n};\nexport const hasAnyChildValue = (parent, possibleChildValue, eq = isEqualDefault) => {\n    return hasChildValue(parent, possibleChildValue, eq, Number.MAX_SAFE_INTEGER);\n};\n/**\n * Returns _true_ if _possibleChild_ is contained within _maxDepth_ children\n * of _parent_ node. By default only looks at immediate children (maxDepth = 0).\n *\n * ```js\n * // Just check parentNode for childNode\n * Trees.hasChild(parentNode, childNode);\n * // See if parentNode or parentNode's parents have childNode\n * Trees.hasChild(parentNode, childNode, 1);\n * // Use custom equality function, in this case comparing on name field\n * Trees.hasChild(parentNode, childNode, 0, (a, b) => a.name === b.name);\n * ```\n * @param parent Parent tree\n * @param possibleChild Sought child\n * @param maxDepth Maximum depth. 0 for immediate children, Number.MAX_SAFE_INTEGER for boundless\n * @param eq Equality function, or {@link isEqualDefault} if undefined.\n * @returns\n */\nexport const hasChild = (parent, possibleChild, eq = isEqualDefault, maxDepth = 0) => {\n    if (maxDepth < 0)\n        return false;\n    if (eq(parent, possibleChild))\n        return true;\n    const pId = `getIdentity` in parent ? parent.getIdentity() : parent.value;\n    const pcId = `getIdentity` in possibleChild ? possibleChild.getIdentity() : possibleChild.value;\n    if (eq(pId, pcId))\n        return true;\n    for (const c of breadthFirst(parent, maxDepth)) {\n        const cId = `getIdentity` in c ? c.getIdentity() : c.value;\n        if (eq(c, possibleChild))\n            return true;\n        if (eq(cId, pcId))\n            return true;\n    }\n    return false;\n};\nexport const hasChildValue = (parent, possibleValue, eq = isEqualDefault, maxDepth = 0) => {\n    if (maxDepth < 0)\n        return false;\n    if (eq(parent.getValue(), possibleValue))\n        return true;\n    for (const c of breadthFirst(parent, maxDepth)) {\n        const v = c.getValue();\n        if (eq(v, possibleValue))\n            return true;\n    }\n    return false;\n};\n/**\n * Iterates over siblings of `node`.\n *\n * Other iteration options:\n * * {@link breadthFirst}: Children, breadth-first\n * * {@link depthFirst}: Children, depth-first\n * * {@link parents}: Chain of parents, starting with immediate parent\n * * {@link siblings}: Nodes with same parent\n * @param node Node to begin from\n * @returns\n */\nexport function* siblings(node) {\n    const p = node.getParent();\n    if (p === undefined)\n        return;\n    for (const s of p.children()) {\n        if (s === node)\n            continue;\n        yield s;\n    }\n}\n// export function parents<T>(node: TreeNode<T>): IterableIterator<TreeNode<T>>;\n// export function parents<T>(node: TraversableTree<T>): IterableIterator<TraversableTree<T>>;\n/**\n * Iterates over parents of `node`, starting with immediate parent\n *\n * Other iteration options:\n * * {@link breadthFirst}: Children, breadth-first\n * * {@link depthFirst}: Children, depth-first\n * * {@link parents}: Chain of parents, starting with immediate parent\n * * {@link siblings}: Nodes with same parent\n * @param node Node to begin from\n * @returns\n */\nexport function* parents(node) {\n    if (isTraversable(node)) {\n        let p = node.getParent();\n        while (p !== undefined) {\n            yield p;\n            p = p.getParent();\n        }\n    }\n    else {\n        let p = node.parent;\n        while (p !== undefined) {\n            yield p;\n            p = p.parent;\n        }\n    }\n}\n// export function findAnyChildByValue<TValue>(parent: TraversableTree<TValue>,\n//   possibleValue: TValue,\n//   eq?: IsEqual<TValue>\n// ): TraversableTree<TValue> | undefined;\n// export function findAnyChildByValue<TValue>(parent: TreeNode<TValue>,\n//   possibleValue: TValue,\n//   eq?: IsEqual<TValue>\n// ): TreeNode<TValue> | undefined;\n/**\n * Descends `parent`, breadth-first, looking for a particular value.\n * Returns _undefined_ if not found.\n * @param parent\n * @param possibleValue\n * @param eq\n * @returns\n */\nexport function findAnyChildByValue(parent, possibleValue, eq = isEqualDefault) {\n    return findChildByValue(parent, possibleValue, eq, Number.MAX_SAFE_INTEGER);\n}\n;\n// export function findChildByValue<T extends TraversableTree<TV> | TreeNode<TV>, TV>(parent: T,\n//   possibleValue: TV,\n//   eq?: IsEqual<TV>,\n//   maxDepth?: number\n// ): TraversableTree<TV> | undefined;\n// export function findChildByValue<TValue>(parent: TreeNode<TValue>,\n//   possibleValue: TValue,\n//   eq?: IsEqual<TValue>,\n//   maxDepth?: number\n// ): TreeNode<TValue> | undefined;\n/**\n * Searches breadth-first for `possibleValue` under and including `parent`.\n * `maxDepth` sets he maximum level to which the tree is searched.\n * @param parent\n * @param possibleValue\n * @param eq\n * @param maxDepth\n * @returns\n */\nexport function findChildByValue(parent, possibleValue, eq = isEqualDefault, maxDepth = 0) {\n    if (maxDepth < 0)\n        return;\n    const isTraver = isTraversable(parent);\n    if (isTraver) {\n        if (eq(parent.getValue(), possibleValue))\n            return parent;\n    }\n    else {\n        if (eq(parent.value, possibleValue))\n            return parent;\n    }\n    for (const d of breadthFirst(parent, maxDepth)) {\n        // This child matches\n        if (isTraver) {\n            if (eq(d.getValue(), possibleValue))\n                return d;\n        }\n        else {\n            if (eq(d.value, possibleValue))\n                return d;\n        }\n    }\n    return;\n}\n;\n/**\n * Iterates over children of `root`, depth-first.\n *\n * Other iteration options:\n * * {@link breadthFirst}: Children, breadth-first\n * * {@link depthFirst}: Children, depth-first\n * * {@link parents}: Chain of parents, starting with immediate parent\n * * {@link siblings}: Nodes with same parent\n * @param root Root node\n * @returns\n */\nexport function* depthFirst(root) {\n    if (!root)\n        return;\n    const stack = new StackMutable();\n    let entry = root;\n    while (entry) {\n        const entries = isTraversable(entry) ?\n            [...entry.children()] :\n            [...entry.childrenStore];\n        stack.push(...entries);\n        if (stack.isEmpty)\n            break;\n        entry = stack.pop();\n        if (entry)\n            yield entry;\n    }\n}\n//export function breadthFirst<T>(root: TraversableTree<T>, depth?: number): IterableIterator<TraversableTree<T>>;\n//export function breadthFirst<T>(root: TreeNode<T>, depth?: number): IterableIterator<TreeNode<T>>;\n/**\n * Iterates over the children of `root`, breadth-first\n *\n * Other iteration options:\n * * {@link breadthFirst}: Children, breadth-first\n * * {@link depthFirst}: Children, depth-first\n * * {@link parents}: Chain of parents, starting with immediate parent\n * * {@link siblings}: Nodes with same parent\n *\n * @example Traversing over a simple object\n * ```js\n * import { Trees } from \"https://unpkg.com/@ixfx/collections/bundle\"\n * const myObj = { name: `Pedro`, size: 45, colour: `orange` };\n * const root = Trees.FromObject.asDynamicTraversable(myObj);\n * for (const v of Trees.Traverse.breadthFirst(root)) {\n * // v.getValue() yields:\n * // { name: 'name', sourceValue: 'Pedro' ...},\n * // { name: 'size', sourceValue: 45 ... }\n * // ...\n * }\n * ```\n * @param root Root node\n * @param depth How many levels to traverse\n * @returns\n */\nexport function* breadthFirst(root, depth = Number.MAX_SAFE_INTEGER) {\n    if (!root)\n        return;\n    const isTrav = isTraversable(root);\n    const queue = isTrav ? new QueueMutable() : new QueueMutable();\n    let entry = root;\n    while (entry) {\n        if (depth < 0)\n            return;\n        if (entry !== undefined) {\n            const kids = `childrenStore` in entry ? entry.childrenStore : entry.children();\n            for (const c of kids) {\n                yield c;\n                queue.enqueue(c);\n            }\n        }\n        entry = queue.dequeue();\n        depth--;\n    }\n}\n/**\n * Applies `predicate` to `root` and all its child nodes, returning the node where\n * `predicate` yields _true_.\n * Use {@link findByValue} to find a node by its value\n * @param root\n * @param predicate\n * @param order Iterate children by breadth or depth. Default 'breadth'\n * @returns\n */\nexport function find(root, predicate, order = `breadth`) {\n    if (predicate(root))\n        return root;\n    const iter = order === `breadth` ? breadthFirst : depthFirst;\n    for (const c of iter(root)) {\n        if (predicate(c))\n            return c;\n    }\n}\n/**\n * Applies `predicate` to `root` and all its child nodes, returning the node value for\n * `predicate` yields _true_.\n * Use {@link find} to filter by nodes rather than values\n *\n * ```js\n * const n = findByValue(root, (v) => v.name === 'Bob');\n * ```\n * @param root\n * @param predicate\n * @param order Iterate children by breadth or depth. Default 'breadth'\n * @returns\n */\nexport function findByValue(root, predicate, order = `breadth`) {\n    if (predicate(root.getValue()))\n        return root;\n    const iter = order === `breadth` ? breadthFirst : depthFirst;\n    for (const c of iter(root)) {\n        if (predicate(c.getValue()))\n            return c;\n    }\n}\n/**\n * Search through children in a path-like manner.\n *\n * It finds the first child of `root` that matches `continuePredicate`.\n * The function gets passed a depth of 1 to begin with. It recurses, looking for the next sub-child, etc.\n *\n * If it can't find a child, it stops.\n *\n * This is different to 'find' functions, which exhaustively search all possible child nodes, regardless of position in tree.\n *\n * ```js\n * const path = 'a.aa.aaa'.split('.');\n * const pred = (nodeValue, depth) => {\n *  if (nodeValue === path[0]) {\n *    path.shift(); // Remove first element\n *    return true;\n *  }\n *  return false;\n * }\n *\n * // Assuming we have a tree of string values:\n * // a\n * //   - aa\n * //       - aaa\n * //   - ab\n * // b\n * //   - ba\n * for (const c of follow(tree, pred)) {\n *  // Returns nodes: a, aa and then aaa\n * }\n * ```\n * @param root\n * @param continuePredicate\n * @param depth\n */\nexport function* followValue(root, continuePredicate, depth = 1) {\n    for (const c of root.children()) {\n        if (continuePredicate(c.getValue(), depth)) {\n            yield c.getValue();\n            yield* followValue(c, continuePredicate, depth + 1);\n        }\n    }\n}\nexport function toStringDeep(node, depth = 0) {\n    if (node === undefined)\n        return `(undefined)`;\n    if (node === null)\n        return `(null)`;\n    const v = node.getValue();\n    let type = typeof v;\n    if (Array.isArray(v))\n        type = `array`;\n    let t = `  `.repeat(depth) + `value: ${JSON.stringify(v)} (${type})\\n`;\n    for (const n of node.children()) {\n        t += toStringDeep(n, depth + 1);\n    }\n    return t;\n}\nexport function toString(...nodes) {\n    let t = ``;\n    for (const node of nodes) {\n        const v = node.getValue();\n        const vString = toStringAbbreviate(v);\n        const children = [...node.children()];\n        const parent = node.getParent();\n        let type = typeof v;\n        if (Array.isArray(v))\n            type = `array`;\n        t += `value: ${vString} (${type}) kids: ${children.length} parented: ${parent ? `y` : `n`}\\n`;\n    }\n    return t;\n}\n","import { asDynamicTraversable as ObjectToTraversable } from './traverse-object.js';\nimport { asDynamicTraversable as TreeNodeToTraversable } from './tree-mutable.js';\nexport * as Mutable from './tree-mutable.js';\nexport * as Pathed from './pathed.js';\nexport * as FromObject from './traverse-object.js';\nexport * as Traverse from './traversable-tree.js';\nexport * from './compare.js';\n/**\n * Makes a 'traversable' to move around a {@link TreeNode}, an existing {@link TraversableTree} or a plain object.\n *\n * @param node\n * @returns\n */\nexport const toTraversable = (node) => {\n    if (isTraversable(node))\n        return node;\n    if (isTreeNode(node))\n        return TreeNodeToTraversable(node);\n    if (typeof node === `object`)\n        return ObjectToTraversable(node);\n    throw new Error(`Parameter 'node' not convertible`);\n};\n/**\n * Checks whether `node` is of type {@link TreeNode}.\n *\n * Checks for: parent, childrenStore and value defined on `node`.\n * @param node\n * @returns\n */\nexport const isTreeNode = (node) => {\n    if (`parent` in node && `childrenStore` in node && `value` in node) {\n        if (Array.isArray(node.childrenStore))\n            return true;\n    }\n    return false;\n};\n/**\n * Checks if `node` is of type {@link TraversableTree}.\n *\n * Checks by looking for: children, getParent, getValue and getIdentity defined on `node`.\n * @param node\n * @returns\n */\nexport const isTraversable = (node) => {\n    return (`children` in node && `getParent` in node && `getValue` in node && `getIdentity` in node);\n};\n","import { push, pop, isEmpty, isFull, peek } from './StackFns.js';\nexport class StackImmutable {\n    opts;\n    /* eslint-disable-next-line functional/prefer-readonly-type */\n    data;\n    constructor(opts = {}, data = []) {\n        this.opts = opts;\n        this.data = data;\n    }\n    push(...toAdd) {\n        return new StackImmutable(this.opts, push(this.opts, this.data, ...toAdd));\n    }\n    pop() {\n        return new StackImmutable(this.opts, pop(this.opts, this.data));\n    }\n    forEach(fn) {\n        this.data.forEach(fn);\n    }\n    forEachFromTop(fn) {\n        [...this.data].reverse().forEach(fn);\n    }\n    get isEmpty() {\n        return isEmpty(this.opts, this.data);\n    }\n    get isFull() {\n        return isFull(this.opts, this.data);\n    }\n    get peek() {\n        return peek(this.opts, this.data);\n    }\n    get length() {\n        return this.data.length;\n    }\n}\n/**\n * Returns a stack. Immutable. Use {@link Stacks.mutable} for a mutable alternative.\n *\n * The basic usage is `push`/`pop` to add/remove, returning the modified stack. Use the\n * property `peek` to see what's on top.\n *\n * @example Basic usage\n * ```js\n * // Create\n * let s = stack();\n * // Add one or more items\n * s = s.push(1, 2, 3, 4);\n * // See what's at the top of the stack\n * s.peek;      // 4\n *\n * // Remove from the top of the stack, returning\n * // a new stack without item\n * s = s.pop();\n * s.peek;        // 3\n * ```\n * @param options Options\n * @param startingItems List of items to add to stack. Items will be pushed 'left to right', ie array index 0 will be bottom of the stack.\n */\nexport const immutable = (options = {}, ...startingItems) => new StackImmutable({ ...options }, [...startingItems]);\n","export * from './IStack.js';\nexport * from './IStackMutable.js';\nexport * from './IStackImmutable.js';\nexport * from './StackImmutable.js';\nexport * from './StackMutable.js';\nexport * from './StackFns.js';\n","//  UNIT TESTED\nimport { defaultKeyer } from '@ixfx/core';\nimport { SimpleEventEmitter } from '@ixfx/events'; //'../../Events.js';\nimport {} from './ISetMutable.js';\nimport {} from './Types.js';\n/**\n * Creates a {@link ISetMutable}.\n * @param keyString Function that produces a key based on a value. If unspecified, uses `JSON.stringify`\n * @returns\n */\nexport const mutable = (keyString) => new SetStringMutable(keyString);\n/**\n * Mutable string set\n */\nexport class SetStringMutable extends SimpleEventEmitter {\n    //  UNIT TESTED\n    /* eslint-disable functional/prefer-readonly-type */\n    store = new Map();\n    keyString;\n    /**\n     * Constructor\n     * @param keyString Function which returns a string version of added items. If unspecified `JSON.stringify`\n     */\n    constructor(keyString) {\n        super();\n        this.keyString = keyString ?? (defaultKeyer);\n    }\n    /**\n     * Number of items stored in set\n     */\n    get size() {\n        return this.store.size;\n    }\n    /**\n     * Adds one or more items to set. `add` event is fired for each item\n     * @param values items to add\n     */\n    add(...values) {\n        //eslint-disable-next-line functional/no-let\n        let somethingAdded = false;\n        for (const value of values) {\n            const isUpdated = this.has(value);\n            this.store.set(this.keyString(value), value);\n            super.fireEvent(`add`, { value: value, updated: isUpdated });\n            if (!isUpdated)\n                somethingAdded = true;\n        }\n        return somethingAdded;\n    }\n    /**\n     * Returns values from set as an iterable\n     * @returns\n     */\n    //eslint-disable-next-line functional/prefer-tacit\n    values() {\n        return this.store.values();\n    }\n    /**\n     * Clear items from set\n     */\n    clear() {\n        this.store.clear();\n        super.fireEvent(`clear`, true);\n    }\n    /**\n     * Delete value from set.\n     * @param v Value to delete\n    * @returns _True_ if item was found and removed\n     */\n    delete(v) {\n        const isDeleted = this.store.delete(this.keyString(v));\n        if (isDeleted)\n            super.fireEvent(`delete`, v);\n        return isDeleted;\n    }\n    /**\n     * Returns _true_ if item exists in set\n     * @param v\n     * @returns\n     */\n    has(v) {\n        return this.store.has(this.keyString(v));\n    }\n    /**\n     * Returns array copy of set\n     * @returns Array copy of set\n     */\n    toArray() {\n        return [...this.store.values()];\n    }\n}\n","import { defaultKeyer, toStringDefault } from '@ixfx/core';\nimport {} from './ISetImmutable.js';\nexport class SetStringImmutable {\n    store;\n    keyString;\n    //eslint-disable-next-line functional/prefer-immutable-types\n    constructor(keyString, map) {\n        this.store = map ?? new Map();\n        this.keyString = keyString ?? (defaultKeyer);\n    }\n    get size() {\n        return this.store.size;\n    }\n    add(...values) {\n        const s = new Map(this.store);\n        for (const v of values) {\n            const key = this.keyString(v);\n            s.set(key, v);\n        }\n        return new SetStringImmutable(this.keyString, s);\n    }\n    delete(v) {\n        const s = new Map(this.store);\n        const key = this.keyString(v);\n        if (s.delete(key))\n            return new SetStringImmutable(this.keyString, s);\n        return this;\n    }\n    has(v) {\n        const key = this.keyString(v);\n        return this.store.has(key);\n    }\n    toArray() {\n        return [...this.store.values()];\n    }\n    *values() {\n        yield* this.store.values();\n    }\n}\n/**\n * Immutable set that uses a `keyString` function to determine uniqueness\n *\n * @param keyString Function that produces a key based on a value. If unspecified, uses `JSON.stringify`.\n * @returns\n */\nexport const immutable = (keyString = toStringDefault) => new SetStringImmutable(keyString);\n","/**\n * MassiveSet supports semantics similar to Set, but without the\n * limitation on how much data is stored.\n *\n * It only supports strings, and stores data in a hierarchy.\n *\n * ```js\n * const set = new MassiveSet(); // maxDepth=1 default\n * set.add(`test`);\n * set.add(`bloorp`);\n * ```\n *\n * In the above example, it will create a subtree for the first letter\n * of each key, putting the value underneath it. So we'd get a sub\n * MassiveSet for every key starting with 't' and every one starting with 'b'.\n *\n * If `maxDepth` was 2, we'd get the same two top-level nodes, but then\n * another sub-node based on the _second_ character of the value.\n *\n * It's not a very smart data-structure since it does no self-balancing\n * or tuning.\n */\nexport class MassiveSet {\n    #depth;\n    #maxDepth;\n    children = new Map();\n    values = [];\n    constructor(maxDepth = 1, depth = 0) {\n        this.#depth = depth;\n        this.#maxDepth = maxDepth;\n    }\n    /**\n     * Returns the number of values stored in just this level of the set\n     * @returns\n     */\n    sizeLocal() {\n        return this.values.length;\n    }\n    /**\n     * Returns the number of branches at this node\n     * Use {@link sizeChildrenDeep} to count all branches recursively\n     * @returns\n     */\n    sizeChildren() {\n        return [...this.children.values()].length;\n    }\n    sizeChildrenDeep() {\n        let t = this.sizeChildren();\n        for (const c of this.children.values()) {\n            t += c.sizeChildrenDeep();\n        }\n        return t;\n    }\n    /**\n     * Returns the total number of values stored in the set\n     */\n    size() {\n        let x = this.values.length;\n        for (const set of this.children.values()) {\n            x += set.size();\n        }\n        return x;\n    }\n    add(value) {\n        if (typeof value !== `string`)\n            throw new Error(`Param 'value' must be a string. Got: ${typeof value}`);\n        if (value.length === 0)\n            throw new Error(`Param 'value' is empty`);\n        const destination = this.#getChild(value, true);\n        if (destination === this) {\n            if (!this.hasLocal(value)) {\n                this.values.push(value);\n            }\n            return;\n        }\n        if (!destination)\n            throw new Error(`Could not create child set for: ${value}`);\n        destination.add(value);\n    }\n    remove(value) {\n        if (typeof value !== `string`)\n            throw new Error(`Param 'value' must be a string. Got: ${typeof value}`);\n        if (value.length === 0)\n            throw new Error(`Param 'value' is empty`);\n        const destination = this.#getChild(value, false);\n        if (destination === undefined)\n            return false;\n        if (destination === this) {\n            if (this.hasLocal(value)) {\n                this.values = this.values.filter(v => v !== value);\n                return true;\n            }\n            return false; // Not found\n        }\n        return destination.remove(value);\n    }\n    debugDump() {\n        const r = this.#dumpToArray();\n        for (const rr of r) {\n            console.log(rr);\n        }\n    }\n    #dumpToArray(depth = 0) {\n        const r = [];\n        r.push(`Depth: ${this.#depth} Max: ${this.#maxDepth}`);\n        for (const [key, value] of this.children.entries()) {\n            const dumped = value.#dumpToArray(depth + 1);\n            r.push(` key: ${key}`);\n            for (const d of dumped) {\n                r.push(` `.repeat(depth + 1) + d);\n            }\n        }\n        r.push(`Values: (${this.values.length})`);\n        for (const v of this.values) {\n            r.push(` ${v}`);\n        }\n        return r.map(line => ` `.repeat(depth) + line);\n    }\n    #getChild(value, create) {\n        if (value === undefined)\n            throw new Error(`Param 'value' undefined`);\n        if (this.#depth === this.#maxDepth)\n            return this;\n        if (value.length <= this.#depth)\n            return this;\n        const k = value[this.#depth];\n        if (k === undefined)\n            throw new Error(`Logic error. Depth: ${this.#depth} Len: ${value.length}`);\n        let child = this.children.get(k);\n        if (child === undefined && create) {\n            child = new MassiveSet(this.#maxDepth, this.#depth + 1);\n            this.children.set(k, child);\n        }\n        return child;\n    }\n    /**\n     * Returns _true_ if `value` stored on this node\n     * @param value\n     * @returns\n     */\n    hasLocal(value) {\n        for (const v of this.values) {\n            if (v === value)\n                return true;\n        }\n        return false;\n    }\n    has(value) {\n        if (typeof value !== `string`)\n            return false;\n        const destination = this.#getChild(value, false);\n        if (destination === undefined)\n            return false;\n        if (destination === this)\n            return this.hasLocal(value);\n        return destination.has(value);\n    }\n}\n","export * from './set-mutable.js';\nexport * from './SetImmutable.js';\nexport {} from './ISetMutable.js';\nexport {} from './ISetImmutable.js';\nexport * from './massive-set.js';\n","import { numberTest, resultThrow } from \"@ixfx/guards\";\nimport { isEqualDefault } from \"@ixfx/core\";\nimport { max as IterablesMax, min as IterablesMin, last as IterablesLast } from \"@ixfx/iterables\";\nimport { QueueMutable } from \"./queue-mutable.js\";\n/**\n * Simple priority queue implementation.\n * Higher numbers mean higher priority.\n *\n * ```js\n * const pm = new PriorityMutable();\n *\n * // Add items with a priority (higher numeric value = higher value)\n * pm.enqueueWithPriority(`hello`, 4);\n * pm.enqueueWithPriotity(`there`, 1);\n *\n * ```\n */\nexport class PriorityMutable extends QueueMutable {\n    constructor(opts = {}) {\n        if (opts.eq === undefined) {\n            opts = {\n                ...opts,\n                eq: (a, b) => {\n                    return isEqualDefault(a.item, b.item);\n                }\n            };\n        }\n        super(opts);\n    }\n    /**\n     * Adds an item with a given priority\n     * @param item Item\n     * @param priority Priority (higher numeric value means higher priority)\n     */\n    enqueueWithPriority(item, priority) {\n        resultThrow(numberTest(priority, `positive`));\n        super.enqueue({ item, priority });\n    }\n    changePriority(item, priority, addIfMissing = false, eq) {\n        if (item === undefined)\n            throw new Error(`Item cannot be undefined`);\n        let toDelete;\n        for (const d of this.data) {\n            if (eq) {\n                if (eq(d.item, item)) {\n                    toDelete = d;\n                    break;\n                }\n            }\n            else {\n                if (this.eq(d, { item, priority: 0 })) {\n                    toDelete = d;\n                    break;\n                }\n            }\n        }\n        if (toDelete === undefined && !addIfMissing)\n            throw new Error(`Item not found in priority queue. Item: ${JSON.stringify(item)}`);\n        if (toDelete !== undefined) {\n            this.removeWhere(item => toDelete === item);\n        }\n        this.enqueueWithPriority(item, priority);\n    }\n    dequeueMax() {\n        //const m = IterablesLast(IterablesMax(this.data, v => v.priority));\n        const m = IterablesLast(IterablesMax(this.data, (a, b) => a.priority >= b.priority));\n        if (m === undefined)\n            return;\n        this.removeWhere(item => item === m);\n        return m.item;\n    }\n    dequeueMin() {\n        const m = IterablesLast(IterablesMax(this.data, (a, b) => a.priority >= b.priority));\n        //const m = IterablesLast(IterablesMin(this.data, (a,b) => a.priority >= b.priority));\n        if (m === undefined)\n            return;\n        this.removeWhere(item => item.item === m);\n        return m.item;\n    }\n    peekMax() {\n        const m = IterablesLast(IterablesMax(this.data, (a, b) => a.priority >= b.priority));\n        //const m = IterablesLast(IterablesMax(this.data, v => v.priority));\n        if (m === undefined)\n            return;\n        return m.item;\n    }\n    peekMin() {\n        //const m = IterablesLast<V>(IterablesMin(this.data, (a,b) => a.priority >= b.priority));\n        const m = IterablesLast(IterablesMin(this.data, (a, b) => a.priority >= b.priority));\n        if (m === undefined)\n            return;\n        return m.item;\n    }\n}\n/**\n * Creates a {@link PriorityMutable} queue.\n *\n * Options:\n * * eq: Equality function\n * * capacity: limit on number of items\n * * discardPolicy: what to do if capacity is reached\n * @param opts\n * @returns\n */\nexport function priority(opts = {}) {\n    return new PriorityMutable(opts);\n}\n","import { peek, isFull, isEmpty, enqueue, dequeue } from './queue-fns.js';\nimport {} from './queue-types.js';\n// -------------------------------\n// Immutable\n// -------------------------------\nexport class QueueImmutable {\n    opts;\n    #data;\n    /**\n     * Creates an instance of Queue.\n     * @param {QueueOpts} opts Options foor queue\n     * @param {V[]} data Initial data. Index 0 is front of queue\n     */\n    constructor(opts = {}, data = []) {\n        if (opts === undefined)\n            throw new Error(`opts parameter undefined`);\n        this.opts = opts;\n        this.#data = data;\n    }\n    forEach(fn) {\n        //eslint-disable-next-line functional/no-let\n        for (let index = this.#data.length - 1; index >= 0; index--) {\n            fn(this.#data[index]);\n        }\n    }\n    forEachFromFront(fn) {\n        // From front of queue\n        this.#data.forEach(item => { fn(item); }); //(vv) => fn(vv));\n    }\n    enqueue(...toAdd) {\n        return new QueueImmutable(this.opts, enqueue(this.opts, this.#data, ...toAdd));\n    }\n    dequeue() {\n        return new QueueImmutable(this.opts, dequeue(this.opts, this.#data));\n    }\n    get isEmpty() {\n        return isEmpty(this.opts, this.#data);\n    }\n    get isFull() {\n        return isFull(this.opts, this.#data);\n    }\n    get length() {\n        return this.#data.length;\n    }\n    get peek() {\n        return peek(this.opts, this.#data);\n    }\n    toArray() {\n        return [...this.#data];\n    }\n}\n/**\n * Returns an immutable queue. Queues are useful if you want to treat 'older' or 'newer'\n * items differently. _Enqueing_ adds items at the back of the queue, while\n * _dequeing_ removes items from the front (ie. the oldest).\n *\n * ```js\n * let q = Queues.immutable();           // Create\n * q = q.enqueue(`a`, `b`);   // Add two strings\n * const front = q.peek();    // `a` is at the front of queue (oldest)\n * q = q.dequeue();           // q now just consists of `b`\n * ```\n * @example Cap size to 5 items, throwing away newest items already in queue.\n * ```js\n * const q = Queues.immutable({capacity: 5, discardPolicy: `newer`});\n * ```\n *\n * @typeParam V - Type of values stored\n * @param options\n * @param startingItems Index 0 is the front of the queue\n * @returns A new queue\n */\nexport const immutable = (options = {}, ...startingItems) => {\n    options = { ...options }; // Make a copy of options\n    return new QueueImmutable(options, [...startingItems]); // Make a copy of array so it can't be modified\n};\n","export * from './priority-mutable.js';\nexport { immutable, QueueImmutable } from './queue-immutable.js';\nexport { mutable, QueueMutable } from './queue-mutable.js';\n//export * from './Responsive.js';\nexport * from './queue-fns.js';\n","import { SimpleEventEmitter } from '@ixfx/events';\nimport { sortByValueProperty } from '@ixfx/core/maps';\nimport { intervalToMs } from '@ixfx/core';\nimport { integerTest, resultThrow } from '@ixfx/guards';\n/**\n * Create a ExpiringMap instance\n * @param options Options when creating map\n * @returns\n */\nexport const create = (options = {}) => new ExpiringMap(options);\n/***\n * A map that can have a capacity limit. The elapsed time for each get/set\n * operation is maintained allowing for items to be automatically removed.\n * `has()` does not affect the last access time.\n *\n * By default, it uses the `none` eviction policy, meaning that when full\n * an error will be thrown if attempting to add new keys.\n *\n * Eviction policies:\n * `oldestGet` removes the item that hasn't been accessed the longest,\n * `oldestSet` removes the item that hasn't been updated the longest.\n *\n * ```js\n * const map = new ExpiringMap();\n * map.set(`fruit`, `apple`);\n *\n * // Remove all entries that were set more than 100ms ago\n * map.deleteWithElapsed(100, `set`);\n * // Remove all entries that were last accessed more than 100ms ago\n * map.deleteWithElapsed(100, `get`);\n * // Returns the elapsed time since `fruit` was last accessed\n * map.elapsedGet(`fruit`);\n * // Returns the elapsed time since `fruit` was last set\n * map.elapsedSet(`fruit`);\n * ```\n *\n * Last set/get time for a key can be manually reset using {@link touch}.\n *\n *\n * Events:\n * * 'expired': when an item is automatically removed.\n * * 'removed': when an item is manually or automatically removed.\n * * 'newKey': when a new key is added\n *\n * ```js\n * map.addEventListener(`expired`, evt => {\n *  const { key, value } = evt;\n * });\n * ```\n * The map can automatically remove items based on elapsed intervals.\n *\n * @example\n * Automatically delete items that haven't been accessed for one second\n * ```js\n * const map = new ExpiringMap({\n *  autoDeleteElapsed: 1000,\n *  autoDeletePolicy: `get`\n * });\n * ```\n *\n * @example\n * Automatically delete the oldest item if we reach a capacity limit\n * ```js\n * const map = new ExpiringMap({\n *  capacity: 5,\n *  evictPolicy: `oldestSet`\n * });\n * ```\n * @typeParam K - Type of keys\n * @typeParam V - Type of values\n */\nexport class ExpiringMap extends SimpleEventEmitter {\n    capacity;\n    store;\n    //private keyCount: number;\n    evictPolicy;\n    autoDeleteElapsedMs;\n    autoDeletePolicy;\n    autoDeleteTimer;\n    disposed = false;\n    constructor(opts = {}) {\n        super();\n        this.capacity = opts.capacity ?? -1;\n        resultThrow(integerTest(this.capacity, `nonZero`, `capacity`));\n        this.store = new Map();\n        //this.keyCount = 0;\n        if (opts.evictPolicy && this.capacity <= 0) {\n            throw new Error(`evictPolicy is set, but no capacity limit is set`);\n        }\n        this.evictPolicy = opts.evictPolicy ?? `none`;\n        this.autoDeleteElapsedMs = opts.autoDeleteElapsedMs ?? -1;\n        this.autoDeletePolicy = opts.autoDeletePolicy ?? `none`;\n        if (this.autoDeleteElapsedMs > 0) {\n            this.autoDeleteTimer = setInterval(() => { this.#maintain(); }, Math.max(1000, this.autoDeleteElapsedMs * 2));\n        }\n    }\n    dispose() {\n        if (this.disposed)\n            return;\n        this.disposed = true;\n        if (this.autoDeleteTimer) {\n            clearInterval(this.autoDeleteTimer);\n            this.autoDeleteTimer = undefined;\n        }\n    }\n    /**\n     * Returns the number of keys being stored.\n     */\n    get keyLength() {\n        return this.store.size; // keyCount;\n    }\n    *entries() {\n        for (const entry of this.store.entries()) {\n            yield [entry[0], entry[1].value];\n        }\n    }\n    *values() {\n        for (const v of this.store.values()) {\n            yield v.value;\n        }\n    }\n    *keys() {\n        yield* this.store.keys();\n    }\n    /**\n     * Returns the elapsed time since `key`\n     * was set. Returns _undefined_ if `key`\n     * does not exist\n     */\n    elapsedSet(key) {\n        const v = this.store.get(key);\n        if (typeof v === `undefined`)\n            return;\n        return Date.now() - v.lastSet;\n    }\n    /**\n     * Returns the elapsed time since `key`\n     * was accessed. Returns _undefined_ if `key`\n     * does not exist\n     */\n    elapsedGet(key) {\n        const v = this.store.get(key);\n        if (typeof v === `undefined`)\n            return;\n        return Date.now() - v.lastGet;\n    }\n    /**\n     * Returns true if `key` is stored.\n     * Does not affect the key's last access time.\n     * @param key\n     * @returns\n     */\n    has(key) {\n        return this.store.has(key);\n    }\n    /**\n     * Gets an item from the map by key, returning\n     * undefined if not present\n     * @param key Key\n     * @returns Value, or undefined\n     */\n    get(key) {\n        const v = this.store.get(key);\n        if (v) {\n            if (this.autoDeletePolicy === `either` || this.autoDeletePolicy === `get`) {\n                this.store.set(key, {\n                    ...v,\n                    lastGet: performance.now(),\n                });\n            }\n            return v.value;\n        }\n    }\n    /**\n     * Deletes the value under `key`, if present.\n     *\n     * Returns _true_ if something was removed.\n     * @param key\n     * @returns\n     */\n    delete(key) {\n        const value = this.store.get(key);\n        if (!value)\n            return false;\n        const d = this.store.delete(key);\n        //this.keyCount = this.keyCount - 1;\n        this.fireEvent(`removed`, {\n            key,\n            value: value.value,\n        });\n        return d;\n    }\n    /**\n     * Clears the contents of the map.\n     * Note: does not fire `removed` event\n     */\n    clear() {\n        this.store.clear();\n    }\n    /**\n     * Updates the lastSet/lastGet time for a value\n     * under `k`.\n     *\n     * Returns false if key was not found\n     * @param key\n     * @returns\n     */\n    touch(key) {\n        const v = this.store.get(key);\n        if (!v)\n            return false;\n        this.store.set(key, {\n            ...v,\n            lastSet: Date.now(),\n            lastGet: Date.now(),\n        });\n        return true;\n    }\n    findEvicteeKey() {\n        if (this.evictPolicy === `none`)\n            return;\n        let sortBy = ``;\n        if (this.evictPolicy === `oldestGet`)\n            sortBy = `lastGet`;\n        else if (this.evictPolicy === `oldestSet`)\n            sortBy = `lastSet`;\n        else\n            throw new Error(`Unknown eviction policy ${this.evictPolicy}`);\n        const sorted = sortByValueProperty(this.store, sortBy);\n        return sorted[0][0];\n    }\n    #maintain() {\n        if (this.autoDeletePolicy === `none`)\n            return;\n        this.deleteWithElapsed(this.autoDeleteElapsedMs, this.autoDeletePolicy);\n    }\n    /**\n     * Deletes all values where elapsed time has past\n     * for get/set or either.\n     * ```js\n     * // Delete all keys (and associated values) not accessed for a minute\n     * em.deleteWithElapsed({mins:1}, `get`);\n     * // Delete things that were set 1s ago\n     * em.deleteWithElapsed(1000, `set`);\n     * ```\n     *\n     * @param interval Interval\n     * @param property Basis for deletion 'get','set' or 'either'\n     * @returns Items removed\n     */\n    deleteWithElapsed(interval, property) {\n        const entries = [...this.store.entries()];\n        const prune = [];\n        const intervalMs = intervalToMs(interval, 1000);\n        const now = performance.now();\n        for (const entry of entries) {\n            const elapsedGet = now - entry[1].lastGet;\n            const elapsedSet = now - entry[1].lastSet;\n            const elapsed = property === `get`\n                ? elapsedGet\n                : (property === `set`\n                    ? elapsedSet\n                    : Math.max(elapsedGet, elapsedSet));\n            if (elapsed >= intervalMs) {\n                prune.push([entry[0], entry[1].value]);\n            }\n        }\n        for (const entry of prune) {\n            this.store.delete(entry[0]);\n            //this.keyCount = this.keyCount - 1;\n            const eventArguments = {\n                key: entry[0],\n                value: entry[1],\n            };\n            this.fireEvent(`expired`, eventArguments);\n            this.fireEvent(`removed`, eventArguments);\n        }\n        return prune;\n    }\n    /**\n     * Sets the `key` to be `value`.\n     *\n     * If the key already exists, it is updated.\n     *\n     * If the map is full, according to its capacity,\n     * another value is selected for removal.\n     * @param key\n     * @param value\n     * @returns\n     */\n    set(key, value) {\n        const existing = this.store.get(key);\n        if (existing) {\n            // Update set time\n            this.store.set(key, {\n                ...existing,\n                lastSet: performance.now(),\n            });\n            return;\n        }\n        // New key\n        if (this.keyLength === this.capacity && this.capacity > 0) {\n            // Evict first\n            const key = this.findEvicteeKey();\n            if (!key) {\n                throw new Error(`ExpiringMap full (capacity: ${this.capacity})`);\n            }\n            const existing = this.store.get(key);\n            this.store.delete(key);\n            //this.keyCount = this.keyCount - 1;\n            if (existing) {\n                const eventArguments = { key, value: existing.value };\n                this.fireEvent(`expired`, eventArguments);\n                this.fireEvent(`removed`, eventArguments);\n            }\n        }\n        //this.keyCount++;\n        this.store.set(key, {\n            lastGet: 0,\n            lastSet: performance.now(),\n            value: value,\n        });\n        this.fireEvent(`newKey`, { key, value });\n    }\n}\n","//  UNIT TESTED\nimport { isEqualDefault } from '@ixfx/core';\n/**\n * Finds first entry by iterable value. Expects a map with an iterable as values.\n *\n * ```js\n * const map = new Map();\n * map.set('hello', ['a', 'b', 'c']);\n * map.set('there', ['d', 'e', 'f']);\n *\n * const entry = firstEntry(map, (value, key) => {\n *  return (value === 'e');\n * });\n * // Entry is: ['there', ['d', 'e', 'f']]\n * ```\n *\n * An alternative is {@link firstEntryByValue} to search by value.\n * @param map Map to search\n * @param predicate Filter function returns true when there is a match of value\n * @returns Entry, or _undefined_ if `filter` function never returns _true_\n */\nexport const firstEntry = (map, predicate) => {\n    for (const e of map.entries()) {\n        const value = e[1];\n        for (const subValue of value) {\n            if (predicate(subValue, e[0]))\n                return e;\n        }\n    }\n};\n/**\n * Returns the size of the largest key, or 0 if empty.\n */\nexport const lengthMax = (map) => {\n    //eslint-disable-next-line functional/no-let\n    let largest = ['', 0];\n    for (const e of map.keysAndCounts()) {\n        if (e[1] > largest[1]) {\n            largest = e;\n        }\n    }\n    return largest[1];\n};\n/**\n * Finds first entry by iterable value. Expects a map with an iterable as values.\n *\n * ```js\n * const map = new Map();\n * map.set('hello', ['a', 'b', 'c']);\n * map.set('there', ['d', 'e', 'f']);\n *\n * const entry = firstEntryByValue(map, 'e');\n * // Entry is: ['there', ['d', 'e', 'f']]\n * ```\n *\n * An alternative is {@link firstEntry} to search by predicate function.\n * @param map Map to search\n * @param value Value to seek\n * @param isEqual Filter function which checks equality. Uses JS comparer by default.\n * @returns Entry, or _undefined_ if `value` not found.\n */\nexport const firstEntryByValue = (map, value, isEqual = isEqualDefault) => {\n    for (const e of map.entries()) {\n        const value_ = e[1];\n        for (const subValue of value_) {\n            if (isEqual(subValue, value))\n                return e;\n        }\n    }\n};\n","import { defaultKeyer, isEqualDefault } from '@ixfx/core';\nimport { firstEntryByValue } from './map-multi-fns.js';\nexport class MapOfSimpleBase {\n    map;\n    groupBy;\n    valueEq;\n    /**\n     * Constructor\n     * @param groupBy Creates keys for values when using `addValue`. By default uses JSON.stringify\n     * @param valueEq Compare values. By default uses JS logic for equality\n     */\n    constructor(groupBy = defaultKeyer, valueEq = (isEqualDefault), initial = []) {\n        this.groupBy = groupBy;\n        this.valueEq = valueEq;\n        this.map = new Map(initial);\n    }\n    /**\n     * Returns _true_ if `key` exists\n     * @param key\n     * @returns\n     */\n    has(key) {\n        return this.map.has(key);\n    }\n    /**\n     * Returns _true_ if `value` exists under `key`.\n     * @param key Key\n     * @param value Value to seek under `key`\n     * @returns _True_ if `value` exists under `key`.\n     */\n    hasKeyValue(key, value) {\n        const values = this.map.get(key);\n        if (!values)\n            return false;\n        for (const v of values) {\n            if (this.valueEq(v, value))\n                return true;\n        }\n        return false;\n    }\n    /**\n     * Debug dump of contents\n     * @returns\n     */\n    debugString() {\n        let r = ``;\n        const keys = [...this.map.keys()];\n        keys.every((k) => {\n            const v = this.map.get(k);\n            if (v === undefined)\n                return;\n            r += k + ` (${v.length}) = ${JSON.stringify(v)}\\r\\n`;\n        });\n        return r;\n    }\n    /**\n     * Return number of values stored under `key`.\n     * Returns 0 if `key` is not found.\n     * @param key\n     * @returns\n     */\n    count(key) {\n        const values = this.map.get(key);\n        if (!values)\n            return 0;\n        return values.length;\n    }\n    /**\n   * Returns first key that contains `value`\n   * @param value\n   * @param eq\n   * @returns\n   */\n    firstKeyByValue(value, eq = isEqualDefault) {\n        const entry = firstEntryByValue(this, value, eq);\n        if (entry)\n            return entry[0];\n    }\n    /**\n     * Iterate over all entries\n     */\n    *entriesFlat() {\n        for (const key of this.map.keys()) {\n            for (const value of this.map.get(key)) {\n                yield [key, value];\n            }\n        }\n    }\n    /**\n     * Iterate over keys and array of values for that key\n     */\n    *entries() {\n        for (const [k, v] of this.map.entries()) {\n            yield [k, [...v]];\n        }\n    }\n    /**\n     * Get all values under `key`\n     * @param key\n     * @returns\n     */\n    *get(key) {\n        const m = this.map.get(key);\n        if (!m)\n            return;\n        yield* m.values();\n    }\n    /**\n     * Iterate over all keys\n     */\n    *keys() {\n        yield* this.map.keys();\n    }\n    /**\n     * Iterate over all values (regardless of key).\n     * Use {@link values} to iterate over a set of values per key\n     */\n    *valuesFlat() {\n        for (const entries of this.map) {\n            yield* entries[1];\n        }\n    }\n    /**\n     * Yields the values for each key in sequence, returning an array.\n     * Use {@link valuesFlat} to iterate over all keys regardless of key.\n     */\n    *values() {\n        for (const entries of this.map) {\n            yield entries[1];\n        }\n    }\n    /**\n     * Iterate over keys and length of values stored under keys\n     */\n    *keysAndCounts() {\n        for (const entries of this.map) {\n            yield [entries[0], entries[1].length];\n        }\n    }\n    /**\n     * Returns the count of keys.\n     */\n    get lengthKeys() {\n        return this.map.size;\n    }\n    /**\n    * _True_ if empty\n    */\n    get isEmpty() {\n        return this.map.size === 0;\n    }\n}\n","import { defaultKeyer, isEqualDefault } from '@ixfx/core';\nimport { MapOfSimpleBase } from './map-of-simple-base.js';\n/**\n * A simple mutable map of arrays, without events. It can store multiple values\n * under the same key.\n *\n * For a fancier approaches, consider ofArrayMutable, ofCircularMutable or ofSetMutable.\n *\n * @example\n * ```js\n * const m = mapOfSimpleMutable();\n * m.add(`hello`, 1, 2, 3); // Adds numbers under key `hello`\n * m.delete(`hello`);       // Deletes everything under `hello`\n *\n * const hellos = m.get(`hello`); // Get list of items under `hello`\n * ```\n *\n * Constructor takes a `groupBy` parameter, which yields a string key for a value. This is the\n * basis by which values are keyed when using `addValues`.\n *\n * Constructor takes a `valueEq` parameter, which compares values. This is used when checking\n * if a value exists under a key, for example.\n * @typeParam V - Type of items\n */\nexport class MapOfSimpleMutable extends MapOfSimpleBase {\n    addKeyedValues(key, ...values) {\n        const existing = this.map.get(key);\n        if (existing === undefined) {\n            this.map.set(key, values);\n        }\n        else {\n            this.map.set(key, [...existing, ...values]);\n        }\n    }\n    /**\n     * Set `values` to `key`.\n     * Previous data stored under `key` is thrown away.\n     * @param key\n     * @param values\n     */\n    setValues(key, values) {\n        this.map.set(key, values);\n    }\n    /**\n     * Adds a value, automatically extracting a key via the\n     * `groupBy` function assigned in the constructor options.\n     * @param values Adds several values\n     */\n    addValue(...values) {\n        for (const v of values) {\n            const key = this.groupBy(v);\n            this.addKeyedValues(key, v);\n        }\n    }\n    /**\n     * Delete `value` under a particular `key`\n     * @param key\n     * @param value\n     * @returns _True_ if `value` was found under `key`\n     */\n    deleteKeyValue(key, value) {\n        const existing = this.map.get(key);\n        if (existing === undefined)\n            return false;\n        const without = existing.filter((existingValue) => !this.valueEq(existingValue, value));\n        this.map.set(key, without);\n        return without.length < existing.length;\n    }\n    /**\n     * Deletes `value` regardless of key.\n     *\n     * Uses the constructor-defined equality function.\n     * @param value Value to delete\n     * @returns\n     */\n    deleteByValue(value) {\n        let del = false;\n        const entries = [...this.map.entries()];\n        for (const keyEntries of entries) {\n            for (const values of keyEntries[1]) {\n                if (this.valueEq(values, value)) {\n                    del = true;\n                    this.deleteKeyValue(keyEntries[0], value);\n                }\n            }\n        }\n        return del;\n    }\n    /**\n     * Deletes all values under `key`,\n     * @param key\n     * @returns _True_ if `key` was found and values stored\n     */\n    delete(key) {\n        const values = this.map.get(key);\n        if (!values)\n            return false;\n        if (values.length === 0)\n            return false;\n        this.map.delete(key);\n        return true;\n    }\n    /**\n     * Clear contents\n     */\n    clear() {\n        this.map.clear();\n    }\n}\n/**\n * A simple mutable map of arrays, without events. It can store multiple values\n * under the same key.\n *\n * For a fancier approaches, consider {@link ofArrayMutable}, {@link ofCircularMutable} or {@link ofSetMutable}.\n *\n * @example\n * ```js\n * const m = mapOfSimpleMutable();\n * m.add(`hello`, 1, 2, 3); // Adds numbers under key `hello`\n * m.delete(`hello`);       // Deletes everything under `hello`\n *\n * const hellos = m.get(`hello`); // Get list of items under `hello`\n * ```\n *\n * @typeParam V - Type of items\n * @returns New instance\n */\nexport const ofSimpleMutable = (groupBy = defaultKeyer, valueEq = (isEqualDefault)) => new MapOfSimpleMutable(groupBy, valueEq);\n","/**\n * Adds an array o [k,v] to the map, returning a new instance\n * @param map Initial data\n * @param data Data to add\n * @returns New map with data added\n */\nconst addArray = (map, data) => {\n    const x = new Map(map.entries());\n    for (const d of data) {\n        if (d[0] === undefined)\n            throw new Error(`key cannot be undefined`);\n        if (d[1] === undefined)\n            throw new Error(`value cannot be undefined`);\n        x.set(d[0], d[1]);\n    }\n    return x;\n};\n/**\n * Adds objects to the map, returning a new instance\n * @param map Initial data\n * @param data Data to add\n * @returns A new map with data added\n */\nconst addObjects = (map, data) => {\n    const x = new Map(map.entries());\n    for (const d of data) {\n        if (d.key === undefined)\n            throw new Error(`key cannot be undefined`);\n        if (d.value === undefined)\n            throw new Error(`value cannot be undefined`);\n        x.set(d.key, d.value);\n    }\n    return x;\n};\n/**\n * Returns true if map contains key\n *\n * @example\n * ```js\n * if (has(map, `London`)) ...\n * ```\n * @param map Map to search\n * @param key Key to find\n * @returns True if map contains key\n */\nexport const has = (map, key) => map.has(key);\n/**\n * Adds data to a map, returning the new map.\n *\n * Can add items in the form of [key,value] or {key, value}.\n * @example These all produce the same result\n * ```js\n * map.set(`hello`, `samantha`);\n * map.add([`hello`, `samantha`]);\n * map.add({key: `hello`, value: `samantha`})\n * ```\n * @param map Initial data\n * @param data One or more data to add in the form of [key,value] or {key, value}\n * @returns New map with data added\n */\nexport const add = (map, ...data) => {\n    if (map === undefined)\n        throw new Error(`map parameter is undefined`);\n    if (data === undefined)\n        throw new Error(`data parameter i.s undefined`);\n    if (data.length === 0)\n        return map;\n    const firstRecord = data[0];\n    const isObject = typeof firstRecord.key !==\n        `undefined` &&\n        typeof firstRecord.value !==\n            `undefined`; //(typeof (data[0] as {readonly key:K}).key !== undefined && typeof (data[0] as {readonly value:V}).value !== undefined);\n    return isObject\n        ? addObjects(map, data)\n        : addArray(map, data);\n};\n/**\n * Sets data in a copy of the initial map\n * @param map Initial map\n * @param key Key\n * @param value Value to  set\n * @returns New map with data set\n */\nexport const set = (map, key, value) => {\n    const x = new Map(map.entries());\n    x.set(key, value);\n    return x;\n};\n/**\n * Delete a key from the map, returning a new map\n * @param map Initial data\n * @param key\n * @returns New map with data deleted\n */\nexport const del = (map, key) => {\n    const x = new Map(map.entries());\n    x.delete(key);\n    return x;\n};\n","import {} from '../types.js';\nimport { add, del, set } from './map-immutable-fns.js';\n/**\n * Returns an {@link IMapImmutable}.\n * Use {@link Maps.mutable} as a mutable alternatve.\n *\n * @example Basic usage\n * ```js\n * // Creating\n * let m = map();\n * // Add\n * m = m.set(\"name\", \"sally\");\n * // Recall\n * m.get(\"name\");\n * ```\n *\n * @example Enumerating\n * ```js\n * for (const [key, value] of map.entries()) {\n *  console.log(`${key} = ${value}`);\n * }\n * ```\n *\n * @example Overview\n * ```js\n * // Create\n * let m = map();\n * // Add as array or key & value pair\n * m = m.add([\"name\" , \"sally\"]);\n * m = m.add({ key: \"name\", value: \"sally\" });\n * // Add using the more typical set\n * m = m.set(\"name\", \"sally\");\n * m.get(\"name\");   // \"sally\";\n * m.has(\"age\");    // false\n * m.has(\"name\");   // true\n * m.isEmpty;       // false\n * m = m.delete(\"name\");\n * m.entries();     // Iterator of key value pairs\n * ```\n *\n * Since it is immutable, `add()`, `delete()` and `clear()` return a new version with change.\n *\n * @param dataOrMap Optional initial data in the form of an array of `{ key: value }` or `[ key, value ]`\n */\nexport const immutable = (dataOrMap) => {\n    if (dataOrMap === undefined)\n        return immutable([]);\n    if (Array.isArray(dataOrMap))\n        return immutable(add(new Map(), ...dataOrMap));\n    const data = dataOrMap;\n    return {\n        add: (...itemsToAdd) => {\n            const s = add(data, ...itemsToAdd);\n            return immutable(s);\n        },\n        set: (key, value) => {\n            const s = set(data, key, value);\n            return immutable(s);\n        },\n        get: (key) => data.get(key),\n        delete: (key) => immutable(del(data, key)),\n        // eslint-disable-next-line @typescript-eslint/no-unused-vars\n        clear: () => immutable(),\n        has: (key) => data.has(key),\n        entries: () => data.entries(),\n        values: () => data.values(),\n        isEmpty: () => data.size === 0,\n    };\n};\n","import {} from '../types.js';\nimport { add, del, set, has } from './map-immutable-fns.js';\n/**\n * Returns a {@link IMapMutable} (which just wraps the in-built Map)\n * Use {@link Maps.immutable} for the immutable alternative.\n *\n * @example Basic usage\n * ```js\n * const m = mapMutable();\n * // Add one or more entries\n * m.add([\"name\", \"sally\"]);\n * // Alternatively:\n * m.set(\"name\", \"sally\");\n * // Recall\n * m.get(\"name\");           // \"sally\"\n * m.delete(\"name\");\n * m.isEmpty; // True\n * m.clear();\n * ```\n * @param data Optional initial data in the form of an array of `{ key: value }` or `[ key, value ]`\n */\nexport const mutable = (...data) => {\n    // eslint-disable-next-line functional/no-let\n    let m = add(new Map(), ...data);\n    return {\n        add: (...data) => {\n            m = add(m, ...data);\n        },\n        delete: (key) => {\n            m = del(m, key);\n        },\n        clear: () => {\n            m = add(new Map());\n        },\n        set: (key, value) => {\n            m = set(m, key, value);\n        },\n        get: (key) => m.get(key),\n        entries: () => m.entries(),\n        values: () => m.values(),\n        isEmpty: () => m.size === 0,\n        has: (key) => has(m, key),\n    };\n};\n","import { isEqualDefault } from '@ixfx/core';\nimport { SimpleEventEmitter } from '@ixfx/events';\nimport { toStringDefault } from '@ixfx/core';\n/**\n * @internal\n */\nexport class MapOfMutableImpl extends SimpleEventEmitter {\n    #map = new Map();\n    groupBy;\n    type;\n    constructor(type, opts = {}) {\n        super();\n        this.type = type;\n        this.groupBy = opts.groupBy ?? toStringDefault;\n    }\n    /**\n     * Returns the type name. For in-built implementations, it will be one of: array, set or circular\n     */\n    get typeName() {\n        return this.type.name;\n    }\n    /**\n     * Returns the number of keys\n     */\n    get lengthKeys() {\n        return this.#map.size;\n    }\n    /**\n     * Returns the length of the longest child list\n     */\n    get lengthMax() {\n        let m = 0;\n        for (const v of this.#map.values()) {\n            m = Math.max(m, this.type.count(v));\n        }\n        return m;\n    }\n    debugString() {\n        const keys = [...this.#map.keys()];\n        let r = `Keys: ${keys.join(`, `)}\\r\\n`;\n        for (const k of keys) {\n            const v = this.#map.get(k);\n            if (v === undefined) {\n                r += ` - ${k} (undefined)\\r\\n`;\n            }\n            else {\n                const asArray = this.type.toArray(v);\n                if (asArray !== undefined) {\n                    r += ` - ${k} (${this.type.count(v)}) = ${JSON.stringify(asArray)}\\r\\n`;\n                }\n            }\n        }\n        ;\n        return r;\n    }\n    get isEmpty() {\n        return this.#map.size === 0;\n    }\n    clear() {\n        this.#map.clear();\n        super.fireEvent(`clear`, true);\n    }\n    addKeyedValues(key, ...values) {\n        const set = this.#map.get(key);\n        if (set === undefined) {\n            this.#map.set(key, this.type.addKeyedValues(undefined, values));\n            super.fireEvent(`addedKey`, { key: key });\n            super.fireEvent(`addedValues`, { values: values });\n        }\n        else {\n            this.#map.set(key, this.type.addKeyedValues(set, values));\n            super.fireEvent(`addedValues`, { values: values });\n        }\n    }\n    set(key, values) {\n        this.addKeyedValues(key, ...values);\n        return this;\n    }\n    addValue(...values) {\n        for (const v of values)\n            this.addKeyedValues(this.groupBy(v), v);\n    }\n    hasKeyValue(key, value, eq) {\n        const m = this.#map.get(key);\n        if (m === undefined)\n            return false;\n        return this.type.has(m, value, eq);\n    }\n    has(key) {\n        return this.#map.has(key);\n    }\n    deleteKeyValue(key, value) {\n        const a = this.#map.get(key);\n        if (a === undefined)\n            return false;\n        return this.deleteKeyValueFromMap(a, key, value);\n    }\n    deleteKeyValueFromMap(map, key, value) {\n        const preCount = this.type.count(map);\n        const filtered = this.type.without(map, value);\n        const postCount = filtered.length;\n        this.#map.set(key, this.type.addKeyedValues(undefined, filtered));\n        return preCount > postCount;\n    }\n    deleteByValue(value) {\n        let something = false;\n        [...this.#map.keys()].filter((key) => {\n            const a = this.#map.get(key);\n            if (!a)\n                throw new Error(`Bug: map could not be accessed`);\n            if (this.deleteKeyValueFromMap(a, key, value)) {\n                something = true; // note that something was deleted\n                // If key is empty, delete it\n                if (this.count(key) === 0)\n                    this.delete(key);\n            }\n        });\n        return something;\n    }\n    delete(key) {\n        const a = this.#map.get(key);\n        if (a === undefined)\n            return false;\n        this.#map.delete(key);\n        this.fireEvent(`deleteKey`, { key: key });\n        return true;\n    }\n    firstKeyByValue(value, eq = isEqualDefault) {\n        const keys = [...this.#map.keys()];\n        const found = keys.find((key) => {\n            const a = this.#map.get(key);\n            if (a === undefined)\n                throw new Error(`Bug: map could not be accessed`);\n            const r = this.type.has(a, value, eq);\n            return r;\n        });\n        return found;\n    }\n    count(key) {\n        const entry = this.#map.get(key);\n        if (entry === undefined)\n            return 0;\n        return this.type.count(entry);\n    }\n    /**\n     * Iterates over values stored under `key`\n     * An empty array is returned if there are no values\n     */\n    *get(key) {\n        const m = this.#map.get(key);\n        if (m === undefined)\n            return;\n        yield* this.type.iterable(m);\n    }\n    /**\n     * Iterate over the values stored under `key`.\n     * If key does not exist, iteration is essentially a no-op\n     * @param key\n     * @returns\n     */\n    *valuesFor(key) {\n        const m = this.#map.get(key);\n        if (m === undefined)\n            return;\n        yield* this.type.iterable(m);\n    }\n    getSource(key) {\n        return this.#map.get(key);\n    }\n    *keys() {\n        yield* this.#map.keys();\n        //return Array.from(this.#map.keys());\n    }\n    *entriesFlat() {\n        for (const entry of this.#map.entries()) {\n            for (const v of this.type.iterable(entry[1])) {\n                yield [entry[0], v];\n            }\n        }\n    }\n    *valuesFlat() {\n        for (const entry of this.#map.entries()) {\n            yield* this.type.iterable(entry[1]);\n        }\n    }\n    *entries() {\n        for (const [k, v] of this.#map.entries()) {\n            const temporary = [...this.type.iterable(v)];\n            yield [k, temporary];\n        }\n    }\n    *keysAndCounts() {\n        for (const key of this.keys()) {\n            yield [key, this.count(key)];\n        }\n    }\n    merge(other) {\n        for (const key of other.keys()) {\n            const data = other.get(key);\n            this.addKeyedValues(key, ...data);\n        }\n    }\n    get size() {\n        return this.#map.size;\n    }\n    get [Symbol.toStringTag]() {\n        return this.#map[Symbol.toStringTag];\n    }\n}\n","import { toStringDefault } from '@ixfx/core';\nimport { without } from '@ixfx/arrays';\nimport { MapOfMutableImpl } from './map-of-multi-impl.js';\nimport { hasAnyValue as mapHasAnyValue, toArray as mapToArray, findValue as mapFindValue, filterValues as mapFilterValues, addValue as mapAddValue } from '@ixfx/core/maps';\n/**\n * Returns a {@link IMapOfMutableExtended} that uses a set to hold values.\n * This means that only unique values are stored under each key. By default it\n * uses the JSON representation to compare items.\n *\n * Options: `{ hash: toStringFn } }`\n *\n * `hash` is Util.ToString function: `(object) => string`. By default it uses\n * `JSON.stringify`.\n *\n * @example Only storing the newest three items per key\n * ```js\n * const map = ofSetMutable();\n * map.addKeyedValues(`hello`, [1, 2, 3, 1, 2, 3]);\n * const hello = map.get(`hello`); // [1, 2, 3]\n * ```\n *\n * @example\n * ```js\n * const hash = (v) => v.name; // Use name as the key\n * const map = ofSetMutable({hash});\n * map.addValue({age:40, name: `Mary`});\n * map.addValue({age:29, name: `Mary`}); // Value ignored as same name exists\n * ```\n * @param options\n * @returns\n */\nexport const ofSetMutable = (options) => {\n    const hash = options?.hash ?? toStringDefault;\n    const comparer = (a, b) => hash(a) === hash(b);\n    const t = {\n        get name() {\n            return `set`;\n        },\n        iterable: (source) => source.values(),\n        addKeyedValues: (dest, values) => mapAddValue(dest, hash, `skip`, ...values),\n        count: (source) => source.size,\n        find: (source, predicate) => mapFindValue(source, predicate),\n        filter: (source, predicate) => mapFilterValues(source, predicate),\n        toArray: (source) => mapToArray(source),\n        has: (source, value) => mapHasAnyValue(source, value, comparer),\n        without: (source, value) => without(mapToArray(source), value, comparer),\n    };\n    const m = new MapOfMutableImpl(t, options);\n    return m;\n};\n","import { isEqualDefault } from '@ixfx/core';\nimport { CircularArray } from '../circular-array.js';\nimport { MapOfMutableImpl } from './map-of-multi-impl.js';\n/**\n * Returns a {@link IMapOfMutableExtended} that uses a {@link ICircularArray} to hold values. Mutable.\n * This means that the number of values stored under each key will be limited to the defined\n * capacity.\n *\n * Required option:\n * * `capacity`: how many items to hold\n *\n * @example Only store the most recent three items per key\n * ```js\n * const map = ofCircularMutable({capacity: 3});\n * map.add(`hello`, [1, 2, 3, 4, 5]);\n * const hello = map.get(`hello`); // [3, 4, 5]\n * ```\n *\n *\n * @param options\n * @returns\n */\nexport const ofCircularMutable = (options) => {\n    const comparer = isEqualDefault;\n    const t = {\n        get name() {\n            return `circular`;\n        },\n        addKeyedValues: (destination, values) => {\n            let ca = destination ?? new CircularArray(options.capacity);\n            for (const v of values) {\n                ca = ca.add(v);\n            }\n            return ca;\n        },\n        count: (source) => source.length,\n        find: (source, predicate) => source.find(predicate),\n        filter: (source, predicate) => source.filter(predicate),\n        toArray: (source) => source,\n        iterable: (source) => source.values(),\n        has: (source, value) => source.find((v) => comparer(v, value)) !== undefined,\n        without: (source, value) => source.filter((v) => !comparer(v, value)),\n    };\n    return new MapOfMutableImpl(t, options);\n};\n","/**\n * Simple map for numbers.\n *\n * Keys not present in map return the `defaultValue` given in the constructor\n * ```js\n * // All keys default to zero.\n * const map = new NumberMap();\n * map.get(`hello`); // 0\n * ```\n *\n * To check if a key is present, use `has`:\n * ```js\n * map.has(`hello`); // false\n * ```\n *\n * Math:\n * ```js\n * // Adds 1 by default to value of `hello`\n * map.add(`hello`);         // 1\n * map.multiply(`hello`, 2); // 2\n *\n * // Reset key to default value\n * map.reset(`hello`); // 0\n * ```\n *\n * Different default value:\n * ```js\n * const map = new NumberMap(10);\n * map.get(`hello`); // 10\n * ```\n *\n * Regular `set` works as well:\n * ```js\n * map.set(`hello`, 5);\n * map.add(`hello`, 2); // 7\n * ```\n */\nexport class NumberMap extends Map {\n    defaultValue;\n    constructor(defaultValue = 0) {\n        super();\n        this.defaultValue = defaultValue;\n    }\n    get(key) {\n        const v = super.get(key);\n        if (v === undefined)\n            return this.defaultValue;\n        return v;\n    }\n    reset(key) {\n        super.set(key, this.defaultValue);\n        return this.defaultValue;\n    }\n    multiply(key, amount) {\n        const v = super.get(key);\n        let value = v ?? this.defaultValue;\n        value *= amount;\n        super.set(key, value);\n        return value;\n    }\n    add(key, amount = 1) {\n        const v = super.get(key);\n        let value = v ?? this.defaultValue;\n        value += amount;\n        super.set(key, value);\n        return value;\n    }\n    subtract(key, amount = 1) {\n        const v = super.get(key);\n        let value = v ?? this.defaultValue;\n        value -= amount;\n        super.set(key, value);\n        return value;\n    }\n}\n","import { isEqualDefault } from '@ixfx/core';\nimport {} from './imap-of-mutable-extended.js';\nimport {} from './map-multi.js';\nimport { MapOfMutableImpl } from './map-of-multi-impl.js';\n/**\n * Returns a {@link IMapOfMutableExtended} to allow storing multiple values under a key, unlike a regular Map.\n * @example\n * ```js\n * const map = ofArrayMutable();\n * map.addKeyedValues(`hello`, [1,2,3,4]); // Adds series of numbers under key `hello`\n *\n * const hello = map.get(`hello`); // Get back values\n * ```\n *\n * Takes options:\n * * `comparer`: {@link IsEqual}\n * * `toString`: Util.ToString\n *\n * A custom Util.ToString function can be provided as the `convertToString` opion. This is then used when checking value equality (`has`, `without`)\n * ```js\n * const map = ofArrayMutable({ convertToString:(v) => v.name}); // Compare values based on their `name` field;\n * ```\n *\n * Alternatively, a {@link IsEqual} function can be used:\n * ```js\n * const map = ofArrayMutable({comparer: (a, b) => a.name === b.name });\n * ```\n * @param options Optiosn for mutable array\n * @typeParam V - Data type of items\n * @returns {@link IMapOfMutableExtended}\n */\nexport const ofArrayMutable = (options = {}) => {\n    // const toStringFunction = opts.toString === undefined ?  \n    // const comparer =\n    //   opts.comparer === undefined\n    //     ? (opts.toString === undefined\n    //       ? (a: V, b: V) => opts.toString(a) === opts.toString(b)\n    //       : isEqualDefault)\n    //     : opts.comparer;\n    // const convertToStringComparer = opts.convertToString === undefined ? undefined : (a: V, b: V) => {\n    //   const r = opts.convertToString(a) === opts.convertToString(b)\n    //   console.log(`ofArrayMutable toString comparer: r: ${ r } a: ${ a } b: ${ b }`);\n    //   console.log(`ofArrayMutable toString comparer: a: ${ opts.toString(a) } b: ${ opts.toString(b) }`);\n    //   return r;\n    // };\n    const convertToString = options.convertToString;\n    const toStringFunction = typeof convertToString === `undefined` ? isEqualDefault : (a, b) => convertToString(a) === convertToString(b);\n    const comparer = options.comparer ?? toStringFunction;\n    const t = {\n        get name() {\n            return `array`;\n        },\n        addKeyedValues: (destination, values) => {\n            if (destination === undefined)\n                return [...values];\n            return [...destination, ...values];\n        },\n        iterable: (source) => source.values(),\n        count: (source) => source.length,\n        find: (source, predicate) => source.find(f => predicate(f)),\n        filter: (source, predicate) => source.filter(f => predicate(f)),\n        toArray: (source) => source,\n        has: (source, value) => source.some((v) => comparer(v, value)),\n        without: (source, value) => source.filter((v) => !comparer(v, value)),\n        //[Symbol.iterator]: (source) => source[Symbol.iterator]()\n    };\n    const m = new MapOfMutableImpl(t, options);\n    return m;\n};\n","import { defaultKeyer, isEqualDefault } from '@ixfx/core';\nimport { MapOfSimpleBase } from './map-of-simple-base.js';\n/**\n * Simple immutable MapOf\n */\nexport class MapOfSimple extends MapOfSimpleBase {\n    addKeyedValues(key, ...values) {\n        //const asEntries = values.map(v => [key, v]) as [string, V[]][];\n        //return this.addBatch(asEntries);\n        return this.addBatch([[key, values]]);\n    }\n    addValue(...values) {\n        const asEntries = values.map((v) => [this.groupBy(v), v]);\n        return this.addBatch(asEntries);\n    }\n    //eslint-disable-next-line functional/prefer-immutable-types\n    addBatch(entries) {\n        // Deep copy Map\n        const temporary = new Map([...this.map.entries()].map((e) => [e[0], [...e[1]]]));\n        for (const [key, list] of entries) {\n            // Does key exist already\n            const existingList = temporary.get(key);\n            if (typeof existingList === `undefined`) {\n                // No, use the batch input as the data for this key\n                // @ts-expect-error\n                temporary.set(key, list);\n            }\n            else {\n                // Yes\n                existingList.push(...list);\n            }\n        }\n        return new MapOfSimple(this.groupBy, this.valueEq, [...temporary.entries()]);\n    }\n    clear() {\n        return new MapOfSimple(this.groupBy, this.valueEq);\n    }\n    deleteKeyValue(_key, _value) {\n        throw new Error(`Method not implemented.`);\n    }\n    deleteByValue(value, eq) {\n        const entries = [...this.map.entries()];\n        const eqFunction = eq ?? this.valueEq;\n        const x = entries.map((entry) => {\n            const key = entry[0];\n            const values = entry[1].filter((vv) => !eqFunction(vv, value));\n            return [key, values];\n        });\n        return new MapOfSimple(this.groupBy, this.valueEq, x);\n    }\n    delete(key) {\n        const entries = [...this.map.entries()].filter((e) => e[0] !== key);\n        return new MapOfSimple(this.groupBy, this.valueEq, entries);\n    }\n}\n/**\n * A simple immutable map of arrays, without events. It can store multiple values\n * under the same key.\n *\n * For a fancier approaches, consider {@link ofArrayMutable}, {@link ofCircularMutable} or {@link ofSetMutable}.\n *\n * @example\n * ```js\n * let m = mapSimple();\n * m = m.add(`hello`, 1, 2, 3); // Adds numbers under key `hello`\n * m = m.delete(`hello`);       // Deletes everything under `hello`\n *\n * const hellos = m.get(`hello`); // Get list of items under `hello`\n * ```\n *\n * @typeParam V - Type of items\n * @returns New instance\n */\nexport const ofSimple = (groupBy = defaultKeyer, valueEq = (isEqualDefault)) => new MapOfSimple(groupBy, valueEq);\n","export { create as expiringMap, ExpiringMap } from './expiring-map.js';\nexport * from './map-of-simple-mutable.js';\nexport { immutable } from './map.js';\nexport { mutable } from './map-mutable.js';\nexport { ofSetMutable } from './map-of-set-mutable.js';\nexport { ofCircularMutable } from './map-of-circular-mutable.js';\nexport { NumberMap } from './number-map.js';\nexport * from './map-multi.js';\n// Re-export from core\nexport * from '@ixfx/core/maps';\n//export type { IDictionary as IMappish, IWithEntries } from '../../data/maps/IMappish.js';\n","import { resultIsError } from \"@ixfx/guards\";\n/**\n * Stores values in a table of rows (vertical) and columns (horizontal)\n */\nexport class Table {\n    rows = [];\n    rowLabels = [];\n    colLabels = [];\n    /**\n     * Keep track of widest row\n     */\n    columnMaxLength = 0;\n    /**\n     * Gets the label for a given column index,\n     * returning _undefined_ if not found.\n     *\n     * Case-sensitive\n     * @param label Label to seek\n     * @returns Index of column, or _undefined_ if not found\n     */\n    getColumnLabelIndex(label) {\n        for (const [index, l] of this.colLabels.entries()) {\n            if (l === label)\n                return index;\n        }\n    }\n    /**\n     * Gets the label for a given row index,\n     * returning _undefined_ if not found.\n     *\n     * Case-sensitive\n     * @param label Label to seek\n     * @returns Index of row, or _undefined_ if not found\n     */\n    getRowLabelIndex(label) {\n        for (const [index, l] of this.rowLabels.entries()) {\n            if (l === label)\n                return index;\n        }\n    }\n    /**\n     * Dumps the values of the table to the console\n     */\n    print() {\n        console.table([...this.rowsWithLabelsObject()]);\n    }\n    /**\n     * Return a copy of table as nested array\n     *\n     * ```js\n     * const t = new Table();\n     * // add stuff\n     * // ...\n     * const m = t.asArray();\n     * for (const row of m) {\n     *  for (const colValue of row) {\n     *    // iterate over all column values for this row\n     *  }\n     * }\n     * ```\n     *\n     * Alternative: get value at row Y and column X\n     * ```js\n     * const value = m[y][x];\n     * ```\n     * @returns\n     */\n    asArray() {\n        const r = [];\n        for (const row of this.rows) {\n            if (row === undefined)\n                r.push([]);\n            else\n                r.push([...row]);\n        }\n        return r;\n    }\n    /**\n     * Return the number of rows\n     */\n    get rowCount() {\n        return this.rows.length;\n    }\n    /**\n     * Return the maximum number of columns in any row\n     */\n    get columnCount() {\n        return this.columnMaxLength;\n        // const lengths = this.rows.map(row => row.length);\n        // return Math.max(...lengths);\n    }\n    /**\n     * Iterates over the table row-wise, in object format.\n     * @see {@link rowsWithLabelsArray} to get rows in array format\n     */\n    *rowsWithLabelsObject() {\n        for (let index = 0; index < this.rows.length; index++) {\n            const labelledRow = this.getRowWithLabelsObject(index);\n            yield labelledRow;\n        }\n    }\n    /**\n     * Iterates over each row, including the labels if available\n     * @see {@link rowsWithLabelsObject} to get rows in object format\n     */\n    *rowsWithLabelsArray() {\n        for (let index = 0; index < this.rows.length; index++) {\n            const labelledRow = this.getRowWithLabelsArray(index);\n            yield labelledRow;\n        }\n    }\n    /**\n     * Assign labels to columns\n     * @param labels\n     */\n    labelColumns(...labels) {\n        this.colLabels = labels;\n    }\n    /**\n     * Assign label to a specific column\n     * First column has an index of 0\n     * @param columnIndex\n     * @param label\n     */\n    labelColumn(columnIndex, label) {\n        this.colLabels[columnIndex] = label;\n    }\n    /**\n     * Label rows\n     * @param labels Labels\n     */\n    labelRows(...labels) {\n        this.rowLabels = labels;\n    }\n    /**\n     * Assign label to a specific row\n     * First row has an index of 0\n     * @param rowIndex\n     * @param label\n     */\n    labelRow(rowIndex, label) {\n        this.rowLabels[rowIndex] = label;\n    }\n    /**\n     * Adds a new row\n     * @param data Columns\n     */\n    appendRow(...data) {\n        this.columnMaxLength = Math.max(this.columnMaxLength, data.length);\n        this.rows.push(data);\n        return data;\n    }\n    /**\n     * Gets a row along with labels, as an array\n     * @param rowIndex\n     * @returns\n     */\n    getRowWithLabelsArray(rowIndex) {\n        const row = this.rows.at(rowIndex);\n        if (row === undefined)\n            return undefined;\n        return row.map((value, index) => [this.colLabels.at(index), value]);\n    }\n    /**\n     * Return a row of objects. Keys use the column labels.\n     *\n     * ```js\n     * const row = table.getRowWithLabelsObject(10);\n     * // eg:\n     * // [{ colour: red, size: 10}, { colour: blue, size: 20 }]\n     * ```\n     * @param rowIndex\n     * @returns\n     */\n    getRowWithLabelsObject(rowIndex) {\n        const row = this.rows.at(rowIndex);\n        if (row === undefined)\n            return undefined;\n        const object = {};\n        for (let index = 0; index < this.colLabels.length; index++) {\n            const label = this.colLabels.at(index) ?? index.toString();\n            object[label] = row[index];\n        }\n        return object;\n    }\n    /**\n     * Gets or creates a row at given position\n     * @param row Index or label of row\n     * @returns\n     */\n    #getOrCreateRawRow(row) {\n        const index = typeof row === `number` ? row : this.getRowLabelIndex(row);\n        // Couldn't lookup label\n        if (index === undefined)\n            return { success: false, error: `row-label-notfound` };\n        // Bad index\n        if (index < 0)\n            return { success: false, error: `row-index-invalid` };\n        // Within existing set of rows\n        if (index < this.rows.length) {\n            return { success: true, value: this.rows[index] };\n        }\n        const newRow = [];\n        this.rows[index] = newRow;\n        return { success: true, value: newRow };\n    }\n    /**\n     * Gets a copy of values at given row, specified by index or label\n     * @param row\n     * @returns Returns row or throws an error if label or index not found\n     */\n    row(row) {\n        const r = this.#getRowRaw(row);\n        if (resultIsError(r)) {\n            throw new Error(r.error);\n        }\n        return [...r.value];\n    }\n    /**\n     * Set the value of row,columm.\n     * Row is created if it doesn't exist, with the other column values being _undefined_\n     * @param row Index or label\n     * @param column Column\n     * @param value Value to set at row,column\n     */\n    set(row, column, value) {\n        const result = this.#getOrCreateRawRow(row);\n        if (resultIsError(result))\n            throw new Error(result.error);\n        // Have an array that corresponds to row\n        const r = result.value;\n        const columnIndex = typeof column === `number` ? column : this.getColumnLabelIndex(column);\n        if (typeof columnIndex === `undefined`)\n            throw new Error(`Column label '${column}' not found or is invalid`);\n        if (columnIndex < 0)\n            throw new Error(`Column index invalid (less than zero)`);\n        // Already have needed columns\n        r[columnIndex] = value;\n    }\n    /**\n     * Gets the value at a specified row and column.\n     * Throws an error if coordinates are out of range or missing.\n     * @param row Row index or label\n     * @param column Column index or label\n     * @returns\n     */\n    get(row, column) {\n        const rowR = this.#getRowRaw(row);\n        if (resultIsError(rowR))\n            throw new Error(rowR.error);\n        const colR = this.#getColumnRaw(rowR.value, column);\n        if (resultIsError(colR))\n            throw new Error(colR.error);\n        return colR.value.value;\n    }\n    #getRowRaw(row) {\n        let index = 0;\n        if (typeof row === `number`) {\n            index = row;\n        }\n        else {\n            index = this.getRowLabelIndex(row);\n            if (typeof index !== `number`)\n                return { error: `row-label-notfound`, success: false };\n        }\n        if (typeof index !== `number`)\n            return { error: `row-invalid`, success: false };\n        if (index < 0 || index >= this.rows.length)\n            return { error: `row-index-out-of-range`, success: false };\n        return { success: true, value: this.rows[index] };\n    }\n    #getColumnRaw(row, column) {\n        const colIndex = typeof column === `number` ? column : this.getColumnLabelIndex(column);\n        if (typeof colIndex !== `number`)\n            return { success: false, error: `col-label-notfound` };\n        if (colIndex < 0 || colIndex >= row.length)\n            return { success: false, error: `col-index-out-of-range` };\n        return {\n            success: true, value: { index: colIndex, value: row[colIndex] }\n        };\n    }\n    /**\n     * Set all the columns of a row to a specified value.\n     *\n     * By default, sets the number of columns corresponding to\n     * the table's maximum column length. To set an arbitrary\n     * length of the row, use `length`\n     * @param row Index or label of row\n     * @param length How wide the row is. If unset, uses the current maximum width of rows.\n     * @param value Value to set\n     */\n    setRow(row, value, length) {\n        // Get or create a row\n        const rowResult = this.#getOrCreateRawRow(row);\n        if (resultIsError(rowResult))\n            throw new Error(rowResult.error);\n        // Set value within row\n        const r = rowResult.value;\n        const width = typeof length === `number` ? length : this.columnMaxLength;\n        for (let columnNumber = 0; columnNumber < width; columnNumber++) {\n            r[columnNumber] = value;\n        }\n        return r;\n    }\n}\n","/* eslint-disable @typescript-eslint/no-non-null-assertion */\nimport { StackMutable } from \"../stack/StackMutable.js\";\nimport { QueueMutable } from \"../queue/queue-mutable.js\";\nimport { PriorityMutable } from \"../queue/priority-mutable.js\";\nimport { immutable as immutableMap } from \"../map/map.js\";\nimport { NumberMap } from \"../map/number-map.js\";\nimport * as Sync from \"@ixfx/iterables/sync\";\nimport { Table } from \"../table.js\";\nimport { resultThrow, stringTest } from \"@ixfx/guards\";\n/**\n * Create a vertex with given id\n * @param id\n * @returns\n */\nexport const createVertex = (id) => {\n    return {\n        id,\n        out: []\n    };\n};\n/**\n * Returns _true_ if graph contains `key`.\n *\n * ```js\n * // Same as\n * g.vertices.has(key)\n * ```\n * @param graph\n * @param key\n * @returns\n */\nexport function hasKey(graph, key) {\n    resultThrow(graphTest(graph));\n    return graph.vertices.has(key);\n}\n/**\n * Returns {@link Vertex} under `key`, or _undefined_\n * if not found.\n *\n * ```js\n * // Same as\n * g.vertices.get(key)\n * ```\n * @param graph\n * @param key\n * @returns\n */\nexport function get(graph, key) {\n    resultThrow(graphTest(graph));\n    resultThrow(stringTest(key, `non-empty`, `key`));\n    return graph.vertices.get(key);\n}\n// export function fromAdjacenyMatrix(m: Array<Array<boolean>>): DirectedGraph {\n//   let g = graph();\n//   for (const row of m) {\n//     connect(g, { from, to })\n//   }\n//   return g;\n// }\n/**\n * Returns the graph connections as an adjacency matrix\n * @param graph\n * @returns\n */\nexport function toAdjacencyMatrix(graph) {\n    resultThrow(graphTest(graph));\n    const v = [...graph.vertices.values()];\n    //const m: Array<Array<boolean>> = [];\n    const table = new Table();\n    table.labelColumns(...v.map(vv => vv.id));\n    table.labelRows(...v.map(vv => vv.id));\n    // const row: Array<boolean> = [];\n    // for (let index = 0; index < v.length; index++) {\n    //   row[ index ] = false;\n    // }\n    // eslint-disable-next-line unicorn/prevent-abbreviations\n    for (let i = 0; i < v.length; i++) {\n        //m[ i ] = [ ...row ];\n        table.setRow(i, false, v.length);\n        const ii = v[i];\n        // eslint-disable-next-line unicorn/prevent-abbreviations\n        for (const [j, jj] of v.entries()) {\n            if (ii.out.some(o => o.id === jj.id)) {\n                //m[ i ][ j ] = true;\n                table.set(i, j, true);\n            }\n        }\n    }\n    return table;\n}\n/**\n * Return a string representation of the graph for debug inspection\n * @param graph\n * @returns\n */\nexport const dumpGraph = (graph) => {\n    const lines = debugGraphToArray(graph);\n    return lines.join(`\\n`);\n};\n/**\n * Return an array of a debug-print of every vertex.\n * @param graph\n * @returns\n */\nconst debugGraphToArray = (graph) => {\n    const r = [];\n    const vertices = (`vertices` in graph) ? graph.vertices.values() : graph;\n    for (const v of vertices) {\n        // eslint-disable-next-line unicorn/prevent-abbreviations\n        const str = debugDumpVertex(v);\n        r.push(...str.map(line => ` ${line}`));\n    }\n    return r;\n};\n/**\n * Returns the weight of an edge, or 1 if undefined.\n * @param graph\n * @param edge\n * @returns\n */\nexport const distance = (graph, edge) => {\n    if (edge.weight !== undefined)\n        return edge.weight;\n    return 1;\n};\n/**\n * Iterate over all the edges in the graph\n * @param graph\n */\nexport function* edges(graph) {\n    resultThrow(graphTest(graph));\n    const vertices = [...graph.vertices.values()];\n    for (const vertex of vertices) {\n        for (const edge of vertex.out) {\n            yield edge;\n        }\n    }\n}\n/**\n * Iterate over all the vertices of the graph\n * @param graph\n */\nexport function* vertices(graph) {\n    resultThrow(graphTest(graph));\n    const vertices = [...graph.vertices.values()];\n    for (const vertex of vertices) {\n        yield vertex;\n    }\n}\nfunction graphTest(g, parameterName = `graph`) {\n    if (g === undefined)\n        return { success: false, error: `Param '${parameterName}' is undefined. Expected Graph` };\n    if (g === null)\n        return { success: false, error: `Param '${parameterName}' is null. Expected Graph` };\n    if (typeof g === `object`) {\n        if (!(`vertices` in g))\n            return {\n                success: false, error: `Param '${parameterName}.vertices' does not exist. Is it a Graph type?`\n            };\n    }\n    else {\n        return { success: false, error: `Param '${parameterName} is type '${typeof g}'. Expected an object Graph` };\n    }\n    return { success: true, value: g };\n}\n// function throwGraphTest(g: DirectedGraph, parameterName = `graph`) {\n//   const r = testGraph(g, parameterName);\n//   if (r[ 0 ]) return;\n//   throw new Error(r[ 1 ] as string)\n// }\n/**\n * Iterate over all the vertices connected to `context` vertex\n * @param graph Graph\n * @param context id or Vertex.\n * @returns\n */\nexport function* adjacentVertices(graph, context) {\n    resultThrow(graphTest(graph));\n    if (context === undefined)\n        return;\n    const vertex = typeof context === `string` ? graph.vertices.get(context) : context;\n    if (vertex === undefined)\n        throw new Error(`Vertex not found ${JSON.stringify(context)}`);\n    for (const edge of vertex.out) {\n        const edgeV = graph.vertices.get(edge.id);\n        if (edgeV === undefined)\n            throw new Error(`Could not find vertex: ${edge.id}`);\n        yield edgeV;\n    }\n}\n/**\n * Returns _true_ if `vertex` has an outgoing connection to\n * the supplied id or vertex.\n *\n * If `vertex` is undefined, _false_ is returned.\n * @param vertex From vertex\n * @param outIdOrVertex To vertex\n * @returns\n */\nexport const vertexHasOut = (vertex, outIdOrVertex) => {\n    if (vertex === undefined)\n        return false;\n    const outId = typeof outIdOrVertex === `string` ? outIdOrVertex : outIdOrVertex.id;\n    return vertex.out.some(edge => edge.id === outId);\n};\n/**\n * Returns _true_ if `vertex` has no outgoing connections\n * @param graph\n * @param vertex\n * @returns\n */\nexport const hasNoOuts = (graph, vertex) => {\n    resultThrow(graphTest(graph));\n    const context = typeof vertex === `string` ? graph.vertices.get(vertex) : vertex;\n    if (context === undefined)\n        return false;\n    return context.out.length === 0;\n};\n/**\n * Returns _true_ if `vertex` only has the given list of vertices.\n * Returns _false_ early if the length of the list does not match up with `vertex.out`\n * @param graph\n * @param vertex\n * @param outIdOrVertex\n * @returns\n */\nexport const hasOnlyOuts = (graph, vertex, ...outIdOrVertex) => {\n    resultThrow(graphTest(graph));\n    const context = resolveVertex(graph, vertex);\n    const outs = outIdOrVertex.map(o => resolveVertex(graph, o));\n    if (outs.length !== context.out.length) {\n        //console.log(`length mismatch. context: ${ JSON.stringify(context.out) } out ${ JSON.stringify(outIdOrVertex) }`);\n        return false;\n    }\n    for (const out of outs) {\n        //console.log(`Testing ${ context.id } -> ${ out.id }`);\n        if (!hasOut(graph, context, out)) {\n            //console.log(`  no`);\n            return false;\n        }\n    }\n    return true;\n};\n/**\n * Returns _true_ if `vertex` has an outgoing connection to the given vertex.\n * @param graph\n * @param vertex\n * @param outIdOrVertex\n * @returns\n */\nexport const hasOut = (graph, vertex, outIdOrVertex) => {\n    resultThrow(graphTest(graph));\n    const context = resolveVertex(graph, vertex);\n    const outId = typeof outIdOrVertex === `string` ? outIdOrVertex : outIdOrVertex.id;\n    return context.out.some(edge => edge.id === outId);\n};\n// export const hasIn = (graph: Graph, contextIdOrVertex: string | Vertex, id: string): boolean => {\n//   const context = typeof contextIdOrVertex === `string` ? graph.vertices.get(contextIdOrVertex) : contextIdOrVertex;\n//   if (context === undefined) return false;\n//   if (context.in === undefined) return false;\n//   return context.in.some(edge => edge.id === id);\n// }\n/**\n * Gets a vertex by id, creating it if it does not exist.\n * @param graph\n * @param id\n * @returns\n */\nexport const getOrCreate = (graph, id) => {\n    resultThrow(graphTest(graph));\n    const v = graph.vertices.get(id);\n    if (v !== undefined)\n        return { graph, vertex: v };\n    const vv = createVertex(id);\n    const gg = updateGraphVertex(graph, vv);\n    return { graph: gg, vertex: vv };\n};\n/**\n * Gets a vertex by id, throwing an error if it does not exist\n * @param graph\n * @param id\n * @returns\n */\nexport const getOrFail = (graph, id) => {\n    resultThrow(graphTest(graph));\n    const v = graph.vertices.get(id);\n    if (v === undefined)\n        throw new Error(`Vertex '${id}' not found in graph`);\n    return v;\n};\n/**\n * Updates a vertex by returning a mutated graph\n * @param graph Graph\n * @param vertex Newly changed vertex\n * @returns\n */\nexport const updateGraphVertex = (graph, vertex) => {\n    resultThrow(graphTest(graph));\n    const gr = {\n        ...graph,\n        vertices: graph.vertices.set(vertex.id, vertex)\n    };\n    return gr;\n};\n/**\n * Default distance computer. Uses `weight` property of edge, or `1` if not found.\n * @param graph\n * @param edge\n * @returns\n */\nexport const distanceDefault = (graph, edge) => {\n    if (edge.weight !== undefined)\n        return edge.weight;\n    return 1;\n};\n/**\n * Returns a mutation of `graph`, with a given edge removed.\n *\n * If edge was not there, original graph is returned.\n * @param graph\n * @param from\n * @param to\n * @returns\n */\nexport function disconnect(graph, from, to) {\n    resultThrow(graphTest(graph));\n    const fromV = resolveVertex(graph, from);\n    const toV = resolveVertex(graph, to);\n    return hasOut(graph, fromV, toV) ? updateGraphVertex(graph, {\n        ...fromV,\n        out: fromV.out.filter(t => t.id !== toV.id)\n    }) : graph;\n}\n/**\n * Make a connection between two vertices with a given weight.\n * It returns the new graph as wll as the created edge.\n * @param graph\n * @param from\n * @param to\n * @param weight\n * @returns\n */\nexport function connectTo(graph, from, to, weight) {\n    resultThrow(graphTest(graph));\n    const fromResult = getOrCreate(graph, from);\n    graph = fromResult.graph;\n    const toResult = getOrCreate(graph, to);\n    graph = toResult.graph;\n    const edge = {\n        id: to,\n        weight\n    };\n    if (!hasOut(graph, fromResult.vertex, toResult.vertex)) {\n        graph = updateGraphVertex(graph, {\n            ...fromResult.vertex,\n            // Add new edge to list of edges for this node\n            out: [...fromResult.vertex.out, edge]\n        });\n    }\n    return { graph, edge };\n}\n/**\n * Connect from -> to. Same as {@link connectWithEdges}, but this version just returns the graph.\n *\n * By default unidirectional, meaning a connection is made only from->to. Use `bidi` option to set a bidirection connection, adding also to->from.\n *\n * Returns a result of `{ graph, edges }`, where `graph` is the new {@link DirectedGraph} and `edges`\n * is an array of {@link Edge Edges}. One for unidirectional, or two for bidirectional.\n * @param graph\n * @param options\n * @returns\n */\nexport function connect(graph, options) {\n    if (typeof graph !== `object`)\n        throw new TypeError(`Param 'graph' is expected to be a DirectedGraph object. Got: ${typeof graph}`);\n    if (typeof options !== `object`)\n        throw new TypeError(`Param 'options' is expected to be ConnectOptions object. Got: ${typeof options}`);\n    const result = connectWithEdges(graph, options);\n    return result.graph;\n}\n/**\n * Connect from -> to. Same as {@link connect} except you get back the edges as well.\n *\n * By default unidirectional, meaning a connection is made only from->to. Use `bidi` option to set a bidirection connection, adding also to->from.\n *\n * Returns a result of `{ graph, edges }`, where `graph` is the new {@link DirectedGraph} and `edges`\n * is an array of {@link Edge Edges}. One for unidirectional, or two for bidirectional.\n * @param graph\n * @param options\n * @returns\n */\nexport function connectWithEdges(graph, options) {\n    resultThrow(graphTest(graph));\n    const { to, weight, from } = options;\n    const bidi = options.bidi ?? false;\n    const toList = Array.isArray(to) ? to : [to];\n    const edges = [];\n    // Connect from -> to\n    for (const toSingle of toList) {\n        const result = connectTo(graph, from, toSingle, weight);\n        graph = result.graph;\n        edges.push(result.edge);\n    }\n    if (!bidi)\n        return { graph, edges };\n    // Bidirectional connection\n    // Connect to -> from\n    for (const toSingle of toList) {\n        const result = connectTo(graph, toSingle, from, weight);\n        graph = result.graph;\n        edges.push(result.edge);\n    }\n    return { graph, edges };\n}\n/**\n * Returns an array of debug-representations for the given vertex.\n * @param v\n * @returns\n */\nconst debugDumpVertex = (v) => {\n    const r = [\n        v.id\n    ];\n    const stringForEdge = (edge) => edge.weight === undefined ? edge.id : `${edge.id} (${edge.weight})`;\n    // for (const edge of v.in) {\n    //   r.push(` <- ${ stringForEdge(edge) }`);\n    // }\n    for (const edge of v.out) {\n        r.push(` -> ${stringForEdge(edge)}`);\n    }\n    if (v.out.length === 0)\n        r[0] += ` (terminal)`;\n    return r;\n};\n/**\n * Returns _true_ if a->b or b->a\n * @param graph\n * @param a\n * @param b\n * @returns\n */\nexport function areAdjacent(graph, a, b) {\n    resultThrow(graphTest(graph));\n    if (hasOut(graph, a, b.id))\n        return true;\n    if (hasOut(graph, b, a.id))\n        return true;\n}\n/**\n * Resolves the id or vertex into a Vertex.\n * throws an error if vertex is not found\n * @param graph\n * @param idOrVertex\n * @returns\n */\nfunction resolveVertex(graph, idOrVertex) {\n    resultThrow(graphTest(graph));\n    if (idOrVertex === undefined)\n        throw new Error(`Param 'idOrVertex' is undefined. Expected string or Vertex`);\n    const v = typeof idOrVertex === `string` ? graph.vertices.get(idOrVertex) : idOrVertex;\n    if (v === undefined)\n        throw new Error(`Id not found ${idOrVertex}`);\n    return v;\n}\n/**\n * Iterates over vertices from a starting vertex in an bread-first-search\n * @param graph\n * @param startIdOrVertex\n * @param targetIdOrVertex\n * @returns\n */\nexport function* bfs(graph, startIdOrVertex, targetIdOrVertex) {\n    resultThrow(graphTest(graph));\n    const start = resolveVertex(graph, startIdOrVertex);\n    const target = targetIdOrVertex === undefined ? undefined : resolveVertex(graph, targetIdOrVertex);\n    const queue = new QueueMutable();\n    const seen = new Set();\n    queue.enqueue(start);\n    while (!queue.isEmpty) {\n        const v = queue.dequeue();\n        yield v;\n        if (target !== undefined && target === v)\n            return;\n        for (const edge of adjacentVertices(graph, v)) {\n            if (!seen.has(edge.id)) {\n                seen.add(edge.id);\n                queue.enqueue(resolveVertex(graph, edge.id));\n            }\n        }\n    }\n}\n/**\n * Iterates over vertices from a starting vertex in an depth-first-search\n * @param graph\n * @param startIdOrVertex\n */\nexport function* dfs(graph, startIdOrVertex) {\n    resultThrow(graphTest(graph));\n    const source = resolveVertex(graph, startIdOrVertex);\n    const s = new StackMutable();\n    const seen = new Set();\n    s.push(source);\n    while (!s.isEmpty) {\n        const v = s.pop();\n        if (v === undefined)\n            continue;\n        if (!seen.has(v.id)) {\n            seen.add(v.id);\n            yield v;\n            for (const edge of v.out) {\n                const destination = graph.vertices.get(edge.id);\n                if (destination) {\n                    s.push(destination);\n                }\n            }\n        }\n    }\n}\n/**\n * Compute shortest distance from the source vertex to the rest of the graph.\n * @param graph\n * @param sourceOrId\n * @returns\n */\nexport const pathDijkstra = (graph, sourceOrId) => {\n    resultThrow(graphTest(graph));\n    const source = typeof sourceOrId === `string` ? graph.vertices.get(sourceOrId) : sourceOrId;\n    if (source === undefined)\n        throw new Error(`source vertex not found`);\n    const distances = new Map();\n    const previous = new Map();\n    distances.set(source.id, 0);\n    const pq = new PriorityMutable();\n    const vertices = [...graph.vertices.values()];\n    for (const v of vertices) {\n        if (v.id !== source.id) {\n            distances.set(v.id, Number.MAX_SAFE_INTEGER);\n            previous.set(v.id, null);\n        }\n        pq.enqueueWithPriority(v.id, Number.MAX_SAFE_INTEGER);\n    }\n    while (!pq.isEmpty) {\n        const u = pq.dequeueMin();\n        if (u === undefined)\n            throw new Error(`Bug. Queue unexpectedly empty`);\n        const vertexU = graph.vertices.get(u);\n        for (const neighbour of vertexU.out) {\n            //const vertexNeigbour = graph.vertices.get(neighbour.to)!;\n            const alt = distances.get(u) + distance(graph, neighbour);\n            if (alt < distances.get(neighbour.id)) {\n                distances.set(neighbour.id, alt);\n                previous.set(neighbour.id, vertexU);\n                pq.changePriority(neighbour.id, alt, true);\n            }\n        }\n    }\n    const pathTo = (id) => {\n        const path = [];\n        while (true) {\n            if (id === source.id)\n                break;\n            const v = previous.get(id);\n            if (v === undefined || v === null)\n                throw new Error(`Id not present: ${id}`);\n            path.push({ id, weight: distances.get(id) });\n            id = v.id;\n        }\n        return path;\n    };\n    return {\n        distances, previous, pathTo\n    };\n};\n/**\n * Clones the graph. Uses shallow clone, because it's all immutable\n * @param graph\n * @returns\n */\nexport const clone = (graph) => {\n    resultThrow(graphTest(graph));\n    const g = {\n        vertices: immutableMap([...graph.vertices.entries()])\n    };\n    return g;\n};\n/**\n * Create a graph\n * ```js\n * let g = graph();\n * ```\n *\n * Can optionally provide initial connections:\n * ```js\n * let g = graph(\n *  { from: `a`, to: `b` },\n *  { from: `b`, to: `c` }\n * )\n * ```\n * @param initialConnections\n * @returns\n */\nexport const graph = (...initialConnections) => {\n    let g = {\n        vertices: immutableMap()\n    };\n    for (const ic of initialConnections) {\n        g = connect(g, ic);\n    }\n    return g;\n};\n/**\n * Returns _true_ if the graph contains is acyclic - that is, it has no loops\n * @param graph\n */\nexport function isAcyclic(graph) {\n    resultThrow(graphTest(graph));\n    const cycles = getCycles(graph);\n    return cycles.length === 0;\n}\n/**\n * Topological sort using Kahn's algorithm.\n * Returns a new graph that is sorted\n * @param graph\n */\nexport function topologicalSort(graph) {\n    resultThrow(graphTest(graph));\n    const indegrees = new NumberMap(0);\n    // Increment indegrees for each edge leading to a vertex\n    for (const edge of edges(graph)) {\n        indegrees.add(edge.id, 1);\n    }\n    // Enqueue all vertices with an indegree of 0\n    const queue = new QueueMutable();\n    let vertexCount = 0;\n    for (const vertex of vertices(graph)) {\n        if (indegrees.get(vertex.id) === 0) {\n            queue.enqueue(vertex);\n        }\n        vertexCount++;\n    }\n    const topOrder = [];\n    while (!queue.isEmpty) {\n        // Add to topological order\n        const u = queue.dequeue();\n        topOrder.push(u);\n        // Iterate through neighbours\n        for (const neighbour of u.out) {\n            const result = indegrees.subtract(neighbour.id, 1);\n            if (result === 0) {\n                queue.enqueue(graph.vertices.get(neighbour.id));\n            }\n        }\n    }\n    if (topOrder.length !== vertexCount) {\n        throw new Error(`Graph contains cycles`);\n    }\n    return graphFromVertices(topOrder);\n}\n/**\n * Create a graph from an iterable of vertices\n * @param vertices\n * @returns\n */\nexport function graphFromVertices(vertices) {\n    const keyValues = Sync.map(vertices, f => {\n        return [f.id, f];\n    });\n    const m = immutableMap([...keyValues]);\n    return {\n        vertices: m\n    };\n}\n/**\n * Get all the cycles ('strongly-connected-components') within the graph\n * [Read more](https://en.wikipedia.org/wiki/Strongly_connected_component)\n * @param graph\n * @returns\n */\nexport function getCycles(graph) {\n    resultThrow(graphTest(graph));\n    let index = 0;\n    const stack = new StackMutable();\n    const vertices = new Map();\n    const scc = [];\n    for (const v of graph.vertices.values()) {\n        vertices.set(v.id, {\n            ...v,\n            lowlink: Number.NaN,\n            index: Number.NaN,\n            onStack: false\n        });\n    }\n    const strongConnect = (vertex) => {\n        vertex.index = index;\n        vertex.lowlink = index;\n        index++;\n        stack.push(vertex);\n        vertex.onStack = true;\n        for (const edge of vertex.out) {\n            const edgeV = vertices.get(edge.id);\n            if (Number.isNaN(edgeV.index)) {\n                strongConnect(edgeV);\n                vertex.lowlink = Math.min(vertex.lowlink, edgeV.lowlink);\n            }\n            else if (edgeV.onStack) {\n                vertex.lowlink = Math.min(vertex.lowlink, edgeV.lowlink);\n            }\n        }\n        if (vertex.lowlink === vertex.index) {\n            const stronglyConnected = [];\n            let w;\n            while (vertex !== w) {\n                w = stack.pop();\n                w.onStack = false;\n                stronglyConnected.push({ id: w.id, out: w.out });\n            }\n            if (stronglyConnected.length > 1)\n                scc.push(stronglyConnected);\n        }\n    };\n    for (const v of vertices.values()) {\n        if (Number.isNaN(v.index)) {\n            strongConnect(v);\n        }\n    }\n    return scc;\n}\n/**\n * Returns a new graph which is transitively reduced.\n * That is, redundant edges are removed\n * @param graph\n * @returns\n */\nexport function transitiveReduction(graph) {\n    resultThrow(graphTest(graph));\n    for (const u of vertices(graph)) {\n        for (const v of adjacentVertices(graph, u)) {\n            for (const v1 of dfs(graph, v)) {\n                if (v.id === v1.id)\n                    continue;\n                if (hasOut(graph, u, v1)) {\n                    const g = disconnect(graph, u, v1);\n                    return transitiveReduction(g);\n                }\n            }\n        }\n    }\n    return graph;\n}\n","import { immutable as immutableMap } from \"../map/map.js\";\nimport { Table } from \"../table.js\";\nexport const createVertex = (id) => {\n    return {\n        id\n    };\n};\nexport const updateGraphVertex = (graph, vertex) => {\n    const gr = {\n        ...graph,\n        vertices: graph.vertices.set(vertex.id, vertex)\n    };\n    return gr;\n};\nexport const getOrCreate = (graph, id) => {\n    const v = graph.vertices.get(id);\n    if (v !== undefined)\n        return { graph, vertex: v };\n    const vv = createVertex(id);\n    const gg = updateGraphVertex(graph, vv);\n    return { graph: gg, vertex: vv };\n};\nfunction resolveVertex(graph, idOrVertex) {\n    if (idOrVertex === undefined)\n        throw new Error(`Param 'idOrVertex' is undefined. Expected string or Vertex`);\n    if (graph === undefined)\n        throw new Error(`Param 'graph' is undefined. Expected Graph`);\n    const v = typeof idOrVertex === `string` ? graph.vertices.get(idOrVertex) : idOrVertex;\n    if (v === undefined)\n        throw new Error(`Id not found ${idOrVertex}`);\n    return v;\n}\n/**\n * Returns _true/false_ if there is a connection between `a` and `b` in `graph`.\n * Use {@link getConnection} if you want to the edge.\n * @param graph Graph to search\n * @param a\n * @param b\n * @returns _true_ if edge exists\n */\nexport const hasConnection = (graph, a, b) => {\n    const edge = getConnection(graph, a, b);\n    return edge !== undefined;\n};\n/**\n * Gets the connection, if it exists between `a` and `b` in `graph`.\n * If it doesn't exist, _undefined_ is returned.\n * Use {@link hasConnection} for a simple true/false if edge exists.\n * @param graph Graph\n * @param a\n * @param b\n * @returns\n */\nexport const getConnection = (graph, a, b) => {\n    if (a === undefined)\n        throw new Error(`Param 'a' is undefined. Expected string or Vertex`);\n    if (b === undefined)\n        throw new Error(`Param 'b' is undefined. Expected string or Vertex`);\n    if (graph === undefined)\n        throw new Error(`Param 'graph' is undefined. Expected Graph`);\n    const aa = resolveVertex(graph, a);\n    const bb = resolveVertex(graph, b);\n    for (const edge of graph.edges) {\n        if (edge.a == aa.id && edge.b === bb.id)\n            return edge;\n        if (edge.a == bb.id && edge.b === aa.id)\n            return edge;\n    }\n    return;\n};\n/**\n * Connects A with B, returning the changed graph and created edge.\n * If the connection already exists, the original graph & edge is returned.\n * @param graph\n * @param a\n * @param b\n * @param weight\n * @returns\n */\nexport function connectTo(graph, a, b, weight) {\n    const aResult = getOrCreate(graph, a);\n    graph = aResult.graph;\n    const bResult = getOrCreate(graph, b);\n    graph = bResult.graph;\n    let edge = getConnection(graph, a, b);\n    if (edge !== undefined)\n        return { graph, edge };\n    edge = {\n        a,\n        b,\n        weight\n    };\n    const graphChanged = {\n        ...graph,\n        edges: [...graph.edges, edge]\n    };\n    return { graph: graphChanged, edge };\n}\n/**\n * Makes a connection between `options.a` and one or more nodes in `options.b`.\n * Same as {@link connectWithEdges} but only the {@link Graph} is returned.\n *\n * ```js\n * let g = graph(); // Create an empty graph\n * // Make a connection between `red` and `orange`\n * g = connect(g, { a: `red`, b: `orange` });\n *\n * // Make a connection between `red` and `orange as well as `red` and `yellow`.\n * g = connect(g, { a: `red`, b: [`orange`, `yellow`] })\n * ```\n * @param graph Initial graph\n * @param options Options\n */\nexport function connect(graph, options) {\n    const result = connectWithEdges(graph, options);\n    return result.graph;\n}\n/**\n * Makes a connection between `options.a` and one or more nodes in `options.b`.\n * Same as {@link connect} but graph and edges are returned.\n *\n * ```js\n * let g = graph(); // Create an empty graph\n *\n * // Make a connection between `red` and `orange`\n * result = connectWithEdges(g, { a: `red`, b: `orange` });\n *\n * // Make a connection between `red` and `orange as well as `red` and `yellow`.\n * result = connectWithEdges(g, { a: `red`, b: [`orange`, `yellow`] })\n * ```\n * @param graph Initial graph\n * @param options Options\n */\nexport function connectWithEdges(graph, options) {\n    const { a, weight, b } = options;\n    const destinations = Array.isArray(b) ? b : [b];\n    const edges = [];\n    for (const destination of destinations) {\n        const result = connectTo(graph, a, destination, weight);\n        graph = result.graph;\n        edges.push(result.edge);\n    }\n    return { graph, edges };\n}\nexport const graph = (...initialConnections) => {\n    let g = {\n        vertices: immutableMap(),\n        edges: []\n    };\n    for (const ic of initialConnections) {\n        g = connect(g, ic);\n    }\n    return g;\n};\nexport function toAdjacencyMatrix(graph) {\n    const v = [...graph.vertices.values()];\n    const table = new Table();\n    table.labelColumns(...v.map(vv => vv.id));\n    table.labelRows(...v.map(vv => vv.id));\n    // eslint-disable-next-line unicorn/prevent-abbreviations\n    for (let i = 0; i < v.length; i++) {\n        table.setRow(i, false, v.length);\n        const ii = v[i];\n        // eslint-disable-next-line unicorn/prevent-abbreviations\n        for (const [j, jj] of v.entries()) {\n            const connected = hasConnection(graph, ii, jj);\n            if (connected) {\n                table.set(i, j, true);\n            }\n        }\n    }\n    return table;\n}\n/**\n * Return a string representation of the graph for debug inspection\n * @param graph\n * @returns\n */\nexport const dumpGraph = (graph) => {\n    const lines = debugGraphToArray(graph);\n    return lines.join(`\\n`);\n};\n/**\n * Return an array of a debug-print of every vertex.\n * @param graph\n * @returns\n */\nconst debugGraphToArray = (graph) => {\n    const r = [];\n    r.push(`Vertices: ${[...graph.vertices.values()].map(v => v.id).join(`, `)}`);\n    r.push(`Edges:`);\n    for (const edge of graph.edges) {\n        r.push(stringForEdge(edge));\n    }\n    return r;\n};\nconst stringForEdge = (edge) => {\n    const weight = edge.weight ? ` (${edge.weight})` : ``;\n    return `${edge.a} <-> ${edge.b}${weight}`;\n};\n/**\n * Iterate over all the vertices connectd to `context` vertex\n * @param graph Graph\n * @param context id or Vertex\n * @returns\n */\nexport function* adjacentVertices(graph, context) {\n    if (context === undefined)\n        return;\n    const vertex = typeof context === `string` ? graph.vertices.get(context) : context;\n    if (vertex === undefined)\n        throw new Error(`Vertex not found ${JSON.stringify(context)}`);\n    for (const edge of graph.edges) {\n        if (edge.a === context)\n            yield resolveVertex(graph, edge.b);\n        else if (edge.b === context)\n            yield resolveVertex(graph, edge.a);\n    }\n}\nexport function* edgesForVertex(graph, context) {\n    if (context === undefined)\n        return;\n    const vertex = typeof context === `string` ? graph.vertices.get(context) : context;\n    if (vertex === undefined)\n        throw new Error(`Vertex not found ${JSON.stringify(context)}`);\n    for (const edge of graph.edges) {\n        if (edge.a === context)\n            yield edge;\n        else if (edge.b === context)\n            yield edge;\n    }\n}\n","/**\n * Directed graphs\n *\n * Graph _vertices_ (ie. nodes) connect to each other along _edges_.\n * This is 'directed' in that connections are not necessarily mutual.\n * A can connect to B without B connecting to A.\n *\n * Connections can have an optional weight, defaulting to 1.\n *\n * @example Creating a directed graph A connects to B and C; B connects to C. C has edges.\n * ```js\n * let g = Directed.graph(\n *  { from: `a`, to: [`b`, `c`] },\n *  { from: `b`, to: `c` }\n*  );\n* ```\n*\n* Graphs do not store data directly, only the relation between vertices. Each vertex has an id,\n* so to associate data, use a map along with the graph.\n*\n*/\nexport * as Directed from './directed-graph.js';\n/**\n * Undirected graphs\n *\n * Graph _vertices_ (ie. nodes) connect to each other along _edges_.\n * Unlike a directed graph, nodes are always mutually connected.\n *\n * @example Creating an undirected graph where vertex 0 connects to 1, 2 & 3; 2 connects to 1\n * ```js\n * let g = Undirected.graph(\n *    { a: `0`, b: [ `1`, `2`, `3` ] },\n *    { a: `2`, b: `1` }\n *  );\n* ```\n*\n* Graphs do not store data directly, only the relation between vertices. Each vertex has an id,\n* so to associate data, use a map along with the graph.\n*\n*/\nexport * as Undirected from './undirected-graph.js';\n","export * from './circular-array.js';\n/**\n * A tree-like structure of branches and leaves.\n *\n * ```js\n * import { Trees } from \"https://unpkg.com/@ixfx/collections/bundle\"\n * const root = Trees.Mutable.rootWrapped(`root`);\n * // Add 'a' as the child of the root node\n * let a = root.addValue(`a`);\n * // Add `aa` as the child of `a`\n * let b = a.addValue(`aa`);\n * b.hasParent(a); // True\n * ```\n */\nexport * as Trees from './tree/index.js';\nexport * from './tree/types.js';\n/**\n * Stacks store items in order, like a stack of plates.\n *\n * ```js\n * import { Stacks } from \"https://unpkg.com/@ixfx/collections/bundle\"\n * let s = Stacks.immutable();\n * s = s.push(`a`, `b`);   // Add two strings\n * // Peek looks at the top of the stack\n * // (ie most recently added)\n * s.peek; // `b`\n * // Remove item from top of stack\n * s = s.pop();\n * s.peek // `a`\n * ```\n */\nexport * as Stacks from './stack/index.js';\nexport { StackMutable } from './stack/StackMutable.js';\nexport { StackImmutable } from './stack/StackImmutable.js';\n/**\n * Sets store unique items.\n */\nexport * as Sets from './set/index.js';\nexport * from './set/Types.js';\nexport { SetStringMutable } from './set/set-mutable.js';\nexport { SetStringImmutable } from './set/SetImmutable.js';\nexport * from './set/ISetMutable.js';\n/**\n * Queues store items in the order in which they are added.\n */\nexport * as Queues from './queue/index.js';\nexport { QueueMutable } from './queue/queue-mutable.js';\nexport { QueueImmutable } from './queue/queue-immutable.js';\n/**\n * Maps associate keys with values.\n */\nexport * as Maps from './map/index.js';\nexport { ExpiringMap } from './map/expiring-map.js';\nexport { MapOfSimpleMutable } from './map/map-of-simple-mutable.js';\n/**\n * Undirected and directed graphs and associated algorithms.\n *\n * @example\n * ```js\n * import { Graphs } from \"https://unpkg.com/@ixfx/collections/bundle\"\n * const Dg = Graphs.Directed;\n * let g = Dg.graph();\n * g = Dg.connect(g, { from: `a`, to: `b` });\n * g = Dg.connect(g, { from: `b`, to: `c` });\n * g = Dg.connect(g, { from: `c`, to: `a` });\n * Dg.dumpGraph(g);\n * // A -> B, B -> C, C -> A\n * ```\n */\nexport * as Graphs from './graph/index.js';\nexport { Table } from './table.js';\n","const t = {\n    name: `root`,\n    seq: [\n        `walk_to_door`,\n        {\n            name: `door_locked`,\n            sel: [\n                `open_door`,\n                {\n                    name: `open_locked_door`,\n                    seq: [`unlock_door`, `open_door`]\n                },\n                `smash_door`\n            ]\n        },\n        `walk_through_door`,\n        `close_door`\n    ]\n};\nconst getName = (t, defaultValue = ``) => {\n    if (typeof t === `object` && `name` in t && t.name !== undefined)\n        return t.name;\n    return defaultValue;\n};\n//eslint-disable-next-line func-style\nexport function* iterateBreadth(t, pathPrefix) {\n    if (typeof pathPrefix === `undefined`) {\n        pathPrefix = getName(t);\n    }\n    for (const [index, n] of entries(t)) {\n        yield [n, pathPrefix];\n    }\n    for (const [index, n] of entries(t)) {\n        const name = getName(n, `?`);\n        const prefix = pathPrefix.length > 0 ? pathPrefix + `.` + name : name;\n        yield* iterateBreadth(n, prefix);\n    }\n}\n//eslint-disable-next-line func-style\nexport function* iterateDepth(t, pathPrefix) {\n    if (typeof pathPrefix === `undefined`) {\n        pathPrefix = getName(t);\n    }\n    for (const [index, n] of entries(t)) {\n        yield [n, pathPrefix];\n        const name = getName(n, `?`);\n        const prefix = pathPrefix.length > 0 ? pathPrefix + `.` + name : name;\n        yield* iterateBreadth(n, prefix);\n    }\n}\n//eslint-disable-next-line func-style\nfunction isSeqNode(n) {\n    return n.seq !== undefined;\n}\n//eslint-disable-next-line func-style\nfunction isSelNode(n) {\n    return n.sel !== undefined;\n}\n//eslint-disable-next-line func-style\nfunction* entries(n) {\n    if (isSeqNode(n)) {\n        yield* n.seq.entries();\n    }\n    else if (isSelNode(n)) {\n        yield* n.sel.entries();\n    }\n    else if (typeof n === `string`) {\n        // no-op\n    }\n    else {\n        throw new TypeError(`Unexpected shape of node. seq/sel missing`);\n    }\n}\n// for (const tn of iterateBreadth(t)) {\n//   console.log(`Path: ${ tn[ 1 ] }`);\n//   console.log(`Node: ${ JSON.stringify(tn[ 0 ]) }`);\n// }\n// console.log(`---`);\n// for (const tn of iterateDepth(t)) {\n//   console.log(`Path: ${ tn[ 1 ] }`);\n//   console.log(`Node: ${ JSON.stringify(tn[ 0 ]) }`);\n// }\n","import { intervalToMs } from '@ixfx/core';\nimport { sleep } from '@ixfx/core';\n/**\n * Pauses execution for interval after which the asynchronous `callback` is executed and awaited.\n * Must be called with `await` if you want the pause effect.\n *\n * @example Pause and wait for function\n * ```js\n * const result = await delay(async () => Math.random(), 1000);\n * console.log(result); // Prints out result after one second\n * ```\n *\n * If the `interval` option is a number its treated as milliseconds. {@link Interval} can also be used:\n * ```js\n * const result = await delay(async () => Math.random(), { mins: 1 });\n * ```\n *\n * If `await` is omitted, the function will run after the provided timeout, and code will continue to run.\n *\n * @example Schedule a function without waiting\n * ```js\n * await delay(async () => {\n *  console.log(Math.random())\n * }, 1000);\n * // Prints out a random number after 1 second.\n * ```\n *\n * {@link delay} and {@link sleep} are similar. `delay()` takes a parameter of what code to execute after the timeout, while `sleep()` just resolves after the timeout.\n *\n * Optionally takes an AbortSignal to cancel delay.\n * ```js\n * const ac = new AbortController();\n * // Super long wait\n * await delay(someFn, { signal: ac.signal, hours: 1 }}\n * ...\n * ac.abort(); // Cancels long delay\n * ```\n *\n * It also allows choice of when delay should happen.\n * If you want to be able to cancel or re-run a delayed function, consider using\n * {@link timeout} instead.\n *\n * @typeParam V - Type of callback return value\n * @param callback What to run after interval\n * @param optsOrMillis Options for delay, or millisecond delay. By default delay is before `callback` is executed.\n * @return Returns result of `callback`.\n */\nexport const delay = async (callback, \n//eslint-disable-next-line functional/prefer-immutable-types\noptsOrMillis) => {\n    const opts = typeof optsOrMillis === `number` ? { millis: optsOrMillis } : optsOrMillis;\n    const delayWhen = opts.delay ?? `before`;\n    if (delayWhen === `before` || delayWhen === `both`) {\n        await sleep(opts);\n    }\n    const r = Promise.resolve(await callback());\n    if (delayWhen === `after` || delayWhen === `both`) {\n        await sleep(opts);\n    }\n    return r;\n};\n/**\n * Iterate over a source iterable with some delay between results.\n * Delay can be before, after or both before and after each result from the\n * source iterable.\n *\n * Since it's an async iterable, `for await ... of` is needed.\n *\n * ```js\n * const opts = { intervalMs: 1000, delay: 'before' };\n * const iterable = count(10);\n * for await (const i of delayIterable(iterable, opts)) {\n *  // Prints 0..9 with one second between\n * }\n * ```\n *\n * Use {@link delay} to return a result after some delay\n *\n * @param iter\n * @param opts\n */\n// export async function* delayIterable<V>(\n//   iter: AsyncIterable<V> | Iterable<V>,\n//   //eslint-disable-next-line functional/prefer-immutable-types\n//   opts: DelayOpts\n// ) {\n//   const intervalMs = intervalToMs(opts);\n//   const delayWhen = opts.delay;\n//   const signal = opts.signal;\n//   for await (const v of iter) {\n//     // Pre-delay\n//     if (delayWhen === 'before' || delayWhen === 'both') {\n//       await sleep({ millis: intervalMs, signal });\n//       if (signal?.aborted) break;\n//     }\n//     // Yield value\n//     yield v;\n//     // Post-delay\n//     if (delayWhen === 'after' || delayWhen === 'both') {\n//       await sleep({ millis: intervalMs, signal });\n//       if (signal?.aborted) break;\n//     }\n//   }\n// }\n/**\n * Async generator that loops via `requestAnimationFrame`.\n *\n * We can use `for await of` to run code:\n * ```js\n * const loop = delayAnimationLoop();\n * for await (const o of loop) {\n *  // Do something...\n *  // Warning: loops forever\n * }\n * // Warning: execution doesn't continue to this point\n * // unless there is a 'break' in loop.\n * ```\n *\n * Or use the generator in manually:\n * ```js\n * // Loop forever\n * (async () => {\n *  const loop = delayAnimationLoop();\n *  while (true) {\n *    await loop.next();\n *\n *    // Do something...\n *    // Warning: loops forever\n *  }\n * })();\n * ```\n *\n * Practically, these approaches are not so useful\n * because execution blocks until the loop finishes.\n *\n * Instead, we might want to continually loop a bit\n * of code while other bits of code continue to run.\n *\n * The below example shows how to do this.\n *\n * ```js\n * setTimeout(async () => {\n *  for await (const _ of delayAnimationLoop()) {\n *    // Do soething at animation speed\n *  }\n * });\n *\n * // Execution continues while loop also runs\n * ```\n *\n */\nasync function* delayAnimationLoop() {\n    let resolve;\n    let p = new Promise((r) => (resolve = r));\n    let timer = 0;\n    const callback = () => {\n        if (resolve)\n            resolve();\n        p = new Promise((r) => (resolve = r));\n    };\n    try {\n        while (true) {\n            timer = globalThis.requestAnimationFrame(callback);\n            // eslint-disable-next-line @typescript-eslint/no-confusing-void-expression\n            const _ = await p;\n            yield _;\n        }\n    }\n    finally {\n        if (resolve)\n            resolve();\n        globalThis.cancelAnimationFrame(timer);\n    }\n}\n/**\n * Async generator that loops at a given interval.\n *\n * @example\n * For Await loop every second\n * ```js\n * const loop = delayLoop(1000);\n * // Or: const loop = delayLoop({ secs: 1 });\n * for await (const o of loop) {\n *  // Do something...\n *  // Warning: loops forever\n * }\n * ```\n *\n * @example\n * Loop runs every second\n * ```js\n * (async () => {\n *  const loop = delayLoop(1000);\n *  // or: loop = delayLoop({ secs: 1 });\n *  while (true) {\n *    await loop.next();\n *\n *    // Do something...\n *    // Warning: loops forever\n *  }\n * })();\n * ```\n *\n * Alternatives:\n * * {@link delay} to run a single function after a delay\n * * {@link sleep} pause execution\n * * {@link continuously} to start/stop/adjust a constantly running loop\n *\n * @param timeout Delay. If 0 is given, `requestAnimationFrame` is used over `setTimeout`.\n */\nexport async function* delayLoop(timeout) {\n    const timeoutMs = intervalToMs(timeout);\n    if (typeof timeoutMs === `undefined`)\n        throw new Error(`timeout is undefined`);\n    if (timeoutMs < 0)\n        throw new Error(`Timeout is less than zero`);\n    if (timeoutMs === 0)\n        return yield* delayAnimationLoop();\n    let resolve;\n    let p = new Promise((r) => (resolve = r));\n    let timer;\n    const callback = () => {\n        if (resolve)\n            resolve();\n        p = new Promise((r) => (resolve = r));\n    };\n    try {\n        while (true) {\n            timer = globalThis.setTimeout(callback, timeoutMs);\n            // eslint-disable-next-line @typescript-eslint/no-confusing-void-expression\n            const _ = await p;\n            yield _;\n        }\n    }\n    finally {\n        if (resolve)\n            resolve();\n        if (timer !== undefined)\n            globalThis.clearTimeout(timer);\n        timer = undefined;\n    }\n}\n","import { integerTest, resultToError, resultIsError, resultThrow } from '@ixfx/guards';\nimport {} from '@ixfx/core';\nimport { intervalToMs } from '@ixfx/core';\n/**\n * Returns a {@link Timeout} that can be triggered, cancelled and reset. Use {@link continuously} for interval-\n * based loops.\n *\n * Once `start()` is called, `callback` will be scheduled to execute after `interval`.\n * If `start()` is called again, the waiting period will be reset to `interval`.\n *\n * @example Essential functionality\n * ```js\n * const fn = () => {\n *  console.log(`Executed`);\n * };\n * const t = timeout(fn, 60*1000);\n * t.start();   // After 1 minute `fn` will run, printing to the console\n * ```\n *\n * @example Control execution functionality\n * ```\n * t.cancel();  // Cancel it from running\n * t.start();   // Schedule again after 1 minute\n * t.start(30*1000); // Cancel that, and now scheduled after 30s\n *\n * // Get the current state of timeout\n * t.runState;    // \"idle\", \"scheduled\" or \"running\"\n * ```\n *\n * Callback function receives any additional parameters passed in from start. This can be useful for passing through event data:\n *\n * @example\n * ```js\n * const t = timeout( (elapsedMs, ...args) => {\n *  // args contains event data\n * }, 1000);\n * el.addEventListener(`click`, t.start);\n * ```\n *\n * Asynchronous callbacks can be used as well:\n * ```js\n * timeout(async () => {...}, 100);\n * ```\n *\n * If you don't expect to need to control the timeout, consider using {@link delay},\n * which can run a given function after a specified delay.\n * @param callback\n * @param interval\n * @returns {@link Timeout}\n */\nexport const timeout = (callback, interval) => {\n    if (callback === undefined) {\n        throw new Error(`callback parameter is undefined`);\n    }\n    const intervalMs = intervalToMs(interval);\n    resultThrow(integerTest(intervalMs, `aboveZero`, `interval`));\n    let timer;\n    let startedAt = 0;\n    let startCount = 0;\n    let startCountTotal = 0;\n    let state = `idle`;\n    const clear = () => {\n        startedAt = 0;\n        globalThis.clearTimeout(timer);\n        state = `idle`;\n    };\n    const start = async (altInterval = interval, args) => {\n        const p = new Promise((resolve, reject) => {\n            startedAt = performance.now();\n            const altTimeoutMs = intervalToMs(altInterval);\n            const it = integerTest(altTimeoutMs, `aboveZero`, `altTimeoutMs`);\n            if (resultIsError(it)) {\n                reject(resultToError(it));\n                return;\n            }\n            switch (state) {\n                case `scheduled`: {\n                    // Cancel other scheduled execution\n                    cancel();\n                    break;\n                }\n                case `running`: {\n                    //console.warn(`Timeout being rescheduled while task is already running`);\n                    break;\n                }\n            }\n            state = `scheduled`;\n            // eslint-disable-next-line @typescript-eslint/no-misused-promises\n            timer = globalThis.setTimeout(async () => {\n                if (state !== `scheduled`) {\n                    console.warn(`Timeout skipping execution since state is not 'scheduled'`);\n                    clear();\n                    return;\n                }\n                const args_ = args ?? [];\n                startCount++;\n                startCountTotal++;\n                state = `running`;\n                await callback(performance.now() - startedAt, ...args_);\n                state = `idle`;\n                clear();\n                resolve();\n            }, altTimeoutMs);\n        });\n        return p;\n    };\n    const cancel = () => {\n        if (state === `idle`)\n            return;\n        clear();\n    };\n    return {\n        start,\n        cancel,\n        get runState() {\n            return state;\n        },\n        get startCount() {\n            return startCount;\n        },\n        get startCountTotal() {\n            return startCountTotal;\n        }\n    };\n};\n// const average = movingAverageLight();\n// const rm = rateMinimum({\n//   interval: { secs: 1 },\n//   whatToCall: (distance: number) => {\n//     average(distance);\n//   },\n//   fallback() {\n//     return 0;\n//   }\n// })\n// document.addEventListener(`pointermove`, event => {\n//   rm(event.movementX + event.movementY);\n// });\n","import { timeout, } from './timeout.js';\n/**\n * Returns a debounce function which acts to filter calls to a given function `fn`.\n *\n * Eg, Let's create a debounced wrapped for a function:\n * ```js\n * const fn = () => console.log('Hello');\n * const debouncedFn = debounce(fn, 1000);\n * ```\n *\n * Now we can call `debouncedFn()` as often as we like, but it will only execute\n * `fn()` after 1 second has elapsed since the last invocation. It essentially filters\n * many calls to fewer calls. Each time `debounceFn()` is called, the timeout is\n * reset, so potentially `fn` could never be called if the rate of `debounceFn` being called\n * is faster than the provided timeout.\n *\n * Remember that to benefit from `debounce`, you must call the debounced wrapper, not the original function.\n *\n * ```js\n * // Create\n * const d = debounce(fn, 1000);\n *\n * // Don't do this if we want to benefit from the debounce\n * fn();\n *\n * // Use the debounced wrapper\n * d(); // Only calls fn after 1000s\n * ```\n *\n * A practical use for this is handling high-frequency streams of data, where we don't really\n * care about processing every event, only last event after a period. Debouncing is commonly\n * used on microcontrollers to prevent button presses being counted twice.\n *\n * @example Handle most recent pointermove event after 1000ms\n * ```js\n * // Set up debounced handler\n * const moveDebounced = debounce((elapsedMs, evt) => {\n *    // Handle event\n * }, 500);\n *\n * // Wire up event\n * el.addEventListener(`pointermove`, moveDebounced);\n * ```\n *\n * Arguments can be passed to the debounced function:\n *\n * ```js\n * const fn = (x) => console.log(x);\n * const d = debounce(fn, 1000);\n * d(10);\n * ```\n *\n * If the provided function is asynchronous, it's possible to await the debounced\n * version as well. If the invocation was filtered, it returns instantly.\n *\n * ```js\n * const d = debounce(fn, 1000);\n * await d();\n * ```\n * @param callback Function to filter access to\n * @param interval Minimum time between invocations\n * @returns Debounce function\n */\nexport const debounce = (callback, interval) => {\n    const t = timeout(callback, interval);\n    return (...args) => { t.start(undefined, args); };\n};\n","/**\n * Maintains a list of listeners to receive data\n *\n * ```js\n * const d = new DispatchList();\n *\n * // Eg: add a listener\n * d.add(v => {\n *  // Handle a value\n * });\n *\n * // Eg. send a value to all listeners\n * d.notify(`some value`);\n * ```\n */\nexport class DispatchList {\n    #handlers;\n    #counter = 0;\n    #id = Math.floor(Math.random() * 100);\n    constructor() {\n        this.#handlers = [];\n    }\n    /**\n     * Returns _true_ if list is empty\n     * @returns\n     */\n    isEmpty() {\n        return this.#handlers.length === 0;\n    }\n    /**\n     * Adds a handler. You get back an id which can be used\n     * to remove the handler later.\n     *\n     * Handlers can be added with 'once' flag set to _true_. This will\n     * automatically remove them after the first value is sent to them.\n     * @param handler\n     * @param options\n     * @returns\n     */\n    add(handler, options = {}) {\n        this.#counter++;\n        const once = options.once ?? false;\n        const wrap = {\n            id: `${this.#id} - ${this.#counter}`,\n            handler,\n            once\n        };\n        this.#handlers.push(wrap);\n        return wrap.id;\n    }\n    /**\n     * Remove a handler by its id.\n     * @param id\n     * @returns _True_ if handler was removed, _false_ if not found.\n     */\n    remove(id) {\n        const length = this.#handlers.length;\n        this.#handlers = this.#handlers.filter(handler => handler.id !== id);\n        return this.#handlers.length !== length;\n    }\n    /**\n     * Emit a value to all handlers\n     * @param value\n     */\n    notify(value) {\n        for (const handler of this.#handlers) {\n            handler.handler(value);\n            if (handler.once) {\n                this.remove(handler.id);\n            }\n        }\n    }\n    /**\n     * Remove all handlers\n     */\n    clear() {\n        this.#handlers = [];\n    }\n}\n","import { integerTest, resultThrow } from \"@ixfx/guards\";\n/**\n * Returns true for every _n_th call, eg 2 for every second call.\n *\n * If `nth` is 1, returns true for everything. 0 will be false for everything.\n *\n * Usage:\n * ```js\n * const tenth = everyNth(10);\n * window.addEventListener(`pointermove`, evt => {\n *  if (!tenth(evt)) return; // Filter out\n *  // Continue processing, it is the 10th thing.\n *\n * });\n * ```\n *\n * Alternative:\n * ```js\n * window.addEventListener(`pointermove`, everyNth(10, evt => {\n *  // Do something with tenth item...\n * });\n * ```\n * @param nth Every nth item\n * @param callback\n * @returns Function which in turn returns true if nth call has been hit, false otherwise\n */\nexport const everyNth = (nth, callback) => {\n    resultThrow(integerTest(nth, `positive`, `nth`));\n    let counter = 0;\n    return (data) => {\n        counter++;\n        if (counter === nth) {\n            counter = 0;\n            if (callback)\n                callback(data);\n            return true;\n        }\n        return false;\n    };\n};\n","import { defaultComparer } from '@ixfx/core';\nimport { shuffle } from '@ixfx/arrays';\n/**\n * Runs a series of async expressions, returning the results.\n * Use {@link runSingle} if it's only a single result you care about.\n *\n * @example Run three functions, returning the highest-ranked result.\n * ```js\n * const result = runSingle([\n *  () => 10,\n *  () => 2,\n *  () => 3\n * ]);\n * // Yields: 10\n * ```\n *\n * Options can be passed for evaluation:\n * ```js\n * const result = run([\n *  (args) => {\n *    if (args === 'apple') return 100;\n *  },\n *  () => {\n *    return 10;\n *  }\n * ])\n * ```\n *\n * ```js\n * const expr = [\n *  (opts) => 10,\n *  (opts) => 2,\n *  (opts) => 3\n * ];\n * const opts = {\n *  rank: (a, b) => {\n *    if (a < b) return -1;\n *    if (a > b) return 1;\n *    return 0;\n *  }\n * }\n * const result = await run(expr, opts);\n * // Returns: 2\n * ```\n *\n * In terms of typing, it takes an generic arguments `ArgsType` and `ResultType`:\n * - `ArgsType`: type of expression arguments. This might be `void` if no arguments are used.\n * - `ResultType`:  return type of expression functions\n *\n * Thus the `expressions` parameter is an array of functions:\n * ```js\n * (args:ArgsType|undefined) => ResultType|undefined\n * // or\n * (args:ArgsType|undefined) => Promise<ResultType|undefined>\n * ```\n *\n * Example:\n * ```js\n * const expressions = [\n *  // Function takes a string arg\n *  (args:string) => return true; // boolean is the necessary return type\n * ];\n * const run<string,boolean>(expressions, opts, 'hello');\n * ```\n * @param expressions\n * @param opts\n * @param args\n * @returns\n */\nexport const run = async (expressions, opts = {}, args) => {\n    const results = [];\n    const compareFunction = opts.rank ?? defaultComparer;\n    let expressionsArray = Array.isArray(expressions)\n        ? (expressions)\n        : [expressions];\n    if (opts.shuffle)\n        expressionsArray = shuffle(expressionsArray);\n    for (let index = 0; index < expressionsArray.length; index++) {\n        const exp = expressionsArray[index];\n        let r;\n        if (typeof exp === 'function') {\n            // @ts-ignore\n            r = await exp(args);\n        }\n        else {\n            r = exp;\n        }\n        if (r !== undefined) {\n            results.push(r);\n            results.sort(compareFunction);\n        }\n        if (typeof opts.stop !== 'undefined') {\n            if (opts.stop(r, results)) {\n                break;\n            }\n        }\n    }\n    if (opts.filter) {\n        return results.filter(opts.filter);\n    }\n    return results;\n};\n/**\n * Like {@link run}, but it returns a single result or _undefined_.\n * Use the `at` option to specify which index of results to use.\n * By default it's -1, which is the presumably the highest-ranked result.\n *\n * @param expressions\n * @param opts\n * @param args\n * @returns\n */\nexport const runSingle = async (expressions, opts = {}, args) => {\n    const results = await run(expressions, opts, args);\n    if (!results)\n        return;\n    if (results.length === 0)\n        return;\n    const at = opts.at ?? -1;\n    return results.at(at);\n};\n","/**\n * Subscribes to events on `target`, returning the event data\n * from the first event that fires.\n *\n * By default waits a maximum of 1 minute.\n *\n * Automatically unsubscribes on success or failure (ie. timeout)\n *\n * ```js\n * // Event will be data from either event, whichever fires first\n * // Exception is thrown if neither fires within 1 second\n * const event = await eventRace(document.body, [`pointermove`, `pointerdown`], { timeout: 1000 });\n * ```\n * @param target Event source\n * @param eventNames Event name(s)\n * @param options Options\n * @returns\n */\nexport const eventRace = (target, eventNames, options = {}) => {\n    const intervalMs = options.timeoutMs ?? 60_1000; //intervalToMs(options.timeout, 60 * 1000);\n    const signal = options.signal;\n    let triggered = false;\n    let disposed = false;\n    let timeout;\n    const promise = new Promise((resolve, reject) => {\n        const onEvent = (event) => {\n            if (`type` in event) {\n                if (eventNames.includes(event.type)) {\n                    triggered = true;\n                    resolve(event);\n                    dispose();\n                }\n                else {\n                    console.warn(`eventRace: Got event '${event.type}' that is not in race list`);\n                }\n            }\n            else {\n                console.warn(`eventRace: Event data does not have expected 'type' field`);\n                console.log(event);\n            }\n        };\n        for (const name of eventNames) {\n            target.addEventListener(name, onEvent);\n        }\n        const dispose = () => {\n            if (disposed)\n                return;\n            if (timeout !== undefined)\n                clearTimeout(timeout);\n            timeout = undefined;\n            disposed = true;\n            for (const name of eventNames) {\n                target.removeEventListener(name, onEvent);\n            }\n        };\n        timeout = setTimeout(() => {\n            if (triggered || disposed)\n                return;\n            dispose();\n            reject(new Error(`eventRace: Events not fired within interval. Events: ${JSON.stringify(eventNames)} Interval: ${intervalMs}`));\n        }, intervalMs);\n        signal?.addEventListener(`abort`, () => {\n            if (triggered || disposed)\n                return;\n            dispose();\n            reject(new Error(`Abort signal received ${signal.reason}`));\n        });\n    });\n    return promise;\n};\n","import { movingAverageLight } from \"@ixfx/numbers\";\nimport { rateMinimum } from \"@ixfx/flow\";\n/**\n * Uses the same algorithm as {@link movingAverageLight}, but adds values automatically if\n * nothing has been manually added.\n *\n * ```js\n * // By default, 0 is added if interval elapses\n * const mat = movingAverageTimed({ interval: 1000 });\n * mat(10); // Add value of 10, returns latest average\n *\n * mat(); // Get current average\n * ```\n *\n * This is useful if you are averaging something based on events. For example calculating the\n * average speed of the pointer. If there is no speed, there is no pointer move event. Using\n * this function, `value` is added at a rate of `updateRateMs`. This timer is reset\n * every time a value is added, a bit like the `debounce` function.\n *\n * Use an AbortSignal to cancel the timer associated with the `movingAverageTimed` function.\n * @param options\n * @returns\n */\nexport const movingAverageTimed = (options) => {\n    const average = movingAverageLight();\n    const rm = rateMinimum({\n        ...options,\n        whatToCall: (distance) => {\n            average(distance);\n        },\n        fallback() {\n            return options.default ?? 0;\n        }\n    });\n    return (v) => {\n        rm(v);\n        return average();\n    };\n};\n","import { SimpleEventEmitter } from '@ixfx/events';\nimport * as Debug from '@ixfx/debug';\n/**\n * A use of a pool resource\n *\n * Has two events, _disposed_ and _released_.\n */\nexport class PoolUser extends SimpleEventEmitter {\n    key;\n    resource;\n    _lastUpdate;\n    _pool;\n    _state;\n    _userExpireAfterMs;\n    /**\n     * Constructor\n     * @param key User key\n     * @param resource Resource being used\n     */\n    constructor(key, resource) {\n        super();\n        this.key = key;\n        this.resource = resource;\n        this._lastUpdate = performance.now();\n        this._pool = resource.pool;\n        this._userExpireAfterMs = this._pool.userExpireAfterMs;\n        this._state = `idle`;\n        this._pool.log.log(`PoolUser ctor key: ${this.key}`);\n    }\n    /**\n     * Returns a human readable debug string\n     * @returns\n     */\n    toString() {\n        if (this.isDisposed)\n            return `PoolUser. State: disposed`;\n        return `PoolUser. State: ${this._state} Elapsed: ${performance.now() - this._lastUpdate} Data: ${JSON.stringify(this.resource.data)}`;\n    }\n    /**\n     * Resets countdown for instance expiry.\n     * Throws an error if instance is disposed.\n     */\n    keepAlive() {\n        if (this._state === `disposed`)\n            throw new Error(`PoolItem disposed`);\n        this._lastUpdate = performance.now();\n    }\n    /**\n     * @internal\n     * @param reason\n     * @returns\n     */\n    _dispose(reason, data) {\n        if (this._state === `disposed`)\n            return;\n        const resource = this.resource;\n        //const data = resource.data;\n        this._state = `disposed`;\n        resource._release(this);\n        this._pool.log.log(`PoolUser dispose key: ${this.key} reason: ${reason}`);\n        this.fireEvent(`disposed`, { data, reason });\n        super.clearEventListeners();\n    }\n    /**\n     * Release this instance\n     * @param reason\n     */\n    release(reason) {\n        if (this.isDisposed)\n            throw new Error(`User disposed`);\n        const resource = this.resource;\n        const data = resource.data;\n        this._pool.log.log(`PoolUser release key: ${this.key} reason: ${reason}`);\n        this.fireEvent(`released`, { data, reason });\n        this._dispose(`release-${reason}`, data);\n    }\n    // #region Properties\n    get data() {\n        if (this.isDisposed)\n            throw new Error(`User disposed`);\n        return this.resource.data;\n    }\n    /**\n     * Returns true if this instance has expired.\n     * Expiry counts if elapsed time is greater than `userExpireAfterMs`\n     */\n    get isExpired() {\n        if (this._userExpireAfterMs > 0) {\n            return performance.now() > this._lastUpdate + this._userExpireAfterMs;\n        }\n        return false;\n    }\n    /**\n     * Returns elapsed time since last 'update'\n     */\n    get elapsed() {\n        return performance.now() - this._lastUpdate;\n    }\n    /**\n     * Returns true if instance is disposed\n     */\n    get isDisposed() {\n        return this._state === `disposed`;\n    }\n    /**\n     * Returns true if instance is neither disposed nor expired\n     */\n    get isValid() {\n        if (this.isDisposed || this.isExpired)\n            return false;\n        if (this.resource.isDisposed)\n            return false;\n        return true;\n    }\n}\n/**\n * A resource allocated in the Pool\n */\nexport class Resource {\n    pool;\n    #state;\n    #data;\n    #users;\n    #capacityPerResource;\n    #resourcesWithoutUserExpireAfterMs;\n    #lastUsersChange;\n    /**\n     * Constructor.\n     * @param pool Pool\n     * @param data Data\n     */\n    constructor(pool, data) {\n        this.pool = pool;\n        if (data === undefined)\n            throw new Error(`Parameter 'data' is undefined`);\n        if (pool === undefined)\n            throw new Error(`Parameter 'pool' is undefined`);\n        this.#data = data;\n        this.#lastUsersChange = 0;\n        this.#resourcesWithoutUserExpireAfterMs =\n            pool.resourcesWithoutUserExpireAfterMs;\n        this.#capacityPerResource = pool.capacityPerResource;\n        this.#users = [];\n        this.#state = `idle`;\n    }\n    /**\n     * Gets data associated with resource.\n     * Throws an error if disposed\n     */\n    get data() {\n        if (this.#state === `disposed`)\n            throw new Error(`Resource disposed`);\n        return this.#data;\n    }\n    /**\n     * Changes the data associated with this resource.\n     * Throws an error if disposed or `data` is undefined.\n     * @param data\n     */\n    updateData(data) {\n        if (this.#state === `disposed`)\n            throw new Error(`Resource disposed`);\n        if (data === undefined)\n            throw new Error(`Parameter 'data' is undefined`);\n        this.#data = data;\n    }\n    /**\n     * Returns a human-readable debug string for resource\n     * @returns\n     */\n    toString() {\n        return `Resource (expired: ${this.isExpiredFromUsers} users: ${this.#users.length}, state: ${this.#state}) data: ${JSON.stringify(this.data)}`;\n    }\n    /**\n     * Assigns a user to this resource.\n     * @internal\n     * @param user\n     */\n    _assign(user) {\n        const existing = this.#users.find((u) => u === user || u.key === user.key);\n        if (existing)\n            throw new Error(`User instance already assigned to resource`);\n        this.#users.push(user);\n        this.#lastUsersChange = performance.now();\n    }\n    /**\n     * Releases a user from this resource\n     * @internal\n     * @param user\n     */\n    _release(user) {\n        this.#users = this.#users.filter((u) => u !== user);\n        this.pool._release(user);\n        this.#lastUsersChange = performance.now();\n    }\n    /**\n     * Returns true if resource can have additional users allocated\n     */\n    get hasUserCapacity() {\n        return this.usersCount < this.#capacityPerResource;\n    }\n    /**\n     * Returns number of uses of the resource\n     */\n    get usersCount() {\n        return this.#users.length;\n    }\n    /**\n     * Returns true if automatic expiry is enabled, and that interval\n     * has elapsed since the users list has changed for this resource\n     */\n    get isExpiredFromUsers() {\n        if (this.#resourcesWithoutUserExpireAfterMs <= 0)\n            return false;\n        if (this.#users.length > 0)\n            return false;\n        return (performance.now() >\n            this.#resourcesWithoutUserExpireAfterMs + this.#lastUsersChange);\n    }\n    /**\n     * Returns true if instance is disposed\n     */\n    get isDisposed() {\n        return this.#state === `disposed`;\n    }\n    /**\n     * Disposes the resource.\n     * If it is already disposed, it does nothing.\n     * @param reason\n     * @returns\n     */\n    dispose(reason) {\n        if (this.#state === `disposed`)\n            return;\n        const data = this.#data;\n        this.#state = `disposed`;\n        this.pool.log.log(`Resource disposed (${reason})`);\n        for (const u of this.#users) {\n            u._dispose(`resource-${reason}`, data);\n        }\n        this.#users = [];\n        this.#lastUsersChange = performance.now();\n        this.pool._releaseResource(this, reason);\n        if (this.pool.freeResource)\n            this.pool.freeResource(data);\n    }\n}\n/**\n * Resource pool\n * It does the housekeeping of managing a limited set of resources which are shared by 'users'.\n * All resources in the Pool are meant to be the same kind of object.\n *\n * An example is an audio sketch driven by TensorFlow. We might want to allocate a sound oscillator per detected human body. A naive implementation would be to make an oscillator for each detected body. However, because poses appear/disappear unpredictably, it's a lot of extra work to maintain the binding between pose and oscillator.\n *\n * Instead, we might use the Pool to allocate oscillators to poses. This will allow us to limit resources and clean up automatically if they haven't been used for a while.\n *\n * Resources can be added manually with `addResource()`, or automatically by providing a `generate()` function in the Pool options. They can then be accessed via a _user key_. This is meant to associated with a single 'user' of a resource. For example, if we are associating oscillators with TensorFlow poses, the 'user key' might be the id of the pose.\n */\nexport class Pool {\n    _resources;\n    _users;\n    capacity;\n    userExpireAfterMs;\n    resourcesWithoutUserExpireAfterMs;\n    capacityPerResource;\n    fullPolicy;\n    generateResource;\n    freeResource;\n    log = Debug.logSet(`Pool`);\n    /**\n     * Constructor.\n     *\n     * By default, no capacity limit, one user per resource\n     * @param options Pool options\n     */\n    constructor(options = {}) {\n        this.capacity = options.capacity ?? -1;\n        this.fullPolicy = options.fullPolicy ?? `error`;\n        this.capacityPerResource = options.capacityPerResource ?? 1;\n        this.userExpireAfterMs = options.userExpireAfterMs ?? -1;\n        this.resourcesWithoutUserExpireAfterMs =\n            options.resourcesWithoutUserExpireAfterMs ?? -1;\n        this.generateResource = options.generate;\n        this.freeResource = options.free;\n        this._users = new Map();\n        this._resources = [];\n        this.log = Debug.logSet(`Pool`, options.debug ?? false);\n        // If we have a time-based expiry, set an interval to\n        // automatically do the housekeeping\n        const timer = Math.max(this.userExpireAfterMs, this.resourcesWithoutUserExpireAfterMs);\n        if (timer > 0) {\n            setInterval(() => {\n                this.maintain();\n            }, timer * 1.1);\n        }\n    }\n    /**\n     * Returns a debug string of Pool state\n     * @returns\n     */\n    dumpToString() {\n        let r = `Pool\n    capacity: ${this.capacity} userExpireAfterMs: ${this.userExpireAfterMs} capacityPerResource: ${this.capacityPerResource}\n    resources count: ${this._resources.length}`;\n        const resource = this._resources.map((r) => r.toString()).join(`\\r\\n\\t`);\n        r += `\\r\\nResources:\\r\\n\\t` + resource;\n        r += `\\r\\nUsers: \\r\\n`;\n        for (const [k, v] of this._users.entries()) {\n            r += `\\tk: ${k} v: ${v.toString()}\\r\\n`;\n        }\n        return r;\n    }\n    /**\n     * Sorts users by longest elapsed time since update\n     * @returns\n     */\n    getUsersByLongestElapsed() {\n        return [...this._users.values()].sort((a, b) => {\n            const aa = a.elapsed;\n            const bb = b.elapsed;\n            if (aa === bb)\n                return 0;\n            if (aa < bb)\n                return 1;\n            return -1;\n        });\n    }\n    /**\n     * Returns resources sorted with least used first\n     * @returns\n     */\n    getResourcesSortedByUse() {\n        return [...this._resources].sort((a, b) => {\n            if (a.usersCount === b.usersCount)\n                return 0;\n            if (a.usersCount < b.usersCount)\n                return -1;\n            return 1;\n        });\n    }\n    /**\n     * Adds a shared resource to the pool\n     * @throws Error if the capacity limit is reached or resource is null\n     * @param resource\n     * @returns\n     */\n    addResource(resource) {\n        if (resource === undefined) {\n            throw new Error(`Cannot add undefined resource`);\n        }\n        if (resource === null)\n            throw new TypeError(`Cannot add null resource`);\n        if (this.capacity > 0 && this._resources.length === this.capacity) {\n            throw new Error(`Capacity limit (${this.capacity}) reached. Cannot add more.`);\n        }\n        this.log.log(`Adding resource: ${JSON.stringify(resource)}`);\n        const pi = new Resource(this, resource);\n        this._resources.push(pi);\n        return pi;\n    }\n    /**\n     * Performs maintenance, removing disposed/expired resources & users.\n     * This is called automatically when using a resource.\n     */\n    maintain() {\n        let changed = false;\n        // Find all disposed resources\n        const nuke = [];\n        for (const p of this._resources) {\n            if (p.isDisposed) {\n                this.log.log(`Maintain, disposed resource: ${JSON.stringify(p.data)}`);\n                nuke.push(p);\n            }\n            else if (p.isExpiredFromUsers) {\n                this.log.log(`Maintain, expired resource: ${JSON.stringify(p.data)}`);\n                nuke.push(p);\n            }\n        }\n        // Remove them\n        if (nuke.length > 0) {\n            for (const resource of nuke) {\n                resource.dispose(`diposed/expired`);\n            }\n            changed = true;\n        }\n        // Find 'users' to clean up\n        const userKeysToRemove = [];\n        for (const [key, user] of this._users.entries()) {\n            if (!user.isValid) {\n                this.log.log(`Maintain. Invalid user: ${user.key} (Disposed: ${user.isDisposed} Expired: ${user.isExpired} Resource disposed: ${user.resource.isDisposed})`);\n                userKeysToRemove.push(key);\n                user._dispose(`invalid`, user.data);\n            }\n        }\n        for (const userKey of userKeysToRemove) {\n            this._users.delete(userKey);\n            changed = true;\n        }\n        if (changed) {\n            this.log.log(`End: resource len: ${this._resources.length} users: ${this.usersLength}`);\n        }\n    }\n    /**\n     * Iterate over resources in the pool.\n     * To iterate over the data associated with each resource, use\n     * `values`.\n     */\n    *resources() {\n        const resource = [...this._resources];\n        for (const r of resource) {\n            yield r;\n        }\n    }\n    /**\n     * Iterate over resource values in the pool.\n     * to iterate over the resources, use `resources`.\n     *\n     * Note that values may be returned even though there is no\n     * active user.\n     */\n    *values() {\n        const resource = [...this._resources];\n        for (const r of resource) {\n            yield r.data;\n        }\n    }\n    /**\n     * Unassociate a key with a pool item\n     * @param userKey\n     */\n    release(userKey, reason) {\n        const pi = this._users.get(userKey);\n        if (!pi)\n            return;\n        pi.release(reason ?? `Pool.release`);\n    }\n    /**\n     * @internal\n     * @param user\n     */\n    _release(user) {\n        this._users.delete(user.key);\n    }\n    /**\n     * @internal\n     * @param resource\n     * @param _\n     */\n    _releaseResource(resource, _) {\n        this._resources = this._resources.filter((v) => v !== resource);\n    }\n    /**\n     * Returns true if `v` has an associted resource in the pool\n     * @param resource\n     * @returns\n     */\n    hasResource(resource) {\n        const found = this._resources.find((v) => v.data === resource);\n        return found !== undefined;\n    }\n    /**\n     * Returns true if a given `userKey` is in use.\n     * @param userKey\n     * @returns\n     */\n    hasUser(userKey) {\n        return this._users.has(userKey);\n    }\n    /**\n     * @internal\n     * @param key\n     * @param resource\n     * @returns\n     */\n    _assign(key, resource) {\n        const u = new PoolUser(key, resource);\n        this._users.set(key, u);\n        resource._assign(u);\n        return u;\n    }\n    /**\n     * Allocates a resource for `userKey`\n     * @internal\n     * @param userKey\n     * @returns\n     */\n    #allocateResource(userKey) {\n        // Sort items by number of users per pool item\n        const sorted = this.getResourcesSortedByUse();\n        // for (let i=0;i<sorted.length;i++) {\n        //   console.log(i +`. users: ` + sorted[i].usersCount);\n        // }\n        if (sorted.length > 0 && sorted[0].hasUserCapacity) {\n            // No problem, resource has capacity\n            //this.log.log(`resource has capacity: ${ sorted[ 0 ].data }`);\n            const u = this._assign(userKey, sorted[0]);\n            return u;\n        }\n        // If resource count is below capacity, can we generate more?\n        if (this.generateResource &&\n            (this.capacity < 0 || this._resources.length < this.capacity)) {\n            this.log.log(`capacity: ${this.capacity} resources: ${this._resources.length}`);\n            const resourceGenerated = this.addResource(this.generateResource());\n            const u = this._assign(userKey, resourceGenerated);\n            return u;\n        }\n    }\n    /**\n     * Return the number of users\n     */\n    get usersLength() {\n        return [...this._users.values()].length;\n    }\n    /**\n     * 'Uses' a resource, returning the value\n     * @param userKey\n     * @returns\n     */\n    useValue(userKey) {\n        const resource = this.use(userKey);\n        return resource.resource.data;\n    }\n    /**\n     * Gets a pool item based on a 'user' key.\n     *\n     * The same key should return the same pool item,\n     * for as long as it still exists.\n     *\n     * If a 'user' already has a resource, it will 'keep alive' their use.\n     * If a 'user' does not already have resource\n     *  - if there is capacity, a resource is allocated to user\n     *  - if pool is full\n     *    - fullPolicy = 'error': an error is thrown\n     *    - fullPolicy = 'evictOldestUser': evicts an older user\n     *    - Throw error\n     * @param userKey\n     * @throws Error If all resources are used and fullPolicy = 'error'\n     * @returns\n     */\n    use(userKey) {\n        const pi = this._users.get(userKey);\n        if (pi) {\n            pi.keepAlive();\n            return pi;\n        }\n        this.maintain();\n        const match = this.#allocateResource(userKey);\n        if (match)\n            return match;\n        // Throw an error if all items are being used\n        if (this.fullPolicy === `error`) {\n            //console.log(this.dumpToString());\n            throw new Error(`Pool is fully used (fullPolicy: ${this.fullPolicy}, capacity: ${this.capacity})`);\n        }\n        // Evict oldest user\n        if (this.fullPolicy === `evictOldestUser`) {\n            const users = this.getUsersByLongestElapsed();\n            if (users.length > 0) {\n                this.release(users[0].key, `evictedOldestUser`);\n                const match2 = this.#allocateResource(userKey);\n                if (match2)\n                    return match2;\n            }\n        }\n        // Evict newest user\n        // Evict from random pool item\n        throw new Error(`Pool is fully used (${this.fullPolicy})`);\n    }\n}\n/**\n * Creates an instance of a Pool\n * @param options\n * @returns\n */\nexport const create = (options = {}) => new Pool(options);\n","/**\n * Creates a new Promise, returning the promise\n * along with its resolve and reject functions.\n *\n * ```js\n * const { promise, resolve, reject } = promiseWithResolvers();\n *\n * setTimeout(() => {\n *  resolve();\n * }, 1000);\n *\n * await promise;\n * ```\n *\n * Promise would be passed somewhere that expects a promise,\n * and you're free to call `resolve` or `reject` when needed.\n * @returns\n */\nexport function promiseWithResolvers() {\n    let resolve;\n    let reject;\n    const promise = new Promise((_resolve, _reject) => {\n        resolve = _resolve;\n        reject = _reject;\n    });\n    // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n    return { promise, resolve: resolve, reject: reject };\n}\n","import { timeout } from \"./timeout.js\";\n/**\n * Ensures that `whatToCall` is executed with a given tempo.\n *\n * ```js\n * const rm = rateMinimum({\n *  fallback: () => {\n *    return Math.random();\n *  },\n *  whatToCall: (value:number) => {\n *    console.log(value);\n *  },\n *  interval: { secs: 10 }\n * });\n *\n * // Invokes `whatToCall`, resetting timeout\n * rm(10);\n *\n * // If we don't call rm() before 'interval' has elapsed,\n * // 'fallback' will be invoked\n * ```\n *\n * A practical use for this is to update calculations based on firing of events\n * as well as when they don't fire. For example user input.\n *\n * ```js\n * // Average distances\n * const average = movingAverageLight();\n * const rm = rateMinimum({\n *  interval: { secs: 1 },\n *  whatToCall: (distance: number) => {\n *    average(distance);\n *  },\n *  // If there are no pointermove events, distance is 0\n *  fallback() {\n *    return 0;\n *  }\n * })\n *\n * // Report total movemeent\n * document.addEventListener(`pointermove`, event => {\n *  rm(event.movementX + event.movementY);\n * });\n * ```\n *\n * @param options\n * @returns\n */\nexport const rateMinimum = (options) => {\n    let disposed = false;\n    const t = timeout(() => {\n        if (disposed)\n            return;\n        t.start();\n        options.whatToCall(options.fallback());\n    }, options.interval);\n    if (options.abort) {\n        options.abort.addEventListener(`abort`, _ => {\n            disposed = true;\n            t.cancel();\n        });\n    }\n    t.start();\n    return (args) => {\n        if (disposed)\n            throw new Error(`AbortSignal has been fired`);\n        t.start();\n        options.whatToCall(args);\n    };\n};\n","import { resolve, resolveSync } from '@ixfx/core';\nimport { intervalToMs } from '@ixfx/core';\nimport { sleep } from '@ixfx/core';\n/**\n * Generates values from `produce` with a time delay.\n * `produce` can be a simple function that returns a value, an async function, or a generator.\n * If `produce` returns _undefined_, generator exits.\n *\n * @example\n * Produce a random number every 500ms\n * ```js\n * const randomGenerator = repeat(() => Math.random(), 500);\n * for await (const r of randomGenerator) {\n *  // Random value every 1 second\n *  // Warning: does not end by itself, a `break` statement is needed\n * }\n * ```\n *\n * @example\n * Return values from a generator every 500ms\n * ```js\n * import { repeat } from '@ixfx/flow.js'\n * import { count } from '@ixfx/numbers.js'\n * for await (const v of repeat(count(10), { fixed: 1000 })) {\n *  // Do something with `v`\n * }\n * ```\n *\n * Options allow either fixed interval (wait this long between iterations), or a minimum interval (wait at least this long). The latter is useful if `produce` takes some time - it will only wait the remaining time or not at all.\n *\n * If the AbortSignal is triggered, an exception will be thrown, stopping iteration.\n *\n * @see {@link continuously}: loop that runs at a constant speed. Able to be started and stopped\n * @see {@link repeat}: run a function a certain number of times, collecting results\n *\n * @param produce Function/generator to use\n * @param opts\n * @typeParam T - Data type\n * @returns Returns value of `produce` function\n */\nexport async function* repeat(produce, opts) {\n    const signal = opts.signal ?? undefined;\n    const delayWhen = opts.delayWhen ?? `before`;\n    const count = opts.count ?? undefined;\n    const allowUndefined = opts.allowUndefined ?? false;\n    const minIntervalMs = opts.delayMinimum ? intervalToMs(opts.delayMinimum) : undefined;\n    const whileFunction = opts.while;\n    let cancelled = false;\n    let sleepMs = intervalToMs(opts.delay, intervalToMs(opts.delayMinimum, 0));\n    let started = performance.now();\n    const doDelay = async () => {\n        const elapsed = performance.now() - started;\n        if (typeof minIntervalMs !== `undefined`) {\n            sleepMs = Math.max(0, minIntervalMs - elapsed);\n        }\n        if (sleepMs) {\n            await sleep({ millis: sleepMs, signal });\n        }\n        started = performance.now();\n        if (signal?.aborted)\n            throw new Error(`Signal aborted ${signal.reason}`);\n    };\n    if (Array.isArray(produce))\n        produce = produce.values();\n    if (opts.onStart)\n        opts.onStart();\n    let errored = true;\n    let loopedTimes = 0;\n    try {\n        while (!cancelled) {\n            loopedTimes++;\n            if (delayWhen === `before` || delayWhen === `both`)\n                await doDelay();\n            const result = await resolve(produce);\n            if (typeof result === `undefined` && !allowUndefined) {\n                cancelled = true;\n            }\n            else {\n                yield result;\n                if (delayWhen === `after` || delayWhen === `both`)\n                    await doDelay();\n                if (count !== undefined && loopedTimes >= count)\n                    cancelled = true;\n            }\n            if (whileFunction) {\n                if (!whileFunction(loopedTimes)) {\n                    cancelled = true;\n                }\n            }\n        }\n        errored = false;\n    }\n    finally {\n        cancelled = true;\n        if (opts.onComplete)\n            opts.onComplete(errored);\n    }\n}\n;\n/**\n * Generates values from `produce` with a time delay.\n * `produce` can be a simple function that returns a value, an function, or a generator.\n * If `produce` returns _undefined_, generator exits.\n *\n * This is the synchronous version. {@link repeat} allows for delays between loops\n * as well as asynchronous callbacks.\n *\n * If the AbortSignal is triggered, an exception will be thrown, stopping iteration.\n *\n * @param produce Function/generator to use\n * @param opts Options\n * @typeParam T - Data type\n * @returns Returns value of `produce` function\n */\nexport function* repeatSync(produce, opts) {\n    const signal = opts.signal ?? undefined;\n    const count = opts.count ?? undefined;\n    const allowUndefined = opts.allowUndefined ?? false;\n    let cancelled = false;\n    if (Array.isArray(produce))\n        produce = produce.values();\n    if (opts.onStart)\n        opts.onStart();\n    let errored = true;\n    let loopedTimes = 0;\n    try {\n        while (!cancelled) {\n            loopedTimes++;\n            const result = resolveSync(produce);\n            if (typeof result === `undefined` && !allowUndefined) {\n                cancelled = true;\n            }\n            else {\n                yield result;\n                if (count !== undefined && loopedTimes >= count)\n                    cancelled = true;\n                if (signal?.aborted)\n                    cancelled = true;\n            }\n        }\n        errored = false;\n    }\n    finally {\n        cancelled = true;\n        if (opts.onComplete)\n            opts.onComplete(errored);\n    }\n}\n;\n/**\n * Logic for continuing repeats\n */\n// export type RepeatPredicate = (\n//   repeats: number,\n//   valuesProduced: number\n// ) => boolean;\n/**\n * Calls and waits for the async function `fn` repeatedly, yielding each result asynchronously.\n * Use {@link repeat} if `fn` does not need to be awaited.\n *\n * ```js\n * // Eg. iterate\n * const r = Flow.repeat(5, async () => Math.random());\n * for await (const v of r) {\n *\n * }\n * // Eg read into array\n * const results = await Array.fromAsync(Flow.repeatAwait(5, async () => Math.random()));\n * ```\n *\n * The number of repeats is determined by the first parameter. If it's a:\n * - number: how many times to repeat\n * - function: it gets called before each repeat, if it returns _false_ repeating stops.\n *\n * Using a fixed number of repeats:\n * ```js\n * // Calls - and waits - for Flow.sleep(1) 5 times\n * await Flow.repeatAwait(5, async () => {\n *    // some kind of async function where we can use await\n *    // eg. sleep for 1s\n *    await Flow.sleep(1);\n * });\n * ```\n *\n * Using a function to dynamically determine number of repeats. The function gets\n * passed the number of repeats so far as well as the number of values produced. This\n * is count of non-undefined results from `cb` that is being repeated.\n *\n * ```js\n * async function task() {\n *  // do something\n * }\n *\n * await Flow.repeatAwait(\n *  (repeats, valuesProduced) => {\n *    // Logic for deciding whether to repeat or not\n *    if (repeats > 5) return false; // Stop repeating\n *  },\n *  task\n * );\n * ```\n *\n * In the above cases we're not using the return value from `fn`. This would look like:\n * ```js\n * const g = Flow.repeatAwait(5, async () => Math.random);\n * for await (const v of g) {\n *  // Loops 5 times, v is the return value of calling `fn` (Math.random)\n * }\n * ```\n * @param countOrPredicate Number of times to repeat, or a function that returns _false_ to stop the loop.\n * @param fn Function to execute. Asynchronous functions will be awited\n * @typeParam V - Return type of repeating function\n * @returns Asynchronous generator of `fn` results.\n */\n// export function repeatAwait<V>(countOrPredicate: number | RepeatPredicate, fn: (repeats: number, valuesProduced: number) => Promise<V | undefined> | V): AsyncIterable<V> {\n//   return typeof countOrPredicate === `number` ? repeatTimesAwaited(countOrPredicate, fn) : repeatWhileAwaited(countOrPredicate, fn);\n// }\n/**\n * Calls `fn` repeatedly, yielding each result.\n * Use {@link repeatAwait} if `fn` is asynchronous and you want to wait for it.\n *\n * The number of repeats is determined by the first parameter. If it's a:\n * - number: how many times to repeat\n * - function: it gets called before each repeat, if it returns _false_ repeating stops.\n *\n * Example: using a fixed number of repeats\n * ```js\n * // Results will be an array with five random numbers\n * const results = [...repeat(5, () => Math.random())];\n *\n * // Or as an generator (note also the simpler expression form)\n * for (const result of repeat(5, Math.random)) {\n * }\n * ```\n *\n * Example: Using a function to dynamically determine number of repeats\n * ```js\n * function task() {\n * }\n *\n * Flow.repeat(\n *  (repeats, valuesProduced) => {\n *    if (repeats > 5) return false; // Stop repeating\n *  },\n *  task\n * );\n * ```\n *\n * In the above cases we're not using the return value from `fn`. To do so,\n * this would look like:\n * ```js\n * const g = Flow.repeat(5, () => Math.random);\n * for (const v of g) {\n *  // Loops 5 times, v is the return value of calling `fn` (Math.random)\n * }\n * ```\n *\n * Alternatives:\n * * {@link Flow.forEach | Flow.forEach} - if you don't need return values\n * * {@link Flow.interval} - if you want to repeatedly call something with an interval between\n * @param countOrPredicate Numnber of repeats, or a function that returns _false_ for when to stop.\n * @param fn Function to execute. Asynchronous functions will be awited\n * @typeParam V - Return type of repeating function\n * @returns Asynchronous generator of `fn` results.\n */\n// export function repeat<V>(countOrPredicate: number | RepeatPredicate, fn: (repeats: number, valuesProduced: number) => V | undefined): Generator<V> {\n//   return typeof countOrPredicate === `number` ? repeatTimes(countOrPredicate, fn) : repeatWhile(countOrPredicate, fn);\n// }\n/**\n * Calls `fn` until `predicate` returns _false_. Awaits result of `fn` each time.\n * Yields result of `fn` asynchronously\n * @param predicate\n * @param fn\n * @typeParam V - Return type of repeating function\n */\n// async function* repeatWhileAwaited<V>(predicate: RepeatPredicate, fn: (repeats: number, valuesProduced: number) => Promise<V | undefined> | V): AsyncGenerator<V> {\n//   let repeats = 0;\n//   let valuesProduced = 0;\n//   while (predicate(repeats, valuesProduced)) {\n//     repeats++;\n//     const v = await fn(repeats, valuesProduced);\n//     if (v === undefined) continue;\n//     yield v;\n//     valuesProduced++;\n//   }\n// }\n/**\n * Calls `fn` until `predicate` returns _false_. Yields result of `fn`.\n * @param predicate Determiner for whether repeating continues\n * @param fn Function to call\n * @typeParam V - Return type of repeating function\n */\n// function* repeatWhile<V>(predicate: RepeatPredicate, fn: (repeats: number, valuesProduced: number) => V | undefined): Generator<V> {\n//   let repeats = 0;\n//   let valuesProduced = 0;\n//   while (predicate(repeats, valuesProduced)) {\n//     repeats++;\n//     const v = fn(repeats, valuesProduced);\n//     if (v === undefined) continue;\n//     yield v;\n//     valuesProduced++;\n//   }\n// }\n/**\n * Calls `fn`, `count` number of times, waiting for the result of `fn`.\n * Yields result of `fn` asynchronously\n * @param count Number of times to run\n * @param fn Function to run\n * @typeParam V - Return type of repeating function\n */\n// async function* repeatTimesAwaited<V>(count: number, fn: (repeats: number, valuesProduced: number) => Promise<V | undefined> | V | undefined) {\n//   throwNumberTest(count, `positive`, `count`);\n//   let valuesProduced = 0;\n//   let repeats = 0;\n//   while (count-- > 0) {\n//     repeats++;\n//     const v = await fn(repeats, valuesProduced);\n//     if (v === undefined) continue;\n//     yield v;\n//     valuesProduced++;\n//   }\n// }\n/**\n * Calls `fn`, `count` times. Assumes a synchronous function. Yields result of `fn`.\n *\n * Note that if `fn` returns _undefined_ repeats will stop.\n * @typeParam V - Return type of repeating function\n * @param count Number of times to run\n * @param fn Function to run\n */\n// function* repeatTimes<V>(count: number, fn: (repeats: number, valuesProduced: number) => V | undefined): Generator<V> {\n//   throwNumberTest(count, `positive`, `count`);\n//   let valuesProduced = 0;\n//   let repeats = 0;\n//   while (count-- > 0) {\n//     //console.log(`Flow.repeatTimes count: ${ count } repeats: ${ repeats } values: ${ valuesProduced }`);\n//     repeats++;\n//     const v = fn(repeats, valuesProduced);\n//     if (v === undefined) continue;\n//     yield v;\n//     valuesProduced++;\n//   }\n// }\n/**\n * Repeatedly calls `fn`, reducing via `reduce`.\n *\n * ```js\n * repeatReduce(10, () => 1, (acc, v) => acc + v);\n * // Yields: 10\n *\n * // Multiplies random values against each other 10 times\n * repeatReduce(10, Math.random, (acc, v) => acc * v);\n * // Yields a single number\n * ```\n * @param countOrPredicate Number of times to run, or function to keep running\n * @param fn Function to call\n * @param initial Initial value\n * @param reduce Function to reduce value\n * @typeParam V - Return type of repeating function\n * @returns Final result\n */\n// export const repeatReduce = <V>(\n//   countOrPredicate: number | RepeatPredicate,\n//   fn: () => V | undefined,\n//   reduce: (accumulator: V, value: V) => V,\n//   initial: V\n// ): V => {\n//   return IterableReduce(repeat(countOrPredicate, fn), reduce, initial);\n//   // if (typeof countOrPredicate === `number`) {\n//   //   throwNumberTest(countOrPredicate, `positive`, `countOrPredicate`);\n//   //   while (countOrPredicate-- > 0) {\n//   //     const v = fn();\n//   //     if (v === undefined) continue;\n//   //     initial = reduce(initial, v);\n//   //   }\n//   // } else {\n//   //   //eslint-disable-next-line functional/no-let\n//   //   let repeats, valuesProduced;\n//   //   repeats = valuesProduced = 0;\n//   //   while (countOrPredicate(repeats, valuesProduced)) {\n//   //     repeats++;\n//   //     const v = fn();\n//   //     if (v === undefined) continue;\n//   //     initial = reduce(initial, v);\n//   //     valuesProduced++;\n//   //   }\n//   // }\n//   // return initial;\n// };\n","/* eslint-disable unicorn/prevent-abbreviations */\nimport { continuously } from \"@ixfx/core\";\nimport { SimpleEventEmitter } from \"@ixfx/events\";\n/**\n * Matches responses with requests, expiring requests if they do not get a response in a timely manner.\n *\n * Basic usage:\n * ```js\n * const m = new RequestResponseMatch(options);\n * // Listen for when a response matches a request\n * m.addEventListener(`match`, event => {\n *  // event: { request:Req, response:Resp}\n * });\n * // Or alternatively, listen for success and failures\n * m.addEventListener(`completed`, event => {\n *  // { request:Resp, response:Req|undefined, success:boolean }\n *  // 'response' will be data or a string error message\n * });\n * m.request(req); // Note that some request was sent\n * ...\n * m.response(resp); // Call when a response is received\n * ```\n *\n * It's also possible to wait for specific replies:\n * ```js\n * // With a promise\n * const resp = await m.requestAwait(req);\n * // With a callback\n * m.requestCallback(req, (success, resp) => {\n *  // Runs on success or failure\n * })\n * ```\n * It relies on creating an id of a request/response for them to be matched up. Use the `key`\n * option if the function can generate a key from either request or response. Or alternatively set both `keyRequest` and `keyResponse` for two functions that can generate a key for request and response respectively.\n *\n *\n * The easy case is if req & resp both have the same field:\n * ```js\n * const m = new RequestResponseMatch({\n *  key: (reqOrResp) => {\n *    // Requests has an 'id' field\n *    // Response also has an 'id' field that corresponds to the request id\n *    return reqOrResp.id;\n *  }\n * });\n * ```\n *\n * A more complicated case:\n * ```js\n * const m = new RequestResponseMatch({\n *  keyRequest: (req) => {\n *    // Requests have an 'id' field\n *    return req.id;\n *  },\n *  keyResponse: (resp) => {\n *    // Responses have id under a different field\n *    return resp.reply_to\n *  }\n * })\n * ```\n *\n * By default, error will be thrown if a response is received that doesn't match up to any request.\n */\nexport class RequestResponseMatch extends SimpleEventEmitter {\n    timeoutMs;\n    whenUnmatchedResponse;\n    keyRequest;\n    keyResponse;\n    #outgoing = new Map();\n    #maintainLoop;\n    constructor(options = {}) {\n        super();\n        if (typeof window === `undefined`) {\n            globalThis.window = {\n                setTimeout: setTimeout,\n                clearTimeout: clearTimeout\n            };\n        }\n        this.timeoutMs = options.timeoutMs ?? 1000;\n        this.whenUnmatchedResponse = options.whenUnmatchedResponse ?? `throw`;\n        this.#maintainLoop = continuously(() => this.#maintain(), this.timeoutMs * 2);\n        if (options.key) {\n            if (options.keyRequest)\n                throw new Error(`Cannot set 'keyRequest' when 'key' is set `);\n            if (options.keyResponse)\n                throw new Error(`Cannot set 'keyResponse' when 'key' is set `);\n            this.keyRequest = options.key;\n            this.keyResponse = options.key;\n        }\n        else {\n            if (!options.keyRequest || !options.keyResponse) {\n                throw new Error(`Expects 'keyRequest' & 'keyResponse' fields to be set if 'key' is not set`);\n            }\n            this.keyRequest = options.keyRequest;\n            this.keyResponse = options.keyResponse;\n        }\n    }\n    #maintain() {\n        const values = [...this.#outgoing.values()];\n        const now = Date.now();\n        for (const v of values) {\n            if (v.expiresAt <= now) {\n                if (v.promiseReject) {\n                    v.promiseReject(`Request timeout`);\n                }\n                const callback = v.callback;\n                if (callback) {\n                    setTimeout(() => {\n                        callback(true, `Request timeout`);\n                    }, 1);\n                }\n                this.fireEvent(`completed`, { request: v.req, response: `Request timeout`, success: false });\n                this.#outgoing.delete(v.id);\n            }\n        }\n        this.debugDump();\n        return this.#outgoing.size > 0;\n    }\n    debugDump() {\n        const values = [...this.#outgoing.values()];\n        const now = Date.now();\n        for (const v of values) {\n            const expire = now - v.expiresAt;\n            console.log(`${v.id} Expires in: ${Math.floor(expire / 1000).toString()}s`);\n        }\n    }\n    /**\n     * Makes a request.\n     * If `callback` is set, it's equivalent to calling `requestCallback`.\n     * If `callback` is not set, a promise is returned\n     * @param request\n     * @param callback\n     * @returns\n     */\n    request(request, callback) {\n        if (callback !== undefined) {\n            this.#requestCallback(request, callback);\n            return;\n        }\n        return this.#requestAwait(request);\n    }\n    /**\n     * Make a request and don't wait for the outcome.\n     * @param request\n     */\n    requestAndForget(request) {\n        const id = this.keyRequest(request);\n        if (this.#outgoing.has(id))\n            throw new Error(`Already a request pending with id '${id}'`);\n        const r = {\n            expiresAt: Date.now() + this.timeoutMs,\n            id,\n            req: request\n        };\n        this.#outgoing.set(id, r);\n        this.#maintainLoop.start();\n    }\n    /**\n     * Make a request, returning a Promise for the outcome.\n     * Errors will throw an exception.\n     * @param request\n     * @returns\n     */\n    #requestAwait(request) {\n        const id = this.keyRequest(request);\n        if (this.#outgoing.has(id))\n            throw new Error(`Already a request pending with id '${id}'`);\n        const p = new Promise((resolve, reject) => {\n            const r = {\n                expiresAt: Date.now() + this.timeoutMs,\n                id,\n                req: request,\n                promiseResolve: resolve,\n                promiseReject: reject\n            };\n            this.#outgoing.set(id, r);\n            this.#maintainLoop.start();\n        });\n        return p;\n    }\n    /**\n     * Make a request, and get notified of outcome with a callback\n     * @param request\n     * @param callback\n     */\n    #requestCallback(request, callback) {\n        const id = this.keyRequest(request);\n        if (this.#outgoing.has(id))\n            throw new Error(`Already a request pending with id '${id}'`);\n        const r = {\n            expiresAt: Date.now() + this.timeoutMs,\n            id,\n            req: request,\n            callback\n        };\n        this.#outgoing.set(id, r);\n        this.#maintainLoop.start();\n    }\n    /**\n     * Response has been received\n     * @param response Response\n     * @returns _True_ if response matched a request\n     */\n    response(response, keepAlive) {\n        const id = this.keyResponse(response);\n        const request = this.#outgoing.get(id);\n        if (!request) {\n            if (this.whenUnmatchedResponse === `throw`)\n                throw new Error(`Unmatched response with id: '${id}'`, { cause: response });\n            // otherwise ignore\n            return false;\n        }\n        if (keepAlive) {\n            // Continue life of request\n            request.expiresAt = Date.now() + this.timeoutMs;\n        }\n        else {\n            this.#outgoing.delete(id);\n        }\n        if (request.promiseResolve) {\n            request.promiseResolve(response);\n        }\n        if (request.callback) {\n            request.callback(false, response);\n        }\n        this.fireEvent(`match`, { request: request.req, response: response });\n        if (!keepAlive) {\n            this.fireEvent(`completed`, { request: request.req, response: response, success: true });\n        }\n        return true;\n    }\n}\n","import { elapsedSince, sleep } from '@ixfx/core';\nimport { resolveLogOption } from '@ixfx/debug';\nimport { integerTest, numberTest, resultThrow } from '@ixfx/guards';\nimport { getErrorMessage } from '@ixfx/debug';\nimport { elapsedToHumanString } from '@ixfx/core';\n/**\n * Generates an expoential backoff series of values\n * ```js\n * // Default: start at 1, power 1.1\n * for (const v of backoffGenerator()) {\n *  // v: numeric value\n * }\n * ```\n *\n * By default the generator runs forever. Use either\n * `limitAttempts` or `limitValue` to stop it when it produces a\n * given quantity of values, or when the value itself reaches a threshold.\n *\n * For example:\n * ```js\n * // `values` will have five values in it\n * const values = [...backoffGenerator({ limitAttempts: 5 })];\n * // Keep generating values until max is reached\n * const values = [...backoffGenerator({ limitValue: 1000 })];\n * ```\n *\n * Options:\n * * startAt: start value\n * * limitAttempts: cap the number of values to generate\n * * limitValue: cap the maximum calculated value\n * * power: power value (default 1.1)\n *\n * @param options\n * @returns\n */\nexport function* backoffGenerator(options = {}) {\n    const startAt = options.startAt ?? 1;\n    let limitAttempts = options.limitAttempts ?? Number.MAX_SAFE_INTEGER;\n    const limitValue = options.limitValue;\n    const power = options.power ?? 1.1;\n    let value = startAt;\n    resultThrow(integerTest(limitAttempts, `aboveZero`, `limitAttempts`), numberTest(startAt, ``, `startAt`), numberTest(limitAttempts, ``, `limitAttempts`), () => (limitValue !== undefined) ? numberTest(limitValue, ``, `limitValue`) : undefined, numberTest(power, ``, `power`));\n    while (limitAttempts > 0) {\n        // Value has climbed to the limit\n        if (limitValue && value >= limitValue)\n            return;\n        limitAttempts--;\n        yield value;\n        // Increase value for next iteration\n        value += Math.pow(value, power);\n    }\n}\n/**\n * Keeps calling `callback` until it returns something other than _undefined_.\n * There is an exponentially-increasing delay between each retry attempt.\n *\n * If `callback` throws an exception, the retry is cancelled, bubbling the exception.\n *\n * ```js\n * // A function that only works some of the time\n * const flakyFn = async () => {\n *  // do the thing\n *  if (Math.random() > 0.9) return true; // success\n *  return; // fake failure\n * };\n *\n * // Retry it up to five times,\n * // starting with 1000ms interval\n * const result = await retryFunction(flakyFn, {\n *  limitAttempts: 5\n * });\n *\n * if (result.success) {\n *  // Yay\n * } else {\n *  console.log(`Failed after ${result.attempts} attempts. Elapsed: ${result.elapsed}`);\n *  console.log(result.message);\n * }\n * ```\n *\n * An `AbortSignal` can be used to cancel process.\n * ```js\n * const abort = new AbortController();\n * const result = await retryFunction(cb, { signal: abort.signal });\n *\n * // Somewhere else...\n * abort('Cancel!'); // Trigger abort\n * ```\n * @param callback Function to run\n * @param options Options\n * @returns\n */\nexport const retryFunction = (callback, options = {}) => {\n    const task = {\n        async probe() {\n            try {\n                const v = await callback();\n                if (v === undefined)\n                    return { value: options.taskValueFallback, error: `Fallback`, success: false };\n                return { value: v, success: true };\n            }\n            catch (error) {\n                return { success: false, error: error };\n            }\n        },\n    };\n    return retryTask(task, options);\n};\n/**\n * Keeps trying to run `task`.\n *\n * ```js\n * const task = (attempts) => {\n *  // attempts is number of times it has been retried\n *\n *  if (Math.random() > 0.5) {\n *    // Return a succesful result\n *    return { success: true }\n *  } else {\n *  }\n *\n * }\n * const t = await retryTask(task, opts);\n * ```\n * @param task\n * @param opts\n * @returns\n */\nexport const retryTask = async (task, opts = {}) => {\n    const signal = opts.abort;\n    const log = resolveLogOption(opts.log);\n    const predelayMs = opts.predelayMs ?? 0;\n    const startedAt = elapsedSince();\n    let attempts = 0;\n    const initialValue = opts.startAt ?? 1000;\n    const limitAttempts = opts.limitAttempts ?? Number.MAX_SAFE_INTEGER;\n    const backoffGen = backoffGenerator({ ...opts, startAt: initialValue, limitAttempts });\n    if (initialValue <= 0)\n        throw new Error(`Param 'initialValue' must be above zero`);\n    if (predelayMs > 0) {\n        try {\n            await sleep({ millis: predelayMs, signal: signal });\n        }\n        catch (error) {\n            // Could happen due to abort signal\n            return {\n                success: false,\n                attempts,\n                value: opts.taskValueFallback,\n                elapsed: startedAt(),\n                message: getErrorMessage(error),\n            };\n        }\n    }\n    for (const t of backoffGen) {\n        attempts++;\n        // Run task\n        const result = await task.probe(attempts);\n        if (result.success) {\n            return { success: result.success, value: result.value, attempts, elapsed: startedAt() };\n        }\n        log({\n            msg: `retry attempts: ${attempts.toString()} t: ${elapsedToHumanString(t)}`,\n        });\n        // Did not succeed.\n        if (attempts >= limitAttempts) {\n            break; // Out of attempts, no point sleeping again\n        }\n        // Sleep\n        try {\n            await sleep({ millis: t, signal });\n        }\n        catch (error) {\n            // Eg if abort signal fires\n            return {\n                success: false,\n                attempts,\n                value: opts.taskValueFallback,\n                message: getErrorMessage(error),\n                elapsed: startedAt(),\n            };\n        }\n    }\n    return {\n        message: `Giving up after ${attempts.toString()} attempts.`,\n        success: false,\n        attempts,\n        value: opts.taskValueFallback,\n        elapsed: startedAt(),\n    };\n};\n","/**\n * Runs a function once\n *\n * ```js\n * const init = runOnce(() => {\n *  // do some initialisation\n * });\n *\n * init(); // Runs once\n * init(); // no-op\n * ```\n * @param onRun\n * @returns\n */\nexport const runOnce = (onRun) => {\n    let run = false;\n    let success = false;\n    return () => {\n        if (run)\n            return success;\n        run = true;\n        success = onRun();\n        return success;\n    };\n};\n","/**\n * Simple synchronisation. Supports only a single signal/waiter.\n * Expects one or more calls to .signal() for .forSignal() to resolve\n *\n * ```js\n * const sw = new SyncWait();\n * obj.addEventListener(`click`, () => {\n *  sw.signal();\n * });\n *\n * // Wait until click event\n * await sw.forSignal();\n * ```\n *\n * `forSignal` can also take a maximum time to wait. If the\n * time elapses, an exception is thrown.\n *\n * {@link didSignal} returns _true_/_false_ if signal happened rather\n * than throwing an exception.\n *\n */\nexport class SyncWait {\n    #resolve;\n    #reject;\n    #promise;\n    signal() {\n        if (this.#resolve) {\n            this.#resolve();\n            this.#resolve = undefined;\n        }\n        this.#promise = Promise.resolve();\n    }\n    /**\n     * Throw away any previous signalled state.\n     * This will cause any currently waiters to throw\n     */\n    flush() {\n        if (this.#reject) {\n            this.#reject(`Flushed`);\n            this.#reject = undefined;\n        }\n        this.#resolve = undefined;\n        this.#promise = undefined;\n    }\n    #initPromise() {\n        const p = new Promise((resolve, reject) => {\n            this.#resolve = resolve;\n            this.#reject = reject;\n        });\n        this.#promise = p;\n        return p;\n    }\n    /**\n     * Call with `await` to wait until .signal() happens.\n     * If a wait period is specified, an exception is thrown if signal does not happen within this time.\n     * @param maximumWaitMs\n     */\n    async forSignal(maximumWaitMs) {\n        let p = this.#promise;\n        p ??= this.#initPromise();\n        if (maximumWaitMs) {\n            const reject = this.#reject;\n            setTimeout(() => {\n                if (reject) {\n                    reject(`Timeout elapsed ${maximumWaitMs.toString()}`);\n                }\n            }, maximumWaitMs);\n        }\n        await p;\n        this.#promise = undefined;\n        this.#resolve = undefined;\n        this.#reject = undefined;\n    }\n    /**\n     * An alternative to {@link forSignal}, returning _true_\n     * if signalled, or _false_ if wait period was exceeded\n     *\n     * ```js\n     * const s = await sw.didSignal(5000);\n     * ```\n     * @param maximumWaitMs\n     * @returns\n     */\n    async didSignal(maximumWaitMs) {\n        try {\n            await this.forSignal(maximumWaitMs);\n            return true;\n        }\n        catch {\n            return false;\n        }\n    }\n}\n","import { SimpleEventEmitter } from '@ixfx/events';\nimport { Queues } from '@ixfx/collections';\nimport { continuously } from '@ixfx/core';\n/**\n * Simple task queue. Each task is awaited and run\n * in turn.\n *\n * The TaskQueueMutable is shared across your code,\n * so you don't create it directly. Rather, use:\n *\n * ```js\n * const queue = TaskQueueMutable.shared;\n * ```\n *\n * @example Usage\n * ```js\n * const queue = TaskQueueMutable.shared;\n * q.enqueue(async () => {\n *  // Takes one second to run\n *  await sleep(1000);\n * });\n * ```\n *\n * You can listen to events from the TaskQueue:\n * ```js\n * TaskQueueMutable.shared.addEventListener(`started`, () => {\n *  // Queue was empty, now started processing\n * });\n *\n * TaskQueueMutable.shared.addEventListener(`empty`, () => {\n *  // Queue has finished processing all items\n * });\n * ```\n */\nexport class TaskQueueMutable extends SimpleEventEmitter {\n    static shared = new TaskQueueMutable();\n    _loop;\n    _queue;\n    constructor() {\n        super();\n        this._queue = Queues.mutable();\n        this._loop = continuously(() => {\n            return this.processQueue();\n        }, 100);\n    }\n    /**\n     * Adds a task. This triggers processing loop if not already started.\n     *\n     * ```js\n     * queue.add(async () => {\n     *  await sleep(1000);\n     * });\n     * ```\n     * @param task Task to run\n     */\n    enqueue(task) {\n        const length = this._queue.enqueue(task);\n        if (this._loop.runState === `idle`) {\n            this.fireEvent(`started`, {});\n            this._loop.start();\n        }\n        return length;\n    }\n    dequeue() {\n        return this._queue.dequeue();\n    }\n    async processQueue() {\n        const task = this._queue.dequeue();\n        if (task === undefined) {\n            this.fireEvent(`empty`, {});\n            return false;\n        }\n        try {\n            await task();\n        }\n        catch (error) {\n            console.error(error);\n        }\n    }\n    /**\n     * Clears all tasks, and stops any scheduled processing.\n     * Currently running tasks will continue.\n     * @returns\n     */\n    clear() {\n        if (this._queue.length === 0)\n            return;\n        this._queue.clear();\n        this._loop.cancel();\n        this.fireEvent(`empty`, {});\n    }\n    /**\n    * Returns true if queue is empty\n    */\n    get isEmpty() {\n        return this._queue.isEmpty;\n    }\n    /**\n     * Number of items in queue\n     */\n    get length() {\n        return this._queue.length;\n    }\n}\n","/***\n * Throttles a function. Callback only allowed to run after minimum of `intervalMinMs`.\n *\n * @example Only handle move event every 500ms\n * ```js\n * const moveThrottled = throttle( (elapsedMs, args) => {\n *  // Handle ar\n * }, 500);\n * el.addEventListener(`pointermove`, moveThrottled)\n * ```\n *\n * Note that `throttle` does not schedule invocations, but rather acts as a filter that\n * sometimes allows follow-through to `callback`, sometimes not. There is an expectation then\n * that the return function from `throttle` is repeatedly called, such as the case for handling\n * a stream of data/events.\n *\n * @example Manual trigger\n * ```js\n * // Set up once\n * const t = throttle( (elapsedMs, args) => { ... }, 5000);\n *\n * // Later, trigger throttle. Sometimes the callback will run,\n * // with data passed in to args[0]\n * t(data);\n * ```\n */\nexport const throttle = (callback, intervalMinMs) => {\n    let trigger = 0;\n    return async (...args) => {\n        const elapsed = performance.now() - trigger;\n        if (elapsed >= intervalMinMs) {\n            const r = callback(elapsed, ...args);\n            if (typeof r === `object`)\n                await r;\n            trigger = performance.now();\n        }\n    };\n};\n","import { clamp } from '@ixfx/numbers';\nimport { intervalToMs } from '@ixfx/core';\n/**\n * A function that returns _true_ when an interval has elapsed\n *\n * ```js\n * const oneSecond = hasElapsed(1000);\n *\n * // Keep calling to check if time has elapsed.\n * // Will return _true_ when it has\n * oneSecond();\n * ```\n *\n * @param elapsed\n * @returns\n */\nexport function hasElapsed(elapsed) {\n    const t = relative(intervalToMs(elapsed, 0), { timer: elapsedMillisecondsAbsolute(), clampValue: true });\n    return () => t.isDone;\n}\n// export const frequencyTimerSource =\n//   (frequency: number): TimerSource =>\n//     () =>\n//       frequencyTimer(frequency, { timer: elapsedMillisecondsAbsolute() });\n/**\n * Returns a function that returns the percentage of timer completion.\n * Starts when return function is first invoked.\n *\n * ```js\n * const timer = Flow.ofTotal(1000);\n *\n * // Call timer() to find out the completion\n * timer(); // Returns 0..1\n * ```\n *\n * Note that timer can exceed 1 (100%). To cap it:\n * ```js\n * Flow.ofTotal(1000, { clampValue: true });\n * ```\n *\n * Takes an {@link Interval} for more expressive time:\n * ```js\n * const timer = Flow.ofTotal({ mins: 4 });\n * ```\n *\n * Is a simple wrapper around {@link relative}.\n * @param duration\n * @see {@link ofTotalTicks} - Use ticks instead of time\n * @see {@link hasElapsed} - Simple _true/false_ if interval has elapsed\n * @returns\n */\nexport function ofTotal(duration, opts = {}) {\n    const totalMs = intervalToMs(duration);\n    if (!totalMs)\n        throw new Error(`Param 'duration' not valid`);\n    const timerOpts = {\n        ...opts,\n        timer: elapsedMillisecondsAbsolute(),\n    };\n    let t;\n    return () => {\n        t ??= relative(totalMs, timerOpts);\n        return t.elapsed;\n    };\n}\n/**\n * Returns a function that returns the percentage (0..1) of timer completion.\n * Uses 'ticks' as a measure. Use {@link ofTotal} if you want time-based.\n *\n * ```js\n * const timer = Flow.ofTotalTicks(1000);\n * timer(); // Returns 0..1\n * ```\n *\n * Note that timer can exceed 1 (100%). To cap it:\n * ```js\n * Flow.ofTotalTicks(1000, { clampValue: true });\n * ```\n *\n * This is a a simple wrapper around {@link relative}.\n * @see {@link ofTotal}\n * @see {@link hasElapsed}: Simple _true/false_ if interval has elapsed\n * @param totalTicks\n * @returns\n */\nexport function ofTotalTicks(totalTicks, opts = {}) {\n    const timerOpts = {\n        ...opts,\n        timer: elapsedTicksAbsolute(),\n    };\n    let t;\n    return () => {\n        t ??= relative(totalTicks, timerOpts);\n        return t.elapsed;\n    };\n}\n/**\n * Returns a {@link ModulationTimer} that is always at 100%.\n * Opposite: {@link timerNeverDone}.\n * @returns\n */\nexport const timerAlwaysDone = () => ({\n    elapsed: 1,\n    isDone: true,\n    // eslint-disable-next-line @typescript-eslint/no-empty-function\n    reset() {\n    },\n    // eslint-disable-next-line @typescript-eslint/no-empty-function\n    mod(amt) {\n    },\n});\n/**\n * Returns a {@link ModulationTimer} that is always at 0%.\n * Opposite: {@link timerAlwaysDone}.\n * @returns\n */\nexport const timerNeverDone = () => ({\n    elapsed: 0,\n    isDone: false,\n    // eslint-disable-next-line @typescript-eslint/no-empty-function\n    reset() {\n    },\n    // eslint-disable-next-line @typescript-eslint/no-empty-function\n    mod() {\n    }\n});\n/**\n * Wraps a timer, returning a relative elapsed value based on\n * a given total. ie. percentage complete toward a total value.\n * This is useful because other parts of code don't need to know\n * about the absolute time values, you get a nice relative completion number.\n *\n * If no timer is specified, a milliseconds-based timer is used.\n *\n * ```js\n * const t = relative(1000);\n * t.elapsed;   // returns % completion (0...1)\n * ```\n * It can also use a tick based timer\n * ```js\n * // Timer that is 'done' at 100 ticks\n * const t = relative(100, { timer: ticksElapsedTimer() });\n * ```\n *\n * Additional fields/methods on the timer instance\n * ```js\n * t.isDone;  // _true_ if .elapsed has reached (or exceeded) 1\n * t.reset(); // start from zero again\n * ```\n *\n * Options:\n * * timer: timer to use. If not specified, `elapsedMillisecondsAbsolute()` is used.\n * * clampValue: if _true_, return value is clamped to 0..1 (default: _false_)\n * * wrapValue: if _true_, return value wraps around continously from 0..1..0 etc. (default: _false_)\n *\n * Note that `clampValue` and `wrapValue` are mutually exclusive: only one can be _true_, but both can be _false_.\n *\n * With options\n * ```js\n * // Total duration of 1000 ticks\n * const t = Timer.relative(1000, { timer: ticksElapsedTimer(); clampValue:true });\n * ```\n *\n * If `total` is Infinity, a 'always completed; timer is returned. Use a value of `NaN` for a\n * timer that always returns 0.\n * @private\n * @param total Total (of milliseconds or ticks, depending on timer source)\n * @param options Options\n * @returns Timer\n */\nexport const relative = (total, options = {}) => {\n    if (!Number.isFinite(total)) {\n        return timerAlwaysDone();\n    }\n    else if (Number.isNaN(total)) {\n        return timerNeverDone();\n    }\n    const clampValue = options.clampValue ?? false;\n    const wrapValue = options.wrapValue ?? false;\n    if (clampValue && wrapValue)\n        throw new Error(`clampValue and wrapValue cannot both be enabled`);\n    let modulationAmount = 1;\n    // Create and starts timer\n    const timer = options.timer ?? elapsedMillisecondsAbsolute();\n    // Keep track of value to avoid over-advancing the tick counter\n    let lastValue = 0;\n    const computeElapsed = (value) => {\n        lastValue = value;\n        let v = value / (total * modulationAmount);\n        if (clampValue)\n            v = clamp(v);\n        else if (wrapValue && v >= 1)\n            v = v % 1;\n        return v;\n    };\n    return {\n        mod(amt) {\n            modulationAmount = amt;\n        },\n        get isDone() {\n            //const tmp = computeElapsed();\n            //console.log(`Timer.relative ${ tmp } elapsed: ${ timer.elapsed } total: ${ total }`)\n            return computeElapsed(lastValue) >= 1;\n        },\n        get elapsed() {\n            return computeElapsed(timer.elapsed);\n        },\n        reset: () => {\n            timer.reset();\n        }\n    };\n};\n/**\n * A timer based on frequency: cycles per unit of time. These timers return a number from\n * 0..1 indicating position with a cycle.\n *\n * In practice, timers are used to 'drive' something like an Oscillator.\n *\n * By default it uses elapsed clock time as a basis for frequency. ie., cycles per second.\n *\n * It returns a `ModulationTimer`, which allows for a modulation amount to be continually applied\n * to the calculation of the 'position' within a cycle.\n *\n * @example Prints around 0/0.5 each second, as timer is half a cycle per second\n * ```js\n * const t = frequencyTimer(0.5);\n * setInterval(() => {\n *  console.log(t.elapsed);\n * }, 1000);\n * ```\n * @param frequency Cycles\n * @param options Options for timer\n * @returns\n */\nexport const frequencyTimer = (frequency, options = {}) => {\n    const timer = options.timer ?? elapsedMillisecondsAbsolute();\n    const cyclesPerSecond = frequency / 1000;\n    let modulationAmount = 1;\n    const computeElapsed = () => {\n        // Get position in a cycle\n        const v = timer.elapsed * (cyclesPerSecond * modulationAmount);\n        // Get fractional part\n        const f = v - Math.floor(v);\n        if (f < 0) {\n            throw new Error(`Unexpected cycle fraction less than 0. Elapsed: ${v} f: ${f}`);\n        }\n        if (f > 1) {\n            throw new Error(`Unexpected cycle fraction more than 1. Elapsed: ${v} f: ${f}`);\n        }\n        return f;\n    };\n    return {\n        mod: (amt) => {\n            modulationAmount = amt;\n        },\n        reset: () => {\n            timer.reset();\n        },\n        get isDone() {\n            return computeElapsed() >= 1;\n        },\n        get elapsed() {\n            return computeElapsed();\n        },\n    };\n};\n/**\n * A timer that uses clock time. Start time is from the point of invocation.\n *\n * ```js\n * const t = elapsedMillisecondsAbsolute();\n * t.reset(); // reset start\n * t.elapsed; // milliseconds since start\n * ```\n * @returns {Timer}\n * @see {ticksElapsedTimer}\n */\nexport const elapsedMillisecondsAbsolute = () => {\n    let start = performance.now();\n    return {\n        /**\n         * Reset timer\n         */\n        reset: () => {\n            start = performance.now();\n        },\n        /**\n         * Returns elapsed time since start\n         */\n        get elapsed() {\n            return performance.now() - start;\n        }\n    };\n};\n/**\n * A timer that progresses with each call to `elapsed`.\n *\n * The first call to elapsed will return 1.\n *\n * ```js\n * const timer = elapsedTicksAbsolute();\n * timer.reset(); // Reset to 0\n * timer.elapsed; // Number of ticks (and also increment ticks)\n * timer.peek;    // Number of ticks (without incrementing)\n * ```\n *\n * Like other {@link Timer} functions, returns with a `isDone` field,\n * but this will always return _true_.\n * @returns {Timer}\n * @see {elapsedMillisecondsAbsolute}\n */\nexport const elapsedTicksAbsolute = () => {\n    let start = 0;\n    return {\n        /**\n         * Reset ticks to 0. The next call to `elapsed` will return 1.\n         */\n        reset: () => {\n            start = 0;\n        },\n        /**\n         * Get current ticks without incrementing.\n         */\n        get peek() {\n            return start;\n        },\n        /**\n         * Returns the number of elapsed ticks as well as\n         * incrementing the tick count.\n         *\n         * Minimum is 1\n         *\n         * Use {@link peek} to get the current ticks without incrementing.\n         */\n        get elapsed() {\n            return ++start;\n        }\n    };\n};\n/**\n * Wraps `timer`, computing a value based on its elapsed value.\n * `fn` creates this value.\n *\n * ```js\n * const t = timerWithFunction(v=>v/2, relativeTimer(1000));\n * t.compute();\n * ```\n *\n * In the above case, `relativeTimer(1000)` creates a timer that goes\n * from 0..1 over one second. `fn` will divide that value by 2, so\n * `t.compute()` will yield values 0..0.5.\n *\n * @param fn\n * @param timer\n * @returns\n */\nexport const timerWithFunction = (fn, timer) => {\n    if (typeof fn !== `function`)\n        throw new Error(`Param 'fn' should be a function. Got: ${typeof fn}`);\n    let startCount = 1;\n    return {\n        get elapsed() {\n            return timer.elapsed;\n        },\n        get isDone() {\n            return timer.isDone;\n        },\n        get runState() {\n            if (timer.isDone)\n                return `idle`;\n            return `scheduled`;\n        },\n        /**\n         * Returns 1 if it has been created, returns +1 for each additional time the timer has been reset.\n         */\n        get startCount() {\n            return startCount;\n        },\n        get startCountTotal() {\n            return startCount;\n        },\n        compute: () => {\n            const elapsed = timer.elapsed;\n            return fn(elapsed);\n        },\n        reset: () => {\n            timer.reset();\n            startCount++;\n        },\n    };\n};\n","import { intervalToMs } from \"@ixfx/core\";\n/**\n * Calls the async `fn` to generate a value if there is no prior value or\n * `interval` has elapsed since value was last generated.\n * @example\n * ```js\n * const f = updateOutdated(async () => {\n *  const r = await fetch(`blah`);\n *  return await r.json();\n * }, 60*1000);\n *\n * // Result will be JSON from fetch. If fetch happened already in the\n * // last 60s, return cached result. Otherwise it will fetch data\n * const result = await f();\n * ```\n *\n * Callback `fn` is passed how many milliseconds have elapsed since last update. Its minimum value will be `interval`.\n *\n * ```js\n * const f = updateOutdated(async elapsedMs => {\n *  // Do something with elapsedMs?\n * }, 60*1000;\n * ```\n *\n * There are different policies for what to happen if `fn` fails. `slow` is the default.\n * * `fast`: Invocation will happen immediately on next attempt\n * * `slow`: Next invocation will wait `interval` as if it was successful\n * * `backoff`: Attempts will get slower and slower until next success. Interval is multipled by 1.2 each time.\n *\n * @param fn Async function to call. Must return a value.\n * @param interval Maximum age of cached result\n * @param updateFail `slow` by default\n * @typeParam V - Return type of `fn`\n * @returns Value\n */\nexport const updateOutdated = (fn, interval, updateFail = `slow`) => {\n    let lastRun = 0;\n    let lastValue;\n    let intervalMsCurrent = intervalToMs(interval, 1000);\n    return () => \n    // eslint-disable-next-line @typescript-eslint/no-misused-promises\n    new Promise(async (resolve, reject) => {\n        const elapsed = performance.now() - lastRun;\n        if (lastValue === undefined || elapsed > intervalMsCurrent) {\n            try {\n                lastRun = performance.now();\n                lastValue = await fn(elapsed);\n                intervalMsCurrent = intervalToMs(interval, 1000);\n            }\n            catch (error) {\n                if (updateFail === `fast`) {\n                    lastValue = undefined;\n                    lastRun = 0;\n                }\n                else if (updateFail === `backoff`) {\n                    intervalMsCurrent = Math.floor(intervalMsCurrent * 1.2);\n                }\n                // eslint-disable-next-line @typescript-eslint/prefer-promise-reject-errors\n                reject(error);\n                return;\n            }\n        }\n        resolve(lastValue);\n    });\n};\n","import { promiseWithResolvers } from \"./promise-with-resolvers.js\";\n/**\n * Queue of a single item, only once, allows for simple synchronisation.\n *\n * It has a 'first write wins' behaviour\n *\n * ```js\n * const q = new WaitForValue(); // or singleItem();\n *\n * // In some part of the code add a value\n * const value = q.add(`some-val`);\n *\n * // Somewhere else, wait for value\n * await q.get(value);\n * ```\n *\n * It is not possible to `add` a second item (an exception will throw), however\n * it is possible to call `get` as many times as you need.\n *\n * The `.isUsed` property allows you to to check if a value\n * has been already added to the queue.\n *\n * Based on: https://2ality.com/2024/05/proposal-promise-with-resolvers.html\n */\nexport class WaitForValue {\n    #promise;\n    #resolve;\n    #written = false;\n    constructor() {\n        const { promise, resolve } = promiseWithResolvers();\n        this.#promise = promise;\n        this.#resolve = resolve;\n    }\n    /**\n     * Gets the promise\n     * ```js\n     * const wv = new WaitForValue();\n     *\n     * await wv.get();\n     * ```\n     * @returns\n     */\n    get() {\n        return this.#promise;\n    }\n    /**\n     * Adds a value, triggering promise resolution.\n     *\n     * Throws an exception if queue has already been used. Use {@link isUsed} to check.\n     * @param value\n     */\n    add(value) {\n        if (this.#written)\n            throw new Error(`QueueSingleUse has already been used`);\n        this.#written = true;\n        this.#resolve(value);\n    }\n    /**\n     * Returns _true_ if a value has been added\n     * and therefore no more values can be written\n     */\n    get isUsed() {\n        return this.#written;\n    }\n}\n/**\n * {@inheritDoc WaitForValue}\n */\nexport const singleItem = () => new WaitForValue();\n","/**\n * Helper function for calling code that should fail after a timeout.\n * In short, it allows you to signal when the function succeeded, to cancel it, or\n * to be notified if it was canceled or completes.\n *\n * It does not execute or track the outcome of execution itself. Rather it's a bit\n * of machinery that needs to be steered by your own logic.\n *\n * `waitFor` takes a timeout, and two lifecycle functions, `onAborted` and `onComplete`.\n * `onAborted` is called if the timeout has elapsed. `onComplete` will run on either success or failure.\n *\n * ```js\n * waitFor(1000,\n * (error) => {\n *  // Failed\n * },\n * (success) => {\n *  if (success) {\n *    // Succeeded\n *  }\n * });\n * ```\n *\n * When calling `waitFor` you get back a function to signal success or failure:\n * ```js\n * const done = waitFor(1000, onAborted, onComplete);\n * done();          // No parameters signals success\n * done('failed');  // A string parameter indicates failure\n * ```\n *\n * @example Compact\n * ```js\n * const done = waitFor(1000,\n *  (reason) => {\n *    console.log(`Aborted: ${reason}`);\n *  });\n *\n * try {\n *  runSomethingThatMightScrewUp();\n *  done(); // Signal it succeeded\n * } catch (e) {\n *  done(e); // Signal there was an error\n * }\n * ```\n *\n * @example Verbose\n * ```js\n * // This function is called by `waitFor` if it was cancelled\n * const onAborted = (reason:string) => {\n *  // 'reason' is a string describing why it has aborted.\n *  // ie: due to timeout or because done() was called with an error\n * };\n *\n * // This function is called by `waitFor` if it completed\n * const onComplete = (success:boolean) => {\n *  // Called if we were aborted or finished succesfully.\n *  // onComplete will be called after onAborted, if it was an error case\n * }\n *\n * // If done() is not called after 1000, onAborted will be called\n * // if done() is called or there was a timeout, onComplete is called\n * const done = waitFor(1000, onAborted, onComplete);\n *\n * // Signal completed successfully (thus calling onComplete(true))\n * done();\n *\n * // Signal there was an error (thus calling onAborted and onComplete(false))\n * done(`Some error`);\n * ```\n *\n * The completion handler is useful for removing event handlers.\n *\n\n * @param timeoutMs\n * @param onAborted\n * @param onComplete\n * @returns\n */\nexport const waitFor = (timeoutMs, onAborted, onComplete) => {\n    let t;\n    let success = false;\n    const done = (error) => {\n        if (t !== undefined) {\n            window.clearTimeout(t);\n            t = undefined;\n        }\n        if (error) {\n            onAborted(error);\n        }\n        else {\n            success = true;\n        }\n        if (onComplete !== undefined)\n            onComplete(success);\n    };\n    t = globalThis.setTimeout(() => {\n        t = undefined;\n        try {\n            onAborted(`Timeout after ${timeoutMs}ms`);\n        }\n        finally {\n            if (onComplete !== undefined)\n                onComplete(success);\n        }\n    }, timeoutMs);\n    return done;\n};\n","import { unique } from '@ixfx/arrays';\n/**\n * Clones machine state\n * @param toClone\n * @returns Cloned of `toClone`\n */\nexport const cloneState = (toClone) => {\n    return Object.freeze({\n        value: toClone.value,\n        visited: [...toClone.visited],\n        machine: toClone.machine,\n    });\n};\n/**\n * Initialises a state machine. [Read more in the ixfx Guide](https://ixfx.fun/flow/state-machine/overview/)\n *\n * ```js\n * const desc = {\n *  pants: ['shoes','socks'],\n *  socks: ['shoes', 'pants'],\n *  shoes: 'shirt',\n *  shirt: null\n * }\n *\n * // Defaults to first key, 'pants'\n * let sm = StateMachine.init(descr);\n *\n * // Move to 'shoes' state\n * sm = StateMachine.to(sm, 'shoes');\n * sm.state; // 'shoes'\n * sm.visited; // [ 'pants' ]\n *\n * StateMachine.isDone(sm); // false\n * StateMachine.possible(sm); // [ 'shirt' ]\n * ```\n * @param stateMachine Settings for state machine\n * @param initialState Initial state name\n * @returns\n */\nexport const init = (stateMachine, initialState) => {\n    const [machine, machineValidationError] = validateMachine(stateMachine);\n    if (!machine)\n        throw new Error(machineValidationError);\n    const state = \n    // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n    (initialState) ?? Object.keys(machine.states)[0];\n    if (typeof machine.states[state] === `undefined`) {\n        throw new TypeError(`Initial state ('${state}') not found`);\n    }\n    // Normalise states\n    const transitions = validateAndNormaliseTransitions(machine.states);\n    if (transitions === undefined) {\n        throw new Error(`Could not normalise transitions`);\n    }\n    return Object.freeze({\n        value: state,\n        visited: [],\n        machine: Object.freeze(Object.fromEntries(transitions)),\n    });\n};\nexport const reset = (sm) => {\n    return init(sm.machine);\n};\nexport const validateMachine = (smOrTransitions) => {\n    if (typeof smOrTransitions === `undefined`) {\n        return [undefined, `Parameter undefined`];\n    }\n    if (smOrTransitions === null) {\n        return [undefined, `Parameter null`];\n    }\n    if (`states` in smOrTransitions) {\n        // Assume Machine type\n        return [smOrTransitions, ``];\n    }\n    if (typeof smOrTransitions === `object`) {\n        return [\n            {\n                states: smOrTransitions,\n            },\n            ``,\n        ];\n    }\n    return [\n        undefined,\n        `Unexpected type: ${typeof smOrTransitions}. Expected object`,\n    ];\n};\n// export const validateMachine = <V extends Transitions>(\n//   sm: Machine<V>\n// ): [machine: Machine<V> | undefined, msg: string] => {\n//   if (typeof sm === 'undefined') {\n//     return [undefined, `Parameter 'sm' is undefined`];\n//   }\n//   if (sm === null) return [undefined, `Parameter 'sm' is null`];\n//   if (`states` in sm) {\n//     const [transitions, validationError] = validateAndNormaliseTransitions(\n//       sm.states\n//     );\n//     if (transitions) {\n//       const machine: Machine<V> = {\n//         // @ts-ignore\n//         states: Object.fromEntries(transitions),\n//       };\n//       return [machine, ''];\n//     } else {\n//       return [undefined, validationError];\n//     }\n//   } else {\n//     return [undefined, `Parameter 'sm.states' is undefined`];\n//   }\n// };\n/**\n * Returns _true_ if MachineState `sm` is in its final state.\n * @param sm\n * @returns\n */\nexport const isDone = (sm) => {\n    return possible(sm).length === 0;\n};\n/**\n * Returns a list of possible state targets for `sm`, or\n * an empty list if no transitions are possible.\n * @param sm\n * @returns\n */\nexport const possibleTargets = (sm) => {\n    // Validate current state\n    validateMachineState(sm);\n    // get list of possible targets\n    const fromS = sm.machine[sm.value];\n    if (fromS.length === 1 && fromS[0].state === null)\n        return [];\n    return fromS;\n};\n/**\n * Returns a list of possible state names for `sm`, or\n * an empty list if no transitions are possible.\n *\n * @param sm\n * @returns\n */\nexport const possible = (sm) => {\n    const targets = possibleTargets(sm);\n    return targets.map((v) => v.state);\n};\nexport const normaliseTargets = (targets) => {\n    const normaliseSingleTarget = (target) => {\n        // Terminal target\n        if (target === null)\n            return { state: null };\n        // String is the target state\n        if (typeof target === `string`) {\n            return {\n                state: target,\n            };\n        }\n        else if (typeof target === `object` && `state` in target) {\n            const targetState = target.state;\n            if (typeof targetState !== `string`) {\n                throw new TypeError(`Target 'state' field is not a string. Got: ${typeof targetState}`);\n            }\n            if (`preconditions` in target) {\n                return {\n                    state: targetState,\n                    preconditions: target.preconditions,\n                };\n            }\n            return { state: targetState };\n        }\n        else {\n            throw new Error(`Unexpected type: ${typeof target}. Expected string or object with 'state' field.`);\n        }\n    };\n    // Array of targets (either strings or objects)\n    if (Array.isArray(targets)) {\n        let containsNull = false;\n        const mapResults = targets.map((t) => {\n            const r = normaliseSingleTarget(t);\n            if (!r)\n                throw new Error(`Invalid target`);\n            containsNull = containsNull || r.state === null;\n            return r;\n        });\n        if (containsNull && mapResults.length > 1) {\n            throw new Error(`Cannot have null as an possible state`);\n        }\n        return mapResults;\n    }\n    else {\n        const target = normaliseSingleTarget(targets);\n        if (!target)\n            return;\n        return [target];\n    }\n};\nconst validateAndNormaliseTransitions = (d) => {\n    const returnMap = new Map();\n    // 1. Index top-level states\n    for (const [topLevelState, topLevelTargets] of Object.entries(d)) {\n        if (typeof topLevelState === `undefined`) {\n            throw new TypeError(`Top-level undefined state`);\n        }\n        if (typeof topLevelTargets === `undefined`) {\n            throw new TypeError(`Undefined target state for ${topLevelState}`);\n        }\n        if (returnMap.has(topLevelState)) {\n            throw new Error(`State defined twice: ${topLevelState}`);\n        }\n        if (topLevelState.includes(` `)) {\n            throw new Error(`State names cannot contain spaces`);\n        }\n        returnMap.set(topLevelState, []);\n    }\n    // 2. Normalise target\n    for (const [topLevelState, topLevelTargets] of Object.entries(d)) {\n        const targets = normaliseTargets(topLevelTargets);\n        if (targets === undefined)\n            throw new Error(`Could not normalise target`);\n        if (targets !== null) {\n            // Check that they all exist as top-level states\n            const seenStates = new Set();\n            for (const target of targets) {\n                if (seenStates.has(target.state)) {\n                    throw new Error(`Target state '${target.state}' already exists for '${topLevelState}'`);\n                }\n                seenStates.add(target.state);\n                if (target.state === null)\n                    continue;\n                if (!returnMap.has(target.state)) {\n                    throw new Error(`Target state '${target.state}' is not defined as a top-level state. Defined under: '${topLevelState}'`);\n                }\n            }\n            returnMap.set(topLevelState, targets);\n        }\n    }\n    return returnMap;\n};\n/**\n * Validates machine state, throwing an exception if not valid\n * and returning `StateTargetStrict`\n * @param state\n * @returns\n */\nconst validateMachineState = (state) => {\n    if (typeof state === `undefined`) {\n        throw new TypeError(`Param 'state' is undefined`);\n    }\n    if (typeof state.value !== `string`) {\n        throw new TypeError(`Existing state is not a string`);\n    }\n};\n/**\n * Attempts to transition to a new state. Either a new\n * `MachineState` is returned reflecting the change, or\n * an exception is thrown.\n *\n * @example Attempts to transition to 'name-of-state'\n * ```js\n * const newState = StateMachine.to(currentState, `name-of-state`);\n * ```\n *\n * Note that 'currentState' is not changed.\n * @param sm\n * @param toState\n * @returns\n */\nexport const to = (sm, toState) => {\n    validateMachineState(sm); // throws if not OK\n    validateTransition(sm, toState); // throws if not OK\n    return Object.freeze({\n        value: toState,\n        machine: sm.machine,\n        visited: unique([sm.visited, [sm.value]]),\n    });\n};\nexport const next = (sm) => {\n    //validateMachineState(sm);\n    const first = possibleTargets(sm).at(0);\n    // eslint-disable-next-line @typescript-eslint/prefer-optional-chain\n    if (!first || first.state === null) {\n        throw new Error(`Not possible to move to a next state from '${sm.value}`);\n    }\n    return to(sm, first.state);\n};\n/**\n * Returns _true_ if `toState` is a valid transition from current state of `sm`\n * @param sm\n * @param toState\n * @returns\n */\nexport const isValidTransition = (sm, toState) => {\n    try {\n        validateTransition(sm, toState);\n        return true;\n    }\n    catch {\n        return false;\n    }\n};\nexport const validateTransition = (sm, toState) => {\n    if (toState === null)\n        throw new Error(`Cannot transition to null state`);\n    if (typeof toState === `undefined`) {\n        throw new Error(`Cannot transition to undefined state`);\n    }\n    if (typeof toState !== `string`) {\n        throw new TypeError(`Parameter 'toState' should be a string. Got: ${typeof toState}`);\n    }\n    //const toS = sm.machine[toState];\n    //if (typeof toS === 'undefined') throw new Error(`Target state '${toState}' not defined`);\n    const p = possible(sm);\n    if (p.length === 0)\n        throw new Error(`Machine is in terminal state`);\n    if (!p.includes(toState)) {\n        throw new Error(`Target state '${toState}' not available at current state '${sm.value}'. Possible states: ${p.join(`, `)}`);\n    }\n};\n/**\n * Returns state transitions based on a list of strings.\n * The last string is the terminal state.\n *  A -> B -> C -> D\n *\n * See also: {@link fromListBidirectional}\n *\n * ```js\n * const transitions = fromList([`a`, `b`, `c`, `d`]);\n * // Object state machine with events\n * const sm = new StateMachine.WithEvents(transitions);\n * // OR, immutable state machine\n * const sm = StateMachine.init(transitions);\n * ```\n * @param states List of states\n * @return MachineDescription\n */\nexport const fromList = (...states) => {\n    const t = {};\n    if (!Array.isArray(states))\n        throw new Error(`Expected array of strings`);\n    if (states.length <= 2)\n        throw new Error(`Expects at least two states`);\n    for (let index = 0; index < states.length; index++) {\n        const s = states[index];\n        if (typeof s !== `string`) {\n            throw new TypeError(`Expected array of strings. Got type '${typeof s}' at index ${index.toString()}`);\n        }\n        t[s] = (index === states.length - 1) ? null : states[index + 1];\n    }\n    return t;\n};\n/**\n * Returns a machine description based on a list of strings. Machine\n * can go back and forth between states:\n *  A <-> B <-> C <-> D\n *\n * See also {@link fromList}.\n *\n * ```js\n * const transitions = fromListBidirectional([`a`, `b`, `c`, `d`]);\n * // Object state machine with events\n * const sm = new StateMachine.WithEvents(transitions);\n * // OR, immutable state machine\n * const sm = StateMachine.init(transitions);\n * ```\n * @param states\n * @returns\n */\nexport const fromListBidirectional = (...states) => {\n    const t = {};\n    if (!Array.isArray(states))\n        throw new Error(`Expected array of strings`);\n    if (states.length < 2)\n        throw new Error(`Expects at least two states`);\n    for (const [index, s] of states.entries()) {\n        if (typeof s !== `string`) {\n            throw new TypeError(`Expected array of strings. Got type '${typeof s}' at index ${index.toString()}`);\n        }\n        t[s] = [];\n    }\n    for (let index = 0; index < states.length; index++) {\n        const v = t[states[index]];\n        if (index === states.length - 1) {\n            if (states.length > 1) {\n                v.push(states[index - 1]);\n            }\n            else {\n                t[states[index]] = null;\n            }\n        }\n        else {\n            v.push(states[index + 1]);\n            if (index > 0)\n                v.push(states[index - 1]);\n        }\n    }\n    return t;\n};\n","import * as Execute from '../execute.js';\nimport {} from './types.js';\nimport { defaultComparer } from '@ixfx/core';\nimport { randomElement } from '@ixfx/arrays';\nimport * as Debug from '@ixfx/debug';\nimport { init as machineInit, reset as machineReset, next as machineNext, to as machineTo } from './state-machine.js';\n// export type Prerequisite<V extends StateMachine.Transitions> =\n//   | readonly StateMachine.StateNames<V>[]\n//   | ((\n//       potentialState: StateMachine.StateNames<V>,\n//       state: StateMachine.MachineState<V>\n//     ) => boolean);\n// export type StatePrerequisites<V extends StateMachine.Transitions> = {\n//   readonly states:\n//     | readonly StateMachine.StateNames<V>[]\n//     | StateMachine.StateNames<V>;\n//   readonly condition?: Prerequisite<V>;\n// };\n// async function run<V extends StateMachine.Transitions>(\n//   machine: StateMachine.Machine<V>,\n//   handlers: readonly StatesHandler<V>[]\n// );\n/**\n * Drives a state machine.\n *\n * [Read more on the ixfx Guide](https://ixfx.fun/flow/state-machine/driver/)\n *\n * Uses a 'handlers' structure to determine when to change\n * state and actions to take.\n *\n * The structure is a set of logical conditions: if we're in\n * this state, then move to this other state etc.\n *\n * ```js\n * const handlers = [\n *  {\n *    // If we're in the 'sleeping' state, move to next state\n *    if: 'sleeping',\n *    then: { next: true }\n *  },\n *  {\n *    // If we're in the 'waking' state, randomly either go to 'resting' or 'sleeping' state\n *    if: 'waking',\n *    then: [\n *      () => {\n *        if (Math.random() > 0.5) {\n *          return { next: 'resting' }\n *        } else {\n *          return { next: 'sleeping' }\n *        }\n *      }\n *    ]\n *   }\n * ];\n * ```\n *\n * Set up the driver, and call `run()` when you want to get\n * the machine to change state or take action:\n *\n * ```js\n * const driver = await StateMachine.driver(states, handlers);\n * setInterval(async () => {\n *  await driver.run(); // Note use of 'await' again\n * }, 1000);\n * ```\n *\n * Essentially, the 'handlers' structure gets run through each time `run()`\n * is called.\n *\n * Defaults to selecting the highest-ranked result to determine\n * what to do next.\n * @param machine\n * @param handlersOrOpts\n * @returns\n */\nexport async function driver(machine, handlersOrOpts) {\n    const opts = Array.isArray(handlersOrOpts)\n        ? {\n            handlers: handlersOrOpts,\n        }\n        : handlersOrOpts;\n    const debug = Debug.resolveLogOption(opts.debug, {\n        category: `StateMachineDriver`,\n    });\n    // Index handlers by state, making sure there are not multiple\n    // handlers for a given state.\n    const byState = new Map();\n    for (const h of opts.handlers) {\n        const ifBlock = Array.isArray(h.if) ? h.if : [h.if];\n        for (const state of ifBlock) {\n            if (typeof state !== `string`) {\n                throw new TypeError(`Expected single or array of strings for the 'if' field. Got: '${typeof state}'.`);\n            }\n            if (byState.has(state)) {\n                throw new Error(`Multiple handlers defined for state '${state}'. There should be at most one.`);\n            }\n            byState.set(state, h);\n        }\n    }\n    const runOpts = {\n        // Rank results by score\n        rank: (a, b) => {\n            return defaultComparer(a.score ?? 0, b.score ?? 0);\n        },\n        shuffle: opts.shuffleHandlers ?? false,\n    };\n    let sm = machineInit(machine);\n    // Check that all 'if' states are actually defined on machine\n    for (const [ifState] of byState) {\n        // Check if state is defined\n        if (typeof sm.machine[ifState] === `undefined` &&\n            ifState !== `__fallback`) {\n            throw new Error(`StateMachineDriver handler references a state ('${ifState}') which is not defined on the machine. Therefore this handler will never run.'`);\n        }\n    }\n    const run = async () => {\n        debug(`Run. State: ${sm.value}`);\n        const state = sm.value;\n        let handler = byState.get(state);\n        if (handler === undefined) {\n            debug(`  No handler for state '${state}', trying __fallback`);\n            // Is there a fallback?\n            handler = byState.get(`__fallback`);\n        }\n        if (handler === undefined) {\n            debug(`  No __fallback handler`);\n            return;\n        }\n        // If the `first` option is given, stop executing fns as soon as we get\n        // a valid result.\n        const runOptionsForHandler = handler.resultChoice === `first`\n            ? {\n                ...runOpts,\n                stop: (latest) => {\n                    if (!latest)\n                        return false;\n                    if (`reset` in latest)\n                        return true;\n                    if (`next` in latest && latest.next !== undefined)\n                        return true;\n                    return false;\n                },\n            }\n            : runOpts;\n        const results = await Execute.run(handler.then, runOptionsForHandler, sm);\n        debug(`  In state '${sm.value}' results: ${results.length}. Choice: ${handler.resultChoice}`);\n        // Apply selection logic\n        //eslint-disable-next-line functional/no-let\n        let r;\n        switch (handler.resultChoice ?? `highest`) {\n            case `highest`: {\n                r = results.at(-1);\n                break;\n            }\n            case `first`: {\n                r = results[0]; // Since we break on the first result\n                break;\n            }\n            case `lowest`: {\n                r = results.at(0);\n                break;\n            }\n            case `random`: {\n                r = randomElement(results);\n                break;\n            }\n            default: {\n                throw new Error(`Unknown 'resultChoice' option: ${handler.resultChoice}. Expected highest, first, lowest or random`);\n            }\n        }\n        debug(`  Chosen result: ${JSON.stringify(r)}`);\n        // Apply result\n        if (r?.reset) {\n            sm = machineReset(sm);\n        }\n        else if (r && r.next) {\n            if (typeof r.next === `boolean`) {\n                sm = machineNext(sm);\n            }\n            else {\n                debug(JSON.stringify(results));\n                sm = machineTo(sm, r.next);\n            }\n        }\n        return sm;\n    };\n    return {\n        reset: () => {\n            sm = machineReset(sm);\n        },\n        getValue: () => sm.value,\n        run,\n        to: (state) => {\n            sm = machineTo(sm, state);\n            return sm;\n        },\n    };\n}\n","import { SimpleEventEmitter } from '@ixfx/events';\nimport * as StateMachine from './state-machine.js';\nimport { elapsedInfinity, elapsedSince } from '@ixfx/core/elapsed';\n/**\n * A state machine that fires events when state changes.\n *\n * ```js\n * const transitions = StateMachine.fromList(`a`, `b`, `c`);\n * const m = new StateMachineWithEvents(transitions);\n * m.addEventListener(`change`, event => {\n *  console.log(`${event.priorState} -> ${event.newState}`);\n * });\n * m.addEventListener(`stop`, event => {\n *  console.log(`State machine has reached final state`);\n * });\n * ```\n */\nexport class StateMachineWithEvents extends SimpleEventEmitter {\n    #sm;\n    #smInitial;\n    #debug;\n    #isDoneNeedsFiring = false;\n    #isDone = false;\n    #changedAt = elapsedInfinity();\n    /**\n     * Create a state machine with initial state, description and options\n     * @param m Machine description\n     * @param opts Options for machine (defaults to `{debug:false}`)\n     */\n    constructor(m, opts = {}) {\n        super();\n        this.#debug = opts.debug ?? false;\n        this.#sm = StateMachine.init(m, opts.initial);\n        this.#smInitial = StateMachine.cloneState(this.#sm);\n    }\n    #setIsDone(v) {\n        if (this.#isDone === v)\n            return;\n        this.#isDone = v;\n        if (v) {\n            this.#isDoneNeedsFiring = true;\n            setTimeout(() => {\n                if (!this.#isDoneNeedsFiring)\n                    return;\n                this.#isDoneNeedsFiring = false;\n                //console.log(`StateMachine isDone (${this.#state}), firing stop.`);\n                this.fireEvent(`stop`, { state: this.#sm.value });\n            }, 2);\n        }\n        else {\n            this.#isDoneNeedsFiring = false;\n        }\n    }\n    /**\n     * Return a list of possible states from current state.\n     *\n     * If list is empty, no states are possible. Otherwise lists\n     * possible states, including 'null' for terminal\n     */\n    get statesPossible() {\n        return StateMachine.possible(this.#sm);\n    }\n    /**\n     * Return a list of all defined states\n     */\n    get statesDefined() {\n        return Object.keys(this.#sm.machine);\n    }\n    /**\n     * Moves to the next state if possible. If multiple states are possible, it will use the first.\n     * If machine is finalised, no error is thrown and null is returned.\n     *\n     * @returns {(string|null)} Returns new state, or null if machine is finalised\n     */\n    next() {\n        const p = StateMachine.possible(this.#sm);\n        if (p.length === 0)\n            return null;\n        this.state = p[0];\n        return p[0];\n    }\n    /**\n     * Returns _true_ if state machine is in its final state\n     *\n     * @returns\n     */\n    get isDone() {\n        return StateMachine.isDone(this.#sm);\n    }\n    /**\n     * Resets machine to initial state\n     */\n    reset() {\n        this.#setIsDone(false);\n        this.#sm = StateMachine.cloneState(this.#smInitial);\n        this.#changedAt = elapsedSince();\n    }\n    /**\n     * Throws if it's not valid to transition to `newState`\n     * @param newState\n     * @returns\n     */\n    validateTransition(newState) {\n        StateMachine.validateTransition(this.#sm, newState);\n    }\n    /**\n     * Returns _true_ if `newState` is valid transition from current state.\n     * Use {@link validateTransition} if you want an explanation for the _false_ results.\n     * @param newState\n     * @returns\n     */\n    isValid(newState) {\n        return StateMachine.isValidTransition(this.#sm, newState);\n    }\n    /**\n     * Gets or sets state. Throws an error if an invalid transition is attempted.\n     * Use `isValid()` to check validity without changing.\n     *\n     * If `newState` is the same as current state, the request is ignored silently.\n     */\n    set state(newState) {\n        const priorState = this.#sm.value;\n        if (newState === this.#sm.value)\n            return;\n        // Try to change state\n        this.#sm = StateMachine.to(this.#sm, newState);\n        if (this.#debug) {\n            console.log(`StateMachine: ${priorState} -> ${newState}`);\n        }\n        this.#changedAt = elapsedSince();\n        setTimeout(() => {\n            this.fireEvent(`change`, { newState: newState, priorState: priorState });\n        }, 1);\n        if (StateMachine.isDone(this.#sm))\n            this.#setIsDone(true);\n    }\n    get state() {\n        return this.#sm.value;\n    }\n    /**\n     * Returns timestamp when state was last changed.\n     * See also `elapsed`\n     */\n    get changedAt() {\n        return this.#changedAt();\n    }\n    /**\n     * Returns milliseconds elapsed since last state change.\n     * See also `changedAt`\n     */\n    get elapsed() {\n        return this.#changedAt();\n    }\n}\n","export * from './driver.js';\nexport * from './state-machine.js';\nexport * from './with-events.js';\n","export * from '@ixfx/core/continuously';\nexport * from './behaviour-tree.js';\nexport * from './delay.js';\nexport * from './debounce.js';\nexport * from './dispatch-list.js';\nexport * from './every.js';\nexport * from './execute.js';\nexport * from './event-race.js';\nexport * from './moving-average.js';\nexport * from './pool.js';\nexport * from './promise-with-resolvers.js';\nexport * from './rate-minimum.js';\nexport * from './repeat.js';\nexport * from './req-resp-match.js';\nexport * from './retry.js';\nexport * from './run-once.js';\nexport * from './sync-wait.js';\nexport * from './task-queue-mutable.js';\nexport * from './throttle.js';\nexport * from './timeout.js';\nexport * from './timer.js';\nexport * from './types.js';\nexport * from './update-outdated.js';\nexport * from './wait-for-value.js';\nexport * from './wait-for.js';\nexport { sleep } from '@ixfx/core';\n/**\n * Functions for creating and driving a state machine\n *\n * [Read more on the ixfx Guide](https://ixfx.fun/flow/state-machine/overview/)\n */\nexport * as StateMachine from './state-machine/index.js';\n","import {} from \"./types.js\";\n/**\n* Returns a random number from 0..weightings.length, distributed by the weighting values.\n*\n* eg: produces 0 20% of the time, 1 50% of the time, 2 30% of the time\n* ```js\n* weightedIndex([0.2, 0.5, 0.3]);\n* ```\n* @param weightings\n* @param rand\n* @returns\n*/\nexport const weightedIndex = (weightings, rand = Math.random) => {\n    const precompute = [];\n    let total = 0;\n    // eslint-disable-next-line unicorn/no-for-loop\n    for (let index = 0; index < weightings.length; index++) {\n        total += weightings[index];\n        precompute[index] = total;\n    }\n    if (total !== 1)\n        throw new Error(`Weightings should add up to 1. Got: ${total}`);\n    return () => {\n        const v = rand();\n        // eslint-disable-next-line unicorn/no-for-loop\n        for (let index = 0; index < precompute.length; index++) {\n            if (v <= precompute[index])\n                return index;\n        }\n        throw new Error(`Bug: weightedIndex could not select index`);\n    };\n};\n","import { arrayTest, resultThrow } from \"@ixfx/guards\";\nimport { weightedIndex } from \"./weighted-index.js\";\n/**\n * Returns a random array index.\n *\n * ```js\n * const v = [`blue`, `red`, `orange`];\n * randomIndex(v); // Yields 0, 1 or 2\n * ```\n *\n * Use {@link randomElement} if you want a value from `array`, not index.\n *\n * @param array Array\n * @param rand Random generator. `Math.random` by default.\n * @returns\n */\nexport const randomIndex = (array, rand = Math.random) => Math.floor(rand() * array.length);\n/**\n * Plucks a random value from an array, optionally mutating\n * the original array.\n *\n * @example Get a random element without modifying array\n * ```js\n * const { value, remainder } = randomPluck(inputArray);\n * ```\n *\n * @example Get a random element, removing it from original array\n * ```js\n * const value = randomPluck(inputArray, { mutate: true });\n * ```\n *\n * If the input array is empty, _undefined_ is returned as the value.\n * @typeParam V - Type of items in array\n * @param array Array to pluck item from\n * @param options Options. By default { mutate: false, source: Math.random }\n * @param rand Random generator. `Math.random` by default.\n *\n */\nexport function randomPluck(array, options = {}) {\n    if (typeof array === `undefined`)\n        throw new Error(`Param 'array' is undefined`);\n    if (!Array.isArray(array))\n        throw new Error(`Param 'array' is not an array`);\n    const mutate = options.mutate ?? false;\n    const rand = options.source ?? Math.random;\n    if (array.length === 0) {\n        if (mutate)\n            return undefined;\n        return { value: undefined, remainder: [] };\n    }\n    const index = randomIndex(array, rand);\n    if (mutate) {\n        // Return bare value\n        const v = array[index];\n        array.splice(index, 1);\n        return v;\n    }\n    else {\n        // Copy array, remove item from that\n        const inputCopy = [...array];\n        inputCopy.splice(index, 1);\n        return {\n            value: array[index],\n            remainder: inputCopy,\n        };\n    }\n}\n;\n/**\n * Returns random element.\n *\n * ```js\n * const v = [`blue`, `red`, `orange`];\n * randomElement(v); // Yields `blue`, `red` or `orange`\n * ```\n *\n * Use {@link randomIndex} if you want a random index within `array`.\n *\n * @param array\n * @param rand Random generator. `Math.random` by default.\n * @returns\n */\nexport const randomElement = (array, rand = Math.random) => {\n    resultThrow(arrayTest(array, `array`));\n    return array[Math.floor(rand() * array.length)];\n};\n/**\n * Selects a random array index, biased by the provided `weightings`.\n *\n * In the below example, `a` will be picked 20% of the time, `b` 50% and so on.\n * ```js\n * const data =    [  `a`,  `b`,  `c`,  `d` ]\n * const weights = [ 0.2,  0.5,  0.1,  0.2 ]\n * ```\n * @param array\n * @param weightings\n * @param randomSource\n */\nexport const randomElementWeightedSource = (array, weightings, randomSource = Math.random) => {\n    if (array.length !== weightings.length)\n        throw new Error(`Lengths of 'array' and 'weightings' should be the same.`);\n    const r = weightedIndex(weightings, randomSource);\n    return () => {\n        const index = r();\n        return array[index];\n    };\n};\n/**\n * Returns a shuffled copy of the input array.\n * @example\n * ```js\n * const d = [1, 2, 3, 4];\n * const s = shuffle(d);\n * // d: [1, 2, 3, 4], s: [3, 1, 2, 4]\n * ```\n * @param dataToShuffle\n * @param rand Random generator. `Math.random` by default.\n * @returns Copy with items moved around randomly\n * @typeParam V - Type of array items\n */\nexport const shuffle = (dataToShuffle, rand = Math.random) => {\n    const array = [...dataToShuffle];\n    for (let index = array.length - 1; index > 0; index--) {\n        const index_ = Math.floor(rand() * (index + 1));\n        [array[index], array[index_]] = [array[index_], array[index]];\n    }\n    return array;\n};\n","import { numberTest, resultThrow } from \"@ixfx/guards\";\n/**\n * Chance of returning `a` or `b`, based on threshold `p`.\n *\n * `p` sets the threshold for picking `b`. The higher the value (up to 1),\n * the more likely `b` will be picked.\n *\n * ```js\n * // 50% of the time it will return 100, 50% 110\n * chance(0.5, 100, 110);\n * // 90% of the time it will yield 110, 10% it will yield 100\n * chance(0.9, 100, 110);\n * ```\n *\n * @param p Threshold to choose option B (value or function)\n * @param a Value or function for option A\n * @param b Value or function for option B\n * @param randomSource Source of random numbers\n * @returns\n */\nexport const chance = (p, a, b, randomSource) => {\n    const source = randomSource ?? Math.random;\n    const resolve = (x) => {\n        if (typeof x === `function`)\n            return x();\n        return x;\n    };\n    const pp = resolve(p);\n    resultThrow(numberTest(pp, `percentage`, `p`));\n    if (source() <= pp) {\n        return resolve(b);\n    }\n    else {\n        return resolve(a);\n    }\n};\n","import { numberTest, resultThrow } from '@ixfx/guards';\nimport {} from \"./types.js\";\n/**\n * Source for random bipolar values\n * ```js\n * const r = bipolarSource();\n * r(); // Produce random value on -1...1 scale\n * ```\n *\n * Options can be provided, for example\n * ```js\n * // -0.5 to 0.5 range\n * bipolarSource({ max: 0.5 });\n * ```\n *\n *\n * @param maxOrOptions Maximum value (number) or options for random generation\n * @returns\n */\nexport const bipolarSource = (maxOrOptions) => {\n    const source = floatSource(maxOrOptions);\n    return () => (source() * 2) - 1;\n};\n/**\n * Returns a random bipolar value\n * ```js\n * const r = bipolar(); // -1...1 random\n * ```\n *\n * Options can be provided, eg.\n * ```js\n * bipolar({ max: 0.5 }); // -0.5..0.5 random\n * ```\n *\n * Use {@link bipolarSource} if you want to generate random\n * values with same settings repeatedly.\n * @param maxOrOptions\n * @returns\n */\nexport const bipolar = (maxOrOptions) => {\n    const source = bipolarSource(maxOrOptions);\n    return source();\n};\n/**\n * Returns a function that produces random float values.\n * Use {@link float} to produce a valued directly.\n *\n * Random float between `max` (exclusive) and 0 (inclusive). Max is 1 if unspecified.\n *\n *\n * ```js\n * // Random number between 0..1 (but not including 1)\n * // (this would be identical to Math.random())\n * const r = floatSource();\n * r(); // Execute to produce random value\n *\n * // Random float between 0..100 (but not including 100)\n * const v = floatSource(100)();\n * ```\n *\n * Options can be used:\n * ```js\n * // Random float between 20..40 (possibly including 20, but always lower than 40)\n * const r = floatSource({ min: 20, max: 40 });\n * ```\n * @param maxOrOptions Maximum value (exclusive) or options\n * @returns Random number\n */\nexport const floatSource = (maxOrOptions = 1) => {\n    const options = typeof maxOrOptions === `number` ? { max: maxOrOptions } : maxOrOptions;\n    let max = options.max ?? 1;\n    let min = options.min ?? 0;\n    const source = options.source ?? Math.random;\n    resultThrow(numberTest(min, ``, `min`), numberTest(max, ``, `max`));\n    if (!options.min && max < 0) {\n        min = max;\n        max = 0;\n    }\n    if (min > max) {\n        throw new Error(`Min is greater than max. Min: ${min.toString()} max: ${max.toString()}`);\n    }\n    return () => source() * (max - min) + min;\n};\n/**\n * Returns a random float between `max` (exclusive) and 0 (inclusive).\n *\n * Max is 1 if unspecified.\n * Use {@link floatSource} to get a function that produces values. This is used internally.\n *\n * ```js\n * // Random number between 0..1 (but not including 1)\n * // (this would be identical to Math.random())\n * const v = float();\n * // Random float between 0..100 (but not including 100)\n * const v = float(100);\n * ```\n *\n * Options can be used:\n * ```js\n * // Random float between 20..40 (possibly including 20, but always lower than 40)\n * const v = float({ min: 20, max: 40 });\n * ```\n * @param maxOrOptions Maximum value (exclusive) or options\n * @returns Random number\n */\nexport const float = (maxOrOptions = 1) => floatSource(maxOrOptions)();\n","/**\n * Keeps generating a random number until\n * it's not 0\n * @param source Random number generator\n * @returns Non-zero number\n */\nexport const calculateNonZero = (source = Math.random) => {\n    let v = 0;\n    while (v === 0) {\n        v = source();\n    }\n    return v;\n};\n","import { calculateNonZero } from \"./non-zero.js\";\n/**\n * Returns a random number with gaussian (ie. bell-curved) distribution\n *\n * @example Random number between 0..1 with gaussian distribution\n * ```js\n * gaussian();\n * ```\n *\n * @example Distribution can be skewed\n * ```js\n * gaussian(10);\n * ```\n *\n * Use {@link gaussianSource} if you want a function with skew value baked-in.\n * @param skew Skew factor. Defaults to 1, no skewing. Above 1 will skew to left, below 1 will skew to right\n * @returns\n */\nexport const gaussian = (skew = 1) => gaussianSource(skew)();\n/**\n * Returns a function that generates a gaussian-distributed random number\n * @example\n * Random number between 0..1 with gaussian distribution\n * ```js\n * // Create function\n * const r = gaussianSource();\n *\n * // Generate random value\n * r();\n * ```\n *\n * @example\n * Pass the random number generator elsewhere\n * ```js\n * const r = gaussianSource(10);\n *\n * // Randomise array with gaussian distribution\n * Arrays.shuffle(r);\n * ```\n *\n * If you want to fit a value to a gaussian curve, see Modulation.gaussian instead.\n * @param skew\n * @returns\n */\nexport const gaussianSource = (skew = 1) => {\n    const min = 0;\n    const max = 1;\n    // Source: https://stackoverflow.com/questions/25582882/javascript-math-random-normal-distribution-gaussian-bell-curve\n    const compute = () => {\n        const u = calculateNonZero();\n        const v = calculateNonZero();\n        let result = Math.sqrt(-2 * Math.log(u)) * Math.cos(2 * Math.PI * v);\n        result = result / 10 + 0.5; // Translate to 0 -> 1\n        if (result > 1 || result < 0) {\n            result = compute(); //;gaussian(skew); // resample between 0 and 1 if out of range\n        }\n        else {\n            result = Math.pow(result, skew); // Skew\n            result *= max - min; // Stretch to fill range\n            result += min; // offset to min\n        }\n        return result;\n    };\n    return compute;\n};\n","/**\n * Generates a six-digit roughly unique id\n * ```js\n * const id = shortGuid();\n * ```\n * @param options Options.\n * @returns\n */\nexport const shortGuid = (options = {}) => {\n    const source = options.source ?? Math.random;\n    // Via Stackoverflow...\n    const firstPart = Math.trunc(source() * 46_656);\n    const secondPart = Math.trunc(source() * 46_656);\n    const firstPartString = `000${firstPart.toString(36)}`.slice(-3);\n    const secondPartString = `000${secondPart.toString(36)}`.slice(-3);\n    return firstPartString + secondPartString;\n};\n","import { integerTest, resultThrow } from \"@ixfx/guards\";\n/**\n * Yields `amount` integers, counting by one from zero. If a negative amount is used,\n * count decreases. If `offset` is provided, this is added to the return result.\n * @example\n * ```js\n * const a = [...count(5)]; // Yields five numbers: [0,1,2,3,4]\n * const b = [...count(-5)]; // Yields five numbers: [0,-1,-2,-3,-4]\n * for (const v of count(5, 5)) {\n *  // Yields: 5, 6, 7, 8, 9\n * }\n * const c = [...count(5,1)]; // Yields [1,2,3,4,5]\n * ```\n *\n * @example Used with forEach\n * ```js\n * // Prints `Hi` 5x\n * forEach(count(5), () => // do something);\n * ```\n *\n * If you want to accumulate return values, consider using Flow.repeat.\n *\n * @example Run some code every 100ms, 10 times:\n * ```js\n * import { interval } from '@ixfx/flow.js'\n * import { count } from '@ixfx/numbers.js'\n * const counter = count(10);\n * for await (const v of interval(counter, { fixedIntervalMs: 100 })) {\n *  // Do something\n * }\n * ```\n * @param amount Number of integers to yield\n * @param offset Added to result\n */\nexport function* count(amount, offset = 0) {\n    resultThrow(integerTest(amount, ``, `amount`), integerTest(offset, ``, `offset`));\n    if (amount === 0)\n        return;\n    let index = 0;\n    do {\n        yield (amount < 0 ? -index + offset : index + offset);\n    } while (index++ < Math.abs(amount) - 1);\n}\n;\n","import { numberTest, integerTest, resultThrow } from \"@ixfx/guards\";\nimport { count } from \"./util/count.js\";\nimport { shuffle } from \"./arrays.js\";\n/**\n * Returns a function that produces a random integer between `max` (exclusive) and 0 (inclusive)\n * Use {@link integer} if you want a random number directly.\n *\n * Invoke directly:\n * ```js\n * integerSource(10)();  // Random number 0-9\n * ```\n *\n * Or keep a reference to re-compute:\n * ```js\n * const r = integerSource(10);\n * r(); // Produce a random integer\n * ```\n *\n * If a negative value is given, this is assumed to be the\n * minimum (inclusive), with 0 as the max (inclusive)\n * ```js\n * integerSource(-5)();  // Random number from -5 to 0\n * ```\n *\n * Specify options for a custom minimum or source of random:\n * ```js\n * integerSource({ max: 5,  min: 10 })();  // Random number 4-10\n * integerSource({ max: -5, min: -10 })(); // Random number from -10 to -6\n * integerSource({ max: 10, source: Math.random })(); // Random number between 0-9, with custom source of random\n * ```\n *\n * Throws an error if max & min are equal\n * @param maxOrOptions Max value (exclusive), or set of options\n * @returns Random integer\n */\nexport const integerSource = (maxOrOptions) => {\n    if (typeof maxOrOptions === `undefined`) {\n        throw new TypeError(`maxOrOptions is undefined`);\n    }\n    const options = typeof maxOrOptions === `number` ? { max: maxOrOptions } : maxOrOptions;\n    let max = Math.floor(options.max ?? 100);\n    let min = Math.floor(options.min ?? 0);\n    // If we just get -5 as the max, invert so\n    // max:1 and min: -5 instead for -5...0 range\n    if (!options.min && max < 0) {\n        max = 1;\n        min = options.max ?? 0;\n    }\n    const randomSource = options.source ?? Math.random;\n    if (min > max) {\n        throw new Error(`Min value is greater than max (min: ${min.toString()} max: ${max.toString()})`);\n    }\n    resultThrow(numberTest(min, ``, `min`), numberTest(max, ``, `max`));\n    if (max === min) {\n        throw new Error(`Max and min values cannot be the same (${max.toString()})`);\n    }\n    // Distance\n    const amt = Math.abs(max - min);\n    return () => Math.floor(randomSource() * amt) + min;\n};\n/**\n * Returns a random integer between `max` (exclusive) and 0 (inclusive)\n * Use {@link integerSource} to return a function instead.\n *\n * ```js\n * integer(10);  // Random number 0,1..9\n * ```\n *\n * If a negative value is given, this is assumed to be the\n * minimum (inclusive), with 0 as the max (inclusive)\n * ```js\n * integer(-5);  // Random number -5,-4,...0\n * ```\n *\n * Specify options for a custom minimum or source of random:\n * ```js\n * integer({ max: 5,  min: 10 });  // Random number 4-10\n * integer({ max: -5, min: -10 }); // Random number from -10 to -6\n * integer({ max: 10, source: Math.random }); // Random number between 0-9, with custom source of random\n * ```\n *\n * Throws an error if max & min are equal\n * @param maxOrOptions Max value (exclusive), or set of options\n * @returns Random integer\n */\nexport const integer = (maxOrOptions) => integerSource(maxOrOptions)();\n/**\n * Returns a generator over random unique integers, up to\n * but not including the given max value.\n *\n * @example 0..9 range\n * ```js\n * const rand = [ ...integerUniqueGen(10) ];\n * // eg: [2, 9, 6, 0, 8, 7, 3, 4, 5, 1]\n * ```\n *\n * @example Options can be provided:\n * ```js\n * // 5..9 range\n * const rand = [ ...integerUniqueGen({ min: 5, max: 10 })];\n * ```\n *\n * Range can be looped. Once the initial random walk through the number\n * range completes, it starts again in a new random way.\n *\n * ```js\n * for (const r of integerUniqueGen({ max: 10, loop: true })) {\n *  // Warning: loops forever\n * }\n * ```\n *\n * Behind the scenes, an array of numbers is created that captures the range, this is then\n * shuffled on the first run, and again whenever the iterator loops, if that's allowed.\n *\n * As a consequence, large ranges will consume larger amounts of memory.\n * @param maxOrOptions\n * @returns\n */\nexport function* integerUniqueGen(maxOrOptions) {\n    const options = typeof maxOrOptions === `number` ? { max: maxOrOptions } : maxOrOptions;\n    const min = options.min ?? 0;\n    const max = options.max ?? 100;\n    const source = options.source ?? Math.random;\n    const loop = options.loop ?? false;\n    resultThrow(integerTest(min, ``, `min`), integerTest(max, ``, `max`));\n    if (min > max) {\n        throw new Error(`Min value is greater than max. Min: ${min.toString()} Max: ${max.toString()}`);\n    }\n    const origRange = [...count(max - min, min)];\n    let numberRange = shuffle(origRange);\n    let index = 0;\n    while (true) {\n        if (index === numberRange.length) {\n            if (loop)\n                numberRange = shuffle(origRange, source);\n            else\n                return;\n        }\n        yield numberRange[index++];\n    }\n}\n","/**\n * Reproducible random values using the Merseene Twister algorithm.\n * With the same seed value, it produces the same series of random values.\n *\n * ```js\n * // Seed with a value of 100\n * const r = mersenneTwister(100);\n * r.float();         // 0..1\n * ```\n *\n * Integer values can also be produced. First parameter\n * is the maximum value (exclusive), the optional second\n * parameter is the minimum value (inclusive).\n * ```js\n * r.integer(10);     // 0..9\n * r.integer(10, 5);  // 5..9\n *\n * // Eg random array index:\n * r.integer(someArray.length);\n * ```\n *\n * Adapted from George MacKerron's implementation. MIT License.\n * https://github.com/jawj/mtwist/\n * @param seed Seed value 0..4294967295. Default: random seed.\n */\nexport function mersenneTwister(seed) {\n    if (!seed)\n        seed = Math.random() * 4294967295;\n    // Initialisation\n    let mt = new Array(624);\n    mt[0] = seed >>> 0;\n    const n1 = 1812433253;\n    for (let mti = 1; mti < 624; mti++) {\n        const n2 = mt[mti - 1] ^ (mt[mti - 1] >>> 30);\n        // uint32 multiplication, low 16 bits and high 16 bits multiplied separately and reassembled:\n        mt[mti] = ((((n1 & 0xffff0000) * n2) >>> 0) + (((n1 & 0x0000ffff) * n2) >>> 0) + mti) >>> 0;\n    }\n    let mti = 624;\n    const randomUint32 = () => {\n        let y;\n        if (mti >= 624) {\n            for (let i = 0; i < 227; i++) {\n                y = ((mt[i] & 0x80000000) | (mt[i + 1] & 0x7fffffff)) >>> 0;\n                mt[i] = (mt[i + 397] ^ (y >>> 1) ^ (y & 1 ? 0x9908b0df : 0)) >>> 0;\n            }\n            for (let i = 227; i < 623; i++) {\n                y = ((mt[i] & 0x80000000) | (mt[i + 1] & 0x7fffffff)) >>> 0;\n                mt[i] = (mt[i - 227] ^ (y >>> 1) ^ (y & 1 ? 0x9908b0df : 0)) >>> 0;\n            }\n            y = ((mt[623] & 0x80000000) | (mt[0] & 0x7fffffff)) >>> 0;\n            mt[623] = (mt[396] ^ (y >>> 1) ^ (y & 1 ? 0x9908b0df : 0)) >>> 0;\n            mti = 0;\n        }\n        y = mt[mti++];\n        y = (y ^ (y >>> 11)) >>> 0;\n        y = (y ^ ((y << 7) & 0x9d2c5680)) >>> 0;\n        y = (y ^ ((y << 15) & 0xefc60000)) >>> 0;\n        y = (y ^ (y >>> 18)) >>> 0;\n        return y;\n    };\n    const float = () => randomUint32() / 4294967296; // 2^32\n    // Max is exclusive\n    const integer = (maxExclusive, minInclusive = 0) => {\n        if (maxExclusive < 1)\n            throw new Error(\"Upper bound must be greater than or equal to 1\");\n        if (maxExclusive > 4294967296)\n            throw new Error(\"Upper bound must not be greater than 4294967296\");\n        if (maxExclusive === 1)\n            return 0;\n        let range = maxExclusive - minInclusive;\n        const bitsNeeded = Math.ceil(Math.log2(range)), bitMask = (1 << bitsNeeded) - 1;\n        while (true) {\n            const int = randomUint32() & bitMask;\n            if (int < range)\n                return minInclusive + int;\n        }\n    };\n    return { integer, float };\n}\n","import {} from \"./types.js\";\n/**\n * Returns a string of random letters and numbers of a given `length`.\n *\n * ```js\n * string();  // Random string of length 5\n * string(4); // eg. `4afd`\n * ```\n * @param lengthOrOptions Length of random string, or options.\n * @returns Random string\n */\nexport const string = (lengthOrOptions = 5) => {\n    const options = typeof lengthOrOptions === `number` ? { length: lengthOrOptions } : lengthOrOptions;\n    const calculate = options.source ?? Math.random;\n    const length = options.length ?? 5;\n    let returnValue = ``;\n    while (returnValue.length < length) {\n        returnValue += calculate()\n            .toString(36)\n            .slice(2);\n    }\n    return returnValue.substring(0, length);\n};\n","import { integer, integerSource } from \"./integer.js\";\n/**\n * Returns a random number of minutes, with a unit of milliseconds.\n *\n * Max value is exclusive, defaulting to 5.\n * Use {@link minutesMs} to get a value directly, or {@link minutesMsSource} to return a function.\n *\n * @example Random value from 0 to one milli less than 5 * 60 * 1000\n * ```js\n * // Create function that returns value\n * const f = minutesMsSource(5);\n *\n * f(); // Generate value\n * ```\n *\n * @example Specified options:\n * ```js\n * // Random time between one minute and 5 minutes\n * const f = minutesMsSource({ max: 5, min: 1 });\n * f();\n * ```\n *\n * @remarks\n * It's a very minor function, but can make\n * code a little more literate:\n * ```js\n * // Random timeout of up to 5 mins\n * setTimeout(() => { ... }, minutesMsSource(5));\n * ```\n * @param maxMinutesOrOptions\n * @see {@link minutesMs}\n * @returns Function that produces a random value\n */\nexport const minutesMsSource = (maxMinutesOrOptions) => {\n    const options = typeof maxMinutesOrOptions === `number`\n        ? { max: maxMinutesOrOptions }\n        : maxMinutesOrOptions;\n    const min = (options.min ?? 0) * 60 * 1000;\n    const max = (options.max ?? 5) * 60 * 1000;\n    return integerSource({ ...options, max, min });\n};\n/**\n * Return a random time value in milliseconds, using minute values to set range.\n *\n * @example Random value from 0 to one milli less than 5 * 60 * 1000\n * ```js\n * // Random value from 0 to one milli less than 5*60*1000\n * minuteMs(5);\n * ```\n *\n * @example Specified options:\n * ```js\n * // Random time between one minute and 5 minutes\n * minuteMs({ max: 5, min: 1 });\n * ```\n *\n * @param maxMinutesOrOptions\n * @see {@link minutesMsSource}\n * @returns Milliseconds\n */\nexport const minutesMs = (maxMinutesOrOptions) => minutesMsSource(maxMinutesOrOptions)();\n/**\n * Returns function which produces a random number of seconds, with a unit of milliseconds.\n *\n * Maximum value is exclusive, defaulting to 5\n * Use {@link secondsMs} to return a random value directly, or {@link secondsMsSource} to return a function.\n *\n * @example Random milliseconds between 0..4999\n * ```js\n * // Create function\n * const f = secondsMsSource(5000);\n * // Produce a value\n * const value = f();\n * ```\n *\n * @example Options can be provided\n * ```js\n * // Random milliseconds between 1000-4999\n * const value = secondsMsSource({ max:5, min:1 })();\n * // Note the extra () at the end to execute the function\n * ```\n *\n * @remarks\n * It's a very minor function, but can make\n * code a little more literate:\n * ```js\n * // Random timeout of up to 5 seconds\n * setTimeout(() => { ...}, secondsMsSource(5));\n * ```\n * @param maxSecondsOrOptions Maximum seconds, or options.\n * @returns Milliseconds\n */\nexport const secondsMsSource = (maxSecondsOrOptions) => {\n    const options = typeof maxSecondsOrOptions === `number`\n        ? { max: maxSecondsOrOptions }\n        : maxSecondsOrOptions;\n    const min = (options.min ?? 0) * 1000;\n    const max = (options.max ?? 5) * 1000;\n    return () => integer({ ...options, max, min });\n};\n/**\n * Generate random time in milliseconds, using seconds to set the bounds\n *\n * @example Random milliseconds between 0..4999\n * ```js\n * secondsMs(5000);\n * ```\n *\n * @example Options can be provided\n * ```js\n * // Random milliseconds between 1000-4999\n * secondsMs({ max:5, min:1 });\n * ```\n * @param maxSecondsOrOptions\n * @returns\n */\nexport const secondsMs = (maxSecondsOrOptions) => secondsMsSource(maxSecondsOrOptions)();\n","export function clamp(v, min = 0, max = 1) {\n    if (v < min)\n        return min;\n    if (v > max)\n        return max;\n    return v;\n}\n","import {} from \"./types.js\";\nimport { clamp } from \"./util/clamp.js\";\n/**\n * Random integer, weighted according to an easing function.\n * Number will be inclusive of `min` and below `max`.\n *\n * @example 0..99\n * ```js\n * const r = Random.weightedIntegerFn(100);\n * r(); // Produce value\n * ```\n *\n * @example 20..29\n * ```js\n * const r = Random.weightedIntegerFn({ min: 20, max: 30 });\n * r(); // Produce value\n * ```\n *\n * @example  0..99 with 'quadIn' easing\n * ```js\n * const r = Random.weightedInteger({ max: 100, easing: `quadIn` });\n * ```\n *\n * Note: result from easing function will be clamped to\n * the min/max (by default 0-1);\n *\n * @param options Options. By default { max:1, min: 0 }\n * @returns Function that produces a random weighted integer\n */\nexport const weightedIntegerSource = (options) => {\n    const source = options.source ?? Math.random;\n    if (typeof options.easingFunction === `undefined`)\n        throw new Error(`Param 'easingFunction' is undefined`);\n    const max = options.max ?? 1;\n    const min = options.min ?? 0;\n    if (max === min)\n        throw new Error(`Param 'max' is the same as  'min'`);\n    if (max < min)\n        throw new Error(`Param 'max' should be greater than  'min'`);\n    const compute = () => {\n        const r = clamp(options.easingFunction(source()));\n        return Math.floor(r * (max - min)) + min;\n    };\n    return compute;\n};\n/**\n * Generate a weighted-random integer.\n *\n * @example 0..99\n * ```js\n * Random.weightedInteger(100);\n * ```\n *\n * @example 20..29\n * ```js\n * Random.weightedInteger({ min: 20, max: 30 });\n * ```\n *\n * @example  0..99 with 'quadIn' easing\n * ```js\n * Random.weightedInteger({ max: 100, easing: `quadIn` })\n * ```\n * @param options Options. Default: { max: 1, min: 0 }\n * @returns Random weighted integer\n */\nexport const weightedInteger = (options) => weightedIntegerSource(options)();\n","import {} from './types.js';\n/***\n * Returns a random number, 0..1, weighted by a given easing function.\n * See @ixfx/modulation.weighted to use a named easing function.\n * Use {@link weightedSource} to return a function instead.\n *\n * @see {@link weightedSource} Returns a function rather than value\n * @returns Random number (0-1)\n */\nexport const weighted = (options) => weightedSource(options)();\n/***\n * Returns a random number, 0..1, weighted by a given easing function.\n * See @ixfx/modulation.weighted to use a named easing function.\n * Use {@link weighted} to get a value directly.\n *\n * @see {@link weighted} Returns value instead of function\n * @returns Function which returns a weighted random value\n */\nexport const weightedSource = (options) => {\n    const source = options.source ?? Math.random;\n    if (typeof options.easing !== `undefined`)\n        throw new Error(`Param 'easingName' unavailable. Use @ixfx/modulation.weighted instead.`);\n    if (typeof options.easingFunction === `undefined`)\n        throw new Error(`Param 'easingFunction' is undefined`);\n    return () => options.easingFunction(source());\n};\n","export * from './arrays.js';\nexport * from './chance.js';\nexport * from './float-source.js';\nexport * from './gaussian.js';\nexport * from './guid.js';\nexport * from './integer.js';\nexport * from './non-zero.js';\nexport * from './seeded.js';\nexport * from './string.js';\nexport * from './time.js';\nexport * from './types.js';\nexport * from './weighted-index.js';\nexport * from './weighted-integer.js';\nexport * from './weighted.js';\n// export { randomElement as arrayElement } from '../data/arrays/Random.js';\n// export { randomHue as hue } from '../visual/colour/index.js';\n// export { randomIndex as arrayIndex } from '../data/arrays/Random.js';\n","/**\n * Run a function if a value changes\n * ```js\n * const r = handleChangeResult(trackNumberChange, (value) => {\n *  // Called when value changes\n * });\n * r(10);\n * ```\n * @param monitor\n * @param onChanged\n * @param onNotChanged\n * @returns\n */\nexport function handleChangeResult(monitor, onChanged, onNotChanged) {\n    return (v) => {\n        const r = monitor(v);\n        if (r.changed) {\n            onChanged(v, r.changes, r.total);\n        }\n        else if (typeof onNotChanged !== `undefined`) {\n            onNotChanged(v, r.identicalRun, r.total);\n        }\n    };\n}\n/**\n * Returns a function to monitor value changes.\n * ```js\n * const f = trackNumberChange(true);\n * f(10); // { changed: true, changesCount: 1 }\n * f(10); // { changed: false, changesCount: 1 }\n * ```\n *\n * Default options:\n * * nanHandling: error\n * * includeFirstValueInCount: false\n *\n * NaN handling:\n * * allow: use NaN value as a legal value and report a change\n * * skip: ignore NaN values, reporting back no change and use the same changes count\n * * error: throw an error if a NaN value is received\n *\n *\n * @returns\n */\nexport function trackNumberChange(options = {}) {\n    const nanHandling = options.nanHandling ?? `error`;\n    const includeFirstValueInCount = options.includeFirstValueInCount ?? false;\n    let lastValue = options.initial;\n    let changes = 0;\n    let total = 0;\n    let identicalRun = 0;\n    return (v) => {\n        if (typeof v !== `number`)\n            throw new TypeError(`Parameter should be number. Got type: ${typeof v}`);\n        if (Number.isNaN(v)) {\n            switch (nanHandling) {\n                case `error`:\n                    throw new Error(`Parameter is NaN`);\n                case `skip`:\n                    return { changed: false, changes, total, identicalRun };\n            }\n        }\n        total++;\n        let eq = lastValue === v;\n        // Because two NaNs don't equal (!?)\n        if (Number.isNaN(lastValue) && Number.isNaN(v))\n            eq = true;\n        if (!eq) {\n            identicalRun = 0;\n            if (lastValue !== undefined || includeFirstValueInCount) {\n                changes++;\n            }\n            lastValue = v;\n            return { changed: true, changes, total, identicalRun };\n        }\n        else {\n            identicalRun++;\n        }\n        return { changed: false, changes, total, identicalRun };\n    };\n}\n/**\n * Returns a function to track changes in a boolean value\n * ```js\n * const t = trackBooleanChange();\n * t(true); // { changed:false }\n * t(true); // { changed:false }\n * t(false); // { changed: true }\n * ```\n *\n * Default options:\n * * includeFirstValueInCount: false\n * @param options\n * @returns\n */\nexport function trackBooleanChange(options = {}) {\n    const includeFirstValueInCount = options.includeFirstValueInCount ?? false;\n    let lastValue = options.initial;\n    let changes = 0;\n    let total = 0;\n    let identicalRun = 0;\n    return (v) => {\n        if (typeof v !== `boolean`)\n            throw new TypeError(`Parameter should be boolean. Got type: ${typeof v}`);\n        total++;\n        if (lastValue !== v) {\n            identicalRun = 0;\n            if (lastValue !== undefined || includeFirstValueInCount) {\n                changes++;\n            }\n            lastValue = v;\n            return { changed: true, changes, total, identicalRun };\n        }\n        else {\n            identicalRun++;\n        }\n        return { changed: false, changes, total, identicalRun };\n    };\n}\n","import { keyValueSorter } from '@ixfx/core';\nimport { SimpleEventEmitter } from '@ixfx/events';\nimport { numberArrayCompute } from '@ixfx/numbers';\n/**\n * Frequency keeps track of how many times a particular value is seen, but\n * unlike a Map it does not store the data. By default compares\n * items by value (via JSON.stringify).\n *\n * Fires `change` event when items are added or it is cleared.\n *\n * Overview\n * ```\n * const fh = new FrequencyTracker();\n * fh.add(value); // adds a value\n * fh.clear();    // clears all data\n * fh.keys() / .values() // returns an iterator for keys and values\n * fh.toArray();  //  returns an array of data in the shape [[key,freq],[key,freq]...]\n * ```\n *\n * Usage\n * ```\n * const fh = new FrequencyTracker();\n * fh.add(`apples`); // Count an occurence of `apples`\n * fh.add(`oranges)`;\n * fh.add(`apples`);\n *\n * const fhData = fh.toArray(); // Expect result [[`apples`, 2], [`oranges`, 1]]\n * fhData.forEach((d) => {\n *  const [key,freq] = d;\n *  console.log(`Key '${key}' occurred ${freq} time(s).`);\n * })\n * ```\n *\n * Custom key string\n * ```\n * const fh = frequency( person => person.name);\n * // All people with name `Samantha` will be counted in same group\n * fh.add({name:`Samantha`, city:`Brisbane`});\n * ```\n * @typeParam V - Type of items\n */\nexport class FrequencyTracker extends SimpleEventEmitter {\n    #store;\n    #keyString;\n    /**\n     * Constructor\n     * @param keyString Function to key items. Uses JSON.stringify by default\n     */\n    constructor(keyString) {\n        super();\n        this.#store = new Map();\n        if (typeof keyString === `undefined`) {\n            keyString = (a) => {\n                if (a === undefined)\n                    throw new Error(`Cannot create key for undefined`);\n                return typeof a === `string` ? a : JSON.stringify(a);\n            };\n        }\n        this.#keyString = keyString;\n    }\n    /**\n     * Clear data. Fires `change` event\n     */\n    clear() {\n        this.#store.clear();\n        this.fireEvent(`change`, { context: this });\n    }\n    /**\n     * @returns Iterator over keys (ie. groups)\n     */\n    keys() {\n        return this.#store.keys();\n    }\n    /**\n     * @returns Iterator over frequency counts\n     */\n    values() {\n        return this.#store.values();\n    }\n    /**\n     * @returns Copy of entries as an array of `[key, count]`\n     */\n    toArray() {\n        return [...this.#store.entries()];\n    }\n    /**\n     * Returns a string with keys and counts, useful for debugging.\n     * @returns\n     */\n    debugString() {\n        let t = ``;\n        for (const [key, count] of this.#store.entries()) {\n            t += `${key}: ${count.toString()}, `;\n        }\n        if (t.endsWith(`, `))\n            return t.slice(0, Math.max(0, t.length - 2));\n        return t;\n    }\n    /**\n     *\n     * @param value Value to count\n     * @returns Frequency of value, or _undefined_ if it does not exist\n     */\n    frequencyOf(value) {\n        if (typeof value === `string`)\n            return this.#store.get(value);\n        const key = this.#keyString(value);\n        return this.#store.get(key);\n    }\n    /**\n     *\n     * @param value Value to count\n     * @returns Relative frequency of `value`, or _undefined_ if it does not exist\n     */\n    relativeFrequencyOf(value) {\n        let freq;\n        if (typeof value === `string`)\n            freq = this.#store.get(value);\n        else {\n            const key = this.#keyString(value);\n            freq = this.#store.get(key);\n        }\n        if (freq === undefined)\n            return;\n        const mma = this.computeValues();\n        return freq / mma.total;\n    }\n    /**\n     * Returns copy of entries as an array\n     * @returns Copy of entries as an array\n     */\n    entries() {\n        return [...this.#store.entries()];\n    }\n    /**\n     * Calculate min,max,avg,total & count from values\n     * @returns Returns `{min,max,avg,total}`\n     */\n    computeValues() {\n        const valuesAsNumbers = [...this.values()];\n        return numberArrayCompute(valuesAsNumbers);\n    }\n    /**\n     * Return entries sorted\n     * @param sortStyle Sorting style (default: _value_, ie. count)\n     * @returns Sorted array of [key,frequency]\n     */\n    entriesSorted(sortStyle = `value`) {\n        const s = keyValueSorter(sortStyle);\n        return s(this.entries());\n    }\n    /**\n     * Add one or more values, firing _change_ event.\n     * @param values Values to add. Fires _change_ event after adding item(s)\n     */\n    add(...values) {\n        if (typeof values === `undefined`)\n            throw new Error(`Param 'values' undefined`);\n        const keys = values.map(v => this.#keyString(v));\n        //const key = this.#keyString(value);\n        for (const key of keys) {\n            const score = this.#store.get(key) ?? 0;\n            this.#store.set(key, score + 1);\n        }\n        this.fireEvent(`change`, { context: this });\n    }\n}\nexport const frequency = (keyString) => new FrequencyTracker(keyString);\n","/**\n * Base tracker class\n */\nexport class TrackerBase {\n    /**\n     * @ignore\n     */\n    seenCount;\n    /**\n     * @ignore\n     */\n    storeIntermediate;\n    /**\n     * @ignore\n     */\n    resetAfterSamples;\n    /**\n     * @ignore\n     */\n    sampleLimit;\n    id;\n    debug;\n    constructor(opts = {}) {\n        this.id = opts.id ?? `tracker`;\n        this.debug = opts.debug ?? false;\n        this.sampleLimit = opts.sampleLimit ?? -1;\n        this.resetAfterSamples = opts.resetAfterSamples ?? -1;\n        this.storeIntermediate =\n            opts.storeIntermediate ??\n                (this.sampleLimit > -1 || this.resetAfterSamples > -1);\n        this.seenCount = 0;\n        if (this.debug) {\n            console.log(`TrackerBase: sampleLimit: ${this.sampleLimit} resetAfter: ${this.resetAfterSamples} store: ${this.storeIntermediate}`);\n        }\n    }\n    /**\n     * Reset tracker\n     */\n    reset() {\n        this.seenCount = 0;\n        this.onReset();\n    }\n    /**\n     * Adds a value, returning computed result.\n     *\n     * At this point, we check if the buffer is larger than `resetAfterSamples`. If so, `reset()` is called.\n     * If not, we check `sampleLimit`. If the buffer is twice as large as sample limit, `trimStore()` is\n     * called to take it down to sample limit, and `onTrimmed()` is called.\n     * @param p\n     * @returns\n     */\n    seen(...p) {\n        if (this.resetAfterSamples > 0 && this.seenCount > this.resetAfterSamples) {\n            this.reset();\n        }\n        else if (this.sampleLimit > 0 && this.seenCount > this.sampleLimit * 2) {\n            this.seenCount = this.trimStore(this.sampleLimit);\n            this.onTrimmed(`resize`);\n        }\n        this.seenCount += p.length;\n        const t = this.filterData(p);\n        return this.computeResults(t);\n    }\n}\n","import { TrackerBase } from \"./tracker-base.js\";\nexport class PrimitiveTracker extends TrackerBase {\n    values;\n    timestamps;\n    constructor(opts) {\n        super(opts);\n        this.values = [];\n        this.timestamps = [];\n    }\n    /**\n     * Reduces size of value store to `limit`. Returns\n     * number of remaining items\n     * @param limit\n     */\n    trimStore(limit) {\n        if (limit >= this.values.length)\n            return this.values.length;\n        this.values = this.values.slice(-limit);\n        this.timestamps = this.timestamps.slice(-limit);\n        return this.values.length;\n    }\n    onTrimmed(reason) {\n        // no-op\n    }\n    get last() {\n        return this.values.at(-1);\n    }\n    get initial() {\n        return this.values.at(0);\n    }\n    /**\n     * Returns number of recorded values (this can include the initial value)\n     */\n    get size() {\n        return this.values.length;\n    }\n    /**\n     * Returns the elapsed time, in milliseconds since the instance was created\n     */\n    get elapsed() {\n        if (this.values.length < 0)\n            throw new Error(`No values seen yet`);\n        return Date.now() - this.timestamps[0];\n    }\n    /**\n     * Returns the time, in milliseconds, covering the initial and last values.\n     * Returns NaN if either of these is missing.\n     */\n    get timespan() {\n        const oldest = this.timestamps.at(0);\n        const newest = this.timestamps.at(-1);\n        if (oldest === undefined)\n            return Number.NaN;\n        if (newest === undefined)\n            return Number.NaN;\n        return newest - oldest;\n    }\n    onReset() {\n        this.values = [];\n        this.timestamps = [];\n    }\n    /**\n     * Tracks a value\n     */\n    filterData(rawValues) {\n        const lastValue = rawValues.at(-1);\n        const last = { value: lastValue, at: performance.now() };\n        const values = rawValues.map(value => ({\n            at: performance.now(),\n            value: value\n        }));\n        //const now = Date.now();\n        if (this.storeIntermediate) {\n            this.values.push(...rawValues);\n            this.timestamps.push(...values.map(v => v.at));\n        }\n        else\n            switch (this.values.length) {\n                case 0: {\n                    // Add as initial value\n                    this.values.push(last.value);\n                    this.timestamps.push(last.at);\n                    break;\n                }\n                case 2: {\n                    // Replace last value\n                    this.values[1] = last.value;\n                    this.timestamps[1] = last.at;\n                    break;\n                }\n                case 1: {\n                    // Add last value\n                    this.values.push(last.value);\n                    this.timestamps.push(last.at);\n                    break;\n                }\n                // No default\n            }\n        return values;\n    }\n}\n","import { PrimitiveTracker } from \"./primitive-tracker.js\";\nimport { minFast, maxFast, totalFast } from \"@ixfx/numbers\";\nexport class NumberTracker extends PrimitiveTracker {\n    #total = 0;\n    #min = Number.MAX_SAFE_INTEGER;\n    #max = Number.MIN_SAFE_INTEGER;\n    /**\n     * Difference between last value and initial.\n     * Eg. if last value was 10 and initial value was 5, 5 is returned (10 - 5)\n     * If either of those is missing, undefined is returned\n     */\n    difference() {\n        if (this.last === undefined)\n            return;\n        if (this.initial === undefined)\n            return;\n        return this.last - this.initial;\n    }\n    /**\n     * Relative difference between last value and initial.\n     * Eg if last value was 10 and initial value was 5, 2 is returned (200%)\n     */\n    relativeDifference() {\n        if (this.last === undefined)\n            return;\n        if (this.initial === undefined)\n            return;\n        return this.last / this.initial;\n    }\n    onReset() {\n        this.#min = Number.MAX_SAFE_INTEGER;\n        this.#max = Number.MIN_SAFE_INTEGER;\n        this.#total = 0;\n        super.onReset();\n    }\n    /**\n     * When trimmed, recomputes to set total/min/max to be based on\n     * current values.\n     * @param reason\n     */\n    onTrimmed(reason) {\n        this.#min = minFast(this.values);\n        this.#max = maxFast(this.values);\n        this.#total = totalFast(this.values);\n    }\n    computeResults(values) {\n        if (values.some((v) => Number.isNaN(v)))\n            throw new Error(`Cannot add NaN`);\n        const numbers = values.map(value => value.value);\n        this.#total = numbers.reduce((accumulator, v) => accumulator + v, this.#total);\n        this.#min = Math.min(...numbers, this.#min);\n        this.#max = Math.max(...numbers, this.#max);\n        return {\n            max: this.#max,\n            min: this.#min,\n            total: this.#total,\n            avg: this.avg\n        };\n    }\n    getMinMaxAvg() {\n        return {\n            min: this.#min,\n            max: this.#max,\n            avg: this.avg,\n        };\n    }\n    get max() {\n        return this.#max;\n    }\n    get total() {\n        return this.#total;\n    }\n    get min() {\n        return this.#min;\n    }\n    get avg() {\n        return this.#total / this.seenCount;\n    }\n}\n/**\n * Keeps track of the total, min, max and avg in a stream of values. By default values\n * are not stored.\n *\n * Usage:\n *\n * ```js\n * import { number } from '@ixfx/trackers.js';\n *\n * const t = number();\n * t.seen(10);\n *\n * t.avg / t.min/ t.max\n * t.initial; // initial value\n * t.size;    // number of seen values\n * t.elapsed; // milliseconds since intialisation\n * t.last;    // last value\n * ```\n *\n * To get `{ avg, min, max, total }`\n * ```\n * t.getMinMax()\n * ```\n *\n * Use `t.reset()` to clear everything.\n *\n * Trackers can automatically reset after a given number of samples\n * ```\n * // reset after 100 samples\n * const t = number({ resetAfterSamples: 100 });\n * ```\n *\n * To store values, use the `storeIntermediate` option:\n *\n * ```js\n * const t = number({ storeIntermediate: true });\n * ```\n *\n * Difference between last value and initial value:\n * ```js\n * t.relativeDifference();\n * ```\n *\n * Get raw data (if it is being stored):\n * ```js\n * t.values; // array of numbers\n * t.timestampes; // array of millisecond times, indexes correspond to t.values\n * ```\n */\nexport const number = (opts = {}) => new NumberTracker(opts);\n","import { NumberTracker } from './number-tracker.js';\n/**\n * A `Tracker` that tracks interval between calls to `mark()`\n */\nexport class IntervalTracker extends NumberTracker {\n    lastMark = 0;\n    mark() {\n        if (this.lastMark > 0) {\n            this.seen(performance.now() - this.lastMark);\n        }\n        this.lastMark = performance.now();\n    }\n}\n/**\n * Returns a new {@link IntervalTracker} instance. IntervalTracker\n * records the interval between each call to `mark`.\n *\n * ```js\n * import { interval } from '@ixfx/trackers.js';\n *\n * const t = interval();\n *\n * // Call `mark` to record an interval\n * t.mark();\n * ...\n * t.mark();\n *\n * // Get average time in milliseconds between calls to `mark`\n * t.avg;\n *\n * // Longest and shortest times are available too...\n * t.min / t.max\n * ```\n *\n * Interval tracker can automatically reset after a given number of samples:\n *\n * ```\n * // Reset after 100 samples\n * const t = interval({ resetAfterSamples: 100} );\n * ```\n * @param options Options for tracker\n * @returns New interval tracker\n */\nexport const interval = (options) => new IntervalTracker(options);\n","import { timeout } from \"@ixfx/flow\";\n/**\n * Tracks the rate of events.\n * It's also able to compute the min,max and average interval between events.\n *\n * @example\n * ```js\n * const clicks = Trackers.rate();\n *\n * // Mark when a click happens\n * document.addEventListener(`click`, () => clicks.mark());\n *\n * // Get details\n * clicks.perSecond; // How many clicks per second\n * clicks.perMinute; // How many clicks per minute\n * ```\n *\n * `timeoutInterval` is a useful option to make the tracker reset\n * after some period without `mark()` being called.\n *\n * Another useful option is `sampleLimit`, which sets an upper bound\n * for how many events to track. A smaller value means the results\n * will more accurately track, but it might be less smooth.\n *\n * ```js\n * // Eg reset tracker after 5 seconds of inactivity\n * const clicks = Trackers.rate({\n *  sampleLimit: 10,\n *  timeoutInterval: { secs: 5 }\n * });\n * ```\n */\nexport class RateTracker {\n    #events = [];\n    #fromTime;\n    #resetAfterSamples;\n    #sampleLimit;\n    #resetTimer;\n    constructor(opts = {}) {\n        this.#resetAfterSamples = opts.resetAfterSamples ?? Number.MAX_SAFE_INTEGER;\n        this.#sampleLimit = opts.sampleLimit ?? Number.MAX_SAFE_INTEGER;\n        if (opts.timeoutInterval) {\n            this.#resetTimer = timeout(() => {\n                this.reset();\n            }, opts.timeoutInterval);\n        }\n        this.#fromTime = performance.now();\n    }\n    /**\n     * Mark that an event has happened\n     */\n    mark() {\n        if (this.#events.length >= this.#resetAfterSamples) {\n            this.reset();\n        }\n        else if (this.#events.length >= this.#sampleLimit) {\n            this.#events = this.#events.slice(1);\n            this.#fromTime = this.#events[0];\n        }\n        this.#events.push(performance.now());\n        if (this.#resetTimer) {\n            this.#resetTimer.start();\n        }\n    }\n    /**\n     * Compute {min,max,avg} for the interval _between_ events.\n     * @returns\n     */\n    computeIntervals() {\n        const intervals = [];\n        let min = Number.MAX_SAFE_INTEGER;\n        let max = Number.MIN_SAFE_INTEGER;\n        let total = 0;\n        let count = 0;\n        let start = 0;\n        for (const event of this.#events) {\n            if (count > 0) {\n                const index = event - start;\n                min = Math.min(index, min);\n                max = Math.max(index, max);\n                total += index;\n                intervals.push(index);\n            }\n            start = event;\n            count++;\n        }\n        const avg = total / count;\n        return {\n            min, max, avg\n        };\n    }\n    /**\n     * Returns the time period (in milliseconds) that encompasses\n     * the data set. Eg, a result of 1000 means there's data that\n     * covers a one second period.\n     */\n    get elapsed() {\n        return performance.now() - this.#fromTime;\n    }\n    /**\n     * Resets the tracker.\n     */\n    reset() {\n        this.#events = [];\n        this.#fromTime = performance.now();\n    }\n    /**\n     * Get the number of events per second\n     */\n    get perSecond() {\n        return this.#events.length / (this.elapsed / 1000);\n    }\n    /**\n     * Get the number of events per minute\n     */\n    get perMinute() {\n        return this.#events.length / (this.elapsed / 1000 / 60);\n    }\n}\n/**\n * @inheritdoc RateTracker\n * @param opts\n * @returns\n */\nexport const rate = (opts = {}) => new RateTracker(opts);\n","import { TrackerBase } from './tracker-base.js';\n/**\n * A tracked value of type `V`.\n */\nexport class ObjectTracker extends TrackerBase {\n    values;\n    constructor(opts = {}) {\n        super(opts);\n        this.values = [];\n    }\n    onTrimmed(reason) {\n        // no-op\n    }\n    /**\n     * Reduces size of value store to `limit`.\n     * Returns number of remaining items\n     * @param limit\n     */\n    trimStore(limit) {\n        if (limit >= this.values.length)\n            return this.values.length;\n        // Index 0 will be the oldest\n        this.values = this.values.slice(-limit);\n        return this.values.length;\n    }\n    /**\n     * Allows sub-classes to be notified when a reset happens\n     * @ignore\n     */\n    onReset() {\n        this.values = [];\n    }\n    /**\n     * Tracks a value\n     * @ignore\n     */\n    filterData(p) {\n        // Make sure values have a timestamp\n        const ts = p.map((v) => `at` in v\n            ? v\n            : {\n                ...v,\n                at: Date.now(),\n            });\n        // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n        const last = ts.at(-1);\n        if (this.storeIntermediate)\n            this.values.push(...ts);\n        else\n            switch (this.values.length) {\n                case 0: {\n                    // Add as initial value\n                    this.values.push(last);\n                    break;\n                }\n                case 1: {\n                    // Add last value\n                    this.values.push(last);\n                    break;\n                }\n                case 2: {\n                    // Replace last value\n                    this.values[1] = last;\n                    break;\n                }\n            }\n        return ts;\n    }\n    /**\n     * Last seen value. If no values have been added, it will return the initial value\n     */\n    get last() {\n        if (this.values.length === 1)\n            return this.values[0];\n        //eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n        return this.values.at(-1);\n    }\n    /**\n     * Returns the oldest value in the buffer\n     */\n    get initial() {\n        return this.values.at(0);\n    }\n    /**\n     * Returns number of recorded values (includes the initial value in the count)\n     */\n    get size() {\n        return this.values.length;\n    }\n    /**\n     * Returns the elapsed time, in milliseconds since the initial value\n     */\n    get elapsed() {\n        return Date.now() - this.values[0].at;\n    }\n    /**\n     * Returns the time, in milliseconds, covering the initial and last values.\n     * Returns NaN if either of these is missing.\n     */\n    get timespan() {\n        const oldest = this.initial;\n        const newest = this.last;\n        if (!oldest)\n            return Number.NaN;\n        if (!newest)\n            return Number.NaN;\n        return newest.at - oldest.at;\n    }\n}\n","import { getOrGenerate, getOrGenerateSync } from '@ixfx/core/maps';\nimport { TrackerBase } from './tracker-base.js';\n/**\n * Keeps track of keyed values of type `V` (eg Point). It stores occurences in type `T`, which\n * must extend from `TrackerBase<V>`, eg `PointTracker`.\n *\n * The `creator` function passed in to the constructor is responsible for instantiating\n * the appropriate `TrackerBase` sub-class.\n *\n * @example Sub-class\n * ```js\n * export class PointsTracker extends TrackedValueMap<Points.Point> {\n *  constructor(opts:TrackOpts = {}) {\n *   super((key, start) => {\n *    if (start === undefined) throw new Error(`Requires start point`);\n *    const p = new PointTracker(key, opts);\n *    p.seen(start);\n *    return p;\n *   });\n *  }\n * }\n * ```\n *\n */\nexport class TrackedValueMap {\n    store;\n    gog;\n    constructor(creator) {\n        this.store = new Map();\n        this.gog = getOrGenerateSync(this.store, creator);\n    }\n    /**\n     * Number of named values being tracked\n     */\n    get size() {\n        return this.store.size;\n    }\n    /**\n     * Returns _true_ if `id` is stored\n     * @param id\n     * @returns\n     */\n    has(id) {\n        return this.store.has(id);\n    }\n    /**\n     * For a given id, note that we have seen one or more values.\n     * @param id Id\n     * @param values Values(s)\n     * @returns Information about start to last value\n     */\n    seen(id, ...values) {\n        const trackedValue = this.getTrackedValue(id, ...values);\n        // Pass it over to the TrackedValue\n        const result = trackedValue.seen(...values);\n        return result;\n    }\n    /**\n     * Creates or returns a TrackedValue instance for `id`.\n     * @param id\n     * @param values\n     * @returns\n     */\n    getTrackedValue(id, ...values) {\n        if (id === null)\n            throw new Error(`id parameter cannot be null`);\n        if (id === undefined)\n            throw new Error(`id parameter cannot be undefined`);\n        // Create or recall TrackedValue by id\n        const trackedValue = this.gog(id, values[0]);\n        return trackedValue;\n    }\n    /**\n     * Remove a tracked value by id.\n     * Use {@link reset} to clear them all.\n     * @param id\n     */\n    delete(id) {\n        this.store.delete(id);\n    }\n    /**\n     * Remove all tracked values.\n     * Use {@link delete} to remove a single value by id.\n     */\n    reset() {\n        this.store = new Map();\n    }\n    /**\n     * Enumerate ids\n     */\n    *ids() {\n        yield* this.store.keys();\n    }\n    /**\n     * Enumerate tracked values\n     */\n    *tracked() {\n        yield* this.store.values();\n    }\n    /**\n     * Iterates TrackedValues ordered with oldest first\n     * @returns\n     */\n    *trackedByAge() {\n        const tp = [...this.store.values()];\n        tp.sort((a, b) => {\n            const aa = a.elapsed;\n            const bb = b.elapsed;\n            if (aa === bb)\n                return 0;\n            if (aa > bb)\n                return -1;\n            return 1;\n        });\n        for (const t of tp) {\n            yield t;\n        }\n    }\n    /**\n     * Iterates underlying values, ordered by age (oldest first)\n     * First the named values are sorted by their `elapsed` value, and then\n     * we return the last value for that group.\n     */\n    *valuesByAge() {\n        for (const tb of this.trackedByAge()) {\n            yield tb.last;\n        }\n    }\n    /**\n     * Enumerate last received values\n     *\n     * @example Calculate centroid of latest-received values\n     * ```js\n     * const pointers = pointTracker();\n     * const c = Points.centroid(...Array.from(pointers.lastPoints()));\n     * ```\n     */\n    *last() {\n        for (const p of this.store.values()) {\n            yield p.last;\n        }\n    }\n    /**\n     * Enumerate starting values\n     */\n    *initialValues() {\n        for (const p of this.store.values()) {\n            yield p.initial;\n        }\n    }\n    /**\n     * Returns a tracked value by id, or undefined if not found\n     * @param id\n     * @returns\n     */\n    get(id) {\n        return this.store.get(id);\n    }\n}\n","export * from './changes.js';\nexport * from './frequency-mutable.js';\nexport * from './interval-tracker.js';\nexport * from './number-tracker.js';\nexport * from './rate-tracker.js';\nexport * from \"./object-tracker.js\";\nexport * from './primitive-tracker.js';\nexport * from \"./tracked-value.js\";\nexport * from './tracker-base.js';\nexport * from './types.js';\n","import { Bezier } from \"./bezier.js\";\n\n// math-inlining.\nconst { abs, cos, sin, acos, atan2, sqrt, pow } = Math;\n\n// cube root function yielding real roots\nfunction crt(v) {\n  return v < 0 ? -pow(-v, 1 / 3) : pow(v, 1 / 3);\n}\n\n// trig constants\nconst pi = Math.PI,\n  tau = 2 * pi,\n  quart = pi / 2,\n  // float precision significant decimal\n  epsilon = 0.000001,\n  // extremas used in bbox calculation and similar algorithms\n  nMax = Number.MAX_SAFE_INTEGER || 9007199254740991,\n  nMin = Number.MIN_SAFE_INTEGER || -9007199254740991,\n  // a zero coordinate, which is surprisingly useful\n  ZERO = { x: 0, y: 0, z: 0 };\n\n// Bezier utility functions\nconst utils = {\n  // Legendre-Gauss abscissae with n=24 (x_i values, defined at i=n as the roots of the nth order Legendre polynomial Pn(x))\n  Tvalues: [\n    -0.0640568928626056260850430826247450385909,\n    0.0640568928626056260850430826247450385909,\n    -0.1911188674736163091586398207570696318404,\n    0.1911188674736163091586398207570696318404,\n    -0.3150426796961633743867932913198102407864,\n    0.3150426796961633743867932913198102407864,\n    -0.4337935076260451384870842319133497124524,\n    0.4337935076260451384870842319133497124524,\n    -0.5454214713888395356583756172183723700107,\n    0.5454214713888395356583756172183723700107,\n    -0.6480936519369755692524957869107476266696,\n    0.6480936519369755692524957869107476266696,\n    -0.7401241915785543642438281030999784255232,\n    0.7401241915785543642438281030999784255232,\n    -0.8200019859739029219539498726697452080761,\n    0.8200019859739029219539498726697452080761,\n    -0.8864155270044010342131543419821967550873,\n    0.8864155270044010342131543419821967550873,\n    -0.9382745520027327585236490017087214496548,\n    0.9382745520027327585236490017087214496548,\n    -0.9747285559713094981983919930081690617411,\n    0.9747285559713094981983919930081690617411,\n    -0.9951872199970213601799974097007368118745,\n    0.9951872199970213601799974097007368118745,\n  ],\n\n  // Legendre-Gauss weights with n=24 (w_i values, defined by a function linked to in the Bezier primer article)\n  Cvalues: [\n    0.1279381953467521569740561652246953718517,\n    0.1279381953467521569740561652246953718517,\n    0.1258374563468282961213753825111836887264,\n    0.1258374563468282961213753825111836887264,\n    0.121670472927803391204463153476262425607,\n    0.121670472927803391204463153476262425607,\n    0.1155056680537256013533444839067835598622,\n    0.1155056680537256013533444839067835598622,\n    0.1074442701159656347825773424466062227946,\n    0.1074442701159656347825773424466062227946,\n    0.0976186521041138882698806644642471544279,\n    0.0976186521041138882698806644642471544279,\n    0.086190161531953275917185202983742667185,\n    0.086190161531953275917185202983742667185,\n    0.0733464814110803057340336152531165181193,\n    0.0733464814110803057340336152531165181193,\n    0.0592985849154367807463677585001085845412,\n    0.0592985849154367807463677585001085845412,\n    0.0442774388174198061686027482113382288593,\n    0.0442774388174198061686027482113382288593,\n    0.0285313886289336631813078159518782864491,\n    0.0285313886289336631813078159518782864491,\n    0.0123412297999871995468056670700372915759,\n    0.0123412297999871995468056670700372915759,\n  ],\n\n  arcfn: function (t, derivativeFn) {\n    const d = derivativeFn(t);\n    let l = d.x * d.x + d.y * d.y;\n    if (typeof d.z !== \"undefined\") {\n      l += d.z * d.z;\n    }\n    return sqrt(l);\n  },\n\n  compute: function (t, points, _3d) {\n    // shortcuts\n    if (t === 0) {\n      points[0].t = 0;\n      return points[0];\n    }\n\n    const order = points.length - 1;\n\n    if (t === 1) {\n      points[order].t = 1;\n      return points[order];\n    }\n\n    const mt = 1 - t;\n    let p = points;\n\n    // constant?\n    if (order === 0) {\n      points[0].t = t;\n      return points[0];\n    }\n\n    // linear?\n    if (order === 1) {\n      const ret = {\n        x: mt * p[0].x + t * p[1].x,\n        y: mt * p[0].y + t * p[1].y,\n        t: t,\n      };\n      if (_3d) {\n        ret.z = mt * p[0].z + t * p[1].z;\n      }\n      return ret;\n    }\n\n    // quadratic/cubic curve?\n    if (order < 4) {\n      let mt2 = mt * mt,\n        t2 = t * t,\n        a,\n        b,\n        c,\n        d = 0;\n      if (order === 2) {\n        p = [p[0], p[1], p[2], ZERO];\n        a = mt2;\n        b = mt * t * 2;\n        c = t2;\n      } else if (order === 3) {\n        a = mt2 * mt;\n        b = mt2 * t * 3;\n        c = mt * t2 * 3;\n        d = t * t2;\n      }\n      const ret = {\n        x: a * p[0].x + b * p[1].x + c * p[2].x + d * p[3].x,\n        y: a * p[0].y + b * p[1].y + c * p[2].y + d * p[3].y,\n        t: t,\n      };\n      if (_3d) {\n        ret.z = a * p[0].z + b * p[1].z + c * p[2].z + d * p[3].z;\n      }\n      return ret;\n    }\n\n    // higher order curves: use de Casteljau's computation\n    const dCpts = JSON.parse(JSON.stringify(points));\n    while (dCpts.length > 1) {\n      for (let i = 0; i < dCpts.length - 1; i++) {\n        dCpts[i] = {\n          x: dCpts[i].x + (dCpts[i + 1].x - dCpts[i].x) * t,\n          y: dCpts[i].y + (dCpts[i + 1].y - dCpts[i].y) * t,\n        };\n        if (typeof dCpts[i].z !== \"undefined\") {\n          dCpts[i].z = dCpts[i].z + (dCpts[i + 1].z - dCpts[i].z) * t;\n        }\n      }\n      dCpts.splice(dCpts.length - 1, 1);\n    }\n    dCpts[0].t = t;\n    return dCpts[0];\n  },\n\n  computeWithRatios: function (t, points, ratios, _3d) {\n    const mt = 1 - t,\n      r = ratios,\n      p = points;\n\n    let f1 = r[0],\n      f2 = r[1],\n      f3 = r[2],\n      f4 = r[3],\n      d;\n\n    // spec for linear\n    f1 *= mt;\n    f2 *= t;\n\n    if (p.length === 2) {\n      d = f1 + f2;\n      return {\n        x: (f1 * p[0].x + f2 * p[1].x) / d,\n        y: (f1 * p[0].y + f2 * p[1].y) / d,\n        z: !_3d ? false : (f1 * p[0].z + f2 * p[1].z) / d,\n        t: t,\n      };\n    }\n\n    // upgrade to quadratic\n    f1 *= mt;\n    f2 *= 2 * mt;\n    f3 *= t * t;\n\n    if (p.length === 3) {\n      d = f1 + f2 + f3;\n      return {\n        x: (f1 * p[0].x + f2 * p[1].x + f3 * p[2].x) / d,\n        y: (f1 * p[0].y + f2 * p[1].y + f3 * p[2].y) / d,\n        z: !_3d ? false : (f1 * p[0].z + f2 * p[1].z + f3 * p[2].z) / d,\n        t: t,\n      };\n    }\n\n    // upgrade to cubic\n    f1 *= mt;\n    f2 *= 1.5 * mt;\n    f3 *= 3 * mt;\n    f4 *= t * t * t;\n\n    if (p.length === 4) {\n      d = f1 + f2 + f3 + f4;\n      return {\n        x: (f1 * p[0].x + f2 * p[1].x + f3 * p[2].x + f4 * p[3].x) / d,\n        y: (f1 * p[0].y + f2 * p[1].y + f3 * p[2].y + f4 * p[3].y) / d,\n        z: !_3d\n          ? false\n          : (f1 * p[0].z + f2 * p[1].z + f3 * p[2].z + f4 * p[3].z) / d,\n        t: t,\n      };\n    }\n  },\n\n  derive: function (points, _3d) {\n    const dpoints = [];\n    for (let p = points, d = p.length, c = d - 1; d > 1; d--, c--) {\n      const list = [];\n      for (let j = 0, dpt; j < c; j++) {\n        dpt = {\n          x: c * (p[j + 1].x - p[j].x),\n          y: c * (p[j + 1].y - p[j].y),\n        };\n        if (_3d) {\n          dpt.z = c * (p[j + 1].z - p[j].z);\n        }\n        list.push(dpt);\n      }\n      dpoints.push(list);\n      p = list;\n    }\n    return dpoints;\n  },\n\n  between: function (v, m, M) {\n    return (\n      (m <= v && v <= M) ||\n      utils.approximately(v, m) ||\n      utils.approximately(v, M)\n    );\n  },\n\n  approximately: function (a, b, precision) {\n    return abs(a - b) <= (precision || epsilon);\n  },\n\n  length: function (derivativeFn) {\n    const z = 0.5,\n      len = utils.Tvalues.length;\n\n    let sum = 0;\n\n    for (let i = 0, t; i < len; i++) {\n      t = z * utils.Tvalues[i] + z;\n      sum += utils.Cvalues[i] * utils.arcfn(t, derivativeFn);\n    }\n    return z * sum;\n  },\n\n  map: function (v, ds, de, ts, te) {\n    const d1 = de - ds,\n      d2 = te - ts,\n      v2 = v - ds,\n      r = v2 / d1;\n    return ts + d2 * r;\n  },\n\n  lerp: function (r, v1, v2) {\n    const ret = {\n      x: v1.x + r * (v2.x - v1.x),\n      y: v1.y + r * (v2.y - v1.y),\n    };\n    if (v1.z !== undefined && v2.z !== undefined) {\n      ret.z = v1.z + r * (v2.z - v1.z);\n    }\n    return ret;\n  },\n\n  pointToString: function (p) {\n    let s = p.x + \"/\" + p.y;\n    if (typeof p.z !== \"undefined\") {\n      s += \"/\" + p.z;\n    }\n    return s;\n  },\n\n  pointsToString: function (points) {\n    return \"[\" + points.map(utils.pointToString).join(\", \") + \"]\";\n  },\n\n  copy: function (obj) {\n    return JSON.parse(JSON.stringify(obj));\n  },\n\n  angle: function (o, v1, v2) {\n    const dx1 = v1.x - o.x,\n      dy1 = v1.y - o.y,\n      dx2 = v2.x - o.x,\n      dy2 = v2.y - o.y,\n      cross = dx1 * dy2 - dy1 * dx2,\n      dot = dx1 * dx2 + dy1 * dy2;\n    return atan2(cross, dot);\n  },\n\n  // round as string, to avoid rounding errors\n  round: function (v, d) {\n    const s = \"\" + v;\n    const pos = s.indexOf(\".\");\n    return parseFloat(s.substring(0, pos + 1 + d));\n  },\n\n  dist: function (p1, p2) {\n    const dx = p1.x - p2.x,\n      dy = p1.y - p2.y;\n    return sqrt(dx * dx + dy * dy);\n  },\n\n  closest: function (LUT, point) {\n    let mdist = pow(2, 63),\n      mpos,\n      d;\n    LUT.forEach(function (p, idx) {\n      d = utils.dist(point, p);\n      if (d < mdist) {\n        mdist = d;\n        mpos = idx;\n      }\n    });\n    return { mdist: mdist, mpos: mpos };\n  },\n\n  abcratio: function (t, n) {\n    // see ratio(t) note on http://pomax.github.io/bezierinfo/#abc\n    if (n !== 2 && n !== 3) {\n      return false;\n    }\n    if (typeof t === \"undefined\") {\n      t = 0.5;\n    } else if (t === 0 || t === 1) {\n      return t;\n    }\n    const bottom = pow(t, n) + pow(1 - t, n),\n      top = bottom - 1;\n    return abs(top / bottom);\n  },\n\n  projectionratio: function (t, n) {\n    // see u(t) note on http://pomax.github.io/bezierinfo/#abc\n    if (n !== 2 && n !== 3) {\n      return false;\n    }\n    if (typeof t === \"undefined\") {\n      t = 0.5;\n    } else if (t === 0 || t === 1) {\n      return t;\n    }\n    const top = pow(1 - t, n),\n      bottom = pow(t, n) + top;\n    return top / bottom;\n  },\n\n  lli8: function (x1, y1, x2, y2, x3, y3, x4, y4) {\n    const nx =\n        (x1 * y2 - y1 * x2) * (x3 - x4) - (x1 - x2) * (x3 * y4 - y3 * x4),\n      ny = (x1 * y2 - y1 * x2) * (y3 - y4) - (y1 - y2) * (x3 * y4 - y3 * x4),\n      d = (x1 - x2) * (y3 - y4) - (y1 - y2) * (x3 - x4);\n    if (d == 0) {\n      return false;\n    }\n    return { x: nx / d, y: ny / d };\n  },\n\n  lli4: function (p1, p2, p3, p4) {\n    const x1 = p1.x,\n      y1 = p1.y,\n      x2 = p2.x,\n      y2 = p2.y,\n      x3 = p3.x,\n      y3 = p3.y,\n      x4 = p4.x,\n      y4 = p4.y;\n    return utils.lli8(x1, y1, x2, y2, x3, y3, x4, y4);\n  },\n\n  lli: function (v1, v2) {\n    return utils.lli4(v1, v1.c, v2, v2.c);\n  },\n\n  makeline: function (p1, p2) {\n    return new Bezier(\n      p1.x,\n      p1.y,\n      (p1.x + p2.x) / 2,\n      (p1.y + p2.y) / 2,\n      p2.x,\n      p2.y\n    );\n  },\n\n  findbbox: function (sections) {\n    let mx = nMax,\n      my = nMax,\n      MX = nMin,\n      MY = nMin;\n    sections.forEach(function (s) {\n      const bbox = s.bbox();\n      if (mx > bbox.x.min) mx = bbox.x.min;\n      if (my > bbox.y.min) my = bbox.y.min;\n      if (MX < bbox.x.max) MX = bbox.x.max;\n      if (MY < bbox.y.max) MY = bbox.y.max;\n    });\n    return {\n      x: { min: mx, mid: (mx + MX) / 2, max: MX, size: MX - mx },\n      y: { min: my, mid: (my + MY) / 2, max: MY, size: MY - my },\n    };\n  },\n\n  shapeintersections: function (\n    s1,\n    bbox1,\n    s2,\n    bbox2,\n    curveIntersectionThreshold\n  ) {\n    if (!utils.bboxoverlap(bbox1, bbox2)) return [];\n    const intersections = [];\n    const a1 = [s1.startcap, s1.forward, s1.back, s1.endcap];\n    const a2 = [s2.startcap, s2.forward, s2.back, s2.endcap];\n    a1.forEach(function (l1) {\n      if (l1.virtual) return;\n      a2.forEach(function (l2) {\n        if (l2.virtual) return;\n        const iss = l1.intersects(l2, curveIntersectionThreshold);\n        if (iss.length > 0) {\n          iss.c1 = l1;\n          iss.c2 = l2;\n          iss.s1 = s1;\n          iss.s2 = s2;\n          intersections.push(iss);\n        }\n      });\n    });\n    return intersections;\n  },\n\n  makeshape: function (forward, back, curveIntersectionThreshold) {\n    const bpl = back.points.length;\n    const fpl = forward.points.length;\n    const start = utils.makeline(back.points[bpl - 1], forward.points[0]);\n    const end = utils.makeline(forward.points[fpl - 1], back.points[0]);\n    const shape = {\n      startcap: start,\n      forward: forward,\n      back: back,\n      endcap: end,\n      bbox: utils.findbbox([start, forward, back, end]),\n    };\n    shape.intersections = function (s2) {\n      return utils.shapeintersections(\n        shape,\n        shape.bbox,\n        s2,\n        s2.bbox,\n        curveIntersectionThreshold\n      );\n    };\n    return shape;\n  },\n\n  getminmax: function (curve, d, list) {\n    if (!list) return { min: 0, max: 0 };\n    let min = nMax,\n      max = nMin,\n      t,\n      c;\n    if (list.indexOf(0) === -1) {\n      list = [0].concat(list);\n    }\n    if (list.indexOf(1) === -1) {\n      list.push(1);\n    }\n    for (let i = 0, len = list.length; i < len; i++) {\n      t = list[i];\n      c = curve.get(t);\n      if (c[d] < min) {\n        min = c[d];\n      }\n      if (c[d] > max) {\n        max = c[d];\n      }\n    }\n    return { min: min, mid: (min + max) / 2, max: max, size: max - min };\n  },\n\n  align: function (points, line) {\n    const tx = line.p1.x,\n      ty = line.p1.y,\n      a = -atan2(line.p2.y - ty, line.p2.x - tx),\n      d = function (v) {\n        return {\n          x: (v.x - tx) * cos(a) - (v.y - ty) * sin(a),\n          y: (v.x - tx) * sin(a) + (v.y - ty) * cos(a),\n        };\n      };\n    return points.map(d);\n  },\n\n  roots: function (points, line) {\n    line = line || { p1: { x: 0, y: 0 }, p2: { x: 1, y: 0 } };\n\n    const order = points.length - 1;\n    const aligned = utils.align(points, line);\n    const reduce = function (t) {\n      return 0 <= t && t <= 1;\n    };\n\n    if (order === 2) {\n      const a = aligned[0].y,\n        b = aligned[1].y,\n        c = aligned[2].y,\n        d = a - 2 * b + c;\n      if (d !== 0) {\n        const m1 = -sqrt(b * b - a * c),\n          m2 = -a + b,\n          v1 = -(m1 + m2) / d,\n          v2 = -(-m1 + m2) / d;\n        return [v1, v2].filter(reduce);\n      } else if (b !== c && d === 0) {\n        return [(2 * b - c) / (2 * b - 2 * c)].filter(reduce);\n      }\n      return [];\n    }\n\n    // see http://www.trans4mind.com/personal_development/mathematics/polynomials/cubicAlgebra.htm\n    const pa = aligned[0].y,\n      pb = aligned[1].y,\n      pc = aligned[2].y,\n      pd = aligned[3].y;\n\n    let d = -pa + 3 * pb - 3 * pc + pd,\n      a = 3 * pa - 6 * pb + 3 * pc,\n      b = -3 * pa + 3 * pb,\n      c = pa;\n\n    if (utils.approximately(d, 0)) {\n      // this is not a cubic curve.\n      if (utils.approximately(a, 0)) {\n        // in fact, this is not a quadratic curve either.\n        if (utils.approximately(b, 0)) {\n          // in fact in fact, there are no solutions.\n          return [];\n        }\n        // linear solution:\n        return [-c / b].filter(reduce);\n      }\n      // quadratic solution:\n      const q = sqrt(b * b - 4 * a * c),\n        a2 = 2 * a;\n      return [(q - b) / a2, (-b - q) / a2].filter(reduce);\n    }\n\n    // at this point, we know we need a cubic solution:\n\n    a /= d;\n    b /= d;\n    c /= d;\n\n    const p = (3 * b - a * a) / 3,\n      p3 = p / 3,\n      q = (2 * a * a * a - 9 * a * b + 27 * c) / 27,\n      q2 = q / 2,\n      discriminant = q2 * q2 + p3 * p3 * p3;\n\n    let u1, v1, x1, x2, x3;\n    if (discriminant < 0) {\n      const mp3 = -p / 3,\n        mp33 = mp3 * mp3 * mp3,\n        r = sqrt(mp33),\n        t = -q / (2 * r),\n        cosphi = t < -1 ? -1 : t > 1 ? 1 : t,\n        phi = acos(cosphi),\n        crtr = crt(r),\n        t1 = 2 * crtr;\n      x1 = t1 * cos(phi / 3) - a / 3;\n      x2 = t1 * cos((phi + tau) / 3) - a / 3;\n      x3 = t1 * cos((phi + 2 * tau) / 3) - a / 3;\n      return [x1, x2, x3].filter(reduce);\n    } else if (discriminant === 0) {\n      u1 = q2 < 0 ? crt(-q2) : -crt(q2);\n      x1 = 2 * u1 - a / 3;\n      x2 = -u1 - a / 3;\n      return [x1, x2].filter(reduce);\n    } else {\n      const sd = sqrt(discriminant);\n      u1 = crt(-q2 + sd);\n      v1 = crt(q2 + sd);\n      return [u1 - v1 - a / 3].filter(reduce);\n    }\n  },\n\n  droots: function (p) {\n    // quadratic roots are easy\n    if (p.length === 3) {\n      const a = p[0],\n        b = p[1],\n        c = p[2],\n        d = a - 2 * b + c;\n      if (d !== 0) {\n        const m1 = -sqrt(b * b - a * c),\n          m2 = -a + b,\n          v1 = -(m1 + m2) / d,\n          v2 = -(-m1 + m2) / d;\n        return [v1, v2];\n      } else if (b !== c && d === 0) {\n        return [(2 * b - c) / (2 * (b - c))];\n      }\n      return [];\n    }\n\n    // linear roots are even easier\n    if (p.length === 2) {\n      const a = p[0],\n        b = p[1];\n      if (a !== b) {\n        return [a / (a - b)];\n      }\n      return [];\n    }\n\n    return [];\n  },\n\n  curvature: function (t, d1, d2, _3d, kOnly) {\n    let num,\n      dnm,\n      adk,\n      dk,\n      k = 0,\n      r = 0;\n\n    //\n    // We're using the following formula for curvature:\n    //\n    //              x'y\" - y'x\"\n    //   k(t) = ------------------\n    //           (x' + y')^(3/2)\n    //\n    // from https://en.wikipedia.org/wiki/Radius_of_curvature#Definition\n    //\n    // With it corresponding 3D counterpart:\n    //\n    //          sqrt( (y'z\" - y\"z') + (z'x\" - z\"x') + (x'y\" - x\"y'))\n    //   k(t) = -------------------------------------------------------\n    //                     (x' + y' + z')^(3/2)\n    //\n\n    const d = utils.compute(t, d1);\n    const dd = utils.compute(t, d2);\n    const qdsum = d.x * d.x + d.y * d.y;\n\n    if (_3d) {\n      num = sqrt(\n        pow(d.y * dd.z - dd.y * d.z, 2) +\n          pow(d.z * dd.x - dd.z * d.x, 2) +\n          pow(d.x * dd.y - dd.x * d.y, 2)\n      );\n      dnm = pow(qdsum + d.z * d.z, 3 / 2);\n    } else {\n      num = d.x * dd.y - d.y * dd.x;\n      dnm = pow(qdsum, 3 / 2);\n    }\n\n    if (num === 0 || dnm === 0) {\n      return { k: 0, r: 0 };\n    }\n\n    k = num / dnm;\n    r = dnm / num;\n\n    // We're also computing the derivative of kappa, because\n    // there is value in knowing the rate of change for the\n    // curvature along the curve. And we're just going to\n    // ballpark it based on an epsilon.\n    if (!kOnly) {\n      // compute k'(t) based on the interval before, and after it,\n      // to at least try to not introduce forward/backward pass bias.\n      const pk = utils.curvature(t - 0.001, d1, d2, _3d, true).k;\n      const nk = utils.curvature(t + 0.001, d1, d2, _3d, true).k;\n      dk = (nk - k + (k - pk)) / 2;\n      adk = (abs(nk - k) + abs(k - pk)) / 2;\n    }\n\n    return { k: k, r: r, dk: dk, adk: adk };\n  },\n\n  inflections: function (points) {\n    if (points.length < 4) return [];\n\n    // FIXME: TODO: add in inflection abstraction for quartic+ curves?\n\n    const p = utils.align(points, { p1: points[0], p2: points.slice(-1)[0] }),\n      a = p[2].x * p[1].y,\n      b = p[3].x * p[1].y,\n      c = p[1].x * p[2].y,\n      d = p[3].x * p[2].y,\n      v1 = 18 * (-3 * a + 2 * b + 3 * c - d),\n      v2 = 18 * (3 * a - b - 3 * c),\n      v3 = 18 * (c - a);\n\n    if (utils.approximately(v1, 0)) {\n      if (!utils.approximately(v2, 0)) {\n        let t = -v3 / v2;\n        if (0 <= t && t <= 1) return [t];\n      }\n      return [];\n    }\n\n    const d2 = 2 * v1;\n\n    if (utils.approximately(d2, 0)) return [];\n\n    const trm = v2 * v2 - 4 * v1 * v3;\n\n    if (trm < 0) return [];\n\n    const sq = Math.sqrt(trm);\n\n    return [(sq - v2) / d2, -(v2 + sq) / d2].filter(function (r) {\n      return 0 <= r && r <= 1;\n    });\n  },\n\n  bboxoverlap: function (b1, b2) {\n    const dims = [\"x\", \"y\"],\n      len = dims.length;\n\n    for (let i = 0, dim, l, t, d; i < len; i++) {\n      dim = dims[i];\n      l = b1[dim].mid;\n      t = b2[dim].mid;\n      d = (b1[dim].size + b2[dim].size) / 2;\n      if (abs(l - t) >= d) return false;\n    }\n    return true;\n  },\n\n  expandbox: function (bbox, _bbox) {\n    if (_bbox.x.min < bbox.x.min) {\n      bbox.x.min = _bbox.x.min;\n    }\n    if (_bbox.y.min < bbox.y.min) {\n      bbox.y.min = _bbox.y.min;\n    }\n    if (_bbox.z && _bbox.z.min < bbox.z.min) {\n      bbox.z.min = _bbox.z.min;\n    }\n    if (_bbox.x.max > bbox.x.max) {\n      bbox.x.max = _bbox.x.max;\n    }\n    if (_bbox.y.max > bbox.y.max) {\n      bbox.y.max = _bbox.y.max;\n    }\n    if (_bbox.z && _bbox.z.max > bbox.z.max) {\n      bbox.z.max = _bbox.z.max;\n    }\n    bbox.x.mid = (bbox.x.min + bbox.x.max) / 2;\n    bbox.y.mid = (bbox.y.min + bbox.y.max) / 2;\n    if (bbox.z) {\n      bbox.z.mid = (bbox.z.min + bbox.z.max) / 2;\n    }\n    bbox.x.size = bbox.x.max - bbox.x.min;\n    bbox.y.size = bbox.y.max - bbox.y.min;\n    if (bbox.z) {\n      bbox.z.size = bbox.z.max - bbox.z.min;\n    }\n  },\n\n  pairiteration: function (c1, c2, curveIntersectionThreshold) {\n    const c1b = c1.bbox(),\n      c2b = c2.bbox(),\n      r = 100000,\n      threshold = curveIntersectionThreshold || 0.5;\n\n    if (\n      c1b.x.size + c1b.y.size < threshold &&\n      c2b.x.size + c2b.y.size < threshold\n    ) {\n      return [\n        (((r * (c1._t1 + c1._t2)) / 2) | 0) / r +\n          \"/\" +\n          (((r * (c2._t1 + c2._t2)) / 2) | 0) / r,\n      ];\n    }\n\n    let cc1 = c1.split(0.5),\n      cc2 = c2.split(0.5),\n      pairs = [\n        { left: cc1.left, right: cc2.left },\n        { left: cc1.left, right: cc2.right },\n        { left: cc1.right, right: cc2.right },\n        { left: cc1.right, right: cc2.left },\n      ];\n\n    pairs = pairs.filter(function (pair) {\n      return utils.bboxoverlap(pair.left.bbox(), pair.right.bbox());\n    });\n\n    let results = [];\n\n    if (pairs.length === 0) return results;\n\n    pairs.forEach(function (pair) {\n      results = results.concat(\n        utils.pairiteration(pair.left, pair.right, threshold)\n      );\n    });\n\n    results = results.filter(function (v, i) {\n      return results.indexOf(v) === i;\n    });\n\n    return results;\n  },\n\n  getccenter: function (p1, p2, p3) {\n    const dx1 = p2.x - p1.x,\n      dy1 = p2.y - p1.y,\n      dx2 = p3.x - p2.x,\n      dy2 = p3.y - p2.y,\n      dx1p = dx1 * cos(quart) - dy1 * sin(quart),\n      dy1p = dx1 * sin(quart) + dy1 * cos(quart),\n      dx2p = dx2 * cos(quart) - dy2 * sin(quart),\n      dy2p = dx2 * sin(quart) + dy2 * cos(quart),\n      // chord midpoints\n      mx1 = (p1.x + p2.x) / 2,\n      my1 = (p1.y + p2.y) / 2,\n      mx2 = (p2.x + p3.x) / 2,\n      my2 = (p2.y + p3.y) / 2,\n      // midpoint offsets\n      mx1n = mx1 + dx1p,\n      my1n = my1 + dy1p,\n      mx2n = mx2 + dx2p,\n      my2n = my2 + dy2p,\n      // intersection of these lines:\n      arc = utils.lli8(mx1, my1, mx1n, my1n, mx2, my2, mx2n, my2n),\n      r = utils.dist(arc, p1);\n\n    // arc start/end values, over mid point:\n    let s = atan2(p1.y - arc.y, p1.x - arc.x),\n      m = atan2(p2.y - arc.y, p2.x - arc.x),\n      e = atan2(p3.y - arc.y, p3.x - arc.x),\n      _;\n\n    // determine arc direction (cw/ccw correction)\n    if (s < e) {\n      // if s<m<e, arc(s, e)\n      // if m<s<e, arc(e, s + tau)\n      // if s<e<m, arc(e, s + tau)\n      if (s > m || m > e) {\n        s += tau;\n      }\n      if (s > e) {\n        _ = e;\n        e = s;\n        s = _;\n      }\n    } else {\n      // if e<m<s, arc(e, s)\n      // if m<e<s, arc(s, e + tau)\n      // if e<s<m, arc(s, e + tau)\n      if (e < m && m < s) {\n        _ = e;\n        e = s;\n        s = _;\n      } else {\n        e += tau;\n      }\n    }\n    // assign and done.\n    arc.s = s;\n    arc.e = e;\n    arc.r = r;\n    return arc;\n  },\n\n  numberSort: function (a, b) {\n    return a - b;\n  },\n};\n\nexport { utils };\n","import { utils } from \"./utils.js\";\n\n/**\n * Poly Bezier\n * @param {[type]} curves [description]\n */\nclass PolyBezier {\n  constructor(curves) {\n    this.curves = [];\n    this._3d = false;\n    if (!!curves) {\n      this.curves = curves;\n      this._3d = this.curves[0]._3d;\n    }\n  }\n\n  valueOf() {\n    return this.toString();\n  }\n\n  toString() {\n    return (\n      \"[\" +\n      this.curves\n        .map(function (curve) {\n          return utils.pointsToString(curve.points);\n        })\n        .join(\", \") +\n      \"]\"\n    );\n  }\n\n  addCurve(curve) {\n    this.curves.push(curve);\n    this._3d = this._3d || curve._3d;\n  }\n\n  length() {\n    return this.curves\n      .map(function (v) {\n        return v.length();\n      })\n      .reduce(function (a, b) {\n        return a + b;\n      });\n  }\n\n  curve(idx) {\n    return this.curves[idx];\n  }\n\n  bbox() {\n    const c = this.curves;\n    var bbox = c[0].bbox();\n    for (var i = 1; i < c.length; i++) {\n      utils.expandbox(bbox, c[i].bbox());\n    }\n    return bbox;\n  }\n\n  offset(d) {\n    const offset = [];\n    this.curves.forEach(function (v) {\n      offset.push(...v.offset(d));\n    });\n    return new PolyBezier(offset);\n  }\n}\n\nexport { PolyBezier };\n","/**\n  A javascript Bezier curve library by Pomax.\n\n  Based on http://pomax.github.io/bezierinfo\n\n  This code is MIT licensed.\n**/\n\nimport { utils } from \"./utils.js\";\nimport { PolyBezier } from \"./poly-bezier.js\";\n\n// math-inlining.\nconst { abs, min, max, cos, sin, acos, sqrt } = Math;\nconst pi = Math.PI;\n// a zero coordinate, which is surprisingly useful\nconst ZERO = { x: 0, y: 0, z: 0 };\n\n/**\n * Bezier curve constructor.\n *\n * ...docs pending...\n */\nclass Bezier {\n  constructor(coords) {\n    let args =\n      coords && coords.forEach ? coords : Array.from(arguments).slice();\n    let coordlen = false;\n\n    if (typeof args[0] === \"object\") {\n      coordlen = args.length;\n      const newargs = [];\n      args.forEach(function (point) {\n        [\"x\", \"y\", \"z\"].forEach(function (d) {\n          if (typeof point[d] !== \"undefined\") {\n            newargs.push(point[d]);\n          }\n        });\n      });\n      args = newargs;\n    }\n\n    let higher = false;\n    const len = args.length;\n\n    if (coordlen) {\n      if (coordlen > 4) {\n        if (arguments.length !== 1) {\n          throw new Error(\n            \"Only new Bezier(point[]) is accepted for 4th and higher order curves\"\n          );\n        }\n        higher = true;\n      }\n    } else {\n      if (len !== 6 && len !== 8 && len !== 9 && len !== 12) {\n        if (arguments.length !== 1) {\n          throw new Error(\n            \"Only new Bezier(point[]) is accepted for 4th and higher order curves\"\n          );\n        }\n      }\n    }\n\n    const _3d = (this._3d =\n      (!higher && (len === 9 || len === 12)) ||\n      (coords && coords[0] && typeof coords[0].z !== \"undefined\"));\n\n    const points = (this.points = []);\n    for (let idx = 0, step = _3d ? 3 : 2; idx < len; idx += step) {\n      var point = {\n        x: args[idx],\n        y: args[idx + 1],\n      };\n      if (_3d) {\n        point.z = args[idx + 2];\n      }\n      points.push(point);\n    }\n    const order = (this.order = points.length - 1);\n\n    const dims = (this.dims = [\"x\", \"y\"]);\n    if (_3d) dims.push(\"z\");\n    this.dimlen = dims.length;\n\n    // is this curve, practically speaking, a straight line?\n    const aligned = utils.align(points, { p1: points[0], p2: points[order] });\n    const baselength = utils.dist(points[0], points[order]);\n    this._linear = aligned.reduce((t, p) => t + abs(p.y), 0) < baselength / 50;\n\n    this._lut = [];\n    this._t1 = 0;\n    this._t2 = 1;\n    this.update();\n  }\n\n  static quadraticFromPoints(p1, p2, p3, t) {\n    if (typeof t === \"undefined\") {\n      t = 0.5;\n    }\n    // shortcuts, although they're really dumb\n    if (t === 0) {\n      return new Bezier(p2, p2, p3);\n    }\n    if (t === 1) {\n      return new Bezier(p1, p2, p2);\n    }\n    // real fitting.\n    const abc = Bezier.getABC(2, p1, p2, p3, t);\n    return new Bezier(p1, abc.A, p3);\n  }\n\n  static cubicFromPoints(S, B, E, t, d1) {\n    if (typeof t === \"undefined\") {\n      t = 0.5;\n    }\n    const abc = Bezier.getABC(3, S, B, E, t);\n    if (typeof d1 === \"undefined\") {\n      d1 = utils.dist(B, abc.C);\n    }\n    const d2 = (d1 * (1 - t)) / t;\n\n    const selen = utils.dist(S, E),\n      lx = (E.x - S.x) / selen,\n      ly = (E.y - S.y) / selen,\n      bx1 = d1 * lx,\n      by1 = d1 * ly,\n      bx2 = d2 * lx,\n      by2 = d2 * ly;\n    // derivation of new hull coordinates\n    const e1 = { x: B.x - bx1, y: B.y - by1 },\n      e2 = { x: B.x + bx2, y: B.y + by2 },\n      A = abc.A,\n      v1 = { x: A.x + (e1.x - A.x) / (1 - t), y: A.y + (e1.y - A.y) / (1 - t) },\n      v2 = { x: A.x + (e2.x - A.x) / t, y: A.y + (e2.y - A.y) / t },\n      nc1 = { x: S.x + (v1.x - S.x) / t, y: S.y + (v1.y - S.y) / t },\n      nc2 = {\n        x: E.x + (v2.x - E.x) / (1 - t),\n        y: E.y + (v2.y - E.y) / (1 - t),\n      };\n    // ...done\n    return new Bezier(S, nc1, nc2, E);\n  }\n\n  static getUtils() {\n    return utils;\n  }\n\n  getUtils() {\n    return Bezier.getUtils();\n  }\n\n  static get PolyBezier() {\n    return PolyBezier;\n  }\n\n  valueOf() {\n    return this.toString();\n  }\n\n  toString() {\n    return utils.pointsToString(this.points);\n  }\n\n  toSVG() {\n    if (this._3d) return false;\n    const p = this.points,\n      x = p[0].x,\n      y = p[0].y,\n      s = [\"M\", x, y, this.order === 2 ? \"Q\" : \"C\"];\n    for (let i = 1, last = p.length; i < last; i++) {\n      s.push(p[i].x);\n      s.push(p[i].y);\n    }\n    return s.join(\" \");\n  }\n\n  setRatios(ratios) {\n    if (ratios.length !== this.points.length) {\n      throw new Error(\"incorrect number of ratio values\");\n    }\n    this.ratios = ratios;\n    this._lut = []; //  invalidate any precomputed LUT\n  }\n\n  verify() {\n    const print = this.coordDigest();\n    if (print !== this._print) {\n      this._print = print;\n      this.update();\n    }\n  }\n\n  coordDigest() {\n    return this.points\n      .map(function (c, pos) {\n        return \"\" + pos + c.x + c.y + (c.z ? c.z : 0);\n      })\n      .join(\"\");\n  }\n\n  update() {\n    // invalidate any precomputed LUT\n    this._lut = [];\n    this.dpoints = utils.derive(this.points, this._3d);\n    this.computedirection();\n  }\n\n  computedirection() {\n    const points = this.points;\n    const angle = utils.angle(points[0], points[this.order], points[1]);\n    this.clockwise = angle > 0;\n  }\n\n  length() {\n    return utils.length(this.derivative.bind(this));\n  }\n\n  static getABC(order = 2, S, B, E, t = 0.5) {\n    const u = utils.projectionratio(t, order),\n      um = 1 - u,\n      C = {\n        x: u * S.x + um * E.x,\n        y: u * S.y + um * E.y,\n      },\n      s = utils.abcratio(t, order),\n      A = {\n        x: B.x + (B.x - C.x) / s,\n        y: B.y + (B.y - C.y) / s,\n      };\n    return { A, B, C, S, E };\n  }\n\n  getABC(t, B) {\n    B = B || this.get(t);\n    let S = this.points[0];\n    let E = this.points[this.order];\n    return Bezier.getABC(this.order, S, B, E, t);\n  }\n\n  getLUT(steps) {\n    this.verify();\n    steps = steps || 100;\n    if (this._lut.length === steps + 1) {\n      return this._lut;\n    }\n    this._lut = [];\n    // n steps means n+1 points\n    steps++;\n    this._lut = [];\n    for (let i = 0, p, t; i < steps; i++) {\n      t = i / (steps - 1);\n      p = this.compute(t);\n      p.t = t;\n      this._lut.push(p);\n    }\n    return this._lut;\n  }\n\n  on(point, error) {\n    error = error || 5;\n    const lut = this.getLUT(),\n      hits = [];\n    for (let i = 0, c, t = 0; i < lut.length; i++) {\n      c = lut[i];\n      if (utils.dist(c, point) < error) {\n        hits.push(c);\n        t += i / lut.length;\n      }\n    }\n    if (!hits.length) return false;\n    return (t /= hits.length);\n  }\n\n  project(point) {\n    // step 1: coarse check\n    const LUT = this.getLUT(),\n      l = LUT.length - 1,\n      closest = utils.closest(LUT, point),\n      mpos = closest.mpos,\n      t1 = (mpos - 1) / l,\n      t2 = (mpos + 1) / l,\n      step = 0.1 / l;\n\n    // step 2: fine check\n    let mdist = closest.mdist,\n      t = t1,\n      ft = t,\n      p;\n    mdist += 1;\n    for (let d; t < t2 + step; t += step) {\n      p = this.compute(t);\n      d = utils.dist(point, p);\n      if (d < mdist) {\n        mdist = d;\n        ft = t;\n      }\n    }\n    ft = ft < 0 ? 0 : ft > 1 ? 1 : ft;\n    p = this.compute(ft);\n    p.t = ft;\n    p.d = mdist;\n    return p;\n  }\n\n  get(t) {\n    return this.compute(t);\n  }\n\n  point(idx) {\n    return this.points[idx];\n  }\n\n  compute(t) {\n    if (this.ratios) {\n      return utils.computeWithRatios(t, this.points, this.ratios, this._3d);\n    }\n    return utils.compute(t, this.points, this._3d, this.ratios);\n  }\n\n  raise() {\n    const p = this.points,\n      np = [p[0]],\n      k = p.length;\n    for (let i = 1, pi, pim; i < k; i++) {\n      pi = p[i];\n      pim = p[i - 1];\n      np[i] = {\n        x: ((k - i) / k) * pi.x + (i / k) * pim.x,\n        y: ((k - i) / k) * pi.y + (i / k) * pim.y,\n      };\n    }\n    np[k] = p[k - 1];\n    return new Bezier(np);\n  }\n\n  derivative(t) {\n    return utils.compute(t, this.dpoints[0], this._3d);\n  }\n\n  dderivative(t) {\n    return utils.compute(t, this.dpoints[1], this._3d);\n  }\n\n  align() {\n    let p = this.points;\n    return new Bezier(utils.align(p, { p1: p[0], p2: p[p.length - 1] }));\n  }\n\n  curvature(t) {\n    return utils.curvature(t, this.dpoints[0], this.dpoints[1], this._3d);\n  }\n\n  inflections() {\n    return utils.inflections(this.points);\n  }\n\n  normal(t) {\n    return this._3d ? this.__normal3(t) : this.__normal2(t);\n  }\n\n  __normal2(t) {\n    const d = this.derivative(t);\n    const q = sqrt(d.x * d.x + d.y * d.y);\n    return { t, x: -d.y / q, y: d.x / q };\n  }\n\n  __normal3(t) {\n    // see http://stackoverflow.com/questions/25453159\n    const r1 = this.derivative(t),\n      r2 = this.derivative(t + 0.01),\n      q1 = sqrt(r1.x * r1.x + r1.y * r1.y + r1.z * r1.z),\n      q2 = sqrt(r2.x * r2.x + r2.y * r2.y + r2.z * r2.z);\n    r1.x /= q1;\n    r1.y /= q1;\n    r1.z /= q1;\n    r2.x /= q2;\n    r2.y /= q2;\n    r2.z /= q2;\n    // cross product\n    const c = {\n      x: r2.y * r1.z - r2.z * r1.y,\n      y: r2.z * r1.x - r2.x * r1.z,\n      z: r2.x * r1.y - r2.y * r1.x,\n    };\n    const m = sqrt(c.x * c.x + c.y * c.y + c.z * c.z);\n    c.x /= m;\n    c.y /= m;\n    c.z /= m;\n    // rotation matrix\n    const R = [\n      c.x * c.x,\n      c.x * c.y - c.z,\n      c.x * c.z + c.y,\n      c.x * c.y + c.z,\n      c.y * c.y,\n      c.y * c.z - c.x,\n      c.x * c.z - c.y,\n      c.y * c.z + c.x,\n      c.z * c.z,\n    ];\n    // normal vector:\n    const n = {\n      t,\n      x: R[0] * r1.x + R[1] * r1.y + R[2] * r1.z,\n      y: R[3] * r1.x + R[4] * r1.y + R[5] * r1.z,\n      z: R[6] * r1.x + R[7] * r1.y + R[8] * r1.z,\n    };\n    return n;\n  }\n\n  hull(t) {\n    let p = this.points,\n      _p = [],\n      q = [],\n      idx = 0;\n    q[idx++] = p[0];\n    q[idx++] = p[1];\n    q[idx++] = p[2];\n    if (this.order === 3) {\n      q[idx++] = p[3];\n    }\n    // we lerp between all points at each iteration, until we have 1 point left.\n    while (p.length > 1) {\n      _p = [];\n      for (let i = 0, pt, l = p.length - 1; i < l; i++) {\n        pt = utils.lerp(t, p[i], p[i + 1]);\n        q[idx++] = pt;\n        _p.push(pt);\n      }\n      p = _p;\n    }\n    return q;\n  }\n\n  split(t1, t2) {\n    // shortcuts\n    if (t1 === 0 && !!t2) {\n      return this.split(t2).left;\n    }\n    if (t2 === 1) {\n      return this.split(t1).right;\n    }\n\n    // no shortcut: use \"de Casteljau\" iteration.\n    const q = this.hull(t1);\n    const result = {\n      left:\n        this.order === 2\n          ? new Bezier([q[0], q[3], q[5]])\n          : new Bezier([q[0], q[4], q[7], q[9]]),\n      right:\n        this.order === 2\n          ? new Bezier([q[5], q[4], q[2]])\n          : new Bezier([q[9], q[8], q[6], q[3]]),\n      span: q,\n    };\n\n    // make sure we bind _t1/_t2 information!\n    result.left._t1 = utils.map(0, 0, 1, this._t1, this._t2);\n    result.left._t2 = utils.map(t1, 0, 1, this._t1, this._t2);\n    result.right._t1 = utils.map(t1, 0, 1, this._t1, this._t2);\n    result.right._t2 = utils.map(1, 0, 1, this._t1, this._t2);\n\n    // if we have no t2, we're done\n    if (!t2) {\n      return result;\n    }\n\n    // if we have a t2, split again:\n    t2 = utils.map(t2, t1, 1, 0, 1);\n    return result.right.split(t2).left;\n  }\n\n  extrema() {\n    const result = {};\n    let roots = [];\n\n    this.dims.forEach(\n      function (dim) {\n        let mfn = function (v) {\n          return v[dim];\n        };\n        let p = this.dpoints[0].map(mfn);\n        result[dim] = utils.droots(p);\n        if (this.order === 3) {\n          p = this.dpoints[1].map(mfn);\n          result[dim] = result[dim].concat(utils.droots(p));\n        }\n        result[dim] = result[dim].filter(function (t) {\n          return t >= 0 && t <= 1;\n        });\n        roots = roots.concat(result[dim].sort(utils.numberSort));\n      }.bind(this)\n    );\n\n    result.values = roots.sort(utils.numberSort).filter(function (v, idx) {\n      return roots.indexOf(v) === idx;\n    });\n\n    return result;\n  }\n\n  bbox() {\n    const extrema = this.extrema(),\n      result = {};\n    this.dims.forEach(\n      function (d) {\n        result[d] = utils.getminmax(this, d, extrema[d]);\n      }.bind(this)\n    );\n    return result;\n  }\n\n  overlaps(curve) {\n    const lbbox = this.bbox(),\n      tbbox = curve.bbox();\n    return utils.bboxoverlap(lbbox, tbbox);\n  }\n\n  offset(t, d) {\n    if (typeof d !== \"undefined\") {\n      const c = this.get(t),\n        n = this.normal(t);\n      const ret = {\n        c: c,\n        n: n,\n        x: c.x + n.x * d,\n        y: c.y + n.y * d,\n      };\n      if (this._3d) {\n        ret.z = c.z + n.z * d;\n      }\n      return ret;\n    }\n    if (this._linear) {\n      const nv = this.normal(0),\n        coords = this.points.map(function (p) {\n          const ret = {\n            x: p.x + t * nv.x,\n            y: p.y + t * nv.y,\n          };\n          if (p.z && nv.z) {\n            ret.z = p.z + t * nv.z;\n          }\n          return ret;\n        });\n      return [new Bezier(coords)];\n    }\n    return this.reduce().map(function (s) {\n      if (s._linear) {\n        return s.offset(t)[0];\n      }\n      return s.scale(t);\n    });\n  }\n\n  simple() {\n    if (this.order === 3) {\n      const a1 = utils.angle(this.points[0], this.points[3], this.points[1]);\n      const a2 = utils.angle(this.points[0], this.points[3], this.points[2]);\n      if ((a1 > 0 && a2 < 0) || (a1 < 0 && a2 > 0)) return false;\n    }\n    const n1 = this.normal(0);\n    const n2 = this.normal(1);\n    let s = n1.x * n2.x + n1.y * n2.y;\n    if (this._3d) {\n      s += n1.z * n2.z;\n    }\n    return abs(acos(s)) < pi / 3;\n  }\n\n  reduce() {\n    // TODO: examine these var types in more detail...\n    let i,\n      t1 = 0,\n      t2 = 0,\n      step = 0.01,\n      segment,\n      pass1 = [],\n      pass2 = [];\n    // first pass: split on extrema\n    let extrema = this.extrema().values;\n    if (extrema.indexOf(0) === -1) {\n      extrema = [0].concat(extrema);\n    }\n    if (extrema.indexOf(1) === -1) {\n      extrema.push(1);\n    }\n\n    for (t1 = extrema[0], i = 1; i < extrema.length; i++) {\n      t2 = extrema[i];\n      segment = this.split(t1, t2);\n      segment._t1 = t1;\n      segment._t2 = t2;\n      pass1.push(segment);\n      t1 = t2;\n    }\n\n    // second pass: further reduce these segments to simple segments\n    pass1.forEach(function (p1) {\n      t1 = 0;\n      t2 = 0;\n      while (t2 <= 1) {\n        for (t2 = t1 + step; t2 <= 1 + step; t2 += step) {\n          segment = p1.split(t1, t2);\n          if (!segment.simple()) {\n            t2 -= step;\n            if (abs(t1 - t2) < step) {\n              // we can never form a reduction\n              return [];\n            }\n            segment = p1.split(t1, t2);\n            segment._t1 = utils.map(t1, 0, 1, p1._t1, p1._t2);\n            segment._t2 = utils.map(t2, 0, 1, p1._t1, p1._t2);\n            pass2.push(segment);\n            t1 = t2;\n            break;\n          }\n        }\n      }\n      if (t1 < 1) {\n        segment = p1.split(t1, 1);\n        segment._t1 = utils.map(t1, 0, 1, p1._t1, p1._t2);\n        segment._t2 = p1._t2;\n        pass2.push(segment);\n      }\n    });\n    return pass2;\n  }\n\n  translate(v, d1, d2) {\n    d2 = typeof d2 === \"number\" ? d2 : d1;\n\n    // TODO: make this take curves with control points outside\n    //       of the start-end interval into account\n\n    const o = this.order;\n    let d = this.points.map((_, i) => (1 - i / o) * d1 + (i / o) * d2);\n    return new Bezier(\n      this.points.map((p, i) => ({\n        x: p.x + v.x * d[i],\n        y: p.y + v.y * d[i],\n      }))\n    );\n  }\n\n  scale(d) {\n    const order = this.order;\n    let distanceFn = false;\n    if (typeof d === \"function\") {\n      distanceFn = d;\n    }\n    if (distanceFn && order === 2) {\n      return this.raise().scale(distanceFn);\n    }\n\n    // TODO: add special handling for non-linear degenerate curves.\n\n    const clockwise = this.clockwise;\n    const points = this.points;\n\n    if (this._linear) {\n      return this.translate(\n        this.normal(0),\n        distanceFn ? distanceFn(0) : d,\n        distanceFn ? distanceFn(1) : d\n      );\n    }\n\n    const r1 = distanceFn ? distanceFn(0) : d;\n    const r2 = distanceFn ? distanceFn(1) : d;\n    const v = [this.offset(0, 10), this.offset(1, 10)];\n    const np = [];\n    const o = utils.lli4(v[0], v[0].c, v[1], v[1].c);\n\n    if (!o) {\n      throw new Error(\"cannot scale this curve. Try reducing it first.\");\n    }\n\n    // move all points by distance 'd' wrt the origin 'o',\n    // and move end points by fixed distance along normal.\n    [0, 1].forEach(function (t) {\n      const p = (np[t * order] = utils.copy(points[t * order]));\n      p.x += (t ? r2 : r1) * v[t].n.x;\n      p.y += (t ? r2 : r1) * v[t].n.y;\n    });\n\n    if (!distanceFn) {\n      // move control points to lie on the intersection of the offset\n      // derivative vector, and the origin-through-control vector\n      [0, 1].forEach((t) => {\n        if (order === 2 && !!t) return;\n        const p = np[t * order];\n        const d = this.derivative(t);\n        const p2 = { x: p.x + d.x, y: p.y + d.y };\n        np[t + 1] = utils.lli4(p, p2, o, points[t + 1]);\n      });\n      return new Bezier(np);\n    }\n\n    // move control points by \"however much necessary to\n    // ensure the correct tangent to endpoint\".\n    [0, 1].forEach(function (t) {\n      if (order === 2 && !!t) return;\n      var p = points[t + 1];\n      var ov = {\n        x: p.x - o.x,\n        y: p.y - o.y,\n      };\n      var rc = distanceFn ? distanceFn((t + 1) / order) : d;\n      if (distanceFn && !clockwise) rc = -rc;\n      var m = sqrt(ov.x * ov.x + ov.y * ov.y);\n      ov.x /= m;\n      ov.y /= m;\n      np[t + 1] = {\n        x: p.x + rc * ov.x,\n        y: p.y + rc * ov.y,\n      };\n    });\n    return new Bezier(np);\n  }\n\n  outline(d1, d2, d3, d4) {\n    d2 = d2 === undefined ? d1 : d2;\n\n    if (this._linear) {\n      // TODO: find the actual extrema, because they might\n      //       be before the start, or past the end.\n\n      const n = this.normal(0);\n      const start = this.points[0];\n      const end = this.points[this.points.length - 1];\n      let s, mid, e;\n\n      if (d3 === undefined) {\n        d3 = d1;\n        d4 = d2;\n      }\n\n      s = { x: start.x + n.x * d1, y: start.y + n.y * d1 };\n      e = { x: end.x + n.x * d3, y: end.y + n.y * d3 };\n      mid = { x: (s.x + e.x) / 2, y: (s.y + e.y) / 2 };\n      const fline = [s, mid, e];\n\n      s = { x: start.x - n.x * d2, y: start.y - n.y * d2 };\n      e = { x: end.x - n.x * d4, y: end.y - n.y * d4 };\n      mid = { x: (s.x + e.x) / 2, y: (s.y + e.y) / 2 };\n      const bline = [e, mid, s];\n\n      const ls = utils.makeline(bline[2], fline[0]);\n      const le = utils.makeline(fline[2], bline[0]);\n      const segments = [ls, new Bezier(fline), le, new Bezier(bline)];\n      return new PolyBezier(segments);\n    }\n\n    const reduced = this.reduce(),\n      len = reduced.length,\n      fcurves = [];\n\n    let bcurves = [],\n      p,\n      alen = 0,\n      tlen = this.length();\n\n    const graduated = typeof d3 !== \"undefined\" && typeof d4 !== \"undefined\";\n\n    function linearDistanceFunction(s, e, tlen, alen, slen) {\n      return function (v) {\n        const f1 = alen / tlen,\n          f2 = (alen + slen) / tlen,\n          d = e - s;\n        return utils.map(v, 0, 1, s + f1 * d, s + f2 * d);\n      };\n    }\n\n    // form curve oulines\n    reduced.forEach(function (segment) {\n      const slen = segment.length();\n      if (graduated) {\n        fcurves.push(\n          segment.scale(linearDistanceFunction(d1, d3, tlen, alen, slen))\n        );\n        bcurves.push(\n          segment.scale(linearDistanceFunction(-d2, -d4, tlen, alen, slen))\n        );\n      } else {\n        fcurves.push(segment.scale(d1));\n        bcurves.push(segment.scale(-d2));\n      }\n      alen += slen;\n    });\n\n    // reverse the \"return\" outline\n    bcurves = bcurves\n      .map(function (s) {\n        p = s.points;\n        if (p[3]) {\n          s.points = [p[3], p[2], p[1], p[0]];\n        } else {\n          s.points = [p[2], p[1], p[0]];\n        }\n        return s;\n      })\n      .reverse();\n\n    // form the endcaps as lines\n    const fs = fcurves[0].points[0],\n      fe = fcurves[len - 1].points[fcurves[len - 1].points.length - 1],\n      bs = bcurves[len - 1].points[bcurves[len - 1].points.length - 1],\n      be = bcurves[0].points[0],\n      ls = utils.makeline(bs, fs),\n      le = utils.makeline(fe, be),\n      segments = [ls].concat(fcurves).concat([le]).concat(bcurves);\n\n    return new PolyBezier(segments);\n  }\n\n  outlineshapes(d1, d2, curveIntersectionThreshold) {\n    d2 = d2 || d1;\n    const outline = this.outline(d1, d2).curves;\n    const shapes = [];\n    for (let i = 1, len = outline.length; i < len / 2; i++) {\n      const shape = utils.makeshape(\n        outline[i],\n        outline[len - i],\n        curveIntersectionThreshold\n      );\n      shape.startcap.virtual = i > 1;\n      shape.endcap.virtual = i < len / 2 - 1;\n      shapes.push(shape);\n    }\n    return shapes;\n  }\n\n  intersects(curve, curveIntersectionThreshold) {\n    if (!curve) return this.selfintersects(curveIntersectionThreshold);\n    if (curve.p1 && curve.p2) {\n      return this.lineIntersects(curve);\n    }\n    if (curve instanceof Bezier) {\n      curve = curve.reduce();\n    }\n    return this.curveintersects(\n      this.reduce(),\n      curve,\n      curveIntersectionThreshold\n    );\n  }\n\n  lineIntersects(line) {\n    const mx = min(line.p1.x, line.p2.x),\n      my = min(line.p1.y, line.p2.y),\n      MX = max(line.p1.x, line.p2.x),\n      MY = max(line.p1.y, line.p2.y);\n    return utils.roots(this.points, line).filter((t) => {\n      var p = this.get(t);\n      return utils.between(p.x, mx, MX) && utils.between(p.y, my, MY);\n    });\n  }\n\n  selfintersects(curveIntersectionThreshold) {\n    // \"simple\" curves cannot intersect with their direct\n    // neighbour, so for each segment X we check whether\n    // it intersects [0:x-2][x+2:last].\n\n    const reduced = this.reduce(),\n      len = reduced.length - 2,\n      results = [];\n\n    for (let i = 0, result, left, right; i < len; i++) {\n      left = reduced.slice(i, i + 1);\n      right = reduced.slice(i + 2);\n      result = this.curveintersects(left, right, curveIntersectionThreshold);\n      results.push(...result);\n    }\n    return results;\n  }\n\n  curveintersects(c1, c2, curveIntersectionThreshold) {\n    const pairs = [];\n    // step 1: pair off any overlapping segments\n    c1.forEach(function (l) {\n      c2.forEach(function (r) {\n        if (l.overlaps(r)) {\n          pairs.push({ left: l, right: r });\n        }\n      });\n    });\n    // step 2: for each pairing, run through the convergence algorithm.\n    let intersections = [];\n    pairs.forEach(function (pair) {\n      const result = utils.pairiteration(\n        pair.left,\n        pair.right,\n        curveIntersectionThreshold\n      );\n      if (result.length > 0) {\n        intersections = intersections.concat(result);\n      }\n    });\n    return intersections;\n  }\n\n  arcs(errorThreshold) {\n    errorThreshold = errorThreshold || 0.5;\n    return this._iterate(errorThreshold, []);\n  }\n\n  _error(pc, np1, s, e) {\n    const q = (e - s) / 4,\n      c1 = this.get(s + q),\n      c2 = this.get(e - q),\n      ref = utils.dist(pc, np1),\n      d1 = utils.dist(pc, c1),\n      d2 = utils.dist(pc, c2);\n    return abs(d1 - ref) + abs(d2 - ref);\n  }\n\n  _iterate(errorThreshold, circles) {\n    let t_s = 0,\n      t_e = 1,\n      safety;\n    // we do a binary search to find the \"good `t` closest to no-longer-good\"\n    do {\n      safety = 0;\n\n      // step 1: start with the maximum possible arc\n      t_e = 1;\n\n      // points:\n      let np1 = this.get(t_s),\n        np2,\n        np3,\n        arc,\n        prev_arc;\n\n      // booleans:\n      let curr_good = false,\n        prev_good = false,\n        done;\n\n      // numbers:\n      let t_m = t_e,\n        prev_e = 1,\n        step = 0;\n\n      // step 2: find the best possible arc\n      do {\n        prev_good = curr_good;\n        prev_arc = arc;\n        t_m = (t_s + t_e) / 2;\n        step++;\n\n        np2 = this.get(t_m);\n        np3 = this.get(t_e);\n\n        arc = utils.getccenter(np1, np2, np3);\n\n        //also save the t values\n        arc.interval = {\n          start: t_s,\n          end: t_e,\n        };\n\n        let error = this._error(arc, np1, t_s, t_e);\n        curr_good = error <= errorThreshold;\n\n        done = prev_good && !curr_good;\n        if (!done) prev_e = t_e;\n\n        // this arc is fine: we can move 'e' up to see if we can find a wider arc\n        if (curr_good) {\n          // if e is already at max, then we're done for this arc.\n          if (t_e >= 1) {\n            // make sure we cap at t=1\n            arc.interval.end = prev_e = 1;\n            prev_arc = arc;\n            // if we capped the arc segment to t=1 we also need to make sure that\n            // the arc's end angle is correct with respect to the bezier end point.\n            if (t_e > 1) {\n              let d = {\n                x: arc.x + arc.r * cos(arc.e),\n                y: arc.y + arc.r * sin(arc.e),\n              };\n              arc.e += utils.angle({ x: arc.x, y: arc.y }, d, this.get(1));\n            }\n            break;\n          }\n          // if not, move it up by half the iteration distance\n          t_e = t_e + (t_e - t_s) / 2;\n        } else {\n          // this is a bad arc: we need to move 'e' down to find a good arc\n          t_e = t_m;\n        }\n      } while (!done && safety++ < 100);\n\n      if (safety >= 100) {\n        break;\n      }\n\n      // console.log(\"L835: [F] arc found\", t_s, prev_e, prev_arc.x, prev_arc.y, prev_arc.s, prev_arc.e);\n\n      prev_arc = prev_arc ? prev_arc : arc;\n      circles.push(prev_arc);\n      t_s = prev_e;\n    } while (t_e < 1);\n    return circles;\n  }\n}\n\nexport { Bezier };\n","import { errorResult, numberTest, resultThrow } from '@ixfx/guards';\n/**\n * Returns true if xy (and z, if present) are _null_.\n * @param p\n * @returns\n */\nexport const isNull = (p) => {\n    if (isPoint3d(p)) {\n        if (p.z !== null)\n            return false;\n    }\n    return p.x === null && p.y === null;\n};\n/***\n * Returns true if either x, y, z isNaN.\n */\nexport const isNaN = (p) => {\n    if (isPoint3d(p)) {\n        if (!Number.isNaN(p.z))\n            return false;\n    }\n    return Number.isNaN(p.x) || Number.isNaN(p.y);\n};\nexport function test(p, name = `Point`, extraInfo = ``) {\n    if (p === undefined) {\n        return errorResult(`'${name}' is undefined. Expected {x,y} got ${JSON.stringify(p)}`, extraInfo);\n    }\n    if (p === null) {\n        return errorResult(`'${name}' is null. Expected {x,y} got ${JSON.stringify(p)}`, extraInfo);\n    }\n    if (typeof p !== `object`)\n        return errorResult(`'${name}' is type '${typeof p}'. Expected object.`, extraInfo);\n    if (p.x === undefined) {\n        return errorResult(`'${name}.x' is undefined. Expected {x,y} got ${JSON.stringify(p)}`, extraInfo);\n    }\n    if (p.y === undefined) {\n        return errorResult(`'${name}.y' is undefined. Expected {x,y} got ${JSON.stringify(p)}`, extraInfo);\n    }\n    if (typeof p.x !== `number`) {\n        return errorResult(`'${name}.x' must be a number. Got ${typeof p.x}`, extraInfo);\n    }\n    if (typeof p.y !== `number`) {\n        return errorResult(`'${name}.y' must be a number. Got ${typeof p.y}`, extraInfo);\n    }\n    if (p.z !== undefined) {\n        if (typeof p.z !== `number`)\n            return errorResult(`${name}.z must be a number. Got: ${typeof p.z}`, extraInfo);\n        if (Number.isNaN(p.z))\n            return errorResult(`'${name}.z' is NaN. Got: ${JSON.stringify(p)}`, extraInfo);\n    }\n    if (p.x === null)\n        return errorResult(`'${name}.x' is null`, extraInfo);\n    if (p.y === null)\n        return errorResult(`'${name}.y' is null`, extraInfo);\n    if (Number.isNaN(p.x))\n        return errorResult(`'${name}.x' is NaN`, extraInfo);\n    if (Number.isNaN(p.y))\n        return errorResult(`'${name}.y' is NaN`, extraInfo);\n    return { success: true, value: p };\n}\n/**\n * Throws an error if point is invalid\n * @param p\n * @param name\n */\nexport function guard(p, name = `Point`, info) {\n    resultThrow(test(p, name, info));\n    // if (p === undefined) {\n    //   throw new Error(\n    //     `'${ name }' is undefined. Expected {x,y} got ${ JSON.stringify(p) }`\n    //   );\n    // }\n    // if (p === null) {\n    //   throw new Error(\n    //     `'${ name }' is null. Expected {x,y} got ${ JSON.stringify(p) }`\n    //   );\n    // }\n    // if (p.x === undefined) {\n    //   throw new Error(\n    //     `'${ name }.x' is undefined. Expected {x,y} got ${ JSON.stringify(p) }`\n    //   );\n    // }\n    // if (p.y === undefined) {\n    //   throw new Error(\n    //     `'${ name }.y' is undefined. Expected {x,y} got ${ JSON.stringify(p) }`\n    //   );\n    // }\n    // if (typeof p.x !== `number`) {\n    //   throw new TypeError(`'${ name }.x' must be a number. Got ${ typeof p.x }`);\n    // }\n    // if (typeof p.y !== `number`) {\n    //   throw new TypeError(`'${ name }.y' must be a number. Got ${ typeof p.y }`);\n    // }\n    // if (p.z !== undefined) {\n    //   if (typeof p.z !== `number`) throw new TypeError(`${ name }.z must be a number. Got: ${ typeof p.z }`)\n    //   if (Number.isNaN(p.z)) throw new Error(`'${ name }.z' is NaN. Got: ${ JSON.stringify(p) }`);\n    // }\n    // if (p.x === null) throw new Error(`'${ name }.x' is null`);\n    // if (p.y === null) throw new Error(`'${ name }.y' is null`);\n    // if (Number.isNaN(p.x)) throw new Error(`'${ name }.x' is NaN`);\n    // if (Number.isNaN(p.y)) throw new Error(`'${ name }.y' is NaN`);\n}\n/**\n * Throws if parameter is not a valid point, or either x or y is 0\n * @param pt\n * @returns\n */\nexport const guardNonZeroPoint = (pt, name = `pt`) => {\n    guard(pt, name);\n    resultThrow(numberTest(pt.x, `nonZero`, `${name}.x`), numberTest(pt.y, `nonZero`, `${name}.y`), () => {\n        if (typeof pt.z !== `undefined`) {\n            return numberTest(pt.z, `nonZero`, `${name}.z`);\n        }\n    });\n    return true;\n};\n/**\n * Returns _true_ if `p` has x & y properties.\n * Returns _false_ if `p` is undefined, null or does not contain properties.\n * Use {@link isPoint3d} to check further check for `z`.\n * @param p\n * @returns\n */\n// eslint-disable-next-line @typescript-eslint/no-redundant-type-constituents\nexport function isPoint(p) {\n    if (p === undefined)\n        return false;\n    if (p === null)\n        return false;\n    if (p.x === undefined)\n        return false;\n    if (p.y === undefined)\n        return false;\n    return true;\n}\n/**\n * Returns _true_ if `p` has x, y, & z properties.\n * Returns _false_ if `p` is undefined, null or does not contain properties.\n * @param p\n * @returns\n */\n// eslint-disable-next-line @typescript-eslint/no-redundant-type-constituents\nexport const isPoint3d = (p) => {\n    if (p === undefined)\n        return false;\n    if (p === null)\n        return false;\n    if (p.x === undefined)\n        return false;\n    if (p.y === undefined)\n        return false;\n    if (p.z === undefined)\n        return false;\n    return true;\n};\n/**\n * Returns true if both xy (and z, if present) are 0.\n * Use `Points.Empty` to return an empty point.\n * @param p\n * @returns\n */\nexport const isEmpty = (p) => {\n    if (isPoint3d(p)) {\n        if (p.z !== 0)\n            return false;\n    }\n    return p.x === 0 && p.y === 0;\n};\n/**\n * Returns true if point is a placeholder, where xy (and z, if present)\n * are `NaN`.\n *\n * Use Points.Placeholder to return a placeholder point.\n * @param p\n * @returns\n */\nexport const isPlaceholder = (p) => {\n    if (isPoint3d(p)) {\n        if (!Number.isNaN(p.z))\n            return false;\n    }\n    return Number.isNaN(p.x) && Number.isNaN(p.y);\n};\n","import { guard as PointsGuard } from '../point/guard.js';\n/**\n * Throws an error if the dimensions of the rectangle are undefined, NaN or negative.\n * @param d\n * @param name\n */\nexport const guardDim = (d, name = `Dimension`) => {\n    if (d === undefined)\n        throw new Error(`${name} is undefined`);\n    if (Number.isNaN(d))\n        throw new Error(`${name} is NaN`);\n    if (d < 0)\n        throw new Error(`${name} cannot be negative`);\n};\n/**\n * Throws an error if rectangle is missing fields or they\n * are not valid.\n *\n * Checks:\n * * `width` and `height` must be defined on `rect`\n * * dimensions (w & h) must not be NaN\n * * dimensions (w & h) must not be negative\n *\n * If `rect` has x,y, this value is checked as well.\n * @param rect\n * @param name\n */\nexport const guard = (rect, name = `rect`) => {\n    if (rect === undefined)\n        throw new Error(`{$name} undefined`);\n    if (isPositioned(rect))\n        PointsGuard(rect, name);\n    guardDim(rect.width, name + `.width`);\n    guardDim(rect.height, name + `.height`);\n};\n/**\n * Returns a positioned rect or if it's not possible, throws an error.\n *\n * If `rect` does not have a position, `origin` is used.\n * If `rect` is positioned and `origin` is provided, returned result uses `origin` as x,y instead.\n * ```js\n * // Returns input because it's positioned\n * getRectPositioned({ x:1, y:2, width:10, height:20 });\n *\n * // Returns { x:1, y:2, width:10, height:20 }\n * getRectPositioned({ width:10, height:20 }, { x:1, y:2 });\n *\n * // Throws, because we have no point\n * getRectPositioned({width:10,height:20})\n * ```\n * @param rect\n * @param origin\n * @returns\n */\nexport const getRectPositioned = (rect, origin) => {\n    guard(rect);\n    if (isPositioned(rect) && origin === undefined) {\n        return rect;\n    }\n    if (origin === undefined)\n        throw new Error(`Unpositioned rect needs origin parameter`);\n    return Object.freeze({ ...rect, ...origin });\n};\n/**\n * Throws an error if `rect` is does not have a position, or\n * is an invalid rectangle\n * @param rect\n * @param name\n */\nexport const guardPositioned = (rect, name = `rect`) => {\n    if (!isPositioned(rect))\n        throw new Error(`Expected ${name} to have x,y`);\n    guard(rect, name);\n};\n/**\n * Returns _true_ if `rect` has width and height values of 0.\n * Use Rects.Empty or Rects.EmptyPositioned to generate an empty rectangle.\n * @param rect\n * @returns\n */\nexport const isEmpty = (rect) => rect.width === 0 && rect.height === 0;\n/**\n * Returns _true_ if `rect` is a placeholder, with both width and height values of NaN.\n * Use Rects.Placeholder or Rects.PlaceholderPositioned to generate a placeholder.\n * @param rect\n * @returns\n */\nexport const isPlaceholder = (rect) => Number.isNaN(rect.width) && Number.isNaN(rect.height);\n/**\n * Returns _true_ if `rect` has position (x,y) fields.\n * @param rect Point, Rect or RectPositiond\n * @returns\n */\nexport const isPositioned = (rect) => rect.x !== undefined && rect.y !== undefined;\n/**\n * Returns _true_ if `rect` has width and height fields.\n * @param rect\n * @returns\n */\nexport const isRect = (rect) => {\n    if (rect === undefined)\n        return false;\n    if (rect.width === undefined)\n        return false;\n    if (rect.height === undefined)\n        return false;\n    return true;\n};\n/**\n * Returns _true_ if `rect` is a positioned rectangle\n * Having width, height, x and y properties.\n * @param rect\n * @returns\n */\nexport const isRectPositioned = (rect) => isRect(rect) && isPositioned(rect);\n","import { guard } from \"./guard.js\";\n/**\n * Returns the area of `rect`\n *\n * ```js\n * const rect = { width: 100, height: 100, x: 100, y: 100 };\n * Rects.area(rect);\n * ```\n * @param rect\n * @returns\n */\nexport const area = (rect) => {\n    guard(rect);\n    return rect.height * rect.width;\n};\n","import { guard } from \"./guard.js\";\nimport { isRect, isRectPositioned, isPositioned } from \"./guard.js\";\n/**\n * Applies an operation over each field of a rectangle.\n * ```js\n * // Convert x,y,width,height to integer values\n * applyFields(v => Number.floor(v), someRect);\n * ```\n * @param op\n * @param rectOrWidth\n * @param heightValue\n * @returns\n */\nexport function applyFields(op, rectOrWidth, heightValue) {\n    let width = (typeof rectOrWidth === `number`) ? rectOrWidth : rectOrWidth.width;\n    let height = (typeof rectOrWidth === `number`) ? heightValue : rectOrWidth.height;\n    if (width === undefined)\n        throw new Error(`Param 'width' undefined`);\n    if (height === undefined)\n        throw new Error(`Param 'height' undefined`);\n    width = op(width, `width`);\n    height = op(height, `height`);\n    if (typeof rectOrWidth === `object`) {\n        if (isPositioned(rectOrWidth)) {\n            const x = op(rectOrWidth.x, `x`);\n            const y = op(rectOrWidth.y, `y`);\n            return { ...rectOrWidth, width, height, x, y };\n        }\n        else {\n            return {\n                ...rectOrWidth, width, height\n            };\n        }\n    }\n    return { width, height };\n}\n/**\n * Applies an joint operation field-wise on two rectangles, returning a single rectangle. This is used to support operations like summing two rectangles.\n * ```js\n * // Eg make a new rectangle by summing each field of rectangle A & B.\n * apply((valueA,valueB) => valueA+valueB, rectA, rectB);\n * ```\n * @param op\n * @param a\n * @param b\n * @param c\n * @returns\n */\nexport function applyMerge(op, a, b, c) {\n    guard(a, `a`);\n    if (isRect(b)) {\n        // Math op by another rectangle\n        return isRectPositioned(a) ? Object.freeze({\n            ...a,\n            x: op(a.x, b.width),\n            y: op(a.y, b.height),\n            width: op(a.width, b.width),\n            height: op(a.height, b.height),\n        }) : Object.freeze({\n            ...a,\n            width: op(a.width, b.width),\n            height: op(a.height, b.height),\n        });\n    }\n    else {\n        // Math op with a series of values\n        if (typeof b !== `number`) {\n            throw new TypeError(`Expected second parameter of type Rect or number. Got ${JSON.stringify(b)}`);\n        }\n        if (typeof c !== `number`)\n            throw new Error(`Expected third param as height. Got ${JSON.stringify(c)}`);\n        return isRectPositioned(a) ? Object.freeze({\n            ...a,\n            x: op(a.x, b),\n            y: op(a.y, c),\n            width: op(a.width, b),\n            height: op(a.height, c),\n        }) : Object.freeze({\n            ...a,\n            width: op(a.width, b),\n            height: op(a.height, c),\n        });\n    }\n}\nexport function applyScalar(op, rect, parameter) {\n    return isPositioned(rect) ? Object.freeze({\n        ...rect,\n        x: op(rect.x, parameter),\n        y: op(rect.y, parameter),\n        width: op(rect.width, parameter),\n        height: op(rect.height, parameter),\n    }) : Object.freeze({\n        ...rect,\n        width: op(rect.width, parameter),\n        height: op(rect.height, parameter),\n    });\n}\n/**\n * Applies `op` with `param` to `rect`'s width and height.\n * @param op\n * @param rect\n * @param parameter\n * @returns\n */\nexport function applyDim(op, rect, parameter) {\n    return Object.freeze({\n        ...rect,\n        width: op(rect.width, parameter),\n        height: op(rect.height, parameter),\n    });\n}\n","/**\n * Returns a point on cardinal direction, or 'center' for the middle.\n *\n * ```js\n * cardinal({x: 10, y:10, width:100, height: 20}, 'center');\n * ```\n * @param rect Rectangle\n * @param card Cardinal direction or 'center'\n * @returns Point\n */\nexport const cardinal = (rect, card) => {\n    const { x, y, width, height } = rect;\n    switch (card) {\n        case `nw`: {\n            return Object.freeze({ x, y });\n        }\n        case `n`: {\n            return Object.freeze({\n                x: x + width / 2,\n                y,\n            });\n        }\n        case `ne`: {\n            return Object.freeze({\n                x: x + width,\n                y,\n            });\n        }\n        case `sw`: {\n            return Object.freeze({ x, y: y + height });\n        }\n        case `s`: {\n            return Object.freeze({\n                x: x + width / 2,\n                y: y + height,\n            });\n        }\n        case `se`: {\n            return Object.freeze({\n                x: x + width,\n                y: y + height,\n            });\n        }\n        case `w`: {\n            return Object.freeze({ x, y: y + height / 2 });\n        }\n        case `e`: {\n            return Object.freeze({ x: x + width, y: y + height / 2 });\n        }\n        case `center`: {\n            return Object.freeze({\n                x: x + width / 2,\n                y: y + height / 2,\n            });\n        }\n        default: {\n            // eslint-disable-next-line @typescript-eslint/restrict-template-expressions\n            throw new Error(`Unknown direction: ${card}`);\n        }\n    }\n};\n","import { isPoint } from \"../point/guard.js\";\nimport { getRectPositioned, guard } from \"./guard.js\";\n/**\n * Returns the center of a rectangle as a {@link Point}.\n *  If the rectangle lacks a position and `origin` parameter is not provided, 0,0 is used instead.\n *\n * ```js\n * const p = Rects.center({x:10, y:20, width:100, height:50});\n * const p2 = Rects.center({width: 100, height: 50}); // Assumes 0,0 for rect x,y\n * ```\n * @param rect Rectangle\n * @param origin Optional origin. Overrides `rect` position if available. If no position is available 0,0 is used by default.\n * @returns\n */\nexport const center = (rect, origin) => {\n    guard(rect);\n    if (origin === undefined && isPoint(rect))\n        origin = rect;\n    else if (origin === undefined)\n        origin = { x: 0, y: 0 }; // throw new Error(`Unpositioned rect needs origin param`);\n    const r = getRectPositioned(rect, origin);\n    return Object.freeze({\n        x: origin.x + rect.width / 2,\n        y: origin.y + rect.height / 2,\n    });\n};\n","import { center } from \"./center.js\";\n/**\n * Perform basic point translation using a rectangle where its center is the origin.\n *\n * Thus the relative coordinate { x: 0, y: 0} corresponds to the absolute middle of the\n * rectangle.\n *\n * The relative coordinate { x: -1, y: -1 } corresponds to the rectangle's {x,y} properties, and so on.\n * @param rectAbsolute\n * @returns\n */\nexport const centerOrigin = (rectAbsolute) => {\n    const c = center(rectAbsolute);\n    const w = rectAbsolute.width / 2;\n    const h = rectAbsolute.height / 2;\n    const relativeToAbsolute = (point) => {\n        return {\n            ...point,\n            x: point.x * w + c.x,\n            y: point.y * h + c.y\n        };\n    };\n    const absoluteToRelative = (point) => {\n        return {\n            ...point,\n            x: ((point.x - rectAbsolute.x) / w) - 1,\n            y: ((point.y - rectAbsolute.y) / h) - 1\n        };\n    };\n    return { relativeToAbsolute, absoluteToRelative };\n};\n","/**\n * Placeholder point: `{ x: NaN, y: NaN }`\n * Use `isPlaceholder` to check if a point is a placeholder.\n * Use `Placeholder3d` get a point with `z` property.\n */\n//eslint-disable-next-line @typescript-eslint/naming-convention\nexport const Placeholder = Object.freeze({ x: Number.NaN, y: Number.NaN });\n/**\n * Placeholder point: `{x: NaN, y:NaN, z:NaN }`\n * Use `isPlaceholder` to check if a point is a placeholder.\n * Use `Placeholder` to get a point without `z` property.\n */\nexport const Placeholder3d = Object.freeze({ x: Number.NaN, y: Number.NaN, z: Number.NaN });\n","import {} from \"../point/point-type.js\";\nimport { getRectPositioned } from \"./guard.js\";\n/**\n * Returns the four corners of a rectangle as an array of Points.\n *\n * ```js\n * const rect = { width: 100, height: 100, x: 0, y: 0};\n * const pts = Rects.corners(rect);\n * ```\n *\n * If the rectangle is not positioned, is origin can be provided.\n * Order of corners: ne, nw, sw, se\n * @param rect\n * @param origin\n * @returns\n */\nexport const corners = (rect, origin) => {\n    const r = getRectPositioned(rect, origin);\n    return [\n        { x: r.x, y: r.y },\n        { x: r.x + r.width, y: r.y },\n        { x: r.x + r.width, y: r.y + r.height },\n        { x: r.x, y: r.y + r.height },\n    ];\n};\n","import { guard as guardPoint } from '../point/guard.js';\n/**\n * Throws if radius is out of range. If x,y is present, these will be validated too.\n * @param circle\n * @param parameterName\n */\nexport const guard = (circle, parameterName = `circle`) => {\n    if (isCirclePositioned(circle)) {\n        guardPoint(circle, `circle`);\n    }\n    if (Number.isNaN(circle.radius))\n        throw new Error(`${parameterName}.radius is NaN`);\n    if (circle.radius <= 0)\n        throw new Error(`${parameterName}.radius must be greater than zero`);\n};\n/**\n * Throws if `circle` is not positioned or has dodgy fields\n * @param circle\n * @param parameterName\n * @returns\n */\nexport const guardPositioned = (circle, parameterName = `circle`) => {\n    if (!isCirclePositioned(circle))\n        throw new Error(`Expected a positioned circle with x,y`);\n    guard(circle, parameterName);\n};\n/***\n * Returns true if radius, x or y are NaN\n */\nexport const isNaN = (a) => {\n    if (Number.isNaN(a.radius))\n        return true;\n    if (isCirclePositioned(a)) {\n        if (Number.isNaN(a.x))\n            return true;\n        if (Number.isNaN(a.y))\n            return true;\n    }\n    return false;\n};\n/**\n * Returns true if parameter has x,y. Does not verify if parameter is a circle or not\n *\n * ```js\n * const circleA = { radius: 5 };\n * Circles.isPositioned(circle); // false\n *\n * const circleB = { radius: 5, x: 10, y: 10 }\n * Circles.isPositioned(circle); // true\n * ```\n * @param p Circle\n * @returns\n */\nexport const isPositioned = (p) => p.x !== undefined && p.y !== undefined;\nexport const isCircle = (p) => p.radius !== undefined;\nexport const isCirclePositioned = (p) => isCircle(p) && isPositioned(p);\n","import { isCirclePositioned } from \"./guard.js\";\n/**\n * Returns true if the two objects have the same values\n *\n * ```js\n * const circleA = { radius: 10, x: 5, y: 5 };\n * const circleB = { radius: 10, x: 5, y: 5 };\n *\n * circleA === circleB; // false, because identity of objects is different\n * Circles.isEqual(circleA, circleB); // true, because values are the same\n * ```\n *\n * Circles must both be positioned or not.\n * @param a\n * @param b\n * @returns\n */\nexport const isEqual = (a, b) => {\n    if (a.radius !== b.radius)\n        return false;\n    if (isCirclePositioned(a) && isCirclePositioned(b)) {\n        if (a.x !== b.x)\n            return false;\n        if (a.y !== b.y)\n            return false;\n        if (a.z !== b.z)\n            return false;\n        return true;\n    }\n    else if (!isCirclePositioned(a) && !isCirclePositioned(b)) {\n        // no-op\n    }\n    else\n        return false; // one is positioned one not\n    return false;\n};\n","import { isPoint, isPoint3d } from \"./guard.js\";\nexport function getTwoPointParameters(a1, ab2, ab3, ab4, ab5, ab6) {\n    if (isPoint3d(a1) && isPoint3d(ab2))\n        return [a1, ab2];\n    if (isPoint(a1) && isPoint(ab2))\n        return [a1, ab2];\n    if (isPoint3d(a1)) {\n        const b = {\n            x: ab2,\n            y: ab3,\n            z: ab4\n        };\n        if (!isPoint3d(b))\n            throw new Error(`Expected x, y & z parameters`);\n        return [a1, b];\n    }\n    if (isPoint(a1)) {\n        const b = {\n            x: ab2,\n            y: ab3\n        };\n        if (!isPoint(b))\n            throw new Error(`Expected x & y parameters`);\n        return [a1, b];\n    }\n    if (typeof ab5 !== `undefined` && typeof ab4 !== `undefined`) {\n        const a = {\n            x: a1,\n            y: ab2,\n            z: ab3\n        };\n        const b = {\n            x: ab4,\n            y: ab5,\n            z: ab6\n        };\n        if (!isPoint3d(a))\n            throw new Error(`Expected x,y,z for first point`);\n        if (!isPoint3d(b))\n            throw new Error(`Expected x,y,z for second point`);\n        return [a, b];\n    }\n    const a = {\n        x: a1,\n        y: ab2\n    };\n    const b = {\n        x: ab3,\n        y: ab4\n    };\n    if (!isPoint(a))\n        throw new Error(`Expected x,y for first point`);\n    if (!isPoint(b))\n        throw new Error(`Expected x,y for second point`);\n    return [a, b];\n}\n/**\n * Returns a Point form of either a point, x,y params or x,y,z params.\n * If parameters are undefined, an empty point is returned (0, 0)\n * @ignore\n * @param a\n * @param b\n * @returns\n */\nexport function getPointParameter(a, b, c) {\n    if (a === undefined)\n        return { x: 0, y: 0 };\n    if (Array.isArray(a)) {\n        if (a.length === 0)\n            return Object.freeze({ x: 0, y: 0 });\n        if (a.length === 1)\n            return Object.freeze({ x: a[0], y: 0 });\n        if (a.length === 2)\n            return Object.freeze({ x: a[0], y: a[1] });\n        if (a.length === 3)\n            return Object.freeze({ x: a[0], y: a[1], z: a[2] });\n        throw new Error(`Expected array to be 1-3 elements in length. Got ${a.length}.`);\n    }\n    if (isPoint(a)) {\n        return a;\n    }\n    else if (typeof a !== `number` || typeof b !== `number`) {\n        throw new TypeError(`Expected point or x,y as parameters. Got: a: ${JSON.stringify(a)} b: ${JSON.stringify(b)}`);\n    }\n    // x,y,z\n    if (typeof c === `number`) {\n        return Object.freeze({ x: a, y: b, z: c });\n    }\n    // x,y\n    return Object.freeze({ x: a, y: b });\n}\n","import { getTwoPointParameters } from \"./get-point-parameter.js\";\nimport { guard, isPoint3d } from \"./guard.js\";\n/**\n * Returns a Point with the x,y,z values of two points added.\n *\n * `z` parameter is used, if present. Uses a default value of 0 for 'z' when adding a 2D point with a 3D one.\n *\n * Examples:\n *\n * ```js\n * sum(ptA, ptB);\n * sum(x1, y1, x2, y2);\n * sum(ptA, x2, y2);\n * ```\n */\nexport function sum(a1, ab2, ab3, ab4, ab5, ab6) {\n    const [ptA, ptB] = getTwoPointParameters(a1, ab2, ab3, ab4, ab5, ab6);\n    guard(ptA, `a`);\n    guard(ptB, `b`);\n    const pt = {\n        x: ptA.x + ptB.x,\n        y: ptA.y + ptB.y,\n    };\n    if (isPoint3d(ptA) || isPoint3d(ptB)) {\n        pt.z = (ptA.z ?? 0) + (ptB.z ?? 0);\n    }\n    ;\n    return Object.freeze(pt);\n}\n;\n","import { getTwoPointParameters } from \"./get-point-parameter.js\";\nimport { guard, isPoint3d } from \"./guard.js\";\n/**\n * Returns a Point with the x,y,z values of two points subtracted (a-b).\n *\n * `z` parameter is used if present. Uses a default value of 0 for 'z' when subtracting a 2D point with a 3D one.\n *\n * Examples:\n *\n * ```js\n * subtract(ptA, ptB);\n * subtract(x1, y1, x2, y2);\n * subtract(ptA, x2, y2);\n * ```\n */\nexport function subtract(a1, ab2, ab3, ab4, ab5, ab6) {\n    const [ptA, ptB] = getTwoPointParameters(a1, ab2, ab3, ab4, ab5, ab6);\n    guard(ptA, `a`);\n    guard(ptB, `b`);\n    const pt = {\n        x: ptA.x - ptB.x,\n        y: ptA.y - ptB.y,\n    };\n    if (isPoint3d(ptA) || isPoint3d(ptB)) {\n        pt.z = (ptA.z ?? 0) - (ptB.z ?? 0);\n    }\n    ;\n    return Object.freeze(pt);\n}\n;\n","import { isEqual } from \"./is-equal.js\";\nimport { sum as PointsSum } from \"../point/sum.js\";\nimport { subtract as PointsSubtract } from \"../point/subtract.js\";\n/**\n * Returns the point(s) of intersection between a circle and line.\n *\n * ```js\n * const circle = { radius: 5, x: 5, y: 5 };\n * const line = { a: { x: 0, y: 0 }, b: { x: 10, y: 10 } };\n * const pts = Circles.intersectionLine(circle, line);\n * ```\n * @param circle\n * @param line\n * @returns Point(s) of intersection, or empty array\n */\nexport const intersectionLine = (circle, line) => {\n    const v1 = {\n        x: line.b.x - line.a.x,\n        y: line.b.y - line.a.y\n    };\n    const v2 = {\n        x: line.a.x - circle.x,\n        y: line.a.y - circle.y\n    };\n    const b = (v1.x * v2.x + v1.y * v2.y) * -2;\n    const c = 2 * (v1.x * v1.x + v1.y * v1.y);\n    const d = Math.sqrt(b * b - 2 * c * (v2.x * v2.x + v2.y * v2.y - circle.radius * circle.radius));\n    if (Number.isNaN(d))\n        return []; // no intercept\n    const u1 = (b - d) / c; // these represent the unit distance of point one and two on the line\n    const u2 = (b + d) / c;\n    const returnValue = [];\n    if (u1 <= 1 && u1 >= 0) { // add point if on the line segment\n        returnValue.push({\n            x: line.a.x + v1.x * u1,\n            y: line.a.y + v1.y * u1\n        });\n    }\n    if (u2 <= 1 && u2 >= 0) { // second add point if on the line segment\n        returnValue.push({\n            x: line.a.x + v1.x * u2,\n            y: line.a.y + v1.y * u2\n        });\n    }\n    return returnValue;\n};\n/**\n *\n * Returns the points of intersection betweeen `a` and `b`.\n *\n * Returns an empty array if circles are equal, one contains the other or if they don't touch at all.\n *\n * @param a Circle\n * @param b Circle\n * @returns Points of intersection, or an empty list if there are none\n */\nexport const intersections = (a, b) => {\n    const vector = PointsSubtract(b, a);\n    const centerD = Math.hypot((vector.y), (vector.x));\n    // Do not intersect\n    if (centerD > a.radius + b.radius)\n        return [];\n    // Circle contains another\n    if (centerD < Math.abs(a.radius - b.radius))\n        return [];\n    // Circles are the same\n    if (isEqual(a, b))\n        return [];\n    const centroidD = ((a.radius * a.radius) - (b.radius * b.radius) + (centerD * centerD)) / (2 * centerD);\n    const centroid = {\n        x: a.x + (vector.x * centroidD / centerD),\n        y: a.y + (vector.y * centroidD / centerD)\n    };\n    const centroidIntersectionD = Math.sqrt((a.radius * a.radius) - (centroidD * centroidD));\n    const intersection = {\n        x: -vector.y * (centroidIntersectionD / centerD),\n        y: vector.x * (centroidIntersectionD / centerD)\n    };\n    return [\n        PointsSum(centroid, intersection),\n        PointsSubtract(centroid, intersection)\n    ];\n};\n","import { intersections as circleIntersections } from \"./circle/intersections.js\";\nexport const circleRect = (a, b) => {\n    // https://yal.cc/rectangle-circle-intersection-test/\n    const deltaX = a.x - Math.max(b.x, Math.min(a.x, b.x + b.width));\n    const deltaY = a.y - Math.max(b.y, Math.min(a.y, b.y + b.height));\n    return (deltaX * deltaX + deltaY * deltaY) < (a.radius * a.radius);\n};\nexport const circleCircle = (a, b) => circleIntersections(a, b).length === 2;\n","import { guard } from \"./guard.js\";\nimport { isPositioned, isRectPositioned } from \"./guard.js\";\nimport { isCirclePositioned } from '../circle/guard.js';\nimport * as Intersects from '../intersects.js';\nimport { isPoint } from \"../point/guard.js\";\n/**\n * Returns true if point is within or on boundary of `rect`.\n *\n * ```js\n * Rects.intersectsPoint(rect, { x: 100, y: 100});\n * Rects.intersectsPoint(rect, 100, 100);\n * ```\n * @param rect\n * @param a\n * @param b\n * @returns\n */\nexport function intersectsPoint(rect, a, b) {\n    guard(rect, `rect`);\n    let x = 0;\n    let y = 0;\n    if (typeof a === `number`) {\n        if (b === undefined)\n            throw new Error(`x and y coordinate needed`);\n        x = a;\n        y = b;\n    }\n    else {\n        x = a.x;\n        y = a.y;\n    }\n    if (isPositioned(rect)) {\n        if (x - rect.x > rect.width || x < rect.x)\n            return false;\n        if (y - rect.y > rect.height || y < rect.y)\n            return false;\n    }\n    else {\n        // Assume 0,0\n        if (x > rect.width || x < 0)\n            return false;\n        if (y > rect.height || y < 0)\n            return false;\n    }\n    return true;\n}\n/**\n * Returns true if `a` or `b` overlap, are equal, or `a` contains `b`.\n * A rectangle can be checked for intersections with another RectPositioned, CirclePositioned or Point.\n *\n */\nexport const isIntersecting = (a, b) => {\n    if (!isRectPositioned(a)) {\n        throw new Error(`a parameter should be RectPositioned`);\n    }\n    if (isCirclePositioned(b)) {\n        return Intersects.circleRect(b, a);\n    }\n    else if (isPoint(b)) {\n        return intersectsPoint(a, b);\n    }\n    throw new Error(`Unknown shape for b: ${JSON.stringify(b)}`);\n};\n","import { guard, isPoint3d } from \"./guard.js\";\nimport { getPointParameter } from \"./get-point-parameter.js\";\n/**\n * Calculate distance between two points.\n * If both points have a `z` property, the distance is 3D distance is calculated.\n * If only one point has a `z`, it is ignored. To force 2D distance, use {@link distance2d}\n *\n * ```js\n * // Distance between two points\n * const ptA = { x: 0.5, y:0.8 };\n * const ptB = { x: 1, y: 0.4 };\n * distance(ptA, ptB);\n * // Or, provide x,y as parameters\n * distance(ptA, 0.4, 0.9);\n *\n * // Distance from ptA to x: 0.5, y:0.8, z: 0.1\n * const ptC = { x: 0.5, y:0.5, z: 0.3 };\n * // With x,y,z as parameters:\n * distance(ptC, 0.5, 0.8, 0.1);\n * ```\n * @param a First point\n * @param xOrB Second point, or x coord\n * @param y y coord, if x coord is given\n * @param z Optional z coord, if x and y are given.\n * @returns\n */\nexport function distance(a, xOrB, y, z) {\n    const pt = getPointParameter(xOrB, y, z);\n    guard(pt, `b`);\n    guard(a, `a`);\n    return isPoint3d(pt) && isPoint3d(a) ? Math.hypot(pt.x - a.x, pt.y - a.y, pt.z - a.z) : Math.hypot(pt.x - a.x, pt.y - a.y);\n}\n/**\n * As {@distance} but always compares by x,y only.\n * @param a\n * @param xOrB\n * @param y\n * @param z\n * @returns\n */\nexport function distance2d(a, xOrB, y) {\n    const pt = getPointParameter(xOrB, y);\n    guard(pt, `b`);\n    guard(a, `a`);\n    return Math.hypot(pt.x - a.x, pt.y - a.y);\n}\n","import { guardPositioned } from \"./guard.js\";\nimport { intersectsPoint } from \"./Intersects.js\";\nimport { center } from \"./center.js\";\nimport {} from '../point/point-type.js';\nimport { guard as PointsGuard } from '../point/guard.js';\nimport { distance as PointsDistance } from '../point/distance.js';\n/**\n * Returns the distance from the perimeter of `rect` to `pt`.\n * If the point is within the rectangle, 0 is returned.\n *\n * If `rect` does not have an x,y it's assumed to be 0,0\n *\n * ```js\n * const rect = { width: 100, height: 100, x: 0, y: 0 };\n * Rects.distanceFromExterior(rect, { x: 20, y: 20 });\n * ```\n * @param rect Rectangle\n * @param pt Point\n * @returns Distance\n */\nexport const distanceFromExterior = (rect, pt) => {\n    guardPositioned(rect, `rect`);\n    PointsGuard(pt, `pt`);\n    if (intersectsPoint(rect, pt))\n        return 0;\n    const dx = Math.max(rect.x - pt.x, 0, pt.x - rect.x + rect.width);\n    const dy = Math.max(rect.y - pt.y, 0, pt.y - rect.y + rect.height);\n    return Math.hypot(dx, dy);\n};\n/**\n * Return the distance of `pt` to the center of `rect`.\n *\n * ```js\n * const rect = { width: 100, height: 100, x: 0, y: 0 };\n * Rects.distanceFromCenter(rect, { x: 20, y: 20 });\n * ```\n * @param rect\n * @param pt\n * @returns\n */\nexport const distanceFromCenter = (rect, pt) => PointsDistance(center(rect), pt);\n","import { applyMerge, applyDim, applyScalar } from \"./apply.js\";\nconst divideOp = (a, b) => a / b;\n/**\n * @internal\n * @param a\n * @param b\n * @param c\n * @returns\n */\nexport function divide(a, b, c) {\n    // @ts-ignore\n    return applyMerge(divideOp, a, b, c);\n}\n/**\n * Divides all components of `rect` by `amount`.\n * This includes x,y if present.\n *\n * ```js\n * divideScalar({ width:10, height:20 }, 2); // { width:5, height: 10 }\n * divideScalar({ x: 1, y: 2, width:10, height:20 }, 2); // { x: 0.5, y: 1, width:5, height: 10 }\n * ```\n * @param rect\n * @param amount\n */\nexport function divideScalar(rect, amount) {\n    return applyScalar(divideOp, rect, amount);\n}\nexport function divideDim(rect, amount) {\n    return applyDim(divideOp, rect, amount);\n}\n","import { guard as guardPoint } from '../point/guard.js';\n/**\n * Returns a line from two points\n *\n * ```js\n * // Line from 0,1 to 10,15\n * const line = Lines.fromPoints( { x:0, y:1 }, { x:10, y:15 });\n * // line is: { a: { x: 0, y: 1}, b: { x: 10, y: 15 } };\n * ```\n * @param a Start point\n * @param b End point\n * @returns\n */\nexport const fromPoints = (a, b) => {\n    guardPoint(a, `a`);\n    guardPoint(b, `b`);\n    a = Object.freeze({ ...a });\n    b = Object.freeze({ ...b });\n    return Object.freeze({\n        a: a,\n        b: b\n    });\n};\n","import { fromPoints } from \"./from-points.js\";\n/**\n * Returns an array of lines that connects provided points. Note that line is not closed.\n *\n * Eg, if points a,b,c are provided, two lines are provided: a->b and b->c.\n *\n * ```js\n * const lines = Lines.joinPointsToLines(ptA, ptB, ptC);\n * // lines is an array of, well, lines\n * ```\n * @param points\n * @returns\n */\nexport const joinPointsToLines = (...points) => {\n    const lines = [];\n    let start = points[0];\n    for (let index = 1; index < points.length; index++) {\n        lines.push(fromPoints(start, points[index]));\n        start = points[index];\n    }\n    return lines;\n};\n","import { isPoint } from \"../point/guard.js\";\nimport { guard } from \"./guard.js\";\nimport { joinPointsToLines as LinesJoinPointsToLines } from '../line/join-points-to-lines.js';\nimport { corners } from \"./corners.js\";\n/**\n * Returns four lines based on each corner.\n * Lines are given in order: top, right, bottom, left\n *\n * ```js\n * const rect = { width: 100, height: 100, x: 100, y: 100 };\n * // Yields: array of length four\n * const lines = Rects.lines(rect);\n * ```\n *\n * @param {(RectPositioned|Rect)} rect\n * @param {Points.Point} [origin]\n * @returns {Lines.Line[]}\n */\nexport const edges = (rect, origin) => {\n    const c = corners(rect, origin);\n    // Connect all the corners, back to first corner again\n    return LinesJoinPointsToLines(...c, c[0]);\n};\n/**\n * Returns a point on the edge of rectangle\n * ```js\n * const r1 = {x: 10, y: 10, width: 100, height: 50};\n * Rects.getEdgeX(r1, `right`);  // Yields: 110\n * Rects.getEdgeX(r1, `bottom`); // Yields: 10\n *\n * const r2 = {width: 100, height: 50};\n * Rects.getEdgeX(r2, `right`);  // Yields: 100\n * Rects.getEdgeX(r2, `bottom`); // Yields: 0\n * ```\n * @param rect\n * @param edge Which edge: right, left, bottom, top\n * @returns\n */\nexport const getEdgeX = (rect, edge) => {\n    guard(rect);\n    switch (edge) {\n        case `top`: {\n            return isPoint(rect) ? rect.x : 0;\n        }\n        case `bottom`: {\n            return isPoint(rect) ? rect.x : 0;\n        }\n        case `left`: {\n            return isPoint(rect) ? rect.y : 0;\n        }\n        case `right`: {\n            return isPoint(rect) ? rect.x + rect.width : rect.width;\n        }\n    }\n};\n/**\n * Returns a point on the edge of rectangle\n *\n * ```js\n * const r1 = {x: 10, y: 10, width: 100, height: 50};\n * Rects.getEdgeY(r1, `right`);  // Yields: 10\n * Rects.getEdgeY(r1, `bottom`); // Yields: 60\n *\n * const r2 = {width: 100, height: 50};\n * Rects.getEdgeY(r2, `right`);  // Yields: 0\n * Rects.getEdgeY(r2, `bottom`); // Yields: 50\n * ```\n * @param rect\n * @param edge Which edge: right, left, bottom, top\n * @returns\n */\nexport const getEdgeY = (rect, edge) => {\n    guard(rect);\n    switch (edge) {\n        case `top`: {\n            return (isPoint(rect) ? rect.y : 0);\n        }\n        case `bottom`: {\n            return isPoint(rect) ? rect.y + rect.height : rect.height;\n        }\n        case `left`: {\n            return isPoint(rect) ? rect.y : 0;\n        }\n        case `right`: {\n            return isPoint(rect) ? rect.y : 0;\n        }\n    }\n};\n","export const Empty = Object.freeze({ width: 0, height: 0 });\nexport const EmptyPositioned = Object.freeze({\n    x: 0,\n    y: 0,\n    width: 0,\n    height: 0,\n});\n","/**\n * Returns a copy of `rect` with `rect` resized so it also encompasses `points`.\n * If provided point(s) are within bounds of `rect`, a copy of `rect` is returned.\n * @param rect\n * @param points\n * @returns\n */\nexport const encompass = (rect, ...points) => {\n    const x = points.map(p => p.x);\n    const y = points.map(p => p.y);\n    let minX = Math.min(...x, rect.x);\n    let minY = Math.min(...y, rect.y);\n    let maxX = Math.max(...x, rect.x + rect.width);\n    let maxY = Math.max(...y, rect.y + rect.height);\n    let rectW = Math.max(rect.width, maxX - minX);\n    let rectH = Math.max(rect.height, maxY - minY);\n    return Object.freeze({\n        ...rect,\n        x: minX,\n        y: minY,\n        width: rectW,\n        height: rectH\n    });\n};\n","import {} from \"./rect-types.js\";\nimport { guard as PointsGuard } from '../point/guard.js';\nimport { guardDim } from \"./guard.js\";\n/**\n * Initialises a rectangle based on its center, a width and height\n *\n * ```js\n * // Rectangle with center at 50,50, width 100 height 200\n * Rects.fromCenter({x: 50, y:50}, 100, 200);\n * ```\n * @param origin\n * @param width\n * @param height\n * @returns\n */\nexport const fromCenter = (origin, width, height) => {\n    PointsGuard(origin, `origin`);\n    guardDim(width, `width`);\n    guardDim(height, `height`);\n    const halfW = width / 2;\n    const halfH = height / 2;\n    return {\n        x: origin.x - halfW,\n        y: origin.y - halfH,\n        width: width,\n        height: height,\n    };\n};\n","/**\n * Initialise a rectangle based on the width and height of a HTML element.\n *\n * ```js\n * Rects.fromElement(document.querySelector(`body`));\n * ```\n * @param el\n * @returns\n */\nexport const fromElement = (el) => ({\n    width: el.clientWidth,\n    height: el.clientHeight,\n});\n","/**\n * Returns a rectangle from a series of numbers: x, y, width, height OR width, height\n *\n * ```js\n * const r1 = Rects.fromNumbers(100, 200);\n * // {width: 100, height: 200}\n *\n * const r2 = Rects.fromNumbers(10, 20, 100, 200);\n * // {x: 10, y: 20, width: 100, height: 200}\n * ```\n * Use the spread operator (...) if the source is an array:\n *\n * ```js\n * const r3 = Rects.fromNumbers(...[10, 20, 100, 200]);\n * ```\n *\n * Use {@link toArray} for the opposite conversion.\n *\n * @see toArray\n * @param xOrWidth\n * @param yOrHeight\n * @param width\n * @param height\n * @returns\n */\nexport function fromNumbers(xOrWidth, yOrHeight, width, height) {\n    if (width === undefined || height === undefined) {\n        if (typeof xOrWidth !== `number`)\n            throw new Error(`width is not an number`);\n        if (typeof yOrHeight !== `number`) {\n            throw new TypeError(`height is not an number`);\n        }\n        return Object.freeze({ width: xOrWidth, height: yOrHeight });\n    }\n    if (typeof xOrWidth !== `number`)\n        throw new Error(`x is not an number`);\n    if (typeof yOrHeight !== `number`)\n        throw new Error(`y is not an number`);\n    if (typeof width !== `number`)\n        throw new Error(`width is not an number`);\n    if (typeof height !== `number`)\n        throw new Error(`height is not an number`);\n    return Object.freeze({ x: xOrWidth, y: yOrHeight, width, height });\n}\n","import { guardDim } from \"./guard.js\";\nimport { guard as PointsGuard } from '../point/guard.js';\n/**\n * Creates a rectangle from its top-left coordinate, a width and height.\n *\n * ```js\n * // Rectangle at 50,50 with width of 100, height of 200.\n * const rect = Rects.fromTopLeft({ x: 50, y:50 }, 100, 200);\n * ```\n * @param origin\n * @param width\n * @param height\n * @returns\n */\nexport const fromTopLeft = (origin, width, height) => {\n    guardDim(width, `width`);\n    guardDim(height, `height`);\n    PointsGuard(origin, `origin`);\n    return { x: origin.x, y: origin.y, width: width, height: height };\n};\n","import { isPoint } from \"../point/guard.js\";\nimport { isRect, isRectPositioned } from \"./guard.js\";\n/**\n * Accepts:\n * * x,y,w,h\n * * x,y,rect\n * * point,rect\n * * RectPositioned\n * * Rect, x,y\n * * Rect, Point\n * @param a\n * @param b\n * @param c\n * @param d\n * @returns\n */\nexport function getRectPositionedParameter(a, b, c, d) {\n    if (typeof a === `number`) {\n        if (typeof b === `number`) {\n            if (typeof c === `number` && typeof d === `number`) {\n                return { x: a, y: b, width: c, height: d };\n            }\n            else if (isRect(c)) {\n                return { x: a, y: b, width: c.width, height: c.height };\n            }\n            else {\n                throw new TypeError(`If params 'a' & 'b' are numbers, expect following parameters to be x,y or Rect`);\n            }\n        }\n        else {\n            throw new TypeError(`If parameter 'a' is a number, expect following parameters to be: y,w,h`);\n        }\n    }\n    else if (isRectPositioned(a)) {\n        return a;\n    }\n    else if (isRect(a)) {\n        if (typeof b === `number` && typeof c === `number`) {\n            return { width: a.width, height: a.height, x: b, y: c };\n        }\n        else if (isPoint(b)) {\n            return { width: a.width, height: a.height, x: b.x, y: b.y };\n        }\n        else {\n            throw new TypeError(`If param 'a' is a Rect, expects following parameters to be x,y`);\n        }\n    }\n    else if (isPoint(a)) {\n        if (typeof b === `number` && typeof c === `number`) {\n            return { x: a.x, y: a.y, width: b, height: c };\n        }\n        else if (isRect(b)) {\n            return { x: a.x, y: a.y, width: b.width, height: b.height };\n        }\n        else {\n            throw new TypeError(`If parameter 'a' is a Point, expect following params to be: Rect or width,height`);\n        }\n    }\n    throw new TypeError(`Expect a first parameter to be x,RectPositioned,Rect or Point`);\n}\n","/**\n * Returns _true_ if the points have identical values\n *\n * ```js\n * const a = {x: 10, y: 10};\n * const b = {x: 10, y: 10;};\n * a === b        // False, because a and be are different objects\n * isEqual(a, b)   // True, because a and b are same value\n * ```\n * @param p Points\n * @returns _True_ if points are equal\n */\nexport const isEqual = (...p) => {\n    if (p === undefined)\n        throw new Error(`parameter 'p' is undefined`);\n    if (p.length < 2)\n        return true;\n    for (let index = 1; index < p.length; index++) {\n        if (p[index].x !== p[0].x)\n            return false;\n        if (p[index].y !== p[0].y)\n            return false;\n    }\n    return true;\n};\n","import { isPositioned } from \"./guard.js\";\nimport { isEqual as PointsIsEqual } from '../point/is-equal.js';\n/**\n * Returns _true_ if the width & height of the two rectangles is the same.\n *\n * ```js\n * const rectA = { width: 10, height: 10, x: 10, y: 10 };\n * const rectB = { width: 10, height: 10, x: 20, y: 20 };\n *\n * // True, even though x,y are different\n * Rects.isEqualSize(rectA, rectB);\n *\n * // False, because coordinates are different\n * Rects.isEqual(rectA, rectB)\n * ```\n * @param a\n * @param b\n * @returns\n */\nexport const isEqualSize = (a, b) => {\n    if (a === undefined)\n        throw new Error(`a undefined`);\n    if (b === undefined)\n        throw new Error(`b undefined`);\n    return a.width === b.width && a.height === b.height;\n};\n/**\n * Returns _true_ if two rectangles have identical values.\n * Both rectangles must be positioned or not.\n *\n * ```js\n * const rectA = { width: 10, height: 10, x: 10, y: 10 };\n * const rectB = { width: 10, height: 10, x: 20, y: 20 };\n *\n * // False, because coordinates are different\n * Rects.isEqual(rectA, rectB)\n *\n * // True, even though x,y are different\n * Rects.isEqualSize(rectA, rectB);\n * ```\n * @param a\n * @param b\n * @returns\n */\nexport const isEqual = (a, b) => {\n    if (isPositioned(a) && isPositioned(b)) {\n        if (!PointsIsEqual(a, b))\n            return false;\n        return a.width === b.width && a.height === b.height;\n    }\n    else if (!isPositioned(a) && !isPositioned(b)) {\n        return a.width === b.width && a.height === b.height;\n    }\n    else {\n        // One param is positioned, the other is not\n        return false;\n    }\n};\n","import { isPoint } from \"../point/guard.js\";\n/**\n * Returns true if `p` is a valid line, containing `a` and `b` Points.\n * ```js\n * Lines.isLine(l);\n * ```\n * @param p Value to check\n * @returns True if a valid line.\n */\nexport const isLine = (p) => {\n    if (p === undefined)\n        return false;\n    if (p.a === undefined)\n        return false;\n    if (p.b === undefined)\n        return false;\n    if (!isPoint(p.a))\n        return false;\n    if (!isPoint(p.b))\n        return false;\n    return true;\n};\n/**\n * Returns true if `p` is a {@link PolyLine}, ie. an array of {@link Line}s.\n * Validates all items in array.\n * @param p\n * @returns\n */\nexport const isPolyLine = (p) => {\n    if (!Array.isArray(p))\n        return false;\n    const valid = !p.some(v => !isLine(v));\n    return valid;\n};\n/**\n * Throws an exception if:\n * * line is undefined\n * * a or b parameters are missing\n *\n * Does not validate points\n * @param line\n * @param name\n */\nexport const guard = (line, name = `line`) => {\n    if (line === undefined)\n        throw new Error(`${name} undefined`);\n    if (line.a === undefined)\n        throw new Error(`${name}.a undefined. Expected {a:Point, b:Point}. Got: ${JSON.stringify(line)}`);\n    if (line.b === undefined)\n        throw new Error(`${name}.b undefined. Expected {a:Point, b:Point} Got: ${JSON.stringify(line)}`);\n};\n","import { isLine } from \"./guard.js\";\nimport { guard as guardPoint } from '../point/guard.js';\n/**\n * Returns [a,b] points from either a line parameter, or two points.\n * It additionally applies the guardPoint function to ensure validity.\n * This supports function overloading.\n * @ignore\n * @param aOrLine\n * @param b\n * @returns\n */\nexport const getPointParameter = (aOrLine, b) => {\n    let a;\n    if (isLine(aOrLine)) {\n        b = aOrLine.b;\n        a = aOrLine.a;\n    }\n    else {\n        a = aOrLine;\n        if (b === undefined)\n            throw new Error(`Since first parameter is not a line, two points are expected. Got a: ${JSON.stringify(a)} b: ${JSON.stringify(b)}`);\n    }\n    guardPoint(a, `a`);\n    guardPoint(a, `b`);\n    return [a, b];\n};\n","import { getPointParameter } from \"./get-points-parameter.js\";\nimport { isPolyLine } from \"./guard.js\";\n/**\n * Returns length of line, polyline or between two points\n *\n * @param aOrLine Point A, line or polyline (array of lines)\n * @param pointB Point B, if first parameter is a point\n * @returns Length (total accumulated length for arrays)\n */\nexport function length(aOrLine, pointB) {\n    if (isPolyLine(aOrLine)) {\n        const sum = aOrLine.reduce((accumulator, v) => length(v) + accumulator, 0);\n        return sum;\n    }\n    if (aOrLine === undefined)\n        throw new TypeError(`Parameter 'aOrLine' is undefined`);\n    const [a, b] = getPointParameter(aOrLine, pointB);\n    const x = b.x - a.x;\n    const y = b.y - a.y;\n    if (a.z !== undefined && b.z !== undefined) {\n        const z = b.z - a.z;\n        return Math.hypot(x, y, z);\n    }\n    else {\n        return Math.hypot(x, y);\n    }\n}\n","import { length as LinesLength } from '../line/length.js';\nimport { edges } from './edges.js';\nimport { guardPositioned } from './guard.js';\n/**\n * Returns the length of each side of the rectangle (top, right, bottom, left)\n *\n * ```js\n * const rect = { width: 100, height: 100, x: 100, y: 100 };\n * // Yields: array of length four\n * const lengths = Rects.lengths(rect);\n * ```\n * @param rect\n * @returns\n */\nexport const lengths = (rect) => {\n    guardPositioned(rect, `rect`);\n    return edges(rect).map((l) => LinesLength(l));\n};\n","/**\n * Returns a rectangle based on provided four corners.\n *\n * To create a rectangle that contains an arbitary set of points, use {@link Points.bbox}.\n *\n * Does some sanity checking such as:\n *  - x will be smallest of topLeft/bottomLeft\n *  - y will be smallest of topRight/topLeft\n *  - width will be largest between top/bottom left and right\n *  - height will be largest between left and right top/bottom\n *\n */\nexport const maxFromCorners = (topLeft, topRight, bottomRight, bottomLeft) => {\n    if (topLeft.y > bottomRight.y) {\n        throw new Error(`topLeft.y greater than bottomRight.y`);\n    }\n    if (topLeft.y > bottomLeft.y) {\n        throw new Error(`topLeft.y greater than bottomLeft.y`);\n    }\n    const w1 = topRight.x - topLeft.x;\n    const w2 = bottomRight.x - bottomLeft.x;\n    const h1 = Math.abs(bottomLeft.y - topLeft.y);\n    const h2 = Math.abs(bottomRight.y - topRight.y);\n    return {\n        x: Math.min(topLeft.x, bottomLeft.x),\n        y: Math.min(topRight.y, topLeft.y),\n        width: Math.max(w1, w2),\n        height: Math.max(h1, h2),\n    };\n};\n","import { applyMerge, applyDim, applyScalar } from \"./apply.js\";\nconst multiplyOp = (a, b) => a * b;\n/**\n * @internal\n * @param a\n * @param b\n * @param c\n * @returns\n */\nexport function multiply(a, b, c) {\n    // @ts-ignore\n    return applyMerge(multiplyOp, a, b, c);\n}\n/**\n * Multiplies all components of `rect` by `amount`.\n * This includes x,y if present.\n *\n * ```js\n * multiplyScalar({ width:10, height:20 }, 2); // { width:20, height: 40 }\n * multiplyScalar({ x: 1, y: 2, width:10, height:20 }, 2); // { x: 2, y: 4, width:20, height: 40 }\n * ```\n *\n * Use {@link multiplyDim} to only multiply width & height.\n * @param rect\n * @param amount\n */\nexport function multiplyScalar(rect, amount) {\n    return applyScalar(multiplyOp, rect, amount);\n    // return isPositioned(rect) ? Object.freeze({\n    //   ...rect,\n    //   x: rect.x * amount,\n    //   y: rect.y * amount,\n    //   width: rect.width * amount,\n    //   height: rect.height * amount,\n    // }) : Object.freeze({\n    //   ...rect,\n    //   width: rect.width * amount,\n    //   height: rect.height * amount,\n    // });\n}\n/**\n * Multiplies only the width/height of `rect`, leaving `x` and `y` as they are.\n * ```js\n * multiplyDim({ x:1,y:2,width:3,height:4 }, 2);\n * // Yields: { x:1, y:2, width:6, height: 8 }\n * ```\n *\n * In comparison, {@link multiply} will also include x & y.\n * @param rect Rectangle\n * @param amount Amount to multiply by\n * @returns\n */\nexport function multiplyDim(rect, amount) {\n    return applyDim(multiplyOp, rect, amount);\n    // return isPositioned(rect) ? Object.freeze({\n    //   ...rect,\n    //   x: rect.x * amount,\n    //   y: rect.y * amount,\n    //   width: rect.width * amount,\n    //   height: rect.height * amount,\n    // }) : Object.freeze({\n    //   ...rect,\n    //   width: rect.width * amount,\n    //   height: rect.height * amount,\n    // });\n}\n","/**\n * If `p` is inside of `rect`, a copy of `p` is returned.\n * If `p` is outside of `rect`, a point is returned closest to `p` on the edge\n * of the rectangle.\n * @param rect\n * @param p\n * @returns\n */\nexport const nearestInternal = (rect, p) => {\n    let { x, y } = p;\n    if (x < rect.x)\n        x = rect.x;\n    else if (x > rect.x + rect.width)\n        x = rect.x + rect.width;\n    if (y < rect.y)\n        y = rect.y;\n    else if (y > rect.y + rect.height)\n        y = rect.y + rect.height;\n    return Object.freeze({ ...p, x, y });\n};\n","export const Placeholder = Object.freeze({\n    width: Number.NaN,\n    height: Number.NaN,\n});\nexport const PlaceholderPositioned = Object.freeze({\n    x: Number.NaN,\n    y: Number.NaN,\n    width: Number.NaN,\n    height: Number.NaN,\n});\n","import { guard } from \"./guard.js\";\n/**\n * Returns the perimeter of `rect` (ie. sum of all edges)\n *  * ```js\n * const rect = { width: 100, height: 100, x: 100, y: 100 };\n * Rects.perimeter(rect);\n * ```\n * @param rect\n * @returns\n */\nexport const perimeter = (rect) => {\n    guard(rect);\n    return rect.height + rect.height + rect.width + rect.width;\n};\n","import { isPoint, isPoint3d } from \"../point/guard.js\";\n/**\n * Returns a function that divides numbers or points by the largest dimension of `rect`.\n *\n * ```js\n * const d = dividerByLargestDimension({width:100,height:50});\n * d(50);                // 0.5 (50/100)\n * d({ x: 10, y: 20 }); // { x: 0.1, y: 0.2 }\n * ```\n * @param rect\n * @returns\n */\nexport const dividerByLargestDimension = (rect) => {\n    const largest = Math.max(rect.width, rect.height);\n    return (value) => {\n        if (typeof value === `number`) {\n            return value / largest;\n        }\n        else if (isPoint3d(value)) {\n            return Object.freeze({\n                ...value,\n                x: value.x / largest,\n                y: value.y / largest,\n                z: value.x / largest\n            });\n        }\n        else if (isPoint(value)) {\n            return Object.freeze({\n                ...value,\n                x: value.x / largest,\n                y: value.y / largest\n            });\n        }\n        else\n            throw new Error(`Param 'value' is neither number nor Point`);\n    };\n};\n","import {} from '@ixfx/random';\nimport { sum as PointsSum } from '../point/sum.js';\nimport { isPositioned } from './guard.js';\n/**\n * Returns a random positioned Rect on a 0..1 scale.\n * ```js\n * const r = Rects.random(); // eg {x: 0.2549012, y:0.859301, width: 0.5212, height: 0.1423 }\n * ```\n *\n * A custom source of randomness can be provided:\n * ```js\n * import { Rects } from \"@ixfx/geometry.js\";\n * import { weightedSource } from \"@ixfx/random.js\"\n * const r = Rects.random(weightedSource(`quadIn`));\n * ```\n * @param rando\n * @returns\n */\nexport const random = (rando) => {\n    rando ??= Math.random;\n    return Object.freeze({\n        x: rando(),\n        y: rando(),\n        width: rando(),\n        height: rando(),\n    });\n};\n/**\n * Returns a random point within a rectangle.\n *\n * By default creates a uniform distribution.\n *\n * ```js\n * const pt = randomPoint({width: 5, height: 10});\n * ```'\n * @param within Rectangle to generate a point within\n * @param options Options\n * @returns\n */\nexport const randomPoint = (within, options = {}) => {\n    // TODO: Does not implement uniform distribution\n    // See: https://math.stackexchange.com/questions/366474/find-coordinates-of-n-points-uniformly-distributed-in-a-rectangle\n    const rand = options.randomSource ?? Math.random;\n    const margin = options.margin ?? { x: 0, y: 0 };\n    const x = rand() * (within.width - margin.x - margin.x);\n    const y = rand() * (within.height - margin.y - margin.y);\n    const pos = { x: x + margin.x, y: y + margin.y };\n    return isPositioned(within) ? PointsSum(pos, within) : Object.freeze(pos);\n};\n","import { applyMerge } from \"./apply.js\";\nimport { isPositioned } from \"./guard.js\";\nconst subtractOp = (a, b) => a - b;\n/**\n * Subtracts width/height from `a`.\n *\n * ```js\n * const rectA = { width: 100, height: 100 };\n * const rectB = { width: 200, height: 200 };\n *\n * // Yields: { width: -100, height: -100 }\n * Rects.subtract(rectA, rectB);\n * Rects.subtract(rectA, 200, 200);\n * ```\n * @param a\n * @param b\n * @param c\n * @returns\n */\nexport function subtract(a, b, c) {\n    // @ts-ignore\n    return applyMerge(subtractOp, a, b, c);\n}\nexport function subtractSize(a, b, c) {\n    const w = typeof b === `number` ? b : b.width;\n    const h = typeof b === `number` ? c : b.height;\n    if (h === undefined)\n        throw new Error(`Expected height as third parameter`);\n    const r = {\n        ...a,\n        width: a.width - w,\n        height: a.height - h\n    };\n    return r;\n}\n/**\n * Subtracts A-B. Applies to x, y, width & height\n * ```js\n * subtractOffset(\n *  { x:100, y:100, width:100, height:100 },\n *  { x:10, y:20,   width: 30, height: 40 }\n * );\n * // Yields: {x: 90, y: 80, width: 70, height: 60 }\n * ```\n * If either `a` or `b` are missing x & y, 0 is used.\n * @param a\n * @param b\n * @returns\n */\nexport function subtractOffset(a, b) {\n    let x = 0;\n    let y = 0;\n    if (isPositioned(a)) {\n        x = a.x;\n        y = a.y;\n    }\n    let xB = 0;\n    let yB = 0;\n    if (isPositioned(b)) {\n        xB = b.x;\n        yB = b.y;\n    }\n    return Object.freeze({\n        ...a,\n        x: x - xB,\n        y: y - yB,\n        width: a.width - b.width,\n        height: a.height - b.height\n    });\n}\n","import { applyMerge } from \"./apply.js\";\nimport { getRectPositioned, isPositioned } from \"./guard.js\";\nconst sumOp = (a, b) => a + b;\n/**\n * Sums width/height of `b` with `a` (ie: a + b), returning result.\n *\n * ```js\n * const rectA = { width: 100, height: 100 };\n * const rectB = { width: 200, height: 200 };\n *\n * // Yields: { width: 300, height: 300 }\n * Rects.sum(rectA, rectB);\n * Rects.sum(rectA, 200, 200);\n * ```\n * @param a\n * @param b\n * @param c\n * @returns\n */\nexport function sum(a, b, c) {\n    // @ts-ignore\n    return applyMerge(sumOp, a, b, c);\n}\n/**\n * Sums x,y,width,height of a+b.\n * ```js\n * sumOffset({x:100,y:100,width:100,height:100}, {x:10, y:20, width: 30, height: 40});\n * // Yields: {x: 110, y: 120, width: 130, height: 140 }\n * ```\n * If either `a` or `b` are missing x & y, 0 is used\n * @param a\n * @param b\n * @returns\n */\nexport function sumOffset(a, b) {\n    let x = 0;\n    let y = 0;\n    if (isPositioned(a)) {\n        x = a.x;\n        y = a.y;\n    }\n    let xB = 0;\n    let yB = 0;\n    if (isPositioned(b)) {\n        xB = b.x;\n        yB = b.y;\n    }\n    return Object.freeze({\n        ...a,\n        x: x + xB,\n        y: y + yB,\n        width: a.width + b.width,\n        height: a.height + b.height\n    });\n}\n","import { isPositioned, isRect } from \"./guard.js\";\n/**\n * Converts a rectangle to an array of numbers. See {@link fromNumbers} for the opposite conversion.\n *\n * ```js\n * const r1 = Rects.toArray({ x: 10, y:20, width: 100, height: 200 });\n * // [10, 20, 100, 200]\n * const r2 = Rects.toArray({ width: 100, height: 200 });\n * // [100, 200]\n * ```\n * @param rect\n * @see fromNumbers\n */\nexport function toArray(rect) {\n    if (isPositioned(rect)) {\n        return [rect.x, rect.y, rect.width, rect.height];\n    }\n    else if (isRect(rect)) {\n        return [rect.width, rect.height];\n    }\n    else {\n        throw new Error(`Param 'rect' is not a rectangle. Got: ${JSON.stringify(rect)}`);\n    }\n}\n","export * from './area.js';\nexport * from './apply.js';\nexport * from './cardinal.js';\nexport * from './center-origin.js';\nexport * from './center.js';\nexport * from './corners.js';\nexport * from './distance.js';\nexport * from './divide.js';\nexport * from './edges.js';\nexport * from './empty.js';\nexport * from './encompass.js';\nexport * from './from-center.js';\nexport * from './from-element.js';\nexport * from './from-numbers.js';\nexport * from './from-top-left.js';\nexport * from './get-rect-positionedparameter.js';\nexport * from './guard.js';\nexport * from './Intersects.js';\nexport * from './is-equal.js';\nexport * from './lengths.js';\nexport * from './max.js';\nexport * from './multiply.js';\nexport * from './nearest.js';\nexport * from './placeholder.js';\nexport * from './perimeter.js';\nexport * from './normalise-by-rect.js';\nexport * from './random.js';\nexport * from './subtract.js';\nexport * from './sum.js';\nexport * from './to-array.js';\n","import { isPoint, isPoint3d } from \"./guard.js\";\n/**\n * Returns a point with Math.abs applied to x,y and z if present.\n * ```js\n * Points.abs({ x:1,  y:1  }); // { x: 1, y: 1 }\n * Points.abs({ x:-1, y:1  }); // { x: 1, y: 1 }\n * Points.abs({ x:-1, y:-1 }); // { x: 1, y: 1 }\n * ```\n * @param pt\n * @returns\n */\nexport function abs(pt) {\n    if (isPoint3d(pt)) {\n        return Object.freeze({\n            ...pt,\n            x: Math.abs(pt.x),\n            y: Math.abs(pt.y),\n            z: Math.abs(pt.z)\n        });\n    }\n    else if (isPoint(pt)) {\n        return Object.freeze({\n            ...pt,\n            x: Math.abs(pt.x),\n            y: Math.abs(pt.y)\n        });\n    }\n    else\n        throw new TypeError(`Param 'pt' is not a point`);\n}\n;\n","export const piPi = Math.PI * 2;\n","import { piPi } from \"../pi.js\";\nimport { guard } from \"./guard.js\";\n/**\n * Returns the angle in radians between `a` and `b`.\n *\n * Eg if `a` is the origin, and `b` is another point,\n * in degrees one would get 0 to -180 when `b` was above `a`.\n *  -180 would be `b` in line with `a`.\n * Same for under `a`.\n *\n * Providing a third point `c` gives the interior angle, where `b` is the middle point.\n *\n * See also {@link angleRadianCircle} which returns coordinates on 0..Math.Pi*2\n * range. This avoids negative numbers.\n * @param a\n * @param b\n * @param c\n * @returns\n */\nexport const angleRadian = (a, b, c) => {\n    guard(a, `a`);\n    if (b === undefined) {\n        return Math.atan2(a.y, a.x);\n    }\n    guard(b, `b`);\n    if (c === undefined) {\n        return Math.atan2(b.y - a.y, b.x - a.x);\n    }\n    guard(c, `c`);\n    return Math.atan2(b.y - a.y, b.x - a.x) - Math.atan2(c.y - a.y, c.x - a.x);\n};\n/**\n * Returns the angle between point(s) using a radian circle system.\n * ```\n *       90deg\n *       Pi/2\n *        |\n * Pi  ---+--- 0\n * 180    |\n *       3PI/2\n *       270deg\n * ```\n * @param a\n * @param b\n * @param c\n * @returns\n */\nexport const angleRadianCircle = (a, b, c) => {\n    const angle = angleRadian(a, b, c);\n    if (angle < 0)\n        return angle + piPi;\n    return angle;\n};\n/**\n * Return the angle of a wedge, defined by a, b and C points, where 'b'\n * could be thought of as the origin or pivot.\n *\n * @param a\n * @param b\n * @param c\n * @returns\n */\nexport const angleRadianThreePoint = (a, b, c) => {\n    const ab = Math.sqrt(Math.pow(b.x - a.x, 2) + Math.pow(b.y - a.y, 2));\n    const bc = Math.sqrt(Math.pow(b.x - c.x, 2) + Math.pow(b.y - c.y, 2));\n    const ac = Math.sqrt(Math.pow(c.x - a.x, 2) + Math.pow(c.y - a.y, 2));\n    return Math.acos((bc * bc + ab * ab - ac * ac) / (2 * bc * ab));\n};\n","import { guard, isPoint3d } from \"./guard.js\";\n/**\n * Applies `fn` on x,y & z (if present) fields, returning all other fields as well\n * ```js\n * const p = {x:1.234, y:4.9};\n * const p2 = Points.apply(p, Math.round);\n * // Yields: {x:1, y:5}\n * ```\n *\n * The name of the field is provided as well. Here we only round the `x` field:\n *\n * ```js\n * const p = {x:1.234, y:4.9};\n * const p2 = Points.apply(p, (v, field) => {\n *  if (field === `x`) return Math.round(v);\n *  return v;\n * });\n * ```\n * @param pt\n * @param fn\n * @returns\n */\nexport function apply(pt, fn) {\n    guard(pt, `pt`);\n    if (isPoint3d(pt)) {\n        return Object.freeze({\n            ...pt,\n            x: fn(pt.x, `x`),\n            y: fn(pt.y, `y`),\n            z: fn(pt.z, `z`)\n        });\n    }\n    return Object.freeze({\n        ...pt,\n        x: fn(pt.x, `x`),\n        y: fn(pt.y, `y`),\n    });\n}\n","import { movingAverageLight as mal } from \"@ixfx/numbers\";\nimport { isPoint3d } from \"./guard.js\";\nexport function averager(kind, opts = {}) {\n    let x;\n    let y;\n    let z;\n    switch (kind) {\n        case `moving-average-light`:\n            {\n                const scaling = opts.scaling ?? 3;\n                x = mal(scaling);\n                y = mal(scaling);\n                z = mal(scaling);\n                break;\n            }\n        default:\n            throw new Error(`Unknown averaging kind '${kind}'. Expected: 'moving-average-light'`);\n    }\n    return (point) => {\n        const ax = x(point.x);\n        const ay = y(point.y);\n        if (isPoint3d(point)) {\n            const az = z(point.z);\n            return Object.freeze({\n                x: ax,\n                y: ay,\n                z: az\n            });\n        }\n        else {\n            return Object.freeze({\n                x: ax,\n                y: ay\n            });\n        }\n    };\n}\n","import { isPoint3d } from \"./guard.js\";\n/**\n * Returns the 'minimum' point from an array of points, using a comparison function.\n *\n * @example Find point closest to a coordinate\n * ```js\n * const points = [...];\n * const center = {x: 100, y: 100};\n *\n * const closestToCenter = findMinimum((a, b) => {\n *  const aDist = distance(a, center);\n *  const bDist = distance(b, center);\n *  if (aDistance < bDistance) return a;\n *  return b;\n * }, points);\n * ```\n * @param comparer Compare function returns the smallest of `a` or `b`\n * @param points\n * @returns\n */\nexport function findMinimum(comparer, ...points) {\n    if (points.length === 0)\n        throw new Error(`No points provided`);\n    let min = points[0];\n    for (const p of points) {\n        if (isPoint3d(min) && isPoint3d(p)) {\n            min = comparer(min, p);\n        }\n        else {\n            min = comparer(min, p);\n        }\n    }\n    return min;\n}\n;\n","import { findMinimum } from \"./find-minimum.js\";\nimport { maxFromCorners as RectsMaxFromCorners } from '../rect/max.js';\n/**\n * Returns the minimum rectangle that can enclose all provided points\n * @param points\n * @returns\n */\nexport const bbox = (...points) => {\n    const leftMost = findMinimum((a, b) => {\n        return a.x < b.x ? a : b;\n    }, ...points);\n    const rightMost = findMinimum((a, b) => {\n        return a.x > b.x ? a : b;\n    }, ...points);\n    const topMost = findMinimum((a, b) => {\n        return a.y < b.y ? a : b;\n    }, ...points);\n    const bottomMost = findMinimum((a, b) => {\n        return a.y > b.y ? a : b;\n    }, ...points);\n    const topLeft = { x: leftMost.x, y: topMost.y };\n    const topRight = { x: rightMost.x, y: topMost.y };\n    const bottomRight = { x: rightMost.x, y: bottomMost.y };\n    const bottomLeft = { x: leftMost.x, y: bottomMost.y };\n    return RectsMaxFromCorners(topLeft, topRight, bottomRight, bottomLeft);\n};\nexport const bbox3d = (...points) => {\n    const box = bbox(...points);\n    const zMin = findMinimum((a, b) => {\n        return a.z < b.z ? a : b;\n    }, ...points);\n    const zMax = findMinimum((a, b) => {\n        return a.z > b.z ? a : b;\n    }, ...points);\n    return {\n        ...box,\n        z: zMin.z,\n        depth: zMax.z - zMin.z\n    };\n};\n","import { isPoint } from \"./guard.js\";\n/**\n * Calculates the [centroid](https://en.wikipedia.org/wiki/Centroid#Of_a_finite_set_of_points) of a set of points\n * Undefined values are skipped over.\n *\n * ```js\n * // Find centroid of a list of points\n * const c1 = centroid(p1, p2, p3, ...);\n *\n * // Find centroid of an array of points\n * const c2 = centroid(...pointsArray);\n * ```\n * @param points\n * @returns A single point\n */\nexport const centroid = (...points) => {\n    if (!Array.isArray(points))\n        throw new Error(`Expected list of points`);\n    // eslint-disable-next-line unicorn/no-array-reduce\n    const sum = points.reduce((previous, p) => {\n        if (p === undefined)\n            return previous; // Ignore undefined\n        if (Array.isArray(p)) {\n            throw new TypeError(`'points' list contains an array. Did you mean: centroid(...myPoints)?`);\n        }\n        if (!isPoint(p)) {\n            throw new Error(`'points' contains something which is not a point: ${JSON.stringify(p)}`);\n        }\n        return {\n            x: previous.x + p.x,\n            y: previous.y + p.y,\n        };\n    }, { x: 0, y: 0 });\n    return Object.freeze({\n        x: sum.x / points.length,\n        y: sum.y / points.length,\n    });\n};\n","import { clamp as clampNumber } from '@ixfx/numbers';\nimport { isPoint3d } from \"./guard.js\";\n/**\n * Clamps a point to be between `min` and `max` (0 & 1 by default)\n * @param pt Point\n * @param min Minimum value (0 by default)\n * @param max Maximum value (1 by default)\n */\nexport function clamp(a, min = 0, max = 1) {\n    if (isPoint3d(a)) {\n        return Object.freeze({\n            x: clampNumber(a.x, min, max),\n            y: clampNumber(a.y, min, max),\n            z: clampNumber(a.z, min, max)\n        });\n    }\n    else {\n        return Object.freeze({\n            x: clampNumber(a.x, min, max),\n            y: clampNumber(a.y, min, max),\n        });\n    }\n}\n","/**\n * Returns -2 if both x & y of a is less than b\n * Returns -1 if either x/y of a is less than b\n *\n * Returns 2 if both x & y of a is greater than b\n * Returns 1 if either x/y of a is greater than b's x/y\n *\n * Returns 0 if x/y of a and b are equal\n * @param a\n * @param b\n * @returns\n */\nexport const compare = (a, b) => {\n    if (a.x < b.x && a.y < b.y)\n        return -2;\n    if (a.x > b.x && a.y > b.y)\n        return 2;\n    if (a.x < b.x || a.y < b.y)\n        return -1;\n    if (a.x > b.x || a.y > b.y)\n        return 1;\n    if (a.x === b.x && a.x === b.y)\n        return 0;\n    return Number.NaN;\n};\n/**\n * Compares points based on x value. Y value is ignored.\n *\n * Return values:\n * * 0: If a.x === b.x\n * * 1: a is to the right of b (ie. a.x > b.x)\n * * -1: a is to the left of b (ie. a.x < b.x)\n *\n * @example Sorting by x\n * ```js\n * arrayOfPoints.sort(Points.compareByX);\n * ```\n *\n * @param a\n * @param b\n * @returns\n */\nexport const compareByX = (a, b) => {\n    if (a.x === b.x)\n        return 0;\n    if (a.x < b.x)\n        return -1;\n    return 1;\n    // a.x - b.x || a.y - b.y;\n};\n/**\n * Compares points based on Y value. X value is ignored.\n *\n * Return values:\n * * 0: If a.y === b.y\n * * 1: A is below B (ie. a.y > b.y)\n * * -1: A is above B (ie. a.y < b.y)\n *\n * @example Sorting by Y\n * ```js\n * arrayOfPoints.sort(Points.compareByY);\n * ```\n * @param a\n * @param b\n * @returns\n */\nexport const compareByY = (a, b) => {\n    if (a.y === b.y)\n        return 0;\n    if (a.y < b.y)\n        return -1;\n    return 1;\n};\n/**\n * Compares points based on Z value. XY values are ignored.\n *\n * Return values:\n * * 0: If a.z === b.z\n * * 1: A is below B (ie. a.z > b.z)\n * * -1: A is above B (ie. a.z < b.z)\n *\n * @example Sorting by Y\n * ```js\n * arrayOfPoints.sort(Points.compareByZ);\n * ```\n * @param a\n * @param b\n * @returns\n */\nexport const compareByZ = (a, b) => {\n    if (a.z === b.z)\n        return 0;\n    if (a.z < b.z)\n        return -1;\n    return 1;\n};\n","import { compareByX } from \"./compare.js\";\nimport { isEqual } from \"./is-equal.js\";\n/**\n * Simple convex hull impementation. Returns a set of points which\n * enclose `pts`.\n *\n * For more power, see something like [Hull.js](https://github.com/AndriiHeonia/hull)\n * @param pts\n * @returns\n */\nexport const convexHull = (...pts) => {\n    const sorted = [...pts].sort(compareByX);\n    if (sorted.length === 1)\n        return sorted;\n    const x = (points) => {\n        const v = [];\n        for (const p of points) {\n            while (v.length >= 2) {\n                // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n                const q = v.at(-1);\n                // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n                const r = v.at(-2);\n                if ((q.x - r.x) * (p.y - r.y) >= (q.y - r.y) * (p.x - r.x)) {\n                    //eslint-disable-next-line functional/immutable-data\n                    v.pop();\n                }\n                else\n                    break;\n            }\n            //eslint-disable-next-line functional/immutable-data\n            v.push(p);\n        }\n        //eslint-disable-next-line functional/immutable-data\n        v.pop();\n        return v;\n    };\n    const upper = x(sorted);\n    //eslint-disable-next-line functional/immutable-data\n    const lower = x(sorted.reverse());\n    if (upper.length === 1 && lower.length === 1 && isEqual(lower[0], upper[0])) {\n        return upper;\n    }\n    return [...upper, ...lower];\n};\n","import { distance as pointsDistance } from '../point/distance.js';\nimport { guardPositioned, isCirclePositioned } from \"./guard.js\";\n/**\n * Returns the distance between two circle centers.\n *\n * ```js\n * const circleA = { radius: 5, x: 5, y: 5 }\n * const circleB = { radius: 10, x: 20, y: 20 }\n * const distance = Circles.distanceCenter(circleA, circleB);\n * ```\n * Throws an error if either is lacking position.\n * @param a\n * @param b\n * @returns Distance\n */\nexport const distanceCenter = (a, b) => {\n    guardPositioned(a, `a`);\n    if (isCirclePositioned(b)) {\n        guardPositioned(b, `b`);\n    }\n    return pointsDistance(a, b);\n};\n","import { distanceCenter } from \"./distance-center.js\";\nimport { isPoint as PointsIsPoint } from \"../point/guard.js\";\nimport { distance as PointsDistance } from \"../point/distance.js\";\nimport { guardPositioned, isCirclePositioned } from \"./guard.js\";\n/**\n * Returns the distance between the exterior of two circles, or between the exterior of a circle and point.\n * If `b` overlaps or is enclosed by `a`, distance is 0.\n *\n * ```js\n * const circleA = { radius: 5, x: 5, y: 5 }\n * const circleB = { radius: 10, x: 20, y: 20 }\n * const distance = Circles.distanceCenter(circleA, circleB);\n * ```\n * @param a\n * @param b\n */\nexport const distanceFromExterior = (a, b) => {\n    guardPositioned(a, `a`);\n    if (isCirclePositioned(b)) {\n        return Math.max(0, distanceCenter(a, b) - a.radius - b.radius);\n    }\n    else if (PointsIsPoint(b)) {\n        const distribution = PointsDistance(a, b);\n        if (distribution < a.radius)\n            return 0;\n        return distribution;\n    }\n    else\n        throw new Error(`Second parameter invalid type`);\n};\n","import { distanceFromExterior as circleDistanceFromExterior } from \"../circle/distance-from-exterior.js\";\nimport { distance } from \"./distance.js\";\nimport { isPoint } from \"./guard.js\";\nimport { distanceFromExterior as rectDistanceFromExterior } from \"../rect/distance.js\";\nimport { isCirclePositioned } from \"../circle/guard.js\";\nimport { isRectPositioned } from \"../rect/guard.js\";\n/**\n * Returns the distance from point `a` to the center of `shape`.\n * @param a Point\n * @param shape Point, or a positioned Rect or Circle.\n * @returns\n */\nexport const distanceToCenter = (a, shape) => {\n    if (isRectPositioned(shape)) {\n        return rectDistanceFromExterior(shape, a);\n    }\n    if (isCirclePositioned(shape)) {\n        return circleDistanceFromExterior(shape, a);\n    }\n    if (isPoint(shape))\n        return distance(a, shape);\n    throw new Error(`Unknown shape`);\n};\n","import { distanceFromExterior as rectDistanceFromExterior } from \"../rect/distance.js\";\nimport { isCirclePositioned } from \"../circle/guard.js\";\nimport { isRectPositioned } from \"../rect/guard.js\";\nimport { isPoint } from \"./guard.js\";\nimport { distance } from \"./distance.js\";\nimport { distanceFromExterior as circleDistanceFromExterior } from \"../circle/distance-from-exterior.js\";\n/**\n * Returns the distance from point `a` to the exterior of `shape`.\n *\n * @example Distance from point to rectangle\n * ```\n * const distance = distanceToExterior(\n *  {x: 50, y: 50},\n *  {x: 100, y: 100, width: 20, height: 20}\n * );\n * ```\n *\n * @example Find closest shape to point\n * ```\n * import {minIndex} from '../data/arrays.js';\n * const shapes = [ some shapes... ]; // Shapes to compare against\n * const pt = { x: 10, y: 10 };       // Comparison point\n * const distances = shapes.map(v => distanceToExterior(pt, v));\n * const closest = shapes[minIndex(...distances)];\n * ```\n * @param a Point\n * @param shape Point, or a positioned Rect or Circle.\n * @returns\n */\nexport const distanceToExterior = (a, shape) => {\n    if (isRectPositioned(shape)) {\n        return rectDistanceFromExterior(shape, a);\n    }\n    if (isCirclePositioned(shape)) {\n        return circleDistanceFromExterior(shape, a);\n    }\n    if (isPoint(shape))\n        return distance(a, shape);\n    throw new Error(`Unknown shape`);\n};\n","import { getPointParameter, getTwoPointParameters } from \"./get-point-parameter.js\";\nimport { guard, guardNonZeroPoint, isPoint3d } from \"./guard.js\";\n/**\n * Returns a Point with the x,y,z values of two points divide (a/b).\n *\n * `z` parameter is used, if present. Uses a default value of 0 for 'z' when dividing a 2D point with a 3D one.\n *\n * Examples:\n *\n * ```js\n * divide(ptA, ptB);\n * divide(x1, y1, x2, y2);\n * divide(ptA, x2, y2);\n * ```\n */\nexport function divide(a1, ab2, ab3, ab4, ab5, ab6) {\n    const [ptA, ptB] = getTwoPointParameters(a1, ab2, ab3, ab4, ab5, ab6);\n    guard(ptA, `a`);\n    guard(ptB, `b`);\n    if (ptB.x === 0)\n        throw new TypeError('Cannot divide by zero (b.x is 0)');\n    if (ptB.y === 0)\n        throw new TypeError('Cannot divide by zero (b.y is 0)');\n    const pt = {\n        x: ptA.x / ptB.x,\n        y: ptA.y / ptB.y,\n    };\n    if (isPoint3d(ptA) || isPoint3d(ptB)) {\n        if (ptB.z === 0)\n            throw new TypeError('Cannot divide by zero (b.z is 0)');\n        pt.z = (ptA.z ?? 0) / (ptB.z ?? 0);\n    }\n    ;\n    return Object.freeze(pt);\n}\n;\n/**\n * Returns a function that divides a point:\n * ```js\n * const f = divider(100, 200);\n * f(50,100); // Yields: { x: 0.5, y: 0.5 }\n * ```\n *\n * Input values can be Point, separate x,y and optional z values or an array:\n * ```js\n * const f = divider({ x: 100, y: 100 });\n * const f = divider( 100, 100 );\n * const f = divider([ 100, 100 ]);\n * ```\n *\n * Likewise the returned function an take these as inputs:\n * ```js\n * f({ x: 100, y: 100});\n * f( 100, 100 );\n * f([ 100, 100 ]);\n * ```\n *\n * Function throws if divisor has 0 for any coordinate (since we can't divide by 0)\n * @param a Divisor point, array of points or x\n * @param b Divisor y value\n * @param c Divisor z value\n * @returns\n */\n//eslint-disable-next-line functional/prefer-readonly-type\nexport function divider(a, b, c) {\n    const divisor = getPointParameter(a, b, c);\n    guardNonZeroPoint(divisor, `divisor`);\n    return (aa, bb, cc) => {\n        const dividend = getPointParameter(aa, bb, cc);\n        return typeof dividend.z === `undefined` ? Object.freeze({\n            x: dividend.x / divisor.x,\n            y: dividend.y / divisor.y,\n        }) : Object.freeze({\n            x: dividend.x / divisor.x,\n            y: dividend.y / divisor.y,\n            z: dividend.z / (divisor.z ?? 1),\n        });\n    };\n}\n","/**\n * Returns point as an array in the form [x,y]. This can be useful for some libraries\n * that expect points in array form.\n *\n * ```\n * const p = {x: 10, y:5};\n * const p2 = toArray(p); // yields [10,5]\n * ```\n * @param p\n * @returns\n */\nexport const toArray = (p) => [p.x, p.y];\n","import { dotProduct as ArraysDotProduct } from '@ixfx/numbers';\nimport { toArray } from './to-array.js';\nexport const dotProduct = (...pts) => {\n    const a = pts.map(p => toArray(p));\n    return ArraysDotProduct(a);\n};\n","/**\n * An empty point of `{ x: 0, y: 0 }`.\n *\n * Use `isEmpty` to check if a point is empty.\n * Use `Empty3d` to get an empty point with `z`.\n */\nexport const Empty = { x: 0, y: 0 };\n/**\n * Returns { x:1, y:1 }\n */\nexport const Unit = { x: 1, y: 1 };\n/**\n * An empty Point of `{ x: 0, y: 0, z: 0}`\n * Use `isEmpty` to check if a point is empty.\n * Use `Empty` to get an empty point without `z`.\n */\nexport const Empty3d = { x: 0, y: 0, z: 0 };\n/**\n * Returns { x:1,y:1,z:1 }\n */\nexport const Unit3d = { x: 1, y: 1, z: 1 };\n","import { guard } from \"./guard.js\";\n/**\n * Returns a point from two or three coordinates or an array of [x,y] or [x,y,z].\n * @example\n * ```js\n * let p = from([10, 5]);    // yields {x:10, y:5}\n * let p = from([10, 5, 2]); // yields: {x:10, y:5, z:2}\n * let p = from(10, 5);      // yields {x:10, y:5}\n * let p = from(10, 5, 2);   // yields: {x:10, y:5, z:2}\n * ```\n * @param xOrArray\n * @param [y]\n * @returns Point\n */\nexport function from(xOrArray, y, z) {\n    if (Array.isArray(xOrArray)) {\n        if (xOrArray.length === 3) {\n            return Object.freeze({\n                x: xOrArray[0],\n                y: xOrArray[1],\n                z: xOrArray[2]\n            });\n        }\n        else if (xOrArray.length === 2) {\n            return Object.freeze({\n                x: xOrArray[0],\n                y: xOrArray[1],\n            });\n        }\n        else {\n            throw new Error(`Expected array of length two or three, got ${xOrArray.length}`);\n        }\n    }\n    else {\n        if (xOrArray === undefined)\n            throw new Error(`Requires an array of [x,y] or x,y parameters at least`);\n        else if (Number.isNaN(xOrArray))\n            throw new Error(`x is NaN`);\n        if (y === undefined)\n            throw new Error(`Param 'y' is missing`);\n        else if (Number.isNaN(y))\n            throw new Error(`y is NaN`);\n        if (z === undefined) {\n            return Object.freeze({ x: xOrArray, y: y });\n        }\n        else {\n            return Object.freeze({ x: xOrArray, y, z });\n        }\n    }\n}\n;\n/**\n * Parses a point as a string, in the form 'x,y' or 'x,y,z'.\n * eg '10,15' will be returned as `{ x: 10, y: 15 }`.\n *\n * Throws an error if `str` is not a string.\n *\n * ```js\n * Points.fromString(`10,15`);  // { x:10, y:15 }\n * Points.fromString(`a,10`);   // { x:NaN, y:10 }\n * ```\n *\n * Use {@link Points.isNaN} to check if returned point has NaN for either coordinate.\n * @param string_\n */\nexport const fromString = (string_) => {\n    if (typeof string_ !== `string`)\n        throw new TypeError(`Param 'str' ought to be a string. Got: ${typeof string_}`);\n    const comma = string_.indexOf(`,`);\n    const x = Number.parseFloat(string_.substring(0, comma));\n    const nextComma = string_.indexOf(',', comma + 1);\n    if (nextComma > 0) {\n        // z component\n        const y = Number.parseFloat(string_.substring(comma + 1, nextComma - comma + 2));\n        const z = Number.parseFloat(string_.substring(nextComma + 1));\n        return { x, y, z };\n    }\n    else {\n        const y = Number.parseFloat(string_.substring(comma + 1));\n        return { x, y };\n    }\n};\n/**\n * Returns an array of points from an array of numbers.\n *\n * Array can be a continuous series of x, y values:\n * ```\n * [1,2,3,4] would yield: [{x:1, y:2}, {x:3, y:4}]\n * ```\n *\n * Or it can be an array of arrays:\n * ```\n * [[1,2], [3,4]] would yield: [{x:1, y:2}, {x:3, y:4}]\n * ```\n * @param coords\n * @returns\n */\nexport const fromNumbers = (...coords) => {\n    const pts = [];\n    if (Array.isArray(coords[0])) {\n        // [[x,y],[x,y]...]\n        for (const coord of coords) {\n            if (!(coord.length % 2 === 0)) {\n                throw new Error(`coords array should be even-numbered`);\n            }\n            pts.push(Object.freeze({ x: coord[0], y: coord[1] }));\n        }\n    }\n    else {\n        // [x,y,x,y,x,y]\n        if (coords.length % 2 !== 0) {\n            throw new Error(`Expected even number of elements: [x,y,x,y...]`);\n        }\n        for (let index = 0; index < coords.length; index += 2) {\n            pts.push(Object.freeze({ x: coords[index], y: coords[index + 1] }));\n        }\n    }\n    return pts;\n};\n","import { guard } from \"./guard.js\";\n/**\n * Reverses a line.\n * ````js\n * const a = { x: 10, y: 20 };\n * const b = { x: 100, y: 200 };\n * const line = reverse({ a, b });\n * // { a: { x: 100, y: 200 }, b: { x: 10, y: 20 } }\n * ```\n * @param line\n * @returns\n */\nexport function reverse(line) {\n    guard(line, `line`);\n    return { a: line.b, b: line.a };\n}\n","import { numberTest, percentTest, resultThrow } from \"@ixfx/guards\";\nimport { getPointParameter } from \"./get-points-parameter.js\";\nimport { length } from \"./length.js\";\nimport { reverse } from \"./reverse.js\";\n/**\n * Calculates a point in-between a line's start and end points.\n *\n * @param amount Interpolation amount\n * @param aOrLine Line, or first point\n * @param pointBOrAllowOverflow Second point (if needed) or allowOverflow.\n * @param allowOverflow If true, interpolation amount is permitted to exceed 0..1, extending the line.\n * @returns\n */\nexport function interpolate(amount, aOrLine, pointBOrAllowOverflow, allowOverflow) {\n    if (typeof pointBOrAllowOverflow === `boolean`) {\n        allowOverflow = pointBOrAllowOverflow;\n        pointBOrAllowOverflow = undefined;\n    }\n    if (!allowOverflow)\n        resultThrow(percentTest(amount, `amount`));\n    else\n        resultThrow(numberTest(amount, ``, `amount`));\n    const [a, b] = getPointParameter(aOrLine, pointBOrAllowOverflow);\n    const d = length(a, b);\n    const d2 = d * (1 - amount);\n    // Points are identical, return a copy of b\n    if (d === 0 && d2 === 0)\n        return Object.freeze({ ...b });\n    const x = b.x - (d2 * (b.x - a.x) / d);\n    const y = b.y - (d2 * (b.y - a.y) / d);\n    return Object.freeze({\n        ...b,\n        x: x,\n        y: y\n    });\n}\n/**\n * Returns the point along a line from its start (A)\n * @param line Line\n * @param distance Distance\n * @param fromA If _true_ (default) returns from A. Use _false_ to calculate from end\n * @returns\n */\nexport function pointAtDistance(line, distance, fromA = true) {\n    if (!fromA)\n        line = reverse(line);\n    const dx = line.b.x - line.a.x;\n    const dy = line.b.y - line.a.y;\n    const theta = Math.atan2(dy, dx);\n    const xp = distance * Math.cos(theta);\n    const yp = distance * Math.sin(theta);\n    return { x: xp + line.a.x, y: yp + line.a.y };\n}\n","import { interpolate as lineInterpolate } from '../line/interpolate.js';\n/**\n * Returns a relative point between two points.\n *\n * ```js\n * interpolate(0.5, { x:0, y:0 }, { x:10, y:10 }); // Halfway { x, y }\n * ```\n *\n * Alias for Lines.interpolate(amount, a, b);\n *\n * @param amount Relative amount, 0-1\n * @param a\n * @param b\n * @param allowOverflow If true, length of line can be exceeded for `amount` of below 0 and above `1`.\n * @returns {@link Point}\n */\nexport const interpolate = (amount, a, b, allowOverflow = false) => lineInterpolate(amount, a, b, allowOverflow); //({x: (1-amt) * a.x + amt * b.x, y:(1-amt) * a.y + amt * b.y });\n","import { isPoint3d } from \"./guard.js\";\n/**\n * Inverts one or more axis of a point\n * ```js\n * invert({x:10, y:10}); // Yields: {x:-10, y:-10}\n * invert({x:10, y:10}, `x`); // Yields: {x:-10, y:10}\n * ```\n * @param pt Point to invert\n * @param what Which axis. If unspecified, both axies are inverted\n * @returns\n */\nexport const invert = (pt, what = `both`) => {\n    switch (what) {\n        case `both`: {\n            return isPoint3d(pt) ? Object.freeze({\n                ...pt,\n                x: pt.x * -1,\n                y: pt.y * -1,\n                z: pt.z * -1,\n            }) : Object.freeze({\n                ...pt,\n                x: pt.x * -1,\n                y: pt.y * -1,\n            });\n        }\n        case `x`: {\n            return Object.freeze({\n                ...pt,\n                x: pt.x * -1,\n            });\n        }\n        case `y`: {\n            return Object.freeze({\n                ...pt,\n                y: pt.y * -1,\n            });\n        }\n        case `z`: {\n            if (isPoint3d(pt)) {\n                return Object.freeze({\n                    ...pt,\n                    z: pt.z * -1,\n                });\n            }\n            else\n                throw new Error(`pt parameter is missing z`);\n        }\n        default: {\n            throw new Error(`Unknown what parameter. Expecting 'both', 'x' or 'y'`);\n        }\n    }\n};\n","import { getTwoPointParameters } from \"./get-point-parameter.js\";\nimport { guard, isPoint3d } from \"./guard.js\";\n/**\n * Returns a Point with the x,y,z values of two points multiply (a/b).\n *\n * `z` parameter is used, if present. Uses a default value of 0 for 'z' when multiplying a 2D point with a 3D one.\n *\n * Examples:\n *\n * ```js\n * multiply(ptA, ptB);\n * multiply(x1, y1, x2, y2);\n * multiply(ptA, x2, y2);\n * ```\n */\nexport function multiply(a1, ab2, ab3, ab4, ab5, ab6) {\n    const [ptA, ptB] = getTwoPointParameters(a1, ab2, ab3, ab4, ab5, ab6);\n    guard(ptA, `a`);\n    guard(ptB, `b`);\n    const pt = {\n        x: ptA.x * ptB.x,\n        y: ptA.y * ptB.y,\n    };\n    if (isPoint3d(ptA) || isPoint3d(ptB)) {\n        pt.z = (ptA.z ?? 0) * (ptB.z ?? 0);\n    }\n    ;\n    return Object.freeze(pt);\n}\n;\n/**\n * Multiplies all components by `v`.\n * Existing properties of `pt` are maintained.\n *\n * ```js\n * multiplyScalar({ x:2, y:4 }, 2);\n * // Yields: { x:4, y:8 }\n * ```\n * @param pt Point\n * @param v Value to multiply by\n * @returns\n */\nexport const multiplyScalar = (pt, v) => {\n    return isPoint3d(pt) ? Object.freeze({\n        ...pt,\n        x: pt.x * v,\n        y: pt.y * v,\n        z: pt.z * v,\n    }) : Object.freeze({\n        ...pt,\n        x: pt.x * v,\n        y: pt.y * v,\n    });\n};\n","import { distance } from \"./distance.js\";\nimport { multiply } from \"./multiply.js\";\n/**\n * Clamps the magnitude of a point.\n * This is useful when using a Point as a vector, to limit forces.\n * @param pt\n * @param max Maximum magnitude (1 by default)\n * @param min Minimum magnitude (0 by default)\n * @returns\n */\nexport const clampMagnitude = (pt, max = 1, min = 0) => {\n    const length = distance(pt);\n    let ratio = 1;\n    if (length > max) {\n        ratio = max / length;\n    }\n    else if (length < min) {\n        ratio = min / length;\n    }\n    return ratio === 1 ? pt : multiply(pt, ratio, ratio);\n};\n","import { findMinimum } from \"./find-minimum.js\";\n/**\n * Returns the left-most of the provided points.\n *\n * Same as:\n * ```js\n * findMinimum((a, b) => {\n *  if (a.x <= b.x) return a;\n *  return b;\n *}, ...points)\n * ```\n *\n * @param points\n * @returns\n */\nexport const leftmost = (...points) => findMinimum((a, b) => (a.x <= b.x ? a : b), ...points);\n/**\n * Returns the right-most of the provided points.\n *\n * Same as:\n * ```js\n * findMinimum((a, b) => {\n *  if (a.x >= b.x) return a;\n *  return b;\n *}, ...points)\n * ```\n *\n * @param points\n * @returns\n */\nexport const rightmost = (...points) => findMinimum((a, b) => (a.x >= b.x ? a : b), ...points);\n","import { Empty } from \"./empty.js\";\nimport { getPointParameter } from \"./get-point-parameter.js\";\nimport { isPoint } from \"./guard.js\";\nconst length = (ptOrX, y) => {\n    if (isPoint(ptOrX)) {\n        y = ptOrX.y;\n        ptOrX = ptOrX.x;\n    }\n    if (y === undefined)\n        throw new Error(`Expected y`);\n    return Math.hypot(ptOrX, y);\n};\n/**\n * Normalise point as a unit vector.\n *\n * ```js\n * normalise({x:10, y:20});\n * normalise(10, 20);\n * ```\n * @param ptOrX Point, or x value\n * @param y y value if first param is x\n * @returns\n */\nexport const normalise = (ptOrX, y) => {\n    const pt = getPointParameter(ptOrX, y);\n    const l = length(pt);\n    if (l === 0)\n        return Empty;\n    return Object.freeze({\n        ...pt,\n        x: pt.x / l,\n        y: pt.y / l,\n    });\n};\n","import { numberTest, resultThrow } from \"@ixfx/guards\";\nimport { isRect } from \"../rect/guard.js\";\nimport { isPoint } from \"./guard.js\";\n/**\n * Normalises a point so it is on a 0..1 scale\n *\n * ```js\n * normaliseByRect({ x: 10, y: 10, width: 20, height: 40 });\n * normaliseByRect({ x: 10, y: 10 }, 20, 40);\n * normaliseByRect(10, 10, 20, 40);\n * ```\n * @param a Point, or x\n * @param b y coord or width\n * @param c height or width\n * @param d height\n * @returns Point\n */\nexport function normaliseByRect(a, b, c, d) {\n    if (isPoint(a)) {\n        if (typeof b === `number` && c !== undefined) {\n            resultThrow(numberTest(b, `positive`, `width`), numberTest(c, `positive`, `height`));\n        }\n        else {\n            if (!isRect(b)) {\n                throw new Error(`Expected second parameter to be a rect`);\n            }\n            c = b.height;\n            b = b.width;\n        }\n        return Object.freeze({\n            x: a.x / b,\n            y: a.y / c,\n        });\n    }\n    else {\n        resultThrow(numberTest(a, `positive`, `x`));\n        if (typeof b !== `number`) {\n            throw new TypeError(`Expecting second parameter to be a number (width)`);\n        }\n        if (typeof c !== `number`) {\n            throw new TypeError(`Expecting third parameter to be a number (height)`);\n        }\n        resultThrow(numberTest(b, `positive`, `y`));\n        resultThrow(numberTest(c, `positive`, `width`));\n        if (d === undefined)\n            throw new Error(`Expected height parameter`);\n        resultThrow(numberTest(d, `positive`, `height`));\n        return Object.freeze({\n            x: a / c,\n            y: b / d,\n        });\n    }\n}\n","/**\n * Runs a sequential series of functions on `pt`. The output from one feeding into the next.\n *\n * ```js\n * const p = Points.pipelineApply(somePoint, Points.normalise, Points.invert);\n * ```\n *\n * If you want to make a reusable pipeline of functions, consider {@link pipeline} instead.\n * @param point\n * @param pipelineFns\n * @returns\n */\nexport const pipelineApply = (point, ...pipelineFns) => pipeline(...pipelineFns)(point); // pipeline.reduce((prev, curr) => curr(prev), pt);\n/**\n * Returns a pipeline function that takes a point to be transformed through a series of functions\n * ```js\n * // Create pipeline\n * const p = Points.pipeline(Points.normalise, Points.invert);\n *\n * // Now run it on `somePoint`.\n * // First we normalised, and then invert\n * const changedPoint = p(somePoint);\n * ```\n *\n * If you don't want to create a pipeline, use {@link pipelineApply}.\n * @param pipeline Pipeline of functions\n * @returns\n */\nexport const pipeline = (...pipeline) => (pt) => pipeline.reduce((previous, current) => current(previous), pt);\n","/**\n * Returns true if `p` seems to be a {@link Polar.Coord} (ie has both distance & angleRadian fields)\n * @param p\n * @returns True if `p` seems to be a PolarCoord\n */\nexport const isPolarCoord = (p) => {\n    if (p.distance === undefined)\n        return false;\n    if (p.angleRadian === undefined)\n        return false;\n    return true;\n};\n/**\n * Throws an error if Coord is invalid\n * @param p\n * @param name\n */\nexport const guard = (p, name = `Point`) => {\n    if (p === undefined) {\n        throw new Error(`'${name}' is undefined. Expected {distance, angleRadian} got ${JSON.stringify(p)}`);\n    }\n    if (p === null) {\n        throw new Error(`'${name}' is null. Expected {distance, angleRadian} got ${JSON.stringify(p)}`);\n    }\n    if (p.angleRadian === undefined) {\n        throw new Error(`'${name}.angleRadian' is undefined. Expected {distance, angleRadian} got ${JSON.stringify(p)}`);\n    }\n    if (p.distance === undefined) {\n        throw new Error(`'${name}.distance' is undefined. Expected {distance, angleRadian} got ${JSON.stringify(p)}`);\n    }\n    if (typeof p.angleRadian !== `number`) {\n        throw new TypeError(`'${name}.angleRadian' must be a number. Got ${p.angleRadian}`);\n    }\n    if (typeof p.distance !== `number`) {\n        throw new TypeError(`'${name}.distance' must be a number. Got ${p.distance}`);\n    }\n    if (p.angleRadian === null)\n        throw new Error(`'${name}.angleRadian' is null`);\n    if (p.distance === null)\n        throw new Error(`'${name}.distance' is null`);\n    if (Number.isNaN(p.angleRadian)) {\n        throw new TypeError(`'${name}.angleRadian' is NaN`);\n    }\n    if (Number.isNaN(p.distance))\n        throw new Error(`'${name}.distance' is NaN`);\n};\n","import { piPi } from './pi.js';\nexport function degreeToRadian(angleInDegrees) {\n    return Array.isArray(angleInDegrees) ? angleInDegrees.map(v => v * (Math.PI / 180)) : angleInDegrees * (Math.PI / 180);\n}\n/**\n * Inverts the angle so it points in the opposite direction of a unit circle\n * @param angleInRadians\n * @returns\n */\nexport function radianInvert(angleInRadians) {\n    return (angleInRadians + Math.PI) % (2 * Math.PI);\n}\nexport function degreeToGradian(angleInDegrees) {\n    return angleInDegrees * 1.111111;\n}\n/**\n * Returns the gradian value converted to degrees.\n * By default it wraps, so any value 360 or greater wraps around.\n * @param angleInGradians\n * @param wrap\n * @returns\n */\nexport function gradianToDegree(angleInGradians, wrap = true) {\n    if (wrap)\n        return (angleInGradians * 0.9) % 360;\n    return angleInGradians * 0.9;\n}\nexport function radianToGradian(angleInRadians) {\n    return angleInRadians * 63.6619772368; // 200/pi\n}\nexport function gradianToRadian(angleInGradian) {\n    return angleInGradian * 0.0157079633; // pi/200\n}\nexport function radianToDegree(angleInRadians) {\n    return Array.isArray(angleInRadians) ? angleInRadians.map(v => v * 180 / Math.PI) : angleInRadians * 180 / Math.PI;\n}\n/**\n * Angle from x-axis to point (ie. `Math.atan2`)\n * @param point\n * @returns\n */\nexport const radiansFromAxisX = (point) => Math.atan2(point.x, point.y);\n/**\n * Sum angles together, accounting for the 'wrap around'.\n *\n * `clockwise` of _true_ (default) means angles are added in clockwise direction\n *\n * ```js\n * // From 180deg, add 90deg in the clockwise direction\n * radiansSum(Math.PI, Math.PI/2, true);\n * ```\n *\n * Orientation of angles is as follows:\n * ```\n *       90deg\n *       Pi/2\n *        |\n * Pi  ---+--- 0\n * 180    |\n *       3PI/2\n *       270deg\n * ```\n * {@link degreesSum} is the same, but uses degrees (0..360)\n * @param start Starting angle, in radian\n * @param amount Angle to add, in radian\n * @param clockwise Add in clockwise direction (default: _true_)\n * @returns Sum result, in radians\n */\nexport const radiansSum = (start, amount, clockwise = true) => {\n    if (clockwise) {\n        let x = start + amount;\n        if (x >= piPi)\n            x = x % piPi;\n        return x;\n    }\n    else {\n        const x = start - amount;\n        if (x < 0) {\n            return piPi + x;\n        }\n        return x;\n    }\n};\n/**\n * Sum angles together, accounting for the 'wrap around'.\n *\n * `clockwise` of _true_ (default) means angles are added in clockwise direction\n *\n * ```js\n * // From 180deg, add 90deg in the clockwise direction\n * radiansSum(180, 90, true);\n * ```\n *\n * {@link radiansSum} is the same, but uses radians (0..2 Pi)\n *\n * Orientation of angles is as follows:\n * ```\n *       90\n *        |\n * 180 ---+--- 0\n *        |\n *       270\n * ```\n * @param start Starting angle, in degrees\n * @param amount Angle to add, in degrees\n * @param clockwise Add in clockwise direction (default: _true_)\n * @returns Sum result, in degrees\n */\nexport const degreesSum = (start, amount, clockwise = true) => radianToDegree(radiansSum(degreeToRadian(start), degreeToRadian(amount), clockwise));\n/**\n * Computes the angle arc between a start and end angle,\n * given in radians. It properly accounts for the wrap-around\n * values.\n *\n * ```js\n * // Between 0-90deg in clockwise direction\n * radianArc(0, Math.PI/2, true); // Yields: 3Pi/2 (270 deg)\n *\n * // In counter-clockwise direction\n * radianArc(0, Math.PI/2, false); // Yields: Math.PI/2 (90deg)\n * ```\n *\n * See {@link degreeArc} to operate in degrees.\n *\n * Orientation of angles is as follows:\n * ```\n *       90deg\n *       Pi/2\n *        |\n * Pi  ---+--- 0\n * 180    |\n *       3PI/2\n *       270deg\n * ```\n * @param start Start angle, in radians\n * @param end End angle, in radians\n * @param clockwise Calculate in clockwise direction (default: _true_)\n * @returns Angle of arc, in radians.\n */\nexport const radianArc = (start, end, clockwise = true) => {\n    let s = start;\n    if (end < s) {\n        s = 0;\n        end = piPi - start + end;\n    }\n    let d = end - s;\n    if (clockwise)\n        d = piPi - d;\n    if (d >= piPi)\n        return d % piPi;\n    return d;\n};\n/**\n * Computes the angle arc between a start and end angle,\n * given in degrees. It properly accounts for the wrap-around\n * values.\n *\n * ```js\n * // Between 0-90 in clockwise direction\n * degreeArc(0, 90, true); // Yields: 270\n *\n * // In counter-clockwise direction\n * degreeArc(0, 90, false); // Yields: 90\n * ```\n *\n * See {@link radianArc} to operate in radians.\n *\n * Orientation of angles is as follows:\n * ```\n *       90\n *        |\n * 180 ---+--- 0\n *        |\n *       270\n * ```\n * @param start Start angle, in degrees\n * @param end End angle, in degrees\n * @param clockwise Calculate in clockwise direction (default: _true_)\n * @returns Angle of arc, in degrees.\n */\nexport const degreeArc = (start, end, clockwise = true) => radianToDegree(radianArc(degreeToRadian(start), degreeToRadian(end), clockwise));\n/**\n * Parses CSS-style angle strings. By default assumes degrees.\n *\n * ```js\n * angleParse(`100`);     // { value: 100, unit: `deg` }\n * angleParse(100);       // { value: 100, unit: `deg` }\n * angleParse(`100deg`);   // { value: 100, unit: `deg` }\n *\n * // More exotic units:\n * angleParse(`100rad`);  // { value: 100, unit: `rad` }\n * angleParse(`100turn`); // { value: 100, unit: `turn` }\n * angleParse(`100grad`); // { value: 100, unit: `grad` }\n * ```\n *\n * Once parsed in this format, use {@link angleConvert} to convert to\n * a different unit.\n * @param value\n * @returns\n */\nexport const angleParse = (value) => {\n    if (isAngle(value))\n        return value;\n    if (typeof value === `number`) {\n        return {\n            value, unit: `deg`\n        };\n    }\n    value = value.toLowerCase();\n    let unit = `deg`;\n    let numberValue = Number.NaN;\n    if (value.endsWith(`grad`)) {\n        numberValue = Number.parseFloat(value.substring(0, value.length - 4));\n        unit = `grad`;\n    }\n    else if (value.endsWith(`rad`)) {\n        numberValue = Number.parseFloat(value.substring(0, value.length - 3));\n        unit = `rad`;\n    }\n    else if (value.endsWith(`turn`)) {\n        numberValue = Number.parseFloat(value.substring(0, value.length - 4));\n        unit = `turn`;\n    }\n    else if (value.endsWith(`deg`)) {\n        numberValue = Number.parseFloat(value.substring(0, value.length - 3));\n        unit = `deg`;\n    }\n    else {\n        numberValue = Number.parseFloat(value);\n    }\n    if (Number.isNaN(numberValue))\n        throw new Error(`Invalid angle (bad value?)`);\n    if (unit.length === 0)\n        throw new Error(`Invalid angle (no unit)`);\n    return {\n        value: numberValue,\n        unit: unit\n    };\n};\nconst isAngle = (v) => {\n    if (typeof v !== `object`)\n        return false;\n    if (`unit` in v && `value` in v) {\n        if (typeof v.unit !== `string`)\n            return false;\n        if (typeof v.value !== `number`)\n            return false;\n        return true;\n    }\n    return false;\n};\n/**\n * Converts an angle to another representation.\n * Input value is assumed degrees unless it's an {@link Angle} type of has the unit.\n *\n * These are all identical inputs: 100, `100`, `100deg`\n * ```js\n * angleConvert(100, `rad`); // Converts 100deg to radians\n * ```\n *\n * Other units can be used for string input: `2turn`, `1grad`, `2rad`.\n * ```js\n * angleConvert(`2rad`, `deg`); // Converts 2radians to degrees\n * ```\n *\n * Can also use an object input:\n * ```js\n * angleConvert({ value: 10, unit: `deg`}, `rad`);\n * ```\n * @param angleOrDegrees\n * @param destination\n * @returns\n */\nexport const angleConvert = (angleOrDegrees, destination) => {\n    const angle = typeof angleOrDegrees === `object` ? angleOrDegrees : angleParse(angleOrDegrees);\n    switch (destination) {\n        case `deg`:\n            if (angle.unit === `deg`)\n                return angle;\n            if (angle.unit === `rad`)\n                return { value: radianToDegree(angle.value), unit: `deg` };\n            if (angle.unit === `grad`)\n                return { value: gradianToDegree(angle.value), unit: `deg` };\n            if (angle.unit === `turn`)\n                return { value: turnToDegree(angle.value), unit: `deg` };\n            throw new Error(`Unknown unit: ${angle.unit}`);\n        case `grad`:\n            if (angle.unit === `deg`)\n                return { value: degreeToGradian(angle.value), unit: `grad` };\n            if (angle.unit === `rad`)\n                return { value: radianToGradian(angle.value), unit: `grad` };\n            if (angle.unit === `grad`)\n                return angle;\n            if (angle.unit === `turn`)\n                return { value: radianToGradian(turnToRadian(angle.value)), unit: `grad` };\n            throw new Error(`Unknown unit: ${angle.unit}`);\n        case `rad`:\n            if (angle.unit === `deg`)\n                return { value: degreeToRadian(angle.value), unit: `rad` };\n            if (angle.unit === `rad`)\n                return angle;\n            if (angle.unit === `grad`)\n                return { value: gradianToRadian(angle.value), unit: `rad` };\n            if (angle.unit === `turn`)\n                return { value: radianToGradian(turnToRadian(angle.value)), unit: `grad` };\n            throw new Error(`Unknown unit: ${angle.unit}`);\n        case `turn`:\n            if (angle.unit === `deg`)\n                return { value: degreeToTurn(angle.value), unit: `turn` };\n            if (angle.unit === `rad`)\n                return { value: radianToTurn(angle.value), unit: `turn` };\n            if (angle.unit === `grad`)\n                return { value: radianToTurn(gradianToRadian(angle.value)), unit: `turn` };\n            if (angle.unit === `turn`)\n                return angle;\n            throw new Error(`Unknown unit: ${angle.unit}`);\n        default:\n            throw new Error(`Destination unit unknown ('${destination}). Expects: deg, grad, rad or turn`);\n    }\n};\n/**\n * Converts 'turns' to degrees. By defaults wraps the value, so\n * turn value of 1 or 2 equal 0deg instead of 360 or 720deg.\n * @param turns\n * @param wrap\n * @returns\n */\nexport const turnToDegree = (turns, wrap = true) => {\n    if (wrap)\n        return (turns * 360) % 360;\n    return turns * 360;\n};\nexport const turnToRadian = (turns) => turns * piPi;\nexport const degreeToTurn = (degrees) => degrees / 360;\nexport const radianToTurn = (radians) => radians / piPi;\n","import { guard } from \"./guard.js\";\nimport { degreeToRadian } from '../angles.js';\n/**\n * Returns a rotated coordinate\n * @param c Coordinate\n * @param amountRadian Amount to rotate, in radians\n * @returns\n */\nexport const rotate = (c, amountRadian) => Object.freeze({\n    ...c,\n    angleRadian: c.angleRadian + amountRadian,\n});\n/**\n * Inverts the direction of coordinate. Ie if pointing north, will point south.\n * @param p\n * @returns\n */\nexport const invert = (p) => {\n    guard(p, `c`);\n    return Object.freeze({\n        ...p,\n        angleRadian: p.angleRadian - Math.PI,\n    });\n};\n/**\n * Returns true if PolarCoords have same magnitude but opposite direction\n * @param a\n * @param b\n * @returns\n */\nexport const isOpposite = (a, b) => {\n    guard(a, `a`);\n    guard(b, `b`);\n    if (a.distance !== b.distance)\n        return false;\n    return a.angleRadian === -b.angleRadian;\n};\n/**\n * Returns true if Coords have the same direction, regardless of magnitude\n * @param a\n * @param b\n * @returns\n */\nexport const isParallel = (a, b) => {\n    guard(a, `a`);\n    guard(b, `b`);\n    return a.angleRadian === b.angleRadian;\n};\n/**\n * Returns true if coords are opposite direction, regardless of magnitude\n * @param a\n * @param b\n * @returns\n */\nexport const isAntiParallel = (a, b) => {\n    guard(a, `a`);\n    guard(b, `b`);\n    return a.angleRadian === -b.angleRadian;\n};\n/**\n * Returns a rotated coordinate\n * @param c Coordinate\n * @param amountDeg Amount to rotate, in degrees\n * @returns\n */\nexport const rotateDegrees = (c, amountDeg) => Object.freeze({\n    ...c,\n    angleRadian: c.angleRadian + degreeToRadian(amountDeg),\n});\n","import { guard, isPolarCoord } from \"./guard.js\";\nimport { subtract as subtractPoint } from \"../point/subtract.js\";\nimport { guard as guardPoint } from \"../point/guard.js\";\nimport { Empty as EmptyPoint } from '../point/empty.js';\nimport { isPoint } from \"../point/guard.js\";\nimport { radianToDegree } from \"../angles.js\";\n/**\n * Converts a polar coordinate to a Line.\n *\n * ```js\n * const line = toLine({ angleRadian: Math.Pi, distance: 0.5 }, { x: 0.2, y: 0.1 });\n * // Yields { a: { x, y}, b: { x, y } }\n * ```\n *\n * The 'start' parameter is taken to be the origin of the Polar coordinate.\n * @param c\n * @param start\n * @returns\n */\nexport const toLine = (c, start) => {\n    const b = toCartesian(c, start);\n    return { a: start, b };\n};\n/**\n * Converts to Cartesian coordinate from polar.\n *\n * ```js\n *\n * const origin = { x: 50, y: 50}; // Polar origin\n * // Yields: { x, y }\n * const polar = Polar.toCartesian({ distance: 10, angleRadian: 0 }, origin);\n * ```\n *\n * Distance and angle can be provided as numbers intead:\n *\n * ```\n * // Yields: { x, y }\n * const polar = Polar.toCartesian(10, 0, origin);\n * ```\n *\n * @param a\n * @param b\n * @param c\n * @returns\n */\nexport const toCartesian = (a, b, c) => {\n    if (isPolarCoord(a)) {\n        if (typeof b === `undefined`)\n            b = EmptyPoint;\n        if (isPoint(b)) {\n            return polarToCartesian(a.distance, a.angleRadian, b);\n        }\n        throw new Error(`Expecting (Coord, Point). Second parameter is not a point`);\n    }\n    else if (typeof a === `object`) {\n        throw new TypeError(`First param is an object, but not a Coord: ${JSON.stringify(a)}`);\n    }\n    else {\n        if (typeof a === `number` && typeof b === `number`) {\n            if (typeof c === `undefined`)\n                c = EmptyPoint;\n            if (!isPoint(c)) {\n                throw new Error(`Expecting (number, number, Point). Point param wrong type`);\n            }\n            return polarToCartesian(a, b, c);\n        }\n        else {\n            throw new TypeError(`Expecting parameters of (number, number). Got: (${typeof a}, ${typeof b}, ${typeof c}). a: ${JSON.stringify(a)}`);\n        }\n    }\n};\n/**\n * Converts a Cartesian coordinate to polar\n *\n * ```js\n *\n * // Yields: { angleRadian, distance }\n * const polar = Polar.fromCartesian({x: 50, y: 50}, origin);\n * ```\n *\n * Any additional properties of `point` are copied to object.\n * @param point Point\n * @param origin Origin\n * @returns\n */\nexport const fromCartesian = (point, origin) => {\n    if (typeof point === `undefined`)\n        throw new Error(`Param 'point' missing. Expecting a Point`);\n    if (typeof origin === `undefined`)\n        throw new Error(`Param 'origin' missing. Expecting a Point`);\n    point = subtractPoint(point, origin);\n    const angle = Math.atan2(point.y, point.x);\n    const distance = Math.hypot(point.x, point.y);\n    const polar = {\n        ...point,\n        angleRadian: angle,\n        distance,\n    };\n    delete polar.x;\n    delete polar.y;\n    return Object.freeze(polar);\n};\n/**\n * Converts a polar coordinate to Cartesian\n * @param distance Distance\n * @param angleRadians Angle in radians\n * @param origin Origin, or 0,0 by default.\n * @returns\n */\nconst polarToCartesian = (distance, angleRadians, origin = EmptyPoint) => {\n    guardPoint(origin);\n    return Object.freeze({\n        x: origin.x + distance * Math.cos(angleRadians),\n        y: origin.y + distance * Math.sin(angleRadians),\n    });\n};\n/**\n * Returns a human-friendly string representation `(distance, angleDeg)`.\n * If `precision` is supplied, this will be the number of significant digits.\n * @param p\n * @returns\n */\nexport const toString = (p, digits) => {\n    if (p === undefined)\n        return `(undefined)`;\n    if (p === null)\n        return `(null)`;\n    const angleDeg = radianToDegree(p.angleRadian);\n    const d = digits ? p.distance.toFixed(digits) : p.distance;\n    const a = digits ? angleDeg.toFixed(digits) : angleDeg;\n    return `(${d},${a})`;\n};\nexport const toPoint = (v, origin = EmptyPoint) => {\n    guard(v, `v`);\n    return Object.freeze({\n        x: origin.x + v.distance * Math.cos(v.angleRadian),\n        y: origin.y + v.distance * Math.sin(v.angleRadian),\n    });\n};\n","import { guard } from \"./guard.js\";\nimport { numberTest, resultThrow } from \"@ixfx/guards\";\nexport const normalise = (c) => {\n    //guard(v, `v`);\n    if (c.distance === 0)\n        throw new Error(`Cannot normalise vector of length 0`);\n    return Object.freeze({\n        ...c,\n        distance: 1,\n    });\n};\n/**\n * Clamps the magnitude of a vector\n * @param v\n * @param max\n * @param min\n * @returns\n */\nexport const clampMagnitude = (v, max = 1, min = 0) => {\n    let mag = v.distance;\n    if (mag > max)\n        mag = max;\n    if (mag < min)\n        mag = min;\n    return Object.freeze({\n        ...v,\n        distance: mag,\n    });\n};\n/**\n * Calculate dot product of two PolarCoords.\n *\n * Eg, power is the dot product of force and velocity\n *\n * Dot products are also useful for comparing similarity of\n *  angle between two unit PolarCoords.\n * @param a\n * @param b\n * @returns\n */\nexport const dotProduct = (a, b) => {\n    guard(a, `a`);\n    guard(b, `b`);\n    return a.distance * b.distance * Math.cos(b.angleRadian - a.angleRadian);\n};\n/**\n * Multiplies the magnitude of a coord by `amt`.\n * Direction is unchanged.\n * @param v\n * @param amt\n * @returns\n */\nexport const multiply = (v, amt) => {\n    guard(v);\n    resultThrow(numberTest(amt, ``, `amt`));\n    return Object.freeze({\n        ...v,\n        distance: v.distance * amt,\n    });\n};\n/**\n * Divides the magnitude of a coord by `amt`.\n * Direction is unchanged.\n * @param v\n * @param amt\n * @returns\n */\nexport const divide = (v, amt) => {\n    guard(v);\n    resultThrow(numberTest(amt, ``, `amt`));\n    return Object.freeze({\n        ...v,\n        distance: v.distance / amt,\n    });\n};\n","import { guard } from \"./guard.js\";\n/**\n * Returns a point with rounded x,y coordinates. By default uses `Math.round` to round.\n * ```js\n * toIntegerValues({x:1.234, y:5.567}); // Yields: {x:1, y:6}\n * ```\n *\n * ```js\n * toIntegerValues(pt, Math.ceil); // Use Math.ceil to round x,y of `pt`.\n * ```\n * @param pt Point to round\n * @param rounder Rounding function, or Math.round by default\n * @returns\n */\nexport const toIntegerValues = (pt, rounder = Math.round) => {\n    guard(pt, `pt`);\n    return Object.freeze({\n        x: rounder(pt.x),\n        y: rounder(pt.y),\n    });\n};\n/**\n * Returns a copy of `pt` with `z` field omitted.\n * If it didn't have one to begin within, a copy is still returned.\n * @param pt\n * @returns\n */\nexport const to2d = (pt) => {\n    guard(pt, `pt`);\n    let copy = {\n        ...pt\n    };\n    delete copy.z;\n    return Object.freeze(copy);\n};\n/**\n * Returns a copy of `pt` with a `z` field set.\n * Defaults to a z value of 0.\n * @param pt Point\n * @param z Z-value, defaults to 0\n * @returns\n */\nexport const to3d = (pt, z = 0) => {\n    guard(pt, `pt`);\n    return Object.freeze({\n        ...pt,\n        z\n    });\n};\n/**\n * Returns a human-friendly string representation `(x, y)`.\n * If `precision` is supplied, this will be the number of significant digits.\n * @param p\n * @returns\n */\nexport function toString(p, digits) {\n    if (p === undefined)\n        return `(undefined)`;\n    if (p === null)\n        return `(null)`;\n    guard(p, `pt`);\n    const x = digits ? p.x.toFixed(digits) : p.x;\n    const y = digits ? p.y.toFixed(digits) : p.y;\n    if (p.z === undefined) {\n        return `(${x},${y})`;\n    }\n    else {\n        const z = digits ? p.z.toFixed(digits) : p.z;\n        return `(${x},${y},${z})`;\n    }\n}\n","import {} from \"../line/line-type.js\";\nimport {} from '../point/point-type.js';\nimport { distance } from '../point/distance.js';\nimport { angleRadian } from '../point/angle.js';\nimport { toString as pointToString } from '../point/To.js';\nimport {} from \"./types.js\";\nimport { toCartesian as polarToCartesian } from \"./conversions.js\";\n/**\n * Converts a ray to a Line in cartesian coordinates.\n *\n * By default, the ray's origin is taken to be 0,0.\n * Passing in an origin will override this default, or whatever\n * the ray's origin property is.\n * @param ray Ray\n * @param origin Override or provide origin point\n * @returns\n */\nexport const toCartesian = (ray, origin) => {\n    const o = getOrigin(ray, origin);\n    const a = polarToCartesian(ray.offset, ray.angleRadian, o);\n    const b = polarToCartesian(ray.offset + ray.length, ray.angleRadian, o);\n    return { a, b };\n};\nconst getOrigin = (ray, origin) => {\n    if (origin !== undefined)\n        return origin;\n    if (ray.origin !== undefined)\n        return ray.origin;\n    return { x: 0, y: 0 };\n};\n/**\n * Returns a copy of `ray` ensuring it has an origin.\n * If the `origin` parameter is provided, it will override the existing origin.\n * If no origin information is available, 0,0 is used.\n * @param ray\n * @param origin\n * @returns\n */\n// const withOrigin = (ray: PolarRay, origin?: Point): PolarRayWithOrigin => {\n//   if (origin) {\n//     return {\n//       ...ray,\n//       origin\n//     };\n//   }\n//   if (ray.origin !== undefined) return { ...ray } as PolarRayWithOrigin;\n//   return {\n//     ...ray,\n//     origin: { x: 0, y: 0 }\n//   }\n// }\n// function getAngle(a: Point, b: Point) {\n//   const angle = Math.atan2(b.y - a.y, b.x - a.x);// * (180 / Math.PI) + 90;\n//   return angle;//return (angle < 0) ? scale(angle, -90, 0, 0, piPi) : angle;\n// }\n/**\n * Returns a string representation of the ray, useful for debugging.\n *\n * ```\n * \"PolarRay(angle: ... offset: ... len: ... origin: ...)\"\n * ```\n * @param ray\n * @returns\n */\nexport const toString = (ray) => {\n    let basic = `PolarRay(angle: ${ray.angleRadian} offset: ${ray.offset} len: ${ray.length}`;\n    if (ray.origin) {\n        basic += ` origin: ${pointToString(ray.origin)}`;\n    }\n    basic += `)`;\n    return basic;\n};\n/**\n * Returns a PolarRay based on a line and origin.\n *\n * If `origin` is omitted, the origin is taken to be the 'a' point of the line.\n * Otherwise, the origin value is used to determine the 'offset' of the ray.\n * @param line\n * @param origin\n * @returns\n */\nexport const fromLine = (line, origin) => {\n    const o = origin ?? line.a;\n    return {\n        angleRadian: angleRadian(line.b, o),\n        offset: distance(line.a, o),\n        length: distance(line.b, line.a),\n        origin: o\n    };\n};\n","/**\n * Produces an Archimedean spiral. It's a generator.\n *\n * ```js\n * const s = spiral(0.1, 1);\n * for (const coord of s) {\n *  // Use Polar coord...\n *  if (coord.step === 1000) break; // Stop after 1000 iterations\n * }\n * ```\n *\n * @param smoothness 0.1 pretty rounded, at around 5 it starts breaking down\n * @param zoom At smoothness 0.1, zoom starting at 1 is OK\n */\nexport function* spiral(smoothness, zoom) {\n    let step = 0;\n    while (true) {\n        const a = smoothness * step++;\n        yield {\n            distance: zoom * a,\n            angleRadian: a,\n            step: step,\n        };\n    }\n}\n/**\n * Produces an Archimedian spiral with manual stepping.\n * @param step Step number. Typically 0, 1, 2 ...\n * @param smoothness 0.1 pretty rounded, at around 5 it starts breaking down\n * @param zoom At smoothness 0.1, zoom starting at 1 is OK\n * @returns\n */\nexport const spiralRaw = (step, smoothness, zoom) => {\n    const a = smoothness * step;\n    return Object.freeze({\n        distance: zoom * a,\n        angleRadian: a,\n    });\n};\n","// import { degreeToRadian, radianToDegree } from '../Angles.js';\nexport * from './angles.js';\nexport * from './conversions.js';\nexport * from './guard.js';\nexport * from './math.js';\nexport * as Ray from './ray.js';\nexport * from './spiral.js';\n","import { normalise as PointsNormalise } from './point/normalise.js';\nimport { isPoint } from './point/guard.js';\nimport * as Polar from './polar/index.js';\nimport { divide as PointDivide } from './point/divider.js';\nimport { guard as LinesGuard } from './line/guard.js';\nimport { sum as PointsSum } from './point/sum.js';\nimport { subtract as PointsSubtract } from './point/index.js';\nimport { multiply as PointsMultiply } from './point/multiply.js';\nimport { dotProduct as PointsDotProduct } from './point/dot-product.js';\nimport { toString as PointsToString } from './point/To.js';\nimport { clampMagnitude as PointsClampMagnitude } from './point/magnitude.js';\nimport { distance as PointsDistance } from './point/distance.js';\nimport { Empty as PointEmpty } from './point/empty.js';\nconst EmptyCartesian = Object.freeze({ x: 0, y: 0 });\nconst piPi = Math.PI * 2;\nconst pi = Math.PI;\n// const Q1 = Math.PI / 2;\n// const Q2 = Math.PI;\n// const Q3 = Q1 + Q2;\n// const Q4 = Math.PI * 2;\nexport const fromRadians = (radians) => {\n    return Object.freeze({\n        x: Math.cos(radians),\n        y: Math.sin(radians)\n    });\n};\nexport const toRadians = (point) => {\n    return Math.atan2(point.y, point.x);\n};\n/**\n * Create a vector from a point\n *\n * If `unipolar` normalisation is used, direction will be fixed to 0..2\n * if `bipolar` normalisation is used, direction will be fixed to -...\n * @param pt Point\n * @param angleNormalisation Technique to normalise angle\n * @param origin Origin to calculate vector from or 0,0 if left empty\n * @returns\n */\nexport const fromPointPolar = (pt, angleNormalisation = ``, origin = EmptyCartesian) => {\n    pt = PointsSubtract(pt, origin);\n    let direction = Math.atan2(pt.y, pt.x);\n    if (angleNormalisation === `unipolar` && direction < 0)\n        direction += piPi;\n    else if (angleNormalisation === `bipolar`) {\n        if (direction > pi)\n            direction -= piPi;\n        else if (direction <= -pi)\n            direction += piPi;\n    }\n    return Object.freeze({\n        distance: PointsDistance(pt),\n        angleRadian: direction,\n    });\n};\n/**\n * Returns a Cartesian-coordinate vector from a line a -> b\n * @param line\n * @returns\n */\nexport const fromLineCartesian = (line) => PointsSubtract(line.b, line.a);\n/**\n * Returns a polar-coordinate vector from a line a -> b\n * @param line\n * @returns\n */\nexport const fromLinePolar = (line) => {\n    LinesGuard(line, `line`);\n    const pt = PointsSubtract(line.b, line.a);\n    return fromPointPolar(pt);\n};\nconst isPolar = (v) => {\n    if (Polar.isPolarCoord(v))\n        return true;\n    return false;\n};\nconst isCartesian = (v) => {\n    if (isPoint(v))\n        return true;\n    return false;\n};\n/**\n * Returns the normalised vector (aka unit vector). This is where\n * direction is kept, but magnitude set to 1. This then just\n * suggests direction.\n * @param v\n * @returns\n */\nexport const normalise = (v) => {\n    if (isPolar(v)) {\n        return Polar.normalise(v);\n    }\n    else if (isCartesian(v)) {\n        return PointsNormalise(v);\n    }\n    throw new Error(`Expected polar/cartesian vector. Got: ${v}`);\n};\nexport const quadrantOffsetAngle = (p) => {\n    if (p.x >= 0 && p.y >= 0)\n        return 0; // Q1\n    if (p.x < 0 && p.y >= 0)\n        return pi; // Q2\n    if (p.x < 0 && p.y < 0)\n        return pi; // Q3\n    return piPi; // Q4\n};\n/**\n * Converts a vector to a polar coordinate. If the provided\n * value is already Polar, it is returned.\n * @param v\n * @param origin\n * @returns Polar vector\n */\nexport const toPolar = (v, origin = PointEmpty) => {\n    if (isPolar(v)) {\n        return v;\n    }\n    else if (isCartesian(v)) {\n        return Polar.fromCartesian(v, origin);\n    }\n    throw new Error(`Expected polar/cartesian vector. Got: ${v}`);\n};\n/**\n * Converts a Vector to a Cartesian coordinate. If the provided\n * value is already Cartesian, it is returned.\n * @param v\n * @returns Cartestian vector\n */\nexport const toCartesian = (v) => {\n    if (isPolar(v)) {\n        return Polar.toPoint(v);\n    }\n    else if (isCartesian(v)) {\n        return v;\n    }\n    throw new Error(`Expected polar/cartesian vector. Got: ${v}`);\n};\n/**\n * Return a human-friendly representation of vector\n * @param v\n * @param digits\n * @returns\n */\nexport const toString = (v, digits) => {\n    if (isPolar(v)) {\n        return Polar.toString(v, digits);\n    }\n    else if (isCartesian(v)) {\n        return PointsToString(v, digits);\n    }\n    throw new Error(`Expected polar/cartesian vector. Got: ${v}`);\n};\n/**\n * Calculate dot product of a vector\n * @param a\n * @param b\n * @returns\n */\nexport const dotProduct = (a, b) => {\n    if (isPolar(a) && isPolar(b)) {\n        return Polar.dotProduct(a, b);\n    }\n    else if (isCartesian(a) && isCartesian(b)) {\n        return PointsDotProduct(a, b);\n    }\n    throw new Error(`Expected two polar/Cartesian vectors.`);\n};\n/**\n * Clamps the magnitude of a vector\n * @param v Vector to clamp\n * @param max Maximum magnitude\n * @param min Minium magnitude\n * @returns\n */\nexport const clampMagnitude = (v, max = 1, min = 0) => {\n    if (isPolar(v)) {\n        return Polar.clampMagnitude(v, max, min);\n    }\n    else if (isCartesian(v)) {\n        return PointsClampMagnitude(v, max, min);\n    }\n    throw new Error(`Expected either polar or Cartesian vector`);\n};\n/**\n * Returns `a + b`.\n *\n * Vector is returned in the same type as `a`.\n * @param a\n * @param b\n * @returns\n */\nexport const sum = (a, b) => {\n    const polar = isPolar(a);\n    a = toCartesian(a);\n    b = toCartesian(b);\n    const c = PointsSum(a, b);\n    return polar ? toPolar(c) : c;\n};\n/**\n * Returns `a - b`.\n *\n * Vector is returned in the same type as `a`\n * @param a\n * @param b\n */\nexport const subtract = (a, b) => {\n    const polar = isPolar(a);\n    a = toCartesian(a);\n    b = toCartesian(b);\n    const c = PointsSubtract(a, b);\n    return polar ? toPolar(c) : c;\n};\n/**\n * Returns `a * b`.\n *\n * Vector is returned in the same type `a`.\n * @param a\n * @param b\n */\nexport const multiply = (a, b) => {\n    const polar = isPolar(a);\n    a = toCartesian(a);\n    b = toCartesian(b);\n    const c = PointsMultiply(a, b);\n    return polar ? toPolar(c) : c;\n};\n/**\n * Returns `a / b`.\n *\n * Vector is returned in the same type `a`.\n * @param a\n * @param b\n */\nexport const divide = (a, b) => {\n    const polar = isPolar(a);\n    a = toCartesian(a);\n    b = toCartesian(b);\n    const c = PointDivide(a, b);\n    return polar ? toPolar(c) : c;\n};\n","import { distance as PointsDistance } from \"../point/distance.js\";\nimport { minIndex } from \"@ixfx/numbers\";\n/**\n * Returns the nearest point on `line` closest to `point`.\n *\n * ```js\n * const pt = Lines.nearest(line, {x:10,y:10});\n * ```\n *\n * If an array of lines is provided, it will be the closest point amongst all the lines\n * @param line Line or array of lines\n * @param point\n * @returns Point `{ x, y }`\n */\nexport const nearest = (line, point) => {\n    const n = (line) => {\n        const { a, b } = line;\n        const atob = { x: b.x - a.x, y: b.y - a.y };\n        const atop = { x: point.x - a.x, y: point.y - a.y };\n        const length = atob.x * atob.x + atob.y * atob.y;\n        let dot = atop.x * atob.x + atop.y * atob.y;\n        const t = Math.min(1, Math.max(0, dot / length));\n        dot = (b.x - a.x) * (point.y - a.y) - (b.y - a.y) * (point.x - a.x);\n        return { x: a.x + atob.x * t, y: a.y + atob.y * t };\n    };\n    if (Array.isArray(line)) {\n        const pts = line.map(l => n(l));\n        const dists = pts.map(p => PointsDistance(p, point));\n        return Object.freeze(pts[minIndex(...dists)]);\n    }\n    else {\n        return Object.freeze(n(line));\n    }\n};\n","import { guard } from './guard.js';\nimport { guard as guardPoint } from '../point/guard.js';\nimport { length } from \"./length.js\";\nimport { nearest } from \"./nearest.js\";\n/**\n * Returns the distance of `point` to the nearest point on `line`\n *\n * ```js\n * const distance = Lines.distanceSingleLine(line, pt);\n * ```\n * @param line Line\n * @param point Target point\n * @returns\n */\nexport const distanceSingleLine = (line, point) => {\n    guard(line, `line`);\n    guardPoint(point, `point`);\n    if (length(line) === 0) {\n        // Line is really a point\n        return length(line.a, point);\n    }\n    const near = nearest(line, point);\n    return length(near, point);\n};\n","import { interpolate } from \"./interpolate.js\";\nimport { length } from \"./length.js\";\nconst directionVector = (line) => ({\n    x: line.b.x - line.a.x,\n    y: line.b.y - line.a.y\n});\nconst directionVectorNormalised = (line) => {\n    const l = length(line);\n    const v = directionVector(line);\n    return {\n        x: v.x / l,\n        y: v.y / l\n    };\n};\n/**\n * Returns a parallel line to `line` at `distance`.\n *\n * ```js\n * const l = Lines.parallel(line, 10);\n * ```\n * @param line\n * @param distance\n */\nexport const parallel = (line, distance) => {\n    const dv = directionVector(line);\n    const dvn = directionVectorNormalised(line);\n    const a = {\n        x: line.a.x - dvn.y * distance,\n        y: line.a.y + dvn.x * distance\n    };\n    return {\n        a,\n        b: {\n            x: a.x + dv.x,\n            y: a.y + dv.y\n        }\n    };\n};\n/**\n * Returns a point perpendicular to `line` at a specified `distance`. Use negative\n * distances for the other side of line.\n * ```\n * // Project a point 100 units away from line, at its midpoint.\n * const pt = Lines.perpendicularPoint(line, 100, 0.5);\n * ```\n * @param line Line\n * @param distance Distance from line. Use negatives to flip side\n * @param amount Relative place on line to project point from. 0 projects from A, 0.5 from the middle, 1 from B.\n */\nexport const perpendicularPoint = (line, distance, amount = 0) => {\n    const origin = interpolate(amount, line);\n    const dvn = directionVectorNormalised(line);\n    return {\n        x: origin.x - dvn.y * distance,\n        y: origin.y + dvn.x * distance\n    };\n};\n","import { bbox as PointsBbox } from \"../point/bbox.js\";\n/**\n * Returns a rectangle that encompasses dimension of line\n *\n * ```js\n * const rect = Lines.bbox(line);\n * ```\n */\nexport const bbox = (line) => PointsBbox(line.a, line.b);\n","import { divide as PointDivide } from '../point/divider.js';\n/**\n * Divides both start and end points by given x,y\n * ```js\n * // Line 1,1 -> 10,10\n * const l = Lines.fromNumbers(1,1,10,10);\n * const ll = Lines.divide(l, {x:2, y:4});\n * // Yields: 0.5,0.25 -> 5,2.5\n * ```\n *\n * Dividing by zero will give Infinity for that dimension.\n * @param line\n * @param point\n * @returns\n */\nexport const divide = (line, point) => Object.freeze({\n    ...line,\n    a: PointDivide(line.a, point),\n    b: PointDivide(line.b, point)\n});\n","import { fromPoints } from \"./from-points.js\";\n/**\n * Returns a line from a basis of coordinates (x1, y1, x2, y2)\n *\n * ```js\n * // Line from 0,1 -> 10,15\n * Lines.fromNumbers(0, 1, 10, 15);\n * ```\n * @param x1\n * @param y1\n * @param x2\n * @param y2\n * @returns\n */\nexport const fromNumbers = (x1, y1, x2, y2) => {\n    if (Number.isNaN(x1))\n        throw new Error(`x1 is NaN`);\n    if (Number.isNaN(x2))\n        throw new Error(`x2 is NaN`);\n    if (Number.isNaN(y1))\n        throw new Error(`y1 is NaN`);\n    if (Number.isNaN(y2))\n        throw new Error(`y2 is NaN`);\n    const a = { x: x1, y: y1 };\n    const b = { x: x2, y: y2 };\n    return fromPoints(a, b);\n};\n","import { fromNumbers } from \"./from-numbers.js\";\n/**\n * Returns a line from four numbers [x1,y1,x2,y2].\n *\n * See {@link toFlatArray} to create an array from a line.\n *\n * ```js\n * const line = Lines.fromFlatArray(...[0, 0, 100, 100]);\n * // line is {a: { x:0, y:0 }, b: { x: 100, y: 100 } }\n * ```\n * @param array Array in the form [x1,y1,x2,y2]\n * @returns Line\n */\nexport const fromFlatArray = (array) => {\n    if (!Array.isArray(array))\n        throw new Error(`arr parameter is not an array`);\n    if (array.length !== 4)\n        throw new Error(`array is expected to have length four`);\n    return fromNumbers(array[0], array[1], array[2], array[3]);\n};\n","import * as Polar from \"../polar/index.js\";\nimport { radianInvert } from \"../angles.js\";\n/**\n * Creates a line from an origin point.\n * ```js\n * // Line of length 0.2 with middle at 0.5,0.5\n * fromPivot({ x:0.5, y:0.5 }, 0.2);\n * // Same line, but on an angle\n * fromPivot({ x:0.5, y:0.5 }, 0.2, degreesToRadian(45));\n *\n * // ...now with pivot point at 20%, rather than center\n * fromPivot({ x:0.5, y:0.5 }, 0.2, degreesToRadian(45), 0.2);\n * ```\n *\n * Examples:\n * * Angle of 0 (deg/rad) results in a horizontal line,\n * * Angle of 90deg in a vertical line.\n * * Angle of 45deg will be angled downwards.\n *\n * @param origin Origin to pivot around\n * @param length Total length of line\n * @param angleRadian Angle of line, in radians\n * @param balance Percentage of where origin ought to be on line. Default: 0.5, meaning the middle of line\n */\nexport const fromPivot = (origin = { x: 0.5, y: 0.5 }, length = 1, angleRadian = 0, balance = 0.5) => {\n    const left = length * balance;\n    const right = length * (1 - balance);\n    const a = Polar.toCartesian(left, radianInvert(angleRadian), origin);\n    const b = Polar.toCartesian(right, angleRadian, origin);\n    return Object.freeze({\n        a, b\n    });\n};\n","import { interpolate } from \"./interpolate.js\";\nimport { getPointParameter } from \"./get-points-parameter.js\";\n/**\n * Returns the mid-point of a line (same as `interpolate` with an amount of 0.5)\n *\n * ```js\n * Lines.midpoint(line); // Returns {x, y}\n * ```\n * @param aOrLine\n * @param pointB\n * @returns\n */\nexport const midpoint = (aOrLine, pointB) => {\n    const [a, b] = getPointParameter(aOrLine, pointB);\n    return interpolate(0.5, a, b);\n};\n","import { length } from \"./length.js\";\nimport { distance as PointsDistance } from \"../point/distance.js\";\n/**\n * Returns the relative position of `pt` along `line`.\n * Warning: assumes `pt` is actually on `line`. Results may be bogus if not.\n * @param line\n * @param pt\n */\nexport const relativePosition = (line, pt) => {\n    const fromStart = PointsDistance(line.a, pt);\n    const total = length(line);\n    return fromStart / total;\n};\n","import { sum as PointsSum } from '../point/sum.js';\n/**\n * Adds both start and end points by given x,y\n * ```js\n *\n * // Line 1,1 -> 10,10\n * const l = Lines.fromNumbers(1,1,10,10);\n * const ll = Lines.sum(l, {x:2, y:4});\n * // Yields: 3,5 -> 12,14\n * ```\n * @param line\n * @param point\n * @returns\n */\nexport const sum = (line, point) => Object.freeze({\n    ...line,\n    a: PointsSum(line.a, point),\n    b: PointsSum(line.b, point)\n});\n","import { rotate as PointRotate } from '../point/index.js';\nimport { interpolate } from \"./interpolate.js\";\n/**\n * Returns a line that is rotated by `angleRad`. By default it rotates\n * around its center, but an arbitrary `origin` point can be provided.\n * If `origin` is a number, it's presumed to be a 0..1 percentage of the line.\n *\n * ```js\n * // Rotates line by 0.1 radians around point 10,10\n * const r = Lines.rotate(line, 0.1, {x:10,y:10});\n *\n * // Rotate line by 5 degrees around its center\n * const r = Lines.rotate(line, degreeToRadian(5));\n *\n * // Rotate line by 5 degres around its end point\n * const r = Lines.rotate(line, degreeToRadian(5), line.b);\n *\n * // Rotate by 90 degrees at the 80% position\n * const r = Lines.rotated = rotate(line, Math.PI / 2, 0.8);\n * ```\n * @param line Line to rotate\n * @param amountRadian Angle in radians to rotate by\n * @param origin Point to rotate around. If undefined, middle of line will be used\n * @returns\n */\nexport const rotate = (line, amountRadian, origin) => {\n    if (typeof amountRadian === `undefined` || amountRadian === 0)\n        return line;\n    if (typeof origin === `undefined`)\n        origin = 0.5;\n    if (typeof origin === `number`) {\n        origin = interpolate(origin, line.a, line.b);\n    }\n    return Object.freeze({\n        ...line,\n        a: PointRotate(line.a, amountRadian, origin),\n        b: PointRotate(line.b, amountRadian, origin)\n    });\n};\n","import { isEqual as PointsIsEqual } from '../point/is-equal.js';\n/**\n * Returns true if the lines have the same value. Note that only\n * the line start and end points are compared. So the lines might\n * be different in other properties, and `isEqual` will still return\n * true.\n *\n * ```js\n * const a = { a: {x:0,  y: 10 }, b: { x: 20, y: 20 }};\n * const b = { a: {x:0,  y: 10 }, b: { x: 20, y: 20 }};\n * a === b; // false, because they are different objects\n * Lines.isEqual(a, b); // true, because they have the same value\n * ```\n * @param {Line} a\n * @param {Line} b\n * @returns {boolean}\n */\nexport const isEqual = (a, b) => PointsIsEqual(a.a, b.a) && PointsIsEqual(a.b, b.b);\n","import { multiply as PointsMultiply } from \"../point/index.js\";\n/**\n * Multiplies start and end of line by point.x, point.y.\n *\n * ```js\n *\n * // Line 1,1 -> 10,10\n * const l = Lines.fromNumbers(1, 1, 10, 10);\n * const ll = Lines.multiply(l, {x:2, y:3});\n * // Yields: 2,20 -> 3,30\n * ```\n * @param line\n * @param point\n * @returns\n */\nexport const multiply = (line, point) => (Object.freeze({\n    ...line,\n    a: PointsMultiply(line.a, point),\n    b: PointsMultiply(line.b, point)\n}));\n","import { subtract as PointsSubtract } from \"../point/subtract.js\";\n/**\n * Subtracts both start and end points by given x,y\n * ```js\n * // Line 1,1 -> 10,10\n * const l = Lines.fromNumbers(1,1,10,10);\n * const ll = Lines.subtract(l, {x:2, y:4});\n * // Yields: -1,-3 -> 8,6\n * ```\n * @param line\n * @param point\n * @returns\n */\nexport const subtract = (line, point) => Object.freeze({\n    ...line,\n    a: PointsSubtract(line.a, point),\n    b: PointsSubtract(line.b, point)\n});\n","import { guard, isLine } from \"./guard.js\";\nimport { toString as PointsToString } from '../point/index.js';\n/**\n * Returns a string representation of a line or two points.\n * @param a\n * @param b\n * @returns\n */\nexport function toString(a, b) {\n    if (isLine(a)) {\n        guard(a, `a`);\n        b = a.b;\n        a = a.a;\n    }\n    else if (b === undefined)\n        throw new Error(`Expect second point if first is a point`);\n    return PointsToString(a) + `-` + PointsToString(b);\n}\n","import { length } from \"./length.js\";\nimport { interpolate } from \"./interpolate.js\";\nimport { parallel, perpendicularPoint } from \"./angles.js\";\nimport { midpoint } from \"./midpoint.js\";\nimport { toFlatArray, toSvgString, slope, withinRange, apply } from \"./index.js\";\nimport { bbox } from \"./bbox.js\";\nimport { relativePosition } from \"./relative-position.js\";\nimport { sum } from \"./sum.js\";\nimport { divide } from \"./divide.js\";\nimport { rotate } from \"./rotate.js\";\nimport { nearest } from \"./nearest.js\";\nimport { distanceSingleLine } from './distance-single-line.js';\nimport { isEqual } from \"./is-equal.js\";\nimport { multiply } from \"./multiply.js\";\nimport { subtract } from \"./subtract.js\";\nimport { toString } from \"./to-string.js\";\n/**\n * Returns a path wrapper around a line instance. This is useful if there are a series\n * of operations you want to do with the same line because you don't have to pass it\n * in as an argument to each function.\n *\n * Note that the line is immutable, so a function like `sum` returns a new LinePath,\n * wrapping the result of `sum`.\n *\n * ```js\n * // Create a path\n * const l = Lines.toPath(fromNumbers(0,0,10,10));\n *\n * // Now we can use it...\n * l.length();\n *\n * // Mutate functions return a new path\n * const ll = l.sum({x:10,y:10});\n * ll.length();\n * ```\n * @param line\n * @returns\n */\nexport const toPath = (line) => {\n    const { a, b } = line;\n    return Object.freeze({\n        ...line,\n        length: () => length(a, b),\n        interpolate: (amount) => interpolate(amount, a, b),\n        relativePosition: (point) => relativePosition(line, point),\n        bbox: () => bbox(line),\n        toString: () => toString(a, b),\n        toFlatArray: () => toFlatArray(a, b),\n        toSvgString: () => toSvgString(a, b),\n        toPoints: () => [a, b],\n        rotate: (amountRadian, origin) => toPath(rotate(line, amountRadian, origin)),\n        nearest: (point) => nearest(line, point),\n        sum: (point) => toPath(sum(line, point)),\n        divide: (point) => toPath(divide(line, point)),\n        multiply: (point) => toPath(multiply(line, point)),\n        subtract: (point) => toPath(subtract(line, point)),\n        midpoint: () => midpoint(a, b),\n        distanceToPoint: (point) => distanceSingleLine(line, point),\n        parallel: (distance) => parallel(line, distance),\n        perpendicularPoint: (distance, amount) => perpendicularPoint(line, distance, amount),\n        slope: () => slope(line),\n        withinRange: (point, maxRange) => withinRange(line, point, maxRange),\n        isEqual: (otherLine) => isEqual(line, otherLine),\n        apply: (fn) => toPath(apply(line, fn)),\n        kind: `line`\n    });\n};\n","import { fromPoints } from \"./from-points.js\";\nimport { toPath } from \"./to-path.js\";\n/**\n * Returns a {@link LinePath} from two points\n *\n * ```js\n * const path = Lines.fromPointsToPath(ptA, ptB);\n * ```\n * @param a\n * @param b\n * @returns\n */\nexport const fromPointsToPath = (a, b) => toPath(fromPoints(a, b));\n","//import * as Points from '../point/index.js';\nimport { normaliseByRect as PointsNormaliseByRect } from '../point/normalise-by-rect.js';\nimport { minFast } from '@ixfx/numbers';\nimport { distanceSingleLine } from './distance-single-line.js';\nimport { isLine } from './guard.js';\nimport { length } from './length.js';\nimport { interpolate } from './interpolate.js';\nimport { isPoint, isEmpty as PointIsEmpty, isPlaceholder as PointIsPlaceholder } from '../point/guard.js';\nexport * from './angles.js';\nexport * from './bbox.js';\nexport * from './distance-single-line.js';\nexport * from './divide.js';\nexport * from './from-flat-array.js';\nexport * from './from-numbers.js';\nexport * from './from-points.js';\nexport * from './from-pivot.js';\nexport * from './from-points-to-path.js';\nexport * from './get-points-parameter.js';\nexport * from './guard.js';\nexport * from './interpolate.js';\nexport * from './is-equal.js';\nexport * from './join-points-to-lines.js';\nexport * from './length.js';\nexport * from './midpoint.js';\nexport * from './multiply.js';\nexport * from './nearest.js';\nexport * from './relative-position.js';\nexport * from './reverse.js';\nexport * from './rotate.js';\nexport * from './subtract.js';\nexport * from './sum.js';\nexport * from './to-path.js';\nexport * from './to-string.js';\nexport const Empty = Object.freeze({\n    a: Object.freeze({ x: 0, y: 0 }),\n    b: Object.freeze({ x: 0, y: 0 })\n});\nexport const Placeholder = Object.freeze({\n    a: Object.freeze({ x: Number.NaN, y: Number.NaN }),\n    b: Object.freeze({ x: Number.NaN, y: Number.NaN })\n});\n/**\n * Returns true if `l` is the same as Line.Empty, that is\n * the `a` and `b` points are Points.Empty.\n * @param l\n * @returns\n */\nexport const isEmpty = (l) => PointIsEmpty(l.a) && PointIsEmpty(l.b);\nexport const isPlaceholder = (l) => PointIsPlaceholder(l.a) && PointIsPlaceholder(l.b);\n/**\n * Applies `fn` to both start and end points.\n *\n * ```js\n * // Line 10,10 -> 20,20\n * const line = Lines.fromNumbers(10,10, 20,20);\n *\n * // Applies randomisation to both x and y.\n * const rand = (p) => ({\n *  x: p.x * Math.random(),\n *  y: p.y * Math.random()\n * });\n *\n * // Applies our randomisation function\n * const line2 = apply(line, rand);\n * ```\n * @param line Line\n * @param fn Function that takes a point and returns a point\n * @returns\n */\nexport const apply = (line, fn) => Object.freeze({\n    ...line,\n    a: fn(line.a),\n    b: fn(line.b)\n});\n/**\n * Returns the angle in radians of a line, or two points\n * ```js\n * Lines.angleRadian(line);\n * Lines.angleRadian(ptA, ptB);\n * ```\n * @param lineOrPoint\n * @param b\n * @returns\n */\nexport const angleRadian = (lineOrPoint, b) => {\n    let a;\n    if (isLine(lineOrPoint)) {\n        a = lineOrPoint.a;\n        b = lineOrPoint.b;\n    }\n    else {\n        a = lineOrPoint;\n        if (b === undefined)\n            throw new Error(`b point must be provided`);\n    }\n    return Math.atan2(b.y - a.y, b.x - a.x);\n};\n/**\n * Normalises start and end points by given width and height. Useful\n * for converting an absolutely-defined line to a relative one.\n *\n * ```js\n *\n * // Line 1,1 -> 10,10\n * const l = Lines.fromNumbers(1,1,10,10);\n * const ll = Lines.normaliseByRect(l, 10, 10);\n * // Yields: 0.1,0.1 -> 1,1\n * ```\n * @param line\n * @param width\n * @param height\n * @returns\n */\nexport const normaliseByRect = (line, width, height) => Object.freeze({\n    ...line,\n    a: PointsNormaliseByRect(line.a, width, height),\n    b: PointsNormaliseByRect(line.b, width, height)\n});\n/**\n * Returns true if `point` is within `maxRange` of `line`.\n *\n * ```js\n * const line = Lines.fromNumbers(0,20,20,20);\n * Lines.withinRange(line, {x:0,y:21}, 1); // True\n * ```\n * @param line\n * @param point\n * @param maxRange\n * @returns True if point is within range\n */\nexport const withinRange = (line, point, maxRange) => {\n    const calculatedDistance = distance(line, point);\n    return calculatedDistance <= maxRange;\n};\n/**\n * Calculates [slope](https://en.wikipedia.org/wiki/Slope) of line.\n *\n * @example\n * ```js\n * Lines.slope(line);\n * Lines.slope(ptA, ptB)\n * ```\n * @param lineOrPoint Line or point. If point is provided, second point must be given too\n * @param b Second point if needed\n * @returns\n */\nexport const slope = (lineOrPoint, b) => {\n    let a;\n    if (isLine(lineOrPoint)) {\n        a = lineOrPoint.a;\n        b = lineOrPoint.b;\n    }\n    else {\n        a = lineOrPoint;\n        if (b === undefined)\n            throw new Error(`b parameter required`);\n    }\n    if (b === undefined) {\n        throw new TypeError(`Second point missing`);\n    }\n    else {\n        return (b.y - a.y) / (b.x - a.x);\n    }\n};\n/**\n * Scales a line from its midpoint\n *\n * @example Shorten by 50%, anchored at the midpoint\n * ```js\n * const l = {\n *  a: {x:50, y:50}, b: {x: 100, y: 90}\n * }\n * const l2 = Lines.scaleFromMidpoint(l, 0.5);\n * ```\n * @param line\n * @param factor\n */\nexport const scaleFromMidpoint = (line, factor) => {\n    const a = interpolate(factor / 2, line);\n    const b = interpolate(0.5 + factor / 2, line);\n    return { a, b };\n};\n/**\n * Calculates `y` where `line` intersects `x`.\n * @param line Line to extend\n * @param x Intersection of x-axis.\n */\nexport const pointAtX = (line, x) => {\n    const y = line.a.y + (x - line.a.x) * slope(line);\n    return Object.freeze({ x: x, y });\n};\n/**\n * Returns a line extended from its `a` point by a specified distance\n *\n * ```js\n * const line = {a: {x: 0, y:0}, b: {x:10, y:10} }\n * const extended = Lines.extendFromA(line, 2);\n * ```\n * @param line\n * @param distance\n * @return Newly extended line\n */\nexport const extendFromA = (line, distance) => {\n    const calculatedLength = length(line);\n    return Object.freeze({\n        ...line,\n        a: line.a,\n        b: Object.freeze({\n            x: line.b.x + (line.b.x - line.a.x) / calculatedLength * distance,\n            y: line.b.y + (line.b.y - line.a.y) / calculatedLength * distance,\n        })\n    });\n};\n/**\n * Yields every integer point along `line`.\n *\n * @example Basic usage\n * ```js\n * const l = { a: {x: 0, y: 0}, b: {x: 100, y: 100} };\n * for (const p of Lines.pointsOf(l)) {\n *  // Do something with point `p`...\n * }\n * ```\n *\n * Some precision is lost as start and end\n * point is also returned as an integer.\n *\n * Uses [Bresenham's line algorithm](https://en.wikipedia.org/wiki/Bresenham%27s_line_algorithm)\n * @param line Line\n */\nexport function* pointsOf(line) {\n    // Via https://play.ertdfgcvb.xyz/#/src/demos/dyna\n    const { a, b } = line;\n    let x0 = Math.floor(a.x);\n    let y0 = Math.floor(a.y);\n    const x1 = Math.floor(b.x);\n    const y1 = Math.floor(b.y);\n    const dx = Math.abs(x1 - x0);\n    const dy = -Math.abs(y1 - y0);\n    const sx = x0 < x1 ? 1 : -1;\n    const sy = y0 < y1 ? 1 : -1;\n    // eslint-disable-next-line unicorn/prevent-abbreviations\n    let err = dx + dy;\n    while (true) {\n        yield { x: x0, y: y0 };\n        if (x0 === x1 && y0 === y1)\n            break;\n        // eslint-disable-next-line unicorn/prevent-abbreviations\n        const e2 = 2 * err;\n        if (e2 >= dy) {\n            err += dy;\n            x0 += sx;\n        }\n        if (e2 <= dx) {\n            err += dx;\n            y0 += sy;\n        }\n    }\n}\n/**\n * Returns the distance of `point` to the\n * nearest point on `line`.\n *\n * ```js\n * const d = Lines.distance(line, {x:10,y:10});\n * ```\n *\n * If an array of lines is provided, the shortest distance is returned.\n * @param line Line (or array of lines)\n * @param point Point to check against\n * @returns Distance\n */\nexport const distance = (line, point) => {\n    if (Array.isArray(line)) {\n        const distances = line.map(l => distanceSingleLine(l, point));\n        return minFast(distances);\n    }\n    else {\n        return distanceSingleLine(line, point);\n    }\n};\n/**\n * Returns an array representation of line: [a.x, a.y, b.x, b.y]\n *\n * See {@link fromFlatArray} to create a line _from_ this representation.\n *\n * ```js\n * Lines.toFlatArray(line);\n * Lines.toFlatArray(pointA, pointB);\n * ```\n * @param {Point} a\n * @param {Point} b\n * @returns {number[]}\n */\nexport const toFlatArray = (a, b) => {\n    if (isLine(a)) {\n        return [a.a.x, a.a.y, a.b.x, a.b.y];\n    }\n    else if (isPoint(a) && isPoint(b)) {\n        return [a.x, a.y, b.x, b.y];\n    }\n    else {\n        throw new Error(`Expected single line parameter, or a and b points`);\n    }\n};\n/**\n * Yields all the points of all the lines.\n *\n * ```js\n * const lines = [ ..some array of lines.. ];\n * for (const pt of Lines.asPoints(lines)) {\n *  // Yields a and then b of each point sequentially\n * }\n * ```\n * @param lines\n */\nexport function* asPoints(lines) {\n    for (const l of lines) {\n        yield l.a;\n        yield l.b;\n    }\n}\n/**\n * Returns an SVG description of line\n * ```\n * Lines.toSvgString(ptA, ptB);\n * ```\n * @param a\n * @param b\n * @returns\n */\nexport const toSvgString = (a, b) => [`M${a.x} ${a.y} L ${b.x} ${b.y}`];\n","import { angleRadian } from \"./angle.js\";\nimport { centroid } from \"./centroid.js\";\nimport { distance } from \"./distance.js\";\nimport { getPointParameter } from \"./get-point-parameter.js\";\n/**\n * Tracks the relation between two points.\n *\n * 1. Call `Points.relation` with the initial reference point\n * 2. You get back a function\n * 3. Call the function with a new point to compute relational information.\n *\n * It computes angle, average, centroid, distance and speed.\n *\n * ```js\n * // Reference point: 50,50\n * const t = Points.relation({x:50,y:50}); // t is a function\n *\n * // Invoke the returned function with a point\n * const relation = t({ x:0, y:0 }); // Juicy relational data\n * ```\n *\n * Or with destructuring:\n *\n * ```js\n * const { angle, distanceFromStart, distanceFromLast, average, centroid, speed } = t({ x:0,y:0 });\n * ```\n *\n * x & y coordinates can also be used as parameters:\n * ```js\n * const t = Points.relation(50, 50);\n * const result = t(0, 0);\n * // result.speed, result.angle ...\n * ```\n *\n * Note that intermediate values are not stored. It keeps the initial\n * and most-recent point. If you want to compute something over a set\n * of prior points, you may want to use {@link PointsTracker}\n * @param a Initial point, or x value\n * @param b y value, if first option is a number.\n * @returns\n */\nexport const relation = (a, b) => {\n    const start = getPointParameter(a, b);\n    let totalX = 0;\n    let totalY = 0;\n    let count = 0;\n    let lastUpdate = performance.now();\n    let lastPoint = start;\n    const update = (aa, bb) => {\n        const p = getPointParameter(aa, bb);\n        totalX += p.x;\n        totalY += p.y;\n        count++;\n        const distanceFromStart = distance(p, start);\n        const distanceFromLast = distance(p, lastPoint);\n        // Track speed\n        const now = performance.now();\n        const speed = distanceFromLast / (now - lastUpdate);\n        lastUpdate = now;\n        lastPoint = p;\n        return Object.freeze({\n            angle: angleRadian(p, start),\n            distanceFromStart,\n            distanceFromLast,\n            speed,\n            centroid: centroid(p, start),\n            average: {\n                x: totalX / count,\n                y: totalY / count,\n            },\n        });\n    };\n    return update;\n};\n","import { TrackedValueMap, } from '@ixfx/trackers';\nimport { ObjectTracker } from '@ixfx/trackers';\nimport { length as LineLength } from '../line/length.js';\nimport * as Vectors from '../vector.js';\nimport { Empty as LinesEmpty } from '../line/index.js';\nimport { joinPointsToLines } from '../line/join-points-to-lines.js';\nimport { relation } from './relation.js';\nimport { distance } from './distance.js';\nimport { subtract } from './subtract.js';\nimport { angleRadian } from './angle.js';\nimport { Placeholder as PointsPlaceholder } from './point-type.js';\n/**\n * A tracked point. Mutable. Useful for monitoring how\n * it changes over time. Eg. when a pointerdown event happens, to record the start position and then\n * track the pointer as it moves until pointerup.\n *\n * See also\n * * [Playground](https://clinth.github.io/ixfx-play/data/point-tracker/index.html)\n * * {@link PointsTracker}: Track several points, useful for multi-touch.\n * * [ixfx Guide to Point Tracker](https://ixfx.fun/geometry/tracking/)\n *\n * ```js\n * // Create a tracker on a pointerdown\n * const t = new PointTracker();\n *\n * // ...and later, tell it when a point is seen (eg. pointermove)\n * const nfo = t.seen({x: evt.x, y:evt.y});\n * // nfo gives us some details on the relation between the seen point, the start, and points inbetween\n * // nfo.angle, nfo.centroid, nfo.speed etc.\n * ```\n *\n * Compute based on last seen point\n * ```js\n * t.angleFromStart();\n * t.distanceFromStart();\n * t.x / t.y\n * t.length; // Total length of accumulated points\n * t.elapsed; // Total duration since start\n * t.lastResult; // The PointSeenInfo for last seen point\n * ```\n *\n * Housekeeping\n * ```js\n * t.reset(); // Reset tracker\n * ```\n *\n * By default, the tracker only keeps track of the initial point and\n * does not store intermediate 'seen' points. To use the tracker as a buffer,\n * set `storeIntermediate` option to _true_.\n *\n * ```js\n * // Keep only the last 10 points\n * const t = new PointTracker({\n *  sampleLimit: 10\n * });\n *\n * // Store all 'seen' points\n * const t = new PointTracker({\n *  storeIntermediate: true\n * });\n *\n * // In this case, the whole tracker is automatically\n * // reset after 10 samples\n * const t = new PointTracker({\n *  resetAfterSamples: 10\n * })\n * ```\n *\n * When using a buffer limited by `sampleLimit`, the 'initial' point will be the oldest in the\n * buffer, not actually the very first point seen.\n */\nexport class PointTracker extends ObjectTracker {\n    initialRelation;\n    markRelation;\n    lastResult;\n    constructor(opts = {}) {\n        super(opts);\n    }\n    /**\n     * Notification that buffer has been knocked down to `sampleLimit`.\n     *\n     * This will reset the `initialRelation`, which will use the new oldest value.\n     */\n    onTrimmed(_reason) {\n        // Force new relation calculations\n        this.initialRelation = undefined;\n    }\n    /**\n     * @ignore\n     */\n    onReset() {\n        super.onReset();\n        this.lastResult = undefined;\n        this.initialRelation = undefined;\n        this.markRelation = undefined;\n    }\n    /**\n     * Makes a 'mark' in the tracker, allowing you to compare values\n     * to this point.\n     */\n    mark() {\n        this.markRelation = relation(this.last);\n    }\n    /**\n     * Tracks a point, returning data on its relation to the\n     * initial point and the last received point.\n     *\n     * Use {@link seenEvent} to track a raw `PointerEvent`.\n     *\n     * @param _p Point\n     */\n    computeResults(_p) {\n        const currentLast = this.last;\n        const previousLast = this.values.at(-2);\n        if (this.initialRelation === undefined && this.initial) {\n            // Don't yet have an initial relation function\n            // Use the oldest point in the buffer (this.initial)\n            this.initialRelation = relation(this.initial);\n        }\n        else if (this.initialRelation === undefined) {\n            // Don't have an initial relation, but also don't have an initial point :()\n            throw new Error(`Bug: No initialRelation, and this.inital is undefined?`);\n        }\n        // Make a new relator based on previous point\n        const lastRelation = previousLast === undefined ? relation(currentLast) : relation(previousLast);\n        // Compute relation from initial point to latest\n        const initialRel = this.initialRelation(currentLast);\n        const markRel = (this.markRelation !== undefined) ? this.markRelation(currentLast) : undefined;\n        const speed = previousLast === undefined ? 0 : LineLength(previousLast, currentLast) / (currentLast.at - previousLast.at);\n        // Compute relation from current point to the previous\n        const lastRel = {\n            ...lastRelation(currentLast),\n            speed,\n        };\n        const r = {\n            fromInitial: initialRel,\n            fromLast: lastRel,\n            fromMark: markRel,\n            values: [...this.values],\n        };\n        this.lastResult = r;\n        return r;\n    }\n    /**\n     * Returns a polyline representation of stored points.\n     * Returns an empty array if points were not saved, or there's only one.\n     */\n    get line() {\n        if (this.values.length === 1)\n            return [];\n        return joinPointsToLines(...this.values);\n    }\n    /**\n     * Returns a vector of the initial/last points of the tracker.\n     * Returns as a polar coordinate\n     */\n    get vectorPolar() {\n        return Vectors.fromLinePolar(this.lineStartEnd);\n    }\n    /**\n     * Returns a vector of the initial/last points of the tracker.\n     * Returns as a Cartesian coordinate\n     */\n    get vectorCartesian() {\n        return Vectors.fromLineCartesian(this.lineStartEnd);\n    }\n    /**\n     * Returns a line from initial point to last point.\n     *\n     * If there are less than two points, Lines.Empty is returned\n     */\n    get lineStartEnd() {\n        const initial = this.initial;\n        if (this.values.length < 2 || !initial)\n            return LinesEmpty;\n        return {\n            a: initial,\n            b: this.last,\n        };\n    }\n    /**\n     * Returns distance from latest point to initial point.\n     * If there are less than two points, zero is returned.\n     *\n     * This is the direct distance from initial to last,\n     * not the accumulated length. Use {@link length} for that.\n     * @returns Distance\n     */\n    distanceFromStart() {\n        const initial = this.initial;\n        return this.values.length >= 2 && initial !== undefined ? distance(initial, this.last) : 0;\n    }\n    /**\n     * Returns the speed (over milliseconds) based on accumulated travel distance.\n     *\n     * If there's no initial point, 0 is returned.\n     * @returns\n     */\n    speedFromStart() {\n        const d = this.length;\n        const t = this.timespan;\n        if (Number.isNaN(t))\n            return 0;\n        if (d === 0)\n            return 0;\n        return Math.abs(d) / t;\n    }\n    /**\n     * Difference between last point and the initial point, calculated\n     * as a simple subtraction of x,y & z.\n     *\n     * `Points.Placeholder` is returned if there's only one point so far.\n     */\n    difference() {\n        const initial = this.initial;\n        return this.values.length >= 2 && initial !== undefined ? subtract(this.last, initial) : PointsPlaceholder;\n    }\n    /**\n     * Returns angle (in radians) from latest point to the initial point\n     * If there are less than two points, undefined is return.\n     * @returns Angle in radians\n     */\n    angleFromStart() {\n        const initial = this.initial;\n        if (initial !== undefined && this.values.length > 2) {\n            return angleRadian(initial, this.last);\n        }\n    }\n    /**\n     * Returns the total distance from accumulated points.\n     * Returns 0 if points were not saved, or there's only one\n     */\n    get length() {\n        if (this.values.length === 1)\n            return 0;\n        const l = this.line;\n        return LineLength(l);\n    }\n    /**\n   * Returns the last x coord\n   */\n    get x() {\n        return this.last.x;\n    }\n    /**\n     * Returns the last y coord\n     */\n    get y() {\n        return this.last.y;\n    }\n    /**\n     * Returns the last z coord (or _undefined_ if not available)\n     */\n    get z() {\n        return this.last.z;\n    }\n}\n/**\n * A {@link TrackedValueMap} for points. Uses {@link PointTracker} to\n * track added values.\n */\nexport class PointsTracker extends TrackedValueMap {\n    constructor(opts = {}) {\n        super((key, start) => {\n            if (start === undefined)\n                throw new Error(`Requires start point`);\n            const p = new PointTracker({\n                ...opts,\n                id: key,\n            });\n            p.seen(start);\n            return p;\n        });\n    }\n    get(id) {\n        const v = super.get(id);\n        return v;\n    }\n}\nexport class UserPointerTracker extends PointTracker {\n    /**\n     * Adds a PointerEvent along with its\n     * coalesced events, if available.\n     * @param p\n     * @returns\n     */\n    seenEvent(p) {\n        if (`getCoalescedEvents` in p) {\n            const events = p.getCoalescedEvents();\n            const asPoints = events.map(event => ({ x: event.clientX, y: event.clientY }));\n            return this.seen(...asPoints);\n        }\n        else {\n            return this.seen({ x: (p).clientX, y: (p).clientY });\n        }\n    }\n}\nexport class UserPointersTracker extends TrackedValueMap {\n    constructor(opts = {}) {\n        super((key, start) => {\n            if (start === undefined)\n                throw new Error(`Requires start point`);\n            const p = new UserPointerTracker({\n                ...opts,\n                id: key,\n            });\n            p.seen(start);\n            return p;\n        });\n    }\n    get(id) {\n        const v = super.get(id);\n        return v;\n    }\n    /**\n   * Track a PointerEvent\n   * @param event\n   */\n    seenEvent(event) {\n        if (`getCoalescedEvents` in event) {\n            const events = event.getCoalescedEvents();\n            const seens = events.map(subEvent => super.seen(subEvent.pointerId.toString(), subEvent));\n            return Promise.all(seens);\n        }\n        else {\n            return Promise.all([super.seen(event.pointerId.toString(), event)]);\n        }\n    }\n}\n","import { isPoint3d } from \"./guard.js\";\nimport { subtract } from \"./subtract.js\";\n/**\n * Computes the progress between two waypoints, given `position`.\n *\n * [Source](https://www.habrador.com/tutorials/math/2-passed-waypoint/?s=09)\n * @param position Current position\n * @param waypointA Start\n * @param waypointB End\n * @returns\n */\nexport const progressBetween = (position, waypointA, waypointB) => {\n    // Via: https://www.habrador.com/tutorials/math/2-passed-waypoint/?s=09\n    // from -> current\n    const a = subtract(position, waypointA);\n    // from -> to\n    const b = subtract(waypointB, waypointA);\n    return isPoint3d(a) && isPoint3d(b) ? ((a.x * b.x + a.y * b.y + a.z * b.z) / (b.x * b.x + b.y * b.y + b.z * b.z)) : (a.x * b.x + a.y * b.y) / (b.x * b.x + b.y * b.y);\n};\n","/**\n * Project `origin` by `distance` and `angle` (radians).\n *\n * To figure out rotation, imagine a horizontal line running through `origin`.\n * * Rotation = 0 deg puts the point on the right of origin, on same y-axis\n * * Rotation = 90 deg/3:00 puts the point below origin, on the same x-axis\n * * Rotation = 180 deg/6:00 puts the point on the left of origin on the same y-axis\n * * Rotation = 270 deg/12:00 puts the point above the origin, on the same x-axis\n *\n * ```js\n * // Yields a point 100 units away from 10,20 with 10 degrees rotation (ie slightly down)\n * const a = Points.project({x:10, y:20}, 100, degreeToRadian(10));\n * ```\n * @param origin\n * @param distance\n * @param angle\n * @returns\n */\nexport const project = (origin, distance, angle) => {\n    const x = Math.cos(angle) * distance + origin.x;\n    const y = Math.sin(angle) * distance + origin.y;\n    return { x, y };\n};\n","import { quantiseEvery as quantiseEveryNumber } from '@ixfx/numbers';\nimport { guard, isPoint3d } from './guard.js';\n/**\n * Quantises a point.\n * @param pt\n * @param snap\n * @param middleRoundsUp\n * @returns\n */\nexport function quantiseEvery(pt, snap, middleRoundsUp = true) {\n    guard(pt, `pt`);\n    guard(snap, `snap`);\n    if (isPoint3d(pt)) {\n        if (!isPoint3d(snap))\n            throw new TypeError(`Param 'snap' is missing 'z' field`);\n        return Object.freeze({\n            x: quantiseEveryNumber(pt.x, snap.x, middleRoundsUp),\n            y: quantiseEveryNumber(pt.y, snap.y, middleRoundsUp),\n            z: quantiseEveryNumber(pt.z, snap.z, middleRoundsUp)\n        });\n    }\n    return Object.freeze({\n        x: quantiseEveryNumber(pt.x, snap.x, middleRoundsUp),\n        y: quantiseEveryNumber(pt.y, snap.y, middleRoundsUp),\n    });\n}\n","import {} from '@ixfx/random';\n/**\n * Returns a random 2D point on a 0..1 scale.\n * ```js\n * import { Points } from \"@ixfx/geometry.js\";\n * const pt = Points.random(); // eg {x: 0.2549012, y:0.859301}\n * ```\n *\n * A custom source of randomness can be provided:\n * ```js\n * import { Points } from \"@ixfx/geometry.js\";\n * import { weightedSource } from \"@ixfx/random.js\"\n * const pt = Points.random(weightedSource(`quadIn`));\n * ```\n * @param rando\n * @returns\n */\nexport const random = (rando) => {\n    if (typeof rando === `undefined`)\n        rando = Math.random;\n    return Object.freeze({\n        x: rando(),\n        y: rando(),\n    });\n};\n/**\n * Returns a random 3D point on a 0..1 scale.\n * ```js\n * import { Points } from \"@ixfx/geometry\";\n * const pt = Points.random(); // eg {x: 0.2549012, y:0.859301}\n * ```\n *\n * A custom source of randomness can be provided:\n * ```js\n * import { Points } from \"@ixfx/geometry\";\n * import { weightedSource } from \"@ixfx/random.js\"\n * const pt = Points.random(weightedSource(`quadIn`));\n * ```\n * @param rando\n * @returns\n */\nexport const random3d = (rando) => {\n    if (typeof rando === `undefined`)\n        rando = Math.random;\n    return Object.freeze({\n        x: rando(),\n        y: rando(),\n        z: rando()\n    });\n};\n","/**\n * Reduces over points, treating _x_ and _y_ separately.\n *\n * ```\n * // Sum x and y values\n * const total = Points.reduce(points, (p, acc) => {\n *  return {x: p.x + acc.x, y: p.y + acc.y}\n * });\n * ```\n * @param pts Points to reduce\n * @param fn Reducer\n * @param initial Initial value, uses `{ x:0, y:0 }` by default\n * @returns\n */\nexport const reduce = (pts, fn, initial) => {\n    if (initial === undefined)\n        initial = { x: 0, y: 0 };\n    let accumulator = initial;\n    for (const p of pts) {\n        accumulator = fn(p, accumulator);\n    }\n    ;\n    return accumulator;\n};\n","import { numberTest, resultThrow } from \"@ixfx/guards\";\nimport { guard } from \"./guard.js\";\nimport { fromCartesian as PolarFromCartesian } from \"../polar/index.js\";\nimport { rotate as PolarRotate, toCartesian as PolarToCartesian } from \"../polar/index.js\";\nexport function rotate(pt, amountRadian, origin) {\n    if (typeof origin === `undefined`)\n        origin = { x: 0, y: 0 };\n    guard(origin, `origin`);\n    resultThrow(numberTest(amountRadian, ``, `amountRadian`));\n    const arrayInput = Array.isArray(pt);\n    // no-op\n    if (amountRadian === 0)\n        return pt;\n    if (!arrayInput) {\n        pt = [pt];\n    }\n    const ptAr = pt;\n    for (const [index, p] of ptAr.entries())\n        guard(p, `pt[${index}]`);\n    const asPolar = ptAr.map((p) => PolarFromCartesian(p, origin));\n    const rotated = asPolar.map((p) => PolarRotate(p, amountRadian));\n    const asCartesisan = rotated.map((p) => PolarToCartesian(p, origin));\n    return arrayInput ? asCartesisan : asCartesisan[0];\n}\n","//eslint-disable-next-line functional/prefer-readonly-type\nexport const rotatePointArray = (v, amountRadian) => {\n    const mat = [\n        [Math.cos(amountRadian), -Math.sin(amountRadian)],\n        [Math.sin(amountRadian), Math.cos(amountRadian)],\n    ];\n    const result = [];\n    for (const [index, element] of v.entries()) {\n        result[index] = [\n            mat[0][0] * element[0] + mat[0][1] * element[1],\n            mat[1][0] * element[0] + mat[1][1] * element[1],\n        ];\n    }\n    return result;\n};\n","import { round as roundNumber } from '@ixfx/numbers';\nimport { getPointParameter } from './get-point-parameter.js';\n/**\n * Round the point's _x_ and _y_ to given number of digits\n * @param ptOrX\n * @param yOrDigits\n * @param digits\n * @returns\n */\nexport const round = (ptOrX, yOrDigits, digits) => {\n    const pt = getPointParameter(ptOrX, yOrDigits);\n    digits = digits ?? yOrDigits;\n    digits = digits ?? 2;\n    return Object.freeze({\n        ...pt,\n        x: roundNumber(digits, pt.x),\n        y: roundNumber(digits, pt.y)\n    });\n};\n","import { numberTest, resultThrow } from \"@ixfx/guards\";\nimport { guard } from \"./guard.js\";\n/**\n * Returns true if two points are within a specified range on both axes.\n *\n * Provide a point for the range to set different x/y range, or pass a number\n * to use the same range for both axis.\n *\n * Note this simply compares x,y values it does not calcuate distance.\n *\n * @example\n * ```js\n * withinRange({x:100,y:100}, {x:101, y:101}, 1); // True\n * withinRange({x:100,y:100}, {x:105, y:101}, {x:5, y:1}); // True\n * withinRange({x:100,y:100}, {x:105, y:105}, {x:5, y:1}); // False - y axis too far\n * ```\n * @param a\n * @param b\n * @param maxRange\n * @returns\n */\nexport const withinRange = (a, b, maxRange) => {\n    guard(a, `a`);\n    guard(b, `b`);\n    if (typeof maxRange === `number`) {\n        resultThrow(numberTest(maxRange, `positive`, `maxRange`));\n        maxRange = { x: maxRange, y: maxRange };\n    }\n    else {\n        guard(maxRange, `maxRange`);\n    }\n    const x = Math.abs(b.x - a.x);\n    const y = Math.abs(b.y - a.y);\n    return x <= maxRange.x && y <= maxRange.y;\n};\n","import { wrap as wrapNumber } from '@ixfx/numbers';\nimport { guard } from './guard.js';\n/**\n * Wraps a point to be within `ptMin` and `ptMax`.\n * Note that max values are _exclusive_, meaning the return value will always be one less.\n *\n * Eg, if a view port is 100x100 pixels, wrapping the point 150,100 yields 50,99.\n *\n * ```js\n * // Wraps 150,100 to on 0,0 -100,100 range\n * wrap({x:150,y:100}, {x:100,y:100});\n * ```\n *\n * Wrap normalised point:\n * ```js\n * wrap({x:1.2, y:1.5}); // Yields: {x:0.2, y:0.5}\n * ```\n * @param pt Point to wrap\n * @param ptMax Maximum value, or `{ x:1, y:1 }` by default\n * @param ptMin Minimum value, or `{ x:0, y:0 }` by default\n * @returns Wrapped point\n */\nexport const wrap = (pt, ptMax, ptMin) => {\n    if (ptMax === undefined)\n        ptMax = { x: 1, y: 1 };\n    if (ptMin === undefined)\n        ptMin = { x: 0, y: 0 };\n    //  Unit tested\n    guard(pt, `pt`);\n    guard(ptMax, `ptMax`);\n    guard(ptMin, `ptMin`);\n    return Object.freeze({\n        x: wrapNumber(pt.x, ptMin.x, ptMax.x),\n        y: wrapNumber(pt.y, ptMin.y, ptMax.y),\n    });\n};\n","export * from './abs.js';\nexport * from './angle.js';\nexport * from './apply.js';\nexport * from './averager.js';\nexport * from './bbox.js';\nexport * from './centroid.js';\nexport * from './clamp.js';\nexport * from './compare.js';\nexport * from './convex-hull.js';\nexport * from './distance.js';\nexport * from './distance-to-center.js';\nexport * from './distance-to-exterior.js';\nexport * from './divider.js';\nexport * from './dot-product.js';\nexport * from './empty.js';\nexport * from './find-minimum.js';\nexport * from './from.js';\nexport * from './get-point-parameter.js';\nexport * from './guard.js';\nexport * from './interpolate.js';\nexport * from './invert.js';\nexport * from './is-equal.js';\nexport * from './magnitude.js';\nexport * from './most.js';\nexport * from './multiply.js';\nexport * from './normalise.js';\nexport * from './normalise-by-rect.js';\nexport * from './pipeline.js';\nexport * from './point-relation-types.js';\nexport * from './point-tracker.js';\nexport * from './point-type.js';\nexport * from './progress-between.js';\nexport * from './project.js';\nexport * from './quantise.js';\nexport * from './random.js';\nexport * from './reduce.js';\nexport * from './relation.js';\nexport * from './rotate.js';\nexport * from './rotate-point-array.js';\nexport * from './round.js';\nexport * from './subtract.js';\nexport * from './sum.js';\nexport * from './To.js';\nexport * from './to-array.js';\nexport * from './within-range.js';\nexport * from './wrap.js';\n","import { degreeToRadian, radianArc, radiansSum } from '../angles.js';\nimport { guard as guardPoint, isPoint } from '../point/guard.js';\nimport { distance as pointsDistance } from '../point/distance.js';\nimport { bbox as pointsBbox } from '../point/bbox.js';\nimport { toCartesian } from '../polar/index.js';\nimport { fromPoints as LinesFromPoints } from '../line/from-points.js';\nimport { piPi } from '../pi.js';\n/**\n * Returns true if parameter is an arc\n * @param p Arc or number\n * @returns\n */\nexport const isArc = (p) => typeof p.startRadian !== `undefined` && typeof p.endRadian !== `undefined` && typeof p.clockwise !== `undefined`;\n/**\n * Returns true if parameter has a positioned (x,y)\n * @param p Point, Arc or ArcPositiond\n * @returns\n */\nexport const isPositioned = (p) => typeof p.x !== `undefined` && typeof p.y !== `undefined`;\n/**\n * Returns an arc from degrees, rather than radians\n * @param radius Radius of arc\n * @param startDegrees Start angle in degrees\n * @param endDegrees End angle in degrees\n * @param origin Optional center of arc\n * @param clockwise Whether arc moves in clockwise direction\n * @returns Arc\n */\nexport function fromDegrees(radius, startDegrees, endDegrees, clockwise, origin) {\n    const a = {\n        radius,\n        startRadian: degreeToRadian(startDegrees),\n        endRadian: degreeToRadian(endDegrees),\n        clockwise\n    };\n    if (isPoint(origin)) {\n        guardPoint(origin);\n        const ap = {\n            ...a,\n            x: origin.x,\n            y: origin.y\n        };\n        return Object.freeze(ap);\n    }\n    else {\n        return Object.freeze(a);\n    }\n}\n/**\n * Returns a {@link Line} linking the start and end points of an {@link ArcPositioned}.\n *\n * @param arc\n * @returns Line from start to end of arc\n */\nexport const toLine = (arc) => LinesFromPoints(point(arc, arc.startRadian), point(arc, arc.endRadian));\n/**\n * Return start and end points of `arc`.\n * `origin` will override arc's origin, if defined.\n *\n * See also:\n * * {@link point} - get point on arc by angle\n * * {@link interpolate} - get point on arc by interpolation percentage\n * @param arc\n * @param origin\n * @returns\n */\nexport const getStartEnd = (arc, origin) => {\n    guard(arc);\n    const start = point(arc, arc.startRadian, origin);\n    const end = point(arc, arc.endRadian, origin);\n    return [start, end];\n};\n/**\n * Calculates a coordinate on an arc, based on an angle.\n * `origin` will override arc's origin, if defined.\n *\n * See also:\n * * {@link getStartEnd} - get start and end of arc\n * * {@link interpolate} - get point on arc by interpolation percentage\n * @param arc Arc\n * @param angleRadian Angle of desired coordinate\n * @param origin Origin of arc (0,0 used by default)\n * @returns Coordinate\n */\nexport const point = (arc, angleRadian, origin) => {\n    if (typeof origin === `undefined`) {\n        origin = isPositioned(arc) ? arc : { x: 0, y: 0 };\n    }\n    return {\n        x: (Math.cos(angleRadian) * arc.radius) + origin.x,\n        y: (Math.sin(angleRadian) * arc.radius) + origin.y\n    };\n};\n/**\n * Throws an error if arc instance is invalid\n * @param arc\n */\nexport const guard = (arc) => {\n    if (typeof arc === `undefined`)\n        throw new TypeError(`Arc is undefined`);\n    if (isPositioned(arc)) {\n        guardPoint(arc, `arc`);\n    }\n    if (typeof arc.radius === `undefined`)\n        throw new TypeError(`Arc radius is undefined (${JSON.stringify(arc)})`);\n    if (typeof arc.radius !== `number`)\n        throw new TypeError(`Radius must be a number`);\n    if (Number.isNaN(arc.radius))\n        throw new TypeError(`Radius is NaN`);\n    if (arc.radius <= 0)\n        throw new TypeError(`Radius must be greater than zero`);\n    if (typeof arc.startRadian === `undefined`)\n        throw new TypeError(`Arc is missing 'startRadian' field`);\n    if (typeof arc.endRadian === `undefined`)\n        throw new TypeError(`Arc is missing 'startRadian' field`);\n    if (Number.isNaN(arc.endRadian))\n        throw new TypeError(`Arc endRadian is NaN`);\n    if (Number.isNaN(arc.startRadian))\n        throw new TypeError(`Arc endRadian is NaN`);\n    if (typeof arc.clockwise === `undefined`)\n        throw new TypeError(`Arc is missing 'clockwise field`);\n    if (arc.startRadian >= arc.endRadian)\n        throw new TypeError(`startRadian is expected to be les than endRadian`);\n};\n/**\n * Compute relative position on arc.\n *\n * See also:\n * * {@link getStartEnd} - get start and end of arc\n * * {@link point} - get point on arc by angle\n * @param arc Arc\n * @param amount Relative position 0-1\n * @param origin If arc is not positioned, pass in an origin\n * @param allowOverflow If _true_ allows point to overflow arc dimensions (default: _false_)\n * @returns\n */\nexport const interpolate = (amount, arc, allowOverflow, origin) => {\n    guard(arc);\n    const overflowOk = allowOverflow ?? false;\n    if (!overflowOk) {\n        if (amount < 0)\n            throw new Error(`Param 'amount' is under zero, and overflow is not allowed`);\n        if (amount > 1)\n            throw new Error(`Param 'amount' is above 1 and overflow is not allowed`);\n    }\n    const span = angularSize(arc); // angular size\n    const rel = span * amount;\n    const angle = radiansSum(arc.startRadian, rel, arc.clockwise);\n    //console.log(`interpolate span: ${ span.toFixed(2) } rel: ${ rel.toFixed(2) } angle: ${ angle.toFixed(2) } amt: ${ amount.toFixed(2) } cw: ${ arc.clockwise } start: ${ arc.startRadian }`);\n    return point(arc, angle, origin);\n    //return point(arc, arc.startRadian + ((arc.endRadian - arc.startRadian) * amount), origin);\n};\n/**\n * Returns the angular size of arc.\n * Eg if arc runs from 45-315deg in clockwise direction, size will be 90deg.\n * @param arc\n */\nexport const angularSize = (arc) => radianArc(arc.startRadian, arc.endRadian, arc.clockwise);\n/**\n * Creates a {@link Path} instance from the arc. This wraps up some functions for convienence.\n * @param arc\n * @returns Path\n */\nexport const toPath = (arc) => {\n    guard(arc);\n    return Object.freeze({\n        ...arc,\n        nearest: (_point) => { throw new Error(`not implemented`); },\n        interpolate: (amount) => interpolate(amount, arc),\n        bbox: () => bbox(arc),\n        length: () => length(arc),\n        toSvgString: () => toSvg(arc),\n        relativePosition: (_point, _intersectionThreshold) => {\n            throw new Error(`Not implemented`);\n        },\n        distanceToPoint: (_point) => {\n            throw new Error(`Not implemented`);\n        },\n        kind: `arc`\n    });\n};\n/**\n * Returns an arc based on a circle using start and end angles.\n * If you don't have the end angle, but rather the size of the arc, use {@link fromCircleAmount}\n * @param circle Circle\n * @param startRadian Start radian\n * @param endRadian End radian\n * @param clockwise Whether arc goes in a clockwise direction (default: true)\n * @returns\n */\nexport const fromCircle = (circle, startRadian, endRadian, clockwise = true) => {\n    const a = Object.freeze({\n        ...circle,\n        endRadian,\n        startRadian,\n        clockwise\n    });\n    return a;\n};\n/**\n * Returns an arc based on a circle, a start angle, and the size of the arc.\n * See {@link fromCircle} if you already have start and end angles.\n * @param circle Circle to base off\n * @param startRadian Starting angle\n * @param sizeRadian Size of arc\n * @param clockwise Whether arc moves in clockwise direction (default: true)\n * @returns\n */\nexport const fromCircleAmount = (circle, startRadian, sizeRadian, clockwise = true) => {\n    const endRadian = radiansSum(startRadian, sizeRadian, clockwise);\n    return fromCircle(circle, startRadian, endRadian);\n};\n/**\n * Calculates the length of the arc\n * @param arc\n * @returns Length\n */\nexport const length = (arc) => piPi * arc.radius * ((arc.startRadian - arc.endRadian) / piPi);\n/**\n * Calculates a {@link Rect} bounding box for arc.\n * @param arc\n * @returns Rectangle encompassing arc.\n */\nexport const bbox = (arc) => {\n    if (isPositioned(arc)) {\n        const middle = interpolate(0.5, arc);\n        const asLine = toLine(arc);\n        return pointsBbox(middle, asLine.a, asLine.b);\n    }\n    else {\n        return {\n            width: arc.radius * 2,\n            height: arc.radius * 2\n        };\n    }\n};\n/**\n * Creates an SV path snippet for arc\n * @returns\n */\n// eslint-disable-next-line unicorn/prevent-abbreviations\nexport const toSvg = (a, b, c, d, e) => {\n    if (isArc(a)) {\n        if (isPositioned(a)) {\n            if (isPoint(b)) {\n                // Passing in a origin override\n                return toSvgFull(b, a.radius, a.startRadian, a.endRadian, c);\n            }\n            else {\n                // Using origin in arc\n                return toSvgFull(a, a.radius, a.startRadian, a.endRadian, b);\n            }\n        }\n        else {\n            return isPoint(b) ? toSvgFull(b, a.radius, a.startRadian, a.endRadian, c) : toSvgFull({ x: 0, y: 0 }, a.radius, a.startRadian, a.endRadian);\n        }\n    }\n    else {\n        if (c === undefined)\n            throw new Error(`startAngle undefined`);\n        if (d === undefined)\n            throw new Error(`endAngle undefined`);\n        if (isPoint(a)) {\n            if (typeof b === `number` && typeof c === `number` && typeof d === `number`) {\n                return toSvgFull(a, b, c, d, e);\n            }\n            else {\n                throw new TypeError(`Expected (point, number, number, number). Missing a number param.`);\n            }\n        }\n        else {\n            throw new Error(`Expected (point, number, number, number). Missing first point.`);\n        }\n    }\n};\nconst toSvgFull = (origin, radius, startRadian, endRadian, opts) => {\n    // https://developer.mozilla.org/en-US/docs/Web/SVG/Tutorial/Paths\n    // A rx ry x-axis-rotation large-arc-flag sweep-flag x y\n    // a rx ry x-axis-rotation large-arc-flag sweep-flag dx dy\n    if (opts === undefined || typeof opts !== `object`)\n        opts = {};\n    const isFullCircle = endRadian - startRadian === 360;\n    const start = toCartesian(radius, endRadian - 0.01, origin);\n    const end = toCartesian(radius, startRadian, origin);\n    const { largeArc = false, sweep = false } = opts;\n    const d = [`\n    M ${start.x} ${start.y}\n    A ${radius} ${radius} 0 ${largeArc ? `1` : `0`} ${sweep ? `1` : `0`} ${end.x} ${end.y},\n  `];\n    if (isFullCircle)\n        d.push(`z`);\n    return d;\n};\n/**\n * Calculates the distance between the centers of two arcs\n * @param a\n * @param b\n * @returns Distance\n */\nexport const distanceCenter = (a, b) => pointsDistance(a, b);\n/**\n * Returns true if the two arcs have the same values\n *\n * ```js\n * const arcA = { radius: 5, endRadian: 0, startRadian: 1 };\n * const arcA = { radius: 5, endRadian: 0, startRadian: 1 };\n * arcA === arcB; // false, because object identities are different\n * Arcs.isEqual(arcA, arcB); // true, because values are identical\n * ```\n * @param a\n * @param b\n * @returns {boolean}\n */\nexport const isEqual = (a, b) => {\n    if (a.radius !== b.radius)\n        return false;\n    if (a.endRadian !== b.endRadian)\n        return false;\n    if (a.startRadian !== b.startRadian)\n        return false;\n    if (a.clockwise !== b.clockwise)\n        return false;\n    if (isPositioned(a) && isPositioned(b)) {\n        if (a.x !== b.x)\n            return false;\n        if (a.y !== b.y)\n            return false;\n        if (a.z !== b.z)\n            return false;\n    }\n    else if (!isPositioned(a) && !isPositioned(b)) {\n        // no-op\n    }\n    else\n        return false; // one is positioned one not\n    return true;\n};\n","export const isQuadraticBezier = (path) => path.quadratic !== undefined;\nexport const isCubicBezier = (path) => path.cubic1 !== undefined && path.cubic2 !== undefined;\n","import { Bezier as BezierLibrary } from 'bezier-js';\nimport { interpolate as LinesInterpolate } from '../line/interpolate.js';\nimport { fromTopLeft as RectsFromTopLeft } from '../rect/from-top-left.js';\nimport { isCubicBezier, isQuadraticBezier } from './guard.js';\nimport { to2d } from '../point/To.js';\nexport * from './bezier-type.js';\nexport * from './guard.js';\n/**\n * Returns a new quadratic bezier with specified bend amount\n *\n * @param {QuadraticBezier} b Curve\n * @param {number} [bend=0] Bend amount, from -1 to 1\n * @returns {QuadraticBezier}\n */\n// export const quadraticBend = (a: Point, b: Point, bend = 0): QuadraticBezier => quadraticSimple(a, b, bend);\n/**\n * Creates a simple quadratic bezier with a specified amount of 'bend'.\n * Bend of -1 will pull curve down, 1 will pull curve up. 0 is no curve.\n *\n * Use {@link interpolator} to calculate a point along the curve.\n * @param {Point} start Start of curve\n * @param {Point} end End of curve\n * @param {number} [bend=0] Bend amount, -1 to 1\n * @returns {QuadraticBezier}\n */\nexport const quadraticSimple = (start, end, bend = 0) => {\n    if (Number.isNaN(bend))\n        throw new Error(`bend is NaN`);\n    if (bend < -1 || bend > 1)\n        throw new Error(`Expects bend range of -1 to 1`);\n    const middle = LinesInterpolate(0.5, start, end);\n    let target = middle;\n    if (end.y < start.y) {\n        // Upward slope\n        target = bend > 0 ? { x: Math.min(start.x, end.x), y: Math.min(start.y, end.y) } :\n            { x: Math.max(start.x, end.x), y: Math.max(start.y, end.y) };\n    }\n    else {\n        // Downward slope\n        target = bend > 0 ? { x: Math.max(start.x, end.x), y: Math.min(start.y, end.y) } :\n            { x: Math.min(start.x, end.x), y: Math.max(start.y, end.y) };\n    }\n    const handle = LinesInterpolate(Math.abs(bend), middle, target);\n    return quadratic(start, end, handle);\n};\n/**\n * Returns a relative point on a simple quadratic\n * @param start Start\n * @param end  End\n * @param bend Bend (-1 to 1)\n * @param amt Amount\n * @returns Point\n */\n// export const computeQuadraticSimple = (start: Point, end: Point, bend: number, amt: number): Point => {\n//   const q = quadraticSimple(start, end, bend);\n//   const bzr = new BezierLibrary(q.a, q.quadratic, q.b);\n//   return bzr.compute(amt);\n// };\n/**\n * Interpolate cubic or quadratic bezier\n * ```js\n * const i = interpolator(myBezier);\n *\n * // Get point at 50%\n * i(0.5); // { x, y }\n * ```\n * @param q\n * @returns\n */\nexport const interpolator = (q) => {\n    //console.log(q);\n    //if (isCubicBezier(q)) console.log(`is cubic`);\n    //const bzr = isCubicBezier(q) ? new BezierLibrary(to2d(q.a), to2d(q.cubic1), to2d(q.cubic2), to2d(q.b)) : new BezierLibrary(q.a, q.quadratic, q.b);\n    const bzr = isCubicBezier(q) ?\n        new BezierLibrary(q.a.x, q.a.y, q.cubic1.x, q.cubic1.y, q.cubic2.x, q.cubic2.y, q.b.x, q.b.y) :\n        new BezierLibrary(q.a, q.quadratic, q.b);\n    return (amount) => bzr.compute(amount);\n};\n//https://developer.mozilla.org/en-US/docs/Web/SVG/Tutorial/Paths\nexport const quadraticToSvgString = (start, end, handle) => [`M ${start.x} ${start.y} Q ${handle.x} ${handle.y} ${end.x} ${end.y}`];\nexport const toPath = (cubicOrQuadratic) => {\n    if (isCubicBezier(cubicOrQuadratic)) {\n        return cubicToPath(cubicOrQuadratic);\n    }\n    else if (isQuadraticBezier(cubicOrQuadratic)) {\n        return quadratictoPath(cubicOrQuadratic);\n    }\n    else {\n        throw new Error(`Unknown bezier type`);\n    }\n};\nexport const cubic = (start, end, cubic1, cubic2) => ({\n    a: Object.freeze(start),\n    b: Object.freeze(end),\n    cubic1: Object.freeze(cubic1),\n    cubic2: Object.freeze(cubic2)\n});\nconst cubicToPath = (cubic) => {\n    const { a, cubic1, cubic2, b } = cubic;\n    const bzr = new BezierLibrary(a, cubic1, cubic2, b);\n    return Object.freeze({\n        ...cubic,\n        length: () => bzr.length(),\n        interpolate: (t) => bzr.compute(t),\n        nearest: (_) => { throw new Error(`not implemented`); },\n        bbox: () => {\n            const { x, y } = bzr.bbox();\n            const xSize = x.size;\n            const ySize = y.size;\n            if (xSize === undefined)\n                throw new Error(`x.size not present on calculated bbox`);\n            if (ySize === undefined)\n                throw new Error(`x.size not present on calculated bbox`);\n            return RectsFromTopLeft({ x: x.min, y: y.min }, xSize, ySize);\n        },\n        relativePosition: (_point, _intersectionThreshold) => {\n            throw new Error(`Not implemented`);\n        },\n        distanceToPoint: (_point) => {\n            throw new Error(`Not implemented`);\n        },\n        toSvgString: () => [`brrup`],\n        kind: `bezier/cubic`\n    });\n};\nexport const quadratic = (start, end, handle) => ({\n    a: Object.freeze(start),\n    b: Object.freeze(end),\n    quadratic: Object.freeze(handle)\n});\nconst quadratictoPath = (quadraticBezier) => {\n    const { a, b, quadratic } = quadraticBezier;\n    const bzr = new BezierLibrary(a, quadratic, b);\n    return Object.freeze({\n        ...quadraticBezier,\n        length: () => bzr.length(),\n        interpolate: (t) => bzr.compute(t),\n        nearest: (_) => { throw new Error(`not implemented`); },\n        bbox: () => {\n            const { x, y } = bzr.bbox();\n            const xSize = x.size;\n            const ySize = y.size;\n            if (xSize === undefined)\n                throw new Error(`x.size not present on calculated bbox`);\n            if (ySize === undefined)\n                throw new Error(`x.size not present on calculated bbox`);\n            return RectsFromTopLeft({ x: x.min, y: y.min }, xSize, ySize);\n        },\n        distanceToPoint: (_point) => {\n            throw new Error(`Not implemented`);\n        },\n        relativePosition: (_point, _intersectionThreshold) => {\n            throw new Error(`Not implemented`);\n        },\n        toString: () => bzr.toString(),\n        toSvgString: () => quadraticToSvgString(a, b, quadratic),\n        kind: `bezier/quadratic`\n    });\n};\n","import { guard } from \"./guard.js\";\n/**\n * Returns the area of `circle`.\n * @param circle\n * @returns\n */\nexport const area = (circle) => {\n    guard(circle);\n    return Math.PI * circle.radius * circle.radius;\n};\n","import { isCirclePositioned } from \"./guard.js\";\nimport { fromCenter as RectsFromCenter } from '../rect/from-center.js';\n/**\n * Computes a bounding box that encloses circle\n * @param circle\n * @returns\n */\nexport const bbox = (circle) => {\n    return isCirclePositioned(circle) ?\n        RectsFromCenter(circle, circle.radius * 2, circle.radius * 2) :\n        { width: circle.radius * 2, height: circle.radius * 2, x: 0, y: 0 };\n};\n","import { isCirclePositioned } from \"./guard.js\";\n/**\n * Returns the center of a circle\n *\n * If the circle has an x,y, that is the center.\n * If not, `radius` is used as the x and y.\n *\n * ```js\n * const circle = { radius: 5, x: 10, y: 10};\n *\n * // Yields: { x: 5, y: 10 }\n * Circles.center(circle);\n * ```\n *\n * It's a trivial function, but can make for more understandable code\n * @param circle\n * @returns Center of circle\n */\nexport const center = (circle) => {\n    return isCirclePositioned(circle) ? Object.freeze({ x: circle.x, y: circle.y }) : Object.freeze({ x: circle.radius, y: circle.radius });\n};\n","/**\n * Yields the points making up the exterior (ie. circumference) of the circle.\n * Uses [Midpoint Circle Algorithm](http://en.wikipedia.org/wiki/Midpoint_circle_algorithm)\n *\n * @example Draw outline of circle\n * ```js\n * const circle = { x: 100, y: 100, radius: 50 }\n * for (const pt of Circles.exteriorIntegerPoints(circle)) {\n *  // Fill 1x1 pixel\n *  ctx.fillRect(pt.x, pt.y, 1, 1);\n * }\n * ```\n * @param circle\n */\nexport function* exteriorIntegerPoints(circle) {\n    const { x, y, radius } = circle;\n    let xx = radius;\n    let yy = 0;\n    let radiusError = 1 - x;\n    while (xx >= yy) {\n        yield { x: xx + x, y: yy + y };\n        yield { x: yy + x, y: xx + y };\n        yield { x: -xx + x, y: yy + y };\n        yield { x: -yy + x, y: xx + y };\n        yield { x: -xx + x, y: -yy + y };\n        yield { x: -yy + x, y: -xx + y };\n        yield { x: xx + x, y: -yy + y };\n        yield { x: yy + x, y: -xx + y };\n        yy++;\n        if (radiusError < 0) {\n            radiusError += 2 * yy + 1;\n        }\n        else {\n            xx--;\n            radiusError += 2 * (yy - xx + 1);\n        }\n    }\n}\n","import { distance } from \"../point/distance.js\";\n/**\n * Returns all integer points contained within `circle`.\n *\n * ```js\n * const c = { x:100, y:100, radius:100 };\n * for (const pt of Circles.interiorIntegerPoints(c)) {\n *   ctx.fillRect(pt.x, pt.y, 1, 1);\n * }\n * ```\n * @param circle\n */\nexport function* interiorIntegerPoints(circle) {\n    const xMin = circle.x - circle.radius;\n    const xMax = circle.x + circle.radius;\n    const yMin = circle.y - circle.radius;\n    const yMax = circle.y + circle.radius;\n    for (let x = xMin; x < xMax; x++) {\n        for (let y = yMin; y < yMax; y++) {\n            const r = Math.abs(distance(circle, x, y));\n            if (r <= circle.radius)\n                yield { x, y };\n        }\n    }\n}\n","import { guard, isCirclePositioned } from \"./guard.js\";\nimport { distance as PointsDistance } from \"../point/distance.js\";\nimport { minIndex } from \"@ixfx/numbers\";\nconst piPi = Math.PI * 2;\n/**\n * Returns the nearest point on `circle`'s perimeter closest to `point`.\n *\n * ```js\n * const pt = Circles.nearest(circle, {x:10,y:10});\n * ```\n *\n * If an array of circles is provided, it will be the closest point amongst all the circles\n * @param circle Circle or array of circles\n * @param point\n * @returns Point `{ x, y }`\n */\nexport const nearest = (circle, point) => {\n    const n = (a) => {\n        const l = Math.sqrt(Math.pow(point.x - a.x, 2) + Math.pow(point.y - a.y, 2));\n        const x = a.x + (a.radius * ((point.x - a.x) / l));\n        const y = a.y + (a.radius * ((point.y - a.y) / l));\n        return { x, y };\n    };\n    if (Array.isArray(circle)) {\n        const pts = circle.map(l => n(l));\n        const dists = pts.map(p => PointsDistance(p, point));\n        return Object.freeze(pts[minIndex(...dists)]);\n    }\n    else {\n        return Object.freeze(n(circle));\n    }\n};\n/**\n * Returns a point on a circle's perimeter at a specified angle in radians\n *\n * ```js\n * // Circle without position\n * const circleA = { radius: 5 };\n *\n * // Get point at angle Math.PI, passing in a origin coordinate\n * const ptA = Circles.pointOnPerimeter(circleA, Math.PI, {x: 10, y: 10 });\n *\n * // Point on circle with position\n * const circleB = { radius: 5, x: 10, y: 10};\n * const ptB = Circles.pointOnPerimeter(circleB, Math.PI);\n * ```\n * @param circle\n * @param angleRadian Angle in radians\n * @param origin or offset of calculated point. By default uses center of circle or 0,0 if undefined\n * @returns Point oo circle\n */\nexport const pointOnPerimeter = (circle, angleRadian, origin) => {\n    if (origin === undefined) {\n        origin = isCirclePositioned(circle) ? circle : { x: 0, y: 0 };\n    }\n    return {\n        x: (Math.cos(-angleRadian) * circle.radius) + origin.x,\n        y: (Math.sin(-angleRadian) * circle.radius) + origin.y\n    };\n};\n/**\n * Returns circumference of `circle` (alias of {@link length})\n * @param circle\n * @returns\n */\nexport const circumference = (circle) => {\n    guard(circle);\n    return piPi * circle.radius;\n};\n/**\n * Returns circumference of `circle` (alias of {@link circumference})\n * @param circle\n * @returns\n */\nexport const length = (circle) => circumference(circle);\n","import { pointOnPerimeter } from \"./perimeter.js\";\nconst piPi = Math.PI * 2;\n/**\n * Computes relative position along circle perimeter\n *\n * ```js\n * const circle = { radius: 100, x: 100, y: 100 };\n *\n * // Get a point halfway around circle\n * // Yields { x, y }\n * const pt = Circles.interpolate(circle, 0.5);\n * ```\n * @param circle\n * @param t Position, 0-1\n * @returns\n */\nexport const interpolate = (circle, t) => pointOnPerimeter(circle, t * piPi);\n","import { isPoint } from \"../point/guard.js\";\nimport { distanceCenter } from \"./distance-center.js\";\nimport { isCircle } from \"./guard.js\";\n/**\n * Returns true if `b` is completely contained by `a`\n *\n * ```js\n * // Compare two points\n * isContainedBy(circleA, circleB);\n *\n * // Compare a circle with a point\n * isContainedBy(circleA, {x: 10, y: 20});\n *\n * // Define radius as third parameter\n * isContainedBy(circleA, {x: 10, y: 20}, 20);\n * ```\n * @param a Circle\n * @param b Circle or point to compare to\n * @param c Radius to accompany parameter b if it's a point\n * @returns\n */\nexport const isContainedBy = (a, b, c) => {\n    const d = distanceCenter(a, b);\n    if (isCircle(b)) {\n        return (d < Math.abs(a.radius - b.radius));\n    }\n    else if (isPoint(b)) {\n        // eslint-disable-next-line unicorn/prefer-ternary\n        if (c === undefined) {\n            return d <= a.radius;\n        }\n        else {\n            // Defining a circle\n            return (d < Math.abs(a.radius - c));\n        }\n    }\n    else\n        throw new Error(`b parameter is expected to be CirclePositioned or Point`);\n};\n","import * as Intersects from '../intersects.js';\nimport { isContainedBy } from \"./is-contained-by.js\";\nimport { isCircle } from \"./guard.js\";\nimport { isRectPositioned } from \"../rect/guard.js\";\nimport { isEqual as PointsIsEqual } from \"../point/is-equal.js\";\nimport { isPoint } from '../point/guard.js';\n/**\n * Returns true if `a` or `b` overlap, are equal, or `a` contains `b`.\n * A circle can be checked for intersections with another CirclePositioned, Point or RectPositioned.\n *\n * Use `intersections` to find the points of intersection.\n *\n * @param a Circle\n * @param b Circle or point to test\n * @returns True if circle overlap\n */\nexport const isIntersecting = (a, b, c) => {\n    if (PointsIsEqual(a, b))\n        return true;\n    if (isContainedBy(a, b, c))\n        return true;\n    if (isCircle(b)) {\n        return Intersects.circleCircle(a, b);\n    }\n    else if (isRectPositioned(b)) {\n        return Intersects.circleRect(a, b);\n    }\n    else if (isPoint(b) && c !== undefined) {\n        return Intersects.circleCircle(a, { ...b, radius: c });\n    }\n    return false;\n};\n","import { isCirclePositioned } from \"./guard.js\";\nimport { multiplyScalar as PointsMultiplyScalar } from '../point/multiply.js';\n/**\n * Multiplies a circle's radius and position (if provided) by `value`.\n *\n * ```js\n * multiplyScalar({ radius: 5 }, 5);\n * // Yields: { radius: 25 }\n *\n * multiplyScalar({ radius: 5, x: 10, y: 20 }, 5);\n * // Yields: { radius: 25, x: 50, y: 100 }\n * ```\n */\nexport function multiplyScalar(a, value) {\n    if (isCirclePositioned(a)) {\n        const pt = PointsMultiplyScalar(a, value);\n        return Object.freeze({\n            ...a,\n            ...pt,\n            radius: a.radius * value\n        });\n    }\n    else {\n        return Object.freeze({\n            ...a,\n            radius: a.radius * value\n        });\n    }\n}\n","import { isCirclePositioned } from \"./guard.js\";\nimport { sum as PointsSum } from \"../point/sum.js\";\nimport { toCartesian as PolarToCartesian } from \"../polar/index.js\";\nconst piPi = Math.PI * 2;\n/**\n * Returns a random point within a circle.\n *\n * By default creates a uniform distribution.\n *\n * ```js\n * const pt = randomPoint({radius: 5});\n * const pt = randomPoint({radius: 5, x: 10, y: 20});\n * ```'\n *\n * Generate points with a gaussian distribution\n * ```js\n * const pt = randomPoint(circle, {\n *  randomSource: Random.gaussian\n * })\n * ```\n * @param within Circle to generate a point within\n * @param opts Options\n * @returns\n */\nexport const randomPoint = (within, opts = {}) => {\n    const offset = isCirclePositioned(within) ? within : { x: 0, y: 0 };\n    const strategy = opts.strategy ?? `uniform`;\n    const margin = opts.margin ?? 0;\n    const radius = within.radius - margin;\n    const rand = opts.randomSource ?? Math.random;\n    switch (strategy) {\n        case `naive`: {\n            return PointsSum(offset, PolarToCartesian(rand() * radius, rand() * piPi));\n        }\n        case `uniform`: {\n            return PointsSum(offset, PolarToCartesian(Math.sqrt(rand()) * radius, rand() * piPi));\n        }\n        default: {\n            throw new Error(`Unknown strategy '${strategy}'. Expects 'uniform' or 'naive'`);\n        }\n    }\n};\n","import { isCircle, isCirclePositioned } from \"./guard.js\";\n/**\n * Creates a SVG path segment.\n * @param a Circle or radius\n * @param sweep If true, path is 'outward'\n * @param origin Origin of path. Required if first parameter is just a radius or circle is non-positioned\n * @returns\n */\nexport const toSvg = (a, sweep, origin) => {\n    if (isCircle(a)) {\n        if (origin !== undefined) {\n            return toSvgFull(a.radius, origin, sweep);\n        }\n        if (isCirclePositioned(a)) {\n            return toSvgFull(a.radius, a, sweep);\n        }\n        else\n            throw new Error(`origin parameter needed for non-positioned circle`);\n    }\n    else {\n        if (origin === undefined) {\n            throw new Error(`origin parameter needed`);\n        }\n        else {\n            return toSvgFull(a, origin, sweep);\n        }\n    }\n};\nconst toSvgFull = (radius, origin, sweep) => {\n    // https://stackoverflow.com/questions/5737975/circle-drawing-with-svgs-arc-path\n    const { x, y } = origin;\n    const s = sweep ? `1` : `0`;\n    return `\n    M ${x}, ${y}\n    m -${radius}, 0\n    a ${radius},${radius} 0 1,${s} ${radius * 2},0\n    a ${radius},${radius} 0 1,${s} -${radius * 2},0\n  `.split(`\\n`);\n};\n","import { bbox } from \"./bbox.js\";\nimport { guard } from \"./guard.js\";\nimport { interpolate } from \"./interpolate.js\";\nimport { nearest } from \"./perimeter.js\";\nimport { toSvg } from \"./svg.js\";\nimport { circumference } from \"./perimeter.js\";\n/**\n * Returns a `CircularPath` representation of a circle\n *\n * @param {CirclePositioned} circle\n * @returns {CircularPath}\n */\nexport const toPath = (circle) => {\n    guard(circle);\n    return {\n        ...circle,\n        nearest: (point) => nearest(circle, point),\n        /**\n         * Returns a relative (0.0-1.0) point on a circle. 0=3 o'clock, 0.25=6 o'clock, 0.5=9 o'clock, 0.75=12 o'clock etc.\n         * @param {t} Relative (0.0-1.0) point\n         * @returns {Point} X,y\n         */\n        interpolate: (t) => interpolate(circle, t),\n        bbox: () => bbox(circle),\n        length: () => circumference(circle),\n        toSvgString: (sweep = true) => toSvg(circle, sweep),\n        relativePosition: (_point, _intersectionThreshold) => {\n            throw new Error(`Not implemented`);\n        },\n        distanceToPoint: (_point) => {\n            throw new Error(`Not implemented`);\n        },\n        kind: `circular`\n    };\n};\n","import { isCirclePositioned } from \"./guard.js\";\nimport { getPointParameter } from \"../point/get-point-parameter.js\";\n/**\n * Returns a positioned version of a circle.\n * If circle is already positioned, it is returned.\n * If no default position is supplied, 0,0 is used.\n * @param circle\n * @param defaultPositionOrX\n * @param y\n * @returns\n */\nexport const toPositioned = (circle, defaultPositionOrX, y) => {\n    if (isCirclePositioned(circle))\n        return circle;\n    // Returns 0,0 if params are undefined\n    const pt = getPointParameter(defaultPositionOrX, y);\n    return Object.freeze({\n        ...circle,\n        ...pt\n    });\n};\n","export * from './area.js';\nexport * from './bbox.js';\nexport * from './center.js';\nexport * from './circular-path.js';\nexport * from './distance-center.js';\nexport * from './distance-from-exterior.js';\nexport * from './exterior-points.js';\nexport * from './guard.js';\nexport * from './interior-points.js';\nexport * from './interpolate.js';\nexport * from './intersecting.js';\nexport * from './intersections.js';\nexport * from './is-contained-by.js';\nexport * from './is-equal.js';\nexport * from './multiply.js';\nexport * from './perimeter.js';\nexport * from './random.js';\nexport * from './svg.js';\nexport * from './to-path.js';\nexport * from './to-positioned.js';\n","/**\n * Returns _true_ if cell coordinates are above zero and within bounds of grid\n *\n * @param grid\n * @param cell\n * @return\n */\nexport const inside = (grid, cell) => {\n    if (cell.x < 0 || cell.y < 0)\n        return false;\n    if (cell.x >= grid.cols || cell.y >= grid.rows)\n        return false;\n    return true;\n};\n","import { inside } from \"./inside.js\";\n/**\n * Returns true if `cell` parameter is a cell with x,y fields.\n * Does not check validity of fields.\n *\n * @param cell\n * @return True if parameter is a cell\n */\nexport const isCell = (cell) => {\n    if (cell === undefined)\n        return false;\n    return `x` in cell && `y` in cell;\n};\n/**\n * Throws an exception if any of the cell's parameters are invalid\n * @private\n * @param cell\n * @param parameterName\n * @param grid\n */\nexport const guardCell = (cell, parameterName = `Param`, grid) => {\n    if (cell === undefined) {\n        throw new Error(parameterName + ` is undefined. Expecting {x,y}`);\n    }\n    if (cell.x === undefined)\n        throw new Error(parameterName + `.x is undefined`);\n    if (cell.y === undefined)\n        throw new Error(parameterName + `.y is undefined`);\n    if (Number.isNaN(cell.x))\n        throw new Error(parameterName + `.x is NaN`);\n    if (Number.isNaN(cell.y))\n        throw new Error(parameterName + `.y is NaN`);\n    if (!Number.isInteger(cell.x)) {\n        throw new TypeError(parameterName + `.x is non-integer`);\n    }\n    if (!Number.isInteger(cell.y)) {\n        throw new TypeError(parameterName + `.y is non-integer`);\n    }\n    if (grid !== undefined && !inside(grid, cell)) {\n        throw new Error(`${parameterName} is outside of grid. Cell: ${cell.x},${cell.y} Grid: ${grid.cols}, ${grid.rows}`);\n    }\n};\n/**\n * Throws an exception if any of the grid's parameters are invalid\n * @param grid\n * @param parameterName\n */\nexport const guardGrid = (grid, parameterName = `Param`) => {\n    if (grid === undefined) {\n        throw new Error(`${parameterName} is undefined. Expecting grid.`);\n    }\n    if (!(`rows` in grid))\n        throw new Error(`${parameterName}.rows is undefined`);\n    if (!(`cols` in grid))\n        throw new Error(`${parameterName}.cols is undefined`);\n    if (!Number.isInteger(grid.rows)) {\n        throw new TypeError(`${parameterName}.rows is not an integer`);\n    }\n    if (!Number.isInteger(grid.cols)) {\n        throw new TypeError(`${parameterName}.cols is not an integer`);\n    }\n};\n","import { clampIndex } from \"@ixfx/numbers\";\nimport { guardCell, guardGrid } from \"./guards.js\";\n/**\n * Calculates a legal position for a cell based on\n * `grid` size and `bounds` wrapping logic.\n * @param grid\n * @param cell\n * @param wrap\n * @returns\n */\nexport const applyBounds = function (grid, cell, wrap = `undefined`) {\n    guardGrid(grid, `grid`);\n    guardCell(cell, `cell`);\n    let x = cell.x;\n    let y = cell.y;\n    switch (wrap) {\n        case `wrap`: {\n            x = x % grid.cols;\n            y = y % grid.rows;\n            if (x < 0)\n                x = grid.cols + x;\n            else if (x >= grid.cols) {\n                x -= grid.cols;\n            }\n            if (y < 0)\n                y = grid.rows + y;\n            else if (y >= grid.rows) {\n                y -= grid.rows;\n            }\n            x = Math.abs(x);\n            y = Math.abs(y);\n            break;\n        }\n        case `stop`: {\n            x = clampIndex(x, grid.cols);\n            y = clampIndex(y, grid.rows);\n            break;\n        }\n        case `undefined`: {\n            if (x < 0 || y < 0)\n                return;\n            if (x >= grid.cols || y >= grid.rows)\n                return;\n            break;\n        }\n        case `unbounded`: {\n            break;\n        }\n        default: {\n            throw new Error(`Unknown BoundsLogic '${wrap}'. Expected: wrap, stop, undefined or unbounded`);\n        }\n    }\n    return Object.freeze({ x, y });\n};\n","import { integerTest, resultThrow } from \"@ixfx/guards\";\nimport { indexFromCell } from \"./index.js\";\n/**\n * Returns a {@link GridCellAccessor} to get values from `array`\n * based on cell (`{x,y}`) coordinates.\n *\n * ```js\n * const arr = [\n *  1,2,3,\n *  4,5,6\n * ]\n * const a = access(arr, 3);\n * a({x:0,y:0});  // 1\n * a({x:2, y:2}); // 6\n * ```\n * @param array\n * @param cols\n * @returns\n */\nexport const access = (array, cols) => {\n    const grid = gridFromArrayDimensions(array, cols);\n    const fn = (cell, wrap = `undefined`) => accessWithGrid(grid, array, cell, wrap);\n    return fn;\n};\nconst accessWithGrid = (grid, array, cell, wrap) => {\n    const index = indexFromCell(grid, cell, wrap);\n    if (index === undefined)\n        return undefined;\n    return array[index];\n};\n/**\n * Returns a {@link GridCellSetter} that can mutate\n * array values based on cell {x,y} positions.\n * ```js\n * const arr = [\n *  1,2,3,\n *  4,5,6\n * ]\n * const a = setMutate(arr, 3);\n * a(10, {x:0,y:0});\n * a(20, {x:2, y:2});\n *\n * // Arr is now:\n * // [\n * //  10, 2, 3,\n * //  4, 5, 20\n * // ]\n * ```\n * @param array\n * @param cols\n * @returns\n */\nexport const setMutate = (array, cols) => {\n    const grid = gridFromArrayDimensions(array, cols);\n    return (value, cell, wrap = `undefined`) => setMutateWithGrid(grid, array, value, cell, wrap);\n};\nconst setMutateWithGrid = (grid, array, value, cell, wrap) => {\n    const index = indexFromCell(grid, cell, wrap);\n    if (index === undefined)\n        throw new RangeError(`Cell (${cell.x},${cell.y}) is out of range of grid cols: ${grid.cols} rows: ${grid.rows}`);\n    array[index] = value;\n    return array;\n};\nexport const set = (array, cols) => {\n    const grid = gridFromArrayDimensions(array, cols);\n    return (value, cell, wrap) => setWithGrid(grid, array, value, cell, wrap);\n};\nconst setWithGrid = (grid, array, value, cell, wrap) => {\n    const index = indexFromCell(grid, cell, wrap);\n    if (index === undefined)\n        throw new RangeError(`Cell (${cell.x},${cell.y}) is out of range of grid cols: ${grid.cols} rows: ${grid.rows}`);\n    const copy = [...array];\n    copy[index] = value;\n    array = copy;\n    return copy;\n};\n/**\n * Creates a {@link Grid} from the basis of an array and a given number of columns\n * @param array\n * @param cols\n * @returns\n */\nconst gridFromArrayDimensions = (array, cols) => {\n    const grid = { cols, rows: Math.ceil(array.length / cols) };\n    return grid;\n};\n/**\n * Wraps `array` for grid access.\n * Mutable, meaning that `array` gets modified if `set` function is used.\n *\n * ```js\n * const g = wrapMutable(myArray, 5); // 5 columns wide\n * g.get({x:1,y:2});     // Get value at cell position\n * g.set(10, {x:1,y:2}); // Set value at cell position\n * g.array;              // Get reference to original passed-in array\n * ```\n *\n * Use {@link wrap} for an immutable version.\n *\n * @param array Array to wrap\n * @param cols Width of grid\n * @returns\n */\nexport const wrapMutable = (array, cols) => {\n    const grid = gridFromArrayDimensions(array, cols);\n    return {\n        ...grid,\n        get: access(array, cols),\n        set: setMutate(array, cols),\n        get array() {\n            return array;\n        }\n    };\n};\n/**\n * Wraps `array` for grid access.\n * Immutable, such that underlying array is not modified and a\n * call to `set` returns a new `GridArray1d`.\n *\n * ```js\n * const myArray = [\n *    `a`, `b`, `c`,\n *    `d`, `e`, `f`\n * ];\n * let g = wrap(myArray, 3);  // 3 columns wide\n * g.get({ x:1, y:2 });          // Get value at cell position\n *\n * // Note that `set` returns a new instance\n * g = g.set(10, { x:1, y:2 });  // Set value at cell position\n * g.array;                      // Get reference to current array\n * ```\n *\n * Use {@link wrapMutable} to modify an array in-place\n * @param array Array to wrap\n * @param cols Width of grid\n * @returns\n */\nexport const wrap = (array, cols) => {\n    const grid = gridFromArrayDimensions(array, cols);\n    return {\n        ...grid,\n        get: (cell, boundsLogic = `undefined`) => accessWithGrid(grid, array, cell, boundsLogic),\n        set: (value, cell, boundsLogic = `undefined`) => {\n            array = setWithGrid(grid, array, value, cell, boundsLogic);\n            return wrap(array, cols);\n        },\n        get array() {\n            return array;\n        }\n    };\n};\n/**\n * Creates a 1-dimensional array to fit a grid of rows x cols.\n * Use {@link createArray} if you want to create this array and wrap it for grid access.\n *\n * ```js\n * // Creates an array filled with 0, sized for a grid 10 rows by 20 columns\n * const arr = createArray(0, 10, 20);\n *\n * // Alternatively, pass in a grid\n * const arr = createArray(0, { rows: 10, cols: 20 });\n * ```\n * @param rowsOrGrid Number of rows, or a grid to use the settings of\n * @param columns Columns\n */\nexport const createArray = (initialValue, rowsOrGrid, columns) => {\n    const rows = typeof rowsOrGrid === `number` ? rowsOrGrid : rowsOrGrid.rows;\n    const cols = typeof rowsOrGrid === `object` ? rowsOrGrid.cols : columns;\n    if (!cols)\n        throw new Error(`Parameter 'columns' missing`);\n    resultThrow(integerTest(rows, `aboveZero`, `rows`), integerTest(cols, `aboveZero`, `cols`));\n    const t = [];\n    const total = rows * cols;\n    for (let index = 0; index < total; index++) {\n        t[index] = initialValue;\n    }\n    return t;\n};\n/**\n * Creates a {@link GridArray1d} instance given the dimensions of the grid.\n * Use {@link createArray} if you just want to create an array sized for a grid.\n *\n * Behind the scenes, it runs:\n * ```js\n * const arr = createArray(initialValue, rows, cols);\n * return wrapMutable(arr, cols);\n * ```\n * @param initialValue\n * @param rowsOrGrid\n * @param columns\n * @returns\n */\nexport const createMutable = (initialValue, rowsOrGrid, columns) => {\n    const rows = typeof rowsOrGrid === `number` ? rowsOrGrid : rowsOrGrid.rows;\n    const cols = typeof rowsOrGrid === `object` ? rowsOrGrid.cols : columns;\n    if (!cols)\n        throw new Error(`Parameter 'columns' missing`);\n    const array = createArray(initialValue, rows, cols);\n    return wrapMutable(array, cols);\n};\n","import { applyBounds } from \"./apply-bounds.js\";\n/**\n * Create a grid from a 2-dimensional array.\n * ```js\n * const data = [\n *  [1,2,3],\n *  [4,5,6]\n * ]\n * const g = create(data);\n * // { rows: 2, cols: 3 }\n * ```\n * @param array\n * @returns\n */\nexport const create = (array) => {\n    let colLen = NaN;\n    for (const row of array) {\n        if (Number.isNaN(colLen)) {\n            colLen = row.length;\n        }\n        else {\n            if (colLen !== row.length)\n                throw new Error(`Array does not have uniform column length`);\n        }\n    }\n    return { rows: array.length, cols: colLen };\n};\nexport const setMutate = (array) => {\n    const grid = create(array);\n    return (value, cell, wrap = `undefined`) => setMutateWithGrid(grid, array, value, cell, wrap);\n};\n/**\n * Returns a function that updates a 2D array representation\n * of a grid. Array is mutated.\n *\n * ```js\n * const m = Grids.Array2d.setMutateWithGrid(grid, array);\n * m(someValue, { x:2, y:3 });\n * ```\n * @param grid\n * @param array\n * @returns\n */\nconst setMutateWithGrid = (grid, array, value, cell, bounds) => {\n    let boundCell = applyBounds(grid, cell, bounds);\n    if (boundCell === undefined)\n        throw new RangeError(`Cell (${cell.x},${cell.y}) is out of range of grid cols: ${grid.cols} rows: ${grid.rows}`);\n    array[boundCell.y][boundCell.x] = value;\n    return array;\n};\n// export const array2dUpdater = <V>(grid: GridVisual, array: Array<Array<V>>) => {\n//   const fn = (v: V, position: Cell) => {\n//     const pos = cellAtPoint(grid, position);\n//     if (pos === undefined) {\n//       throw new Error(\n//         `Position does not exist. Pos: ${ JSON.stringify(\n//           position\n//         ) } Grid: ${ JSON.stringify(grid) }`\n//       );\n//     }\n//     array[ pos.y ][ pos.x ] = v;\n//   };\n//   return fn;\n// };\nexport const access = (array) => {\n    const grid = create(array);\n    const fn = (cell, wrap = `undefined`) => accessWithGrid(grid, array, cell, wrap);\n    return fn;\n};\nconst accessWithGrid = (grid, array, cell, wrap) => {\n    let boundCell = applyBounds(grid, cell, wrap);\n    if (boundCell === undefined)\n        return undefined;\n    return array[boundCell.y][boundCell.x];\n};\nexport const wrapMutable = (array) => {\n    const grid = create(array);\n    return {\n        ...grid,\n        get: access(array),\n        set: setMutate(array),\n        get array() {\n            return array;\n        }\n    };\n};\nexport const set = (array) => {\n    const grid = create(array);\n    return (value, cell, wrap) => setWithGrid(grid, array, value, cell, wrap);\n};\nconst setWithGrid = (grid, array, value, cell, wrap) => {\n    let boundCell = applyBounds(grid, cell, wrap);\n    if (boundCell === undefined)\n        throw new RangeError(`Cell (${cell.x},${cell.y}) is out of range of grid cols: ${grid.cols} rows: ${grid.rows}`);\n    let copyWhole = [...array];\n    let copyRow = [...copyWhole[boundCell.y]];\n    copyRow[boundCell.x] = value;\n    copyWhole[boundCell.y] = copyRow;\n    array = copyWhole;\n    return copyWhole;\n};\n/**\n * Wraps `array` with two dimensions for grid access.\n * Immutable, such that underlying array is not modified and a\n * call to `set` returns a new `GridArray1d`.\n *\n * ```js\n * // Grid of rows: 2, cols: 3\n * const myArray = [\n *  [ `a`, `b`, `c` ],\n *  [ `d`, `e`, `f` ]\n * ]\n * let g = wrap(myArray);\n * g.get({x:1,y:2});          // Get value at cell position\n * g = g.set(10, {x:1,y:2}); // Set value at cell position\n * g.array;                  // Get reference to current array\n * ```\n *\n * Use {@link wrapMutable} to modify an array in-place\n * @param array Array to wrap\n * @returns\n */\nexport const wrap = (array) => {\n    const grid = create(array);\n    return {\n        ...grid,\n        get: (cell, boundsLogic = `undefined`) => accessWithGrid(grid, array, cell, boundsLogic),\n        set: (value, cell, boundsLogic = `undefined`) => {\n            array = setWithGrid(grid, array, value, cell, boundsLogic);\n            return wrap(array);\n        },\n        get array() {\n            return array;\n        }\n    };\n};\n","/**\n * Converts an 1D or 2D array of cell coordinates into values\n *\n * ```js\n * // 1D (ie an array of coordinates)\n * const cells = Grid.As.cells(grid);\n * for (const v of Grid.values(grid, cells)) {\n *\n * }\n * ```\n * ```js\n * // 2D (ie an array of rows)\n * const rows = Grid.As.rows(grid);\n * for (const v of Grid.values(grid, rows)) {\n * }\n * ```\n * @param grid\n * @param iter\n */\nexport function* values(grid, iter) {\n    for (const d of iter) {\n        if (Array.isArray(d)) {\n            yield d.map(v => grid.get(v, `undefined`));\n        }\n        else {\n            yield grid.get(d, `undefined`);\n        }\n    }\n}\n// export function visitValues<T>(readable: GridReadable<T>, visitor: Generator<Cell[]>, wrap?: BoundsLogic): Generator<T[]>\n// export function visitValues<T>(readable: GridReadable<T>, visitor: Generator<Cell>, wrap?: BoundsLogic): Generator<T>\n// /**\n//  * Visits the values of a readable grid\n//  * @param readable Readable grid\n//  * @param visitor Visitor\n//  * @param wrap Wrapping logic, defaultign to 'undefined'\n//  */\n// export function* visitValues<T>(readable: GridReadable<T>, visitor: Generator<Cell | Cell[]>, wrap: BoundsLogic = `undefined`) {\n//   for (const cellOrCells of visitor) {\n//     if (Array.isArray(cellOrCells)) {\n//       yield cellOrCells.map(cell => readable.accessor(cell, wrap));\n//     } else {\n//       yield readable.accessor(cellOrCells, wrap);\n//     }\n//   }\n// }\n","import { guardGrid, guardCell } from \"../guards.js\";\nimport { values } from \"../values.js\";\n/**\n * Enumerate all cell coordinates in an efficient manner.\n * Runs left-to-right, top-to-bottom.\n *\n * If end of grid is reached, behaviour depends on `wrap`:\n * * _true_ (default): iterator will wrap to ensure all are visited.\n * * _false_: iterator stops at end of grid\n *\n * ```js\n * import { Grids } from 'ixfx/geometry.js';\n *\n * // Enumerate each cell position, left-to-right, top-to-bottom\n * for (const cell of Grids.By.cells(grid)) {\n *  // cell will be { x, y }\n * }\n * ```\n *\n * See also:\n * * {@link cellValues}: Iterate over cell values\n * * {@link cellsAndValues}: Iterate over pairs of cell coordinates and cell values\n * @param grid Grid to iterate over\n * @param start Starting cell position (default: {x:0,y:0})\n * @param wrap If true (default), iteration will wrap around through (0,0) when end of grid is reached.\n */\nexport function* cells(grid, start, wrap = true) {\n    if (!start)\n        start = { x: 0, y: 0 };\n    guardGrid(grid, `grid`);\n    guardCell(start, `start`, grid);\n    let { x, y } = start;\n    let canMove = true;\n    do {\n        yield { x, y };\n        x++;\n        if (x === grid.cols) {\n            y++;\n            x = 0;\n        }\n        if (y === grid.rows) {\n            if (wrap) {\n                y = 0;\n                x = 0;\n            }\n            else {\n                canMove = false;\n            }\n        }\n        if (x === start.x && y === start.y)\n            canMove = false; // Complete\n    } while (canMove);\n}\n;\n/**\n * Yield all the values of a grid, left-to-right, top-to-bottom.\n *\n * This is just a wrapper around Grids.values:\n * ```js\n * yield* values(grid, cells(grid, start, wrap));\n * ```\n *\n * See also:\n * * {@link cells}: Iterate over cell coordinates\n * * {@link cellsAndValues}: Iterate over pairs of cell coordinates and cell values\n * @param grid\n * @param start\n * @param wrap\n */\nexport function* cellValues(grid, start, wrap = true) {\n    yield* values(grid, cells(grid, start, wrap));\n}\n/**\n * Yield all cell coordinates and values of a grid, left-to-right, top-to-bottom\n *\n * See also:\n * * {@link cells}: Iterate over cell coordinates\n * * {@link cellValues}: Iterate over cell values\n * @param grid\n * @param start\n * @param wrap\n */\nexport function* cellsAndValues(grid, start, wrap = true) {\n    for (const cell of cells(grid, start, wrap)) {\n        yield { cell, value: grid.get(cell) };\n    }\n}\n","import { cells } from \"./enumerators/cells.js\";\n/**\n * Enumerate rows of grid, returning all the cells in the row\n * as an array\n *\n * ```js\n * for (const row of Grid.As.rows(shape)) {\n *  // row is an array of Cells.\n *  // [ {x:0, y:0}, {x:1, y:0} ... ]\n * }\n * ```\n *\n * Use `Grid.values` to convert the returned iterator into values:\n * ```js\n * for (const v of Grid.values(Grid.rows(shape))) {\n * }\n * ```\n * @param grid\n * @param start\n */\nexport const rows = function* (grid, start) {\n    if (!start)\n        start = { x: 0, y: 0 };\n    let row = start.y;\n    let rowCells = [];\n    for (const c of cells(grid, start)) {\n        if (c.y === row) {\n            rowCells.push(c);\n        }\n        else {\n            yield rowCells;\n            rowCells = [c];\n            row = c.y;\n        }\n    }\n    if (rowCells.length > 0)\n        yield rowCells;\n};\n/**\n * Enumerate columns of grid, returning all the cells in the\n * same column as an array.\n *\n * ```js\n * for (const col of Grid.As.columns(grid)) {\n * }\n * ```\n *\n * Use `Grid.values` to convert into values\n * ```js\n * for (const value of Grid.values(Grid.As.columns(grid))) {\n * }\n * ```\n * @param grid\n * @param start\n */\nexport function* columns(grid, start) {\n    if (!start)\n        start = { x: 0, y: 0 };\n    for (let x = start.x; x < grid.cols; x++) {\n        let colCells = [];\n        for (let y = start.y; y < grid.rows; y++) {\n            colCells.push({ x, y });\n        }\n        yield colCells;\n    }\n}\n","//import { clampIndex } from '@ixfx/numbers';\nimport { applyBounds } from './apply-bounds.js';\n/**\n * Returns a coordinate offset from `start` by `vector` amount.\n *\n * Different behaviour can be specified for how to handle when coordinates exceed the bounds of the grid\n *\n * Note: x and y wrapping are calculated independently. A large wrapping of x, for example won't shift up/down a line.\n *\n * Use {@link Grids.applyBounds} if you need to calculate a wrapped coordinate without adding two together.\n * @param grid Grid to traverse\n * @param vector Offset in x/y\n * @param start Start point\n * @param bounds\n * @returns Cell\n */\nexport const offset = function (grid, start, vector, bounds = `undefined`) {\n    return applyBounds(grid, {\n        x: start.x + vector.x,\n        y: start.y + vector.y\n    }, bounds);\n    // guardCell(start, `start`, grid);\n    // guardCell(vector);\n    // guardGrid(grid, `grid`);\n    // // eslint-disable-next-line functional/no-let\n    // let x = start.x;\n    // // eslint-disable-next-line functional/no-let\n    // let y = start.y;\n    // switch (bounds) {\n    //   case `wrap`: {\n    //     x += vector.x % grid.cols;\n    //     y += vector.y % grid.rows;\n    //     if (x < 0) x = grid.cols + x;\n    //     else if (x >= grid.cols) {\n    //       x -= grid.cols;\n    //     }\n    //     if (y < 0) y = grid.rows + y;\n    //     else if (y >= grid.rows) {\n    //       y -= grid.rows;\n    //     }\n    //     break;\n    //   }\n    //   case `stop`: {\n    //     x += vector.x;\n    //     y += vector.y;\n    //     x = clampIndex(x, grid.cols);\n    //     y = clampIndex(y, grid.rows);\n    //     break;\n    //   }\n    //   case `undefined`: {\n    //     x += vector.x;\n    //     y += vector.y;\n    //     if (x < 0 || y < 0) return;\n    //     if (x >= grid.cols || y >= grid.rows) return;\n    //     break;\n    //   }\n    //   case `unbounded`: {\n    //     x += vector.x;\n    //     y += vector.y;\n    //     break;\n    //   }\n    //   default: {\n    //     // eslint-disable-next-line @typescript-eslint/restrict-template-expressions\n    //     throw new Error(`Unknown BoundsLogic case ${ bounds }`);\n    //   }\n    // }\n    // return Object.freeze({ x, y });\n};\n","import { zipKeyValue } from \"@ixfx/core/maps\";\nimport { integerTest, resultThrow } from \"@ixfx/guards\";\nimport { guardCell, guardGrid } from \"./guards.js\";\nimport { offset } from \"./offset.js\";\n/**\n * Returns a list of all cardinal directions: n, ne, nw, e, s, se, sw, w\n */\nexport const allDirections = Object.freeze([\n    `n`,\n    `ne`,\n    `nw`,\n    `e`,\n    `s`,\n    `se`,\n    `sw`,\n    `w`,\n]);\n/**\n * Returns a list of + shaped directions: n, e, s, w\n */\nexport const crossDirections = Object.freeze([\n    `n`,\n    `e`,\n    `s`,\n    `w`,\n]);\n/**\n * Returns cells that correspond to the cardinal directions at a specified distance\n * i.e. it projects a line from `start` cell in all cardinal directions and returns the cells at `steps` distance.\n * @param grid Grid\n * @param steps Distance\n * @param start Start poiint\n * @param bounds Logic for if bounds of grid are exceeded\n * @returns Cells corresponding to cardinals\n */\nexport const offsetCardinals = (grid, start, steps, bounds = `stop`) => {\n    guardGrid(grid, `grid`);\n    guardCell(start, `start`);\n    resultThrow(integerTest(steps, `aboveZero`, `steps`));\n    const directions = allDirections;\n    const vectors = directions.map((d) => getVectorFromCardinal(d, steps));\n    const cells = directions.map((d, index) => offset(grid, start, vectors[index], bounds));\n    return zipKeyValue(directions, cells);\n};\n/**\n * Returns an `{ x, y }` signed vector corresponding to the provided cardinal direction.\n * ```js\n * const n = getVectorFromCardinal(`n`); // {x: 0, y: -1}\n * ```\n *\n * Optional `multiplier` can be applied to vector\n * ```js\n * const n = getVectorFromCardinal(`n`, 10); // {x: 0, y: -10}\n * ```\n *\n * Blank direction returns `{ x: 0, y: 0 }`\n * @param cardinal Direction\n * @param multiplier Multipler\n * @returns Signed vector in the form of `{ x, y }`\n */\nexport const getVectorFromCardinal = (cardinal, multiplier = 1) => {\n    let v;\n    switch (cardinal) {\n        case `n`: {\n            v = { x: 0, y: -1 * multiplier };\n            break;\n        }\n        case `ne`: {\n            v = { x: 1 * multiplier, y: -1 * multiplier };\n            break;\n        }\n        case `e`: {\n            v = { x: 1 * multiplier, y: 0 };\n            break;\n        }\n        case `se`: {\n            v = { x: 1 * multiplier, y: 1 * multiplier };\n            break;\n        }\n        case `s`: {\n            v = { x: 0, y: 1 * multiplier };\n            break;\n        }\n        case `sw`: {\n            v = { x: -1 * multiplier, y: 1 * multiplier };\n            break;\n        }\n        case `w`: {\n            v = { x: -1 * multiplier, y: 0 };\n            break;\n        }\n        case `nw`: {\n            v = { x: -1 * multiplier, y: -1 * multiplier };\n            break;\n        }\n        default: {\n            v = { x: 0, y: 0 };\n        }\n    }\n    return Object.freeze(v);\n};\n","//import type { Cell, GridReadable } from '../Types.js';\nexport * from './cells.js';\n// export function* withValues<T>(grid: GridReadable<T>, iter: IterableIterator<Cell>) {\n//   for (const cell of iter) {\n//     yield { cell, value: grid.get(cell, `undefined`) };\n//   }\n// }\n","import { guardCell } from \"./guards.js\";\n/**\n * Returns the cells on the line of `start` and `end`, inclusive\n *\n * ```js\n * // Get cells that connect 0,0 and 10,10\n * const cells = Grids.getLine({x:0,y:0}, {x:10,y:10});\n * ```\n *\n * This function does not handle wrapped coordinates.\n * @param start Starting cell\n * @param end End cell\n * @returns\n */\nexport const getLine = (start, end) => {\n    // https://stackoverflow.com/a/4672319\n    guardCell(start);\n    guardCell(end);\n    let startX = start.x;\n    let startY = start.y;\n    const dx = Math.abs(end.x - startX);\n    const dy = Math.abs(end.y - startY);\n    const sx = startX < end.x ? 1 : -1;\n    const sy = startY < end.y ? 1 : -1;\n    let error = dx - dy;\n    const cells = [];\n    // eslint-disable-next-line no-constant-condition\n    while (true) {\n        cells.push(Object.freeze({ x: startX, y: startY }));\n        if (startX === end.x && startY === end.y)\n            break;\n        const error2 = 2 * error;\n        if (error2 > -dy) {\n            error -= dy;\n            startX += sx;\n        }\n        if (error2 < dx) {\n            error += dx;\n            startY += sy;\n        }\n    }\n    return cells;\n};\n/**\n * Returns a list of cells from `start` to `end`.\n *\n * Throws an error if start and end are not on same row or column.\n *\n * @param start Start cell\n * @param end end clel\n * @param endInclusive\n * @return Array of cells\n */\nexport const simpleLine = function (start, end, endInclusive = false) {\n    const cells = [];\n    if (start.x === end.x) {\n        // Vertical\n        const lastY = endInclusive ? end.y + 1 : end.y;\n        for (let y = start.y; y < lastY; y++) {\n            cells.push({ x: start.x, y: y });\n        }\n    }\n    else if (start.y === end.y) {\n        // Horizontal\n        const lastX = endInclusive ? end.x + 1 : end.x;\n        for (let x = start.x; x < lastX; x++) {\n            cells.push({ x: x, y: start.y });\n        }\n    }\n    else {\n        throw new Error(`Only does vertical and horizontal: ${start.x},${start.y} - ${end.x},${end.y}`);\n    }\n    return cells;\n};\n","import { integerTest, resultThrow } from \"@ixfx/guards\";\nimport { guardGrid } from \"./guards.js\";\nimport { offset } from \"./offset.js\";\n/**\n * Returns the index for a given cell.\n * This is useful if a grid is stored in an array.\n *\n * ```js\n * const data = [\n *  1, 2,\n *  3, 4,\n *  5, 6 ];\n * const cols = 2; // Grid of 2 columns wide\n * const index = indexFromCell(cols, {x: 1, y: 1});\n * // Yields an index of 3\n * console.log(data[index]); // Yields 4\n * ```\n *\n * Bounds logic is applied to cell.x/y separately. Wrapping\n * only ever happens in same col/row.\n * @see cellFromIndex\n * @param grid Grid\n * @param cell Cell to get index for\n * @param wrap Logic for if we hit bounds of grid\n * @returns\n */\nexport const indexFromCell = (grid, cell, wrap) => {\n    guardGrid(grid, `grid`);\n    if (cell.x < 0) {\n        switch (wrap) {\n            case `stop`: {\n                cell = { ...cell, x: 0 };\n                break;\n            }\n            case `unbounded`: {\n                throw new Error(`unbounded not supported`);\n            }\n            case `undefined`: {\n                return undefined;\n            }\n            case `wrap`: {\n                //cell = { ...cell, x: grid.cols + cell.x };\n                cell = offset(grid, { x: 0, y: cell.y }, { x: cell.x, y: 0 }, `wrap`);\n                break;\n            }\n        }\n    }\n    if (cell.y < 0) {\n        switch (wrap) {\n            case `stop`: {\n                cell = { ...cell, y: 0 };\n                break;\n            }\n            case `unbounded`: {\n                throw new Error(`unbounded not supported`);\n            }\n            case `undefined`: {\n                return undefined;\n            }\n            case `wrap`: {\n                cell = { ...cell, y: grid.rows + cell.y };\n                break;\n            }\n        }\n    }\n    if (cell.x >= grid.cols) {\n        switch (wrap) {\n            case `stop`: {\n                cell = { ...cell, x: grid.cols - 1 };\n                break;\n            }\n            case `unbounded`: {\n                throw new Error(`unbounded not supported`);\n            }\n            case `undefined`: {\n                return undefined;\n            }\n            case `wrap`: {\n                cell = { ...cell, x: cell.x % grid.cols };\n                break;\n            }\n        }\n    }\n    if (cell.y >= grid.rows) {\n        switch (wrap) {\n            case `stop`: {\n                cell = { ...cell, y: grid.rows - 1 };\n                break;\n            }\n            case `unbounded`: {\n                throw new Error(`unbounded not supported`);\n            }\n            case `undefined`: {\n                return undefined;\n            }\n            case `wrap`: {\n                cell = { ...cell, y: cell.y % grid.rows };\n                break;\n            }\n        }\n    }\n    const index = cell.y * grid.cols + cell.x;\n    return index;\n};\n/**\n * Returns x,y from an array index.\n *\n * ```js\n *  const data = [\n *   1, 2,\n *   3, 4,\n *   5, 6 ];\n *\n * // Cols of 2, index 2 (ie. data[2] == 3)\n * const cell = cellFromIndex(2, 2);\n * // Yields: {x: 0, y: 1}\n * ```\n * @see indexFromCell\n * @param colsOrGrid\n * @param index\n * @returns\n */\nexport const cellFromIndex = (colsOrGrid, index) => {\n    let cols = 0;\n    cols = typeof colsOrGrid === `number` ? colsOrGrid : colsOrGrid.cols;\n    resultThrow(integerTest(cols, `aboveZero`, `colsOrGrid`));\n    return {\n        x: index % cols,\n        y: Math.floor(index / cols),\n    };\n};\n","/**\n * Returns _true_ if grids `a` and `b` are equal in value.\n * Returns _false_ if either parameter is undefined.\n *\n * @param a\n * @param b\n * @return\n */\nexport const isEqual = (a, b) => {\n    if (b === undefined)\n        return false;\n    if (a === undefined)\n        return false;\n    if (`rows` in a && `cols` in a) {\n        if (`rows` in b && `cols` in b) {\n            if (a.rows !== b.rows || a.cols !== b.cols)\n                return false;\n        }\n        else\n            return false;\n    }\n    if (`size` in a) {\n        if (`size` in b) {\n            if (a.size !== b.size)\n                return false;\n        }\n        else\n            return false;\n    }\n    return true;\n};\n/**\n * Returns _true_ if two cells equal.\n * Returns _false_ if either cell are undefined\n *\n * @param a\n * @param b\n * @returns\n */\nexport const cellEquals = (a, b) => {\n    if (b === undefined)\n        return false;\n    if (a === undefined)\n        return false;\n    return a.x === b.x && a.y === b.y;\n};\n","import { zipKeyValue } from \"@ixfx/core/maps\";\nimport { allDirections, getVectorFromCardinal } from \"./directions.js\";\nimport { randomElement } from \"@ixfx/random\";\nimport { offset } from \"./offset.js\";\nexport const randomNeighbour = (nbos) => randomElement(nbos); // .filter(isNeighbour));\n/**\n * Returns _true_ if `n` is a Neighbour type, eliminating NeighbourMaybe possibility\n *\n * @param n\n * @return\n */\nconst isNeighbour = (n) => {\n    if (n === undefined)\n        return false;\n    if (n[1] === undefined)\n        return false;\n    return true;\n};\n/**\n * Gets a list of neighbours for `cell` (using {@link neighbours}), filtering\n * results to only those that are valid neighbours (using {@link isNeighbour})\n *\n * ```js\n * // Get all eight surrounding cells\n * const n = Grids.neighbourList(grid, cell, Grids.allDirections);\n *\n * // Get north, east, south, west cells\n * const n = Grids.neighbourList(grid, cell, Grids.crossDirections);\n * ```\n * @param grid Grid\n * @param cell Cell\n * @param directions Directions\n * @param bounds Bounds\n * @returns\n */\nexport const neighbourList = (grid, cell, directions, bounds) => {\n    // Get neighbours for cell\n    const cellNeighbours = neighbours(grid, cell, bounds, directions);\n    // Filter out undefined cells\n    const entries = Object.entries(cellNeighbours);\n    return entries.filter(n => isNeighbour(n));\n};\n/**\n * Returns neighbours for a cell. If no `directions` are provided, it defaults to {@link allDirections}.\n *\n * ```js\n * const grid = { rows: 5, cols: 5 };\n * const cell = { x:2, y:2 };\n *\n * // Get n,ne,nw,e,s,se,sw and w neighbours\n * const n = Grids.neighbours(grid, cell, `wrap`);\n *\n * Yields:\n * {\n *  n: {x: 2, y: 1}\n *  s: {x: 2, y: 3}\n *  ....\n * }\n * ```\n *\n * Returns neighbours without diagonals (ie: n, e, s, w):\n * ```js\n * const n = Grids.neighbours(grid, cell, `stop`, Grids.crossDirections);\n * ```\n * @returns Returns a map of cells, keyed by cardinal direction\n * @param grid Grid\n * @param cell Cell\n * @param bounds How to handle edges of grid\n * @param directions Directions to return\n */\nexport const neighbours = (grid, cell, bounds = `undefined`, directions) => {\n    const directories = directions ?? allDirections;\n    const points = directories.map((c) => offset(grid, cell, getVectorFromCardinal(c), bounds));\n    return zipKeyValue(directories, points);\n};\n","/**\n * Returns a two-dimensional array according to `grid`\n * size.\n *\n * ```js\n * const a = Grids.toArray({ rows: 3, cols: 2 });\n * Yields:\n * [ [_,_] ]\n * [ [_,_] ]\n * [ [_,_] ]\n * ```\n *\n * `initialValue` can be provided to set the value\n * for all cells.\n * @param grid Grid\n * @param initialValue Initial value\n * @returns\n */\nexport const toArray2d = (grid, initialValue) => {\n    const returnValue = [];\n    for (let row = 0; row < grid.rows; row++) {\n        returnValue[row] = Array.from({ length: grid.cols });\n        if (initialValue) {\n            for (let col = 0; col < grid.cols; col++) {\n                returnValue[row][col] = initialValue;\n            }\n        }\n    }\n    return returnValue;\n};\n","/**\n * Returns a key string for a cell instance\n * A key string allows comparison of instances by value rather than reference\n *\n * ```js\n * cellKeyString({x:10,y:20});\n * // Yields: \"Cell{10,20}\";\n * ```\n * @param v\n * @returns\n */\nexport const cellKeyString = (v) => `Cell{${v.x},${v.y}}`;\n","import { guardCell } from \"./guards.js\";\nimport { fromTopLeft as RectsFromTopLeft } from '../rect/from-top-left.js';\nimport { integerTest, numberTest, resultThrow } from '@ixfx/guards';\nimport { cells } from \"./enumerators/cells.js\";\n/**\n * Generator that returns rectangles for each cell in a grid\n *\n * @example Draw rectangles\n * ```js\n * import { Drawing } from 'visuals.js'\n * const rects = [...Grids.asRectangles(grid)];\n * Drawing.rect(ctx, rects, { strokeStyle: `silver`});\n * ```\n * @param grid\n */\nexport function* asRectangles(grid) {\n    for (const c of cells(grid)) {\n        yield rectangleForCell(grid, c);\n    }\n}\n/**\n * Returns the cell at a specified visual coordinate\n * or _undefined_ if the position is outside of the grid.\n *\n * `position` must be in same coordinate/scale as the grid.\n *\n * @param position Position, eg in pixels\n * @param grid Grid\n * @return Cell at position or undefined if outside of the grid\n */\nexport const cellAtPoint = (grid, position) => {\n    const size = grid.size;\n    resultThrow(numberTest(size, `positive`, `grid.size`));\n    if (position.x < 0 || position.y < 0)\n        return;\n    const x = Math.floor(position.x / size);\n    const y = Math.floor(position.y / size);\n    if (x >= grid.cols)\n        return;\n    if (y >= grid.rows)\n        return;\n    return { x, y };\n};\n/**\n * Returns a visual rectangle of the cell, positioned from the top-left corner\n *\n * ```js\n * const cell = { x: 1, y: 0 };\n *\n * // 5x5 grid, each cell 5px in size\n * const grid = { rows: 5, cols: 5, size: 5 }\n *\n * const r = rectangleForCell(grid, cell,);\n *\n * // Yields: { x: 5, y: 0, width: 5, height: 5 }\n * ```\n * @param cell\n * @param grid\n * @return\n */\nexport const rectangleForCell = (grid, cell) => {\n    guardCell(cell);\n    const size = grid.size;\n    const x = cell.x * size;\n    const y = cell.y * size;\n    const r = RectsFromTopLeft({ x: x, y: y }, size, size);\n    return r;\n};\n/**\n * Returns the visual midpoint of a cell (eg. pixel coordinate)\n *\n * @param cell\n * @param grid\n * @return\n */\nexport const cellMiddle = (grid, cell) => {\n    guardCell(cell);\n    const size = grid.size;\n    const x = cell.x * size; // + (grid.spacing ? cell.x * grid.spacing : 0);\n    const y = cell.y * size; // + (grid.spacing ? cell.y * grid.spacing : 0);\n    return Object.freeze({ x: x + size / 2, y: y + size / 2 });\n};\n","//import { visitor } from \"./Visitor.js\";\n// export const visitorBreadth = (\n//   grid: Grid,\n//   start: Cell,\n//   opts: VisitorOpts = {}\n// ) =>\n//   visitor(\n//     {\n//       select: (nbos) => nbos[ 0 ],\n//     },\n//     grid,\n//     start,\n//     opts\n//   );\nexport const breadthLogic = () => {\n    return {\n        select: (nbos) => nbos[0],\n    };\n};\n","import { allDirections } from \"../directions.js\";\nimport { neighbourList } from \"../neighbour.js\";\n// export function* cellNeigbours(\n//   grid: Grid,\n//   cell: Cell,\n//   bounds: BoundsLogic = `undefined`,\n//   directions?: ReadonlyArray<CardinalDirection>\n// ) {\n//   const dirs = directions ?? allDirections;\n//   const points = dirs.map((c) =>\n//     offset(grid, cell, getVectorFromCardinal(c), bounds)\n//   );\n//   for (const pt of points) {\n//     if (pt !== undefined) yield pt;\n//   }\n// }\nexport const neighboursLogic = () => {\n    return {\n        select: (neighbours) => {\n            return neighbours.at(0);\n        },\n        getNeighbours: (grid, cell) => {\n            return neighbourList(grid, cell, allDirections, `undefined`);\n        }\n    };\n};\n","/**\n * Visits cells running down columns, left-to-right.\n * @param opts Options\n * @returns Visitor generator\n */\nexport const columnLogic = (opts = {}) => {\n    const reversed = opts.reversed ?? false;\n    return {\n        select: (nbos) => nbos.find((n) => n[0] === (reversed ? `n` : `s`)),\n        getNeighbours: (grid, cell) => {\n            if (reversed) {\n                // WALK UP COLUMN, RIGHT-TO-LEFT\n                if (cell.y > 0) {\n                    // Easy case\n                    cell = { x: cell.x, y: cell.y - 1 };\n                }\n                else {\n                    // Top of column\n                    if (cell.x === 0) {\n                        // Top-left corner, need to wrap\n                        cell = { x: grid.cols - 1, y: grid.rows - 1 };\n                    }\n                    else {\n                        cell = { x: cell.x - 1, y: grid.rows - 1 };\n                    }\n                }\n            }\n            else {\n                // WALK DOWN COLUMNS, LEFT-TO-RIGHT\n                if (cell.y < grid.rows - 1) {\n                    // Easy case, move down by one\n                    cell = { x: cell.x, y: cell.y + 1 };\n                }\n                else {\n                    // End of column\n                    if (cell.x < grid.cols - 1) {\n                        // Move to next column and start at top\n                        cell = { x: cell.x + 1, y: 0 };\n                    }\n                    else {\n                        // Move to start of grid\n                        cell = { x: 0, y: 0 };\n                    }\n                }\n            }\n            return [[reversed ? `n` : `s`, cell]];\n        }\n    };\n};\n","// export const visitorDepth = (grid: Grid, start: Cell, opts: VisitorOpts = {}) =>\n//   visitor(\n//     {\n//       select: (nbos) => nbos.at(-1),\n//     },\n//     grid,\n//     start,\n//     opts\n//   );\nexport const depthLogic = () => {\n    return {\n        select: (nbos) => nbos.at(-1)\n    };\n};\n","import { randomNeighbour } from \"../neighbour.js\";\nimport { cells } from \"../enumerators/cells.js\";\n// export const visitorRandom = (\n//   grid: Grid,\n//   start: Cell,\n//   opts: VisitorOpts = {}\n// ) =>\n//   visitor(\n//     ,\n//     grid,\n//     start,\n//     opts\n//   );\nexport const randomLogic = () => {\n    return {\n        getNeighbours: (grid, cell) => {\n            const t = [];\n            for (const c of cells(grid, cell)) {\n                t.push([`n`, c]);\n            }\n            return t;\n        },\n        select: randomNeighbour,\n    };\n};\n","import { randomNeighbour } from \"../neighbour.js\";\n// export const visitorRandomContiguous = (\n//   grid: Grid,\n//   start: Cell,\n//   opts: VisitorOpts = {}\n// ) =>\n//   visitor(\n//     ,\n//     grid,\n//     start,\n//     opts\n//   );\nexport const randomContiguousLogic = () => {\n    return {\n        select: randomNeighbour,\n    };\n};\n","/**\n* Visit by following rows. Normal order is left-to-right, top-to-bottom.\n* @param opts Options\n* @returns\n*/\nexport const rowLogic = (opts = {}) => {\n    const reversed = opts.reversed ?? false;\n    return {\n        select: (nbos) => nbos.find((n) => n[0] === (reversed ? `w` : `e`)),\n        getNeighbours: (grid, cell) => {\n            if (reversed) {\n                // WALKING BACKWARD ALONG ROW\n                if (cell.x > 0) {\n                    // All fine, step to the left\n                    cell = { x: cell.x - 1, y: cell.y };\n                }\n                else {\n                    // At the beginning of a row\n                    if (cell.y > 0) {\n                        // Wrap to next row up\n                        cell = { x: grid.cols - 1, y: cell.y - 1 };\n                    }\n                    else {\n                        // Wrap to end of grid\n                        cell = { x: grid.cols - 1, y: grid.rows - 1 };\n                    }\n                }\n            }\n            else {\n                /*\n                 * WALKING FORWARD ALONG ROWS\n                 */\n                if (cell.x < grid.rows - 1) {\n                    // All fine, step to the right\n                    cell = { x: cell.x + 1, y: cell.y };\n                }\n                else {\n                    // At the end of a row\n                    // eslint-disable-next-line unicorn/prefer-ternary\n                    if (cell.y < grid.rows - 1) {\n                        // More rows available, wrap to next row down\n                        cell = { x: 0, y: cell.y + 1 };\n                    }\n                    else {\n                        // No more rows available, wrap to start of the grid\n                        cell = { x: 0, y: 0 };\n                    }\n                }\n            }\n            return [[reversed ? `w` : `e`, cell]];\n        }\n    };\n};\n","import { mutable } from '@ixfx/collections/set';\nimport { crossDirections } from \"../directions.js\";\nimport { guardGrid, guardCell, isCell } from \"../guards.js\";\nimport { cellEquals } from \"../is-equal.js\";\nimport { neighbourList } from '../neighbour.js';\nimport { cellKeyString } from \"../to-string.js\";\n/**\n * Visits every cell in grid using supplied selection function\n * In-built functions to use: visitorDepth, visitorBreadth, visitorRandom,\n * visitorColumn, visitorRow.\n *\n * Usage example:\n * ```js\n *  let visitor = Grids.visitor(Grids.visitorRandom, grid, startCell);\n *  for (let cell of visitor) {\n *   // do something with cell\n *  }\n * ```\n *\n * If you want to keep tabs on the visitor, pass in a @ixfx/collections.Sets.ISetMutable instance. This gets\n * updated as cells are visited to make sure we don't visit the same one twice. If a set is not passed\n * in, one will be created internally.\n * ```js\n * let visited = new SetStringMutable<Grids.Cell>(c => Grids.cellKeyString(c));\n * let visitor = Grids.visitor(Grids.visitorRandom, grid, startCell, visited);\n * ```\n *\n * To visit with some delay, try this pattern\n * ```js\n *  const delayMs = 100;\n *  const run = () => {\n *   let cell = visitor.next().value;\n *   if (cell === undefined) return;\n *   // Do something with cell\n *   setTimeout(run, delayMs);\n *  }\n *  setTimeout(run, delayMs);\n * ```\n * @param logic Logic for selecting next cell\n * @param grid Grid to visitl\n * @param opts Options\n * @returns Cells\n */\nexport function* visitByNeighbours(logic, grid, opts = {}) {\n    guardGrid(grid, `grid`);\n    const start = opts.start ?? { x: 0, y: 0 };\n    guardCell(start, `opts.start`, grid);\n    const v = opts.visited ?? mutable(cellKeyString);\n    const possibleNeighbours = logic.getNeighbours ?? ((g, c) => neighbourList(g, c, crossDirections, `undefined`));\n    let cellQueue = [start];\n    let moveQueue = [];\n    let current = undefined;\n    while (cellQueue.length > 0) {\n        if (current === undefined) {\n            const nv = cellQueue.pop();\n            if (nv === undefined) {\n                break;\n            }\n            current = nv;\n        }\n        if (!v.has(current)) {\n            v.add(current);\n            yield current;\n            const nextSteps = possibleNeighbours(grid, current).filter((step) => {\n                if (step[1] === undefined)\n                    return false;\n                return !v.has(step[1]);\n            });\n            if (nextSteps.length === 0) {\n                // No more moves for this cell\n                if (current !== undefined) {\n                    cellQueue = cellQueue.filter((cq) => cellEquals(cq, current));\n                }\n            }\n            else {\n                for (const n of nextSteps) {\n                    if (n === undefined)\n                        continue;\n                    if (n[1] === undefined)\n                        continue;\n                    moveQueue.push(n);\n                }\n            }\n        }\n        // Remove steps already made\n        moveQueue = moveQueue.filter((step) => !v.has(step[1]));\n        if (moveQueue.length === 0) {\n            current = undefined;\n        }\n        else {\n            // Pick move\n            const potential = logic.select(moveQueue);\n            if (potential !== undefined) {\n                cellQueue.push(potential[1]);\n                current = potential[1];\n            }\n        }\n    }\n}\n;\n","import { integerTest, resultThrow } from \"@ixfx/guards\";\nimport { guardCell, guardGrid } from \"../guards.js\";\n/**\n * Runs the provided `visitor` for `steps`, returning the cell we end at\n * ```js\n * // Create visitor & stepper\n * const visitor = Grids.Visit.create(`row`);\n * const stepper = Grids.Visit.stepper(grid, visitor);\n *\n * // Step by 10\n * stepper(10); // GridCell {x,y}\n *\n * // Step by another 2\n * stepper(2);\n * ```\n * @param grid Grid to traverse\n * @param start Start point\n * @param createVisitor Visitor function\n * @returns\n */\nexport const stepper = (grid, createVisitor, start = { x: 0, y: 0 }, resolution = 1) => {\n    guardGrid(grid, `grid`);\n    guardCell(start, `start`);\n    resultThrow(integerTest(resolution, ``, `resolution`));\n    // Create a list of steps\n    const steps = [];\n    let count = 0;\n    let position = 0;\n    for (const c of createVisitor(grid, { start, boundsWrap: `undefined` })) {\n        count++;\n        if ((count % resolution) !== 0)\n            continue;\n        steps.push(c);\n    }\n    return (step, fromStart = false) => {\n        resultThrow(integerTest(step, ``, `step`));\n        if (fromStart)\n            position = step;\n        else\n            position += step;\n        //position = position % steps.length;\n        return steps.at(position % steps.length);\n    };\n};\n// export const step = (\n//   grid: Grid,\n//   start: Cell,\n//   steps: number,\n//   createVisitor: CreateVisitor\n// ): Cell => {\n//   throwIntegerTest(steps, ``, `steps`);\n//   const opts: Partial<VisitorOpts> = {\n//     reversed: steps < 0,\n//     start\n//   };\n//   steps = Math.abs(steps);\n//   let c = start;\n//   let v = createVisitor(grid, opts);\n//   v.next(); // Burn up starting cell\n//   let stepsMade = 0;\n//   while (stepsMade < steps) {\n//     stepsMade++;\n//     const { value } = v.next();\n//     if (value) {\n//       c = value;\n//       if (opts.debug) {\n//         console.log(\n//           `stepsMade: ${ stepsMade } cell: ${ c.x }, ${ c.y } reverse: ${ opts.reversed }`\n//         );\n//       }\n//     } else {\n//       if (steps >= grid.cols * grid.rows) {\n//         steps -= grid.cols * grid.rows;\n//         stepsMade = 0;\n//         v = createVisitor(grid, opts);\n//         v.next();\n//         c = start;\n//         if (opts.debug) console.log(`resetting visitor to ${ steps }`);\n//       } else throw new Error(`Value not received by visitor`);\n//     }\n//   }\n//   return c;\n// };\n","import { breadthLogic } from './breadth.js';\nimport { neighboursLogic } from './cell-neighbours.js';\nimport { columnLogic } from './columns.js';\nimport { depthLogic } from './depth.js';\nimport { randomLogic } from './random.js';\nimport { randomContiguousLogic } from './random-contiguous.js';\nimport { rowLogic } from './rows.js';\nimport { visitByNeighbours } from './visitor.js';\nexport * from './breadth.js';\nexport * from './cell-neighbours.js';\nexport * from './columns.js';\nexport * from './depth.js';\nexport * from './step.js';\nexport * from './random.js';\nexport * from './random-contiguous.js';\nexport * from './rows.js';\nexport * from './visitor.js';\n/**\n * Logic types:\n * * 'row': left-to-right, top-to-bottom\n * * 'column': top-to-bottom, left-to-right\n * * 'neighbours': neighbours surrounding cell (eight)\n * * 'breadth`: breadth-first\n * * 'depth': depth-first\n * * 'random': any random cell in grid\n * * 'random-contiguous': any random cell neighbouring an already visited cell\n * @param type\n * @param opts\n * @returns\n */\nexport const create = (type, opts = {}) => {\n    switch (type) {\n        case `random-contiguous`:\n            return withLogic(randomContiguousLogic(), opts);\n        case `random`:\n            return withLogic(randomLogic(), opts);\n        case `depth`:\n            return withLogic(depthLogic(), opts);\n        case `breadth`:\n            return withLogic(breadthLogic(), opts);\n        case `neighbours`:\n            return withLogic(neighboursLogic(), opts);\n        case `row`:\n            return withLogic(rowLogic(opts), opts);\n        case `column`:\n            return withLogic(columnLogic(opts), opts);\n        default:\n            throw new TypeError(`Param 'type' unknown. Value: ${type}`);\n    }\n};\nexport const withLogic = (logic, options = {}) => {\n    return (grid, optionsOverride = {}) => {\n        return visitByNeighbours(logic, grid, { ...options, ...optionsOverride });\n    };\n};\nfunction isIterator(v) {\n    if (typeof v !== `object`)\n        return false;\n    if (!(`next` in v))\n        return false;\n    if (!(`throw` in v))\n        return false;\n    if (!(`return` in v))\n        return false;\n    return true;\n}\n// export function* withValues<T>(createOrIter: CreateVisitor | Generator<Cell>, grid: GridReadable<T>, opts: Partial<VisitorOpts>) {\n//   const iter = isIterator(createOrIter) ? createOrIter : createOrIter(grid, opts)();\n//   for (const cell of iter) {\n//     yield { cell, value: grid.accessor(cell, `undefined`) }\n//   }\n// }\n// export const byCells = (grid: Grid, options: Partial<VisitorOpts> = {}) => {\n//   return (logic: NeighbourSelectionLogic, optionsOverride: Partial<VisitorOpts> = {}) => {\n//     return visitByNeighbours(logic, grid, { ...options, ...optionsOverride });\n//   }\n// }\n// export const byCellsLeftToRightTopToBottom = ():CreateVisitor => {\n//   return (grid) => {\n//     return cells(grid)\n//   }\n// }\n","export * from './apply-bounds.js';\nexport * as Array1d from './array-1d.js';\nexport * as Array2d from './array-2d.js';\n/**\n * Iterates over slices of the grid (eg a whole row, a whole column)\n */\nexport * as As from './as.js';\nexport * from './directions.js';\nexport * as By from './enumerators/index.js';\nexport * from './geometry.js';\nexport * from './guards.js';\nexport * from './indexing.js';\nexport * from './inside.js';\nexport * from './is-equal.js';\nexport * from './neighbour.js';\nexport * from './offset.js';\nexport * from './to-array.js';\nexport * from './to-string.js';\nexport * from './visual.js';\nexport * from './values.js';\nexport * as Visit from './visitors/index.js';\n","import { isQuadraticBezier } from \"../bezier/guard.js\";\nimport { isLine } from \"../line/guard.js\";\n/**\n * Return the start point of a path\n *\n * @param path\n * @return Point\n */\nexport const getStart = function (path) {\n    if (isQuadraticBezier(path))\n        return path.a;\n    else if (isLine(path))\n        return path.a;\n    else\n        throw new Error(`Unknown path type ${JSON.stringify(path)}`);\n};\n/**\n * Return the end point of a path\n *\n * @param path\n * @return Point\n */\nexport const getEnd = function (path) {\n    if (isQuadraticBezier(path))\n        return path.b;\n    else if (isLine(path))\n        return path.b;\n    else\n        throw new Error(`Unknown path type ${JSON.stringify(path)}`);\n};\n","import { bbox as PointsBbox } from '../point/bbox.js';\nimport { isEqual as PointsIsEqual } from '../point/is-equal.js';\nimport { corners as RectsCorners } from '../rect/corners.js';\nimport { sortByNumericProperty } from '@ixfx/arrays';\nimport { getEnd, getStart } from './start-end.js';\n/**\n * Returns a new compoundpath, replacing a path at a given index\n *\n * @param compoundPath Existing compoundpath\n * @param index Index to replace at\n * @param path Path to substitute in\n * @returns New compoundpath\n */\nexport const setSegment = (compoundPath, index, path) => {\n    const existing = [...compoundPath.segments];\n    //eslint-disable-next-line functional/prefer-readonly-type,functional/immutable-data\n    existing[index] = path;\n    return fromPaths(...existing);\n};\n/**\n * Computes x,y point at a relative position along compoundpath\n *\n * @param paths Combined paths (assumes contiguous)\n * @param t Position (given as a percentage from 0 to 1)\n * @param useWidth If true, widths are used for calulcating. If false, lengths are used\n * @param dimensions Precalculated dimensions of paths, will be computed if omitted\n * @returns\n */\nexport const interpolate = (paths, t, useWidth, dimensions) => {\n    if (dimensions === undefined) {\n        dimensions = computeDimensions(paths);\n    }\n    // Expected value to land on\n    const expected = t * (useWidth ? dimensions.totalWidth : dimensions.totalLength);\n    let soFar = 0;\n    // Use widths or lengths?\n    const l = useWidth ? dimensions.widths : dimensions.lengths;\n    for (const [index, element] of l.entries()) {\n        if (soFar + element >= expected) {\n            const relative = expected - soFar;\n            let amt = relative / element;\n            if (amt > 1)\n                amt = 1;\n            return paths[index].interpolate(amt);\n        }\n        else\n            soFar += element;\n    }\n    return { x: 0, y: 0 };\n};\n/**\n * Returns the shortest distance of `point` to any point on `paths`.\n * @param paths\n * @param point\n * @returns\n */\nexport const distanceToPoint = (paths, point) => {\n    if (paths.length === 0)\n        return 0;\n    let distances = paths.map((p, index) => ({ path: p, index, distance: p.distanceToPoint(point) }));\n    distances = sortByNumericProperty(distances, `distance`);\n    if (distances.length === 0)\n        throw new Error(`Could not look up distances`);\n    return distances[0].distance;\n};\n/**\n * Relative position\n * @param paths Paths\n * @param point Point\n * @param intersectionThreshold Threshold\n * @param dimensions Pre-computed dimensions\n * @returns\n */\nexport const relativePosition = (paths, point, intersectionThreshold, dimensions) => {\n    if (dimensions === undefined) {\n        dimensions = computeDimensions(paths);\n    }\n    let distances = paths.map((p, index) => ({ path: p, index, distance: p.distanceToPoint(point) }));\n    distances = sortByNumericProperty(distances, `distance`);\n    if (distances.length < 0)\n        throw new Error(`Point does not intersect with path`);\n    const d = distances[0];\n    if (d.distance > intersectionThreshold)\n        throw new Error(`Point does not intersect with path. Minimum distance: ${d.distance}, threshold: ${intersectionThreshold}`);\n    const relativePositionOnPath = d.path.relativePosition(point, intersectionThreshold);\n    // Add up distances\n    let accumulated = 0;\n    for (let index = 0; index < d.index; index++) {\n        // Add up length of paths before closest path segment\n        accumulated += dimensions.lengths[index];\n    }\n    // Add up partial amount of closest path\n    accumulated += dimensions.lengths[d.index] * relativePositionOnPath;\n    const accumulatedRel = accumulated / dimensions.totalLength;\n    console.log(`acc: ${accumulated} rel: ${accumulatedRel} on path: ${relativePositionOnPath} path: ${d.index}`);\n    return accumulatedRel;\n};\n/**\n * Computes the widths and lengths of all paths, adding them up as well\n *\n * @param paths\n * @returns\n */\nexport const computeDimensions = (paths) => {\n    const widths = paths.map(l => l.bbox().width);\n    const lengths = paths.map(l => l.length());\n    let totalLength = 0;\n    let totalWidth = 0;\n    for (const length of lengths) {\n        totalLength += length;\n    }\n    for (const width of widths) {\n        totalWidth += width;\n    }\n    return { totalLength, totalWidth, widths, lengths };\n};\n/**\n * Computes the bounding box that encloses entire compoundpath\n *\n * @param paths\n * @returns\n */\nexport const bbox = (paths) => {\n    const boxes = paths.map(p => p.bbox());\n    const corners = boxes.flatMap(b => RectsCorners(b));\n    return PointsBbox(...corners);\n};\n/**\n * Produce a human-friendly representation of paths\n *\n * @param paths\n * @returns\n */\nexport const toString = (paths) => paths.map(p => p.toString()).join(`, `);\n/**\n * Throws an error if paths are not connected together, in order\n *\n * @param paths\n */\nexport const guardContinuous = (paths) => {\n    let lastPos = getEnd(paths[0]);\n    for (let index = 1; index < paths.length; index++) {\n        const start = getStart(paths[index]);\n        if (!PointsIsEqual(start, lastPos))\n            throw new Error(`Path index ${index} does not start at prior path end. Start: ${start.x},${start.y} expected: ${lastPos.x},${lastPos.y}`);\n        lastPos = getEnd(paths[index]);\n    }\n};\nexport const toSvgString = (paths) => paths.flatMap(p => p.toSvgString());\n/**\n * Create a compoundpath from an array of paths.\n * All this does is verify they are connected, and precomputes dimensions\n *\n * @param paths\n * @returns\n */\nexport const fromPaths = (...paths) => {\n    guardContinuous(paths); // Throws an error if paths are not connected\n    const dims = computeDimensions(paths);\n    return Object.freeze({\n        segments: paths,\n        length: () => dims.totalLength,\n        nearest: (_) => { throw new Error(`not implemented`); },\n        interpolate: (t, useWidth = false) => interpolate(paths, t, useWidth, dims),\n        relativePosition: (point, intersectionThreshold) => relativePosition(paths, point, intersectionThreshold, dims),\n        distanceToPoint: (point) => distanceToPoint(paths, point),\n        bbox: () => bbox(paths),\n        toString: () => toString(paths),\n        toSvgString: () => toSvgString(paths),\n        kind: `compound`\n    });\n};\n","export * from './compound-path.js';\nexport * from './start-end.js';\n","import { project as PointsProject } from \"../point/project.js\";\n// import { guard as PointGuard } from \"../point/Guard.js\";\n// import { throwNumberTest } from \"@ixfx/guards\";\n// import { piPi } from \"../pi.js\";\n/**\n * A triangle consisting of three empty points (Points.Empty)\n */\nexport const Empty = Object.freeze({\n    a: { x: 0, y: 0 },\n    b: { x: 0, y: 0 },\n    c: { x: 0, y: 0 },\n});\n/**\n * A triangle consisting of three placeholder points (Points.Placeholder)\n */\nexport const Placeholder = Object.freeze({\n    a: { x: Number.NaN, y: Number.NaN },\n    b: { x: Number.NaN, y: Number.NaN },\n    c: { x: Number.NaN, y: Number.NaN },\n});\n/**\n * Returns a triangle anchored at `origin` with a given `length` and `angleRadian`.\n * The origin will be point `b` of the triangle, and the angle will be the angle for b.\n * @param origin Origin\n * @param length Length\n * @param angleRadian Angle\n * @returns\n */\nexport const equilateralFromVertex = (origin, length = 10, angleRadian = Math.PI / 2) => {\n    if (!origin)\n        origin = Object.freeze({ x: 0, y: 0 });\n    const a = PointsProject(origin, length, Math.PI - -angleRadian / 2);\n    const c = PointsProject(origin, length, Math.PI - angleRadian / 2);\n    return { a, b: origin, c };\n};\n","import { equilateralFromVertex } from \"../triangle/create.js\";\nimport { corners as RectsCorners } from '../rect/corners.js';\nimport { fromTopLeft as RectsFromTopLeft } from '../rect/from-top-left.js';\nimport { rotate as PointsRotate } from \"../point/rotate.js\";\n/**\n * Returns the points forming an arrow.\n *\n * @example Create an arrow anchored by its tip at 100,100\n * ```js\n * const opts = {\n *  tailLength: 10,\n *  arrowSize: 20,\n *  tailThickness: 5,\n *  angleRadian: degreeToRadian(45)\n * }\n * const arrow = Shapes.arrow({x:100, y:100}, `tip`, opts); // Yields an array of points\n *\n * // Eg: draw points\n * Drawing.connectedPoints(ctx, arrow, {strokeStyle: `red`, loop: true});\n * ```\n *\n * @param origin Origin of arrow\n * @param from Does origin describe the tip, tail or middle?\n * @param opts Options for arrow\n * @returns\n */\nexport const arrow = (origin, from, opts = {}) => {\n    const tailLength = opts.tailLength ?? 10;\n    const tailThickness = opts.tailThickness ?? Math.max(tailLength / 5, 5);\n    const angleRadian = opts.angleRadian ?? 0;\n    const arrowSize = opts.arrowSize ?? Math.max(tailLength / 5, 15);\n    const triAngle = Math.PI / 2;\n    let tri;\n    let tailPoints;\n    if (from === `tip`) {\n        tri = equilateralFromVertex(origin, arrowSize, triAngle);\n        tailPoints = RectsCorners(RectsFromTopLeft({ x: tri.a.x - tailLength, y: origin.y - tailThickness / 2 }, tailLength, tailThickness));\n    }\n    else if (from === `middle`) {\n        const midX = tailLength + arrowSize / 2;\n        const midY = tailThickness / 2;\n        tri = equilateralFromVertex({\n            x: origin.x + arrowSize * 1.2,\n            y: origin.y,\n        }, arrowSize, triAngle);\n        tailPoints = RectsCorners(RectsFromTopLeft({ x: origin.x - midX, y: origin.y - midY }, tailLength + arrowSize, tailThickness));\n    }\n    else {\n        //const midY = origin.y - tailThickness/2;\n        tailPoints = RectsCorners(RectsFromTopLeft({ x: origin.x, y: origin.y - tailThickness / 2 }, tailLength, tailThickness));\n        tri = equilateralFromVertex({ x: origin.x + tailLength + arrowSize * 0.7, y: origin.y }, arrowSize, triAngle);\n    }\n    const arrow = PointsRotate([\n        tailPoints[0],\n        tailPoints[1],\n        tri.a,\n        tri.b,\n        tri.c,\n        tailPoints[2],\n        tailPoints[3],\n    ], angleRadian, origin);\n    return arrow;\n};\n","import { isPoint, guard as PointsGuard, isPlaceholder as PointsIsPlaceholder, isEmpty as PointsIsEmpty } from '../point/guard.js';\nimport { isEqual as PointsIsEqual } from \"../point/is-equal.js\";\n/**\n * Throws an exception if the triangle is invalid\n * @param t\n * @param name\n */\nexport const guard = (t, name = `t`) => {\n    if (t === undefined)\n        throw new Error(`{$name} undefined`);\n    PointsGuard(t.a, name + `.a`);\n    PointsGuard(t.b, name + `.b`);\n    PointsGuard(t.c, name + `.c`);\n};\n/**\n * Returns true if the parameter appears to be a valid triangle\n * @param p\n * @returns\n */\nexport const isTriangle = (p) => {\n    if (p === undefined)\n        return false;\n    const tri = p;\n    if (!isPoint(tri.a))\n        return false;\n    if (!isPoint(tri.b))\n        return false;\n    if (!isPoint(tri.c))\n        return false;\n    return true;\n};\n/**\n * Returns true if triangle is empty\n * @param t\n * @returns\n */\nexport const isEmpty = (t) => PointsIsEmpty(t.a) && PointsIsEmpty(t.b) && PointsIsEmpty(t.c);\n/**\n * Returns true if triangle is a placeholder\n * @param t\n * @returns\n */\nexport const isPlaceholder = (t) => PointsIsPlaceholder(t.a) &&\n    PointsIsPlaceholder(t.b) &&\n    PointsIsPlaceholder(t.c);\n/**\n * Returns true if the two parameters have equal values\n * @param a\n * @param b\n * @returns\n */\nexport const isEqual = (a, b) => PointsIsEqual(a.a, b.a) &&\n    PointsIsEqual(a.b, b.b) &&\n    PointsIsEqual(a.c, b.c);\n","import { guard } from \"./guard.js\";\nimport { reduce as PointsReduce } from '../point/index.js';\n/**\n * Returns simple centroid of triangle\n * @param t\n * @returns\n */\nexport const centroid = (t) => {\n    guard(t);\n    const total = PointsReduce([t.a, t.b, t.c], (p, accumulator) => ({\n        x: p.x + accumulator.x,\n        y: p.y + accumulator.y,\n    }));\n    const div = {\n        x: total.x / 3,\n        y: total.y / 3,\n    };\n    return div;\n};\n","import { isCircle, isCirclePositioned } from \"../circle/guard.js\";\nimport { isRect, isRectPositioned } from \"../rect/guard.js\";\nimport { randomPoint as circleRandomPoint } from '../circle/random.js';\nimport { randomPoint as rectRandomPoint } from '../rect/random.js';\nimport { center as circleCenter } from '../circle/center.js';\nimport { isTriangle } from \"../triangle/guard.js\";\nimport { centroid as triangleCentroid } from \"../triangle/centroid.js\";\nimport { center as rectCenter } from '../rect/center.js';\n/**\n * Returns a random point within a shape.\n * `shape` can be {@link Circles.CirclePositioned} or {@link Rects.RectPositioned}\n * @param shape\n * @param opts\n * @returns\n */\nexport const randomPoint = (shape, opts = {}) => {\n    if (isCirclePositioned(shape)) {\n        return circleRandomPoint(shape, opts);\n    }\n    else if (isRectPositioned(shape)) {\n        return rectRandomPoint(shape, opts);\n    }\n    throw new Error(`Unknown shape. Only CirclePositioned and RectPositioned are supported.`);\n};\n// export type Shape = {\n//   intersects(x:Point|Shape):ContainsResult\n//   readonly kind:`circular`\n// }\n/**\n * Returns the center of a shape\n * Shape can be: rectangle, triangle, circle\n * @param shape\n * @returns\n */\nexport const center = (shape) => {\n    if (shape === undefined) {\n        return Object.freeze({ x: 0.5, y: 0.5 });\n    }\n    else if (isRect(shape)) {\n        return rectCenter(shape);\n    }\n    else if (isTriangle(shape)) {\n        return triangleCentroid(shape);\n    }\n    else if (isCircle(shape)) {\n        return circleCenter(shape);\n    }\n    else {\n        throw new Error(`Unknown shape: ${JSON.stringify(shape)}`);\n    }\n};\n","import { isCirclePositioned } from \"../circle/guard.js\";\nimport { isRectPositioned } from \"../rect/guard.js\";\nimport { isIntersecting as CirclesIsIntersecting } from '../circle/intersecting.js';\nimport { isIntersecting as RectsIsIntersecting } from '../rect/Intersects.js';\n/**\n * Returns the intersection result between a and b.\n * `a` can be a {@link Circles.CirclePositioned} or {@link Rects.RectPositioned}\n * `b` can be as above or a {@link Point}.\n * @param a\n * @param b\n */\nexport const isIntersecting = (a, b) => {\n    if (isCirclePositioned(a)) {\n        return CirclesIsIntersecting(a, b);\n    }\n    else if (isRectPositioned(a)) {\n        return RectsIsIntersecting(a, b);\n    }\n    throw new Error(`a or b are unknown shapes. a: ${JSON.stringify(a)} b: ${JSON.stringify(b)}`);\n};\n","import { integerTest, resultThrow } from \"@ixfx/guards\";\nimport { toCartesian } from \"../polar/conversions.js\";\nimport { Empty as PointEmpty } from \"../point/empty.js\";\n/**\n * Generates a starburst shape, returning an array of points. By default, initial point is top and horizontally-centred.\n *\n * ```\n * // Generate a starburst with four spikes\n * const pts = starburst(4, 100, 200);\n * ```\n *\n * `points` of two produces a lozenge shape.\n * `points` of three produces a triangle shape.\n * `points` of five is the familiar 'star' shape.\n *\n * Note that the path will need to be closed back to the first point to enclose the shape.\n *\n * @example Create starburst and draw it. Note use of 'loop' flag to close the path\n * ```\n * const points = starburst(4, 100, 200);\n * Drawing.connectedPoints(ctx, pts, {loop: true, fillStyle: `orange`, strokeStyle: `red`});\n * ```\n *\n * Options:\n * * initialAngleRadian: angle offset to begin from. This overrides the `-Math.PI/2` default.\n *\n * @param points Number of points in the starburst. Defaults to five, which produces a typical star\n * @param innerRadius Inner radius. A proportionally smaller inner radius makes for sharper spikes. If unspecified, 50% of the outer radius is used.\n * @param outerRadius Outer radius. Maximum radius of a spike to origin\n * @param opts Options\n * @param origin Origin, or `{ x:0, y:0 }` by default.\n */\nexport const starburst = (outerRadius, points = 5, innerRadius, origin = PointEmpty, opts) => {\n    resultThrow(integerTest(points, `positive`, `points`));\n    const angle = (Math.PI * 2) / points;\n    const angleHalf = angle / 2;\n    const initialAngle = opts?.initialAngleRadian ?? -Math.PI / 2;\n    if (innerRadius === undefined)\n        innerRadius = outerRadius / 2;\n    let a = initialAngle;\n    const pts = [];\n    for (let index = 0; index < points; index++) {\n        const peak = toCartesian(outerRadius, a, origin);\n        const left = toCartesian(innerRadius, a - angleHalf, origin);\n        const right = toCartesian(innerRadius, a + angleHalf, origin);\n        pts.push(left, peak);\n        if (index + 1 < points)\n            pts.push(right);\n        a += angle;\n    }\n    return pts;\n};\n","export * from './arrow.js';\nexport * from './etc.js';\nexport * from './is-intersecting.js';\nexport * from './starburst.js';\n","import { joinPointsToLines } from './line/join-points-to-lines.js';\nimport { toPath } from './line/to-path.js';\nimport { distance as PointsDistance } from \"./point/distance.js\";\nimport { sortByNumericProperty } from \"@ixfx/arrays\";\n/**\n * Create from set of points, connected in order starting at array position 0.\n * @param waypoints\n * @param opts\n * @returns\n */\nexport const fromPoints = (waypoints, opts = {}) => {\n    const lines = joinPointsToLines(...waypoints);\n    return init(lines.map((l) => toPath(l)), opts);\n};\n/**\n * Initialise\n *\n * Options:\n * * maxDistanceFromLine: Distances greater than this are not matched. Default 0.1\n * @param paths\n * @param opts\n * @returns\n */\nexport const init = (paths, opts = {}) => {\n    //const enforceOrder = opts.enforceOrder ?? true;\n    const maxDistanceFromLine = opts.maxDistanceFromLine ?? 0.1;\n    const checkUnordered = (pt) => {\n        const results = paths.map((p, index) => {\n            const nearest = p.nearest(pt);\n            const distance = PointsDistance(pt, nearest);\n            // Relative position of nearest point on this path segment\n            const positionRelative = p.relativePosition(nearest, maxDistanceFromLine);\n            ;\n            return { positionRelative, path: p, index, nearest, distance, rank: Number.MAX_SAFE_INTEGER };\n        });\n        const filtered = results.filter((v) => v.distance <= maxDistanceFromLine);\n        const sorted = sortByNumericProperty(filtered, `distance`);\n        // Assign ranks\n        for (let rank = 0; rank < sorted.length; rank++) {\n            sorted[rank].rank = rank;\n        }\n        return sorted;\n    };\n    // const checkUnordered = (p:Point) => {\n    //   // Calculate progress of pointer between all the waypoint lines\n    //   const progresses = lines.map((line, index) => (\n    //     {\n    //       index,\n    //       score: Points.progressBetween(p, line.a, line.b)\n    //     }));\n    //   // Sort by closest\n    //   const sorted = Arrays.sortByNumericProperty(progresses, `score`);\n    // };\n    return checkUnordered;\n};\n","import { sortByNumericProperty } from \"@ixfx/arrays\";\nimport { randomPoint as ShapesRandomPoint } from \"./shape/index.js\";\nimport { isIntersecting as CirclesIsIntersecting } from \"./circle/intersecting.js\";\n/**\n * Naive randomised circle packing.\n * [Algorithm by Taylor Hobbs](https://tylerxhobbs.com/essays/2016/a-randomized-approach-to-cicle-packing)\n */\nexport const random = (circles, container, opts = {}) => {\n    if (!Array.isArray(circles))\n        throw new Error(`Parameter 'circles' is not an array`);\n    const attempts = opts.attempts ?? 2000;\n    const sorted = sortByNumericProperty(circles, `radius`);\n    const positionedCircles = [];\n    const willHit = (b, radius) => positionedCircles.some(v => CirclesIsIntersecting(v, b, radius));\n    while (sorted.length > 0) {\n        //eslint-disable-next-line functional/immutable-data\n        const circle = sorted.pop();\n        if (!circle)\n            break;\n        const randomPointOpts = { ...opts, margin: { x: circle.radius, y: circle.radius } };\n        //eslint-disable-next-line functional/no-let\n        for (let index = 0; index < attempts; index++) {\n            const position = ShapesRandomPoint(container, randomPointOpts);\n            if (!willHit(position, circle.radius)) {\n                //eslint-disable-next-line functional/immutable-data\n                positionedCircles.push(Object.freeze({ ...circle, ...position }));\n                break;\n            }\n        }\n    }\n    return positionedCircles;\n};\n","export * as CirclePacking from './circle-packing.js';\n","import { degreeToRadian } from './angles.js';\nexport const fromDegrees = (radiusX, radiusY, rotationDeg = 0, startAngleDeg = 0, endAngleDeg = 360) => ({\n    radiusX, radiusY,\n    rotation: degreeToRadian(rotationDeg),\n    startAngle: degreeToRadian(startAngleDeg),\n    endAngle: degreeToRadian(endAngleDeg)\n});\n","import { distance } from \"./point/distance.js\";\n/**\n * Simplifies a curve by dropping points based on shortest distance.\n *\n * Values of `epsilon` approaching zero keep more of the original points.\n * Making `epsilon` larger will filter out more points, making the curve more lossy and jagged.\n *\n * ```js\n * // Source set of points that define the curve\n * const pts = [ {x:100,y:200}, {x:10, y:20}, ... ];\n *\n * const simplified = rdpShortestDistance(pts, 3); // Yields an array of points\n * ```\n * It is an implementation of the [Ramer Douglas Peucker algorithm](https://en.wikipedia.org/wiki/Ramer%E2%80%93Douglas%E2%80%93Peucker_algorithm)\n * by Marius Karthaus. Try the online playground: https://karthaus.nl/rdp/\n *\n * @param points\n * @param epsilon\n * @returns\n */\nexport const rdpShortestDistance = (points, epsilon = 0.1) => {\n    const firstPoint = points[0];\n    // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n    const lastPoint = points.at(-1);\n    if (points.length < 3) {\n        return points;\n    }\n    let index = -1;\n    let distribution = 0;\n    for (let index_ = 1; index_ < points.length - 1; index_++) {\n        const cDistribution = distanceFromPointToLine(points[index_], firstPoint, lastPoint);\n        if (cDistribution > distribution) {\n            distribution = cDistribution;\n            index = index_;\n        }\n    }\n    if (distribution > epsilon) {\n        // iterate\n        const l1 = points.slice(0, index + 1);\n        const l2 = points.slice(index);\n        const r1 = rdpShortestDistance(l1, epsilon);\n        const r2 = rdpShortestDistance(l2, epsilon);\n        // concat r2 to r1 minus the end/startpoint that will be the same\n        const rs = [...r1.slice(0, -1), ...r2]; //concat(r2);\n        return rs;\n    }\n    else {\n        return [firstPoint, lastPoint];\n    }\n};\n/**\n * Simplifies a curve by dropping points based on perpendicular distance\n *\n * Values of `epsilon` approaching zero keep more of the original points.\n * Making `epsilon` larger will filter out more points, making the curve more lossy and jagged.\n *\n * ```js\n * // Source set of points that define the curve\n * const pts = [ {x:100,y:200}, {x:10, y:20}, ... ];\n *\n * const simplified = rdpShortestDistance(pts, 3); // Yields an array of points\n * ```\n * It is an implementation of the [Ramer Douglas Peucker algorithm](https://en.wikipedia.org/wiki/Ramer%E2%80%93Douglas%E2%80%93Peucker_algorithm)\n * by Marius Karthaus. Try the online playground: https://karthaus.nl/rdp/\n *\n * @param points\n * @param epsilon\n * @returns\n */\nexport const rdpPerpendicularDistance = (points, epsilon = 0.1) => {\n    const firstPoint = points[0];\n    // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n    const lastPoint = points.at(-1);\n    if (points.length < 3) {\n        return points;\n    }\n    let index = -1;\n    let distribution = 0;\n    for (let index_ = 1; index_ < points.length - 1; index_++) {\n        const cDistribution = findPerpendicularDistance(points[index_], firstPoint, lastPoint);\n        if (cDistribution > distribution) {\n            distribution = cDistribution;\n            index = index_;\n        }\n    }\n    if (distribution > epsilon) {\n        // iterate\n        const l1 = points.slice(0, index + 1);\n        const l2 = points.slice(index);\n        const r1 = rdpPerpendicularDistance(l1, epsilon);\n        const r2 = rdpPerpendicularDistance(l2, epsilon);\n        // concat r2 to r1 minus the end/startpoint that will be the same\n        const rs = [...r1.slice(0, -1), ...r2];\n        return rs;\n    }\n    else {\n        return [firstPoint, lastPoint];\n    }\n};\nfunction findPerpendicularDistance(p, p1, p2) {\n    // if start and end point are on the same x the distance is the difference in X.\n    let result;\n    let slope;\n    let intercept;\n    if (p1.x == p2.x) {\n        result = Math.abs(p.x - p1.x);\n    }\n    else {\n        slope = (p2.y - p1.y) / (p2.x - p1.x);\n        intercept = p1.y - (slope * p1.x);\n        result = Math.abs(slope * p.x - p.y + intercept) / Math.sqrt(Math.pow(slope, 2) + 1);\n    }\n    return result;\n}\nconst distanceFromPointToLine = (p, index, index_) => {\n    const lineLength = distance(index, index_); //First, we need the length of the line segment.\n    if (lineLength == 0) { //if it's 0, the line is actually just a point.\n        return distance(p, index);\n    }\n    const t = ((p.x - index.x) * (index_.x - index.x) + (p.y - index.y) * (index_.y - index.y)) / lineLength;\n    //t is very important. t is a number that essentially compares the individual coordinates\n    //distances between the point and each point on the line.\n    if (t < 0) { //if t is less than 0, the point is behind i, and closest to i.\n        return distance(p, index);\n    } //if greater than 1, it's closest to j.\n    if (t > 1) {\n        return distance(p, index_);\n    }\n    return distance(p, { x: index.x + t * (index_.x - index.x), y: index.y + t * (index_.y - index.y) });\n};\n","import {} from '@ixfx/collections';\nimport * as Shapes from './shape/index.js';\nimport { fromTopLeft as RectsFromTopLeft } from './rect/from-top-left.js';\nimport { intersectsPoint as RectsIntersectsPoint } from './rect/Intersects.js';\nimport { fromNumbers as PointsFromNumbers } from './point/from.js';\n/**\n * Direction\n */\nexport var Direction;\n(function (Direction) {\n    Direction[Direction[\"Nw\"] = 0] = \"Nw\";\n    Direction[Direction[\"Ne\"] = 1] = \"Ne\";\n    Direction[Direction[\"Sw\"] = 2] = \"Sw\";\n    Direction[Direction[\"Se\"] = 3] = \"Se\";\n})(Direction || (Direction = {}));\n/**\n * Creates a QuadTreeNode\n * @param bounds Bounds of region\n * @param initialData Initial items to place in quad tree\n * @param opts Options\n * @returns New quad tree\n */\nexport const quadTree = (bounds, initialData = [], opts = {}) => {\n    const o = {\n        maxItems: opts.maxItems ?? 4,\n        maxLevels: opts.maxLevels ?? 4\n    };\n    const n = new QuadTreeNode(undefined, bounds, 0, o);\n    for (const d of initialData) {\n        n.add(d);\n    }\n    return n;\n};\n/**\n * QuadTreeNode. The values of the node is an array of {@link QuadTreeItem}.\n *\n * To create, you probably want the {@link quadTree} function.\n *\n */\nexport class QuadTreeNode {\n    boundary;\n    level;\n    opts;\n    #items = [];\n    #children = [];\n    #parent;\n    /**\n     * Constructor\n     * @param boundary\n     * @param level\n     * @param opts\n     */\n    constructor(parent, boundary, level, opts) {\n        this.boundary = boundary;\n        this.level = level;\n        this.opts = opts;\n        this.#parent = parent;\n    }\n    getLengthChildren() {\n        return this.#children.length;\n    }\n    *parents() {\n        //eslint-disable-next-line functional/no-let,@typescript-eslint/no-this-alias\n        let n = this;\n        while (n.#parent !== undefined) {\n            yield n.#parent;\n            n = n.#parent;\n        }\n    }\n    getParent() {\n        return this.#parent;\n    }\n    /**\n     * Iterates over immediate children\n     */\n    *children() {\n        for (const c of this.#children) {\n            yield c;\n        }\n    }\n    /**\n     * Array of QuadTreeItem\n     * @returns\n     */\n    getValue() {\n        return this.#items;\n    }\n    getIdentity() {\n        return this;\n    }\n    /**\n     * Get a descendant node in a given direction\n     * @param d\n     * @returns\n     */\n    direction(d) {\n        return this.#children[d];\n    }\n    /**\n     * Add an item to the quadtree\n     * @param p\n     * @returns False if item is outside of boundary, True if item was added\n     */\n    add(p) {\n        if (!Shapes.isIntersecting(this.boundary, p))\n            return false;\n        if (this.#children.length > 0) {\n            for (const d of this.#children)\n                (d).add(p);\n            return true;\n        }\n        this.#items.push(p);\n        if (this.#items.length > this.opts.maxItems &&\n            this.level < this.opts.maxLevels) {\n            if (this.#children.length === 0) {\n                this.#subdivide();\n            }\n            // Add to child\n            for (const item of this.#items) {\n                for (const d of this.#children)\n                    (d).add(item);\n            }\n            //this.descendants.forEach(d => (d as QuadTreeNode).add(p));\n            this.#items = [];\n        }\n        return true;\n    }\n    /**\n     * Returns true if point is inside node's boundary\n     * @param p\n     * @returns\n     */\n    couldHold(p) {\n        return RectsIntersectsPoint(this.boundary, p);\n    }\n    #subdivide() {\n        const w = this.boundary.width / 2;\n        const h = this.boundary.height / 2;\n        const x = this.boundary.x;\n        const y = this.boundary.y;\n        // top-left corners of each of the four new sections\n        const coords = PointsFromNumbers(x + w, y, x, y, x, y + h, x + w, y + h);\n        const rects = coords.map((p) => RectsFromTopLeft(p, w, h));\n        // rects.forEach((r, index) => {\n        //   this.descendants[index] = new QuadTreeNode(r, this.level + 1, this.opts);\n        // });\n        this.#children = rects.map((r) => new QuadTreeNode(this, r, this.level + 1, this.opts));\n    }\n}\n","import { isPoint } from './point/index.js';\nimport { isRect } from './rect/guard.js';\nimport { Placeholder as PlaceholderRect } from './rect/placeholder.js';\n/**\n * Returns a set of scaler functions, to convert to and from ranges.\n *\n * ```js\n * const scaler = Scaler.scaler(`both`, {width:window.innerWidth, height:window.innerHeight});\n * // Assuming screen of 800x400...\n * scaler.abs(400,200);          // Yields { x:0.5, y:0.5 }\n * scaler.abs({ x:400, y:200 }); // Yields { x:0.5, y:0.5 }\n *\n * scaler.rel(0.5, 0.5);         // Yields: { x:400, y:200 }\n * scaler.rel({ x:0.5, y:0.5 }); // Yields: { x:400, y:200 }\n * ```\n *\n * If no default range is provided, it must be given each time the scale function is used.\n *\n * ```js\n * const scaler = Scaler.scaler(`both`);\n *\n * scaler.abs(400, 200, 800, 400);\n * scaler.abs(400, 200, { width: 800, height: 400 });\n * scaler.abs({ x:400, y: 200}, { width: 800, height: 400 });\n * scaler.abs({ x:400, y: 200}, 800, 400);\n * // All are the same, yielding { x:0.5, y:0.5 }\n *\n * scaler.abs(400, 200); // Throws an exception because there is no scale\n * ```\n * @param scaleBy Dimension to scale by\n * @param defaultRect Default range\n * @returns\n */\nexport const scaler = (scaleBy = `both`, defaultRect) => {\n    const defaultBounds = defaultRect ?? PlaceholderRect;\n    let sw = 1;\n    let sh = 1;\n    let s = { x: 1, y: 1 };\n    const computeScale = () => {\n        switch (scaleBy) {\n            case `height`: {\n                return { x: sh, y: sh };\n            }\n            case `width`: {\n                return { x: sw, y: sw };\n            }\n            case `min`: {\n                return { x: Math.min(sw, sh), y: Math.min(sw, sh) };\n            }\n            case `max`: {\n                return { x: Math.max(sw, sh), y: Math.max(sw, sh) };\n            }\n            default: {\n                return { x: sw, y: sh };\n            }\n        }\n    };\n    const normalise = (a, b, c, d) => {\n        let inX = Number.NaN;\n        let inY = Number.NaN;\n        let outW = defaultBounds.width;\n        let outH = defaultBounds.height;\n        if (typeof a === `number`) {\n            inX = a;\n            if (typeof b === `number`) {\n                inY = b;\n                if (c === undefined)\n                    return [inX, inY, outW, outH];\n                if (isRect(c)) {\n                    outW = c.width;\n                    outH = c.height;\n                }\n                else if (typeof c === `number`) {\n                    outW = c;\n                    if (typeof d === `number`) {\n                        outH = d;\n                    }\n                    else {\n                        throw new TypeError(`Missing final height value`);\n                    }\n                }\n                else\n                    throw new Error(`Missing valid output range`);\n            }\n            else if (isRect(b)) {\n                outW = b.width;\n                outH = b.height;\n            }\n            else {\n                throw new Error(`Expected input y or output Rect to follow first number parameter`);\n            }\n        }\n        else if (isPoint(a)) {\n            inX = a.x;\n            inY = a.y;\n            if (b === undefined)\n                return [inX, inY, outW, outH];\n            if (isRect(b)) {\n                outW = b.width;\n                outH = b.height;\n            }\n            else if (typeof b === `number`) {\n                outW = b;\n                if (typeof c === `number`) {\n                    outH = c;\n                }\n                else {\n                    throw new TypeError(`Expected height as third parameter after Point and output width`);\n                }\n            }\n            else {\n                throw new TypeError(`Expected Rect or width as second parameter when first parameter is a Point`);\n            }\n        }\n        else {\n            throw new Error(`Expected input Point or x value as first parameter`);\n        }\n        return [inX, inY, outW, outH];\n    };\n    const scaleAbs = (a, b, c, d) => {\n        const n = normalise(a, b, c, d);\n        return scaleNormalised(true, ...n);\n    };\n    const scaleRel = (a, b, c, d) => {\n        const n = normalise(a, b, c, d);\n        return scaleNormalised(false, ...n);\n    };\n    const scaleNormalised = (abs, x, y, w, h) => {\n        if (Number.isNaN(w))\n            throw new Error(`Output width range missing`);\n        if (Number.isNaN(h))\n            throw new Error(`Output height range missing`);\n        // If output dimensions has changed since last, create a new scale\n        if (w !== sw || h !== sh) {\n            sw = w;\n            sh = h;\n            s = computeScale();\n        }\n        return abs ? {\n            x: x * s.x,\n            y: y * s.y,\n        } : {\n            x: x / s.x,\n            y: y / s.y,\n        };\n    };\n    return {\n        computeScale,\n        rel: scaleRel,\n        abs: scaleAbs,\n        width: defaultBounds.width,\n        height: defaultBounds.height\n    };\n};\n// export const scalerReactive = (scaleBy: ScaleBy = `both`,\n//   defaultRect?: ReactiveInitial<Rect>) => {\n//   const resolve = (a: Point | Rect | RectPositioned | number, b: Rect | number, c: number, d: number) => {\n//     if (typeof a === `number`) {\n//       if (typeof b === `number`) {\n//         return { x: a, y: b, width: undefined, height: undefined }\n//       } else {\n//         throw new TypeError(`Expected 'b' parameter to be the y value?`);\n//       }\n//     } else if (isPoint(a)) {\n//       if (isRect(b)) {\n//         // Positioned rect\n//         return {\n//           x: \n//       }\n//       }\n//     }\n//   }\n","import { toPositioned as circleToPositioned } from './circle/to-positioned.js';\nimport { scale, linearSpace } from '@ixfx/numbers';\nconst cos = Math.cos;\nconst sin = Math.sin;\nconst asin = Math.asin;\nconst sqrt = Math.sqrt;\nconst pow = Math.pow;\nconst pi = Math.PI;\nconst piPi = Math.PI * 2;\nconst goldenAngle = pi * (3 - sqrt(5));\nconst goldenSection = (1 + sqrt(5)) / 2;\n/**\n * Generates points on a Vogel spiral - a sunflower-like arrangement of points.\n *\n * @example With no arguments, assumes a unit circle\n * ```js\n * for (const pt of circleVogelSpiral()) {\n *  // Generate points on a unit circle, with 95% density\n * }\n * ```\n *\n *\n * @example Specifying a circle and options\n * ```js\n * const circle = { radius: 100, x: 100, y: 100 };\n * const opts = {\n *  maxPoints: 50,\n *  density: 0.99\n * };\n * for (const pt of circleVogelSpiral(circle, opts)) {\n *  // Do something with point...\n * }\n * ```\n *\n * @example Array format\n * ```js\n * const ptsArray = [...circleVogelSpiral(circle, opts)];\n * ```\n * @param circle\n * @param opts\n */\nexport function* circleVogelSpiral(circle, opts = {}) {\n    const maxPoints = opts.maxPoints ?? 5000;\n    const density = opts.density ?? 0.95;\n    const rotationOffset = opts.rotation ?? 0;\n    const c = circleToPositioned(circle ?? { radius: 1, x: 0, y: 0 });\n    const max = c.radius;\n    //eslint-disable-next-line functional/no-let\n    let spacing = c.radius * scale(density, 0, 1, 0.3, 0.01);\n    if (opts.spacing)\n        spacing = opts.spacing;\n    //eslint-disable-next-line functional/no-let\n    let radius = 0;\n    //eslint-disable-next-line functional/no-let\n    let count = 0;\n    //eslint-disable-next-line functional/no-let\n    let angle = 0;\n    while (count < maxPoints && radius < max) {\n        radius = spacing * count ** 0.5;\n        angle = rotationOffset + (count * 2 * pi) / goldenSection;\n        yield Object.freeze({\n            x: c.x + radius * cos(angle),\n            y: c.y + radius * sin(angle),\n        });\n        count++;\n    }\n}\n/**\n * Generates points spaced out on the given number of rings.\n *\n * Get points as array\n * ```js\n * const circle = { radius: 5, x: 100, y: 100 };\n * const opts = { rings: 5 };\n * const points = [...circleRings(circle, rings)];\n * ```\n *\n * Or iterate over them\n * ```js\n * for (const point of circleRings(circle, opts)) {\n * }\n * ```\n * Source: http://www.holoborodko.com/pavel/2015/07/23/generating-equidistant-points-on-unit-disk/#more-3453\n * @param circle\n */\nexport function* circleRings(circle, opts = {}) {\n    const rings = opts.rings ?? 5;\n    const c = circleToPositioned(circle ?? { radius: 1, x: 0, y: 0 });\n    const ringR = 1 / rings;\n    const rotationOffset = opts.rotation ?? 0;\n    //eslint-disable-next-line functional/no-let\n    let ringCount = 1;\n    // Origin\n    yield Object.freeze({ x: c.x, y: c.y });\n    //eslint-disable-next-line functional/no-let\n    for (let r = ringR; r <= 1; r += ringR) {\n        const n = Math.round(pi / asin(1 / (2 * ringCount)));\n        for (const theta of linearSpace(0, piPi, n + 1)) {\n            yield Object.freeze({\n                x: c.x + r * cos(theta + rotationOffset) * c.radius,\n                y: c.y + r * sin(theta + rotationOffset) * c.radius,\n            });\n        }\n        ringCount++;\n    }\n}\n/**\n * Fibonacci sphere algorithm. Generates points\n * distributed on a sphere.\n *\n * @example Generate points of a unit sphere\n * ```js\n * for (const pt of sphereFibonacci(100)) {\n *  // pt.x, pt.y, pt.z\n * }\n * ```\n *\n * @example Generate points into an array\n * ```js\n * const sphere = { radius: 10, x: 10, y: 200 }\n * const pts = [...sphereFibonacci(100, 0, sphere)];\n * ```\n *\n * Source: https://codepen.io/elchininet/pen/vXeRyL\n *\n * @param samples\n * @returns\n */\nexport function* sphereFibonacci(samples = 100, rotationRadians = 0, sphere) {\n    const offset = 2 / samples;\n    const s = sphere ?? { x: 0, y: 0, z: 0, radius: 1 };\n    for (let index = 0; index < samples; index++) {\n        const y = index * offset - 1 + offset / 2;\n        const r = sqrt(1 - pow(y, 2));\n        const a = ((index + 1) % samples) * goldenAngle + rotationRadians;\n        const x = cos(a) * r;\n        const z = sin(a) * r;\n        //eslint-disable-next-line functional/immutable-data\n        yield Object.freeze({\n            x: s.x + x * s.radius,\n            y: s.y + y * s.radius,\n            z: s.z + z * s.radius,\n        });\n    }\n}\n","import { angleRadian as PointsAngleRadian } from '../point/angle.js';\nimport { guard } from \"./guard.js\";\nimport { radianToDegree } from \"../angles.js\";\n/**\n * Return the three interior angles of the triangle, in radians.\n * @param t\n * @returns\n */\nexport const angles = (t) => {\n    guard(t);\n    return [\n        PointsAngleRadian(t.a, t.b),\n        PointsAngleRadian(t.b, t.c),\n        PointsAngleRadian(t.c, t.a),\n    ];\n};\n/**\n * Returns the three interior angles of the triangle, in degrees\n * @param t\n * @returns\n */\nexport const anglesDegrees = (t) => {\n    guard(t);\n    return radianToDegree(angles(t));\n};\n","import { joinPointsToLines } from \"../line/join-points-to-lines.js\";\nimport { guard } from \"./guard.js\";\n/**\n * Returns the edges (ie sides) of the triangle as an array of lines\n * @param t\n * @returns Array of length three\n */\nexport const edges = (t) => {\n    guard(t);\n    return joinPointsToLines(t.a, t.b, t.c, t.a);\n};\n","import { guard } from \"./guard.js\";\nimport { length as LinesLength } from '../line/length.js';\nimport { edges } from \"./edges.js\";\n/**\n * Calculates the area of a triangle\n * @param t\n * @returns\n */\nexport const area = (t) => {\n    guard(t, `t`);\n    // Get length of edges\n    const lengths = edges(t).map((l) => LinesLength(l));\n    // Add up length of edges, halve\n    const p = (lengths[0] + lengths[1] + lengths[2]) / 2;\n    return Math.sqrt(p * (p - lengths[0]) * (p - lengths[1]) * (p - lengths[2]));\n};\n","import { getPointParameter } from \"../point/get-point-parameter.js\";\nimport { guard } from \"./guard.js\";\n/**\n * Returns the [Barycentric coordinate](https://en.wikipedia.org/wiki/Barycentric_coordinate_system) of a point within a triangle\n *\n * @param t\n * @param a\n * @param b\n * @returns\n */\nexport const barycentricCoord = (t, a, b) => {\n    const pt = getPointParameter(a, b);\n    const ab = (x, y, pa, pb) => (pa.y - pb.y) * x + (pb.x - pa.x) * y + pa.x * pb.y - pb.x * pa.y;\n    const alpha = ab(pt.x, pt.y, t.b, t.c) / ab(t.a.x, t.a.y, t.b, t.c);\n    const theta = ab(pt.x, pt.y, t.c, t.a) / ab(t.b.x, t.b.y, t.c, t.a);\n    const gamma = ab(pt.x, pt.y, t.a, t.b) / ab(t.c.x, t.c.y, t.a, t.b);\n    return {\n        a: alpha,\n        b: theta,\n        c: gamma,\n    };\n};\n/**\n * Convert Barycentric coordinate to Cartesian\n * @param t\n * @param bc\n * @returns\n */\nexport const barycentricToCartestian = (t, bc) => {\n    guard(t);\n    const { a, b, c } = t;\n    const x = a.x * bc.a + b.x * bc.b + c.x * bc.c;\n    const y = a.y * bc.a + b.y * bc.b + c.y * bc.c;\n    if (a.z && b.z && c.z) {\n        const z = a.z * bc.a + b.z * bc.b + c.z * bc.c;\n        return Object.freeze({ x, y, z });\n    }\n    else {\n        return Object.freeze({ x, y });\n    }\n};\n","/**\n * Returns the bounding box that encloses the triangle.\n * @param t\n * @param inflation If specified, box will be inflated by this much. Default: 0.\n * @returns\n */\nexport const bbox = (t, inflation = 0) => {\n    const { a, b, c } = t;\n    const xMin = Math.min(a.x, b.x, c.x) - inflation;\n    const xMax = Math.max(a.x, b.x, c.x) + inflation;\n    const yMin = Math.min(a.y, b.y, c.y) - inflation;\n    const yMax = Math.max(a.y, b.y, c.y) + inflation;\n    const r = {\n        x: xMin,\n        y: yMin,\n        width: xMax - xMin,\n        height: yMax - yMin,\n    };\n    return r;\n};\n","import { guard } from \"./guard.js\";\n/**\n * Returns the corners (vertices) of the triangle as an array of points\n * @param t\n * @returns Array of length three\n */\nexport const corners = (t) => {\n    guard(t);\n    return [t.a, t.b, t.c];\n};\n","import { numberTest, resultThrow } from \"@ixfx/guards\";\nimport { fromNumbers as PointsFromNumbers } from \"../point/from.js\";\nimport { guard as PointGuard } from \"../point/guard.js\";\nimport { piPi } from \"../pi.js\";\nimport { toCartesian as PolarToCartesian } from \"../polar/conversions.js\";\n/**\n * Returns an equilateral triangle centered at the origin.\n *\n * ```js\n * // Create a triangle at 100,100 with radius of 60\n * const tri = fromRadius({x:100,y:100}, 60);\n *\n * // Triangle with point A upwards, B to the right, C to the left\n * constr tri2 = fromRadius({x:100,y:100}, 60, {initialAngleRadian: -Math.PI / 2});\n * ```\n *\n *\n * @param origin Origin\n * @param radius Radius of triangle\n * @param opts Options\n */\nexport const fromRadius = (origin, radius, opts = {}) => {\n    resultThrow(numberTest(radius, `positive`, `radius`));\n    PointGuard(origin, `origin`);\n    const initialAngleRadian = opts.initialAngleRadian ?? 0;\n    const angles = [\n        initialAngleRadian,\n        initialAngleRadian + (piPi * 1) / 3,\n        initialAngleRadian + (piPi * 2) / 3,\n    ];\n    const points = angles.map((a) => PolarToCartesian(radius, a, origin));\n    return fromPoints(points);\n};\n/**\n * Returns a triangle from a set of coordinates in a flat array form:\n * [xA, yA, xB, yB, xC, yC]\n * @param coords\n * @returns\n */\nexport const fromFlatArray = (coords) => {\n    if (!Array.isArray(coords))\n        throw new Error(`coords expected as array`);\n    if (coords.length !== 6) {\n        throw new Error(`coords array expected with 6 elements. Got ${coords.length}`);\n    }\n    return fromPoints(PointsFromNumbers(...coords));\n};\n/**\n * Returns a triangle from an array of three points\n * @param points\n * @returns\n */\nexport const fromPoints = (points) => {\n    if (!Array.isArray(points))\n        throw new Error(`points expected as array`);\n    if (points.length !== 3) {\n        throw new Error(`points array expected with 3 elements. Got ${points.length}`);\n    }\n    const t = {\n        a: points[0],\n        b: points[1],\n        c: points[2],\n    };\n    return t;\n};\n","import { guard } from \"./guard.js\";\nimport { length as LinesLength } from '../line/length.js';\nimport { edges } from \"./edges.js\";\n/**\n * Calculates perimeter of a triangle\n * @param t\n * @returns\n */\nexport const perimeter = (t) => {\n    guard(t);\n    return edges(t).reduce((accumulator, v) => accumulator + LinesLength(v), 0);\n};\n","import { area } from \"./area.js\";\nimport { centroid } from \"./centroid.js\";\nimport { perimeter } from \"./perimeter.js\";\n/**\n * Returns the largest circle enclosed by triangle `t`.\n * @param t\n */\nexport const innerCircle = (t) => {\n    const c = centroid(t);\n    const p = perimeter(t) / 2;\n    const a = area(t);\n    const radius = a / p;\n    return { radius, ...c };\n};\n","import { getPointParameter } from \"../point/get-point-parameter.js\";\nimport { bbox } from \"./bbox.js\";\nimport { intersectsPoint as RectsIntersectsPoint } from '../rect/Intersects.js';\nimport { barycentricCoord } from \"./barycentric.js\";\n/**\n * Returns true if point is within or on the boundary of triangle\n * @param t\n * @param a\n * @param b\n */\nexport const intersectsPoint = (t, a, b) => {\n    const box = bbox(t);\n    const pt = getPointParameter(a, b);\n    // If it's not in the bounding box, can return false straight away\n    if (!RectsIntersectsPoint(box, pt))\n        return false;\n    const bc = barycentricCoord(t, pt);\n    return (0 <= bc.a && bc.a <= 1 && 0 <= bc.b && bc.b <= 1 && 0 <= bc.c && bc.c <= 1);\n};\n","import { guard } from \"./guard.js\";\nimport { distance } from \"../point/distance.js\";\n/**\n * Returns the lengths of the triangle sides\n * @param t\n * @returns Array of length three\n */\nexport const lengths = (t) => {\n    guard(t);\n    return [\n        distance(t.a, t.b),\n        distance(t.b, t.c),\n        distance(t.c, t.a),\n    ];\n};\n","import { angles } from \"./angles.js\";\nimport { guard } from \"./guard.js\";\nimport { lengths } from \"./lengths.js\";\n/**\n * Returns true if it is an equilateral triangle\n * @param t\n * @returns\n */\nexport const isEquilateral = (t) => {\n    guard(t);\n    const [a, b, c] = lengths(t);\n    return a === b && b === c;\n};\n/**\n * Returns true if it is an isosceles triangle\n * @param t\n * @returns\n */\nexport const isIsosceles = (t) => {\n    const [a, b, c] = lengths(t);\n    if (a === b)\n        return true;\n    if (b === c)\n        return true;\n    if (c === a)\n        return true;\n    return false;\n};\n/**\n * Returns true if at least one interior angle is 90 degrees\n * @param t\n * @returns\n */\nexport const isRightAngle = (t) => angles(t).includes(Math.PI / 2);\n/**\n * Returns true if triangle is oblique: No interior angle is 90 degrees\n * @param t\n * @returns\n */\nexport const isOblique = (t) => !isRightAngle(t);\n/**\n * Returns true if triangle is actue: all interior angles less than 90 degrees\n * @param t\n * @returns\n */\nexport const isAcute = (t) => !angles(t).some((v) => v >= Math.PI / 2);\n/**\n * Returns true if triangle is obtuse: at least one interior angle is greater than 90 degrees\n * @param t\n * @returns\n */\nexport const isObtuse = (t) => angles(t).some((v) => v > Math.PI / 2);\n","/**\n * Applies `fn` to each of a triangle's corner points, returning the result.\n *\n * @example Add some random to the x of each corner\n * ```\n * const t = apply(tri, p => {\n *  const r = 10;\n *  return {\n *    x: p.x + (Math.random()*r*2) - r,\n *    y: p.y\n *  }\n * });\n * ```\n * @param t\n * @param fn\n * @returns\n */\nexport const apply = (t, fn) => Object.freeze({\n    ...t,\n    a: fn(t.a, `a`),\n    b: fn(t.b, `b`),\n    c: fn(t.c, `c`),\n});\n","import { length as LinesLength } from '../line/length.js';\nimport { edges } from \"./edges.js\";\nimport { centroid } from './centroid.js';\n/**\n * Returns the largest circle touching the corners of triangle `t`.\n * @param t\n * @returns\n */\nexport const outerCircle = (t) => {\n    const [a, b, c] = edges(t).map((l) => LinesLength(l));\n    const cent = centroid(t);\n    const radius = (a * b * c) /\n        Math.sqrt((a + b + c) * (-a + b + c) * (a - b + c) * (a + b - c));\n    return {\n        radius,\n        ...cent,\n    };\n};\n","import { centroid } from \"./centroid.js\";\nimport { rotate as PointsRotate } from \"../point/index.js\";\n/**\n * Returns a triangle that is rotated by `angleRad`. By default it rotates\n * around its center but an arbitrary `origin` point can be provided.\n *\n * ```js\n * let triangle = Triangles.fromPoints([a, b, c]);\n *\n * // Rotate triangle by 5 degrees\n * triangle = Triangles.rotate(triangle, degreeToRadian(5));\n *\n * // Rotate by 90 degrees\n * triangle = Triangles.rotate(triangle, Math.PI / 2);\n * ```\n * @param triangle Triangle to rotate\n * @param amountRadian Angle in radians to rotate by\n * @param origin Point to rotate around. If undefined, middle of triangle will be used\n * @returns A new triangle\n */\nexport const rotate = (triangle, amountRadian, origin) => {\n    if (amountRadian === undefined || amountRadian === 0)\n        return triangle;\n    if (origin === undefined)\n        origin = centroid(triangle);\n    return Object.freeze({\n        ...triangle,\n        a: PointsRotate(triangle.a, amountRadian, origin),\n        b: PointsRotate(triangle.b, amountRadian, origin),\n        c: PointsRotate(triangle.c, amountRadian, origin),\n    });\n};\n/**\n * Rotates the vertices of the triangle around one point (by default, `b`), returning\n * as a new object.\n *\n * ```js\n * let triangle = Triangles.fromPoints([a, b, c]);\n * triangle = Triangles.rotateByVertex(triangle, Math.Pi, `a`);\n * ```\n * @param triangle Triangle\n * @param amountRadian Angle to rotate by\n * @param vertex Name of vertex: a, b or c.\n * @returns A new triangle\n */\nexport const rotateByVertex = (triangle, amountRadian, vertex = `b`) => {\n    const origin = vertex === `a` ? triangle.a : (vertex === `b` ? triangle.b : triangle.c);\n    return Object.freeze({\n        a: PointsRotate(triangle.a, amountRadian, origin),\n        b: PointsRotate(triangle.b, amountRadian, origin),\n        c: PointsRotate(triangle.c, amountRadian, origin),\n    });\n};\n","import { guard } from \"./guard.js\";\n/**\n * Returns the coordinates of triangle in a flat array form:\n * [xA, yA, xB, yB, xC, yC]\n * @param t\n * @returns\n */\nexport const toFlatArray = (t) => {\n    guard(t);\n    return [t.a.x, t.a.y, t.b.x, t.b.y, t.c.x, t.c.y];\n};\n","const pi4over3 = (Math.PI * 4) / 3;\nconst pi2over3 = (Math.PI * 2) / 3;\nconst resolveLength = (t) => {\n    if (typeof t === `number`)\n        return t;\n    return t.length;\n};\n/**\n * Returns a positioned `Triangle` from an equilateral triangle definition.\n * By default the rotation is such that point `a` and `c` are lying on the horizontal,\n * and `b` is the upward-facing tip.\n *\n * Default is a triangle pointing upwards with b at the top, c to the left and b to right on the baseline.\n *\n * Example rotation values in radians:\n * *  0: a and c on vertical, b at the tip\n * *  Math.PI: `c`and `a` are on vertical, with `b` at the tip.\n * *  Math.PI/2: `c` and `a` are on horizontal, `c` to the left. `b` at the bottom.\n * *  Math.PI*1.5: `c` and `a` are on horizontal, `c` to the right. `b` at the top. (default)\n * @param t\n * @param origin\n * @param rotationRad\n * @returns\n */\nexport const fromCenter = (t, origin, rotationRad) => {\n    if (!origin)\n        origin = Object.freeze({ x: 0, y: 0 });\n    const r = resolveLength(t) / Math.sqrt(3);\n    const rot = rotationRad ?? Math.PI * 1.5;\n    const b = {\n        x: r * Math.cos(rot) + origin.x,\n        y: r * Math.sin(rot) + origin.y,\n    };\n    const a = {\n        x: r * Math.cos(rot + pi4over3) + origin.x,\n        y: r * Math.sin(rot + pi4over3) + origin.y,\n    };\n    const c = {\n        x: r * Math.cos(rot + pi2over3) + origin.x,\n        y: r * Math.sin(rot + pi2over3) + origin.y,\n    };\n    return Object.freeze({ a, b, c });\n};\n/**\n * Calculate center from the given point A\n * @param t\n * @param ptA\n * @returns\n */\nexport const centerFromA = (t, ptA) => {\n    if (!ptA)\n        ptA = Object.freeze({ x: 0, y: 0 });\n    const r = resolveLength(t);\n    const { radius } = incircle(t);\n    return {\n        x: ptA.x + r / 2,\n        y: ptA.y - radius,\n    };\n};\n/**\n * Calculate center from the given point B\n * @param t\n * @param ptB\n * @returns\n */\nexport const centerFromB = (t, ptB) => {\n    if (!ptB)\n        ptB = Object.freeze({ x: 0, y: 0 });\n    const { radius } = incircle(t);\n    return {\n        x: ptB.x,\n        y: ptB.y + radius * 2,\n    };\n};\n/**\n * Calculate center from the given point C\n * @param t\n * @param ptC\n * @returns\n */\nexport const centerFromC = (t, ptC) => {\n    if (!ptC)\n        ptC = Object.freeze({ x: 0, y: 0 });\n    const r = resolveLength(t);\n    const { radius } = incircle(t);\n    return {\n        x: ptC.x - r / 2,\n        y: ptC.y - radius,\n    };\n};\n/**\n * Returns the height (or rise) of an equilateral triangle.\n * Ie. from one vertex to the perpendicular edge.\n * (line marked x in the diagram below)\n *\n * ```\n *      .\n *     .x .\n *    . x  .\n *   .  x   .\n *  ..........\n * ```\n * @param t\n */\nexport const height = (t) => (Math.sqrt(3) / 2) * resolveLength(t);\nexport const perimeter = (t) => resolveLength(t) * 3;\nexport const area = (t) => (Math.pow(resolveLength(t), 2) * Math.sqrt(3)) / 4;\n/**\n * Circle that encompasses all points of triangle\n * @param t\n */\nexport const circumcircle = (t) => ({\n    radius: (Math.sqrt(3) / 3) * resolveLength(t),\n});\n/**\n * Circle that is inside the edges of the triangle\n * @param t\n * @returns\n */\nexport const incircle = (t) => ({\n    radius: (Math.sqrt(3) / 6) * resolveLength(t),\n});\n","/**\n * Returns a positioned triangle from a point for A.\n *\n * ```\n *             c (90 deg)\n *             .\n *          .   .\n *       .       .\n *    .           .\n * a .............. b\n * ```\n * @param t\n * @param origin\n * @returns\n */\nexport const fromA = (t, origin) => {\n    if (!origin)\n        origin = Object.freeze({ x: 0, y: 0 });\n    const tt = resolveLengths(t);\n    const seg = hypotenuseSegments(t);\n    const h = height(t);\n    const a = { x: origin.x, y: origin.y };\n    const b = { x: origin.x + tt.hypotenuse, y: origin.y };\n    const c = { x: origin.x + seg[1], y: origin.y - h };\n    return { a, b, c };\n};\n/**\n * Returns a positioned triangle from a point for B.\n *\n * ```\n *             c (90 deg)\n *             .\n *          .   .\n *       .       .\n *    .           .\n * a .............. b\n * ```\n * @param t\n * @param origin\n * @returns\n */\nexport const fromB = (t, origin) => {\n    if (!origin)\n        origin = Object.freeze({ x: 0, y: 0 });\n    const tt = resolveLengths(t);\n    const seg = hypotenuseSegments(t);\n    const h = height(t);\n    const b = { x: origin.x, y: origin.y };\n    const a = { x: origin.x - tt.hypotenuse, y: origin.y };\n    const c = { x: origin.x - seg[0], y: origin.y - h };\n    return { a, b, c };\n};\n/**\n * Returns a positioned triangle from a point for C.\n *\n * ```\n *             c (90 deg)\n *             .\n *          .   .\n *       .       .\n *    .           .\n * a .............. b\n * ```\n *\n *\n * ```js\n * // Triangle pointing up to 0,0 with sides of 15\n * Triangles.Right.fromC({ adjacent: 15, opposite:15 }, { x: 0, y: 0 });\n * ```\n * @param t\n * @param origin\n * @returns\n */\nexport const fromC = (t, origin) => {\n    if (!origin)\n        origin = Object.freeze({ x: 0, y: 0 });\n    const seg = hypotenuseSegments(t);\n    const h = height(t);\n    const c = { x: origin.x, y: origin.y };\n    const a = { x: origin.x - seg[1], y: origin.y + h };\n    const b = { x: origin.x + seg[0], y: origin.y + h };\n    return { a, b, c };\n};\n/**\n * Returns a right triangle with all lengths defined.\n * At least two lengths must already exist\n * @param t\n * @returns\n */\nexport const resolveLengths = (t) => {\n    const a = t.adjacent;\n    const o = t.opposite;\n    const h = t.hypotenuse;\n    if (a !== undefined && o !== undefined) {\n        return {\n            ...t,\n            adjacent: a,\n            opposite: o,\n            hypotenuse: Math.hypot(a, o),\n        };\n    }\n    else if (a && h) {\n        return {\n            ...t,\n            adjacent: a,\n            hypotenuse: h,\n            opposite: h * h - a * a,\n        };\n    }\n    else if (o && h) {\n        return {\n            ...t,\n            hypotenuse: h,\n            opposite: o,\n            adjacent: h * h - o * o,\n        };\n    }\n    else if (t.opposite && t.hypotenuse && t.adjacent) {\n        return t;\n    }\n    throw new Error(`Missing at least two edges`);\n};\n/**\n * Height of right-triangle\n * @param t\n * @returns\n */\nexport const height = (t) => {\n    const tt = resolveLengths(t);\n    const p = (tt.opposite * tt.opposite) / tt.hypotenuse;\n    const q = (tt.adjacent * tt.adjacent) / tt.hypotenuse;\n    return Math.sqrt(p * q);\n};\n/**\n * Returns the lengths of the hypotenuse split into p and q segments.\n * In other words, if one makes a line from the right-angle vertex down to hypotenuse.\n *\n * [See here](https://rechneronline.de/pi/right-triangle.php)\n * @param t\n * @returns\n */\nexport const hypotenuseSegments = (t) => {\n    const tt = resolveLengths(t);\n    const p = (tt.opposite * tt.opposite) / tt.hypotenuse;\n    const q = (tt.adjacent * tt.adjacent) / tt.hypotenuse;\n    return [p, q];\n};\nexport const perimeter = (t) => {\n    const tt = resolveLengths(t);\n    return tt.adjacent + tt.hypotenuse + tt.opposite;\n};\nexport const area = (t) => {\n    const tt = resolveLengths(t);\n    return (tt.opposite * tt.adjacent) / 2;\n};\n/**\n * Angle (in radians) between hypotenuse and adjacent edge\n * @param t\n * @returns\n */\nexport const angleAtPointA = (t) => {\n    const tt = resolveLengths(t);\n    return Math.acos((tt.adjacent * tt.adjacent +\n        tt.hypotenuse * tt.hypotenuse -\n        tt.opposite * tt.opposite) /\n        (2 * tt.adjacent * tt.hypotenuse));\n};\n/**\n * Angle (in radians) between opposite edge and hypotenuse\n * @param t\n * @returns\n */\nexport const angleAtPointB = (t) => {\n    const tt = resolveLengths(t);\n    return Math.acos((tt.opposite * tt.opposite +\n        tt.hypotenuse * tt.hypotenuse -\n        tt.adjacent * tt.adjacent) /\n        (2 * tt.opposite * tt.hypotenuse));\n};\n/**\n * Returns the median line lengths a, b and c in an array.\n *\n * The median lines are the lines from each vertex to the center.\n *\n * @param t\n * @returns\n */\nexport const medians = (t) => {\n    const tt = resolveLengths(t);\n    const b = tt.adjacent * tt.adjacent;\n    const c = tt.hypotenuse * tt.hypotenuse;\n    const a = tt.opposite * tt.opposite;\n    return [\n        Math.sqrt(2 * (b + c) - a) / 2,\n        Math.sqrt(2 * (c + a) - b) / 2,\n        Math.sqrt(2 * (a + b) - c) / 2,\n    ];\n};\n/**\n * The circle which passes through the points of the triangle\n * @param t\n * @returns\n */\nexport const circumcircle = (t) => {\n    const tt = resolveLengths(t);\n    return { radius: tt.hypotenuse / 2 };\n};\n/**\n * Circle enclosed by triangle\n * @param t\n * @returns\n */\nexport const incircle = (t) => {\n    const tt = resolveLengths(t);\n    return {\n        radius: (tt.adjacent + tt.opposite - tt.hypotenuse) / 2,\n    };\n};\n/**\n * Returns the opposite length of a right-angle triangle,\n * marked here\n *\n * ```\n *    .  <\n *   ..  <\n * ....  <\n * ```\n *\n * This is just:\n * ```js\n * opposite = Math.tan(angle) * adjacent\n * ```\n * @param angleRad\n * @param adjacent\n * @returns\n */\nexport const oppositeFromAdjacent = (angleRad, adjacent) => Math.tan(angleRad) * adjacent;\n/**\n * Returns the opposite length of a right-angle triangle,\n * marked here\n *\n * ```\n *    .  <\n *   ..  <\n * ....  <\n * ```\n *\n * This is just:\n * ```js\n * opposite = Math.tan(angle) * adjacent\n * ```\n * @param angleRad\n * @param hypotenuse\n * @returns\n */\nexport const oppositeFromHypotenuse = (angleRad, hypotenuse) => Math.sin(angleRad) * hypotenuse;\n/**\n * Returns the adjecent length of a right-angle triangle,\n * marked here\n * ```\n *    .\n *   ..  o\n * ....\n * ^^^^\n * ```\n * This is just:\n * ```js\n * opposite = Math.tan(angle) * adjacent\n * ```\n * @param angleRadian\n * @param hypotenuse\n * @returns\n */\nexport const adjacentFromHypotenuse = (angleRadian, hypotenuse) => Math.cos(angleRadian) * hypotenuse;\n/**\n * Returns the adjecent length of a right-angle triangle,\n * marked here\n * ```\n *    .\n *   ..  o\n * ....\n * ^^^^\n * ```\n * This is just:\n * ```js\n * opposite = Math.tan(angle) * adjacent\n * ```\n * @param angleRadian\n * @param opposite\n * @returns\n */\nexport const adjacentFromOpposite = (angleRadian, opposite) => opposite / Math.tan(angleRadian);\n/**\n * Returns the hypotenuse length of a right-angle triangle,\n * marked here\n * ```\n *      .\n * >   ..\n * >  ...\n * > ....  opp\n *  .....\n *   adj\n * ```\n * This is just:\n * ```js\n * opposite = Math.tan(angle) * adjacent\n * ```\n * @param angleRadian\n * @param opposite\n * @returns\n */\nexport const hypotenuseFromOpposite = (angleRadian, opposite) => opposite / Math.sin(angleRadian);\n/**\n * Returns the hypotenuse length of a right-angle triangle,\n * marked here\n * ```\n *      .\n * >   ..\n * >  ...\n * > ....  opp\n *  .....\n *   adj\n * ```\n * This is just:\n * ```js\n * opposite = Math.tan(angle) * adjacent\n * ```\n * @param angleRadian\n * @param adjacent\n * @returns\n */\nexport const hypotenuseFromAdjacent = (angleRadian, adjacent) => adjacent / Math.cos(angleRadian);\n","export const baseAngle = (t) => Math.acos(t.base / (2 * t.legs));\nexport const apexAngle = (t) => {\n    const aa = t.legs * t.legs;\n    const cc = t.base * t.base;\n    return Math.acos((2 * aa - cc) / (2 * aa));\n};\nexport const height = (t) => {\n    const aa = t.legs * t.legs;\n    const cc = t.base * t.base;\n    return Math.sqrt((4 * aa - cc) / 4);\n};\nexport const legHeights = (t) => {\n    const b = baseAngle(t);\n    return t.base * Math.sin(b);\n};\nexport const perimeter = (t) => 2 * t.legs + t.base;\nexport const area = (t) => {\n    const h = height(t);\n    return (h * t.base) / 2;\n};\nexport const circumcircle = (t) => {\n    const h = height(t);\n    const hh = h * h;\n    const cc = t.base * t.base;\n    return { radius: (4 * hh + cc) / (8 * h) };\n};\nexport const incircle = (t) => {\n    const h = height(t);\n    return { radius: (t.base * h) / (2 * t.legs + t.base) };\n};\nexport const medians = (t) => {\n    const aa = t.legs * t.legs;\n    const cc = t.base * t.base;\n    const medianAB = Math.sqrt(aa + 2 * cc) / 2;\n    const medianC = Math.sqrt(4 * aa - cc) / 2;\n    return [medianAB, medianAB, medianC];\n};\n/**\n * Returns a positioned `Triangle` based on a center origin.\n * Center is determined by the intesecting of the medians.\n *\n * See: https://rechneronline.de/pi/isosceles-triangle.php\n * @param t\n * @param origin\n * @returns\n */\nexport const fromCenter = (t, origin) => {\n    if (!origin)\n        origin = Object.freeze({ x: 0, y: 0 });\n    const h = height(t);\n    const incircleR = incircle(t).radius;\n    const verticalToApex = h - incircleR;\n    const a = { x: origin.x - t.base / 2, y: origin.y + incircleR };\n    const b = { x: origin.x + t.base / 2, y: origin.y + incircleR };\n    const c = { x: origin.x, y: origin.y - verticalToApex };\n    return { a, b, c };\n};\nexport const fromA = (t, origin) => {\n    if (!origin)\n        origin = Object.freeze({ x: 0, y: 0 });\n    const h = height(t);\n    const a = { x: origin.x, y: origin.y };\n    const b = { x: origin.x + t.base, y: origin.y };\n    const c = { x: origin.x + t.base / 2, y: origin.y - h };\n    return { a, b, c };\n};\nexport const fromB = (t, origin) => {\n    if (!origin)\n        origin = Object.freeze({ x: 0, y: 0 });\n    const h = height(t);\n    const b = { x: origin.x, y: origin.y };\n    const a = { x: origin.x - t.base, y: origin.y };\n    const c = { x: origin.x - t.base / 2, y: origin.y - h };\n    return { a, b, c };\n};\nexport const fromC = (t, origin) => {\n    if (!origin)\n        origin = Object.freeze({ x: 0, y: 0 });\n    const h = height(t);\n    const c = { x: origin.x, y: origin.y };\n    const a = { x: origin.x - t.base / 2, y: origin.y + h };\n    const b = { x: origin.x + t.base / 2, y: origin.y + h };\n    return { a, b, c };\n};\n","export * from './angles.js';\nexport * from './area.js';\nexport * from './barycentric.js';\nexport * from './bbox.js';\nexport * from './centroid.js';\nexport * from './corners.js';\nexport * from './create.js';\nexport * from './edges.js';\nexport * from './from.js';\nexport * from './inner-circle.js';\nexport * from './intersects.js';\nexport * from './kinds.js';\nexport * from './lengths.js';\nexport * from './math.js';\nexport * from './outer-circle.js';\nexport * from './perimeter.js';\nexport * from './rotate.js';\nexport * from './to.js';\nexport * from './guard.js';\n/**\n * Functions for working with equilateral triangles, defined by length\n */\nexport * as Equilateral from './equilateral.js';\n/**\n * Functions for working with right-angled triangles, defined by two of three edges\n */\nexport * as Right from './right.js';\nexport * as Isosceles from './isosceles.js';\n/**\n* Triangle.\n*\n* Helpers for creating:\n*  - {@link Triangles.fromFlatArray}: Create from [x1, y1, x2, y2, x3, y3]\n*  - {@link Triangles.fromPoints}: Create from three `{x,y}` sets\n*  - {@link Triangles.fromRadius}: Equilateral triangle of a given radius and center\n*/\n","/**\n * Arcs are a angle-limited circle. Essentially describing a wedge.\n */\nexport * as Arcs from './arc/index.js';\nexport * as Beziers from './bezier/index.js';\n/**\n * A circle is defined as having a radius\n */\nexport * as Circles from './circle/index.js';\nexport * as Grids from './grid/index.js';\nexport * as Lines from './line/index.js';\nexport * as Paths from './path/index.js';\nexport * as Points from './point/index.js';\n/**\n * Work with Polar coordinates.\n * A {@link Polar.Coord} is just `{ angleRadians:number, distance: number }`.\n *\n * Conversion: {@link toCartesian}, {@link fromCartesian}, {@link toString}\n *\n * Math: {@link divide}, {@link invert}, {@link multiply}, {@link dotProduct}\n *\n * Geometric manipulations: {@link rotate}, {@link rotateDegrees}\n *\n * Cleaning: {@link clampMagnitude}, {@link normalise}\n *\n * Debugging: {@link toString}\n *\n * Comparisons: {@link isAntiParallel}, {@link isOpposite}, {@link isParallel}, {@link isPolarCoord}\n */\nexport * as Polar from './polar/index.js';\nexport * as Rects from './rect/index.js';\n/**\n * Generate a few basic geometric shapes\n * Overview:\n * * {@link arrow}\n * * {@link starburst}\n */\nexport * as Shapes from './shape/index.js';\nexport * as Waypoints from './waypoint.js';\nexport * as Layouts from './layout.js';\nexport * from './point/point-tracker.js';\nexport * as Compound from './path/compound-path.js';\nexport * as Ellipses from './ellipse.js';\n//export type * from './types.js';\nexport * from './angles.js';\nexport * as CurveSimplification from './curve-simplification.js';\n/**\n * Quad tree is a datastructure for efficiently determining whether\n * a point/shape is at a location\n * - {@link quadTree}: Create a quad tree\n */\nexport * as QuadTree from './quad-tree.js';\nexport * from './scaler.js';\n/**\n * Helper functions for working with vectors, which can either be a {@link Points.Point} or Polar {@link Polar.Coord}.\n * While most of the functionality is provided in either of those modules, the Vector module lets you cleanly\n * interoperate between these two coordinates.\n */\nexport * as Vectors from './vector.js';\n/**\n * Functions for producing points within a shape.\n * Useful for creating patterns.\n *\n * Overview:\n * * {@link sphereFibonacci}: Generate points on a sphere\n * * {@link circleVogelSpiral}: Generate a sunflower-esque pattern of points in a circle\n */\nexport * as SurfacePoints from './surface-points.js';\n/**\n * Triangle processing.\n *\n * Helpers for creating:\n * - {@link Triangles.fromFlatArray}: Create from `[ aX, aY, bX, bY, cX, cY ]`\n * - {@link Triangles.fromPoints}: Create from an array of three Points.\n * - {@link Triangles.fromRadius}: Equilateral triangle of a given radius and center\n *\n * There are sub-modules for dealing with particular triangles:\n * - {@link Triangles.Equilateral}: Equilateral triangls\n * - {@link Triangles.Right}: Right-angled triangles\n * - {@link Triangles.Isosceles}: Iscosceles triangles\n *\n * Calculations\n * - {@link angles}: Internal angles in radians. {@link anglesDegrees} for degrees.\n * - {@link area}: Area of triangle\n * - {@link bbox}: Bounding box\n * - {@link centroid}: Centroid of triangle\n * - {@link perimeter}: Calculate perimeter\n * - {@link lengths}: Return array lengths of triangle's edges\n * - {@link rotate}, {@link rotateByVertex}\n *\n * Conversions\n * - {@link edges}: Edges of triangle as {@link Lines.Line}\n * - {@link corners}: Corner positions\n * - {@link innerCircle}: Largest circle to fit within triangle\n * - {@link outerCircle}: Largest circle to enclose triangle\n * - {@link toFlatArray}: Returns an array of coordinates: `[aX, aY, bX, bY, cX, cY]`\n *\n * Comparisons\n * - {@link intersectsPoint}: Whether a point intersects triangle\n * - {@link isEqual}: Check whether two triangles have equal values\n * - {@link isAcute}, {@link isEquilateral}, {@link isIsosceles}, {@link isRightAngle}\n * - {@link isTriangle}: Returns true if object has expected properties of a triangle\n */\nexport * as Triangles from './triangle/index.js';\n// try {\n//   if (typeof window !== `undefined`) {\n//     //eslint-disable-next-line functional/immutable-data,@typescript-eslint/no-explicit-any\n//     (window as any).ixfx = { ...(window as any).ixfx, Geometry: { Circles, Arcs, Lines, Rects, Points, Paths, Grids, Beziers, Compound, Ellipses, Polar, Shapes, radiansFromAxisX, radianToDegree, degreeToRadian } };\n//   }\n// } catch { /* no-op */ }\n","import { resultToError } from \"@ixfx/guards\";\n/**\n * Resolves either a string or HTML element to an element.\n * Useful when an argument is either an HTML element or query.\n *\n * ```js\n * resolveEl(`#someId`);\n * resolveEl(someElement);\n * ```\n * @param domQueryOrEl\n * @returns\n */\nexport const resolveEl = (domQueryOrEl) => {\n    const r = resolveElementTry(domQueryOrEl);\n    if (r.success)\n        return r.value;\n    throw resultToError(r);\n};\n/**\n * Tries to resolve a query, returning a `Result`.\n *\n * ```js\n * const { success, value, error } = resolveElementTry(`#some-element`);\n * if (success) {\n *  // Do something with value\n * } else {\n *  console.error(error);\n * }\n * ```\n * @param domQueryOrEl\n * @returns\n */\nexport const resolveElementTry = (domQueryOrEl) => {\n    if (typeof domQueryOrEl === `string`) {\n        const d = document.querySelector(domQueryOrEl);\n        if (d === null) {\n            const error = domQueryOrEl.startsWith(`#`) ? `Query '${domQueryOrEl}' did not match anything. Try '#id', 'div', or '.class'`\n                : `Query '${domQueryOrEl}' did not match anything. Did you mean '#${domQueryOrEl}?`;\n            return { success: false, error };\n        }\n        domQueryOrEl = d;\n    }\n    else if (domQueryOrEl === null) {\n        return { success: false, error: `Param 'domQueryOrEl' is null, cannot resolve.` };\n    }\n    else if (domQueryOrEl === undefined) {\n        return { success: false, error: `Param 'domQueryOrEl' is undefined` };\n    }\n    const el = domQueryOrEl;\n    return { success: true, value: el };\n};\n/**\n * Returns a set of elements.\n *\n * Returns an empty list if `selectors` is undefined or null.\n *\n * @param selectors\n * @returns\n */\nexport const resolveEls = (selectors) => {\n    if (selectors === undefined)\n        return [];\n    if (selectors === null)\n        return [];\n    if (Array.isArray(selectors))\n        return selectors;\n    if (typeof selectors === `string`) {\n        const elements = [...document.querySelectorAll(selectors)];\n        return elements;\n    }\n    return [selectors];\n};\n","import { round } from '@ixfx/numbers';\nimport { resolveEl as resolveElement } from './resolve-el.js';\nimport JSON5 from 'json5';\nconst padding = (v, options) => {\n    if (options.leftPadding) {\n        if (v.length < options.leftPadding)\n            return '&nbsp;'.repeat(options.leftPadding - v.length) + v;\n    }\n    return v;\n};\nconst convertNumber = (v, o) => {\n    v = (o.roundNumbers !== undefined) ? round(o.roundNumbers, v) : v;\n    let asString = (o.precision !== undefined) ? v.toFixed(o.precision) : v.toString();\n    asString = padding(asString.toString(), o);\n    return asString;\n};\nconst toHtmlSimple = (v, options) => {\n    if (v === null)\n        return `(null)`;\n    if (v === undefined)\n        return `(undefined)`;\n    if (typeof v === `boolean`)\n        return v ? `true` : `false`;\n    if (typeof v === `string`)\n        return `\"${v}\"`;\n    if (typeof v === `number`)\n        return convertNumber(v, options.numbers);\n    if (typeof v === `object`)\n        return toTableSimple(v, options);\n    return JSON5.stringify(v);\n};\nconst toTableSimple = (v, options) => {\n    let html = `<div style=\"display:grid; grid-template-columns: repeat(2, 1fr)\">`;\n    for (const entry of Object.entries(v)) {\n        const value = toHtmlSimple(entry[1], options);\n        html += `<div class=\"label\" style=\"display:table-cell\">${entry[0]}</div>\n      <div class=\"data\" style=\"display:table-cell\">${value}</div>`;\n    }\n    html += `</div>`;\n    return html;\n};\n/**\n * Creates a table of data points for each object in the map\n * ```\n * const t = DataTable.fromList(parentEl, map);\n * t.update(newMap);\n * ```\n */\nexport const fromList = (parentOrQuery, data) => {\n    const parent = resolveElement(parentOrQuery);\n    let container = document.createElement(`DIV`);\n    parent.append(container);\n    const options = {\n        numbers: {},\n        objectsAsTables: true\n    };\n    const remove = () => {\n        if (!container)\n            return false;\n        container.remove();\n        container = undefined;\n        return true;\n    };\n    const update = (data) => {\n        const seenTables = new Set();\n        for (const [key, value] of data) {\n            const tKey = `table-${key}`;\n            seenTables.add(tKey);\n            let t = parent.querySelector(`#${tKey}`);\n            if (t === null) {\n                t = document.createElement(`table`);\n                if (!t)\n                    throw new Error(`Could not create table element`);\n                t.id = tKey;\n                parent.append(t);\n            }\n            updateElement(t, value, options);\n        }\n        // Remove tables that aren't present in map\n        const tables = Array.from(parent.querySelectorAll(`table`));\n        for (const t of tables) {\n            if (!seenTables.has(t.id)) {\n                t.remove();\n            }\n        }\n    };\n    if (data)\n        update(data);\n    return { update, remove };\n    // return (d: ReadonlyMap<string, object>) => {\n    //   update(d);\n    // };\n};\n/**\n * Updates the given table element so each entry in the map is a\n * row in the table.\n *\n * Rows are keyed by the map key. Rows with keys not found in the map are deleted.\n * @param t Table\n * @param data Map of data\n * @param options Options\n * @returns\n */\nconst updateElement = (t, data, options) => {\n    const numberFormatting = options.numbers ?? {};\n    //const precision = options.precision ?? 2;\n    const idPrefix = options.idPrefix ?? ``;\n    const objectsAsTables = options.objectsAsTables ?? false;\n    if (data === undefined) {\n        t.innerHTML = ``;\n        return;\n    }\n    const seenRows = new Set();\n    for (const [key, value] of Object.entries(data)) {\n        const domKey = `${idPrefix}-row-${key}`;\n        // Keep track of keys currently in object\n        seenRows.add(domKey);\n        // Is there already a row for this key?\n        let rowEl = t.querySelector(`tr[data-key='${domKey}']`);\n        if (rowEl === null) {\n            // No row, add it\n            rowEl = document.createElement(`tr`);\n            t.append(rowEl);\n            rowEl.setAttribute(`data-key`, domKey);\n            const keyEl = document.createElement(`td`);\n            keyEl.textContent = key;\n            keyEl.classList.add(`label`);\n            rowEl.append(keyEl);\n        }\n        // Is there already a cell for the value?\n        let valEl = rowEl.querySelector(`td[data-key='${domKey}-val']`);\n        if (valEl === null) {\n            // No, create the cell\n            valEl = document.createElement(`td`);\n            valEl.classList.add(`data`);\n            valEl.setAttribute(`data-key`, `${domKey}-val`);\n            rowEl.append(valEl);\n        }\n        // Format the value as HTML\n        let valueHTML;\n        if (options.formatter) {\n            valueHTML = options.formatter(value, key);\n        }\n        // If there's no formatter, or not handled...\n        if (valueHTML === undefined) {\n            if (typeof value === `object`) {\n                valueHTML = objectsAsTables ? toTableSimple(value, options) : JSON5.stringify(value);\n            }\n            else if (typeof value === `number`) {\n                valueHTML = convertNumber(value, numberFormatting);\n                //let vv = (options.roundNumbers) ? round(options.roundNumbers, value) : value;\n                //let vvStr = vv.toFixed(precision);\n                //valueHTML = padding(vvStr, options);\n            }\n            else if (typeof value === `boolean`) {\n                valueHTML = value ? `true` : `false`;\n            }\n            else if (typeof value === `string`) {\n                valueHTML = `\"${value}\"`;\n            }\n            else {\n                valueHTML = JSON.stringify(value);\n            }\n        }\n        // Set the cell value\n        valEl.innerHTML = valueHTML;\n    }\n    // Remove rows that aren't present in data\n    const rows = Array.from(t.querySelectorAll(`tr`));\n    for (const r of rows) {\n        const key = r.getAttribute(`data-key`);\n        if (!seenRows.has(key)) {\n            r.remove();\n        }\n    }\n};\n/**\n * Creates a HTML table where each row is a key-value pair from `data`.\n * First column is the key, second column data.\n *\n * ```js\n * const dt = fromObject(`#hostDiv`);\n * ```\n *\n * `dt` is a function to call when you want to update data:\n *\n * ```js\n * dt({\n *  name: `Blerg`,\n *  height: 120\n * });\n * ```\n */\nexport const fromObject = (parentOrQuery, data, opts = {}) => {\n    const parent = resolveElement(parentOrQuery);\n    const idPrefix = opts.idPrefix ?? Math.floor(Math.random() * 1000).toString();\n    const options = {\n        numbers: {},\n        objectsAsTables: true,\n        idPrefix: ``,\n        ...opts\n    };\n    let t = document.createElement(`table`);\n    parent.append(t);\n    const remove = () => {\n        if (!t)\n            return false;\n        t.remove();\n        t = undefined;\n        return true;\n    };\n    // Update already if there's initial data\n    if (data)\n        updateElement(t, data, options);\n    const update = (d) => {\n        if (!t)\n            throw new Error(`Table disposed`);\n        updateElement(t, d, { ...options, idPrefix });\n    };\n    return { remove, update };\n};\n","import { resolveEl } from './resolve-el.js';\nimport { isPlaceholder as RectsIsPlaceholder } from '@ixfx/geometry/rect';\nimport { Placeholder as PointsPlaceholder, isPlaceholder as PointsIsPlaceholder, Empty as PointsEmpty } from '@ixfx/geometry/point';\nimport { PlaceholderPositioned as RectsPlaceholderPositioned } from '@ixfx/geometry/rect';\nimport { clamp } from '@ixfx/numbers';\nexport const draggable = (elemOrQuery, listener, options = {}) => {\n    const elem = resolveEl(elemOrQuery);\n    /**\n     * Viewport location at drag start\n     */\n    let initialPointerPosition = PointsPlaceholder;\n    let token;\n    const autoTranslate = options.autoTranslate ?? false;\n    const quickDrag = options.quickDrag ?? false;\n    const fence = options.fence ? resolveEl(options.fence) : undefined;\n    const fenceViewport = options.fenceViewport;\n    let fenceOffset = RectsPlaceholderPositioned;\n    const relativePosition = window.getComputedStyle(elem).position === `relative`;\n    // De-select if there's a click elsewhere\n    const onParentClick = () => {\n        const selected = elem.classList.contains(`drag-sel`);\n        if (selected) {\n            elem.classList.remove(`drag-sel`);\n        }\n    };\n    // Click to select\n    const onElementClick = (event) => {\n        const selected = elem.classList.contains(`drag-sel`);\n        if (selected) {\n            elem.classList.remove(`drag-sel`);\n        }\n        else {\n            elem.classList.add(`drag-sel`);\n        }\n        event.stopPropagation();\n    };\n    elem.ownerDocument.addEventListener(`click`, onParentClick);\n    elem.addEventListener(`click`, onElementClick);\n    // Remove event handlers\n    const dragCleanup = () => {\n        elem.classList.remove(`drag-progress`);\n        elem.ownerDocument.removeEventListener(`pointermove`, onPointerMove);\n        elem.ownerDocument.removeEventListener(`pointerup`, onPointerUp);\n        elem.ownerDocument.removeEventListener(`pointercancel`, onDragCancel);\n    };\n    const dispose = () => {\n        if (elem.classList.contains(`drag-progress`)) {\n            onDragCancel(undefined, `dispose`);\n        }\n        else {\n            dragCleanup();\n        }\n        elem.ownerDocument.removeEventListener(`click`, onParentClick);\n        elem.removeEventListener(`click`, onElementClick);\n    };\n    const validateOffsetAndPoint = (offset, x, y) => {\n        if (!RectsIsPlaceholder(fenceOffset)) {\n            offset = {\n                x: clamp(offset.x, fenceOffset.x, fenceOffset.width),\n                y: clamp(offset.y, fenceOffset.y, fenceOffset.height)\n            };\n            if (fenceViewport) {\n                x = clamp(x, fenceViewport.x, fenceViewport.x + fenceViewport.width);\n                y = clamp(y, fenceViewport.y, fenceViewport.y + fenceViewport.height);\n            }\n        }\n        return [offset, { x, y }];\n    };\n    // Dragging\n    let lastMoveOffset = PointsEmpty;\n    const onPointerMove = (moveEvent) => {\n        moveEvent.preventDefault();\n        moveEvent.stopPropagation();\n        const { x, y } = moveEvent;\n        let offset = PointsIsPlaceholder(initialPointerPosition)\n            ? { x: moveEvent.offsetX, y: moveEvent.offsetY }\n            : {\n                x: x - initialPointerPosition.x,\n                y: y - initialPointerPosition.y,\n            };\n        const r = validateOffsetAndPoint(offset, x, y);\n        offset = r[0];\n        const state = {\n            delta: offset,\n            initial: initialPointerPosition,\n            token,\n            viewport: r[1]\n        };\n        if (typeof listener.progress !== `undefined`) {\n            const p = listener.progress(state);\n            if (p.abort) {\n                onDragCancel(undefined, `discontinued`);\n                return;\n            }\n            if (p.viewport) {\n                offset = {\n                    x: p.viewport.x - initialPointerPosition.x,\n                    y: p.viewport.y - initialPointerPosition.y\n                };\n            }\n        }\n        lastMoveOffset = offset;\n        if (autoTranslate) {\n            const offsetX = offset.x;\n            const offsetY = offset.y;\n            elem.style.translate = `${offsetX}px ${offsetY}px`;\n        }\n    };\n    // Done dragging\n    const onPointerUp = (upEvent) => {\n        const bounds = elem.getBoundingClientRect();\n        dragCleanup();\n        const { x, y } = upEvent;\n        // let offset = {\n        //   x: upEvent.x - initialPointerPosition.x,\n        //   y: upEvent.y - initialPointerPosition.y,\n        // };\n        const r = validateOffsetAndPoint(lastMoveOffset, x, y);\n        const state = {\n            initial: initialPointerPosition,\n            token,\n            delta: r[0],\n            viewport: r[1]\n        };\n        if (autoTranslate) {\n            elem.style.translate = `none`;\n            if (relativePosition) {\n                // eslint-disable-next-line @typescript-eslint/no-non-null-assertion, @typescript-eslint/no-non-null-asserted-optional-chain\n                const parent = elem.parentElement?.getBoundingClientRect();\n                elem.style.left = `${bounds.x - parent.left}px`;\n                elem.style.top = `${bounds.y - parent.top}px`;\n            }\n            else {\n                elem.style.left = `${bounds.x}px`;\n                elem.style.top = `${bounds.y}px`;\n            }\n        }\n        if (typeof listener.success !== `undefined`) {\n            listener.success(state);\n        }\n    };\n    // Drag is cancelled\n    const onDragCancel = (event, reason = `pointercancel`) => {\n        dragCleanup();\n        let viewport = PointsPlaceholder;\n        if (event && `x` in event && `y` in event) {\n            viewport = { x: event.x, y: event.y };\n        }\n        const state = {\n            token,\n            initial: initialPointerPosition,\n            delta: { x: -1, y: -1 },\n            viewport\n        };\n        if (typeof listener.abort !== `undefined`) {\n            listener.abort(reason, state);\n        }\n    };\n    elem.addEventListener(`pointerdown`, (event) => {\n        const selected = elem.classList.contains(`drag-sel`);\n        if (!selected && !quickDrag)\n            return;\n        const event_ = event;\n        initialPointerPosition = { x: event_.x, y: event_.y };\n        const s = typeof listener.start === `undefined`\n            ? { allow: true, token }\n            : listener.start();\n        if (!s.allow)\n            return;\n        token = s.token;\n        if (fence) {\n            const fenceBounds = fence.getBoundingClientRect();\n            fenceOffset = {\n                x: fenceBounds.x - initialPointerPosition.x,\n                y: fenceBounds.y - initialPointerPosition.y,\n                width: fenceBounds.x + fenceBounds.width - initialPointerPosition.x,\n                height: fenceBounds.y + fenceBounds.height - initialPointerPosition.y,\n            };\n        }\n        else if (fenceViewport) {\n            fenceOffset = {\n                x: fenceViewport.x - initialPointerPosition.x,\n                y: fenceViewport.y - initialPointerPosition.y,\n                width: (fenceViewport.width + fenceViewport.x) - initialPointerPosition.x,\n                height: (fenceViewport.height + fenceViewport.y) - initialPointerPosition.y\n            };\n        }\n        elem.classList.add(`drag-progress`);\n        elem.ownerDocument.addEventListener(`pointermove`, onPointerMove);\n        elem.ownerDocument.addEventListener(`pointerup`, onPointerUp);\n        elem.ownerDocument.addEventListener(`pointercancel`, onDragCancel);\n    });\n    return dispose;\n};\n","import { resolveEl } from './resolve-el.js';\n/**\n * Adds tab and shift+tab to TEXTAREA\n * @param el\n */\nexport const textAreaKeyboard = (el) => {\n    el.addEventListener(`keydown`, (event) => {\n        const elementValue = el.value;\n        const start = el.selectionStart;\n        const end = el.selectionEnd;\n        if (event.key === `Tab` && event.shiftKey) {\n            if (el.value.substring(start - 2, start) === `  `) {\n                el.value = elementValue.slice(0, Math.max(0, start - 2)) + elementValue.slice(Math.max(0, end));\n            }\n            el.selectionStart = el.selectionEnd = start - 2;\n            event.preventDefault();\n            return false;\n        }\n        else if (event.key === `Tab`) {\n            el.value = elementValue.slice(0, Math.max(0, start)) + `  ` + elementValue.slice(Math.max(0, end));\n            el.selectionStart = el.selectionEnd = start + 2;\n            event.preventDefault();\n            return false;\n        }\n    });\n};\n/**\n * Quick access to <input type=\"checkbox\"> value.\n * Provide a checkbox by string id or object reference. If a callback is\n * supplied, it will be called when the checkbox changes value.\n *\n * ```\n * const opt = checkbox(`#chkMate`);\n * opt.checked; // Gets/sets\n *\n * const opt = checkbox(document.getElementById(`#chkMate`), newVal => {\n *  if (newVal) ...\n * });\n * ```\n * @param {(string | HTMLInputElement)} domIdOrEl\n * @param {(currentVal:boolean) => void} [onChanged]\n * @returns\n */\nexport const checkbox = (domIdOrEl, onChanged) => {\n    const el = resolveEl(domIdOrEl);\n    if (onChanged) {\n        el.addEventListener(`change`, () => {\n            onChanged(el.checked);\n        });\n    }\n    return {\n        get checked() {\n            return el.checked;\n        },\n        set checked(value) {\n            el.checked = value;\n        },\n    };\n};\n/**\n * Numeric INPUT\n *\n * ```\n * const el = numeric(`#num`, (currentValue) => {\n *  // Called when input changes\n * })\n * ```\n *\n * Get/set value\n * ```\n * el.value = 10;\n * ```\n * @param domIdOrEl\n * @param onChanged\n * @param live If true, event handler fires based on `input` event, rather than `change`\n * @returns\n */\nexport const numeric = (domIdOrEl, onChanged, live) => {\n    const el = resolveEl(domIdOrEl);\n    const eventName = live ? `change` : `input`;\n    if (onChanged) {\n        el.addEventListener(eventName, () => {\n            onChanged(Number.parseInt(el.value));\n        });\n    }\n    return {\n        get value() {\n            return Number.parseInt(el.value);\n        },\n        set value(value) {\n            el.value = value.toString();\n        },\n    };\n};\n/**\n * Button\n *\n * ```\n * const b = button(`#myButton`, () => {\n *  console.log(`Button clicked`);\n * });\n * ```\n *\n * ```\n * b.click(); // Call the click handler\n * b.disabled = true / false;\n * ```\n * @param domQueryOrEl Query string or element instance\n * @param onClickHandler Callback when button is clicked\n * @returns\n */\nexport const button = (domQueryOrEl, onClickHandler) => {\n    const el = resolveEl(domQueryOrEl);\n    const addEvent = () => {\n        if (onClickHandler) {\n            el.addEventListener(`click`, onClickHandler);\n        }\n    };\n    const removeEvent = () => {\n        if (onClickHandler) {\n            el.removeEventListener(`click`, onClickHandler);\n        }\n    };\n    addEvent();\n    return {\n        /**\n         * Gets text content of button\n         */\n        get title() {\n            return el.textContent;\n        },\n        /**\n         * Sets text content of button\n         */\n        set title(value) {\n            el.textContent = value;\n        },\n        /**\n         * Disposes the button.\n         * Removes event handler and optionally removes from document\n         * @param deleteElement\n         */\n        dispose(deleteElement = false) {\n            removeEvent();\n            if (deleteElement)\n                el.remove();\n        },\n        /**\n         * Sets the click handler, overwriting existing.\n         * @param handler\n         */\n        onClick(handler) {\n            removeEvent();\n            onClickHandler = handler;\n            addEvent();\n        },\n        /**\n         * Trigger onClick handler\n         */\n        click() {\n            if (onClickHandler)\n                onClickHandler();\n        },\n        /**\n         * Sets disabled state of button\n         */\n        set disabled(value) {\n            el.disabled = value;\n        },\n        /**\n         * Gets the button element\n         */\n        get el() {\n            return el;\n        }\n    };\n};\n/**\n * Creates a BUTTON element, wrapping it via {@link button} and returning it.\n * ```js\n * const b = buttonCreate(`Stop`, () => console.log(`Stop`));\n * someParent.addNode(b.el);\n * ```\n * @param title\n * @param onClick\n * @returns\n */\nexport const buttonCreate = (title, onClick) => {\n    const el = document.createElement(`button`);\n    const w = button(el, onClick);\n    w.title = title;\n    return w;\n};\n/**\n * SELECT element.\n *\n * Handle changes in value:\n * ```\n * const mySelect = select(`#mySelect`, (newValue) => {\n *  console.log(`Value is now ${newValue}`);\n * });\n * ```\n *\n * Enable/disable:\n * ```\n * mySelect.disabled = true / false;\n * ```\n *\n * Get currently selected index or value:\n * ```\n * mySelect.value / mySelect.index\n * ```\n *\n * Is the currently selected value a placeholder?\n * ```\n * mySelect.isSelectedPlaceholder\n * ```\n *\n * Set list of options\n * ```\n * // Adds options, preselecting `opt2`.\n * mySelect.setOpts([`opt1`, `opt2 ...], `opt2`);\n * ```\n *\n * Select an element\n * ```\n * mySelect.select(1); // Select second item\n * mySelect.select(1, true); // If true is added, change handler fires as well\n * ```\n * @param domQueryOrEl Query (eg `#id`) or element\n * @param onChanged Callback when a selection is made\n * @param options Options\n * @return\n */\nexport const select = (domQueryOrEl, onChanged, options = {}) => {\n    const el = resolveEl(domQueryOrEl);\n    const { placeholderOpt, shouldAddChoosePlaceholder = false, autoSelectAfterChoice = -1, } = options;\n    const change = () => {\n        if (onChanged !== undefined)\n            onChanged(el.value);\n        if (autoSelectAfterChoice >= 0)\n            el.selectedIndex = autoSelectAfterChoice;\n    };\n    if (onChanged) {\n        el.addEventListener(`change`, (_event) => {\n            change();\n        });\n    }\n    return {\n        set disabled(value) {\n            el.disabled = value;\n        },\n        get value() {\n            return el.value;\n        },\n        get index() {\n            return el.selectedIndex;\n        },\n        get isSelectedPlaceholder() {\n            return ((shouldAddChoosePlaceholder || options.placeholderOpt !== undefined) &&\n                el.selectedIndex === 0);\n        },\n        setOpts(opts, preSelect) {\n            el.options.length = 0;\n            if (shouldAddChoosePlaceholder)\n                opts = [`-- Choose --`, ...opts];\n            else if (placeholderOpt !== undefined)\n                opts = [placeholderOpt, ...opts];\n            let toSelect = 0;\n            for (const [index, o] of opts.entries()) {\n                const optEl = document.createElement(`option`);\n                optEl.value = o;\n                optEl.innerHTML = o;\n                if (preSelect !== undefined && o === preSelect)\n                    toSelect = index;\n                el.options.add(optEl);\n            }\n            el.selectedIndex = toSelect;\n        },\n        select(index = 0, trigger = false) {\n            el.selectedIndex = index;\n            if (trigger && onChanged) {\n                change();\n            }\n        },\n    };\n};\n","/* eslint-disable unicorn/prevent-abbreviations */\nexport function isHtmlElement(o) {\n    // eslint-disable-next-line @typescript-eslint/no-unsafe-return\n    return (typeof HTMLElement === \"object\" ? o instanceof HTMLElement : //DOM2\n        o && typeof o === \"object\" && o !== null && o.nodeType === 1 && typeof o.nodeName === \"string\");\n}\n","import * as Text from \"@ixfx/core/text\";\nimport { resolveEl } from \"./resolve-el.js\";\nimport { isHtmlElement } from \"./ts-util.js\";\n/**\n * Parses input in the form of: `['elementid-attribute', 'default-value']`.\n * Eg, `['indicator-fill', 'gray']` will yield:\n * ```\n * { variable: `indicator-fill`, attribute: `fill`, id: `indicator`, defaultValue: `gray` }\n * ```\n *\n * Once parsed, use {@link setFromCssVariables} to apply data.\n *\n * ```js\n * // Array of arrays is treated as a set of key-value pairs\n * const options = [ [`indicator-fill`, `gray`], [`backdrop-fill`, `whitesmoke`] ]\n * const attrs = parseCssVariablesAsAttributes(options);\n * Yields:\n * [\n *  { variable: `indicator-fill`, attribute: `fill`, id: `indicator`, defaultValue: `gray` }\n *  { variable: `backdrop-fill`, attribute: `fill`, id: `backdrop`, defaultValue: `whitesmoke` }\n * ]\n *\n * // Assign\n * setFromCssVariables(document.body, attrs);\n * ```\n * @param options\n * @returns\n */\nexport const parseCssVariablesAsAttributes = (options) => {\n    return options.map(opt => {\n        let defaultValue;\n        // Nested array, treat second element as default value, name as first\n        if (Array.isArray(opt)) {\n            defaultValue = opt[1];\n            opt = opt[0];\n        }\n        const dash = opt.indexOf(`-`);\n        if (dash < 0)\n            throw new Error(`Simple expression expects form of: 'elementid-attribute'`);\n        return {\n            variable: opt,\n            attribute: opt.slice(dash + 1),\n            id: opt.slice(0, dash),\n            defaultValue\n        };\n    });\n};\n/**\n * Reads the value of a CSS variable and assign it to HTML attributes or object field.\n *\n * ```js\n * const options = [\n *  // Set the 'width' attribute to the value of --some-css-variable to all elements with class 'blah'\n *  { query: `.blah`, variable: `some-css-variable`, attribute: `width` }\n *\n *  // Set #blah's 'size' attribute to the value of css variable '--size'\n *  { id: 'blah', variable: 'size', attribute: 'size' }\n *\n *  // Sets someEL.blah = css variable '--hue'\n *  { element: someEl, variable: `hue`, field: `blah` }\n * ]\n *\n * setFromCssVariables(document.body, ...options);\n * ```\n *\n * The first parameter is the context for which CSS variable values are fetched\n * as well as for resolving query selectors. This can usually be `document.body`.\n * @param context Context element which is needed for relative querying. Otherwise use document.body\n * @param options Details of what to do\n */\nexport const setFromCssVariables = (context, ...options) => {\n    const contextEl = resolveEl(context);\n    const style = window.getComputedStyle(contextEl);\n    for (const opt of options) {\n        const variable = Text.afterMatch(opt.variable, `--`);\n        let v = style.getPropertyValue(`--${variable}`);\n        if (v === null || v.length === 0) {\n            if (opt.defaultValue === undefined) {\n                continue;\n            }\n            else {\n                v = opt.defaultValue;\n            }\n        }\n        let query;\n        let els; //: SVGElement | HTMLElement | null | undefined;\n        if (`query` in opt && opt.query !== undefined) {\n            query = opt.query;\n        }\n        else if (`id` in opt && opt.id !== undefined) {\n            query = `#${opt.id}`;\n        }\n        else if (`object` in opt && opt.object !== undefined) {\n            els = Array.isArray(opt.object) ? opt.object : [opt.object];\n        }\n        if (query === undefined) {\n            // No query\n            if (els === undefined) {\n                // If there's no query or objects, there's nothing to do\n                throw new Error(`Missing 'query', 'id' or 'object' fields`);\n            }\n        }\n        else {\n            // Run query\n            els = [...contextEl.querySelectorAll(query)]; // as SVGElement | HTMLElement | null | undefined;\n        }\n        if (els === null)\n            continue;\n        if (els === undefined)\n            continue;\n        if (opt.attribute) {\n            for (const el of els) {\n                if (isHtmlElement(el)) {\n                    el.setAttribute(opt.attribute, v);\n                }\n                else {\n                    throw new Error(`Trying to set an attribute on something not a HTML element`, { cause: el });\n                }\n            }\n        }\n        else if (opt.field) {\n            for (const el of els) {\n                if (typeof el === `object`) {\n                    (el)[opt.field] = v;\n                }\n                else {\n                    throw new Error(`Trying to set field on something that is not an object (${typeof el})`, { cause: el });\n                }\n            }\n        }\n        else {\n            throw new Error(`Neither 'attribute' or 'field' to set is defined in option (${JSON.stringify(opt)})`);\n        }\n    }\n};\n/**\n * Computes the styles for `elt` (or defaults to document.body) using `fallback`\n * as a set of default values.\n *\n * ```js\n * // Fetch styles\n * const styles = getCssVariablesWithFallback({\n *  my_var: `red` // reads CSS variable '--my-var'\n * }, element);\n *\n * // Access --my-var, or if it doesn't exist returns 'red'\n * styles.my_var;\n * ```\n *\n * Hyphen case (eg 'my-var') is a common way of delimiting words in CSS variables, but\n * can't be (elegantly) used in object properties. Instead, use '_' in the\n * object key, which is replaced with '-'.\n *\n * The leading '--' is not needed either.\n * @param fallback\n * @param elt\n * @returns\n */\nexport function getCssVariablesWithFallback(fallback, elt) {\n    const styles = getComputedStyle(elt ?? document.body);\n    const entries = Object.entries(fallback);\n    const filledEntries = entries.map(entry => {\n        return [entry[0], getCssVariablesFromStyles(styles, entry[0], entry[1])];\n    });\n    return Object.fromEntries(filledEntries);\n}\n/**\n * Returns the value of a CSS variable. If it is no defined, returns `fallbackValue`;\n * ```js\n * // Returns the value of --fg, or 'white' otherwise\n * getCssVariable(`--fg`, `white`);\n * ```\n *\n * `--` prefix can be omitted:\n * ```js\n * getCssVariable(`fg`, `white`);\n * ```\n * @param cssVariable\n * @param fallbackValue\n * @returns\n */\nexport function getCssVariable(cssVariable, fallbackValue) {\n    if (!cssVariable.startsWith(`--`))\n        cssVariable = `--${cssVariable}`;\n    const fromCss = getComputedStyle(document.body).getPropertyValue(cssVariable).trim();\n    if (fromCss.length === 0)\n        return fallbackValue;\n    return fromCss;\n}\n/**\n * Sets CSS variables using an object.\n *\n * ```js\n * const vars = {\n *  my_var: `red`,\n *  my_size: 10\n * }\n *\n * // Set to document.body\n * setCssVariables(vars);\n *\n * // Set to an element\n * setCssVariables(vars, elem);\n *\n * // Or to a CSSStyleDeclaration\n * setCssVariables(vars, styles);\n * ```\n *\n * @param variables\n * @param stylesOrEl\n */\n// eslint-disable-next-line @typescript-eslint/no-unnecessary-type-parameters\nexport function setCssVariables(variables, stylesOrEl) {\n    const styles = stylesOrEl === undefined ? document.body.style :\n        isHtmlElement(stylesOrEl) ? stylesOrEl.style : stylesOrEl;\n    for (const [key, value] of Object.entries(variables)) {\n        let variableName = key.replaceAll('_', '-');\n        if (!variableName.startsWith(`--`))\n            variableName = `--` + variableName;\n        styles.setProperty(variableName, value.toString());\n    }\n}\n/**\n * Returns a CSS variable from a CSS style declaration, or returning `fallback`.\n * ```js\n * // These will all access --my-var\n * getCssVariablesFromStyles(getComputedStyle(element), `--my-var`, `red`);\n * getCssVariablesFromStyles(getComputedStyle(element), `my-var`, `red`);\n * getCssVariablesFromStyles(getComputedStyle(element), `my_var`, `red`);\n * ```\n * @param styles\n * @param name\n * @param fallback\n * @returns\n */\nexport function getCssVariablesFromStyles(styles, name, fallback) {\n    if (!name.startsWith(`--`))\n        name = `--` + name;\n    name = name.replaceAll(`_`, `-`);\n    const v = styles.getPropertyValue(name);\n    if (v.length === 0) {\n        return fallback;\n    }\n    if (typeof fallback === `number`)\n        return parseFloat(v);\n    if (typeof fallback === `boolean`) {\n        if (v === `true`)\n            return true;\n        else if (v === `false`)\n            return false;\n    }\n    return v;\n}\n","import { resolveEl, resolveEls } from \"./resolve-el.js\";\n/**\n * Returns the value of `getBoundingClientRect` plus the width of all the borders\n * @param elOrQuery\n * @returns\n */\nexport const getBoundingClientRectWithBorder = (elOrQuery) => {\n    let el = resolveEl(elOrQuery);\n    const size = el.getBoundingClientRect();\n    if (el instanceof SVGElement) {\n        el = el.parentElement;\n    }\n    const border = getComputedPixels(el, `borderTopWidth`, `borderLeftWidth`, `borderRightWidth`, `borderBottomWidth`);\n    return {\n        x: size.x,\n        y: size.y,\n        width: size.width + border.borderLeftWidth + border.borderRightWidth,\n        height: size.height + border.borderTopWidth + border.borderBottomWidth\n    };\n};\n/**\n * Returns the computed measurements of CSS properties via [getComputedStyle](https://developer.mozilla.org/en-US/docs/Web/API/Window/getComputedStyle).\n *\n * ```js\n * const v = getComputedPixels(`#some-el`, `borderTopWidth`, `borderLeftWidth`);\n * v.borderTopWidth;  // number\n * b.borderLeftWidth; // number\n * ```\n *\n * Throws an error if value from `getComputedStyle` is not a string or does not end in 'px'.\n * @param elOrQuery\n * @param properties\n * @returns\n */\nexport const getComputedPixels = (elOrQuery, ...properties) => {\n    const s = getComputedStyle(resolveEl(elOrQuery));\n    const returnValue = {};\n    for (const property of properties) {\n        const v = s[property];\n        if (typeof v === `string`) {\n            if (v.endsWith(`px`)) {\n                returnValue[property] = Number.parseFloat(v.substring(0, v.length - 2));\n            }\n            else {\n                throw new Error(`Property '${String(property)}' does not end in 'px'. Value: ${v}`);\n            }\n        }\n        else {\n            throw new Error(`Property '${String(property)}' is not type string. Got: ${typeof v} Value: ${v}`);\n        }\n    }\n    return returnValue;\n};\n/**\n * If `value` is _true_, the provided CSS class is added to element(s), otherwise it is removed.\n *\n * ```js\n * setClass(`#someId`, true, `activated`); // Add 'activated'\n * setClass(`#someId`, false, `activated`); // Removes 'activated'\n * ```\n *\n * @param selectors\n * @param value\n * @param cssClass\n * @returns\n */\nexport const setCssClass = (selectors, value, cssClass) => {\n    const elements = resolveEls(selectors);\n    if (elements.length === 0)\n        return;\n    for (const element of elements) {\n        if (value)\n            element.classList.add(cssClass);\n        else\n            element.classList.remove(cssClass);\n    }\n};\n/**\n * Toggles a CSS class on all elements that match selector.\n *\n * ```js\n * setCssToggle(`span`, `activated`); // Toggles the 'activated' class on all SPAN elements\n * ```\n *\n * Uses `HTMLElement.classList.toggle`\n * @param selectors\n * @param cssClass\n * @returns\n */\nexport const setCssToggle = (selectors, cssClass) => {\n    const elements = resolveEls(selectors);\n    if (elements.length === 0)\n        return;\n    for (const element of elements) {\n        element.classList.toggle(cssClass);\n    }\n};\n/**\n * Sets the CSS 'display' property\n *\n * ```js\n * setCssDisplay(`span`, `block`); // Sets display:block for all spans\n * ```\n *\n * @param selectors\n * @param value\n * @returns\n */\nexport const setCssDisplay = (selectors, value) => {\n    const elements = resolveEls(selectors);\n    if (elements.length === 0)\n        return;\n    for (const element of elements) {\n        (element).style.display = value;\n    }\n};\n","import { fromObject } from \"./data-table.js\";\n// TODO Visually show data which has changed since last update\n// TODO Click on a field to show a sparkline for it\n/**\n * Creates a simple display for data. Designed to show ixfx state data\n *\n * ```js\n * // Create once\n * const display = new DataDisplay();\n *\n * // Call .update to show state\n * display.update(state);\n * ```\n */\nexport class DataDisplay {\n    dataTable;\n    /**\n     * Constructor\n     * @param options Options\n     */\n    constructor(options = {}) {\n        const theme = options.theme ?? `dark`;\n        const existing = document.querySelector(`#ixfx-data-display`);\n        if (existing !== null)\n            throw new Error(`DataDisplay already loaded on this page`);\n        const container = document.createElement(`div`);\n        container.id = `ixfx-data-display`;\n        container.classList.add(`theme-${theme}`);\n        const css = document.createElement(`style`);\n        css.textContent = `\n    #ixfx-data-display {\n      background: white;\n      color: black;\n      border: 2px solid hsl(0deg 0.61% 90%);\n      border-radius: 4px;\n      z-index: 1000;\n      opacity: 40%;\n      padding: 1em;\n      font-family: monospace;\n      position: fixed;\n      right: 1em;\n      top: 1em;\n    }\n    #ixfx-data-display.theme-dark {\n      background: black;\n      color: white;\n      border: 2px solid hsl(0deg 0.61% 10%);\n    }\n    #ixfx-data-display:hover {\n      opacity: 100%;\n    }\n    #ixfx-data-display table {\n      border-collapse: collapse;\n    }\n    #ixfx-data-display tr:not(:last-child) {\n      border-bottom: 2px solid hsl(0deg 0.61% 90%);\n    }\n    #ixfx-data-display.dark tr:not(:last-child) {\n      border-bottom: 2px solid hsl(0deg 0.61% 10%);\n    }\n    #ixfx-data-display td {\n      padding-bottom: 0.4em;\n      padding-top: 0.4em;\n    }\n    #ixfx-data-display .label {\n      color: hsl(0deg 0.61% 60%);\n      text-align: right;\n      padding-right: 0.5em;\n    }\n    #ixfx-data-display.theme-dark .label {\n      color: gray;\n    }\n    `;\n        container.style.display = `inline-block`;\n        document.body.append(css);\n        document.body.append(container);\n        this.dataTable = fromObject(container, undefined, {\n            objectsAsTables: true,\n            ...options\n        });\n    }\n    update(data) {\n        this.dataTable.update(data);\n    }\n}\n","import { resolveEls } from \"./resolve-el.js\";\nexport function setText(selectors, value) {\n    return setProperty(`textContent`, selectors, value);\n}\n;\n/**\n * Sets the innerHTML of an element.\n *\n * ```js\n * setHtml(`#some-el`, `<b>hello</b>`);\n * ```\n * @param selectors\n * @param value\n * @returns\n */\nexport function setHtml(selectors, value) {\n    return setProperty(`innerHTML`, selectors, value);\n}\n;\n/**\n * Sets some property on an element\n *\n * ```js\n * setProperty(`width`, `canvas`, 100); // Set the width property to 100\n * ```\n *\n * If `value` is an object, converts to JSON first.\n * @param property\n * @param selectors\n * @param value\n * @returns\n */\nexport function setProperty(property, selectors, value) {\n    let elements = [];\n    const set = (v) => {\n        const typ = typeof v;\n        const vv = (typ === `string` || typ === `number` || typ === `boolean`) ? v :\n            JSON.stringify(v);\n        if (elements.length === 0) {\n            elements = resolveEls(selectors);\n        }\n        for (const element of elements) {\n            element[property] = vv;\n        }\n        return vv;\n    };\n    return value === undefined ? set : set(value);\n}\n;\n","import { setCssClass, setCssDisplay, setCssToggle } from \"./css.js\";\nimport { resolveEl, resolveEls } from \"./resolve-el.js\";\nimport { setHtml, setText } from \"./set-property.js\";\n/**\n * Returns an object with handy functions for working on/against the provided selector.\n *\n * ```js\n * const e = el(`#my-element`);\n * e.text(`hello`);           // Set the inner text of the elemenet\n * e.cssDisplay(`block`);    // Sets display:block\n * e.cssToggle(`activated`);  // Toggles the 'activated' CSS class\n * e.cssClass(true, `activated`); // Turns on the 'activated' CSS class\n * e.el();                    // Returns the HTML Element\n * ```\n *\n * The selector is only queried when created. Use {@link elRequery} to continually\n * re-query the selector before each operation.\n *\n * @param selectors\n * @returns\n */\nexport const el = (selectors) => {\n    const elements = resolveEls(selectors);\n    const text = setText(elements);\n    const html = setHtml(elements);\n    return {\n        text,\n        html,\n        cssDisplay: (value) => { setCssDisplay(elements, value); },\n        cssClass: (value, cssClass) => { setCssClass(elements, value, cssClass); },\n        cssToggle: (cssClass) => { setCssToggle(elements, cssClass); },\n        el: () => elements[0],\n        els: () => elements\n    };\n};\nexport const elRequery = (selectors) => ({\n    text: (value) => setText(selectors, value),\n    html: (value) => setHtml(selectors, value),\n    cssDisplay: (value) => { setCssDisplay(selectors, value); },\n    cssClass: (value, cssClass) => { setCssClass(selectors, value, cssClass); },\n    cssToggle: (cssClass) => { setCssToggle(selectors, cssClass); },\n    el: () => resolveEl(selectors),\n    els: () => resolveEls(selectors)\n});\n","import { intervalToMs } from \"@ixfx/core\";\nexport const debounce = (callback, interval) => {\n    let timer;\n    const ms = intervalToMs(interval, 100);\n    return () => {\n        // eslint-disable-next-line @typescript-eslint/no-unsafe-argument\n        if (timer)\n            clearTimeout(timer);\n        timer = setTimeout(callback, ms);\n    };\n};\n","import { resolveEl } from \"./resolve-el.js\";\nimport { getComputedPixels } from \"./css.js\";\nimport { Rects } from \"@ixfx/geometry\";\nimport { debounce } from \"./internal/debounce.js\";\nimport { intervalToMs } from \"@ixfx/core\";\n/**\n * Consider using static methods:\n *\n * ```js\n * // Resize an <SVG> element to match viewport\n * Dom.ElementSizer.svgViewport(svg);\n *\n * // Resize canvas to match its parent\n * Dom.ElementSizer.canvasParent(canvas);\n *\n * // Resize canvas to match viewport\n * Dom.ElementSizer.canvasViewport(canvas);\n * ```\n */\nexport class ElementSizer {\n    #stretch;\n    #size;\n    #naturalSize;\n    #naturalRatio;\n    #viewport;\n    #onSizeChanging = (size, el) => { };\n    #el;\n    #containerEl;\n    #disposed = false;\n    #resizeObservable;\n    #sizeDebounce = () => ({});\n    constructor(elOrQuery, options) {\n        this.#el = resolveEl(elOrQuery);\n        const container = options.containerEl;\n        if (container === null || typeof container === `undefined`) {\n            const pe = this.#el.parentElement;\n            if (pe !== null) {\n                this.#containerEl = pe;\n            }\n            else {\n                const pn = this.#el.parentNode;\n                if (pn !== null) {\n                    this.#containerEl = pn;\n                }\n            }\n        }\n        else if (typeof container === `string` || typeof container === `object`) {\n            this.#containerEl = resolveEl(container);\n        }\n        //this.#containerEl = options.containerEl ? resolveEl(options.containerEl) : this.#el.parentElement!;\n        this.#stretch = options.stretch ?? `none`;\n        this.#onSizeChanging = options.onSizeChanging;\n        this.#size = Rects.Empty;\n        const onSizeDone = options.onSizeDone;\n        if (typeof onSizeDone !== `undefined`) {\n            this.#sizeDebounce = debounce(() => {\n                onSizeDone(this.size, this.#el);\n            }, options.debounceTimeout);\n        }\n        let naturalSize = options.naturalSize;\n        naturalSize ??= this.#el.getBoundingClientRect();\n        this.#naturalRatio = 1;\n        this.#naturalSize = naturalSize;\n        this.setNaturalSize(naturalSize);\n        this.#viewport = Rects.EmptyPositioned;\n        if (this.#containerEl === document.body) {\n            this.#byViewport();\n        }\n        else {\n            this.#byContainer();\n        }\n    }\n    dispose(reason) {\n        if (this.#disposed)\n            return;\n        this.#disposed = true;\n        if (this.#resizeObservable) {\n            this.#resizeObservable.disconnect();\n            this.#resizeObservable = undefined;\n        }\n    }\n    static canvasParent(canvasElementOrQuery, options) {\n        const el = resolveEl(canvasElementOrQuery);\n        const er = new ElementSizer(el, {\n            ...options,\n            onSizeChanging(size, el) {\n                el.width = size.width;\n                el.height = size.height;\n                if (options.onSizeChanging)\n                    options.onSizeChanging(size, el);\n            },\n        });\n        return er;\n    }\n    static canvasViewport(canvasElementOrQuery, options) {\n        const el = resolveEl(canvasElementOrQuery);\n        el.style.position = `absolute`;\n        el.style.zIndex = (options.zIndex ?? 0).toString();\n        el.style.left = `0px`;\n        el.style.top = `0px`;\n        const opts = { ...options, containerEl: document.body };\n        return this.canvasParent(canvasElementOrQuery, opts);\n    }\n    /**\n     * Size an SVG element to match viewport\n     * @param svg\n     * @returns\n     */\n    static svgViewport(svg, onSizeSet) {\n        const er = new ElementSizer(svg, {\n            containerEl: document.body,\n            stretch: `both`,\n            onSizeChanging(size) {\n                svg.setAttribute(`width`, size.width.toString());\n                svg.setAttribute(`height`, size.height.toString());\n                if (onSizeSet)\n                    onSizeSet(size);\n            },\n        });\n        return er;\n    }\n    #byContainer() {\n        const c = this.#containerEl;\n        if (!c) {\n            throw new Error(`No container element`);\n        }\n        // Listen for resize\n        const r = new ResizeObserver((entries) => {\n            this.#onParentResize(entries);\n        });\n        r.observe(c);\n        // Get current value\n        const current = this.#computeSizeBasedOnParent(c.getBoundingClientRect());\n        this.size = current;\n        this.#resizeObservable = r;\n    }\n    #byViewport() {\n        const r = new ResizeObserver((entries) => {\n            this.#onViewportResize();\n        });\n        r.observe(document.documentElement);\n        this.#resizeObservable = r;\n        this.#onViewportResize();\n    }\n    #onViewportResize() {\n        this.size = { width: window.innerWidth, height: window.innerHeight };\n        this.#viewport = {\n            x: 0, y: 0,\n            ...this.size\n        };\n    }\n    /**\n     * Sets the 'natural' size of an element.\n     * This can also be specified when creating ElementSizer.\n     * @param size\n     */\n    setNaturalSize(size) {\n        this.#naturalSize = size;\n        this.#naturalRatio = size.width / size.height;\n    }\n    get naturalSize() {\n        return this.#naturalSize;\n    }\n    get viewport() {\n        return this.#viewport;\n    }\n    #computeSizeBasedOnParent(parentSize) {\n        let { width, height } = parentSize;\n        let stretch = this.#stretch;\n        if (stretch === `min`) {\n            stretch = width < height ? `width` : `height`;\n        }\n        else if (stretch === `max`) {\n            stretch = width > height ? `width` : `height`;\n        }\n        if (stretch === `width`) {\n            height = width / this.#naturalRatio;\n        }\n        else if (stretch === `height`) {\n            width = height * this.#naturalRatio;\n        }\n        // If we have a border, take that into account\n        if (this.#el instanceof HTMLElement) {\n            const b = getComputedPixels(this.#el, `borderTopWidth`, `borderLeftWidth`, `borderRightWidth`, `borderBottomWidth`);\n            width -= (b.borderLeftWidth + b.borderRightWidth);\n            height -= (b.borderTopWidth + b.borderBottomWidth);\n        }\n        return { width, height };\n    }\n    #onParentResize(args) {\n        const box = args[0].contentBoxSize[0];\n        const parentSize = { width: box.inlineSize, height: box.blockSize };\n        this.size = this.#computeSizeBasedOnParent(parentSize);\n        this.#viewport = {\n            x: 0, y: 0,\n            width: parentSize.width,\n            height: parentSize.height\n        };\n    }\n    set size(size) {\n        Rects.guard(size, `size`);\n        this.#size = size;\n        if (this.#onSizeChanging) {\n            this.#onSizeChanging(size, this.#el);\n        }\n        this.#sizeDebounce();\n    }\n    get size() {\n        return this.#size;\n    }\n}\n","import { getErrorMessage } from \"@ixfx/debug\";\n/**\n * Creates an error handler to show errors on-screen.\n * This is useful when testing on mobile devices that lack access to the console.\n *\n * ```js\n * const e = defaultErrorHandler();\n * ```\n *\n * Manual control:\n * ```js\n * const e = defaultErrorHandler();\n * e.show(someError);\n * e.hide();\n * ```\n * @returns\n */\nexport const defaultErrorHandler = () => {\n    let enabled = true;\n    const container = document.createElement(`div`);\n    container.style.color = `black`;\n    container.style.border = `2px solid red`;\n    container.style.backgroundColor = `hsl(0, 80%, 90%)`;\n    container.style.padding = `1em`;\n    container.style.display = `none`;\n    container.style.top = `1em`;\n    container.style.left = `1em`;\n    container.style.position = `absolute`;\n    container.style.fontFamily = `monospace`;\n    const messageElement = document.createElement(`div`);\n    messageElement.style.maxWidth = `50vw`;\n    messageElement.style.maxHeight = `50vh`;\n    messageElement.style.overflowY = `scroll`;\n    container.innerHTML = `<h1>Error</h1>`;\n    container.append(messageElement);\n    const styleButton = (b) => {\n        b.style.padding = `0.3em`;\n        b.style.marginTop = `1em`;\n    };\n    const buttonClose = document.createElement(`button`);\n    buttonClose.textContent = `Close`;\n    buttonClose.addEventListener(`click`, () => {\n        hide();\n    });\n    const buttonStop = document.createElement(`button`);\n    buttonStop.textContent = `Stop displaying errors`;\n    buttonStop.addEventListener(`click`, () => {\n        enabled = false;\n        hide();\n    });\n    styleButton(buttonClose);\n    styleButton(buttonStop);\n    container.append(buttonClose);\n    container.append(buttonStop);\n    document.body.append(container);\n    const show = (ex) => {\n        container.style.display = `inline`;\n        messageElement.innerHTML += ex.stack ? `<pre>${ex.stack}</pre>` : `<p>${getErrorMessage(ex)}</p>`;\n    };\n    const hide = () => {\n        container.style.display = `none`;\n    };\n    window.onerror = (message, url, lineNo, colNo, error) => {\n        if (enabled) {\n            if (error) {\n                console.log(error);\n                show(error);\n            }\n            else {\n                console.log(message);\n                show(message);\n            }\n        }\n    };\n    window.addEventListener(`unhandledrejection`, (event) => {\n        console.log(event.reason);\n        if (enabled) {\n            show(event.reason);\n        }\n    });\n    return { show, hide };\n};\n","export const addShadowCss = (parentEl, styles) => {\n    const styleEl = document.createElement(`style`);\n    //eslint-disable-next-line functional/immutable-data\n    styleEl.textContent = styles;\n    //eslint-disable-next-line functional/no-let\n    let shadowRoot;\n    if (parentEl.shadowRoot) {\n        shadowRoot = parentEl.shadowRoot;\n        //eslint-disable-next-line functional/immutable-data\n        shadowRoot.innerHTML = ``;\n    }\n    else {\n        shadowRoot = parentEl.attachShadow({ mode: `open` });\n    }\n    shadowRoot.append(styleEl);\n    return shadowRoot;\n};\n","import { resolveEl } from './resolve-el.js';\nimport { addShadowCss } from './shadow-dom.js';\n/**\n * Allows writing to a DOM element in console.log style. Element grows in size, so use\n * something like `overflow-y: scroll` on its parent\n *\n * ```\n * const l = log(`#dataStream`); // Assumes HTML element with id `dataStream` exists\n * l.log(`Hi`);\n * l.log(); // Displays a horizontal rule\n *\n * const l = log(document.getElementById(`dataStream`), {\n *  timestamp: true,\n *  truncateEntries: 20\n * });\n * l.log(`Hi`);\n * l.error(`Some error`); // Adds class `error` to line\n * ```\n *\n * For logging high-throughput streams:\n * ```\n * // Silently drop log if it was less than 5ms since the last\n * const l = log(`#dataStream`, { minIntervalMs: 5 });\n *\n * // Only the last 100 entries are kept\n * const l = log(`#dataStream`, { capacity: 100 });\n * ```\n *\n * @param domQueryOrElement Element or id of element\n * @param opts\n */\nexport const log = (domQueryOrElement, opts = {}) => {\n    const { capacity = 0, monospaced = true, timestamp = false, collapseDuplicates = true, css = `` } = opts;\n    let added = 0;\n    let lastLog;\n    let lastLogRepeats = 0;\n    const parentElement = resolveEl(domQueryOrElement);\n    const fontFamily = monospaced\n        ? `Consolas, \"Andale Mono WT\", \"Andale Mono\", \"Lucida Console\", \"Lucida Sans Typewriter\", \"DejaVu Sans Mono\", \"Bitstream Vera Sans Mono\", \"Liberation Mono\", Monaco, \"Courier New\", Courier, monospace`\n        : `normal`;\n    const shadowRoot = addShadowCss(parentElement, `\n  .log {\n    font-family: ${fontFamily};\n    background-color: var(--code-background-color);\n    padding: var(--padding1, 0.2em);\n    overflow-y: auto;\n    height:100%;\n  }\n  .timestamp {\n    margin-right: 0.5em;\n    opacity: 0.5;\n    font-size: 70%;\n    align-self: center;\n  }\n  .line {\n    display: flex;\n    padding-bottom: 0.1em;\n    padding-top: 0.1em;\n  }\n  .line:hover {\n  \n  }\n  .error {\n    color: red;\n  }\n  .badge {\n    border: 1px solid currentColor;\n    align-self: center;\n    font-size: 70%;\n    padding-left: 0.2em;\n    padding-right: 0.2em;\n    border-radius: 1em;\n    margin-left: 0.5em;\n    margin-right: 0.5em;\n  }\n  .msg {\n    flex: 1;\n    word-break: break-word;\n  }\n  ${css}\n  `);\n    const el = document.createElement(`div`);\n    el.className = `log`;\n    shadowRoot.append(el);\n    const error = (messageOrError) => {\n        const line = document.createElement(`div`);\n        if (typeof messageOrError === `string`) {\n            line.innerHTML = messageOrError;\n        }\n        else if (messageOrError instanceof Error) {\n            const stack = messageOrError.stack;\n            line.innerHTML = stack === undefined ? messageOrError.toString() : stack.toString();\n        }\n        else {\n            line.innerHTML = messageOrError;\n        }\n        line.classList.add(`error`);\n        append(line);\n        lastLog = undefined;\n        lastLogRepeats = 0;\n    };\n    let lastLogTime = 0;\n    const warn = (whatToLog = ``) => {\n        const element = log(whatToLog);\n        if (!element)\n            return element;\n        element.classList.add(`warning`);\n        return element;\n    };\n    const log = (whatToLog = ``) => {\n        let message;\n        const interval = window.performance.now() - lastLogTime;\n        if (opts.minIntervalMs && interval < opts.minIntervalMs)\n            return;\n        lastLogTime = window.performance.now();\n        if (typeof whatToLog === `object`) {\n            message = JSON.stringify(whatToLog);\n        }\n        else if (whatToLog === undefined) {\n            message = `(undefined)`;\n        }\n        else if (whatToLog === null) {\n            message = `(null)`;\n        }\n        else if (typeof whatToLog === `number`) {\n            if (Number.isNaN(message))\n                message = `(NaN)`;\n            message = whatToLog.toString();\n        }\n        else {\n            message = whatToLog;\n        }\n        if (message.length === 0) {\n            const rule = document.createElement(`hr`);\n            lastLog = undefined;\n            append(rule);\n        }\n        else if (message === lastLog && collapseDuplicates) {\n            const lastElement = el.firstElementChild;\n            let lastBadge = lastElement.querySelector(`.badge`);\n            if (lastBadge === null) {\n                lastBadge = document.createElement(`div`);\n                lastBadge.className = `badge`;\n                lastElement.insertAdjacentElement(`beforeend`, lastBadge);\n            }\n            if (lastElement !== null) {\n                lastBadge.textContent = (++lastLogRepeats).toString();\n            }\n            return lastElement;\n        }\n        else {\n            const line = document.createElement(`div`);\n            line.textContent = message;\n            append(line);\n            lastLog = message;\n            return line;\n        }\n    };\n    const append = (line) => {\n        if (timestamp) {\n            const wrapper = document.createElement(`div`);\n            const timestamp = document.createElement(`div`);\n            timestamp.className = `timestamp`;\n            timestamp.textContent = new Date().toLocaleTimeString();\n            wrapper.append(timestamp, line);\n            line.classList.add(`msg`);\n            wrapper.classList.add(`line`);\n            line = wrapper;\n        }\n        else {\n            line.classList.add(`line`, `msg`);\n        }\n        if (opts.reverse) {\n            el.append(line);\n        }\n        else {\n            el.insertBefore(line, el.firstChild);\n        }\n        if (capacity > 0 && ++added > capacity * 2) {\n            while (added > capacity) {\n                el.lastChild?.remove();\n                added--;\n            }\n        }\n        if (opts.reverse) {\n            // Scroll to bottom\n            el.scrollTop = el.scrollHeight;\n        }\n        lastLogRepeats = 0;\n    };\n    const clear = () => {\n        el.innerHTML = ``;\n        lastLog = undefined;\n        lastLogRepeats = 0;\n        added = 0;\n    };\n    const dispose = () => {\n        el.remove();\n    };\n    return {\n        error,\n        log,\n        warn,\n        append,\n        clear,\n        dispose,\n        get isEmpty() {\n            return added === 0;\n        },\n    };\n};\n","import { getErrorMessage } from '@ixfx/debug';\nimport { log } from './log.js';\nimport { resolveEl } from './resolve-el.js';\nimport { afterMatch } from '@ixfx/core/text';\n/**\n * Adds an inline console to the page. A DIV is added to display log messages.\n *\n * Captures all console.log, console.warn and console.error calls, as well as unhandled exceptions.\n *\n * ```js\n * // Adds the DIV and intercepts console logs\n * inlineConsole();\n *\n * console.log(`Hello`); // message is displayed in the inline console\n * ```\n * @param options\n */\nexport const inlineConsole = (options = {}) => {\n    const original = {\n        log: console.log,\n        error: console.error,\n        warn: console.warn\n    };\n    const witholdCss = options.witholdCss ?? false;\n    const insertIntoEl = options.insertIntoEl;\n    let logElement;\n    if (insertIntoEl) {\n        logElement = resolveEl(insertIntoEl);\n    }\n    else {\n        logElement = document.createElement(`DIV`);\n        logElement.id = `ixfx-log`;\n        document.body.prepend(logElement);\n    }\n    if (!witholdCss) {\n        logElement.style.position = `fixed`;\n        logElement.style.left = `0px`;\n        logElement.style.top = `0px`;\n        logElement.style.pointerEvents = `none`;\n        logElement.style.display = `none`;\n    }\n    const logger = log(logElement, options);\n    const visibility = (show) => {\n        logElement.style.display = show ? `block` : `none`;\n    };\n    console.error = (message, ...optionalParameters) => {\n        logger.error(message);\n        if (optionalParameters.length > 0) {\n            logger.error(optionalParameters);\n        }\n        original.error(message, ...optionalParameters);\n        visibility(true);\n    };\n    console.warn = (message, ...optionalParameters) => {\n        logger.warn(message);\n        if (optionalParameters.length > 0) {\n            logger.warn(optionalParameters);\n        }\n        visibility(true);\n    };\n    console.log = (message, ...optionalParameters) => {\n        logger.log(message);\n        if (optionalParameters.length > 0) {\n            logger.log(optionalParameters);\n        }\n        original.log(message, ...optionalParameters);\n        visibility(true);\n    };\n    window.onerror = (event, source, lineno, _colno, error) => {\n        const abbreviatedSource = source === undefined ? `` : afterMatch(source, `/`, { fromEnd: true });\n        const eventString = getErrorMessage(error);\n        logger.error(eventString + ` (${abbreviatedSource}:${lineno})`);\n        visibility(true);\n    };\n    window.addEventListener('unhandledrejection', function (e) {\n        logger.error(e.reason);\n        visibility(true);\n    });\n};\n","import { uniqueInstances } from \"@ixfx/core\";\n/**\n * Async iterator over DOM query strings\n * ```js\n * query(`div`); // all DIVs\n * query([`.class`, `.and-other-class`]); // All things with these two classes\n * ```\n * @param queryOrElement\n * @returns\n */\nexport async function* query(queryOrElement, options = {}) {\n    if (typeof queryOrElement === `string`) {\n        return query([queryOrElement], options);\n    }\n    else if (typeof queryOrElement === `object` && `nodeName` in queryOrElement) {\n        return query([queryOrElement], options);\n    }\n    const ensureUnique = options ?? false;\n    const isUnique = ensureUnique ? uniqueInstances() : (_) => true;\n    if (Array.isArray(queryOrElement)) {\n        for (const item of queryOrElement) {\n            if (typeof item === `string`) {\n                for (const element of document.querySelectorAll(item)) {\n                    const elementProper = element;\n                    if (isUnique(elementProper)) {\n                        yield elementProper;\n                    }\n                }\n            }\n            else {\n                if (isUnique(item)) {\n                    yield item;\n                }\n            }\n        }\n    }\n    else {\n        for await (const item of queryOrElement) {\n            if (typeof item === `string`) {\n                for (const element of document.querySelectorAll(item)) {\n                    if (isUnique(element)) {\n                        yield element;\n                    }\n                }\n            }\n            else {\n                if (isUnique(item)) {\n                    yield item;\n                }\n            }\n        }\n    }\n}\n","import { shortGuid } from \"@ixfx/random\";\nimport { resolveEl } from \"./resolve-el.js\";\nexport const tabSet = (options) => {\n    const panels = options.panels;\n    const preselectId = options.preselectId ?? panels[0].id;\n    const guid = `tabset-${shortGuid()}`;\n    const parentEl = resolveEl(options.parent);\n    const switcher = `\n  <div class=\"ixfx-tabset\" id=\"${guid}\">\n    <fieldset class=\"ixfx-tabset-controls\">\n    ${panels.map(p => {\n        const panelId = `${guid}-${p.id}-select`;\n        return `<input type=\"radio\" name=\"${guid}-tabs\" id=\"${panelId}\" data-tabset=\"${p.id}\"><label for=\"${panelId}\">${p.label}</label>`;\n    }).join(``)}\n    </fieldset>\n    <div class=\"ixfx-tabset-host\" id=\"${guid}-host\"></div>\n  </div>\n  `;\n    parentEl.innerHTML = switcher;\n    // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n    const hostEl = document.getElementById(`${guid}-host`);\n    // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n    const tabSetEl = document.getElementById(guid);\n    tabSetEl.querySelector(`fieldset`)?.addEventListener(`change`, event => {\n        const el = event.target;\n        // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n        select(el.getAttribute(`data-tabset`));\n    });\n    let currentPanel;\n    const select = (id) => {\n        const newPanel = panels.find(p => p.id === id);\n        const priorPanel = currentPanel;\n        if (options.onPanelChanging) {\n            const allow = options.onPanelChanging(priorPanel, newPanel);\n            if (typeof allow === `boolean` && !allow)\n                return; // Cancel panel change\n        }\n        if (priorPanel) {\n            priorPanel.dismount();\n        }\n        currentPanel = newPanel;\n        if (newPanel) {\n            newPanel.mount(hostEl);\n            const domId = `#${guid}-${id}-select`;\n            const inputEl = tabSetEl.querySelector(domId);\n            if (inputEl) {\n                inputEl.checked = true;\n            }\n            else {\n                console.warn(`Could not find INPUT element for panel id: ${id} (${domId})`);\n            }\n        }\n        if (options.onPanelChange)\n            options.onPanelChange(priorPanel, newPanel);\n    };\n    select(preselectId);\n    let warned = false;\n    const notify = (name, args) => {\n        if (!currentPanel)\n            return;\n        if (currentPanel.notify) {\n            currentPanel.notify(name, args);\n        }\n        else if (!warned) {\n            warned = true;\n            console.warn(`TabbedPanel.notify dropping notification '${name}'. Panel implementation is missing 'notify' function`);\n        }\n    };\n    return { select, panels, hostEl, tabSetEl, notify };\n};\n","import JSON5 from 'json5';\nimport { resolveEl } from './resolve-el.js';\nimport { getPointParameter } from '@ixfx/geometry/point';\nimport { cardinal } from '@ixfx/geometry/rect';\nimport { Points } from '@ixfx/geometry';\n/**\n * Convert an absolute point to relative, in different coordinate spaces.\n *\n * When calling the returned function, the input value must be in the same\n * scale as the intended output scale.\n *\n * Viewport-relative is used by default.\n *\n * @example Get relative position of click in screen coordinates\n * ```js\n * const f = pointScaler({ to: 'screen' });\n * document.addEventListener('click', evt => {\n *  const screenRelative = f(evt.screenX, evt.screenY);\n *  // Yields {x,y} on 0..1 scale\n * });\n * ```\n *\n * @example Get relative position of click in viewport coordinates\n * ```js\n * const f = pointScaler({ to: 'viewport' });\n * document.addEventListener('click', evt => {\n *  const viewportRelative = f(evt.clientX, evt.clientY);\n *  // Yields {x,y} on 0..1 scale\n * });\n * ```\n *\n * @example Get relative position of click in document coordinates\n * ```js\n * const f = pointScaler({ to: 'document' });\n * document.addEventListener('click', evt => {\n *  const documentRelative = f(evt.pageX, evt.pageY);\n *  // Yields {x,y} on 0..1 scale\n * });\n * ```\n *\n * @param reference\n * @returns\n */\nexport const pointScaler = (reference = `viewport`) => {\n    switch (reference) {\n        case `viewport`: {\n            return (a, b) => {\n                const pt = getPointParameter(a, b);\n                return Object.freeze({\n                    x: pt.x / window.innerWidth,\n                    y: pt.y / window.innerHeight,\n                });\n            };\n        }\n        case `screen`: {\n            return (a, b) => {\n                const pt = getPointParameter(a, b);\n                return Object.freeze({\n                    x: pt.x / screen.width,\n                    y: pt.y / screen.height,\n                });\n            };\n        }\n        case `document`: {\n            return (a, b) => {\n                const pt = getPointParameter(a, b);\n                return Object.freeze({\n                    x: pt.x / document.body.scrollWidth,\n                    y: pt.y / document.body.scrollHeight,\n                });\n            };\n        }\n        default: {\n            throw new Error(`Unknown 'reference' parameter: ${JSON.stringify(reference)}`);\n        }\n    }\n};\n/**\n * Returns a function which yields element position in target coordinate space with optional scaling.\n * Live position is calculated when the function is invoked.\n * Use {@link positionRelative} to simply get relative position of element in given coordinate space.\n *\n * @example Absolute position of #blah in viewport coordinate space\n * ```js\n * const f = positionFn('#blah');\n * f(); // Yields: {x,y}\n * // Or:\n * positionFn('#blah')(); // Immediately invoke\n * ```\n *\n * @example Relative position of element in viewport-space\n * ```js\n * const f = positionFn(evt.target, { relative: true });\n * f(); // Yields: {x,y}\n * ```\n *\n * @example Relative position of #blah in screen-space\n * ```js\n * const f = positionFn('#blah', { target: 'screen', relative: true });\n * f(); // Yields: {x,y}\n * ```\n *\n * By default, top-left corner (north west) is used. Other cardinal points or 'center' can be specified:\n * ```js\n * // Relative position by center\n * positionFn('#blah', { relative: true, anchor: 'center' });\n *\n * // ...by bottom-right corner\n * positionFn('#blah', { relative: true, anchor: 'se' });\n * ```\n *\n * This function is useful if you have a stable DOM element and conversion target.\n * If the DOM element is changing continually, consider using {@link viewportToSpace} to\n * convert from viewport coordinates to target coordinates:\n *\n * ```js\n * // Eg.1 Absolute coords in screen space\n * const vpToScreen = viewportToSpace('screen');\n * vpToScreen(el.getBoundingClientRect());\n *\n * // Eg.2 Relative coords in viewport space\n * const vpRelative = pointScaler(); // Re-usable scaler. Default uses viewport\n * vpRelative(el.getBoundingClientRect()); // Yields: { x,y }\n *\n * // Eg.3 Relative coords in screen space\n * const vpToScreen = viewportToSpace('screen'); // Map viewport->screen\n * const screenRelative = pointScaler('screen'); // Scale screen units\n *\n * // Combine into a resuable function that takes an element\n * const mapAndScale = (el) => screenRelative(vpToScreen(el.getBoundingClientRect()));\n *\n * // Call\n * mapAndScale(document.getElementById('blah')); // Yields: { x,y }\n * ```\n * @param domQueryOrEl\n * @param options\n * @returns\n */\n// eslint-disable-next-line unicorn/prevent-abbreviations\nexport const positionFn = (domQueryOrEl, options = {}) => {\n    const targetSpace = options.target ?? `viewport`;\n    const relative = options.relative ?? false;\n    const anchor = options.anchor ?? `nw`;\n    const el = resolveEl(domQueryOrEl);\n    const vpToSpace = viewportToSpace(targetSpace);\n    if (relative) {\n        const s = pointScaler(targetSpace);\n        return () => s(vpToSpace(cardinal(el.getBoundingClientRect(), anchor)));\n    }\n    else {\n        return () => vpToSpace(cardinal(el.getBoundingClientRect(), anchor));\n    }\n};\n/**\n * Returns a {x,y} Point on a cardinal position of element.\n * ```\n * // Top edge, middle horizontal position\n * const pos = cardinalPosition(`#blah`, `n`);\n * ```\n * @param domQueryOrEl\n * @param anchor\n * @returns\n */\nexport const cardinalPosition = (domQueryOrEl, anchor = `nw`) => {\n    const el = resolveEl(domQueryOrEl);\n    return cardinal(el.getBoundingClientRect(), anchor);\n};\n/**\n * Returns relative position of element in target coordinate space, or viewport by default.\n * Relative means that { x:0.5, y: 0.5 } is the middle of the target space. Eg for viewport, that means its the middle of the browser window.\n * ```js\n * // These all yield { x, y }\n * elPositionRelative('#blah');\n * elPositionRelative(evt.target, 'screen');\n * ```\n * @param domQueryOrEl DOM query or element\n * @param target Target coordinate space, or viewport by default\n * @returns Point\n */\nexport const positionRelative = (domQueryOrEl, target = `viewport`) => {\n    const f = positionFn(domQueryOrEl, { relative: true, target });\n    return f();\n};\n/**\n * Returns a function that converts input viewport coordinate space\n * to an output coordinate space.\n *\n * ```js\n * // f() will convert from viewport to document coordinate space\n * const f = viewportToSpace('document');\n *\n * // {x:100,y:100} is viewport coordinate space\n * f(100,100); // Yields: { x, y } converted to document space\n * ```\n *\n * Or immediately invoke for one-off use:\n * ```js\n * viewportToSpace('document')(100,100); // Yields: { x, y }\n * ```\n * @param targetSpace\n * @returns\n */\nexport const viewportToSpace = (targetSpace = `viewport`) => {\n    switch (targetSpace) {\n        case `screen`: {\n            return (a, b) => {\n                const pt = getPointParameter(a, b);\n                return Object.freeze({\n                    x: pt.x + window.screenX,\n                    y: pt.y + window.screenY,\n                });\n            };\n        }\n        case `document`: {\n            return (a, b) => {\n                const pt = getPointParameter(a, b);\n                return Object.freeze({\n                    x: pt.x + window.scrollX,\n                    y: pt.y + window.scrollY,\n                });\n            };\n        }\n        case `viewport`: {\n            return (a, b) => {\n                const pt = getPointParameter(a, b);\n                return Object.freeze({\n                    x: pt.x,\n                    y: pt.y,\n                });\n            };\n        }\n        default: {\n            throw new Error(`Unexpected target coordinate space: ${targetSpace}. Expected: viewport, document or screen`);\n        }\n    }\n};\n/**\n * Position element by relative coordinate. Relative to window dimensions by default\n * @param relativePos Window-relative coordinate. 0.5/0.5 is middle of window.\n */\nexport const positionFromMiddle = (domQueryOrEl, relativePos, relativeTo = `window`) => {\n    if (!domQueryOrEl)\n        throw new Error(`domQueryOrEl is null or undefined`);\n    const el = resolveEl(domQueryOrEl);\n    // Convert relative to absolute units\n    const absPosition = Points.multiply(relativePos, window.innerWidth, window.innerHeight);\n    const thingRect = el.getBoundingClientRect();\n    const offsetPos = Points.subtract(absPosition, thingRect.width / 2, thingRect.height / 2);\n    // Apply via CSS\n    el.style.transform = `translate(${offsetPos.x}px, ${offsetPos.y}px)`;\n};\n/**\n * Given an array of class class names, this will cycle between them each time\n * it is called.\n *\n * Eg, assume `list` is: [ `a`, `b`, `c` ]\n *\n * If `el` already has the class `a`, the first time it is called, class `a`\n * is removed, and `b` added. The next time `b` is swapped for `c`. Once again,\n * `c` will swap with `a` and so on.\n *\n * If `el` is undefined or null, function silently returns.\n * @param el Element\n * @param list List of class names\n * @returns\n */\nexport const cycleCssClass = (el, list) => {\n    if (el === null || !el)\n        return;\n    if (!Array.isArray(list)) {\n        throw new TypeError(`List should be an array of strings`);\n    }\n    for (let index = 0; index < list.length; index++) {\n        // eslint-disable-next-line @typescript-eslint/no-unsafe-argument\n        if (el.classList.contains(list[index])) {\n            // eslint-disable-next-line @typescript-eslint/no-unsafe-argument\n            el.classList.remove(list[index]);\n            if (index + 1 < list.length) {\n                // eslint-disable-next-line @typescript-eslint/no-unsafe-argument\n                el.classList.add(list[index + 1]);\n            }\n            else {\n                // eslint-disable-next-line @typescript-eslint/no-unsafe-argument\n                el.classList.add(list[0]);\n            }\n            return;\n        }\n    }\n    el.classList.add(list[0]);\n};\n/**\n * Source: https://zellwk.com/blog/translate-in-javascript\n * @param domQueryOrEl\n */\nexport const getTranslation = (domQueryOrEl) => {\n    // Source:\n    // https://raw.githubusercontent.com/zellwk/javascript/master/src/browser/dom/translate-values.js\n    const el = resolveEl(domQueryOrEl);\n    const style = window.getComputedStyle(el);\n    const matrix = style.transform;\n    // No transform property. Simply return 0 values.\n    if (matrix === `none` || typeof matrix === `undefined`) {\n        return {\n            x: 0,\n            y: 0,\n            z: 0,\n        };\n    }\n    // Can either be 2d or 3d transform\n    const matrixType = matrix.includes(`3d`) ? `3d` : `2d`;\n    // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n    // @ts-expect-error\n    const matrixValues = (/matrix.*\\((.+)\\)/.exec(matrix))[1].split(`, `);\n    // 2d Matrixes have 6 values\n    // Last 2 values are X and Y.\n    // 2d Matrixes does not have Z value.\n    if (matrixType === `2d`) {\n        return {\n            x: Number.parseFloat(matrixValues[4]),\n            y: Number.parseFloat(matrixValues[5]),\n            z: 0,\n        };\n    }\n    // 3d Matrixes have 16 values\n    // The 13th, 14th, and 15th values are X, Y, and Z\n    if (matrixType === `3d`) {\n        return {\n            x: Number.parseFloat(matrixValues[12]),\n            y: Number.parseFloat(matrixValues[13]),\n            z: Number.parseFloat(matrixValues[14]),\n        };\n    }\n    return { x: 0, y: 0, z: 0 };\n};\n/**\n * Creates an element after `sibling`\n * ```\n * const el = createAfter(siblingEl, `DIV`);\n * ```\n * @param sibling Element\n * @param tagName Element to create\n * @returns New element\n */\nexport const createAfter = (sibling, tagName) => {\n    const el = document.createElement(tagName);\n    sibling.parentElement?.insertBefore(el, sibling.nextSibling);\n    return el;\n};\n/**\n * Creates an element inside of `parent`\n * ```\n * const newEl = createIn(parentEl, `DIV`);\n * ```\n * @param parent Parent element\n * @param tagName Tag to create\n * @returns New element\n */\nexport const createIn = (parent, tagName) => {\n    const el = document.createElement(tagName);\n    parent.append(el);\n    return el;\n};\n/**\n * Remove all child nodes from `parent`\n * @param parent\n */\nexport const clear = (parent) => {\n    let c = parent.lastElementChild;\n    while (c) {\n        c.remove();\n        c = parent.lastElementChild;\n    }\n};\n/**\n * Copies string representation of object to clipboard\n * @param object\n * @returns Promise\n */\nexport const copyToClipboard = (object) => {\n    const p = new Promise((resolve, reject) => {\n        //const json = JSON.stringify(obj, null, 2);\n        const string_ = JSON5.stringify(object);\n        navigator.clipboard.writeText(JSON.stringify(string_)).then(() => {\n            resolve(true);\n        }, (error) => {\n            console.warn(`Could not copy to clipboard`);\n            console.log(string_);\n            reject(new Error(error));\n        });\n    });\n    return p;\n};\n/**\n * Inserts `element` into `parent` sorted according to its HTML attribute `data-sort`.\n *\n * Assumes:\n * * Every child of `parent` and `element`, has a `data-sort` attribute. This is the basis for sorting.\n * * `parent` starts off empty or pre-sorted.\n * * Order of `parent`'s children is not changed (ie it always remains sorted)\n * @param parent Parent to insert into\n * @param element Element to insert\n */\nexport const insertSorted = (parent, element) => {\n    const elSort = element.getAttribute(`data-sort`) ?? ``;\n    let elAfter;\n    let elBefore;\n    for (const c of parent.children) {\n        const sort = c.getAttribute(`data-sort`) ?? ``;\n        if (elSort >= sort)\n            elAfter = c;\n        if (elSort <= sort)\n            elBefore = c;\n        if (elAfter !== undefined && elBefore !== undefined)\n            break;\n    }\n    if (elAfter !== undefined) {\n        elAfter.insertAdjacentElement(`afterend`, element);\n    }\n    else if (elBefore === undefined) {\n        parent.append(element);\n    }\n    else {\n        elBefore.insertAdjacentElement(`beforebegin`, element);\n    }\n};\n/**\n * Creates a DOM tree, based on provided data.\n *\n * This will create new DOM elements if needed, update\n * existing ones or remove them if the value is no longer present.\n *\n *\n * @param parentEl\n * @param list Values to create elements for\n * @param createUpdate Function to create/update elements based on a value\n */\nexport const reconcileChildren = (parentEl, list, createUpdate) => {\n    if (typeof parentEl === `undefined`)\n        throw new Error(`Param 'parentEl' is undefined`);\n    if (parentEl === null)\n        throw new Error(`Param 'parentEl' is null`);\n    const seen = new Set();\n    for (const [key, value] of list) {\n        const id = `c-${key}`;\n        const el = parentEl.querySelector(`#${id}`);\n        const finalEl = createUpdate(value, el);\n        if (el !== finalEl) {\n            finalEl.id = id;\n            parentEl.append(finalEl);\n        }\n        seen.add(id);\n    }\n    const prune = [];\n    for (const child of parentEl.children) {\n        if (!seen.has(child.id)) {\n            prune.push(child);\n        }\n    }\n    // for (let index = 0; index < parentEl.children.length; index++) {\n    //   const c = parentEl.children[ index ] as HTMLElement;\n    //   if (!seen.has(c.id)) {\n    //     prune.push(c);\n    //   }\n    // }\n    for (const p of prune)\n        p.remove();\n};\n/**\n * Gets a HTML element by id, throwing an error if not found\n * @param id\n * @returns\n */\n// eslint-disable-next-line @typescript-eslint/no-unnecessary-type-parameters\nexport const byId = (id) => {\n    const element = document.getElementById(id);\n    if (element === null)\n        throw new Error(`HTML element with id '${id}' not found`);\n    return element;\n};\n","export * as DataTable from './data-table.js';\nexport * as DragDrop from './drag-drop.js';\nexport * as Forms from './forms.js';\nexport * from './css-variables.js';\nexport * from './css.js';\nexport * from './data-display.js';\nexport * from './el.js';\nexport * from './element-sizing.js';\nexport * from './error-handler.js';\nexport * from './inline-console.js';\nexport * from './log.js';\nexport * from './query.js';\nexport * from './resolve-el.js';\nexport * from './set-property.js';\nexport * from './shadow-dom.js';\nexport * from './tabbed-panel.js';\nexport * from './utility.js';\n","import { arrayTest, resultThrow } from '@ixfx/guards';\nimport { Colour } from '@ixfx/visual';\nimport { resolveEl } from '@ixfx/dom';\n//import type { IStackImmutable } from '@ixfx/collections';\nimport { StackImmutable } from '@ixfx/collections/stack';\nimport { Beziers, Lines, Points, Rects, Triangles } from '@ixfx/geometry';\nimport { quantiseEvery } from '@ixfx/numbers';\n// import type { Point } from '../geometry/point/PointType.js';\n// import type { Line } from '../geometry/line/LineType.js';\n// import type { CirclePositioned } from '../geometry/circle/CircleType.js';\n// import type { Rect, RectPositioned } from '../geometry/rect/index.js';\n// import type { Path } from '../geometry/path/PathType.js';\n// import type { Triangle } from '../geometry/triangle/TriangleType.js';\n// import { Empty as RectsEmpty } from '../geometry/rect/Empty.js';\n// import { corners as RectsCorners } from '../geometry/rect/Corners.js';\n// import { isLine } from '../geometry/line/Guard.js';\n// import { quantiseEvery } from '../numbers/Quantise.js';\nconst PIPI = Math.PI * 2;\n/**\n * Gets a 2d drawing context from canvas element or query, or throws an error\n * @param canvasElementContextOrQuery Canvas element reference or DOM query\n * @returns Drawing context.\n */\nexport const getContext = (canvasElementContextOrQuery) => {\n    if (canvasElementContextOrQuery === null) {\n        throw new Error(`canvasElCtxOrQuery null. Must be a 2d drawing context or Canvas element`);\n    }\n    if (canvasElementContextOrQuery === undefined) {\n        throw new Error(`canvasElCtxOrQuery undefined. Must be a 2d drawing context or Canvas element`);\n    }\n    const ctx = canvasElementContextOrQuery instanceof CanvasRenderingContext2D\n        ? canvasElementContextOrQuery\n        : canvasElementContextOrQuery instanceof HTMLCanvasElement\n            ? canvasElementContextOrQuery.getContext(`2d`)\n            : typeof canvasElementContextOrQuery === `string`\n                ? resolveEl(canvasElementContextOrQuery).getContext(`2d`)\n                : canvasElementContextOrQuery;\n    if (ctx === null)\n        throw new Error(`Could not create 2d context for canvas`);\n    return ctx;\n};\n/**\n * Makes a helper object that wraps together a bunch of drawing functions that all use the same drawing context\n * @param ctxOrCanvasEl Drawing context or canvs element reference\n * @param canvasBounds Bounds of drawing (optional). Used for limiting `textBlock`\n * @returns\n */\nexport const makeHelper = (ctxOrCanvasEl, canvasBounds) => {\n    const ctx = getContext(ctxOrCanvasEl);\n    return {\n        ctx,\n        paths(pathsToDraw, opts) {\n            paths(ctx, pathsToDraw, opts);\n        },\n        line(lineToDraw, opts) {\n            line(ctx, lineToDraw, opts);\n        },\n        rect(rectsToDraw, opts) {\n            rect(ctx, rectsToDraw, opts);\n        },\n        bezier(bezierToDraw, opts) {\n            bezier(ctx, bezierToDraw, opts);\n        },\n        connectedPoints(pointsToDraw, opts) {\n            connectedPoints(ctx, pointsToDraw, opts);\n        },\n        pointLabels(pointsToDraw, opts) {\n            pointLabels(ctx, pointsToDraw, opts);\n        },\n        dot(dotPosition, opts) {\n            dot(ctx, dotPosition, opts);\n        },\n        circle(circlesToDraw, opts) {\n            circle(ctx, circlesToDraw, opts);\n        },\n        arc(arcsToDraw, opts) {\n            arc(ctx, arcsToDraw, opts);\n        },\n        textBlock(lines, opts) {\n            if (opts.bounds === undefined && canvasBounds !== undefined) {\n                opts = { ...opts, bounds: { ...canvasBounds, x: 0, y: 0 } };\n            }\n            textBlock(ctx, lines, opts);\n        },\n    };\n};\n/**\n * Creates a drawing op to apply provided options\n * @param opts Drawing options that apply\n * @returns Stack\n */\nconst optsOp = (opts) => coloringOp(opts.strokeStyle, opts.fillStyle);\n/**\n * Applies drawing options to `ctx`, returning a {@link DrawingStack}\n * @param ctx Context\n * @param opts Options\n * @returns\n */\nconst applyOpts = (ctx, opts = {}, ...additionalOps) => {\n    if (ctx === undefined)\n        throw new Error(`ctx undefined`);\n    // Create a drawing stack, pushing an op generated from drawing options\n    const stack = drawingStack(ctx).push(optsOp(opts), ...additionalOps);\n    // Apply stack to context\n    stack.apply();\n    return stack;\n};\n/**\n * Draws one or more arcs.\n * @param ctx\n * @param arcs\n * @param opts\n */\nexport const arc = (ctx, arcs, opts = {}) => {\n    applyOpts(ctx, opts);\n    const draw = (arc) => {\n        ctx.beginPath();\n        ctx.arc(arc.x, arc.y, arc.radius, arc.startRadian, arc.endRadian);\n        ctx.stroke();\n    };\n    const arcsArray = Array.isArray(arcs) ? arcs : [arcs];\n    for (const arc of arcsArray) {\n        draw(arc);\n    }\n};\n/**\n * Colouring drawing op. Applies `fillStyle` and `strokeStyle`\n * @param strokeStyle\n * @param fillStyle\n * @returns\n */\nconst coloringOp = (strokeStyle, fillStyle) => {\n    const apply = (ctx) => {\n        if (fillStyle)\n            ctx.fillStyle = fillStyle;\n        if (strokeStyle)\n            ctx.strokeStyle = strokeStyle;\n    };\n    return apply;\n};\nconst lineOp = (lineWidth, lineJoin, lineCap) => {\n    const apply = (ctx) => {\n        if (lineWidth)\n            ctx.lineWidth = lineWidth;\n        if (lineJoin)\n            ctx.lineJoin = lineJoin;\n        if (lineCap)\n            ctx.lineCap = lineCap;\n    };\n    return apply;\n};\n/**\n * Creates and returns an immutable drawing stack for a context\n * @param ctx Context\n * @param stk Initial stack operations\n * @returns\n */\nexport const drawingStack = (ctx, stk) => {\n    stk ??= new StackImmutable();\n    const push = (...ops) => {\n        stk ??= new StackImmutable();\n        const s = stk.push(...ops);\n        for (const o of ops)\n            o(ctx);\n        return drawingStack(ctx, s);\n    };\n    const pop = () => {\n        const s = stk?.pop();\n        return drawingStack(ctx, s);\n    };\n    const apply = () => {\n        if (stk === undefined)\n            return drawingStack(ctx);\n        for (const op of stk.data)\n            op(ctx);\n        return drawingStack(ctx, stk);\n    };\n    return { push, pop, apply };\n};\n/**\n * Draws a curved line through a set of points\n * @param ctx\n * @param points\n * @param opts\n */\nexport const lineThroughPoints = (ctx, points, opts) => {\n    applyOpts(ctx, opts);\n    // https://stackoverflow.com/questions/7054272/how-to-draw-smooth-curve-through-n-points-using-javascript-html5-canvas\n    ctx.moveTo(points[0].x, points[0].y);\n    for (const [index, p] of points.entries()) {\n        if (index + 2 >= points.length)\n            continue;\n        const pNext = points[index + 1];\n        const mid = {\n            x: (p.x + pNext.x) / 2,\n            y: (p.y + pNext.y) / 2,\n        };\n        const cpX1 = (mid.x + p.x) / 2;\n        const cpX2 = (mid.x + pNext.x) / 2;\n        ctx.quadraticCurveTo(cpX1, pNext.y, mid.x, mid.y);\n        ctx.quadraticCurveTo(cpX2, pNext.y, pNext.x, pNext.y);\n    }\n};\n/**\n * Draws one or more circles. Will draw outline/fill depending on\n * whether `strokeStyle` or `fillStyle` params are present in the drawing options.\n *\n * ```js\n * // Draw a circle with radius of 10 at 0,0\n * circle(ctx, {radius:10});\n *\n * // Draw a circle of radius 10 at 100,100\n * circle(ctx, {radius: 10, x: 100, y: 100});\n *\n * // Draw two blue outlined circles\n * circle(ctx, [ {radius: 5}, {radius: 10} ], {strokeStyle:`blue`});\n * ```\n * @param ctx Drawing context\n * @param circlesToDraw Circle(s) to draw\n * @param opts Drawing options\n */\nexport const circle = (ctx, circlesToDraw, opts = {}) => {\n    applyOpts(ctx, opts);\n    const draw = (c) => {\n        ctx.beginPath();\n        ctx.arc(c.x, c.y, c.radius, 0, PIPI);\n        if (opts.strokeStyle)\n            ctx.stroke();\n        if (opts.fillStyle)\n            ctx.fill();\n    };\n    if (Array.isArray(circlesToDraw)) {\n        for (const c of circlesToDraw)\n            draw(c);\n    }\n    else {\n        draw(circlesToDraw);\n    }\n};\n/**\n * Draws one or more ellipses. Will draw outline/fill depending on\n * whether `strokeStyle` or `fillStyle` params are present in the drawing options.\n * @param ctx\n * @param ellipsesToDraw\n * @param opts\n */\nexport const ellipse = (ctx, ellipsesToDraw, opts = {}) => {\n    applyOpts(ctx, opts);\n    const draw = (ellipse) => {\n        ctx.beginPath();\n        const rotation = ellipse.rotation ?? 0;\n        const startAngle = ellipse.startAngle ?? 0;\n        const endAngle = ellipse.endAngle ?? PIPI;\n        ctx.ellipse(ellipse.x, ellipse.y, ellipse.radiusX, ellipse.radiusY, rotation, startAngle, endAngle);\n        if (opts.strokeStyle)\n            ctx.stroke();\n        if (opts.fillStyle)\n            ctx.fill();\n    };\n    const ellipsesArray = Array.isArray(ellipsesToDraw) ? ellipsesToDraw : [ellipsesToDraw];\n    for (const ellipse of ellipsesArray) {\n        draw(ellipse);\n    }\n};\n/**\n * Draws one or more paths.\n * supported paths are quadratic beziers and lines.\n * @param ctx\n * @param pathsToDraw\n * @param opts\n */\nexport const paths = (ctx, pathsToDraw, opts = {}) => {\n    applyOpts(ctx, opts);\n    const draw = (path) => {\n        // Call appropriate drawing function depending on the type of path\n        if (Beziers.isQuadraticBezier(path))\n            quadraticBezier(ctx, path, opts);\n        else if (Lines.isLine(path))\n            line(ctx, path, opts);\n        else\n            throw new Error(`Unknown path type ${JSON.stringify(path)}`);\n    };\n    if (Array.isArray(pathsToDraw)) {\n        for (const p of pathsToDraw)\n            draw(p);\n    }\n    else {\n        draw(pathsToDraw);\n    }\n};\n/**\n * Draws a line between all the given points.\n * If a fillStyle is specified, it will be filled.\n *\n * See also:\n * * {@link line}: Draw one or more lines\n *\n * @param ctx\n * @param pts\n */\nexport const connectedPoints = (ctx, pts, opts = {}) => {\n    const shouldLoop = opts.loop ?? false;\n    resultThrow(arrayTest(pts, `pts`));\n    if (pts.length === 0)\n        return;\n    // Throw an error if any point is invalid\n    for (const [index, pt] of pts.entries())\n        Points.guard(pt, `Index ${index}`);\n    applyOpts(ctx, opts);\n    // Draw points\n    if (opts.lineWidth)\n        ctx.lineWidth = opts.lineWidth;\n    ctx.beginPath();\n    ctx.moveTo(pts[0].x, pts[0].y);\n    for (const pt of pts)\n        ctx.lineTo(pt.x, pt.y);\n    if (shouldLoop)\n        ctx.lineTo(pts[0].x, pts[0].y);\n    // if (opts.strokeStyle) ctx.strokeStyle = opts.strokeStyle;\n    if (opts.strokeStyle ||\n        (opts.strokeStyle === undefined && opts.fillStyle === undefined)) {\n        ctx.stroke();\n    }\n    if (opts.fillStyle) {\n        ctx.fill();\n    }\n};\n/**\n * Draws labels for a set of points\n * @param ctx\n * @param pts Points to draw\n * @param opts\n * @param labels Labels for points\n */\nexport const pointLabels = (ctx, pts, opts = {}, labels) => {\n    if (pts.length === 0)\n        return;\n    // Throw an error if any point is invalid\n    for (const [index, pt] of pts.entries())\n        Points.guard(pt, `Index ${index}`);\n    applyOpts(ctx, opts);\n    for (const [index, pt] of pts.entries()) {\n        const label = labels !== undefined && index < labels.length ? labels[index] : index.toString();\n        ctx.fillText(label.toString(), pt.x, pt.y);\n    }\n};\n/**\n * Returns `point` with the canvas's translation matrix applied\n * @param ctx\n * @param point\n * @returns\n */\nexport const translatePoint = (ctx, point) => {\n    const m = ctx.getTransform();\n    return {\n        x: point.x * m.a + point.y * m.c + m.e,\n        y: point.x * m.b + point.y * m.d + m.f,\n    };\n};\n/**\n * Creates a new HTML IMG element with a snapshot of the\n * canvas. Element will need to be inserted into the document.\n *\n * ```\n * const myCanvas = document.getElementById('someCanvas');\n * const el = copyToImg(myCanvas);\n * document.getElementById('images').appendChild(el);\n * ```\n * @param canvasEl\n * @returns\n */\nexport const copyToImg = (canvasEl) => {\n    const img = document.createElement(`img`);\n    img.src = canvasEl.toDataURL(`image/jpeg`);\n    return img;\n};\n/**\n * Draws filled circle(s) at provided point(s)\n * @param ctx\n * @param pos\n * @param opts\n */\nexport const dot = (ctx, pos, opts) => {\n    opts ??= {};\n    const radius = opts.radius ?? 10;\n    const positions = Array.isArray(pos) ? pos : [pos];\n    const stroke = opts.stroke ? opts.stroke : opts.strokeStyle !== undefined;\n    let filled = opts.filled ? opts.filled : opts.fillStyle !== undefined;\n    if (!stroke && !filled)\n        filled = true;\n    applyOpts(ctx, opts);\n    for (const pos of positions) {\n        ctx.beginPath();\n        if (`radius` in pos) {\n            ctx.arc(pos.x, pos.y, pos.radius, 0, 2 * Math.PI);\n        }\n        else {\n            ctx.arc(pos.x, pos.y, radius, 0, 2 * Math.PI);\n        }\n        if (filled) {\n            ctx.fill();\n        }\n        if (stroke) {\n            ctx.stroke();\n        }\n    }\n    // const makePath = () => {\n    //   ctx.beginPath();\n    //   // x&y for arc is the center of circle\n    //   if (Array.isArray(pos)) {\n    //     for (const p of pos) {\n    //       ctx.arc(p.x, p.y, radius, 0, 2 * Math.PI);\n    //     }\n    //   } else {\n    //     const p = pos as Point;\n    //     ctx.arc(p.x, p.y, radius, 0, 2 * Math.PI);\n    //   }\n    // }\n    // makePath();\n    // if (opts.filled || !opts.stroke) {\n    //   ctx.fill();\n    // }\n    // if (opts.stroke) {\n    //   if (opts.strokeWidth) ctx.lineWidth = opts.strokeWidth;\n    //   //makePath();\n    //   ctx.stroke();\n    // }\n};\n/**\n * Draws a cubic or quadratic bezier\n * @param ctx\n * @param bezierToDraw\n * @param opts\n */\nexport const bezier = (ctx, bezierToDraw, opts) => {\n    if (Beziers.isQuadraticBezier(bezierToDraw)) {\n        quadraticBezier(ctx, bezierToDraw, opts);\n    }\n    else if (Beziers.isCubicBezier(bezierToDraw)) {\n        cubicBezier(ctx, bezierToDraw, opts);\n    }\n};\nconst cubicBezier = (ctx, bezierToDraw, opts = {}) => {\n    let stack = applyOpts(ctx, opts);\n    const { a, b, cubic1, cubic2 } = bezierToDraw;\n    const isDebug = opts.debug ?? false;\n    if (isDebug) {\n        /*\n         * const ss = ctx.strokeStyle;\n         * ctx.strokeStyle = ss;\n         */\n    }\n    ctx.beginPath();\n    ctx.moveTo(a.x, a.y);\n    ctx.bezierCurveTo(cubic1.x, cubic1.y, cubic2.x, cubic2.y, b.x, b.y);\n    ctx.stroke();\n    if (isDebug) {\n        stack = stack.push(optsOp({\n            ...opts,\n            strokeStyle: Colour.multiplyOpacity(opts.strokeStyle ?? `silver`, 0.6),\n            fillStyle: Colour.multiplyOpacity(opts.fillStyle ?? `yellow`, 0.4),\n        }));\n        stack.apply();\n        ctx.moveTo(a.x, a.y);\n        ctx.lineTo(cubic1.x, cubic1.y);\n        ctx.stroke();\n        ctx.moveTo(b.x, b.y);\n        ctx.lineTo(cubic2.x, cubic2.y);\n        ctx.stroke();\n        ctx.fillText(`a`, a.x + 5, a.y);\n        ctx.fillText(`b`, b.x + 5, b.y);\n        ctx.fillText(`c1`, cubic1.x + 5, cubic1.y);\n        ctx.fillText(`c2`, cubic2.x + 5, cubic2.y);\n        dot(ctx, cubic1, { radius: 3 });\n        dot(ctx, cubic2, { radius: 3 });\n        dot(ctx, a, { radius: 3 });\n        dot(ctx, b, { radius: 3 });\n        stack = stack.pop();\n        stack.apply();\n    }\n};\nconst quadraticBezier = (ctx, bezierToDraw, opts = {}) => {\n    const { a, b, quadratic } = bezierToDraw;\n    const isDebug = opts.debug ?? false;\n    let stack = applyOpts(ctx, opts);\n    ctx.beginPath();\n    ctx.moveTo(a.x, a.y);\n    ctx.quadraticCurveTo(quadratic.x, quadratic.y, b.x, b.y);\n    ctx.stroke();\n    if (isDebug) {\n        /*\n         * const fs = ctx.fillStyle;\n         * const ss = ctx.strokeStyle;\n         * ctx.fillStyle = opts.strokeStyle ?? `gray`;\n         * ctx.strokeStyle = opts.strokeStyle ?? `gray`;\n         */\n        stack = stack.push(optsOp({\n            ...opts,\n            strokeStyle: Colour.multiplyOpacity(opts.strokeStyle ?? `silver`, 0.6),\n            fillStyle: Colour.multiplyOpacity(opts.fillStyle ?? `yellow`, 0.4),\n        }));\n        connectedPoints(ctx, [a, quadratic, b]);\n        ctx.fillText(`a`, a.x + 5, a.y);\n        ctx.fillText(`b`, b.x + 5, b.y);\n        ctx.fillText(`h`, quadratic.x + 5, quadratic.y);\n        dot(ctx, quadratic, { radius: 3 });\n        dot(ctx, a, { radius: 3 });\n        dot(ctx, b, { radius: 3 });\n        /*\n         * ctx.fillStyle = fs;\n         * ctx.strokeStyle = ss;\n         */\n        stack = stack.pop();\n        stack.apply();\n    }\n};\n/**\n * Draws one or more lines.\n *\n * Each line is drawn independently, ie it's not assumed lines are connected.\n *\n * See also:\n * * {@link connectedPoints}: Draw a series of connected points\n * @param ctx\n * @param toDraw\n * @param opts\n */\nexport const line = (ctx, toDraw, opts = {}) => {\n    const isDebug = opts.debug ?? false;\n    const o = lineOp(opts.lineWidth, opts.lineJoin, opts.lineCap);\n    applyOpts(ctx, opts, o);\n    const draw = (d) => {\n        const { a, b } = d;\n        ctx.beginPath();\n        ctx.moveTo(a.x, a.y);\n        ctx.lineTo(b.x, b.y);\n        if (isDebug) {\n            ctx.fillText(`a`, a.x, a.y);\n            ctx.fillText(`b`, b.x, b.y);\n            dot(ctx, a, { radius: 5, strokeStyle: `black` });\n            dot(ctx, b, { radius: 5, strokeStyle: `black` });\n        }\n        ctx.stroke();\n    };\n    if (Array.isArray(toDraw)) {\n        for (const t of toDraw)\n            draw(t);\n    }\n    else {\n        draw(toDraw);\n    }\n};\n/**\n * Draws one or more triangles\n * @param ctx\n * @param toDraw\n * @param opts\n */\nexport const triangle = (ctx, toDraw, opts = {}) => {\n    applyOpts(ctx, opts);\n    const draw = (t) => {\n        connectedPoints(ctx, Triangles.corners(t), { ...opts, loop: true });\n        if (opts.debug) {\n            pointLabels(ctx, Triangles.corners(t), undefined, [`a`, `b`, `c`]);\n        }\n    };\n    if (Array.isArray(toDraw)) {\n        for (const t of toDraw) {\n            draw(t);\n        }\n    }\n    else {\n        draw(toDraw);\n    }\n};\n/**\n * Draws one or more rectangles.\n *\n * @param ctx\n * @param toDraw\n * @param opts\n */\nexport const rect = (ctx, toDraw, opts = {}) => {\n    applyOpts(ctx, opts);\n    const filled = opts.filled ?? (opts.fillStyle === undefined ? false : true);\n    const stroke = opts.stroke ?? (opts.strokeStyle === undefined ? false : true);\n    const draw = (d) => {\n        const x = `x` in d ? d.x : 0;\n        const y = `y` in d ? d.y : 0;\n        if (filled)\n            ctx.fillRect(x, y, d.width, d.height);\n        if (stroke) {\n            if (opts.strokeWidth)\n                ctx.lineWidth = opts.strokeWidth;\n            //if (opts.strokeStyle) ctx.strokeStyle = opts.strokeStyle;\n            ctx.strokeRect(x, y, d.width, d.height);\n        }\n        if (opts.crossed) {\n            ctx.beginPath();\n            ctx.moveTo(x, y);\n            ctx.lineTo(d.width, d.height);\n            ctx.stroke();\n            ctx.moveTo(0, d.height);\n            ctx.lineTo(d.width, 0);\n            ctx.stroke();\n        }\n        if (opts.debug) {\n            pointLabels(ctx, Rects.corners(d), undefined, [`NW`, `NE`, `SE`, `SW`]);\n        }\n    };\n    if (Array.isArray(toDraw)) {\n        for (const t of toDraw) {\n            draw(t);\n        }\n    }\n    else {\n        draw(toDraw);\n    }\n};\n/**\n * Returns the width of `text`. Rounds number up to nearest multiple if provided. If\n * text is empty or undefined, 0 is returned.\n * @param ctx\n * @param text\n * @param widthMultiple\n * @returns\n */\nexport const textWidth = (ctx, text, padding = 0, widthMultiple) => {\n    const rect = textRect(ctx, text, padding, widthMultiple);\n    return rect.width;\n};\nexport const textRect = (ctx, text, padding = 0, widthMultiple) => {\n    if (text === undefined || text === null || text.length === 0)\n        return Rects.Empty;\n    const m = ctx.measureText(text);\n    const width = (widthMultiple) ? quantiseEvery(m.width, widthMultiple) + padding : m.width + padding;\n    return {\n        width: width,\n        height: m.actualBoundingBoxAscent + m.actualBoundingBoxDescent + padding + padding\n    };\n};\nexport const textHeight = (ctx, text, padding = 0) => {\n    const rect = textRect(ctx, text, padding);\n    return rect.height;\n    // if (text === undefined || text === null || text.length === 0) return 0;\n    // const m = ctx.measureText(text);\n    // return m.actualBoundingBoxAscent + m.actualBoundingBoxDescent + padding + padding;\n};\n/**\n * Draws a block of text. Each array item is considered a line.\n * @param ctx\n * @param lines\n * @param opts\n */\nexport const textBlock = (ctx, lines, opts) => {\n    applyOpts(ctx, opts);\n    const anchorPadding = opts.anchorPadding ?? 0;\n    const align = opts.align ?? `top`;\n    const anchor = opts.anchor;\n    const bounds = opts.bounds ?? { x: 0, y: 0, width: 1_000_000, height: 1_000_000 };\n    // Measure each line\n    const blocks = lines.map((l) => ctx.measureText(l));\n    // Get width and height\n    const widths = blocks.map((tm) => tm.width);\n    const heights = blocks.map((tm) => tm.actualBoundingBoxAscent + tm.actualBoundingBoxDescent + 3);\n    // Find extremes\n    const maxWidth = Math.max(...widths);\n    const totalHeight = heights.reduce((accumulator, value) => accumulator + value, 0);\n    let { x, y } = anchor;\n    if (anchor.x + maxWidth > bounds.width) {\n        x = bounds.width - (maxWidth + anchorPadding);\n    }\n    else\n        x -= anchorPadding;\n    if (x < bounds.x)\n        x = bounds.x + anchorPadding;\n    if (anchor.y + totalHeight > bounds.height) {\n        y = bounds.height - (totalHeight + anchorPadding);\n    }\n    else\n        y -= anchorPadding;\n    if (y < bounds.y)\n        y = bounds.y + anchorPadding;\n    if (align === `top`) {\n        ctx.textBaseline = `top`;\n    }\n    else {\n        ctx.textBaseline = `middle`;\n    }\n    for (const [index, line] of lines.entries()) {\n        ctx.fillText(line, x, y);\n        y += heights[index];\n    }\n};\n/**\n * Draws an aligned text block\n */\nexport const textBlockAligned = (ctx, text, opts) => {\n    const { bounds } = opts;\n    const { horiz = `left`, vert = `top` } = opts;\n    const lines = typeof text === `string` ? [text] : text;\n    applyOpts(ctx, opts);\n    ctx.save();\n    ctx.translate(bounds.x, bounds.y);\n    ctx.textAlign = `left`;\n    ctx.textBaseline = `top`;\n    const middleX = bounds.width / 2;\n    const middleY = bounds.height / 2;\n    // Measure each line\n    const blocks = lines.map((l) => ctx.measureText(l));\n    const heights = blocks.map((tm) => tm.actualBoundingBoxAscent + tm.actualBoundingBoxDescent);\n    const totalHeight = heights.reduce((accumulator, value) => accumulator + value, 0);\n    let y = 0;\n    if (vert === `center`)\n        y = middleY - totalHeight / 2;\n    else if (vert === `bottom`) {\n        y = bounds.height - totalHeight;\n    }\n    for (const [index, line] of lines.entries()) {\n        let x = 0;\n        if (horiz === `center`)\n            x = middleX - blocks[index].width / 2;\n        else if (horiz === `right`)\n            x = bounds.width - blocks[index].width;\n        ctx.fillText(line, x, y);\n        y += heights[index];\n    }\n    ctx.restore();\n};\n","var __defProp = Object.defineProperty;\nvar __defNormalProp = (obj, key, value) => key in obj ? __defProp(obj, key, { enumerable: true, configurable: true, writable: true, value }) : obj[key] = value;\nvar __export = (target, all) => {\n  for (var name2 in all)\n    __defProp(target, name2, { get: all[name2], enumerable: true });\n};\nvar __publicField = (obj, key, value) => __defNormalProp(obj, typeof key !== \"symbol\" ? key + \"\" : key, value);\n\n// src/modules/invariant.ts\nfunction invariant(condition, message) {\n  if (condition) {\n    return;\n  }\n  if (process.env.NODE_ENV !== \"production\") {\n    if (message === void 0) {\n      throw new Error(\"invariant requires an error message argument\");\n    }\n  }\n  const error = !message ? new Error(\n    \"Minified exception occurred; use the non-minified dev environment for the full error message and additional helpful warnings.\"\n  ) : new Error(message);\n  error.name = \"colorizr\";\n  throw error;\n}\n\n// src/modules/constants.ts\nvar COLOR_KEYS = {\n  hsl: [\"h\", \"s\", \"l\"],\n  oklab: [\"l\", \"a\", \"b\"],\n  oklch: [\"l\", \"c\", \"h\"],\n  rgb: [\"r\", \"g\", \"b\"]\n};\nvar COLOR_MODELS = [\"hsl\", \"oklab\", \"oklch\", \"rgb\"];\nvar DEG2RAD = Math.PI / 180;\nvar LAB_TO_LMS = {\n  l: [0.3963377773761749, 0.2158037573099136],\n  m: [-0.1055613458156586, -0.0638541728258133],\n  s: [-0.0894841775298119, -1.2914855480194092]\n};\nvar LRGB_TO_LMS = {\n  l: [0.4122214708, 0.5363325363, 0.0514459929],\n  m: [0.2119034982, 0.6806995451, 0.1073969566],\n  s: [0.0883024619, 0.2817188376, 0.6299787005]\n};\nvar LSM_TO_LAB = {\n  l: [0.2104542553, 0.793617785, 0.0040720468],\n  a: [1.9779984951, 2.428592205, 0.4505937099],\n  b: [0.0259040371, 0.7827717662, 0.808675766]\n};\nvar LSM_TO_RGB = {\n  r: [4.076741636075958, -3.307711539258063, 0.2309699031821043],\n  g: [-1.2684379732850315, 2.609757349287688, -0.341319376002657],\n  b: [-0.0041960761386756, -0.7034186179359362, 1.7076146940746117]\n};\nvar SRGB_TO_P3 = [\n  [0.8224270476, 0.1775729524, 0],\n  [0.0331008087, 0.9668991913, 0],\n  [0.0170720188, 0.0723477973, 0.9105801839]\n];\nvar PRECISION = 5;\nvar RAD2DEG = 180 / Math.PI;\nvar MESSAGES = {\n  alpha: \"amount must be a number between 0 and 1\",\n  hueRange: \"hue must be a number between 0 and 360\",\n  input: \"input is required\",\n  inputHex: \"input is required and must be a hex\",\n  inputNumber: \"input is required and must be a number\",\n  inputString: \"input is required and must be a string\",\n  invalid: \"invalid input\",\n  invalidCSS: \"invalid CSS string\",\n  left: \"left is required and must be a string\",\n  lightnessRange: \"lightness must be a number between 0 and 1\",\n  options: \"invalid options\",\n  right: \"right is required and must be a string\",\n  threshold: \"threshold must be a number between 0 and 255\"\n};\n\n// src/modules/css-colors.ts\nvar cssColors = {\n  aliceblue: \"#f0f8ff\",\n  antiquewhite: \"#faebd7\",\n  aqua: \"#00ffff\",\n  aquamarine: \"#7fffd4\",\n  azure: \"#f0ffff\",\n  beige: \"#f5f5dc\",\n  bisque: \"#ffe4c4\",\n  black: \"#000000\",\n  blanchedalmond: \"#ffebcd\",\n  blue: \"#0000ff\",\n  blueviolet: \"#8a2be2\",\n  brown: \"#a52a2a\",\n  burlywood: \"#deb887\",\n  cadetblue: \"#5f9ea0\",\n  chartreuse: \"#7fff00\",\n  chocolate: \"#d2691e\",\n  coral: \"#ff7f50\",\n  cornflowerblue: \"#6495ed\",\n  cornsilk: \"#fff8dc\",\n  crimson: \"#dc143c\",\n  cyan: \"#00ffff\",\n  darkblue: \"#00008b\",\n  darkcyan: \"#008b8b\",\n  darkgoldenrod: \"#b8860b\",\n  darkgray: \"#a9a9a9\",\n  darkgreen: \"#006400\",\n  darkkhaki: \"#bdb76b\",\n  darkmagenta: \"#8b008b\",\n  darkolivegreen: \"#556b2f\",\n  darkorange: \"#ff8c00\",\n  darkorchid: \"#9932cc\",\n  darkred: \"#8b0000\",\n  darksalmon: \"#e9967a\",\n  darkseagreen: \"#8fbc8f\",\n  darkslateblue: \"#483d8b\",\n  darkslategray: \"#2f4f4f\",\n  darkslategrey: \"#2f4f4f\",\n  darkturquoise: \"#00ced1\",\n  darkviolet: \"#9400d3\",\n  deeppink: \"#ff1493\",\n  deepskyblue: \"#00bfff\",\n  dimgray: \"#696969\",\n  dimgrey: \"#696969\",\n  dodgerblue: \"#1e90ff\",\n  firebrick: \"#b22222\",\n  floralwhite: \"#fffaf0\",\n  forestgreen: \"#228b22\",\n  fuchsia: \"#ff00ff\",\n  gainsboro: \"#dcdcdc\",\n  ghostwhite: \"#f8f8ff\",\n  gold: \"#ffd700\",\n  goldenrod: \"#daa520\",\n  gray: \"#808080\",\n  grey: \"#808080\",\n  green: \"#008000\",\n  greenyellow: \"#adff2f\",\n  honeydew: \"#f0fff0\",\n  hotpink: \"#ff69b4\",\n  indianred: \"#cd5c5c\",\n  indigo: \"#4b0082\",\n  ivory: \"#fffff0\",\n  khaki: \"#f0e68c\",\n  lavender: \"#e6e6fa\",\n  lavenderblush: \"#fff0f5\",\n  lawngreen: \"#7cfc00\",\n  lemonchiffon: \"#fffacd\",\n  lightblue: \"#add8e6\",\n  lightcoral: \"#f08080\",\n  lightcyan: \"#e0ffff\",\n  lightgoldenrodyellow: \"#fafad2\",\n  lightgray: \"#d3d3d3\",\n  lightgreen: \"#90ee90\",\n  lightgrey: \"#d3d3d3\",\n  lightpink: \"#ffb6c1\",\n  lightsalmon: \"#ffa07a\",\n  lightseagreen: \"#20b2aa\",\n  lightskyblue: \"#87cefa\",\n  lightslategray: \"#778899\",\n  lightslategrey: \"#778899\",\n  lightsteelblue: \"#b0c4de\",\n  lightyellow: \"#ffffe0\",\n  lime: \"#00ff00\",\n  limegreen: \"#32cd32\",\n  linen: \"#faf0e6\",\n  magenta: \"#ff00ff\",\n  maroon: \"#800000\",\n  mediumaquamarine: \"#66cdaa\",\n  mediumblue: \"#0000cd\",\n  mediumorchid: \"#ba55d3\",\n  mediumpurple: \"#9370db\",\n  mediumseagreen: \"#3cb371\",\n  mediumslateblue: \"#7b68ee\",\n  mediumspringgreen: \"#00fa9a\",\n  mediumturquoise: \"#48d1cc\",\n  mediumvioletred: \"#c71585\",\n  midnightblue: \"#191970\",\n  mintcream: \"#f5fffa\",\n  mistyrose: \"#ffe4e1\",\n  moccasin: \"#ffe4b5\",\n  navajowhite: \"#ffdead\",\n  navy: \"#000080\",\n  oldlace: \"#fdf5e6\",\n  olive: \"#808000\",\n  olivedrab: \"#6b8e23\",\n  orange: \"#ffa500\",\n  orangered: \"#ff4500\",\n  orchid: \"#da70d6\",\n  palegoldenrod: \"#eee8aa\",\n  palegreen: \"#98fb98\",\n  paleturquoise: \"#afeeee\",\n  palevioletred: \"#db7093\",\n  papayawhip: \"#ffefd5\",\n  peachpuff: \"#ffdab9\",\n  peru: \"#cd853f\",\n  pink: \"#ffc0cb\",\n  plum: \"#dda0dd\",\n  powderblue: \"#b0e0e6\",\n  purple: \"#800080\",\n  rebeccapurple: \"#663399\",\n  red: \"#ff0000\",\n  rosybrown: \"#bc8f8f\",\n  royalblue: \"#4169e1\",\n  saddlebrown: \"#8b4513\",\n  salmon: \"#fa8072\",\n  sandybrown: \"#f4a460\",\n  seagreen: \"#2e8b57\",\n  seashell: \"#fff5ee\",\n  sienna: \"#a0522d\",\n  silver: \"#c0c0c0\",\n  skyblue: \"#87ceeb\",\n  slateblue: \"#6a5acd\",\n  slategray: \"#708090\",\n  slategrey: \"#708090\",\n  snow: \"#fffafa\",\n  springgreen: \"#00ff7f\",\n  steelblue: \"#4682b4\",\n  tan: \"#d2b48c\",\n  teal: \"#008080\",\n  thistle: \"#d8bfd8\",\n  tomato: \"#ff6347\",\n  turquoise: \"#40e0d0\",\n  violet: \"#ee82ee\",\n  wheat: \"#f5deb3\",\n  white: \"#ffffff\",\n  whitesmoke: \"#f5f5f5\",\n  yellow: \"#ffff00\",\n  yellowgreen: \"#9acd32\"\n};\n\n// src/modules/validators.ts\nfunction hasValidMatches(input) {\n  return Array.isArray(input) && input.length === 6;\n}\nfunction isNamedColor(input) {\n  return isString(input) && Object.keys(cssColors).includes(input.toLowerCase());\n}\nfunction isNumber(input) {\n  return typeof input === \"number\" && !Number.isNaN(input);\n}\nfunction isPlainObject(input) {\n  if (!input) {\n    return false;\n  }\n  const { toString } = Object.prototype;\n  const prototype = Object.getPrototypeOf(input);\n  return toString.call(input) === \"[object Object]\" && (prototype === null || prototype === Object.getPrototypeOf({}));\n}\nfunction isString(input, validate = true) {\n  const isValid = typeof input === \"string\";\n  if (validate) {\n    return isValid && !!input.trim().length;\n  }\n  return isValid;\n}\nfunction isValidColorModel(input) {\n  return isHSL(input) || isRGB(input) || isLAB(input) || isLCH(input);\n}\nfunction isHex(input) {\n  if (!isString(input)) {\n    return false;\n  }\n  return /^#([\\da-f]{3,4}|[\\da-f]{6,8})$/i.test(input);\n}\nfunction isHSL(input) {\n  if (!isPlainObject(input)) {\n    return false;\n  }\n  const entries = Object.entries(input);\n  return !!entries.length && entries.every(([key, value]) => {\n    if (key === \"h\") {\n      return value >= 0 && value <= 360;\n    }\n    if (key === \"alpha\") {\n      return value >= 0 && value <= 1;\n    }\n    return COLOR_KEYS.hsl.includes(key) && value >= 0 && value <= 100;\n  });\n}\nfunction isLAB(input) {\n  if (!isPlainObject(input)) {\n    return false;\n  }\n  const entries = Object.entries(input);\n  return !!entries.length && entries.every(([key, value]) => {\n    if (key === \"l\") {\n      return value >= 0 && value <= 100;\n    }\n    if (key === \"alpha\") {\n      return value >= 0 && value <= 1;\n    }\n    return COLOR_KEYS.oklab.includes(key) && value >= -1 && value <= 1;\n  });\n}\nfunction isLCH(input) {\n  if (!isPlainObject(input)) {\n    return false;\n  }\n  const entries = Object.entries(input);\n  return !!entries.length && entries.every(([key, value]) => {\n    if (key === \"l\") {\n      return value >= 0 && value <= 100;\n    }\n    if (key === \"alpha\") {\n      return value >= 0 && value <= 1;\n    }\n    return COLOR_KEYS.oklch.includes(key) && value >= 0 && value <= (key === \"h\" ? 360 : 1);\n  });\n}\nfunction isRGB(input) {\n  if (!isPlainObject(input)) {\n    return false;\n  }\n  const entries = Object.entries(input);\n  return !!entries.length && entries.every(([key, value]) => {\n    if (key === \"alpha\") {\n      return value >= 0 && value <= 1;\n    }\n    return COLOR_KEYS.rgb.includes(key) && value >= 0 && value <= 255;\n  });\n}\n\n// src/modules/utils.ts\nfunction addAlpha(input, alpha) {\n  invariant(isValidColorModel(input), MESSAGES.invalid);\n  let value = alpha;\n  if (!value) {\n    return input;\n  }\n  if (value > 1) {\n    value /= 100;\n  }\n  if (value === 1) {\n    return input;\n  }\n  return { ...input, alpha: value };\n}\nfunction clamp(value, min = 0, max = 100) {\n  return Math.min(Math.max(value, min), max);\n}\nfunction constrainDegrees(input, amount) {\n  invariant(isNumber(input), MESSAGES.inputNumber);\n  let value = input + amount;\n  if (value > 360) {\n    value %= 360;\n  }\n  if (value < 0) {\n    value += 360;\n  }\n  return Math.abs(value);\n}\nfunction limit(input, model, key) {\n  invariant(isNumber(input), \"Input is not a number\");\n  invariant(COLOR_MODELS.includes(model), `Invalid model${model ? `: ${model}` : \"\"}`);\n  invariant(COLOR_KEYS[model].includes(key), `Invalid key${key ? `: ${key}` : \"\"}`);\n  switch (model) {\n    case \"hsl\": {\n      invariant(COLOR_KEYS.hsl.includes(key), \"Invalid key\");\n      if ([\"s\", \"l\"].includes(key)) {\n        return clamp(input);\n      }\n      return clamp(input, 0, 360);\n    }\n    case \"rgb\": {\n      invariant(COLOR_KEYS.rgb.includes(key), \"Invalid key\");\n      return clamp(input, 0, 255);\n    }\n    /* c8 ignore next 3 */\n    default: {\n      throw new Error(\"Invalid inputs\");\n    }\n  }\n}\nfunction parseInput(input, model) {\n  const keys = COLOR_KEYS[model];\n  const validator = {\n    hsl: isHSL,\n    oklab: isLAB,\n    oklch: isLCH,\n    rgb: isRGB\n  };\n  invariant(isPlainObject(input) || Array.isArray(input), MESSAGES.invalid);\n  const value = Array.isArray(input) ? { [keys[0]]: input[0], [keys[1]]: input[1], [keys[2]]: input[2] } : input;\n  invariant(validator[model](value), `invalid ${model} color`);\n  return value;\n}\nfunction restrictValues(input, precision = PRECISION, forcePrecision = true) {\n  const output = new Map(Object.entries(input));\n  for (const [key, value] of output.entries()) {\n    output.set(key, round(value, precision, forcePrecision));\n  }\n  return Object.fromEntries(output);\n}\nfunction round(input, precision = 2, forcePrecision = true) {\n  if (!isNumber(input) || input === 0) {\n    return 0;\n  }\n  if (forcePrecision) {\n    const factor2 = 10 ** precision;\n    return Math.round(input * factor2) / factor2;\n  }\n  const absInput = Math.abs(input);\n  let digits = Math.abs(Math.ceil(Math.log(absInput) / Math.LN10));\n  if (digits === 0) {\n    digits = 2;\n  } else if (digits > precision) {\n    digits = precision;\n  }\n  let exponent = precision - (digits < 0 ? 0 : digits);\n  if (exponent <= 1 && precision > 1) {\n    exponent = 2;\n  } else if (exponent > precision || exponent === 0) {\n    exponent = precision;\n  }\n  const factor = 10 ** exponent;\n  return Math.round(input * factor) / factor;\n}\n\n// src/modules/hex-utils.ts\nfunction addAlphaToHex(input, alpha) {\n  invariant(isHex(input), MESSAGES.inputHex);\n  invariant(isNumber(alpha), MESSAGES.inputNumber);\n  if (alpha >= 1) {\n    return removeAlphaFromHex(input);\n  }\n  return `${removeAlphaFromHex(input)}${convertAlphaToHex(alpha)}`;\n}\nfunction convertAlphaToHex(input) {\n  invariant(isNumber(input), MESSAGES.inputNumber);\n  let alpha = input;\n  if (input > 1) {\n    alpha /= 100;\n  }\n  return Math.round(alpha * 255).toString(16).padStart(2, \"0\");\n}\nfunction extractAlphaFromHex(input) {\n  invariant(isHex(input), MESSAGES.inputString);\n  const alpha = input.substring(7, 9);\n  if (!alpha) {\n    return 1;\n  }\n  return round(parseInt(alpha, 16) / 255);\n}\nfunction hexadecimalToNumber(input) {\n  return round(parseInt(input, 16));\n}\nfunction removeAlphaFromHex(input) {\n  invariant(isHex(input), MESSAGES.inputHex);\n  if (input.length === 5) {\n    return input.substring(0, 4);\n  }\n  return input.substring(0, 7);\n}\n\n// src/converters/index.ts\nvar converters_exports = {};\n__export(converters_exports, {\n  hex2hsl: () => hex2hsl,\n  hex2oklab: () => hex2oklab,\n  hex2oklch: () => hex2oklch,\n  hex2rgb: () => hex2rgb,\n  hsl2hex: () => hsl2hex,\n  hsl2oklab: () => hsl2oklab,\n  hsl2oklch: () => hsl2oklch,\n  hsl2rgb: () => hsl2rgb,\n  oklab2hex: () => oklab2hex,\n  oklab2hsl: () => oklab2hsl,\n  oklab2oklch: () => oklab2oklch,\n  oklab2rgb: () => oklab2rgb,\n  oklch2hex: () => oklch2hex,\n  oklch2hsl: () => oklch2hsl,\n  oklch2oklab: () => oklch2oklab,\n  oklch2rgb: () => oklch2rgb,\n  rgb2hex: () => rgb2hex,\n  rgb2hsl: () => rgb2hsl,\n  rgb2oklab: () => rgb2oklab,\n  rgb2oklch: () => rgb2oklch\n});\n\n// src/format-hex.ts\nfunction formatHex(input) {\n  invariant(isHex(input), MESSAGES.inputHex);\n  let color = input.replace(\"#\", \"\");\n  if (color.length === 3 || color.length === 4) {\n    const values = [...color];\n    color = \"\";\n    values.forEach((d) => {\n      color += `${d}${d}`;\n    });\n  }\n  const hex = `#${color}`;\n  invariant(isHex(hex), \"invalid hex\");\n  return hex;\n}\n\n// src/converters/hex2rgb.ts\nfunction hex2rgb(input) {\n  invariant(isHex(input), MESSAGES.inputHex);\n  const hex = formatHex(input).slice(1);\n  return {\n    r: parseInt(hex.charAt(0) + hex.charAt(1), 16),\n    g: parseInt(hex.charAt(2) + hex.charAt(3), 16),\n    b: parseInt(hex.charAt(4) + hex.charAt(5), 16)\n  };\n}\n\n// src/converters/rgb2hsl.ts\nfunction rgb2hsl(input) {\n  const value = parseInput(input, \"rgb\");\n  const rLimit = limit(value.r, \"rgb\", \"r\") / 255;\n  const gLimit = limit(value.g, \"rgb\", \"g\") / 255;\n  const bLimit = limit(value.b, \"rgb\", \"b\") / 255;\n  const min = Math.min(rLimit, gLimit, bLimit);\n  const max = Math.max(rLimit, gLimit, bLimit);\n  const delta = max - min;\n  let h = 0;\n  let s;\n  const l = (max + min) / 2;\n  let rate;\n  switch (max) {\n    case rLimit:\n      rate = !delta ? 0 : (gLimit - bLimit) / delta;\n      h = 60 * rate;\n      break;\n    case gLimit:\n      rate = (bLimit - rLimit) / delta;\n      h = 60 * rate + 120;\n      break;\n    case bLimit:\n      rate = (rLimit - gLimit) / delta;\n      h = 60 * rate + 240;\n      break;\n    /* c8 ignore next 2 */\n    default:\n      break;\n  }\n  if (h < 0) {\n    h = 360 + h;\n  }\n  if (min === max) {\n    s = 0;\n  } else {\n    s = l < 0.5 ? delta / (2 * l) : delta / (2 - 2 * l);\n  }\n  return {\n    h: Math.abs(+(h % 360).toFixed(2)),\n    s: +(s * 100).toFixed(2),\n    l: +(l * 100).toFixed(2)\n  };\n}\n\n// src/converters/hex2hsl.ts\nfunction hex2hsl(input) {\n  invariant(isHex(input), MESSAGES.inputHex);\n  return rgb2hsl(hex2rgb(input));\n}\n\n// src/converters/rgb2oklab.ts\nvar { cbrt, sign } = Math;\nfunction rgb2lrgb(input) {\n  const abs2 = Math.abs(input);\n  if (abs2 < 0.04045) {\n    return input / 12.92;\n  }\n  return (sign(input) || 1) * ((abs2 + 0.055) / 1.055) ** 2.4;\n}\nfunction rgb2oklab(input, precision = PRECISION) {\n  const value = parseInput(input, \"rgb\");\n  const [lr, lg, lb] = [rgb2lrgb(value.r / 255), rgb2lrgb(value.g / 255), rgb2lrgb(value.b / 255)];\n  const l = cbrt(LRGB_TO_LMS.l[0] * lr + LRGB_TO_LMS.l[1] * lg + LRGB_TO_LMS.l[2] * lb);\n  const m = cbrt(LRGB_TO_LMS.m[0] * lr + LRGB_TO_LMS.m[1] * lg + LRGB_TO_LMS.m[2] * lb);\n  const s = cbrt(LRGB_TO_LMS.s[0] * lr + LRGB_TO_LMS.s[1] * lg + LRGB_TO_LMS.s[2] * lb);\n  const lab = {\n    l: LSM_TO_LAB.l[0] * l + LSM_TO_LAB.l[1] * m - LSM_TO_LAB.l[2] * s,\n    a: LSM_TO_LAB.a[0] * l - LSM_TO_LAB.a[1] * m + LSM_TO_LAB.a[2] * s,\n    b: LSM_TO_LAB.b[0] * l + LSM_TO_LAB.b[1] * m - LSM_TO_LAB.b[2] * s\n  };\n  return restrictValues(lab, precision);\n}\n\n// src/converters/hex2oklab.ts\nfunction hex2oklab(input, precision) {\n  invariant(isHex(input), MESSAGES.inputHex);\n  return rgb2oklab(hex2rgb(input), precision);\n}\n\n// src/converters/oklab2oklch.ts\nvar { atan2, sqrt } = Math;\nfunction oklab2oklch(input, precision) {\n  const { l, a, b } = restrictValues(parseInput(input, \"oklab\"));\n  const c = sqrt(a ** 2 + b ** 2);\n  let h = (atan2(b, a) * RAD2DEG + 360) % 360;\n  if (round(c * 1e4) === 0) {\n    h = 0;\n  }\n  return restrictValues({ l, c, h }, precision);\n}\n\n// src/converters/rgb2oklch.ts\nfunction rgb2oklch(input, precision) {\n  const value = parseInput(input, \"rgb\");\n  return oklab2oklch(rgb2oklab(value, precision), precision);\n}\n\n// src/converters/hex2oklch.ts\nfunction hex2oklch(input, precision) {\n  invariant(isHex(input), MESSAGES.inputHex);\n  return rgb2oklch(hex2rgb(input), precision);\n}\n\n// src/modules/hue2rgb.ts\nfunction hue2rgb(point, chroma2, h) {\n  invariant(isNumber(point) && isNumber(chroma2) && isNumber(h), \"point, chroma and h are required\");\n  let hue = h;\n  if (hue < 0) {\n    hue += 1;\n  }\n  if (hue > 1) {\n    hue -= 1;\n  }\n  if (hue < 1 / 6) {\n    return round(point + (chroma2 - point) * 6 * hue, 4);\n  }\n  if (hue < 1 / 2) {\n    return round(chroma2, 4);\n  }\n  if (hue < 2 / 3) {\n    return round(point + (chroma2 - point) * (2 / 3 - hue) * 6, 4);\n  }\n  return round(point, 4);\n}\n\n// src/converters/hsl2rgb.ts\nfunction hsl2rgb(input) {\n  const value = parseInput(input, \"hsl\");\n  const h = round(value.h) / 360;\n  const s = round(value.s) / 100;\n  const l = round(value.l) / 100;\n  let r;\n  let g;\n  let b;\n  let point;\n  let chroma2;\n  if (s === 0) {\n    r = l;\n    g = l;\n    b = l;\n  } else {\n    chroma2 = l < 0.5 ? l * (1 + s) : l + s - l * s;\n    point = 2 * l - chroma2;\n    r = hue2rgb(point, chroma2, h + 1 / 3);\n    g = hue2rgb(point, chroma2, h);\n    b = hue2rgb(point, chroma2, h - 1 / 3);\n  }\n  return {\n    r: Math.round(r * 255),\n    g: Math.round(g * 255),\n    b: Math.round(b * 255)\n  };\n}\n\n// src/converters/rgb2hex.ts\nfunction rgb2hex(input) {\n  const rgb = parseInput(input, \"rgb\");\n  return `#${Object.values(rgb).map((d) => `0${Math.floor(d).toString(16)}`.slice(-2)).join(\"\")}`;\n}\n\n// src/converters/hsl2hex.ts\nfunction hsl2hex(input) {\n  const value = parseInput(input, \"hsl\");\n  return rgb2hex(hsl2rgb(value));\n}\n\n// src/converters/hsl2oklab.ts\nfunction hsl2oklab(input, precision) {\n  const value = parseInput(input, \"hsl\");\n  return rgb2oklab(hsl2rgb(value), precision);\n}\n\n// src/converters/hsl2oklch.ts\nfunction hsl2oklch(input, precision) {\n  const value = parseInput(input, \"hsl\");\n  return rgb2oklch(hsl2rgb(value), precision);\n}\n\n// src/converters/oklab2rgb.ts\nvar { abs } = Math;\nfunction lrgb2rgb(input) {\n  const absoluteNumber = abs(input);\n  const sign2 = input < 0 ? -1 : 1;\n  if (absoluteNumber > 31308e-7) {\n    return sign2 * (absoluteNumber ** (1 / 2.4) * 1.055 - 0.055);\n  }\n  return input * 12.92;\n}\nfunction oklab2rgb(input, precision = 0) {\n  const { l: L, a: A, b: B } = parseInput(input, \"oklab\");\n  const l = (L + LAB_TO_LMS.l[0] * A + LAB_TO_LMS.l[1] * B) ** 3;\n  const m = (L + LAB_TO_LMS.m[0] * A + LAB_TO_LMS.m[1] * B) ** 3;\n  const s = (L + LAB_TO_LMS.s[0] * A + LAB_TO_LMS.s[1] * B) ** 3;\n  const r = 255 * lrgb2rgb(LSM_TO_RGB.r[0] * l + LSM_TO_RGB.r[1] * m + LSM_TO_RGB.r[2] * s);\n  const g = 255 * lrgb2rgb(LSM_TO_RGB.g[0] * l + LSM_TO_RGB.g[1] * m + LSM_TO_RGB.g[2] * s);\n  const b = 255 * lrgb2rgb(LSM_TO_RGB.b[0] * l + LSM_TO_RGB.b[1] * m + LSM_TO_RGB.b[2] * s);\n  return {\n    r: clamp(round(r, precision), 0, 255),\n    g: clamp(round(g, precision), 0, 255),\n    b: clamp(round(b, precision), 0, 255)\n  };\n}\n\n// src/converters/oklab2hex.ts\nfunction oklab2hex(input) {\n  const value = parseInput(input, \"oklab\");\n  return rgb2hex(oklab2rgb(value));\n}\n\n// src/converters/oklab2hsl.ts\nfunction oklab2hsl(input) {\n  const value = parseInput(input, \"oklab\");\n  return rgb2hsl(oklab2rgb(value));\n}\n\n// src/converters/oklch2oklab.ts\nvar { sin, cos } = Math;\nfunction oklch2oklab(input, precision) {\n  let { l, c, h } = parseInput(input, \"oklch\");\n  if (Number.isNaN(h) || h < 0) {\n    h = 0;\n  }\n  return restrictValues({ l, a: c * cos(h * DEG2RAD), b: c * sin(h * DEG2RAD) }, precision);\n}\n\n// src/converters/oklch2rgb.ts\nfunction oklch2rgb(input, precision = 0) {\n  const value = parseInput(input, \"oklch\");\n  return oklab2rgb(oklch2oklab(value), precision);\n}\n\n// src/converters/oklch2hex.ts\nfunction oklch2hex(input) {\n  const value = parseInput(input, \"oklch\");\n  return rgb2hex(oklch2rgb(value));\n}\n\n// src/converters/oklch2hsl.ts\nfunction oklch2hsl(input) {\n  const value = parseInput(input, \"oklch\");\n  return rgb2hsl(oklch2rgb(value));\n}\n\n// src/extract-color-parts.ts\nfunction extractColorParts(input) {\n  invariant(isString(input), MESSAGES.inputString);\n  if (isHex(input)) {\n    const keys2 = COLOR_KEYS.rgb;\n    const { r, g, b } = hex2rgb(input);\n    const alpha2 = extractAlphaFromHex(input);\n    return {\n      model: \"rgb\",\n      [keys2[0]]: r,\n      [keys2[1]]: g,\n      [keys2[2]]: b,\n      alpha: alpha2 < 1 ? alpha2 : void 0\n    };\n  }\n  const colorRegex = /(?:(rgb|hsl|oklab|oklch)a?\\s*\\(\\s*([\\d%.-]+)\\s*[ ,/]\\s*([\\d%.-]+)\\s*[ ,/]\\s*([\\d%.-]+)(?:\\s*[ ,/]\\s*([\\d%.-]+))?\\s*\\))/i;\n  const matches = colorRegex.exec(input);\n  invariant(hasValidMatches(matches), MESSAGES.invalidCSS);\n  const model = matches[1];\n  const keys = COLOR_KEYS[model];\n  let alpha = matches[5] ? parseFloat(matches[5]) : 1;\n  if (alpha > 1) {\n    alpha /= 100;\n  }\n  return {\n    model,\n    [keys[0]]: parseFloat(matches[2]),\n    [keys[1]]: parseFloat(matches[3]),\n    [keys[2]]: parseFloat(matches[4]),\n    alpha: alpha < 1 ? alpha : void 0\n  };\n}\n\n// src/parse-css.ts\nfunction parseCSS(input, format) {\n  invariant(isString(input), MESSAGES.inputString);\n  let result;\n  const value = isNamedColor(input) ? cssColors[input.toLowerCase()] : input;\n  const output = format ?? (isHex(value) ? \"hex\" : extractColorParts(value).model);\n  const colorParams = (params) => Object.values(params);\n  if (isHex(value)) {\n    const alpha = extractAlphaFromHex(value);\n    switch (output) {\n      case \"hsl\": {\n        result = addAlpha(hex2hsl(value), alpha);\n        break;\n      }\n      case \"oklab\": {\n        result = addAlpha(hex2oklab(value), alpha);\n        break;\n      }\n      case \"oklch\": {\n        result = addAlpha(hex2oklch(value), alpha);\n        break;\n      }\n      case \"rgb\": {\n        result = addAlpha(hex2rgb(value), alpha);\n        break;\n      }\n      default: {\n        result = `${removeAlphaFromHex(value)}${alpha !== 1 ? convertAlphaToHex(alpha) : \"\"}`;\n        break;\n      }\n    }\n    return result;\n  }\n  switch (output) {\n    case \"hsl\": {\n      const { alpha, model, ...color } = extractColorParts(value);\n      if ([\"oklab\", \"oklch\"].includes(model) && color.l > 1) {\n        color.l = round(color.l / 100, PRECISION);\n      }\n      result = addAlpha(\n        model === \"hsl\" ? color : converters_exports[`${model}2hsl`](colorParams(color)),\n        alpha\n      );\n      break;\n    }\n    case \"oklab\": {\n      const { alpha, model, ...color } = extractColorParts(value);\n      if ([\"oklab\", \"oklch\"].includes(model) && color.l > 1) {\n        color.l = round(color.l / 100, PRECISION);\n      }\n      result = addAlpha(\n        model === \"oklab\" ? color : converters_exports[`${model}2oklab`](colorParams(color)),\n        alpha\n      );\n      break;\n    }\n    case \"oklch\": {\n      const { alpha, model, ...color } = extractColorParts(value);\n      if ([\"oklab\", \"oklch\"].includes(model) && color.l > 1) {\n        color.l = round(color.l / 100, PRECISION);\n      }\n      result = addAlpha(\n        model === \"oklch\" ? color : converters_exports[`${model}2oklch`](colorParams(color)),\n        alpha\n      );\n      break;\n    }\n    case \"rgb\": {\n      const { alpha, model, ...color } = extractColorParts(value);\n      if ([\"oklab\", \"oklch\"].includes(model) && color.l > 1) {\n        color.l /= 100;\n      }\n      result = addAlpha(\n        model === \"rgb\" ? color : converters_exports[`${model}2rgb`](colorParams(color)),\n        alpha\n      );\n      break;\n    }\n    case \"hex\":\n    default: {\n      const { alpha, model, ...color } = extractColorParts(value);\n      let alphaPrefix = \"\";\n      if ([\"oklab\", \"oklch\"].includes(model) && color.l > 1) {\n        color.l = round(color.l / 100, PRECISION);\n      }\n      if (alpha) {\n        alphaPrefix = convertAlphaToHex(alpha);\n      }\n      result = `${converters_exports[`${model}2hex`](colorParams(color))}${alphaPrefix}`;\n      break;\n    }\n  }\n  return result;\n}\n\n// src/modules/parse-color.ts\nfunction parseColor(color) {\n  invariant(!!color, MESSAGES.input);\n  const output = {};\n  if (isString(color)) {\n    const { alpha = 1 } = extractColorParts(color);\n    const type = isHex(color) ? \"hex\" : extractColorParts(color).model;\n    output.hex = addAlphaToHex(parseCSS(color, \"hex\"), alpha);\n    output.hsl = addAlpha(parseCSS(color, \"hsl\"), alpha);\n    output.oklab = addAlpha(parseCSS(color, \"oklab\"), alpha);\n    output.oklch = addAlpha(parseCSS(color, \"oklch\"), alpha);\n    output.rgb = addAlpha(parseCSS(color, \"rgb\"), alpha);\n    output.alpha = alpha;\n    output.type = type;\n  } else if (isPlainObject(color)) {\n    const { alpha = 1 } = color;\n    if (isHSL(color)) {\n      output.hsl = {\n        h: limit(color.h, \"hsl\", \"h\"),\n        s: limit(color.s, \"hsl\", \"s\"),\n        l: limit(color.l, \"hsl\", \"l\")\n      };\n      output.rgb = hsl2rgb(output.hsl);\n      output.oklab = hsl2oklab(output.hsl);\n      output.oklch = hsl2oklch(output.hsl);\n      output.type = \"hsl\";\n    } else if (isLAB(color)) {\n      output.hsl = oklab2hsl(color);\n      output.oklab = color;\n      output.oklch = oklab2oklch(color);\n      output.rgb = oklab2rgb(color);\n      output.type = \"oklab\";\n    } else if (isLCH(color)) {\n      output.hsl = oklch2hsl(color);\n      output.oklab = oklch2oklab(color);\n      output.oklch = color;\n      output.rgb = oklch2rgb(color);\n      output.type = \"oklch\";\n    } else if (isRGB(color)) {\n      output.rgb = {\n        r: limit(color.r, \"rgb\", \"r\"),\n        g: limit(color.g, \"rgb\", \"g\"),\n        b: limit(color.b, \"rgb\", \"b\")\n      };\n      output.hsl = rgb2hsl(output.rgb);\n      output.oklab = rgb2oklab(output.rgb);\n      output.oklch = rgb2oklch(output.rgb);\n      output.type = \"rgb\";\n    } else {\n      throw new Error(\"invalid color\");\n    }\n    output.hex = addAlphaToHex(hsl2hex(output.hsl), alpha);\n    output.hsl = addAlpha(output.hsl, alpha);\n    output.oklab = addAlpha(output.oklab, alpha);\n    output.oklch = addAlpha(output.oklch, alpha);\n    output.rgb = addAlpha(output.rgb, alpha);\n    output.alpha = alpha;\n  } else {\n    throw new Error(MESSAGES.input);\n  }\n  return output;\n}\n\n// src/brightness-difference.ts\nfunction brightnessDifference(left, right, precision = PRECISION) {\n  invariant(isString(left), MESSAGES.left);\n  invariant(isString(right), MESSAGES.right);\n  const RGBLeft = parseCSS(left, \"rgb\");\n  const RGBRight = parseCSS(right, \"rgb\");\n  const brightnessLeft = (RGBLeft.r * 299 + RGBLeft.g * 587 + RGBLeft.b * 114) / 1e3;\n  const brightnessRight = (RGBRight.r * 299 + RGBRight.g * 587 + RGBRight.b * 114) / 1e3;\n  return round(Math.abs(brightnessRight - brightnessLeft), precision);\n}\n\n// src/chroma.ts\nfunction chroma(input) {\n  invariant(isString(input), MESSAGES.inputString);\n  const { r, g, b } = parseCSS(input, \"rgb\");\n  const max = Math.max(r, g, b);\n  const min = Math.min(r, g, b);\n  return round((max - min) / 255, 4);\n}\n\n// src/color-difference.ts\nfunction colorDifference(left, right) {\n  invariant(isString(left), MESSAGES.left);\n  invariant(isString(right), MESSAGES.right);\n  const RGBLeft = parseCSS(left, \"rgb\");\n  const RGBRight = parseCSS(right, \"rgb\");\n  return Math.max(RGBLeft.r, RGBRight.r) - Math.min(RGBLeft.r, RGBRight.r) + (Math.max(RGBLeft.g, RGBRight.g) - Math.min(RGBLeft.g, RGBRight.g)) + (Math.max(RGBLeft.b, RGBRight.b) - Math.min(RGBLeft.b, RGBRight.b));\n}\n\n// src/luminance.ts\nfunction luminance(input) {\n  invariant(isString(input), MESSAGES.inputString);\n  const { r, g, b } = parseCSS(input, \"rgb\");\n  const rgb = [r / 255, g / 255, b / 255];\n  for (let index = 0; index < rgb.length; index++) {\n    if (rgb[index] <= 0.03928) {\n      rgb[index] /= 12.92;\n    } else {\n      rgb[index] = ((rgb[index] + 0.055) / 1.055) ** 2.4;\n    }\n  }\n  return round(0.2126 * rgb[0] + 0.7152 * rgb[1] + 0.0722 * rgb[2], 4);\n}\n\n// src/contrast.ts\nfunction contrast(left, right) {\n  invariant(isString(left), MESSAGES.left);\n  invariant(isString(right), MESSAGES.right);\n  const LuminanceLeft = luminance(left);\n  const LuminanceRight = luminance(right);\n  return round(\n    LuminanceLeft >= LuminanceRight ? (LuminanceLeft + 0.05) / (LuminanceRight + 0.05) : (LuminanceRight + 0.05) / (LuminanceLeft + 0.05)\n  );\n}\n\n// src/compare.ts\nfunction compare(left, right) {\n  invariant(isString(left), MESSAGES.left);\n  invariant(isString(right), MESSAGES.right);\n  const colorThreshold = 500;\n  const brightnessThreshold = 125;\n  const colorDifference2 = colorDifference(left, right);\n  const contrast2 = contrast(left, right);\n  const brightnessDifference2 = brightnessDifference(left, right);\n  const isBright = brightnessDifference2 >= brightnessThreshold;\n  const hasEnoughDifference = colorDifference2 >= colorThreshold;\n  let compliant = 0;\n  if (isBright && hasEnoughDifference) {\n    compliant = 2;\n  } else if (isBright || hasEnoughDifference) {\n    compliant = 1;\n  }\n  return {\n    brightnessDifference: brightnessDifference2,\n    colorDifference: colorDifference2,\n    compliant,\n    contrast: contrast2,\n    largeAA: contrast2 >= 3,\n    largeAAA: contrast2 >= 4.5,\n    normalAA: contrast2 >= 4.5,\n    normalAAA: contrast2 >= 7\n  };\n}\n\n// src/format-css.ts\nfunction getColorModel(input) {\n  if (isHex(input) || isNamedColor(input)) {\n    return \"hex\";\n  }\n  if (isString(input)) {\n    return extractColorParts(input).model;\n  } else if (isHSL(input)) {\n    return \"hsl\";\n  } else if (isLAB(input)) {\n    return \"oklab\";\n  } else if (isLCH(input)) {\n    return \"oklch\";\n  } else if (isRGB(input)) {\n    return \"rgb\";\n  }\n  throw new Error(MESSAGES.invalid);\n}\nfunction getColorValue(input, output) {\n  const value = isNamedColor(input) ? cssColors[input.toLowerCase()] : input;\n  const from = getColorModel(value);\n  if (from === output) {\n    return value;\n  }\n  const converterKey = `${from}2${output}`;\n  const converter = converters_exports[converterKey];\n  if (!converter) {\n    throw new Error(`Converter not found for ${from} to ${output}`);\n  }\n  switch (from) {\n    case \"hex\": {\n      if (output === \"hex\") {\n        return value;\n      }\n      return converter(value);\n    }\n    case \"hsl\": {\n      if (output === \"hsl\") {\n        return value;\n      }\n      return converter(value);\n    }\n    case \"oklab\": {\n      if (output === \"oklab\") {\n        return value;\n      }\n      return converter(value);\n    }\n    case \"oklch\": {\n      if (output === \"oklch\") {\n        return value;\n      }\n      return converter(value);\n    }\n    default: {\n      if (output === \"rgb\") {\n        return value;\n      }\n      return converter(value);\n    }\n  }\n}\nfunction formatCSS(input, options = {}) {\n  invariant(isHex(input) || isValidColorModel(input), MESSAGES.invalid);\n  const { alpha, format = \"hex\", precision = PRECISION, separator: baseSeparator = \" \" } = options;\n  const opacity2 = alpha && alpha !== 1 ? `${round(alpha * 100)}%` : null;\n  let params = [];\n  let separator = baseSeparator;\n  switch (format) {\n    case \"hsl\": {\n      const { h, s, l } = getColorValue(input, \"hsl\");\n      params = [h, `${s}%`, `${l}%`];\n      break;\n    }\n    case \"oklab\": {\n      separator = \" \";\n      const { l, a, b } = restrictValues(getColorValue(input, \"oklab\"), precision);\n      params = [`${round(l * 100, precision)}%`, a, b];\n      break;\n    }\n    case \"oklch\": {\n      separator = \" \";\n      const { l, c, h } = restrictValues(getColorValue(input, \"oklch\"), precision);\n      params = [`${round(l * 100, precision)}%`, c, h];\n      break;\n    }\n    case \"rgb\": {\n      const { r, g, b } = getColorValue(input, \"rgb\");\n      params = [r, g, b];\n      break;\n    }\n    default: {\n      const hex = removeAlphaFromHex(getColorValue(input, \"hex\"));\n      if (alpha && alpha !== 1) {\n        return `${hex}${convertAlphaToHex(alpha)}`;\n      }\n      return hex;\n    }\n  }\n  return `${format}(${params.join(separator)}${opacity2 ? ` / ${opacity2}` : \"\"})`;\n}\n\n// src/modules/updater.ts\nfunction updater(key, operator, format) {\n  return (input, amount) => {\n    invariant(isString(input), MESSAGES.inputString);\n    invariant(isNumber(amount), MESSAGES.alpha);\n    const color = parseCSS(input, \"hsl\");\n    const output = isHex(input) || isNamedColor(input) ? \"hex\" : extractColorParts(input).model;\n    return formatCSS(\n      {\n        ...color,\n        [key]: clamp(color[key] + (operator === \"+\" ? amount : -amount), 0, 100)\n      },\n      { format: format ?? output }\n    );\n  };\n}\n\n// src/darken.ts\nfunction darken(input, amount, format) {\n  return updater(\"l\", \"-\", format)(input, amount);\n}\n\n// src/desaturate.ts\nfunction desaturate(input, amount, format) {\n  return updater(\"s\", \"-\", format)(input, amount);\n}\n\n// src/rotate.ts\nfunction rotate(input, degrees, format) {\n  invariant(isString(input), MESSAGES.inputString);\n  invariant(isNumber(degrees), \"degrees must be a number\");\n  const color = parseCSS(input, \"hsl\");\n  const output = isHex(input) || isNamedColor(input) ? \"hex\" : extractColorParts(input).model;\n  return formatCSS(\n    {\n      ...color,\n      h: constrainDegrees(color.h, degrees)\n    },\n    { format: format ?? output }\n  );\n}\n\n// src/invert.ts\nfunction invert(input) {\n  invariant(isString(input), MESSAGES.inputString);\n  const format = isHex(input) || isNamedColor(input) ? \"hex\" : extractColorParts(input).model;\n  const hex = parseCSS(input, \"hex\");\n  return formatCSS(rotate(hex, 180), { format });\n}\n\n// src/lighten.ts\nfunction lighten(input, amount, format) {\n  return updater(\"l\", \"+\", format)(input, amount);\n}\n\n// src/opacify.ts\nfunction opacify(input, alpha, format) {\n  invariant(isString(input), MESSAGES.inputString);\n  invariant(isNumber(alpha), MESSAGES.alpha);\n  const type = isHex(input) || isNamedColor(input) ? \"hex\" : extractColorParts(input).model;\n  const rgb = parseCSS(input, \"rgb\");\n  return formatCSS(rgb, { format: format ?? type, alpha });\n}\n\n// src/opacity.ts\nfunction opacity(input) {\n  invariant(isString(input), MESSAGES.inputString);\n  if (isHex(input)) {\n    return extractAlphaFromHex(input);\n  } else if (Object.keys(cssColors).includes(input)) {\n    return 1;\n  }\n  const { alpha } = extractColorParts(input);\n  if (!alpha) {\n    return 1;\n  }\n  return alpha;\n}\n\n// src/saturate.ts\nfunction saturate(input, amount, format) {\n  return updater(\"s\", \"+\", format)(input, amount);\n}\n\n// src/text-color.ts\nfunction textColor(input, options = {}) {\n  const { darkColor = \"#000000\", lightColor = \"#ffffff\", threshold = 128 } = options;\n  invariant(isString(input), MESSAGES.inputString);\n  invariant(threshold >= 0 && threshold <= 255, MESSAGES.threshold);\n  try {\n    const { r, g, b } = hex2rgb(parseCSS(input, \"hex\"));\n    const yiq = (r * 299 + g * 587 + b * 114) / 1e3;\n    return yiq >= threshold ? darkColor : lightColor;\n  } catch (error) {\n    console.warn(`Invalid color input: ${input}`);\n    console.warn(error);\n    return darkColor;\n  }\n}\n\n// src/transparentize.ts\nfunction transparentize(input, alpha, format) {\n  invariant(isString(input), MESSAGES.inputString);\n  invariant(isNumber(alpha), MESSAGES.alpha);\n  invariant(alpha >= -1 && alpha <= 1, MESSAGES.alpha);\n  const oklch = parseCSS(input, \"oklab\");\n  const value = round(clamp(opacity(input) - alpha, 0, 1));\n  return formatCSS(oklch, { format, alpha: value });\n}\n\n// src/colorizr.ts\nvar Colorizr = class {\n  constructor(color, options = {}) {\n    __publicField(this, \"alpha\");\n    __publicField(this, \"hex\");\n    __publicField(this, \"hsl\");\n    __publicField(this, \"oklab\");\n    __publicField(this, \"oklch\");\n    __publicField(this, \"rgb\");\n    __publicField(this, \"type\");\n    invariant(!!color, \"color is required\");\n    const { alpha, hex, hsl, oklab, oklch, rgb, type } = parseColor(color);\n    this.hex = hex;\n    this.hsl = hsl;\n    this.oklab = oklab;\n    this.oklch = oklch;\n    this.rgb = rgb;\n    this.alpha = alpha;\n    this.type = options.format ?? type;\n  }\n  /**\n   * Get css string\n   */\n  get css() {\n    return this.selectedColor;\n  }\n  /**\n   * Get the red value\n   */\n  get red() {\n    return Number(this.rgb.r);\n  }\n  /**\n   * Get the green value\n   */\n  get green() {\n    return Number(this.rgb.g);\n  }\n  /**\n   * Get the blue value\n   */\n  get blue() {\n    return Number(this.rgb.b);\n  }\n  /**\n   * Get the hue value\n   */\n  get hue() {\n    return Number(this.hsl.h);\n  }\n  /**\n   * Get the saturation value\n   */\n  get saturation() {\n    return Number(this.hsl.s);\n  }\n  /**\n   * Get the lightness value\n   */\n  get lightness() {\n    return Number(this.hsl.l);\n  }\n  /**\n   * Get the luminance value\n   */\n  get luminance() {\n    return luminance(this.selectedColor);\n  }\n  /**\n   * Get the chroma value\n   */\n  get chroma() {\n    return chroma(this.selectedColor);\n  }\n  get opacity() {\n    return opacity(this.selectedColor);\n  }\n  /**\n   * Get the contrasted color\n   */\n  get textColor() {\n    return textColor(this.selectedColor);\n  }\n  get selectedColor() {\n    return formatCSS(this[this.type], { format: this.type, alpha: this.alpha });\n  }\n  brightnessDifference(input) {\n    return brightnessDifference(this.selectedColor, input);\n  }\n  colorDifference(input) {\n    return colorDifference(this.selectedColor, input);\n  }\n  /**\n   * Test 2 colors for compliance\n   */\n  compare(input) {\n    return compare(this.selectedColor, input);\n  }\n  contrast(input) {\n    return contrast(this.selectedColor, input);\n  }\n  format(type, precision) {\n    return formatCSS(this.rgb, {\n      alpha: this.alpha,\n      format: type,\n      precision\n    });\n  }\n  /**\n   * Increase lightness\n   */\n  lighten(amount) {\n    return lighten(this.selectedColor, amount);\n  }\n  /**\n   * Decrease lightness\n   */\n  darken(amount) {\n    return darken(this.selectedColor, amount);\n  }\n  /**\n   * Increase saturation\n   */\n  saturate(amount) {\n    return saturate(this.selectedColor, amount);\n  }\n  /**\n   * Decrease saturation\n   */\n  desaturate(amount) {\n    return desaturate(this.selectedColor, amount);\n  }\n  /**\n   * Invert color\n   */\n  invert() {\n    return invert(this.selectedColor);\n  }\n  /**\n   * Add opacity to the color.\n   */\n  opacify(alpha = 0.9) {\n    return opacify(this.selectedColor, alpha, this.type);\n  }\n  /**\n   * Rotate color\n   */\n  rotate(degrees) {\n    return rotate(this.selectedColor, degrees);\n  }\n  /**\n   * Make the color more transparent\n   */\n  transparentize(alpha = 0.1) {\n    return transparentize(this.selectedColor, alpha, this.type);\n  }\n};\n\n// src/convert.ts\nfunction convert(input, format) {\n  const value = parseCSS(input, format);\n  return formatCSS(value, { format });\n}\n\n// src/is-valid-color.ts\nfunction isValidColor(input) {\n  try {\n    parseCSS(input);\n    return true;\n  } catch {\n    return false;\n  }\n}\n\n// src/name.ts\nfunction name(input) {\n  invariant(isString(input), MESSAGES.inputString);\n  const hex = parseCSS(input, \"hex\");\n  const [color] = Object.entries(cssColors).find(([, value]) => value === hex) || [];\n  return color ?? hex;\n}\n\n// src/palette.ts\nfunction palette(input, options = {}) {\n  invariant(isString(input), MESSAGES.inputString);\n  invariant(isPlainObject(options), MESSAGES.options);\n  const { format, lightness, saturation, size = 6, type } = options;\n  const hsl = parseCSS(input, \"hsl\");\n  const colorFormat = isHex(input) || isNamedColor(input) ? \"hex\" : extractColorParts(input).model;\n  const output = [];\n  if (type === \"monochromatic\") {\n    const step = 80 / size;\n    for (let index = size; index > 0; index--) {\n      output.push(hsl2hex({ ...hsl, l: step * index }));\n    }\n  } else {\n    const step = 360 / size;\n    output.push(hsl2hex({ ...hsl, l: lightness ?? hsl.l, s: saturation ?? hsl.s }));\n    for (let index = 1; index < size; index++) {\n      const color = rotate(input, hsl.h + step * index, \"hex\");\n      output.push(hsl2hex({ ...hex2hsl(color), l: lightness ?? hsl.l, s: saturation ?? hsl.s }));\n    }\n  }\n  return output.map((color) => convert(color, format ?? colorFormat));\n}\n\n// src/p3.ts\nfunction multiplyMatrix(matrix, vector) {\n  return [\n    matrix[0][0] * vector[0] + matrix[0][1] * vector[1] + matrix[0][2] * vector[2],\n    matrix[1][0] * vector[0] + matrix[1][1] * vector[1] + matrix[1][2] * vector[2],\n    matrix[2][0] * vector[0] + matrix[2][1] * vector[1] + matrix[2][2] * vector[2]\n  ];\n}\nfunction isInP3Gamut(color) {\n  const epsilon = 1e-6;\n  return color.every((component) => component >= 0 - epsilon && component <= 1 + epsilon);\n}\nfunction oklabToLinearSRGB(L, a, b) {\n  const l = (L + LAB_TO_LMS.l[0] * a + LAB_TO_LMS.l[1] * b) ** 3;\n  const m = (L + LAB_TO_LMS.m[0] * a + LAB_TO_LMS.m[1] * b) ** 3;\n  const s = (L + LAB_TO_LMS.s[0] * a + LAB_TO_LMS.s[1] * b) ** 3;\n  return [\n    LSM_TO_RGB.r[0] * l + LSM_TO_RGB.r[1] * m + LSM_TO_RGB.r[2] * s,\n    LSM_TO_RGB.g[0] * l + LSM_TO_RGB.g[1] * m + LSM_TO_RGB.g[2] * s,\n    LSM_TO_RGB.b[0] * l + LSM_TO_RGB.b[1] * m + LSM_TO_RGB.b[2] * s\n  ];\n}\nfunction oklabToLinearP3(L, a, b) {\n  const srgb = oklabToLinearSRGB(L, a, b);\n  return multiplyMatrix(SRGB_TO_P3, srgb);\n}\nfunction getOkLCHMaxChroma(input, precision = PRECISION) {\n  const { l, h } = isString(input) ? parseCSS(input, \"oklch\") : input;\n  invariant(isNumber(l) && l >= 0 && l <= 1, MESSAGES.lightnessRange);\n  invariant(isNumber(h) && h >= 0 && h <= 360, MESSAGES.hueRange);\n  const epsilon = 1e-6;\n  let low = 0;\n  let high = 0.5;\n  while (high - low > epsilon) {\n    const mid = (low + high) / 2;\n    const { l: L, a, b } = oklch2oklab({ l, c: mid, h }, 16);\n    const p3Color = oklabToLinearP3(L, a, b);\n    if (isInP3Gamut(p3Color)) {\n      low = mid;\n    } else {\n      high = mid;\n    }\n  }\n  return round(low, precision);\n}\nfunction getP3Color(input) {\n  const lch = isString(input) ? parseCSS(input, \"oklch\") : input;\n  return `oklch(${lch.l} ${getOkLCHMaxChroma(lch)} ${lch.h})`;\n}\n\n// src/random.ts\nfunction random(type = \"hex\") {\n  const hsl = {\n    h: Math.floor(Math.random() * 360) + 1,\n    s: Math.floor(Math.random() * 90) + 10,\n    l: Math.floor(Math.random() * 80) + 10\n  };\n  return formatCSS(hsl, { format: type });\n}\n\n// src/scheme.ts\nfunction scheme(input, typeOrOptions) {\n  invariant(isString(input), MESSAGES.inputString);\n  const { format, type = \"complementary\" } = isString(typeOrOptions) ? { type: typeOrOptions } : typeOrOptions ?? {};\n  const output = isHex(input) || isNamedColor(input) ? \"hex\" : extractColorParts(input).model;\n  const colors = [];\n  switch (type) {\n    case \"analogous\": {\n      colors.push(rotate(input, -30), input, rotate(input, 30));\n      break;\n    }\n    case \"complementary\": {\n      colors.push(input, rotate(input, 180));\n      break;\n    }\n    case \"split\":\n    case \"split-complementary\": {\n      colors.push(input, rotate(input, 150), rotate(input, 210));\n      break;\n    }\n    case \"triadic\": {\n      colors.push(input, rotate(input, 120), rotate(input, 240));\n      break;\n    }\n    case \"tetradic\":\n    case \"rectangle\": {\n      colors.push(input, rotate(input, 60), rotate(input, 180), rotate(input, 240));\n      break;\n    }\n    case \"square\": {\n      colors.push(input, rotate(input, 90), rotate(input, 180), rotate(input, 270));\n      break;\n    }\n    default: {\n      throw new TypeError(\"invalid type\");\n    }\n  }\n  return colors.map((color) => convert(color, format ?? output));\n}\n\n// src/swatch.ts\nfunction shadeColor(input, lightness) {\n  const { c, h } = input;\n  const chromaScale = c === 0 ? 1 : 4 * lightness * (1 - lightness);\n  const chroma2 = c * chromaScale;\n  const adjustedChroma = clamp(chroma2, 0, 0.4);\n  return { l: lightness, c: adjustedChroma, h };\n}\nfunction swatch(input, options = {}) {\n  invariant(isString(input), MESSAGES.inputString);\n  const {\n    format,\n    lightnessFactor = 1.5,\n    maxLightness = 0.97,\n    minLightness = 0.2,\n    scale = \"dynamic\",\n    variant = \"base\"\n  } = options;\n  invariant(\n    maxLightness > minLightness && maxLightness <= 1 && minLightness >= 0,\n    \"maxLightness must be greater than minLightness and within the range [0, 1].\"\n  );\n  const lch = parseCSS(input, \"oklch\");\n  const chromaScale = {\n    base: 1,\n    deep: 0.8,\n    neutral: 0.5,\n    pastel: 0.3,\n    subtle: 0.2,\n    vibrant: 1.25\n  }[variant];\n  lch.l = 0.7;\n  lch.c *= chromaScale;\n  if (variant === \"deep\") {\n    lch.l *= 0.7;\n  }\n  const colorFormat = isHex(input) || isNamedColor(input) ? \"hex\" : extractColorParts(input).model;\n  const steps = 11;\n  let palette2 = {};\n  if (scale === \"dynamic\") {\n    for (let index = 0; index < steps; index++) {\n      const lightness = maxLightness - (maxLightness - minLightness) * (index / (steps - 1)) ** lightnessFactor;\n      let tone = index * 100;\n      if (index === 0) {\n        tone = 50;\n      } else if (index === 10) {\n        tone = 950;\n      }\n      palette2[tone] = lightness;\n    }\n  } else {\n    palette2 = {\n      50: 0.97,\n      100: 0.92,\n      200: 0.85,\n      300: 0.78,\n      400: 0.69,\n      500: 0.57,\n      600: 0.46,\n      700: 0.35,\n      800: 0.24,\n      900: 0.18,\n      950: 0.1\n    };\n  }\n  const output = Object.entries(palette2).reduce(\n    (acc, [key, value]) => {\n      acc[Number(key)] = shadeColor(lch, value);\n      return acc;\n    },\n    {}\n  );\n  return Object.entries(output).reduce((acc, [key, value]) => {\n    return {\n      ...acc,\n      [key]: formatCSS(value, { format: format ?? colorFormat })\n    };\n  }, {});\n}\n\n// src/index.ts\nvar index_default = Colorizr;\nexport {\n  addAlphaToHex,\n  brightnessDifference,\n  chroma,\n  colorDifference,\n  compare,\n  contrast,\n  convert,\n  convertAlphaToHex,\n  darken,\n  index_default as default,\n  desaturate,\n  extractAlphaFromHex,\n  extractColorParts,\n  formatCSS,\n  formatHex,\n  getOkLCHMaxChroma,\n  getP3Color,\n  hex2hsl,\n  hex2oklab,\n  hex2oklch,\n  hex2rgb,\n  hexadecimalToNumber,\n  hsl2hex,\n  hsl2oklab,\n  hsl2oklch,\n  hsl2rgb,\n  isHSL,\n  isHex,\n  isLAB,\n  isLCH,\n  isRGB,\n  isValidColor,\n  lighten,\n  luminance,\n  name,\n  oklab2hex,\n  oklab2hsl,\n  oklab2oklch,\n  oklab2rgb,\n  oklch2hex,\n  oklch2hsl,\n  oklch2oklab,\n  oklch2rgb,\n  opacify,\n  opacity,\n  palette,\n  parseCSS,\n  random,\n  removeAlphaFromHex,\n  rgb2hex,\n  rgb2hsl,\n  rgb2oklab,\n  rgb2oklch,\n  rotate,\n  saturate,\n  scheme,\n  swatch,\n  textColor,\n  transparentize\n};\n//# sourceMappingURL=index.mjs.map","export const isHsl = (v) => {\n    if (typeof v !== `object`)\n        return false;\n    if (!(`h` in v))\n        return false;\n    if (!(`s` in v))\n        return false;\n    if (!(`l` in v))\n        return false;\n    if (!(`unit` in v))\n        return false;\n    if (!(`space` in v))\n        return false;\n    if (v.space !== `hsl`)\n        return false;\n    return true;\n};\nexport const isRgb = (v) => {\n    if (typeof v !== `object`)\n        return false;\n    if (!(`r` in v))\n        return false;\n    if (!(`g` in v))\n        return false;\n    if (!(`b` in v))\n        return false;\n    if (!(`space` in v))\n        return false;\n    if (!(`unit` in v))\n        return false;\n    if (v.space === `srgb`)\n        return true;\n    return false;\n};\n/**\n * If the input object has r,g&b properties, it will return a fully-\n * formed Rgb type with `unit` and `space` properties.\n *\n * If it lacks these basic three properties or they are out of range,\n *  _undefined_ is returned.\n *\n * If RGB values are less than 1 assumes unit:scalar. Otherwise unit:8bit.\n * If RGB values exceed 255, _undefined_ returned.\n * @param v\n * @returns\n */\nexport const tryParseObjectToRgb = (v) => {\n    if (typeof v !== `object`)\n        throw new TypeError(`Param 'v' is expected to be an object, got: ${typeof v}`);\n    if (!(`r` in v && `g` in v && `b` in v))\n        return;\n    if (!(`unit` in v)) {\n        if (v.r <= 1 && v.g <= 1 && v.b <= 1) {\n            v.unit = `scalar`;\n        }\n        else if (v.r > 255 && v.g <= 255 && v.b <= 255) {\n            return; // out of range\n        }\n        else {\n            v.unit = `8bit`;\n        }\n    }\n    if (!(`space` in v)) {\n        v.space = `srgb`;\n    }\n    return v;\n};\nexport const tryParseObjectToHsl = (v) => {\n    if (!(`h` in v && `s` in v && `l` in v))\n        return;\n    if (!(`unit` in v)) {\n        if (v.r <= 1 && v.g <= 1 && v.b <= 1) {\n            v.unit = `scalar`;\n        }\n        else if (v.s > 100 && v.l <= 100) {\n            return; // out of range\n        }\n        else {\n            v.unit = `absolute`;\n        }\n    }\n    if (!(`space` in v)) {\n        v.space = `hsl`;\n    }\n    return v;\n};\nexport const isOkLch = (v) => {\n    if (typeof v !== `object`)\n        return false;\n    if (!(`l` in v))\n        return false;\n    if (!(`c` in v))\n        return false;\n    if (!(`h` in v))\n        return false;\n    if (!(`unit` in v))\n        return false;\n    if (!(`space` in v))\n        return false;\n    if (v.space === `lch`)\n        return true;\n    if (v.space === `oklch`)\n        return true;\n    return false;\n};\nexport const isColourish = (v) => {\n    if (typeof v === `string`)\n        return true;\n    if (typeof v !== `object`)\n        return false;\n    if (isHsl(v))\n        return true;\n    if (isOkLch(v))\n        return true;\n    if (isRgb(v))\n        return true;\n    return false;\n};\n","export function calculateHueDistance(a, b, limit = 1) {\n    let long = -1;\n    let short = -1;\n    if (b < a) {\n        long = (b - a);\n        short = limit - (a - b);\n    }\n    else {\n        long = (b - a);\n        short = (long) - limit;\n    }\n    const forward = short > 0 ? short : long;\n    const backward = short > 0 ? long : short;\n    if (Math.abs(long) < Math.abs(short)) {\n        const t = short;\n        short = long;\n        long = t;\n    }\n    return { long, short, forward, backward };\n}\nexport const libraryRgbToHexString = (rgb) => {\n    const componentToHex = (c) => {\n        const hex = Math.floor(c).toString(16);\n        return hex.length == 1 ? \"0\" + hex : hex;\n    };\n    let part = `#${componentToHex(rgb.r)}${componentToHex(rgb.g)}${componentToHex(rgb.b)}`;\n    if (typeof rgb.alpha !== `undefined` && rgb.alpha !== 255) {\n        part += componentToHex(rgb.alpha);\n    }\n    return part;\n};\nexport function wrapScalarHue(value) {\n    value = value % 1;\n    if (value < 0)\n        return (1 - Math.abs(value)) % 1;\n    return value;\n}\n// export function cssAngleFormat(value:string) {\n//   let start = value.indexOf(`)`);\n//   let end = value.lastIndexOf(')');\n//   if (start < 0) return value;\n//   if (end < start) return value;\n// }\n","import Colorizr, * as C from \"colorizr\";\nimport { numberInclusiveRangeTest, numberTest, percentTest } from \"@ixfx/guards\";\nimport { resultThrow } from \"@ixfx/guards\";\nimport { cssDefinedHexColours, resolveCss } from \"./css-colours.js\";\nimport { angleConvert, angleParse } from \"@ixfx/geometry\";\nimport { clamp, interpolate } from \"@ixfx/numbers\";\nimport { isRgb } from \"./guards.js\";\nimport { calculateHueDistance, libraryRgbToHexString, wrapScalarHue } from \"./utility.js\";\nimport { parseCssRgbFunction, to8bit as rgbTo8bit, toLibraryHsl as rgbToLibraryHsl } from \"./srgb.js\";\n/**\n * Scales the opacity value of an input HSL value\n * ```js\n * withOpacity()\n * ```\n * @param value Colour\n * @param fn Function that calcules opacity based on input scalar value\n * @returns\n */\nexport const withOpacity = (value, fn) => {\n    switch (value.unit) {\n        case `absolute`:\n            return {\n                ...value,\n                opacity: fn((value.opacity ?? 100) / 100, value) * 100\n            };\n        case `scalar`:\n            return {\n                ...value,\n                opacity: fn((value.opacity ?? 1), value)\n            };\n    }\n};\n/**\n * Increases or decreases lightness by this percentage, returning new colour\n *\n * Amount to change:\n * * 'fixed': a fixed amount\n * * 'delta': increase/decrease by this amount\n * * 'pdelta': proportion of current value to change by ('percentage delta')\n *\n * ```\n * const colour = { h: 0.5, s: 0.5, l: 0.5, space: `hsl`, unit: `scalar` };\n * changeLightness(colour, { pdelta: 0.1 }); // l: 0.55\n * changeLightness(colour, { delta: 0.1 });  // l: 0.6\n * changeLightness(colour, { fixed: 0.5 });  // l: 0.5\n * ```\n *\n * Keep in mind the numerical value will depend on the unit of `value`. If it's scalar,\n * lightness is 0..1 scale, otherwise 0..100 scale.\n *\n * Use negative values to decrease (does not apply to 'fixed')\n * @param value Hsl colour\n * @param amount Amount to change\n */\nexport const changeLightness = (value, amount) => {\n    let newL = 0;\n    if (typeof amount.pdelta !== `undefined`) {\n        newL = value.l + (value.l * amount.pdelta);\n    }\n    else if (typeof amount.delta !== `undefined`) {\n        newL = amount.delta + value.l;\n    }\n    else if (typeof amount.fixed !== `undefined`) {\n        if (amount.fixed < 0)\n            throw new TypeError(`Cannot use negative value with 'fixed'`);\n        newL = amount.fixed;\n    }\n    else {\n        throw new TypeError(`Parameter 'amount' is missing 'delta/pdelta/fixed' properties`);\n    }\n    return {\n        ...value,\n        l: scaleProperty(value, newL, `l`)\n    };\n};\nconst scaleProperty = (hsl, value, property) => {\n    if (hsl.unit === `scalar`) {\n        // 0..1 scale\n        if (value > 1)\n            value = 1;\n        else if (value < 0)\n            value = 0;\n    }\n    else {\n        // 0..100 scale\n        if (value > 100)\n            value = 100;\n        else if (value < 0)\n            value = 0;\n    }\n    return value;\n};\nconst hslTransparent = Object.freeze({\n    h: 0, s: 0, l: 0, opacity: 0, unit: `absolute`, space: `hsl`\n});\nexport function fromHexString(hexString, options = {}) {\n    return fromLibrary(C.hex2hsl(hexString), options);\n}\nexport function fromCss(value, options = {}) {\n    value = value.toLowerCase();\n    if (value.startsWith(`hsla(`))\n        throw new Error(`hsla() not supported`);\n    if (value.startsWith(`rgba(`))\n        throw new Error(`rgba() not supported`);\n    if (value.startsWith(`#`)) {\n        return fromHexString(value, options);\n    }\n    if (value.startsWith(`--`)) {\n        try {\n            value = resolveCss(value);\n        }\n        catch (error) {\n            if (typeof options.fallbackString !== `undefined`)\n                value = options.fallbackString;\n            if (typeof options.fallbackColour !== `undefined`)\n                return options.fallbackColour;\n            throw error;\n        }\n    }\n    if (value === `transparent`)\n        return hslTransparent;\n    if (typeof cssDefinedHexColours[value] !== `undefined`) {\n        return fromHexString(cssDefinedHexColours[value], options);\n    }\n    if (value.startsWith(`rgb(`)) {\n        const hsl = rgbToLibraryHsl(value);\n        return fromLibrary(hsl, options);\n    }\n    if (!value.startsWith(`hsl(`)) {\n        try {\n            value = C.convert(value, `hsl`);\n        }\n        catch (error) {\n            if (options.fallbackString) {\n                value = options.fallbackString;\n            }\n            else {\n                throw error;\n            }\n        }\n    }\n    try {\n        // Hand-rolled hsl() parse because the package is broken\n        const hsl = parseCssHslFunction(value);\n        if (options.scalar)\n            return toScalar(hsl);\n        return toAbsolute(hsl);\n    }\n    catch (error) {\n        if (options.fallbackColour)\n            return options.fallbackColour;\n        throw error;\n    }\n}\nexport const toCssString = (hsl) => {\n    const abs = toAbsolute(hsl);\n    let css = `hsl(${abs.h}deg ${abs.s}% ${abs.l}%`;\n    if (`opacity` in abs && abs.opacity !== undefined && abs.opacity < 100) {\n        css += ` / ${abs.opacity}%`;\n    }\n    css += ')';\n    return css;\n};\nexport const toHexString = (hsl) => {\n    const rgb = toLibraryRgb(hsl);\n    return libraryRgbToHexString(rgb);\n};\nconst toLibrary = (hsl) => {\n    const abs = toAbsolute(hsl);\n    return {\n        h: abs.h,\n        s: abs.s,\n        l: abs.l,\n        alpha: abs.opacity,\n    };\n};\nfunction fromLibrary(hsl, parsingOptions = {}) {\n    if (typeof hsl === `undefined` || hsl === null) {\n        if (parsingOptions.fallbackColour)\n            return parsingOptions.fallbackColour;\n    }\n    const scalarOpt = parsingOptions.scalar ?? true;\n    // Library result is absolute\n    resultThrow(numberInclusiveRangeTest(hsl.h, 0, 360, `h`), numberInclusiveRangeTest(hsl.s, 0, 100, `s`), numberInclusiveRangeTest(hsl.l, 0, 100, `l`), percentTest((hsl.alpha ?? 1), `alpha`)\n    // () => hsl.alpha !== undefined ? numberInclusiveRangeTest(hsl.alpha, 0, 100, `alpha`) : { success: true, value: hsl },\n    );\n    if (scalarOpt) {\n        return scalar(hsl.h / 360, hsl.s / 100, hsl.l / 100, (hsl.alpha ?? 1));\n    }\n    else {\n        return absolute(hsl.h, hsl.s, hsl.l, (hsl.alpha ?? 1) * 100);\n    }\n}\nexport const toAbsolute = (hslOrString) => {\n    // if (typeof hslOrString === `string`) {\n    //   return toAbsolute(fromLibrary(C.parseCSS(hslOrString, `hsl`), { scalar: false }));\n    // }\n    if (typeof hslOrString === `string`) {\n        return fromCss(hslOrString, { scalar: false });\n        // try {\n        //   return toScalar(fromLibrary(C.parseCSS(hslOrString, `hsl`), { scalar: true }));\n        // } catch (error) {\n        //   console.error(`Hsl.toScalar: ${ hslOrString }`);\n        //   throw error;\n        // }\n    }\n    if (isRgb(hslOrString)) {\n        return toAbsolute(fromLibrary(rgbToLibraryHsl(hslOrString), { scalar: false }));\n    }\n    const hsl = hslOrString;\n    guard(hsl);\n    if (hsl.unit === `absolute`)\n        return hsl;\n    return {\n        h: hsl.h * 360,\n        s: hsl.s * 100,\n        l: hsl.l * 100,\n        opacity: (hsl.opacity ?? 1) * 100,\n        unit: `absolute`,\n        space: `hsl`\n    };\n};\n/**\n * Generates a {@link HslScalar} value.\n *\n * ```js\n * generateScaler(10); // 10deg, default to full saturation, half lightness and full opacity\n *\n * // Generate HSL value from radian angle and 50% saturation\n * generateScalar(`10rad`, 0.5);\n *\n * // Generate from numeric CSS variable\n * generateScalar(`--hue`);\n * ```\n * @param absoluteHslOrVariable Hue angle or CSS variable\n * @param saturation\n * @param lightness\n * @param opacity\n */\nexport const generateScalar = (absoluteHslOrVariable, saturation = 1, lightness = 0.5, opacity = 1) => {\n    if (typeof absoluteHslOrVariable === `string`) {\n        if (absoluteHslOrVariable.startsWith(`--`)) {\n            absoluteHslOrVariable = getComputedStyle(document.body).getPropertyValue(absoluteHslOrVariable).trim();\n        }\n    }\n    const hue = angleParse(absoluteHslOrVariable);\n    if (saturation > 1)\n        throw new TypeError(`Param 'saturation' must be between 0..1`);\n    if (lightness > 1)\n        throw new TypeError(`Param 'lightness' must be between 0..1`);\n    if (opacity > 1)\n        throw new TypeError(`Param 'opacity' must be between 0..1`);\n    const hueDeg = angleConvert(hue, `deg`).value / 360;\n    return {\n        h: hueDeg,\n        s: saturation,\n        l: lightness,\n        opacity: opacity,\n        unit: `scalar`,\n        space: `hsl`\n    };\n};\n/**\n * Converts a {@link Hsl} value to scalar units, or parses a colour string\n * and converts it.\n *\n * ```js\n * toScalar({ h: 100, s: 50, l: 100, unit: `absolute` });\n * toScalar(`red`);\n * ```\n * @param hslOrString\n * @returns\n */\nexport const toScalar = (hslOrString) => {\n    if (typeof hslOrString === `string`) {\n        return fromCss(hslOrString, { scalar: true });\n        // try {\n        //   return toScalar(fromLibrary(C.parseCSS(hslOrString, `hsl`), { scalar: true }));\n        // } catch (error) {\n        //   console.error(`Hsl.toScalar: ${ hslOrString }`);\n        //   throw error;\n        // }\n    }\n    if (isRgb(hslOrString)) {\n        return toScalar(fromLibrary(rgbToLibraryHsl(hslOrString), { scalar: true }));\n    }\n    const hsl = hslOrString;\n    guard(hsl);\n    if (hsl.unit === `scalar`)\n        return hsl;\n    return {\n        h: hsl.h / 360,\n        s: hsl.s / 100,\n        l: hsl.l / 100,\n        opacity: (hsl.opacity ?? 1) / 100,\n        unit: `scalar`,\n        space: `hsl`\n    };\n};\nexport const guard = (hsl) => {\n    const { h, s, l, opacity, space, unit } = hsl;\n    if (space !== `hsl`)\n        throw new Error(`Space is expected to be 'hsl'. Got: ${space}`);\n    if (unit === `absolute`) {\n        resultThrow(numberTest(h, `finite`, `h`), numberInclusiveRangeTest(s, 0, 100, `s`), numberInclusiveRangeTest(l, 0, 100, `l`), () => {\n            if (typeof opacity === `number`) {\n                return numberInclusiveRangeTest(opacity, 0, 100, `opacity`);\n            }\n        });\n    }\n    else if (unit === `scalar`) {\n        resultThrow(numberTest(h, `percentage`, `h`), numberTest(s, `percentage`, `s`), numberTest(l, `percentage`, `l`), () => {\n            if (typeof opacity === `number`) {\n                return numberTest(opacity, `percentage`, `opacity`);\n            }\n        });\n    }\n    else {\n        throw new Error(`Unit is expected to be 'absolute' or 'scalar'. Got: ${unit}`);\n    }\n};\nexport const interpolator = (a, b, direction = `shorter`) => {\n    a = toScalar(a);\n    b = toScalar(b);\n    const aOpacity = a.opacity ?? 1;\n    const distanceCalc = calculateHueDistance(a.h, b.h, 1);\n    const hueDistance = direction === `longer` ? distanceCalc.long : distanceCalc.short;\n    const satDistance = b.s - a.s;\n    const lightDistance = b.l - a.l;\n    const opacityDistance = (b.opacity ?? 1) - aOpacity;\n    return (amount) => {\n        amount = clamp(amount);\n        let h = interpolate(amount, 0, Math.abs(hueDistance));\n        if (hueDistance < 0)\n            h = a.h - h;\n        else\n            h = a.h + h;\n        const s = interpolate(amount, 0, satDistance);\n        const l = interpolate(amount, 0, lightDistance);\n        const o = interpolate(amount, 0, opacityDistance);\n        return scalar(wrapScalarHue(h), s + a.s, l + a.l, o + aOpacity);\n    };\n};\n/**\n * Creates a HslScalar value from scalar (0..1) values\n * @param hue\n * @param sat\n * @param lightness\n * @param opacity\n * @returns\n */\nexport function scalar(hue = 0.5, sat = 1, lightness = 0.5, opacity = 1) {\n    const hsl = {\n        unit: `scalar`,\n        space: `hsl`,\n        h: hue,\n        s: sat,\n        l: lightness,\n        opacity: opacity\n    };\n    guard(hsl);\n    return hsl;\n}\nexport function absolute(hue = 200, sat = 100, lightness = 50, opacity = 100) {\n    const hsl = {\n        unit: `absolute`,\n        space: `hsl`,\n        h: hue,\n        s: sat,\n        l: lightness,\n        opacity: opacity\n    };\n    guard(hsl);\n    return hsl;\n}\n/**\n * It seems Colorizr can't handle 'deg' units\n * @param value\n */\nexport function parseCssHslFunction(value) {\n    if (value.startsWith(`hsla`))\n        throw new Error(`hsla() is not supported`);\n    if (!value.startsWith(`hsl(`))\n        throw new Error(`Expected hsl(..) CSS colour`);\n    const start = value.indexOf('(');\n    const end = value.indexOf(')');\n    if (end < start)\n        throw new Error(`Is hsl() not terminated? Missing ')'`);\n    const part = value.substring(start + 1, end);\n    let split = part.split(/[\\s,]+/);\n    if (split.length < 3)\n        throw new Error(`Expected three tokens. Got: ${split.length} length`);\n    let returnRelative = false;\n    if (split[0].endsWith(`%`))\n        returnRelative = true;\n    if (split[1].endsWith(`%`) && split[2].endsWith(`%`))\n        returnRelative = true;\n    const valueAsScalar = (v, pos) => {\n        if (v === `none`)\n            return 0;\n        if (v.endsWith(`%`)) {\n            return Number.parseFloat(v.substring(0, v.length - 1)) / 100;\n        }\n        if (v.endsWith(`deg`) && pos === 0) {\n            v = v.substring(0, v.length - 3);\n        }\n        const vf = Number.parseFloat(v);\n        if (pos === 0)\n            return vf / 360;\n        if (pos === 3)\n            return vf; // opacity\n        return vf / 100;\n    };\n    const valueAsAbs = (v, pos) => {\n        if (v === `none`)\n            return 0;\n        if (v.endsWith(`%`)) {\n            const vf = Number.parseFloat(v.substring(0, v.length - 1));\n            if (pos === 0)\n                return vf * 360;\n            return vf;\n        }\n        if (v.endsWith(`deg`) && pos === 0) {\n            return Number.parseFloat(v.substring(0, v.length - 3));\n        }\n        const vf = Number.parseFloat(v);\n        return vf;\n    };\n    // Is there opacity?\n    if (split.length > 3) {\n        if (split[3] === '/') {\n            // Remove / part\n            split = [split[0], split[1], split[2], split[4]];\n        }\n    }\n    if (returnRelative) {\n        return scalar(valueAsScalar(split[0], 0), valueAsScalar(split[1], 1), valueAsScalar(split[2], 2), valueAsScalar(split[3] ?? `100%`, 3));\n    }\n    else {\n        // Return as absolute\n        return absolute(valueAsAbs(split[0], 0), valueAsAbs(split[1], 1), valueAsAbs(split[2], 2), valueAsAbs(split[3] ?? `100%`, 3));\n    }\n}\n/**\n * Converts a Hsl structure (or CSS string) to Colorizr's RGB format\n * @param hsl HSL colour\n * @returns\n */\nexport function toLibraryRgb(hsl) {\n    if (typeof hsl === `string`) {\n        const parseResult = fromCss(hsl, { scalar: false });\n        //console.log(`parseResult hsl: ${ hsl } pr: `, parseResult);\n        return toLibraryRgb(parseResult);\n    }\n    hsl = toAbsolute(hsl);\n    //console.log(`toLibraryRgb hsl`, hsl);\n    const rgb = C.hsl2rgb({ h: hsl.h, s: hsl.s, l: hsl.l });\n    return { ...rgb, alpha: (hsl.opacity ?? 100) / 100 * 255 };\n}\n","import { numberInclusiveRangeTest, percentTest, resultThrow } from \"@ixfx/guards\";\nimport Colorizr, * as C from \"colorizr\";\nimport { cssDefinedHexColours } from \"./css-colours.js\";\nimport { angleConvert, angleParse } from \"@ixfx/geometry\";\nimport { calculateHueDistance, libraryRgbToHexString, wrapScalarHue } from \"./utility.js\";\nimport { clamp, interpolate } from \"@ixfx/numbers\";\nimport { parseCssRgbFunction, to8bit as rgbTo8bit } from \"./srgb.js\";\nexport const OKLCH_CHROMA_MAX = 0.4;\nexport const guard = (lch) => {\n    const { l, c, h, opacity, space, unit } = lch;\n    if (space !== `oklch`)\n        throw new Error(`Space is expected to be 'oklch'. Got: ${space}`);\n    if (unit === `absolute`) {\n        resultThrow(percentTest(l, `l`), () => {\n            if (typeof c === `number`) {\n                return numberInclusiveRangeTest(c, 0, OKLCH_CHROMA_MAX, `c`);\n            }\n        }, () => {\n            if (typeof h === `number`) {\n                return numberInclusiveRangeTest(c, 0, 360, `h`);\n            }\n        }, percentTest((opacity ?? 1), `opacity`));\n    }\n    else if (unit === `scalar`) {\n        // Percentage values for L,C,H\n        resultThrow(percentTest(l, `l`), percentTest(c, `c`), percentTest(h, `h`), percentTest((lch.opacity ?? 1), `opacity`));\n    }\n    else {\n        throw new Error(`Unit is expected to be 'absolute' or 'scalar'. Got: ${unit}`);\n    }\n};\nexport function fromLibrary(lch, parsingOptions = {}) {\n    if (typeof lch === `undefined` || lch === null) {\n        if (parsingOptions.fallbackColour)\n            return parsingOptions.fallbackColour;\n    }\n    const scalarReturn = parsingOptions.scalar ?? true;\n    // Validate\n    resultThrow(percentTest(lch.l, `l`), percentTest(lch.c, `c`), numberInclusiveRangeTest(lch.h, 0, 360, `h`), percentTest((lch.alpha ?? 1), `alpha`));\n    if (scalarReturn) {\n        return scalar(lch.l, lch.c / OKLCH_CHROMA_MAX, lch.h / 360, (lch.alpha ?? 1));\n    }\n    else {\n        return absolute(lch.l, lch.c, lch.h, (lch.alpha ?? 1));\n    }\n}\n/**\n * Parse a HEX-formatted colour into OkLch structured format\n * @param hexString\n * @param options\n * @returns\n */\nexport const fromHexString = (hexString, options = {}) => {\n    return fromLibrary(C.hex2oklch(hexString), options);\n};\nconst oklchTransparent = Object.freeze({\n    l: 0, c: 0, h: 0, opacity: 0, unit: `absolute`, space: `oklch`\n});\nexport function fromCss(value, options = {}) {\n    value = value.toLowerCase();\n    if (value.startsWith(`#`)) {\n        return fromHexString(value, options);\n    }\n    if (value === `transparent`)\n        return oklchTransparent;\n    if (typeof cssDefinedHexColours[value] !== `undefined`) {\n        return fromHexString(cssDefinedHexColours[value], options);\n    }\n    if (value.startsWith(`rgb(`)) {\n        const rgb = rgbTo8bit(parseCssRgbFunction(value));\n        const lch = C.rgb2oklch({ r: rgb.r, g: rgb.g, b: rgb.b });\n        return fromLibrary(lch, options);\n    }\n    if (!value.startsWith(`hsl(`) && !value.startsWith(`oklch(`)) {\n        try {\n            const converted = C.convert(value, `oklch`);\n            value = converted;\n        }\n        catch (error) {\n            if (options.fallbackString) {\n                value = options.fallbackString;\n            }\n            else {\n                throw error;\n            }\n        }\n    }\n    const cc = new Colorizr(value);\n    const lch = cc.oklch;\n    return fromLibrary(lch, options);\n}\n//export const fromCssScalar = (value: string, options: ParsingOptions<OkLchAbsolute> = {}): OkLchScalar => toScalar(fromCssAbsolute(value, options));\n/**\n * Returns a string or {@link OkLch} value to absolute form.\n *\n * This means ranges are:\n * * lightness: 0..1\n * * chroma: 0...CHROMA_MAX (0.4)\n * * hue: 0..360\n * @param lchOrString\n * @returns\n */\nexport const toAbsolute = (lchOrString) => {\n    if (typeof lchOrString === `string`) {\n        return toAbsolute(fromCss(lchOrString, { scalar: true }));\n    }\n    guard(lchOrString);\n    if (lchOrString.unit === `absolute`)\n        return lchOrString;\n    return {\n        space: `oklch`,\n        unit: `absolute`,\n        l: lchOrString.l,\n        c: lchOrString.c * OKLCH_CHROMA_MAX,\n        h: lchOrString.h * 360,\n        opacity: lchOrString.opacity\n    };\n};\nexport const toScalar = (lchOrString) => {\n    if (typeof lchOrString === `string`) {\n        return toScalar(fromCss(lchOrString, { scalar: true }));\n    }\n    const lch = lchOrString;\n    guard(lch);\n    //console.log(`toScalar input: ${ JSON.stringify(lchOrString) } lch: `, lch);\n    // Already relative\n    if (lch.unit === `scalar`)\n        return lch;\n    // Absolute values\n    return {\n        l: lch.l, // unchanged\n        c: lch.c / OKLCH_CHROMA_MAX,\n        h: lch.h / 360,\n        opacity: (lch.opacity ?? 1),\n        unit: `scalar`,\n        space: `oklch`\n    };\n};\nconst toLibrary = (lch) => {\n    const abs = toAbsolute(lch);\n    return {\n        l: abs.l,\n        c: abs.c,\n        h: abs.h,\n        alpha: abs.opacity,\n    };\n};\n// const libraryLchToScalar = (c: C.LCH): OkLchScalar => {\n//   return {\n//     l: c.h,\n//     c: c.c,\n//     h: c.h / 360,\n//     opacity: c.alpha ?? 1,\n//     unit: `scalar`,\n//     space: `oklch`\n//   }\n// }\n/**\n * Returns the colour as a CSS colour string: `oklch(l c h / opacity)`.\n *\n * @param lch Colour\n * @param precision Set precision of numbers, defaults to 3\n * @returns CSS colour string\n */\nexport const toCssString = (lch, precision = 3) => {\n    guard(lch);\n    const { l, c, h, opacity } = lch;\n    let css = ``;\n    switch (lch.unit) {\n        case `absolute`:\n            css = `oklch(${(l * 100).toFixed(precision)}% ${c.toFixed(precision)} ${h.toFixed(precision)}`;\n            break;\n        case `scalar`:\n            css = `oklch(${l.toFixed(precision)} ${(c * OKLCH_CHROMA_MAX).toFixed(precision)} ${(h * 360).toFixed(precision)}`;\n            break;\n    }\n    if (typeof opacity !== `undefined` && opacity !== 1) {\n        css += ` / ${opacity.toFixed(precision)}`;\n    }\n    css += `)`;\n    return css;\n};\nexport const toHexString = (lch) => {\n    const lch1 = toLibrary(lch);\n    const rgb = C.oklch2rgb(lch1);\n    return libraryRgbToHexString(rgb);\n};\n// export const oklchFromCss = (css: string): OkLchScalar => {\n//   if (css.startsWith(`#`)) {\n//     libraryLchToScalar(C.hex2oklch(css));\n//   }\n//   const p = C.extractColorParts(css);\n//   return libraryToScalar(p);\n// }\n// const libraryToScalar = (colour: unknown): OkLchScalar => {\n//   if (C.isLCH(colour)) {\n//     return libraryLchToScalar(colour);\n//   }\n//   if (C.isRGB(colour)) {\n//     return libraryToScalar(C.rgb2oklch(colour));\n//   }\n//   if (C.isLAB(colour)) {\n//     return libraryToScalar(C.oklab2oklch(colour));\n//   }\n//   if (C.isHSL(colour)) {\n//     return libraryToScalar(C.hsl2oklch(colour));\n//   }\n//   if (C.isHex(colour)) {\n//     return libraryLchToScalar(C.hex2oklch(colour));\n//   }\n//   throw new Error(`Unexpected colour format`);\n// }\n// export const oklchToColorJs = (lch: OkLch): ColorConstructor => {\n//   throwNumberTest(lch.l, `percentage`, `lch.l`);\n//   throwNumberTest(lch.c, `percentage`, `lch.c`);\n//   throwNumberTest(lch.h, `percentage`, `lch.h`);\n//   throwNumberTest(lch.opacity, `percentage`, `lch.opacity`);\n//   return {\n//     alpha: lch.opacity,\n//     coords: [ lch.l, lch.c * 0.4, lch.h * 360 ],\n//     spaceId: `oklch`\n//   }\n// }\n// const oklchToColorJs = (oklch: OkLch) => {\n//   throwNumberTest(oklch.l, `percentage`, `oklch.l`);\n//   throwNumberTest(oklch.c, `percentage`, `oklch.c`);\n//   throwNumberTest(oklch.h, `percentage`, `oklch.h`);\n//   throwNumberTest(oklch.opacity, `percentage`, `oklch.opacity`);\n//   const coords: [ number, number, number ] = [\n//     oklch.l,\n//     oklch.c * 0.4,\n//     oklch.h * 360\n//   ]\n//   return new ColorJs.default(`oklch`, coords, oklch.opacity);\n// }\n// export const isOklch = (p: Colourish | undefined | null): p is OkLch => {\n//   if (typeof p === `undefined` || p === null) return false;\n//   if (typeof p !== `object`) return false;\n//   // Check if Colourjs\n//   //if ((p as ColorJs.ColorObject).spaceId !== undefined) return false;\n//   //if ((p as ColorJs.ColorObject).coords !== undefined) return false;\n//   if (p.space !== `oklch`) return false;\n//   if (typeof p.l === `undefined`) return false;\n//   if (typeof p.c === `undefined`) return false;\n//   if (typeof p.h === `undefined`) return false;\n//   return true;\n// }\nexport const generateScalar = (absoluteHslOrVariable, chroma = 1, lightness = 0.5, opacity = 1) => {\n    if (typeof absoluteHslOrVariable === `string`) {\n        if (absoluteHslOrVariable.startsWith(`--`)) {\n            absoluteHslOrVariable = getComputedStyle(document.body).getPropertyValue(absoluteHslOrVariable).trim();\n        }\n    }\n    if (lightness > 1)\n        throw new TypeError(`Param 'lightness' must be between 0..1`);\n    if (chroma > 1)\n        throw new TypeError(`Param 'chroma' must be between 0..1`);\n    const hue = angleParse(absoluteHslOrVariable);\n    const hueDeg = angleConvert(hue, `deg`).value / 360;\n    if (opacity > 1)\n        throw new TypeError(`Param 'opacity' must be between 0..1`);\n    return {\n        l: lightness,\n        c: chroma,\n        h: hueDeg,\n        opacity: opacity,\n        unit: `scalar`,\n        space: `oklch`\n    };\n};\n/**\n * Scales the opacity value of an input Oklch value\n * ```js\n * withOpacity()\n * ```\n * @param value\n * @param fn\n * @returns\n */\nexport const withOpacity = (value, fn) => {\n    switch (value.unit) {\n        case `absolute`:\n            return {\n                ...value,\n                opacity: fn((value.opacity ?? 100) / 100, value) * 100\n            };\n        case `scalar`:\n            return {\n                ...value,\n                opacity: fn((value.opacity ?? 1), value)\n            };\n    }\n};\nexport const interpolator = (a, b, direction = `shorter`) => {\n    a = toScalar(a);\n    b = toScalar(b);\n    //console.log(`a`, a);\n    //console.log(`b`, b);\n    const aOpacity = a.opacity ?? 1;\n    const distanceCalc = calculateHueDistance(a.h, b.h, 1);\n    const hueDistance = direction === `longer` ? distanceCalc.long : distanceCalc.short;\n    const chromaDistance = b.c - a.c;\n    const lightDistance = b.l - a.l;\n    const opacityDistance = (b.opacity ?? 1) - aOpacity;\n    //console.log(`distanceCalc`, distanceCalc);\n    //console.log(`interpolator distances: hue: ${ hueDistance } c: ${ chromaDistance } light: ${ lightDistance } opacity: ${ opacityDistance }`);\n    return (amount) => {\n        amount = clamp(amount);\n        let h = interpolate(amount, 0, Math.abs(hueDistance));\n        if (hueDistance < 0)\n            h = a.h - h;\n        else\n            h = a.h + h;\n        const c = interpolate(amount, 0, chromaDistance);\n        const l = interpolate(amount, 0, lightDistance);\n        const o = interpolate(amount, 0, opacityDistance);\n        //console.log(`amount: ${ amount } h: ${ h } s: ${ s } l: ${ l } o: ${ o }`);\n        return scalar(l + a.l, c + a.c, wrapScalarHue(h), o + aOpacity);\n    };\n};\nexport function scalar(lightness = 0.7, chroma = 0.1, hue = 0.5, opacity = 1) {\n    const lch = {\n        unit: `scalar`,\n        space: `oklch`,\n        l: lightness,\n        c: chroma,\n        h: hue,\n        opacity: opacity\n    };\n    guard(lch);\n    return lch;\n}\n/**\n * Create an LCH colour using absolute hue\n * @param l Lightness 0..1\n * @param c Chroma 0..4\n * @param h Hue 0..360\n * @param opacity\n * @returns\n */\nexport const absolute = (l, c, h, opacity = 1) => {\n    const lch = {\n        space: `oklch`,\n        unit: `absolute`,\n        opacity,\n        l, c, h\n    };\n    guard(lch);\n    return lch;\n};\n","import * as SrgbSpace from \"./srgb.js\";\nimport * as HslSpace from './hsl.js';\nimport * as OklchSpace from './oklch.js';\n/**\n * Converts from some kind of colour that is legal in CSS\n * into a structured Colour type.\n *\n * Handles: hex format, CSS variables, colour names\n * ```js\n * fromCssColour(`#ffffff`);\n * fromCssColour(`blue`);\n * fromCssColour(`--some-variable`);\n * fromCssColour(`hsl(50, 50%, 50%)`);\n * fromCssColour(`rgb(50, 100, 100)`);\n * ```\n * @param colour\n * @returns\n */\nexport const fromCssColour = (colour) => {\n    if (colour.startsWith(`#`)) {\n        return SrgbSpace.fromHexString(colour, true);\n    }\n    if (typeof cssDefinedHexColours[colour] !== `undefined`) {\n        return SrgbSpace.fromHexString(cssDefinedHexColours[colour], true);\n    }\n    if (colour.startsWith(`--`)) {\n        const fromCss = getComputedStyle(document.body).getPropertyValue(colour).trim();\n        if (fromCss.length === 0 || fromCss === null)\n            throw new Error(`Variable missing: ${colour}`);\n        return fromCssColour(fromCss);\n    }\n    colour = colour.toLowerCase();\n    if (colour.startsWith(`hsl(`)) {\n        return HslSpace.fromCss(colour, { scalar: true });\n    }\n    if (colour.startsWith(`rgb(`)) {\n        return SrgbSpace.fromCss(colour, { scalar: true });\n    }\n    if (colour.startsWith(`oklch(`)) {\n        return OklchSpace.fromCss(colour, { scalar: true });\n    }\n    throw new Error(`String colour is not a hex colour, CSS variable nor well-defined colour. Input: '${colour}'`);\n};\n/**\n * Resolves a named colour or CSS variable to a colour string.\n * Doesn't do conversion or parsing.\n *\n * ```js\n * resolveCss(`red`);\n * resolveCss(`my-var`);\n * ```\n * @param colour Colour\n * @param fallback Fallback if CSS variable is missing\n * @returns\n */\nexport const resolveCss = (colour, fallback) => {\n    if (colour.startsWith(`--`)) {\n        const fromCss = getComputedStyle(document.body).getPropertyValue(colour).trim();\n        if (fromCss.length === 0 || fromCss === null) {\n            if (typeof fallback !== `undefined`)\n                return fallback;\n            throw new Error(`CSS variable missing: '${colour}'`);\n        }\n        return resolveCss(fromCss); // Recurse, because value might be a named colour\n    }\n    if (typeof cssDefinedHexColours[colour] !== `undefined`) {\n        return cssDefinedHexColours[colour];\n    }\n    return colour; // assume legit\n};\nexport const cssDefinedHexColours = {\n    \"aliceblue\": \"#f0f8ff\",\n    \"antiquewhite\": \"#faebd7\",\n    \"aqua\": \"#00ffff\",\n    \"aquamarine\": \"#7fffd4\",\n    \"azure\": \"#f0ffff\",\n    \"beige\": \"#f5f5dc\",\n    \"bisque\": \"#ffe4c4\",\n    \"black\": \"#000000\",\n    \"blanchedalmond\": \"#ffebcd\",\n    \"blue\": \"#0000ff\",\n    \"blueviolet\": \"#8a2be2\",\n    \"brown\": \"#a52a2a\",\n    \"burlywood\": \"#deb887\",\n    \"cadetblue\": \"#5f9ea0\",\n    \"chartreuse\": \"#7fff00\",\n    \"chocolate\": \"#d2691e\",\n    \"coral\": \"#ff7f50\",\n    \"cornflowerblue\": \"#6495ed\",\n    \"cornsilk\": \"#fff8dc\",\n    \"crimson\": \"#dc143c\",\n    \"cyan\": \"#00ffff\",\n    \"darkblue\": \"#00008b\",\n    \"darkcyan\": \"#008b8b\",\n    \"darkgoldenrod\": \"#b8860b\",\n    \"darkgray\": \"#a9a9a9\",\n    \"darkgreen\": \"#006400\",\n    \"darkkhaki\": \"#bdb76b\",\n    \"darkmagenta\": \"#8b008b\",\n    \"darkolivegreen\": \"#556b2f\",\n    \"darkorange\": \"#ff8c00\",\n    \"darkorchid\": \"#9932cc\",\n    \"darkred\": \"#8b0000\",\n    \"darksalmon\": \"#e9967a\",\n    \"darkseagreen\": \"#8fbc8f\",\n    \"darkslateblue\": \"#483d8b\",\n    \"darkslategray\": \"#2f4f4f\",\n    \"darkturquoise\": \"#00ced1\",\n    \"darkviolet\": \"#9400d3\",\n    \"deeppink\": \"#ff1493\",\n    \"deepskyblue\": \"#00bfff\",\n    \"dimgray\": \"#696969\",\n    \"dodgerblue\": \"#1e90ff\",\n    \"firebrick\": \"#b22222\",\n    \"floralwhite\": \"#fffaf0\",\n    \"forestgreen\": \"#228b22\",\n    \"fuchsia\": \"#ff00ff\",\n    \"gainsboro\": \"#dcdcdc\",\n    \"ghostwhite\": \"#f8f8ff\",\n    \"gold\": \"#ffd700\",\n    \"goldenrod\": \"#daa520\",\n    \"gray\": \"#808080\",\n    \"green\": \"#008000\",\n    \"greenyellow\": \"#adff2f\",\n    \"honeydew\": \"#f0fff0\",\n    \"hotpink\": \"#ff69b4\",\n    \"indianred\": \"#cd5c5c\",\n    \"indigo\": \"#4b0082\",\n    \"ivory\": \"#fffff0\",\n    \"khaki\": \"#f0e68c\",\n    \"lavender\": \"#e6e6fa\",\n    \"lavenderblush\": \"#fff0f5\",\n    \"lawngreen\": \"#7cfc00\",\n    \"lemonchiffon\": \"#fffacd\",\n    \"lightblue\": \"#add8e6\",\n    \"lightcoral\": \"#f08080\",\n    \"lightcyan\": \"#e0ffff\",\n    \"lightgoldenrodyellow\": \"#fafad2\",\n    \"lightgray\": \"#d3d3d3\",\n    \"lightgreen\": \"#90ee90\",\n    \"lightpink\": \"#ffb6c1\",\n    \"lightsalmon\": \"#ffa07a\",\n    \"lightseagreen\": \"#20b2aa\",\n    \"lightskyblue\": \"#87cefa\",\n    \"lightslategray\": \"#778899\",\n    \"lightsteelblue\": \"#b0c4de\",\n    \"lightyellow\": \"#ffffe0\",\n    \"lime\": \"#00ff00\",\n    \"limegreen\": \"#32cd32\",\n    \"linen\": \"#faf0e6\",\n    \"magenta\": \"#ff00ff\",\n    \"maroon\": \"#800000\",\n    \"mediumaquamarine\": \"#66cdaa\",\n    \"mediumblue\": \"#0000cd\",\n    \"mediumorchid\": \"#ba55d3\",\n    \"mediumpurple\": \"#9370db\",\n    \"mediumseagreen\": \"#3cb371\",\n    \"mediumslateblue\": \"#7b68ee\",\n    \"mediumspringgreen\": \"#00fa9a\",\n    \"mediumturquoise\": \"#48d1cc\",\n    \"mediumvioletred\": \"#c71585\",\n    \"midnightblue\": \"#191970\",\n    \"mintcream\": \"#f5fffa\",\n    \"mistyrose\": \"#ffe4e1\",\n    \"moccasin\": \"#ffe4b5\",\n    \"navajowhite\": \"#ffdead\",\n    \"navy\": \"#000080\",\n    \"oldlace\": \"#fdf5e6\",\n    \"olive\": \"#808000\",\n    \"olivedrab\": \"#6b8e23\",\n    \"orange\": \"#ffa500\",\n    \"orangered\": \"#ff4500\",\n    \"orchid\": \"#da70d6\",\n    \"palegoldenrod\": \"#eee8aa\",\n    \"palegreen\": \"#98fb98\",\n    \"paleturquoise\": \"#afeeee\",\n    \"palevioletred\": \"#db7093\",\n    \"papayawhip\": \"#ffefd5\",\n    \"peachpuff\": \"#ffdab9\",\n    \"peru\": \"#cd853f\",\n    \"pink\": \"#ffc0cb\",\n    \"plum\": \"#dda0dd\",\n    \"powderblue\": \"#b0e0e6\",\n    \"purple\": \"#800080\",\n    \"rebeccapurple\": \"#663399\",\n    \"red\": \"#ff0000\",\n    \"rosybrown\": \"#bc8f8f\",\n    \"royalblue\": \"#4169e1\",\n    \"saddlebrown\": \"#8b4513\",\n    \"salmon\": \"#fa8072\",\n    \"sandybrown\": \"#f4a460\",\n    \"seagreen\": \"#2e8b57\",\n    \"seashell\": \"#fff5ee\",\n    \"sienna\": \"#a0522d\",\n    \"silver\": \"#c0c0c0\",\n    \"skyblue\": \"#87ceeb\",\n    \"slateblue\": \"#6a5acd\",\n    \"slategray\": \"#708090\",\n    \"snow\": \"#fffafa\",\n    \"springgreen\": \"#00ff7f\",\n    \"steelblue\": \"#4682b4\",\n    \"tan\": \"#d2b48c\",\n    \"teal\": \"#008080\",\n    \"thistle\": \"#d8bfd8\",\n    \"tomato\": \"#ff6347\",\n    \"turquoise\": \"#40e0d0\",\n    \"violet\": \"#ee82ee\",\n    \"wheat\": \"#f5deb3\",\n    \"white\": \"#ffffff\",\n    \"whitesmoke\": \"#f5f5f5\",\n    \"yellow\": \"#ffff00\",\n    \"yellowgreen\": \"#9acd32\",\n    \"transparent\": \"#00000000\"\n};\n","import Colorizr, * as C from \"colorizr\";\nimport { numberInclusiveRangeTest, numberTest } from \"@ixfx/guards\";\nimport { resultThrow } from \"@ixfx/guards\";\nimport { cssDefinedHexColours } from \"./css-colours.js\";\nimport { clamp, interpolate } from \"@ixfx/numbers\";\nimport { toLibraryRgb as hslToLibraryRgb } from \"./hsl.js\";\nimport { isHsl } from \"./guards.js\";\nimport { libraryRgbToHexString } from \"./utility.js\";\nexport const withOpacity = (value, fn) => {\n    switch (value.unit) {\n        case `8bit`:\n            return {\n                ...value,\n                opacity: fn((value.opacity ?? 255) / 255, value) * 255\n            };\n        case `scalar`:\n            return {\n                ...value,\n                opacity: fn((value.opacity ?? 1), value)\n            };\n    }\n};\nexport function fromHexString(hexString, scalar = true) {\n    return fromLibrary(C.hex2rgb(hexString), { scalar });\n}\n;\nconst srgbTansparent = Object.freeze({\n    r: 0, g: 0, b: 0, opacity: 0, unit: `8bit`, space: `srgb`\n});\n/**\n * Converts a colour in a legal CSS form into Rgb value, by default RgbScalar (0..1) scale.\n * ```js\n * fromCss(`rebeccapurple`);\n * fromCss(`rgb(40% 20% 60%)`);\n *\n * // Get 8bit version on 0..255 scale\n * fromCss(`blue`, { scalar: false });\n * ```\n *\n * @param value\n * @param options\n * @returns\n */\nexport function fromCss(value, options = {}) {\n    value = value.toLowerCase();\n    if (value.startsWith(`hsla(`))\n        throw new Error(`hsla() not supported`);\n    if (value.startsWith(`rgba(`))\n        throw new Error(`rgba() not supported`);\n    const scalar = options.scalar ?? true;\n    // Convert from hex\n    if (value.startsWith(`#`))\n        return fromHexString(value, scalar);\n    // Special-case transparent\n    if (value === `transparent`)\n        return srgbTansparent;\n    // Convert from named colour\n    if (typeof cssDefinedHexColours[value] !== `undefined`)\n        fromHexString(cssDefinedHexColours[value], scalar);\n    if (value.startsWith(`hsl(`)) {\n        const rgb = hslToLibraryRgb(value);\n        return fromLibrary(rgb, options);\n    }\n    // if (value.startsWith(`hsl(`)) {\n    //   const hslRel = hslToScalar(parseCssHslFunction(value));\n    //   const rgb = C.hsl2rgb({ h: hslRel.h, s: hslRel.s, l: hslRel.l, alpha: hslRel.opacity ?? 1 });\n    //   return fromLibrary(rgb, options);\n    // }\n    // Convert to rgb() colour function\n    if (!value.startsWith(`rgb(`)) {\n        try {\n            value = C.convert(value, `rgb`);\n        }\n        catch (error) {\n            if (options.fallbackString) {\n                value = options.fallbackString;\n            }\n            else {\n                throw error;\n            }\n        }\n    }\n    try {\n        // Hand-rolled rgb() parse because the package is broken\n        const rgb = parseCssRgbFunction(value);\n        if (scalar)\n            return toScalar(rgb);\n        return to8bit(rgb);\n    }\n    catch (error) {\n        if (options.fallbackColour)\n            return options.fallbackColour;\n        throw error;\n    }\n}\nexport const toHexString = (rgb) => {\n    const rgb1 = toLibrary(rgb);\n    return libraryRgbToHexString(rgb1);\n};\nexport const toCssString = (rgb) => {\n    guard(rgb);\n    switch (rgb.unit) {\n        case `8bit`:\n            if (rgb.opacity === undefined || rgb.opacity === 255) {\n                return `rgb(${rgb.r} ${rgb.g} ${rgb.b})`;\n            }\n            return `rgb(${rgb.r} ${rgb.g} ${rgb.b} / ${(rgb.opacity ?? 255) / 255})`;\n        case `scalar`:\n            if (rgb.opacity === undefined || rgb.opacity === 1) {\n                return `rgb(${rgb.r * 100}% ${rgb.g * 100}% ${rgb.b * 100}%)`;\n            }\n            return `rgb(${rgb.r * 100}% ${rgb.g * 100}% ${rgb.b * 100}% / ${(rgb.opacity ?? 1) * 100}%)`;\n        default:\n            throw new Error(`Unknown unit: ${rgb.unit}`);\n    }\n};\nconst toLibrary = (rgb) => {\n    const abs = to8bit(rgb);\n    return {\n        r: abs.r,\n        g: abs.g,\n        b: abs.b,\n        alpha: abs.opacity,\n    };\n};\nfunction fromLibrary(rgb, parsingOptions = {}) {\n    if (parsingOptions.scalar) {\n        return {\n            r: rgb.r / 255,\n            g: rgb.g / 255,\n            b: rgb.b / 255,\n            opacity: rgb.alpha ?? 1,\n            unit: `scalar`,\n            space: `srgb`\n        };\n    }\n    else {\n        return {\n            r: rgb.r,\n            g: rgb.g,\n            b: rgb.b,\n            opacity: rgb.alpha ?? 255,\n            unit: `8bit`,\n            space: `srgb`\n        };\n    }\n}\nexport const to8bit = (rgbOrString) => {\n    if (typeof rgbOrString === `string`) {\n        return fromCss(rgbOrString, { scalar: false });\n    }\n    if (isHsl(rgbOrString)) {\n        return to8bit(fromLibrary(hslToLibraryRgb(rgbOrString), { scalar: false }));\n    }\n    guard(rgbOrString);\n    if (rgbOrString.unit === `8bit`)\n        return rgbOrString;\n    return {\n        r: rgbOrString.r * 255,\n        g: rgbOrString.g * 255,\n        b: rgbOrString.b * 255,\n        opacity: (rgbOrString.opacity ?? 1) * 255,\n        unit: `8bit`,\n        space: `srgb`\n    };\n};\nexport const toScalar = (rgbOrString) => {\n    if (typeof rgbOrString === `string`) {\n        return fromCss(rgbOrString, { scalar: true });\n    }\n    if (isHsl(rgbOrString)) {\n        return toScalar(fromLibrary(hslToLibraryRgb(rgbOrString), { scalar: true }));\n    }\n    guard(rgbOrString);\n    if (rgbOrString.unit === `scalar`)\n        return rgbOrString;\n    return {\n        r: rgbOrString.r / 255,\n        g: rgbOrString.g / 255,\n        b: rgbOrString.b / 255,\n        opacity: (rgbOrString.opacity ?? 1) / 255,\n        unit: `scalar`,\n        space: `srgb`\n    };\n};\nexport const guard = (rgb) => {\n    const { r, g, b, opacity, space, unit } = rgb;\n    if (space !== `srgb`)\n        throw new Error(`Space is expected to be 'srgb'. Got: ${space}`);\n    if (unit === `8bit`) {\n        resultThrow(numberInclusiveRangeTest(r, 0, 255, `r`), numberInclusiveRangeTest(g, 0, 255, `g`), numberInclusiveRangeTest(b, 0, 255, `b`), () => {\n            if (typeof opacity === `number`) {\n                return numberInclusiveRangeTest(opacity, 0, 255, `opacity`);\n            }\n        });\n    }\n    else if (unit === `scalar`) {\n        resultThrow(numberTest(r, `percentage`, `r`), numberTest(g, `percentage`, `g`), numberTest(b, `percentage`, `b`), () => {\n            if (typeof opacity === `number`) {\n                return numberTest(opacity, `percentage`, `opacity`);\n            }\n        });\n    }\n    else {\n        throw new Error(`Unit is expected to be '8bit' or 'scalar'. Got: ${unit}`);\n    }\n};\n/**\n * Sets the lightness value.\n *\n * Amount to change:\n * * 'fixed': a fixed amount\n * * 'delta': increase/decrease by this amount\n * * 'pdelta': proportion of current value to change by ('percentage delta')\n *\n * Use negative values to decrease\n * @param rgb Colour\n * @param amount Amount to change\n */\nexport const changeLightness = (rgb, amount) => {\n    let newL = 0;\n    const co = new Colorizr(toCssString(rgb));\n    const scalarUnit = rgb.unit === `scalar`;\n    if (typeof amount.pdelta !== `undefined`) {\n        newL = co.oklab.l + (co.oklab.l * amount.pdelta);\n    }\n    else if (typeof amount.delta !== `undefined`) {\n        newL = co.oklab.l + amount.delta;\n    }\n    else if (typeof amount.fixed !== `undefined`) {\n        if (amount.fixed < 0)\n            throw new TypeError(`Amount cannot be negative when using 'fixed'`);\n        newL = amount.fixed;\n    }\n    else {\n        throw new TypeError(`Parameter 'amount' is missing 'pdelta/delta/fixed' properties`);\n    }\n    if (newL < 0)\n        newL = 0;\n    else if (newL > 1)\n        newL = 1;\n    const rgbResult = C.oklab2rgb({ a: co.oklab.a, b: co.oklab.b, l: newL, alpha: co.oklab.alpha });\n    return fromLibrary(rgbResult, { scalar: scalarUnit });\n    //return eightBit ? fromLibrary8bit(rgbResult) : fromLibraryScalar(rgbResult);\n};\n/**\n * Returns a lightness value (0..1) for an RGB input\n *\n * Calculates lightness by converting to Oklab and using the 'L' value\n * @param rgb\n * @returns\n */\nexport function lightness(rgb) {\n    const co = new Colorizr(toCssString(rgb));\n    return co.oklab.l;\n}\nconst scaleProperty = (rgb, value, property) => {\n    if (rgb.unit === `scalar`) {\n        // 0..1 scale\n        if (value > 1)\n            value = 1;\n        else if (value < 0)\n            value = 0;\n    }\n    else {\n        // 0..255 scale\n        if (value > 255)\n            value = 255;\n        else if (value < 0)\n            value = 0;\n    }\n    return value;\n};\n/**\n * Creates a Rgb8Bit value from 8bit (0..255) values\n * @param red\n * @param green\n * @param blue\n * @param opacity\n * @returns\n */\nexport function eightBit(red = 100, green = 100, blue = 100, opacity = 255) {\n    const rgb = {\n        unit: `8bit`,\n        space: `srgb`,\n        r: red,\n        g: green,\n        b: blue,\n        opacity: opacity\n    };\n    guard(rgb);\n    return rgb;\n}\n/**\n * Creates a RgbScalar value from scalar (0..1) values\n * @param red\n * @param green\n * @param blue\n * @param opacity\n * @returns\n */\nexport function scalar(red = 0.5, green = 0.5, blue = 0.5, opacity = 1) {\n    const rgb = {\n        unit: `scalar`,\n        space: `srgb`,\n        r: red,\n        g: green,\n        b: blue,\n        opacity: opacity\n    };\n    guard(rgb);\n    return rgb;\n}\n/**\n * It seems Colorizr can't handle % values properly :'(\n * @param value\n */\nexport function parseCssRgbFunction(value) {\n    if (value.startsWith(`rgba`))\n        throw new Error(`RGBA is not supported`);\n    if (!value.startsWith(`rgb(`))\n        throw new Error(`Expected rgb(..) CSS colour`);\n    const start = value.indexOf('(');\n    const end = value.indexOf(')');\n    if (end < start)\n        throw new Error(`Is rgb() not terminated? Missing ')'`);\n    const part = value.substring(start + 1, end);\n    let split = part.split(/[\\s,]+/);\n    if (split.length < 3)\n        throw new Error(`Expected three tokens. Got: ${split.length} length`);\n    let relativeCount = 0;\n    for (const s of split) {\n        if (s.endsWith('%'))\n            relativeCount++;\n    }\n    const valueAsScalar = (v, pos) => {\n        if (v.endsWith(`%`)) {\n            return Number.parseFloat(v.substring(0, v.length - 1)) / 100;\n        }\n        if (pos < 3) {\n            // r, g or b\n            return Number.parseFloat(v) / 255;\n        }\n        else {\n            // opacity should already be in scalar value\n            return Number.parseFloat(v);\n        }\n    };\n    const valueAs8bit = (v, pos) => {\n        if (v.endsWith(`%`)) {\n            return Number.parseFloat(v.substring(0, v.length - 1)) / 100 * 255;\n        }\n        if (pos < 3) {\n            // r, g or b\n            return Number.parseFloat(v);\n        }\n        else {\n            // opacity should already be in scalar value\n            return Number.parseFloat(v) * 255;\n        }\n    };\n    // Is there opacity?\n    if (split.length > 3) {\n        if (split[3] === '/') {\n            // Remove / part\n            split = [split[0], split[1], split[2], split[4]];\n        }\n    }\n    if (relativeCount > 1) {\n        // Return as scalar\n        return scalar(valueAsScalar(split[0], 0), valueAsScalar(split[1], 1), valueAsScalar(split[2], 2), valueAsScalar(split[3] ?? `1`, 3));\n    }\n    else {\n        // Return as 8bit\n        return eightBit(valueAs8bit(split[0], 0), valueAs8bit(split[1], 1), valueAs8bit(split[2], 2), valueAs8bit(split[3] ?? `1`, 3));\n    }\n}\n/**\n * Interpolates colours in Srgb space. Probably\n * really ugly, use OkLch space isntead.\n *\n * ```js\n * const i = interpolator(`red`, `blue`);\n * i(0.5); // Get 50% between these colours\n * ```\n * @param colourA\n * @param colourB\n * @returns\n */\nexport const interpolator = (colourA, colourB) => {\n    const aa = toScalar(colourA);\n    const bb = toScalar(colourB);\n    const aOpacity = aa.opacity ?? 1;\n    const opacityDistance = (bb.opacity ?? 1) - aOpacity;\n    const r = bb.r - aa.r;\n    const g = bb.g - aa.g;\n    const b = bb.b - aa.b;\n    return (amount) => {\n        amount = clamp(amount);\n        return scalar(aa.r + interpolate(amount, 0, r), aa.g + interpolate(amount, 0, g), aa.b + interpolate(amount, 0, b), aOpacity + interpolate(amount, 0, opacityDistance));\n    };\n};\n/**\n * Converts a Rgb structure (or CSS string) to Colorizr's HSL format\n * @param rgb\n * @returns\n */\nexport function toLibraryHsl(rgb) {\n    if (typeof rgb === `string`) {\n        const parseResult = fromCss(rgb, { scalar: false });\n        return toLibraryHsl(parseResult);\n    }\n    rgb = to8bit(rgb);\n    const hsl = C.rgb2hsl({ r: rgb.r, g: rgb.g, b: rgb.b });\n    return { ...hsl, alpha: (rgb.opacity ?? 255) / 255 };\n}\n","import { Grids } from '@ixfx/geometry';\nimport * as SrgbSpace from './colour/srgb.js';\n/**\n * Returns a {@link https://api.ixfx.fun/_ixfx/geometry/Grids/Grid/} based on the provided `image`\n * @param image ImageData\n * @returns Grid\n */\nexport const grid = (image) => {\n    const g = { rows: image.width, cols: image.height };\n    return g;\n};\n/**\n * Returns an object that allows get/set grid semantics on the underlying `image` data.\n * Uses 8-bit sRGB values, meaning 0..255 range for red, green, blue & opacity.\n *\n * ```js\n * // Get CANVAS element, drawing context and then image data\n * const canvasEl = document.querySelector(`#my-canvas`);\n * const ctx = canvasEl.getContext(`2d`);\n * const imageData = ctx.getImageData();\n *\n * // Now that we have image data, we can wrap it:\n * const asGrid = ImageDataGrid.wrap(imageData);\n * asGrid.get({ x:10, y: 20 }); // Get pixel at 10,20\n * asGrid.set(colour, { x:10, y: 20 }); // Set pixel value\n *\n * // Display changes back on the canvas\n * ctx.putImageData(imageData, 0, 0)\n * ```\n * @param image\n * @returns\n */\nexport const wrap = (image) => {\n    return {\n        ...grid(image),\n        get: accessor(image),\n        set: setter(image)\n    };\n};\n/**\n * Returns a function to access pixel values by x,y\n * @param image\n * @returns\n */\nexport const accessor = (image) => {\n    const g = grid(image);\n    const data = image.data;\n    const fn = (cell, bounds = `undefined`) => {\n        const index = Grids.indexFromCell(g, cell, bounds);\n        if (index === undefined)\n            return;\n        const pxIndex = index * 4;\n        return {\n            r: data[pxIndex],\n            g: data[pxIndex + 1],\n            b: data[pxIndex + 2],\n            opacity: data[pxIndex + 3],\n            unit: `8bit`,\n            space: `srgb`\n        };\n    };\n    return fn;\n};\n/**\n * Returns a function that sets pixel values\n * @param image\n * @returns\n */\nexport const setter = (image) => {\n    const g = grid(image);\n    const data = image.data;\n    const fn = (value, cell, bounds = `undefined`) => {\n        const index = Grids.indexFromCell(g, cell, bounds);\n        if (index === undefined)\n            throw new Error(`Cell out of range. ${cell.x},${cell.y}`);\n        const pixel = SrgbSpace.to8bit(value);\n        const pxIndex = index * 4;\n        data[pxIndex] = pixel.r;\n        data[pxIndex + 1] = pixel.g;\n        data[pxIndex + 2] = pixel.b;\n        data[pxIndex + 3] = pixel.opacity ?? 255;\n    };\n    return fn;\n};\n// export function* visit(image: ImageData, visitor: Grids.VisitGenerator) {\n//   const a = accessor(image);\n//   for (const cell of visitor) {\n//     yield a(cell, `undefined`);\n//   }\n// }\n/**\n * Yields pixels of an image row by row\n * @param image\n */\nexport function* byRow(image) {\n    const a = accessor(image);\n    const g = grid(image);\n    const v = Grids.As.rows(g, { x: 0, y: 0 });\n    for (const row of v) {\n        const pixels = row.map(p => a(p, `undefined`));\n        yield pixels;\n    }\n}\n/**\n * Yields pixels of an image column by column\n * @param image\n */\nexport function* byColumn(image) {\n    const a = accessor(image);\n    const g = grid(image);\n    for (let x = 0; x < g.cols; x++) {\n        const col = [];\n        for (let y = 0; y < g.rows; y++) {\n            const p = a({ x, y }, `undefined`);\n            if (p)\n                col.push(p);\n        }\n        yield col;\n    }\n}\n","import { ElementSizer, resolveEl } from '@ixfx/dom';\nimport { SimpleEventEmitter } from '@ixfx/events';\nimport { Rects, scaler } from '@ixfx/geometry';\nimport * as Drawing from './drawing.js';\nimport * as ImageDataGrid from './image-data-grid.js';\nimport { cloneFromFields } from '@ixfx/core/records';\n/**\n * A wrapper for the CANVAS element that scales the canvas for high-DPI displays\n * and helps with resizing.\n *\n * ```js\n * const canvas = new CanvasHelper(`#my-canvas`, { resizeLogic: `both` });\n * const { ctx, width, height } = canvas.ctx; // Get drawing context, width & height\n * ```\n *\n * Draw whenever it is resized using the 'resize' event\n * ```js\n * canvas.addEventListener(`resize`, ({ctx, size}) => {\n *  // Use ctx...\n * });\n * ```\n *\n * Or provide a function when initialising:\n * ```js\n * const onResize = (ctx, size) => {\n *  // Do drawing\n * }\n * const canvas = new CanvasHelper(`#my-canvas`, { resizeLogic: `both`, onResize });\n * ```\n *\n * Automatically draw at animation speeds:\n * ```js\n * const draw = () => {\n * }\n * const canvas = new CanvasHelper(`#my-canvas`, { resizeLogic: `both`, draw });\n * ```\n */\nexport class CanvasHelper extends SimpleEventEmitter {\n    el;\n    opts;\n    #scaler;\n    #scalerSize;\n    #viewport = Rects.EmptyPositioned;\n    #logicalSize = Rects.Empty;\n    #ctx;\n    #drawHelper;\n    #resizer;\n    #disposed = false;\n    constructor(domQueryOrEl, opts = {}) {\n        super();\n        if (!domQueryOrEl)\n            throw new Error(`Param 'domQueryOrEl' is null or undefined. Expected canvas element.`);\n        this.el = resolveEl(domQueryOrEl);\n        if (this.el.nodeName !== `CANVAS`) {\n            throw new Error(`Expected CANVAS HTML element. Got: ${this.el.nodeName}`);\n        }\n        const size = this.el.getBoundingClientRect();\n        this.opts = {\n            resizeLogic: opts.resizeLogic ?? `none`,\n            disablePointerEvents: opts.disablePointerEvents ?? false,\n            pixelZoom: opts.pixelZoom ?? (window.devicePixelRatio || 1),\n            height: opts.height ?? size.height,\n            width: opts.width ?? size.width,\n            zIndex: opts.zIndex ?? -1,\n            coordinateScale: opts.coordinateScale ?? `both`,\n            onResizing: opts.onResizing,\n            onResized: opts.onResized,\n            clearOnResize: opts.clearOnResize ?? true,\n            draw: opts.draw,\n            skipCss: opts.skipCss ?? false,\n            colourSpace: `srgb`\n        };\n        this.#scaler = scaler(`both`);\n        this.#scalerSize = scaler(`both`, size);\n        this.#init();\n    }\n    getRectangle() {\n        return {\n            x: 0, y: 0,\n            ...this.#logicalSize\n        };\n    }\n    dispose(reason) {\n        if (this.#disposed)\n            return;\n        this.#disposed = true;\n        if (this.#resizer) {\n            this.#resizer.dispose(`CanvasHelper disposing ${reason}`.trim());\n            this.#resizer = undefined;\n        }\n    }\n    #getContext(reset = false) {\n        if (this.#ctx === undefined || reset) {\n            const ratio = this.ratio;\n            const c = this.el.getContext(`2d`);\n            if (c === null)\n                throw new Error(`Could not create drawing context`);\n            this.#ctx = c;\n            // Reset scale\n            c.setTransform(1, 0, 0, 1, 0, 0);\n            c.scale(ratio, ratio);\n        }\n        return this.#ctx;\n    }\n    ;\n    /**\n     * Gets the drawable area of the canvas.\n     * This accounts for scaling due to high-DPI displays etc.\n     * @returns\n     */\n    getPhysicalSize() {\n        return {\n            width: this.width * this.ratio,\n            height: this.height * this.ratio\n        };\n    }\n    /**\n     * Creates a drawing helper for the canvas.\n     * If one is already created it is reused.\n     */\n    getDrawHelper() {\n        if (!this.#drawHelper) {\n            this.#drawHelper = Drawing.makeHelper(this.#getContext(), {\n                width: this.width, height: this.height\n            });\n        }\n    }\n    setLogicalSize(logicalSize) {\n        Rects.guard(logicalSize, `logicalSize`);\n        const logicalSizeInteger = Rects.applyFields(v => Math.floor(v), logicalSize);\n        const ratio = this.opts.pixelZoom;\n        // Scaler for going between relative and logical units\n        this.#scaler = scaler(this.opts.coordinateScale, logicalSize);\n        this.#scalerSize = scaler(`both`, logicalSize);\n        // Scaled logical size for DPI\n        const pixelScaled = Rects.multiplyScalar(logicalSize, ratio);\n        // Canvas will actually be much larger, based on DPI\n        this.el.width = pixelScaled.width;\n        this.el.height = pixelScaled.height;\n        // But scaled down on screen\n        this.el.style.width = logicalSizeInteger.width.toString() + `px`;\n        this.el.style.height = logicalSizeInteger.height.toString() + `px`;\n        // Since dimensions have change, reset context\n        this.#getContext(true);\n        if (this.opts.clearOnResize) {\n            this.ctx.clearRect(0, 0, this.width, this.height);\n        }\n        this.#logicalSize = logicalSizeInteger;\n        //console.log(`setting logical size to ${ this.#logicalSize.width }x${ this.#logicalSize.height }`);\n        // Notify listeners of resize\n        // const r = this.opts.onResizing;\n        // if (r) {\n        //   setTimeout(() => { r(this.ctx, this.size, this) }, 100);\n        // }\n        if (this.opts.onResizing) {\n            this.opts.onResizing(this.ctx, this.size, this);\n        }\n        this.fireEvent(`resize`, { ctx: this.ctx, size: this.#logicalSize, helper: this });\n    }\n    #init() {\n        //console.log(`init`, this.opts);\n        // If there is a 'draw' callback, set up an animation loop\n        const d = this.opts.draw;\n        if (d) {\n            const sched = () => {\n                d(this.ctx, this.#logicalSize, this);\n                requestAnimationFrame(sched);\n            };\n            setTimeout(() => { sched(); }, 100);\n        }\n        if (!this.opts.disablePointerEvents) {\n            this.#handleEvents();\n        }\n        const resizeLogic = this.opts.resizeLogic ?? `none`;\n        if (resizeLogic === `none`) {\n            this.setLogicalSize({ width: this.opts.width, height: this.opts.height });\n        }\n        else {\n            const resizerOptions = {\n                onSizeChanging: (size) => {\n                    if (Rects.isEqual(this.#logicalSize, size))\n                        return;\n                    this.setLogicalSize(size);\n                },\n                onSizeDone: (size, el) => {\n                    this.#onResizeDone(size);\n                },\n                containerEl: this.opts.containerEl,\n                naturalSize: { width: this.opts.width, height: this.opts.height },\n                stretch: this.opts.resizeLogic ?? `none`\n            };\n            this.#resizer = new ElementSizer(this.el, resizerOptions);\n        }\n        this.#getContext();\n    }\n    #onResizeDone(size) {\n        if (this.opts.onResized)\n            this.opts.onResized(this.ctx, this.size, this);\n        this.fireEvent(`resized`, { ctx: this.ctx, size: this.#logicalSize, helper: this });\n    }\n    #handleEvents() {\n        const handlePointerEvent = (event) => {\n            const { offsetX, offsetY } = event;\n            const physicalX = offsetX * this.ratio;\n            const physicalY = offsetY * this.ratio;\n            event = cloneFromFields(event);\n            const eventData = {\n                physicalX, physicalY,\n                // eslint-disable-next-line @typescript-eslint/no-misused-spread\n                ...event\n            };\n            switch (event.type) {\n                case `pointerup`: {\n                    {\n                        this.fireEvent(`pointerup`, eventData);\n                        break;\n                    }\n                    ;\n                }\n                case `pointermove`: {\n                    {\n                        this.fireEvent(`pointermove`, eventData);\n                        break;\n                    }\n                    ;\n                }\n                case `pointerdown`: {\n                    {\n                        this.fireEvent(`pointerup`, eventData);\n                        break;\n                    }\n                    ;\n                }\n            }\n            ;\n        };\n        this.el.addEventListener(`pointermove`, handlePointerEvent);\n        this.el.addEventListener(`pointerdown`, handlePointerEvent);\n        this.el.addEventListener(`pointerup`, handlePointerEvent);\n    }\n    /**\n     * Clears the canvas.\n     *\n     * Shortcut for:\n     * `ctx.clearRect(0, 0, this.width, this.height)`\n     */\n    clear() {\n        if (!this.#ctx)\n            return;\n        this.#ctx.clearRect(0, 0, this.width, this.height);\n    }\n    /**\n     * Fills the canvas with a given colour.\n     *\n     * Shortcut for:\n     * ```js\n        * ctx.fillStyle = ``;\n     * ctx.fillRect(0, 0, this.width, this.height);\n     * ```\n     * @param colour Colour\n     */\n    fill(colour) {\n        if (!this.#ctx)\n            return;\n        if (colour)\n            this.#ctx.fillStyle = colour;\n        this.#ctx.fillRect(0, 0, this.width, this.height);\n    }\n    /**\n     * Gets the drawing context\n     */\n    get ctx() {\n        if (this.#ctx === undefined)\n            throw new Error(`Context not available`);\n        return this.#getContext();\n    }\n    get viewport() {\n        return this.#viewport;\n    }\n    /**\n     * Gets the logical width of the canvas\n     * See also: {@link height}, {@link size}\n     */\n    get width() {\n        return this.#logicalSize.width;\n    }\n    /**\n     * Gets the logical height of the canvas\n     * See also: {@link width}, {@link size}\n     */\n    get height() {\n        return this.#logicalSize.height;\n    }\n    /**\n     * Gets the logical size of the canvas\n     * See also: {@link width}, {@link height}\n     */\n    get size() {\n        return this.#logicalSize;\n    }\n    /**\n     * Gets the current scaling ratio being used\n     * to compensate for high-DPI display\n     */\n    get ratio() {\n        return window.devicePixelRatio || 1;\n    }\n    /**\n     * Returns the width or height, whichever is smallest\n     */\n    get dimensionMin() {\n        return Math.min(this.width, this.height);\n    }\n    /**\n     * Returns the width or height, whichever is largest\n     */\n    get dimensionMax() {\n        return Math.max(this.width, this.height);\n    }\n    drawBounds(strokeStyle = `green`) {\n        const ctx = this.#getContext();\n        Drawing.rect(ctx, { x: 0, y: 0, width: this.width, height: this.height }, { crossed: true, strokeStyle, strokeWidth: 1 });\n        Drawing.rect(ctx, this.#viewport, { crossed: true, strokeStyle: `silver`, strokeWidth: 3 });\n    }\n    /**\n     * Returns a Scaler that converts from absolute\n     * to relative coordinates.\n     * This is based on the canvas size.\n     *\n     * ```js\n        * // Assuming a canvas of 800x500\n     * toRelative({ x: 800, y: 600 });  // { x: 1,   y: 1 }\n     * toRelative({ x: 0, y: 0 });   // { x: 0,   y: 0 }\n     * toRelative({ x: 400, y: 300 }); // { x: 0.5, y: 0.5 }\n     * ```\n     */\n    get toRelative() {\n        return this.#scaler.rel;\n    }\n    /**\n     * Returns a scaler for points based on width & height\n     */\n    get toAbsoluteFixed() {\n        return this.#scalerSize.abs;\n    }\n    /**\n     * Returns a scaler for points based on width & height\n     */\n    get toRelativeFixed() {\n        return this.#scalerSize.rel;\n    }\n    get logicalCenter() {\n        return {\n            x: this.#logicalSize.width / 2,\n            y: this.#logicalSize.height / 2\n        };\n    }\n    /**\n   * Returns a Scaler that converts from relative to absolute\n   * coordinates.\n   * This is based on the canvas size.\n   *\n   * ```js\n   * // Assuming a canvas of 800x600\n   * toAbsolute({ x: 1, y: 1 });      // { x: 800, y: 600}\n   * toAbsolute({ x: 0, y: 0 });      // { x: 0, y: 0}\n   * toAbsolute({ x: 0.5, y: 0.5 });  // { x: 400, y: 300}\n   * ```\n   */\n    get toAbsolute() {\n        return this.#scaler.abs;\n    }\n    /**\n     * Gets the center coordinate of the canvas\n     */\n    get center() {\n        return { x: this.width / 2, y: this.height / 2 };\n    }\n    /**\n     * Gets the image data for the canvas.\n     * Uses the 'physical' canvas size. Eg. A logical size of 400x400 might be\n     * 536x536 with a high-DPI display.\n     * @returns\n     */\n    getImageData() {\n        const size = this.getPhysicalSize();\n        const data = this.ctx.getImageData(0, 0, size.width, size.height, { colorSpace: this.opts.colourSpace });\n        if (data === null || data === undefined)\n            throw new Error(`Could not get image data from context`);\n        return data;\n    }\n    /**\n     * Returns the canvas frame data as a writable grid.\n     * When editing, make as many edits as needed before calling\n     * `flip`, which writes buffer back to the canvas.\n     * ```js\n        * const g = helper.getWritableBuffer();\n     * // Get {r,g,b,opacity} of pixel 10,10\n     * const pixel = g.get({ x: 10, y: 10 });\n     *\n     * // Set a colour to pixel 10,10\n     * g.set({ r: 0.5, g: 1, b: 0, opacity: 0 }, { x: 10, y: 10 });\n     *\n     * // Write buffer to canvas\n     * g.flip();\n     * ```\n     *\n     * Uses 'physical' size of canvas. Eg with a high-DPI screen, this will\n     * mean a higher number of rows and columns compared to the logical size.\n     * @returns\n     */\n    getWritableBuffer() {\n        const ctx = this.ctx;\n        const data = this.getImageData();\n        const grid = ImageDataGrid.grid(data);\n        const get = ImageDataGrid.accessor(data);\n        const set = ImageDataGrid.setter(data);\n        const flip = () => {\n            ctx.putImageData(data, 0, 0);\n        };\n        return { grid, get, set, flip };\n    }\n}\n// export const imageDataAsGrid = (canvas: HTMLCanvasElement, colorSpace: PredefinedColorSpace = `srgb`) => {\n//   const ctx = canvas.getContext(`2d`);\n//   if (!ctx) throw new Error(`Could not create context`);\n//   const data = ctx.getImageData(0, 0, canvas.width, canvas.height, { colorSpace });\n//   if (!data) throw new Error(`Could not get image data from context`);\n//   const get = ImageDataGrid.accessor(data);\n//   const set = ImageDataGrid.setter(data);\n// }\n","export const piPi = Math.PI * 2;\n","import { scalerTwoWay, clamp } from \"@ixfx/numbers\";\nimport { resolveEl, resolveElementTry } from \"@ixfx/dom\";\nimport { resultErrorToString } from \"@ixfx/guards\";\nimport { Points, Rects } from \"@ixfx/geometry\";\nimport { piPi } from \"./pi-pi.js\";\n/**\n * Manges the drawing for a region of a canvas\n */\nexport class CanvasSource {\n    #canvasEl;\n    #ctx;\n    #sizeBasis;\n    #sizeScaler;\n    #logicalSize;\n    #pixelScaling;\n    #regions = [];\n    constructor(canvasElementOrQuery, sizeBasis = `min`) {\n        this.#canvasEl = resolveEl(canvasElementOrQuery);\n        this.#sizeBasis = sizeBasis;\n        this.#pixelScaling = window.devicePixelRatio || 1;\n        this.#sizeScaler = this.#createSizeScaler();\n        this.#logicalSize = this.setLogicalSize({ width: this.#canvasEl.width, height: this.#canvasEl.height });\n    }\n    /**\n     * Set logical size for region\n     * @param size\n     * @returns\n     */\n    setLogicalSize(size) {\n        this.#logicalSize = size;\n        const el = this.#canvasEl;\n        el.width = (size.width * this.#pixelScaling);\n        el.height = (size.height * this.#pixelScaling);\n        el.style.width = `${(size.width).toString()}px`;\n        el.style.height = `${(size.height).toString()}px`;\n        this.#sizeScaler = this.#createSizeScaler();\n        this.invalidateContext();\n        return size;\n    }\n    #createSizeScaler() {\n        let inMax = 1;\n        switch (this.#sizeBasis) {\n            case `min`:\n                inMax = Math.min(this.#canvasEl.width, this.#canvasEl.height);\n                break;\n            case `max`:\n                inMax = Math.max(this.#canvasEl.width, this.#canvasEl.height);\n                break;\n        }\n        const s = scalerTwoWay(0, inMax, 0, 1);\n        return {\n            abs: s.in,\n            rel: s.out\n        };\n    }\n    /**\n     * Causes drawing context to be re-created\n     */\n    invalidateContext() {\n        this.#ctx = undefined;\n    }\n    #add(region) {\n        if (!region)\n            throw new Error(`Param 'region' is undefined/null`);\n        if (this.#regions.includes(region))\n            throw new Error(`Region already exists`);\n        this.#regions.push(region);\n        return region;\n    }\n    /**\n     * Convert relative to absolute\n     * @param pt\n     * @param kind\n     * @returns\n     */\n    toAbsPoint(pt, kind = `independent`) {\n        let { x, y } = pt;\n        switch (kind) {\n            case `independent`:\n                x *= this.width;\n                y *= this.height;\n        }\n        return { x, y };\n    }\n    /**\n     * Gets the offset x,y\n     */\n    get offset() {\n        const b = this.#canvasEl.getBoundingClientRect();\n        return { x: b.left, y: b.top };\n    }\n    /**\n     * Converts an absolute point to relative\n     * @param pt\n     * @param source\n     * @param kind\n     * @param clamped\n     * @returns\n     */\n    toRelPoint(pt, source, kind = `independent`, clamped = true) {\n        let { x, y } = pt;\n        if (source === `screen`) {\n            const b = this.#canvasEl.getBoundingClientRect();\n            x -= b.x;\n            y -= b.y;\n        }\n        switch (kind) {\n            case `independent`:\n                x /= this.width;\n                y /= this.height;\n                break;\n            case `skip`:\n                break;\n        }\n        if (clamped) {\n            x = clamp(x);\n            y = clamp(y);\n        }\n        return { x, y };\n    }\n    /**\n     * Converts a rectangle to absolute coordinates\n     * @param rect\n     * @param kind\n     * @returns\n     */\n    toAbsRect(rect, kind = `independent`) {\n        let { width, height } = rect;\n        switch (kind) {\n            case `independent`:\n                width *= this.width;\n                height *= this.height;\n                if (Rects.isRectPositioned(rect)) {\n                    return {\n                        ...this.toAbsPoint(rect),\n                        width,\n                        height\n                    };\n                }\n        }\n        return { width, height };\n    }\n    /**\n     * Creates a region\n     *\n     * Absolute positioned. Uses source coordinates which don't change\n     * ```js\n     * source.createRegion({\n     *  absPositioned: { x: 0, y: 0, width: 100, height: 100}\n     * });\n     * ```\n     *\n     * Relative positioned. Uses coordiantes relative to source dimensions.\n     * Updated if source changes.\n     * ```js\n     * source.createRegion({\n     *  relativePositioned: { x: 0, y:0, width: 1, height: 0.5 },\n     *  scale: `independent`\n     * });\n     * ```\n     *\n     * Relative sized. Uses size relative to source dimension. By default centers.\n     * ```js\n     * source.createRegion({\n     *  relativeSize: { width: 0.5, height: 0.5 }\n     *  position: `center`\n     * })\n     * ```\n     * @param spec\n     * @returns\n     */\n    createRegion(spec) {\n        const marginPx = spec.marginPx ?? 0;\n        const marginPx2 = marginPx * 2;\n        if (`absPositioned` in spec) {\n            const rect = Rects.subtractSize(spec.absPositioned, marginPx, marginPx);\n            return this.#add(new CanvasRegion(this, () => rect));\n        }\n        if (`relativePositioned` in spec) {\n            let compute;\n            const rect = spec.relativePositioned;\n            switch (spec.scale) {\n                case `independent`:\n                    compute = (source) => ({\n                        x: (rect.x * source.width) + marginPx,\n                        y: (rect.y * source.height) + marginPx,\n                        width: (rect.width * source.width) - marginPx2,\n                        height: (rect.height * source.height) - marginPx2\n                    });\n                    break;\n                default:\n                    throw new Error(`Param 'kind' unknown (${spec.scale})`);\n            }\n            return this.#add(new CanvasRegion(this, compute));\n        }\n        if (`relativeSize` in spec) {\n            let compute;\n            const rect = spec.relativeSize;\n            const position = spec.position;\n            switch (spec.scale) {\n                case `independent`:\n                    compute = (source) => {\n                        const width = (rect.width * source.width) - marginPx2;\n                        const height = (rect.height * source.height) - marginPx2;\n                        let x = source.width / 2 - width / 2;\n                        let y = source.height / 2 - height / 2;\n                        switch (position) {\n                            case `n`:\n                                y = 0;\n                                break;\n                            case `s`:\n                                y = source.height - height;\n                                break;\n                            default:\n                            /** no-op, */\n                        }\n                        x += marginPx;\n                        y += marginPx;\n                        return { width, height, x, y };\n                    };\n                    break;\n                default:\n                    throw new Error(`Param 'kind' unknown (${spec.scale})`);\n            }\n            return this.#add(new CanvasRegion(this, compute));\n        }\n        if (`match` in spec) {\n            const result = resolveElementTry(spec.match);\n            if (!result.success) {\n                throw new Error(`Could not resolve match element. ${resultErrorToString(result)}`);\n            }\n            const compute = (_source) => {\n                const bounds = result.value.getBoundingClientRect();\n                return {\n                    x: bounds.x + marginPx,\n                    y: bounds.y + marginPx,\n                    width: bounds.width - marginPx2,\n                    height: bounds.height - marginPx2\n                };\n            };\n            return this.#add(new CanvasRegion(this, compute));\n        }\n        throw new Error(`Spec doesn't seem valid`);\n    }\n    /**\n     * Clears the region of the canvas\n     */\n    clear() {\n        const c = this.context;\n        c.clearRect(0, 0, this.width, this.height);\n    }\n    /**\n     * Gets - or creates - the drawing context\n     */\n    get context() {\n        if (this.#ctx)\n            return this.#ctx;\n        const c = this.#canvasEl.getContext(`2d`);\n        if (!c)\n            throw new Error(`Could not create 2d context`);\n        c.setTransform(1, 0, 0, 1, 0, 0);\n        c.scale(this.#pixelScaling, this.#pixelScaling);\n        this.#ctx = c;\n        for (const r of this.#regions) {\n            r.recomputeRegion();\n        }\n        return this.#ctx;\n    }\n    /**\n     * Gets a scaler for size\n     */\n    get sizeScaler() {\n        return this.#sizeScaler;\n    }\n    /**\n     * Gets the logical width\n     */\n    get width() {\n        return this.#logicalSize.width;\n    }\n    /**\n     * Gets the logical height\n     */\n    get height() {\n        return this.#logicalSize.height;\n    }\n}\n/**\n * Draws on a canvas, constrained to a specific region\n */\nexport class CanvasRegion {\n    source;\n    #regionCompute;\n    #r;\n    /**\n     * Creates, using coordinate in canvas coordinates\n     */\n    constructor(source, regionCompute) {\n        this.source = source;\n        this.#regionCompute = regionCompute;\n        this.#r = regionCompute(source);\n    }\n    /**\n     * Calls the original `regionCompute` function passed in to the constructor\n     * to recompute the absolute region\n     */\n    recomputeRegion() {\n        this.#r = this.#regionCompute(this.source);\n    }\n    /**\n     * Converts a region-relative point (0..1) to an absolute\n     * point, which uses region-relative coordinates.\n     *\n     * Eg if the region had an x,y of 100,100, `toAbsRegion({x:0,y:0})`\n     * will return 0,0.\n     *\n     * @param regionRel\n     * @param scaleBy\n     * @returns\n     */\n    toAbsRegion(regionRel, scaleBy = `both`) {\n        switch (scaleBy) {\n            case `both`:\n                return {\n                    x: regionRel.x * this.#r.width,\n                    y: regionRel.y * this.#r.height\n                };\n                break;\n        }\n    }\n    /**\n     * Returns a copy of `p` offset by the region's x & y\n     * @param p\n     * @returns\n     */\n    applyRegionOffset(p) {\n        return {\n            x: p.x + this.#r.x,\n            y: p.y + this.#r.y\n        };\n    }\n    /**\n     * Draws a line from a series of points.\n     * Assumes region-relative, % coordinates (ie 0..1 scale)\n     * @param relativePoints Points to connect, in region-relative coordinates\n     * @param strokeStyle Stroke style\n     * @param lineWidth Line with\n     */\n    drawConnectedPointsRelative(relativePoints, strokeStyle, lineWidth = 1) {\n        const points = relativePoints.map(p => this.toAbsRegion(p));\n        this.drawConnectedPoints(points, strokeStyle, lineWidth);\n    }\n    /**\n     * Draws connected points in absolute coordinates,\n     * however with 0,0 being the top-left of the region.\n     *\n     * Thus, this will apply the region offset before drawing.\n     * @param points Points to draw\n     * @param strokeStyle Stroke style\n     * @param lineWidth Line width\n     */\n    drawConnectedPoints(points, strokeStyle, lineWidth = 1) {\n        const c = this.context;\n        c.save();\n        c.translate(this.#r.x, this.#r.y);\n        c.beginPath();\n        c.strokeStyle = strokeStyle;\n        c.lineWidth = lineWidth;\n        for (let index = 0; index < points.length; index++) {\n            if (index === 0) {\n                c.moveTo(points[index].x, points[index].y);\n            }\n            else {\n                c.lineTo(points[index].x, points[index].y);\n            }\n        }\n        c.stroke();\n        c.restore();\n    }\n    /**\n     * Fills text at a relative position\n     * @param text\n     * @param relPos Relative, meaning 0.5,0.5 is the middle of the region\n     * @param fillStyle\n     * @param baseline\n     * @param align\n     */\n    fillTextRelative(text, relPos, fillStyle = `black`, font, baseline = `alphabetic`, align = `start`) {\n        const point = this.toAbsRegion(relPos);\n        this.fillTextRelative(text, point, fillStyle, font, baseline, align);\n    }\n    /**\n     * Fills text at a region-relative position\n     * @param text\n     * @param point Region relative, meaning 0,0 is top-left of region\n     * @param fillStyle\n     * @param baseline\n     * @param align\n     */\n    fillText(text, point, fillStyle = `black`, font, baseline = `alphabetic`, align = `start`) {\n        const c = this.context;\n        c.save();\n        c.translate(this.#r.x, this.#r.y);\n        if (font.length > 0) {\n            c.font = font;\n        }\n        c.textBaseline = baseline;\n        c.textAlign = align;\n        c.fillStyle = fillStyle;\n        c.fillText(text, point.x, point.y);\n        c.restore();\n    }\n    drawCircles(relativeCircles, fillStyle, strokeStyle = ``, lineWidth = 1) {\n        const circles = relativeCircles.map(c => {\n            return {\n                ...this.toAbsRegion(c),\n                radius: this.source.sizeScaler.abs(c.radius)\n            };\n        });\n        const c = this.context;\n        c.save();\n        c.translate(this.#r.x, this.#r.y);\n        c.fillStyle = fillStyle;\n        c.strokeStyle = strokeStyle;\n        c.lineWidth = lineWidth;\n        for (const circle of circles) {\n            c.beginPath();\n            c.arc(circle.x, circle.y, circle.radius, 0, piPi);\n            c.closePath();\n            if (fillStyle.length > 0) {\n                c.fill();\n            }\n            if (strokeStyle.length > 0) {\n                c.stroke();\n            }\n        }\n        c.restore();\n    }\n    /**\n     * Clears the region\n     */\n    clear() {\n        const c = this.context;\n        c.clearRect(this.#r.x, this.#r.y, this.#r.width, this.#r.height);\n    }\n    /**\n     * Fills the region\n     * @param fillStyle\n     */\n    fill(fillStyle = `white`) {\n        const c = this.context;\n        c.fillStyle = fillStyle;\n        c.fillRect(this.#r.x, this.#r.y, this.#r.width, this.#r.height);\n    }\n    /**\n     * For debugging, draws an outline of the bounds\n     * @param strokeStyle\n     * @param lineWidth\n     */\n    drawBounds(strokeStyle, lineWidth = 1) {\n        this.drawConnectedPointsRelative([\n            { x: 0, y: 0 },\n            { x: 1, y: 0 },\n            { x: 1, y: 1 },\n            { x: 0, y: 1 },\n            { x: 0, y: 0 }\n        ], strokeStyle, lineWidth);\n        this.drawConnectedPointsRelative([\n            { x: 0, y: 1 },\n            { x: 1, y: 0 }\n        ], strokeStyle, lineWidth);\n        this.drawConnectedPointsRelative([\n            { x: 0, y: 0 },\n            { x: 1, y: 1 }\n        ], strokeStyle, lineWidth);\n    }\n    /**\n     * Converts a  point to a region-relative one.\n     * @param pt\n     * @param kind\n     * @returns\n     */\n    toRelPoint(pt, source = `screen`, kind = `independent`, clamped = true) {\n        pt = this.source.toRelPoint(pt, source, `skip`, false);\n        let { x, y } = pt;\n        x -= this.x;\n        y -= this.y;\n        switch (kind) {\n            case `independent`:\n                x /= this.width;\n                y /= this.height;\n        }\n        if (clamped) {\n            x = clamp(x);\n            y = clamp(y);\n        }\n        return { x, y };\n    }\n    /**\n     * Converts absolute to region point\n     * @param pt\n     * @param source\n     * @param clamped\n     * @returns\n     */\n    absToRegionPoint(pt, source, clamped) {\n        if (source === `screen`) {\n            pt = Points.subtract(pt, this.source.offset);\n        }\n        let { x, y } = pt;\n        x -= this.x;\n        y -= this.y;\n        if (clamped) {\n            if (x < 0)\n                x = 0;\n            if (y < 0)\n                y = 0;\n            if (x > this.width + this.x)\n                x = this.x + this.width;\n            if (y > this.height + this.y)\n                y = this.y + this.height;\n        }\n        return { x, y };\n    }\n    /**\n     * Get center of region\n     */\n    get center() {\n        return Rects.center(this.#r);\n    }\n    /**\n     * Gets the drawing context\n     */\n    get context() {\n        return this.source.context;\n    }\n    /**\n     * SEts the region\n     */\n    set region(value) {\n        this.#r = value;\n    }\n    /**\n     * Gets the region\n     */\n    get region() {\n        return this.#r;\n    }\n    /**\n     * Gets the width\n     */\n    get width() {\n        return this.#r.width;\n    }\n    /**\n     * Gets the height\n     */\n    get height() {\n        return this.#r.height;\n    }\n    /**\n     * Gets the x offset\n     */\n    get x() {\n        return this.#r.x;\n    }\n    /**\n     * Gets they y offset\n     */\n    get y() {\n        return this.#r.y;\n    }\n    /**\n     * Gets the width/height, whichever is smaller\n     */\n    get dimensionMin() {\n        return Math.min(this.#r.width, this.#r.height);\n    }\n}\n","/**\n * Applies drawing options to given SVG element.\n * Applies: fillStyle\n * @param elem Element\n * @param opts Drawing options\n */\nexport const applyOpts = (elem, opts) => {\n    if (opts.fillStyle)\n        elem.setAttributeNS(null, `fill`, opts.fillStyle);\n    if (opts.opacity) {\n        elem.setAttributeNS(null, `opacity`, opts.opacity.toString());\n    }\n};\n","import {} from '@ixfx/geometry/rect';\n/**\n * Get the bounds of an SVG element (determined by its width/height attribs)\n * @param svg\n * @returns\n */\nexport const getBounds = (svg) => {\n    const w = svg.getAttributeNS(null, `width`);\n    const width = w === null ? 0 : Number.parseFloat(w);\n    const h = svg.getAttributeNS(null, `height`);\n    const height = h === null ? 0 : Number.parseFloat(h);\n    return { width, height };\n};\n/**\n * Set the bounds of an element, using its width/height attribs.\n * @param svg\n * @param bounds\n */\nexport const setBounds = (svg, bounds) => {\n    svg.setAttributeNS(null, `width`, bounds.width.toString());\n    svg.setAttributeNS(null, `height`, bounds.height.toString());\n};\n","/**\n * Creates an element of `type` and with `id` (if specified)\n * @param type Element type, eg `circle`\n * @param id Optional id to assign to element\n * @returns Element\n */\nexport const createEl = (type, id) => {\n    const m = document.createElementNS(`http://www.w3.org/2000/svg`, type);\n    if (id) {\n        m.id = id;\n    }\n    return m;\n};\n/**\n * Creates and appends a SVG element.\n *\n * ```js\n * // Create a circle\n * const circleEl = createOrResolve(parentEl, `SVGCircleElement`);\n * ```\n *\n * If `queryOrExisting` is specified, it is used as a query to find an existing element. If\n * query starts with `#`, this will be set as the element id, if created.\n *\n * ```js\n * // Creates an element with id 'myCircle' if it doesn't exist\n * const circleEl = createOrResolve(parentEl, `SVGCircleElement`, `#myCircle`);\n * ```\n * @param parent Parent element\n * @param type Type of SVG element\n * @param queryOrExisting Query, eg `#id`\n * @returns\n */\nexport const createOrResolve = (parent, type, queryOrExisting, suffix) => {\n    let existing = null;\n    if (queryOrExisting !== undefined) {\n        existing = typeof queryOrExisting === `string` ? parent.querySelector(queryOrExisting) : queryOrExisting;\n    }\n    if (existing === null) {\n        const p = document.createElementNS(`http://www.w3.org/2000/svg`, type);\n        parent.append(p);\n        if (queryOrExisting && typeof queryOrExisting === `string` &&\n            queryOrExisting.startsWith(`#`)) {\n            p.id = suffix !== undefined && !queryOrExisting.endsWith(suffix) ? queryOrExisting.slice(1) + suffix : queryOrExisting.slice(1);\n        }\n        return p;\n    }\n    return existing;\n};\n","import { numberTest, resultThrow } from '@ixfx/guards';\nimport {} from '@ixfx/random';\nimport { scalar as hslScalar, toCssString } from './hsl.js';\n/**\n * Returns a full HSL colour string (eg `hsl(20,50%,75%)`) based on a index.\n * It's useful for generating perceptually different shades as the index increments.\n *\n * ```\n * el.style.backgroundColor = goldenAgeColour(10);\n * ```\n *\n * Saturation and lightness can be specified, as numeric ranges of 0-1.\n *\n * @param saturation Saturation (0-1), defaults to 0.5\n * @param lightness Lightness (0-1), defaults to 0.75\n * @param alpha Opacity (0-1), defaults to 1.0\n * @returns HSL colour string eg `hsl(20,50%,75%)`\n */\nexport const goldenAngleColour = (index, saturation = 0.5, lightness = 0.75, alpha = 1) => {\n    resultThrow(numberTest(index, `positive`, `index`), numberTest(saturation, `percentage`, `saturation`), numberTest(lightness, `percentage`, `lightness`), numberTest(alpha, `percentage`, `alpha`));\n    // Via Stackoverflow\n    const hueDeg = index * 137.508; // use golden angle approximation\n    const hueRel = (hueDeg % 360) / 360;\n    return toCssString(hslScalar(hueRel, saturation, lightness, alpha));\n    //return alpha === 1 ? `hsl(${ hue },${ saturation * 100 }%,${ lightness * 100 }%)` : `hsl(${ hue },${ saturation * 100 }%,${ lightness * 100 }%,${ alpha * 100 }%)`;\n};\n/**\n * Returns a random hue component (0..359)\n *\n * ```\n * // Generate hue\n * const h = randomHue(); // 0-359\n *\n * // Generate hue and assign as part of a HSL string\n * el.style.backgroundColor = `hsl(${randomHue(), 50%, 75%})`;\n * ```\n * @param rand\n * @returns\n */\nexport const randomHue = (rand = Math.random) => rand() * 360;\n","import { toColour, toCssColour } from './conversion.js';\nimport * as HslSpace from './hsl.js';\nimport * as SrgbSpace from './srgb.js';\nimport { clamp } from '@ixfx/numbers';\nimport { OklchSpace } from './index.js';\nimport * as C from 'colorizr';\n/**\n * Multiplies the opacity of a colour by `amount`, returning a computed CSS colour.\n *\n * ```js\n * multiplyOpacity(`red`, 0.5); // Returns a colour string\n * ```\n *\n * For example, to half the opacity, use `amount: 0.5`.\n * Clamps the result to ensure it's between 0..1\n * @param colourish Colour\n * @param amount Amount\n * @returns\n */\nexport function multiplyOpacity(colourish, amount) {\n    return withOpacity(colourish, o => clamp(o * amount));\n}\n/**\n * Does a computation with the opacity of a colour, returning colour.\n *\n * Passes operation to `HslSpace` or `SrgbSpace` depending on space of `colourish`.\n * @param colourish Colour\n * @param fn Function that takes original opacity as input and returns output opacity\n */\nexport function withOpacity(colourish, fn) {\n    const colour = toColour(colourish);\n    let result;\n    switch (colour.space) {\n        case `hsl`:\n            result = HslSpace.withOpacity(colour, fn);\n            break;\n        case `srgb`:\n            result = SrgbSpace.withOpacity(colour, fn);\n            break;\n        case `oklch`:\n            result = OklchSpace.withOpacity(colour, fn);\n            break;\n        default:\n            throw new Error(`Unknown space: '${colour.space}'. Expected hsl, srgb, oklch`);\n    }\n    if (!result)\n        throw new Error(`Is colour in correct form?`);\n    // If input type was string, return result as string\n    if (typeof colourish === `string`) {\n        return toCssColour(result);\n    }\n    return result;\n}\n;\nexport function setOpacity(colourish, opacity) {\n    const colour = toColour(colourish);\n    colour.opacity = opacity;\n    if (typeof colourish === `string`) {\n        return toCssColour(colour);\n    }\n    return colour;\n}\n// export function lighten(colour: string, amount: number): string;\n// export function lighten(colour: Colour, amount: number): Colour;\n// export function lighten(colourish: Colourish, amount: number): Colourish {\n//   const asString = toCssColour(colourish);\n//   const result = C.lighten(asString, amount, ``)\n// }\n// export const multiplySaturation = (colour: Colourish, amt: number): string => {\n//   throwNumberTest(amt, `percentage`, `amt`);\n//   const c = structuredToColorJs(colour);\n//   c.s = (c.s ?? 0) * amt;\n//   return c.toString();\n// };\n","import { pairwise } from '@ixfx/arrays';\nimport * as HslSpace from './hsl.js';\nimport { convert, toCssColour } from \"./conversion.js\";\nimport { convertScalar, OklchSpace, SrgbSpace } from \"./index.js\";\nfunction interpolateInit(colours, destination = `hsl`) {\n    if (!Array.isArray(colours))\n        throw new Error(`Param 'colours' is not an array as expected. Got: ${typeof colours}`);\n    if (colours.length < 2)\n        throw new Error(`Param 'colours' should be at least two in length. Got: ${colours.length}`);\n    const c = colours.map(colour => convertScalar(colour, destination));\n    return [...pairwise(c)];\n}\n/**\n * Returns a CSS `linear-gradient` with stops corresponding to the given list of `colours`.\n * ```js\n * element.style.background = Colour.cssLinearGradient(['red','green','blue']);\n * ```\n * @param colours\n * @returns\n */\nexport const cssLinearGradient = (colours) => {\n    const c = colours.map(c => toCssColour(c));\n    return `linear-gradient(to right, ${c.join(`, `)})`;\n};\n/**\n * Returns a function that interpolates between two colours. Returns string colour values.\n *\n * By default takes a shorter direction and uses the OkLCH colourspace.\n * ```js\n * const i = interpolator(`blue`, `red`);\n * i(0.5); // Get the colour at 50%, as a string.\n * ```\n *\n * To work with structured colour values, use one of the space's `interpolate` functions.\n *\n * If you want to create discrete steps, consider {@link createSteps} or {@link scale}.\n *\n * @param colourA\n * @param colourB\n * @param options\n * @returns\n */\nexport const interpolator = (colourA, colourB, options = {}) => {\n    const space = options.space ?? `oklch`;\n    const direction = options.direction ?? `shorter`;\n    let inter;\n    switch (space) {\n        case `hsl`:\n            inter = HslSpace.interpolator(convert(colourA, `hsl-scalar`), convert(colourB, `hsl-scalar`), direction);\n            break;\n        case `srgb`:\n            inter = SrgbSpace.interpolator(convert(colourA, `srgb-scalar`), convert(colourB, `srgb-scalar`));\n            break;\n        default:\n            inter = OklchSpace.interpolator(convert(colourA, `oklch-scalar`), convert(colourB, `oklch-scalar`), direction);\n    }\n    return (amount) => toCssColour(inter(amount));\n};\n/**\n * Produces a stepped scale of colours.\n *\n * Builds off {@link createSteps} which can only step between two colours.\n *\n * ```js\n * // A scale of from red to green, with three colours in-between\n * const steps = Colour.scale([ `red`, `green` ], { stepsBetween: 3 });\n * for (const step of steps) {\n *  // A CSS colour string\n * }\n * ```\n *\n * {@link cssLinearGradient} can produce a smooth gradient in CSS on the basis\n * of the stepped colours.\n * @param colours\n * @param opts\n * @returns\n */\nexport const scale = (colours, opts = {}) => {\n    const direction = opts.direction ?? `shorter`;\n    const space = opts.space ?? `oklch`;\n    const pieces = interpolateInit(colours, space);\n    let stepsBetween = 0;\n    if (typeof opts.stepsBetween === `number`) {\n        stepsBetween = opts.stepsBetween;\n        if (stepsBetween < 1)\n            throw new Error(`Param 'stepsBetween' must be at least 1`);\n    }\n    else if (typeof opts.stepsTotal === `number`) {\n        if (opts.stepsTotal <= colours.length)\n            throw new Error(`Param 'stepsTotal' must be greater than number of provided colour stops (${colours.length}) +1 per stop`);\n        const totalSteps = opts.stepsTotal - colours.length;\n        stepsBetween = Math.floor(totalSteps / pieces.length);\n    }\n    const steps = pieces.map((piece) => {\n        //const pieceSteps = HslSpace.createSteps(piece[ 0 ], piece[ 1 ], stepsBetween, direction, true);\n        const pieceSteps = createSteps(piece[0], piece[1], { steps: stepsBetween, space, direction, exclusive: true });\n        // Add end colour\n        pieceSteps.push(piece[1]);\n        return pieceSteps;\n    });\n    // Add very first colour\n    const firstPiece = pieces[0];\n    steps.unshift([firstPiece[0]]);\n    return steps.flat().map(c => toCssColour(c));\n};\nexport function createSteps(a, b, options = {}) {\n    const exclusive = options.exclusive ?? false;\n    const steps = options.steps ?? 5;\n    const space = options.space ?? `oklch`;\n    const direction = options.direction ?? `shorter`;\n    if (!exclusive && steps < 2)\n        throw new Error(`Param 'steps' should be at least 2 when 'exclusive' is false`);\n    if (exclusive && steps < 1)\n        throw new Error(`Param 'steps' should be at least 1 when 'exlusive' is true`);\n    const aa = convertScalar(a, space);\n    const bb = convertScalar(b, space);\n    // Create interpolator\n    let inter;\n    switch (space) {\n        case `hsl`:\n            inter = HslSpace.interpolator(aa, bb, direction);\n            break;\n        case `oklch`:\n            inter = OklchSpace.interpolator(aa, bb, direction);\n            break;\n        case `srgb`:\n            inter = SrgbSpace.interpolator(aa, bb);\n            break;\n        default:\n            throw new Error(`Colour space '${space}' not supported for interpolation.`);\n    }\n    if (!inter)\n        throw new Error(`Could not create interpolator for space: ${space}`);\n    let stepBy = 0;\n    let startAt = 0;\n    let endAt = 1;\n    if (exclusive) {\n        stepBy = 1 / (steps + 1);\n        startAt = stepBy;\n        endAt = 1 - stepBy;\n    }\n    else {\n        stepBy = 1 / (steps - 1);\n    }\n    const results = [];\n    for (let interpolateAmount = startAt; interpolateAmount <= endAt; interpolateAmount += stepBy) {\n        results.push(inter(interpolateAmount));\n    }\n    return results;\n}\n","export * from './conversion.js';\nexport * from './css-colours.js';\nexport * from './generate.js';\nexport * from './guards.js';\n//export * from './interpolate.js';\nexport * from './math.js';\nexport * from './interpolate.js';\nexport * as HslSpace from './hsl.js';\nexport * as OklchSpace from './oklch.js';\nexport * as SrgbSpace from './srgb.js';\nexport * from './types.js';\n","import Colorizr, * as C from \"colorizr\";\nimport {} from \"./types.js\";\nimport * as SrgbSpace from \"./srgb.js\";\nimport * as HslSpace from './hsl.js';\nimport * as OkLchSpace from './oklch.js';\nimport { fromCssColour } from \"./css-colours.js\";\nimport { isHsl, isRgb, tryParseObjectToRgb, tryParseObjectToHsl, isColourish, isOkLch } from \"./guards.js\";\nimport { OklchSpace } from \"./index.js\";\n/**\n * Converts an object or string representation of colour to ixfx's\n * structured colour.\n * Use {@link convertToString} if you want a CSS colour string instead.\n * @param colour\n * @param destination\n * @returns\n */\nexport function convert(colour, destination) {\n    if (destination === `hsl-scalar`) {\n        if (typeof colour === `string` || isHsl(colour) || isRgb(colour)) {\n            return HslSpace.toScalar(colour);\n        }\n    }\n    else if (destination === `hsl-absolute`) {\n        if (typeof colour === `string` || isHsl(colour)) {\n            return HslSpace.toAbsolute(colour);\n        }\n    }\n    else if (destination === `oklch-scalar`) {\n        if (typeof colour === `string` || isOkLch(colour)) {\n            return OkLchSpace.toScalar(colour);\n        }\n    }\n    else if (destination === `oklch-absolute`) {\n        if (typeof colour === `string` || isOkLch(colour)) {\n            return OkLchSpace.toAbsolute(colour);\n        }\n    }\n    else if (destination === `srgb-8bit`) {\n        if (typeof colour === `string` || isRgb(colour)) {\n            return SrgbSpace.to8bit(colour);\n        }\n    }\n    else if (destination === `srgb-scalar`) {\n        if (typeof colour === `string` || isRgb(colour)) {\n            return SrgbSpace.toScalar(colour);\n        }\n    }\n    else {\n        throw new Error(`Destination '${destination}' not supported for input: ${JSON.stringify(colour)}`);\n    }\n    return convert(toCssColour(colour), destination);\n}\n/**\n * Like {@link convert}, but result is a CSS colour string\n * @param colour\n * @param destination\n * @returns\n */\nexport function convertToString(colour, destination) {\n    const c = convert(colour, destination);\n    return toCssColour(c);\n}\nexport function convertScalar(colour, destination) {\n    if (destination === `oklch`)\n        return convert(colour, `oklch-scalar`);\n    if (destination === `srgb`)\n        return convert(colour, `srgb-scalar`);\n    if (destination === `hsl`)\n        return convert(colour, `hsl-scalar`);\n    throw new Error(`Unknown destination: '${destination}'`);\n}\nexport const toCssColour = (colour) => {\n    if (typeof colour === `string`)\n        return colour;\n    if (isHsl(colour)) {\n        return HslSpace.toCssString(colour);\n    }\n    if (isRgb(colour)) {\n        return SrgbSpace.toCssString(colour);\n    }\n    if (isOkLch(colour)) {\n        return OklchSpace.toCssString(colour);\n    }\n    const asRgb = tryParseObjectToRgb(colour);\n    if (asRgb)\n        return SrgbSpace.toCssString(asRgb);\n    const asHsl = tryParseObjectToHsl(colour);\n    if (asHsl)\n        return HslSpace.toCssString(asHsl);\n    throw new Error(`Unknown colour format: '${JSON.stringify(colour)}'`);\n};\nexport const toHexColour = (colour) => {\n    if (isHsl(colour)) {\n        return HslSpace.toHexString(colour);\n    }\n    if (isRgb(colour)) {\n        return SrgbSpace.toHexString(colour);\n    }\n    if (isOkLch(colour)) {\n        return OklchSpace.toHexString(colour);\n    }\n    if (typeof colour === `string`) {\n        if (colour.startsWith(`#`))\n            return colour;\n        const c = convert(colour, `srgb-8bit`);\n        return SrgbSpace.toHexString(c);\n    }\n    const asRgb = tryParseObjectToRgb(colour);\n    if (asRgb)\n        return SrgbSpace.toHexString(asRgb);\n    const asHsl = tryParseObjectToHsl(colour);\n    if (asHsl)\n        return HslSpace.toHexString(asHsl);\n    throw new Error(`Unknown colour format: '${JSON.stringify(colour)}'`);\n};\nexport const toLibraryColour = (colour) => {\n    const asCss = toCssColour(colour);\n    return new Colorizr(asCss);\n};\n// export const convertColourString = (colour: string, destination: 'hex' | 'hsl' | 'oklab' | 'oklch' | 'srgb' | `rgb`): string => {\n//   if (destination === `srgb`) destination = `rgb`;\n//   return C.convert(colour, destination);\n// }\nexport const guard = (colour) => {\n    switch (colour.space) {\n        case `hsl`:\n            HslSpace.guard(colour);\n            break;\n        case `srgb`:\n            SrgbSpace.guard(colour);\n            break;\n        case `oklch`:\n            OkLchSpace.guard(colour);\n            break;\n        default:\n            throw new Error(`Unsupported colour space: '${colour.space}'`);\n    }\n};\nexport const toColour = (colourish) => {\n    if (!isColourish(colourish))\n        throw new Error(`Could not parse input. Expected CSS colour string or structured colour {r,g,b}, {h,s,l} etc. Got: ${JSON.stringify(colourish)}`);\n    let c;\n    if (typeof colourish === `string`)\n        c = fromCssColour(colourish);\n    else\n        c = colourish;\n    if (c === undefined)\n        throw new Error(`Could not parse input. Expected CSS colour string or structured colour {r,g,b}, {h,s,l} etc.`);\n    guard(c);\n    return c;\n};\n/**\n * Returns a CSS-ready string\n * representation.\n * ```js\n * element.style.backgroundColor = resolveToString(`red`);\n * ```\n *\n * Tries each parameter in turn, returning the value\n * for the first that resolves. This can be useful for\n * having fallback values.\n *\n * ```js\n * // Try a CSS variable, a object property or finally fallback to red.\n * element.style.backgroundColor = toStringFirst('--some-var', opts.background, `red`);\n * ```\n * @param colours Array of colours to resolve\n * @returns\n */\nexport const toStringFirst = (...colours) => {\n    for (const colour of colours) {\n        if (colour === undefined)\n            continue;\n        if (colour === null)\n            continue;\n        try {\n            const c = toColour(colour);\n            return toCssColour(c);\n        }\n        catch { /* empty */ }\n    }\n    return `rebeccapurple`;\n};\nexport function rgbToHsl(rgb, scalarResult) {\n    // Needed because the Colorizr package has broken RGB to HSL\n    // Converts rgb { model: 'rgb', r: 40, g: 20, b: 60, alpha: undefined }\n    // to : { h: 270, s: 50, l: 0.06 }\n    // when it should be: { h: 270, s: 50, l: 40 }\n    // Source: https://www.jameslmilner.com/posts/converting-rgb-hex-hsl-colors/\n    let { r, g, b } = rgb;\n    const opacity = rgb.opacity ?? 1;\n    if (rgb.unit === `8bit`) {\n        r /= 255;\n        g /= 255;\n        b /= 255;\n    }\n    const max = Math.max(r, g, b);\n    const min = Math.min(r, g, b);\n    let h = (max + min) / 2;\n    let s = h;\n    const l = h;\n    if (max === min) {\n        // Achromatic\n        if (scalarResult) {\n            return HslSpace.scalar(0, 0, 0, opacity);\n        }\n        else {\n            return HslSpace.absolute(0, 0, 0, opacity);\n        }\n    }\n    const d = max - min;\n    s = l >= 0.5 ? d / (2 - (max + min)) : d / (max + min);\n    switch (max) {\n        case r:\n            h = ((g - b) / d + 0) * 60;\n            break;\n        case g:\n            h = ((b - r) / d + 2) * 60;\n            break;\n        case b:\n            h = ((r - g) / d + 4) * 60;\n            break;\n    }\n    if (scalarResult) {\n        return HslSpace.scalar(h / 360, s, l, opacity);\n    }\n    else {\n        return HslSpace.absolute(h, s * 100, l * 100, opacity);\n    }\n}\n","/**\n * Applies drawing options to given SVG element.\n * Applies: strokeStyle, strokeWidth, strokeDash, strokeLineCap\n * @param elem Element\n * @param opts\n */\nexport const applyStrokeOpts = (elem, opts) => {\n    if (opts.strokeStyle)\n        elem.setAttributeNS(null, `stroke`, opts.strokeStyle);\n    if (opts.strokeWidth) {\n        elem.setAttributeNS(null, `stroke-width`, opts.strokeWidth.toString());\n    }\n    if (opts.strokeDash)\n        elem.setAttribute(`stroke-dasharray`, opts.strokeDash);\n    if (opts.strokeLineCap) {\n        elem.setAttribute(`stroke-linecap`, opts.strokeLineCap);\n    }\n};\n","import { applyOpts } from \"./apply.js\";\nimport { createEl, createOrResolve } from \"./create.js\";\nexport const createMarker = (id, opts, childCreator) => {\n    const m = createEl(`marker`, id);\n    if (opts.markerWidth) {\n        m.setAttribute(`markerWidth`, opts.markerWidth?.toString());\n    }\n    if (opts.markerHeight) {\n        m.setAttribute(`markerHeight`, opts.markerHeight?.toString());\n    }\n    if (opts.orient)\n        m.setAttribute(`orient`, opts.orient.toString());\n    else\n        m.setAttribute(`orient`, `auto-start-reverse`);\n    if (opts.viewBox)\n        m.setAttribute(`viewBox`, opts.viewBox.toString());\n    if (opts.refX)\n        m.setAttribute(`refX`, opts.refX.toString());\n    if (opts.refY)\n        m.setAttribute(`refY`, opts.refY.toString());\n    if (childCreator) {\n        const c = childCreator();\n        m.appendChild(c);\n    }\n    return m;\n};\nexport const markerPrebuilt = (elem, opts, _context) => {\n    if (elem === null)\n        return `(elem null)`;\n    const parent = elem.ownerSVGElement;\n    if (parent === null)\n        throw new Error(`parent for elem is null`);\n    const defsEl = createOrResolve(parent, `defs`, `defs`);\n    //eslint-disable-next-line functional/no-let\n    let defEl = defsEl.querySelector(`#${opts.id}`);\n    if (defEl !== null) {\n        return `url(#${opts.id})`;\n    }\n    if (opts.id === `triangle`) {\n        opts = { ...opts, strokeStyle: `transparent` };\n        if (!opts.markerHeight)\n            opts = { ...opts, markerHeight: 6 };\n        if (!opts.markerWidth)\n            opts = { ...opts, markerWidth: 6 };\n        if (!opts.refX)\n            opts = { ...opts, refX: opts.markerWidth };\n        if (!opts.refY)\n            opts = { ...opts, refY: opts.markerHeight };\n        if (!opts.fillStyle || opts.fillStyle === `none`) {\n            opts = { ...opts, fillStyle: `black` };\n        }\n        if (!opts.viewBox)\n            opts = { ...opts, viewBox: `0 0 10 10` };\n        defEl = createMarker(opts.id, opts, () => {\n            const tri = createEl(`path`);\n            tri.setAttribute(`d`, `M 0 0 L 10 5 L 0 10 z`);\n            if (opts)\n                applyOpts(tri, opts);\n            return tri;\n        });\n    }\n    else\n        throw new Error(`Do not know how to make ${opts.id}`);\n    //eslint-disable-next-line functional/immutable-data\n    defEl.id = opts.id;\n    defsEl.appendChild(defEl);\n    return `url(#${opts.id})`;\n};\n","import { markerPrebuilt } from \"./markers.js\";\n/**\n * Applies path drawing options to given element\n * Applies: markerEnd, markerStart, markerMid\n * @param elem Element (presumed path)\n * @param opts Options\n */\nexport const applyPathOpts = (elem, opts) => {\n    if (opts.markerEnd) {\n        elem.setAttribute(`marker-end`, markerPrebuilt(elem, opts.markerEnd, opts));\n    }\n    if (opts.markerStart) {\n        elem.setAttribute(`marker-start`, markerPrebuilt(elem, opts.markerStart, opts));\n    }\n    if (opts.markerMid) {\n        elem.setAttribute(`marker-mid`, markerPrebuilt(elem, opts.markerMid, opts));\n    }\n};\n","//import type { CirclePositioned } from '../../geometry/circle/CircleType.js';\n//import type { Point } from '../../geometry/point/PointType.js';\n//import type { Line } from '../../geometry/line/LineType.js';\n//import * as Lines from '../geometry/line/index.js';\nimport { Lines, Polar } from '@ixfx/geometry';\n//import * as Svg from './index.js';\nimport { toStringFirst as ColourStringFirst } from '../colour/conversion.js';\nimport { applyOpts } from './apply.js';\nimport { applyStrokeOpts } from './stroke.js';\nimport { createEl, createOrResolve } from './create.js';\nimport { applyPathOpts } from './path.js';\n//import type { PolarRay } from 'src/geometry/polar/Types.js';\n//import { toCartesian as polarRayToCartesian } from 'src/geometry/polar/Ray.js';\n//import {Palette} from \".\";\nconst numberOrPercentage = (v) => {\n    if (v >= 0 && v <= 1)\n        return `${v * 100}%`;\n    return v.toString();\n};\n/**\n * Creates and adds an SVG path element\n * @example\n * ```js\n * const paths = [\n *  `M300,200`,\n *  `a25,25 -30 0,1 50, -25 l 50,-25`\n * ]\n * const pathEl = path(paths, parentEl);\n * ```\n * @param svgOrArray Path syntax, or array of paths. Can be empty if path data will be added later\n * @param parent SVG parent element\n * @param opts Options Drawing options\n * @returns\n */\nexport const path = (svgOrArray, parent, opts, queryOrExisting) => {\n    const elem = createOrResolve(parent, `path`, queryOrExisting);\n    const svg = typeof svgOrArray === `string` ? svgOrArray : svgOrArray.join(`\\n`);\n    elem.setAttributeNS(null, `d`, svg);\n    parent.append(elem);\n    return pathUpdate(elem, opts);\n};\nexport const pathUpdate = (elem, opts) => {\n    if (opts)\n        applyOpts(elem, opts);\n    if (opts)\n        applyStrokeOpts(elem, opts);\n    return elem;\n};\n/**\n * Updates an existing `SVGCircleElement` with potentially updated circle data and drawing options\n * @param elem Element\n * @param circle Circle\n * @param opts Drawing options\n * @returns SVGCircleElement\n */\nexport const circleUpdate = (elem, circle, opts) => {\n    elem.setAttributeNS(null, `cx`, circle.x.toString());\n    elem.setAttributeNS(null, `cy`, circle.y.toString());\n    elem.setAttributeNS(null, `r`, circle.radius.toString());\n    if (opts)\n        applyOpts(elem, opts);\n    if (opts)\n        applyStrokeOpts(elem, opts);\n    return elem;\n};\n/**\n * Creates or reuses a `SVGCircleElement`.\n *\n * To update an existing element, use `circleUpdate`\n * @param circle\n * @param parent\n * @param opts\n * @param queryOrExisting\n * @returns\n */\nexport const circle = (circle, parent, opts, queryOrExisting) => {\n    const p = createOrResolve(parent, `circle`, queryOrExisting);\n    return circleUpdate(p, circle, opts);\n};\n/**\n * Creates or resuses a `SVGGElement` (group)\n *\n * To update an existing elemnet, use `groupUpdate`\n * @param children\n * @param parent\n * @param queryOrExisting\n * @returns\n */\nexport const group = (children, parent, queryOrExisting) => {\n    const p = createOrResolve(parent, `g`, queryOrExisting);\n    return groupUpdate(p, children);\n};\nexport const groupUpdate = (elem, children) => {\n    for (const c of children) {\n        if (c.parentNode !== elem) {\n            elem.append(c);\n        }\n    }\n    return elem;\n};\n/**\n * Creates or reuses a SVGLineElement.\n *\n * @param line\n * @param parent\n * @param opts\n * @param queryOrExisting\n * @returns\n */\nexport const line = (line, parent, opts, queryOrExisting) => {\n    const lineEl = createOrResolve(parent, `line`, queryOrExisting);\n    return lineUpdate(lineEl, line, opts);\n};\n/**\n * Updates a SVGLineElement instance with potentially changed line and drawing data\n * @param lineEl\n * @param line\n * @param opts\n * @returns\n */\nexport const lineUpdate = (lineEl, line, opts) => {\n    lineEl.setAttributeNS(null, `x1`, line.a.x.toString());\n    lineEl.setAttributeNS(null, `y1`, line.a.y.toString());\n    lineEl.setAttributeNS(null, `x2`, line.b.x.toString());\n    lineEl.setAttributeNS(null, `y2`, line.b.y.toString());\n    if (opts)\n        applyOpts(lineEl, opts);\n    if (opts)\n        applyPathOpts(lineEl, opts);\n    if (opts)\n        applyStrokeOpts(lineEl, opts);\n    return lineEl;\n};\nexport const polarRayUpdate = (lineEl, ray, opts) => {\n    const l = Polar.Ray.toCartesian(ray);\n    lineEl.setAttributeNS(null, `x1`, l.a.x.toString());\n    lineEl.setAttributeNS(null, `y1`, l.a.y.toString());\n    lineEl.setAttributeNS(null, `x2`, l.b.x.toString());\n    lineEl.setAttributeNS(null, `y2`, l.b.y.toString());\n    if (opts)\n        applyOpts(lineEl, opts);\n    if (opts)\n        applyPathOpts(lineEl, opts);\n    if (opts)\n        applyStrokeOpts(lineEl, opts);\n    return lineEl;\n};\n/**\n * Updates an existing SVGTextPathElement instance with text and drawing options\n * @param el\n * @param text\n * @param opts\n * @returns\n */\nexport const textPathUpdate = (el, text, opts) => {\n    if (opts?.method)\n        el.setAttributeNS(null, `method`, opts.method);\n    if (opts?.side)\n        el.setAttributeNS(null, `side`, opts.side);\n    if (opts?.spacing)\n        el.setAttributeNS(null, `spacing`, opts.spacing);\n    if (opts?.startOffset) {\n        el.setAttributeNS(null, `startOffset`, numberOrPercentage(opts.startOffset));\n    }\n    if (opts?.textLength) {\n        el.setAttributeNS(null, `textLength`, numberOrPercentage(opts.textLength));\n    }\n    if (text) {\n        el.textContent = text;\n    }\n    if (opts)\n        applyOpts(el, opts);\n    if (opts)\n        applyStrokeOpts(el, opts);\n    return el;\n};\n/**\n * Creates or reuses a SVGTextPathElement.\n * @param pathReference\n * @param text\n * @param parent\n * @param opts\n * @param textQueryOrExisting\n * @param pathQueryOrExisting\n * @returns\n */\nexport const textPath = (pathReference, text, parent, opts, textQueryOrExisting, pathQueryOrExisting) => {\n    const textEl = createOrResolve(parent, `text`, textQueryOrExisting, `-text`);\n    // Update text properties, but don't pass in position or text\n    textUpdate(textEl, undefined, undefined, opts);\n    const p = createOrResolve(textEl, `textPath`, pathQueryOrExisting);\n    p.setAttributeNS(null, `href`, pathReference);\n    return textPathUpdate(p, text, opts);\n};\n/**\n * Updates an existing SVGTextElement instance with position, text and drawing options\n * @param el\n * @param pos\n * @param text\n * @param opts\n * @returns\n */\nexport const textUpdate = (el, pos, text, opts) => {\n    if (pos) {\n        el.setAttributeNS(null, `x`, pos.x.toString());\n        el.setAttributeNS(null, `y`, pos.y.toString());\n    }\n    if (text) {\n        el.textContent = text;\n    }\n    if (opts) {\n        applyOpts(el, opts);\n        if (opts)\n            applyStrokeOpts(el, opts);\n        if (opts.anchor)\n            el.setAttributeNS(null, `text-anchor`, opts.anchor);\n        if (opts.align)\n            el.setAttributeNS(null, `alignment-baseline`, opts.align);\n        const userSelect = opts.userSelect ?? true;\n        if (!userSelect) {\n            el.style.userSelect = `none`;\n        }\n    }\n    return el;\n};\n/**\n * Creates or reuses a SVGTextElement\n * @param pos Position of text\n * @param text Text\n * @param parent\n * @param opts\n * @param queryOrExisting\n * @returns\n */\nexport const text = (text, parent, pos, opts, queryOrExisting) => {\n    const p = createOrResolve(parent, `text`, queryOrExisting);\n    return textUpdate(p, pos, text, opts);\n};\n/**\n * Creates a square grid based at a center point, with cells having `spacing` height and width.\n *\n * It fits in as many cells as it can within `width` and `height`.\n *\n * Returns a SVG group, consisting of horizontal and vertical lines\n * @param parent Parent element\n * @param center Center point of grid\n * @param spacing Width/height of cells\n * @param width How wide grid should be\n * @param height How high grid should be\n * @param opts\n */\nexport const grid = (parent, center, spacing, width, height, opts = {}) => {\n    if (!opts.strokeStyle) {\n        opts = { ...opts, strokeStyle: ColourStringFirst(`bg-dim`, `silver`) };\n    }\n    if (!opts.strokeWidth)\n        opts = { ...opts, strokeWidth: 1 };\n    const g = createEl(`g`);\n    applyOpts(g, opts);\n    applyPathOpts(g, opts);\n    applyStrokeOpts(g, opts);\n    // Horizontals\n    let y = 0;\n    while (y < height) {\n        const horiz = Lines.fromNumbers(0, y, width, y);\n        line(horiz, g);\n        y += spacing;\n    }\n    // Verticals\n    let x = 0;\n    while (x < width) {\n        const vert = Lines.fromNumbers(x, 0, x, height);\n        line(vert, g);\n        x += spacing;\n    }\n    parent.append(g);\n    return g;\n};\n","import { Polar } from \"@ixfx/geometry\";\n// import type { Line } from \"../../geometry/line/LineType.js\";\n// import type { Point } from \"../../geometry/point/PointType.js\";\n// import { fromLine as polarRayFromLine } from \"../../geometry/polar/Ray.js\";\n/**\n * Returns a Line type from an SVGLineElement\n * @param el SVG Line Element\n * @returns\n */\nexport const lineFromSvgLine = (el) => {\n    if (!el)\n        throw new Error(`Param 'el' is undefined`);\n    const a = { x: el.x1.baseVal.value, y: el.y1.baseVal.value };\n    const b = { x: el.x2.baseVal.value, y: el.y2.baseVal.value };\n    return { a, b };\n};\nexport const polarRayFromSvgLine = (el, origin) => {\n    const l = lineFromSvgLine(el);\n    return Polar.Ray.fromLine(l, origin);\n};\n","/**\n * Removes an SVG element from a parent\n * @param parent Parent\n * @param queryOrExisting Query or existing element\n * @returns\n */\nexport const remove = (parent, queryOrExisting) => {\n    if (typeof queryOrExisting === `string`) {\n        const elem = parent.querySelector(queryOrExisting);\n        if (elem === null)\n            return;\n        elem.remove();\n    }\n    else {\n        queryOrExisting.remove();\n    }\n};\n/**\n * Removes all children of `parent`, but not `parent` itself.\n * @param parent\n */\nexport const clear = (parent) => {\n    let c = parent.lastElementChild;\n    while (c) {\n        c.remove();\n        c = parent.lastElementChild;\n    }\n};\n","import { applyOpts } from './apply.js';\nimport { applyStrokeOpts } from './stroke.js';\nimport { remove } from './remove.js';\nimport * as Elements from './elements.js';\n/**\n * Creates a {@link SvgHelper} for the creating and management of SVG elements.\n * @param parent\n * @param parentOpts\n * @returns\n */\nexport const makeHelper = (parent, parentOpts) => {\n    if (parentOpts) {\n        applyOpts(parent, parentOpts);\n        applyStrokeOpts(parent, parentOpts);\n    }\n    const o = {\n        remove: (queryOrExisting) => { remove(parent, queryOrExisting); },\n        text: (text, pos, opts, queryOrExisting) => Elements.text(text, parent, pos, opts, queryOrExisting),\n        textPath: (pathReference, text, opts, textQueryOrExisting, pathQueryOrExisting) => Elements.textPath(pathReference, text, parent, opts, textQueryOrExisting, pathQueryOrExisting),\n        line: (line, opts, queryOrExisting) => Elements.line(line, parent, opts, queryOrExisting),\n        circle: (circle, opts, queryOrExisting) => Elements.circle(circle, parent, opts, queryOrExisting),\n        path: (svgString, opts, queryOrExisting) => Elements.path(svgString, parent, opts, queryOrExisting),\n        grid: (center, spacing, width, height, opts) => Elements.grid(parent, center, spacing, width, height, opts),\n        query: (selectors) => parent.querySelector(selectors),\n        get width() {\n            const w = parent.getAttributeNS(null, `width`);\n            if (w === null)\n                return 0;\n            return Number.parseFloat(w);\n        },\n        set width(width) {\n            parent.setAttributeNS(null, `width`, width.toString());\n        },\n        get parent() {\n            return parent;\n        },\n        get height() {\n            const w = parent.getAttributeNS(null, `height`);\n            if (w === null)\n                return 0;\n            return Number.parseFloat(w);\n        },\n        set height(height) {\n            parent.setAttributeNS(null, `height`, height.toString());\n        },\n        clear: () => {\n            while (parent.firstChild) {\n                parent.lastChild.remove();\n            }\n        },\n    };\n    return o;\n};\n","export * from './apply.js';\nexport * from './bounds.js';\nexport * from './create.js';\nexport * as Elements from './elements.js';\nexport * from './geometry.js';\nexport * from './helper.js';\nexport * from './markers.js';\nexport * from './path.js';\nexport * from './remove.js';\nexport * from './stroke.js';\n","import { PointsTracker } from '@ixfx/geometry/point';\nimport * as Svg from './svg/index.js';\nimport { ElementSizer, resolveEl } from '@ixfx/dom';\n/**\n * Visualises pointer events within a given element.\n *\n * ```js\n * // Show pointer events for whole document\n * pointerVis(document);\n * ```\n *\n * Note you may need to set the following CSS properties on the target element:\n *\n * ```css\n * touch-action: none;\n * user-select: none;\n * overscroll-behavior: none;\n * ```\n *\n * Options\n * * touchRadius/mouseRadius: size of circle for these kinds of pointer events\n * * trace: if true, intermediate events are captured and displayed\n * @param elOrQuery Element to monitor\n * @param options Options\n */\nexport const pointerVisualise = (elOrQuery, options = {}) => {\n    const touchRadius = options.touchRadius ?? 45;\n    const mouseRadius = options.touchRadius ?? 20;\n    const trace = options.trace ?? false;\n    const hue = options.hue ?? 100;\n    const startFillStyle = `hsla(${hue}, 100%, 10%, 10%)`;\n    let currentHue = hue;\n    const el = resolveEl(elOrQuery);\n    const tracker = new PointsTracker({\n        storeIntermediate: trace,\n    });\n    const svg = document.createElementNS(`http://www.w3.org/2000/svg`, `svg`);\n    svg.id = `pointerVis`;\n    svg.style.zIndex = `-1000`;\n    svg.style.position = `fixed`;\n    svg.style.top = `0`;\n    svg.style.left = `0`;\n    svg.style.width = `100%`;\n    svg.style.height = `100%`;\n    svg.style.boxSizing = `border-box`;\n    svg.style.border = `3px solid red`;\n    svg.style.pointerEvents = `none`;\n    svg.style.touchAction = `none`;\n    // const er = new ElementSizer(svg, {\n    //   containerEl:document.body,\n    //   stretch:`both`,\n    //   onSetSize(size) {\n    //     svg.setAttribute(`width`, size.width.toString());\n    //     svg.setAttribute(`height`, size.height.toString());\n    //   },\n    // })\n    const er = ElementSizer.svgViewport(svg);\n    //fullSizeElement(svg);\n    let pointerCount = 0;\n    const lostPointer = (event) => {\n        const id = event.pointerId.toString();\n        tracker.delete(id);\n        currentHue = hue;\n        svg.querySelector(`#pv-start-${id}`)?.remove();\n        for (let index = 0; index < pointerCount + 10; index++) {\n            svg.querySelector(`#pv-progress-${id}-${index}`)?.remove();\n        }\n        pointerCount = 0;\n    };\n    const trackPointer = async (event) => {\n        const id = event.pointerId.toString();\n        const pt = { x: event.x, y: event.y };\n        const type = event.pointerType;\n        if (event.type === `pointermove` && !tracker.has(id)) {\n            return;\n        }\n        const info = (await tracker.seen(event.pointerId.toString(), { x: event.clientX, y: event.clientY }));\n        if (info.values.length === 1) {\n            const el = Svg.Elements.circle({\n                ...info.values[0],\n                radius: type === `touch` ? touchRadius : mouseRadius,\n            }, svg, {\n                fillStyle: startFillStyle,\n            }, `#pv-start-${id}`);\n            el.style.pointerEvents = `none`;\n            el.style.touchAction = `none`;\n        }\n        const fillStyle = `hsla(${currentHue}, 100%, 50%, 50%)`;\n        const el2 = Svg.Elements.circle({ ...pt, radius: type === `touch` ? touchRadius : mouseRadius }, svg, {\n            fillStyle,\n        }, `#pv-progress-${id}-${info.values.length}`);\n        el2.style.pointerEvents = `none`;\n        el2.style.touchAction = `none`;\n        currentHue += 1;\n        pointerCount = info.values.length;\n    };\n    document.body.append(svg);\n    el.addEventListener(`pointerdown`, trackPointer);\n    el.addEventListener(`pointermove`, trackPointer);\n    el.addEventListener(`pointerup`, lostPointer);\n    el.addEventListener(`pointerleave`, lostPointer);\n    el.addEventListener(`contextmenu`, (event) => {\n        event.preventDefault();\n    });\n};\n","import * as ImageDataGrid from './image-data-grid.js';\nimport { Grids } from '@ixfx/geometry';\n/**\n * Multiply every element of kernel by the same `scalar` value.\n * Returns new result, input is unmodified\n * @param kernel\n * @param scalar\n * @returns\n */\nexport const multiply = (kernel, scalar) => {\n    const rows = kernel.length;\n    const cols = kernel[0].length;\n    const copy = [];\n    for (let row = 0; row < rows; row++) {\n        copy[row] = [];\n        for (let col = 0; col < cols; col++) {\n            copy[row][col] = kernel[row][col] * scalar;\n        }\n    }\n    return copy;\n};\nexport function convolveCell(cell, kernel, source, reduce) {\n    const valuesAtKernelPos = kernel.map(o => {\n        // For a kernel cell vector, get the position in the source grid\n        const pos = Grids.offset(source, cell, o.cell, `stop`); // `stop` avoids fringing at extents of image\n        // If there's no cell, return undefined\n        let kernelValue;\n        let sourceValue;\n        if (pos) {\n            sourceValue = source.get(pos, `undefined`);\n            kernelValue = o.value;\n        }\n        //if (!pos) return { cell: o.cell, value: undefined, scalar: NaN } as CellValueScalar<T>;\n        return { cell: o.cell, value: sourceValue, kernel: o.value };\n    });\n    return reduce(valuesAtKernelPos);\n}\n/**\n * Performs kernel-based convolution over `image`.\n * @param kernel\n * @param image\n */\nexport function* convolveImage(kernel, image) {\n    //const grid = { rows: image.width, cols: image.height };\n    const imageDataAsGrid = ImageDataGrid.wrap(image);\n    yield* convolve(kernel, imageDataAsGrid, Grids.By.cells(imageDataAsGrid), rgbReducer);\n}\nexport function* convolve(kernel, source, visitor, reduce, origin) {\n    if (!origin) {\n        const kernelRows = kernel.length;\n        const kernelCols = kernel[0].length;\n        origin = { x: Math.floor(kernelRows / 2), y: Math.floor(kernelCols / 2) };\n    }\n    const asArray = kernel2dToArray(kernel, origin);\n    // for (const c of visitor) {\n    //   const v = convolveCell<V>(c, asArray, source, access, reduce);\n    //   yield [ c, v ];\n    // }\n    for (const cell of visitor) {\n        const value = convolveCell(cell, asArray, source, reduce);\n        yield { cell, value };\n    }\n}\n/**\n * For a given kernel, returns an array of offsets. These\n * consist of a cell offset (eg `{x:-1,y:-1}`) and the value at that kernel position.\n * @param kernel\n * @param origin\n * @returns\n */\nexport const kernel2dToArray = (kernel, origin) => {\n    const offsets = [];\n    const rows = kernel.length;\n    const cols = kernel[0].length;\n    if (!origin) {\n        origin = {\n            x: Math.floor(rows / 2),\n            y: Math.floor(cols / 2)\n        };\n    }\n    for (let xx = 0; xx < rows; xx++) {\n        for (let yy = 0; yy < cols; yy++) {\n            const v = {\n                cell: { x: xx - origin.x, y: yy - origin.y },\n                value: kernel[xx][yy]\n            };\n            offsets.push(v);\n            //offsets.push([ { x: xx - origin.x, y: yy - origin.y }, kernel[ xx ][ yy ] ]);\n        }\n    }\n    return offsets;\n};\nexport const rgbReducer = (values) => {\n    let r = 0;\n    let g = 0;\n    let b = 0;\n    let opacity = 0;\n    for (const value of values) {\n        const rgb = value.value;\n        const kernelValue = value.kernel;\n        if (!rgb)\n            continue;\n        if (rgb.opacity === 0)\n            continue;\n        if (kernelValue === 0)\n            continue;\n        r += (rgb.r * kernelValue);\n        g += (rgb.g * kernelValue);\n        b += (rgb.b * kernelValue);\n        opacity += ((rgb.opacity ?? 1) * kernelValue);\n    }\n    const result = {\n        r, g, b,\n        unit: `8bit`,\n        space: `srgb`,\n        opacity\n    };\n    return result;\n};\nexport const identityKernel = [\n    [0, 0, 0],\n    [0, 1, 0],\n    [0, 0, 0]\n];\nexport const edgeDetectionKernel = [\n    [0, -1, 0],\n    [-1, 4, -1],\n    [0, -1, 0]\n];\nexport const sharpenKernel = [\n    [0, -1, 0],\n    [-1, 5, -1],\n    [0, -1, 0]\n];\nexport const boxBlurKernel = multiply([\n    [1, 1, 1],\n    [1, 1, 1],\n    [1, 1, 1]\n], 1 / 9);\nexport const gaussianBlur3Kernel = multiply([\n    [1, 2, 1],\n    [2, 4, 2],\n    [1, 2, 1]\n], 1 / 16);\nexport const gaussianBlur5Kernel = multiply([\n    [1, 4, 6, 4, 1],\n    [4, 16, 24, 16, 4],\n    [6, 24, 36, 24, 6],\n    [4, 16, 24, 16, 4],\n    [1, 4, 6, 4, 1],\n], 1 / 256);\nexport const unsharpMasking5Kernel = multiply([\n    [1, 4, 6, 4, 1],\n    [4, 16, 24, 16, 4],\n    [6, 24, -476, 24, 6],\n    [4, 16, 24, 16, 4],\n    [1, 4, 6, 4, 1],\n], -1 / 256);\n","export const create = (fallbacks) => new NamedColourPaletteImpl(fallbacks);\nclass NamedColourPaletteImpl {\n    #store = new Map();\n    #aliases = new Map();\n    fallbacks;\n    #lastFallback = 0;\n    #elementBase;\n    constructor(fallbacks) {\n        if (fallbacks !== undefined)\n            this.fallbacks = fallbacks;\n        else\n            this.fallbacks = [`red`, `blue`, `green`, `orange`];\n        this.#elementBase = document.body;\n    }\n    setElementBase(el) {\n        this.#elementBase = el;\n    }\n    add(key, colour) {\n        this.#store.set(key, colour);\n    }\n    alias(from, to) {\n        this.#aliases.set(from, to);\n    }\n    get(key, fallback) {\n        const alias = this.#aliases.get(key);\n        if (alias !== undefined)\n            key = alias;\n        const c = this.#store.get(key);\n        if (c !== undefined)\n            return c;\n        const variableName = `--` + key;\n        let fromCss = getComputedStyle(this.#elementBase)\n            .getPropertyValue(variableName)\n            .trim();\n        // Not found\n        if (fromCss === undefined || fromCss.length === 0) {\n            if (fallback !== undefined)\n                return fallback;\n            fromCss = this.fallbacks[this.#lastFallback];\n            this.#lastFallback++;\n            if (this.#lastFallback === this.fallbacks.length)\n                this.#lastFallback = 0;\n        }\n        return fromCss;\n    }\n    getOrAdd(key, fallback) {\n        if (this.has(key))\n            return this.get(key);\n        const c = this.get(key, fallback);\n        this.add(key, c);\n        return c;\n    }\n    has(key) {\n        return this.#store.has(key);\n    }\n}\n","import { continuously } from '@ixfx/core';\nimport { delayLoop } from '@ixfx/flow';\n/**\n * Generator that yields frames from a video element as [ImageData](https://developer.mozilla.org/en-US/docs/Web/API/ImageData).\n *\n * ```js\n * import { Video } from '@ixfx/visual.js'\n *\n * const ctx = canvasEl.getContext(`2d`);\n * for await (const frame of Video.frames(videoEl)) {\n *   // TODO: Some processing of pixels\n *\n *   // Draw image on to the visible canvas\n *   ctx.putImageData(frame, 0, 0);\n * }\n * ```\n *\n * Under the hood it creates a hidden canvas where frames are drawn to. This is necessary\n * to read back pixel data. An existing canvas can be used if it is passed in as an option.\n *\n * Options:\n * * `canvasEl`: CANVAS element to use as a buffer (optional)\n * * `maxIntervalMs`: Max frame rate (0 by default, ie runs as fast as possible)\n * * `showCanvas`: Whether buffer canvas will be shown (false by default)\n * @param sourceVideoEl\n * @param opts\n */\nexport async function* frames(sourceVideoEl, opts = {}) {\n    // TODO: Ideally use OffscreenCanvas when it has wider support?\n    // TODO: When ImageBitmap has possibility to get pixels, that might also help to avoid having to write to hidden canvas\n    const maxIntervalMs = opts.maxIntervalMs ?? 0;\n    const showCanvas = opts.showCanvas ?? false;\n    let canvasEl = opts.canvasEl;\n    let w, h;\n    w = h = 0;\n    // Create & setup canvas\n    if (canvasEl === undefined) {\n        canvasEl = document.createElement(`CANVAS`);\n        canvasEl.classList.add(`ixfx-frames`);\n        if (!showCanvas) {\n            canvasEl.style.display = `none`;\n        }\n        document.body.appendChild(canvasEl);\n    }\n    // Update size of canvas based on video\n    const updateSize = () => {\n        if (canvasEl === undefined)\n            return;\n        w = sourceVideoEl.videoWidth;\n        h = sourceVideoEl.videoHeight;\n        canvasEl.width = w;\n        canvasEl.height = h;\n    };\n    let c = null;\n    const looper = delayLoop(maxIntervalMs);\n    for await (const _ of looper) {\n        // If we don't yet have the size of video, get it\n        if (w === 0 || h === 0)\n            updateSize();\n        // If there is still no dimensions (ie stream has not started), there's nothing to do yet\n        if (w === 0 || h === 0)\n            continue;\n        // Draw current frame from video element to hidden canvas\n        c ??= canvasEl.getContext(`2d`);\n        if (c === null)\n            return;\n        c.drawImage(sourceVideoEl, 0, 0, w, h);\n        // Get pixels\n        const pixels = c.getImageData(0, 0, w, h);\n        yield pixels;\n    }\n}\n/**\n * Captures frames from a video element. It can send pixel data to a function or post to a worker script.\n *\n * @example Using a function\n * ```js\n * // Capture from a VIDEO element, handling frame data\n * // imageData is ImageData type: https://developer.mozilla.org/en-US/docs/Web/API/ImageData\n * Video.capture(sourceVideoEl, {\n *  onFrame(imageData => {\n *    // Do something with pixels...\n *  });\n * });\n * ```\n *\n * @example Using a worker\n * ```js\n * Video.capture(sourceVideoEl, {\n *  workerScript: `./frameProcessor.js`\n * });\n * ```\n *\n * In frameProcessor.js:\n * ```\n * const process = (frame) => {\n *  // ...process frame\n *\n *  // Send image back?\n *  self.postMessage({frame});\n * };\n *\n * self.addEventListener(`message`, evt => {\n *   const {pixels, width, height} = evt.data;\n *   const frame = new ImageData(new Uint8ClampedArray(pixels),\n *     width, height);\n *\n *   // Process it\n *   process(frame);\n * });\n * ```\n *\n * Options:\n * * `canvasEl`: CANVAS element to use as a buffer (optional)\n * * `maxIntervalMs`: Max frame rate (0 by default, ie runs as fast as possible)\n * * `showCanvas`: Whether buffer canvas will be shown (false by default)\n * * `workerScript`: If this specified, this URL will be loaded as a Worker, and frame data will be automatically posted to it\n *\n * Implementation: frames are captured using a animation-speed loop to a hidden canvas. From there\n * the pixel data is extracted and sent to either destination. In future the intermediate drawing to a\n * canvas could be skipped if it becomes possible to get pixel data from an ImageBitmap.\n * @param sourceVideoEl Source VIDEO element\n * @param opts\n * @returns\n */\nexport const capture = (sourceVideoEl, opts = {}) => {\n    const maxIntervalMs = opts.maxIntervalMs ?? 0;\n    const showCanvas = opts.showCanvas ?? false;\n    const onFrame = opts.onFrame;\n    // Ideally use OffscreenCanvas when it has support?\n    const w = sourceVideoEl.videoWidth;\n    const h = sourceVideoEl.videoHeight;\n    // Create canvas\n    const canvasEl = document.createElement(`CANVAS`);\n    canvasEl.classList.add(`ixfx-capture`);\n    if (!showCanvas) {\n        canvasEl.style.display = `none`;\n    }\n    canvasEl.width = w;\n    canvasEl.height = h;\n    let c = null;\n    let worker;\n    if (opts.workerScript) {\n        worker = new Worker(opts.workerScript);\n    }\n    // Should we get image data?\n    const getPixels = worker || onFrame;\n    if (!getPixels && !showCanvas) {\n        console.warn(`Video will be captured to hidden element without any processing. Is this what you want?`);\n    }\n    const loop = continuously(() => {\n        // Draw current frame from video element to hidden canvas\n        if (c === null)\n            c = canvasEl.getContext(`2d`);\n        if (c === null)\n            return;\n        c.drawImage(sourceVideoEl, 0, 0, w, h);\n        let pixels;\n        if (getPixels) {\n            // ImageData necessary\n            pixels = c.getImageData(0, 0, w, h);\n        }\n        if (worker) {\n            // Send to worker\n            worker.postMessage({\n                pixels: pixels.data.buffer,\n                width: w,\n                height: h,\n                channels: 4,\n            }, [pixels.data.buffer]);\n        }\n        if (onFrame) {\n            // Send to callback\n            try {\n                onFrame(pixels);\n            }\n            catch (e) {\n                console.error(e);\n            }\n        }\n    }, maxIntervalMs);\n    return {\n        start: () => { loop.start(); },\n        cancel: () => { loop.cancel(); },\n        canvasEl,\n    };\n};\nexport const manualCapture = (sourceVideoEl, opts = {}) => {\n    const showCanvas = opts.showCanvas ?? false;\n    // Ideally use OffscreenCanvas when it has support?\n    const w = sourceVideoEl.videoWidth;\n    const h = sourceVideoEl.videoHeight;\n    // Create canvas if necessary\n    const definedCanvasEl = opts.canvasEl !== undefined;\n    let canvasEl = opts.canvasEl;\n    if (!canvasEl) {\n        canvasEl = document.createElement(`CANVAS`);\n        canvasEl.classList.add(`ixfx-capture`);\n        document.body.append(canvasEl);\n        if (!showCanvas)\n            canvasEl.style.display = `none`;\n    }\n    canvasEl.width = w;\n    canvasEl.height = h;\n    const capture = () => {\n        let c;\n        // Draw current frame from video element to canvas\n        if (!c)\n            c = canvasEl.getContext(`2d`, { willReadFrequently: true });\n        if (!c)\n            throw new Error(`Could not create graphics context`);\n        c.drawImage(sourceVideoEl, 0, 0, w, h);\n        const pixels = c.getImageData(0, 0, w, h);\n        pixels.currentTime = sourceVideoEl.currentTime;\n        if (opts.postCaptureDraw)\n            opts.postCaptureDraw(c, w, h);\n        return pixels;\n    };\n    const dispose = () => {\n        if (definedCanvasEl)\n            return; // we didn't create it\n        try {\n            canvasEl.remove();\n        }\n        catch (_) {\n            // no-op\n        }\n    };\n    const c = {\n        canvasEl,\n        capture,\n        dispose,\n    };\n    return c;\n};\n","import * as Drawing from \"../drawing.js\";\nimport { Bipolar } from \"@ixfx/numbers\";\nimport { QueueImmutable } from \"@ixfx/collections/queue\";\nimport * as Colour from \"../colour/index.js\";\nimport {} from \"@ixfx/geometry/circle\";\nfunction getNumericAttribute(el, name, defaultValue) {\n    const a = el.getAttribute(name);\n    if (a === null)\n        return defaultValue;\n    return Number.parseInt(a);\n}\n/**\n * Initialises a plotter for bipolar values (-1...1)\n *\n * ```js\n * const p = BipolarView.init(`#my-canvas`);\n * // Shows the dot at 1, 0.5\n * p(1, 0.5);\n * ```\n * @param elementQuery\n * @param options\n * @returns\n */\nexport const init = (elementQuery, options = {}) => {\n    const element = document.querySelector(elementQuery);\n    if (!element)\n        throw new Error(`Element query could not be found (${elementQuery})`);\n    const labels = options.labels ?? [`x`, `y`];\n    const labelPrecision = options.labelPrecision ?? 2;\n    const asPercentages = options.asPercentages ?? false;\n    const displayLastValues = options.displayLastValues ?? 0;\n    // Flags\n    const showWhiskers = options.showWhiskers ?? true;\n    const showDot = options.showDot ?? true;\n    const showLabels = options.showLabels ?? true;\n    const yAxisBottomNegative = options.yAxisBottomNegative ?? true;\n    // Colours\n    const axisColour = Colour.toStringFirst(options.axisColour, `silver`);\n    const bgColour = Colour.toStringFirst(options.bgColour, `white`);\n    const whiskerColour = Colour.toStringFirst(options.whiskerColour, `black`);\n    const dotColour = Colour.toStringFirst(options.dotColour, options.whiskerColour, `black`);\n    const labelColour = Colour.toStringFirst(options.labelColour, options.axisColour, `silver`);\n    // Sizes\n    const axisWidth = (options.axisWidth ?? 1 * window.devicePixelRatio);\n    const dotRadius = (options.dotRadius ?? 5 * window.devicePixelRatio);\n    const pad = (options.padding ?? 10 * window.devicePixelRatio);\n    const whiskerSize = (options.whiskerSize ?? 5 * window.devicePixelRatio);\n    const width = (options.width ?? getNumericAttribute(element, `width`, 200) * window.devicePixelRatio);\n    const height = (options.height ?? getNumericAttribute(element, `height`, 200) * window.devicePixelRatio);\n    let lastValues;\n    if (displayLastValues > 0) {\n        lastValues = new QueueImmutable({\n            capacity: displayLastValues,\n            discardPolicy: `older`\n        });\n    }\n    element.width = width; // * window.devicePixelRatio;\n    element.height = height; // * window.devicePixelRatio;\n    element.style.width = `${(width / window.devicePixelRatio)}px`;\n    element.style.height = `${(height / window.devicePixelRatio)}px`;\n    const midY = height / 2;\n    const midX = width / 2;\n    const ctx = element.getContext(`2d`);\n    if (!ctx)\n        throw new Error(`Could not create drawing context`);\n    if (window.devicePixelRatio >= 2) {\n        ctx.font = `20px sans-serif`;\n    }\n    const percentageFormat = (v) => `${Math.round(v * 100)}%`;\n    const fixedFormat = (v) => v.toFixed(labelPrecision);\n    const valueFormat = asPercentages ? percentageFormat : fixedFormat;\n    if (showLabels) {\n        labels[0] = labels[0] + `:`;\n        labels[1] = labels[1] + `:`;\n    }\n    else {\n        labels[0] = ``;\n        labels[1] = ``;\n    }\n    const renderBackground = options.renderBackground ?? ((ctx, width, height) => {\n        if (options.bgColour === `transparent`) {\n            ctx.clearRect(0, 0, width, height);\n        }\n        else {\n            ctx.fillStyle = bgColour;\n            ctx.fillRect(0, 0, width, height);\n        }\n    });\n    return (x, y) => {\n        x = Bipolar.clamp(x);\n        y = Bipolar.clamp(y);\n        renderBackground(ctx, width, height);\n        // Labels\n        ctx.fillStyle = labelColour;\n        ctx.textBaseline = `top`;\n        ctx.save();\n        ctx.translate(midX, midY);\n        ctx.rotate(-Math.PI / 2);\n        ctx.fillText((labels[1] + ` ` + valueFormat(y)).trim(), -midX + pad, 1);\n        ctx.restore();\n        ctx.fillText((labels[0] + ` ` + valueFormat(x)).trim(), pad, midX + 2);\n        if (!yAxisBottomNegative)\n            y *= -1;\n        // Axes\n        ctx.strokeStyle = axisColour;\n        ctx.lineWidth = axisWidth;\n        ctx.beginPath();\n        ctx.moveTo(pad, midY);\n        ctx.lineTo(width - pad, midY);\n        ctx.moveTo(midX, pad);\n        ctx.lineTo(midX, height - pad);\n        ctx.stroke();\n        ctx.closePath();\n        const yy = (height - pad - pad) / 2 * -y;\n        const xx = (width - pad - pad) / 2 * x;\n        const dotPos = { x: xx, y: yy, radius: dotRadius };\n        if (lastValues) {\n            lastValues = lastValues.enqueue(dotPos);\n        }\n        ctx.save();\n        ctx.translate(midX, midY);\n        // Dot\n        if (showDot) {\n            if (lastValues) {\n                const opacityStep = 1 / lastValues.length;\n                let opacity = 1;\n                lastValues.forEach(d => {\n                    const colour = Colour.multiplyOpacity(dotColour, opacity);\n                    Drawing.circle(ctx, d, { fillStyle: colour });\n                    opacity -= opacityStep;\n                });\n            }\n            else {\n                Drawing.circle(ctx, dotPos, { fillStyle: dotColour });\n            }\n        }\n        // Whiskers\n        if (showWhiskers) {\n            ctx.strokeStyle = whiskerColour;\n            // y line\n            ctx.beginPath();\n            ctx.moveTo(0, yy - whiskerSize);\n            ctx.lineTo(0, yy + whiskerSize);\n            // x line\n            ctx.moveTo(xx - whiskerSize, 0);\n            ctx.lineTo(xx + whiskerSize, 0);\n            ctx.stroke();\n            ctx.closePath();\n        }\n        // Restore transform\n        ctx.restore();\n    };\n};\n","import { scaler } from \"@ixfx/numbers\";\nexport const computeMinMax = (mm) => {\n    const x = mm.map(m => m.x);\n    const y = mm.map(m => m.y);\n    const minX = Math.min(...x);\n    const maxX = Math.max(...x);\n    const minY = Math.min(...y);\n    const maxY = Math.max(...y);\n    const width = maxX - minX;\n    const height = maxY - minY;\n    return {\n        min: { x: minX, y: minY },\n        max: { x: maxX, y: maxY },\n        width, height,\n        minDim: Math.min(width, height),\n        maxDim: Math.max(width, height)\n    };\n};\nexport const relativeCompute = (minMax) => {\n    if (!Number.isFinite(minMax.height)) {\n        return (point) => point;\n    }\n    const xScale = scaler(minMax.min.x, minMax.max.x);\n    const yScale = scaler(minMax.min.y, minMax.max.y);\n    return (point) => ({\n        x: xScale(point.x),\n        y: yScale(point.y)\n    });\n};\nexport const absoluteCompute = (minMax) => {\n    const xScale = scaler(0, 1, minMax.min.x, minMax.max.x);\n    const yScale = scaler(0, 1, minMax.min.y, minMax.max.y);\n    return (point) => ({\n        x: xScale(point.x),\n        y: yScale(point.y)\n    });\n};\nexport const computeAxisMark = (mm, increments, major) => {\n    // Vertical\n    const xValues = [];\n    let count = 0;\n    for (let x = mm.min.x; x < mm.max.x; x += increments) {\n        const isMajor = count % major === 0;\n        xValues.push({ x, y: 0, major: isMajor });\n        count++;\n    }\n    // Horizontal\n    count = 0;\n    const yValues = [];\n    for (let y = mm.min.y; y < mm.max.y; y += increments) {\n        const isMajor = count % major === 0;\n        yValues.push({ x: 0, y, major: isMajor });\n        count++;\n    }\n    return { x: xValues, y: yValues };\n};\n","import { MapOfSimpleMutable } from \"@ixfx/collections\";\nexport class DataSet {\n    #data;\n    #meta;\n    lastChange;\n    constructor() {\n        this.lastChange = performance.now();\n        this.#data = new MapOfSimpleMutable();\n        this.#meta = new Map();\n    }\n    get metaCount() {\n        return this.#meta.size;\n    }\n    clear() {\n        this.#data.clear();\n        this.lastChange = performance.now();\n    }\n    set(series, data) {\n        this.#data.setValues(series, data);\n    }\n    deleteBySeries(series) {\n        const changed = this.#data.delete(series);\n        if (changed) {\n            this.lastChange = performance.now();\n        }\n        return changed;\n    }\n    setMeta(series, meta) {\n        this.#meta.set(series, meta);\n    }\n    hasMeta(series) {\n        return this.#meta.has(series);\n    }\n    getMeta(series) {\n        return this.#meta.get(series);\n    }\n    *getValues() {\n        yield* this.#data.valuesFlat();\n    }\n    *getEntries() {\n        yield* this.#data.entries();\n    }\n    *getSeries() {\n        yield* this.#data.values();\n    }\n    add(value, series = `default`) {\n        this.#data.addKeyedValues(series, value);\n        this.lastChange = performance.now();\n    }\n}\n","import { DataSet } from \"./DataSet.js\";\nimport * as Cart from './cartesian.js';\nimport { round } from \"@ixfx/numbers\";\nimport { CanvasSource } from \"../canvas-region.js\";\nimport { resolveEl } from \"@ixfx/dom\";\nimport { ElementSizer } from \"@ixfx/dom\";\nimport { Points, Rects } from \"@ixfx/geometry\";\nimport { goldenAngleColour } from \"../colour/generate.js\";\nimport { toCssColour as ColourToString } from \"../colour/conversion.js\";\nexport const insert = (insertOptions, options = {}) => {\n    const parentEl = (insertOptions.parent === undefined) ? document.body : resolveEl(insertOptions.parent);\n    const canvasEl = document.createElement(`canvas`);\n    parentEl.prepend(canvasEl);\n    const ds = new DataSet();\n    const source = new CanvasSource(canvasEl, `min`);\n    const spec = insertOptions.region ?? ({ relativePositioned: { x: 0, y: 0, width: 1, height: 1 } });\n    const region = source.createRegion(spec);\n    const p = new CartesianCanvasPlot(region, ds, options);\n    if (insertOptions.canvasResizeTo === `viewport`) {\n        ElementSizer.canvasViewport(canvasEl, {\n            onSizeChanging: (size, _el) => {\n                source.setLogicalSize(size);\n                p.invalidateRange();\n                p.draw();\n            }\n        });\n    }\n    else {\n        // Parent\n        ElementSizer.canvasParent(canvasEl, {\n            onSizeChanging: (size, _el) => {\n                source.setLogicalSize(size);\n                p.invalidateRange();\n                p.draw();\n            }\n        });\n    }\n    return p;\n};\n/**\n * Simple plotting of cartesian values.\n *\n * Create a plot that fills screen\n * ```js\n * const p = Plot.insert({fill`viewport});\n * const dataSet = p.dataSet;\n *\n * // Add data\n * ds.add({ x: 1, y: 2 });\n *\n * // Draw\n * p.draw();\n * ```\n *\n * Create a plot that fills a container\n * ```js\n * const p = Plot.insert({parent:`#someel`});\n * ```\n *\n * Add data using the created data set\n * ```js\n *\n * // Add a value to the `alpha` series\n * p.dataSet.add({x:1,y:1}, `alpha`);\n * ```\n *\n * Set default series formatting\n * ```js\n * p.setMeta(`default`, {\n *  colour: `hsl(50,100%,50%)`,\n *  lineWidth: 10\n * });\n * ```\n *\n * Series can have metadata associated with it in the DataSet\n * ```js\n * // Use 'pink' by default for the series 'alpha'\n * p.setMeta(`alpha`, { colour: `pink` });\n * ``\n *\n */\nexport class CartesianCanvasPlot {\n    #data;\n    #lastDataChange;\n    #canvasRegion;\n    actualDataRange = Rects.EmptyPositioned;\n    visibleRange = Rects.PlaceholderPositioned;\n    show;\n    whiskerLength;\n    axisRounder = round(1, true);\n    onInvalidated;\n    /**\n     * List of lines to draw after drawing everything else.\n     * Lines are given in value-coordinate space\n     */\n    overlayLines = [];\n    #grid;\n    #rangeMode;\n    #currentRange;\n    #axisStyle;\n    #valueStyle;\n    #connectStyle;\n    #rangeManual;\n    #textStyle;\n    #visualPadding;\n    #visualClear;\n    constructor(cr, data, options = {}) {\n        if (!data)\n            throw new TypeError(`Param 'data' is undefined`);\n        if (typeof data !== `object`)\n            throw new TypeError(`Param 'data' is not an object. Got: ${typeof data}`);\n        this.onInvalidated = options.onInvalidated;\n        this.#data = data;\n        this.#canvasRegion = cr;\n        this.#lastDataChange = 0;\n        this.#visualClear = options.clear ?? `region`;\n        this.#rangeMode = options.range ?? `auto`;\n        this.#valueStyle = options.valueStyle ?? `dot`;\n        this.#connectStyle = options.connectStyle ?? ``;\n        this.whiskerLength = options.whiskerLength ?? 5;\n        this.#visualPadding = options.visualPadding ?? 20;\n        this.show = {\n            axes: true,\n            axisValues: true,\n            grid: true,\n            whiskers: true,\n            ...options.show\n        };\n        this.#axisStyle = {\n            colour: `black`,\n            width: 2,\n            ...options.axisStyle\n        };\n        this.#textStyle = {\n            colour: `black`,\n            size: `1em`,\n            font: `system-ui`,\n            ...options.textStyle\n        };\n        this.#grid = {\n            increments: 0.1,\n            major: 5,\n            colour: `whitesmoke`,\n            width: 1,\n            ...options.grid\n        };\n    }\n    getCurrentRange() {\n        if (this.#data.lastChange === this.#lastDataChange && this.#currentRange)\n            return this.#currentRange;\n        this.#lastDataChange = this.#data.lastChange;\n        const r = this.#createRange();\n        this.#currentRange = r;\n        if (this.onInvalidated)\n            this.onInvalidated();\n        return r;\n    }\n    invalidateRange() {\n        this.#currentRange = undefined;\n    }\n    #createRange() {\n        // Compute scale of data\n        const range = this.getDataRange(); // actual data range, or user-provided\n        const absDataToRelative = Cart.relativeCompute(range);\n        const relDataToAbs = Cart.absoluteCompute(range);\n        const cr = this.#canvasRegion;\n        const padding = this.#visualPadding;\n        // Offsets are in canvas coordinates, not region\n        // eg 0,0 is top-left corner of canvas\n        let xOffset = cr.x + padding;\n        let yOffset = cr.y + padding;\n        const allowedHeight = cr.height - (padding * 2);\n        const allowedWidth = cr.width - (padding * 2);\n        const dimensionMin = Math.min(allowedHeight, allowedWidth);\n        ;\n        if (allowedWidth >= allowedHeight) {\n            // Landscape\n            xOffset += (allowedWidth / 2) - (dimensionMin / 2);\n        }\n        else {\n            // Portrait\n            yOffset += (allowedHeight / 2) - (dimensionMin / 2);\n        }\n        const relDataToCanvas = (pt) => {\n            let { x, y } = pt;\n            if (x === Number.NEGATIVE_INFINITY)\n                x = 0;\n            else if (x === Number.POSITIVE_INFINITY)\n                x = 1;\n            if (y === Number.NEGATIVE_INFINITY)\n                y = 0;\n            else if (y === Number.POSITIVE_INFINITY)\n                y = 1;\n            x = x * dimensionMin;\n            y = (1 - y) * dimensionMin;\n            x += xOffset;\n            y += yOffset;\n            return { x, y };\n        };\n        const canvasToRelData = (pt) => {\n            let { x, y } = pt;\n            x -= xOffset;\n            y -= yOffset;\n            x = x / dimensionMin;\n            y = 1 - (y / dimensionMin);\n            return { x, y };\n        };\n        // Convert region-space to plot area relative\n        const regionSpaceToRelative = (pt) => {\n            let { x, y } = pt;\n            x = x - cr.x + this.#visualPadding;\n            y = (dimensionMin + this.#visualPadding) - y;\n            x /= dimensionMin;\n            y = (y / dimensionMin);\n            return { x, y };\n        };\n        return {\n            absDataToRelative, relDataToCanvas, canvasToRelData, regionSpaceToRelative, relDataToAbs, range\n        };\n    }\n    /**\n     * Positions an element at the viewport location of `data` point.\n     * Ensure the element has `position:absolute` set.\n     * @param data\n     * @param elementToPosition\n     * @param by\n     */\n    positionElementAt(data, elementToPosition, by = `middle`, relativeToQuery) {\n        const el = resolveEl(elementToPosition);\n        let { x, y } = this.valueToScreenSpace(data);\n        // x -= this.canvasSource.offset.x;\n        // y -= this.canvasSource.offset.y;\n        if (by === `middle`) {\n            const bounds = el.getBoundingClientRect();\n            x -= bounds.width / 2;\n            y -= bounds.height / 2;\n        }\n        else if (by === `top-left`) {\n            // no-op\n        }\n        else\n            throw new Error(`Param 'by' expected to be 'middle' or 'top-left'.`);\n        if (relativeToQuery) {\n            const relativeTo = resolveEl(relativeToQuery);\n            const bounds = relativeTo.getBoundingClientRect();\n            //console.log(`Plot relativeTo: ${ relativeTo.scrollTop } y:  ${ bounds.y }`);\n            x -= bounds.x;\n            y -= bounds.y;\n        }\n        el.style.left = `${x}px`;\n        el.style.top = `${y}px`;\n    }\n    /**\n     * When range is auto, returns the range of the data\n     * Otherwise returns the user-provided range.\n     * @returns\n     */\n    getDataRange() {\n        if (this.#rangeMode === `auto`) {\n            return Cart.computeMinMax([...this.#data.getValues()]);\n        }\n        else {\n            if (!this.#rangeManual) {\n                this.#rangeManual = Cart.computeMinMax([this.#rangeMode.max, this.#rangeMode.min]);\n            }\n            return this.#rangeManual;\n        }\n    }\n    valueToScreenSpace(dataPoint) {\n        const region = this.valueToRegionSpace(dataPoint);\n        const offset = this.canvasSource.offset;\n        const scr = {\n            x: region.x + offset.x,\n            y: region.y + offset.y\n        };\n        return scr;\n    }\n    valueToRegionSpace(dataValue, debug = false) {\n        const ds = this.getCurrentRange();\n        // Scale absolute value relative to total dimensions of data\n        const rel = ds.absDataToRelative(dataValue);\n        // Scale relative data value to canvas space\n        const region = ds.relDataToCanvas(rel);\n        if (debug)\n            console.log(`orig: ${dataValue.x}x${dataValue.y} rel: ${rel.x}x${rel.y} region: ${region.x}x${region.y}`);\n        return {\n            ...dataValue,\n            x: region.x,\n            y: region.y\n        };\n    }\n    // #regionSpaceToValue(scr: Point, clamped: boolean) {\n    //   const ds = this.getCurrentRange();\n    //   const rel = ds.regionSpaceToRelative(scr);\n    //   //console.log(`regionSpaceToRelative ${ rel.x.toFixed(2) },${ rel.y.toFixed(2) }`);\n    //   const value = ds.relDataToAbs(rel);\n    //   //if (debug) console.log(`orig: ${ a.x }x${ a.y } rel: ${ rel.x }x${ rel.y } scr: ${ scr.x }x${ scr.y }`);\n    //   const pt = {\n    //     ...scr,\n    //     x: value.x,\n    //     y: value.y\n    //   }\n    //   if (clamped) return clamp(pt);\n    //   return pt;\n    // }\n    /**\n     * Converts a point in pixel coordinates to a value.\n     * Useful for converting from user input coordinates.\n     * @param point\n     * @returns\n     */\n    pointToValue(point, _source) {\n        const ds = this.getCurrentRange();\n        // Apply offset\n        const canvasPoint = Points.subtract(point, this.canvasSource.offset);\n        const v = ds.canvasToRelData(canvasPoint);\n        return ds.relDataToAbs(v);\n    }\n    // valueToScreen(a: Point) {\n    //   const ds = this.getCurrentRange();\n    //   const rel = ds.valueToRelative(a);\n    //   const scr = ds.relativeToElementSpace(rel);\n    //   const bounds = this.helper.el.getBoundingClientRect();\n    //   return {\n    //     x: scr.x + bounds.x,\n    //     y: scr.y + bounds.y\n    //   }\n    // }\n    // valueRectToScreen(a: Point, b: Point): RectPositioned {\n    //   a = this.valueToScreen(a);\n    //   b = this.valueToScreen(b);\n    //   return {\n    //     x: a.x,\n    //     y: b.y,\n    //     width: b.x - a.x,\n    //     height: a.y - b.y\n    //   }\n    // }\n    /**\n     * Compute canvas-relative coordinates based on two points in value space\n     * @param valueA\n     * @param valueB\n     */\n    #valueLineToCanvasSpace(valueA, valueB, debug = false) {\n        valueA = this.valueToRegionSpace(valueA, debug);\n        valueB = this.valueToRegionSpace(valueB, debug);\n        return { a: valueA, b: valueB };\n    }\n    getDefaultMeta() {\n        return {\n            colour: goldenAngleColour(this.#data.metaCount),\n            lineWidth: 2,\n            dotRadius: 5\n        };\n    }\n    draw() {\n        if (this.#visualClear === `region`) {\n            this.#canvasRegion.clear();\n        }\n        else {\n            this.canvasSource.clear();\n        }\n        //const ctx = this.helper.ctx;\n        //this.helper.drawBounds(`whitesmoke`);\n        //Drawing.rect(ctx, this.renderArea, { strokeStyle: `whitesmoke` });\n        this.#useGrid();\n        if (this.show.axes)\n            this.#drawAxes();\n        //let seriesCount = 0;\n        for (const [k, v] of this.#data.getEntries()) {\n            let meta = this.#data.getMeta(k);\n            if (!meta) {\n                meta = this.getDefaultMeta();\n                this.#data.setMeta(k, meta);\n            }\n            this.#drawSeries(k, v, meta);\n            //seriesCount++;\n        }\n        //console.log(`series count: ${ seriesCount }`);\n        for (const line of this.overlayLines) {\n            this.drawLine(line, line.colour, line.width);\n        }\n    }\n    /**\n     * Draws a line in value-coordinate space\n     * @param line\n     * @param colour\n     * @param width\n     */\n    drawLine(line, colour, width) {\n        const l = this.#valueLineToCanvasSpace(line.a, line.b);\n        this.#drawLineCanvasSpace(l, colour, width);\n    }\n    setMeta(series, meta) {\n        this.#data.setMeta(series, {\n            ...this.getDefaultMeta(),\n            ...meta\n        });\n    }\n    #drawAxes() {\n        const { colour, width } = this.#axisStyle;\n        // Axis coordinates in canvas-space\n        const yAxis = this.#valueLineToCanvasSpace({ x: 0, y: Number.NEGATIVE_INFINITY }, { x: 0, y: Number.POSITIVE_INFINITY }, false);\n        const xAxis = this.#valueLineToCanvasSpace({ x: Number.NEGATIVE_INFINITY, y: 0 }, { x: Number.POSITIVE_INFINITY, y: 0 }, false);\n        //console.log(`x axis: ${ xAxis.a.x }-${ xAxis.b.x }`);\n        this.#drawLineCanvasSpace(xAxis, colour, width, false);\n        this.#drawLineCanvasSpace(yAxis, colour, width, false);\n    }\n    #drawYAxisValues(yPoints) {\n        //const { ctx } = this.helper;\n        const ctx = this.#canvasRegion.context;\n        ctx.font = this.#textStyle.size + ` ` + this.#textStyle.font;\n        ctx.fillStyle = this.#textStyle.colour;\n        ctx.textBaseline = `middle`;\n        for (const p of yPoints) {\n            if (p.x === 0 && p.y === 0)\n                continue;\n            const reg = this.valueToRegionSpace(p, false);\n            const value = this.axisRounder(p.y);\n            const label = value.toString();\n            const measure = ctx.measureText(label);\n            const x = reg.x - measure.width - (this.whiskerLength / 2) - 5;\n            const y = reg.y;\n            ctx.fillText(label, x, y);\n        }\n    }\n    #drawXAxisValues(xPoints) {\n        //const { ctx } = this.helper;\n        const ctx = this.#canvasRegion.context;\n        ctx.font = this.#textStyle.size + ` ` + this.#textStyle.font;\n        ctx.fillStyle = this.#textStyle.colour;\n        ctx.textBaseline = `top`;\n        for (const p of xPoints) {\n            const reg = this.valueToRegionSpace(p, false);\n            const value = this.axisRounder(p.x);\n            const label = value.toString();\n            const measure = ctx.measureText(label);\n            const x = reg.x - measure.width / 2;\n            const y = reg.y + measure.actualBoundingBoxAscent + measure.actualBoundingBoxDescent + (this.whiskerLength / 2);\n            ctx.fillText(label, x, y);\n        }\n    }\n    #drawWhisker(p, vertical) {\n        const whiskerHalfLength = this.whiskerLength / 2;\n        const v = vertical ? { x: p.x, y: 0 } : { y: p.y, x: 0 };\n        const reg = this.valueToRegionSpace(v, false);\n        const line = vertical ? {\n            a: { x: reg.x, y: reg.y - whiskerHalfLength },\n            b: { x: reg.x, y: reg.y + whiskerHalfLength },\n        } :\n            {\n                a: { y: reg.y, x: reg.x - whiskerHalfLength },\n                b: { y: reg.y, x: reg.x + whiskerHalfLength },\n            };\n        this.#drawLineCanvasSpace(line, this.#axisStyle.colour, this.#axisStyle.width, false);\n    }\n    #drawGridline(p, vertical) {\n        const line = vertical ?\n            this.#valueLineToCanvasSpace({ x: p.x, y: Number.NEGATIVE_INFINITY }, { x: p.x, y: Number.POSITIVE_INFINITY }) :\n            this.#valueLineToCanvasSpace({ y: p.y, x: Number.NEGATIVE_INFINITY }, { y: p.y, x: Number.POSITIVE_INFINITY }, false);\n        this.#drawLineCanvasSpace(line, this.#grid.colour, p.major ? this.#grid.width * 2 : this.#grid.width);\n    }\n    #useGrid() {\n        const g = this.#grid;\n        const showGrid = this.show.grid;\n        const showWhiskers = this.show.whiskers;\n        const showValues = this.show.axisValues;\n        const mm = this.getCurrentRange().range; // actual data range, or user-provided\n        const { increments, major } = g;\n        // Vertical lines\n        const axisMarks = Cart.computeAxisMark(mm, increments, major);\n        for (const p of axisMarks.x) {\n            if (showGrid)\n                this.#drawGridline(p, true);\n            if (showWhiskers && p.major)\n                this.#drawWhisker(p, true);\n        }\n        // Horizontal lines\n        for (const p of axisMarks.y) {\n            if (showGrid)\n                this.#drawGridline(p, false);\n            if (showWhiskers && p.major)\n                this.#drawWhisker(p, false);\n        }\n        if (showValues) {\n            this.#drawXAxisValues(axisMarks.x.filter(p => p.major));\n            this.#drawYAxisValues(axisMarks.y.filter(p => p.major));\n        }\n    }\n    #drawSeries(name, series, meta) {\n        if (this.#connectStyle === `line`) {\n            this.#drawConnected(series, meta.colour, meta.lineWidth);\n        }\n        //let valueCount = 0;\n        if (this.#valueStyle === `dot`) {\n            for (const v of series) {\n                this.#drawDot(v, meta.colour, meta.dotRadius);\n                //valueCount++;\n            }\n        }\n        //console.log(`valueCount: ${ valueCount }`);\n    }\n    #drawConnected(dots, colour, width) {\n        const ctx = this.#canvasRegion.context;\n        ctx.beginPath();\n        for (const [index, dot_] of dots.entries()) {\n            const dot = this.valueToRegionSpace(dot_, false);\n            if (index === 0)\n                ctx.moveTo(dot.x, dot.y);\n            ctx.lineTo(dot.x, dot.y);\n        }\n        ctx.strokeStyle = ColourToString(colour);\n        ctx.lineWidth = width;\n        ctx.stroke();\n        ctx.closePath();\n    }\n    #drawDot(originalDot, fallbackColour, fallbackRadius) {\n        const colour = ColourToString(originalDot.fillStyle ?? fallbackColour);\n        const pos = this.valueToRegionSpace(originalDot);\n        const radius = originalDot.radius ?? fallbackRadius;\n        this.#canvasRegion.drawCircles([\n            { ...pos, radius }\n        ], colour);\n        // const ctx = this.helper.ctx;\n        // const dot = this.#valueToElementSpace(originalDot, false);\n        // const radius = originalDot.radius ?? fallbackRadius;\n        // //console.log(`dot ${ dot.x }x${ dot.y } (from ${ originalDot.x }x${ originalDot.y })`);\n        // ctx.fillStyle = Colour.resolveToString(originalDot.fillStyle ?? fallbackColour);\n        // ctx.beginPath();\n        // ctx.arc(dot.x, dot.y, radius, 0, Math.PI * 2);\n        // ctx.fill();\n        // ctx.closePath();\n    }\n    #drawLineCanvasSpace(line, colour, width, debug = false) {\n        if (debug)\n            console.log(line);\n        const ctx = this.#canvasRegion.context;\n        colour = ColourToString(colour);\n        //this.#canvasRegion.drawConnectedPoints([ line.a, line.b ], colour, width);\n        ctx.beginPath();\n        ctx.moveTo(line.a.x, line.a.y);\n        ctx.lineTo(line.b.x, line.b.y);\n        ctx.strokeStyle = ColourToString(colour);\n        ctx.lineWidth = width;\n        ctx.stroke();\n        ctx.closePath();\n    }\n    get dataSet() {\n        return this.#data;\n    }\n    get canvasRegion() {\n        return this.#canvasRegion;\n    }\n    get canvasSource() {\n        return this.#canvasRegion.source;\n    }\n}\n","export * as BipolarView from './bipolar-view.js';\nexport * from './cartesian.js';\nexport * from './cartesian-canvas-plot.js';\nexport * from './DataSet.js';\n","export * from './canvas-helper.js';\nexport * from './canvas-region.js';\nexport * from './pointer-visualise.js';\nexport * as Svg from './svg/index.js';\nexport * as Convolve2d from './convolve-2d.js';\nimport * as NamedColourPalette from './named-colour-palette.js';\nimport * as Colour from './colour/index.js';\nexport * as Colour from './colour/index.js';\nimport * as Video from './video.js';\nexport * as Drawing from './drawing.js';\n/**\n * Wraps [ImageData](https://developer.mozilla.org/en-US/docs/Web/API/ImageData) as an ixfx {@link https://api.ixfx.fun/_ixfx/geometry/Grids/Grid/} type.\n * This is useful because it's otherwise a one-dimensional array listing each rgba in turn.\n */\nexport * as ImageDataGrid from './image-data-grid.js';\nexport * as Plot from './plot/index.js';\n/**\n * Working with video, either playback from a file or stream from a video camera.\n *\n * Overview\n * * {@link frames}: Yields frames from a video camera\n * * {@link capture}: Capture frames from a VIDEO element\n *\n * @example Importing\n * ```js\n * // If library is stored two directories up under `ixfx/`\n * import {Video} from '../../ixfx/dist/visual.js';\n * // Import from web\n * import {Video} from '@ixfx/visual.js'\n * ```\n */\nexport * as Video from './video.js';\ntry {\n    if (typeof window !== `undefined`) {\n        window.ixfx = {\n            ...window.ixfx,\n            Visuals: {\n                NamedColourPalette,\n                Colour,\n                Video,\n            },\n        };\n    }\n}\ncatch {\n    /* no-op */\n}\n","import { arrayTest, resultThrow } from '@ixfx/guards';\nimport { Colour } from '@ixfx/visual';\nimport { resolveEl } from '@ixfx/dom';\n//import type { IStackImmutable } from '@ixfx/collections';\nimport { StackImmutable, type IStackImmutable } from '@ixfx/collections/stack';\nimport { Beziers, Lines, Points, Rects, Triangles, type Arcs, type Circles, type Ellipses, type Paths } from '@ixfx/geometry';\nimport { quantiseEvery } from '@ixfx/numbers';\n\n// import type { Point } from '../geometry/point/PointType.js';\n// import type { Line } from '../geometry/line/LineType.js';\n// import type { CirclePositioned } from '../geometry/circle/CircleType.js';\n// import type { Rect, RectPositioned } from '../geometry/rect/index.js';\n// import type { Path } from '../geometry/path/PathType.js';\n// import type { Triangle } from '../geometry/triangle/TriangleType.js';\n\n// import { Empty as RectsEmpty } from '../geometry/rect/Empty.js';\n// import { corners as RectsCorners } from '../geometry/rect/Corners.js';\n// import { isLine } from '../geometry/line/Guard.js';\n// import { quantiseEvery } from '../numbers/Quantise.js';\n\nconst PIPI = Math.PI * 2;\n\nexport type CanvasContextQuery =\n  | null\n  | string\n  | CanvasRenderingContext2D\n  | HTMLCanvasElement;\n\n/**\n * Gets a 2d drawing context from canvas element or query, or throws an error\n * @param canvasElementContextOrQuery Canvas element reference or DOM query\n * @returns Drawing context.\n */\nexport const getContext = (\n  canvasElementContextOrQuery: CanvasContextQuery\n): CanvasRenderingContext2D => {\n  if (canvasElementContextOrQuery === null) {\n    throw new Error(\n      `canvasElCtxOrQuery null. Must be a 2d drawing context or Canvas element`\n    );\n  }\n  if (canvasElementContextOrQuery === undefined) {\n    throw new Error(\n      `canvasElCtxOrQuery undefined. Must be a 2d drawing context or Canvas element`\n    );\n  }\n\n  const ctx =\n    canvasElementContextOrQuery instanceof CanvasRenderingContext2D\n      ? canvasElementContextOrQuery\n      : canvasElementContextOrQuery instanceof HTMLCanvasElement\n        ? canvasElementContextOrQuery.getContext(`2d`)\n\n        : typeof canvasElementContextOrQuery === `string`\n          ? resolveEl<HTMLCanvasElement>(canvasElementContextOrQuery).getContext(`2d`)\n          : canvasElementContextOrQuery;\n  if (ctx === null) throw new Error(`Could not create 2d context for canvas`);\n  return ctx;\n};\n\n\n/**\n * Makes a helper object that wraps together a bunch of drawing functions that all use the same drawing context\n * @param ctxOrCanvasEl Drawing context or canvs element reference\n * @param canvasBounds Bounds of drawing (optional). Used for limiting `textBlock`\n * @returns\n */\nexport const makeHelper = (\n  ctxOrCanvasEl: CanvasContextQuery,\n  canvasBounds?: Rects.Rect\n) => {\n  const ctx = getContext(ctxOrCanvasEl);\n  return {\n    ctx,\n    paths(pathsToDraw: Paths.Path[] | readonly Paths.Path[], opts?: DrawingOpts): void {\n      paths(ctx, pathsToDraw, opts);\n    },\n    line(lineToDraw: Lines.Line | Lines.Line[], opts?: DrawingOpts): void {\n      line(ctx, lineToDraw, opts);\n    },\n    rect(\n      rectsToDraw: Rects.Rect | Rects.Rect[] | Rects.RectPositioned | Rects.RectPositioned[],\n      opts?: RectOpts\n    ): void {\n      rect(ctx, rectsToDraw, opts);\n    },\n    bezier(\n      bezierToDraw: Beziers.QuadraticBezier | Beziers.CubicBezier,\n      opts?: DrawingOpts\n    ): void {\n      bezier(ctx, bezierToDraw, opts);\n    },\n    connectedPoints(\n      pointsToDraw: Points.Point[],\n      opts?: DrawingOpts & Partial<ConnectedPointsOptions>\n    ): void {\n      connectedPoints(ctx, pointsToDraw, opts);\n    },\n    pointLabels(pointsToDraw: Points.Point[], opts?: DrawingOpts): void {\n      pointLabels(ctx, pointsToDraw, opts);\n    },\n    dot(\n      dotPosition: Points.Point | Points.Point[],\n      opts?: DotOpts\n    ): void {\n      dot(ctx, dotPosition, opts);\n    },\n    circle(\n      circlesToDraw: Circles.CirclePositioned | Circles.CirclePositioned[],\n      opts: DrawingOpts\n    ): void {\n      circle(ctx, circlesToDraw, opts);\n    },\n    arc(\n      arcsToDraw: Arcs.ArcPositioned | Arcs.ArcPositioned[],\n      opts: DrawingOpts\n    ): void {\n      arc(ctx, arcsToDraw, opts);\n    },\n    textBlock(\n      lines: string[],\n      opts: DrawingOpts & {\n        anchor: Points.Point;\n        anchorPadding?: number;\n        bounds?: Rects.RectPositioned;\n      }\n    ): void {\n      if (opts.bounds === undefined && canvasBounds !== undefined) {\n        opts = { ...opts, bounds: { ...canvasBounds, x: 0, y: 0 } };\n      }\n      textBlock(ctx, lines, opts);\n    },\n  };\n};\n\n/**\n * Drawing options\n */\nexport type DrawingOpts = {\n  /**\n   * Stroke style\n   */\n  readonly strokeStyle?: string;\n  /**\n   * Fill style\n   */\n  readonly fillStyle?: string;\n  /**\n   * If true, diagnostic helpers will be drawn\n   */\n  readonly debug?: boolean;\n};\n\nexport type LineOpts = {\n  readonly lineWidth?: number;\n  readonly lineCap?: CanvasLineCap;\n  readonly lineJoin?: CanvasLineJoin;\n};\n\n/**\n * Creates a drawing op to apply provided options\n * @param opts Drawing options that apply\n * @returns Stack\n */\nconst optsOp = (opts: DrawingOpts): StackOp =>\n  coloringOp(opts.strokeStyle, opts.fillStyle);\n\n/**\n * Applies drawing options to `ctx`, returning a {@link DrawingStack}\n * @param ctx Context\n * @param opts Options\n * @returns\n */\nconst applyOpts = (\n  ctx: CanvasRenderingContext2D,\n  opts: DrawingOpts = {},\n  ...additionalOps: readonly StackOp[]\n): DrawingStack => {\n  if (ctx === undefined) throw new Error(`ctx undefined`);\n\n  // Create a drawing stack, pushing an op generated from drawing options\n  const stack = drawingStack(ctx).push(optsOp(opts), ...additionalOps);\n\n  // Apply stack to context\n  stack.apply();\n  return stack;\n};\n\n/**\n * Draws one or more arcs.\n * @param ctx\n * @param arcs\n * @param opts\n */\nexport const arc = (\n  ctx: CanvasRenderingContext2D,\n  arcs: Arcs.ArcPositioned | readonly Arcs.ArcPositioned[],\n  opts: DrawingOpts = {}\n) => {\n  applyOpts(ctx, opts);\n\n  const draw = (arc: Arcs.ArcPositioned) => {\n    ctx.beginPath();\n    ctx.arc(arc.x, arc.y, arc.radius, arc.startRadian, arc.endRadian);\n    ctx.stroke();\n  };\n\n  const arcsArray: Arcs.ArcPositioned[] = Array.isArray(arcs) ? arcs : [ arcs ];\n  for (const arc of arcsArray) {\n    draw(arc);\n  }\n\n};\n\n/**\n * A drawing stack operation\n */\nexport type StackOp = (ctx: CanvasRenderingContext2D) => void;\n\n/**\n * A drawing stack (immutable)\n */\nexport type DrawingStack = {\n  /**\n   * Push a new drawing op\n   * @param ops Operation to add\n   * @returns stack with added op\n   */\n  push(...ops: readonly StackOp[]): DrawingStack;\n  /**\n   * Pops an operatiomn\n   * @returns Drawing stack with item popped\n   */\n  pop(): DrawingStack;\n  /**\n   * Applies drawing stack\n   */\n  apply(): DrawingStack;\n};\n\n/**\n * Colouring drawing op. Applies `fillStyle` and `strokeStyle`\n * @param strokeStyle\n * @param fillStyle\n * @returns\n */\nconst coloringOp = (\n  strokeStyle: string | CanvasGradient | CanvasPattern | undefined,\n  fillStyle: string | CanvasGradient | CanvasPattern | undefined\n): StackOp => {\n  const apply = (ctx: CanvasRenderingContext2D) => {\n    if (fillStyle) ctx.fillStyle = fillStyle;\n    if (strokeStyle) ctx.strokeStyle = strokeStyle;\n  };\n  return apply;\n};\n\nconst lineOp = (\n  lineWidth: number | undefined,\n  lineJoin: CanvasLineJoin | undefined,\n  lineCap: CanvasLineCap | undefined\n): StackOp => {\n  const apply = (ctx: CanvasRenderingContext2D) => {\n    if (lineWidth) ctx.lineWidth = lineWidth;\n    if (lineJoin) ctx.lineJoin = lineJoin;\n    if (lineCap) ctx.lineCap = lineCap;\n  };\n  return apply;\n};\n\n/**\n * Creates and returns an immutable drawing stack for a context\n * @param ctx Context\n * @param stk Initial stack operations\n * @returns\n */\nexport const drawingStack = (\n  ctx: CanvasRenderingContext2D,\n  stk?: IStackImmutable<StackOp>\n): DrawingStack => {\n  stk ??= new StackImmutable<StackOp>();\n\n  const push = (...ops: StackOp[]): DrawingStack => {\n    stk ??= new StackImmutable<StackOp>();\n    const s = stk.push(...ops);\n    for (const o of ops) o(ctx);\n    return drawingStack(ctx, s);\n  };\n\n  const pop = (): DrawingStack => {\n    const s = stk?.pop();\n    return drawingStack(ctx, s);\n  };\n\n  const apply = (): DrawingStack => {\n    if (stk === undefined) return drawingStack(ctx);\n    for (const op of stk.data) op(ctx);\n    return drawingStack(ctx, stk);\n  };\n\n  return { push, pop, apply };\n};\n\n/**\n * Draws a curved line through a set of points\n * @param ctx \n * @param points \n * @param opts \n */\nexport const lineThroughPoints = (\n  ctx: CanvasRenderingContext2D,\n  points: readonly Points.Point[],\n  opts?: DrawingOpts\n): void => {\n  applyOpts(ctx, opts);\n\n  // https://stackoverflow.com/questions/7054272/how-to-draw-smooth-curve-through-n-points-using-javascript-html5-canvas\n  ctx.moveTo(points[ 0 ].x, points[ 0 ].y);\n\n  for (const [ index, p ] of points.entries()) {\n    if (index + 2 >= points.length) continue;\n    const pNext = points[ index + 1 ];\n    const mid = {\n      x: (p.x + pNext.x) / 2,\n      y: (p.y + pNext.y) / 2,\n    };\n    const cpX1 = (mid.x + p.x) / 2;\n    const cpX2 = (mid.x + pNext.x) / 2;\n    ctx.quadraticCurveTo(cpX1, pNext.y, mid.x, mid.y);\n    ctx.quadraticCurveTo(cpX2, pNext.y, pNext.x, pNext.y);\n  }\n};\n\n/**\n * Draws one or more circles. Will draw outline/fill depending on\n * whether `strokeStyle` or `fillStyle` params are present in the drawing options.\n *\n * ```js\n * // Draw a circle with radius of 10 at 0,0\n * circle(ctx, {radius:10});\n *\n * // Draw a circle of radius 10 at 100,100\n * circle(ctx, {radius: 10, x: 100, y: 100});\n *\n * // Draw two blue outlined circles\n * circle(ctx, [ {radius: 5}, {radius: 10} ], {strokeStyle:`blue`});\n * ```\n * @param ctx Drawing context\n * @param circlesToDraw Circle(s) to draw\n * @param opts Drawing options\n */\nexport const circle = (\n  ctx: CanvasRenderingContext2D,\n  circlesToDraw: Circles.CirclePositioned | readonly Circles.CirclePositioned[],\n  opts: DrawingOpts = {}\n) => {\n  applyOpts(ctx, opts);\n\n  const draw = (c: Circles.CirclePositioned) => {\n    ctx.beginPath();\n    ctx.arc(c.x, c.y, c.radius, 0, PIPI);\n    if (opts.strokeStyle) ctx.stroke();\n    if (opts.fillStyle) ctx.fill();\n  };\n\n  if (Array.isArray(circlesToDraw)) {\n    for (const c of circlesToDraw) draw(c as Circles.CirclePositioned);\n  } else {\n    draw(circlesToDraw as Circles.CirclePositioned);\n  }\n};\n\n/**\n * Draws one or more ellipses. Will draw outline/fill depending on\n * whether `strokeStyle` or `fillStyle` params are present in the drawing options.\n * @param ctx\n * @param ellipsesToDraw\n * @param opts\n */\nexport const ellipse = (\n  ctx: CanvasRenderingContext2D,\n  ellipsesToDraw:\n    | Ellipses.EllipsePositioned\n    | readonly Ellipses.EllipsePositioned[],\n  opts: DrawingOpts = {}\n) => {\n  applyOpts(ctx, opts);\n\n  const draw = (ellipse: Ellipses.EllipsePositioned) => {\n    ctx.beginPath();\n    const rotation = ellipse.rotation ?? 0;\n    const startAngle = ellipse.startAngle ?? 0;\n    const endAngle = ellipse.endAngle ?? PIPI;\n    ctx.ellipse(ellipse.x, ellipse.y, ellipse.radiusX, ellipse.radiusY, rotation, startAngle, endAngle);\n    if (opts.strokeStyle) ctx.stroke();\n    if (opts.fillStyle) ctx.fill();\n  };\n\n  const ellipsesArray = Array.isArray(ellipsesToDraw) ? ellipsesToDraw : [ ellipsesToDraw ];\n  for (const ellipse of ellipsesArray) {\n    draw(ellipse);\n  }\n};\n\n/**\n * Draws one or more paths.\n * supported paths are quadratic beziers and lines.\n * @param ctx\n * @param pathsToDraw\n * @param opts\n */\nexport const paths = (\n  ctx: CanvasRenderingContext2D,\n  pathsToDraw: readonly Paths.Path[] | Paths.Path,\n  opts: { readonly strokeStyle?: string; readonly debug?: boolean } = {}\n) => {\n  applyOpts(ctx, opts);\n\n  const draw = (path: Paths.Path) => {\n    // Call appropriate drawing function depending on the type of path\n    if (Beziers.isQuadraticBezier(path)) quadraticBezier(ctx, path, opts);\n    else if (Lines.isLine(path)) line(ctx, path, opts);\n    else throw new Error(`Unknown path type ${ JSON.stringify(path) }`);\n  };\n\n  if (Array.isArray(pathsToDraw)) {\n    for (const p of pathsToDraw) draw(p);\n  } else {\n    draw(pathsToDraw as Paths.Path);\n  }\n};\n\nexport type ConnectedPointsOptions = {\n  readonly lineWidth: number\n  readonly loop: boolean\n  readonly fillStyle: string\n  readonly strokeStyle: string\n}\n/**\n * Draws a line between all the given points.\n * If a fillStyle is specified, it will be filled.\n *\n * See also:\n * * {@link line}: Draw one or more lines\n *\n * @param ctx\n * @param pts\n */\nexport const connectedPoints = (\n  ctx: CanvasRenderingContext2D,\n  pts: readonly Points.Point[],\n  opts: Partial<ConnectedPointsOptions> = {}\n) => {\n  const shouldLoop = opts.loop ?? false;\n\n  resultThrow(arrayTest(pts, `pts`));\n\n  if (pts.length === 0) return;\n\n  // Throw an error if any point is invalid\n  for (const [ index, pt ] of pts.entries()) Points.guard(pt, `Index ${ index }`);\n\n  applyOpts(ctx, opts);\n\n  // Draw points\n  if (opts.lineWidth) ctx.lineWidth = opts.lineWidth;\n  ctx.beginPath();\n  ctx.moveTo(pts[ 0 ].x, pts[ 0 ].y);\n  for (const pt of pts) ctx.lineTo(pt.x, pt.y);\n\n  if (shouldLoop) ctx.lineTo(pts[ 0 ].x, pts[ 0 ].y);\n\n  // if (opts.strokeStyle) ctx.strokeStyle = opts.strokeStyle;\n  if (\n    opts.strokeStyle ||\n    (opts.strokeStyle === undefined && opts.fillStyle === undefined)\n  ) {\n    ctx.stroke();\n  }\n  if (opts.fillStyle) {\n    ctx.fill();\n  }\n};\n\n/**\n * Draws labels for a set of points\n * @param ctx\n * @param pts Points to draw\n * @param opts\n * @param labels Labels for points\n */\nexport const pointLabels = (\n  ctx: CanvasRenderingContext2D,\n  pts: readonly Points.Point[],\n  opts: { readonly fillStyle?: string } = {},\n  labels?: readonly string[]\n) => {\n  if (pts.length === 0) return;\n\n  // Throw an error if any point is invalid\n  for (const [ index, pt ] of pts.entries()) Points.guard(pt, `Index ${ index }`);\n\n  applyOpts(ctx, opts);\n\n  for (const [ index, pt ] of pts.entries()) {\n    const label =\n      labels !== undefined && index < labels.length ? labels[ index ] : index.toString();\n    ctx.fillText(label.toString(), pt.x, pt.y);\n  }\n};\n\n/**\n * Returns `point` with the canvas's translation matrix applied\n * @param ctx\n * @param point\n * @returns\n */\nexport const translatePoint = (\n  ctx: CanvasRenderingContext2D,\n  point: Points.Point\n): Points.Point => {\n  const m = ctx.getTransform();\n  return {\n    x: point.x * m.a + point.y * m.c + m.e,\n    y: point.x * m.b + point.y * m.d + m.f,\n  };\n};\n\n/**\n * Creates a new HTML IMG element with a snapshot of the\n * canvas. Element will need to be inserted into the document.\n *\n * ```\n * const myCanvas = document.getElementById('someCanvas');\n * const el = copyToImg(myCanvas);\n * document.getElementById('images').appendChild(el);\n * ```\n * @param canvasEl\n * @returns\n */\nexport const copyToImg = (canvasEl: HTMLCanvasElement): HTMLImageElement => {\n  const img = document.createElement(`img`);\n  img.src = canvasEl.toDataURL(`image/jpeg`);\n  return img;\n};\n\nexport type DotOpts = DrawingOpts & {\n  readonly radius?: number;\n  readonly stroke?: boolean;\n  readonly filled?: boolean;\n  readonly strokeWidth?: number;\n}\n\n/**\n * Draws filled circle(s) at provided point(s)\n * @param ctx\n * @param pos\n * @param opts\n */\nexport const dot = (\n  ctx: CanvasRenderingContext2D,\n  pos: Points.Point | (Points.Point | Circles.CirclePositioned)[] | Circles.CirclePositioned,\n  opts?: DotOpts\n) => {\n  opts ??= {};\n  const radius = opts.radius ?? 10;\n  const positions = Array.isArray(pos) ? pos : [ pos ];\n  const stroke = opts.stroke ? opts.stroke : opts.strokeStyle !== undefined;\n  let filled = opts.filled ? opts.filled : opts.fillStyle !== undefined;\n  if (!stroke && !filled) filled = true;\n\n  applyOpts(ctx, opts);\n\n  for (const pos of positions) {\n    ctx.beginPath();\n    if (`radius` in pos) {\n      ctx.arc(pos.x, pos.y, pos.radius, 0, 2 * Math.PI);\n    } else {\n      ctx.arc(pos.x, pos.y, radius, 0, 2 * Math.PI);\n    }\n    if (filled) {\n      ctx.fill();\n    }\n    if (stroke) {\n      ctx.stroke();\n    }\n  }\n\n  // const makePath = () => {\n  //   ctx.beginPath();\n\n  //   // x&y for arc is the center of circle\n  //   if (Array.isArray(pos)) {\n  //     for (const p of pos) {\n  //       ctx.arc(p.x, p.y, radius, 0, 2 * Math.PI);\n  //     }\n  //   } else {\n  //     const p = pos as Point;\n  //     ctx.arc(p.x, p.y, radius, 0, 2 * Math.PI);\n  //   }\n  // }\n  // makePath();\n  // if (opts.filled || !opts.stroke) {\n  //   ctx.fill();\n  // }\n  // if (opts.stroke) {\n  //   if (opts.strokeWidth) ctx.lineWidth = opts.strokeWidth;\n  //   //makePath();\n  //   ctx.stroke();\n  // }\n};\n\n/**\n * Draws a cubic or quadratic bezier\n * @param ctx\n * @param bezierToDraw\n * @param opts\n */\nexport const bezier = (\n  ctx: CanvasRenderingContext2D,\n  bezierToDraw: Beziers.QuadraticBezier | Beziers.CubicBezier,\n  opts?: DrawingOpts\n) => {\n  if (Beziers.isQuadraticBezier(bezierToDraw)) {\n    quadraticBezier(ctx, bezierToDraw, opts);\n  } else if (Beziers.isCubicBezier(bezierToDraw)) {\n    cubicBezier(ctx, bezierToDraw, opts);\n  }\n};\n\nconst cubicBezier = (\n  ctx: CanvasRenderingContext2D,\n  bezierToDraw: Beziers.CubicBezier,\n  opts: DrawingOpts = {}\n) => {\n  let stack = applyOpts(ctx, opts);\n\n  const { a, b, cubic1, cubic2 } = bezierToDraw;\n  const isDebug = opts.debug ?? false;\n\n  if (isDebug) {\n    /*\n     * const ss = ctx.strokeStyle;\n     * ctx.strokeStyle = ss;\n     */\n  }\n  ctx.beginPath();\n  ctx.moveTo(a.x, a.y);\n  ctx.bezierCurveTo(cubic1.x, cubic1.y, cubic2.x, cubic2.y, b.x, b.y);\n  ctx.stroke();\n\n  if (isDebug) {\n    stack = stack.push(\n      optsOp({\n        ...opts,\n        strokeStyle: Colour.multiplyOpacity(opts.strokeStyle ?? `silver`, 0.6),\n        fillStyle: Colour.multiplyOpacity(opts.fillStyle ?? `yellow`, 0.4),\n      })\n    );\n\n    stack.apply();\n    ctx.moveTo(a.x, a.y);\n    ctx.lineTo(cubic1.x, cubic1.y);\n    ctx.stroke();\n    ctx.moveTo(b.x, b.y);\n    ctx.lineTo(cubic2.x, cubic2.y);\n    ctx.stroke();\n\n    ctx.fillText(`a`, a.x + 5, a.y);\n    ctx.fillText(`b`, b.x + 5, b.y);\n    ctx.fillText(`c1`, cubic1.x + 5, cubic1.y);\n    ctx.fillText(`c2`, cubic2.x + 5, cubic2.y);\n\n    dot(ctx, cubic1, { radius: 3 });\n    dot(ctx, cubic2, { radius: 3 });\n    dot(ctx, a, { radius: 3 });\n    dot(ctx, b, { radius: 3 });\n    stack = stack.pop();\n    stack.apply();\n  }\n};\n\nconst quadraticBezier = (\n  ctx: CanvasRenderingContext2D,\n  bezierToDraw: Beziers.QuadraticBezier,\n  opts: DrawingOpts = {}\n) => {\n  const { a, b, quadratic } = bezierToDraw;\n  const isDebug = opts.debug ?? false;\n  let stack = applyOpts(ctx, opts);\n\n  ctx.beginPath();\n  ctx.moveTo(a.x, a.y);\n  ctx.quadraticCurveTo(quadratic.x, quadratic.y, b.x, b.y);\n  ctx.stroke();\n\n  if (isDebug) {\n    /*\n     * const fs = ctx.fillStyle;\n     * const ss = ctx.strokeStyle;\n     * ctx.fillStyle = opts.strokeStyle ?? `gray`;\n     * ctx.strokeStyle = opts.strokeStyle ?? `gray`;\n     */\n    stack = stack.push(\n      optsOp({\n        ...opts,\n        strokeStyle: Colour.multiplyOpacity(opts.strokeStyle ?? `silver`, 0.6),\n        fillStyle: Colour.multiplyOpacity(opts.fillStyle ?? `yellow`, 0.4),\n      })\n    );\n    connectedPoints(ctx, [ a, quadratic, b ]);\n\n    ctx.fillText(`a`, a.x + 5, a.y);\n    ctx.fillText(`b`, b.x + 5, b.y);\n    ctx.fillText(`h`, quadratic.x + 5, quadratic.y);\n    dot(ctx, quadratic, { radius: 3 });\n    dot(ctx, a, { radius: 3 });\n    dot(ctx, b, { radius: 3 });\n    /*\n     * ctx.fillStyle = fs;\n     * ctx.strokeStyle = ss;\n     */\n    stack = stack.pop();\n    stack.apply();\n  }\n};\n\n/**\n * Draws one or more lines.\n *\n * Each line is drawn independently, ie it's not assumed lines are connected.\n *\n * See also:\n * * {@link connectedPoints}: Draw a series of connected points\n * @param ctx\n * @param toDraw\n * @param opts\n */\nexport const line = (\n  ctx: CanvasRenderingContext2D,\n  toDraw: Lines.Line | readonly Lines.Line[],\n  opts: LineOpts & DrawingOpts = {}\n) => {\n  const isDebug = opts.debug ?? false;\n  const o = lineOp(opts.lineWidth, opts.lineJoin, opts.lineCap);\n  applyOpts(ctx, opts, o);\n\n  const draw = (d: Lines.Line) => {\n    const { a, b } = d;\n    ctx.beginPath();\n    ctx.moveTo(a.x, a.y);\n    ctx.lineTo(b.x, b.y);\n    if (isDebug) {\n      ctx.fillText(`a`, a.x, a.y);\n      ctx.fillText(`b`, b.x, b.y);\n      dot(ctx, a, { radius: 5, strokeStyle: `black` });\n      dot(ctx, b, { radius: 5, strokeStyle: `black` });\n    }\n    ctx.stroke();\n  };\n\n  if (Array.isArray(toDraw)) {\n    for (const t of toDraw) draw(t as Lines.Line);\n  } else {\n    draw(toDraw as Lines.Line);\n  }\n};\n\n/**\n * Draws one or more triangles\n * @param ctx\n * @param toDraw\n * @param opts\n */\nexport const triangle = (\n  ctx: CanvasRenderingContext2D,\n  toDraw: Triangles.Triangle | readonly Triangles.Triangle[],\n  opts: DrawingOpts & { readonly filled?: boolean } = {}\n) => {\n  applyOpts(ctx, opts);\n\n  const draw = (t: Triangles.Triangle) => {\n    connectedPoints(ctx, Triangles.corners(t), { ...opts, loop: true });\n\n    if (opts.debug) {\n      pointLabels(ctx, Triangles.corners(t), undefined, [ `a`, `b`, `c` ]);\n    }\n  };\n\n  if (Array.isArray(toDraw)) {\n    for (const t of toDraw) {\n      draw(t);\n    }\n  } else {\n    draw(toDraw as Triangles.Triangle);\n  }\n};\n\n// export const arrowFromTip = (ctx:CanvasRenderingContext2D, tipPos: Point, tailLength:number, opts:DrawingOpts) => {\n//   if (opts.fillStyle) ctx.fillStyle = opts.fillStyle;\n//   if (opts.strokeStyle) ctx.strokeStyle = opts.strokeStyle;\n\n//   ctx.save();\n//   ctx.translate\n//   ctx.restore();\n// }\n\n\nexport type RectOpts = DrawingOpts & Readonly<Partial<{\n  stroke: boolean\n  filled: boolean\n  strokeWidth: number\n  /**\n   * If true, diagonals are drawn\n   */\n  crossed: boolean\n}>>\n\n/**\n * Draws one or more rectangles.\n * \n * @param ctx\n * @param toDraw\n * @param opts\n */\nexport const rect = (\n  ctx: CanvasRenderingContext2D,\n  toDraw: Rects.Rect | Rects.Rect[] | Rects.RectPositioned | Rects.RectPositioned[],\n  opts: RectOpts = {}\n) => {\n  applyOpts(ctx, opts);\n\n  const filled = opts.filled ?? (opts.fillStyle === undefined ? false : true);\n  const stroke = opts.stroke ?? (opts.strokeStyle === undefined ? false : true);\n  const draw = (d: Rects.RectPositioned | Rects.Rect) => {\n    const x = `x` in d ? d.x : 0;\n    const y = `y` in d ? d.y : 0;\n    if (filled) ctx.fillRect(x, y, d.width, d.height);\n    if (stroke) {\n      if (opts.strokeWidth) ctx.lineWidth = opts.strokeWidth;\n      //if (opts.strokeStyle) ctx.strokeStyle = opts.strokeStyle;\n      ctx.strokeRect(x, y, d.width, d.height);\n    }\n    if (opts.crossed) {\n      ctx.beginPath();\n      ctx.moveTo(x, y);\n      ctx.lineTo(d.width, d.height);\n      ctx.stroke();\n      ctx.moveTo(0, d.height);\n      ctx.lineTo(d.width, 0);\n      ctx.stroke();\n    }\n    if (opts.debug) {\n      pointLabels(ctx, Rects.corners(d), undefined, [ `NW`, `NE`, `SE`, `SW` ]);\n    }\n  };\n\n  if (Array.isArray(toDraw)) {\n    for (const t of toDraw) {\n      draw(t);\n    }\n  } else {\n    draw(toDraw as Rects.RectPositioned);\n  }\n};\n\n/**\n * Returns the width of `text`. Rounds number up to nearest multiple if provided. If\n * text is empty or undefined, 0 is returned.\n * @param ctx\n * @param text\n * @param widthMultiple\n * @returns\n */\nexport const textWidth = (\n  ctx: CanvasRenderingContext2D,\n  text?: string | null,\n  padding = 0,\n  widthMultiple?: number\n): number => {\n  const rect = textRect(ctx, text, padding, widthMultiple);\n  return rect.width;\n};\n\nexport const textRect = (ctx: CanvasRenderingContext2D,\n  text?: string | null,\n  padding = 0, widthMultiple?: number): Rects.Rect => {\n  if (text === undefined || text === null || text.length === 0) return Rects.Empty;\n  const m = ctx.measureText(text);\n\n  const width = (widthMultiple) ? quantiseEvery(m.width, widthMultiple) + padding : m.width + padding;\n\n  return {\n    width: width,\n    height: m.actualBoundingBoxAscent + m.actualBoundingBoxDescent + padding + padding\n  }\n}\n\nexport const textHeight = (\n  ctx: CanvasRenderingContext2D,\n  text?: string | null,\n  padding = 0): number => {\n  const rect = textRect(ctx, text, padding);\n  return rect.height;\n  // if (text === undefined || text === null || text.length === 0) return 0;\n  // const m = ctx.measureText(text);\n  // return m.actualBoundingBoxAscent + m.actualBoundingBoxDescent + padding + padding;\n}\n\n\n/**\n * Draws a block of text. Each array item is considered a line.\n * @param ctx\n * @param lines\n * @param opts\n */\nexport const textBlock = (\n  ctx: CanvasRenderingContext2D,\n  lines: readonly string[],\n  opts: DrawingOpts & {\n    readonly anchor: Points.Point;\n    readonly align?: `top` | `center`\n    readonly anchorPadding?: number;\n    readonly bounds?: Rects.RectPositioned;\n  }\n) => {\n  applyOpts(ctx, opts);\n  const anchorPadding = opts.anchorPadding ?? 0;\n  const align = opts.align ?? `top`;\n  const anchor = opts.anchor;\n  const bounds = opts.bounds ?? { x: 0, y: 0, width: 1_000_000, height: 1_000_000 };\n\n  // Measure each line\n  const blocks = lines.map((l) => ctx.measureText(l));\n\n  // Get width and height\n  const widths = blocks.map((tm) => tm.width);\n  const heights = blocks.map(\n    (tm) => tm.actualBoundingBoxAscent + tm.actualBoundingBoxDescent + 3\n  );\n\n  // Find extremes\n  const maxWidth = Math.max(...widths);\n  const totalHeight = heights.reduce((accumulator, value) => accumulator + value, 0);\n\n  let { x, y } = anchor;\n\n  if (anchor.x + maxWidth > bounds.width) {\n    x = bounds.width - (maxWidth + anchorPadding);\n  } else x -= anchorPadding;\n\n  if (x < bounds.x) x = bounds.x + anchorPadding;\n\n  if (anchor.y + totalHeight > bounds.height) {\n    y = bounds.height - (totalHeight + anchorPadding);\n  } else y -= anchorPadding;\n\n  if (y < bounds.y) y = bounds.y + anchorPadding;\n\n  if (align === `top`) {\n    ctx.textBaseline = `top`;\n  } else {\n    ctx.textBaseline = `middle`;\n  }\n  for (const [ index, line ] of lines.entries()) {\n    ctx.fillText(line, x, y);\n    y += heights[ index ];\n  }\n};\n\nexport type HorizAlign = `left` | `right` | `center`;\nexport type VertAlign = `top` | `center` | `bottom`;\n\n/**\n * Draws an aligned text block\n */\nexport const textBlockAligned = (\n  ctx: CanvasRenderingContext2D,\n  text: readonly string[] | string,\n  opts: DrawingOpts & {\n    readonly bounds: Rects.RectPositioned;\n    readonly horiz?: HorizAlign;\n    readonly vert?: VertAlign;\n  }\n) => {\n  const { bounds } = opts;\n  const { horiz = `left`, vert = `top` } = opts;\n\n  const lines = typeof text === `string` ? [ text ] : text;\n\n  applyOpts(ctx, opts);\n\n  ctx.save();\n  ctx.translate(bounds.x, bounds.y);\n  ctx.textAlign = `left`;\n  ctx.textBaseline = `top`;\n  const middleX = bounds.width / 2;\n  const middleY = bounds.height / 2;\n\n  // Measure each line\n  const blocks = lines.map((l) => ctx.measureText(l));\n  const heights = blocks.map(\n    (tm) => tm.actualBoundingBoxAscent + tm.actualBoundingBoxDescent\n  );\n  const totalHeight = heights.reduce((accumulator, value) => accumulator + value, 0);\n\n  let y = 0;\n  if (vert === `center`) y = middleY - totalHeight / 2;\n  else if (vert === `bottom`) {\n    y = bounds.height - totalHeight;\n  }\n\n  for (const [ index, line ] of lines.entries()) {\n    let x = 0;\n    if (horiz === `center`) x = middleX - blocks[ index ].width / 2;\n    else if (horiz === `right`) x = bounds.width - blocks[ index ].width;\n    ctx.fillText(line, x, y);\n    y += heights[ index ];\n  }\n\n  ctx.restore();\n};\n","import type { Hsl, Rgb, OkLch, Colourish } from \"./types.js\";\n\nexport const isHsl = (v: any): v is Hsl => {\n  if (typeof v !== `object`) return false;\n  if (!(`h` in v)) return false;\n  if (!(`s` in v)) return false;\n  if (!(`l` in v)) return false;\n  if (!(`unit` in v)) return false;\n  if (!(`space` in v)) return false;\n  if (v.space !== `hsl`) return false;\n  return true;\n}\n\nexport const isRgb = (v: any): v is Rgb => {\n  if (typeof v !== `object`) return false;\n  if (!(`r` in v)) return false;\n  if (!(`g` in v)) return false;\n  if (!(`b` in v)) return false;\n  if (!(`space` in v)) return false;\n  if (!(`unit` in v)) return false;\n  if (v.space === `srgb`) return true;\n  return false;\n}\n\n\n/**\n * If the input object has r,g&b properties, it will return a fully-\n * formed Rgb type with `unit` and `space` properties.\n * \n * If it lacks these basic three properties or they are out of range,\n *  _undefined_ is returned.\n * \n * If RGB values are less than 1 assumes unit:scalar. Otherwise unit:8bit.\n * If RGB values exceed 255, _undefined_ returned.\n * @param v \n * @returns \n */\nexport const tryParseObjectToRgb = (v: any): Rgb | undefined => {\n  if (typeof v !== `object`) throw new TypeError(`Param 'v' is expected to be an object, got: ${ typeof v }`);\n  if (!(`r` in v && `g` in v && `b` in v)) return;\n  if (!(`unit` in v)) {\n    if (v.r <= 1 && v.g <= 1 && v.b <= 1) {\n      v.unit = `scalar`;\n    } else if (v.r > 255 && v.g <= 255 && v.b <= 255) {\n      return; // out of range\n    } else {\n      v.unit = `8bit`;\n    }\n  }\n  if (!(`space` in v)) {\n    v.space = `srgb`;\n  }\n  return v as Rgb;\n}\n\nexport const tryParseObjectToHsl = (v: any): Hsl | undefined => {\n  if (!(`h` in v && `s` in v && `l` in v)) return;\n  if (!(`unit` in v)) {\n    if (v.r <= 1 && v.g <= 1 && v.b <= 1) {\n      v.unit = `scalar`;\n    } else if (v.s > 100 && v.l <= 100) {\n      return; // out of range\n    } else {\n      v.unit = `absolute`;\n    }\n  }\n  if (!(`space` in v)) {\n    v.space = `hsl`;\n  }\n  return v as Hsl;\n}\n\nexport const isOkLch = (v: any): v is OkLch => {\n  if (typeof v !== `object`) return false;\n  if (!(`l` in v)) return false;\n  if (!(`c` in v)) return false;\n  if (!(`h` in v)) return false;\n  if (!(`unit` in v)) return false;\n  if (!(`space` in v)) return false;\n  if (v.space === `lch`) return true;\n  if (v.space === `oklch`) return true;\n  return false;\n}\n\nexport const isColourish = (v: any): v is Colourish => {\n  if (typeof v === `string`) return true;\n  if (typeof v !== `object`) return false;\n  if (isHsl(v)) return true;\n  if (isOkLch(v)) return true;\n  if (isRgb(v)) return true;\n  return false;\n}","import type { RGB } from \"colorizr\";\n\nexport function calculateHueDistance(a: number, b: number, limit = 1) {\n  let long = -1;\n  let short = -1;\n  if (b < a) {\n    long = (b - a);\n    short = limit - (a - b);\n  } else {\n    long = (b - a);\n    short = (long) - limit;\n  }\n  const forward = short > 0 ? short : long;\n  const backward = short > 0 ? long : short;\n  if (Math.abs(long) < Math.abs(short)) {\n    const t = short;\n    short = long;\n    long = t;\n  }\n  return { long, short, forward, backward };\n}\n\nexport const libraryRgbToHexString = (rgb: RGB): string => {\n  const componentToHex = (c: number) => {\n    const hex = Math.floor(c).toString(16);\n    return hex.length == 1 ? \"0\" + hex : hex;\n  }\n\n  let part = `#${ componentToHex(rgb.r) }${ componentToHex(rgb.g) }${ componentToHex(rgb.b) }`;\n  if (typeof rgb.alpha !== `undefined` && rgb.alpha !== 255) {\n    part += componentToHex(rgb.alpha);\n  }\n  return part;\n}\n\nexport function wrapScalarHue(value: number) {\n  value = value % 1;\n  if (value < 0) return (1 - Math.abs(value)) % 1;\n  return value;\n}\n\n// export function cssAngleFormat(value:string) {\n//   let start = value.indexOf(`)`);\n//   let end = value.lastIndexOf(')');\n//   if (start < 0) return value;\n//   if (end < start) return value;\n\n// }","import Colorizr, * as C from \"colorizr\";\nimport type { Colourish, Hsl, HslAbsolute, HslScalar, ParsingOptions, Rgb } from \"./types.js\";\nimport { numberInclusiveRangeTest, numberTest, percentTest } from \"@ixfx/guards\";\nimport { resultThrow } from \"@ixfx/guards\";\nimport { cssDefinedHexColours, resolveCss } from \"./css-colours.js\";\nimport { angleConvert, angleParse, type Angle } from \"@ixfx/geometry\";\nimport { clamp, interpolate } from \"@ixfx/numbers\";\nimport { isRgb } from \"./guards.js\";\nimport { calculateHueDistance, libraryRgbToHexString, wrapScalarHue } from \"./utility.js\";\nimport { parseCssRgbFunction, to8bit as rgbTo8bit, toLibraryHsl as rgbToLibraryHsl } from \"./srgb.js\";\n\n/**\n * Scales the opacity value of an input HSL value\n * ```js\n * withOpacity()\n * ```\n * @param value Colour\n * @param fn Function that calcules opacity based on input scalar value\n * @returns \n */\nexport const withOpacity = <T extends Hsl>(value: T, fn: (opacityScalar: number, value: T) => number): T => {\n  switch (value.unit) {\n    case `absolute`:\n      return {\n        ...value,\n        opacity: fn((value.opacity ?? 100) / 100, value) * 100\n      }\n    case `scalar`:\n      return {\n        ...value,\n        opacity: fn((value.opacity ?? 1), value)\n      }\n  }\n}\n\n/**\n * Increases or decreases lightness by this percentage, returning new colour\n * \n * Amount to change:\n * * 'fixed': a fixed amount\n * * 'delta': increase/decrease by this amount\n * * 'pdelta': proportion of current value to change by ('percentage delta')\n * \n * ```\n * const colour = { h: 0.5, s: 0.5, l: 0.5, space: `hsl`, unit: `scalar` };\n * changeLightness(colour, { pdelta: 0.1 }); // l: 0.55\n * changeLightness(colour, { delta: 0.1 });  // l: 0.6\n * changeLightness(colour, { fixed: 0.5 });  // l: 0.5\n * ```\n * \n * Keep in mind the numerical value will depend on the unit of `value`. If it's scalar,\n * lightness is 0..1 scale, otherwise 0..100 scale.\n * \n * Use negative values to decrease (does not apply to 'fixed')\n * @param value Hsl colour\n * @param amount Amount to change\n */\nexport const changeLightness = (value: Hsl, amount: Partial<{ pdelta: number, delta: number, fixed: number }>): Hsl => {\n  let newL = 0;\n  if (typeof amount.pdelta !== `undefined`) {\n    newL = value.l + (value.l * amount.pdelta);\n  } else if (typeof amount.delta !== `undefined`) {\n    newL = amount.delta + value.l;\n  } else if (typeof amount.fixed !== `undefined`) {\n    if (amount.fixed < 0) throw new TypeError(`Cannot use negative value with 'fixed'`);\n    newL = amount.fixed;\n  } else {\n    throw new TypeError(`Parameter 'amount' is missing 'delta/pdelta/fixed' properties`);\n  }\n  return {\n    ...value,\n    l: scaleProperty(value, newL, `l`)\n  }\n}\n\nconst scaleProperty = (hsl: Hsl, value: number, property: `l` | `h` | `s`) => {\n  if (hsl.unit === `scalar`) {\n    // 0..1 scale\n    if (value > 1) value = 1;\n    else if (value < 0) value = 0;\n  } else {\n    // 0..100 scale\n    if (value > 100) value = 100;\n    else if (value < 0) value = 0;\n  }\n  return value;\n}\n\nconst hslTransparent = Object.freeze({\n  h: 0, s: 0, l: 0, opacity: 0, unit: `absolute`, space: `hsl`\n});\n\nexport function fromHexString<T extends ParsingOptions<Hsl>>(hexString: string, scalar: T): T extends { scalar: true } ? HslScalar : HslAbsolute;\n\nexport function fromHexString(hexString: string, options: ParsingOptions<Hsl> = {}): Hsl {\n  return fromLibrary(C.hex2hsl(hexString), options);\n}\n\nexport function fromCss<T extends ParsingOptions<Hsl>>(value: string, options?: T): T extends { scalar: true } ? HslScalar : HslAbsolute;\nexport function fromCss(value: string, options: Partial<ParsingOptions<Hsl>> = {}): Hsl {\n  value = value.toLowerCase();\n\n  if (value.startsWith(`hsla(`)) throw new Error(`hsla() not supported`);\n  if (value.startsWith(`rgba(`)) throw new Error(`rgba() not supported`);\n\n  if (value.startsWith(`#`)) {\n    return fromHexString(value, options);\n  }\n  if (value.startsWith(`--`)) {\n    try {\n      value = resolveCss(value);\n    } catch (error) {\n      if (typeof options.fallbackString !== `undefined`) value = options.fallbackString;\n      if (typeof options.fallbackColour !== `undefined`) return options.fallbackColour;\n      throw error;\n    }\n  }\n  if (value === `transparent`) return hslTransparent;\n  if (typeof cssDefinedHexColours[ value ] !== `undefined`) {\n    return fromHexString(cssDefinedHexColours[ value ] as string, options);\n  }\n\n  if (value.startsWith(`rgb(`)) {\n    const hsl = rgbToLibraryHsl(value);\n    return fromLibrary(hsl, options);\n  }\n\n  if (!value.startsWith(`hsl(`)) {\n    try {\n      value = C.convert(value, `hsl`);\n    } catch (error) {\n      if (options.fallbackString) {\n        value = options.fallbackString;\n      } else {\n        throw error;\n      }\n    }\n  }\n\n  try {\n    // Hand-rolled hsl() parse because the package is broken\n    const hsl = parseCssHslFunction(value);\n    if (options.scalar) return toScalar(hsl);\n    return toAbsolute(hsl);\n  } catch (error) {\n    if (options.fallbackColour) return options.fallbackColour;\n    throw error;\n  }\n\n}\n\nexport const toCssString = (hsl: Hsl): string => {\n  const abs = toAbsolute(hsl);\n  let css = `hsl(${ abs.h }deg ${ abs.s }% ${ abs.l }%`;\n  if (`opacity` in abs && abs.opacity !== undefined && abs.opacity < 100) {\n    css += ` / ${ abs.opacity }%`;\n  }\n  css += ')';\n  return css;\n}\n\nexport const toHexString = (hsl: Hsl): string => {\n  const rgb = toLibraryRgb(hsl);\n  return libraryRgbToHexString(rgb);\n}\n\nconst toLibrary = (hsl: Hsl): C.HSL => {\n  const abs = toAbsolute(hsl);\n  return {\n    h: abs.h,\n    s: abs.s,\n    l: abs.l,\n    alpha: abs.opacity,\n  }\n}\nfunction fromLibrary<T extends ParsingOptions<Hsl>>(hsl: C.HSL, parsingOptions: T): T extends { scalar: true } ? HslScalar : HslAbsolute;\n\nfunction fromLibrary<T extends Hsl>(hsl: C.HSL, parsingOptions: ParsingOptions<T> = {}): T {\n  if (typeof hsl === `undefined` || hsl === null) {\n    if (parsingOptions.fallbackColour) return parsingOptions.fallbackColour;\n  }\n  const scalarOpt = parsingOptions.scalar ?? true;\n\n  // Library result is absolute\n  resultThrow(\n    numberInclusiveRangeTest(hsl.h, 0, 360, `h`),\n    numberInclusiveRangeTest(hsl.s, 0, 100, `s`),\n    numberInclusiveRangeTest(hsl.l, 0, 100, `l`),\n    percentTest((hsl.alpha ?? 1), `alpha`)\n    // () => hsl.alpha !== undefined ? numberInclusiveRangeTest(hsl.alpha, 0, 100, `alpha`) : { success: true, value: hsl },\n  );\n  if (scalarOpt) {\n    return scalar(hsl.h / 360, hsl.s / 100, hsl.l / 100, (hsl.alpha ?? 1)) as T;\n  } else {\n    return absolute(hsl.h, hsl.s, hsl.l, (hsl.alpha ?? 1) * 100) as T;\n  }\n}\n\nexport const toAbsolute = (hslOrString: Hsl | Rgb | string): HslAbsolute => {\n  // if (typeof hslOrString === `string`) {\n  //   return toAbsolute(fromLibrary(C.parseCSS(hslOrString, `hsl`), { scalar: false }));\n  // }\n  if (typeof hslOrString === `string`) {\n    return fromCss(hslOrString, { scalar: false });\n    // try {\n    //   return toScalar(fromLibrary(C.parseCSS(hslOrString, `hsl`), { scalar: true }));\n    // } catch (error) {\n    //   console.error(`Hsl.toScalar: ${ hslOrString }`);\n    //   throw error;\n    // }\n  }\n  if (isRgb(hslOrString)) {\n    return toAbsolute(fromLibrary(rgbToLibraryHsl(hslOrString), { scalar: false }));\n  }\n  const hsl = hslOrString;\n  guard(hsl);\n  if (hsl.unit === `absolute`) return hsl;\n  return {\n    h: hsl.h * 360,\n    s: hsl.s * 100,\n    l: hsl.l * 100,\n    opacity: (hsl.opacity ?? 1) * 100,\n    unit: `absolute`,\n    space: `hsl`\n  }\n}\n\n/**\n * Generates a {@link HslScalar} value.\n * \n * ```js\n * generateScaler(10); // 10deg, default to full saturation, half lightness and full opacity\n * \n * // Generate HSL value from radian angle and 50% saturation\n * generateScalar(`10rad`, 0.5); \n * \n * // Generate from numeric CSS variable\n * generateScalar(`--hue`);\n * ```\n * @param absoluteHslOrVariable Hue angle or CSS variable\n * @param saturation \n * @param lightness \n * @param opacity \n */\nexport const generateScalar = (absoluteHslOrVariable: string | number | Angle, saturation = 1, lightness = 0.5, opacity = 1): HslScalar => {\n\n  if (typeof absoluteHslOrVariable === `string`) {\n    if (absoluteHslOrVariable.startsWith(`--`)) {\n      absoluteHslOrVariable = getComputedStyle(document.body).getPropertyValue(absoluteHslOrVariable).trim()\n    }\n  }\n  const hue = angleParse(absoluteHslOrVariable);\n  if (saturation > 1) throw new TypeError(`Param 'saturation' must be between 0..1`);\n  if (lightness > 1) throw new TypeError(`Param 'lightness' must be between 0..1`);\n  if (opacity > 1) throw new TypeError(`Param 'opacity' must be between 0..1`);\n  const hueDeg = angleConvert(hue, `deg`).value / 360;\n  return {\n    h: hueDeg,\n    s: saturation,\n    l: lightness,\n    opacity: opacity,\n    unit: `scalar`,\n    space: `hsl`\n  }\n}\n\n/**\n * Converts a {@link Hsl} value to scalar units, or parses a colour string\n * and converts it.\n * \n * ```js\n * toScalar({ h: 100, s: 50, l: 100, unit: `absolute` });\n * toScalar(`red`);\n * ```\n * @param hslOrString \n * @returns \n */\nexport const toScalar = (hslOrString: Rgb | Hsl | string): HslScalar => {\n  if (typeof hslOrString === `string`) {\n    return fromCss(hslOrString, { scalar: true });\n    // try {\n    //   return toScalar(fromLibrary(C.parseCSS(hslOrString, `hsl`), { scalar: true }));\n    // } catch (error) {\n    //   console.error(`Hsl.toScalar: ${ hslOrString }`);\n    //   throw error;\n    // }\n  }\n  if (isRgb(hslOrString)) {\n    return toScalar(fromLibrary(rgbToLibraryHsl(hslOrString), { scalar: true }));\n  }\n\n  const hsl = hslOrString;\n  guard(hsl);\n  if (hsl.unit === `scalar`) return hsl;\n  return {\n    h: hsl.h / 360,\n    s: hsl.s / 100,\n    l: hsl.l / 100,\n    opacity: (hsl.opacity ?? 1) / 100,\n    unit: `scalar`,\n    space: `hsl`\n  }\n}\n\nexport const guard = (hsl: Hsl) => {\n  const { h, s, l, opacity, space, unit } = hsl;\n  if (space !== `hsl`) throw new Error(`Space is expected to be 'hsl'. Got: ${ space }`);\n  if (unit === `absolute`) {\n    resultThrow(\n      numberTest(h, `finite`, `h`),\n      numberInclusiveRangeTest(s, 0, 100, `s`),\n      numberInclusiveRangeTest(l, 0, 100, `l`),\n      () => {\n        if (typeof opacity === `number`) {\n          return numberInclusiveRangeTest(opacity, 0, 100, `opacity`);\n        }\n      });\n  } else if (unit === `scalar`) {\n    resultThrow(\n      numberTest(h, `percentage`, `h`),\n      numberTest(s, `percentage`, `s`),\n      numberTest(l, `percentage`, `l`),\n      () => {\n        if (typeof opacity === `number`) {\n          return numberTest(opacity, `percentage`, `opacity`);\n        }\n      });\n  } else {\n    throw new Error(`Unit is expected to be 'absolute' or 'scalar'. Got: ${ unit }`);\n  }\n}\n\nexport const interpolator = (a: Hsl | string, b: Hsl | string, direction: `longer` | `shorter` = `shorter`) => {\n  a = toScalar(a);\n  b = toScalar(b);\n  const aOpacity = a.opacity ?? 1;\n  const distanceCalc = calculateHueDistance(a.h, b.h, 1);\n  const hueDistance = direction === `longer` ? distanceCalc.long : distanceCalc.short;\n  const satDistance = b.s - a.s;\n  const lightDistance = b.l - a.l;\n  const opacityDistance = (b.opacity ?? 1) - aOpacity;\n\n  return (amount: number): HslScalar => {\n    amount = clamp(amount);\n    let h = interpolate(amount, 0, Math.abs(hueDistance));\n    if (hueDistance < 0) h = a.h - h;\n    else h = a.h + h;\n\n    const s = interpolate(amount, 0, satDistance);\n    const l = interpolate(amount, 0, lightDistance);\n    const o = interpolate(amount, 0, opacityDistance);\n    return scalar(wrapScalarHue(h), s + a.s, l + a.l, o + aOpacity);\n  }\n}\n\n/**\n * Creates a HslScalar value from scalar (0..1) values\n * @param hue \n * @param sat \n * @param lightness \n * @param opacity \n * @returns \n */\nexport function scalar(hue = 0.5, sat = 1, lightness = 0.5, opacity = 1): HslScalar {\n  const hsl: HslScalar = {\n    unit: `scalar`,\n    space: `hsl`,\n    h: hue,\n    s: sat,\n    l: lightness,\n    opacity: opacity\n  }\n  guard(hsl);\n  return hsl;\n}\n\nexport function absolute(hue = 200, sat = 100, lightness = 50, opacity = 100): HslAbsolute {\n  const hsl: HslAbsolute = {\n    unit: `absolute`,\n    space: `hsl`,\n    h: hue,\n    s: sat,\n    l: lightness,\n    opacity: opacity\n  }\n  guard(hsl);\n  return hsl;\n}\n\n/**\n * It seems Colorizr can't handle 'deg' units\n * @param value \n */\nexport function parseCssHslFunction(value: string): Hsl {\n  if (value.startsWith(`hsla`)) throw new Error(`hsla() is not supported`);\n  if (!value.startsWith(`hsl(`)) throw new Error(`Expected hsl(..) CSS colour`);\n\n  const start = value.indexOf('(');\n  const end = value.indexOf(')');\n  if (end < start) throw new Error(`Is hsl() not terminated? Missing ')'`);\n\n  const part = value.substring(start + 1, end);\n  let split = part.split(/[\\s,]+/);\n  if (split.length < 3) throw new Error(`Expected three tokens. Got: ${ split.length } length`);\n\n  let returnRelative = false;\n  if (split[ 0 ].endsWith(`%`)) returnRelative = true;\n  if (split[ 1 ].endsWith(`%`) && split[ 2 ].endsWith(`%`)) returnRelative = true;\n\n  const valueAsScalar = (v: string, pos: number) => {\n    if (v === `none`) return 0;\n    if (v.endsWith(`%`)) {\n      return Number.parseFloat(v.substring(0, v.length - 1)) / 100;\n    }\n    if (v.endsWith(`deg`) && pos === 0) {\n      v = v.substring(0, v.length - 3);\n    }\n\n    const vf = Number.parseFloat(v);\n    if (pos === 0) return vf / 360;\n    if (pos === 3) return vf; // opacity\n    return vf / 100;\n  }\n\n  const valueAsAbs = (v: string, pos: number) => {\n    if (v === `none`) return 0;\n    if (v.endsWith(`%`)) {\n      const vf = Number.parseFloat(v.substring(0, v.length - 1));\n      if (pos === 0) return vf * 360;\n      return vf;\n    }\n    if (v.endsWith(`deg`) && pos === 0) {\n      return Number.parseFloat(v.substring(0, v.length - 3));\n    }\n    const vf = Number.parseFloat(v);\n    return vf;\n  }\n\n  // Is there opacity?\n  if (split.length > 3) {\n    if (split[ 3 ] === '/') {\n      // Remove / part\n      split = [ split[ 0 ], split[ 1 ], split[ 2 ], split[ 4 ] ];\n    }\n  }\n  if (returnRelative) {\n    return scalar(\n      valueAsScalar(split[ 0 ], 0),\n      valueAsScalar(split[ 1 ], 1),\n      valueAsScalar(split[ 2 ], 2),\n      valueAsScalar(split[ 3 ] ?? `100%`, 3)\n    )\n  } else {\n    // Return as absolute\n    return absolute(\n      valueAsAbs(split[ 0 ], 0),\n      valueAsAbs(split[ 1 ], 1),\n      valueAsAbs(split[ 2 ], 2),\n      valueAsAbs(split[ 3 ] ?? `100%`, 3)\n    )\n  }\n}\n\n/**\n * Converts a Hsl structure (or CSS string) to Colorizr's RGB format\n * @param hsl HSL colour\n * @returns \n */\nexport function toLibraryRgb(hsl: Hsl | string): C.RGB {\n  if (typeof hsl === `string`) {\n    const parseResult = fromCss(hsl, { scalar: false });\n    //console.log(`parseResult hsl: ${ hsl } pr: `, parseResult);\n    return toLibraryRgb(parseResult);\n  }\n  hsl = toAbsolute(hsl);\n  //console.log(`toLibraryRgb hsl`, hsl);\n  const rgb = C.hsl2rgb({ h: hsl.h, s: hsl.s, l: hsl.l });\n  return { ...rgb, alpha: (hsl.opacity ?? 100) / 100 * 255 };\n}","import type { OkLch, OkLchAbsolute, OkLchScalar, ParsingOptions } from \"./types.js\";\nimport { numberInclusiveRangeTest, percentTest, resultThrow } from \"@ixfx/guards\";\nimport Colorizr, * as C from \"colorizr\";\nimport { cssDefinedHexColours } from \"./css-colours.js\";\nimport { angleConvert, angleParse, type Angle } from \"@ixfx/geometry\";\nimport { calculateHueDistance, libraryRgbToHexString, wrapScalarHue } from \"./utility.js\";\nimport { clamp, interpolate } from \"@ixfx/numbers\";\nimport { parseCssRgbFunction, to8bit as rgbTo8bit } from \"./srgb.js\";\n\nexport const OKLCH_CHROMA_MAX = 0.4;\n\nexport const guard = (lch: OkLch) => {\n  const { l, c, h, opacity, space, unit } = lch;\n  if (space !== `oklch`) throw new Error(`Space is expected to be 'oklch'. Got: ${ space }`);\n\n  if (unit === `absolute`) {\n    resultThrow(\n      percentTest(l, `l`),\n      () => {\n        if (typeof c === `number`) {\n          return numberInclusiveRangeTest(c, 0, OKLCH_CHROMA_MAX, `c`);\n        }\n      },\n      () => {\n        if (typeof h === `number`) {\n          return numberInclusiveRangeTest(c, 0, 360, `h`);\n        }\n      },\n      percentTest((opacity ?? 1), `opacity`)\n    );\n  } else if (unit === `scalar`) {\n    // Percentage values for L,C,H\n    resultThrow(\n      percentTest(l, `l`),\n      percentTest(c, `c`),\n      percentTest(h, `h`),\n      percentTest((lch.opacity ?? 1), `opacity`)\n    );\n  } else {\n    throw new Error(`Unit is expected to be 'absolute' or 'scalar'. Got: ${ unit }`);\n  }\n}\n\n\n\n/**\n * Coverts from the Colorizr library\n * Tests ranges:\n * * l: 0..1\n * * c: 0..1\n * * h: 0..360\n * * alpha: 0..1\n * \n * Default option: { scalar: true }\n * @param lch LCH value\n * @param parsingOptions Options for parsing \n * @returns \n */\nexport function fromLibrary<T extends ParsingOptions<OkLch>>(lch: C.LCH, parsingOptions: T): T extends { scalar: true } ? OkLchScalar : OkLchAbsolute;\n\nexport function fromLibrary(lch: C.LCH, parsingOptions: ParsingOptions<OkLch> = {}): OkLch {\n  if (typeof lch === `undefined` || lch === null) {\n    if (parsingOptions.fallbackColour) return parsingOptions.fallbackColour;\n  }\n\n  const scalarReturn = parsingOptions.scalar ?? true;\n\n  // Validate\n  resultThrow(\n    percentTest(lch.l, `l`),\n    percentTest(lch.c, `c`),\n    numberInclusiveRangeTest(lch.h, 0, 360, `h`),\n    percentTest((lch.alpha ?? 1), `alpha`)\n  );\n\n  if (scalarReturn) {\n    return scalar(lch.l, lch.c / OKLCH_CHROMA_MAX, lch.h / 360, (lch.alpha ?? 1));\n  } else {\n    return absolute(lch.l, lch.c, lch.h, (lch.alpha ?? 1));\n  }\n}\n\n/**\n * Parse a HEX-formatted colour into OkLch structured format\n * @param hexString \n * @param options \n * @returns \n */\nexport const fromHexString = (hexString: string, options: ParsingOptions<OkLch> = {}): OkLch => {\n  return fromLibrary(C.hex2oklch(hexString), options);\n}\n\nconst oklchTransparent: OkLchAbsolute = Object.freeze({\n  l: 0, c: 0, h: 0, opacity: 0, unit: `absolute`, space: `oklch`\n});\n\n/**\n * Converts from some CSS-representation of colour to a structured OkLch format.\n * \n * ```js\n * fromCss(`yellow`);\n * fromCss(`rgb(100,200,90)`);\n * fromCss(`#ff00ff`);\n * ```\n * \n * By default returns a {@link OkLchScalar} (relative) representation. Use the flag 'scalar:true' to get back\n * {@link OkLchAbsolute}.\n * @param value \n * @param options \n */\nexport function fromCss<T extends ParsingOptions<OkLch>>(value: string, options: T): T extends { scalar: true } ? OkLchScalar : OkLchAbsolute;\n\nexport function fromCss(value: string, options: ParsingOptions<OkLch> = {}): OkLch {\n  value = value.toLowerCase();\n  if (value.startsWith(`#`)) {\n    return fromHexString(value, options);\n  }\n  if (value === `transparent`) return oklchTransparent;\n  if (typeof cssDefinedHexColours[ value ] !== `undefined`) {\n    return fromHexString(cssDefinedHexColours[ value ] as string, options);\n  }\n\n  if (value.startsWith(`rgb(`)) {\n    const rgb = rgbTo8bit(parseCssRgbFunction(value));\n    const lch = C.rgb2oklch({ r: rgb.r, g: rgb.g, b: rgb.b });\n    return fromLibrary(lch, options);\n  }\n\n  if (!value.startsWith(`hsl(`) && !value.startsWith(`oklch(`)) {\n    try {\n      const converted = C.convert(value, `oklch`);\n      value = converted;\n    } catch (error) {\n      if (options.fallbackString) {\n        value = options.fallbackString;\n      } else {\n        throw error;\n      }\n    }\n  }\n  const cc = new Colorizr(value);\n  const lch = cc.oklch;\n  return fromLibrary(lch, options);\n}\n\n//export const fromCssScalar = (value: string, options: ParsingOptions<OkLchAbsolute> = {}): OkLchScalar => toScalar(fromCssAbsolute(value, options));\n\n/**\n * Returns a string or {@link OkLch} value to absolute form.\n * \n * This means ranges are:\n * * lightness: 0..1\n * * chroma: 0...CHROMA_MAX (0.4)\n * * hue: 0..360\n * @param lchOrString \n * @returns \n */\nexport const toAbsolute = (lchOrString: OkLch | string): OkLchAbsolute => {\n  if (typeof lchOrString === `string`) {\n    return toAbsolute(fromCss(lchOrString, { scalar: true }));\n  }\n  guard(lchOrString);\n  if (lchOrString.unit === `absolute`) return lchOrString;\n  return {\n    space: `oklch`,\n    unit: `absolute`,\n    l: lchOrString.l,\n    c: lchOrString.c * OKLCH_CHROMA_MAX,\n    h: lchOrString.h * 360,\n    opacity: lchOrString.opacity\n  }\n}\n\n\nexport const toScalar = (lchOrString: OkLch | string): OkLchScalar => {\n  if (typeof lchOrString === `string`) {\n    return toScalar(fromCss(lchOrString, { scalar: true }));\n  }\n  const lch = lchOrString;\n  guard(lch);\n\n  //console.log(`toScalar input: ${ JSON.stringify(lchOrString) } lch: `, lch);\n  // Already relative\n  if (lch.unit === `scalar`) return lch;\n\n  // Absolute values\n  return {\n    l: lch.l, // unchanged\n    c: lch.c / OKLCH_CHROMA_MAX,\n    h: lch.h / 360,\n    opacity: (lch.opacity ?? 1),\n    unit: `scalar`,\n    space: `oklch`\n  }\n}\n\nconst toLibrary = (lch: OkLch): C.LCH => {\n  const abs = toAbsolute(lch);\n  return {\n    l: abs.l,\n    c: abs.c,\n    h: abs.h,\n    alpha: abs.opacity,\n  }\n}\n// const libraryLchToScalar = (c: C.LCH): OkLchScalar => {\n//   return {\n//     l: c.h,\n//     c: c.c,\n//     h: c.h / 360,\n//     opacity: c.alpha ?? 1,\n//     unit: `scalar`,\n//     space: `oklch`\n//   }\n// }\n\n\n/**\n * Returns the colour as a CSS colour string: `oklch(l c h / opacity)`.\n *\n * @param lch Colour\n * @param precision Set precision of numbers, defaults to 3 \n * @returns CSS colour string\n */\nexport const toCssString = (lch: OkLch, precision = 3): string => {\n  guard(lch);\n  const { l, c, h, opacity } = lch;\n  let css = ``;\n  switch (lch.unit) {\n    case `absolute`:\n      css = `oklch(${ (l * 100).toFixed(precision) }% ${ c.toFixed(precision) } ${ h.toFixed(precision) }`\n      break;\n    case `scalar`:\n      css = `oklch(${ l.toFixed(precision) } ${ (c * OKLCH_CHROMA_MAX).toFixed(precision) } ${ (h * 360).toFixed(precision) }`\n      break;\n  }\n  if (typeof opacity !== `undefined` && opacity !== 1) {\n    css += ` / ${ opacity.toFixed(precision) }`;\n  }\n  css += `)`;\n  return css;\n}\n\nexport const toHexString = (lch: OkLch): string => {\n  const lch1 = toLibrary(lch);\n  const rgb = C.oklch2rgb(lch1);\n  return libraryRgbToHexString(rgb);\n}\n\n// export const oklchFromCss = (css: string): OkLchScalar => {\n//   if (css.startsWith(`#`)) {\n//     libraryLchToScalar(C.hex2oklch(css));\n//   }\n//   const p = C.extractColorParts(css);\n//   return libraryToScalar(p);\n// }\n\n// const libraryToScalar = (colour: unknown): OkLchScalar => {\n//   if (C.isLCH(colour)) {\n//     return libraryLchToScalar(colour);\n//   }\n//   if (C.isRGB(colour)) {\n//     return libraryToScalar(C.rgb2oklch(colour));\n//   }\n//   if (C.isLAB(colour)) {\n//     return libraryToScalar(C.oklab2oklch(colour));\n//   }\n//   if (C.isHSL(colour)) {\n//     return libraryToScalar(C.hsl2oklch(colour));\n//   }\n//   if (C.isHex(colour)) {\n//     return libraryLchToScalar(C.hex2oklch(colour));\n//   }\n//   throw new Error(`Unexpected colour format`);\n// }\n\n// export const oklchToColorJs = (lch: OkLch): ColorConstructor => {\n//   throwNumberTest(lch.l, `percentage`, `lch.l`);\n//   throwNumberTest(lch.c, `percentage`, `lch.c`);\n//   throwNumberTest(lch.h, `percentage`, `lch.h`);\n//   throwNumberTest(lch.opacity, `percentage`, `lch.opacity`);\n//   return {\n//     alpha: lch.opacity,\n//     coords: [ lch.l, lch.c * 0.4, lch.h * 360 ],\n//     spaceId: `oklch`\n//   }\n// }\n\n// const oklchToColorJs = (oklch: OkLch) => {\n//   throwNumberTest(oklch.l, `percentage`, `oklch.l`);\n//   throwNumberTest(oklch.c, `percentage`, `oklch.c`);\n//   throwNumberTest(oklch.h, `percentage`, `oklch.h`);\n//   throwNumberTest(oklch.opacity, `percentage`, `oklch.opacity`);\n//   const coords: [ number, number, number ] = [\n//     oklch.l,\n//     oklch.c * 0.4,\n//     oklch.h * 360\n//   ]\n//   return new ColorJs.default(`oklch`, coords, oklch.opacity);\n// }\n\n// export const isOklch = (p: Colourish | undefined | null): p is OkLch => {\n//   if (typeof p === `undefined` || p === null) return false;\n//   if (typeof p !== `object`) return false;\n\n//   // Check if Colourjs\n//   //if ((p as ColorJs.ColorObject).spaceId !== undefined) return false;\n//   //if ((p as ColorJs.ColorObject).coords !== undefined) return false;\n//   if (p.space !== `oklch`) return false;\n//   if (typeof p.l === `undefined`) return false;\n//   if (typeof p.c === `undefined`) return false;\n//   if (typeof p.h === `undefined`) return false;\n//   return true;\n// }\n\nexport const generateScalar = (absoluteHslOrVariable: string | number | Angle, chroma = 1, lightness = 0.5, opacity = 1): OkLchScalar => {\n\n  if (typeof absoluteHslOrVariable === `string`) {\n    if (absoluteHslOrVariable.startsWith(`--`)) {\n      absoluteHslOrVariable = getComputedStyle(document.body).getPropertyValue(absoluteHslOrVariable).trim()\n    }\n  }\n  if (lightness > 1) throw new TypeError(`Param 'lightness' must be between 0..1`);\n  if (chroma > 1) throw new TypeError(`Param 'chroma' must be between 0..1`);\n  const hue = angleParse(absoluteHslOrVariable);\n  const hueDeg = angleConvert(hue, `deg`).value / 360;\n  if (opacity > 1) throw new TypeError(`Param 'opacity' must be between 0..1`);\n\n  return {\n    l: lightness,\n    c: chroma,\n    h: hueDeg,\n    opacity: opacity,\n    unit: `scalar`,\n    space: `oklch`\n  }\n}\n\n/**\n * Scales the opacity value of an input Oklch value\n * ```js\n * withOpacity()\n * ```\n * @param value \n * @param fn \n * @returns \n */\nexport const withOpacity = <T extends OkLch>(value: T, fn: (opacityScalar: number, value: T) => number): T => {\n  switch (value.unit) {\n    case `absolute`:\n      return {\n        ...value,\n        opacity: fn((value.opacity ?? 100) / 100, value) * 100\n      }\n    case `scalar`:\n      return {\n        ...value,\n        opacity: fn((value.opacity ?? 1), value)\n      }\n  }\n}\n\nexport const interpolator = (a: OkLch | string, b: OkLch | string, direction: `longer` | `shorter` = `shorter`) => {\n  a = toScalar(a);\n  b = toScalar(b);\n  //console.log(`a`, a);\n  //console.log(`b`, b);\n\n  const aOpacity = a.opacity ?? 1;\n  const distanceCalc = calculateHueDistance(a.h, b.h, 1);\n  const hueDistance = direction === `longer` ? distanceCalc.long : distanceCalc.short;\n  const chromaDistance = b.c - a.c;\n  const lightDistance = b.l - a.l;\n  const opacityDistance = (b.opacity ?? 1) - aOpacity;\n  //console.log(`distanceCalc`, distanceCalc);\n  //console.log(`interpolator distances: hue: ${ hueDistance } c: ${ chromaDistance } light: ${ lightDistance } opacity: ${ opacityDistance }`);\n\n  return (amount: number): OkLchScalar => {\n    amount = clamp(amount);\n    let h = interpolate(amount, 0, Math.abs(hueDistance));\n    if (hueDistance < 0) h = a.h - h;\n    else h = a.h + h;\n\n    const c = interpolate(amount, 0, chromaDistance);\n    const l = interpolate(amount, 0, lightDistance);\n    const o = interpolate(amount, 0, opacityDistance);\n    //console.log(`amount: ${ amount } h: ${ h } s: ${ s } l: ${ l } o: ${ o }`);\n    return scalar(l + a.l, c + a.c, wrapScalarHue(h), o + aOpacity);\n  }\n}\n\nexport function scalar(lightness = 0.7, chroma = 0.1, hue = 0.5, opacity = 1): OkLchScalar {\n  const lch: OkLchScalar = {\n    unit: `scalar`,\n    space: `oklch`,\n    l: lightness,\n    c: chroma,\n    h: hue,\n    opacity: opacity\n  }\n  guard(lch);\n  return lch;\n}\n\n/**\n * Create an LCH colour using absolute hue\n * @param l Lightness 0..1\n * @param c Chroma 0..4\n * @param h Hue 0..360\n * @param opacity \n * @returns \n */\nexport const absolute = (l: number, c: number, h: number, opacity = 1): OkLchAbsolute => {\n  const lch: OkLchAbsolute = {\n    space: `oklch`,\n    unit: `absolute`,\n    opacity,\n    l, c, h\n  };\n  guard(lch);\n  return lch;\n}\n","import * as SrgbSpace from \"./srgb.js\";\nimport * as HslSpace from './hsl.js';\nimport * as OklchSpace from './oklch.js';\nimport type { Colour } from \"./types.js\";\n\n/**\n * Converts from some kind of colour that is legal in CSS\n * into a structured Colour type.\n * \n * Handles: hex format, CSS variables, colour names\n * ```js\n * fromCssColour(`#ffffff`);\n * fromCssColour(`blue`);\n * fromCssColour(`--some-variable`);\n * fromCssColour(`hsl(50, 50%, 50%)`);\n * fromCssColour(`rgb(50, 100, 100)`);\n * ```\n * @param colour \n * @returns \n */\nexport const fromCssColour = (colour: string): Colour => {\n  if (colour.startsWith(`#`)) {\n    return SrgbSpace.fromHexString(colour, true);\n  }\n\n  if (typeof cssDefinedHexColours[ colour ] !== `undefined`) {\n    return SrgbSpace.fromHexString(cssDefinedHexColours[ colour ] as string, true);\n  }\n  if (colour.startsWith(`--`)) {\n    const fromCss = getComputedStyle(document.body).getPropertyValue(colour).trim();\n    if (fromCss.length === 0 || fromCss === null) throw new Error(`Variable missing: ${ colour }`);\n    return fromCssColour(fromCss);\n  }\n  colour = colour.toLowerCase();\n  if (colour.startsWith(`hsl(`)) {\n    return HslSpace.fromCss(colour, { scalar: true });\n  }\n  if (colour.startsWith(`rgb(`)) {\n    return SrgbSpace.fromCss(colour, { scalar: true });\n  }\n  if (colour.startsWith(`oklch(`)) {\n    return OklchSpace.fromCss(colour, { scalar: true });\n  }\n\n  throw new Error(`String colour is not a hex colour, CSS variable nor well-defined colour. Input: '${ colour }'`);\n}\n\n/**\n * Resolves a named colour or CSS variable to a colour string.\n * Doesn't do conversion or parsing.\n * \n * ```js\n * resolveCss(`red`);\n * resolveCss(`my-var`);\n * ```\n * @param colour Colour\n * @param fallback Fallback if CSS variable is missing\n * @returns \n */\nexport const resolveCss = (colour: string, fallback?: string): string => {\n  if (colour.startsWith(`--`)) {\n    const fromCss = getComputedStyle(document.body).getPropertyValue(colour).trim();\n    if (fromCss.length === 0 || fromCss === null) {\n      if (typeof fallback !== `undefined`) return fallback;\n      throw new Error(`CSS variable missing: '${ colour }'`);\n    }\n    return resolveCss(fromCss); // Recurse, because value might be a named colour\n  }\n  if (typeof cssDefinedHexColours[ colour ] !== `undefined`) {\n    return cssDefinedHexColours[ colour ] as string;\n  }\n  return colour; // assume legit\n}\n\nexport const cssDefinedHexColours = {\n  \"aliceblue\": \"#f0f8ff\",\n  \"antiquewhite\": \"#faebd7\",\n  \"aqua\": \"#00ffff\",\n  \"aquamarine\": \"#7fffd4\",\n  \"azure\": \"#f0ffff\",\n  \"beige\": \"#f5f5dc\",\n  \"bisque\": \"#ffe4c4\",\n  \"black\": \"#000000\",\n  \"blanchedalmond\": \"#ffebcd\",\n  \"blue\": \"#0000ff\",\n  \"blueviolet\": \"#8a2be2\",\n  \"brown\": \"#a52a2a\",\n  \"burlywood\": \"#deb887\",\n  \"cadetblue\": \"#5f9ea0\",\n  \"chartreuse\": \"#7fff00\",\n  \"chocolate\": \"#d2691e\",\n  \"coral\": \"#ff7f50\",\n  \"cornflowerblue\": \"#6495ed\",\n  \"cornsilk\": \"#fff8dc\",\n  \"crimson\": \"#dc143c\",\n  \"cyan\": \"#00ffff\",\n  \"darkblue\": \"#00008b\",\n  \"darkcyan\": \"#008b8b\",\n  \"darkgoldenrod\": \"#b8860b\",\n  \"darkgray\": \"#a9a9a9\",\n  \"darkgreen\": \"#006400\",\n  \"darkkhaki\": \"#bdb76b\",\n  \"darkmagenta\": \"#8b008b\",\n  \"darkolivegreen\": \"#556b2f\",\n  \"darkorange\": \"#ff8c00\",\n  \"darkorchid\": \"#9932cc\",\n  \"darkred\": \"#8b0000\",\n  \"darksalmon\": \"#e9967a\",\n  \"darkseagreen\": \"#8fbc8f\",\n  \"darkslateblue\": \"#483d8b\",\n  \"darkslategray\": \"#2f4f4f\",\n  \"darkturquoise\": \"#00ced1\",\n  \"darkviolet\": \"#9400d3\",\n  \"deeppink\": \"#ff1493\",\n  \"deepskyblue\": \"#00bfff\",\n  \"dimgray\": \"#696969\",\n  \"dodgerblue\": \"#1e90ff\",\n  \"firebrick\": \"#b22222\",\n  \"floralwhite\": \"#fffaf0\",\n  \"forestgreen\": \"#228b22\",\n  \"fuchsia\": \"#ff00ff\",\n  \"gainsboro\": \"#dcdcdc\",\n  \"ghostwhite\": \"#f8f8ff\",\n  \"gold\": \"#ffd700\",\n  \"goldenrod\": \"#daa520\",\n  \"gray\": \"#808080\",\n  \"green\": \"#008000\",\n  \"greenyellow\": \"#adff2f\",\n  \"honeydew\": \"#f0fff0\",\n  \"hotpink\": \"#ff69b4\",\n  \"indianred\": \"#cd5c5c\",\n  \"indigo\": \"#4b0082\",\n  \"ivory\": \"#fffff0\",\n  \"khaki\": \"#f0e68c\",\n  \"lavender\": \"#e6e6fa\",\n  \"lavenderblush\": \"#fff0f5\",\n  \"lawngreen\": \"#7cfc00\",\n  \"lemonchiffon\": \"#fffacd\",\n  \"lightblue\": \"#add8e6\",\n  \"lightcoral\": \"#f08080\",\n  \"lightcyan\": \"#e0ffff\",\n  \"lightgoldenrodyellow\": \"#fafad2\",\n  \"lightgray\": \"#d3d3d3\",\n  \"lightgreen\": \"#90ee90\",\n  \"lightpink\": \"#ffb6c1\",\n  \"lightsalmon\": \"#ffa07a\",\n  \"lightseagreen\": \"#20b2aa\",\n  \"lightskyblue\": \"#87cefa\",\n  \"lightslategray\": \"#778899\",\n  \"lightsteelblue\": \"#b0c4de\",\n  \"lightyellow\": \"#ffffe0\",\n  \"lime\": \"#00ff00\",\n  \"limegreen\": \"#32cd32\",\n  \"linen\": \"#faf0e6\",\n  \"magenta\": \"#ff00ff\",\n  \"maroon\": \"#800000\",\n  \"mediumaquamarine\": \"#66cdaa\",\n  \"mediumblue\": \"#0000cd\",\n  \"mediumorchid\": \"#ba55d3\",\n  \"mediumpurple\": \"#9370db\",\n  \"mediumseagreen\": \"#3cb371\",\n  \"mediumslateblue\": \"#7b68ee\",\n  \"mediumspringgreen\": \"#00fa9a\",\n  \"mediumturquoise\": \"#48d1cc\",\n  \"mediumvioletred\": \"#c71585\",\n  \"midnightblue\": \"#191970\",\n  \"mintcream\": \"#f5fffa\",\n  \"mistyrose\": \"#ffe4e1\",\n  \"moccasin\": \"#ffe4b5\",\n  \"navajowhite\": \"#ffdead\",\n  \"navy\": \"#000080\",\n  \"oldlace\": \"#fdf5e6\",\n  \"olive\": \"#808000\",\n  \"olivedrab\": \"#6b8e23\",\n  \"orange\": \"#ffa500\",\n  \"orangered\": \"#ff4500\",\n  \"orchid\": \"#da70d6\",\n  \"palegoldenrod\": \"#eee8aa\",\n  \"palegreen\": \"#98fb98\",\n  \"paleturquoise\": \"#afeeee\",\n  \"palevioletred\": \"#db7093\",\n  \"papayawhip\": \"#ffefd5\",\n  \"peachpuff\": \"#ffdab9\",\n  \"peru\": \"#cd853f\",\n  \"pink\": \"#ffc0cb\",\n  \"plum\": \"#dda0dd\",\n  \"powderblue\": \"#b0e0e6\",\n  \"purple\": \"#800080\",\n  \"rebeccapurple\": \"#663399\",\n  \"red\": \"#ff0000\",\n  \"rosybrown\": \"#bc8f8f\",\n  \"royalblue\": \"#4169e1\",\n  \"saddlebrown\": \"#8b4513\",\n  \"salmon\": \"#fa8072\",\n  \"sandybrown\": \"#f4a460\",\n  \"seagreen\": \"#2e8b57\",\n  \"seashell\": \"#fff5ee\",\n  \"sienna\": \"#a0522d\",\n  \"silver\": \"#c0c0c0\",\n  \"skyblue\": \"#87ceeb\",\n  \"slateblue\": \"#6a5acd\",\n  \"slategray\": \"#708090\",\n  \"snow\": \"#fffafa\",\n  \"springgreen\": \"#00ff7f\",\n  \"steelblue\": \"#4682b4\",\n  \"tan\": \"#d2b48c\",\n  \"teal\": \"#008080\",\n  \"thistle\": \"#d8bfd8\",\n  \"tomato\": \"#ff6347\",\n  \"turquoise\": \"#40e0d0\",\n  \"violet\": \"#ee82ee\",\n  \"wheat\": \"#f5deb3\",\n  \"white\": \"#ffffff\",\n  \"whitesmoke\": \"#f5f5f5\",\n  \"yellow\": \"#ffff00\",\n  \"yellowgreen\": \"#9acd32\",\n  \"transparent\": \"#00000000\"\n}\n","import Colorizr, * as C from \"colorizr\";\n\nimport type { Hsl, ParsingOptions, Rgb, Rgb8Bit, RgbScalar } from \"./types.js\";\nimport { numberInclusiveRangeTest, numberTest } from \"@ixfx/guards\";\nimport { resultThrow } from \"@ixfx/guards\";\nimport { cssDefinedHexColours } from \"./css-colours.js\";\nimport { clamp, interpolate } from \"@ixfx/numbers\";\nimport { toLibraryRgb as hslToLibraryRgb } from \"./hsl.js\";\nimport { isHsl } from \"./guards.js\";\nimport { libraryRgbToHexString } from \"./utility.js\";\n\nexport const withOpacity = <T extends Rgb>(value: T, fn: (opacityScalar: number, value: T) => number): T => {\n  switch (value.unit) {\n    case `8bit`:\n      return {\n        ...value,\n        opacity: fn((value.opacity ?? 255) / 255, value) * 255\n      }\n    case `scalar`:\n      return {\n        ...value,\n        opacity: fn((value.opacity ?? 1), value)\n      }\n  }\n}\n\nexport function fromHexString<T extends boolean>(hexString: string, scalar: T): T extends true ? RgbScalar : Rgb8Bit;\nexport function fromHexString(hexString: string, scalar = true): RgbScalar | Rgb8Bit {\n  return fromLibrary(C.hex2rgb(hexString), { scalar });\n};\n\nconst srgbTansparent: Rgb8Bit = Object.freeze({\n  r: 0, g: 0, b: 0, opacity: 0, unit: `8bit`, space: `srgb`\n})\n\nexport function fromCss<T extends ParsingOptions<Rgb>>(value: string, options: T): T extends { scalar: true } ? RgbScalar : Rgb8Bit;\n\n/**\n * Converts a colour in a legal CSS form into Rgb value, by default RgbScalar (0..1) scale.\n * ```js\n * fromCss(`rebeccapurple`);\n * fromCss(`rgb(40% 20% 60%)`);\n * \n * // Get 8bit version on 0..255 scale\n * fromCss(`blue`, { scalar: false });\n * ```\n * \n * @param value \n * @param options \n * @returns \n */\nexport function fromCss(value: string, options: ParsingOptions<Rgb> = {}): Rgb {\n  value = value.toLowerCase();\n  if (value.startsWith(`hsla(`)) throw new Error(`hsla() not supported`);\n  if (value.startsWith(`rgba(`)) throw new Error(`rgba() not supported`);\n\n\n  const scalar = options.scalar ?? true;\n\n  // Convert from hex\n  if (value.startsWith(`#`)) return fromHexString(value, scalar);\n  // Special-case transparent\n  if (value === `transparent`) return srgbTansparent;\n  // Convert from named colour\n  if (typeof cssDefinedHexColours[ value ] !== `undefined`) fromHexString(cssDefinedHexColours[ value ] as string, scalar);\n\n  if (value.startsWith(`hsl(`)) {\n    const rgb = hslToLibraryRgb(value);\n    return fromLibrary(rgb, options);\n  }\n\n  // if (value.startsWith(`hsl(`)) {\n\n  //   const hslRel = hslToScalar(parseCssHslFunction(value));\n  //   const rgb = C.hsl2rgb({ h: hslRel.h, s: hslRel.s, l: hslRel.l, alpha: hslRel.opacity ?? 1 });\n  //   return fromLibrary(rgb, options);\n\n  // }\n\n  // Convert to rgb() colour function\n  if (!value.startsWith(`rgb(`)) {\n    try {\n      value = C.convert(value, `rgb`);\n    } catch (error) {\n      if (options.fallbackString) {\n        value = options.fallbackString;\n      } else {\n        throw error;\n      }\n    }\n  }\n\n  try {\n    // Hand-rolled rgb() parse because the package is broken\n    const rgb = parseCssRgbFunction(value);\n    if (scalar) return toScalar(rgb);\n    return to8bit(rgb);\n  } catch (error) {\n    if (options.fallbackColour) return options.fallbackColour;\n    throw error;\n  }\n}\n\nexport const toHexString = (rgb: Rgb): string => {\n  const rgb1 = toLibrary(rgb);\n  return libraryRgbToHexString(rgb1);\n}\n\nexport const toCssString = (rgb: Rgb): string => {\n  guard(rgb);\n  switch (rgb.unit) {\n    case `8bit`:\n      if (rgb.opacity === undefined || rgb.opacity === 255) {\n        return `rgb(${ rgb.r } ${ rgb.g } ${ rgb.b })`;\n      }\n      return `rgb(${ rgb.r } ${ rgb.g } ${ rgb.b } / ${ (rgb.opacity ?? 255) / 255 })`;\n    case `scalar`:\n      if (rgb.opacity === undefined || rgb.opacity === 1) {\n        return `rgb(${ rgb.r * 100 }% ${ rgb.g * 100 }% ${ rgb.b * 100 }%)`;\n      }\n      return `rgb(${ rgb.r * 100 }% ${ rgb.g * 100 }% ${ rgb.b * 100 }% / ${ (rgb.opacity ?? 1) * 100 }%)`;\n    default:\n\n      throw new Error(`Unknown unit: ${ (rgb as any).unit }`);\n  }\n}\n\nconst toLibrary = (rgb: Rgb): C.RGB => {\n  const abs = to8bit(rgb);\n  return {\n    r: abs.r,\n    g: abs.g,\n    b: abs.b,\n    alpha: abs.opacity,\n  }\n}\n\nfunction fromLibrary<T extends ParsingOptions<Rgb>>(rgb: C.RGB, parsingOptions: T):\n  T extends { scalar: true } ? RgbScalar : Rgb8Bit\n\nfunction fromLibrary(rgb: C.RGB, parsingOptions: ParsingOptions<Rgb> = {}): Rgb8Bit | RgbScalar {\n  if (parsingOptions.scalar) {\n    return {\n      r: rgb.r / 255,\n      g: rgb.g / 255,\n      b: rgb.b / 255,\n      opacity: rgb.alpha ?? 1,\n      unit: `scalar`,\n      space: `srgb`\n    }\n  } else {\n    return {\n      r: rgb.r,\n      g: rgb.g,\n      b: rgb.b,\n      opacity: rgb.alpha ?? 255,\n      unit: `8bit`,\n      space: `srgb`\n    }\n  }\n}\n\n\nexport const to8bit = (rgbOrString: Rgb | string): Rgb8Bit => {\n  if (typeof rgbOrString === `string`) {\n    return fromCss(rgbOrString, { scalar: false });\n  }\n  if (isHsl(rgbOrString)) {\n    return to8bit(fromLibrary(hslToLibraryRgb(rgbOrString), { scalar: false }));\n  }\n  guard(rgbOrString);\n  if (rgbOrString.unit === `8bit`) return rgbOrString;\n  return {\n    r: rgbOrString.r * 255,\n    g: rgbOrString.g * 255,\n    b: rgbOrString.b * 255,\n    opacity: (rgbOrString.opacity ?? 1) * 255,\n    unit: `8bit`,\n    space: `srgb`\n  }\n}\n\nexport const toScalar = (rgbOrString: Rgb | Hsl | string): RgbScalar => {\n  if (typeof rgbOrString === `string`) {\n    return fromCss(rgbOrString, { scalar: true });\n  }\n  if (isHsl(rgbOrString)) {\n    return toScalar(fromLibrary(hslToLibraryRgb(rgbOrString), { scalar: true }));\n  }\n  guard(rgbOrString);\n  if (rgbOrString.unit === `scalar`) return rgbOrString;\n  return {\n    r: rgbOrString.r / 255,\n    g: rgbOrString.g / 255,\n    b: rgbOrString.b / 255,\n    opacity: (rgbOrString.opacity ?? 1) / 255,\n    unit: `scalar`,\n    space: `srgb`\n  }\n}\n\nexport const guard = (rgb: Rgb) => {\n  const { r, g, b, opacity, space, unit } = rgb;\n  if (space !== `srgb`) throw new Error(`Space is expected to be 'srgb'. Got: ${ space }`);\n  if (unit === `8bit`) {\n    resultThrow(\n      numberInclusiveRangeTest(r, 0, 255, `r`),\n      numberInclusiveRangeTest(g, 0, 255, `g`),\n      numberInclusiveRangeTest(b, 0, 255, `b`),\n      () => {\n        if (typeof opacity === `number`) {\n          return numberInclusiveRangeTest(opacity, 0, 255, `opacity`);\n        }\n      }\n    );\n  } else if (unit === `scalar`) {\n    resultThrow(\n      numberTest(r, `percentage`, `r`),\n      numberTest(g, `percentage`, `g`),\n      numberTest(b, `percentage`, `b`),\n      () => {\n        if (typeof opacity === `number`) {\n          return numberTest(opacity, `percentage`, `opacity`);\n        }\n      });\n  } else {\n    throw new Error(`Unit is expected to be '8bit' or 'scalar'. Got: ${ unit }`);\n  }\n}\n\n/**\n * Sets the lightness value.\n * \n * Amount to change:\n * * 'fixed': a fixed amount\n * * 'delta': increase/decrease by this amount\n * * 'pdelta': proportion of current value to change by ('percentage delta')\n * \n * Use negative values to decrease\n * @param rgb Colour\n * @param amount Amount to change\n */\nexport const changeLightness = (rgb: Rgb, amount: Partial<{ pdelta: number, delta: number, fixed: number }>): Rgb => {\n  let newL = 0;\n  const co = new Colorizr(toCssString(rgb));\n  const scalarUnit = rgb.unit === `scalar`;\n  if (typeof amount.pdelta !== `undefined`) {\n    newL = co.oklab.l + (co.oklab.l * amount.pdelta);\n  } else if (typeof amount.delta !== `undefined`) {\n    newL = co.oklab.l + amount.delta;\n  } else if (typeof amount.fixed !== `undefined`) {\n    if (amount.fixed < 0) throw new TypeError(`Amount cannot be negative when using 'fixed'`);\n    newL = amount.fixed;\n  } else {\n    throw new TypeError(`Parameter 'amount' is missing 'pdelta/delta/fixed' properties`);\n  }\n  if (newL < 0) newL = 0;\n  else if (newL > 1) newL = 1;\n\n  const rgbResult = C.oklab2rgb({ a: co.oklab.a, b: co.oklab.b, l: newL, alpha: co.oklab.alpha });\n  return fromLibrary(rgbResult, { scalar: scalarUnit });\n  //return eightBit ? fromLibrary8bit(rgbResult) : fromLibraryScalar(rgbResult);\n}\n\n/**\n * Returns a lightness value (0..1) for an RGB input\n * \n * Calculates lightness by converting to Oklab and using the 'L' value\n * @param rgb \n * @returns \n */\nexport function lightness(rgb: Rgb) {\n  const co = new Colorizr(toCssString(rgb));\n  return co.oklab.l;\n}\n\nconst scaleProperty = (rgb: Rgb, value: number, property: `r` | `g` | `b` | `opacity`) => {\n  if (rgb.unit === `scalar`) {\n    // 0..1 scale\n    if (value > 1) value = 1;\n    else if (value < 0) value = 0;\n  } else {\n    // 0..255 scale\n    if (value > 255) value = 255;\n    else if (value < 0) value = 0;\n  }\n  return value;\n}\n\n/**\n * Creates a Rgb8Bit value from 8bit (0..255) values\n * @param red \n * @param green \n * @param blue \n * @param opacity \n * @returns \n */\nexport function eightBit(red = 100, green = 100, blue = 100, opacity = 255): Rgb8Bit {\n  const rgb: Rgb8Bit = {\n    unit: `8bit`,\n    space: `srgb`,\n    r: red,\n    g: green,\n    b: blue,\n    opacity: opacity\n  }\n  guard(rgb);\n  return rgb;\n}\n\n/**\n * Creates a RgbScalar value from scalar (0..1) values\n * @param red \n * @param green \n * @param blue \n * @param opacity \n * @returns \n */\nexport function scalar(red = 0.5, green = 0.5, blue = 0.5, opacity = 1): RgbScalar {\n  const rgb: RgbScalar = {\n    unit: `scalar`,\n    space: `srgb`,\n    r: red,\n    g: green,\n    b: blue,\n    opacity: opacity\n  }\n  guard(rgb);\n  return rgb;\n}\n\n\n/**\n * It seems Colorizr can't handle % values properly :'(\n * @param value \n */\nexport function parseCssRgbFunction(value: string): Rgb {\n  if (value.startsWith(`rgba`)) throw new Error(`RGBA is not supported`);\n  if (!value.startsWith(`rgb(`)) throw new Error(`Expected rgb(..) CSS colour`);\n\n  const start = value.indexOf('(');\n  const end = value.indexOf(')');\n  if (end < start) throw new Error(`Is rgb() not terminated? Missing ')'`);\n\n  const part = value.substring(start + 1, end);\n  let split = part.split(/[\\s,]+/);\n  if (split.length < 3) throw new Error(`Expected three tokens. Got: ${ split.length } length`);\n\n  let relativeCount = 0;\n  for (const s of split) {\n    if (s.endsWith('%')) relativeCount++;\n  }\n\n  const valueAsScalar = (v: string, pos: number) => {\n    if (v.endsWith(`%`)) {\n      return Number.parseFloat(v.substring(0, v.length - 1)) / 100;\n    }\n    if (pos < 3) {\n      // r, g or b\n      return Number.parseFloat(v) / 255;\n    } else {\n      // opacity should already be in scalar value\n      return Number.parseFloat(v);\n    }\n  }\n\n  const valueAs8bit = (v: string, pos: number) => {\n    if (v.endsWith(`%`)) {\n      return Number.parseFloat(v.substring(0, v.length - 1)) / 100 * 255;\n    }\n    if (pos < 3) {\n      // r, g or b\n      return Number.parseFloat(v);\n    } else {\n      // opacity should already be in scalar value\n      return Number.parseFloat(v) * 255;\n    }\n  }\n\n  // Is there opacity?\n  if (split.length > 3) {\n    if (split[ 3 ] === '/') {\n      // Remove / part\n      split = [ split[ 0 ], split[ 1 ], split[ 2 ], split[ 4 ] ];\n    }\n  }\n  if (relativeCount > 1) {\n    // Return as scalar\n    return scalar(\n      valueAsScalar(split[ 0 ], 0),\n      valueAsScalar(split[ 1 ], 1),\n      valueAsScalar(split[ 2 ], 2),\n      valueAsScalar(split[ 3 ] ?? `1`, 3)\n    )\n  } else {\n    // Return as 8bit\n    return eightBit(\n      valueAs8bit(split[ 0 ], 0),\n      valueAs8bit(split[ 1 ], 1),\n      valueAs8bit(split[ 2 ], 2),\n      valueAs8bit(split[ 3 ] ?? `1`, 3)\n    )\n  }\n}\n\n/**\n * Interpolates colours in Srgb space. Probably\n * really ugly, use OkLch space isntead.\n * \n * ```js\n * const i = interpolator(`red`, `blue`);\n * i(0.5); // Get 50% between these colours\n * ```\n * @param colourA \n * @param colourB \n * @returns \n */\nexport const interpolator = (colourA: Rgb | string, colourB: Rgb | string) => {\n  const aa = toScalar(colourA);\n  const bb = toScalar(colourB);\n\n  const aOpacity = aa.opacity ?? 1;\n  const opacityDistance = (bb.opacity ?? 1) - aOpacity;\n\n  const r = bb.r - aa.r;\n  const g = bb.g - aa.g;\n  const b = bb.b - aa.b;\n\n  return (amount: number): RgbScalar => {\n    amount = clamp(amount);\n    return scalar(\n      aa.r + interpolate(amount, 0, r),\n      aa.g + interpolate(amount, 0, g),\n      aa.b + interpolate(amount, 0, b),\n      aOpacity + interpolate(amount, 0, opacityDistance));\n  }\n}\n\n/**\n * Converts a Rgb structure (or CSS string) to Colorizr's HSL format\n * @param rgb \n * @returns \n */\nexport function toLibraryHsl(rgb: Rgb | string): C.HSL {\n  if (typeof rgb === `string`) {\n    const parseResult = fromCss(rgb, { scalar: false });\n    return toLibraryHsl(parseResult);\n  }\n  rgb = to8bit(rgb);\n  const hsl = C.rgb2hsl({ r: rgb.r, g: rgb.g, b: rgb.b });\n  return { ...hsl, alpha: (rgb.opacity ?? 255) / 255 };\n}","import { Grids } from '@ixfx/geometry';\nimport * as SrgbSpace from './colour/srgb.js';\nimport type { Rgb, Rgb8Bit } from './colour/types.js';\n\n/**\n * Returns a {@link https://api.ixfx.fun/_ixfx/geometry/Grids/Grid/} based on the provided `image`\n * @param image ImageData\n * @returns Grid\n */\nexport const grid = (image: ImageData): Grids.Grid => {\n  const g = { rows: image.width, cols: image.height };\n  return g;\n}\n\n/**\n * Returns an object that allows get/set grid semantics on the underlying `image` data.\n * Uses 8-bit sRGB values, meaning 0..255 range for red, green, blue & opacity.\n * \n * ```js\n * // Get CANVAS element, drawing context and then image data\n * const canvasEl = document.querySelector(`#my-canvas`);\n * const ctx = canvasEl.getContext(`2d`);\n * const imageData = ctx.getImageData();\n * \n * // Now that we have image data, we can wrap it:\n * const asGrid = ImageDataGrid.wrap(imageData);\n * asGrid.get({ x:10, y: 20 }); // Get pixel at 10,20\n * asGrid.set(colour, { x:10, y: 20 }); // Set pixel value\n * \n * // Display changes back on the canvas\n * ctx.putImageData(imageData, 0, 0)\n * ```\n * @param image \n * @returns \n */\nexport const wrap = (image: ImageData): Grids.GridWritable<Rgb8Bit> & Grids.GridReadable<Rgb8Bit> => {\n  return {\n    ...grid(image),\n    get: accessor(image),\n    set: setter(image)\n  }\n}\n\n/**\n * Returns a function to access pixel values by x,y\n * @param image \n * @returns \n */\nexport const accessor = (image: ImageData): Grids.GridCellAccessor<Rgb8Bit> => {\n  const g = grid(image);\n  const data = image.data;\n\n  const fn: Grids.GridCellAccessor<Rgb8Bit> = (cell: Grids.GridCell, bounds = `undefined`) => {\n    const index = Grids.indexFromCell(g, cell, bounds);\n    if (index === undefined) return;\n    const pxIndex = index * 4;\n    return {\n      r: data[ pxIndex ],\n      g: data[ pxIndex + 1 ],\n      b: data[ pxIndex + 2 ],\n      opacity: data[ pxIndex + 3 ],\n      unit: `8bit`,\n      space: `srgb`\n    };\n  };\n  return fn;\n};\n\n/**\n * Returns a function that sets pixel values\n * @param image \n * @returns \n */\nexport const setter = (image: ImageData): Grids.GridCellSetter<Rgb> => {\n  const g = grid(image);\n  const data = image.data;\n\n  const fn: Grids.GridCellSetter<Rgb> = (value: Rgb, cell: Grids.GridCell, bounds = `undefined`) => {\n    const index = Grids.indexFromCell(g, cell, bounds);\n    if (index === undefined) throw new Error(`Cell out of range. ${ cell.x },${ cell.y }`);\n    const pixel = SrgbSpace.to8bit(value);\n    const pxIndex = index * 4;\n    data[ pxIndex ] = pixel.r;\n    data[ pxIndex + 1 ] = pixel.g;\n    data[ pxIndex + 2 ] = pixel.b;\n    data[ pxIndex + 3 ] = pixel.opacity ?? 255;\n  };\n  return fn;\n}\n\n// export function* visit(image: ImageData, visitor: Grids.VisitGenerator) {\n//   const a = accessor(image);\n\n//   for (const cell of visitor) {\n//     yield a(cell, `undefined`);\n//   }\n// }\n\n/**\n * Yields pixels of an image row by row\n * @param image \n */\nexport function* byRow(image: ImageData) {\n  const a = accessor(image);\n  const g = grid(image);\n\n  const v = Grids.As.rows(g, { x: 0, y: 0 });\n  for (const row of v) {\n    const pixels = row.map(p => a(p, `undefined`));\n    yield pixels\n  }\n}\n\n/**\n * Yields pixels of an image column by column\n * @param image \n */\nexport function* byColumn(image: ImageData) {\n  const a = accessor(image);\n  const g = grid(image);\n\n  for (let x = 0; x < g.cols; x++) {\n    const col: Rgb8Bit[] = [];\n    for (let y = 0; y < g.rows; y++) {\n      const p = a({ x, y }, `undefined`);\n      if (p) col.push(p);\n    }\n    yield col;\n  }\n}","import { ElementSizer, resolveEl, type ElementResizeLogic, type ElementSizerOptions } from '@ixfx/dom';\nimport { SimpleEventEmitter } from '@ixfx/events';\nimport type { ScaleBy, ScalerCombined } from '@ixfx/geometry';\nimport type { Rect, RectPositioned } from '@ixfx/geometry/rect';\nimport { Rects, scaler } from '@ixfx/geometry';\nimport * as Drawing from './drawing.js';\nimport * as ImageDataGrid from './image-data-grid.js';\nimport { cloneFromFields } from '@ixfx/core/records';\nimport type { Grid } from '@ixfx/geometry/grid';\nimport type { DrawingHelper } from './types.js';\n\nexport type CanvasEvents = {\n  /**\n   * Fired when canvas is resized\n   */\n  resize: { size: Rect, helper: CanvasHelper, ctx: CanvasRenderingContext2D }\n\n  resized: { size: Rect, helper: CanvasHelper, ctx: CanvasRenderingContext2D }\n  /**\n   * Pointerdown. \n   * \n   * Adds logicalX/Y to get logical pixel coordinate\n   */\n  pointerdown: PointerEvent & { physicalX: number, physicalY: number },\n  /**\n * Pointerup. \n * \n * Adds logicalX/Y to get logical pixel coordinate\n */\n  pointerup: PointerEvent & { physicalX: number, physicalY: number },\n  /**\n * Pointermove \n * \n * Adds logicalX/Y to get logical pixel coordinate\n */\n  pointermove: PointerEvent & { physicalX: number, physicalY: number },\n}\n\n\n/**\n * CanvasHelper options\n */\nexport type CanvasHelperOptions = Readonly<{\n  containerEl?: HTMLElement\n  /**\n   * Automatic canvas resizing logic.\n   */\n  resizeLogic?: ElementResizeLogic\n  /**\n   * By default, the helper emits pointer events from the canvas.\n   * Set this to _true_ to disable.\n   */\n  disablePointerEvents: boolean\n  /**\n   * By default the display DPI is used for scaling.\n   * If this is set, this will override.\n   */\n  pixelZoom: number\n  /**\n   * If _true_ (default) canvas is cleared when a resize happens\n   */\n  clearOnResize: boolean\n  /**\n   * If true, it won't add any position CSS\n   */\n  skipCss: boolean;\n  coordinateScale: ScaleBy;\n  /**\n   * Callback when canvas is resized\n   * @param size \n   * @returns \n   */\n  onResizing?: (ctx: CanvasRenderingContext2D, size: Rect, helper: CanvasHelper) => void\n  onResized?: (ctx: CanvasRenderingContext2D, size: Rect, helper: CanvasHelper) => void\n  /**\n   * Logical width of canvas.\n   * This is used for establishing the desired aspect ratio.\n   */\n  width: number\n  /**\n   * Logical height of canvas.\n   * This is used for establishing the desired aspect ratio.\n   */\n  height: number\n  /**\n   * If set, the z-index for this canvas.\n   * By default, fullscreen canvas will be given -1\n   */\n  zIndex: number\n  /**\n   * Colour space to use. Defaults to sRGB.\n   */\n  colourSpace: PredefinedColorSpace;\n\n  /**\n   * If specified, this function be called in an animation loop.\n   * @param ctx Drawing context\n   * @param size Viewport size\n   * @param helper CanvasHelper instance\n   * @returns \n   */\n  draw?: (ctx: CanvasRenderingContext2D, size: Rect, helper: CanvasHelper) => void\n}>;\n\n\n/**\n * A wrapper for the CANVAS element that scales the canvas for high-DPI displays\n * and helps with resizing.\n * \n * ```js\n * const canvas = new CanvasHelper(`#my-canvas`, { resizeLogic: `both` });\n * const { ctx, width, height } = canvas.ctx; // Get drawing context, width & height\n * ```\n * \n * Draw whenever it is resized using the 'resize' event\n * ```js\n * canvas.addEventListener(`resize`, ({ctx, size}) => {\n *  // Use ctx...  \n * });\n * ```\n * \n * Or provide a function when initialising:\n * ```js\n * const onResize = (ctx, size) => {\n *  // Do drawing\n * }\n * const canvas = new CanvasHelper(`#my-canvas`, { resizeLogic: `both`, onResize });\n * ```\n * \n * Automatically draw at animation speeds:\n * ```js\n * const draw = () => {\n * }\n * const canvas = new CanvasHelper(`#my-canvas`, { resizeLogic: `both`, draw });\n * ```\n */\nexport class CanvasHelper extends SimpleEventEmitter<CanvasEvents> {\n  readonly el: HTMLCanvasElement;\n  readonly opts: CanvasHelperOptions\n\n  #scaler: ScalerCombined;\n  #scalerSize: ScalerCombined;\n  #viewport: RectPositioned = Rects.EmptyPositioned;\n  #logicalSize: Rect = Rects.Empty;\n  #ctx: CanvasRenderingContext2D | undefined;\n  #drawHelper: DrawingHelper | undefined;\n  #resizer: ElementSizer<HTMLCanvasElement> | undefined;\n  #disposed = false;\n\n  constructor(domQueryOrEl: Readonly<string | HTMLCanvasElement | undefined | null>, opts: Partial<CanvasHelperOptions> = {}) {\n    super();\n    if (!domQueryOrEl) throw new Error(`Param 'domQueryOrEl' is null or undefined. Expected canvas element.`);\n    this.el = resolveEl<HTMLCanvasElement>(domQueryOrEl);\n    if (this.el.nodeName !== `CANVAS`) {\n      throw new Error(`Expected CANVAS HTML element. Got: ${ this.el.nodeName }`);\n    }\n\n    const size = this.el.getBoundingClientRect();\n    this.opts = {\n      resizeLogic: opts.resizeLogic ?? `none`,\n      disablePointerEvents: opts.disablePointerEvents ?? false,\n      pixelZoom: opts.pixelZoom ?? (window.devicePixelRatio || 1),\n      height: opts.height ?? size.height,\n      width: opts.width ?? size.width,\n      zIndex: opts.zIndex ?? -1,\n      coordinateScale: opts.coordinateScale ?? `both`,\n      onResizing: opts.onResizing,\n      onResized: opts.onResized,\n      clearOnResize: opts.clearOnResize ?? true,\n      draw: opts.draw,\n      skipCss: opts.skipCss ?? false,\n      colourSpace: `srgb`\n    }\n\n    this.#scaler = scaler(`both`);\n    this.#scalerSize = scaler(`both`, size);\n    this.#init();\n  }\n\n  getRectangle(): RectPositioned {\n    return {\n      x: 0, y: 0,\n      ...this.#logicalSize\n    }\n  }\n  dispose(reason?: string) {\n    if (this.#disposed) return;\n    this.#disposed = true;\n    if (this.#resizer) {\n      this.#resizer.dispose(`CanvasHelper disposing ${ reason }`.trim());\n      this.#resizer = undefined;\n    }\n  }\n\n  #getContext(reset = false) {\n    if (this.#ctx === undefined || reset) {\n      const ratio = this.ratio;\n      const c = this.el.getContext(`2d`);\n      if (c === null) throw new Error(`Could not create drawing context`);\n      this.#ctx = c;\n      // Reset scale\n      c.setTransform(1, 0, 0, 1, 0, 0);\n      c.scale(ratio, ratio);\n    }\n    return this.#ctx;\n  };\n\n  /**\n   * Gets the drawable area of the canvas.\n   * This accounts for scaling due to high-DPI displays etc.\n   * @returns \n   */\n  getPhysicalSize() {\n    return {\n      width: this.width * this.ratio,\n      height: this.height * this.ratio\n    }\n  }\n\n  /**\n   * Creates a drawing helper for the canvas.\n   * If one is already created it is reused.\n   */\n  getDrawHelper() {\n    if (!this.#drawHelper) {\n      this.#drawHelper = Drawing.makeHelper(this.#getContext(), {\n        width: this.width, height: this.height\n      });\n    }\n  }\n\n  setLogicalSize(logicalSize: Rect) {\n    Rects.guard(logicalSize, `logicalSize`);\n    const logicalSizeInteger = Rects.applyFields(v => Math.floor(v), logicalSize);\n    const ratio = this.opts.pixelZoom;\n\n    // Scaler for going between relative and logical units\n    this.#scaler = scaler(this.opts.coordinateScale, logicalSize);\n    this.#scalerSize = scaler(`both`, logicalSize);\n\n    // Scaled logical size for DPI\n    const pixelScaled = Rects.multiplyScalar(logicalSize, ratio);\n\n    // Canvas will actually be much larger, based on DPI\n    this.el.width = pixelScaled.width;\n    this.el.height = pixelScaled.height;\n\n    // But scaled down on screen\n    this.el.style.width = logicalSizeInteger.width.toString() + `px`;\n    this.el.style.height = logicalSizeInteger.height.toString() + `px`;\n\n    // Since dimensions have change, reset context\n    this.#getContext(true);\n\n    if (this.opts.clearOnResize) {\n      this.ctx.clearRect(0, 0, this.width, this.height);\n    }\n\n    this.#logicalSize = logicalSizeInteger;\n\n    //console.log(`setting logical size to ${ this.#logicalSize.width }x${ this.#logicalSize.height }`);\n\n    // Notify listeners of resize\n    // const r = this.opts.onResizing;\n    // if (r) {\n    //   setTimeout(() => { r(this.ctx, this.size, this) }, 100);\n    // }\n    if (this.opts.onResizing) {\n      this.opts.onResizing(this.ctx, this.size, this);\n    }\n    this.fireEvent(`resize`, { ctx: this.ctx, size: this.#logicalSize, helper: this });\n  }\n\n\n  #init() {\n    //console.log(`init`, this.opts);\n\n    // If there is a 'draw' callback, set up an animation loop\n    const d = this.opts.draw;\n    if (d) {\n      const sched = () => {\n        d(this.ctx, this.#logicalSize, this);\n        requestAnimationFrame(sched);\n      }\n      setTimeout(() => { sched() }, 100);\n    }\n\n    if (!this.opts.disablePointerEvents) {\n      this.#handleEvents();\n    }\n\n    const resizeLogic = this.opts.resizeLogic ?? `none`;\n    if (resizeLogic === `none`) {\n      this.setLogicalSize({ width: this.opts.width, height: this.opts.height });\n    } else {\n      const resizerOptions: ElementSizerOptions<HTMLCanvasElement> = {\n        onSizeChanging: (size) => {\n          if (Rects.isEqual(this.#logicalSize, size)) return;\n          this.setLogicalSize(size);\n        },\n        onSizeDone: (size, el) => {\n          this.#onResizeDone(size);\n        },\n        containerEl: this.opts.containerEl,\n        naturalSize: { width: this.opts.width, height: this.opts.height },\n        stretch: this.opts.resizeLogic ?? `none`\n      };\n      this.#resizer = new ElementSizer(this.el, resizerOptions);\n    }\n\n    this.#getContext();\n  }\n\n  #onResizeDone(size: Rect) {\n    if (this.opts.onResized) this.opts.onResized(this.ctx, this.size, this);\n    this.fireEvent(`resized`, { ctx: this.ctx, size: this.#logicalSize, helper: this });\n  }\n\n  #handleEvents() {\n    const handlePointerEvent = (event: PointerEvent) => {\n      const { offsetX, offsetY } = event;\n      const physicalX = offsetX * this.ratio;\n      const physicalY = offsetY * this.ratio;\n      event = cloneFromFields(event);\n      const eventData = {\n        physicalX, physicalY,\n        // eslint-disable-next-line @typescript-eslint/no-misused-spread\n        ...event\n      };\n\n      switch (event.type) {\n        case `pointerup`: {\n          {\n            this.fireEvent(`pointerup`, eventData);\n            break;\n          };\n        }\n        case `pointermove`: {\n          {\n            this.fireEvent(`pointermove`, eventData);\n            break;\n          };\n        }\n        case `pointerdown`: {\n          {\n            this.fireEvent(`pointerup`, eventData);\n            break;\n          };\n        }\n      };\n    }\n\n    this.el.addEventListener(`pointermove`, handlePointerEvent);\n    this.el.addEventListener(`pointerdown`, handlePointerEvent);\n    this.el.addEventListener(`pointerup`, handlePointerEvent);\n  }\n\n  /**\n   * Clears the canvas.\n   * \n   * Shortcut for:\n   * `ctx.clearRect(0, 0, this.width, this.height)`\n   */\n  clear() {\n    if (!this.#ctx) return;\n    this.#ctx.clearRect(0, 0, this.width, this.height);\n\n  }\n\n  /**\n   * Fills the canvas with a given colour.\n   * \n   * Shortcut for:\n   * ```js\n      * ctx.fillStyle = ``;\n   * ctx.fillRect(0, 0, this.width, this.height);\n   * ```\n   * @param colour Colour\n   */\n  fill(colour?: string) {\n    if (!this.#ctx) return;\n    if (colour) this.#ctx.fillStyle = colour;\n    this.#ctx.fillRect(0, 0, this.width, this.height);\n\n  }\n  /**\n   * Gets the drawing context\n   */\n  get ctx() {\n    if (this.#ctx === undefined) throw new Error(`Context not available`);\n    return this.#getContext();\n  }\n\n  get viewport() {\n    return this.#viewport;\n  }\n\n  /**\n   * Gets the logical width of the canvas\n   * See also: {@link height}, {@link size}\n   */\n  get width() {\n    return this.#logicalSize.width;\n  }\n\n  /**\n   * Gets the logical height of the canvas\n   * See also: {@link width}, {@link size}\n   */\n  get height() {\n    return this.#logicalSize.height;\n  }\n\n  /**\n   * Gets the logical size of the canvas\n   * See also: {@link width}, {@link height}\n   */\n  get size() {\n    return this.#logicalSize;\n  }\n\n  /**\n   * Gets the current scaling ratio being used\n   * to compensate for high-DPI display\n   */\n  get ratio() {\n    return window.devicePixelRatio || 1;\n  }\n\n  /**\n   * Returns the width or height, whichever is smallest\n   */\n  get dimensionMin() {\n    return Math.min(this.width, this.height);\n  }\n\n  /**\n   * Returns the width or height, whichever is largest\n   */\n  get dimensionMax() {\n    return Math.max(this.width, this.height);\n  }\n\n\n\n  drawBounds(strokeStyle = `green`) {\n    const ctx = this.#getContext();\n    Drawing.rect(ctx,\n      { x: 0, y: 0, width: this.width, height: this.height },\n      { crossed: true, strokeStyle, strokeWidth: 1 });\n\n    Drawing.rect(ctx, this.#viewport, { crossed: true, strokeStyle: `silver`, strokeWidth: 3 })\n  }\n\n  /**\n   * Returns a Scaler that converts from absolute\n   * to relative coordinates.\n   * This is based on the canvas size.\n   * \n   * ```js\n      * // Assuming a canvas of 800x500\n   * toRelative({ x: 800, y: 600 });  // { x: 1,   y: 1 }\n   * toRelative({ x: 0, y: 0 });   // { x: 0,   y: 0 }\n   * toRelative({ x: 400, y: 300 }); // { x: 0.5, y: 0.5 }\n   * ```\n   */\n  get toRelative() {\n    return this.#scaler.rel;\n  }\n\n  /**\n   * Returns a scaler for points based on width & height\n   */\n  get toAbsoluteFixed() {\n    return this.#scalerSize.abs\n  }\n\n  /**\n   * Returns a scaler for points based on width & height\n   */\n  get toRelativeFixed() {\n    return this.#scalerSize.rel;\n  }\n\n  get logicalCenter() {\n    return {\n      x: this.#logicalSize.width / 2,\n      y: this.#logicalSize.height / 2\n    }\n  }\n\n  /**\n * Returns a Scaler that converts from relative to absolute\n * coordinates.\n * This is based on the canvas size.\n * \n * ```js\n * // Assuming a canvas of 800x600\n * toAbsolute({ x: 1, y: 1 });      // { x: 800, y: 600}\n * toAbsolute({ x: 0, y: 0 });      // { x: 0, y: 0}\n * toAbsolute({ x: 0.5, y: 0.5 });  // { x: 400, y: 300}\n * ```\n */\n  get toAbsolute() {\n    return this.#scaler.abs;\n  }\n\n  /**\n   * Gets the center coordinate of the canvas\n   */\n  get center() {\n    return { x: this.width / 2, y: this.height / 2 }\n  }\n\n  /**\n   * Gets the image data for the canvas.\n   * Uses the 'physical' canvas size. Eg. A logical size of 400x400 might be\n   * 536x536 with a high-DPI display.\n   * @returns \n   */\n  getImageData(): ImageData {\n    const size = this.getPhysicalSize();\n    const data = this.ctx.getImageData(0, 0, size.width, size.height, { colorSpace: this.opts.colourSpace });\n\n    if (data === null || data === undefined) throw new Error(`Could not get image data from context`);\n    return data;\n  }\n\n  /**\n   * Returns the canvas frame data as a writable grid.\n   * When editing, make as many edits as needed before calling\n   * `flip`, which writes buffer back to the canvas.\n   * ```js\n      * const g = helper.getWritableBuffer();\n   * // Get {r,g,b,opacity} of pixel 10,10\n   * const pixel = g.get({ x: 10, y: 10 });\n   * \n   * // Set a colour to pixel 10,10\n   * g.set({ r: 0.5, g: 1, b: 0, opacity: 0 }, { x: 10, y: 10 });\n   * \n   * // Write buffer to canvas\n   * g.flip();\n   * ```\n   * \n   * Uses 'physical' size of canvas. Eg with a high-DPI screen, this will\n   * mean a higher number of rows and columns compared to the logical size.\n   * @returns\n   */\n  getWritableBuffer() {\n    const ctx = this.ctx;\n    const data = this.getImageData();\n    const grid = ImageDataGrid.grid(data);\n    const get = ImageDataGrid.accessor(data);\n    const set = ImageDataGrid.setter(data);\n\n    const flip = () => {\n      ctx.putImageData(data, 0, 0);\n    }\n\n    return { grid, get, set, flip };\n  }\n}\n\n// export const imageDataAsGrid = (canvas: HTMLCanvasElement, colorSpace: PredefinedColorSpace = `srgb`) => {\n//   const ctx = canvas.getContext(`2d`);\n//   if (!ctx) throw new Error(`Could not create context`);\n\n//   const data = ctx.getImageData(0, 0, canvas.width, canvas.height, { colorSpace });\n//   if (!data) throw new Error(`Could not get image data from context`);\n\n//   const get = ImageDataGrid.accessor(data);\n//   const set = ImageDataGrid.setter(data);\n// }","export const piPi = Math.PI*2;","import { scalerTwoWay, clamp } from \"@ixfx/numbers\";\nimport { resolveEl, resolveElementTry } from \"@ixfx/dom\";\nimport { resultErrorToString } from \"@ixfx/guards\";\nimport type { Rect, RectPositioned } from \"@ixfx/geometry/rect\";\nimport type { Point } from \"@ixfx/geometry/point\";\nimport { Points, Rects } from \"@ixfx/geometry\";\nimport type { CirclePositioned } from \"@ixfx/geometry/circle\";\nimport { piPi } from \"./pi-pi.js\";\n\nexport type CanvasRegionSpecRelativePositioned = {\n  relativePositioned: RectPositioned\n  scale?: `independent`\n}\n\nexport type CanvasRegionSpecAbsolutePositioned = {\n  absPositioned: RectPositioned\n}\n\nexport type CanvasRegionSpecRelativeSized = {\n  relativeSize: Rect\n  scale?: `independent`\n  /**\n   * Cardinal directions, or 'center' (default)\n   */\n  position: `center` | `n` | `s`\n}\n\nexport type CanvasRegionSpecMatched = {\n  match: HTMLElement | string\n}\n\nexport type CanvasRegionSpec = { marginPx?: number } & (CanvasRegionSpecAbsolutePositioned | CanvasRegionSpecRelativePositioned | CanvasRegionSpecRelativeSized | CanvasRegionSpecMatched);\n\n/**\n * Manges the drawing for a region of a canvas\n */\nexport class CanvasSource {\n  #canvasEl: HTMLCanvasElement;\n  #ctx: undefined | CanvasRenderingContext2D;\n  #sizeBasis: `min` | `max`;\n  #sizeScaler;\n  #logicalSize: Rect;\n  #pixelScaling: number;\n\n  #regions: CanvasRegion[] = [];\n\n  constructor(canvasElementOrQuery: HTMLCanvasElement | string, sizeBasis: `min` | `max` = `min`) {\n    this.#canvasEl = resolveEl<HTMLCanvasElement>(canvasElementOrQuery);\n    this.#sizeBasis = sizeBasis;\n    this.#pixelScaling = window.devicePixelRatio || 1;\n    this.#sizeScaler = this.#createSizeScaler();\n    this.#logicalSize = this.setLogicalSize({ width: this.#canvasEl.width, height: this.#canvasEl.height });\n  }\n\n\n  /**\n   * Set logical size for region\n   * @param size\n   * @returns \n   */\n  setLogicalSize(size: Rect) {\n    this.#logicalSize = size;\n    const el = this.#canvasEl;\n    el.width = (size.width * this.#pixelScaling);\n    el.height = (size.height * this.#pixelScaling);\n\n    el.style.width = `${ (size.width).toString() }px`;\n    el.style.height = `${ (size.height).toString() }px`;\n    this.#sizeScaler = this.#createSizeScaler();\n    this.invalidateContext();\n    return size;\n  }\n\n\n  #createSizeScaler() {\n    let inMax = 1;\n    switch (this.#sizeBasis) {\n      case `min`:\n        inMax = Math.min(this.#canvasEl.width, this.#canvasEl.height);\n        break;\n      case `max`:\n        inMax = Math.max(this.#canvasEl.width, this.#canvasEl.height);\n        break;\n    }\n    const s = scalerTwoWay(0, inMax, 0, 1);\n    return {\n      abs: s.in,\n      rel: s.out\n    }\n  }\n\n  /**\n   * Causes drawing context to be re-created\n   */\n  invalidateContext() {\n    this.#ctx = undefined;\n  }\n\n  #add(region: CanvasRegion) {\n    if (!region) throw new Error(`Param 'region' is undefined/null`);\n    if (this.#regions.includes(region)) throw new Error(`Region already exists`);\n    this.#regions.push(region);\n    return region;\n  }\n\n\n  /**\n   * Convert relative to absolute\n   * @param pt \n   * @param kind \n   * @returns \n   */\n  toAbsPoint(pt: Point, kind: `independent` = `independent`) {\n    let { x, y } = pt;\n    switch (kind) {\n      case `independent`:\n        x *= this.width;\n        y *= this.height;\n\n    }\n    return { x, y };\n  }\n\n  /**\n   * Gets the offset x,y\n   */\n  get offset() {\n    const b = this.#canvasEl.getBoundingClientRect();\n    return { x: b.left, y: b.top };\n  }\n\n  /**\n   * Converts an absolute point to relative\n   * @param pt \n   * @param source \n   * @param kind \n   * @param clamped \n   * @returns \n   */\n  toRelPoint(pt: Point, source: `screen` | `source`, kind: `independent` | `skip` = `independent`, clamped = true) {\n    let { x, y } = pt;\n    if (source === `screen`) {\n      const b = this.#canvasEl.getBoundingClientRect();\n      x -= b.x;\n      y -= b.y;\n    }\n    switch (kind) {\n      case `independent`:\n        x /= this.width;\n        y /= this.height;\n        break;\n      case `skip`:\n        break;\n    }\n    if (clamped) {\n      x = clamp(x);\n      y = clamp(y);\n    }\n    return { x, y };\n  }\n\n  /**\n   * Converts a rectangle to absolute coordinates\n   * @param rect \n   * @param kind \n   * @returns \n   */\n  toAbsRect(rect: Rect | RectPositioned, kind: `independent` = `independent`) {\n    let { width, height } = rect;\n    switch (kind) {\n      case `independent`:\n        width *= this.width;\n        height *= this.height;\n        if (Rects.isRectPositioned(rect)) {\n          return {\n            ...this.toAbsPoint(rect),\n            width,\n            height\n          }\n        }\n    }\n    return { width, height }\n  }\n\n\n  /**\n   * Creates a region\n   * \n   * Absolute positioned. Uses source coordinates which don't change\n   * ```js\n   * source.createRegion({ \n   *  absPositioned: { x: 0, y: 0, width: 100, height: 100} \n   * });\n   * ```\n   * \n   * Relative positioned. Uses coordiantes relative to source dimensions.\n   * Updated if source changes.\n   * ```js\n   * source.createRegion({\n   *  relativePositioned: { x: 0, y:0, width: 1, height: 0.5 },\n   *  scale: `independent`\n   * });\n   * ```\n   * \n   * Relative sized. Uses size relative to source dimension. By default centers.\n   * ```js\n   * source.createRegion({\n   *  relativeSize: { width: 0.5, height: 0.5 }\n   *  position: `center`\n   * })\n   * ```\n   * @param spec \n   * @returns \n   */\n  createRegion(spec: CanvasRegionSpec) {\n    const marginPx = spec.marginPx ?? 0;\n    const marginPx2 = marginPx * 2;\n    if (`absPositioned` in spec) {\n      const rect = Rects.subtractSize(spec.absPositioned, marginPx, marginPx);\n      return this.#add(new CanvasRegion(this, () => rect))\n    }\n\n    if (`relativePositioned` in spec) {\n      let compute: ((source: CanvasSource) => RectPositioned);\n      const rect = spec.relativePositioned;\n      switch (spec.scale) {\n        case `independent`:\n          compute = (source: CanvasSource): RectPositioned => ({\n            x: (rect.x * source.width) + marginPx,\n            y: (rect.y * source.height) + marginPx,\n            width: (rect.width * source.width) - marginPx2,\n            height: (rect.height * source.height) - marginPx2\n          });\n          break;\n        default:\n          throw new Error(`Param 'kind' unknown (${ spec.scale })`);\n      }\n      return this.#add(new CanvasRegion(this, compute));\n    }\n\n    if (`relativeSize` in spec) {\n      let compute: ((source: CanvasSource) => RectPositioned);\n      const rect = spec.relativeSize;\n      const position = spec.position;\n\n      switch (spec.scale) {\n        case `independent`:\n          compute = (source: CanvasSource): RectPositioned => {\n            const width = (rect.width * source.width) - marginPx2;\n            const height = (rect.height * source.height) - marginPx2;\n            let x = source.width / 2 - width / 2;\n            let y = source.height / 2 - height / 2;\n            switch (position) {\n              case `n`:\n                y = 0;\n                break;\n              case `s`:\n                y = source.height - height;\n                break;\n              default:\n              /** no-op, */\n            }\n            x += marginPx;\n            y += marginPx;\n            return { width, height, x, y }\n          }\n          break;\n        default:\n          throw new Error(`Param 'kind' unknown (${ spec.scale })`);\n      }\n      return this.#add(new CanvasRegion(this, compute));\n    }\n\n    if (`match` in spec) {\n      const result = resolveElementTry(spec.match);\n      if (!result.success) {\n        throw new Error(`Could not resolve match element. ${ resultErrorToString(result) }`);\n      }\n      const compute = (_source: CanvasSource): RectPositioned => {\n        const bounds = result.value.getBoundingClientRect();\n        return {\n          x: bounds.x + marginPx,\n          y: bounds.y + marginPx,\n          width: bounds.width - marginPx2,\n          height: bounds.height - marginPx2\n        }\n      }\n      return this.#add(new CanvasRegion(this, compute));\n    }\n    throw new Error(`Spec doesn't seem valid`);\n  }\n\n  /**\n   * Clears the region of the canvas\n   */\n  clear() {\n    const c = this.context;\n    c.clearRect(0, 0, this.width, this.height);\n  }\n\n  /**\n   * Gets - or creates - the drawing context\n   */\n  get context() {\n    if (this.#ctx) return this.#ctx;\n    const c = this.#canvasEl.getContext(`2d`);\n    if (!c) throw new Error(`Could not create 2d context`);\n    c.setTransform(1, 0, 0, 1, 0, 0);\n    c.scale(this.#pixelScaling, this.#pixelScaling);\n\n    this.#ctx = c;\n\n    for (const r of this.#regions) {\n      r.recomputeRegion();\n    }\n    return this.#ctx;\n  }\n\n  /**\n   * Gets a scaler for size\n   */\n  get sizeScaler() {\n    return this.#sizeScaler;\n  }\n\n  /**\n   * Gets the logical width\n   */\n  get width() {\n    return this.#logicalSize.width;\n  }\n\n  /**\n   * Gets the logical height\n   */\n  get height() {\n    return this.#logicalSize.height;\n  }\n}\n\n/**\n * Draws on a canvas, constrained to a specific region\n */\nexport class CanvasRegion {\n  source: CanvasSource;\n  #regionCompute: (parent: CanvasSource) => RectPositioned;\n  #r: RectPositioned;\n\n  /**\n   * Creates, using coordinate in canvas coordinates\n   */\n  constructor(source: CanvasSource, regionCompute: (parent: CanvasSource) => RectPositioned) {\n    this.source = source;\n    this.#regionCompute = regionCompute;\n    this.#r = regionCompute(source);\n  }\n\n  /**\n   * Calls the original `regionCompute` function passed in to the constructor\n   * to recompute the absolute region\n   */\n  recomputeRegion() {\n    this.#r = this.#regionCompute(this.source);\n  }\n\n  /**\n   * Converts a region-relative point (0..1) to an absolute\n   * point, which uses region-relative coordinates.\n   * \n   * Eg if the region had an x,y of 100,100, `toAbsRegion({x:0,y:0})`\n   * will return 0,0.\n   *\n   * @param regionRel \n   * @param scaleBy \n   * @returns \n   */\n  toAbsRegion(regionRel: Point, scaleBy: `both` = `both`) {\n    switch (scaleBy) {\n      case `both`:\n        return {\n          x: regionRel.x * this.#r.width,\n          y: regionRel.y * this.#r.height\n        }\n        break;\n    }\n  }\n\n  /**\n   * Returns a copy of `p` offset by the region's x & y\n   * @param p \n   * @returns \n   */\n  applyRegionOffset(p: Point) {\n    return {\n      x: p.x + this.#r.x,\n      y: p.y + this.#r.y\n    }\n  }\n\n  /**\n   * Draws a line from a series of points.\n   * Assumes region-relative, % coordinates (ie 0..1 scale)\n   * @param relativePoints Points to connect, in region-relative coordinates\n   * @param strokeStyle Stroke style\n   * @param lineWidth Line with\n   */\n  drawConnectedPointsRelative(relativePoints: Point[], strokeStyle: string, lineWidth = 1) {\n    const points = relativePoints.map(p => this.toAbsRegion(p));\n    this.drawConnectedPoints(points, strokeStyle, lineWidth);\n  }\n\n  /**\n   * Draws connected points in absolute coordinates,\n   * however with 0,0 being the top-left of the region.\n   * \n   * Thus, this will apply the region offset before drawing.\n   * @param points Points to draw\n   * @param strokeStyle Stroke style\n   * @param lineWidth Line width\n   */\n  drawConnectedPoints(points: Point[], strokeStyle: string, lineWidth = 1) {\n    const c = this.context;\n    c.save();\n    c.translate(this.#r.x, this.#r.y);\n    c.beginPath();\n    c.strokeStyle = strokeStyle;\n    c.lineWidth = lineWidth;\n    for (let index = 0; index < points.length; index++) {\n      if (index === 0) {\n        c.moveTo(points[ index ].x, points[ index ].y);\n      } else {\n        c.lineTo(points[ index ].x, points[ index ].y);\n      }\n    }\n    c.stroke();\n    c.restore();\n  }\n\n  /**\n   * Fills text at a relative position\n   * @param text \n   * @param relPos Relative, meaning 0.5,0.5 is the middle of the region\n   * @param fillStyle \n   * @param baseline \n   * @param align \n   */\n  fillTextRelative(text: string, relPos: Point, fillStyle = `black`, font: string, baseline: CanvasTextBaseline = `alphabetic`, align: CanvasTextAlign = `start`) {\n    const point = this.toAbsRegion(relPos);\n    this.fillTextRelative(text, point, fillStyle, font, baseline, align);\n  }\n\n  /**\n   * Fills text at a region-relative position\n   * @param text \n   * @param point Region relative, meaning 0,0 is top-left of region\n   * @param fillStyle \n   * @param baseline \n   * @param align \n   */\n  fillText(text: string, point: Point, fillStyle = `black`, font: string, baseline: CanvasTextBaseline = `alphabetic`, align: CanvasTextAlign = `start`) {\n    const c = this.context;\n    c.save();\n    c.translate(this.#r.x, this.#r.y);\n    if (font.length > 0) {\n      c.font = font;\n    }\n    c.textBaseline = baseline;\n    c.textAlign = align;\n    c.fillStyle = fillStyle;\n    c.fillText(text, point.x, point.y);\n    c.restore();\n  }\n\n  drawCircles(relativeCircles: CirclePositioned[], fillStyle: string, strokeStyle = ``, lineWidth = 1) {\n    const circles = relativeCircles.map(c => {\n      return {\n        ...this.toAbsRegion(c),\n        radius: this.source.sizeScaler.abs(c.radius)\n      }\n    });\n\n    const c = this.context;\n    c.save();\n    c.translate(this.#r.x, this.#r.y);\n    c.fillStyle = fillStyle;\n    c.strokeStyle = strokeStyle;\n    c.lineWidth = lineWidth;\n\n    for (const circle of circles) {\n      c.beginPath();\n      c.arc(circle.x, circle.y, circle.radius, 0, piPi);\n      c.closePath();\n      if (fillStyle.length > 0) {\n        c.fill();\n      }\n      if (strokeStyle.length > 0) {\n        c.stroke();\n      }\n    }\n    c.restore();\n  }\n\n  /**\n   * Clears the region\n   */\n  clear() {\n    const c = this.context;\n    c.clearRect(this.#r.x, this.#r.y, this.#r.width, this.#r.height);\n  }\n\n  /**\n   * Fills the region\n   * @param fillStyle\n   */\n  fill(fillStyle = `white`) {\n    const c = this.context;\n    c.fillStyle = fillStyle;\n    c.fillRect(this.#r.x, this.#r.y, this.#r.width, this.#r.height);\n  }\n\n  /**\n   * For debugging, draws an outline of the bounds\n   * @param strokeStyle \n   * @param lineWidth \n   */\n  drawBounds(strokeStyle: string, lineWidth = 1) {\n    this.drawConnectedPointsRelative([\n      { x: 0, y: 0 },\n      { x: 1, y: 0 },\n      { x: 1, y: 1 },\n      { x: 0, y: 1 },\n      { x: 0, y: 0 }\n    ], strokeStyle, lineWidth);\n\n    this.drawConnectedPointsRelative([\n      { x: 0, y: 1 },\n      { x: 1, y: 0 }\n    ], strokeStyle, lineWidth);\n    this.drawConnectedPointsRelative([\n      { x: 0, y: 0 },\n      { x: 1, y: 1 }\n    ], strokeStyle, lineWidth);\n  }\n\n  /**\n   * Converts a  point to a region-relative one.\n   * @param pt \n   * @param kind \n   * @returns \n   */\n  toRelPoint(pt: Point, source: `screen` | `source` = `screen`, kind: `independent` = `independent`, clamped = true) {\n    pt = this.source.toRelPoint(pt, source, `skip`, false);\n    let { x, y } = pt;\n    x -= this.x;\n    y -= this.y;\n\n    switch (kind) {\n      case `independent`:\n        x /= this.width;\n        y /= this.height;\n    }\n    if (clamped) {\n      x = clamp(x);\n      y = clamp(y);\n    }\n    return { x, y };\n  }\n\n  /**\n   * Converts absolute to region point\n   * @param pt \n   * @param source \n   * @param clamped \n   * @returns \n   */\n  absToRegionPoint(pt: Point, source: `screen`, clamped: boolean) {\n    if (source === `screen`) {\n      pt = Points.subtract(pt, this.source.offset);\n    }\n\n    let { x, y } = pt;\n    x -= this.x;\n    y -= this.y;\n\n    if (clamped) {\n      if (x < 0) x = 0;\n      if (y < 0) y = 0;\n      if (x > this.width + this.x) x = this.x + this.width;\n      if (y > this.height + this.y) y = this.y + this.height;\n    }\n    return { x, y };\n  }\n\n  /**\n   * Get center of region\n   */\n  get center() {\n    return Rects.center(this.#r);\n  }\n\n  /**\n   * Gets the drawing context\n   */\n  get context() {\n    return this.source.context;\n  }\n\n  /**\n   * SEts the region\n   */\n  set region(value: RectPositioned) {\n    this.#r = value;\n  }\n\n  /**\n   * Gets the region\n   */\n  get region() {\n    return this.#r;\n  }\n\n  /**\n   * Gets the width\n   */\n  get width() {\n    return this.#r.width;\n  }\n\n  /**\n   * Gets the height\n   */\n  get height() {\n    return this.#r.height;\n  }\n\n  /**\n   * Gets the x offset\n   */\n  get x() {\n    return this.#r.x;\n  }\n\n  /**\n   * Gets they y offset\n   */\n  get y() {\n    return this.#r.y;\n  }\n\n  /**\n   * Gets the width/height, whichever is smaller\n   */\n  get dimensionMin() {\n    return Math.min(this.#r.width, this.#r.height);\n  }\n}\n","import type { DrawingOpts } from \"./types.js\";\n\n/**\n * Applies drawing options to given SVG element.\n * Applies: fillStyle\n * @param elem Element\n * @param opts Drawing options\n */\nexport const applyOpts = (elem: SVGElement, opts: DrawingOpts) => {\n  if (opts.fillStyle) elem.setAttributeNS(null, `fill`, opts.fillStyle);\n  if (opts.opacity) {\n    elem.setAttributeNS(null, `opacity`, opts.opacity.toString());\n  }\n\n};","import { type Rect } from '@ixfx/geometry/rect';\n/**\n * Get the bounds of an SVG element (determined by its width/height attribs)\n * @param svg\n * @returns\n */\nexport const getBounds = (svg: SVGElement): Rect => {\n  const w = svg.getAttributeNS(null, `width`);\n  const width = w === null ? 0 : Number.parseFloat(w);\n  const h = svg.getAttributeNS(null, `height`);\n  const height = h === null ? 0 : Number.parseFloat(h);\n  return { width, height };\n};\n\n/**\n * Set the bounds of an element, using its width/height attribs.\n * @param svg\n * @param bounds\n */\nexport const setBounds = (svg: SVGElement, bounds: Rect): void => {\n  svg.setAttributeNS(null, `width`, bounds.width.toString());\n  svg.setAttributeNS(null, `height`, bounds.height.toString());\n};","/**\n * Creates an element of `type` and with `id` (if specified)\n * @param type Element type, eg `circle`\n * @param id Optional id to assign to element\n * @returns Element\n */\nexport const createEl = <V extends SVGElement>(\n  type: string,\n  id?: string\n): V => {\n  const m = document.createElementNS(`http://www.w3.org/2000/svg`, type) as V;\n  if (id) {\n    m.id = id;\n  }\n  return m;\n};\n\n\n/**\n * Creates and appends a SVG element.\n *\n * ```js\n * // Create a circle\n * const circleEl = createOrResolve(parentEl, `SVGCircleElement`);\n * ```\n *\n * If `queryOrExisting` is specified, it is used as a query to find an existing element. If\n * query starts with `#`, this will be set as the element id, if created.\n *\n * ```js\n * // Creates an element with id 'myCircle' if it doesn't exist\n * const circleEl = createOrResolve(parentEl, `SVGCircleElement`, `#myCircle`);\n * ```\n * @param parent Parent element\n * @param type Type of SVG element\n * @param queryOrExisting Query, eg `#id`\n * @returns\n */\nexport const createOrResolve = <V extends SVGElement>(\n  parent: SVGElement,\n  type: string,\n  queryOrExisting?: string | V,\n  suffix?: string\n): V => {\n  let existing:SVGElement|HTMLElement|null = null;\n  if (queryOrExisting !== undefined) {\n    existing = typeof queryOrExisting === `string` ? parent.querySelector(queryOrExisting) : queryOrExisting;\n  }\n  if (existing === null) {\n    const p = document.createElementNS(`http://www.w3.org/2000/svg`, type) as V;\n    parent.append(p);\n    if (queryOrExisting && typeof queryOrExisting === `string` &&\n      queryOrExisting.startsWith(`#`)) {\n      p.id = suffix !== undefined && !queryOrExisting.endsWith(suffix) ? queryOrExisting.slice(1) + suffix : queryOrExisting.slice(1);\n    }\n    return p;\n  }\n  return existing as V;\n};","import { numberTest, resultThrow } from '@ixfx/guards';\nimport { type RandomSource } from '@ixfx/random';\nimport { scalar as hslScalar, toCssString } from './hsl.js';\n\n/**\n * Returns a full HSL colour string (eg `hsl(20,50%,75%)`) based on a index.\n * It's useful for generating perceptually different shades as the index increments.\n *\n * ```\n * el.style.backgroundColor = goldenAgeColour(10);\n * ```\n *\n * Saturation and lightness can be specified, as numeric ranges of 0-1.\n *\n * @param saturation Saturation (0-1), defaults to 0.5\n * @param lightness Lightness (0-1), defaults to 0.75\n * @param alpha Opacity (0-1), defaults to 1.0\n * @returns HSL colour string eg `hsl(20,50%,75%)`\n */\nexport const goldenAngleColour = (\n  index: number,\n  saturation = 0.5,\n  lightness = 0.75,\n  alpha = 1\n) => {\n  resultThrow(\n    numberTest(index, `positive`, `index`),\n    numberTest(saturation, `percentage`, `saturation`),\n    numberTest(lightness, `percentage`, `lightness`),\n    numberTest(alpha, `percentage`, `alpha`)\n  );\n  // Via Stackoverflow\n  const hueDeg = index * 137.508; // use golden angle approximation\n  const hueRel = (hueDeg % 360) / 360\n  return toCssString(hslScalar(hueRel, saturation, lightness, alpha));\n  //return alpha === 1 ? `hsl(${ hue },${ saturation * 100 }%,${ lightness * 100 }%)` : `hsl(${ hue },${ saturation * 100 }%,${ lightness * 100 }%,${ alpha * 100 }%)`;\n};\n\n/**\n * Returns a random hue component (0..359)\n * \n * ```\n * // Generate hue\n * const h = randomHue(); // 0-359\n *\n * // Generate hue and assign as part of a HSL string\n * el.style.backgroundColor = `hsl(${randomHue(), 50%, 75%})`;\n * ```\n * @param rand\n * @returns\n */\nexport const randomHue = (rand: RandomSource = Math.random): number => rand() * 360;\n","import type { Colour, Colourish, Hsl, OkLch, Rgb } from './types.js';\nimport { toColour, toCssColour } from './conversion.js';\nimport * as HslSpace from './hsl.js';\nimport * as SrgbSpace from './srgb.js';\nimport { clamp } from '@ixfx/numbers';\nimport { OklchSpace } from './index.js';\nimport * as C from 'colorizr';\n\nexport function multiplyOpacity<T extends Colourish>(colourish: T, amount: number):\n  T extends string ? string :\n  T extends Hsl ? Hsl :\n  T extends OkLch ? OkLch :\n  T extends Rgb ? Rgb : never\n\n/**\n * Multiplies the opacity of a colour by `amount`, returning a computed CSS colour.\n * \n * ```js\n * multiplyOpacity(`red`, 0.5); // Returns a colour string\n * ```\n * \n * For example, to half the opacity, use `amount: 0.5`.\n * Clamps the result to ensure it's between 0..1\n * @param colourish Colour\n * @param amount Amount\n * @returns \n */\nexport function multiplyOpacity(colourish: Colourish, amount: number): Colourish {\n  return withOpacity(colourish, o => clamp(o * amount));\n}\n\n/**\n * Does a computation with the opacity of a colour, returning colour string\n * @param colourish Colour\n * @param fn Function that takes original opacity as input and returns output opacity\n */\n//export function withOpacity(colourish: string, fn: (scalarOpacity: number) => number): string;\n\n/**\n * Does a computation with the opacity of a colour in a HSL structure\n * @param hsl Colour\n * @param fn Function that takes original opacity as input and returns output opacity\n */\n//export function withOpacity(hsl: Hsl, fn: (scalarOpacity: number) => number): Hsl;\n\n/**\n * Does a computation with the opacity of a colour in a RGB structure\n * @param colourish Colour\n * @param fn Function that takes original opacity as input and returns output opacity\n */\n\n//export function withOpacity(rgb: Rgb, fn: (scalarOpacity: number) => number): Rgb;\nexport function withOpacity<T extends Colourish>(colourish: T, fn: (scalarOpacity: number) => number):\n  T extends string ? string :\n  T extends Hsl ? Hsl :\n  T extends OkLch ? OkLch :\n  T extends Rgb ? Rgb : never\n\n/**\n * Does a computation with the opacity of a colour, returning colour.\n * \n * Passes operation to `HslSpace` or `SrgbSpace` depending on space of `colourish`.\n * @param colourish Colour\n * @param fn Function that takes original opacity as input and returns output opacity\n */\nexport function withOpacity(colourish: Colourish, fn: (scalarOpacity: number) => number): Colourish {\n  const colour = toColour(colourish);\n  let result: Colour | undefined;\n  switch (colour.space) {\n    case `hsl`:\n      result = HslSpace.withOpacity(colour, fn);\n      break;\n    case `srgb`:\n      result = SrgbSpace.withOpacity(colour, fn);\n      break;\n    case `oklch`:\n      result = OklchSpace.withOpacity(colour, fn);\n      break;\n    default:\n      throw new Error(`Unknown space: '${ colour.space }'. Expected hsl, srgb, oklch`)\n  }\n  if (!result) throw new Error(`Is colour in correct form?`);\n\n  // If input type was string, return result as string\n  if (typeof colourish === `string`) {\n    return toCssColour(result);\n  }\n  return result;\n};\n\nexport function setOpacity<T extends Colourish>(colourish: T, amount: number):\n  T extends string ? string :\n  T extends Hsl ? Hsl :\n  T extends OkLch ? OkLch :\n  T extends Rgb ? Rgb : never\n\nexport function setOpacity(colourish: Colourish, opacity: number): Colourish {\n  const colour = toColour(colourish);\n  colour.opacity = opacity;\n  if (typeof colourish === `string`) {\n    return toCssColour(colour);\n  }\n  return colour;\n}\n\n// export function lighten(colour: string, amount: number): string;\n// export function lighten(colour: Colour, amount: number): Colour;\n// export function lighten(colourish: Colourish, amount: number): Colourish {\n//   const asString = toCssColour(colourish);\n//   const result = C.lighten(asString, amount, ``)\n// }\n\n\n\n// export const multiplySaturation = (colour: Colourish, amt: number): string => {\n//   throwNumberTest(amt, `percentage`, `amt`);\n//   const c = structuredToColorJs(colour);\n//   c.s = (c.s ?? 0) * amt;\n//   return c.toString();\n// };","import type { Colour, ColourInterpolationOpts, ColourInterpolator, Colourish, ColourSpaces, ColourStepOpts, Hsl, HslScalar, OkLch, OkLchScalar, RgbScalar } from \"./types.js\";\nimport { pairwise } from '@ixfx/arrays';\nimport * as HslSpace from './hsl.js';\nimport { convert, toCssColour, type ConvertDestinations } from \"./conversion.js\";\nimport { convertScalar, OklchSpace, SrgbSpace } from \"./index.js\";\n\n/**\n * Returns a function to interpolate between colours\n * ```js\n * const i = interpolator([`orange`, `yellow`, `red`]);\n * \n * // Get a random colour on the above spectrum\n * i(Math.random());\n * ```\n * \n * Results will vary depending on the colour space used, play with the options.\n * When using a hue-based colour space, the `hue` option sets the logic for how hue values wrap.\n * \n * ```js\n * interpolator([`orange`, `yellow`, `red`], { space: `hsl`, hue: `longer })\n * ```\n * @param colours Colours to interpolate between\n * @param opts Options for interpolation\n * @returns \n */\n// export const interpolator = (colours: Colourish[], opts: Partial<ColourInterpolationOpts> = {}) => {\n//   const spaceDestination: ConvertDestinations = `oklch-scalar`;\n//   let ranges: Colour[] = [];\n//   const direction = opts.direction ?? `shorter`;\n\n//   switch (opts.space) {\n//     case `hsl`:\n//       ranges = interpolateInit(colours, `hsl-scalar`)\n//         .map(piece => HslSpace.interpolator(piece[ 0 ], piece[ 1 ], direction));\n//       break;\n//     default:\n//       ranges = interpolateInit(colours, `oklch-scalar`)\n//         .map(piece => OklchSpace.interpolator(piece[ 0 ], piece[ 1 ], direction));\n//       break;\n//   }\n\n\n//   return (amt: number): string => {\n//     amt = clamp(amt);\n\n//     // Scale to 0..1 to 0...ranges.length\n//     const s = scaleNumber(amt, 0, 1, 0, ranges.length);\n//     const index = Math.floor(s);\n//     const amtAdjusted = s - index;\n//     const range = ranges[ index ];\n\n//     // If we're at the end, return the last colour\n\n//     if (index === 1) return toHex(colours.at(-1)!);\n\n//     const colour = range(amtAdjusted);\n//     return colour.display();\n\n//   }\n// }\n\n// const interpolatorInit = (colours: Colourish[]) => {\n//   if (!Array.isArray(colours)) throw new Error(`Param 'colours' is not an array as expected. Got: ${ typeof colours }`);\n//   if (colours.length < 2) throw new Error(`Param 'colours' should be at least two in length. Got: ${ colours.length }`);\n//   const c = colours.map(colour => toLibraryColour(colour));\n//   return [ ...pairwise(c) ];\n// }\n\n// function interpolateInit(colours: Colourish[], destination: `oklch-scalar`): OkLchScalar[][];\n// function interpolateInit(colours: Colourish[], destination: `hsl-scalar`): HslScalar[][];\nfunction interpolateInit<T extends ColourSpaces>(colours: Colourish[], destination: T):\n  T extends `oklch` ? OkLchScalar[][] :\n  T extends `hsl` ? HslScalar[][] :\n  T extends `srgb` ? RgbScalar[][] : HslScalar[][]\n\nfunction interpolateInit(colours: Colourish[], destination: ColourSpaces = `hsl`): (OkLchScalar | HslScalar | RgbScalar)[][] {\n  if (!Array.isArray(colours)) throw new Error(`Param 'colours' is not an array as expected. Got: ${ typeof colours }`);\n  if (colours.length < 2) throw new Error(`Param 'colours' should be at least two in length. Got: ${ colours.length }`);\n\n  const c = colours.map(colour => convertScalar(colour, destination));\n  return [ ...pairwise(c) ];\n}\n\n/**\n * Returns a CSS `linear-gradient` with stops corresponding to the given list of `colours`.\n * ```js\n * element.style.background = Colour.cssLinearGradient(['red','green','blue']);\n * ```\n * @param colours \n * @returns \n */\nexport const cssLinearGradient = (colours: Colourish[]) => {\n  const c = colours.map(c => toCssColour(c));\n  return `linear-gradient(to right, ${ c.join(`, `) })`;\n}\n\n/**\n * Returns a function that interpolates between two colours. Returns string colour values.\n * \n * By default takes a shorter direction and uses the OkLCH colourspace.\n * ```js\n * const i = interpolator(`blue`, `red`);\n * i(0.5); // Get the colour at 50%, as a string.\n * ```\n * \n * To work with structured colour values, use one of the space's `interpolate` functions.\n * \n * If you want to create discrete steps, consider {@link createSteps} or {@link scale}.\n * \n * @param colourA \n * @param colourB \n * @param options \n * @returns \n */\nexport const interpolator = (colourA: Colourish, colourB: Colourish, options: Partial<ColourInterpolationOpts> = {}) => {\n  const space = options.space ?? `oklch`;\n  const direction = options.direction ?? `shorter`;\n\n  let inter: ColourInterpolator<Colour> | undefined;\n  switch (space) {\n    case `hsl`:\n      inter = HslSpace.interpolator(convert(colourA, `hsl-scalar`), convert(colourB, `hsl-scalar`), direction);\n      break;\n    case `srgb`:\n      inter = SrgbSpace.interpolator(convert(colourA, `srgb-scalar`), convert(colourB, `srgb-scalar`));\n      break;\n    default:\n      inter = OklchSpace.interpolator(convert(colourA, `oklch-scalar`), convert(colourB, `oklch-scalar`), direction);\n  }\n\n  return (amount: number) => toCssColour(inter(amount));\n\n}\n\n/**\n * Produces a stepped scale of colours.\n * \n * Builds off {@link createSteps} which can only step between two colours.\n * \n * ```js\n * // A scale of from red to green, with three colours in-between\n * const steps = Colour.scale([ `red`, `green` ], { stepsBetween: 3 });\n * for (const step of steps) {\n *  // A CSS colour string\n * }\n * ```\n * \n * {@link cssLinearGradient} can produce a smooth gradient in CSS on the basis\n * of the stepped colours.\n * @param colours \n * @param opts \n * @returns \n */\nexport const scale = (colours: Colourish[], opts: Partial<ColourStepOpts> = {}): string[] => {\n  const direction = opts.direction ?? `shorter`;\n  const space = opts.space ?? `oklch`;\n  const pieces = interpolateInit(colours, space);\n\n  let stepsBetween = 0;\n  if (typeof opts.stepsBetween === `number`) {\n    stepsBetween = opts.stepsBetween;\n    if (stepsBetween < 1) throw new Error(`Param 'stepsBetween' must be at least 1`);\n  } else if (typeof opts.stepsTotal === `number`) {\n    if (opts.stepsTotal <= colours.length) throw new Error(`Param 'stepsTotal' must be greater than number of provided colour stops (${ colours.length }) +1 per stop`);\n    const totalSteps = opts.stepsTotal - colours.length;\n    stepsBetween = Math.floor(totalSteps / pieces.length);\n  }\n\n  const steps = pieces.map((piece: Colour[]) => {\n    //const pieceSteps = HslSpace.createSteps(piece[ 0 ], piece[ 1 ], stepsBetween, direction, true);\n    const pieceSteps: Colour[] = createSteps(piece[ 0 ], piece[ 1 ], { steps: stepsBetween, space, direction, exclusive: true });\n\n    // Add end colour\n    pieceSteps.push(piece[ 1 ]);\n    return pieceSteps;\n  });\n\n  // Add very first colour\n  const firstPiece = pieces[ 0 ];\n  steps.unshift([ firstPiece[ 0 ] ]);\n  return steps.flat().map(c => toCssColour(c));\n}\n\nexport type CreateStepsOptions = Partial<{ space: ColourSpaces, steps: number, direction: `longer` | `shorter`, exclusive: boolean }>\n\n/**\n * Creates discrete colour steps between two colours. \n * \n * Use {@link scale} to create steps between any number of colours.\n * \n * Start and end colours are included (and counted as a step) unless `exclusive` is set to _true_\n * \n * ```js\n * // Array of five HslScalar \n * createSteps(`red`,`blue`, { steps: 5 });\n * ```\n * \n * Defaults to the oklch colour space, 5 steps and non-exclusive.\n * @param a Start colour\n * @param b End colour\n * @param options\n * @returns \n */\nexport function createSteps<T extends CreateStepsOptions>(a: Colourish | string, b: Colourish, options: T):\n  T extends { space: `oklch` } ? OkLchScalar[] :\n  T extends { space: `srgb` } ? RgbScalar[] :\n  T extends { space: `hsl` } ? HslScalar[] : OkLchScalar[];\n\nexport function createSteps(a: Colourish | string, b: Colourish, options: CreateStepsOptions = {}): Colour[] {\n  const exclusive = options.exclusive ?? false;\n  const steps = options.steps ?? 5;\n  const space = options.space ?? `oklch`;\n  const direction = options.direction ?? `shorter`;\n\n  if (!exclusive && steps < 2) throw new Error(`Param 'steps' should be at least 2 when 'exclusive' is false`);\n  if (exclusive && steps < 1) throw new Error(`Param 'steps' should be at least 1 when 'exlusive' is true`);\n\n  const aa = convertScalar(a, space);\n  const bb = convertScalar(b, space);\n\n  // Create interpolator\n  let inter: ColourInterpolator<Colour> | undefined;\n  switch (space) {\n    case `hsl`:\n      inter = HslSpace.interpolator(aa as HslScalar, bb as HslScalar, direction);\n      break;\n    case `oklch`:\n      inter = OklchSpace.interpolator(aa as OkLchScalar, bb as OkLchScalar, direction);\n      break;\n    case `srgb`:\n      inter = SrgbSpace.interpolator(aa as RgbScalar, bb as RgbScalar);\n      break;\n    default:\n      throw new Error(`Colour space '${ space }' not supported for interpolation.`);\n  }\n  if (!inter) throw new Error(`Could not create interpolator for space: ${ space }`);\n\n  let stepBy = 0;\n  let startAt = 0;\n  let endAt = 1;\n  if (exclusive) {\n    stepBy = 1 / (steps + 1);\n    startAt = stepBy;\n    endAt = 1 - stepBy;\n  } else {\n    stepBy = 1 / (steps - 1);\n  }\n\n  const results: Colour[] = [];\n  for (let interpolateAmount = startAt; interpolateAmount <= endAt; interpolateAmount += stepBy) {\n    results.push(inter(interpolateAmount));\n  }\n\n  return results;\n}\n","export * from './conversion.js';\nexport * from './css-colours.js';\nexport * from './generate.js';\nexport * from './guards.js';\n//export * from './interpolate.js';\nexport * from './math.js';\nexport * from './interpolate.js';\nexport * as HslSpace from './hsl.js';\nexport * as OklchSpace from './oklch.js';\nexport * as SrgbSpace from './srgb.js';\n\nexport * from './types.js';","import Colorizr, * as C from \"colorizr\";\nimport { type Colour, type Colourish, type ColourSpaces, type Hsl, type HslAbsolute, type HslScalar, type OkLch, type OkLchAbsolute, type OkLchScalar, type Rgb, type Rgb8Bit, type RgbScalar } from \"./types.js\";\nimport * as SrgbSpace from \"./srgb.js\";\nimport * as HslSpace from './hsl.js';\nimport * as OkLchSpace from './oklch.js';\nimport { fromCssColour } from \"./css-colours.js\";\nimport { isHsl, isRgb, tryParseObjectToRgb, tryParseObjectToHsl, isColourish, isOkLch } from \"./guards.js\";\nimport { OklchSpace } from \"./index.js\";\n\nexport type ConvertDestinations = `hsl-scalar` | `hsl-absolute` | `oklch-scalar` | `oklch-absolute` | `srgb-8bit` | `srgb-scalar`;\n\nexport function convert<T extends ConvertDestinations>(colour: Colourish, destination: T):\n  T extends \"oklch-absolute\" ? OkLchAbsolute :\n  T extends \"oklch-scalar\" ? OkLchScalar :\n  T extends \"srgb-8bit\" ? Rgb8Bit :\n  T extends \"srgb-scalar\" ? RgbScalar :\n  T extends \"hsl-scalar\" ? HslScalar :\n  T extends \"hsl-absolute\" ? HslAbsolute : never\n\n/**\n * Converts an object or string representation of colour to ixfx's\n * structured colour.\n * Use {@link convertToString} if you want a CSS colour string instead.\n * @param colour \n * @param destination \n * @returns \n */\nexport function convert(colour: Colourish, destination: ConvertDestinations): Hsl | OkLch | Rgb {\n  if (destination === `hsl-scalar`) {\n    if (typeof colour === `string` || isHsl(colour) || isRgb(colour)) {\n      return HslSpace.toScalar(colour);\n    }\n  } else if (destination === `hsl-absolute`) {\n    if (typeof colour === `string` || isHsl(colour)) {\n      return HslSpace.toAbsolute(colour);\n    }\n  } else if (destination === `oklch-scalar`) {\n    if (typeof colour === `string` || isOkLch(colour)) {\n      return OkLchSpace.toScalar(colour);\n    }\n  } else if (destination === `oklch-absolute`) {\n    if (typeof colour === `string` || isOkLch(colour)) {\n      return OkLchSpace.toAbsolute(colour);\n    }\n  } else if (destination === `srgb-8bit`) {\n    if (typeof colour === `string` || isRgb(colour)) {\n      return SrgbSpace.to8bit(colour);\n    }\n  } else if (destination === `srgb-scalar`) {\n    if (typeof colour === `string` || isRgb(colour)) {\n      return SrgbSpace.toScalar(colour);\n    }\n  } else {\n    throw new Error(`Destination '${ destination }' not supported for input: ${ JSON.stringify(colour) }`);\n  }\n  return convert(toCssColour(colour), destination);\n}\n\n/**\n * Like {@link convert}, but result is a CSS colour string\n * @param colour \n * @param destination \n * @returns \n */\nexport function convertToString(colour: Colourish, destination: ConvertDestinations): string {\n  const c = convert(colour, destination);\n  return toCssColour(c);\n}\n\nexport function convertScalar<T extends ColourSpaces>(colour: Colourish, destination: T):\n  T extends \"oklch\" ? OkLchScalar :\n  T extends \"hsl\" ? HslScalar :\n  T extends \"srgb\" ? RgbScalar : never\n\nexport function convertScalar(colour: Colourish, destination: ColourSpaces): HslScalar | OkLchScalar | RgbScalar {\n  if (destination === `oklch`) return convert(colour, `oklch-scalar`);\n  if (destination === `srgb`) return convert(colour, `srgb-scalar`);\n  if (destination === `hsl`) return convert(colour, `hsl-scalar`);\n  throw new Error(`Unknown destination: '${ destination }'`);\n}\n\nexport const toCssColour = (colour: Colourish | object): string => {\n  if (typeof colour === `string`) return colour;\n\n  if (isHsl(colour)) {\n    return HslSpace.toCssString(colour);\n  }\n\n  if (isRgb(colour)) {\n    return SrgbSpace.toCssString(colour);\n  }\n\n  if (isOkLch(colour)) {\n    return OklchSpace.toCssString(colour);\n  }\n  const asRgb = tryParseObjectToRgb(colour);\n  if (asRgb) return SrgbSpace.toCssString(asRgb);\n\n  const asHsl = tryParseObjectToHsl(colour);\n  if (asHsl) return HslSpace.toCssString(asHsl);\n\n  throw new Error(`Unknown colour format: '${ JSON.stringify(colour) }'`);\n}\n\nexport const toHexColour = (colour: Colourish | object): string => {\n\n  if (isHsl(colour)) {\n    return HslSpace.toHexString(colour);\n  }\n\n  if (isRgb(colour)) {\n    return SrgbSpace.toHexString(colour);\n  }\n\n  if (isOkLch(colour)) {\n    return OklchSpace.toHexString(colour);\n  }\n\n  if (typeof colour === `string`) {\n    if (colour.startsWith(`#`)) return colour;\n    const c = convert(colour, `srgb-8bit`);\n    return SrgbSpace.toHexString(c);\n  }\n\n  const asRgb = tryParseObjectToRgb(colour);\n  if (asRgb) return SrgbSpace.toHexString(asRgb);\n\n  const asHsl = tryParseObjectToHsl(colour);\n  if (asHsl) return HslSpace.toHexString(asHsl);\n\n  throw new Error(`Unknown colour format: '${ JSON.stringify(colour) }'`);\n}\n\n\n\nexport const toLibraryColour = (colour: Colourish): Colorizr => {\n  const asCss = toCssColour(colour);\n  return new Colorizr(asCss);\n}\n\n// export const convertColourString = (colour: string, destination: 'hex' | 'hsl' | 'oklab' | 'oklch' | 'srgb' | `rgb`): string => {\n//   if (destination === `srgb`) destination = `rgb`;\n//   return C.convert(colour, destination);\n// }\n\nexport const guard = (colour: Colour) => {\n  switch (colour.space) {\n    case `hsl`:\n      HslSpace.guard(colour);\n      break;\n    case `srgb`:\n      SrgbSpace.guard(colour);\n      break;\n    case `oklch`:\n      OkLchSpace.guard(colour);\n      break;\n    default:\n      throw new Error(`Unsupported colour space: '${ colour.space }'`);\n  }\n}\n\nexport const toColour = (colourish: any): Colour => {\n  if (!isColourish(colourish)) throw new Error(`Could not parse input. Expected CSS colour string or structured colour {r,g,b}, {h,s,l} etc. Got: ${ JSON.stringify(colourish) }`);\n  let c: Colour | undefined;\n  if (typeof colourish === `string`) c = fromCssColour(colourish);\n  else c = colourish;\n  if (c === undefined) throw new Error(`Could not parse input. Expected CSS colour string or structured colour {r,g,b}, {h,s,l} etc.`);\n\n  guard(c);\n  return c;\n}\n\n/**\n * Returns a CSS-ready string\n * representation.\n * ```js\n * element.style.backgroundColor = resolveToString(`red`);\n * ```\n * \n * Tries each parameter in turn, returning the value\n * for the first that resolves. This can be useful for\n * having fallback values.\n * \n * ```js\n * // Try a CSS variable, a object property or finally fallback to red.\n * element.style.backgroundColor = toStringFirst('--some-var', opts.background, `red`);\n * ```\n * @param colours Array of colours to resolve\n * @returns \n */\nexport const toStringFirst = (...colours: (Colourish | undefined)[]): string => {\n  for (const colour of colours) {\n    if (colour === undefined) continue;\n    if (colour === null) continue;\n    try {\n      const c = toColour(colour);\n      return toCssColour(c);\n    } catch { /* empty */ }\n  }\n  return `rebeccapurple`;\n}\n\n\nexport function rgbToHsl(rgb: Rgb, scalarResult: true): HslScalar\nexport function rgbToHsl(rgb: Rgb, scalarResult: false): HslAbsolute\nexport function rgbToHsl(rgb: Rgb, scalarResult: boolean): Hsl {\n  // Needed because the Colorizr package has broken RGB to HSL\n  // Converts rgb { model: 'rgb', r: 40, g: 20, b: 60, alpha: undefined }\n  // to : { h: 270, s: 50, l: 0.06 }\n  // when it should be: { h: 270, s: 50, l: 40 }\n\n  // Source: https://www.jameslmilner.com/posts/converting-rgb-hex-hsl-colors/\n  let { r, g, b } = rgb;\n  const opacity = rgb.opacity ?? 1;\n  if (rgb.unit === `8bit`) {\n    r /= 255;\n    g /= 255;\n    b /= 255;\n  }\n\n  const max = Math.max(r, g, b);\n  const min = Math.min(r, g, b);\n\n  let h = (max + min) / 2;\n  let s = h;\n  const l = h;\n\n  if (max === min) {\n    // Achromatic\n    if (scalarResult) {\n      return HslSpace.scalar(0, 0, 0, opacity);\n    } else {\n      return HslSpace.absolute(0, 0, 0, opacity);\n    }\n  }\n\n  const d = max - min;\n  s = l >= 0.5 ? d / (2 - (max + min)) : d / (max + min);\n  switch (max) {\n    case r:\n      h = ((g - b) / d + 0) * 60;\n      break;\n    case g:\n      h = ((b - r) / d + 2) * 60;\n      break;\n    case b:\n      h = ((r - g) / d + 4) * 60;\n      break;\n  }\n\n  if (scalarResult) {\n    return HslSpace.scalar(h / 360, s, l, opacity)\n  } else {\n    return HslSpace.absolute(h, s * 100, l * 100, opacity);\n  }\n}","import type { StrokeOpts } from \"./types.js\";\n\n/**\n * Applies drawing options to given SVG element.\n * Applies: strokeStyle, strokeWidth, strokeDash, strokeLineCap\n * @param elem Element\n * @param opts\n */\nexport const applyStrokeOpts = (elem: SVGElement, opts: StrokeOpts) => {\n  if (opts.strokeStyle) elem.setAttributeNS(null, `stroke`, opts.strokeStyle);\n  if (opts.strokeWidth) {\n    elem.setAttributeNS(null, `stroke-width`, opts.strokeWidth.toString());\n  }\n  if (opts.strokeDash) elem.setAttribute(`stroke-dasharray`, opts.strokeDash);\n  if (opts.strokeLineCap) {\n    elem.setAttribute(`stroke-linecap`, opts.strokeLineCap);\n  }\n};","import { applyOpts } from \"./apply.js\";\nimport { createEl, createOrResolve } from \"./create.js\";\nimport type { DrawingOpts, MarkerOpts } from \"./types.js\";\n\nexport const createMarker = (\n  id: string,\n  opts: MarkerOpts,\n  childCreator?: () => SVGElement\n): SVGMarkerElement => {\n  const m = createEl<SVGMarkerElement>(`marker`, id);\n\n  if (opts.markerWidth) {\n    m.setAttribute(`markerWidth`, opts.markerWidth?.toString());\n  }\n  if (opts.markerHeight) {\n    m.setAttribute(`markerHeight`, opts.markerHeight?.toString());\n  }\n  if (opts.orient) m.setAttribute(`orient`, opts.orient.toString());\n  else m.setAttribute(`orient`, `auto-start-reverse`);\n\n  if (opts.viewBox) m.setAttribute(`viewBox`, opts.viewBox.toString());\n  if (opts.refX) m.setAttribute(`refX`, opts.refX.toString());\n  if (opts.refY) m.setAttribute(`refY`, opts.refY.toString());\n\n  if (childCreator) {\n    const c = childCreator();\n    m.appendChild(c);\n  }\n  return m;\n};\n\nexport const markerPrebuilt = (\n  elem: SVGElement | null,\n  opts: MarkerOpts,\n  _context: DrawingOpts\n): string => {\n  if (elem === null) return `(elem null)`;\n\n  const parent = elem.ownerSVGElement;\n  if (parent === null) throw new Error(`parent for elem is null`);\n  const defsEl = createOrResolve<SVGDefsElement>(parent, `defs`, `defs`);\n\n  //eslint-disable-next-line functional/no-let\n  let defEl = defsEl.querySelector(`#${ opts.id }`) as SVGElement | null;\n\n  if (defEl !== null) {\n    return `url(#${ opts.id })`;\n  }\n\n  if (opts.id === `triangle`) {\n    opts = { ...opts, strokeStyle: `transparent` };\n    if (!opts.markerHeight) opts = { ...opts, markerHeight: 6 };\n    if (!opts.markerWidth) opts = { ...opts, markerWidth: 6 };\n    if (!opts.refX) opts = { ...opts, refX: opts.markerWidth };\n    if (!opts.refY) opts = { ...opts, refY: opts.markerHeight };\n    if (!opts.fillStyle || opts.fillStyle === `none`) {\n      opts = { ...opts, fillStyle: `black` };\n    }\n    if (!opts.viewBox) opts = { ...opts, viewBox: `0 0 10 10` };\n\n    defEl = createMarker(opts.id, opts, () => {\n      const tri = createEl<SVGPathElement>(`path`);\n      tri.setAttribute(`d`, `M 0 0 L 10 5 L 0 10 z`);\n      if (opts) applyOpts(tri, opts);\n      return tri;\n    });\n  } else throw new Error(`Do not know how to make ${ opts.id }`);\n\n  //eslint-disable-next-line functional/immutable-data\n  defEl.id = opts.id;\n  defsEl.appendChild(defEl);\n\n  return `url(#${ opts.id })`;\n};\n","import type { DrawingOpts } from \"../drawing.js\";\nimport { markerPrebuilt } from \"./markers.js\";\nimport type { PathDrawingOpts } from \"./types.js\";\n\n/**\n * Applies path drawing options to given element\n * Applies: markerEnd, markerStart, markerMid\n * @param elem Element (presumed path)\n * @param opts Options\n */\nexport const applyPathOpts = (elem: SVGElement, opts: PathDrawingOpts) => {\n  if (opts.markerEnd) {\n    elem.setAttribute(\n      `marker-end`,\n      markerPrebuilt(elem, opts.markerEnd, opts as DrawingOpts)\n    );\n  }\n  if (opts.markerStart) {\n    elem.setAttribute(\n      `marker-start`,\n      markerPrebuilt(elem, opts.markerStart, opts as DrawingOpts)\n    );\n  }\n  if (opts.markerMid) {\n    elem.setAttribute(\n      `marker-mid`,\n      markerPrebuilt(elem, opts.markerMid, opts as DrawingOpts)\n    );\n  }\n};","\n//import type { CirclePositioned } from '../../geometry/circle/CircleType.js';\n//import type { Point } from '../../geometry/point/PointType.js';\n//import type { Line } from '../../geometry/line/LineType.js';\n//import * as Lines from '../geometry/line/index.js';\nimport { Lines, Polar } from '@ixfx/geometry';\n//import * as Svg from './index.js';\nimport { toStringFirst as ColourStringFirst } from '../colour/conversion.js';\n//import { getCssVariable } from '../colour/index.js';\nimport type { CircleDrawingOpts, LineDrawingOpts, PathDrawingOpts, TextDrawingOpts, TextPathDrawingOpts } from './types.js';\nimport { applyOpts } from './apply.js';\nimport { applyStrokeOpts } from './stroke.js';\nimport { createEl, createOrResolve } from './create.js';\nimport { applyPathOpts } from './path.js';\nimport type { CirclePositioned } from '@ixfx/geometry/circle';\nimport type { Line } from '@ixfx/geometry/line';\nimport type { Point } from '@ixfx/geometry/point';\n//import type { PolarRay } from 'src/geometry/polar/Types.js';\n//import { toCartesian as polarRayToCartesian } from 'src/geometry/polar/Ray.js';\n//import {Palette} from \".\";\n\nconst numberOrPercentage = (v: number): string => {\n  if (v >= 0 && v <= 1) return `${ v * 100 }%`;\n  return v.toString();\n};\n\n/**\n * Creates and adds an SVG path element\n * @example\n * ```js\n * const paths = [\n *  `M300,200`,\n *  `a25,25 -30 0,1 50, -25 l 50,-25`\n * ]\n * const pathEl = path(paths, parentEl);\n * ```\n * @param svgOrArray Path syntax, or array of paths. Can be empty if path data will be added later\n * @param parent SVG parent element\n * @param opts Options Drawing options\n * @returns\n */\nexport const path = (\n  svgOrArray: string | readonly string[],\n  parent: SVGElement,\n  opts?: PathDrawingOpts,\n  queryOrExisting?: string | SVGPathElement\n): SVGPathElement => {\n  const elem = createOrResolve<SVGPathElement>(\n    parent,\n    `path`,\n    queryOrExisting\n  );\n  const svg =\n    typeof svgOrArray === `string` ? svgOrArray : svgOrArray.join(`\\n`);\n\n  elem.setAttributeNS(null, `d`, svg);\n  parent.append(elem);\n  return pathUpdate(elem, opts);\n};\n\nexport const pathUpdate = (\n  elem: SVGPathElement,\n  opts?: PathDrawingOpts\n) => {\n  if (opts) applyOpts(elem, opts);\n  if (opts) applyStrokeOpts(elem, opts);\n  return elem;\n};\n\n/**\n * Updates an existing `SVGCircleElement` with potentially updated circle data and drawing options\n * @param elem Element\n * @param circle Circle\n * @param opts Drawing options\n * @returns SVGCircleElement\n */\nexport const circleUpdate = (\n  elem: SVGCircleElement,\n  circle: CirclePositioned,\n  opts?: CircleDrawingOpts\n) => {\n  elem.setAttributeNS(null, `cx`, circle.x.toString());\n  elem.setAttributeNS(null, `cy`, circle.y.toString());\n  elem.setAttributeNS(null, `r`, circle.radius.toString());\n  if (opts) applyOpts(elem, opts);\n  if (opts) applyStrokeOpts(elem, opts);\n\n  return elem;\n};\n\n/**\n * Creates or reuses a `SVGCircleElement`.\n *\n * To update an existing element, use `circleUpdate`\n * @param circle\n * @param parent\n * @param opts\n * @param queryOrExisting\n * @returns\n */\nexport const circle = (\n  circle: CirclePositioned,\n  parent: SVGElement,\n  opts?: CircleDrawingOpts,\n  queryOrExisting?: string | SVGCircleElement\n): SVGCircleElement => {\n  const p = createOrResolve<SVGCircleElement>(\n    parent,\n    `circle`,\n    queryOrExisting\n  );\n  return circleUpdate(p, circle, opts);\n};\n\n/**\n * Creates or resuses a `SVGGElement` (group)\n *\n * To update an existing elemnet, use `groupUpdate`\n * @param children\n * @param parent\n * @param queryOrExisting\n * @returns\n */\nexport const group = (\n  children: readonly SVGElement[],\n  parent: SVGElement,\n  queryOrExisting?: string | SVGGElement\n): SVGGElement => {\n  const p = createOrResolve<SVGGElement>(parent, `g`, queryOrExisting);\n  return groupUpdate(p, children);\n};\n\nexport const groupUpdate = (\n  elem: SVGGElement,\n  children: readonly SVGElement[]\n) => {\n  for (const c of children) {\n    if (c.parentNode !== elem) {\n      elem.append(c);\n    }\n  }\n\n  return elem;\n};\n\n/**\n * Creates or reuses a SVGLineElement.\n *\n * @param line\n * @param parent\n * @param opts\n * @param queryOrExisting\n * @returns\n */\nexport const line = (\n  line: Line,\n  parent: SVGElement,\n  opts?: LineDrawingOpts,\n  queryOrExisting?: string | SVGLineElement\n): SVGLineElement => {\n  const lineEl = createOrResolve<SVGLineElement>(\n    parent,\n    `line`,\n    queryOrExisting\n  );\n  return lineUpdate(lineEl, line, opts);\n};\n\n/**\n * Updates a SVGLineElement instance with potentially changed line and drawing data\n * @param lineEl\n * @param line\n * @param opts\n * @returns\n */\nexport const lineUpdate = (\n  lineEl: SVGLineElement,\n  line: Line,\n  opts?: LineDrawingOpts\n) => {\n  lineEl.setAttributeNS(null, `x1`, line.a.x.toString());\n  lineEl.setAttributeNS(null, `y1`, line.a.y.toString());\n  lineEl.setAttributeNS(null, `x2`, line.b.x.toString());\n  lineEl.setAttributeNS(null, `y2`, line.b.y.toString());\n  if (opts) applyOpts(lineEl, opts);\n  if (opts) applyPathOpts(lineEl, opts);\n  if (opts) applyStrokeOpts(lineEl, opts);\n  return lineEl;\n};\n\nexport const polarRayUpdate = (lineEl: SVGLineElement, ray: Polar.PolarRay, opts?: LineDrawingOpts) => {\n  const l = Polar.Ray.toCartesian(ray);\n  lineEl.setAttributeNS(null, `x1`, l.a.x.toString());\n  lineEl.setAttributeNS(null, `y1`, l.a.y.toString());\n  lineEl.setAttributeNS(null, `x2`, l.b.x.toString());\n  lineEl.setAttributeNS(null, `y2`, l.b.y.toString());\n  if (opts) applyOpts(lineEl, opts);\n  if (opts) applyPathOpts(lineEl, opts);\n  if (opts) applyStrokeOpts(lineEl, opts);\n  return lineEl;\n}\n\n/**\n * Updates an existing SVGTextPathElement instance with text and drawing options\n * @param el\n * @param text\n * @param opts\n * @returns\n */\nexport const textPathUpdate = (\n  el: SVGTextPathElement,\n  text?: string,\n  opts?: TextPathDrawingOpts\n) => {\n  if (opts?.method) el.setAttributeNS(null, `method`, opts.method);\n  if (opts?.side) el.setAttributeNS(null, `side`, opts.side);\n  if (opts?.spacing) el.setAttributeNS(null, `spacing`, opts.spacing);\n  if (opts?.startOffset) {\n    el.setAttributeNS(null, `startOffset`, numberOrPercentage(opts.startOffset));\n  }\n  if (opts?.textLength) {\n    el.setAttributeNS(null, `textLength`, numberOrPercentage(opts.textLength));\n  }\n\n  if (text) {\n    el.textContent = text;\n  }\n  if (opts) applyOpts(el, opts);\n  if (opts) applyStrokeOpts(el, opts);\n  return el;\n};\n\n/**\n * Creates or reuses a SVGTextPathElement.\n * @param pathReference\n * @param text\n * @param parent\n * @param opts\n * @param textQueryOrExisting\n * @param pathQueryOrExisting\n * @returns\n */\nexport const textPath = (\n  pathReference: string,\n  text: string,\n  parent: SVGElement,\n  opts?: TextPathDrawingOpts,\n  textQueryOrExisting?: string | SVGTextElement,\n  pathQueryOrExisting?: string | SVGTextPathElement\n): SVGTextPathElement => {\n  const textEl = createOrResolve<SVGTextElement>(\n    parent,\n    `text`,\n    textQueryOrExisting, `-text`\n  );\n  // Update text properties, but don't pass in position or text\n  textUpdate(textEl, undefined, undefined, opts);\n\n  const p = createOrResolve<SVGTextPathElement>(\n    textEl,\n    `textPath`,\n    pathQueryOrExisting\n  );\n  p.setAttributeNS(null, `href`, pathReference);\n  return textPathUpdate(p, text, opts);\n};\n\n/**\n * Updates an existing SVGTextElement instance with position, text and drawing options\n * @param el\n * @param pos\n * @param text\n * @param opts\n * @returns\n */\nexport const textUpdate = (\n  el: SVGTextElement,\n  pos?: Point,\n  text?: string,\n  opts?: TextDrawingOpts\n) => {\n  if (pos) {\n    el.setAttributeNS(null, `x`, pos.x.toString());\n    el.setAttributeNS(null, `y`, pos.y.toString());\n  }\n  if (text) {\n    el.textContent = text;\n  }\n\n  if (opts) {\n    applyOpts(el, opts);\n    if (opts) applyStrokeOpts(el, opts);\n\n    if (opts.anchor) el.setAttributeNS(null, `text-anchor`, opts.anchor);\n    if (opts.align) el.setAttributeNS(null, `alignment-baseline`, opts.align);\n\n    const userSelect = opts.userSelect ?? true;\n\n    if (!userSelect) {\n      el.style.userSelect = `none`;\n    }\n  }\n  return el;\n};\n\n/**\n * Creates or reuses a SVGTextElement\n * @param pos Position of text\n * @param text Text\n * @param parent\n * @param opts\n * @param queryOrExisting\n * @returns\n */\nexport const text = (\n  text: string,\n  parent: SVGElement,\n  pos?: Point,\n  opts?: TextDrawingOpts,\n  queryOrExisting?: string | SVGTextElement\n): SVGTextElement => {\n  const p = createOrResolve<SVGTextElement>(\n    parent,\n    `text`,\n    queryOrExisting\n  );\n  return textUpdate(p, pos, text, opts);\n};\n\n/**\n * Creates a square grid based at a center point, with cells having `spacing` height and width.\n *\n * It fits in as many cells as it can within `width` and `height`.\n *\n * Returns a SVG group, consisting of horizontal and vertical lines\n * @param parent Parent element\n * @param center Center point of grid\n * @param spacing Width/height of cells\n * @param width How wide grid should be\n * @param height How high grid should be\n * @param opts\n */\nexport const grid = (\n  parent: SVGElement,\n  center: Point,\n  spacing: number,\n  width: number,\n  height: number,\n  opts: LineDrawingOpts = {}\n) => {\n  if (!opts.strokeStyle) {\n    opts = { ...opts, strokeStyle: ColourStringFirst(`bg-dim`, `silver`) };\n  }\n  if (!opts.strokeWidth) opts = { ...opts, strokeWidth: 1 };\n\n  const g = createEl<SVGGElement>(`g`);\n  applyOpts(g, opts);\n  applyPathOpts(g, opts);\n  applyStrokeOpts(g, opts);\n\n  // Horizontals\n  let y = 0;\n  while (y < height) {\n    const horiz = Lines.fromNumbers(0, y, width, y);\n    line(horiz, g);\n    y += spacing;\n  }\n\n  // Verticals\n  let x = 0;\n  while (x < width) {\n    const vert = Lines.fromNumbers(x, 0, x, height);\n    line(vert, g);\n    x += spacing;\n  }\n  parent.append(g);\n  return g;\n};\n","import { Polar } from \"@ixfx/geometry\";\nimport type { Line } from \"@ixfx/geometry/line\";\nimport type { Point } from \"@ixfx/geometry/point\";\n// import type { Line } from \"../../geometry/line/LineType.js\";\n// import type { Point } from \"../../geometry/point/PointType.js\";\n// import { fromLine as polarRayFromLine } from \"../../geometry/polar/Ray.js\";\n\n/**\n * Returns a Line type from an SVGLineElement\n * @param el SVG Line Element\n * @returns \n */\nexport const lineFromSvgLine = (el: SVGLineElement): Line => {\n  if (!el) throw new Error(`Param 'el' is undefined`);\n  const a = { x: el.x1.baseVal.value, y: el.y1.baseVal.value };\n  const b = { x: el.x2.baseVal.value, y: el.y2.baseVal.value };\n  return { a, b }\n}\n\nexport const polarRayFromSvgLine = (el: SVGLineElement, origin: Point): Polar.PolarRay => {\n  const l = lineFromSvgLine(el);\n  return Polar.Ray.fromLine(l, origin);\n}","/**\n * Removes an SVG element from a parent\n * @param parent Parent\n * @param queryOrExisting Query or existing element \n * @returns \n */\nexport const remove = <V extends SVGElement>(\n  parent: SVGElement,\n  queryOrExisting: string | V\n) => {\n  if (typeof queryOrExisting === `string`) {\n    const elem = parent.querySelector(queryOrExisting);\n    if (elem === null) return;\n    elem.remove();\n  } else {\n    queryOrExisting.remove();\n  }\n};\n\n/**\n * Removes all children of `parent`, but not `parent` itself.\n * @param parent \n */\nexport const clear = (parent: SVGElement) => {\n  let c = parent.lastElementChild;\n  while (c) {\n    c.remove();\n    c = parent.lastElementChild;\n  }\n};","// import { Point } from '@ixfx/geometry';\n// import type { Line } from '../../geometry/line/LineType.js';\n// import type { CirclePositioned } from '../../geometry/circle/CircleType.js';\nimport type { CircleDrawingOpts, DrawingOpts, LineDrawingOpts, PathDrawingOpts, StrokeOpts, TextDrawingOpts } from './types.js';\nimport { applyOpts } from './apply.js';\nimport { applyStrokeOpts } from './stroke.js';\nimport { remove } from './remove.js';\nimport * as Elements from './elements.js';\nimport type { Point } from '@ixfx/geometry/point';\nimport type { CirclePositioned } from '@ixfx/geometry/circle';\nimport type { Line } from '@ixfx/geometry/line';\n\n/**\n * Helper to make SVG elements with a common parent.\n *\n * Create with {@link makeHelper}.\n */\nexport type SvgHelper = {\n  remove(queryOrExisting: string | SVGElement): void;\n  /**\n   * Creates a text element\n   * @param text Text\n   * @param pos Position\n   * @param opts Drawing options\n   * @param queryOrExisting DOM query to look up existing element, or the element instance\n   */\n  text(\n    text: string,\n    pos: Point,\n    opts?: TextDrawingOpts,\n    queryOrExisting?: string | SVGTextElement\n  ): SVGTextElement;\n  /**\n   * Creates text on a path\n   * @param pathReference Reference to path element\n   * @param text Text\n   * @param opts Drawing options\n   * @param textQueryOrExisting DOM query to look up existing element, or the element instance\n   * @param pathQueryOrExisting DOM query to look up existing element, or the element instance\n   */\n  textPath(\n    pathReference: string,\n    text: string,\n    opts?: TextDrawingOpts,\n    textQueryOrExisting?: string | SVGTextElement,\n    pathQueryOrExisting?: string | SVGTextPathElement\n  ): SVGTextPathElement;\n  /**\n   * Creates a line\n   * @param line Line\n   * @param opts Drawing options\n   * @param queryOrExisting DOM query to look up existing element, or the element instance\n   */\n  line(\n    line: Line,\n    opts?: LineDrawingOpts,\n    queryOrExisting?: string | SVGLineElement\n  ): SVGLineElement;\n  /**\n   * Creates a circle\n   * @param circle Circle\n   * @param opts Drawing options\n   * @param queryOrExisting DOM query to look up existing element, or the element instance\n   */\n  circle(\n    circle: CirclePositioned,\n    opts?: CircleDrawingOpts,\n    queryOrExisting?: string | SVGCircleElement\n  ): SVGCircleElement;\n  /**\n   * Creates a path\n   * @param svgString Path description, or empty string\n   * @param opts Drawing options\n   * @param queryOrExisting DOM query to look up existing element, or the element instance\n   */\n  path(\n    svgString: string | readonly string[],\n    opts?: PathDrawingOpts,\n    queryOrExisting?: string | SVGPathElement\n  ): SVGPathElement;\n  /**\n   * Creates a grid of horizontal and vertical lines inside of a group\n   * @param center Grid origin\n   * @param spacing Cell size\n   * @param width Width of grid\n   * @param height Height of grid\n   * @param opts Drawing options\n   */\n  grid(\n    center: Point,\n    spacing: number,\n    width: number,\n    height: number,\n    opts?: LineDrawingOpts\n  ): SVGGElement;\n  /**\n   * Returns an element if it exists in parent\n   * @param selectors Eg `#path`\n   */\n  query<V extends SVGElement>(selectors: string): V | null;\n  /**\n   * Gets/sets the width of the parent\n   */\n  get width(): number;\n  set width(width: number);\n  /**\n   * Gets the parent\n   */\n  get parent(): SVGElement;\n  /**\n   * Gets/sets the height of the parent\n   */\n  get height(): number;\n  set height(height: number);\n  /**\n   * Deletes all child elements\n   */\n  clear(): void;\n};\n\n/**\n * Creates a {@link SvgHelper} for the creating and management of SVG elements.\n * @param parent\n * @param parentOpts\n * @returns\n */\nexport const makeHelper = (\n  parent: SVGElement,\n  parentOpts?: DrawingOpts & StrokeOpts\n): SvgHelper => {\n  if (parentOpts) {\n    applyOpts(parent, parentOpts);\n    applyStrokeOpts(parent, parentOpts);\n  }\n\n  const o: SvgHelper = {\n    remove: (queryOrExisting: string | SVGElement) => { remove(parent, queryOrExisting); },\n    text: (\n      text: string,\n      pos: Point,\n      opts?: TextDrawingOpts,\n      queryOrExisting?: string | SVGTextElement\n    ) => Elements.text(text, parent, pos, opts, queryOrExisting),\n    textPath: (\n      pathReference: string,\n      text: string,\n      opts?: TextDrawingOpts,\n      textQueryOrExisting?: string | SVGTextElement,\n      pathQueryOrExisting?: string | SVGTextPathElement\n    ) => Elements.textPath(pathReference, text, parent, opts, textQueryOrExisting, pathQueryOrExisting),\n    line: (\n      line: Line,\n      opts?: LineDrawingOpts,\n      queryOrExisting?: string | SVGLineElement\n    ) => Elements.line(line, parent, opts, queryOrExisting),\n    circle: (\n      circle: CirclePositioned,\n      opts?: CircleDrawingOpts,\n      queryOrExisting?: string | SVGCircleElement\n    ) => Elements.circle(circle, parent, opts, queryOrExisting),\n    path: (\n      svgString: string | readonly string[],\n      opts?: PathDrawingOpts,\n      queryOrExisting?: string | SVGPathElement\n    ) => Elements.path(svgString, parent, opts, queryOrExisting),\n    grid: (\n      center: Point,\n      spacing: number,\n      width: number,\n      height: number,\n      opts?: LineDrawingOpts\n    ) => Elements.grid(parent, center, spacing, width, height, opts),\n    query: <V extends SVGElement>(selectors: string): V | null =>\n      parent.querySelector(selectors),\n    get width(): number {\n      const w = parent.getAttributeNS(null, `width`);\n      if (w === null) return 0;\n      return Number.parseFloat(w);\n    },\n    set width(width: number) {\n      parent.setAttributeNS(null, `width`, width.toString());\n    },\n    get parent(): SVGElement {\n      return parent;\n    },\n    get height(): number {\n      const w = parent.getAttributeNS(null, `height`);\n      if (w === null) return 0;\n      return Number.parseFloat(w);\n    },\n    set height(height: number) {\n      parent.setAttributeNS(null, `height`, height.toString());\n    },\n    clear: () => {\n      while (parent.firstChild) {\n        (parent.lastChild as HTMLElement).remove();\n      }\n    },\n  };\n  return o;\n};\n","export * from './apply.js'\nexport * from './bounds.js'\nexport * from './create.js'\nexport * as Elements from './elements.js';\nexport * from './geometry.js';\nexport * from './helper.js';\nexport * from './markers.js';\nexport * from './path.js'\nexport * from './remove.js';\nexport * from './stroke.js'\nexport type * from './types.js';\n","\nimport { PointsTracker } from '@ixfx/geometry/point';\nimport * as Svg from './svg/index.js';\nimport { ElementSizer, resolveEl } from '@ixfx/dom';\nexport type Opts = {\n  readonly touchRadius?: number;\n  readonly mouseRadius?: number;\n  readonly trace?: boolean;\n  readonly hue?: number;\n};\n\n/**\n * Visualises pointer events within a given element.\n *\n * ```js\n * // Show pointer events for whole document\n * pointerVis(document);\n * ```\n *\n * Note you may need to set the following CSS properties on the target element:\n *\n * ```css\n * touch-action: none;\n * user-select: none;\n * overscroll-behavior: none;\n * ```\n *\n * Options\n * * touchRadius/mouseRadius: size of circle for these kinds of pointer events\n * * trace: if true, intermediate events are captured and displayed\n * @param elOrQuery Element to monitor\n * @param options Options\n */\nexport const pointerVisualise = (\n  elOrQuery: HTMLElement | string,\n  options: Opts = {}\n) => {\n  const touchRadius = options.touchRadius ?? 45;\n  const mouseRadius = options.touchRadius ?? 20;\n  const trace = options.trace ?? false;\n  const hue = options.hue ?? 100;\n\n  const startFillStyle = `hsla(${ hue }, 100%, 10%, 10%)`;\n  let currentHue = hue;\n\n  const el = resolveEl(elOrQuery);\n  const tracker = new PointsTracker({\n    storeIntermediate: trace,\n  });\n\n\n  const svg = document.createElementNS(\n    `http://www.w3.org/2000/svg`,\n    `svg`\n  ) as any as SVGElement & HTMLElement;\n  svg.id = `pointerVis`;\n  svg.style.zIndex = `-1000`;\n  svg.style.position = `fixed`;\n  svg.style.top = `0`;\n  svg.style.left = `0`;\n  svg.style.width = `100%`;\n  svg.style.height = `100%`;\n  svg.style.boxSizing = `border-box`;\n  svg.style.border = `3px solid red`;\n  svg.style.pointerEvents = `none`;\n  svg.style.touchAction = `none`;\n\n  // const er = new ElementSizer(svg, {\n  //   containerEl:document.body,\n  //   stretch:`both`,\n  //   onSetSize(size) {\n  //     svg.setAttribute(`width`, size.width.toString());\n  //     svg.setAttribute(`height`, size.height.toString());\n  //   },\n  // })\n  const er = ElementSizer.svgViewport(svg);\n  //fullSizeElement(svg);\n  let pointerCount = 0;\n\n  const lostPointer = (event: PointerEvent) => {\n    const id = event.pointerId.toString();\n\n    tracker.delete(id);\n    currentHue = hue;\n    svg.querySelector(`#pv-start-${ id }`)?.remove();\n\n    for (let index = 0; index < pointerCount + 10; index++) {\n      svg.querySelector(`#pv-progress-${ id }-${ index }`)?.remove();\n    }\n    pointerCount = 0;\n  };\n\n  const trackPointer = async (event: PointerEvent) => {\n    const id = event.pointerId.toString();\n    const pt = { x: event.x, y: event.y };\n    const type = event.pointerType;\n    if (event.type === `pointermove` && !tracker.has(id)) {\n      return;\n    }\n    const info = (await tracker.seen(event.pointerId.toString(), { x: event.clientX, y: event.clientY }));\n\n    if (info.values.length === 1) {\n      const el = Svg.Elements.circle(\n        {\n          ...info.values[ 0 ],\n          radius: type === `touch` ? touchRadius : mouseRadius,\n        },\n        svg,\n        {\n          fillStyle: startFillStyle,\n        },\n        `#pv-start-${ id }`\n      );\n      el.style.pointerEvents = `none`;\n      el.style.touchAction = `none`;\n    }\n\n    const fillStyle = `hsla(${ currentHue }, 100%, 50%, 50%)`;\n\n    const el2 = Svg.Elements.circle(\n      { ...pt, radius: type === `touch` ? touchRadius : mouseRadius },\n      svg,\n      {\n        fillStyle,\n      },\n      `#pv-progress-${ id }-${ info.values.length }`\n    );\n    el2.style.pointerEvents = `none`;\n    el2.style.touchAction = `none`;\n    currentHue += 1;\n    pointerCount = info.values.length;\n  };\n\n  document.body.append(svg);\n\n\n  el.addEventListener(`pointerdown`, trackPointer);\n\n  el.addEventListener(`pointermove`, trackPointer);\n  el.addEventListener(`pointerup`, lostPointer);\n  el.addEventListener(`pointerleave`, lostPointer);\n  el.addEventListener(`contextmenu`, (event) => {\n    event.preventDefault();\n  });\n};\n","import * as ImageDataGrid from './image-data-grid.js';\nimport { Grids } from '@ixfx/geometry';\nimport type { Rgb8Bit } from './colour/types.js';\n\nexport type Kernel<T> = readonly (readonly T[])[];\n//export type CellWithValue<V> = readonly [ cell: Grids.Cell, value: V | undefined ];\nexport type CellValueScalar<TCell, TKernel> = Grids.GridCellAndValue<TCell> & { kernel: TKernel };\n\nexport type KernelCompute = <V>(offset: Grids.GridCell, value: V) => V;\nexport type KernelReduce<TCell, TKernel> = (values: CellValueScalar<TCell, TKernel>[]) => TCell | undefined;\n\n/**\n * Multiply every element of kernel by the same `scalar` value.\n * Returns new result, input is unmodified\n * @param kernel \n * @param scalar \n * @returns \n */\nexport const multiply = (kernel: Kernel<number>, scalar: number): Kernel<number> => {\n  const rows = kernel.length;\n  const cols = kernel[ 0 ].length;\n  const copy: number[][] = [];\n  for (let row = 0; row < rows; row++) {\n    copy[ row ] = [];\n    for (let col = 0; col < cols; col++) {\n      copy[ row ][ col ] = kernel[ row ][ col ] * scalar;\n    }\n  }\n  return copy;\n};\n\n\nexport function convolveCell<TCell, TKernel>(cell: Grids.GridCell, kernel: Kernel2dArray<TKernel>, source: Grids.GridReadable<TCell>, reduce: KernelReduce<TCell, TKernel>): TCell | undefined {\n  const valuesAtKernelPos: CellValueScalar<TCell, TKernel>[] = kernel.map(o => {\n    // For a kernel cell vector, get the position in the source grid\n    const pos = Grids.offset(source, cell, o.cell, `stop`); // `stop` avoids fringing at extents of image\n\n    // If there's no cell, return undefined\n    let kernelValue: TKernel | undefined;\n    let sourceValue: TCell | undefined;\n\n    if (pos) {\n      sourceValue = source.get(pos, `undefined`);\n      kernelValue = o.value;\n    }\n    //if (!pos) return { cell: o.cell, value: undefined, scalar: NaN } as CellValueScalar<T>;\n    return { cell: o.cell, value: sourceValue, kernel: o.value } as CellValueScalar<TCell, TKernel>;\n  });\n  return reduce(valuesAtKernelPos);\n}\n\n/**\n * Performs kernel-based convolution over `image`.\n * @param kernel \n * @param image \n */\nexport function* convolveImage(kernel: Kernel<number>, image: ImageData) {\n  //const grid = { rows: image.width, cols: image.height };\n  const imageDataAsGrid = ImageDataGrid.wrap(image);\n  yield* convolve(kernel, imageDataAsGrid, Grids.By.cells(imageDataAsGrid), rgbReducer);\n}\n\nexport function* convolve<TCell, TKernel>(kernel: Kernel<TKernel>, source: Grids.GridReadable<TCell>, visitor: Iterable<Grids.GridCell>, reduce: KernelReduce<TCell, TKernel>, origin?: Grids.GridCell): IterableIterator<Grids.GridCellAndValue<TCell>> {\n  if (!origin) {\n    const kernelRows = kernel.length;\n    const kernelCols = kernel[ 0 ].length;\n    origin = { x: Math.floor(kernelRows / 2), y: Math.floor(kernelCols / 2) };\n  }\n\n  const asArray = kernel2dToArray(kernel, origin);\n  // for (const c of visitor) {\n  //   const v = convolveCell<V>(c, asArray, source, access, reduce);\n  //   yield [ c, v ];\n  // }\n  for (const cell of visitor) {\n    const value = convolveCell<TCell, TKernel>(cell, asArray, source, reduce);\n    yield { cell, value };\n  }\n}\n\nexport type Kernel2dArray<T> = Grids.GridCellAndValue<T>[];\n\n/**\n * For a given kernel, returns an array of offsets. These\n * consist of a cell offset (eg `{x:-1,y:-1}`) and the value at that kernel position.\n * @param kernel \n * @param origin \n * @returns \n */\nexport const kernel2dToArray = <T>(kernel: Kernel<T>, origin?: Grids.GridCell): Kernel2dArray<T> => {\n  const offsets: Kernel2dArray<T> = [];\n  const rows = kernel.length;\n  const cols = kernel[ 0 ].length;\n  if (!origin) {\n    origin = {\n      x: Math.floor(rows / 2),\n      y: Math.floor(cols / 2)\n    };\n  }\n\n  for (let xx = 0; xx < rows; xx++) {\n    for (let yy = 0; yy < cols; yy++) {\n      const v: Grids.GridCellAndValue<T> = {\n        cell: { x: xx - origin.x, y: yy - origin.y },\n        value: kernel[ xx ][ yy ]\n      }\n      offsets.push(v);\n      //offsets.push([ { x: xx - origin.x, y: yy - origin.y }, kernel[ xx ][ yy ] ]);\n    }\n  }\n  return offsets;\n};\n\nexport const rgbReducer: KernelReduce<Rgb8Bit, number> = (values: CellValueScalar<Rgb8Bit, number>[]) => {\n  let r = 0;\n  let g = 0;\n  let b = 0;\n  let opacity = 0;\n  for (const value of values) {\n    const rgb = value.value;\n    const kernelValue = value.kernel;\n    if (!rgb) continue;\n    if (rgb.opacity === 0) continue;\n    if (kernelValue === 0) continue;\n    r += (rgb.r * kernelValue);\n    g += (rgb.g * kernelValue);\n    b += (rgb.b * kernelValue);\n    opacity += ((rgb.opacity ?? 1) * kernelValue);\n  }\n\n  const result: Rgb8Bit = {\n    r, g, b,\n    unit: `8bit`,\n    space: `srgb`,\n    opacity\n  };\n  return result;\n};\nexport const identityKernel = [\n  [ 0, 0, 0 ],\n  [ 0, 1, 0 ],\n  [ 0, 0, 0 ]\n];\n\nexport const edgeDetectionKernel = [\n  [ 0, -1, 0 ],\n  [ -1, 4, -1 ],\n  [ 0, -1, 0 ]\n];\n\nexport const sharpenKernel = [\n  [ 0, -1, 0 ],\n  [ -1, 5, -1 ],\n  [ 0, -1, 0 ]\n];\n\nexport const boxBlurKernel = multiply([\n  [ 1, 1, 1 ],\n  [ 1, 1, 1 ],\n  [ 1, 1, 1 ]\n], 1 / 9);\n\nexport const gaussianBlur3Kernel = multiply([\n  [ 1, 2, 1 ],\n  [ 2, 4, 2 ],\n  [ 1, 2, 1 ]\n], 1 / 16);\n\nexport const gaussianBlur5Kernel = multiply([\n  [ 1, 4, 6, 4, 1 ],\n  [ 4, 16, 24, 16, 4 ],\n  [ 6, 24, 36, 24, 6 ],\n  [ 4, 16, 24, 16, 4 ],\n  [ 1, 4, 6, 4, 1 ],\n], 1 / 256);\n\nexport const unsharpMasking5Kernel = multiply([\n  [ 1, 4, 6, 4, 1 ],\n  [ 4, 16, 24, 16, 4 ],\n  [ 6, 24, -476, 24, 6 ],\n  [ 4, 16, 24, 16, 4 ],\n  [ 1, 4, 6, 4, 1 ],\n], -1 / 256);","/**\n * Manage a set of named colours. Uses CSS variables as a fallback if colour is not added\n *\n */\nexport type NamedColourPalette = {\n  setElementBase(el: Element): void;\n  has(key: string): boolean;\n\n  /**\n   * Returns a colour by name.\n   *\n   * If the colour is not found:\n   *  1. Try to use a CSS variable `--key`, or\n   *  2. The next fallback colour is used (array cycles)\n   *\n   * @param key\n   * @param fallback\n   * @returns\n   */\n  get(key: string, fallback?: string): string;\n\n  /**\n   * Gets a colour by key, adding and returning fallback if not present\n   * @param key Key of colour\n   * @param fallback Fallback colour if key is not found\n   */\n  getOrAdd(key: string, fallback?: string): string;\n\n  /**\n   * Adds a colour with a given key\n   *\n   * @param key\n   * @param value\n   */\n  add(key: string, value: string): void;\n\n  alias(from: string, to: string): void;\n};\n\nexport const create = (fallbacks?: ReadonlyArray<string>): NamedColourPalette =>\n  new NamedColourPaletteImpl(fallbacks);\n\nclass NamedColourPaletteImpl {\n  readonly #store: Map<string, string> = new Map();\n  readonly #aliases: Map<string, string> = new Map();\n\n  readonly fallbacks: ReadonlyArray<string>;\n  #lastFallback = 0;\n\n  #elementBase: Element;\n\n  constructor(fallbacks?: ReadonlyArray<string>) {\n    if (fallbacks !== undefined) this.fallbacks = fallbacks;\n    else this.fallbacks = [ `red`, `blue`, `green`, `orange` ];\n    this.#elementBase = document.body;\n  }\n\n  setElementBase(el: Element) {\n    this.#elementBase = el;\n  }\n\n  add(key: string, colour: string) {\n    this.#store.set(key, colour);\n  }\n\n  alias(from: string, to: string) {\n    this.#aliases.set(from, to);\n  }\n\n  get(key: string, fallback?: string): string {\n    const alias = this.#aliases.get(key);\n    if (alias !== undefined) key = alias;\n\n    const c = this.#store.get(key);\n    if (c !== undefined) return c;\n\n    const variableName = `--` + key;\n    let fromCss = getComputedStyle(this.#elementBase)\n      .getPropertyValue(variableName)\n      .trim();\n\n    // Not found\n    if (fromCss === undefined || fromCss.length === 0) {\n      if (fallback !== undefined) return fallback;\n      fromCss = this.fallbacks[ this.#lastFallback ];\n      this.#lastFallback++;\n      if (this.#lastFallback === this.fallbacks.length) this.#lastFallback = 0;\n    }\n    return fromCss;\n  }\n\n  getOrAdd(key: string, fallback?: string): string {\n    if (this.has(key)) return this.get(key);\n    const c = this.get(key, fallback);\n    this.add(key, c);\n    return c;\n  }\n\n  has(key: string): boolean {\n    return this.#store.has(key);\n  }\n}\n","import { continuously } from '@ixfx/core';\nimport { delayLoop } from '@ixfx/flow';\n\nexport type Capturer = {\n  start(): void;\n  cancel(): void;\n  readonly canvasEl: HTMLCanvasElement;\n};\n\nexport type ManualCapturer = {\n  capture(): ImageData;\n  readonly canvasEl: HTMLCanvasElement;\n  dispose(): void;\n};\n\nexport type CaptureOpts = {\n  /**\n   * Delay between reading frames.\n   * Default: 0, reading as fast as possible\n   */\n  readonly maxIntervalMs?: number;\n  /**\n   * Whether to show the created capture canvas.\n   * Default: false\n   */\n  readonly showCanvas?: boolean;\n  readonly workerScript?: string;\n  readonly onFrame?: (pixels: ImageData) => void;\n};\n\nexport type ManualCaptureOpts = {\n  /**\n   * If true, the intermediate canvas is shown\n   * The intermediate canvas is where captures from the source are put in order\n   * to get the ImageData\n   */\n  readonly showCanvas?: boolean;\n  /**\n   * If specified, this function will be called after ImageData is captured\n   * from the intermediate canvs. This allows for drawing on top of the\n   * captured image.\n   */\n  readonly postCaptureDraw?: (\n    ctx: CanvasRenderingContext2D,\n    width: number,\n    height: number\n  ) => void;\n\n  /**\n   * If specified, this is the canvas captured to\n   */\n  readonly canvasEl?: HTMLCanvasElement;\n};\n\n/**\n * Options for frames generator\n */\nexport type FramesOpts = {\n  /**\n   * Max frame rate (millis per frame), or 0 for animation speed\n   */\n  readonly maxIntervalMs?: number;\n  /**\n   * False by default, created canvas will be hidden\n   */\n  readonly showCanvas?: boolean;\n  /**\n   * If provided, this canvas will be used as the buffer rather than creating one.\n   */\n  readonly canvasEl?: HTMLCanvasElement;\n};\n\n/**\n * Generator that yields frames from a video element as [ImageData](https://developer.mozilla.org/en-US/docs/Web/API/ImageData).\n *\n * ```js\n * import { Video } from '@ixfx/visual.js'\n *\n * const ctx = canvasEl.getContext(`2d`);\n * for await (const frame of Video.frames(videoEl)) {\n *   // TODO: Some processing of pixels\n *\n *   // Draw image on to the visible canvas\n *   ctx.putImageData(frame, 0, 0);\n * }\n * ```\n *\n * Under the hood it creates a hidden canvas where frames are drawn to. This is necessary\n * to read back pixel data. An existing canvas can be used if it is passed in as an option.\n *\n * Options:\n * * `canvasEl`: CANVAS element to use as a buffer (optional)\n * * `maxIntervalMs`: Max frame rate (0 by default, ie runs as fast as possible)\n * * `showCanvas`: Whether buffer canvas will be shown (false by default)\n * @param sourceVideoEl\n * @param opts\n */\n\nexport async function* frames(\n  sourceVideoEl: HTMLVideoElement,\n  opts: FramesOpts = {}\n): AsyncIterable<ImageData> {\n  // TODO: Ideally use OffscreenCanvas when it has wider support?\n  // TODO: When ImageBitmap has possibility to get pixels, that might also help to avoid having to write to hidden canvas\n\n  const maxIntervalMs = opts.maxIntervalMs ?? 0;\n\n  const showCanvas = opts.showCanvas ?? false;\n  let canvasEl = opts.canvasEl;\n  let w, h;\n  w = h = 0;\n\n  // Create & setup canvas\n  if (canvasEl === undefined) {\n    canvasEl = document.createElement(`CANVAS`) as HTMLCanvasElement;\n    canvasEl.classList.add(`ixfx-frames`);\n    if (!showCanvas) {\n      canvasEl.style.display = `none`;\n    }\n    document.body.appendChild(canvasEl);\n  }\n\n  // Update size of canvas based on video\n  const updateSize = () => {\n    if (canvasEl === undefined) return;\n    w = sourceVideoEl.videoWidth;\n    h = sourceVideoEl.videoHeight;\n    canvasEl.width = w;\n    canvasEl.height = h;\n  };\n\n  let c: CanvasRenderingContext2D | null = null;\n\n  const looper = delayLoop(maxIntervalMs);\n  for await (const _ of looper) {\n    // If we don't yet have the size of video, get it\n    if (w === 0 || h === 0) updateSize();\n\n    // If there is still no dimensions (ie stream has not started), there's nothing to do yet\n    if (w === 0 || h === 0) continue;\n\n    // Draw current frame from video element to hidden canvas\n    c ??= canvasEl.getContext(`2d`);\n    if (c === null) return;\n    c.drawImage(sourceVideoEl, 0, 0, w, h);\n\n    // Get pixels\n    const pixels = c.getImageData(0, 0, w, h);\n    yield pixels;\n  }\n}\n\n/**\n * Captures frames from a video element. It can send pixel data to a function or post to a worker script.\n *\n * @example Using a function\n * ```js\n * // Capture from a VIDEO element, handling frame data\n * // imageData is ImageData type: https://developer.mozilla.org/en-US/docs/Web/API/ImageData\n * Video.capture(sourceVideoEl, {\n *  onFrame(imageData => {\n *    // Do something with pixels...\n *  });\n * });\n * ```\n *\n * @example Using a worker\n * ```js\n * Video.capture(sourceVideoEl, {\n *  workerScript: `./frameProcessor.js`\n * });\n * ```\n *\n * In frameProcessor.js:\n * ```\n * const process = (frame) => {\n *  // ...process frame\n *\n *  // Send image back?\n *  self.postMessage({frame});\n * };\n *\n * self.addEventListener(`message`, evt => {\n *   const {pixels, width, height} = evt.data;\n *   const frame = new ImageData(new Uint8ClampedArray(pixels),\n *     width, height);\n *\n *   // Process it\n *   process(frame);\n * });\n * ```\n *\n * Options:\n * * `canvasEl`: CANVAS element to use as a buffer (optional)\n * * `maxIntervalMs`: Max frame rate (0 by default, ie runs as fast as possible)\n * * `showCanvas`: Whether buffer canvas will be shown (false by default)\n * * `workerScript`: If this specified, this URL will be loaded as a Worker, and frame data will be automatically posted to it\n *\n * Implementation: frames are captured using a animation-speed loop to a hidden canvas. From there\n * the pixel data is extracted and sent to either destination. In future the intermediate drawing to a\n * canvas could be skipped if it becomes possible to get pixel data from an ImageBitmap.\n * @param sourceVideoEl Source VIDEO element\n * @param opts\n * @returns\n */\nexport const capture = (\n  sourceVideoEl: HTMLVideoElement,\n  opts: CaptureOpts = {}\n): Capturer => {\n  const maxIntervalMs = opts.maxIntervalMs ?? 0;\n  const showCanvas = opts.showCanvas ?? false;\n  const onFrame = opts.onFrame;\n\n  // Ideally use OffscreenCanvas when it has support?\n  const w = sourceVideoEl.videoWidth;\n  const h = sourceVideoEl.videoHeight;\n\n  // Create canvas\n  const canvasEl = document.createElement(`CANVAS`) as HTMLCanvasElement;\n  canvasEl.classList.add(`ixfx-capture`);\n\n  if (!showCanvas) {\n    canvasEl.style.display = `none`;\n  }\n  canvasEl.width = w;\n  canvasEl.height = h;\n  let c: CanvasRenderingContext2D | null = null;\n  let worker: Worker | undefined;\n  if (opts.workerScript) {\n    worker = new Worker(opts.workerScript);\n  }\n\n  // Should we get image data?\n  const getPixels = worker || onFrame;\n  if (!getPixels && !showCanvas) {\n    console.warn(\n      `Video will be captured to hidden element without any processing. Is this what you want?`\n    );\n  }\n\n  const loop = continuously(() => {\n    // Draw current frame from video element to hidden canvas\n    if (c === null) c = canvasEl.getContext(`2d`);\n    if (c === null) return;\n    c.drawImage(sourceVideoEl, 0, 0, w, h);\n    let pixels: ImageData | undefined;\n\n    if (getPixels) {\n      // ImageData necessary\n      pixels = c.getImageData(0, 0, w, h);\n    }\n\n    if (worker) {\n      // Send to worker\n      worker.postMessage(\n        {\n          pixels: pixels!.data.buffer,\n          width: w,\n          height: h,\n          channels: 4,\n        },\n        [ pixels!.data.buffer ]\n      );\n    }\n    if (onFrame) {\n      // Send to callback\n      try {\n        onFrame(pixels!);\n      } catch (e) {\n        console.error(e);\n      }\n    }\n  }, maxIntervalMs);\n\n  return {\n    start: () => { loop.start(); },\n    cancel: () => { loop.cancel(); },\n    canvasEl,\n  };\n};\n\nexport const manualCapture = (\n  sourceVideoEl: HTMLVideoElement,\n  opts: ManualCaptureOpts = {}\n): ManualCapturer => {\n  const showCanvas = opts.showCanvas ?? false;\n\n  // Ideally use OffscreenCanvas when it has support?\n  const w = sourceVideoEl.videoWidth;\n  const h = sourceVideoEl.videoHeight;\n\n  // Create canvas if necessary\n  const definedCanvasEl = opts.canvasEl !== undefined;\n  let canvasEl = opts.canvasEl;\n  if (!canvasEl) {\n    canvasEl = document.createElement(`CANVAS`) as HTMLCanvasElement;\n    canvasEl.classList.add(`ixfx-capture`);\n    document.body.append(canvasEl);\n    if (!showCanvas) canvasEl.style.display = `none`;\n  }\n\n  canvasEl.width = w;\n  canvasEl.height = h;\n\n  const capture = (): ImageData => {\n    let c: CanvasRenderingContext2D | undefined | null;\n\n    // Draw current frame from video element to canvas\n    if (!c) c = canvasEl.getContext(`2d`, { willReadFrequently: true });\n    if (!c) throw new Error(`Could not create graphics context`);\n    c.drawImage(sourceVideoEl, 0, 0, w, h);\n\n    const pixels = c.getImageData(0, 0, w, h);\n\n    (pixels as any).currentTime = sourceVideoEl.currentTime;\n\n    if (opts.postCaptureDraw) opts.postCaptureDraw(c, w, h);\n    return pixels;\n  };\n\n  const dispose = (): void => {\n    if (definedCanvasEl) return; // we didn't create it\n    try {\n      canvasEl.remove();\n    } catch (_) {\n      // no-op\n    }\n  };\n\n  const c: ManualCapturer = {\n    canvasEl,\n    capture,\n    dispose,\n  };\n  return c;\n};\n","import * as Drawing from \"../drawing.js\";\nimport { Bipolar } from \"@ixfx/numbers\";\nimport { type IQueueImmutable, QueueImmutable } from \"@ixfx/collections/queue\";\nimport * as Colour from \"../colour/index.js\";\nimport { type CirclePositioned } from \"@ixfx/geometry/circle\";\n\n/**\n * Options\n */\nexport type BipolarViewOptions = Readonly<{\n  width?: number,\n  height?: number,\n  labelPrecision?: number\n  labels?: [ string, string ],\n  axisColour?: string,\n  bgColour?: string,\n  whiskerColour?: string,\n  whiskerSize?: number,\n  dotColour?: string,\n  dotRadius?: number,\n  showWhiskers?: boolean,\n  showDot?: boolean,\n  showLabels?: boolean,\n  padding?: number,\n  labelColour?: string,\n  axisWidth?: number,\n  asPercentages?: boolean,\n  /**\n   * If non-zero, will render the last X number of values with increasing opacity.\n   * Default: 0\n   */\n  displayLastValues?: number\n  /**\n   * If _true_, (default) negative y values are at the bottom.\n   * If _false_  negative y values are at the top.\n   */\n  yAxisBottomNegative?: boolean,\n  /**\n   * Custom rendering for background\n   */\n  renderBackground?: Render\n}>\n\nfunction getNumericAttribute(el: HTMLElement, name: string, defaultValue: number) {\n  const a = el.getAttribute(name);\n  if (a === null) return defaultValue;\n  return Number.parseInt(a);\n}\n\nexport type Render = (ctx: CanvasRenderingContext2D, width: number, height: number) => void;\n/**\n * A function that plots a point on the graph\n */\nexport type BipolarView = (x: number, y: number) => void;\n\n/**\n * Initialises a plotter for bipolar values (-1...1)\n * \n * ```js\n * const p = BipolarView.init(`#my-canvas`);\n * // Shows the dot at 1, 0.5\n * p(1, 0.5);\n * ```\n * @param elementQuery \n * @param options \n * @returns \n */\nexport const init = (elementQuery: string, options: BipolarViewOptions = {}): BipolarView => {\n  const element = document.querySelector<HTMLCanvasElement>(elementQuery);\n  if (!element) throw new Error(`Element query could not be found (${ elementQuery })`);\n  const labels = options.labels ?? [ `x`, `y` ];\n  const labelPrecision = options.labelPrecision ?? 2;\n  const asPercentages = options.asPercentages ?? false;\n  const displayLastValues = options.displayLastValues ?? 0;\n  // Flags\n  const showWhiskers = options.showWhiskers ?? true;\n  const showDot = options.showDot ?? true;\n  const showLabels = options.showLabels ?? true;\n  const yAxisBottomNegative = options.yAxisBottomNegative ?? true;\n  // Colours\n  const axisColour = Colour.toStringFirst(options.axisColour, `silver`);\n  const bgColour = Colour.toStringFirst(options.bgColour, `white`);\n  const whiskerColour = Colour.toStringFirst(options.whiskerColour, `black`);\n  const dotColour = Colour.toStringFirst(options.dotColour, options.whiskerColour, `black`);\n  const labelColour = Colour.toStringFirst(options.labelColour, options.axisColour, `silver`);\n\n  // Sizes\n  const axisWidth = (options.axisWidth ?? 1 * window.devicePixelRatio);\n  const dotRadius = (options.dotRadius ?? 5 * window.devicePixelRatio);\n  const pad = (options.padding ?? 10 * window.devicePixelRatio);\n  const whiskerSize = (options.whiskerSize ?? 5 * window.devicePixelRatio);\n  const width = (options.width ?? getNumericAttribute(element, `width`, 200) * window.devicePixelRatio);\n  const height = (options.height ?? getNumericAttribute(element, `height`, 200) * window.devicePixelRatio);\n\n  let lastValues: IQueueImmutable<CirclePositioned> | undefined;\n  if (displayLastValues > 0) {\n    lastValues = new QueueImmutable<CirclePositioned>({\n      capacity: displayLastValues,\n      discardPolicy: `older`\n    });\n  }\n\n  element.width = width;// * window.devicePixelRatio;\n  element.height = height;// * window.devicePixelRatio;\n  element.style.width = `${ (width / window.devicePixelRatio) }px`;\n  element.style.height = `${ (height / window.devicePixelRatio) }px`;\n\n  const midY = height / 2;\n  const midX = width / 2;\n  const ctx = element.getContext(`2d`);\n  if (!ctx) throw new Error(`Could not create drawing context`);\n\n  if (window.devicePixelRatio >= 2) {\n    ctx.font = `20px sans-serif`;\n  }\n  const percentageFormat = (v: number) => `${ Math.round(v * 100) }%`;\n  const fixedFormat = (v: number) => v.toFixed(labelPrecision);\n\n  const valueFormat = asPercentages ? percentageFormat : fixedFormat;\n  if (showLabels) {\n    labels[ 0 ] = labels[ 0 ] + `:`;\n    labels[ 1 ] = labels[ 1 ] + `:`;\n  } else {\n    labels[ 0 ] = ``;\n    labels[ 1 ] = ``;\n  }\n\n  const renderBackground: Render = options.renderBackground ?? ((ctx, width, height): void => {\n    if (options.bgColour === `transparent`) {\n      ctx.clearRect(0, 0, width, height);\n    } else {\n      ctx.fillStyle = bgColour;\n      ctx.fillRect(0, 0, width, height);\n    }\n  });\n\n  return (x: number, y: number) => {\n    x = Bipolar.clamp(x);\n    y = Bipolar.clamp(y);\n\n    renderBackground(ctx, width, height);\n\n    // Labels\n    ctx.fillStyle = labelColour;\n    ctx.textBaseline = `top`;\n    ctx.save();\n    ctx.translate(midX, midY);\n    ctx.rotate(-Math.PI / 2);\n    ctx.fillText((labels[ 1 ] + ` ` + valueFormat(y)).trim(), -midX + pad, 1);\n    ctx.restore();\n    ctx.fillText((labels[ 0 ] + ` ` + valueFormat(x)).trim(), pad, midX + 2);\n\n    if (!yAxisBottomNegative) y *= -1;\n\n    // Axes\n    ctx.strokeStyle = axisColour;\n    ctx.lineWidth = axisWidth;\n    ctx.beginPath();\n    ctx.moveTo(pad, midY);\n    ctx.lineTo(width - pad, midY);\n    ctx.moveTo(midX, pad);\n    ctx.lineTo(midX, height - pad);\n    ctx.stroke();\n    ctx.closePath();\n\n    const yy = (height - pad - pad) / 2 * -y;\n    const xx = (width - pad - pad) / 2 * x;\n    const dotPos = { x: xx, y: yy, radius: dotRadius };\n\n    if (lastValues) {\n      lastValues = lastValues.enqueue(dotPos);\n    }\n    ctx.save();\n    ctx.translate(midX, midY);\n\n    // Dot\n    if (showDot) {\n      if (lastValues) {\n        const opacityStep = 1 / lastValues.length;\n        let opacity = 1;\n        lastValues.forEach(d => {\n          const colour = Colour.multiplyOpacity(dotColour, opacity);\n          Drawing.circle(ctx, d, { fillStyle: colour });\n          opacity -= opacityStep;\n        });\n      } else {\n        Drawing.circle(ctx, dotPos, { fillStyle: dotColour });\n      }\n    }\n\n    // Whiskers\n    if (showWhiskers) {\n      ctx.strokeStyle = whiskerColour;\n\n      // y line\n      ctx.beginPath();\n      ctx.moveTo(0, yy - whiskerSize);\n      ctx.lineTo(0, yy + whiskerSize);\n\n      // x line\n      ctx.moveTo(xx - whiskerSize, 0);\n      ctx.lineTo(xx + whiskerSize, 0);\n      ctx.stroke();\n      ctx.closePath();\n    }\n\n    // Restore transform\n    ctx.restore();\n  }\n}\n","\nimport { scaler } from \"@ixfx/numbers\";\nimport type { GridStyle, LineStyle, ShowOptions, TextStyle } from \"./types.js\";\nimport type { Point } from \"@ixfx/geometry/point\";\n\nexport type PointMinMax = { min: Point, max: Point, width: number, height: number, minDim: number, maxDim: number };\n\nexport type PlotPoint = Point & {\n  fillStyle?: string\n  radius?: number\n}\n\nexport type CartesianScaler = (pt: Point) => Point;\n\nexport type CartesianDataRange = {\n  /**\n   * Converts a data value to relative value (0..1)\n   */\n  absDataToRelative: CartesianScaler\n  /**\n   * Converts a relative value to element-based coordinates\n   * (ie 0,0 is top-left of CANVAS)\n   */\n  relDataToCanvas: CartesianScaler\n  canvasToRelData: CartesianScaler\n  /**\n   * Converts canvas coordinate to relative\n   */\n  regionSpaceToRelative: CartesianScaler,\n  /**\n   * Converts relative coordinate to value\n   */\n  relDataToAbs: CartesianScaler\n  range: PointMinMax\n}\n\n\nexport type CartesianPlotOptions = {\n  clear: `region` | `canvas`\n  onInvalidated: () => void\n  /**\n * Margin around whole plot area. Use\n * to avoid dots being cut off by edge of canvas\n */\n  visualPadding: number\n  // canvasWidth: number\n  // canvasHeight: number\n  // canvasResize: ElementResizeLogic\n  // coordinateScale: ScaleBy\n  show: Partial<ShowOptions>\n  /**\n   * If 'auto' (default), range of plot is based on data.\n   * Otherwise specify the range, eg:\n   * `{ min: {x:-1,y:-1}, {x:1,y:1}}`\n   * \n   */\n  range: `auto` | { min: Point, max: Point }\n\n  /**\n   * Gridline setting\n   */\n  grid: Partial<GridStyle>\n  /**\n   * Drawing settings for axis (if 'showAxes' is enabled)\n   */\n  axisStyle: LineStyle\n  /**\n   * How values are drawn. Default: 'dot'\n   */\n  valueStyle: `dot` | ``,\n  /**\n   * How values are connected. Default: '' (no connecting)\n   * Values are connected in order of dataset.\n   */\n  connectStyle: `` | `line`,\n  textStyle: TextStyle\n  whiskerLength: number\n}\n\nexport const computeMinMax = (mm: Point[]): PointMinMax => {\n  const x = mm.map(m => m.x);\n  const y = mm.map(m => m.y);\n  const minX = Math.min(...x);\n  const maxX = Math.max(...x);\n  const minY = Math.min(...y);\n  const maxY = Math.max(...y);\n  const width = maxX - minX;\n  const height = maxY - minY;\n\n  return {\n    min: { x: minX, y: minY },\n    max: { x: maxX, y: maxY },\n    width, height,\n    minDim: Math.min(width, height),\n    maxDim: Math.max(width, height)\n  }\n}\n\nexport const relativeCompute = (minMax: PointMinMax) => {\n  if (!Number.isFinite(minMax.height)) {\n    return (point: Point) => point;\n  }\n  const xScale = scaler(minMax.min.x, minMax.max.x);\n  const yScale = scaler(minMax.min.y, minMax.max.y);\n  return (point: Point) => ({\n    x: xScale(point.x),\n    y: yScale(point.y)\n  });\n}\n\nexport const absoluteCompute = (minMax: PointMinMax) => {\n  const xScale = scaler(0, 1, minMax.min.x, minMax.max.x);\n  const yScale = scaler(0, 1, minMax.min.y, minMax.max.y);\n  return (point: Point) => ({\n    x: xScale(point.x),\n    y: yScale(point.y)\n  });\n}\n\nexport type AxisMark = Point & {\n  major: boolean\n}\nexport const computeAxisMark = (mm: PointMinMax, increments: number, major: number): { x: AxisMark[], y: AxisMark[] } => {\n  // Vertical\n  const xValues: AxisMark[] = [];\n  let count = 0;\n\n  for (let x = mm.min.x; x < mm.max.x; x += increments) {\n    const isMajor = count % major === 0;\n    xValues.push({ x, y: 0, major: isMajor });\n    count++;\n  }\n\n  // Horizontal\n  count = 0;\n  const yValues: AxisMark[] = [];\n  for (let y = mm.min.y; y < mm.max.y; y += increments) {\n    const isMajor = count % major === 0;\n    yValues.push({ x: 0, y, major: isMajor })\n    count++;\n  }\n  return { x: xValues, y: yValues }\n}","import { MapOfSimpleMutable } from \"@ixfx/collections\";\n\nexport class DataSet<TValue, TSeriesMeta> {\n  #data;\n  #meta;\n  lastChange;\n\n  constructor() {\n    this.lastChange = performance.now();\n    this.#data = new MapOfSimpleMutable<TValue>();\n\n    this.#meta = new Map<string, TSeriesMeta>();\n  }\n\n  get metaCount() {\n    return this.#meta.size;\n  }\n\n  clear() {\n    this.#data.clear();\n    this.lastChange = performance.now();\n  }\n\n  set(series: string, data: TValue[]) {\n    this.#data.setValues(series, data);\n  }\n\n  deleteBySeries(series: string) {\n    const changed = this.#data.delete(series);\n    if (changed) {\n      this.lastChange = performance.now();\n    }\n    return changed;\n  }\n\n  setMeta(series: string, meta: TSeriesMeta) {\n    this.#meta.set(series, meta);\n  }\n\n  hasMeta(series: string) {\n    return this.#meta.has(series);\n  }\n\n  getMeta(series: string) {\n    return this.#meta.get(series);\n  }\n\n  *getValues() {\n    yield* this.#data.valuesFlat();\n  }\n\n  *getEntries() {\n    yield* this.#data.entries();\n  }\n\n  *getSeries() {\n    yield* this.#data.values();\n  }\n\n  add(value: TValue, series = `default`) {\n    this.#data.addKeyedValues(series, value);\n    this.lastChange = performance.now();\n  }\n}","\nimport { DataSet } from \"./DataSet.js\";\nimport * as Cart from './cartesian.js';\nimport { round } from \"@ixfx/numbers\";\nimport type { GridStyle, LineStyle, SeriesMeta, ShowOptions, TextStyle } from \"./types.js\";\nimport type { RecursivePartial } from \"@ixfx/core\";\nimport type { CanvasRegion, CanvasRegionSpec } from \"../canvas-region.js\";\nimport { CanvasSource } from \"../canvas-region.js\";\nimport { resolveEl } from \"@ixfx/dom\";\nimport { ElementSizer } from \"@ixfx/dom\";\nimport type { RectPositioned } from \"@ixfx/geometry/rect\";\nimport { Points, Rects } from \"@ixfx/geometry\";\nimport type { Line } from \"@ixfx/geometry/line\";\nimport type { Point } from \"@ixfx/geometry/point\";\nimport { goldenAngleColour } from \"../colour/generate.js\";\nimport { toCssColour as ColourToString } from \"../colour/conversion.js\";\nexport type InsertOptions = {\n  region?: CanvasRegionSpec\n  /**\n   * Parent to insert CANVAS element into.\n   * If undefined, it will be added to the body.\n   */\n  parent?: HTMLElement | string\n  /**\n   * How canvas should be sized\n   */\n  canvasResizeTo: `parent` | `viewport`\n};\n\n\nexport const insert = (insertOptions: InsertOptions, options: RecursivePartial<Cart.CartesianPlotOptions> = {}) => {\n\n  const parentEl = (insertOptions.parent === undefined) ? document.body : resolveEl(insertOptions.parent);\n  const canvasEl = document.createElement(`canvas`);\n  parentEl.prepend(canvasEl);\n\n  const ds = new DataSet<Cart.PlotPoint, SeriesMeta>();\n\n  const source = new CanvasSource(canvasEl, `min`);\n  const spec = insertOptions.region ?? ({ relativePositioned: { x: 0, y: 0, width: 1, height: 1 } });\n  const region = source.createRegion(spec);\n  const p = new CartesianCanvasPlot(region, ds, options);\n\n  if (insertOptions.canvasResizeTo === `viewport`) {\n    ElementSizer.canvasViewport(canvasEl, {\n      onSizeChanging: (size, _el) => {\n        source.setLogicalSize(size);\n        p.invalidateRange();\n        p.draw();\n      }\n    });\n  } else {\n    // Parent\n    ElementSizer.canvasParent(canvasEl, {\n      onSizeChanging: (size, _el) => {\n        source.setLogicalSize(size);\n        p.invalidateRange();\n        p.draw();\n      }\n    });\n  }\n  return p;\n}\n\n\n/**\n * Simple plotting of cartesian values.\n * \n * Create a plot that fills screen\n * ```js\n * const p = Plot.insert({fill`viewport});\n * const dataSet = p.dataSet;\n * \n * // Add data\n * ds.add({ x: 1, y: 2 });\n * \n * // Draw\n * p.draw();\n * ```\n *\n * Create a plot that fills a container\n * ```js\n * const p = Plot.insert({parent:`#someel`});\n * ```\n * \n * Add data using the created data set\n * ```js\n * \n * // Add a value to the `alpha` series\n * p.dataSet.add({x:1,y:1}, `alpha`);\n * ```\n * \n * Set default series formatting\n * ```js\n * p.setMeta(`default`, {\n *  colour: `hsl(50,100%,50%)`,\n *  lineWidth: 10\n * });\n * ```\n * \n * Series can have metadata associated with it in the DataSet\n * ```js\n * // Use 'pink' by default for the series 'alpha'\n * p.setMeta(`alpha`, { colour: `pink` });\n * ``\n * \n */\nexport class CartesianCanvasPlot {\n  #data;\n  #lastDataChange;\n  #canvasRegion: CanvasRegion;\n\n  actualDataRange: RectPositioned = Rects.EmptyPositioned;\n  visibleRange: RectPositioned = Rects.PlaceholderPositioned;\n  show: ShowOptions;\n  whiskerLength: number;\n  axisRounder = round(1, true);\n  onInvalidated: undefined | (() => void);\n\n  /**\n   * List of lines to draw after drawing everything else.\n   * Lines are given in value-coordinate space\n   */\n  overlayLines: (Line & LineStyle)[] = [];\n  #grid: GridStyle\n  #rangeMode;\n\n  #currentRange?: Cart.CartesianDataRange;\n\n  #axisStyle: LineStyle;\n  #valueStyle;\n  #connectStyle;\n  #rangeManual: Cart.PointMinMax | undefined;\n  #textStyle: TextStyle;\n  #visualPadding: number;\n  #visualClear: `region` | `canvas`;\n\n  constructor(cr: CanvasRegion, data: DataSet<Cart.PlotPoint, SeriesMeta>, options: RecursivePartial<Cart.CartesianPlotOptions> = {}) {\n    if (!data) throw new TypeError(`Param 'data' is undefined`);\n    if (typeof data !== `object`) throw new TypeError(`Param 'data' is not an object. Got: ${ typeof data }`);\n    this.onInvalidated = options.onInvalidated as undefined | (() => void);\n    this.#data = data;\n    this.#canvasRegion = cr;\n    this.#lastDataChange = 0;\n    this.#visualClear = options.clear ?? `region`;\n    this.#rangeMode = options.range ?? `auto`;\n    this.#valueStyle = options.valueStyle ?? `dot`;\n    this.#connectStyle = options.connectStyle ?? ``;\n    this.whiskerLength = options.whiskerLength ?? 5;\n    this.#visualPadding = options.visualPadding ?? 20;\n    this.show = {\n      axes: true,\n      axisValues: true,\n      grid: true,\n      whiskers: true,\n      ...options.show\n    };\n\n    this.#axisStyle = {\n      colour: `black`,\n      width: 2,\n      ...options.axisStyle\n    };\n    this.#textStyle = {\n      colour: `black`,\n      size: `1em`,\n      font: `system-ui`,\n      ...options.textStyle\n    };\n\n    this.#grid = {\n      increments: 0.1,\n      major: 5,\n      colour: `whitesmoke`,\n      width: 1,\n      ...options.grid\n    }\n  }\n\n  getCurrentRange() {\n    if (this.#data.lastChange === this.#lastDataChange && this.#currentRange) return this.#currentRange;\n    this.#lastDataChange = this.#data.lastChange;\n    const r = this.#createRange();\n    this.#currentRange = r;\n    if (this.onInvalidated) this.onInvalidated();\n    return r;\n  }\n\n  invalidateRange() {\n    this.#currentRange = undefined;\n  }\n\n  #createRange(): Cart.CartesianDataRange {\n    // Compute scale of data\n    const range = this.getDataRange(); // actual data range, or user-provided\n\n    const absDataToRelative = Cart.relativeCompute(range);\n    const relDataToAbs = Cart.absoluteCompute(range);\n    const cr = this.#canvasRegion;\n    const padding = this.#visualPadding;\n\n    // Offsets are in canvas coordinates, not region\n    // eg 0,0 is top-left corner of canvas\n    let xOffset = cr.x + padding;\n    let yOffset = cr.y + padding;\n\n    const allowedHeight = cr.height - (padding * 2);\n    const allowedWidth = cr.width - (padding * 2);\n    const dimensionMin = Math.min(allowedHeight, allowedWidth);;\n\n    if (allowedWidth >= allowedHeight) {\n      // Landscape\n      xOffset += (allowedWidth / 2) - (dimensionMin / 2);\n    } else {\n      // Portrait\n      yOffset += (allowedHeight / 2) - (dimensionMin / 2);\n    }\n\n    const relDataToCanvas = (pt: Point) => {\n      let { x, y } = pt;\n      if (x === Number.NEGATIVE_INFINITY) x = 0;\n      else if (x === Number.POSITIVE_INFINITY) x = 1;\n      if (y === Number.NEGATIVE_INFINITY) y = 0;\n      else if (y === Number.POSITIVE_INFINITY) y = 1;\n      x = x * dimensionMin;\n      y = (1 - y) * dimensionMin;\n\n      x += xOffset;\n      y += yOffset;\n\n      return { x, y }\n    };\n\n    const canvasToRelData = (pt: Point) => {\n      let { x, y } = pt;\n      x -= xOffset;\n      y -= yOffset;\n      x = x / dimensionMin;\n      y = 1 - (y / dimensionMin);\n      return { x, y }\n    };\n\n    // Convert region-space to plot area relative\n    const regionSpaceToRelative = (pt: Point) => {\n      let { x, y } = pt;\n      x = x - cr.x + this.#visualPadding;\n      y = (dimensionMin + this.#visualPadding) - y;\n      x /= dimensionMin;\n      y = (y / dimensionMin);\n      return { x, y }\n    }\n\n    return {\n      absDataToRelative, relDataToCanvas, canvasToRelData, regionSpaceToRelative, relDataToAbs, range\n    }\n  }\n\n\n  /**\n   * Positions an element at the viewport location of `data` point.\n   * Ensure the element has `position:absolute` set.\n   * @param data \n   * @param elementToPosition \n   * @param by \n   */\n  positionElementAt(data: Point, elementToPosition: HTMLElement | string, by: `middle` | `top-left` = `middle`, relativeToQuery?: HTMLElement | string) {\n    const el = resolveEl(elementToPosition);\n    let { x, y } = this.valueToScreenSpace(data);\n    // x -= this.canvasSource.offset.x;\n    // y -= this.canvasSource.offset.y;\n    if (by === `middle`) {\n      const bounds = el.getBoundingClientRect();\n      x -= bounds.width / 2;\n      y -= bounds.height / 2;\n    } else if (by === `top-left`) {\n      // no-op\n    } else throw new Error(`Param 'by' expected to be 'middle' or 'top-left'.`);\n    if (relativeToQuery) {\n      const relativeTo = resolveEl(relativeToQuery);\n      const bounds = relativeTo.getBoundingClientRect();\n\n      //console.log(`Plot relativeTo: ${ relativeTo.scrollTop } y:  ${ bounds.y }`);\n      x -= bounds.x;\n      y -= bounds.y;\n    }\n    el.style.left = `${ x }px`;\n    el.style.top = `${ y }px`;\n  }\n\n  /**\n   * When range is auto, returns the range of the data\n   * Otherwise returns the user-provided range.\n   * @returns \n   */\n  getDataRange(): Cart.PointMinMax {\n    if (this.#rangeMode === `auto`) {\n      return Cart.computeMinMax([ ...this.#data.getValues() ]);\n    } else {\n      if (!this.#rangeManual) {\n        this.#rangeManual = Cart.computeMinMax([ this.#rangeMode.max, this.#rangeMode.min ]);\n      }\n      return this.#rangeManual;\n    }\n  }\n\n  valueToScreenSpace(dataPoint: Point) {\n    const region = this.valueToRegionSpace(dataPoint);\n    const offset = this.canvasSource.offset;\n    const scr = {\n      x: region.x + offset.x,\n      y: region.y + offset.y\n    }\n    return scr;\n  }\n\n  valueToRegionSpace(dataValue: Point, debug = false) {\n    const ds = this.getCurrentRange();\n\n    // Scale absolute value relative to total dimensions of data\n    const rel = ds.absDataToRelative(dataValue);\n\n    // Scale relative data value to canvas space\n    const region = ds.relDataToCanvas(rel);\n\n    if (debug) console.log(`orig: ${ dataValue.x }x${ dataValue.y } rel: ${ rel.x }x${ rel.y } region: ${ region.x }x${ region.y }`);\n    return {\n      ...dataValue,\n      x: region.x,\n      y: region.y\n    }\n  }\n\n  // #regionSpaceToValue(scr: Point, clamped: boolean) {\n  //   const ds = this.getCurrentRange();\n\n  //   const rel = ds.regionSpaceToRelative(scr);\n  //   //console.log(`regionSpaceToRelative ${ rel.x.toFixed(2) },${ rel.y.toFixed(2) }`);\n\n  //   const value = ds.relDataToAbs(rel);\n  //   //if (debug) console.log(`orig: ${ a.x }x${ a.y } rel: ${ rel.x }x${ rel.y } scr: ${ scr.x }x${ scr.y }`);\n\n  //   const pt = {\n  //     ...scr,\n  //     x: value.x,\n  //     y: value.y\n  //   }\n  //   if (clamped) return clamp(pt);\n  //   return pt;\n  // }\n\n  /**\n   * Converts a point in pixel coordinates to a value.\n   * Useful for converting from user input coordinates.\n   * @param point \n   * @returns \n   */\n  pointToValue(point: Point, _source: `screen`) {\n    const ds = this.getCurrentRange();\n\n    // Apply offset\n    const canvasPoint = Points.subtract(point, this.canvasSource.offset);\n\n    const v = ds.canvasToRelData(canvasPoint);\n    return ds.relDataToAbs(v);\n  }\n\n  // valueToScreen(a: Point) {\n  //   const ds = this.getCurrentRange();\n  //   const rel = ds.valueToRelative(a);\n  //   const scr = ds.relativeToElementSpace(rel);\n  //   const bounds = this.helper.el.getBoundingClientRect();\n  //   return {\n  //     x: scr.x + bounds.x,\n  //     y: scr.y + bounds.y\n  //   }\n  // }\n\n  // valueRectToScreen(a: Point, b: Point): RectPositioned {\n  //   a = this.valueToScreen(a);\n  //   b = this.valueToScreen(b);\n  //   return {\n  //     x: a.x,\n  //     y: b.y,\n  //     width: b.x - a.x,\n  //     height: a.y - b.y\n  //   }\n  // }\n\n  /**\n   * Compute canvas-relative coordinates based on two points in value space\n   * @param valueA \n   * @param valueB \n   */\n  #valueLineToCanvasSpace(valueA: Point, valueB: Point, debug = false): Line {\n    valueA = this.valueToRegionSpace(valueA, debug) as Point;\n    valueB = this.valueToRegionSpace(valueB, debug) as Point;\n    return { a: valueA, b: valueB };\n  }\n\n  getDefaultMeta(): SeriesMeta {\n    return {\n      colour: goldenAngleColour(this.#data.metaCount),\n      lineWidth: 2,\n      dotRadius: 5\n    }\n  }\n\n  draw() {\n    if (this.#visualClear === `region`) {\n      this.#canvasRegion.clear();\n    } else {\n      this.canvasSource.clear();\n    }\n\n    //const ctx = this.helper.ctx;\n    //this.helper.drawBounds(`whitesmoke`);\n    //Drawing.rect(ctx, this.renderArea, { strokeStyle: `whitesmoke` });\n\n    this.#useGrid();\n    if (this.show.axes) this.#drawAxes();\n\n    //let seriesCount = 0;\n    for (const [ k, v ] of this.#data.getEntries()) {\n      let meta = this.#data.getMeta(k);\n      if (!meta) {\n        meta = this.getDefaultMeta();\n        this.#data.setMeta(k, meta);\n      }\n      this.#drawSeries(k, v, meta);\n      //seriesCount++;\n    }\n    //console.log(`series count: ${ seriesCount }`);\n    for (const line of this.overlayLines) {\n      this.drawLine(line, line.colour, line.width);\n    }\n  }\n\n  /**\n   * Draws a line in value-coordinate space\n   * @param line \n   * @param colour \n   * @param width \n   */\n  drawLine(line: Line, colour: string, width: number) {\n    const l = this.#valueLineToCanvasSpace(line.a, line.b);\n    this.#drawLineCanvasSpace(l, colour, width);\n  }\n\n  setMeta(series: string, meta: Partial<SeriesMeta>) {\n    this.#data.setMeta(series, {\n      ...this.getDefaultMeta(),\n      ...meta\n    })\n  }\n\n  #drawAxes() {\n    const { colour, width } = this.#axisStyle;\n    // Axis coordinates in canvas-space\n    const yAxis = this.#valueLineToCanvasSpace({ x: 0, y: Number.NEGATIVE_INFINITY }, { x: 0, y: Number.POSITIVE_INFINITY }, false);\n    const xAxis = this.#valueLineToCanvasSpace({ x: Number.NEGATIVE_INFINITY, y: 0 }, { x: Number.POSITIVE_INFINITY, y: 0 }, false);\n\n    //console.log(`x axis: ${ xAxis.a.x }-${ xAxis.b.x }`);\n    this.#drawLineCanvasSpace(xAxis, colour, width, false);\n    this.#drawLineCanvasSpace(yAxis, colour, width, false);\n  }\n\n\n  #drawYAxisValues(yPoints: Point[]) {\n    //const { ctx } = this.helper;\n    const ctx = this.#canvasRegion.context;\n\n    ctx.font = this.#textStyle.size + ` ` + this.#textStyle.font;\n    ctx.fillStyle = this.#textStyle.colour;\n    ctx.textBaseline = `middle`;\n\n\n    for (const p of yPoints) {\n      if (p.x === 0 && p.y === 0) continue;\n      const reg = this.valueToRegionSpace(p, false);\n      const value = this.axisRounder(p.y);\n      const label = value.toString();\n      const measure = ctx.measureText(label);\n      const x = reg.x - measure.width - (this.whiskerLength / 2) - 5;\n      const y = reg.y;\n      ctx.fillText(label, x, y);\n    }\n  }\n\n  #drawXAxisValues(xPoints: Point[]) {\n    //const { ctx } = this.helper;\n    const ctx = this.#canvasRegion.context;\n    ctx.font = this.#textStyle.size + ` ` + this.#textStyle.font;\n    ctx.fillStyle = this.#textStyle.colour;\n    ctx.textBaseline = `top`;\n    for (const p of xPoints) {\n      const reg = this.valueToRegionSpace(p, false);\n      const value = this.axisRounder(p.x);\n      const label = value.toString();\n      const measure = ctx.measureText(label);\n      const x = reg.x - measure.width / 2;\n      const y = reg.y + measure.actualBoundingBoxAscent + measure.actualBoundingBoxDescent + (this.whiskerLength / 2);\n      ctx.fillText(label, x, y);\n    }\n  }\n\n  #drawWhisker(p: Cart.AxisMark, vertical: boolean) {\n    const whiskerHalfLength = this.whiskerLength / 2;\n    const v = vertical ? { x: p.x, y: 0 } : { y: p.y, x: 0 }\n    const reg = this.valueToRegionSpace(v, false);\n\n    const line = vertical ? {\n      a: { x: reg.x, y: reg.y - whiskerHalfLength },\n      b: { x: reg.x, y: reg.y + whiskerHalfLength },\n    } :\n      {\n        a: { y: reg.y, x: reg.x - whiskerHalfLength },\n        b: { y: reg.y, x: reg.x + whiskerHalfLength },\n      }\n    this.#drawLineCanvasSpace(line, this.#axisStyle.colour, this.#axisStyle.width, false);\n  }\n\n  #drawGridline(p: Cart.AxisMark, vertical: boolean) {\n    const line = vertical ?\n      this.#valueLineToCanvasSpace({ x: p.x, y: Number.NEGATIVE_INFINITY }, { x: p.x, y: Number.POSITIVE_INFINITY }) :\n      this.#valueLineToCanvasSpace({ y: p.y, x: Number.NEGATIVE_INFINITY }, { y: p.y, x: Number.POSITIVE_INFINITY }, false);\n    this.#drawLineCanvasSpace(line, this.#grid.colour, p.major ? this.#grid.width * 2 : this.#grid.width);\n  }\n\n  #useGrid() {\n    const g = this.#grid;\n    const showGrid = this.show.grid;\n    const showWhiskers = this.show.whiskers;\n    const showValues = this.show.axisValues;\n    const mm = this.getCurrentRange().range; // actual data range, or user-provided\n    const { increments, major } = g;\n\n    // Vertical lines\n    const axisMarks = Cart.computeAxisMark(mm, increments, major);\n    for (const p of axisMarks.x) {\n      if (showGrid) this.#drawGridline(p, true);\n      if (showWhiskers && p.major) this.#drawWhisker(p, true);\n    }\n\n    // Horizontal lines\n    for (const p of axisMarks.y) {\n      if (showGrid) this.#drawGridline(p, false);\n      if (showWhiskers && p.major) this.#drawWhisker(p, false);\n    }\n\n    if (showValues) {\n      this.#drawXAxisValues(axisMarks.x.filter(p => p.major));\n      this.#drawYAxisValues(axisMarks.y.filter(p => p.major));\n    }\n  }\n\n  #drawSeries(name: string, series: Cart.PlotPoint[], meta: SeriesMeta) {\n    if (this.#connectStyle === `line`) {\n      this.#drawConnected(series, meta.colour, meta.lineWidth);\n    }\n\n    //let valueCount = 0;\n    if (this.#valueStyle === `dot`) {\n      for (const v of series) {\n        this.#drawDot(v, meta.colour, meta.dotRadius);\n        //valueCount++;\n      }\n    }\n    //console.log(`valueCount: ${ valueCount }`);\n  }\n\n  #drawConnected(dots: Cart.PlotPoint[], colour: string, width: number) {\n    const ctx = this.#canvasRegion.context;\n    ctx.beginPath();\n    for (const [ index, dot_ ] of dots.entries()) {\n      const dot = this.valueToRegionSpace(dot_, false);\n      if (index === 0) ctx.moveTo(dot.x, dot.y);\n      ctx.lineTo(dot.x, dot.y);\n    }\n    ctx.strokeStyle = ColourToString(colour);\n    ctx.lineWidth = width;\n    ctx.stroke();\n    ctx.closePath();\n  }\n\n  #drawDot(originalDot: Cart.PlotPoint, fallbackColour: string, fallbackRadius: number) {\n    const colour = ColourToString(originalDot.fillStyle ?? fallbackColour);\n    const pos = this.valueToRegionSpace(originalDot);\n    const radius = originalDot.radius ?? fallbackRadius;\n    this.#canvasRegion.drawCircles([\n      { ...pos, radius }\n    ], colour);\n\n    // const ctx = this.helper.ctx;\n    // const dot = this.#valueToElementSpace(originalDot, false);\n    // const radius = originalDot.radius ?? fallbackRadius;\n    // //console.log(`dot ${ dot.x }x${ dot.y } (from ${ originalDot.x }x${ originalDot.y })`);\n    // ctx.fillStyle = Colour.resolveToString(originalDot.fillStyle ?? fallbackColour);\n    // ctx.beginPath();\n    // ctx.arc(dot.x, dot.y, radius, 0, Math.PI * 2);\n    // ctx.fill();\n    // ctx.closePath();\n  }\n\n\n  #drawLineCanvasSpace(line: Line, colour: string, width: number, debug = false) {\n    if (debug) console.log(line);\n    const ctx = this.#canvasRegion.context;\n\n    colour = ColourToString(colour);\n    //this.#canvasRegion.drawConnectedPoints([ line.a, line.b ], colour, width);\n    ctx.beginPath();\n    ctx.moveTo(line.a.x, line.a.y);\n    ctx.lineTo(line.b.x, line.b.y);\n    ctx.strokeStyle = ColourToString(colour);\n    ctx.lineWidth = width;\n    ctx.stroke();\n    ctx.closePath();\n  }\n\n  get dataSet() {\n    return this.#data;\n  }\n\n  get canvasRegion() {\n    return this.#canvasRegion;\n  }\n\n  get canvasSource() {\n    return this.#canvasRegion.source;\n  }\n}","export * as BipolarView from './bipolar-view.js'\nexport * from './cartesian.js';\nexport * from './cartesian-canvas-plot.js';\nexport * from './DataSet.js';\nexport type * from './types.js';","export * from './canvas-helper.js';\nexport * from './canvas-region.js';\n\nexport * from './pointer-visualise.js';\nexport * as Svg from './svg/index.js';\nexport type * from './types.js';\n\nexport * as Convolve2d from './convolve-2d.js';\n\nimport * as NamedColourPalette from './named-colour-palette.js';\n\n\nimport * as Colour from './colour/index.js';\n\nexport * as Colour from './colour/index.js';\n\nimport * as Video from './video.js';\n\nexport * as Drawing from './drawing.js';\n\n/**\n * Wraps [ImageData](https://developer.mozilla.org/en-US/docs/Web/API/ImageData) as an ixfx {@link https://api.ixfx.fun/_ixfx/geometry/Grids/Grid/} type.\n * This is useful because it's otherwise a one-dimensional array listing each rgba in turn.\n */\nexport * as ImageDataGrid from './image-data-grid.js';\n\nexport * as Plot from './plot/index.js';\n\n/**\n * Working with video, either playback from a file or stream from a video camera.\n *\n * Overview\n * * {@link frames}: Yields frames from a video camera\n * * {@link capture}: Capture frames from a VIDEO element\n *\n * @example Importing\n * ```js\n * // If library is stored two directories up under `ixfx/`\n * import {Video} from '../../ixfx/dist/visual.js';\n * // Import from web\n * import {Video} from '@ixfx/visual.js'\n * ```\n */\nexport * as Video from './video.js';\n\ntry {\n  if (typeof window !== `undefined`) {\n    (window as any).ixfx = {\n      ...(window as any).ixfx,\n      Visuals: {\n        NamedColourPalette,\n        Colour,\n        Video,\n      },\n    };\n  }\n} catch {\n  /* no-op */\n}\n\n\n","import { LitElement, html, css } from 'lit';\nimport { customElement } from 'lit/decorators.js';\nimport { createRef, type Ref, ref } from 'lit/directives/ref.js';\nimport * as D from '../util/drawing.js';\nimport { type NormalizedLandmark, type Detection, type HandLandmarkerResult, type BoundingBox } from '@mediapipe/tasks-vision';\nimport type { PoseData } from '../types.js';\nimport { ExpiringMap } from 'ixfx/collections.js';\nimport { Colour } from 'ixfx/visual.js';\nimport type { ProcessorModes } from '../processor-modes.js';\n\n@customElement('overlay-element')\n\nexport class OverlayElement extends LitElement {\n  static override styles = css`\n    :host {\n      display: block;\n      height: 100%;\n      width: 100%;\n    }\n  `;\n\n  canvasEl: Ref<HTMLCanvasElement> = createRef();\n  #colours = new ExpiringMap<string, string>({\n    autoDeleteElapsedMs: 1000,\n    autoDeletePolicy: `get`,\n  });\n  lastHue = 100;\n\n  labelPoints = true;\n\n  override render() {\n    return html`\n      <canvas ${ ref(this.canvasEl) }></canvas>\n    `;\n  }\n\n  setSize(width: number, height: number) {\n    const el = this.canvasEl.value;\n    if (!el) return;\n    el.width = width;\n    el.height = height;\n  }\n\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  draw(mode: ProcessorModes, data?: any) {\n    const el = this.canvasEl.value;\n    if (!el) return;\n\n    const wrap = D.wrap(el);\n    wrap.clear();\n\n    if (!data) return;\n\n    switch (mode) {\n      case `hand`: {\n        this.drawHands(wrap, data as HandLandmarkerResult);\n        break;\n      }\n      case `objects`: {\n        this.drawObjects(wrap, data.detections);\n        break;\n      }\n      case `pose`: {\n        for (const d of data) {\n          if (`poseid` in d) {\n            const pose = d as PoseData;\n            this.drawPose(wrap, pose);\n\n          }\n        }\n        this.drawLandmarks(wrap, data.landmarks);\n        break;\n      }\n      case `face`: {\n        this.drawFaces(wrap, data.detections);\n        break;\n      }\n    }\n  }\n\n\n  drawFaces(wrap: D.Wrapper, d: Detection[]) {\n    for (let i = 0; i < d.length; i++) {\n      const bbox = d[ i ].boundingBox;\n      const colour = Colour.goldenAngleColour(i);\n      for (let k = 0; k < d[ i ].keypoints.length; k++) {\n        const label = this.labelPoints ? k.toString() : ``;\n        wrap.dot(d[ i ].keypoints[ k ], 0.01, colour, label);\n      }\n\n    }\n  }\n\n  drawHands(wrap: D.Wrapper, results: HandLandmarkerResult) {\n    let index = 0;\n    for (const hand of results.landmarks) {\n      const colour = Colour.goldenAngleColour(index);\n      this.drawHand(wrap, hand, colour);\n      this.drawOneSetOfLandmarks(wrap, hand, 0.02, colour);\n\n      index++;\n    }\n  }\n\n  drawHand(wrap: D.Wrapper, p: NormalizedLandmark[], colour: string) {\n    const width = 0.01;\n    wrap.ctx.strokeStyle = colour;\n    wrap.joinPoints(width, p[ 0 ], p[ 1 ], p[ 2 ], p[ 3 ], p[ 4 ]);\n    wrap.joinPoints(width, p[ 5 ], p[ 6 ], p[ 7 ], p[ 8 ]);\n    wrap.joinPoints(width, p[ 9 ], p[ 10 ], p[ 11 ], p[ 12 ]);\n    wrap.joinPoints(width, p[ 13 ], p[ 14 ], p[ 15 ], p[ 16 ]);\n    wrap.joinPoints(width, p[ 17 ], p[ 18 ], p[ 19 ], p[ 20 ]);\n    wrap.joinPoints(width, p[ 5 ], p[ 9 ], p[ 13 ], p[ 17 ], p[ 0 ], p[ 5 ]);\n  }\n\n  drawObjects(wrap: D.Wrapper, data: Detection[]) {\n    const typewriter = D.typewriter(wrap.ctx, 10, 100);\n\n    let index = 0;\n    for (const d of data) {\n      // Object detection\n      const colour = Colour.goldenAngleColour(index);\n      this.drawDetectionBoundingBox(wrap, d as Detection, colour, typewriter);\n      index++;\n    }\n  }\n\n  drawDetectionBoundingBox(wrap: D.Wrapper, det: Detection, colour: string, typewriter: D.Typewriter) {\n    const ctx = wrap.ctx;\n    const bbox = det.boundingBox;\n    if (bbox) {\n      this.drawBoundingBox(ctx, bbox, colour)\n    }\n    if (det.categories) {\n      for (const c of det.categories) {\n        typewriter.line(`${ c.score.toPrecision(2) } - ${ c.categoryName }`, colour);\n      }\n    }\n  }\n\n  drawBoundingBox(ctx: CanvasRenderingContext2D, bbox: BoundingBox, colour: string) {\n    ctx.save();\n    ctx.translate(bbox.originX, bbox.originY);\n    ctx.rotate(bbox.angle);\n    ctx.lineWidth = 5;\n    ctx.strokeStyle = colour;\n    ctx.strokeRect(0, 0, bbox.width, bbox.height);\n    ctx.restore();\n  }\n\n  getColour(id: string) {\n    let colour = this.#colours.get(id);\n    this.#colours.touch(id);\n    if (!colour) {\n      this.lastHue += (45 * Math.random());\n      if (this.lastHue > 360) this.lastHue = this.lastHue % 360;\n      colour = `hsl(${ this.lastHue }deg, 50%, 50%)`;\n      this.#colours.set(id, colour);\n    }\n    return colour;\n  }\n\n  drawLandmarks(wrap: D.Wrapper, poses: NormalizedLandmark[][]) {\n    if (!poses) return;\n    let index = 0;\n    for (const p of poses) {\n      this.drawOneSetOfLandmarks(wrap, p, 0.01, this.getColour(index.toString()));\n      index++;\n    }\n  }\n\n  drawOneSetOfLandmarks(wrap: D.Wrapper, p: NormalizedLandmark[], maxRadius: number, colour: string) {\n    let index = 0;\n    for (const l of p) {\n      let z = -1 * l.z; // Invert so closer is toward 1\n      const r = Math.min(maxRadius * 3, Math.max(0.0001, maxRadius + (maxRadius * z * 3)));\n      const label = this.labelPoints ? index.toString() : ``;\n      wrap.dot(l, r, colour, label);\n      index++;\n    }\n  }\n\n  drawPose(wrap: D.Wrapper, pose: PoseData) {\n    const colour = this.getColour(pose.poseid);\n    this.drawPoseLines(wrap, pose.landmarks, colour);\n    if (this.labelPoints) {\n      this.drawOneSetOfLandmarks(wrap, pose.landmarks, 0.002, colour)\n    }\n  }\n\n  drawPoseLines(wrap: D.Wrapper, p: NormalizedLandmark[], colour: string) {\n    let index = 0;\n    const width = 0.01;\n    wrap.ctx.strokeStyle = colour;\n\n    // Left side\n    wrap.joinPoints(width, p[ 32 ], p[ 30 ], p[ 28 ], p[ 26 ], p[ 24 ], p[ 12 ], p[ 14 ], p[ 16 ], p[ 18 ], p[ 20 ], p[ 16 ], p[ 22 ])\n    // Right side\n    wrap.joinPoints(width, p[ 31 ], p[ 29 ], p[ 27 ], p[ 25 ], p[ 23 ], p[ 11 ], p[ 13 ], p[ 15 ], p[ 17 ], p[ 19 ], p[ 15 ], p[ 21 ])\n\n    // Shoulders\n    wrap.joinPoints(width, p[ 12 ], p[ 11 ]);\n\n    // Hips\n    wrap.joinPoints(width, p[ 24 ], p[ 23 ]);\n\n    // Mouth\n    wrap.joinPoints(width, p[ 10 ], p[ 9 ]);\n\n    // Eyes\n    wrap.joinPoints(width, p[ 8 ], p[ 6 ], p[ 5 ], p[ 4 ], p[ 0 ], p[ 1 ], p[ 2 ], p[ 3 ], p[ 7 ])\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    // @ts-ignore\n    'overlay-element': OverlayElement;\n  }\n}\n","import type { Verbosity } from \"../types.js\"\n\nexport class Log {\n  verbosity: Verbosity\n  prefix: string;\n\n  constructor(prefix: string, verbosity: Verbosity | Log) {\n    if (typeof verbosity === `string`) {\n      this.verbosity = verbosity;\n    } else {\n      this.verbosity = verbosity.verbosity;\n    }\n    this.prefix = prefix;\n  }\n\n  info(msg: any) {\n    if (this.verbosity === `errors`) return;\n    console.log(this.prefix, msg);\n  }\n\n  debug(msg: any) {\n    if (this.verbosity !== `debug`) return;\n    console.log(this.prefix, msg);\n\n  }\n}","import type { RecordingData } from \"./types.js\";\nimport type { Dispatcher, DispatcherDataArgs } from \"./dispatcher.js\";\nimport type { Recordings } from \"./sources/recording-sources.js\";\nimport { Log } from \"./util/log.js\";\nimport type { ProcessorModes } from \"./processor-modes.js\";\n\nexport type RecorderStates = `idle` | `recording` | `complete`;\n\nexport class Recorder extends EventTarget {\n  #state: RecorderStates = `idle`;\n  #mode: ProcessorModes | undefined;\n\n  buffer: any[] = [];\n  computeFreqMs: number = 0;\n  onDataBound;\n  log = new Log(`Recorder`, `info`);\n\n  constructor(readonly recordings: Recordings, readonly dispatcher: Dispatcher) {\n    super();\n    this.onDataBound = this.onData.bind(this);\n  }\n\n  start(computeFreqMs: number) {\n    this.computeFreqMs = computeFreqMs;\n    this.#setState(`recording`);\n    this.dispatcher.addEventListener(`data`, this.onDataBound);\n  }\n\n  get length() {\n    return this.buffer.length;\n  }\n\n  onData(event: Event) {\n    const detail = (event as CustomEvent).detail as DispatcherDataArgs;\n    const data = detail.data;\n    const mode = detail.mode;\n    this.#mode = mode;\n    this.buffer.push(data);\n    if (this.buffer.length % 5 === 0) {\n      this.log.info(`Recorder: ${ this.buffer.length } samples`);\n    }\n  }\n\n  stop() {\n    this.#setState(`complete`);\n    this.dispatcher.removeEventListener(`data`, this.onDataBound);\n\n    const name = this.recordings.promptName();\n    if (name) {\n      const rec: RecordingData = {\n        rateMs: this.computeFreqMs,\n        samples: this.buffer,\n        mode: this.#mode!,\n        name\n      }\n      this.recordings.add(rec);\n    }\n    this.buffer = [];\n  }\n\n  #setState(state: RecorderStates) {\n    const prior = this.#state;\n    if (state === prior) return;\n    this.#state = state;\n    if (state === `recording` && prior !== `idle`) throw new Error(`Cannot transition ${ prior } - > ${ state }`);\n    if (state === `complete` && prior !== `recording`) throw new Error(`Cannot transition ${ prior } - > ${ state }`);\n    this.log.debug(`${ prior } -> ${ state }`);\n    this.dispatchEvent(new CustomEvent(`state-change`, {\n      detail: {\n        priorState: prior,\n        newState: state\n      }\n    }));\n  }\n\n  get state() {\n    return this.#state;\n  }\n}","import { LitElement, html, css, type PropertyValues } from 'lit';\nimport { customElement, property } from 'lit/decorators.js';\nimport { createRef, type Ref, ref } from 'lit/directives/ref.js';\nimport { VideoSelector } from './video-selector.js';\nimport type { Options, SourceData } from '../types.js';\nimport { OverlayElement } from './pose-overlay.js';\nimport type { VideoSourceElement } from './video-source.js';\nimport type { RecPanel } from './rec-panel.js';\nimport { Recorder } from '../recorder.js';\nimport type { SourcesState } from '../sources/index.js';\nimport type { ProcessorModes } from '../processor-modes.js';\n\n@customElement('vision-element')\nexport class VisionElement extends LitElement {\n  videoSelectorEl: Ref<VideoSelector> = createRef();\n  videoSourceEl: Ref<VideoSourceElement> = createRef();\n  overlayEl: Ref<OverlayElement> = createRef();\n  recPanelEl: Ref<RecPanel> = createRef();\n  debug = true;\n\n  #lastCameras: SourceData[] = [];\n  #lastRecordings: SourceData[] = [];\n  #lastSource: SourceData | undefined;\n  #lastOptions: Options | undefined\n\n  @property()\n  uiSource: `video` | `recording` = `video`\n\n  @property()\n  recorder: Recorder | undefined;\n\n  @property()\n  hideModelSelector = false;\n\n  override render() {\n    return html`\n      <div id=\"sources\">\n        <video-source id=\"video\" ${ ref(this.videoSourceEl) } @sized=${ this.onVideoSized }></video-source>\n        <overlay-element @click=${ this.onOverlayClick } id=\"overlay\" ${ ref(this.overlayEl) } ></overlay-element>\n      </div>\n      <div id=\"controls\">\n        ${ this.hideModelSelector ?\n        html`` :\n        html`<details><summary>Model</summary>\n                  <model-element @request-mode=${ this.onRequestMode }></model-element>\n                </details>`\n      }\n        <details><summary>Source</summary>\n          <fieldset @change=${ this.onSelectSource }>\n            <input type=\"radio\" checked name=\"source\" id=\"source-video\" value=\"video\"><label for=\"source-video\">Video</label>\n            <input type=\"radio\" name=\"source\" id=\"source-recording\" value=\"recording\"><label for=\"source-recording\">Recording</label>\n          </fieldset>\n          <video-selector class=${ this.uiSource === `video` ? `show` : `hidden` } \n            .source=${ this.#lastSource } \n            .cameras=${ this.#lastCameras } ${ ref(this.videoSelectorEl) } \n            @startstop=${ this.onVideoStartStop }\n            @change=${ this.onVideoSelectorChange }>\n          </video-selector>\n          <rec-panel class=${ this.uiSource === `recording` ? `show` : `hidden` } \n            .recordings=${ this.#lastRecordings } \n            @startstop=${ this.onRecStartStop }\n            @change=${ this.onRecSelectorChange }\n            @request-delete=${ this.onRecRequestDelete }\n            id=\"rec-panel\" ${ ref(this.recPanelEl) }>\n            </rec-panel>\n        </details>\n        <details><summary>Recording</summary>\n        ${ this.getRecordingUi() }\n        </details>\n      </div>\n    `;\n  }\n\n  onRequestMode(event: Event) {\n    this.dispatchEvent(new CustomEvent(`request-mode`, {\n      detail: (event as CustomEvent).detail\n    }));\n  }\n\n  onRecRequestDelete(event: Event) {\n    const detail = (event as CustomEvent).detail as SourceData;\n    this.dispatchEvent(new CustomEvent(`request-source-delete`, { detail }))\n  }\n\n  onRecSelectorChange(event: Event) {\n    const detail = (event as CustomEvent).detail as SourceData;\n    this.dispatchEvent(new CustomEvent(`request-source`, { detail }))\n  }\n\n  /**\n   * User has choosing a new camera\n   * @param event \n   */\n  onVideoSelectorChange(event: Event) {\n    const detail = (event as CustomEvent).detail as SourceData;\n    this.dispatchEvent(new CustomEvent(`request-source`, { detail: detail }))\n  }\n\n  onRecStartStop(event: Event) {\n    const detail = (event as CustomEvent).detail as SourceData;\n    this.dispatchEvent(new CustomEvent(`source-startstop`, {\n      detail\n    }))\n  }\n\n  onVideoStartStop(event: Event) {\n    const detail = (event as CustomEvent).detail as SourceData;\n    this.dispatchEvent(new CustomEvent(`source-startstop`, {\n      detail\n    }))\n  }\n\n  getRecordingUi() {\n    if (!this.recorder) return html`<button @click=${ this.onStartRecording }>Start recording</button>`;\n    const r = this.recorder;\n    switch (r.state) {\n      case 'recording': {\n        return html`<button @click=${ this.onStopRecording }>Stop recording</button>`\n      }\n      case 'complete': {\n        return html`<em>Complete</em>`\n      }\n    }\n  }\n\n  onStopRecording() {\n    const r = this.recorder;\n    if (!r) return;\n    r.stop();\n    this.recorder = undefined;\n  }\n\n  onStartRecording() {\n    this.dispatchEvent(new CustomEvent(`request-recorder`));\n  }\n\n  onOverlayClick() {\n    this.videoSourceEl.value?.togglePreview();\n  }\n\n  setOptions(options: Options) {\n    this.#lastOptions = options\n  }\n\n  /**\n   * User swapped between camera/recording in UI\n   * @param event \n   * @returns \n   */\n  onSelectSource(event: Event) {\n    const t = event.target as HTMLInputElement;\n    if (!t) return;\n    if (t.value === `video`) {\n      this.uiSource = `video`;\n    } else if (t.value === `recording`) {\n      this.uiSource = `recording`;\n    }\n  }\n\n  /**\n   * Notification that sources have been updated\n   * @param sources \n   */\n  onSourcesUpdated(cameras: SourceData[], recordings: SourceData[]) {\n    this.#lastCameras = cameras;\n    this.#lastRecordings = recordings;\n    const el = this.videoSelectorEl.value;\n    if (el) {\n      el.cameras = cameras\n    }\n\n    const recPanel = this.recPanelEl.value;\n    if (recPanel) {\n      recPanel.recordings = this.#lastRecordings;\n    } else {\n      console.warn(`Not able to set recordings, element missing.`)\n    }\n  }\n\n  override connectedCallback(): void {\n    super.connectedCallback();\n    window.addEventListener(`resize`, () => {\n      this.resizeElements();\n    });\n  }\n\n  protected override firstUpdated(_changedProperties: PropertyValues): void {\n    const overlay = this.overlayEl.value;\n    const opts = this.#lastOptions?.overlay;\n    if (overlay && opts) {\n      overlay.labelPoints = opts.label;\n    } else {\n      console.warn(`Not able to set options for overlay, element missing.`);\n    }\n  }\n\n  updateRecPanel() {\n    const el = this.shadowRoot?.getElementById(`rec-panel`) as RecPanel | null;\n    const recPanel = this.recPanelEl.value || el;\n    if (recPanel) {\n      recPanel.recordings = this.#lastRecordings;\n    } else {\n      console.warn(`Not able to set recordings, element missing.`)\n    }\n  }\n\n  /**\n   * Notification that source has changed\n   * @param source \n   */\n  notifySourceChange(source: SourceData) {\n    this.#lastSource = source;\n    let el = this.videoSelectorEl.value;\n    if (el) {\n      el.source = source;\n    }\n  }\n\n  notifySourceState(state: SourcesState, source?: SourceData) {\n    if (!source) {\n      this.videoSelectorEl.value?.notifySourceState(state);\n      this.recPanelEl.value?.notifySourceState(state)\n    } else if (source.kind === `camera` || source.kind === `file`) {\n      this.videoSelectorEl.value?.notifySourceState(state);\n    } else if (source.kind === `recording`) {\n      this.recPanelEl.value?.notifySourceState(state)\n    }\n  }\n\n  onVideoSized() {\n    this.resizeElements();\n  }\n\n  resizeElements() {\n    const overlay = this.overlayEl.value;\n    const v = this.videoSourceEl.value;\n\n    if (!v || !overlay) return;\n\n    const container = this.getBoundingClientRect();\n    const videoSize = v.getVideoSize();\n    if (!videoSize) return;\n\n    let w = videoSize?.width;\n    let h = videoSize?.height;\n\n    const isVideoLandscape = w >= h;\n    const videoRatioWoverH = w / h;\n    const videoRatioHoverW = h / w;\n    const isLandscape = w >= h;\n\n    let constrainedDimension = isVideoLandscape ? `width` : `height`;\n    if (isLandscape) constrainedDimension = `height`;\n\n    if (constrainedDimension === `width`) {\n      w = container.width;\n      h = w * videoRatioHoverW;\n    } else {\n      h = container.height;\n      w = h * videoRatioWoverH\n    }\n\n    const left = container.width / 2 - w / 2;\n    const top = container.height / 2 - h / 2;\n    v.style.height = overlay.style.height = `${ h }px`;\n    v.style.width = overlay.style.width = `${ w }px`;\n\n    v.style.left = overlay.style.left = `${ left }px`;\n    v.style.top = overlay.style.top = `${ top }px`;\n    overlay.setSize(w, h);\n  }\n\n  onSourceChange(event: CustomEvent) {\n    const d = event.detail;\n\n    this.dispatchEvent(new CustomEvent(`change-source`, {\n      detail: d\n    }));\n  }\n\n  onReceivedData(mode: ProcessorModes, data: any) {\n    const el = this.overlayEl.value;\n    if (!el) return;\n    el.draw(mode, data);\n  }\n\n  getVideoSource() {\n    return this.videoSourceEl.value;\n  }\n\n  getVideoElement() {\n    const src = this.getVideoSource();\n    if (!src) return;\n    return src.getVideoElement();\n  }\n\n  static override styles = css`\n  :host {\n    display: block;\n    background-color: transparent;\n    font-family: system-ui, sans-serif;\n  }\n  #controls {\n    background: black;\n    color: white;\n    position: absolute;\n    top: 0px;\n    left: 0px;\n    padding: 0.5rem;\n  }\n  #overlay,#video {\n    position:absolute;\n  }\n  #sources {\n    background:green;\n  }\n  fieldset {\n    border: 0;\n  }\n  summary {\n    user-select: none;\n    pointer:default;\n  }\n  details {\n    padding:0.3rem;\n  }\n\n  .hidden {\n    display:none;\n  }\n  `;\n\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    // @ts-ignore\n    'vision-element': VisionElement;\n  }\n}\n","\n\nimport { LitElement, html, css } from 'lit';\nimport { customElement, property } from 'lit/decorators.js';\nimport type { RecordingData, SourceData, Verbosity } from '../types.js';\nimport { createRef, type Ref, ref } from 'lit/directives/ref.js';\nimport type { SourcesState } from '../sources/index.js';\n\n\n@customElement('rec-panel')\nexport class RecPanel extends LitElement {\n  static override styles = css`\n    :host {\n      display:block;\n      background-color: hsla(0,0%,30%,0.5);\n    }\n    #contents {\n      padding: 0.5rem;\n    }\n    #toolbar {\n      margin-bottom: 0.5rem;\n    }\n  `;\n\n  @property()\n  recordings: SourceData[] = []\n\n  @property()\n  playing = false;\n\n  selectEl: Ref<HTMLSelectElement> = createRef();\n\n  override render() {\n    if (this.recordings.length === 0) {\n      return html`<em>No recordings</em>`;\n    }\n\n    let recs = [\n\n      ...this.recordings\n    ]\n    return html`\n    <div id=\"contents\">\n      <div id=\"toolbar\">\n        <button @click=${ this.onStartStopClick }>${ this.playing ? `Stop` : `Play` }</button>\n      </div>\n      <select ${ ref(this.selectEl) } @change=${ this.onSelectChange }>\n        ${ this.recordings.map(r => html`<option .source=${ r }>${ r.label }</option>`) }\n      </select>\n      <button @click=${ this.onDeleteClick }>Delete</button>\n    </div>\n    `;\n  }\n\n  onStartStopClick() {\n    const rec = this.getSelected();\n    if (!rec) {\n      console.warn(`No recording selected?`);\n      return;\n    }\n    this.dispatchEvent(new CustomEvent(`startstop`, { detail: rec }));\n  }\n\n  onSelectChange(event: Event) {\n    const target = event.target as HTMLSelectElement;\n    if (!target) return;\n    const item = target.item(target.selectedIndex);\n    if (!item) return;\n    const recording = (item as any).recording as RecordingData;\n\n  }\n\n  getSelected(): SourceData | undefined {\n    const el = this.selectEl.value;\n    if (!el) return;\n    const item = el.item(el.selectedIndex);\n    if (!item) return;\n    return (item as any).source as SourceData;\n  }\n\n  onDeleteClick() {\n    const rec = this.getSelected();\n    if (!rec) return;\n    this.dispatchEvent(new CustomEvent(`request-delete`, { detail: rec }));\n  }\n\n\n\n  // #setState(state: RecPanelStates) {\n  //   const prior = this.#state;\n  //   if (state === prior) return;\n  //   this.#state = state;\n  //   this.#log(`state ${ prior } -> ${ state }`);\n  //   this.dispatchEvent(new CustomEvent(`state`, {\n  //     detail: {\n  //       priorState: prior,\n  //       newState: state\n  //     }\n  //   }));\n  // }\n\n\n\n  notifySourceState(state: SourcesState) {\n    this.playing = state === `started`;\n  }\n\n  // onToggle() {\n  //   this.expanded = !this.expanded;\n  // }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    'rec-panel': RecPanel;\n  }\n}\n","import { LitElement, html, css } from 'lit';\nimport { customElement, property } from 'lit/decorators.js';\nimport { createRef, type Ref, ref } from 'lit/directives/ref.js';\nimport type { SourceData } from '../types.js';\nimport { Log } from '../util/log.js';\n\nexport type VideoSourceStates = `started` | `stopped`;\n\n/**\n * Events:\n * * state\n * * sized: {width/height}\n */\n@customElement('video-source')\nexport class VideoSourceElement extends LitElement {\n  videoEl: Ref<HTMLVideoElement> = createRef();\n\n  @property()\n  source: SourceData | undefined\n\n  log = new Log(`VideoSourceElement`, `errors`);\n  #state = `stopped`;\n\n  @property()\n  showPreview: boolean = true\n\n  override render() {\n    return html`\n      <video class=${ this.showPreview ? `show` : `hide` } @pause=${ this.onPause } @loadedmetadata=${ this.onLoadedMetadata } @playing=${ this.onPlaying } @ended=${ this.onEnded } loop autoplay muted playsInline webkitPlaysInline ${ ref(this.videoEl) }></video>\n    `;\n  }\n\n  togglePreview() {\n    this.showPreview = !this.showPreview;\n  }\n\n  getVideoElement() {\n    return this.videoEl.value;\n  }\n\n  getVideoSize() {\n    const el = this.videoEl.value;\n    if (!el) return;\n    return {\n      width: el.videoWidth,\n      height: el.videoHeight\n    }\n  }\n\n  get isStarted() {\n    return this.#state === `started`;\n  }\n\n  start() {\n    const el = this.videoEl.value;\n    if (!el) {\n      console.warn(`No video element`)\n    } else {\n      el.play();\n    }\n  }\n\n  stop() {\n    const el = this.videoEl.value;\n    if (!el) {\n      console.warn(`No video element`)\n    } else {\n      el.pause();\n    }\n  }\n\n  onLoadedMetadata() {\n    const el = this.videoEl.value;\n    if (!el) return;\n    this.dispatchEvent(new CustomEvent(`sized`, {\n      detail: {\n        width: el.videoWidth,\n        height: el.videoHeight\n      }\n    }\n    ));\n  }\n\n  #setState(state: VideoSourceStates) {\n    const prior = this.#state;\n    if (state === prior) return;\n    this.#state = state;\n    this.log.debug(`state ${ prior } -> ${ state }`);\n    this.dispatchEvent(new CustomEvent(`state`, {\n      detail: {\n        priorState: prior,\n        newState: state\n      }\n    }));\n  }\n\n  /**\n   * From video element - now playing\n   */\n  onPlaying() {\n    this.#setState(`started`);\n  }\n\n  /**\n   * From video element - now stopped\n   */\n  onPause() {\n    this.#setState(`stopped`);\n  }\n\n  /**\n   * From video element - now stopped\n   */\n  onEnded() {\n    this.#setState(`stopped`);\n  }\n\n  setVideoSource(source: MediaProvider | string | null | undefined) {\n    const el = this.videoEl.value;\n\n    if (el) {\n      el.classList.remove(`hide`);\n\n      if (typeof source === `string`) {\n        el.srcObject = null;\n        el.src = source;\n      } else {\n        if (!source) {\n          el.pause();\n          el.classList.add(`hide`);\n        }\n        el.srcObject = source ?? null;\n      }\n    } else {\n      console.warn(`Video element unavailable`);\n    }\n    if (source && el?.paused) {\n      el.play();\n    }\n  }\n\n\n  static override styles = css`\n    :host {\n      display: block;\n    }\n    video {\n      width: 100%;\n      height: 100%;\n      opacity: 0.5;\n    }\n    video.hide {\n      display:none;\n    }\n  `;\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    // @ts-ignore\n    'video-source': VideoSourceElement;\n  }\n}\n","export type ProcessorModes = `pose` | `objects` | `hand` | `face`;\n\nexport const getProcessorModes = () => [ `pose`, `objects`, `hand`, `face` ];\n\nexport const validateProcessorMode = (a: any, fallback?: ProcessorModes): ProcessorModes => {\n  if (typeof a === `string`) {\n    if (a === `pose`) return `pose`;\n    if (a === `hand`) return `hand`;\n    if (a === `face`) return `face`;\n    if (a === `objects`) return `objects`;\n  }\n  if (fallback) return fallback;\n  throw new Error(`Invalid mode: ${ a }. Expected: ${ getProcessorModes().join(`,`) }`);\n}\n\n","import { LitElement, html, css } from 'lit';\nimport { customElement } from 'lit/decorators.js';\nimport { getProcessorModes, validateProcessorMode } from '../processor-modes.js';\n\n@customElement('model-element')\nexport class ModelElement extends LitElement {\n  static override styles = css`\n    :host {\n      display: block;\n    \n    }\n  `;\n\n\n  override render() {\n    const modes = getProcessorModes();\n\n    return html`\n      <select @change=${ this.onSelectChange }>\n      ${ modes.map(m => html`<option>${ m }</option>`) }\n      </select>\n    `;\n  }\n\n  onSelectChange(event: Event) {\n    const value = (event.target as HTMLSelectElement).value;\n\n    this.dispatchEvent(new CustomEvent(`request-mode`, {\n      detail: {\n        mode: validateProcessorMode(value)\n      }\n    }));\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    // @ts-ignore\n    'model-element': ModelElement;\n  }\n}\n","export const piPi = Math.PI * 2;","import { piPi } from './pi.js';\nimport type { Point } from './point/point-type.js';\n/**\n * Convert angle in degrees to angle in radians.\n * @param angleInDegrees \n * @returns \n */\nexport function degreeToRadian(angleInDegrees: number): number;\n\n/**\n * Convert angles in degrees to angles in radians\n * @param angleInDegrees \n */\nexport function degreeToRadian(angleInDegrees: readonly number[]): readonly number[];\n\n\nexport function degreeToRadian(angleInDegrees: number | readonly number[]): number | readonly number[] {\n  return Array.isArray(angleInDegrees) ? angleInDegrees.map(v => v * (Math.PI / 180)) : (angleInDegrees as number) * (Math.PI / 180);\n}\n\n/**\n * Inverts the angle so it points in the opposite direction of a unit circle\n * @param angleInRadians \n * @returns \n */\nexport function radianInvert(angleInRadians: number) {\n  return (angleInRadians + Math.PI) % (2 * Math.PI);\n}\n\nexport function degreeToGradian(angleInDegrees: number) {\n  return angleInDegrees * 1.111111\n}\n\n/**\n * Returns the gradian value converted to degrees.\n * By default it wraps, so any value 360 or greater wraps around.\n * @param angleInGradians \n * @param wrap \n * @returns \n */\nexport function gradianToDegree(angleInGradians: number, wrap = true) {\n  if (wrap) return (angleInGradians * 0.9) % 360;\n  return angleInGradians * 0.9;\n}\n\n\nexport function radianToGradian(angleInRadians: number) {\n  return angleInRadians * 63.6619772368; // 200/pi\n}\n\nexport function gradianToRadian(angleInGradian: number) {\n  return angleInGradian * 0.0157079633; // pi/200\n}\n\n/**\n * Convert angle in radians to angle in degrees\n * @param angleInRadians\n * @returns \n */\nexport function radianToDegree(angleInRadians: number): number;\n\n/**\n * Convert angles in radians to angles in degrees\n * @param angleInRadians \n */\nexport function radianToDegree(angleInRadians: readonly number[]): readonly number[];\n\n\nexport function radianToDegree(angleInRadians: number | readonly number[]): number | readonly number[] {\n  return Array.isArray(angleInRadians) ? angleInRadians.map(v => v * 180 / Math.PI) : (angleInRadians as number) * 180 / Math.PI;\n}\n\n\n/**\n * Angle from x-axis to point (ie. `Math.atan2`)\n * @param point \n * @returns \n */\nexport const radiansFromAxisX = (point: Point): number => Math.atan2(point.x, point.y);\n\n/**\n * Sum angles together, accounting for the 'wrap around'.\n * \n * `clockwise` of _true_ (default) means angles are added in clockwise direction\n * \n * ```js\n * // From 180deg, add 90deg in the clockwise direction\n * radiansSum(Math.PI, Math.PI/2, true);\n * ```\n * \n * Orientation of angles is as follows:\n * ```\n *       90deg\n *       Pi/2\n *        |\n * Pi  ---+--- 0\n * 180    |\n *       3PI/2\n *       270deg\n * ```\n * {@link degreesSum} is the same, but uses degrees (0..360)\n * @param start Starting angle, in radian\n * @param amount Angle to add, in radian\n * @param clockwise Add in clockwise direction (default: _true_)\n * @returns Sum result, in radians\n */\nexport const radiansSum = (start: number, amount: number, clockwise = true) => {\n  if (clockwise) {\n    let x = start + amount;\n    if (x >= piPi) x = x % piPi;\n    return x;\n  } else {\n    const x = start - amount;\n    if (x < 0) {\n      return piPi + x;\n    }\n    return x;\n  }\n}\n\n/**\n * Sum angles together, accounting for the 'wrap around'.\n * \n * `clockwise` of _true_ (default) means angles are added in clockwise direction\n * \n * ```js\n * // From 180deg, add 90deg in the clockwise direction\n * radiansSum(180, 90, true);\n * ```\n * \n * {@link radiansSum} is the same, but uses radians (0..2 Pi)\n * \n * Orientation of angles is as follows:\n * ```\n *       90\n *        |\n * 180 ---+--- 0\n *        |\n *       270\n * ```\n * @param start Starting angle, in degrees\n * @param amount Angle to add, in degrees\n * @param clockwise Add in clockwise direction (default: _true_)\n * @returns Sum result, in degrees\n */\nexport const degreesSum = (start: number, amount: number, clockwise = true) => radianToDegree(radiansSum(degreeToRadian(start), degreeToRadian(amount), clockwise));\n\n/**\n * Computes the angle arc between a start and end angle,\n * given in radians. It properly accounts for the wrap-around\n * values.\n * \n * ```js\n * // Between 0-90deg in clockwise direction\n * radianArc(0, Math.PI/2, true); // Yields: 3Pi/2 (270 deg)\n * \n * // In counter-clockwise direction\n * radianArc(0, Math.PI/2, false); // Yields: Math.PI/2 (90deg)\n * ```\n * \n * See {@link degreeArc} to operate in degrees.\n * \n * Orientation of angles is as follows:\n * ```\n *       90deg\n *       Pi/2\n *        |\n * Pi  ---+--- 0\n * 180    |\n *       3PI/2\n *       270deg\n * ```\n * @param start Start angle, in radians\n * @param end End angle, in radians\n * @param clockwise Calculate in clockwise direction (default: _true_)\n * @returns Angle of arc, in radians.\n */\nexport const radianArc = (start: number, end: number, clockwise = true) => {\n  let s = start;\n  if (end < s) {\n    s = 0;\n    end = piPi - start + end;\n  }\n  let d = end - s;\n  if (clockwise) d = piPi - d;\n  if (d >= piPi) return d % piPi;\n  return d;\n}\n\n/**\n * Computes the angle arc between a start and end angle,\n * given in degrees. It properly accounts for the wrap-around\n * values.\n * \n * ```js\n * // Between 0-90 in clockwise direction\n * degreeArc(0, 90, true); // Yields: 270\n * \n * // In counter-clockwise direction\n * degreeArc(0, 90, false); // Yields: 90\n * ```\n * \n * See {@link radianArc} to operate in radians.\n * \n * Orientation of angles is as follows:\n * ```\n *       90\n *        |\n * 180 ---+--- 0\n *        |\n *       270\n * ```\n * @param start Start angle, in degrees\n * @param end End angle, in degrees\n * @param clockwise Calculate in clockwise direction (default: _true_)\n * @returns Angle of arc, in degrees.\n */\nexport const degreeArc = (start: number, end: number, clockwise = true) => radianToDegree(radianArc(degreeToRadian(start), degreeToRadian(end), clockwise));\n\n\nexport type Angle = {\n  value: number\n  unit: `deg` | `rad` | `turn` | `grad`\n}\n\n/**\n * Parses CSS-style angle strings. By default assumes degrees.\n * \n * ```js\n * angleParse(`100`);     // { value: 100, unit: `deg` }\n * angleParse(100);       // { value: 100, unit: `deg` }\n * angleParse(`100deg`);   // { value: 100, unit: `deg` }\n * \n * // More exotic units:\n * angleParse(`100rad`);  // { value: 100, unit: `rad` }\n * angleParse(`100turn`); // { value: 100, unit: `turn` }\n * angleParse(`100grad`); // { value: 100, unit: `grad` }\n * ```\n * \n * Once parsed in this format, use {@link angleConvert} to convert to\n * a different unit.\n * @param value \n * @returns \n */\nexport const angleParse = (value: string | number | Angle): Angle => {\n  if (isAngle(value)) return value;\n\n  if (typeof value === `number`) {\n    return {\n      value, unit: `deg`\n    }\n  }\n  value = value.toLowerCase();\n  let unit = `deg`;\n  let numberValue = Number.NaN;\n  if (value.endsWith(`grad`)) {\n    numberValue = Number.parseFloat(value.substring(0, value.length - 4));\n    unit = `grad`;\n  } else if (value.endsWith(`rad`)) {\n    numberValue = Number.parseFloat(value.substring(0, value.length - 3));\n    unit = `rad`;\n  } else if (value.endsWith(`turn`)) {\n    numberValue = Number.parseFloat(value.substring(0, value.length - 4));\n    unit = `turn`;\n  } else if (value.endsWith(`deg`)) {\n    numberValue = Number.parseFloat(value.substring(0, value.length - 3));\n    unit = `deg`;\n  } else {\n    numberValue = Number.parseFloat(value);\n  }\n\n  if (Number.isNaN(numberValue)) throw new Error(`Invalid angle (bad value?)`);\n  if (unit.length === 0) throw new Error(`Invalid angle (no unit)`);\n  return {\n    value: numberValue,\n    unit: unit as `deg` | `grad` | `turn` | `rad`\n  }\n}\n\nconst isAngle = (v: any): v is Angle => {\n  if (typeof v !== `object`) return false;\n  if (`unit` in v && `value` in v) {\n    if (typeof v.unit !== `string`) return false;\n    if (typeof v.value !== `number`) return false;\n    return true;\n  }\n  return false;\n}\n\n/**\n * Converts an angle to another representation.\n * Input value is assumed degrees unless it's an {@link Angle} type of has the unit.\n * \n * These are all identical inputs: 100, `100`, `100deg`\n * ```js\n * angleConvert(100, `rad`); // Converts 100deg to radians\n * ```\n * \n * Other units can be used for string input: `2turn`, `1grad`, `2rad`.\n * ```js\n * angleConvert(`2rad`, `deg`); // Converts 2radians to degrees\n * ```\n * \n * Can also use an object input:\n * ```js\n * angleConvert({ value: 10, unit: `deg`}, `rad`);\n * ```\n * @param angleOrDegrees \n * @param destination \n * @returns \n */\nexport const angleConvert = (angleOrDegrees: Angle | number | string, destination: Angle[ `unit` ]): Angle => {\n  const angle = typeof angleOrDegrees === `object` ? angleOrDegrees : angleParse(angleOrDegrees);\n  switch (destination) {\n    case `deg`:\n      if (angle.unit === `deg`) return angle;\n      if (angle.unit === `rad`) return { value: radianToDegree(angle.value), unit: `deg` };\n      if (angle.unit === `grad`) return { value: gradianToDegree(angle.value), unit: `deg` };\n      if (angle.unit === `turn`) return { value: turnToDegree(angle.value), unit: `deg` };\n      throw new Error(`Unknown unit: ${ angle.unit }`);\n    case `grad`:\n      if (angle.unit === `deg`) return { value: degreeToGradian(angle.value), unit: `grad` };\n      if (angle.unit === `rad`) return { value: radianToGradian(angle.value), unit: `grad` };\n      if (angle.unit === `grad`) return angle;\n      if (angle.unit === `turn`) return { value: radianToGradian(turnToRadian(angle.value)), unit: `grad` };\n      throw new Error(`Unknown unit: ${ angle.unit }`);\n    case `rad`:\n      if (angle.unit === `deg`) return { value: degreeToRadian(angle.value), unit: `rad` };\n      if (angle.unit === `rad`) return angle;\n      if (angle.unit === `grad`) return { value: gradianToRadian(angle.value), unit: `rad` };\n      if (angle.unit === `turn`) return { value: radianToGradian(turnToRadian(angle.value)), unit: `grad` };\n      throw new Error(`Unknown unit: ${ angle.unit }`);\n    case `turn`:\n      if (angle.unit === `deg`) return { value: degreeToTurn(angle.value), unit: `turn` };\n      if (angle.unit === `rad`) return { value: radianToTurn(angle.value), unit: `turn` };\n      if (angle.unit === `grad`) return { value: radianToTurn(gradianToRadian(angle.value)), unit: `turn` };\n      if (angle.unit === `turn`) return angle;\n      throw new Error(`Unknown unit: ${ angle.unit }`);\n    default:\n      throw new Error(`Destination unit unknown ('${ destination }). Expects: deg, grad, rad or turn`);\n  }\n}\n\n/**\n * Converts 'turns' to degrees. By defaults wraps the value, so \n * turn value of 1 or 2 equal 0deg instead of 360 or 720deg.\n * @param turns \n * @param wrap \n * @returns \n */\nexport const turnToDegree = (turns: number, wrap = true) => {\n  if (wrap) return (turns * 360) % 360;\n  return turns * 360;\n}\n\nexport const turnToRadian = (turns: number) => turns * piPi;\nexport const degreeToTurn = (degrees: number) => degrees / 360;\nexport const radianToTurn = (radians: number) => radians / piPi","import type { Point, Point3d } from \"./point-type.js\";\nimport { errorResult, numberTest, resultThrow, type Result } from '@ixfx/guards';\n\n/**\n * Returns true if xy (and z, if present) are _null_.\n * @param p\n * @returns\n */\nexport const isNull = (p: Point) => {\n  if (isPoint3d(p)) {\n    if (p.z !== null) return false;\n  }\n  return p.x === null && p.y === null;\n}\n\n/***\n * Returns true if either x, y, z isNaN.\n */\nexport const isNaN = (p: Point) => {\n  if (isPoint3d(p)) {\n    if (!Number.isNaN(p.z)) return false;\n  }\n  return Number.isNaN(p.x) || Number.isNaN(p.y)\n}\n\nexport function test(p: Point, name = `Point`, extraInfo = ``): Result<Point, string> {\n  if (p === undefined) {\n    return errorResult(`'${ name }' is undefined. Expected {x,y} got ${ JSON.stringify(p) }`, extraInfo);\n  }\n  if (p === null) {\n    return errorResult(\n      `'${ name }' is null. Expected {x,y} got ${ JSON.stringify(p) }`, extraInfo\n    );\n  }\n  if (typeof p !== `object`) return errorResult(\n    `'${ name }' is type '${ typeof p }'. Expected object.`, extraInfo\n  );\n  if (p.x === undefined) {\n    return errorResult(\n      `'${ name }.x' is undefined. Expected {x,y} got ${ JSON.stringify(p) }`, extraInfo\n    );\n  }\n  if (p.y === undefined) {\n    return errorResult(\n      `'${ name }.y' is undefined. Expected {x,y} got ${ JSON.stringify(p) }`, extraInfo\n    );\n  }\n  if (typeof p.x !== `number`) {\n    return errorResult(`'${ name }.x' must be a number. Got ${ typeof p.x }`, extraInfo);\n  }\n  if (typeof p.y !== `number`) {\n    return errorResult(`'${ name }.y' must be a number. Got ${ typeof p.y }`, extraInfo);\n  }\n  if (p.z !== undefined) {\n    if (typeof p.z !== `number`) return errorResult(`${ name }.z must be a number. Got: ${ typeof p.z }`, extraInfo)\n    if (Number.isNaN(p.z)) return errorResult(`'${ name }.z' is NaN. Got: ${ JSON.stringify(p) }`, extraInfo);\n  }\n\n  if (p.x === null) return errorResult(`'${ name }.x' is null`, extraInfo);\n  if (p.y === null) return errorResult(`'${ name }.y' is null`, extraInfo);\n\n  if (Number.isNaN(p.x)) return errorResult(`'${ name }.x' is NaN`, extraInfo);\n  if (Number.isNaN(p.y)) return errorResult(`'${ name }.y' is NaN`, extraInfo);\n\n  return { success: true, value: p }\n}\n\n/**\n * Throws an error if point is invalid\n * @param p\n * @param name\n */\nexport function guard(p: Point, name = `Point`, info?: string) {\n  resultThrow(test(p, name, info))\n  // if (p === undefined) {\n  //   throw new Error(\n  //     `'${ name }' is undefined. Expected {x,y} got ${ JSON.stringify(p) }`\n  //   );\n  // }\n  // if (p === null) {\n  //   throw new Error(\n  //     `'${ name }' is null. Expected {x,y} got ${ JSON.stringify(p) }`\n  //   );\n  // }\n  // if (p.x === undefined) {\n  //   throw new Error(\n  //     `'${ name }.x' is undefined. Expected {x,y} got ${ JSON.stringify(p) }`\n  //   );\n  // }\n  // if (p.y === undefined) {\n  //   throw new Error(\n  //     `'${ name }.y' is undefined. Expected {x,y} got ${ JSON.stringify(p) }`\n  //   );\n  // }\n  // if (typeof p.x !== `number`) {\n\n  //   throw new TypeError(`'${ name }.x' must be a number. Got ${ typeof p.x }`);\n  // }\n  // if (typeof p.y !== `number`) {\n\n  //   throw new TypeError(`'${ name }.y' must be a number. Got ${ typeof p.y }`);\n  // }\n  // if (p.z !== undefined) {\n  //   if (typeof p.z !== `number`) throw new TypeError(`${ name }.z must be a number. Got: ${ typeof p.z }`)\n  //   if (Number.isNaN(p.z)) throw new Error(`'${ name }.z' is NaN. Got: ${ JSON.stringify(p) }`);\n  // }\n\n  // if (p.x === null) throw new Error(`'${ name }.x' is null`);\n  // if (p.y === null) throw new Error(`'${ name }.y' is null`);\n\n  // if (Number.isNaN(p.x)) throw new Error(`'${ name }.x' is NaN`);\n  // if (Number.isNaN(p.y)) throw new Error(`'${ name }.y' is NaN`);\n}\n\n/**\n * Throws if parameter is not a valid point, or either x or y is 0\n * @param pt\n * @returns\n */\nexport const guardNonZeroPoint = (pt: Point | Point3d, name = `pt`) => {\n  guard(pt, name);\n  resultThrow(\n    numberTest(pt.x, `nonZero`, `${ name }.x`),\n    numberTest(pt.y, `nonZero`, `${ name }.y`),\n    () => {\n      if (typeof pt.z !== `undefined`) {\n        return numberTest(pt.z, `nonZero`, `${ name }.z`);\n      }\n    }\n  );\n  return true;\n};\n\n/**\n * Returns _true_ if `p` has x & y properties.\n * Returns _false_ if `p` is undefined, null or does not contain properties.\n * Use {@link isPoint3d} to check further check for `z`.\n * @param p \n * @returns \n */\n// eslint-disable-next-line @typescript-eslint/no-redundant-type-constituents\nexport function isPoint(p: number | unknown): p is Point {\n  if (p === undefined) return false;\n  if (p === null) return false;\n  if ((p as Point).x === undefined) return false;\n  if ((p as Point).y === undefined) return false;\n  return true;\n}\n\n/**\n * Returns _true_ if `p` has x, y, & z properties.\n * Returns _false_ if `p` is undefined, null or does not contain properties.\n * @param p \n * @returns \n */\n// eslint-disable-next-line @typescript-eslint/no-redundant-type-constituents\nexport const isPoint3d = (p: Point | unknown): p is Point3d => {\n  if (p === undefined) return false;\n  if (p === null) return false;\n  if ((p as Point3d).x === undefined) return false;\n  if ((p as Point3d).y === undefined) return false;\n  if ((p as Point3d).z === undefined) return false;\n  return true;\n};\n\n/**\n * Returns true if both xy (and z, if present) are 0.\n * Use `Points.Empty` to return an empty point.\n * @param p\n * @returns\n */\nexport const isEmpty = (p: Point) => {\n  if (isPoint3d(p)) {\n    if (p.z !== 0) return false;\n  }\n  return p.x === 0 && p.y === 0\n\n}\n\n/**\n * Returns true if point is a placeholder, where xy (and z, if present)\n * are `NaN`.\n *\n * Use Points.Placeholder to return a placeholder point.\n * @param p\n * @returns\n */\nexport const isPlaceholder = (p: Point) => {\n  if (isPoint3d(p)) {\n    if (!Number.isNaN(p.z)) return false;\n  }\n  return Number.isNaN(p.x) && Number.isNaN(p.y);\n}\n","import { isPoint, isPoint3d } from \"./guard.js\";\nimport type { Point, Point3d } from \"./point-type.js\";\n\nexport function getTwoPointParameters(a: Point, b: Point): [ a: Point, b: Point ];\nexport function getTwoPointParameters(a: Point3d, b: Point3d): [ a: Point3d, b: Point3d ];\nexport function getTwoPointParameters(a: Point, x: number, y: number): [ a: Point, b: Point ];\nexport function getTwoPointParameters(a: Point3d, x: number, y: number, z: number): [ a: Point3d, b: Point3d ];\nexport function getTwoPointParameters(ax: number, ay: number, bx: number, by: number): [ a: Point, b: Point ];\nexport function getTwoPointParameters(ax: number, ay: number, az: number, bx: number, by: number, bz: number): [ a: Point3d, b: Point3d ];\nexport function getTwoPointParameters(a1: Point | Point3d | number, ab2: Point | Point3d | number, ab3?: number, ab4?: number, ab5?: number, ab6?: number) {\n  if (isPoint3d(a1) && isPoint3d(ab2)) return [ a1, ab2 ];\n  if (isPoint(a1) && isPoint(ab2)) return [ a1, ab2 ];\n  if (isPoint3d(a1)) {\n    const b = {\n      x: ab2,\n      y: ab3,\n      z: ab4\n    }\n    if (!isPoint3d(b)) throw new Error(`Expected x, y & z parameters`);\n    return [ a1, b ];\n  }\n  if (isPoint(a1)) {\n    const b = {\n      x: ab2,\n      y: ab3\n    }\n    if (!isPoint(b)) throw new Error(`Expected x & y parameters`);\n    return [ a1, b ];\n  }\n\n  if (typeof ab5 !== `undefined` && typeof ab4 !== `undefined`) {\n    const a = {\n      x: a1,\n      y: ab2,\n      z: ab3\n    };\n    const b = {\n      x: ab4,\n      y: ab5,\n      z: ab6\n    }\n    if (!isPoint3d(a)) throw new Error(`Expected x,y,z for first point`);\n    if (!isPoint3d(b)) throw new Error(`Expected x,y,z for second point`);\n    return [ a, b ];\n  }\n\n  const a = {\n    x: a1,\n    y: ab2\n  };\n  const b = {\n    x: ab3,\n    y: ab4\n  }\n  if (!isPoint(a)) throw new Error(`Expected x,y for first point`);\n  if (!isPoint(b)) throw new Error(`Expected x,y for second point`);\n  return [ a, b ];\n\n}\n\n/**\n * Returns a Point form of either a point, x,y params or x,y,z params.\n * If parameters are undefined, an empty point is returned (0, 0)\n * @ignore\n * @param a\n * @param b\n * @returns\n */\nexport function getPointParameter(\n  a?: Point3d | Point | number | Array<number> | ReadonlyArray<number>,\n  b?: number | boolean,\n  c?: number\n): Point | Point3d {\n  if (a === undefined) return { x: 0, y: 0 };\n\n  if (Array.isArray(a)) {\n    if (a.length === 0) return Object.freeze({ x: 0, y: 0 });\n    if (a.length === 1) return Object.freeze({ x: a[ 0 ], y: 0 });\n    if (a.length === 2) return Object.freeze({ x: a[ 0 ], y: a[ 1 ] });\n    if (a.length === 3) return Object.freeze({ x: a[ 0 ], y: a[ 1 ], z: a[ 2 ] });\n    throw new Error(\n      `Expected array to be 1-3 elements in length. Got ${ a.length }.`\n    );\n  }\n\n  if (isPoint(a)) {\n    return a;\n  } else if (typeof a !== `number` || typeof b !== `number`) {\n    throw new TypeError(\n      `Expected point or x,y as parameters. Got: a: ${ JSON.stringify(\n        a\n      ) } b: ${ JSON.stringify(b) }`\n    );\n  }\n\n  // x,y,z\n  if (typeof c === `number`) {\n    return Object.freeze({ x: a, y: b, z: c });\n  }\n  // x,y\n  return Object.freeze({ x: a, y: b });\n}","import { guard, isPoint3d } from \"./guard.js\";\nimport type { Point, Point3d } from './point-type.js';\nimport { getPointParameter } from \"./get-point-parameter.js\";\n\nexport function distance(a: Point, b?: Point): number;\nexport function distance(a: Point, x: number, y: number): number;\n\n/**\n * Calculate distance between two points.\n * If both points have a `z` property, the distance is 3D distance is calculated.\n * If only one point has a `z`, it is ignored. To force 2D distance, use {@link distance2d}\n *\n * ```js\n * // Distance between two points\n * const ptA = { x: 0.5, y:0.8 };\n * const ptB = { x: 1, y: 0.4 };\n * distance(ptA, ptB);\n * // Or, provide x,y as parameters\n * distance(ptA, 0.4, 0.9);\n *\n * // Distance from ptA to x: 0.5, y:0.8, z: 0.1\n * const ptC = { x: 0.5, y:0.5, z: 0.3 };\n * // With x,y,z as parameters:\n * distance(ptC, 0.5, 0.8, 0.1);\n * ```\n * @param a First point\n * @param xOrB Second point, or x coord\n * @param y y coord, if x coord is given\n * @param z Optional z coord, if x and y are given.\n * @returns\n */\nexport function distance(\n  a: Point | Point3d,\n  xOrB?: Point | Point3d | number,\n  y?: number,\n  z?: number\n): number {\n  const pt = getPointParameter(xOrB, y, z);\n  guard(pt, `b`);\n  guard(a, `a`);\n  return isPoint3d(pt) && isPoint3d(a) ? Math.hypot(pt.x - a.x, pt.y - a.y, pt.z - a.z) : Math.hypot(pt.x - a.x, pt.y - a.y);\n}\n\n/**\n * As {@distance} but always compares by x,y only.\n * @param a\n * @param xOrB \n * @param y \n * @param z \n * @returns \n */\nexport function distance2d(\n  a: Point,\n  xOrB?: Point | number,\n  y?: number\n): number {\n  const pt = getPointParameter(xOrB, y);\n  guard(pt, `b`);\n  guard(a, `a`);\n  return Math.hypot(pt.x - a.x, pt.y - a.y);\n}\n","import { isPoint3d } from \"./guard.js\";\nimport type { Point, Point3d } from \"./point-type.js\";\n\nexport function findMinimum(\n  comparer: (a: Point, b: Point) => Point,\n  ...points: ReadonlyArray<Point>\n): Point;\n\nexport function findMinimum(\n  comparer: (a: Point3d, b: Point3d) => Point3d,\n  ...points: ReadonlyArray<Point3d>\n): Point3d;\n\n/**\n * Returns the 'minimum' point from an array of points, using a comparison function.\n *\n * @example Find point closest to a coordinate\n * ```js\n * const points = [...];\n * const center = {x: 100, y: 100};\n *\n * const closestToCenter = findMinimum((a, b) => {\n *  const aDist = distance(a, center);\n *  const bDist = distance(b, center);\n *  if (aDistance < bDistance) return a;\n *  return b;\n * }, points);\n * ```\n * @param comparer Compare function returns the smallest of `a` or `b`\n * @param points\n * @returns\n */\nexport function findMinimum(\n  comparer: ((a: Point, b: Point) => Point)|((a: Point3d, b: Point3d) => Point3d),\n  ...points: ReadonlyArray<Point|Point3d>\n): Point|Point3d  {\n  if (points.length === 0) throw new Error(`No points provided`);\n  let min = points[ 0 ];\n  for (const p of points) {\n    if (isPoint3d(min) && isPoint3d(p)) {\n      min = comparer(min, p);\n    } else {\n      min = comparer(min as any, p as any);\n    }\n  }\n  return min;\n};","import type { Point } from \"../point/point-type.js\";\nimport type { RectPositioned } from \"./rect-types.js\";\n\n/**\n * Returns a rectangle based on provided four corners.\n *\n * To create a rectangle that contains an arbitary set of points, use {@link Points.bbox}.\n *\n * Does some sanity checking such as:\n *  - x will be smallest of topLeft/bottomLeft\n *  - y will be smallest of topRight/topLeft\n *  - width will be largest between top/bottom left and right\n *  - height will be largest between left and right top/bottom\n *\n */\nexport const maxFromCorners = (\n  topLeft: Point,\n  topRight: Point,\n  bottomRight: Point,\n  bottomLeft: Point\n): RectPositioned => {\n  if (topLeft.y > bottomRight.y) {\n    throw new Error(`topLeft.y greater than bottomRight.y`);\n  }\n  if (topLeft.y > bottomLeft.y) {\n    throw new Error(`topLeft.y greater than bottomLeft.y`);\n  }\n\n  const w1 = topRight.x - topLeft.x;\n  const w2 = bottomRight.x - bottomLeft.x;\n  const h1 = Math.abs(bottomLeft.y - topLeft.y);\n  const h2 = Math.abs(bottomRight.y - topRight.y);\n  return {\n    x: Math.min(topLeft.x, bottomLeft.x),\n    y: Math.min(topRight.y, topLeft.y),\n    width: Math.max(w1, w2),\n    height: Math.max(h1, h2),\n  };\n};\n","import type { Rect3dPositioned, RectPositioned } from \"../rect/rect-types.js\";\nimport { findMinimum } from \"./find-minimum.js\";\nimport type { Point, Point3d } from \"./point-type.js\";\nimport { maxFromCorners as RectsMaxFromCorners } from '../rect/max.js';\n/**\n * Returns the minimum rectangle that can enclose all provided points\n * @param points\n * @returns\n */\nexport const bbox = (...points: ReadonlyArray<Point>): RectPositioned => {\n  const leftMost = findMinimum((a, b) => {\n    return a.x < b.x ? a : b;\n  }, ...points);\n  const rightMost = findMinimum((a, b) => {\n    return a.x > b.x ? a : b;\n  }, ...points);\n  const topMost = findMinimum((a, b) => {\n    return a.y < b.y ? a : b;\n  }, ...points);\n  const bottomMost = findMinimum((a, b) => {\n    return a.y > b.y ? a : b;\n  }, ...points);\n\n  const topLeft = { x: leftMost.x, y: topMost.y };\n  const topRight = { x: rightMost.x, y: topMost.y };\n  const bottomRight = { x: rightMost.x, y: bottomMost.y };\n  const bottomLeft = { x: leftMost.x, y: bottomMost.y };\n  return RectsMaxFromCorners(topLeft, topRight, bottomRight, bottomLeft);\n};\n\nexport const bbox3d = (...points: ReadonlyArray<Point3d>): Rect3dPositioned => {\n  const box = bbox(...points);\n  const zMin = findMinimum((a: Point3d, b: Point3d) => {\n    return a.z < b.z ? a : b\n  }, ...points);\n  const zMax = findMinimum((a: Point3d, b: Point3d) => {\n    return a.z > b.z ? a : b\n  }, ...points);\n\n  return {\n    ...box,\n    z: zMin.z,\n    depth: zMax.z - zMin.z\n  }\n}","import type { Coord } from \"./types.js\";\n\n/**\n * Returns true if `p` seems to be a {@link Polar.Coord} (ie has both distance & angleRadian fields)\n * @param p\n * @returns True if `p` seems to be a PolarCoord\n */\nexport const isPolarCoord = (p: unknown): p is Coord => {\n  if ((p as Coord).distance === undefined) return false;\n  if ((p as Coord).angleRadian === undefined) return false;\n  return true;\n};\n\n/**\n * Throws an error if Coord is invalid\n * @param p\n * @param name\n */\nexport const guard = (p: Coord, name = `Point`) => {\n  if (p === undefined) {\n    throw new Error(\n      `'${ name }' is undefined. Expected {distance, angleRadian} got ${ JSON.stringify(\n        p\n      ) }`\n    );\n  }\n  if (p === null) {\n    throw new Error(\n      `'${ name }' is null. Expected {distance, angleRadian} got ${ JSON.stringify(\n        p\n      ) }`\n    );\n  }\n  if (p.angleRadian === undefined) {\n    throw new Error(\n      `'${ name }.angleRadian' is undefined. Expected {distance, angleRadian} got ${ JSON.stringify(\n        p\n      ) }`\n    );\n  }\n  if (p.distance === undefined) {\n    throw new Error(\n      `'${ name }.distance' is undefined. Expected {distance, angleRadian} got ${ JSON.stringify(\n        p\n      ) }`\n    );\n  }\n  if (typeof p.angleRadian !== `number`) {\n    throw new TypeError(\n\n      `'${ name }.angleRadian' must be a number. Got ${ p.angleRadian }`\n    );\n  }\n  if (typeof p.distance !== `number`) {\n\n    throw new TypeError(`'${ name }.distance' must be a number. Got ${ p.distance }`);\n  }\n\n  if (p.angleRadian === null) throw new Error(`'${ name }.angleRadian' is null`);\n  if (p.distance === null) throw new Error(`'${ name }.distance' is null`);\n\n  if (Number.isNaN(p.angleRadian)) {\n    throw new TypeError(`'${ name }.angleRadian' is NaN`);\n  }\n  if (Number.isNaN(p.distance)) throw new Error(`'${ name }.distance' is NaN`);\n};","import { guard } from \"./guard.js\";\nimport type { Coord } from \"./types.js\";\nimport { degreeToRadian } from '../angles.js';\n\n/**\n * Returns a rotated coordinate\n * @param c Coordinate\n * @param amountRadian Amount to rotate, in radians\n * @returns\n */\nexport const rotate = (c: Coord, amountRadian: number): Coord =>\n  Object.freeze({\n    ...c,\n    angleRadian: c.angleRadian + amountRadian,\n  });\n\n/**\n * Inverts the direction of coordinate. Ie if pointing north, will point south.\n * @param p\n * @returns\n */\nexport const invert = (p: Coord): Coord => {\n  guard(p, `c`);\n  return Object.freeze({\n    ...p,\n    angleRadian: p.angleRadian - Math.PI,\n  });\n};\n\n/**\n * Returns true if PolarCoords have same magnitude but opposite direction\n * @param a\n * @param b\n * @returns\n */\nexport const isOpposite = (a: Coord, b: Coord): boolean => {\n  guard(a, `a`);\n  guard(b, `b`);\n  if (a.distance !== b.distance) return false;\n  return a.angleRadian === -b.angleRadian;\n};\n\n/**\n * Returns true if Coords have the same direction, regardless of magnitude\n * @param a\n * @param b\n * @returns\n */\nexport const isParallel = (a: Coord, b: Coord): boolean => {\n  guard(a, `a`);\n  guard(b, `b`);\n  return a.angleRadian === b.angleRadian;\n};\n\n/**\n * Returns true if coords are opposite direction, regardless of magnitude\n * @param a\n * @param b\n * @returns\n */\nexport const isAntiParallel = (a: Coord, b: Coord): boolean => {\n  guard(a, `a`);\n  guard(b, `b`);\n  return a.angleRadian === -b.angleRadian;\n};\n\n/**\n * Returns a rotated coordinate\n * @param c Coordinate\n * @param amountDeg Amount to rotate, in degrees\n * @returns\n */\nexport const rotateDegrees = (c: Coord, amountDeg: number): Coord =>\n  Object.freeze({\n    ...c,\n    angleRadian: c.angleRadian + degreeToRadian(amountDeg),\n  });\n\n","import { getTwoPointParameters } from \"./get-point-parameter.js\";\nimport { guard, isPoint3d } from \"./guard.js\";\nimport type { Point, Point3d } from \"./point-type.js\";\nimport type { Writeable } from \"@ixfx/core\";\n\nexport function subtract(a: Point, b: Point): Point;\nexport function subtract(a: Point3d, b: Point3d): Point3d;\nexport function subtract(a: Point, x: number, y: number): Point;\nexport function subtract(a: Point3d, x: number, y: number, z: number): Point3d;\nexport function subtract(ax: number, ay: number, bx: number, by: number): Point;\nexport function subtract(ax: number, ay: number, az: number, bx: number, by: number, bz: number): Point3d;\n\n/**\n * Returns a Point with the x,y,z values of two points subtracted (a-b).\n * \n * `z` parameter is used if present. Uses a default value of 0 for 'z' when subtracting a 2D point with a 3D one.\n *\n * Examples:\n *\n * ```js\n * subtract(ptA, ptB);\n * subtract(x1, y1, x2, y2);\n * subtract(ptA, x2, y2);\n * ```\n */\nexport function subtract(\n  a1: Point | Point3d | number, ab2: Point | Point3d | number, ab3?: number, ab4?: number, ab5?: number, ab6?: number\n): Point | Point3d {\n  const [ ptA, ptB ] = getTwoPointParameters(a1 as any, ab2 as any, ab3 as any, ab4 as any, ab5 as any, ab6 as any);\n  guard(ptA, `a`);\n  guard(ptB, `b`);\n  const pt: Writeable<Point> = {\n    x: ptA.x - ptB.x,\n    y: ptA.y - ptB.y,\n  };\n  if (isPoint3d(ptA) || isPoint3d(ptB)) {\n    pt.z = (ptA.z ?? 0) - (ptB.z ?? 0);\n  };\n  return Object.freeze(pt);\n};\n","/**\n * An empty point of `{ x: 0, y: 0 }`.\n *\n * Use `isEmpty` to check if a point is empty.\n * Use `Empty3d` to get an empty point with `z`.\n */\nexport const Empty = { x: 0, y: 0 } as const;\n\n/**\n * Returns { x:1, y:1 }\n */\nexport const Unit = { x: 1, y: 1 } as const;\n\n/**\n * An empty Point of `{ x: 0, y: 0, z: 0}`\n * Use `isEmpty` to check if a point is empty.\n * Use `Empty` to get an empty point without `z`.\n */\nexport const Empty3d = { x: 0, y: 0, z: 0 } as const;\n\n/**\n * Returns { x:1,y:1,z:1 }\n */\nexport const Unit3d = { x: 1, y: 1, z: 1 } as const;","import type { Point } from \"../point/point-type.js\";\nimport { guard, isPolarCoord } from \"./guard.js\";\nimport type { Coord, PolarToCartesian } from \"./types.js\";\nimport { subtract as subtractPoint } from \"../point/subtract.js\";\nimport { guard as guardPoint } from \"../point/guard.js\";\nimport { Empty as EmptyPoint } from '../point/empty.js';\nimport { isPoint } from \"../point/guard.js\";\nimport { radianToDegree } from \"../angles.js\";\n\n/**\n * Converts a polar coordinate to a Line.\n * \n * ```js\n * const line = toLine({ angleRadian: Math.Pi, distance: 0.5 }, { x: 0.2, y: 0.1 });\n * // Yields { a: { x, y}, b: { x, y } }\n * ```\n * \n * The 'start' parameter is taken to be the origin of the Polar coordinate.\n * @param c \n * @param start \n * @returns \n */\nexport const toLine = (c: Coord, start: Point) => {\n  const b = toCartesian(c, start);\n  return { a: start, b }\n}\n\n/**\n * Converts to Cartesian coordinate from polar.\n *\n * ```js\n *\n * const origin = { x: 50, y: 50}; // Polar origin\n * // Yields: { x, y }\n * const polar = Polar.toCartesian({ distance: 10, angleRadian: 0 }, origin);\n * ```\n *\n * Distance and angle can be provided as numbers intead:\n *\n * ```\n * // Yields: { x, y }\n * const polar = Polar.toCartesian(10, 0, origin);\n * ```\n *\n * @param a\n * @param b\n * @param c\n * @returns\n */\nexport const toCartesian: PolarToCartesian = (\n  a: Coord | number,\n  b?: Point | number,\n  c?: Point\n): Point => {\n  if (isPolarCoord(a)) {\n    if (typeof b === `undefined`) b = EmptyPoint;\n    if (isPoint(b)) {\n      return polarToCartesian(a.distance, a.angleRadian, b);\n    }\n    throw new Error(\n      `Expecting (Coord, Point). Second parameter is not a point`\n    );\n  } else if (typeof a === `object`) {\n    throw new TypeError(\n      `First param is an object, but not a Coord: ${ JSON.stringify(a) }`\n    );\n  } else {\n    if (typeof a === `number` && typeof b === `number`) {\n      if (typeof c === `undefined`) c = EmptyPoint;\n      if (!isPoint(c)) {\n        throw new Error(\n          `Expecting (number, number, Point). Point param wrong type`\n        );\n      }\n      return polarToCartesian(a, b, c);\n    } else {\n      throw new TypeError(\n        `Expecting parameters of (number, number). Got: (${ typeof a }, ${ typeof b }, ${ typeof c }). a: ${ JSON.stringify(\n          a\n        ) }`\n      );\n    }\n  }\n};\n\n/**\n * Converts a Cartesian coordinate to polar\n *\n * ```js\n *\n * // Yields: { angleRadian, distance }\n * const polar = Polar.fromCartesian({x: 50, y: 50}, origin);\n * ```\n *\n * Any additional properties of `point` are copied to object.\n * @param point Point\n * @param origin Origin\n * @returns\n */\nexport const fromCartesian = (\n  point: Point,\n  origin: Point\n): Coord => {\n  if (typeof point === `undefined`) throw new Error(`Param 'point' missing. Expecting a Point`);\n  if (typeof origin === `undefined`) throw new Error(`Param 'origin' missing. Expecting a Point`);\n\n  point = subtractPoint(point, origin);\n\n  const angle = Math.atan2(point.y, point.x);\n  const distance = Math.hypot(point.x, point.y);\n\n  const polar = {\n    ...point,\n    angleRadian: angle,\n    distance,\n  };\n  delete (polar as any).x;\n  delete (polar as any).y;\n  return Object.freeze(polar);\n};\n\n/**\n * Converts a polar coordinate to Cartesian\n * @param distance Distance\n * @param angleRadians Angle in radians\n * @param origin Origin, or 0,0 by default.\n * @returns\n */\nconst polarToCartesian = (\n  distance: number,\n  angleRadians: number,\n  origin: Point = EmptyPoint\n): Point => {\n  guardPoint(origin);\n  return Object.freeze({\n    x: origin.x + distance * Math.cos(angleRadians),\n    y: origin.y + distance * Math.sin(angleRadians),\n  });\n};\n\n/**\n * Returns a human-friendly string representation `(distance, angleDeg)`.\n * If `precision` is supplied, this will be the number of significant digits.\n * @param p\n * @returns\n */\nexport const toString = (p: Coord, digits?: number): string => {\n  if (p === undefined) return `(undefined)`;\n  if (p === null) return `(null)`;\n\n  const angleDeg = radianToDegree(p.angleRadian);\n  const d = digits ? p.distance.toFixed(digits) : p.distance;\n  const a = digits ? angleDeg.toFixed(digits) : angleDeg;\n  return `(${ d },${ a })`;\n};\n\nexport const toPoint = (v: Coord, origin = EmptyPoint): Point => {\n  guard(v, `v`);\n  return Object.freeze({\n    x: origin.x + v.distance * Math.cos(v.angleRadian),\n    y: origin.y + v.distance * Math.sin(v.angleRadian),\n  });\n};","import { guard } from \"./guard.js\";\nimport type { Coord } from \"./types.js\";\nimport { numberTest, resultThrow } from \"@ixfx/guards\"\n\nexport const normalise = (c: Coord): Coord => {\n  //guard(v, `v`);\n  if (c.distance === 0) throw new Error(`Cannot normalise vector of length 0`);\n  return Object.freeze({\n    ...c,\n    distance: 1,\n  });\n};\n\n\n\n/**\n * Clamps the magnitude of a vector\n * @param v\n * @param max\n * @param min\n * @returns\n */\nexport const clampMagnitude = (v: Coord, max = 1, min = 0): Coord => {\n  let mag = v.distance;\n  if (mag > max) mag = max;\n  if (mag < min) mag = min;\n  return Object.freeze({\n    ...v,\n    distance: mag,\n  });\n};\n\n/**\n * Calculate dot product of two PolarCoords.\n *\n * Eg, power is the dot product of force and velocity\n *\n * Dot products are also useful for comparing similarity of\n *  angle between two unit PolarCoords.\n * @param a\n * @param b\n * @returns\n */\nexport const dotProduct = (a: Coord, b: Coord): number => {\n  guard(a, `a`);\n  guard(b, `b`);\n  return a.distance * b.distance * Math.cos(b.angleRadian - a.angleRadian);\n};\n\n\n/**\n * Multiplies the magnitude of a coord by `amt`.\n * Direction is unchanged.\n * @param v\n * @param amt\n * @returns\n */\nexport const multiply = (v: Coord, amt: number): Coord => {\n  guard(v);\n  resultThrow(numberTest(amt, ``, `amt`));\n  return Object.freeze({\n    ...v,\n    distance: v.distance * amt,\n  });\n};\n\n/**\n * Divides the magnitude of a coord by `amt`.\n * Direction is unchanged.\n * @param v\n * @param amt\n * @returns\n */\nexport const divide = (v: Coord, amt: number): Coord => {\n  guard(v);\n  resultThrow(numberTest(amt, ``, `amt`));\n  return Object.freeze({\n    ...v,\n    distance: v.distance / amt,\n  });\n};\n","/**\n * A point, consisting of x, y and maybe z fields.\n */\nexport type Point = {\n  readonly x: number;\n  readonly y: number;\n  readonly z?: number;\n};\n\nexport type Point3d = Point & {\n  readonly z: number;\n};\n\n/**\n * Placeholder point: `{ x: NaN, y: NaN }`\n * Use `isPlaceholder` to check if a point is a placeholder.\n * Use `Placeholder3d` get a point with `z` property.\n */\n//eslint-disable-next-line @typescript-eslint/naming-convention\nexport const Placeholder = Object.freeze({ x: Number.NaN, y: Number.NaN });\n\n/**\n * Placeholder point: `{x: NaN, y:NaN, z:NaN }`\n * Use `isPlaceholder` to check if a point is a placeholder.\n * Use `Placeholder` to get a point without `z` property.\n */\nexport const Placeholder3d = Object.freeze({ x: Number.NaN, y: Number.NaN, z: Number.NaN });","import { piPi } from \"../pi.js\";\nimport { guard } from \"./guard.js\";\nimport type { Point } from \"./point-type.js\";\n\n/**\n * Returns the angle in radians between `a` and `b`.\n *\n * Eg if `a` is the origin, and `b` is another point,\n * in degrees one would get 0 to -180 when `b` was above `a`.\n *  -180 would be `b` in line with `a`.\n * Same for under `a`.\n *\n * Providing a third point `c` gives the interior angle, where `b` is the middle point.\n * \n * See also {@link angleRadianCircle} which returns coordinates on 0..Math.Pi*2\n * range. This avoids negative numbers.\n * @param a\n * @param b\n * @param c\n * @returns\n */\nexport const angleRadian = (a: Point, b?: Point, c?: Point) => {\n  guard(a, `a`);\n\n  if (b === undefined) {\n    return Math.atan2(a.y, a.x);\n  }\n  guard(b, `b`);\n  if (c === undefined) {\n    return Math.atan2(b.y - a.y, b.x - a.x);\n  }\n\n  guard(c, `c`);\n  return Math.atan2(b.y - a.y, b.x - a.x) - Math.atan2(c.y - a.y, c.x - a.x);\n};\n\n/**\n * Returns the angle between point(s) using a radian circle system.\n * ```\n *       90deg\n *       Pi/2\n *        |\n * Pi  ---+--- 0\n * 180    |\n *       3PI/2\n *       270deg\n * ```\n * @param a \n * @param b \n * @param c \n * @returns \n */\nexport const angleRadianCircle = (a: Point, b?: Point, c?: Point) => {\n  const angle = angleRadian(a, b, c);\n  if (angle < 0) return angle + piPi\n  return angle;\n}\n\n/**\n * Return the angle of a wedge, defined by a, b and C points, where 'b'\n * could be thought of as the origin or pivot.\n * \n * @param a \n * @param b \n * @param c \n * @returns \n */\nexport const angleRadianThreePoint = (a: Point, b: Point, c: Point) => {\n  const ab = Math.sqrt(Math.pow(b.x - a.x, 2) + Math.pow(b.y - a.y, 2));\n  const bc = Math.sqrt(Math.pow(b.x - c.x, 2) + Math.pow(b.y - c.y, 2));\n  const ac = Math.sqrt(Math.pow(c.x - a.x, 2) + Math.pow(c.y - a.y, 2));\n  return Math.acos((bc * bc + ab * ab - ac * ac) / (2 * bc * ab));\n}","import { guard } from \"./guard.js\";\nimport type { Point, Point3d } from \"./point-type.js\";\n\n/**\n * Returns a point with rounded x,y coordinates. By default uses `Math.round` to round.\n * ```js\n * toIntegerValues({x:1.234, y:5.567}); // Yields: {x:1, y:6}\n * ```\n *\n * ```js\n * toIntegerValues(pt, Math.ceil); // Use Math.ceil to round x,y of `pt`.\n * ```\n * @param pt Point to round\n * @param rounder Rounding function, or Math.round by default\n * @returns\n */\nexport const toIntegerValues = (\n  pt: Point,\n  rounder: (x: number) => number = Math.round\n): Point => {\n  guard(pt, `pt`);\n  return Object.freeze({\n    x: rounder(pt.x),\n    y: rounder(pt.y),\n  });\n};\n\n/**\n * Returns a copy of `pt` with `z` field omitted.\n * If it didn't have one to begin within, a copy is still returned.\n * @param pt \n * @returns \n */\nexport const to2d = (pt: Point): Point => {\n  guard(pt, `pt`);\n  let copy = {\n    ...pt\n  };\n  delete copy.z;\n  return Object.freeze(copy);\n}\n\n/**\n * Returns a copy of `pt` with a `z` field set.\n * Defaults to a z value of 0.\n * @param pt Point\n * @param z Z-value, defaults to 0\n * @returns \n */\nexport const to3d = (pt: Point, z: number = 0): Point3d => {\n  guard(pt, `pt`);\n  return Object.freeze({\n    ...pt,\n    z\n  });\n}\n\n/**\n * Returns a human-friendly string representation `(x, y)`.\n * If `precision` is supplied, this will be the number of significant digits.\n * @param p\n * @returns\n */\nexport function toString(p: Point, digits?: number): string {\n  if (p === undefined) return `(undefined)`;\n  if (p === null) return `(null)`;\n  guard(p, `pt`);\n\n  const x = digits ? p.x.toFixed(digits) : p.x;\n  const y = digits ? p.y.toFixed(digits) : p.y;\n\n  if (p.z === undefined) {\n    return `(${ x },${ y })`;\n  } else {\n    const z = digits ? p.z.toFixed(digits) : p.z;\n    return `(${ x },${ y },${ z })`;\n  }\n}","import { type Line } from \"../line/line-type.js\";\nimport { type Point } from '../point/point-type.js';\nimport { distance } from '../point/distance.js';\nimport { angleRadian } from '../point/angle.js';\nimport { toString as pointToString } from '../point/To.js';\nimport { type PolarRay } from \"./types.js\";\nimport { toCartesian as polarToCartesian } from \"./conversions.js\";\n\n/**\n * Converts a ray to a Line in cartesian coordinates.\n * \n * By default, the ray's origin is taken to be 0,0.\n * Passing in an origin will override this default, or whatever\n * the ray's origin property is.\n * @param ray Ray\n * @param origin Override or provide origin point\n * @returns \n */\nexport const toCartesian = (ray: PolarRay, origin?: Point): Line => {\n  const o = getOrigin(ray, origin);\n  const a = polarToCartesian(ray.offset, ray.angleRadian, o);\n  const b = polarToCartesian(ray.offset + ray.length, ray.angleRadian, o);\n  return { a, b }\n}\n\nconst getOrigin = (ray: PolarRay, origin?: Point): Point => {\n  if (origin !== undefined) return origin;\n  if (ray.origin !== undefined) return ray.origin;\n  return { x: 0, y: 0 };\n}\n\n/**\n * Returns a copy of `ray` ensuring it has an origin.\n * If the `origin` parameter is provided, it will override the existing origin.\n * If no origin information is available, 0,0 is used.\n * @param ray \n * @param origin \n * @returns \n */\n// const withOrigin = (ray: PolarRay, origin?: Point): PolarRayWithOrigin => {\n//   if (origin) {\n//     return {\n//       ...ray,\n//       origin\n//     };\n//   }\n//   if (ray.origin !== undefined) return { ...ray } as PolarRayWithOrigin;\n//   return {\n//     ...ray,\n//     origin: { x: 0, y: 0 }\n//   }\n// }\n\n\n\n// function getAngle(a: Point, b: Point) {\n//   const angle = Math.atan2(b.y - a.y, b.x - a.x);// * (180 / Math.PI) + 90;\n//   return angle;//return (angle < 0) ? scale(angle, -90, 0, 0, piPi) : angle;\n// }\n\n/**\n * Returns a string representation of the ray, useful for debugging.\n * \n * ```\n * \"PolarRay(angle: ... offset: ... len: ... origin: ...)\"\n * ```\n * @param ray \n * @returns \n */\nexport const toString = (ray: PolarRay): string => {\n  let basic = `PolarRay(angle: ${ ray.angleRadian } offset: ${ ray.offset } len: ${ ray.length }`;\n  if (ray.origin) {\n    basic += ` origin: ${ pointToString(ray.origin) }`;\n  }\n  basic += `)`;\n  return basic;\n}\n\n/**\n * Returns a PolarRay based on a line and origin.\n * \n * If `origin` is omitted, the origin is taken to be the 'a' point of the line.\n * Otherwise, the origin value is used to determine the 'offset' of the ray.\n * @param line \n * @param origin \n * @returns \n */\nexport const fromLine = (line: Line, origin?: Point): PolarRay => {\n  const o = origin ?? line.a;\n  return {\n    angleRadian: angleRadian(line.b, o),\n    offset: distance(line.a, o),\n    length: distance(line.b, line.a),\n    origin: o\n  }\n}\n\n","/**\n * Produces an Archimedean spiral. It's a generator.\n *\n * ```js\n * const s = spiral(0.1, 1);\n * for (const coord of s) {\n *  // Use Polar coord...\n *  if (coord.step === 1000) break; // Stop after 1000 iterations\n * }\n * ```\n *\n * @param smoothness 0.1 pretty rounded, at around 5 it starts breaking down\n * @param zoom At smoothness 0.1, zoom starting at 1 is OK\n */\n\nimport type { Coord } from \"./types.js\";\n\nexport function* spiral(\n  smoothness: number,\n  zoom: number\n): IterableIterator<Coord & { readonly step: number }> {\n  let step = 0;\n\n  while (true) {\n    const a = smoothness * step++;\n    yield {\n      distance: zoom * a,\n      angleRadian: a,\n      step: step,\n    };\n  }\n}\n\n/**\n * Produces an Archimedian spiral with manual stepping.\n * @param step Step number. Typically 0, 1, 2 ...\n * @param smoothness 0.1 pretty rounded, at around 5 it starts breaking down\n * @param zoom At smoothness 0.1, zoom starting at 1 is OK\n * @returns\n */\nexport const spiralRaw = (\n  step: number,\n  smoothness: number,\n  zoom: number\n): Coord => {\n  const a = smoothness * step;\n  return Object.freeze({\n    distance: zoom * a,\n    angleRadian: a,\n  });\n};","// import { degreeToRadian, radianToDegree } from '../Angles.js';\n\n// import type { Point } from '../point/PointType.js';\n// import { subtract } from '../point/Subtract.js';\n// import { Empty } from '../point/Empty.js';\n// import { isPoint, guard as PointGuard } from '../point/Guard.js';\n// import type { Coord } from './Types.js';\n\n//const EmptyCartesian = Object.freeze({ x: 0, y: 0 });\n\nexport type * from './types.js';\nexport * from './angles.js';\nexport * from './conversions.js';\nexport * from './guard.js';\nexport * from './math.js';\nexport * as Ray from './ray.js';\nexport * from './spiral.js'\n\n\n","import type { Point } from \"../point/point-type.js\";\nimport type { Line } from \"./line-type.js\";\nimport { guard as guardPoint } from '../point/guard.js';\n\n/**\n * Returns a line from two points\n * \n * ```js\n * // Line from 0,1 to 10,15\n * const line = Lines.fromPoints( { x:0, y:1 }, { x:10, y:15 });\n * // line is: { a: { x: 0, y: 1}, b: { x: 10, y: 15 } };\n * ```\n * @param a Start point\n * @param b End point\n * @returns \n */\nexport const fromPoints = (a: Point, b: Point): Line => {\n  guardPoint(a, `a`);\n  guardPoint(b, `b`);\n  a = Object.freeze({ ...a });\n  b = Object.freeze({ ...b });\n  return Object.freeze({\n    a: a,\n    b: b\n  });\n};\n\n","import { degreeToRadian, radianArc, radiansSum } from '../angles.js';\nimport { guard as guardPoint, isPoint } from '../point/guard.js';\nimport { distance as pointsDistance } from '../point/distance.js';\nimport { bbox as pointsBbox } from '../point/bbox.js';\nimport { toCartesian } from '../polar/index.js';\nimport type { Point } from '../point/point-type.js';\nimport type { Line } from '../line/line-type.js';\nimport type { Path } from '../path/path-type.js';\nimport type { Rect, RectPositioned } from '../rect/rect-types.js';\nimport { fromPoints as LinesFromPoints } from '../line/from-points.js';\nimport type { Arc, ArcInterpolate, ArcPositioned, ArcSvgOpts, ArcToSvg } from './arc-type.js';\nimport type { CirclePositioned } from '../circle/circle-type.js';\nimport { piPi } from '../pi.js';\n\nexport type * from './arc-type.js';\n\n/**\n * Returns true if parameter is an arc\n * @param p Arc or number\n * @returns \n */\nexport const isArc = (p: unknown): p is Arc => typeof (p as Arc).startRadian !== `undefined` && typeof (p as Arc).endRadian !== `undefined` && typeof (p as Arc).clockwise !== `undefined`;\n\n/**\n * Returns true if parameter has a positioned (x,y) \n * @param p Point, Arc or ArcPositiond\n * @returns \n */\nexport const isPositioned = (p: Point | Arc | ArcPositioned): p is Point => typeof (p as Point).x !== `undefined` && typeof (p as Point).y !== `undefined`;\n\n//const piPi = Math.PI * 2;\n\n/**\n * Returns an arc from degrees, rather than radians\n * @param radius Radius of arc\n * @param startDegrees Start angle in degrees\n * @param endDegrees End angle in degrees\n * @returns Arc\n */\nexport function fromDegrees(radius: number, startDegrees: number, endDegrees: number, clockwise: boolean): Arc;\n\n/**\n * Returns an arc from degrees, rather than radians\n * @param radius Radius of arc\n * @param startDegrees Start angle in degrees\n * @param endDegrees End angle in degrees\n * @param origin Optional center of arc\n * @param clockwise Whether arc moves in clockwise direction\n * @returns Arc\n */export function fromDegrees(radius: number, startDegrees: number, endDegrees: number, clockwise: boolean, origin: Point): ArcPositioned\n\n/**\n * Returns an arc from degrees, rather than radians\n * @param radius Radius of arc\n * @param startDegrees Start angle in degrees\n * @param endDegrees End angle in degrees\n * @param origin Optional center of arc\n * @param clockwise Whether arc moves in clockwise direction\n * @returns Arc\n */\nexport function fromDegrees(radius: number, startDegrees: number, endDegrees: number, clockwise: boolean, origin?: Point): Arc | ArcPositioned {\n  const a: Arc = {\n    radius,\n    startRadian: degreeToRadian(startDegrees),\n    endRadian: degreeToRadian(endDegrees),\n    clockwise\n  };\n  if (isPoint(origin)) {\n    guardPoint(origin);\n    const ap: ArcPositioned = {\n      ...a,\n      x: origin.x,\n      y: origin.y\n    };\n    return Object.freeze(ap);\n  } else {\n    return Object.freeze(a);\n  }\n}\n\n/**\n * Returns a {@link Line} linking the start and end points of an {@link ArcPositioned}.\n *\n * @param arc\n * @returns Line from start to end of arc\n */\nexport const toLine = (arc: ArcPositioned): Line => LinesFromPoints(\n  point(arc, arc.startRadian),\n  point(arc, arc.endRadian)\n);\n\n/**\n * Return start and end points of `arc`.\n * `origin` will override arc's origin, if defined.\n * \n * See also: \n * * {@link point} - get point on arc by angle\n * * {@link interpolate} - get point on arc by interpolation percentage\n * @param arc \n * @param origin \n * @returns \n */\nexport const getStartEnd = (arc: ArcPositioned | Arc, origin?: Point): [ start: Point, end: Point ] => {\n  guard(arc);\n  const start = point(arc, arc.startRadian, origin);\n  const end = point(arc, arc.endRadian, origin);\n  return [ start, end ];\n}\n\n/**\n * Calculates a coordinate on an arc, based on an angle.\n * `origin` will override arc's origin, if defined.\n * \n * See also:\n * * {@link getStartEnd} - get start and end of arc\n * * {@link interpolate} - get point on arc by interpolation percentage\n * @param arc Arc\n * @param angleRadian Angle of desired coordinate \n * @param origin Origin of arc (0,0 used by default)\n * @returns Coordinate\n */\nexport const point = (arc: Arc | ArcPositioned, angleRadian: number, origin?: Point): Point => {\n\n  if (typeof origin === `undefined`) {\n    origin = isPositioned(arc) ? arc : { x: 0, y: 0 };\n  }\n  return {\n    x: (Math.cos(angleRadian) * arc.radius) + origin.x,\n    y: (Math.sin(angleRadian) * arc.radius) + origin.y\n  };\n};\n\n/**\n * Throws an error if arc instance is invalid\n * @param arc \n */\nexport const guard = (arc: Arc | ArcPositioned) => {\n  if (typeof arc === `undefined`) throw new TypeError(`Arc is undefined`);\n  if (isPositioned(arc)) {\n    guardPoint(arc, `arc`);\n  }\n  if (typeof arc.radius === `undefined`) throw new TypeError(`Arc radius is undefined (${ JSON.stringify(arc) })`);\n  if (typeof arc.radius !== `number`) throw new TypeError(`Radius must be a number`);\n  if (Number.isNaN(arc.radius)) throw new TypeError(`Radius is NaN`);\n  if (arc.radius <= 0) throw new TypeError(`Radius must be greater than zero`);\n\n  if (typeof arc.startRadian === `undefined`) throw new TypeError(`Arc is missing 'startRadian' field`);\n  if (typeof arc.endRadian === `undefined`) throw new TypeError(`Arc is missing 'startRadian' field`);\n  if (Number.isNaN(arc.endRadian)) throw new TypeError(`Arc endRadian is NaN`);\n  if (Number.isNaN(arc.startRadian)) throw new TypeError(`Arc endRadian is NaN`);\n\n  if (typeof arc.clockwise === `undefined`) throw new TypeError(`Arc is missing 'clockwise field`);\n  if (arc.startRadian >= arc.endRadian) throw new TypeError(`startRadian is expected to be les than endRadian`);\n};\n\n\n\n\n/**\n * Compute relative position on arc.\n * \n * See also:\n * * {@link getStartEnd} - get start and end of arc\n * * {@link point} - get point on arc by angle\n * @param arc Arc\n * @param amount Relative position 0-1\n * @param origin If arc is not positioned, pass in an origin\n * @param allowOverflow If _true_ allows point to overflow arc dimensions (default: _false_)\n * @returns \n */\nexport const interpolate: ArcInterpolate = (amount: number, arc: ArcPositioned | Arc, allowOverflow?: boolean, origin?: Point): Point => {\n  guard(arc);\n  const overflowOk = allowOverflow ?? false;\n  if (!overflowOk) {\n    if (amount < 0) throw new Error(`Param 'amount' is under zero, and overflow is not allowed`);\n    if (amount > 1) throw new Error(`Param 'amount' is above 1 and overflow is not allowed`);\n  }\n  const span = angularSize(arc); // angular size\n  const rel = span * amount;\n  const angle = radiansSum(arc.startRadian, rel, arc.clockwise);\n  //console.log(`interpolate span: ${ span.toFixed(2) } rel: ${ rel.toFixed(2) } angle: ${ angle.toFixed(2) } amt: ${ amount.toFixed(2) } cw: ${ arc.clockwise } start: ${ arc.startRadian }`);\n  return point(arc, angle, origin);\n  //return point(arc, arc.startRadian + ((arc.endRadian - arc.startRadian) * amount), origin);\n};\n\n/**\n * Returns the angular size of arc.\n * Eg if arc runs from 45-315deg in clockwise direction, size will be 90deg.\n * @param arc \n */\nexport const angularSize = (arc: Arc) => radianArc(arc.startRadian, arc.endRadian, arc.clockwise)\n\n/**\n * Creates a {@link Path} instance from the arc. This wraps up some functions for convienence.\n * @param arc \n * @returns Path\n */\nexport const toPath = (arc: ArcPositioned): Path => {\n  guard(arc);\n\n  return Object.freeze({\n    ...arc,\n    nearest: (_point: Point) => { throw new Error(`not implemented`); },\n    interpolate: (amount: number) => interpolate(amount, arc),\n    bbox: () => bbox(arc) as RectPositioned,\n    length: () => length(arc),\n    toSvgString: () => toSvg(arc),\n    relativePosition: (_point: Point, _intersectionThreshold: number) => {\n      throw new Error(`Not implemented`)\n    },\n    distanceToPoint: (_point: Point): number => {\n      throw new Error(`Not implemented`)\n    },\n    kind: `arc`\n  });\n};\n\n/**\n * Returns an arc based on a circle using start and end angles.\n * If you don't have the end angle, but rather the size of the arc, use {@link fromCircleAmount}\n * @param circle Circle\n * @param startRadian Start radian\n * @param endRadian End radian\n * @param clockwise Whether arc goes in a clockwise direction (default: true)\n * @returns \n */\nexport const fromCircle = (circle: CirclePositioned, startRadian: number, endRadian: number, clockwise = true): ArcPositioned => {\n  const a: ArcPositioned = Object.freeze({\n    ...circle,\n    endRadian,\n    startRadian,\n    clockwise\n  });\n  return a;\n}\n\n/**\n * Returns an arc based on a circle, a start angle, and the size of the arc.\n * See {@link fromCircle} if you already have start and end angles.\n * @param circle Circle to base off\n * @param startRadian Starting angle\n * @param sizeRadian Size of arc\n * @param clockwise Whether arc moves in clockwise direction (default: true)\n * @returns \n */\nexport const fromCircleAmount = (circle: CirclePositioned, startRadian: number, sizeRadian: number, clockwise = true): ArcPositioned => {\n  const endRadian = radiansSum(startRadian, sizeRadian, clockwise);\n  return fromCircle(circle, startRadian, endRadian)\n}\n\n\n/**\n * Calculates the length of the arc\n * @param arc \n * @returns Length\n */\nexport const length = (arc: Arc): number => piPi * arc.radius * ((arc.startRadian - arc.endRadian) / piPi);\n\n/**\n * Calculates a {@link Rect} bounding box for arc.\n * @param arc \n * @returns Rectangle encompassing arc.\n */\nexport const bbox = (arc: ArcPositioned | Arc): RectPositioned | Rect => {\n  if (isPositioned(arc)) {\n    const middle = interpolate(0.5, arc);\n    const asLine = toLine(arc);\n    return pointsBbox(middle, asLine.a, asLine.b);\n  } else {\n    return {\n      width: arc.radius * 2,\n      height: arc.radius * 2\n    };\n  }\n};\n\n\n\n\n\n/**\n * Creates an SV path snippet for arc\n * @returns \n */\n// eslint-disable-next-line unicorn/prevent-abbreviations\nexport const toSvg: ArcToSvg = (a: Point | Arc | ArcPositioned, b?: number | Point | ArcSvgOpts, c?: number | ArcSvgOpts, d?: number, e?: ArcSvgOpts) => {\n  if (isArc(a)) {\n    if (isPositioned(a)) {\n      if (isPoint(b)) {\n        // Passing in a origin override\n        return toSvgFull(b, a.radius, a.startRadian, a.endRadian, c as ArcSvgOpts)\n      } else {\n        // Using origin in arc\n        return toSvgFull(a, a.radius, a.startRadian, a.endRadian, b as ArcSvgOpts);\n      }\n    } else {\n      return isPoint(b) ? toSvgFull(b, a.radius, a.startRadian, a.endRadian, c as ArcSvgOpts) : toSvgFull({ x: 0, y: 0 }, a.radius, a.startRadian, a.endRadian);\n    }\n  } else {\n    if (c === undefined) throw new Error(`startAngle undefined`);\n    if (d === undefined) throw new Error(`endAngle undefined`);\n\n    if (isPoint(a)) {\n      if (typeof b === `number` && typeof c === `number` && typeof d === `number`) {\n        return toSvgFull(a, b, c, d, e);\n      } else {\n        throw new TypeError(`Expected (point, number, number, number). Missing a number param.`);\n      }\n    } else {\n      throw new Error(`Expected (point, number, number, number). Missing first point.`);\n    }\n  }\n};\n\n\n\nconst toSvgFull = (origin: Point, radius: number, startRadian: number, endRadian: number, opts?: ArcSvgOpts): readonly string[] => {\n  // https://developer.mozilla.org/en-US/docs/Web/SVG/Tutorial/Paths\n  // A rx ry x-axis-rotation large-arc-flag sweep-flag x y\n  // a rx ry x-axis-rotation large-arc-flag sweep-flag dx dy\n\n  if (opts === undefined || typeof opts !== `object`) opts = {};\n\n  const isFullCircle = endRadian - startRadian === 360;\n  const start = toCartesian(radius, endRadian - 0.01, origin);\n  const end = toCartesian(radius, startRadian, origin);\n\n  const { largeArc = false, sweep = false } = opts;\n\n  const d = [ `\n    M ${ start.x } ${ start.y }\n    A ${ radius } ${ radius } 0 ${ largeArc ? `1` : `0` } ${ sweep ? `1` : `0` } ${ end.x } ${ end.y },\n  `];\n\n  if (isFullCircle) d.push(`z`);\n\n  return d;\n};\n\n/**\n * Calculates the distance between the centers of two arcs\n * @param a\n * @param b \n * @returns Distance \n */\nexport const distanceCenter = (a: ArcPositioned, b: ArcPositioned): number => pointsDistance(a, b);\n\n/**\n * Returns true if the two arcs have the same values\n *\n * ```js\n * const arcA = { radius: 5, endRadian: 0, startRadian: 1 };\n * const arcA = { radius: 5, endRadian: 0, startRadian: 1 };\n * arcA === arcB; // false, because object identities are different\n * Arcs.isEqual(arcA, arcB); // true, because values are identical\n * ```\n * @param a\n * @param b\n * @returns {boolean}\n */\nexport const isEqual = (a: Arc | ArcPositioned, b: Arc | ArcPositioned): boolean => {\n  if (a.radius !== b.radius) return false;\n  if (a.endRadian !== b.endRadian) return false;\n  if (a.startRadian !== b.startRadian) return false;\n  if (a.clockwise !== b.clockwise) return false;\n\n  if (isPositioned(a) && isPositioned(b)) {\n    if (a.x !== b.x) return false;\n    if (a.y !== b.y) return false;\n    if (a.z !== b.z) return false;\n  } else if (!isPositioned(a) && !isPositioned(b)) {\n    // no-op\n  } else return false; // one is positioned one not\n\n  return true;\n};","import { isPoint } from \"../point/guard.js\";\nimport type { Line, PolyLine } from \"./line-type.js\";\n\n/**\n * Returns true if `p` is a valid line, containing `a` and `b` Points.\n * ```js\n * Lines.isLine(l);\n * ```\n * @param p Value to check\n * @returns True if a valid line.\n */\nexport const isLine = (p: any): p is Line => {\n  if (p === undefined) return false;\n  if ((p as Line).a === undefined) return false;\n  if ((p as Line).b === undefined) return false;\n  if (!isPoint((p as Line).a)) return false;\n  if (!isPoint((p as Line).b)) return false;\n  return true;\n};\n\n/**\n * Returns true if `p` is a {@link PolyLine}, ie. an array of {@link Line}s.\n * Validates all items in array.\n * @param p \n * @returns\n */\n\nexport const isPolyLine = (p: any): p is PolyLine => {\n  if (!Array.isArray(p)) return false;\n\n  const valid = !p.some(v => !isLine(v));\n  return valid;\n};\n\n/**\n * Throws an exception if:\n * * line is undefined\n * * a or b parameters are missing\n * \n * Does not validate points\n * @param line \n * @param name \n */\nexport const guard = (line: Line, name = `line`) => {\n  if (line === undefined) throw new Error(`${ name } undefined`);\n  if (line.a === undefined) throw new Error(`${ name }.a undefined. Expected {a:Point, b:Point}. Got: ${ JSON.stringify(line) }`);\n  if (line.b === undefined) throw new Error(`${ name }.b undefined. Expected {a:Point, b:Point} Got: ${ JSON.stringify(line) }`);\n};","import type { Point } from \"../point/point-type.js\";\nimport { isLine } from \"./guard.js\";\nimport type { Line } from \"./line-type.js\";\nimport { guard as guardPoint } from '../point/guard.js';\n\n/**\n * Returns [a,b] points from either a line parameter, or two points.\n * It additionally applies the guardPoint function to ensure validity.\n * This supports function overloading.\n * @ignore\n * @param aOrLine \n * @param b \n * @returns \n */\nexport const getPointParameter = (aOrLine: Point | Line, b?: Point): readonly [ Point, Point ] => {\n\n  let a;\n  if (isLine(aOrLine)) {\n    b = aOrLine.b;\n    a = aOrLine.a;\n  } else {\n    a = aOrLine;\n    if (b === undefined) throw new Error(`Since first parameter is not a line, two points are expected. Got a: ${ JSON.stringify(a) } b: ${ JSON.stringify(b) }`);\n  }\n  guardPoint(a, `a`);\n  guardPoint(a, `b`);\n\n  return [ a, b ];\n};","import type { Point } from \"../point/point-type.js\";\nimport { getPointParameter } from \"./get-points-parameter.js\";\nimport { isPolyLine } from \"./guard.js\";\nimport type { Line, PolyLine } from \"./line-type.js\";\n\n/**\n * Returns the length between two points\n * ```js\n * Lines.length(ptA, ptB);\n * ```\n * @param a First point\n * @param b Second point\n * @returns \n */\nexport function length(a: Point, b: Point): number;\n\n/**\n * Returns length of line. If a polyline (array of lines) is provided,\n * it is the sum total that is returned.\n * \n * ```js\n * Lines.length(a: {x:0, y:0}, b: {x: 100, y:100});\n * Lines.length(lines);\n * ```\n * @param line Line\n */\nexport function length(line: Line | PolyLine): number;\n\n/**\n * Returns length of line, polyline or between two points\n * \n * @param aOrLine Point A, line or polyline (array of lines)\n * @param pointB Point B, if first parameter is a point\n * @returns Length (total accumulated length for arrays)\n */\n\nexport function length(aOrLine: Point | Line | PolyLine, pointB?: Point): number {\n  if (isPolyLine(aOrLine)) {\n    const sum = aOrLine.reduce((accumulator, v) => length(v) + accumulator, 0);\n    return sum;\n  }\n  if (aOrLine === undefined) throw new TypeError(`Parameter 'aOrLine' is undefined`);\n  const [ a, b ] = getPointParameter(aOrLine, pointB);\n  const x = b.x - a.x;\n  const y = b.y - a.y;\n  if (a.z !== undefined && b.z !== undefined) {\n    const z = b.z - a.z;\n    return Math.hypot(x, y, z);\n  } else {\n    return Math.hypot(x, y);\n  }\n}\n","import { guard } from \"./guard.js\";\nimport type { Line } from \"./line-type.js\";\n\n/**\n * Reverses a line.\n * ````js\n * const a = { x: 10, y: 20 };\n * const b = { x: 100, y: 200 };\n * const line = reverse({ a, b });\n * // { a: { x: 100, y: 200 }, b: { x: 10, y: 20 } }\n * ```\n * @param line \n * @returns \n */\nexport function reverse(line: Line): Line {\n  guard(line, `line`);\n  return { a: line.b, b: line.a };\n}","import { numberTest, percentTest, resultThrow } from \"@ixfx/guards\";\nimport type { Point } from \"../point/point-type.js\";\nimport type { Line } from \"./line-type.js\";\nimport { getPointParameter } from \"./get-points-parameter.js\";\nimport { length } from \"./length.js\";\nimport { reverse } from \"./reverse.js\";\n/**\n * Calculates a point in-between `a` and `b`.\n * \n * If an interpolation amount below 0 or above 1 is given, _and_\n * `allowOverflow_ is true, a point will be returned that is extended\n * past `line`. This is useful for easing functions which might\n * briefly go past the limits.\n * \n * ```js\n * // Get {x,y} at 50% along line\n * Lines.interpolate(0.5, line);\n * \n * // Get {x,y} at 80% between point A and B\n * Lines.interpolate(0.8, ptA, ptB);\n * ```\n * @param amount Relative position, 0 being at a, 0.5 being halfway, 1 being at b\n * @param a Start\n * @param pointB End\n * @returns Point between a and b\n */\nexport function interpolate(amount: number, a: Point, pointB: Point, allowOverflow?: boolean): Point;\n\n/**\n * Calculates a point in-between `line`'s start and end points.\n * \n * ```js\n * // Get {x, y } at 50% along line\n * Lines.interpolate(0.5, line);\n * ```\n * \n * Any additional properties from `b`  are returned on the result as well.\n * @param amount 0..1 \n * @param line Line\n * @param allowOverflow If true, interpolation amount is permitted to exceed 0..1, extending the line\n */\nexport function interpolate(amount: number, line: Line, allowOverflow?: boolean): Point;\n\n/**\n * Calculates a point in-between a line's start and end points.\n * \n * @param amount Interpolation amount\n * @param aOrLine Line, or first point\n * @param pointBOrAllowOverflow Second point (if needed) or allowOverflow.\n * @param allowOverflow If true, interpolation amount is permitted to exceed 0..1, extending the line.\n * @returns \n */\nexport function interpolate(amount: number, aOrLine: Point | Line, pointBOrAllowOverflow?: Point | boolean, allowOverflow?: boolean): Point {\n\n  if (typeof pointBOrAllowOverflow === `boolean`) {\n    allowOverflow = pointBOrAllowOverflow;\n    pointBOrAllowOverflow = undefined;\n  }\n\n\n  if (!allowOverflow) resultThrow(percentTest(amount, `amount`));\n  else resultThrow(numberTest(amount, ``, `amount`));\n\n  const [ a, b ] = getPointParameter(aOrLine, pointBOrAllowOverflow);\n\n  const d = length(a, b);\n  const d2 = d * (1 - amount);\n\n  // Points are identical, return a copy of b\n  if (d === 0 && d2 === 0) return Object.freeze({ ...b });\n\n  const x = b.x - (d2 * (b.x - a.x) / d);\n  const y = b.y - (d2 * (b.y - a.y) / d);\n\n  return Object.freeze({\n    ...b,\n    x: x,\n    y: y\n  });\n}\n\n/**\n * Returns the point along a line from its start (A)\n * @param line Line\n * @param distance Distance\n * @param fromA If _true_ (default) returns from A. Use _false_ to calculate from end\n * @returns \n */\nexport function pointAtDistance(line: Line, distance: number, fromA = true): Point {\n  if (!fromA) line = reverse(line);\n\n  const dx = line.b.x - line.a.x;\n  const dy = line.b.y - line.a.y;\n  const theta = Math.atan2(dy, dx);\n  const xp = distance * Math.cos(theta);\n  const yp = distance * Math.sin(theta);\n  return { x: xp + line.a.x, y: yp + line.a.y };\n}","import type { RectPositioned, Rect } from \"./rect-types.js\";\nimport { guard as PointsGuard } from '../point/guard.js';\nimport type { Point } from '../point/point-type.js';\n\n/**\n * Throws an error if the dimensions of the rectangle are undefined, NaN or negative.\n * @param d \n * @param name \n */\nexport const guardDim = (d: number, name = `Dimension`) => {\n  if (d === undefined) throw new Error(`${ name } is undefined`);\n  if (Number.isNaN(d)) throw new Error(`${ name } is NaN`);\n  if (d < 0) throw new Error(`${ name } cannot be negative`);\n};\n\n/**\n * Throws an error if rectangle is missing fields or they\n * are not valid.\n * \n * Checks:\n * * `width` and `height` must be defined on `rect`\n * * dimensions (w & h) must not be NaN\n * * dimensions (w & h) must not be negative\n * \n * If `rect` has x,y, this value is checked as well.\n * @param rect\n * @param name\n */\nexport const guard = (rect: Rect, name = `rect`) => {\n  if (rect === undefined) throw new Error(`{$name} undefined`);\n  if (isPositioned(rect)) PointsGuard(rect, name);\n  guardDim(rect.width, name + `.width`);\n  guardDim(rect.height, name + `.height`);\n};\n\n/**\n * Returns a positioned rect or if it's not possible, throws an error.\n * \n * If `rect` does not have a position, `origin` is used.\n * If `rect` is positioned and `origin` is provided, returned result uses `origin` as x,y instead.\n * ```js\n * // Returns input because it's positioned\n * getRectPositioned({ x:1, y:2, width:10, height:20 });\n * \n * // Returns { x:1, y:2, width:10, height:20 }\n * getRectPositioned({ width:10, height:20 }, { x:1, y:2 });\n *  \n * // Throws, because we have no point\n * getRectPositioned({width:10,height:20})\n * ```\n * @param rect \n * @param origin \n * @returns \n */\nexport const getRectPositioned = (rect: Rect | RectPositioned, origin?: Point): RectPositioned => {\n  guard(rect);\n  if (isPositioned(rect) && origin === undefined) {\n    return rect;\n  }\n  if (origin === undefined) throw new Error(`Unpositioned rect needs origin parameter`);\n  return Object.freeze({ ...rect, ...origin });\n\n}\n\n/**\n * Throws an error if `rect` is does not have a position, or\n * is an invalid rectangle\n * @param rect \n * @param name \n */\nexport const guardPositioned = (rect: RectPositioned, name = `rect`) => {\n  if (!isPositioned(rect)) throw new Error(`Expected ${ name } to have x,y`);\n  guard(rect, name);\n};\n\n/**\n * Returns _true_ if `rect` has width and height values of 0.\n * Use Rects.Empty or Rects.EmptyPositioned to generate an empty rectangle.\n * @param rect \n * @returns \n */\nexport const isEmpty = (rect: Rect): boolean =>\n  rect.width === 0 && rect.height === 0;\n\n/**\n * Returns _true_ if `rect` is a placeholder, with both width and height values of NaN.\n * Use Rects.Placeholder or Rects.PlaceholderPositioned to generate a placeholder.\n * @param rect \n * @returns \n */\nexport const isPlaceholder = (rect: Rect): boolean =>\n  Number.isNaN(rect.width) && Number.isNaN(rect.height);\n\n/**\n * Returns _true_ if `rect` has position (x,y) fields.\n * @param rect Point, Rect or RectPositiond\n * @returns\n */\nexport const isPositioned = (\n  rect: Point | Rect | RectPositioned\n): rect is Point =>\n  (rect as Point).x !== undefined && (rect as Point).y !== undefined;\n\n/**\n * Returns _true_ if `rect` has width and height fields.\n * @param rect\n * @returns\n */\nexport const isRect = (rect: unknown): rect is Rect => {\n  if (rect === undefined) return false;\n  if ((rect as Rect).width === undefined) return false;\n  if ((rect as Rect).height === undefined) return false;\n  return true;\n};\n\n/**\n * Returns _true_ if `rect` is a positioned rectangle\n * Having width, height, x and y properties.\n * @param rect\n * @returns\n */\nexport const isRectPositioned = (\n  rect: any\n): rect is RectPositioned => isRect(rect) && isPositioned(rect);\n","import type { Point } from \"../point/point-type.js\";\nimport { guardDim } from \"./guard.js\";\nimport type { RectPositioned } from \"./rect-types.js\";\nimport { guard as PointsGuard } from '../point/guard.js';\n\n/**\n * Creates a rectangle from its top-left coordinate, a width and height.\n *\n * ```js\n * // Rectangle at 50,50 with width of 100, height of 200.\n * const rect = Rects.fromTopLeft({ x: 50, y:50 }, 100, 200);\n * ```\n * @param origin\n * @param width\n * @param height\n * @returns\n */\nexport const fromTopLeft = (\n  origin: Point,\n  width: number,\n  height: number\n): RectPositioned => {\n  guardDim(width, `width`);\n  guardDim(height, `height`);\n  PointsGuard(origin, `origin`);\n\n  return { x: origin.x, y: origin.y, width: width, height: height };\n};\n","import type { Path } from \"../path/path-type.js\";\nimport type { QuadraticBezier, CubicBezier } from \"./bezier-type.js\";\n\nexport const isQuadraticBezier = (path: Path | QuadraticBezier | CubicBezier): path is QuadraticBezier => (path as QuadraticBezier).quadratic !== undefined;\n\nexport const isCubicBezier = (path: Path | CubicBezier | QuadraticBezier): path is CubicBezier => (path as CubicBezier).cubic1 !== undefined && (path as CubicBezier).cubic2 !== undefined;\n","import { Bezier as BezierLibrary } from 'bezier-js';\nimport { interpolate as LinesInterpolate } from '../line/interpolate.js';\nimport { fromTopLeft as RectsFromTopLeft } from '../rect/from-top-left.js';\nimport type { Point } from '../point/point-type.js';\nimport type { CubicBezier, CubicBezierPath, QuadraticBezier, QuadraticBezierPath } from './bezier-type.js';\nimport { isCubicBezier, isQuadraticBezier } from './guard.js';\nimport { to2d } from '../point/To.js';\nexport * from './bezier-type.js';\nexport * from './guard.js';\n/**\n * Returns a new quadratic bezier with specified bend amount\n *\n * @param {QuadraticBezier} b Curve\n * @param {number} [bend=0] Bend amount, from -1 to 1\n * @returns {QuadraticBezier}\n */\n// export const quadraticBend = (a: Point, b: Point, bend = 0): QuadraticBezier => quadraticSimple(a, b, bend);\n\n/**\n * Creates a simple quadratic bezier with a specified amount of 'bend'.\n * Bend of -1 will pull curve down, 1 will pull curve up. 0 is no curve.\n * \n * Use {@link interpolator} to calculate a point along the curve.\n * @param {Point} start Start of curve\n * @param {Point} end End of curve\n * @param {number} [bend=0] Bend amount, -1 to 1\n * @returns {QuadraticBezier}\n */\nexport const quadraticSimple = (start: Point, end: Point, bend = 0): QuadraticBezier => {\n  if (Number.isNaN(bend)) throw new Error(`bend is NaN`);\n  if (bend < -1 || bend > 1) throw new Error(`Expects bend range of -1 to 1`);\n\n  const middle = LinesInterpolate(0.5, start, end);\n  let target = middle;\n  if (end.y < start.y) {\n    // Upward slope\n    target = bend > 0 ? { x: Math.min(start.x, end.x), y: Math.min(start.y, end.y) } :\n      { x: Math.max(start.x, end.x), y: Math.max(start.y, end.y) };\n  } else {\n    // Downward slope\n    target = bend > 0 ? { x: Math.max(start.x, end.x), y: Math.min(start.y, end.y) } :\n      { x: Math.min(start.x, end.x), y: Math.max(start.y, end.y) };\n  }\n\n  const handle = LinesInterpolate(Math.abs(bend), middle, target,);\n  return quadratic(start, end, handle);\n};\n\n/**\n * Returns a relative point on a simple quadratic \n * @param start Start\n * @param end  End\n * @param bend Bend (-1 to 1)\n * @param amt Amount\n * @returns Point\n */\n// export const computeQuadraticSimple = (start: Point, end: Point, bend: number, amt: number): Point => {\n//   const q = quadraticSimple(start, end, bend);\n//   const bzr = new BezierLibrary(q.a, q.quadratic, q.b);\n//   return bzr.compute(amt);\n// };\n\n/**\n * Interpolate cubic or quadratic bezier\n * ```js\n * const i = interpolator(myBezier);\n * \n * // Get point at 50%\n * i(0.5); // { x, y }\n * ```\n * @param q \n * @returns \n */\nexport const interpolator = (q: QuadraticBezier | CubicBezier): (amount: number) => Point => {\n  //console.log(q);\n  //if (isCubicBezier(q)) console.log(`is cubic`);\n  //const bzr = isCubicBezier(q) ? new BezierLibrary(to2d(q.a), to2d(q.cubic1), to2d(q.cubic2), to2d(q.b)) : new BezierLibrary(q.a, q.quadratic, q.b);\n  const bzr = isCubicBezier(q) ?\n    new BezierLibrary(q.a.x, q.a.y, q.cubic1.x, q.cubic1.y, q.cubic2.x, q.cubic2.y, q.b.x, q.b.y) :\n    new BezierLibrary(q.a, q.quadratic, q.b);\n\n  return (amount: number) => bzr.compute(amount);\n};\n\n//https://developer.mozilla.org/en-US/docs/Web/SVG/Tutorial/Paths\nexport const quadraticToSvgString = (start: Point, end: Point, handle: Point): ReadonlyArray<string> => [ `M ${ start.x } ${ start.y } Q ${ handle.x } ${ handle.y } ${ end.x } ${ end.y }` ];\n\nexport const toPath = (cubicOrQuadratic: CubicBezier | QuadraticBezier): CubicBezierPath | QuadraticBezierPath => {\n  if (isCubicBezier(cubicOrQuadratic)) {\n    return cubicToPath(cubicOrQuadratic);\n  } else if (isQuadraticBezier(cubicOrQuadratic)) {\n    return quadratictoPath(cubicOrQuadratic);\n  } else {\n    throw new Error(`Unknown bezier type`);\n  }\n};\n\nexport const cubic = (start: Point, end: Point, cubic1: Point, cubic2: Point): CubicBezier => (\n  {\n    a: Object.freeze(start),\n    b: Object.freeze(end),\n    cubic1: Object.freeze(cubic1),\n    cubic2: Object.freeze(cubic2)\n  });\n\nconst cubicToPath = (cubic: CubicBezier): CubicBezierPath => {\n  const { a, cubic1, cubic2, b } = cubic;\n\n  const bzr = new BezierLibrary(a, cubic1, cubic2, b);\n  return Object.freeze({\n    ...cubic,\n    length: () => bzr.length(),\n    interpolate: (t: number) => bzr.compute(t),\n    nearest: (_: Point) => { throw new Error(`not implemented`); },\n    bbox: () => {\n      const { x, y } = bzr.bbox();\n      const xSize = x.size;\n      const ySize = y.size;\n      if (xSize === undefined) throw new Error(`x.size not present on calculated bbox`);\n      if (ySize === undefined) throw new Error(`x.size not present on calculated bbox`);\n\n      return RectsFromTopLeft({ x: x.min, y: y.min }, xSize, ySize);\n    },\n    relativePosition: (_point: Point, _intersectionThreshold: number) => {\n      throw new Error(`Not implemented`);\n    },\n    distanceToPoint: (_point: Point): number => {\n      throw new Error(`Not implemented`);\n    },\n    toSvgString: () => [ `brrup` ],\n    kind: `bezier/cubic`\n  });\n};\n\nexport const quadratic = (start: Point, end: Point, handle: Point): QuadraticBezier => ({\n  a: Object.freeze(start),\n  b: Object.freeze(end),\n  quadratic: Object.freeze(handle)\n});\n\n\nconst quadratictoPath = (quadraticBezier: QuadraticBezier): QuadraticBezierPath => {\n  const { a, b, quadratic } = quadraticBezier;\n  const bzr = new BezierLibrary(a, quadratic, b);\n  return Object.freeze({\n    ...quadraticBezier,\n    length: () => bzr.length(),\n    interpolate: (t: number) => bzr.compute(t),\n    nearest: (_: Point) => { throw new Error(`not implemented`); },\n    bbox: () => {\n      const { x, y } = bzr.bbox();\n      const xSize = x.size;\n      const ySize = y.size;\n      if (xSize === undefined) throw new Error(`x.size not present on calculated bbox`);\n      if (ySize === undefined) throw new Error(`x.size not present on calculated bbox`);\n      return RectsFromTopLeft({ x: x.min, y: y.min }, xSize, ySize);\n    },\n    distanceToPoint: (_point: Point): number => {\n      throw new Error(`Not implemented`);\n\n    },\n    relativePosition: (_point: Point, _intersectionThreshold: number): number => {\n      throw new Error(`Not implemented`);\n\n    },\n    toString: () => bzr.toString(),\n    toSvgString: () => quadraticToSvgString(a, b, quadratic),\n    kind: `bezier/quadratic`\n  });\n};\n\n","import { guard as guardPoint } from '../point/guard.js';\nimport type { Point } from '../point/point-type.js';\nimport type { Circle, CirclePositioned } from './circle-type.js';\n\n/**\n * Throws if radius is out of range. If x,y is present, these will be validated too.\n * @param circle \n * @param parameterName \n */\nexport const guard = (circle: CirclePositioned | Circle, parameterName = `circle`) => {\n  if (isCirclePositioned(circle)) {\n    guardPoint(circle, `circle`);\n  }\n\n  if (Number.isNaN(circle.radius)) throw new Error(`${ parameterName }.radius is NaN`);\n  if (circle.radius <= 0) throw new Error(`${ parameterName }.radius must be greater than zero`);\n};\n\n/**\n * Throws if `circle` is not positioned or has dodgy fields\n * @param circle \n * @param parameterName \n * @returns \n */\nexport const guardPositioned = (circle: CirclePositioned, parameterName = `circle`) => {\n  if (!isCirclePositioned(circle)) throw new Error(`Expected a positioned circle with x,y`);\n  guard(circle, parameterName);\n};\n\n/***\n * Returns true if radius, x or y are NaN\n */\nexport const isNaN = (a: Circle | CirclePositioned): boolean => {\n  if (Number.isNaN(a.radius)) return true;\n  if (isCirclePositioned(a)) {\n    if (Number.isNaN(a.x)) return true;\n    if (Number.isNaN(a.y)) return true;\n  }\n  return false;\n};\n\n\n/**\n * Returns true if parameter has x,y. Does not verify if parameter is a circle or not\n * \n * ```js\n * const circleA = { radius: 5 };\n * Circles.isPositioned(circle); // false\n * \n * const circleB = { radius: 5, x: 10, y: 10 }\n * Circles.isPositioned(circle); // true\n * ```\n * @param p Circle\n * @returns \n */\nexport const isPositioned = (p: Circle | Point): p is Point => (p as Point).x !== undefined && (p as Point).y !== undefined;\n\nexport const isCircle = (p: any): p is Circle => (p as Circle).radius !== undefined;\n\nexport const isCirclePositioned = (p: any): p is CirclePositioned => isCircle(p) && isPositioned(p);","import type { Circle } from \"./circle-type.js\";\nimport { guard } from \"./guard.js\";\n\n/**\n * Returns the area of `circle`.\n * @param circle \n * @returns \n */\nexport const area = (circle: Circle) => {\n  guard(circle);\n  return Math.PI * circle.radius * circle.radius;\n};","import { type RectPositioned } from \"./rect-types.js\";\n\nimport type { Point } from \"../point/point-type.js\";\nimport { guard as PointsGuard } from '../point/guard.js';\nimport { guardDim } from \"./guard.js\";\n/**\n * Initialises a rectangle based on its center, a width and height\n *\n * ```js\n * // Rectangle with center at 50,50, width 100 height 200\n * Rects.fromCenter({x: 50, y:50}, 100, 200);\n * ```\n * @param origin\n * @param width\n * @param height\n * @returns\n */\nexport const fromCenter = (\n  origin: Point,\n  width: number,\n  height: number\n): RectPositioned => {\n  PointsGuard(origin, `origin`);\n\n  guardDim(width, `width`);\n  guardDim(height, `height`);\n\n  const halfW = width / 2;\n  const halfH = height / 2;\n  return {\n    x: origin.x - halfW,\n    y: origin.y - halfH,\n    width: width,\n    height: height,\n  };\n};","import type { CirclePositioned, Circle } from \"./circle-type.js\";\nimport { isCirclePositioned } from \"./guard.js\";\nimport { fromCenter as RectsFromCenter } from '../rect/from-center.js';\nimport type { RectPositioned } from \"../rect/rect-types.js\";\n/**\n * Computes a bounding box that encloses circle\n * @param circle\n * @returns \n */\nexport const bbox = (circle: CirclePositioned | Circle): RectPositioned => {\n  return isCirclePositioned(circle) ?\n    RectsFromCenter(circle, circle.radius * 2, circle.radius * 2) :\n    { width: circle.radius * 2, height: circle.radius * 2, x: 0, y: 0 };\n};\n","import type { CirclePositioned, Circle } from \"./circle-type.js\";\nimport { isCirclePositioned } from \"./guard.js\";\n\n/**\n * Returns the center of a circle\n * \n * If the circle has an x,y, that is the center.\n * If not, `radius` is used as the x and y.\n * \n * ```js\n * const circle = { radius: 5, x: 10, y: 10};\n * \n * // Yields: { x: 5, y: 10 }\n * Circles.center(circle);\n * ```\n * \n * It's a trivial function, but can make for more understandable code\n * @param circle \n * @returns Center of circle\n */\nexport const center = (circle: CirclePositioned | Circle) => {\n  return isCirclePositioned(circle) ? Object.freeze({ x: circle.x, y: circle.y }) : Object.freeze({ x: circle.radius, y: circle.radius });\n};","import type { CirclePositioned } from \"./circle-type.js\";\nimport { distance as pointsDistance } from '../point/distance.js';\nimport { guardPositioned, isCirclePositioned } from \"./guard.js\";\nimport type { Point } from '../point/point-type.js';\n\n/**\n * Returns the distance between two circle centers.\n * \n * ```js\n * const circleA = { radius: 5, x: 5, y: 5 }\n * const circleB = { radius: 10, x: 20, y: 20 }\n * const distance = Circles.distanceCenter(circleA, circleB);\n * ```\n * Throws an error if either is lacking position.\n * @param a \n * @param b \n * @returns Distance\n */\nexport const distanceCenter = (a: CirclePositioned, b: CirclePositioned | Point): number => {\n  guardPositioned(a, `a`);\n  if (isCirclePositioned(b)) {\n    guardPositioned(b, `b`);\n  }\n  return pointsDistance(a, b);\n};\n","import type { CirclePositioned } from \"./circle-type.js\";\nimport { distanceCenter } from \"./distance-center.js\";\nimport { isPoint as PointsIsPoint } from \"../point/guard.js\";\nimport { distance as PointsDistance } from \"../point/distance.js\";\nimport { guardPositioned, isCirclePositioned } from \"./guard.js\";\nimport type { Point } from '../point/point-type.js';\n\n/**\n * Returns the distance between the exterior of two circles, or between the exterior of a circle and point.\n * If `b` overlaps or is enclosed by `a`, distance is 0.\n * \n * ```js\n * const circleA = { radius: 5, x: 5, y: 5 }\n * const circleB = { radius: 10, x: 20, y: 20 }\n * const distance = Circles.distanceCenter(circleA, circleB);\n * ```\n * @param a\n * @param b \n */\nexport const distanceFromExterior = (a: CirclePositioned, b: CirclePositioned | Point): number => {\n  guardPositioned(a, `a`);\n  if (isCirclePositioned(b)) {\n    return Math.max(0, distanceCenter(a, b) - a.radius - b.radius);\n  } else if (PointsIsPoint(b)) {\n    const distribution = PointsDistance(a, b);\n    if (distribution < a.radius) return 0;\n    return distribution;\n  } else throw new Error(`Second parameter invalid type`);\n};","import type { Point } from '../point/point-type.js';\nimport type { CirclePositioned } from \"./circle-type.js\";\n\n/**\n * Yields the points making up the exterior (ie. circumference) of the circle.\n * Uses [Midpoint Circle Algorithm](http://en.wikipedia.org/wiki/Midpoint_circle_algorithm)\n * \n * @example Draw outline of circle\n * ```js\n * const circle = { x: 100, y: 100, radius: 50 }\n * for (const pt of Circles.exteriorIntegerPoints(circle)) {\n *  // Fill 1x1 pixel\n *  ctx.fillRect(pt.x, pt.y, 1, 1);\n * }\n * ```\n * @param circle \n */\nexport function* exteriorIntegerPoints(circle: CirclePositioned): IterableIterator<Point> {\n  const { x, y, radius } = circle;\n\n  let xx = radius;\n  let yy = 0;\n  let radiusError = 1 - x;\n  while (xx >= yy) {\n    yield { x: xx + x, y: yy + y };\n    yield { x: yy + x, y: xx + y };\n    yield { x: -xx + x, y: yy + y };\n    yield { x: -yy + x, y: xx + y };\n    yield { x: -xx + x, y: -yy + y };\n    yield { x: -yy + x, y: -xx + y };\n    yield { x: xx + x, y: -yy + y };\n    yield { x: yy + x, y: -xx + y }\n    yy++;\n    if (radiusError < 0) {\n      radiusError += 2 * yy + 1;\n    } else {\n      xx--;\n      radiusError += 2 * (yy - xx + 1);\n    }\n  }\n}\n\n","import type { CirclePositioned } from \"./circle-type.js\";\nimport { distance } from \"../point/distance.js\";\nimport type { Point } from '../point/point-type.js';\n\n/**\n * Returns all integer points contained within `circle`.\n * \n * ```js\n * const c = { x:100, y:100, radius:100 };\n * for (const pt of Circles.interiorIntegerPoints(c)) {\n *   ctx.fillRect(pt.x, pt.y, 1, 1);\n * }\n * ```\n * @param circle \n */\nexport function* interiorIntegerPoints(circle: CirclePositioned): IterableIterator<Point> {\n  const xMin = circle.x - circle.radius;\n  const xMax = circle.x + circle.radius;\n  const yMin = circle.y - circle.radius;\n  const yMax = circle.y + circle.radius;\n  for (let x = xMin; x < xMax; x++) {\n    for (let y = yMin; y < yMax; y++) {\n      const r = Math.abs(distance(circle, x, y));\n      if (r <= circle.radius) yield { x, y };\n    }\n  }\n}","import type { Point } from \"../point/point-type.js\";\nimport type { Circle, CirclePositioned } from \"./circle-type.js\";\nimport { guard, isCirclePositioned } from \"./guard.js\";\nimport { distance as PointsDistance } from \"../point/distance.js\";\nimport { minIndex } from \"@ixfx/numbers\";\nconst piPi = Math.PI * 2;\n\n/**\n * Returns the nearest point on `circle`'s perimeter closest to `point`.\n * \n * ```js\n * const pt = Circles.nearest(circle, {x:10,y:10});\n * ```\n * \n * If an array of circles is provided, it will be the closest point amongst all the circles\n * @param circle Circle or array of circles\n * @param point\n * @returns Point `{ x, y }`\n */\nexport const nearest = (circle: CirclePositioned | readonly CirclePositioned[], point: Point): Point => {\n  const n = (a: CirclePositioned): Point => {\n    const l = Math.sqrt(Math.pow(point.x - a.x, 2) + Math.pow(point.y - a.y, 2));\n    const x = a.x + (a.radius * ((point.x - a.x) / l));\n    const y = a.y + (a.radius * ((point.y - a.y) / l));\n    return { x, y };\n  };\n\n  if (Array.isArray(circle)) {\n    const pts = circle.map(l => n(l));\n    const dists = pts.map(p => PointsDistance(p, point));\n    return Object.freeze<Point>(pts[ minIndex(...dists) ]);\n  } else {\n    return Object.freeze<Point>(n(circle as CirclePositioned));\n  }\n};\n\n/**\n * Returns a point on a circle's perimeter at a specified angle in radians\n * \n * ```js\n * // Circle without position\n * const circleA = { radius: 5 };\n * \n * // Get point at angle Math.PI, passing in a origin coordinate\n * const ptA = Circles.pointOnPerimeter(circleA, Math.PI, {x: 10, y: 10 });\n * \n * // Point on circle with position\n * const circleB = { radius: 5, x: 10, y: 10};\n * const ptB = Circles.pointOnPerimeter(circleB, Math.PI);\n * ```\n * @param circle\n * @param angleRadian Angle in radians\n * @param origin or offset of calculated point. By default uses center of circle or 0,0 if undefined\n * @returns Point oo circle\n */\nexport const pointOnPerimeter = (circle: Circle | CirclePositioned, angleRadian: number, origin?: Point): Point => {\n  if (origin === undefined) {\n    origin = isCirclePositioned(circle) ? circle : { x: 0, y: 0 };\n  }\n  return {\n    x: (Math.cos(-angleRadian) * circle.radius) + origin.x,\n    y: (Math.sin(-angleRadian) * circle.radius) + origin.y\n  };\n};\n\n/**\n * Returns circumference of `circle` (alias of {@link length})\n * @param circle \n * @returns \n */\nexport const circumference = (circle: Circle): number => {\n  guard(circle);\n  return piPi * circle.radius;\n};\n\n/**\n * Returns circumference of `circle` (alias of {@link circumference})\n * @param circle \n * @returns \n */\nexport const length = (circle: Circle): number => circumference(circle);\n","import type { Point } from \"../point/point-type.js\";\nimport type { CirclePositioned } from \"./circle-type.js\";\nimport { pointOnPerimeter } from \"./perimeter.js\";\nconst piPi = Math.PI * 2;\n/**\n * Computes relative position along circle perimeter\n * \n * ```js\n * const circle = { radius: 100, x: 100, y: 100 };\n * \n * // Get a point halfway around circle\n * // Yields { x, y }\n * const pt = Circles.interpolate(circle, 0.5);\n * ```\n * @param circle \n * @param t Position, 0-1\n * @returns \n */\nexport const interpolate = (circle: CirclePositioned, t: number): Point => pointOnPerimeter(circle, t * piPi);\n","import type { Circle, CirclePositioned } from \"./circle-type.js\";\nimport { isCirclePositioned } from \"./guard.js\";\n\n/**\n * Returns true if the two objects have the same values\n *\n * ```js\n * const circleA = { radius: 10, x: 5, y: 5 };\n * const circleB = { radius: 10, x: 5, y: 5 };\n * \n * circleA === circleB; // false, because identity of objects is different\n * Circles.isEqual(circleA, circleB); // true, because values are the same\n * ```\n * \n * Circles must both be positioned or not.\n * @param a\n * @param b\n * @returns\n */\nexport const isEqual = (a: CirclePositioned | Circle, b: CirclePositioned | Circle): boolean => {\n  if (a.radius !== b.radius) return false;\n\n  if (isCirclePositioned(a) && isCirclePositioned(b)) {\n    if (a.x !== b.x) return false;\n    if (a.y !== b.y) return false;\n    if (a.z !== b.z) return false;\n    return true;\n  } else if (!isCirclePositioned(a) && !isCirclePositioned(b)) {\n    // no-op\n  } else return false; // one is positioned one not\n\n  return false;\n};","import { getTwoPointParameters } from \"./get-point-parameter.js\";\nimport { guard, isPoint3d } from \"./guard.js\";\nimport type { Point, Point3d } from \"./point-type.js\";\nimport type { Writeable } from \"@ixfx/core\";\n\nexport function sum(a: Point, b: Point): Point;\nexport function sum(a: Point3d, b: Point3d): Point3d;\nexport function sum(a: Point, x: number, y: number): Point;\nexport function sum(a: Point3d, x: number, y: number, z: number): Point3d;\nexport function sum(ax: number, ay: number, bx: number, by: number): Point;\nexport function sum(ax: number, ay: number, az: number, bx: number, by: number, bz: number): Point3d;\n\n/**\n * Returns a Point with the x,y,z values of two points added.\n * \n * `z` parameter is used, if present. Uses a default value of 0 for 'z' when adding a 2D point with a 3D one.\n *\n * Examples:\n *\n * ```js\n * sum(ptA, ptB);\n * sum(x1, y1, x2, y2);\n * sum(ptA, x2, y2);\n * ```\n */\nexport function sum(\n  a1: Point | Point3d | number, ab2: Point | Point3d | number, ab3?: number, ab4?: number, ab5?: number, ab6?: number\n): Point | Point3d {\n  const [ ptA, ptB ] = getTwoPointParameters(a1 as any, ab2 as any, ab3 as any, ab4 as any, ab5 as any, ab6 as any);\n  guard(ptA, `a`);\n  guard(ptB, `b`);\n  const pt: Writeable<Point> = {\n    x: ptA.x + ptB.x,\n    y: ptA.y + ptB.y,\n  };\n  if (isPoint3d(ptA) || isPoint3d(ptB)) {\n    pt.z = (ptA.z ?? 0) + (ptB.z ?? 0);\n  };\n  return Object.freeze(pt);\n};\n","import { isEqual } from \"./is-equal.js\";\nimport { sum as PointsSum } from \"../point/sum.js\";\nimport { subtract as PointsSubtract } from \"../point/subtract.js\";\nimport type { Point } from '../point/point-type.js';\nimport type { CirclePositioned } from \"./circle-type.js\";\nimport type { Line } from \"../line/line-type.js\";\n\n/**\n * Returns the point(s) of intersection between a circle and line.\n * \n * ```js\n * const circle = { radius: 5, x: 5, y: 5 };\n * const line = { a: { x: 0, y: 0 }, b: { x: 10, y: 10 } };\n * const pts = Circles.intersectionLine(circle, line);\n * ```\n * @param circle \n * @param line \n * @returns Point(s) of intersection, or empty array\n */\nexport const intersectionLine = (circle: CirclePositioned, line: Line): readonly Point[] => {\n  const v1 = {\n    x: line.b.x - line.a.x,\n    y: line.b.y - line.a.y\n  };\n  const v2 = {\n    x: line.a.x - circle.x,\n    y: line.a.y - circle.y\n  };\n\n  const b = (v1.x * v2.x + v1.y * v2.y) * -2;\n  const c = 2 * (v1.x * v1.x + v1.y * v1.y);\n\n  const d = Math.sqrt(b * b - 2 * c * (v2.x * v2.x + v2.y * v2.y - circle.radius * circle.radius));\n  if (Number.isNaN(d)) return []; // no intercept\n\n  const u1 = (b - d) / c;  // these represent the unit distance of point one and two on the line\n  const u2 = (b + d) / c;\n\n  const returnValue: Point[] = [];\n  if (u1 <= 1 && u1 >= 0) {  // add point if on the line segment\n    returnValue.push({\n      x: line.a.x + v1.x * u1,\n      y: line.a.y + v1.y * u1\n    });\n  }\n  if (u2 <= 1 && u2 >= 0) {  // second add point if on the line segment\n    returnValue.push({\n      x: line.a.x + v1.x * u2,\n      y: line.a.y + v1.y * u2\n    });\n  }\n  return returnValue;\n};\n\n\n/**\n * \n * Returns the points of intersection betweeen `a` and `b`.\n * \n * Returns an empty array if circles are equal, one contains the other or if they don't touch at all.\n *\n * @param a Circle\n * @param b Circle\n * @returns Points of intersection, or an empty list if there are none\n */\nexport const intersections = (a: CirclePositioned, b: CirclePositioned): readonly Point[] => {\n  const vector = PointsSubtract(b, a);\n  const centerD = Math.hypot((vector.y), (vector.x));\n\n  // Do not intersect\n  if (centerD > a.radius + b.radius) return [];\n\n  // Circle contains another\n  if (centerD < Math.abs(a.radius - b.radius)) return [];\n\n  // Circles are the same\n  if (isEqual(a, b)) return [];\n\n  const centroidD = ((a.radius * a.radius) - (b.radius * b.radius) + (centerD * centerD)) / (2 * centerD);\n  const centroid = {\n    x: a.x + (vector.x * centroidD / centerD),\n    y: a.y + (vector.y * centroidD / centerD)\n  };\n\n  const centroidIntersectionD = Math.sqrt((a.radius * a.radius) - (centroidD * centroidD));\n\n  const intersection = {\n    x: -vector.y * (centroidIntersectionD / centerD),\n    y: vector.x * (centroidIntersectionD / centerD)\n  };\n  return [\n    PointsSum(centroid, intersection),\n    PointsSubtract(centroid, intersection)\n  ];\n};\n","import { intersections as circleIntersections } from \"./circle/intersections.js\";\nimport type { CirclePositioned } from \"./circle/circle-type.js\";\nimport type { RectPositioned } from \"./rect/index.js\";\n\nexport const circleRect = (a: CirclePositioned, b: RectPositioned) => {\n  // https://yal.cc/rectangle-circle-intersection-test/\n  const deltaX = a.x - Math.max(b.x, Math.min(a.x, b.x + b.width));\n  const deltaY = a.y - Math.max(b.y, Math.min(a.y, b.y + b.height));\n  return (deltaX * deltaX + deltaY * deltaY) < (a.radius * a.radius);\n};\n\nexport const circleCircle = (a: CirclePositioned, b: CirclePositioned) => circleIntersections(a, b).length === 2;","import { isPoint } from \"../point/guard.js\";\nimport { distanceCenter } from \"./distance-center.js\";\nimport { isCircle } from \"./guard.js\";\nimport type { CirclePositioned } from \"./circle-type.js\";\nimport type { Point } from '../point/point-type.js';\n\n/**\n * Returns true if `b` is completely contained by `a`\n *\n * ```js\n * // Compare two points\n * isContainedBy(circleA, circleB);\n * \n * // Compare a circle with a point\n * isContainedBy(circleA, {x: 10, y: 20});\n * \n * // Define radius as third parameter\n * isContainedBy(circleA, {x: 10, y: 20}, 20);\n * ```\n * @param a Circle\n * @param b Circle or point to compare to\n * @param c Radius to accompany parameter b if it's a point\n * @returns\n */\nexport const isContainedBy = (a: CirclePositioned, b: CirclePositioned | Point, c?: number): boolean => {\n  const d = distanceCenter(a, b);\n  if (isCircle(b)) {\n    return (d < Math.abs(a.radius - b.radius));\n  } else if (isPoint(b)) {\n    // eslint-disable-next-line unicorn/prefer-ternary\n    if (c === undefined) {\n      return d <= a.radius;\n    } else {\n      // Defining a circle\n      return (d < Math.abs(a.radius - c));\n    }\n  } else throw new Error(`b parameter is expected to be CirclePositioned or Point`);\n};\n","import type { Point } from \"./point-type.js\";\n\n/**\n * Returns _true_ if the points have identical values\n *\n * ```js\n * const a = {x: 10, y: 10};\n * const b = {x: 10, y: 10;};\n * a === b        // False, because a and be are different objects\n * isEqual(a, b)   // True, because a and b are same value\n * ```\n * @param p Points\n * @returns _True_ if points are equal\n */\nexport const isEqual = (...p: ReadonlyArray<Point>): boolean => {\n  if (p === undefined) throw new Error(`parameter 'p' is undefined`);\n  if (p.length < 2) return true;\n\n  for (let index = 1; index < p.length; index++) {\n    if (p[ index ].x !== p[ 0 ].x) return false;\n    if (p[ index ].y !== p[ 0 ].y) return false;\n  }\n  return true;\n};","import type { CirclePositioned } from \"./circle-type.js\";\nimport * as Intersects from '../intersects.js';\nimport { isContainedBy } from \"./is-contained-by.js\";\nimport { isCircle } from \"./guard.js\";\nimport { isRectPositioned } from \"../rect/guard.js\";\nimport { isEqual as PointsIsEqual } from \"../point/is-equal.js\";\nimport type { Point } from '../point/point-type.js';\nimport { isPoint } from '../point/guard.js';\nimport type { RectPositioned } from \"../rect/index.js\";\n\n/**\n * Returns true if `a` or `b` overlap, are equal, or `a` contains `b`.\n * A circle can be checked for intersections with another CirclePositioned, Point or RectPositioned.\n * \n * Use `intersections` to find the points of intersection.\n *\n * @param a Circle\n * @param b Circle or point to test\n * @returns True if circle overlap\n */\nexport const isIntersecting = (a: CirclePositioned, b: CirclePositioned | Point | RectPositioned, c?: number): boolean => {\n  if (PointsIsEqual(a, b)) return true;\n  if (isContainedBy(a, b, c)) return true;\n  if (isCircle(b)) {\n    return Intersects.circleCircle(a, b);\n  } else if (isRectPositioned(b)) {\n    return Intersects.circleRect(a, b);\n  } else if (isPoint(b) && c !== undefined) {\n    return Intersects.circleCircle(a, { ...b, radius: c });\n  }\n  return false;\n};","import { getTwoPointParameters } from \"./get-point-parameter.js\";\nimport { guard, isPoint3d } from \"./guard.js\";\nimport type { Point, Point3d } from \"./point-type.js\";\nimport type { Writeable } from \"@ixfx/core\";\n\nexport function multiply(a: Point, b: Point): Point;\nexport function multiply(a: Point3d, b: Point3d): Point3d;\nexport function multiply(a: Point, x: number, y: number): Point;\nexport function multiply(a: Point3d, x: number, y: number, z: number): Point3d;\nexport function multiply(ax: number, ay: number, bx: number, by: number): Point;\nexport function multiply(ax: number, ay: number, az: number, bx: number, by: number, bz: number): Point3d;\n\n/**\n * Returns a Point with the x,y,z values of two points multiply (a/b).\n * \n * `z` parameter is used, if present. Uses a default value of 0 for 'z' when multiplying a 2D point with a 3D one.\n *\n * Examples:\n *\n * ```js\n * multiply(ptA, ptB);\n * multiply(x1, y1, x2, y2);\n * multiply(ptA, x2, y2);\n * ```\n */\nexport function multiply(\n  a1: Point | Point3d | number, ab2: Point | Point3d | number, ab3?: number, ab4?: number, ab5?: number, ab6?: number\n): Point | Point3d {\n  const [ ptA, ptB ] = getTwoPointParameters(a1 as any, ab2 as any, ab3 as any, ab4 as any, ab5 as any, ab6 as any);\n  guard(ptA, `a`);\n  guard(ptB, `b`);\n  const pt: Writeable<Point> = {\n    x: ptA.x * ptB.x,\n    y: ptA.y * ptB.y,\n  };\n  if (isPoint3d(ptA) || isPoint3d(ptB)) {\n    pt.z = (ptA.z ?? 0) * (ptB.z ?? 0);\n  };\n  return Object.freeze(pt);\n};\n\n/**\n * Multiplies all components by `v`.\n * Existing properties of `pt` are maintained.\n *\n * ```js\n * multiplyScalar({ x:2, y:4 }, 2);\n * // Yields: { x:4, y:8 }\n * ```\n * @param pt Point\n * @param v Value to multiply by\n * @returns\n */\nexport const multiplyScalar = (\n  pt: Point | Point3d,\n  v: number\n): Point | Point3d => {\n  return isPoint3d(pt) ? Object.freeze({\n    ...pt,\n    x: pt.x * v,\n    y: pt.y * v,\n    z: pt.z * v,\n  }) : Object.freeze({\n    ...pt,\n    x: pt.x * v,\n    y: pt.y * v,\n  });\n};\n\n","import type { CirclePositioned, Circle } from \"./circle-type.js\";\nimport { isCirclePositioned } from \"./guard.js\";\nimport { multiplyScalar as PointsMultiplyScalar } from '../point/multiply.js';\n\nexport function multiplyScalar(a: CirclePositioned, value: number): CirclePositioned;\nexport function multiplyScalar(a: Circle, value: number): Circle;\n\n/**\n * Multiplies a circle's radius and position (if provided) by `value`.\n * \n * ```js\n * multiplyScalar({ radius: 5 }, 5);\n * // Yields: { radius: 25 }\n * \n * multiplyScalar({ radius: 5, x: 10, y: 20 }, 5);\n * // Yields: { radius: 25, x: 50, y: 100 }\n * ```\n */\nexport function multiplyScalar(a: Circle | CirclePositioned, value: number): Circle | CirclePositioned {\n  if (isCirclePositioned(a)) {\n    const pt = PointsMultiplyScalar(a, value);\n    return Object.freeze({\n      ...a,\n      ...pt,\n      radius: a.radius * value\n    });\n  } else {\n    return Object.freeze({\n      ...a,\n      radius: a.radius * value\n    });\n  }\n}\n\n","import type { Point } from \"../point/point-type.js\";\nimport type { Circle, CirclePositioned, CircleRandomPointOpts } from \"./circle-type.js\";\nimport { isCirclePositioned } from \"./guard.js\";\nimport { sum as PointsSum } from \"../point/sum.js\";\nimport { toCartesian as PolarToCartesian } from \"../polar/index.js\";\nconst piPi = Math.PI * 2;\n/**\n * Returns a random point within a circle.\n * \n * By default creates a uniform distribution.\n * \n * ```js\n * const pt = randomPoint({radius: 5});\n * const pt = randomPoint({radius: 5, x: 10, y: 20});\n * ```'\n * \n * Generate points with a gaussian distribution\n * ```js\n * const pt = randomPoint(circle, {\n *  randomSource: Random.gaussian\n * })\n * ```\n * @param within Circle to generate a point within\n * @param opts Options\n * @returns \n */\nexport const randomPoint = (within: Circle | CirclePositioned, opts: Partial<CircleRandomPointOpts> = {}): Point => {\n  const offset: Point = isCirclePositioned(within) ? within : { x: 0, y: 0 };\n  const strategy = opts.strategy ?? `uniform`;\n  const margin = opts.margin ?? 0;\n  const radius = within.radius - margin;\n  const rand = opts.randomSource ?? Math.random;\n  switch (strategy) {\n    case `naive`: {\n      return PointsSum(offset, PolarToCartesian(rand() * radius, rand() * piPi));\n    }\n    case `uniform`: {\n      return PointsSum(offset, PolarToCartesian(Math.sqrt(rand()) * radius, rand() * piPi));\n    }\n    default: {\n\n      throw new Error(`Unknown strategy '${ strategy }'. Expects 'uniform' or 'naive'`);\n    }\n  }\n};","import type { Point } from \"../point/point-type.js\";\nimport type { Circle, CirclePositioned, CircleToSvg } from \"./circle-type.js\";\nimport { isCircle, isCirclePositioned } from \"./guard.js\";\n\n\n\n\n/**\n * Creates a SVG path segment.\n * @param a Circle or radius\n * @param sweep If true, path is 'outward'\n * @param origin Origin of path. Required if first parameter is just a radius or circle is non-positioned\n * @returns \n */\nexport const toSvg: CircleToSvg = (a: CirclePositioned | number | Circle, sweep: boolean, origin?: Point): readonly string[] => {\n  if (isCircle(a)) {\n    if (origin !== undefined) {\n      return toSvgFull(a.radius, origin, sweep);\n    }\n    if (isCirclePositioned(a)) {\n      return toSvgFull(a.radius, a, sweep);\n    } else throw new Error(`origin parameter needed for non-positioned circle`);\n  } else {\n    if (origin === undefined) { throw new Error(`origin parameter needed`); } else {\n      return toSvgFull(a, origin, sweep);\n    }\n  }\n};\n\nconst toSvgFull = (radius: number, origin: Point, sweep: boolean): readonly string[] => {\n  // https://stackoverflow.com/questions/5737975/circle-drawing-with-svgs-arc-path\n  const { x, y } = origin;\n  const s = sweep ? `1` : `0`;\n  return `\n    M ${ x }, ${ y }\n    m -${ radius }, 0\n    a ${ radius },${ radius } 0 1,${ s } ${ radius * 2 },0\n    a ${ radius },${ radius } 0 1,${ s } -${ radius * 2 },0\n  `.split(`\\n`);\n};\n","import type { Point } from \"../point/point-type.js\";\nimport { bbox } from \"./bbox.js\";\nimport type { CirclePositioned } from \"./circle-type.js\";\nimport type { CircularPath } from \"./circular-path.js\";\nimport { guard } from \"./guard.js\";\nimport { interpolate } from \"./interpolate.js\";\nimport { nearest } from \"./perimeter.js\";\nimport { toSvg } from \"./svg.js\";\nimport { circumference } from \"./perimeter.js\";\n/**\n * Returns a `CircularPath` representation of a circle\n *\n * @param {CirclePositioned} circle\n * @returns {CircularPath}\n */\nexport const toPath = (circle: CirclePositioned): CircularPath => {\n  guard(circle);\n\n  return {\n    ...circle,\n    nearest: (point: Point) => nearest(circle, point),\n    /**\n     * Returns a relative (0.0-1.0) point on a circle. 0=3 o'clock, 0.25=6 o'clock, 0.5=9 o'clock, 0.75=12 o'clock etc.\n     * @param {t} Relative (0.0-1.0) point\n     * @returns {Point} X,y\n     */\n    interpolate: (t: number) => interpolate(circle, t),\n    bbox: () => bbox(circle),\n    length: () => circumference(circle),\n    toSvgString: (sweep = true) => toSvg(circle, sweep),\n    relativePosition: (_point: Point, _intersectionThreshold: number) => {\n      throw new Error(`Not implemented`)\n    },\n    distanceToPoint: (_point: Point): number => {\n      throw new Error(`Not implemented`)\n    },\n    kind: `circular`\n  };\n};","import type { Circle, CirclePositioned } from \"./circle-type.js\";\nimport { isCirclePositioned } from \"./guard.js\";\nimport type { Point } from '../point/point-type.js';\nimport { getPointParameter } from \"../point/get-point-parameter.js\";\n\n\n/**\n * Returns a positioned version of a circle.\n * If circle is already positioned, it is returned.\n * If no default position is supplied, 0,0 is used.\n * @param circle \n * @param defaultPositionOrX \n * @param y \n * @returns \n */\nexport const toPositioned = (circle: Circle | CirclePositioned, defaultPositionOrX?: Point | number, y?: number): CirclePositioned => {\n  if (isCirclePositioned(circle)) return circle;\n\n  // Returns 0,0 if params are undefined\n  const pt = getPointParameter(defaultPositionOrX, y);\n  return Object.freeze({\n    ...circle,\n    ...pt\n  });\n};","export * from './area.js';\nexport * from './bbox.js';\nexport * from './center.js';\nexport type * from './circle-type.js';\nexport * from './circular-path.js';\nexport * from './distance-center.js';\nexport * from './distance-from-exterior.js';\nexport * from './exterior-points.js';\nexport * from './guard.js';\nexport * from './interior-points.js';\nexport * from './interpolate.js';\nexport * from './intersecting.js';\nexport * from './intersections.js';\nexport * from './is-contained-by.js';\nexport * from './is-equal.js';\nexport * from './multiply.js';\nexport * from './perimeter.js';\nexport * from './random.js';\nexport * from './svg.js';\nexport * from './to-path.js';\nexport * from './to-positioned.js';\n\n","import type { Grid, GridCell } from \"./types.js\";\n\n/**\n * Returns _true_ if cell coordinates are above zero and within bounds of grid\n *\n * @param grid\n * @param cell\n * @return\n */\nexport const inside = (grid: Grid, cell: GridCell): boolean => {\n  if (cell.x < 0 || cell.y < 0) return false;\n  if (cell.x >= grid.cols || cell.y >= grid.rows) return false;\n  return true;\n};\n\n\n","import { inside } from \"./inside.js\";\nimport type { GridCell, Grid } from \"./types.js\";\n\n/**\n * Returns true if `cell` parameter is a cell with x,y fields.\n * Does not check validity of fields.\n *\n * @param cell\n * @return True if parameter is a cell\n */\nexport const isCell = (cell: GridCell | undefined): cell is GridCell => {\n  if (cell === undefined) return false;\n  return `x` in cell && `y` in cell;\n};\n\n/**\n * Throws an exception if any of the cell's parameters are invalid\n * @private\n * @param cell\n * @param parameterName\n * @param grid\n */\nexport const guardCell = (\n  cell: GridCell,\n  parameterName = `Param`,\n  grid?: Grid\n) => {\n  if (cell === undefined) {\n    throw new Error(parameterName + ` is undefined. Expecting {x,y}`);\n  }\n  if (cell.x === undefined) throw new Error(parameterName + `.x is undefined`);\n  if (cell.y === undefined) throw new Error(parameterName + `.y is undefined`);\n  if (Number.isNaN(cell.x)) throw new Error(parameterName + `.x is NaN`);\n  if (Number.isNaN(cell.y)) throw new Error(parameterName + `.y is NaN`);\n  if (!Number.isInteger(cell.x)) {\n    throw new TypeError(parameterName + `.x is non-integer`);\n  }\n  if (!Number.isInteger(cell.y)) {\n    throw new TypeError(parameterName + `.y is non-integer`);\n  }\n  if (grid !== undefined && !inside(grid, cell)) {\n    throw new Error(\n      `${ parameterName } is outside of grid. Cell: ${ cell.x },${ cell.y } Grid: ${ grid.cols }, ${ grid.rows }`\n    );\n  }\n};\n\n/**\n * Throws an exception if any of the grid's parameters are invalid\n * @param grid\n * @param parameterName\n */\nexport const guardGrid = (grid: Grid, parameterName = `Param`) => {\n  if (grid === undefined) {\n    throw new Error(`${ parameterName } is undefined. Expecting grid.`);\n  }\n  if (!(`rows` in grid)) throw new Error(`${ parameterName }.rows is undefined`);\n  if (!(`cols` in grid)) throw new Error(`${ parameterName }.cols is undefined`);\n\n  if (!Number.isInteger(grid.rows)) {\n    throw new TypeError(`${ parameterName }.rows is not an integer`);\n  }\n  if (!Number.isInteger(grid.cols)) {\n    throw new TypeError(`${ parameterName }.cols is not an integer`);\n  }\n};","import { clampIndex } from \"@ixfx/numbers\";\nimport { guardCell, guardGrid } from \"./guards.js\";\nimport type { GridBoundsLogic, GridCell, Grid } from \"./types.js\";\n\n/**\n * Calculates a legal position for a cell based on\n * `grid` size and `bounds` wrapping logic.\n * @param grid \n * @param cell \n * @param wrap \n * @returns \n */\nexport const applyBounds = function (\n  grid: Grid,\n  cell: GridCell,\n  wrap: GridBoundsLogic = `undefined`\n): GridCell | undefined {\n  guardGrid(grid, `grid`);\n  guardCell(cell, `cell`);\n\n  let x = cell.x;\n  let y = cell.y;\n  switch (wrap) {\n    case `wrap`: {\n      x = x % grid.cols;\n      y = y % grid.rows;\n      if (x < 0) x = grid.cols + x;\n      else if (x >= grid.cols) {\n        x -= grid.cols;\n      }\n      if (y < 0) y = grid.rows + y;\n      else if (y >= grid.rows) {\n        y -= grid.rows;\n      }\n      x = Math.abs(x);\n      y = Math.abs(y);\n      break;\n    }\n    case `stop`: {\n      x = clampIndex(x, grid.cols);\n      y = clampIndex(y, grid.rows);\n      break;\n    }\n    case `undefined`: {\n      if (x < 0 || y < 0) return;\n      if (x >= grid.cols || y >= grid.rows) return;\n      break;\n    }\n    case `unbounded`: {\n      break;\n    }\n    default: {\n      throw new Error(`Unknown BoundsLogic '${ wrap }'. Expected: wrap, stop, undefined or unbounded`);\n    }\n  }\n  return Object.freeze({ x, y });\n};","import { integerTest, resultThrow } from \"@ixfx/guards\";\nimport { indexFromCell } from \"./index.js\";\nimport type { GridCellAccessor, GridCell, GridBoundsLogic, Grid, GridCellSetter, GridReadable, GridWritable, GridArray1d } from \"./types.js\";\n\n/**\n * Returns a {@link GridCellAccessor} to get values from `array`\n * based on cell (`{x,y}`) coordinates.\n * \n * ```js\n * const arr = [\n *  1,2,3,\n *  4,5,6\n * ]\n * const a = access(arr, 3);\n * a({x:0,y:0});  // 1\n * a({x:2, y:2}); // 6\n * ```\n * @param array \n * @param cols \n * @returns \n */\nexport const access = <V>(\n  array: readonly V[],\n  cols: number\n): GridCellAccessor<V> => {\n  const grid = gridFromArrayDimensions(array, cols);\n\n  const fn: GridCellAccessor<V> = (\n    cell: GridCell,\n    wrap: GridBoundsLogic = `undefined`\n  ): V | undefined => accessWithGrid(grid, array, cell, wrap);\n  return fn;\n};\n\nconst accessWithGrid = <T>(grid: Grid, array: readonly T[] | T[], cell: GridCell, wrap: GridBoundsLogic) => {\n  const index = indexFromCell(grid, cell, wrap);\n  if (index === undefined) return undefined;\n  return array[ index ];\n}\n\n/**\n * Returns a {@link GridCellSetter} that can mutate\n * array values based on cell {x,y} positions.\n * ```js\n * const arr = [\n *  1,2,3,\n *  4,5,6\n * ]\n * const a = setMutate(arr, 3);\n * a(10, {x:0,y:0});\n * a(20, {x:2, y:2});\n * \n * // Arr is now:\n * // [\n * //  10, 2, 3,\n * //  4, 5, 20\n * // ]\n * ```\n * @param array \n * @param cols \n * @returns \n */\nexport const setMutate = <V>(\n  array: V[],\n  cols: number\n): GridCellSetter<V> => {\n  const grid = gridFromArrayDimensions(array, cols);\n  return (value: V, cell: GridCell, wrap: GridBoundsLogic = `undefined`) => setMutateWithGrid(grid, array, value, cell, wrap);\n}\n\nconst setMutateWithGrid = <V>(\n  grid: Grid,\n  array: V[],\n  value: V, cell: GridCell, wrap: GridBoundsLogic\n) => {\n  const index = indexFromCell(grid, cell, wrap);\n  if (index === undefined) throw new RangeError(`Cell (${ cell.x },${ cell.y }) is out of range of grid cols: ${ grid.cols } rows: ${ grid.rows }`);\n  array[ index ] = value;\n  return array;\n}\n\nexport const set = <V>(\n  array: readonly V[],\n  cols: number\n) => {\n  const grid = gridFromArrayDimensions(array, cols);\n  return (value: V, cell: GridCell, wrap: GridBoundsLogic) => setWithGrid(grid, array, value, cell, wrap);\n}\n\nconst setWithGrid = <V>(\n  grid: Grid,\n  array: readonly V[],\n  value: V, cell: GridCell, wrap: GridBoundsLogic\n) => {\n  const index = indexFromCell(grid, cell, wrap);\n  if (index === undefined) throw new RangeError(`Cell (${ cell.x },${ cell.y }) is out of range of grid cols: ${ grid.cols } rows: ${ grid.rows }`);\n  const copy = [ ...array ];\n  copy[ index ] = value;\n  array = copy;\n  return copy;\n}\n\n/**\n * Creates a {@link Grid} from the basis of an array and a given number of columns\n * @param array \n * @param cols \n * @returns \n */\nconst gridFromArrayDimensions = <T>(array: readonly T[] | T[], cols: number): Grid => {\n  const grid = { cols, rows: Math.ceil(array.length / cols) };\n  return grid;\n}\n\n\n/**\n * Wraps `array` for grid access.\n * Mutable, meaning that `array` gets modified if `set` function is used.\n *  \n * ```js\n * const g = wrapMutable(myArray, 5); // 5 columns wide\n * g.get({x:1,y:2});     // Get value at cell position\n * g.set(10, {x:1,y:2}); // Set value at cell position\n * g.array;              // Get reference to original passed-in array\n * ```\n * \n * Use {@link wrap} for an immutable version.\n * \n * @param array Array to wrap\n * @param cols Width of grid\n * @returns \n */\nexport const wrapMutable = <T>(array: T[], cols: number): GridArray1d<T> => {\n  const grid = gridFromArrayDimensions(array, cols);\n  return {\n    ...grid,\n    get: access(array, cols),\n    set: setMutate(array, cols),\n    get array() {\n      return array;\n    }\n  }\n}\n\n/**\n * Wraps `array` for grid access.\n * Immutable, such that underlying array is not modified and a\n * call to `set` returns a new `GridArray1d`.\n * \n * ```js\n * const myArray = [\n *    `a`, `b`, `c`, \n *    `d`, `e`, `f` \n * ];\n * let g = wrap(myArray, 3);  // 3 columns wide\n * g.get({ x:1, y:2 });          // Get value at cell position\n * \n * // Note that `set` returns a new instance\n * g = g.set(10, { x:1, y:2 });  // Set value at cell position\n * g.array;                      // Get reference to current array\n * ```\n * \n * Use {@link wrapMutable} to modify an array in-place\n * @param array Array to wrap\n * @param cols Width of grid\n * @returns \n */\nexport const wrap = <T>(array: T[], cols: number): GridArray1d<T> => {\n  const grid = gridFromArrayDimensions(array, cols);\n  return {\n    ...grid,\n    get: (cell: GridCell, boundsLogic: GridBoundsLogic = `undefined`) => accessWithGrid(grid, array, cell, boundsLogic),\n    set: (value: T, cell: GridCell, boundsLogic: GridBoundsLogic = `undefined`) => {\n      array = setWithGrid(grid, array, value, cell, boundsLogic);\n      return wrap(array, cols);\n    },\n    get array() {\n      return array;\n    }\n  }\n}\n\n/**\n * Creates a 1-dimensional array to fit a grid of rows x cols.\n * Use {@link createArray} if you want to create this array and wrap it for grid access.\n * \n * ```js\n * // Creates an array filled with 0, sized for a grid 10 rows by 20 columns\n * const arr = createArray(0, 10, 20);\n * \n * // Alternatively, pass in a grid\n * const arr = createArray(0, { rows: 10, cols: 20 });\n * ```\n * @param rowsOrGrid Number of rows, or a grid to use the settings of\n * @param columns Columns\n */\nexport const createArray = <T>(initialValue: T, rowsOrGrid: number | Grid, columns?: number): T[] => {\n  const rows = typeof rowsOrGrid === `number` ? rowsOrGrid : rowsOrGrid.rows;\n  const cols = typeof rowsOrGrid === `object` ? rowsOrGrid.cols : columns;\n  if (!cols) throw new Error(`Parameter 'columns' missing`);\n  resultThrow(\n    integerTest(rows, `aboveZero`, `rows`),\n    integerTest(cols, `aboveZero`, `cols`)\n  );\n\n  const t: T[] = [];\n  const total = rows * cols;\n  for (let index = 0; index < total; index++) {\n    t[ index ] = initialValue;\n  }\n  return t;\n}\n\n/**\n * Creates a {@link GridArray1d} instance given the dimensions of the grid.\n * Use {@link createArray} if you just want to create an array sized for a grid.\n * \n * Behind the scenes, it runs:\n * ```js\n * const arr = createArray(initialValue, rows, cols);\n * return wrapMutable(arr, cols);\n * ```\n * @param initialValue \n * @param rowsOrGrid \n * @param columns \n * @returns \n */\nexport const createMutable = <T>(initialValue: T, rowsOrGrid: number | Grid, columns?: number): GridArray1d<T> => {\n  const rows = typeof rowsOrGrid === `number` ? rowsOrGrid : rowsOrGrid.rows;\n  const cols = typeof rowsOrGrid === `object` ? rowsOrGrid.cols : columns;\n  if (!cols) throw new Error(`Parameter 'columns' missing`);\n  const array = createArray(initialValue, rows, cols);\n  return wrapMutable(array, cols);\n}\n","import { applyBounds } from \"./apply-bounds.js\";\nimport type { GridBoundsLogic, GridCell, GridCellAccessor, GridCellSetter, Grid, GridReadable, GridWritable } from \"./types.js\";\n\nexport type ArrayGrid<T> = GridReadable<T> & GridWritable<T> & {\n  array: T[][]\n}\n\n/**\n * Create a grid from a 2-dimensional array.\n * ```js\n * const data = [\n *  [1,2,3],\n *  [4,5,6]\n * ]\n * const g = create(data);\n * // { rows: 2, cols: 3 }\n * ```\n * @param array \n * @returns \n */\nexport const create = <T>(array: ReadonlyArray<T[]> | Array<T[]>): Grid => {\n  let colLen = NaN;\n  for (const row of array) {\n    if (Number.isNaN(colLen)) {\n      colLen = row.length;\n    } else {\n      if (colLen !== row.length) throw new Error(`Array does not have uniform column length`);\n    }\n  }\n\n  return { rows: array.length, cols: colLen };\n}\n\nexport const setMutate = <V>(\n  array: V[][]\n): GridCellSetter<V> => {\n  const grid = create(array);\n  return (value: V, cell: GridCell, wrap: GridBoundsLogic = `undefined`) => setMutateWithGrid(grid, array, value, cell, wrap);\n}\n\n/**\n * Returns a function that updates a 2D array representation\n * of a grid. Array is mutated.\n *\n * ```js\n * const m = Grids.Array2d.setMutateWithGrid(grid, array);\n * m(someValue, { x:2, y:3 });\n * ```\n * @param grid\n * @param array\n * @returns\n */\nconst setMutateWithGrid = <V>(\n  grid: Grid,\n  array: V[][],\n  value: V, cell: GridCell, bounds: GridBoundsLogic\n) => {\n  let boundCell = applyBounds(grid, cell, bounds);\n  if (boundCell === undefined) throw new RangeError(`Cell (${ cell.x },${ cell.y }) is out of range of grid cols: ${ grid.cols } rows: ${ grid.rows }`);\n  array[ boundCell.y ][ boundCell.x ] = value;\n  return array;\n}\n// export const array2dUpdater = <V>(grid: GridVisual, array: Array<Array<V>>) => {\n//   const fn = (v: V, position: Cell) => {\n//     const pos = cellAtPoint(grid, position);\n//     if (pos === undefined) {\n//       throw new Error(\n//         `Position does not exist. Pos: ${ JSON.stringify(\n//           position\n//         ) } Grid: ${ JSON.stringify(grid) }`\n//       );\n//     }\n//     array[ pos.y ][ pos.x ] = v;\n//   };\n//   return fn;\n// };\n\nexport const access = <T>(\n  array: ReadonlyArray<T[]>\n): GridCellAccessor<T> => {\n  const grid = create(array);\n\n  const fn: GridCellAccessor<T> = (\n    cell: GridCell,\n    wrap: GridBoundsLogic = `undefined`\n  ): T | undefined => accessWithGrid(grid, array, cell, wrap);\n  return fn;\n};\n\nconst accessWithGrid = <T>(grid: Grid, array: ReadonlyArray<T[]> | Array<T[]>, cell: GridCell, wrap: GridBoundsLogic) => {\n  let boundCell = applyBounds(grid, cell, wrap);\n  if (boundCell === undefined) return undefined;\n  return array[ boundCell.y ][ boundCell.x ];\n}\n\nexport const wrapMutable = <T>(array: T[][]): ArrayGrid<T> => {\n  const grid = create(array);\n  return {\n    ...grid,\n    get: access(array),\n    set: setMutate(array),\n    get array() {\n      return array;\n    }\n  }\n}\n\nexport const set = <V>(\n  array: readonly V[][]\n) => {\n  const grid = create(array);\n  return (value: V, cell: GridCell, wrap: GridBoundsLogic) => setWithGrid(grid, array, value, cell, wrap);\n}\n\nconst setWithGrid = <V>(\n  grid: Grid,\n  array: readonly V[][],\n  value: V, cell: GridCell, wrap: GridBoundsLogic\n) => {\n  let boundCell = applyBounds(grid, cell, wrap);\n  if (boundCell === undefined) throw new RangeError(`Cell (${ cell.x },${ cell.y }) is out of range of grid cols: ${ grid.cols } rows: ${ grid.rows }`);\n  let copyWhole = [ ...array ];\n  let copyRow = [ ...copyWhole[ boundCell.y ] ];\n  copyRow[ boundCell.x ] = value;\n  copyWhole[ boundCell.y ] = copyRow;\n  array = copyWhole;\n  return copyWhole;\n}\n\n/**\n * Wraps `array` with two dimensions for grid access.\n * Immutable, such that underlying array is not modified and a\n * call to `set` returns a new `GridArray1d`.\n * \n * ```js\n * // Grid of rows: 2, cols: 3\n * const myArray = [\n *  [ `a`, `b`, `c` ],\n *  [ `d`, `e`, `f` ]\n * ]\n * let g = wrap(myArray);\n * g.get({x:1,y:2});          // Get value at cell position\n * g = g.set(10, {x:1,y:2}); // Set value at cell position\n * g.array;                  // Get reference to current array\n * ```\n * \n * Use {@link wrapMutable} to modify an array in-place\n * @param array Array to wrap\n * @returns \n */\nexport const wrap = <T>(array: T[][]): ArrayGrid<T> => {\n  const grid = create(array);\n  return {\n    ...grid,\n    get: (cell: GridCell, boundsLogic: GridBoundsLogic = `undefined`) => accessWithGrid(grid, array, cell, boundsLogic),\n    set: (value: T, cell: GridCell, boundsLogic: GridBoundsLogic = `undefined`) => {\n      array = setWithGrid(grid, array, value, cell, boundsLogic);\n      return wrap(array);\n    },\n    get array() {\n      return array;\n    }\n  }\n}","import type { GridReadable, GridCell, GridBoundsLogic } from \"./types.js\";\n\n\nexport function values<T>(grid: GridReadable<T>, iter: Iterable<GridCell>): Generator<T>\nexport function values<T>(grid: GridReadable<T>, iter: Iterable<GridCell[]>): Generator<T[]>\n\n/**\n * Converts an 1D or 2D array of cell coordinates into values\n * \n * ```js\n * // 1D (ie an array of coordinates)\n * const cells = Grid.As.cells(grid);\n * for (const v of Grid.values(grid, cells)) {\n * \n * }\n * ```\n * ```js\n * // 2D (ie an array of rows)\n * const rows = Grid.As.rows(grid);\n * for (const v of Grid.values(grid, rows)) {\n * }\n * ```\n * @param grid \n * @param iter \n */\nexport function* values<T>(grid: GridReadable<T>, iter: Iterable<GridCell> | Iterable<GridCell[]>) {\n  for (const d of iter) {\n    if (Array.isArray(d)) {\n      yield d.map(v => grid.get(v, `undefined`));\n    } else {\n      yield grid.get(d, `undefined`);\n    }\n  }\n}\n\n// export function visitValues<T>(readable: GridReadable<T>, visitor: Generator<Cell[]>, wrap?: BoundsLogic): Generator<T[]>\n\n// export function visitValues<T>(readable: GridReadable<T>, visitor: Generator<Cell>, wrap?: BoundsLogic): Generator<T>\n\n// /**\n//  * Visits the values of a readable grid\n//  * @param readable Readable grid\n//  * @param visitor Visitor\n//  * @param wrap Wrapping logic, defaultign to 'undefined'\n//  */\n// export function* visitValues<T>(readable: GridReadable<T>, visitor: Generator<Cell | Cell[]>, wrap: BoundsLogic = `undefined`) {\n//   for (const cellOrCells of visitor) {\n//     if (Array.isArray(cellOrCells)) {\n//       yield cellOrCells.map(cell => readable.accessor(cell, wrap));\n//     } else {\n//       yield readable.accessor(cellOrCells, wrap);\n//     }\n//   }\n// }","import { guardGrid, guardCell } from \"../guards.js\";\nimport type { Grid, GridCell, GridCellAndValue, GridReadable } from \"../types.js\";\nimport { values } from \"../values.js\";\n\n/**\n * Enumerate all cell coordinates in an efficient manner.\n * Runs left-to-right, top-to-bottom.\n * \n * If end of grid is reached, behaviour depends on `wrap`:\n * * _true_ (default): iterator will wrap to ensure all are visited.\n * * _false_: iterator stops at end of grid\n * \n * ```js\n * import { Grids } from 'ixfx/geometry.js';\n * \n * // Enumerate each cell position, left-to-right, top-to-bottom\n * for (const cell of Grids.By.cells(grid)) {\n *  // cell will be { x, y }\n * }\n * ```\n * \n * See also:\n * * {@link cellValues}: Iterate over cell values\n * * {@link cellsAndValues}: Iterate over pairs of cell coordinates and cell values\n * @param grid Grid to iterate over\n * @param start Starting cell position (default: {x:0,y:0})\n * @param wrap If true (default), iteration will wrap around through (0,0) when end of grid is reached.\n */\nexport function* cells(grid: Grid, start?: GridCell, wrap = true) {\n  if (!start) start = { x: 0, y: 0 }\n\n  guardGrid(grid, `grid`);\n  guardCell(start, `start`, grid);\n\n  let { x, y } = start;\n  let canMove = true;\n  do {\n    yield { x, y };\n    x++;\n    if (x === grid.cols) {\n      y++;\n      x = 0;\n    }\n    if (y === grid.rows) {\n      if (wrap) {\n        y = 0;\n        x = 0;\n      } else {\n        canMove = false;\n      }\n    }\n    if (x === start.x && y === start.y) canMove = false; // Complete\n  } while (canMove);\n};\n\n/**\n * Yield all the values of a grid, left-to-right, top-to-bottom.\n * \n * This is just a wrapper around Grids.values:\n * ```js\n * yield* values(grid, cells(grid, start, wrap));\n * ```\n * \n * See also:\n * * {@link cells}: Iterate over cell coordinates\n * * {@link cellsAndValues}: Iterate over pairs of cell coordinates and cell values\n * @param grid \n * @param start \n * @param wrap \n */\nexport function* cellValues<T>(grid: GridReadable<T>, start?: GridCell, wrap = true) {\n  yield* values(grid, cells(grid, start, wrap));\n}\n\n/**\n * Yield all cell coordinates and values of a grid, left-to-right, top-to-bottom\n * \n * See also:\n * * {@link cells}: Iterate over cell coordinates\n * * {@link cellValues}: Iterate over cell values\n * @param grid \n * @param start \n * @param wrap \n */\nexport function* cellsAndValues<T>(grid: GridReadable<T>, start?: GridCell, wrap = true): Generator<GridCellAndValue<T>> {\n  for (const cell of cells(grid, start, wrap)) {\n    yield { cell, value: grid.get(cell) }\n  }\n}","import type { GridCell, Grid, GridReadable } from \"./types.js\";\nimport { cells } from \"./enumerators/cells.js\";\n\n/**\n * Enumerate rows of grid, returning all the cells in the row\n * as an array\n *\n * ```js\n * for (const row of Grid.As.rows(shape)) {\n *  // row is an array of Cells.\n *  // [ {x:0, y:0}, {x:1, y:0} ... ]\n * }\n * ```\n * \n * Use `Grid.values` to convert the returned iterator into values:\n * ```js\n * for (const v of Grid.values(Grid.rows(shape))) {\n * }\n * ```\n * @param grid\n * @param start\n */\nexport const rows = function* (grid: Grid, start?: GridCell) {\n  if (!start) start = { x: 0, y: 0 }\n  let row = start.y;\n  let rowCells: Array<GridCell> = [];\n\n  for (const c of cells(grid, start)) {\n    if (c.y === row) {\n      rowCells.push(c);\n    } else {\n      yield rowCells;\n      rowCells = [ c ];\n      row = c.y;\n    }\n  }\n  if (rowCells.length > 0) yield rowCells;\n};\n\n/**\n * Enumerate columns of grid, returning all the cells in the\n * same column as an array.\n * \n * ```js\n * for (const col of Grid.As.columns(grid)) {\n * }\n * ```\n * \n * Use `Grid.values` to convert into values\n * ```js\n * for (const value of Grid.values(Grid.As.columns(grid))) {\n * }\n * ```\n * @param grid \n * @param start \n */\nexport function* columns(grid: Grid, start?: GridCell) {\n  if (!start) start = { x: 0, y: 0 };\n  for (let x = start.x; x < grid.cols; x++) {\n    let colCells: Array<GridCell> = [];\n    for (let y = start.y; y < grid.rows; y++) {\n      colCells.push({ x, y });\n    }\n    yield colCells;\n  }\n}","//import { clampIndex } from '@ixfx/numbers';\nimport { applyBounds } from './apply-bounds.js';\n//import { guardCell, guardGrid } from './guards.js';\nimport type { Grid, GridCell, GridBoundsLogic } from './types.js';\n\n/**\n * Returns a coordinate offset from `start` by `vector` amount.\n *\n * Different behaviour can be specified for how to handle when coordinates exceed the bounds of the grid\n *\n * Note: x and y wrapping are calculated independently. A large wrapping of x, for example won't shift up/down a line.\n * \n * Use {@link Grids.applyBounds} if you need to calculate a wrapped coordinate without adding two together.\n * @param grid Grid to traverse\n * @param vector Offset in x/y\n * @param start Start point\n * @param bounds\n * @returns Cell\n */\nexport const offset = function (\n  grid: Grid,\n  start: GridCell,\n  vector: GridCell,\n  bounds: GridBoundsLogic = `undefined`\n): GridCell | undefined {\n  return applyBounds(grid, {\n    x: start.x + vector.x,\n    y: start.y + vector.y\n  }, bounds)\n  // guardCell(start, `start`, grid);\n  // guardCell(vector);\n  // guardGrid(grid, `grid`);\n\n  // // eslint-disable-next-line functional/no-let\n  // let x = start.x;\n  // // eslint-disable-next-line functional/no-let\n  // let y = start.y;\n  // switch (bounds) {\n  //   case `wrap`: {\n  //     x += vector.x % grid.cols;\n  //     y += vector.y % grid.rows;\n  //     if (x < 0) x = grid.cols + x;\n  //     else if (x >= grid.cols) {\n  //       x -= grid.cols;\n  //     }\n  //     if (y < 0) y = grid.rows + y;\n  //     else if (y >= grid.rows) {\n  //       y -= grid.rows;\n  //     }\n  //     break;\n  //   }\n  //   case `stop`: {\n  //     x += vector.x;\n  //     y += vector.y;\n  //     x = clampIndex(x, grid.cols);\n  //     y = clampIndex(y, grid.rows);\n  //     break;\n  //   }\n  //   case `undefined`: {\n  //     x += vector.x;\n  //     y += vector.y;\n  //     if (x < 0 || y < 0) return;\n  //     if (x >= grid.cols || y >= grid.rows) return;\n  //     break;\n  //   }\n  //   case `unbounded`: {\n  //     x += vector.x;\n  //     y += vector.y;\n  //     break;\n  //   }\n  //   default: {\n  //     // eslint-disable-next-line @typescript-eslint/restrict-template-expressions\n  //     throw new Error(`Unknown BoundsLogic case ${ bounds }`);\n  //   }\n  // }\n  // return Object.freeze({ x, y });\n};\n\n","import { zipKeyValue } from \"@ixfx/core/maps\";\nimport { integerTest, resultThrow } from \"@ixfx/guards\";\nimport { guardCell, guardGrid } from \"./guards.js\";\nimport type { GridBoundsLogic, GridCardinalDirection, GridCardinalDirectionOptional, GridCell, Grid, GridNeighbours } from \"./types.js\";\nimport { offset } from \"./offset.js\";\n\n/**\n * Returns a list of all cardinal directions: n, ne, nw, e, s, se, sw, w\n */\nexport const allDirections = Object.freeze([\n  `n`,\n  `ne`,\n  `nw`,\n  `e`,\n  `s`,\n  `se`,\n  `sw`,\n  `w`,\n]) as readonly GridCardinalDirection[];\n\n/**\n * Returns a list of + shaped directions: n, e, s, w\n */\nexport const crossDirections = Object.freeze([\n  `n`,\n  `e`,\n  `s`,\n  `w`,\n]) as readonly GridCardinalDirection[];\n\n/**\n * Returns cells that correspond to the cardinal directions at a specified distance\n * i.e. it projects a line from `start` cell in all cardinal directions and returns the cells at `steps` distance.\n * @param grid Grid\n * @param steps Distance\n * @param start Start poiint\n * @param bounds Logic for if bounds of grid are exceeded\n * @returns Cells corresponding to cardinals\n */\nexport const offsetCardinals = (\n  grid: Grid,\n  start: GridCell,\n  steps: number,\n  bounds: GridBoundsLogic = `stop`\n): GridNeighbours => {\n  guardGrid(grid, `grid`);\n  guardCell(start, `start`);\n  resultThrow(integerTest(steps, `aboveZero`, `steps`));\n\n  const directions = allDirections;\n  const vectors = directions.map((d) => getVectorFromCardinal(d, steps));\n  const cells = directions.map((d, index) =>\n    offset(grid, start, vectors[ index ], bounds)\n  );\n\n  return zipKeyValue(directions, cells) as GridNeighbours;\n};\n\n/**\n * Returns an `{ x, y }` signed vector corresponding to the provided cardinal direction.\n * ```js\n * const n = getVectorFromCardinal(`n`); // {x: 0, y: -1}\n * ```\n *\n * Optional `multiplier` can be applied to vector\n * ```js\n * const n = getVectorFromCardinal(`n`, 10); // {x: 0, y: -10}\n * ```\n *\n * Blank direction returns `{ x: 0, y: 0 }`\n * @param cardinal Direction\n * @param multiplier Multipler\n * @returns Signed vector in the form of `{ x, y }`\n */\nexport const getVectorFromCardinal = (\n  cardinal: GridCardinalDirectionOptional,\n  multiplier = 1\n): GridCell => {\n  let v;\n  switch (cardinal) {\n    case `n`: {\n      v = { x: 0, y: -1 * multiplier };\n      break;\n    }\n    case `ne`: {\n      v = { x: 1 * multiplier, y: -1 * multiplier };\n      break;\n    }\n    case `e`: {\n      v = { x: 1 * multiplier, y: 0 };\n      break;\n    }\n    case `se`: {\n      v = { x: 1 * multiplier, y: 1 * multiplier };\n      break;\n    }\n    case `s`: {\n      v = { x: 0, y: 1 * multiplier };\n      break;\n    }\n    case `sw`: {\n      v = { x: -1 * multiplier, y: 1 * multiplier };\n      break;\n    }\n    case `w`: {\n      v = { x: -1 * multiplier, y: 0 };\n      break;\n    }\n    case `nw`: {\n      v = { x: -1 * multiplier, y: -1 * multiplier };\n      break;\n    }\n    default: {\n      v = { x: 0, y: 0 };\n    }\n  }\n  return Object.freeze(v);\n};","//import type { Cell, GridReadable } from '../Types.js';\n\nexport * from './cells.js';\n\n// export function* withValues<T>(grid: GridReadable<T>, iter: IterableIterator<Cell>) {\n//   for (const cell of iter) {\n//     yield { cell, value: grid.get(cell, `undefined`) };\n//   }\n// }","import { guardCell } from \"./guards.js\";\nimport type { GridCell } from \"./types.js\";\n\n/**\n * Returns the cells on the line of `start` and `end`, inclusive\n *\n * ```js\n * // Get cells that connect 0,0 and 10,10\n * const cells = Grids.getLine({x:0,y:0}, {x:10,y:10});\n * ```\n *\n * This function does not handle wrapped coordinates.\n * @param start Starting cell\n * @param end End cell\n * @returns\n */\nexport const getLine = (start: GridCell, end: GridCell): ReadonlyArray<GridCell> => {\n  // https://stackoverflow.com/a/4672319\n  guardCell(start);\n  guardCell(end);\n\n  let startX = start.x;\n  let startY = start.y;\n  const dx = Math.abs(end.x - startX);\n  const dy = Math.abs(end.y - startY);\n  const sx = startX < end.x ? 1 : -1;\n  const sy = startY < end.y ? 1 : -1;\n  let error = dx - dy;\n\n  const cells:GridCell[] = [];\n  // eslint-disable-next-line no-constant-condition\n  while (true) {\n    cells.push(Object.freeze({ x: startX, y: startY }));\n    if (startX === end.x && startY === end.y) break;\n    const error2 = 2 * error;\n    if (error2 > -dy) {\n      error -= dy;\n      startX += sx;\n    }\n    if (error2 < dx) {\n      error += dx;\n      startY += sy;\n    }\n  }\n  return cells;\n};\n\n/**\n * Returns a list of cells from `start` to `end`.\n *\n * Throws an error if start and end are not on same row or column.\n *\n * @param start Start cell\n * @param end end clel\n * @param endInclusive\n * @return Array of cells\n */\nexport const simpleLine = function (\n  start: GridCell,\n  end: GridCell,\n  endInclusive = false\n): ReadonlyArray<GridCell> {\n  const cells: Array<GridCell> = [];\n  if (start.x === end.x) {\n    // Vertical\n    const lastY = endInclusive ? end.y + 1 : end.y;\n    for (let y = start.y; y < lastY; y++) {\n      cells.push({ x: start.x, y: y });\n    }\n  } else if (start.y === end.y) {\n    // Horizontal\n    const lastX = endInclusive ? end.x + 1 : end.x;\n    for (let x = start.x; x < lastX; x++) {\n      cells.push({ x: x, y: start.y });\n    }\n  } else {\n    throw new Error(\n      `Only does vertical and horizontal: ${ start.x },${ start.y } - ${ end.x },${ end.y }`\n    );\n  }\n  return cells;\n};","import { integerTest, resultThrow } from \"@ixfx/guards\";\nimport { guardGrid } from \"./guards.js\";\nimport { offset } from \"./offset.js\";\nimport type { Grid, GridCell, GridBoundsLogic } from \"./types.js\";\n\n/**\n * Returns the index for a given cell.\n * This is useful if a grid is stored in an array.\n *\n * ```js\n * const data = [\n *  1, 2,\n *  3, 4,\n *  5, 6 ];\n * const cols = 2; // Grid of 2 columns wide\n * const index = indexFromCell(cols, {x: 1, y: 1});\n * // Yields an index of 3\n * console.log(data[index]); // Yields 4\n * ```\n *\n * Bounds logic is applied to cell.x/y separately. Wrapping\n * only ever happens in same col/row.\n * @see cellFromIndex\n * @param grid Grid\n * @param cell Cell to get index for\n * @param wrap Logic for if we hit bounds of grid\n * @returns\n */\nexport const indexFromCell = (\n  grid: Grid,\n  cell: GridCell,\n  wrap: GridBoundsLogic\n): number | undefined => {\n  guardGrid(grid, `grid`);\n\n  if (cell.x < 0) {\n    switch (wrap) {\n      case `stop`: {\n        cell = { ...cell, x: 0 };\n        break;\n      }\n      case `unbounded`: {\n        throw new Error(`unbounded not supported`);\n      }\n      case `undefined`: {\n        return undefined;\n      }\n      case `wrap`: {\n        //cell = { ...cell, x: grid.cols + cell.x };\n        cell = offset(grid, { x: 0, y: cell.y }, { x: cell.x, y: 0 }, `wrap`)!;\n        break;\n      }\n    }\n  }\n  if (cell.y < 0) {\n    switch (wrap) {\n      case `stop`: {\n        cell = { ...cell, y: 0 };\n        break;\n      }\n      case `unbounded`: {\n        throw new Error(`unbounded not supported`);\n      }\n      case `undefined`: {\n        return undefined;\n      }\n      case `wrap`: {\n        cell = { ...cell, y: grid.rows + cell.y };\n        break;\n      }\n    }\n  }\n  if (cell.x >= grid.cols) {\n    switch (wrap) {\n      case `stop`: {\n        cell = { ...cell, x: grid.cols - 1 };\n        break;\n      }\n      case `unbounded`: {\n        throw new Error(`unbounded not supported`);\n      }\n      case `undefined`: {\n        return undefined;\n      }\n      case `wrap`: {\n        cell = { ...cell, x: cell.x % grid.cols };\n        break;\n      }\n    }\n  }\n  if (cell.y >= grid.rows) {\n    switch (wrap) {\n      case `stop`: {\n        cell = { ...cell, y: grid.rows - 1 };\n        break;\n      }\n      case `unbounded`: {\n        throw new Error(`unbounded not supported`);\n      }\n      case `undefined`: {\n        return undefined;\n      }\n      case `wrap`: {\n        cell = { ...cell, y: cell.y % grid.rows };\n        break;\n      }\n    }\n  }\n\n  const index = cell.y * grid.cols + cell.x;\n\n  return index;\n};\n\n/**\n * Returns x,y from an array index.\n *\n * ```js\n *  const data = [\n *   1, 2,\n *   3, 4,\n *   5, 6 ];\n *\n * // Cols of 2, index 2 (ie. data[2] == 3)\n * const cell = cellFromIndex(2, 2);\n * // Yields: {x: 0, y: 1}\n * ```\n * @see indexFromCell\n * @param colsOrGrid\n * @param index\n * @returns\n */\nexport const cellFromIndex = (\n  colsOrGrid: number | Grid,\n  index: number\n): GridCell => {\n  let cols = 0;\n  cols = typeof colsOrGrid === `number` ? colsOrGrid : colsOrGrid.cols;\n  resultThrow(integerTest(cols, `aboveZero`, `colsOrGrid`));\n\n  return {\n    x: index % cols,\n    y: Math.floor(index / cols),\n  };\n};","import type { GridCell, Grid, GridVisual } from \"./types.js\";\n\n/**\n * Returns _true_ if grids `a` and `b` are equal in value.\n * Returns _false_ if either parameter is undefined.\n *\n * @param a\n * @param b\n * @return\n */\nexport const isEqual = (\n  a: Grid | GridVisual,\n  b: Grid | GridVisual\n): boolean => {\n  if (b === undefined) return false;\n  if (a === undefined) return false;\n  if (`rows` in a && `cols` in a) {\n    if (`rows` in b && `cols` in b) {\n      if (a.rows !== b.rows || a.cols !== b.cols) return false;\n    } else return false;\n  }\n  if (`size` in a) {\n    if (`size` in b) {\n      if (a.size !== b.size) return false;\n    } else return false;\n  }\n  return true;\n};\n\n/**\n * Returns _true_ if two cells equal.\n * Returns _false_ if either cell are undefined\n *\n * @param a\n * @param b\n * @returns\n */\nexport const cellEquals = (\n  a: GridCell | undefined,\n  b: GridCell | undefined\n): boolean => {\n  if (b === undefined) return false;\n  if (a === undefined) return false;\n  return a.x === b.x && a.y === b.y;\n};","import { zipKeyValue } from \"@ixfx/core/maps\";\nimport { allDirections, getVectorFromCardinal } from \"./directions.js\";\nimport type { GridBoundsLogic, GridCardinalDirection, GridCell, Grid, GridNeighbour, GridNeighbourMaybe, GridNeighbours } from \"./types.js\";\nimport { randomElement } from \"@ixfx/random\";\nimport { offset } from \"./offset.js\";\n\nexport const randomNeighbour = (nbos: readonly GridNeighbour[]) => randomElement(nbos); // .filter(isNeighbour));\n\n/**\n * Returns _true_ if `n` is a Neighbour type, eliminating NeighbourMaybe possibility\n *\n * @param n\n * @return\n */\nconst isNeighbour = (\n  n: GridNeighbour | GridNeighbourMaybe | undefined\n): n is GridNeighbour => {\n  if (n === undefined) return false;\n  if (n[ 1 ] === undefined) return false;\n  return true;\n};\n\n/**\n * Gets a list of neighbours for `cell` (using {@link neighbours}), filtering\n * results to only those that are valid neighbours (using {@link isNeighbour})\n * \n * ```js\n * // Get all eight surrounding cells\n * const n = Grids.neighbourList(grid, cell, Grids.allDirections);\n * \n * // Get north, east, south, west cells\n * const n = Grids.neighbourList(grid, cell, Grids.crossDirections);\n * ```\n * @param grid Grid\n * @param cell Cell\n * @param directions Directions \n * @param bounds Bounds\n * @returns \n */\nexport const neighbourList = (\n  grid: Grid,\n  cell: GridCell,\n  directions: readonly GridCardinalDirection[],\n  bounds: GridBoundsLogic\n): readonly GridNeighbour[] => {\n  // Get neighbours for cell\n  const cellNeighbours = neighbours(grid, cell, bounds, directions);\n\n  // Filter out undefined cells\n  const entries = Object.entries(cellNeighbours);\n  return (entries as GridNeighbourMaybe[]).filter(n => isNeighbour(n));\n};\n\n/**\n * Returns neighbours for a cell. If no `directions` are provided, it defaults to {@link allDirections}.\n *\n * ```js\n * const grid = { rows: 5, cols: 5 };\n * const cell = { x:2, y:2 };\n *\n * // Get n,ne,nw,e,s,se,sw and w neighbours\n * const n = Grids.neighbours(grid, cell, `wrap`);\n *\n * Yields:\n * {\n *  n: {x: 2, y: 1}\n *  s: {x: 2, y: 3}\n *  ....\n * }\n * ```\n *\n * Returns neighbours without diagonals (ie: n, e, s, w):\n * ```js\n * const n = Grids.neighbours(grid, cell, `stop`, Grids.crossDirections);\n * ```\n * @returns Returns a map of cells, keyed by cardinal direction\n * @param grid Grid\n * @param cell Cell\n * @param bounds How to handle edges of grid\n * @param directions Directions to return\n */\nexport const neighbours = (\n  grid: Grid,\n  cell: GridCell,\n  bounds: GridBoundsLogic = `undefined`,\n  directions?: readonly GridCardinalDirection[]\n): GridNeighbours => {\n  const directories = directions ?? allDirections;\n  const points = directories.map((c) =>\n    offset(grid, cell, getVectorFromCardinal(c), bounds)\n  );\n  return zipKeyValue<GridCell>(directories, points) as GridNeighbours;\n};","\n/**\n * Returns a two-dimensional array according to `grid`\n * size.\n *\n * ```js\n * const a = Grids.toArray({ rows: 3, cols: 2 });\n * Yields:\n * [ [_,_] ]\n * [ [_,_] ]\n * [ [_,_] ]\n * ```\n *\n * `initialValue` can be provided to set the value\n * for all cells.\n * @param grid Grid\n * @param initialValue Initial value\n * @returns\n */\n\nimport type { Grid } from \"./types.js\";\n\nexport const toArray2d = <V>(grid: Grid, initialValue?: V): V[][] => {\n  const returnValue:V[][] = [];\n  for (let row = 0; row < grid.rows; row++) {\n    returnValue[ row ] = Array.from<V>({ length: grid.cols });\n    if (initialValue) {\n      for (let col = 0; col < grid.cols; col++) {\n        returnValue[ row ][ col ] = initialValue;\n      }\n    }\n  }\n  return returnValue;\n};","import type { GridCell } from \"./types.js\";\n\n/**\n * Returns a key string for a cell instance\n * A key string allows comparison of instances by value rather than reference\n *\n * ```js\n * cellKeyString({x:10,y:20});\n * // Yields: \"Cell{10,20}\";\n * ```\n * @param v\n * @returns\n */\nexport const cellKeyString = (v: GridCell): string => `Cell{${ v.x },${ v.y }}`;\n","import type { RectPositioned } from \"../rect/rect-types.js\";\nimport { guardCell } from \"./guards.js\";\nimport type { GridCell, GridVisual } from \"./types.js\";\nimport { fromTopLeft as RectsFromTopLeft } from '../rect/from-top-left.js';\nimport type { Point } from \"../point/point-type.js\";\nimport { integerTest, numberTest, resultThrow } from '@ixfx/guards';\nimport { cells } from \"./enumerators/cells.js\";\n\n/**\n * Generator that returns rectangles for each cell in a grid\n *\n * @example Draw rectangles\n * ```js\n * import { Drawing } from 'visuals.js'\n * const rects = [...Grids.asRectangles(grid)];\n * Drawing.rect(ctx, rects, { strokeStyle: `silver`});\n * ```\n * @param grid\n */\nexport function* asRectangles(\n  grid: GridVisual\n): IterableIterator<RectPositioned> {\n  for (const c of cells(grid)) {\n    yield rectangleForCell(grid, c);\n  }\n}\n\n/**\n * Returns the cell at a specified visual coordinate\n * or _undefined_ if the position is outside of the grid.\n *\n * `position` must be in same coordinate/scale as the grid.\n *\n * @param position Position, eg in pixels\n * @param grid Grid\n * @return Cell at position or undefined if outside of the grid\n */\nexport const cellAtPoint = (\n  grid: GridVisual,\n  position: Point\n): GridCell | undefined => {\n  const size = grid.size;\n  resultThrow(numberTest(size, `positive`, `grid.size`));\n  if (position.x < 0 || position.y < 0) return;\n  const x = Math.floor(position.x / size);\n  const y = Math.floor(position.y / size);\n  if (x >= grid.cols) return;\n  if (y >= grid.rows) return;\n  return { x, y };\n};\n\n/**\n * Returns a visual rectangle of the cell, positioned from the top-left corner\n *\n * ```js\n * const cell = { x: 1, y: 0 };\n *\n * // 5x5 grid, each cell 5px in size\n * const grid = { rows: 5, cols: 5, size: 5 }\n *\n * const r = rectangleForCell(grid, cell,);\n *\n * // Yields: { x: 5, y: 0, width: 5, height: 5 }\n * ```\n * @param cell\n * @param grid\n * @return\n */\nexport const rectangleForCell = (\n  grid: GridVisual,\n  cell: GridCell\n): RectPositioned => {\n  guardCell(cell);\n  const size = grid.size;\n  const x = cell.x * size;\n  const y = cell.y * size;\n  const r = RectsFromTopLeft({ x: x, y: y }, size, size);\n  return r;\n};\n\n/**\n * Returns the visual midpoint of a cell (eg. pixel coordinate)\n *\n * @param cell\n * @param grid\n * @return\n */\nexport const cellMiddle = (grid: GridVisual, cell: GridCell): Point => {\n  guardCell(cell);\n\n  const size = grid.size;\n  const x = cell.x * size; // + (grid.spacing ? cell.x * grid.spacing : 0);\n  const y = cell.y * size; // + (grid.spacing ? cell.y * grid.spacing : 0);\n  return Object.freeze({ x: x + size / 2, y: y + size / 2 });\n};","import type { Grid, GridCell, GridVisitorOpts, GridNeighbourSelectionLogic } from \"../types.js\";\n//import { visitor } from \"./Visitor.js\";\n\n// export const visitorBreadth = (\n//   grid: Grid,\n//   start: Cell,\n//   opts: VisitorOpts = {}\n// ) =>\n//   visitor(\n//     {\n//       select: (nbos) => nbos[ 0 ],\n//     },\n//     grid,\n//     start,\n//     opts\n//   );\n\nexport const breadthLogic = (): GridNeighbourSelectionLogic => {\n  return {\n    select: (nbos) => nbos[ 0 ],\n  }\n}","import { allDirections } from \"../directions.js\";\nimport { neighbourList } from \"../neighbour.js\";\nimport type { GridNeighbour, GridNeighbourSelectionLogic } from \"../types.js\";\n\n// export function* cellNeigbours(\n//   grid: Grid,\n//   cell: Cell,\n//   bounds: BoundsLogic = `undefined`,\n//   directions?: ReadonlyArray<CardinalDirection>\n// ) {\n//   const dirs = directions ?? allDirections;\n//   const points = dirs.map((c) =>\n//     offset(grid, cell, getVectorFromCardinal(c), bounds)\n//   );\n//   for (const pt of points) {\n//     if (pt !== undefined) yield pt;\n//   }\n// }\n\nexport const neighboursLogic = (): GridNeighbourSelectionLogic => {\n  return {\n    select: (neighbours: readonly GridNeighbour[]) => {\n      return neighbours.at(0);\n    },\n    getNeighbours: (grid, cell) => {\n      return neighbourList(grid, cell, allDirections, `undefined`)\n    }\n  }\n}\n","import type { GridNeighbour, GridNeighbourSelectionLogic, GridVisitorOpts } from \"../types.js\";\n\n/**\n * Visits cells running down columns, left-to-right.\n * @param opts Options\n * @returns Visitor generator\n */\nexport const columnLogic = (opts: Partial<GridVisitorOpts> = {}): GridNeighbourSelectionLogic => {\n  const reversed = opts.reversed ?? false;\n  return {\n    select: (nbos) => nbos.find((n) => n[ 0 ] === (reversed ? `n` : `s`)),\n    getNeighbours: (grid, cell): ReadonlyArray<GridNeighbour> => {\n      if (reversed) {\n        // WALK UP COLUMN, RIGHT-TO-LEFT\n        if (cell.y > 0) {\n          // Easy case\n          cell = { x: cell.x, y: cell.y - 1 };\n        } else {\n          // Top of column\n          if (cell.x === 0) {\n            // Top-left corner, need to wrap\n            cell = { x: grid.cols - 1, y: grid.rows - 1 };\n          } else {\n            cell = { x: cell.x - 1, y: grid.rows - 1 };\n          }\n        }\n      } else {\n        // WALK DOWN COLUMNS, LEFT-TO-RIGHT\n        if (cell.y < grid.rows - 1) {\n          // Easy case, move down by one\n          cell = { x: cell.x, y: cell.y + 1 };\n        } else {\n          // End of column\n          if (cell.x < grid.cols - 1) {\n            // Move to next column and start at top\n            cell = { x: cell.x + 1, y: 0 };\n          } else {\n            // Move to start of grid\n            cell = { x: 0, y: 0 };\n          }\n        }\n      }\n      return [ [ reversed ? `n` : `s`, cell ] ];\n    }\n  }\n}","import type { GridNeighbourSelectionLogic } from \"../types.js\";\n\n// export const visitorDepth = (grid: Grid, start: Cell, opts: VisitorOpts = {}) =>\n//   visitor(\n//     {\n//       select: (nbos) => nbos.at(-1),\n//     },\n//     grid,\n//     start,\n//     opts\n//   );\n\nexport const depthLogic = (): GridNeighbourSelectionLogic => {\n  return {\n    select: (nbos) => nbos.at(-1)\n  }\n}","import { randomNeighbour } from \"../neighbour.js\";\nimport type { GridNeighbour, GridNeighbourSelectionLogic } from \"../types.js\";\nimport { cells } from \"../enumerators/cells.js\";\n\n// export const visitorRandom = (\n//   grid: Grid,\n//   start: Cell,\n//   opts: VisitorOpts = {}\n// ) =>\n//   visitor(\n//     ,\n//     grid,\n//     start,\n//     opts\n//   );\n\nexport const randomLogic = (): GridNeighbourSelectionLogic => {\n  return {\n    getNeighbours: (grid, cell) => {\n      const t: Array<GridNeighbour> = [];\n      for (const c of cells(grid, cell)) {\n        t.push([ `n`, c ]);\n      }\n      return t;\n    },\n    select: randomNeighbour,\n  }\n}","import { randomNeighbour } from \"../neighbour.js\";\nimport type { GridNeighbourSelectionLogic } from \"../types.js\";\n\n// export const visitorRandomContiguous = (\n//   grid: Grid,\n//   start: Cell,\n//   opts: VisitorOpts = {}\n// ) =>\n//   visitor(\n//     ,\n//     grid,\n//     start,\n//     opts\n//   );\nexport const randomContiguousLogic = (): GridNeighbourSelectionLogic => {\n  return {\n    select: randomNeighbour,\n  }\n}","import type { GridCell, Grid, GridNeighbour, GridNeighbourSelectionLogic, GridVisitorOpts } from \"../types.js\";\n\n/**\n* Visit by following rows. Normal order is left-to-right, top-to-bottom.\n* @param opts Options\n* @returns\n*/\nexport const rowLogic = (opts: Partial<GridVisitorOpts> = {}): GridNeighbourSelectionLogic => {\n  const reversed = opts.reversed ?? false;\n  return {\n    select: (nbos: ReadonlyArray<GridNeighbour>) =>\n      nbos.find((n) => n[ 0 ] === (reversed ? `w` : `e`)),\n    getNeighbours: (\n      grid: Grid,\n      cell: GridCell\n    ): ReadonlyArray<GridNeighbour> => {\n      if (reversed) {\n        // WALKING BACKWARD ALONG ROW\n        if (cell.x > 0) {\n          // All fine, step to the left\n          cell = { x: cell.x - 1, y: cell.y };\n        } else {\n          // At the beginning of a row\n          if (cell.y > 0) {\n            // Wrap to next row up\n            cell = { x: grid.cols - 1, y: cell.y - 1 };\n          } else {\n            // Wrap to end of grid\n            cell = { x: grid.cols - 1, y: grid.rows - 1 };\n          }\n        }\n      } else {\n        /*\n         * WALKING FORWARD ALONG ROWS\n         */\n        if (cell.x < grid.rows - 1) {\n          // All fine, step to the right\n          cell = { x: cell.x + 1, y: cell.y };\n        } else {\n          // At the end of a row\n          // eslint-disable-next-line unicorn/prefer-ternary\n          if (cell.y < grid.rows - 1) {\n            // More rows available, wrap to next row down\n            cell = { x: 0, y: cell.y + 1 };\n          } else {\n            // No more rows available, wrap to start of the grid\n            cell = { x: 0, y: 0 };\n          }\n        }\n      }\n      return [ [ reversed ? `w` : `e`, cell ] ];\n    }\n  }\n}","import { mutable } from '@ixfx/collections/set';\nimport { crossDirections } from \"../directions.js\";\nimport { guardGrid, guardCell, isCell } from \"../guards.js\";\nimport { cellEquals } from \"../is-equal.js\";\nimport { neighbourList } from '../neighbour.js';\nimport { cellKeyString } from \"../to-string.js\";\nimport type { GridNeighbourSelectionLogic, Grid, GridCell, GridVisitorOpts, GridNeighbour } from \"../types.js\";\n\n/**\n * Visits every cell in grid using supplied selection function\n * In-built functions to use: visitorDepth, visitorBreadth, visitorRandom,\n * visitorColumn, visitorRow.\n *\n * Usage example:\n * ```js\n *  let visitor = Grids.visitor(Grids.visitorRandom, grid, startCell);\n *  for (let cell of visitor) {\n *   // do something with cell\n *  }\n * ```\n *\n * If you want to keep tabs on the visitor, pass in a @ixfx/collections.Sets.ISetMutable instance. This gets\n * updated as cells are visited to make sure we don't visit the same one twice. If a set is not passed\n * in, one will be created internally.\n * ```js\n * let visited = new SetStringMutable<Grids.Cell>(c => Grids.cellKeyString(c));\n * let visitor = Grids.visitor(Grids.visitorRandom, grid, startCell, visited);\n * ```\n *\n * To visit with some delay, try this pattern\n * ```js\n *  const delayMs = 100;\n *  const run = () => {\n *   let cell = visitor.next().value;\n *   if (cell === undefined) return;\n *   // Do something with cell\n *   setTimeout(run, delayMs);\n *  }\n *  setTimeout(run, delayMs);\n * ```\n * @param logic Logic for selecting next cell\n * @param grid Grid to visitl\n * @param opts Options\n * @returns Cells\n */\nexport function* visitByNeighbours(\n  logic: GridNeighbourSelectionLogic,\n  grid: Grid,\n  opts: Partial<GridVisitorOpts> = {}\n): Generator<GridCell> {\n  guardGrid(grid, `grid`);\n  const start = opts.start ?? { x: 0, y: 0 };\n\n  guardCell(start, `opts.start`, grid);\n\n  const v = opts.visited ?? mutable<GridCell>(cellKeyString);\n  const possibleNeighbours = logic.getNeighbours ?? ((g: Grid, c: GridCell) => neighbourList(g, c, crossDirections, `undefined`));\n\n  let cellQueue: GridCell[] = [ start ];\n  let moveQueue: GridNeighbour[] = [];\n  let current: GridCell | undefined = undefined;\n\n  while (cellQueue.length > 0) {\n    if (current === undefined) {\n      const nv = cellQueue.pop();\n      if (nv === undefined) {\n        break;\n      }\n      current = nv;\n    }\n\n    if (!v.has(current)) {\n      v.add(current);\n      yield current;\n\n      const nextSteps = possibleNeighbours(grid, current).filter(\n        (step) => {\n          if (step[ 1 ] === undefined) return false;\n          return !v.has(step[ 1 ])\n        }\n      );\n\n      if (nextSteps.length === 0) {\n        // No more moves for this cell\n        if (current !== undefined) {\n          cellQueue = cellQueue.filter((cq) => cellEquals(cq, current));\n        }\n      } else {\n        for (const n of nextSteps) {\n          if (n === undefined) continue;\n          if (n[ 1 ] === undefined) continue;\n          moveQueue.push(n);\n        }\n      }\n    }\n\n    // Remove steps already made\n    moveQueue = moveQueue.filter((step) => !v.has(step[ 1 ]));\n\n    if (moveQueue.length === 0) {\n      current = undefined;\n    } else {\n      // Pick move\n      const potential = logic.select(moveQueue);\n      if (potential !== undefined) {\n        cellQueue.push(potential[ 1 ]);\n        current = potential[ 1 ];\n      }\n    }\n  }\n};\n","import { integerTest, resultThrow } from \"@ixfx/guards\";\nimport { guardCell, guardGrid } from \"../guards.js\";\nimport type { Grid, GridCell, GridCreateVisitor } from \"../types.js\";\n\n/**\n * Runs the provided `visitor` for `steps`, returning the cell we end at\n * ```js\n * // Create visitor & stepper\n * const visitor = Grids.Visit.create(`row`);\n * const stepper = Grids.Visit.stepper(grid, visitor);\n * \n * // Step by 10\n * stepper(10); // GridCell {x,y}\n * \n * // Step by another 2\n * stepper(2);\n * ```\n * @param grid Grid to traverse\n * @param start Start point\n * @param createVisitor Visitor function\n * @returns\n */\nexport const stepper = (\n  grid: Grid,\n  createVisitor: GridCreateVisitor,\n  start: GridCell = { x: 0, y: 0 },\n  resolution = 1\n) => {\n  guardGrid(grid, `grid`);\n  guardCell(start, `start`);\n  resultThrow(integerTest(resolution, ``, `resolution`));\n\n  // Create a list of steps\n  const steps: GridCell[] = [];\n  let count = 0;\n  let position = 0;\n  for (const c of createVisitor(grid, { start, boundsWrap: `undefined` })) {\n    count++;\n    if ((count % resolution) !== 0) continue;\n    steps.push(c);\n  }\n\n  return (step: number, fromStart = false) => {\n    resultThrow(integerTest(step, ``, `step`));\n    if (fromStart) position = step;\n    else position += step;\n    //position = position % steps.length;\n    return steps.at(position % steps.length);\n\n  }\n}\n\n// export const step = (\n//   grid: Grid,\n//   start: Cell,\n//   steps: number,\n//   createVisitor: CreateVisitor\n// ): Cell => {\n//   throwIntegerTest(steps, ``, `steps`);\n\n//   const opts: Partial<VisitorOpts> = {\n//     reversed: steps < 0,\n//     start\n//   };\n//   steps = Math.abs(steps);\n\n//   let c = start;\n//   let v = createVisitor(grid, opts);\n//   v.next(); // Burn up starting cell\n\n//   let stepsMade = 0;\n\n//   while (stepsMade < steps) {\n//     stepsMade++;\n//     const { value } = v.next();\n//     if (value) {\n//       c = value;\n//       if (opts.debug) {\n//         console.log(\n//           `stepsMade: ${ stepsMade } cell: ${ c.x }, ${ c.y } reverse: ${ opts.reversed }`\n//         );\n//       }\n//     } else {\n//       if (steps >= grid.cols * grid.rows) {\n//         steps -= grid.cols * grid.rows;\n//         stepsMade = 0;\n//         v = createVisitor(grid, opts);\n//         v.next();\n//         c = start;\n//         if (opts.debug) console.log(`resetting visitor to ${ steps }`);\n//       } else throw new Error(`Value not received by visitor`);\n//     }\n//   }\n//   return c;\n// };\n","import type { GridCell, GridCreateVisitor, Grid, GridReadable, GridNeighbourSelectionLogic, GridVisitorOpts } from '../types.js';\nimport { breadthLogic } from './breadth.js';\nimport { neighboursLogic } from './cell-neighbours.js';\nimport { columnLogic } from './columns.js';\nimport { depthLogic } from './depth.js';\nimport { randomLogic } from './random.js';\nimport { randomContiguousLogic } from './random-contiguous.js';\nimport { rowLogic } from './rows.js';\nimport { visitByNeighbours } from './visitor.js';\n\nexport * from './breadth.js';\nexport * from './cell-neighbours.js';\nexport * from './columns.js';\nexport * from './depth.js';\nexport * from './step.js';\nexport * from './random.js';\nexport * from './random-contiguous.js';\nexport * from './rows.js';\nexport * from './visitor.js';\n\nexport type VisitorTypes = `row` | `column` | `neighbours` | `breadth` | `depth` | `random` | `random-contiguous`\n\n/**\n * Logic types:\n * * 'row': left-to-right, top-to-bottom\n * * 'column': top-to-bottom, left-to-right\n * * 'neighbours': neighbours surrounding cell (eight)\n * * 'breadth`: breadth-first\n * * 'depth': depth-first\n * * 'random': any random cell in grid\n * * 'random-contiguous': any random cell neighbouring an already visited cell\n * @param type \n * @param opts \n * @returns \n */\nexport const create = (type: VisitorTypes, opts: Partial<GridVisitorOpts> = {}) => {\n  switch (type) {\n    case `random-contiguous`:\n      return withLogic(randomContiguousLogic(), opts);\n    case `random`:\n      return withLogic(randomLogic(), opts);\n    case `depth`:\n      return withLogic(depthLogic(), opts);\n    case `breadth`:\n      return withLogic(breadthLogic(), opts);\n    case `neighbours`:\n      return withLogic(neighboursLogic(), opts);\n    case `row`:\n      return withLogic(rowLogic(opts), opts);\n    case `column`:\n      return withLogic(columnLogic(opts), opts);\n    default:\n      throw new TypeError(`Param 'type' unknown. Value: ${ type }`);\n  }\n}\n\nexport const withLogic = (logic: GridNeighbourSelectionLogic, options: Partial<GridVisitorOpts> = {}) => {\n  return (grid: Grid, optionsOverride: Partial<GridVisitorOpts> = {}) => {\n    return visitByNeighbours(logic, grid, { ...options, ...optionsOverride });\n  }\n}\n\nfunction isIterator<T>(v: any): v is Generator<T> {\n  if (typeof v !== `object`) return false;\n  if (!(`next` in v)) return false;\n  if (!(`throw` in v)) return false;\n  if (!(`return` in v)) return false;\n  return true;\n\n}\n\n\n// export function* withValues<T>(createOrIter: CreateVisitor | Generator<Cell>, grid: GridReadable<T>, opts: Partial<VisitorOpts>) {\n//   const iter = isIterator(createOrIter) ? createOrIter : createOrIter(grid, opts)();\n//   for (const cell of iter) {\n//     yield { cell, value: grid.accessor(cell, `undefined`) }\n//   }\n// }\n\n// export const byCells = (grid: Grid, options: Partial<VisitorOpts> = {}) => {\n//   return (logic: NeighbourSelectionLogic, optionsOverride: Partial<VisitorOpts> = {}) => {\n//     return visitByNeighbours(logic, grid, { ...options, ...optionsOverride });\n//   }\n// }\n\n// export const byCellsLeftToRightTopToBottom = ():CreateVisitor => {\n//   return (grid) => {\n//     return cells(grid)\n//   }\n// }","export * from './apply-bounds.js';\nexport * as Array1d from './array-1d.js';\nexport * as Array2d from './array-2d.js';\n/**\n * Iterates over slices of the grid (eg a whole row, a whole column)\n */\nexport * as As from './as.js';\nexport * from './directions.js';\nexport * as By from './enumerators/index.js';\nexport * from './geometry.js';\nexport * from './guards.js';\nexport * from './indexing.js';\nexport * from './inside.js';\nexport * from './is-equal.js';\nexport * from './neighbour.js';\nexport * from './offset.js';\nexport * from './to-array.js';\nexport * from './to-string.js';\nexport type * from './types.js';\nexport * from './visual.js';\nexport * from './values.js';\nexport * as Visit from './visitors/index.js';\n\n\n\n\n\n","import { numberTest, resultThrow } from \"@ixfx/guards\";\nimport type { Rect } from \"../rect/rect-types.js\";\nimport { isRect } from \"../rect/guard.js\";\nimport { isPoint } from \"./guard.js\";\nimport type { Point } from \"./point-type.js\";\n\n/**\n * Normalises a point by a given width and height\n * \n * ```js\n * normaliseByRect({ x: 10, y: 10 }, 20, 40 }); // { x: 0.5, y: 0.2 }\n * ```\n * @param point Point\n * @param width Width\n * @param height Height\n */\nexport function normaliseByRect(\n  point: Point,\n  width: number,\n  height: number\n): Point;\n\n/**\n * Normalises a point by a given rect's width and height\n * \n * ```js\n * normaliseByRect({ x: 10, y: 10, width: 20, height: 40 }); // { x: 0.5, y: 0.2 }\n * ```\n * @param pt \n * @param rect \n */\nexport function normaliseByRect(pt: Point, rect: Rect): Point;\n\n/**\n * Normalises x,y by width and height so it is on a 0..1 scale\n * \n * ```js\n * normaliseByRect(10, 10, 20, 40); // { x: 0.5, y: 0.2 }\n * ```\n * @param x\n * @param y\n * @param width\n * @param height\n */\nexport function normaliseByRect(\n  x: number,\n  y: number,\n  width: number,\n  height: number\n): Point;\n\n/**\n * Normalises a point so it is on a 0..1 scale\n * \n * ```js\n * normaliseByRect({ x: 10, y: 10, width: 20, height: 40 }); \n * normaliseByRect({ x: 10, y: 10 }, 20, 40); \n * normaliseByRect(10, 10, 20, 40);\n * ```\n * @param a Point, or x\n * @param b y coord or width\n * @param c height or width\n * @param d height\n * @returns Point\n */\nexport function normaliseByRect(\n  a: Point | number,\n  b: number | Rect,\n  c?: number,\n  d?: number\n): Point {\n  if (isPoint(a)) {\n    if (typeof b === `number` && c !== undefined) {\n      resultThrow(\n        numberTest(b, `positive`, `width`),\n        numberTest(c, `positive`, `height`)\n      );\n    } else {\n      if (!isRect(b)) {\n        throw new Error(`Expected second parameter to be a rect`);\n      }\n      c = b.height;\n      b = b.width;\n    }\n    return Object.freeze({\n      x: a.x / b,\n      y: a.y / c,\n    });\n  } else {\n    resultThrow(numberTest(a, `positive`, `x`));\n    if (typeof b !== `number`) {\n      throw new TypeError(`Expecting second parameter to be a number (width)`);\n    }\n    if (typeof c !== `number`) {\n      throw new TypeError(`Expecting third parameter to be a number (height)`);\n    }\n\n    resultThrow(numberTest(b, `positive`, `y`));\n    resultThrow(numberTest(c, `positive`, `width`));\n    if (d === undefined) throw new Error(`Expected height parameter`);\n    resultThrow(numberTest(d, `positive`, `height`));\n    return Object.freeze({\n      x: a / c,\n      y: b / d,\n    });\n  }\n}","import type { Point } from \"../point/point-type.js\";\nimport type { Line } from \"./line-type.js\";\nimport { distance as PointsDistance } from \"../point/distance.js\";\nimport { minIndex } from \"@ixfx/numbers\";\n/**\n * Returns the nearest point on `line` closest to `point`.\n * \n * ```js\n * const pt = Lines.nearest(line, {x:10,y:10});\n * ```\n * \n * If an array of lines is provided, it will be the closest point amongst all the lines\n * @param line Line or array of lines\n * @param point\n * @returns Point `{ x, y }`\n */\nexport const nearest = (line: Line | readonly Line[], point: Point): Point => {\n\n  const n = (line: Line): Point => {\n    const { a, b } = line;\n    const atob = { x: b.x - a.x, y: b.y - a.y };\n    const atop = { x: point.x - a.x, y: point.y - a.y };\n    const length = atob.x * atob.x + atob.y * atob.y;\n\n\n    let dot = atop.x * atob.x + atop.y * atob.y;\n    const t = Math.min(1, Math.max(0, dot / length));\n    dot = (b.x - a.x) * (point.y - a.y) - (b.y - a.y) * (point.x - a.x);\n    return { x: a.x + atob.x * t, y: a.y + atob.y * t };\n  };\n\n  if (Array.isArray(line)) {\n    const pts = line.map(l => n(l));\n    const dists = pts.map(p => PointsDistance(p, point));\n    return Object.freeze<Point>(pts[ minIndex(...dists) ]);\n  } else {\n    return Object.freeze<Point>(n(line as Line));\n  }\n};","import type { Point } from \"../point/point-type.js\";\nimport type { Line } from \"./line-type.js\";\nimport { guard } from './guard.js';\nimport { guard as guardPoint } from '../point/guard.js';\nimport { length } from \"./length.js\";\nimport { nearest } from \"./nearest.js\";\n/**\n * Returns the distance of `point` to the nearest point on `line`\n * \n * ```js\n * const distance = Lines.distanceSingleLine(line, pt);\n * ```\n * @param line Line\n * @param point Target point\n * @returns \n */\nexport const distanceSingleLine = (line: Line, point: Point): number => {\n  guard(line, `line`);\n  guardPoint(point, `point`);\n\n  if (length(line) === 0) {\n    // Line is really a point\n    return length(line.a, point);\n  }\n\n  const near = nearest(line, point);\n  return length(near, point);\n};","import { interpolate } from \"./interpolate.js\";\nimport type { Line } from \"./line-type.js\";\nimport { length } from \"./length.js\";\nimport type { Point } from \"../point/point-type.js\";\n\nconst directionVector = (line: Line): Point => ({\n  x: line.b.x - line.a.x,\n  y: line.b.y - line.a.y\n});\n\n\n\nconst directionVectorNormalised = (line: Line): Point => {\n  const l = length(line);\n  const v = directionVector(line);\n  return {\n    x: v.x / l,\n    y: v.y / l\n  };\n};\n\n/**\n * Returns a parallel line to `line` at `distance`.\n * \n * ```js\n * const l = Lines.parallel(line, 10);\n * ```\n * @param line\n * @param distance \n */\nexport const parallel = (line: Line, distance: number): Line => {\n  const dv = directionVector(line);\n  const dvn = directionVectorNormalised(line);\n  const a = {\n    x: line.a.x - dvn.y * distance,\n    y: line.a.y + dvn.x * distance\n  };\n  return {\n    a,\n    b: {\n      x: a.x + dv.x,\n      y: a.y + dv.y\n    }\n  };\n};\n\n/**\n * Returns a point perpendicular to `line` at a specified `distance`. Use negative\n * distances for the other side of line.\n * ```\n * // Project a point 100 units away from line, at its midpoint.\n * const pt = Lines.perpendicularPoint(line, 100, 0.5);\n * ```\n * @param line Line\n * @param distance Distance from line. Use negatives to flip side\n * @param amount Relative place on line to project point from. 0 projects from A, 0.5 from the middle, 1 from B.\n */\nexport const perpendicularPoint = (line: Line, distance: number, amount = 0) => {\n  const origin = interpolate(amount, line);\n  const dvn = directionVectorNormalised(line);\n  return {\n    x: origin.x - dvn.y * distance,\n    y: origin.y + dvn.x * distance\n  };\n};\n","import type { RectPositioned } from \"../rect/rect-types.js\";\nimport type { Line } from \"./line-type.js\";\nimport { bbox as PointsBbox } from \"../point/bbox.js\";\n/**\n * Returns a rectangle that encompasses dimension of line\n * \n * ```js\n * const rect = Lines.bbox(line);\n * ```\n */\nexport const bbox = (line: Line): RectPositioned => PointsBbox(line.a, line.b);\n","\nimport { getPointParameter, getTwoPointParameters } from \"./get-point-parameter.js\";\nimport { guard, guardNonZeroPoint, isPoint3d } from \"./guard.js\";\nimport type { Point, Point3d } from \"./point-type.js\";\nimport type { Writeable } from \"@ixfx/core\";\n\nexport function divide(a: Point, b: Point): Point;\nexport function divide(a: Point3d, b: Point3d): Point3d;\nexport function divide(a: Point, x: number, y: number): Point;\nexport function divide(a: Point3d, x: number, y: number, z: number): Point3d;\nexport function divide(ax: number, ay: number, bx: number, by: number): Point;\nexport function divide(ax: number, ay: number, az: number, bx: number, by: number, bz: number): Point3d;\n\n/**\n * Returns a Point with the x,y,z values of two points divide (a/b).\n * \n * `z` parameter is used, if present. Uses a default value of 0 for 'z' when dividing a 2D point with a 3D one.\n *\n * Examples:\n *\n * ```js\n * divide(ptA, ptB);\n * divide(x1, y1, x2, y2);\n * divide(ptA, x2, y2);\n * ```\n */\nexport function divide(\n  a1: Point | Point3d | number, ab2: Point | Point3d | number, ab3?: number, ab4?: number, ab5?: number, ab6?: number\n): Point | Point3d {\n  const [ ptA, ptB ] = getTwoPointParameters(a1 as any, ab2 as any, ab3 as any, ab4 as any, ab5 as any, ab6 as any);\n  guard(ptA, `a`);\n  guard(ptB, `b`);\n  if (ptB.x === 0) throw new TypeError('Cannot divide by zero (b.x is 0)');\n  if (ptB.y === 0) throw new TypeError('Cannot divide by zero (b.y is 0)');\n\n  const pt: Writeable<Point> = {\n    x: ptA.x / ptB.x,\n    y: ptA.y / ptB.y,\n  };\n  if (isPoint3d(ptA) || isPoint3d(ptB)) {\n    if (ptB.z === 0) throw new TypeError('Cannot divide by zero (b.z is 0)');\n\n    pt.z = (ptA.z ?? 0) / (ptB.z ?? 0);\n  };\n  return Object.freeze(pt);\n};\n\n\n/**\n * Returns a function that divides a point:\n * ```js\n * const f = divider(100, 200);\n * f(50,100); // Yields: { x: 0.5, y: 0.5 }\n * ```\n *\n * Input values can be Point, separate x,y and optional z values or an array:\n * ```js\n * const f = divider({ x: 100, y: 100 });\n * const f = divider( 100, 100 );\n * const f = divider([ 100, 100 ]);\n * ```\n *\n * Likewise the returned function an take these as inputs:\n * ```js\n * f({ x: 100, y: 100});\n * f( 100, 100 );\n * f([ 100, 100 ]);\n * ```\n *\n * Function throws if divisor has 0 for any coordinate (since we can't divide by 0)\n * @param a Divisor point, array of points or x\n * @param b Divisor y value\n * @param c Divisor z value\n * @returns\n */\n//eslint-disable-next-line functional/prefer-readonly-type\nexport function divider(a: Point3d | Point | number | number[], b?: number, c?: number) {\n  const divisor = getPointParameter(a, b, c);\n  guardNonZeroPoint(divisor, `divisor`);\n\n  return (\n    aa: Point3d | Point | number | number[],\n    bb?: number,\n    cc?: number\n  ): Point => {\n    const dividend = getPointParameter(aa, bb, cc);\n\n    return typeof dividend.z === `undefined` ? Object.freeze({\n      x: dividend.x / divisor.x,\n      y: dividend.y / divisor.y,\n    }) : Object.freeze({\n      x: dividend.x / divisor.x,\n      y: dividend.y / divisor.y,\n      z: dividend.z / (divisor.z ?? 1),\n    });\n  };\n}\n","import type { Point } from \"../point/point-type.js\";\nimport type { Line } from \"./line-type.js\";\nimport { divide as PointDivide } from '../point/divider.js';\n/**\n * Divides both start and end points by given x,y\n * ```js\n * // Line 1,1 -> 10,10\n * const l = Lines.fromNumbers(1,1,10,10);\n * const ll = Lines.divide(l, {x:2, y:4});\n * // Yields: 0.5,0.25 -> 5,2.5\n * ```\n * \n * Dividing by zero will give Infinity for that dimension.\n * @param line \n * @param point \n * @returns \n */\nexport const divide = (line: Line, point: Point): Line => Object.freeze({\n  ...line,\n  a: PointDivide(line.a, point),\n  b: PointDivide(line.b, point)\n});\n\n","import { fromPoints } from \"./from-points.js\";\nimport type { Line } from \"./line-type.js\";\n\n/**\n * Returns a line from a basis of coordinates (x1, y1, x2, y2)\n * \n * ```js\n * // Line from 0,1 -> 10,15\n * Lines.fromNumbers(0, 1, 10, 15);\n * ```\n * @param x1 \n * @param y1 \n * @param x2 \n * @param y2 \n * @returns \n */\nexport const fromNumbers = (x1: number, y1: number, x2: number, y2: number): Line => {\n  if (Number.isNaN(x1)) throw new Error(`x1 is NaN`);\n  if (Number.isNaN(x2)) throw new Error(`x2 is NaN`);\n  if (Number.isNaN(y1)) throw new Error(`y1 is NaN`);\n  if (Number.isNaN(y2)) throw new Error(`y2 is NaN`);\n\n  const a = { x: x1, y: y1 };\n  const b = { x: x2, y: y2 };\n  return fromPoints(a, b);\n};","import { fromNumbers } from \"./from-numbers.js\";\nimport type { Line } from \"./line-type.js\";\n\n/**\n * Returns a line from four numbers [x1,y1,x2,y2].\n * \n * See {@link toFlatArray} to create an array from a line.\n * \n * ```js\n * const line = Lines.fromFlatArray(...[0, 0, 100, 100]);\n * // line is {a: { x:0, y:0 }, b: { x: 100, y: 100 } }\n * ```\n * @param array Array in the form [x1,y1,x2,y2]\n * @returns Line\n */\nexport const fromFlatArray = (array: readonly number[]): Line => {\n  if (!Array.isArray(array)) throw new Error(`arr parameter is not an array`);\n  if (array.length !== 4) throw new Error(`array is expected to have length four`);\n  return fromNumbers(array[ 0 ], array[ 1 ], array[ 2 ], array[ 3 ]);\n};","import type { Point } from \"../point/point-type.js\"\nimport * as Polar from \"../polar/index.js\";\nimport { radianInvert } from \"../angles.js\";\n\n/**\n * Creates a line from an origin point.\n * ```js\n * // Line of length 0.2 with middle at 0.5,0.5\n * fromPivot({ x:0.5, y:0.5 }, 0.2);\n * // Same line, but on an angle\n * fromPivot({ x:0.5, y:0.5 }, 0.2, degreesToRadian(45));\n * \n * // ...now with pivot point at 20%, rather than center\n * fromPivot({ x:0.5, y:0.5 }, 0.2, degreesToRadian(45), 0.2);\n * ```\n * \n * Examples:\n * * Angle of 0 (deg/rad) results in a horizontal line,\n * * Angle of 90deg in a vertical line. \n * * Angle of 45deg will be angled downwards.\n * \n * @param origin Origin to pivot around\n * @param length Total length of line\n * @param angleRadian Angle of line, in radians\n * @param balance Percentage of where origin ought to be on line. Default: 0.5, meaning the middle of line\n */\nexport const fromPivot = (origin: Point = { x: 0.5, y: 0.5 }, length: number = 1, angleRadian: number = 0, balance: number = 0.5) => {\n  const left = length * balance;\n  const right = length * (1 - balance);\n  const a = Polar.toCartesian(left, radianInvert(angleRadian), origin);\n  const b = Polar.toCartesian(right, angleRadian, origin);\n  return Object.freeze({\n    a, b\n  });\n}","import type { Point } from \"../point/point-type.js\";\nimport { interpolate } from \"./interpolate.js\";\nimport type { Line } from \"./line-type.js\";\nimport { getPointParameter } from \"./get-points-parameter.js\";\n\n/**\n * Returns the mid-point of a line (same as `interpolate` with an amount of 0.5)\n * \n * ```js\n * Lines.midpoint(line); // Returns {x, y}\n * ```\n * @param aOrLine \n * @param pointB \n * @returns \n */\nexport const midpoint = (aOrLine: Point | Line, pointB?: Point): Point => {\n  const [ a, b ] = getPointParameter(aOrLine, pointB);\n  return interpolate(0.5, a, b);\n};","import type { Point } from \"../point/point-type.js\";\nimport type { Line } from \"./line-type.js\";\nimport { length } from \"./length.js\";\nimport { distance as PointsDistance } from \"../point/distance.js\";\n/**\n * Returns the relative position of `pt` along `line`.\n * Warning: assumes `pt` is actually on `line`. Results may be bogus if not.\n * @param line \n * @param pt \n */\nexport const relativePosition = (line: Line, pt: Point): number => {\n  const fromStart = PointsDistance(line.a, pt);\n  const total = length(line);\n  return fromStart / total;\n}","import type { Point } from \"../point/point-type.js\";\nimport type { Line } from \"./line-type.js\";\nimport { sum as PointsSum } from '../point/sum.js';\n\n/**\n * Adds both start and end points by given x,y\n * ```js\n * \n * // Line 1,1 -> 10,10\n * const l = Lines.fromNumbers(1,1,10,10);\n * const ll = Lines.sum(l, {x:2, y:4});\n * // Yields: 3,5 -> 12,14\n * ```\n * @param line \n * @param point \n * @returns \n */\nexport const sum = (line: Line, point: Point): Line => Object.freeze({\n  ...line,\n  a: PointsSum(line.a, point),\n  b: PointsSum(line.b, point)\n});","import { isPoint, isPoint3d } from \"./guard.js\";\nimport type { Point, Point3d } from \"./point-type.js\";\n\nexport function abs(pt: Point3d): Point3d;\nexport function abs(pt: Point): Point;\n\n/**\n * Returns a point with Math.abs applied to x,y and z if present.\n * ```js\n * Points.abs({ x:1,  y:1  }); // { x: 1, y: 1 }\n * Points.abs({ x:-1, y:1  }); // { x: 1, y: 1 }\n * Points.abs({ x:-1, y:-1 }); // { x: 1, y: 1 }\n * ```\n * @param pt\n * @returns\n */\nexport function abs(pt: Point): Point {\n  if (isPoint3d(pt)) {\n    return Object.freeze({\n      ...pt,\n      x: Math.abs(pt.x),\n      y: Math.abs(pt.y),\n      z: Math.abs(pt.z)\n    });\n  } else if (isPoint(pt)) {\n    return Object.freeze({\n      ...pt,\n      x: Math.abs(pt.x),\n      y: Math.abs(pt.y)\n    });\n  } else throw new TypeError(`Param 'pt' is not a point`);\n};","import { guard, isPoint3d } from \"./guard.js\";\nimport type { Point, Point3d } from \"./point-type.js\";\n\n// type PointFields = `x` | `y`;\n// type Point3dFields = PointFields & 'z';\n\nexport type PointApplyFn = (v: number, field: `x` | `y`) => number;\nexport type Point3dApplyFn = (v: number, field: `x` | `y` | `z`) => number;\n\nexport function apply(pt: Point3d, fn: Point3dApplyFn): Point3d\nexport function apply(pt: Point, fn: PointApplyFn): Point;\n\n/**\n * Applies `fn` on x,y & z (if present) fields, returning all other fields as well\n * ```js\n * const p = {x:1.234, y:4.9};\n * const p2 = Points.apply(p, Math.round);\n * // Yields: {x:1, y:5}\n * ```\n *\n * The name of the field is provided as well. Here we only round the `x` field:\n *\n * ```js\n * const p = {x:1.234, y:4.9};\n * const p2 = Points.apply(p, (v, field) => {\n *  if (field === `x`) return Math.round(v);\n *  return v;\n * });\n * ```\n * @param pt\n * @param fn\n * @returns\n */\nexport function apply(\n  pt: Point,\n  fn: Point3dApplyFn | PointApplyFn\n): Point {\n  guard(pt, `pt`);\n  if (isPoint3d(pt)) {\n    return Object.freeze<Point3d>({\n      ...pt,\n      x: fn(pt.x, `x`),\n      y: fn(pt.y, `y`),\n      z: (fn as Point3dApplyFn)(pt.z, `z`)\n    });\n  }\n  return Object.freeze<Point>({\n    ...pt,\n    x: fn(pt.x, `x`),\n    y: fn(pt.y, `y`),\n  });\n}","import { movingAverageLight as mal } from \"@ixfx/numbers\"\nimport { isPoint3d } from \"./guard.js\";\nimport type { Point } from \"./point-type.js\";\n\nexport type PointAverager = (point: Point) => Point;\nexport type PointAverageKinds = `moving-average-light`;\n\n\n/**\n * Keeps track of average x, y and z values.\n * \n * When calling, you have to specify the averaging technique. At the moment\n * only 'moving-average-light' is supported. This uses @ixfx/numbers.movingAverageLight\n * under-the-hood.\n * \n * ```js\n * // Create averager\n * const averager = Points.averager(`moving-average-light`);\n * \n * // Call function with a point to add it to average\n * // and return the current average.\n * averager(somePoint); // Yields current average {x,y,z?}\n * ```\n * \n * @param kind Averaging strategy\n * @param opts Scaling parameter. Higher means more smoothing, lower means less (minimum: 1). Default: 3\n * @returns \n */\nexport function averager(kind: `moving-average-light`, opts: Partial<{ scaling: number }>): PointAverager;\n\nexport function averager(kind: PointAverageKinds, opts: Partial<{ scaling: number }> = {}): PointAverager {\n  let x: (v: number) => number;\n  let y: (v: number) => number;\n  let z: (v: number) => number;\n  switch (kind) {\n    case `moving-average-light`:\n      {\n        const scaling = opts.scaling ?? 3;\n        x = mal(scaling);\n        y = mal(scaling);\n        z = mal(scaling);\n        break;\n      }\n    default:\n      throw new Error(`Unknown averaging kind '${ kind }'. Expected: 'moving-average-light'`);\n  }\n\n  return (point: Point) => {\n    const ax = x(point.x);\n    const ay = y(point.y);\n    if (isPoint3d(point)) {\n      const az = z(point.z);\n      return Object.freeze({\n        x: ax,\n        y: ay,\n        z: az\n      })\n    } else {\n      return Object.freeze({\n        x: ax,\n        y: ay\n      })\n    }\n  }\n}","import { isPoint } from \"./guard.js\";\nimport type { Point } from \"./point-type.js\";\n\n/**\n * Calculates the [centroid](https://en.wikipedia.org/wiki/Centroid#Of_a_finite_set_of_points) of a set of points\n * Undefined values are skipped over. Calculation and return value is 2D.\n *\n * ```js\n * // Find centroid of a list of points\n * const c1 = centroid(p1, p2, p3, ...);\n *\n * // Find centroid of an array of points\n * const c2 = centroid(...pointsArray);\n * ```\n * @param points\n * @returns A single point\n */\nexport const centroid = (...points: readonly (Point | undefined)[]): Point => {\n  if (!Array.isArray(points)) throw new Error(`Expected list of points`);\n\n  const sum = points.reduce<Point>(\n    (previous, p) => {\n      if (p === undefined) return previous; // Ignore undefined\n      if (Array.isArray(p)) {\n        throw new TypeError(\n          `'points' list contains an array. Did you mean: centroid(...myPoints)?`\n        );\n      }\n      if (!isPoint(p)) {\n        throw new Error(\n          `'points' contains something which is not a point: ${ JSON.stringify(\n            p\n          ) }`\n        );\n      }\n      return {\n        x: previous.x + p.x,\n        y: previous.y + p.y,\n      };\n    },\n    { x: 0, y: 0 }\n  );\n\n  return Object.freeze({\n    x: sum.x / points.length,\n    y: sum.y / points.length,\n  });\n};\n\n","import { clamp as clampNumber } from '@ixfx/numbers';\nimport { isPoint3d } from \"./guard.js\";\nimport type { Point, Point3d } from \"./point-type.js\";\n\nexport function clamp(a: Point, min?: number, max?: number): Point;\nexport function clamp(a: Point3d, min?: number, max?: number): Point3d;\n\n/**\n * Clamps a point to be between `min` and `max` (0 & 1 by default)\n * @param pt Point\n * @param min Minimum value (0 by default)\n * @param max Maximum value (1 by default)\n */\nexport function clamp(\n  a: Point,\n  min = 0,\n  max = 1\n): Point {\n\n  if (isPoint3d(a)) {\n    return Object.freeze({\n      x: clampNumber(a.x, min, max),\n      y: clampNumber(a.y, min, max),\n      z: clampNumber(a.z, min, max)\n    });\n  } else {\n    return Object.freeze({\n      x: clampNumber(a.x, min, max),\n      y: clampNumber(a.y, min, max),\n    });\n  }\n}\n","import type { Point, Point3d } from \"./point-type.js\";\n\n/**\n * Returns -2 if both x & y of a is less than b\n * Returns -1 if either x/y of a is less than b\n *\n * Returns 2 if both x & y of a is greater than b\n * Returns 1 if either x/y of a is greater than b's x/y\n *\n * Returns 0 if x/y of a and b are equal\n * @param a\n * @param b\n * @returns\n */\nexport const compare = (a: Point, b: Point): number => {\n  if (a.x < b.x && a.y < b.y) return -2;\n  if (a.x > b.x && a.y > b.y) return 2;\n  if (a.x < b.x || a.y < b.y) return -1;\n  if (a.x > b.x || a.y > b.y) return 1;\n  if (a.x === b.x && a.x === b.y) return 0;\n  return Number.NaN;\n};\n\n/**\n * Compares points based on x value. Y value is ignored.\n * \n * Return values:\n * * 0: If a.x === b.x\n * * 1: a is to the right of b (ie. a.x > b.x)\n * * -1: a is to the left of b (ie. a.x < b.x)\n *\n * @example Sorting by x\n * ```js\n * arrayOfPoints.sort(Points.compareByX);\n * ```\n * \n * @param a\n * @param b\n * @returns\n */\nexport const compareByX = (a: Point, b: Point): number => {\n  if (a.x === b.x) return 0;\n  if (a.x < b.x) return -1;\n  return 1;\n\n  // a.x - b.x || a.y - b.y;\n}\n\n/**\n * Compares points based on Y value. X value is ignored.\n * \n * Return values:\n * * 0: If a.y === b.y\n * * 1: A is below B (ie. a.y > b.y)\n * * -1: A is above B (ie. a.y < b.y)\n *\n * @example Sorting by Y\n * ```js\n * arrayOfPoints.sort(Points.compareByY);\n * ```\n * @param a\n * @param b\n * @returns\n */\nexport const compareByY = (a: Point, b: Point): number => {\n  if (a.y === b.y) return 0;\n  if (a.y < b.y) return -1;\n  return 1;\n}\n\n/**\n * Compares points based on Z value. XY values are ignored.\n * \n * Return values:\n * * 0: If a.z === b.z\n * * 1: A is below B (ie. a.z > b.z)\n * * -1: A is above B (ie. a.z < b.z)\n *\n * @example Sorting by Y\n * ```js\n * arrayOfPoints.sort(Points.compareByZ);\n * ```\n * @param a\n * @param b\n * @returns\n */\nexport const compareByZ = (a: Point3d, b: Point3d): number => {\n  if (a.z === b.z) return 0;\n  if (a.z < b.z) return -1;\n  return 1;\n}","import { compareByX } from \"./compare.js\";\nimport { isEqual } from \"./is-equal.js\";\nimport type { Point } from \"./point-type.js\";\n\n/**\n * Simple convex hull impementation. Returns a set of points which\n * enclose `pts`.\n *\n * For more power, see something like [Hull.js](https://github.com/AndriiHeonia/hull)\n * @param pts\n * @returns\n */\nexport const convexHull = (...pts: ReadonlyArray<Point>): ReadonlyArray<Point> => {\n  const sorted = [ ...pts ].sort(compareByX);\n  if (sorted.length === 1) return sorted;\n\n  const x = (points: Array<Point>) => {\n    const v: Array<Point> = [];\n    for (const p of points) {\n      while (v.length >= 2) {\n        // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n        const q = v.at(-1)!;\n        // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n        const r = v.at(-2)!;\n        if ((q.x - r.x) * (p.y - r.y) >= (q.y - r.y) * (p.x - r.x)) {\n          //eslint-disable-next-line functional/immutable-data\n          v.pop();\n        } else break;\n      }\n      //eslint-disable-next-line functional/immutable-data\n      v.push(p);\n    }\n    //eslint-disable-next-line functional/immutable-data\n    v.pop();\n    return v;\n  };\n\n  const upper = x(sorted);\n  //eslint-disable-next-line functional/immutable-data\n  const lower = x(sorted.reverse());\n\n  if (upper.length === 1 && lower.length === 1 && isEqual(lower[ 0 ], upper[ 0 ])) {\n    return upper;\n  }\n  return [ ...upper, ...lower ];\n};","import { guard } from \"./guard.js\";\nimport { isPositioned, isRectPositioned } from \"./guard.js\";\nimport { isCirclePositioned } from '../circle/guard.js';\nimport * as Intersects from '../intersects.js';\nimport { isPoint } from \"../point/guard.js\";\nimport type { Rect, RectPositioned } from \"./rect-types.js\";\nimport type { Point } from \"../point/point-type.js\";\nimport type { CirclePositioned } from \"../circle/circle-type.js\";\n/**\n * Returns _true_ if `point` is within, or on boundary of `rect`.\n *\n * ```js\n * Rects.intersectsPoint(rect, { x: 100, y: 100});\n * ```\n * @param rect\n * @param point\n */\nexport function intersectsPoint(\n  rect: Rect | RectPositioned,\n  point: Point\n): boolean;\n\n/**\n * Returns true if x,y coordinate is within, or on boundary of `rect`.\n * ```js\n * Rects.intersectsPoint(rect, 100, 100);\n * ```\n * @param rect\n * @param x\n * @param y\n */\nexport function intersectsPoint(\n  rect: Rect | RectPositioned,\n  x: number,\n  y: number\n): boolean;\n\n/**\n * Returns true if point is within or on boundary of `rect`.\n *\n * ```js\n * Rects.intersectsPoint(rect, { x: 100, y: 100});\n * Rects.intersectsPoint(rect, 100, 100);\n * ```\n * @param rect\n * @param a\n * @param b\n * @returns\n */\n\nexport function intersectsPoint(\n  rect: Rect | RectPositioned,\n  a: Point | number,\n  b?: number\n): boolean {\n  guard(rect, `rect`);\n  let x = 0;\n  let y = 0;\n  if (typeof a === `number`) {\n    if (b === undefined) throw new Error(`x and y coordinate needed`);\n    x = a;\n    y = b;\n  } else {\n    x = a.x;\n    y = a.y;\n  }\n  if (isPositioned(rect)) {\n    if (x - rect.x > rect.width || x < rect.x) return false;\n    if (y - rect.y > rect.height || y < rect.y) return false;\n  } else {\n    // Assume 0,0\n    if (x > rect.width || x < 0) return false;\n    if (y > rect.height || y < 0) return false;\n  }\n  return true;\n}\n\n/**\n * Returns true if `a` or `b` overlap, are equal, or `a` contains `b`.\n * A rectangle can be checked for intersections with another RectPositioned, CirclePositioned or Point.\n *\n */\nexport const isIntersecting = (\n  a: RectPositioned,\n\n  b: CirclePositioned | Point\n): boolean => {\n  if (!isRectPositioned(a)) {\n    throw new Error(`a parameter should be RectPositioned`);\n  }\n\n  if (isCirclePositioned(b)) {\n    return Intersects.circleRect(b, a);\n  } else if (isPoint(b)) {\n    return intersectsPoint(a, b);\n  }\n  throw new Error(`Unknown shape for b: ${ JSON.stringify(b) }`);\n};","import { isPoint } from \"../point/guard.js\";\nimport type { Point } from \"../point/point-type.js\";\nimport { getRectPositioned, guard } from \"./guard.js\";\nimport type { Rect, RectPositioned } from \"./rect-types.js\";\n\n/**\n * Returns the center of a rectangle as a {@link Point}.\n *  If the rectangle lacks a position and `origin` parameter is not provided, 0,0 is used instead.\n *\n * ```js\n * const p = Rects.center({x:10, y:20, width:100, height:50});\n * const p2 = Rects.center({width: 100, height: 50}); // Assumes 0,0 for rect x,y\n * ```\n * @param rect Rectangle\n * @param origin Optional origin. Overrides `rect` position if available. If no position is available 0,0 is used by default.\n * @returns\n */\nexport const center = (\n  rect: RectPositioned | Rect,\n  origin?: Point\n): Point => {\n  guard(rect);\n  if (origin === undefined && isPoint(rect)) origin = rect;\n  else if (origin === undefined) origin = { x: 0, y: 0 }; // throw new Error(`Unpositioned rect needs origin param`);\n\n  const r = getRectPositioned(rect, origin);\n  return Object.freeze({\n    x: origin.x + rect.width / 2,\n    y: origin.y + rect.height / 2,\n  });\n};","import { guardPositioned } from \"./guard.js\";\nimport { intersectsPoint } from \"./Intersects.js\";\nimport { center } from \"./center.js\";\nimport type { RectPositioned } from \"./rect-types.js\";\nimport { type Point } from '../point/point-type.js';\nimport { guard as PointsGuard } from '../point/guard.js';\nimport { distance as PointsDistance } from '../point/distance.js';\n\n/**\n * Returns the distance from the perimeter of `rect` to `pt`.\n * If the point is within the rectangle, 0 is returned.\n *\n * If `rect` does not have an x,y it's assumed to be 0,0\n *\n * ```js\n * const rect = { width: 100, height: 100, x: 0, y: 0 };\n * Rects.distanceFromExterior(rect, { x: 20, y: 20 });\n * ```\n * @param rect Rectangle\n * @param pt Point\n * @returns Distance\n */\nexport const distanceFromExterior = (\n  rect: RectPositioned,\n  pt: Point\n): number => {\n  guardPositioned(rect, `rect`);\n  PointsGuard(pt, `pt`);\n  if (intersectsPoint(rect, pt)) return 0;\n  const dx = Math.max(rect.x - pt.x, 0, pt.x - rect.x + rect.width);\n  const dy = Math.max(rect.y - pt.y, 0, pt.y - rect.y + rect.height);\n  return Math.hypot(dx, dy);\n};\n\n/**\n * Return the distance of `pt` to the center of `rect`.\n *\n * ```js\n * const rect = { width: 100, height: 100, x: 0, y: 0 };\n * Rects.distanceFromCenter(rect, { x: 20, y: 20 });\n * ```\n * @param rect\n * @param pt\n * @returns\n */\nexport const distanceFromCenter = (\n  rect: RectPositioned,\n  pt: Point\n): number => PointsDistance(center(rect), pt);\n","import { distanceFromExterior as circleDistanceFromExterior } from \"../circle/distance-from-exterior.js\";\nimport { distance } from \"./distance.js\";\nimport { isPoint } from \"./guard.js\";\nimport { distanceFromExterior as rectDistanceFromExterior } from \"../rect/distance.js\";\nimport type { Point } from \"./point-type.js\";\nimport { isCirclePositioned } from \"../circle/guard.js\";\nimport { isRectPositioned } from \"../rect/guard.js\";\nimport type { PointCalculableShape } from \"../shape/index.js\";\n\n/**\n * Returns the distance from point `a` to the center of `shape`.\n * @param a Point\n * @param shape Point, or a positioned Rect or Circle.\n * @returns\n */\nexport const distanceToCenter = (\n  a: Point,\n  shape: PointCalculableShape\n): number => {\n  if (isRectPositioned(shape)) {\n    return rectDistanceFromExterior(shape, a);\n  }\n  if (isCirclePositioned(shape)) {\n    return circleDistanceFromExterior(shape, a);\n  }\n  if (isPoint(shape)) return distance(a, shape);\n  throw new Error(`Unknown shape`);\n};","import { distanceFromExterior as rectDistanceFromExterior } from \"../rect/distance.js\";\nimport { isCirclePositioned } from \"../circle/guard.js\";\nimport { isRectPositioned } from \"../rect/guard.js\";\nimport type { Point } from \"./point-type.js\";\nimport type { PointCalculableShape } from \"../shape/shape-type.js\";\nimport { isPoint } from \"./guard.js\";\nimport { distance } from \"./distance.js\";\nimport { distanceFromExterior as circleDistanceFromExterior } from \"../circle/distance-from-exterior.js\";\n/**\n * Returns the distance from point `a` to the exterior of `shape`.\n *\n * @example Distance from point to rectangle\n * ```\n * const distance = distanceToExterior(\n *  {x: 50, y: 50},\n *  {x: 100, y: 100, width: 20, height: 20}\n * );\n * ```\n *\n * @example Find closest shape to point\n * ```\n * import {minIndex} from '../data/arrays.js';\n * const shapes = [ some shapes... ]; // Shapes to compare against\n * const pt = { x: 10, y: 10 };       // Comparison point\n * const distances = shapes.map(v => distanceToExterior(pt, v));\n * const closest = shapes[minIndex(...distances)];\n * ```\n * @param a Point\n * @param shape Point, or a positioned Rect or Circle.\n * @returns\n */\nexport const distanceToExterior = (\n  a: Point,\n  shape: PointCalculableShape\n): number => {\n  if (isRectPositioned(shape)) {\n    return rectDistanceFromExterior(shape, a);\n  }\n  if (isCirclePositioned(shape)) {\n    return circleDistanceFromExterior(shape, a);\n  }\n  if (isPoint(shape)) return distance(a, shape);\n  throw new Error(`Unknown shape`);\n};","import type { Point } from \"./point-type.js\";\n\n/**\n * Returns point as an array in the form [x,y]. This can be useful for some libraries\n * that expect points in array form.\n *\n * ```\n * const p = {x: 10, y:5};\n * const p2 = toArray(p); // yields [10,5]\n * ```\n * @param p\n * @returns\n */\nexport const toArray = (p: Point): ReadonlyArray<number> => [ p.x, p.y ];\n","import { dotProduct as ArraysDotProduct } from '@ixfx/numbers';\nimport type { Point } from './point-type.js';\nimport { toArray } from './to-array.js';\n\nexport const dotProduct = (...pts: readonly Point[]): number => {\n  const a = pts.map(p => toArray(p));\n  return ArraysDotProduct(a);\n};","import { guard } from \"./guard.js\";\nimport type { Point, Point3d } from \"./point-type.js\";\n\nexport function from(x: number, y: number, z: number): Point3d;\nexport function from(x: number, y: number): Point;\nexport function from(array: [ x: number, y: number, z: number ]): Point3d;\nexport function from(array: [ x: number, y: number ]): Point;\n\n/**\n * Returns a point from two or three coordinates or an array of [x,y] or [x,y,z].\n * @example\n * ```js\n * let p = from([10, 5]);    // yields {x:10, y:5}\n * let p = from([10, 5, 2]); // yields: {x:10, y:5, z:2}\n * let p = from(10, 5);      // yields {x:10, y:5}\n * let p = from(10, 5, 2);   // yields: {x:10, y:5, z:2}\n * ```\n * @param xOrArray\n * @param [y]\n * @returns Point\n */\nexport function from(\n  xOrArray?: number | readonly number[],\n  y?: number,\n  z?: number\n): Point {\n  if (Array.isArray(xOrArray)) {\n    if (xOrArray.length === 3) {\n      return Object.freeze({\n        x: xOrArray[ 0 ],\n        y: xOrArray[ 1 ],\n        z: xOrArray[ 2 ]\n      });\n    } else if (xOrArray.length === 2) {\n      return Object.freeze({\n        x: xOrArray[ 0 ],\n        y: xOrArray[ 1 ],\n      });\n    } else {\n      throw new Error(`Expected array of length two or three, got ${ xOrArray.length }`);\n    }\n  } else {\n    if (xOrArray === undefined) throw new Error(`Requires an array of [x,y] or x,y parameters at least`)\n    else if (Number.isNaN(xOrArray)) throw new Error(`x is NaN`);\n    if (y === undefined) throw new Error(`Param 'y' is missing`);\n    else if (Number.isNaN(y)) throw new Error(`y is NaN`);\n    if (z === undefined) {\n      return Object.freeze({ x: xOrArray as number, y: y });\n    } else {\n      return Object.freeze({ x: xOrArray as number, y, z })\n    }\n  }\n};\n\n/**\n * Parses a point as a string, in the form 'x,y' or 'x,y,z'.\n * eg '10,15' will be returned as `{ x: 10, y: 15 }`.\n * \n * Throws an error if `str` is not a string.\n * \n * ```js\n * Points.fromString(`10,15`);  // { x:10, y:15 }\n * Points.fromString(`a,10`);   // { x:NaN, y:10 }\n * ```\n * \n * Use {@link Points.isNaN} to check if returned point has NaN for either coordinate.\n * @param string_ \n */\nexport const fromString = (string_: string): Point => {\n  if (typeof string_ !== `string`) throw new TypeError(`Param 'str' ought to be a string. Got: ${ typeof string_ }`);\n  const comma = string_.indexOf(`,`);\n  const x = Number.parseFloat(string_.substring(0, comma));\n  const nextComma = string_.indexOf(',', comma + 1);\n  if (nextComma > 0) {\n    // z component\n    const y = Number.parseFloat(string_.substring(comma + 1, nextComma - comma + 2));\n    const z = Number.parseFloat(string_.substring(nextComma + 1));\n    return { x, y, z };\n  } else {\n    const y = Number.parseFloat(string_.substring(comma + 1));\n    return { x, y };\n  }\n}\n\n\n/**\n * Returns an array of points from an array of numbers.\n *\n * Array can be a continuous series of x, y values:\n * ```\n * [1,2,3,4] would yield: [{x:1, y:2}, {x:3, y:4}]\n * ```\n *\n * Or it can be an array of arrays:\n * ```\n * [[1,2], [3,4]] would yield: [{x:1, y:2}, {x:3, y:4}]\n * ```\n * @param coords\n * @returns\n */\nexport const fromNumbers = (\n  ...coords: readonly (readonly number[])[] | readonly number[]\n): readonly Point[] => {\n  const pts: Point[] = [];\n\n  if (Array.isArray(coords[ 0 ])) {\n    // [[x,y],[x,y]...]\n    for (const coord of (coords as number[][])) {\n      if (!(coord.length % 2 === 0)) {\n        throw new Error(`coords array should be even-numbered`);\n      }\n      pts.push(Object.freeze({ x: coord[ 0 ], y: coord[ 1 ] }));\n    }\n  } else {\n    // [x,y,x,y,x,y]\n    if (coords.length % 2 !== 0) {\n      throw new Error(`Expected even number of elements: [x,y,x,y...]`);\n    }\n\n    for (let index = 0; index < coords.length; index += 2) {\n      pts.push(\n        Object.freeze({ x: coords[ index ] as number, y: coords[ index + 1 ] as number })\n      );\n    }\n  }\n  return pts;\n};\n","import type { Point } from \"./point-type.js\";\nimport { interpolate as lineInterpolate } from '../line/interpolate.js';\n\n/**\n * Returns a relative point between two points.\n * \n * ```js\n * interpolate(0.5, { x:0, y:0 }, { x:10, y:10 }); // Halfway { x, y }\n * ```\n *\n * Alias for Lines.interpolate(amount, a, b);\n *\n * @param amount Relative amount, 0-1\n * @param a\n * @param b\n * @param allowOverflow If true, length of line can be exceeded for `amount` of below 0 and above `1`.\n * @returns {@link Point}\n */\nexport const interpolate = (\n  amount: number,\n  a: Point,\n  b: Point,\n  allowOverflow = false\n): Point => lineInterpolate(amount, a, b, allowOverflow); //({x: (1-amt) * a.x + amt * b.x, y:(1-amt) * a.y + amt * b.y });\n","import { isPoint3d } from \"./guard.js\";\nimport type { Point, Point3d } from \"./point-type.js\";\n\n/**\n * Inverts one or more axis of a point\n * ```js\n * invert({x:10, y:10}); // Yields: {x:-10, y:-10}\n * invert({x:10, y:10}, `x`); // Yields: {x:-10, y:10}\n * ```\n * @param pt Point to invert\n * @param what Which axis. If unspecified, both axies are inverted\n * @returns\n */\nexport const invert = (\n  pt: Point | Point3d,\n  what: `both` | `x` | `y` | `z` = `both`\n): Point => {\n  switch (what) {\n    case `both`: {\n      return isPoint3d(pt) ? Object.freeze({\n        ...pt,\n        x: pt.x * -1,\n        y: pt.y * -1,\n        z: pt.z * -1,\n      }) : Object.freeze({\n        ...pt,\n        x: pt.x * -1,\n        y: pt.y * -1,\n      });\n    }\n    case `x`: {\n      return Object.freeze({\n        ...pt,\n        x: pt.x * -1,\n      });\n    }\n    case `y`: {\n      return Object.freeze({\n        ...pt,\n        y: pt.y * -1,\n      });\n    }\n    case `z`: {\n      if (isPoint3d(pt)) {\n        return Object.freeze({\n          ...pt,\n          z: pt.z * -1,\n        });\n      } else throw new Error(`pt parameter is missing z`);\n    }\n    default: {\n      throw new Error(`Unknown what parameter. Expecting 'both', 'x' or 'y'`);\n    }\n  }\n};","import { distance } from \"./distance.js\";\nimport { multiply } from \"./multiply.js\";\nimport type { Point } from \"./point-type.js\";\n\n/**\n * Clamps the magnitude of a point.\n * This is useful when using a Point as a vector, to limit forces.\n * @param pt\n * @param max Maximum magnitude (1 by default)\n * @param min Minimum magnitude (0 by default)\n * @returns\n */\nexport const clampMagnitude = (pt: Point, max = 1, min = 0): Point => {\n  const length = distance(pt);\n  let ratio = 1;\n  if (length > max) {\n    ratio = max / length;\n  } else if (length < min) {\n    ratio = min / length;\n  }\n  return ratio === 1 ? pt : multiply(pt, ratio, ratio);\n};","import { findMinimum } from \"./find-minimum.js\";\nimport type { Point } from \"./point-type.js\";\n\n/**\n * Returns the left-most of the provided points.\n *\n * Same as:\n * ```js\n * findMinimum((a, b) => {\n *  if (a.x <= b.x) return a;\n *  return b;\n *}, ...points)\n * ```\n *\n * @param points\n * @returns\n */\nexport const leftmost = (...points: ReadonlyArray<Point>): Point =>\n  findMinimum((a, b) => (a.x <= b.x ? a : b), ...points);\n\n/**\n * Returns the right-most of the provided points.\n *\n * Same as:\n * ```js\n * findMinimum((a, b) => {\n *  if (a.x >= b.x) return a;\n *  return b;\n *}, ...points)\n * ```\n *\n * @param points\n * @returns\n */\nexport const rightmost = (...points: ReadonlyArray<Point>): Point =>\n  findMinimum((a, b) => (a.x >= b.x ? a : b), ...points);\n","import { Empty } from \"./empty.js\";\nimport { getPointParameter } from \"./get-point-parameter.js\";\nimport { isPoint } from \"./guard.js\";\nimport type { Point } from \"./point-type.js\";\n\nconst length = (ptOrX: Point | number, y?: number): number => {\n  if (isPoint(ptOrX)) {\n    y = ptOrX.y;\n    ptOrX = ptOrX.x;\n  }\n  if (y === undefined) throw new Error(`Expected y`);\n  return Math.hypot(ptOrX, y);\n};\n\n\n\n/**\n * Normalise point as a unit vector.\n *\n * ```js\n * normalise({x:10, y:20});\n * normalise(10, 20);\n * ```\n * @param ptOrX Point, or x value\n * @param y y value if first param is x\n * @returns\n */\nexport const normalise = (ptOrX: Point | number, y?: number): Point => {\n  const pt = getPointParameter(ptOrX, y);\n  const l = length(pt);\n  if (l === 0) return Empty;\n  return Object.freeze({\n    ...pt,\n    x: pt.x / l,\n    y: pt.y / l,\n  });\n};","import type { Point } from \"./point-type.js\";\n\n/**\n * Runs a sequential series of functions on `pt`. The output from one feeding into the next.\n * \n * ```js\n * const p = Points.pipelineApply(somePoint, Points.normalise, Points.invert);\n * ```\n *\n * If you want to make a reusable pipeline of functions, consider {@link pipeline} instead.\n * @param point\n * @param pipelineFns\n * @returns\n */\nexport const pipelineApply = (\n  point: Point,\n  ...pipelineFns: readonly ((pt: Point) => Point)[]\n): Point => pipeline(...pipelineFns)(point); // pipeline.reduce((prev, curr) => curr(prev), pt);\n\n/**\n * Returns a pipeline function that takes a point to be transformed through a series of functions\n * ```js\n * // Create pipeline\n * const p = Points.pipeline(Points.normalise, Points.invert);\n *\n * // Now run it on `somePoint`.\n * // First we normalised, and then invert\n * const changedPoint = p(somePoint);\n * ```\n *\n * If you don't want to create a pipeline, use {@link pipelineApply}.\n * @param pipeline Pipeline of functions\n * @returns\n */\nexport const pipeline =\n  (...pipeline: readonly ((pt: Point) => Point)[]) =>\n    (pt: Point) =>\n\n      pipeline.reduce((previous, current) => current(previous), pt);\n","import type { Line } from './line/line-type.js';\nimport type { Point } from './point/point-type.js';\nimport { normalise as PointsNormalise } from './point/normalise.js';\nimport { isPoint } from './point/guard.js';\nimport * as Polar from './polar/index.js';\nimport { divide as PointDivide } from './point/divider.js';\nimport { guard as LinesGuard } from './line/guard.js';\nimport { sum as PointsSum } from './point/sum.js';\nimport { subtract as PointsSubtract } from './point/index.js';\nimport { multiply as PointsMultiply } from './point/multiply.js';\nimport { dotProduct as PointsDotProduct } from './point/dot-product.js';\nimport { toString as PointsToString } from './point/To.js';\nimport { clampMagnitude as PointsClampMagnitude } from './point/magnitude.js';\nimport { distance as PointsDistance } from './point/distance.js';\nimport { Empty as PointEmpty } from './point/empty.js';\n\nexport type Vector = Point | Polar.Coord;\n\nconst EmptyCartesian = Object.freeze({ x: 0, y: 0 });\n\nconst piPi = Math.PI * 2;\nconst pi = Math.PI;\n\n// const Q1 = Math.PI / 2;\n// const Q2 = Math.PI;\n// const Q3 = Q1 + Q2;\n// const Q4 = Math.PI * 2;\n\nexport const fromRadians = (radians: number) => {\n  return Object.freeze({\n    x: Math.cos(radians),\n    y: Math.sin(radians)\n  });\n}\n\nexport const toRadians = (point: Point) => {\n  return Math.atan2(point.y, point.x);\n}\n/**\n * Create a vector from a point\n *\n * If `unipolar` normalisation is used, direction will be fixed to 0..2\n * if `bipolar` normalisation is used, direction will be fixed to -...\n * @param pt Point\n * @param angleNormalisation Technique to normalise angle\n * @param origin Origin to calculate vector from or 0,0 if left empty\n * @returns\n */\nexport const fromPointPolar = (\n  pt: Point,\n  angleNormalisation: `` | `unipolar` | `bipolar` = ``,\n  origin: Point = EmptyCartesian\n): Polar.Coord => {\n  pt = PointsSubtract(pt, origin);\n\n  let direction = Math.atan2(pt.y, pt.x);\n  if (angleNormalisation === `unipolar` && direction < 0) direction += piPi;\n  else if (angleNormalisation === `bipolar`) {\n    if (direction > pi) direction -= piPi;\n    else if (direction <= -pi) direction += piPi;\n  }\n\n  return Object.freeze({\n    distance: PointsDistance(pt),\n    angleRadian: direction,\n  });\n};\n\n/**\n * Returns a Cartesian-coordinate vector from a line a -> b\n * @param line\n * @returns\n */\nexport const fromLineCartesian = (line: Line): Point =>\n  PointsSubtract(line.b, line.a);\n\n/**\n * Returns a polar-coordinate vector from a line a -> b\n * @param line\n * @returns\n */\nexport const fromLinePolar = (line: Line): Polar.Coord => {\n  LinesGuard(line, `line`);\n  const pt = PointsSubtract(line.b, line.a);\n  return fromPointPolar(pt);\n};\n\nconst isPolar = (v: Vector): v is Polar.Coord => {\n  if (Polar.isPolarCoord(v)) return true;\n  return false;\n};\n\nconst isCartesian = (v: Vector): v is Point => {\n  if (isPoint(v)) return true;\n  return false;\n};\n\n/**\n * Returns the normalised vector (aka unit vector). This is where\n * direction is kept, but magnitude set to 1. This then just\n * suggests direction.\n * @param v\n * @returns\n */\nexport const normalise = (v: Vector): Vector => {\n  if (isPolar(v)) {\n    return Polar.normalise(v);\n  } else if (isCartesian(v)) {\n    return PointsNormalise(v);\n  }\n\n  throw new Error(`Expected polar/cartesian vector. Got: ${ v }`);\n};\n\nexport const quadrantOffsetAngle = (p: Point): number => {\n  if (p.x >= 0 && p.y >= 0) return 0; // Q1\n  if (p.x < 0 && p.y >= 0) return pi; // Q2\n  if (p.x < 0 && p.y < 0) return pi; // Q3\n  return piPi; // Q4\n};\n\n/**\n * Converts a vector to a polar coordinate. If the provided\n * value is already Polar, it is returned.\n * @param v\n * @param origin\n * @returns Polar vector\n */\nexport const toPolar = (v: Vector, origin = PointEmpty): Polar.Coord => {\n  if (isPolar(v)) {\n    return v;\n  } else if (isCartesian(v)) {\n    return Polar.fromCartesian(v, origin);\n  }\n\n  throw new Error(`Expected polar/cartesian vector. Got: ${ v }`);\n};\n\n/**\n * Converts a Vector to a Cartesian coordinate. If the provided\n * value is already Cartesian, it is returned.\n * @param v\n * @returns Cartestian vector\n */\nexport const toCartesian = (v: Vector): Point => {\n  if (isPolar(v)) {\n    return Polar.toPoint(v);\n  } else if (isCartesian(v)) {\n    return v;\n  }\n\n  throw new Error(`Expected polar/cartesian vector. Got: ${ v }`);\n};\n\n/**\n * Return a human-friendly representation of vector\n * @param v\n * @param digits\n * @returns\n */\nexport const toString = (v: Vector, digits?: number) => {\n  if (isPolar(v)) {\n    return Polar.toString(v, digits);\n  } else if (isCartesian(v)) {\n    return PointsToString(v, digits);\n  }\n\n  throw new Error(`Expected polar/cartesian vector. Got: ${ v }`);\n};\n\n/**\n * Calculate dot product of a vector\n * @param a\n * @param b\n * @returns\n */\nexport const dotProduct = (a: Vector, b: Vector) => {\n  if (isPolar(a) && isPolar(b)) {\n    return Polar.dotProduct(a, b);\n  } else if (isCartesian(a) && isCartesian(b)) {\n    return PointsDotProduct(a, b);\n  }\n  throw new Error(`Expected two polar/Cartesian vectors.`);\n};\n\n/**\n * Clamps the magnitude of a vector\n * @param v Vector to clamp\n * @param max Maximum magnitude\n * @param min Minium magnitude\n * @returns\n */\nexport const clampMagnitude = (v: Vector, max = 1, min = 0) => {\n  if (isPolar(v)) {\n    return Polar.clampMagnitude(v, max, min);\n  } else if (isCartesian(v)) {\n    return PointsClampMagnitude(v, max, min);\n  }\n  throw new Error(`Expected either polar or Cartesian vector`);\n};\n\n/**\n * Returns `a + b`.\n *\n * Vector is returned in the same type as `a`.\n * @param a\n * @param b\n * @returns\n */\nexport const sum = (a: Vector, b: Vector) => {\n  const polar = isPolar(a);\n  a = toCartesian(a);\n  b = toCartesian(b);\n  const c = PointsSum(a, b);\n  return polar ? toPolar(c) : c;\n};\n\n/**\n * Returns `a - b`.\n *\n * Vector is returned in the same type as `a`\n * @param a\n * @param b\n */\nexport const subtract = (a: Vector, b: Vector) => {\n  const polar = isPolar(a);\n  a = toCartesian(a);\n  b = toCartesian(b);\n  const c = PointsSubtract(a, b);\n  return polar ? toPolar(c) : c;\n};\n\n/**\n * Returns `a * b`.\n *\n * Vector is returned in the same type `a`.\n * @param a\n * @param b\n */\nexport const multiply = (a: Vector, b: Vector) => {\n  const polar = isPolar(a);\n  a = toCartesian(a);\n  b = toCartesian(b);\n  const c = PointsMultiply(a, b);\n  return polar ? toPolar(c) : c;\n};\n\n/**\n * Returns `a / b`.\n *\n * Vector is returned in the same type `a`.\n * @param a\n * @param b\n */\nexport const divide = (a: Vector, b: Vector) => {\n  const polar = isPolar(a);\n  a = toCartesian(a);\n  b = toCartesian(b);\n  const c = PointDivide(a, b);\n  return polar ? toPolar(c) : c;\n};\n","import type { Point } from \"../point/point-type.js\";\nimport { fromPoints } from \"./from-points.js\";\nimport type { Line, PolyLine } from \"./line-type.js\";\n\n/**\n * Returns an array of lines that connects provided points. Note that line is not closed.\n * \n * Eg, if points a,b,c are provided, two lines are provided: a->b and b->c.\n * \n * ```js\n * const lines = Lines.joinPointsToLines(ptA, ptB, ptC);\n * // lines is an array of, well, lines\n * ```\n * @param points \n * @returns \n */\nexport const joinPointsToLines = (...points: readonly Point[]): PolyLine => {\n  const lines: Line[] = [];\n\n  let start = points[ 0 ];\n\n  for (let index = 1; index < points.length; index++) {\n    lines.push(fromPoints(start, points[ index ]));\n    start = points[ index ];\n  }\n  return lines;\n};","import { angleRadian } from \"./angle.js\";\nimport { centroid } from \"./centroid.js\";\nimport { distance } from \"./distance.js\";\nimport { getPointParameter } from \"./get-point-parameter.js\";\nimport type { PointRelation } from \"./point-relation-types.js\";\nimport type { Point } from \"./point-type.js\";\n\n/**\n * Tracks the relation between two points.\n * \n * 1. Call `Points.relation` with the initial reference point\n * 2. You get back a function\n * 3. Call the function with a new point to compute relational information.\n * \n * It computes angle, average, centroid, distance and speed.\n * \n * ```js\n * // Reference point: 50,50\n * const t = Points.relation({x:50,y:50}); // t is a function\n *\n * // Invoke the returned function with a point\n * const relation = t({ x:0, y:0 }); // Juicy relational data\n * ```\n * \n * Or with destructuring:\n * \n * ```js\n * const { angle, distanceFromStart, distanceFromLast, average, centroid, speed } = t({ x:0,y:0 });\n * ```\n *\n * x & y coordinates can also be used as parameters:\n * ```js\n * const t = Points.relation(50, 50);\n * const result = t(0, 0);\n * // result.speed, result.angle ...\n * ```\n *\n * Note that intermediate values are not stored. It keeps the initial\n * and most-recent point. If you want to compute something over a set\n * of prior points, you may want to use {@link PointsTracker}\n * @param a Initial point, or x value\n * @param b y value, if first option is a number.\n * @returns\n */\nexport const relation = (a: Point | number, b?: number): PointRelation => {\n  const start = getPointParameter(a, b);\n  let totalX = 0;\n  let totalY = 0;\n  let count = 0;\n  let lastUpdate = performance.now();\n  let lastPoint = start;\n  const update = (aa: Point | number, bb?: number) => {\n    const p = getPointParameter(aa, bb);\n    totalX += p.x;\n    totalY += p.y;\n    count++;\n\n    const distanceFromStart = distance(p, start);\n    const distanceFromLast = distance(p, lastPoint);\n\n    // Track speed\n    const now = performance.now();\n    const speed = distanceFromLast / (now - lastUpdate);\n    lastUpdate = now;\n\n    lastPoint = p;\n\n    return Object.freeze({\n      angle: angleRadian(p, start),\n      distanceFromStart,\n      distanceFromLast,\n      speed,\n      centroid: centroid(p, start),\n      average: {\n        x: totalX / count,\n        y: totalY / count,\n      },\n    });\n  };\n\n  return update;\n};\n\n","import {\n  TrackedValueMap,\n  type TrackedValueOpts as TrackOpts,\n  type TimestampedObject,\n} from '@ixfx/trackers';\nimport { ObjectTracker } from '@ixfx/trackers';\nimport { length as LineLength } from '../line/length.js';\nimport * as Vectors from '../vector.js';\nimport { Empty as LinesEmpty } from '../line/index.js';\nimport type { Coord as PolarCoord } from '../polar/index.js';\nimport type { Line, PolyLine } from '../line/line-type.js';\nimport type { Point, Point3d } from './point-type.js';\nimport type { PointRelation } from './point-relation-types.js';\nimport { joinPointsToLines } from '../line/join-points-to-lines.js';\nimport type { TrimReason } from '@ixfx/trackers';\nimport type { PointRelationResult } from \"./point-relation-types.js\";\nimport { relation } from './relation.js';\nimport { distance } from './distance.js';\nimport { subtract } from './subtract.js';\nimport { angleRadian } from './angle.js';\nimport { Placeholder as PointsPlaceholder } from './point-type.js';\n/**\n * Information about seen points\n */\nexport type PointTrack = PointRelationResult & {\n  // readonly speedFromInitial:number\n};\n\n/**\n * Results of point tracking\n */\nexport type PointTrackerResults = Readonly<{\n  /**\n   * Relation of last point to previous point\n   */\n  fromLast: PointTrack;\n  /**\n   * Relation of last point to 'initial' point.\n   * This will be the oldest point in the buffer of the tracker.\n   */\n  fromInitial: PointTrack;\n  /**\n   * Relation of last point to a 'mark' point,\n   * which is manually set.\n   * \n   * Will give _undefined_ if `.mark()` has not been called on tracker.\n   */\n  fromMark: PointTrack | undefined;\n  values: readonly Point[];\n}>;\n\n\n\n/**\n * A tracked point. Mutable. Useful for monitoring how\n * it changes over time. Eg. when a pointerdown event happens, to record the start position and then\n * track the pointer as it moves until pointerup.\n *\n * See also\n * * [Playground](https://clinth.github.io/ixfx-play/data/point-tracker/index.html)\n * * {@link PointsTracker}: Track several points, useful for multi-touch.\n * * [ixfx Guide to Point Tracker](https://ixfx.fun/geometry/tracking/)\n * \n * ```js\n * // Create a tracker on a pointerdown\n * const t = new PointTracker();\n *\n * // ...and later, tell it when a point is seen (eg. pointermove)\n * const nfo = t.seen({x: evt.x, y:evt.y});\n * // nfo gives us some details on the relation between the seen point, the start, and points inbetween\n * // nfo.angle, nfo.centroid, nfo.speed etc.\n * ```\n *\n * Compute based on last seen point\n * ```js\n * t.angleFromStart();\n * t.distanceFromStart();\n * t.x / t.y\n * t.length; // Total length of accumulated points\n * t.elapsed; // Total duration since start\n * t.lastResult; // The PointSeenInfo for last seen point\n * ```\n *\n * Housekeeping\n * ```js\n * t.reset(); // Reset tracker\n * ```\n *\n * By default, the tracker only keeps track of the initial point and\n * does not store intermediate 'seen' points. To use the tracker as a buffer,\n * set `storeIntermediate` option to _true_.\n *\n * ```js\n * // Keep only the last 10 points\n * const t = new PointTracker({\n *  sampleLimit: 10\n * });\n *\n * // Store all 'seen' points\n * const t = new PointTracker({\n *  storeIntermediate: true\n * });\n *\n * // In this case, the whole tracker is automatically\n * // reset after 10 samples\n * const t = new PointTracker({\n *  resetAfterSamples: 10\n * })\n * ```\n *\n * When using a buffer limited by `sampleLimit`, the 'initial' point will be the oldest in the\n * buffer, not actually the very first point seen.\n */\nexport class PointTracker<TPoint extends Point = Point> extends ObjectTracker<TPoint, PointTrackerResults> {\n  initialRelation: PointRelation | undefined;\n  markRelation: PointRelation | undefined;\n  lastResult: PointTrackerResults | undefined;\n\n  constructor(opts: TrackOpts = {}) {\n    super(opts);\n  }\n\n  /**\n   * Notification that buffer has been knocked down to `sampleLimit`.\n   * \n   * This will reset the `initialRelation`, which will use the new oldest value.\n   */\n  onTrimmed(_reason: TrimReason): void {\n    // Force new relation calculations\n    this.initialRelation = undefined;\n  }\n\n  /**\n   * @ignore\n   */\n  onReset(): void {\n    super.onReset();\n    this.lastResult = undefined;\n    this.initialRelation = undefined;\n    this.markRelation = undefined\n  }\n\n\n\n  /**\n   * Makes a 'mark' in the tracker, allowing you to compare values\n   * to this point.\n   */\n  mark() {\n    this.markRelation = relation(this.last);\n  }\n\n  /**\n   * Tracks a point, returning data on its relation to the\n   * initial point and the last received point.\n   * \n   * Use {@link seenEvent} to track a raw `PointerEvent`.\n   * \n   * @param _p Point\n   */\n  computeResults(\n    _p: TimestampedObject<Point>[]\n  ): PointTrackerResults {\n    const currentLast = this.last;\n    const previousLast = this.values.at(-2);\n\n    if (this.initialRelation === undefined && this.initial) {\n      // Don't yet have an initial relation function\n      // Use the oldest point in the buffer (this.initial)\n      this.initialRelation = relation(this.initial);\n    } else if (this.initialRelation === undefined) {\n      // Don't have an initial relation, but also don't have an initial point :()\n      throw new Error(`Bug: No initialRelation, and this.inital is undefined?`);\n    }\n\n    // Make a new relator based on previous point\n    const lastRelation = previousLast === undefined ? relation(currentLast) : relation(previousLast);\n\n    // Compute relation from initial point to latest\n    const initialRel: PointTrack = this.initialRelation(currentLast);\n\n    const markRel: PointTrack | undefined = (this.markRelation !== undefined) ? this.markRelation(currentLast) : undefined;\n\n    const speed = previousLast === undefined ? 0 : LineLength(previousLast, currentLast) / (currentLast.at - previousLast.at);\n\n    // Compute relation from current point to the previous\n    const lastRel: PointTrack = {\n      ...lastRelation(currentLast),\n      speed,\n    };\n\n    const r: PointTrackerResults = {\n      fromInitial: initialRel,\n      fromLast: lastRel,\n      fromMark: markRel,\n      values: [ ...this.values ],\n    };\n    this.lastResult = r;\n    return r;\n  }\n\n  /**\n   * Returns a polyline representation of stored points.\n   * Returns an empty array if points were not saved, or there's only one.\n   */\n  get line(): PolyLine {\n    if (this.values.length === 1) return [];\n    return joinPointsToLines(...this.values);\n  }\n\n  /**\n   * Returns a vector of the initial/last points of the tracker.\n   * Returns as a polar coordinate\n   */\n  get vectorPolar(): PolarCoord {\n    return Vectors.fromLinePolar(this.lineStartEnd);\n  }\n\n  /**\n   * Returns a vector of the initial/last points of the tracker.\n   * Returns as a Cartesian coordinate\n   */\n  get vectorCartesian(): Point {\n    return Vectors.fromLineCartesian(this.lineStartEnd);\n  }\n\n  /**\n   * Returns a line from initial point to last point.\n   *\n   * If there are less than two points, Lines.Empty is returned\n   */\n  get lineStartEnd(): Line {\n    const initial = this.initial;\n    if (this.values.length < 2 || !initial) return LinesEmpty;\n    return {\n      a: initial,\n      b: this.last,\n    };\n  }\n\n  /**\n   * Returns distance from latest point to initial point.\n   * If there are less than two points, zero is returned.\n   *\n   * This is the direct distance from initial to last,\n   * not the accumulated length. Use {@link length} for that.\n   * @returns Distance\n   */\n  distanceFromStart(): number {\n    const initial = this.initial;\n    return this.values.length >= 2 && initial !== undefined ? distance(initial, this.last) : 0;\n  }\n\n  /**\n   * Returns the speed (over milliseconds) based on accumulated travel distance.\n   * \n   * If there's no initial point, 0 is returned.\n   * @returns \n   */\n  speedFromStart(): number {\n    const d = this.length;\n    const t = this.timespan;\n    if (Number.isNaN(t)) return 0;\n    if (d === 0) return 0;\n    return Math.abs(d) / t;\n  }\n\n  /**\n   * Difference between last point and the initial point, calculated\n   * as a simple subtraction of x,y & z.\n   *\n   * `Points.Placeholder` is returned if there's only one point so far.\n   */\n  difference(): Point | Point3d {\n    const initial = this.initial;\n    return this.values.length >= 2 && initial !== undefined ? subtract(this.last, initial) : PointsPlaceholder;\n  }\n\n  /**\n   * Returns angle (in radians) from latest point to the initial point\n   * If there are less than two points, undefined is return.\n   * @returns Angle in radians\n   */\n  angleFromStart(): number | undefined {\n    const initial = this.initial;\n    if (initial !== undefined && this.values.length > 2) {\n      return angleRadian(initial, this.last);\n    }\n  }\n\n  /**\n   * Returns the total distance from accumulated points.\n   * Returns 0 if points were not saved, or there's only one\n   */\n  get length(): number {\n    if (this.values.length === 1) return 0;\n    const l = this.line;\n    return LineLength(l);\n  }\n\n  /**\n * Returns the last x coord\n */\n  get x() {\n    return this.last.x;\n  }\n\n  /**\n   * Returns the last y coord\n   */\n  get y() {\n    return this.last.y;\n  }\n\n  /**\n   * Returns the last z coord (or _undefined_ if not available)\n   */\n  get z() {\n    return this.last.z;\n  }\n}\n\n/**\n * A {@link TrackedValueMap} for points. Uses {@link PointTracker} to\n * track added values.\n */\nexport class PointsTracker<TPoint extends Point = Point> extends TrackedValueMap<\n  TPoint,\n  PointTracker<TPoint>,\n  PointTrackerResults\n> {\n\n  constructor(opts: TrackOpts = {}) {\n    super((key, start) => {\n      if (start === undefined) throw new Error(`Requires start point`);\n      const p = new PointTracker<TPoint>({\n        ...opts,\n        id: key,\n      });\n      p.seen(start);\n      return p;\n    });\n  }\n\n  get(id: string) {\n    const v = super.get(id);\n    return v as PointTracker<TPoint> | undefined\n  }\n}\n\nexport class UserPointerTracker extends PointTracker {\n  /**\n   * Adds a PointerEvent along with its\n   * coalesced events, if available.\n   * @param p \n   * @returns \n   */\n  seenEvent(p: PointerEvent | MouseEvent): PointTrackerResults {\n    if (`getCoalescedEvents` in p) {\n      const events = p.getCoalescedEvents();\n      const asPoints = events.map(event => ({ x: event.clientX, y: event.clientY }));\n      return this.seen(...asPoints);\n    } else {\n      return this.seen({ x: (p).clientX, y: (p).clientY });\n    }\n  }\n}\n\nexport class UserPointersTracker extends TrackedValueMap<\n  Point,\n  PointTracker,\n  PointTrackerResults\n> {\n\n  constructor(opts: TrackOpts = {}) {\n    super((key, start) => {\n      if (start === undefined) throw new Error(`Requires start point`);\n      const p = new UserPointerTracker({\n        ...opts,\n        id: key,\n      });\n      p.seen(start);\n      return p;\n    });\n  }\n\n  get(id: string) {\n    const v = super.get(id);\n    return v as UserPointerTracker | undefined\n  }\n  /**\n * Track a PointerEvent\n * @param event\n */\n  seenEvent(event: PointerEvent): Promise<PointTrackerResults[]> {\n    if (`getCoalescedEvents` in event) {\n      const events = event.getCoalescedEvents();\n      const seens = events.map(subEvent => super.seen(subEvent.pointerId.toString(), subEvent));\n      return Promise.all(seens);\n    } else {\n      return Promise.all([ super.seen((event as PointerEvent).pointerId.toString(), event) ]);\n    }\n  }\n}","\nimport { isPoint3d } from \"./guard.js\";\nimport type { Point3d, Point } from \"./point-type.js\";\nimport { subtract } from \"./subtract.js\";\n\n/**\n * Computes the progress between two waypoints, given `position`.\n * \n * [Source](https://www.habrador.com/tutorials/math/2-passed-waypoint/?s=09)\n * @param position Current position\n * @param waypointA Start\n * @param waypointB End\n * @returns \n */\nexport const progressBetween = (\n  position: Point | Point3d,\n  waypointA: Point | Point3d,\n  waypointB: Point | Point3d\n) => {\n  // Via: https://www.habrador.com/tutorials/math/2-passed-waypoint/?s=09\n  // from -> current\n  const a = subtract(position, waypointA);\n\n  // from -> to\n  const b = subtract(waypointB, waypointA);\n\n  return isPoint3d(a) && isPoint3d(b) ? (\n    (a.x * b.x + a.y * b.y + a.z * b.z) / (b.x * b.x + b.y * b.y + b.z * b.z)\n  ) : (a.x * b.x + a.y * b.y) / (b.x * b.x + b.y * b.y);\n};","import type { Point } from \"./point-type.js\";\n\n/**\n * Project `origin` by `distance` and `angle` (radians).\n *\n * To figure out rotation, imagine a horizontal line running through `origin`.\n * * Rotation = 0 deg puts the point on the right of origin, on same y-axis\n * * Rotation = 90 deg/3:00 puts the point below origin, on the same x-axis\n * * Rotation = 180 deg/6:00 puts the point on the left of origin on the same y-axis\n * * Rotation = 270 deg/12:00 puts the point above the origin, on the same x-axis\n *\n * ```js\n * // Yields a point 100 units away from 10,20 with 10 degrees rotation (ie slightly down)\n * const a = Points.project({x:10, y:20}, 100, degreeToRadian(10));\n * ```\n * @param origin\n * @param distance\n * @param angle\n * @returns\n */\nexport const project = (origin: Point, distance: number, angle: number) => {\n  const x = Math.cos(angle) * distance + origin.x;\n  const y = Math.sin(angle) * distance + origin.y;\n  return { x, y };\n};","import { quantiseEvery as quantiseEveryNumber } from '@ixfx/numbers';\nimport { guard, isPoint3d } from './guard.js';\nimport type { Point, Point3d } from './point-type.js';\n\nexport function quantiseEvery(pt: Point3d, snap: Point3d, middleRoundsUp?: boolean): Point3d;\nexport function quantiseEvery(pt: Point, snap: Point, middleRoundsUp?: boolean): Point;\n\n/**\n * Quantises a point.\n * @param pt \n * @param snap \n * @param middleRoundsUp \n * @returns \n */\nexport function quantiseEvery(pt: Point, snap: Point, middleRoundsUp = true): Point {\n  guard(pt, `pt`);\n  guard(snap, `snap`);\n  if (isPoint3d(pt)) {\n    if (!isPoint3d(snap)) throw new TypeError(`Param 'snap' is missing 'z' field`);\n    return Object.freeze({\n      x: quantiseEveryNumber(pt.x, snap.x, middleRoundsUp),\n      y: quantiseEveryNumber(pt.y, snap.y, middleRoundsUp),\n      z: quantiseEveryNumber(pt.z, snap.z, middleRoundsUp)\n    });\n  }\n\n  return Object.freeze({\n    x: quantiseEveryNumber(pt.x, snap.x, middleRoundsUp),\n    y: quantiseEveryNumber(pt.y, snap.y, middleRoundsUp),\n  });\n}","import { type RandomSource } from '@ixfx/random';\nimport type { Point, Point3d } from './point-type.js';\n\n/**\n * Returns a random 2D point on a 0..1 scale.\n * ```js\n * import { Points } from \"@ixfx/geometry.js\";\n * const pt = Points.random(); // eg {x: 0.2549012, y:0.859301}\n * ```\n *\n * A custom source of randomness can be provided:\n * ```js\n * import { Points } from \"@ixfx/geometry.js\";\n * import { weightedSource } from \"@ixfx/random.js\"\n * const pt = Points.random(weightedSource(`quadIn`));\n * ```\n * @param rando\n * @returns\n */\nexport const random = (rando?: RandomSource): Point => {\n  if (typeof rando === `undefined`) rando = Math.random;\n\n  return Object.freeze({\n    x: rando(),\n    y: rando(),\n  });\n};\n\n/**\n * Returns a random 3D point on a 0..1 scale.\n * ```js\n * import { Points } from \"@ixfx/geometry\";\n * const pt = Points.random(); // eg {x: 0.2549012, y:0.859301}\n * ```\n *\n * A custom source of randomness can be provided:\n * ```js\n * import { Points } from \"@ixfx/geometry\";\n * import { weightedSource } from \"@ixfx/random.js\"\n * const pt = Points.random(weightedSource(`quadIn`));\n * ```\n * @param rando\n * @returns\n */\nexport const random3d = (rando?: RandomSource): Point3d => {\n  if (typeof rando === `undefined`) rando = Math.random;\n\n  return Object.freeze({\n    x: rando(),\n    y: rando(),\n    z: rando()\n  });\n};","import type { Point } from \"./point-type.js\";\n\n/**\n * Reduces over points, treating _x_ and _y_ separately.\n *\n * ```\n * // Sum x and y values\n * const total = Points.reduce(points, (p, acc) => {\n *  return {x: p.x + acc.x, y: p.y + acc.y}\n * });\n * ```\n * @param pts Points to reduce\n * @param fn Reducer\n * @param initial Initial value, uses `{ x:0, y:0 }` by default\n * @returns\n */\nexport const reduce = (\n  pts: ReadonlyArray<Point>,\n  fn: (p: Point, accumulated: Point) => Point,\n  initial?: Point\n): Point => {\n  if (initial === undefined) initial = { x: 0, y: 0 }\n  let accumulator = initial;\n  for (const p of pts) {\n    accumulator = fn(p, accumulator);\n  };\n  return accumulator;\n};","import { numberTest, resultThrow } from \"@ixfx/guards\";\nimport type { Point } from \"./point-type.js\";\nimport { guard } from \"./guard.js\";\nimport { fromCartesian as PolarFromCartesian } from \"../polar/index.js\";\nimport { rotate as PolarRotate, toCartesian as PolarToCartesian } from \"../polar/index.js\";\n/**\n * Rotate a single point by a given amount in radians\n * @param pt\n * @param amountRadian\n * @param origin\n */\nexport function rotate(pt: Point, amountRadian: number, origin?: Point): Point;\n\n/**\n * Rotate several points by a given amount in radians\n * @param pt Points\n * @param amountRadian Amount to rotate in radians. If 0 is given, a copy of the input array is returned\n * @param origin Origin to rotate around. Defaults to 0,0\n */\nexport function rotate(\n  pt: readonly Point[],\n  amountRadian: number,\n  origin?: Point\n): readonly Point[];\n\nexport function rotate(\n  pt: Point | readonly Point[],\n  amountRadian: number,\n  origin?: Point\n): Point | readonly Point[] {\n  if (typeof origin === `undefined`) origin = { x: 0, y: 0 };\n  guard(origin, `origin`);\n  resultThrow(numberTest(amountRadian, ``, `amountRadian`));\n  const arrayInput = Array.isArray(pt);\n\n  // no-op\n  if (amountRadian === 0) return pt;\n\n  if (!arrayInput) {\n    pt = [ pt as Point ];\n  }\n\n  const ptAr = pt as readonly Point[];\n  for (const [ index, p ] of ptAr.entries()) guard(p, `pt[${ index }]`);\n\n  const asPolar = ptAr.map((p) => PolarFromCartesian(p, origin));\n  const rotated = asPolar.map((p) => PolarRotate(p, amountRadian));\n  const asCartesisan = rotated.map((p) => PolarToCartesian(p, origin));\n  return arrayInput ? asCartesisan : asCartesisan[ 0 ];\n}","\n//eslint-disable-next-line functional/prefer-readonly-type\nexport const rotatePointArray = (\n  v: ReadonlyArray<ReadonlyArray<number>>,\n  amountRadian: number\n): Array<Array<number>> => {\n  const mat = [\n    [ Math.cos(amountRadian), -Math.sin(amountRadian) ],\n    [ Math.sin(amountRadian), Math.cos(amountRadian) ],\n  ];\n  const result:number[][] = [];\n  for (const [ index, element ] of v.entries()) {\n    result[ index ] = [\n      mat[ 0 ][ 0 ] * element[ 0 ] + mat[ 0 ][ 1 ] * element[ 1 ],\n      mat[ 1 ][ 0 ] * element[ 0 ] + mat[ 1 ][ 1 ] * element[ 1 ],\n    ];\n  }\n  return result;\n};","import { round as roundNumber } from '@ixfx/numbers';\nimport { getPointParameter } from './get-point-parameter.js';\nimport type { Point } from './point-type.js';\n\n/**\n * Round the point's _x_ and _y_ to given number of digits\n * @param ptOrX \n * @param yOrDigits \n * @param digits \n * @returns \n */\nexport const round = (ptOrX: Point | number, yOrDigits?: number, digits?: number): Point => {\n  const pt = getPointParameter(ptOrX, yOrDigits);\n  digits = digits ?? yOrDigits;\n  digits = digits ?? 2;\n  return Object.freeze({\n    ...pt,\n    x: roundNumber(digits, pt.x),\n    y: roundNumber(digits, pt.y)\n  })\n}","import { numberTest, resultThrow } from \"@ixfx/guards\";\nimport type { Point } from \"./point-type.js\";\nimport { guard } from \"./guard.js\";\n\n/**\n * Returns true if two points are within a specified range on both axes.\n * \n * Provide a point for the range to set different x/y range, or pass a number\n * to use the same range for both axis.\n *\n * Note this simply compares x,y values it does not calcuate distance.\n *\n * @example\n * ```js\n * withinRange({x:100,y:100}, {x:101, y:101}, 1); // True\n * withinRange({x:100,y:100}, {x:105, y:101}, {x:5, y:1}); // True\n * withinRange({x:100,y:100}, {x:105, y:105}, {x:5, y:1}); // False - y axis too far\n * ```\n * @param a\n * @param b\n * @param maxRange\n * @returns\n */\nexport const withinRange = (\n  a: Point,\n  b: Point,\n  maxRange: Point | number\n): boolean => {\n  guard(a, `a`);\n  guard(b, `b`);\n\n  if (typeof maxRange === `number`) {\n    resultThrow(numberTest(maxRange, `positive`, `maxRange`));\n    maxRange = { x: maxRange, y: maxRange };\n  } else {\n    guard(maxRange, `maxRange`);\n  }\n  const x = Math.abs(b.x - a.x);\n  const y = Math.abs(b.y - a.y);\n  return x <= maxRange.x && y <= maxRange.y;\n};","import { wrap as wrapNumber } from '@ixfx/numbers';\nimport { guard } from './guard.js';\nimport type { Point } from \"./point-type.js\";\n\n/**\n * Wraps a point to be within `ptMin` and `ptMax`.\n * Note that max values are _exclusive_, meaning the return value will always be one less.\n *\n * Eg, if a view port is 100x100 pixels, wrapping the point 150,100 yields 50,99.\n *\n * ```js\n * // Wraps 150,100 to on 0,0 -100,100 range\n * wrap({x:150,y:100}, {x:100,y:100});\n * ```\n *\n * Wrap normalised point:\n * ```js\n * wrap({x:1.2, y:1.5}); // Yields: {x:0.2, y:0.5}\n * ```\n * @param pt Point to wrap\n * @param ptMax Maximum value, or `{ x:1, y:1 }` by default\n * @param ptMin Minimum value, or `{ x:0, y:0 }` by default\n * @returns Wrapped point\n */\nexport const wrap = (\n  pt: Point,\n  ptMax?: Point,\n  ptMin?: Point\n): Point => {\n\n  if (ptMax === undefined) ptMax = { x: 1, y: 1 };\n  if (ptMin === undefined) ptMin = { x: 0, y: 0 };\n\n  //  Unit tested\n  guard(pt, `pt`);\n  guard(ptMax, `ptMax`);\n  guard(ptMin, `ptMin`);\n\n  return Object.freeze({\n    x: wrapNumber(pt.x, ptMin.x, ptMax.x),\n    y: wrapNumber(pt.y, ptMin.y, ptMax.y),\n  });\n};\n","export * from './abs.js';\nexport * from './angle.js';\nexport * from './apply.js';\nexport * from './averager.js';\nexport * from './bbox.js';\nexport * from './centroid.js';\nexport * from './clamp.js';\nexport * from './compare.js';\nexport * from './convex-hull.js';\nexport * from './distance.js';\nexport * from './distance-to-center.js';\nexport * from './distance-to-exterior.js';\nexport * from './divider.js';\nexport * from './dot-product.js';\nexport * from './empty.js';\nexport * from './find-minimum.js';\nexport * from './from.js';\nexport * from './get-point-parameter.js';\nexport * from './guard.js';\nexport * from './interpolate.js';\nexport * from './invert.js';\nexport * from './is-equal.js';\nexport * from './magnitude.js';\nexport * from './most.js';\nexport * from './multiply.js';\nexport * from './normalise.js';\nexport * from './normalise-by-rect.js';\nexport * from './pipeline.js';\nexport * from './point-relation-types.js';\nexport * from './point-tracker.js';\nexport * from './point-type.js';\nexport * from './progress-between.js';\nexport * from './project.js';\nexport * from './quantise.js';\nexport * from './random.js';\nexport * from './reduce.js';\nexport * from './relation.js';\nexport * from './rotate.js';\nexport * from './rotate-point-array.js';\nexport * from './round.js';\nexport * from './subtract.js';\nexport * from './sum.js';\nexport * from './To.js';\nexport * from './to-array.js';\nexport * from './within-range.js';\nexport * from './wrap.js';\nexport type { Point, Point3d } from './point-type.js';\n","import type { Point } from \"../point/point-type.js\";\nimport type { Line } from \"./line-type.js\";\nimport { rotate as PointRotate } from '../point/index.js';\nimport { interpolate } from \"./interpolate.js\";\n\n/**\n * Returns a line that is rotated by `angleRad`. By default it rotates\n * around its center, but an arbitrary `origin` point can be provided.\n * If `origin` is a number, it's presumed to be a 0..1 percentage of the line.\n * \n * ```js\n * // Rotates line by 0.1 radians around point 10,10\n * const r = Lines.rotate(line, 0.1, {x:10,y:10});\n * \n * // Rotate line by 5 degrees around its center\n * const r = Lines.rotate(line, degreeToRadian(5));\n * \n * // Rotate line by 5 degres around its end point\n * const r = Lines.rotate(line, degreeToRadian(5), line.b);\n * \n * // Rotate by 90 degrees at the 80% position\n * const r = Lines.rotated = rotate(line, Math.PI / 2, 0.8);\n * ```\n * @param line Line to rotate\n * @param amountRadian Angle in radians to rotate by\n * @param origin Point to rotate around. If undefined, middle of line will be used\n * @returns \n */\nexport const rotate = (line: Line, amountRadian?: number, origin?: Point | number): Line => {\n  if (typeof amountRadian === `undefined` || amountRadian === 0) return line;\n  if (typeof origin === `undefined`) origin = 0.5;\n  if (typeof origin === `number`) {\n    origin = interpolate(origin, line.a, line.b);\n  }\n  return Object.freeze({\n    ...line,\n    a: PointRotate(line.a, amountRadian, origin),\n    b: PointRotate(line.b, amountRadian, origin)\n  });\n};","import type { Line } from \"./line-type.js\";\nimport { isEqual as PointsIsEqual } from '../point/is-equal.js';\n/**\n * Returns true if the lines have the same value. Note that only\n * the line start and end points are compared. So the lines might\n * be different in other properties, and `isEqual` will still return\n * true.\n * \n * ```js\n * const a = { a: {x:0,  y: 10 }, b: { x: 20, y: 20 }};\n * const b = { a: {x:0,  y: 10 }, b: { x: 20, y: 20 }};\n * a === b; // false, because they are different objects\n * Lines.isEqual(a, b); // true, because they have the same value\n * ```\n * @param {Line} a\n * @param {Line} b\n * @returns {boolean}\n */\nexport const isEqual = (a: Line, b: Line): boolean => PointsIsEqual(a.a, b.a) && PointsIsEqual(a.b, b.b);","import type { Line } from \"./line-type.js\";\nimport { multiply as PointsMultiply, type Point } from \"../point/index.js\";\n/**\n * Multiplies start and end of line by point.x, point.y.\n * \n * ```js\n * \n * // Line 1,1 -> 10,10\n * const l = Lines.fromNumbers(1, 1, 10, 10);\n * const ll = Lines.multiply(l, {x:2, y:3});\n * // Yields: 2,20 -> 3,30\n * ```\n * @param line \n * @param point \n * @returns \n */\nexport const multiply = (line: Line, point: Point): Line => (Object.freeze({\n  ...line,\n  a: PointsMultiply(line.a, point),\n  b: PointsMultiply(line.b, point)\n}));","import type { Point } from \"../point/point-type.js\";\nimport type { Line } from \"./line-type.js\";\nimport { subtract as PointsSubtract } from \"../point/subtract.js\";\n\n/**\n * Subtracts both start and end points by given x,y\n * ```js\n * // Line 1,1 -> 10,10\n * const l = Lines.fromNumbers(1,1,10,10);\n * const ll = Lines.subtract(l, {x:2, y:4});\n * // Yields: -1,-3 -> 8,6\n * ```\n * @param line \n * @param point \n * @returns \n */\nexport const subtract = (line: Line, point: Point): Line => Object.freeze({\n  ...line,\n  a: PointsSubtract(line.a, point),\n  b: PointsSubtract(line.b, point)\n});","import type { Point } from \"../point/point-type.js\";\nimport { guard, isLine } from \"./guard.js\";\nimport type { Line } from \"./line-type.js\";\nimport { toString as PointsToString } from '../point/index.js';\n/**\n * Returns a string representation of two points\n * ```js\n * console.log(Lines.toString(a, b)));\n * ```\n * @param a \n * @param b \n * @returns \n */\nexport function toString(a: Point, b: Point): string;\n\n/**\n * Returns a string representation of a line \n * ```js\n * Lines.toString(line);\n * ```\n * @param line \n */\nexport function toString(line: Line): string;\n\n/**\n * Returns a string representation of a line or two points.\n * @param a\n * @param b \n * @returns \n */\n\nexport function toString(a: Point | Line, b?: Point): string {\n  if (isLine(a)) {\n    guard(a, `a`);\n    b = a.b;\n    a = a.a;\n  } else if (b === undefined) throw new Error(`Expect second point if first is a point`);\n  return PointsToString(a) + `-` + PointsToString(b);\n}\n\n","import type { LinePath } from \"./line-path-type.js\";\nimport type { Line } from \"./line-type.js\";\nimport { length } from \"./length.js\";\nimport { interpolate } from \"./interpolate.js\";\nimport type { Point } from \"../point/point-type.js\";\nimport { parallel, perpendicularPoint } from \"./angles.js\";\nimport { midpoint } from \"./midpoint.js\";\nimport { toFlatArray, toSvgString, slope, withinRange, apply } from \"./index.js\";\nimport { bbox } from \"./bbox.js\";\nimport { relativePosition } from \"./relative-position.js\";\nimport { sum } from \"./sum.js\";\nimport { divide } from \"./divide.js\";\nimport { rotate } from \"./rotate.js\";\nimport { nearest } from \"./nearest.js\";\nimport { distanceSingleLine } from './distance-single-line.js';\nimport { isEqual } from \"./is-equal.js\";\nimport { multiply } from \"./multiply.js\";\nimport { subtract } from \"./subtract.js\";\nimport { toString } from \"./to-string.js\";\n/**\n * Returns a path wrapper around a line instance. This is useful if there are a series\n * of operations you want to do with the same line because you don't have to pass it\n * in as an argument to each function.\n * \n * Note that the line is immutable, so a function like `sum` returns a new LinePath,\n * wrapping the result of `sum`.\n * \n * ```js\n * // Create a path\n * const l = Lines.toPath(fromNumbers(0,0,10,10));\n * \n * // Now we can use it...\n * l.length();\n * \n * // Mutate functions return a new path\n * const ll = l.sum({x:10,y:10});\n * ll.length();\n * ```\n * @param line \n * @returns \n */\nexport const toPath = (line: Line): LinePath => {\n  const { a, b } = line;\n  return Object.freeze({\n    ...line,\n    length: () => length(a, b),\n    interpolate: (amount: number) => interpolate(amount, a, b),\n    relativePosition: (point: Point) => relativePosition(line, point),\n    bbox: () => bbox(line),\n    toString: () => toString(a, b),\n    toFlatArray: () => toFlatArray(a, b),\n    toSvgString: () => toSvgString(a, b),\n    toPoints: () => [ a, b ],\n    rotate: (amountRadian: number, origin: Point) => toPath(rotate(line, amountRadian, origin)),\n    nearest: (point: Point) => nearest(line, point),\n    sum: (point: Point) => toPath(sum(line, point)),\n    divide: (point: Point) => toPath(divide(line, point)),\n    multiply: (point: Point) => toPath(multiply(line, point)),\n    subtract: (point: Point) => toPath(subtract(line, point)),\n    midpoint: () => midpoint(a, b),\n    distanceToPoint: (point: Point) => distanceSingleLine(line, point),\n    parallel: (distance: number) => parallel(line, distance),\n    perpendicularPoint: (distance: number, amount?: number) => perpendicularPoint(line, distance, amount),\n    slope: () => slope(line),\n    withinRange: (point: Point, maxRange: number) => withinRange(line, point, maxRange),\n    isEqual: (otherLine: Line) => isEqual(line, otherLine),\n    apply: (fn: (point: Point) => Point) => toPath(apply(line, fn)),\n    kind: `line`\n  });\n};","import type { Point } from \"../point/point-type.js\";\nimport { fromPoints } from \"./from-points.js\";\nimport type { LinePath } from \"./line-path-type.js\";\nimport { toPath } from \"./to-path.js\";\n\n/**\n * Returns a {@link LinePath} from two points\n * \n * ```js\n * const path = Lines.fromPointsToPath(ptA, ptB);\n * ```\n * @param a \n * @param b \n * @returns \n */\nexport const fromPointsToPath = (a: Point, b: Point): LinePath => toPath(fromPoints(a, b));\n","import type { Point } from '../point/point-type.js';\nimport type { Line } from './line-type.js';\n//import * as Points from '../point/index.js';\nimport { normaliseByRect as PointsNormaliseByRect } from '../point/normalise-by-rect.js';\nimport { minFast } from '@ixfx/numbers';\nimport { distanceSingleLine } from './distance-single-line.js';\nimport { isLine } from './guard.js';\nimport { length } from './length.js';\nimport { interpolate } from './interpolate.js';\nimport { isPoint, isEmpty as PointIsEmpty, isPlaceholder as PointIsPlaceholder } from '../point/guard.js';\n\nexport * from './angles.js';\nexport * from './bbox.js';\nexport * from './distance-single-line.js';\nexport * from './divide.js';\nexport * from './from-flat-array.js';\nexport * from './from-numbers.js';\nexport * from './from-points.js';\nexport * from './from-pivot.js';\nexport * from './from-points-to-path.js';\nexport * from './get-points-parameter.js';\nexport * from './guard.js';\nexport * from './interpolate.js';\nexport * from './is-equal.js';\nexport * from './join-points-to-lines.js';\nexport * from './length.js';\nexport type * from './line-path-type.js';\nexport type * from './line-type.js';\nexport * from './midpoint.js';\nexport * from './multiply.js';\nexport * from './nearest.js';\nexport * from './relative-position.js';\nexport * from './reverse.js';\nexport * from './rotate.js';\nexport * from './subtract.js';\nexport * from './sum.js';\nexport * from './to-path.js';\nexport * from './to-string.js';\n\n\nexport const Empty = Object.freeze({\n  a: Object.freeze({ x: 0, y: 0 }),\n  b: Object.freeze({ x: 0, y: 0 })\n});\n\n\nexport const Placeholder = Object.freeze({\n  a: Object.freeze({ x: Number.NaN, y: Number.NaN }),\n  b: Object.freeze({ x: Number.NaN, y: Number.NaN })\n});\n\n/**\n * Returns true if `l` is the same as Line.Empty, that is\n * the `a` and `b` points are Points.Empty.\n * @param l \n * @returns \n */\nexport const isEmpty = (l: Line): boolean => PointIsEmpty(l.a) && PointIsEmpty(l.b);\n\nexport const isPlaceholder = (l: Line): boolean => PointIsPlaceholder(l.a) && PointIsPlaceholder(l.b);\n\n\n\n\n/**\n * Applies `fn` to both start and end points.\n * \n * ```js\n * // Line 10,10 -> 20,20\n * const line = Lines.fromNumbers(10,10, 20,20);\n * \n * // Applies randomisation to both x and y.\n * const rand = (p) => ({\n *  x: p.x * Math.random(),\n *  y: p.y * Math.random()\n * });\n * \n * // Applies our randomisation function\n * const line2 = apply(line, rand);\n * ```\n * @param line Line\n * @param fn Function that takes a point and returns a point\n * @returns \n */\nexport const apply = (line: Line, fn: (p: Point) => Point) => Object.freeze<Line>(\n  {\n    ...line,\n    a: fn(line.a),\n    b: fn(line.b)\n  }\n);\n\n\n/**\n * Returns the angle in radians of a line, or two points\n * ```js\n * Lines.angleRadian(line);\n * Lines.angleRadian(ptA, ptB);\n * ```\n * @param lineOrPoint \n * @param b \n * @returns \n */\nexport const angleRadian = (lineOrPoint: Line | Point, b?: Point): number => {\n  let a: Point;\n  if (isLine(lineOrPoint)) {\n    a = lineOrPoint.a;\n    b = lineOrPoint.b;\n  } else {\n    a = lineOrPoint;\n    if (b === undefined) throw new Error(`b point must be provided`);\n  }\n  return Math.atan2(b.y - a.y, b.x - a.x);\n};\n\n/**\n * Normalises start and end points by given width and height. Useful\n * for converting an absolutely-defined line to a relative one.\n * \n * ```js\n * \n * // Line 1,1 -> 10,10\n * const l = Lines.fromNumbers(1,1,10,10);\n * const ll = Lines.normaliseByRect(l, 10, 10);\n * // Yields: 0.1,0.1 -> 1,1\n * ```\n * @param line \n * @param width\n * @param height \n * @returns \n */\nexport const normaliseByRect = (line: Line, width: number, height: number): Line => Object.freeze({\n  ...line,\n  a: PointsNormaliseByRect(line.a, width, height),\n  b: PointsNormaliseByRect(line.b, width, height)\n});\n\n\n/**\n * Returns true if `point` is within `maxRange` of `line`.\n * \n * ```js\n * const line = Lines.fromNumbers(0,20,20,20);\n * Lines.withinRange(line, {x:0,y:21}, 1); // True\n * ```\n * @param line\n * @param point\n * @param maxRange \n * @returns True if point is within range\n */\nexport const withinRange = (line: Line, point: Point, maxRange: number): boolean => {\n  const calculatedDistance = distance(line, point);\n  return calculatedDistance <= maxRange;\n};\n\n\n/**\n * Calculates [slope](https://en.wikipedia.org/wiki/Slope) of line.\n * \n * @example\n * ```js\n * Lines.slope(line);\n * Lines.slope(ptA, ptB)\n * ```\n * @param lineOrPoint Line or point. If point is provided, second point must be given too\n * @param b Second point if needed\n * @returns \n */\nexport const slope = (lineOrPoint: Line | Point, b?: Point): number => {\n\n  let a: Point;\n  if (isLine(lineOrPoint)) {\n\n    a = lineOrPoint.a;\n    b = lineOrPoint.b;\n  } else {\n    a = lineOrPoint;\n    if (b === undefined) throw new Error(`b parameter required`);\n  }\n  if (b === undefined) {\n    throw new TypeError(`Second point missing`)\n  } else {\n    return (b.y - a.y) / (b.x - a.x);\n  }\n};\n\n\n/**\n * Scales a line from its midpoint\n * \n * @example Shorten by 50%, anchored at the midpoint\n * ```js\n * const l = {\n *  a: {x:50, y:50}, b: {x: 100, y: 90}\n * }\n * const l2 = Lines.scaleFromMidpoint(l, 0.5);\n * ```\n * @param line\n * @param factor \n */\nexport const scaleFromMidpoint = (line: Line, factor: number): Line => {\n  const a = interpolate(factor / 2, line);\n  const b = interpolate(0.5 + factor / 2, line);\n  return { a, b };\n};\n\n/**\n * Calculates `y` where `line` intersects `x`.\n * @param line Line to extend\n * @param x Intersection of x-axis.\n */\nexport const pointAtX = (line: Line, x: number): Point => {\n  const y = line.a.y + (x - line.a.x) * slope(line);\n  return Object.freeze({ x: x, y });\n};\n\n/**\n * Returns a line extended from its `a` point by a specified distance\n *\n * ```js\n * const line = {a: {x: 0, y:0}, b: {x:10, y:10} }\n * const extended = Lines.extendFromA(line, 2);\n * ```\n * @param line\n * @param distance\n * @return Newly extended line\n */\nexport const extendFromA = (line: Line, distance: number): Line => {\n  const calculatedLength = length(line);\n  return Object.freeze({\n    ...line,\n    a: line.a,\n    b: Object.freeze({\n      x: line.b.x + (line.b.x - line.a.x) / calculatedLength * distance,\n      y: line.b.y + (line.b.y - line.a.y) / calculatedLength * distance,\n    })\n  });\n};\n\n/**\n * Yields every integer point along `line`. \n * \n * @example Basic usage\n * ```js\n * const l = { a: {x: 0, y: 0}, b: {x: 100, y: 100} };\n * for (const p of Lines.pointsOf(l)) {\n *  // Do something with point `p`...\n * }\n * ```\n * \n * Some precision is lost as start and end\n * point is also returned as an integer.\n * \n * Uses [Bresenham's line algorithm](https://en.wikipedia.org/wiki/Bresenham%27s_line_algorithm)\n * @param line Line\n */\n\nexport function* pointsOf(line: Line): Generator<Point> {\n  // Via https://play.ertdfgcvb.xyz/#/src/demos/dyna\n  const { a, b } = line;\n  let x0 = Math.floor(a.x);\n  let y0 = Math.floor(a.y);\n  const x1 = Math.floor(b.x);\n  const y1 = Math.floor(b.y);\n  const dx = Math.abs(x1 - x0);\n  const dy = -Math.abs(y1 - y0);\n  const sx = x0 < x1 ? 1 : -1;\n  const sy = y0 < y1 ? 1 : -1;\n  // eslint-disable-next-line unicorn/prevent-abbreviations\n  let err = dx + dy;\n\n  while (true) {\n    yield { x: x0, y: y0 };\n    if (x0 === x1 && y0 === y1) break;\n    // eslint-disable-next-line unicorn/prevent-abbreviations\n    const e2 = 2 * err;\n    if (e2 >= dy) {\n      err += dy;\n      x0 += sx;\n    }\n    if (e2 <= dx) {\n      err += dx;\n      y0 += sy;\n    }\n  }\n}\n\n/**\n * Returns the distance of `point` to the \n * nearest point on `line`.\n * \n * ```js\n * const d = Lines.distance(line, {x:10,y:10});\n * ```\n * \n * If an array of lines is provided, the shortest distance is returned.\n * @param line Line (or array of lines)\n * @param point Point to check against\n * @returns Distance\n */\nexport const distance = (line: Line | readonly Line[], point: Point): number => {\n  if (Array.isArray(line)) {\n    const distances = line.map(l => distanceSingleLine(l, point));\n    return minFast(distances);\n  } else {\n    return distanceSingleLine(line as Line, point);\n  }\n};\n\n/**\n * Returns an array representation of line: [a.x, a.y, b.x, b.y]\n * \n * See {@link fromFlatArray} to create a line _from_ this representation.\n *\n * ```js\n * Lines.toFlatArray(line);\n * Lines.toFlatArray(pointA, pointB);\n * ```\n * @param {Point} a\n * @param {Point} b\n * @returns {number[]}\n */\nexport const toFlatArray = (a: Point | Line, b: Point): readonly number[] => {\n  if (isLine(a)) {\n    return [ a.a.x, a.a.y, a.b.x, a.b.y ];\n  } else if (isPoint(a) && isPoint(b)) {\n    return [ a.x, a.y, b.x, b.y ];\n  } else {\n    throw new Error(`Expected single line parameter, or a and b points`);\n  }\n};\n\n/**\n * Yields all the points of all the lines.\n * \n * ```js\n * const lines = [ ..some array of lines.. ];\n * for (const pt of Lines.asPoints(lines)) {\n *  // Yields a and then b of each point sequentially\n * }\n * ```\n * @param lines \n */\n\nexport function* asPoints(lines: Iterable<Line>) {\n  for (const l of lines) {\n    yield l.a;\n    yield l.b;\n  }\n}\n\n/**\n * Returns an SVG description of line\n * ```\n * Lines.toSvgString(ptA, ptB);\n * ```\n * @param a \n * @param b \n * @returns \n */\nexport const toSvgString = (a: Point, b: Point): readonly string[] => [ `M${ a.x } ${ a.y } L ${ b.x } ${ b.y }` ];\n","import { type Point } from \"../point/point-type.js\";\nimport { getRectPositioned } from \"./guard.js\";\nimport type { Rect, RectPositioned } from \"./rect-types.js\";\n\n/**\n * Returns the four corners of a rectangle as an array of Points.\n *\n * ```js\n * const rect = { width: 100, height: 100, x: 0, y: 0};\n * const pts = Rects.corners(rect);\n * ```\n *\n * If the rectangle is not positioned, is origin can be provided.\n * Order of corners: ne, nw, sw, se\n * @param rect\n * @param origin\n * @returns\n */\nexport const corners = (\n  rect: RectPositioned | Rect,\n  origin?: Point\n): readonly Point[] => {\n  const r = getRectPositioned(rect, origin);\n  return [\n    { x: r.x, y: r.y },\n    { x: r.x + r.width, y: r.y },\n    { x: r.x + r.width, y: r.y + r.height },\n    { x: r.x, y: r.y + r.height },\n  ];\n};","import { isQuadraticBezier } from \"../bezier/guard.js\";\nimport { isLine } from \"../line/guard.js\";\nimport type { Point } from \"../point/point-type.js\";\nimport type { Path } from \"./path-type.js\";\n\n/**\n * Return the start point of a path\n *\n * @param path\n * @return Point\n */\nexport const getStart = function (path: Path): Point {\n  if (isQuadraticBezier(path)) return path.a;\n  else if (isLine(path)) return path.a;\n  else throw new Error(`Unknown path type ${ JSON.stringify(path) }`);\n};\n\n/**\n * Return the end point of a path\n *\n * @param path\n * @return Point\n */\nexport const getEnd = function (path: Path): Point {\n  if (isQuadraticBezier(path)) return path.b;\n  else if (isLine(path)) return path.b;\n  else throw new Error(`Unknown path type ${ JSON.stringify(path) }`);\n};","import { bbox as PointsBbox } from '../point/bbox.js';\nimport { isEqual as PointsIsEqual } from '../point/is-equal.js';\nimport type { Point } from '../point/point-type.js';\nimport { corners as RectsCorners } from '../rect/corners.js';\nimport { sortByNumericProperty } from '@ixfx/arrays';\nimport { getEnd, getStart } from './start-end.js';\nimport type { CompoundPath, Dimensions, Path } from './path-type.js';\nimport type { RectPositioned } from '../rect/rect-types.js';\n\n/**\n * Returns a new compoundpath, replacing a path at a given index\n *\n * @param compoundPath Existing compoundpath\n * @param index Index to replace at\n * @param path Path to substitute in\n * @returns New compoundpath\n */\nexport const setSegment = (compoundPath: CompoundPath, index: number, path: Path): CompoundPath => {\n  const existing = [ ...compoundPath.segments ];\n  //eslint-disable-next-line functional/prefer-readonly-type,functional/immutable-data\n  existing[ index ] = path;\n  return fromPaths(...existing);\n};\n\n/**\n * Computes x,y point at a relative position along compoundpath\n *\n * @param paths Combined paths (assumes contiguous)\n * @param t Position (given as a percentage from 0 to 1)\n * @param useWidth If true, widths are used for calulcating. If false, lengths are used\n * @param dimensions Precalculated dimensions of paths, will be computed if omitted\n * @returns\n */\nexport const interpolate = (paths: readonly Path[], t: number, useWidth?: boolean, dimensions?: Dimensions) => {\n  if (dimensions === undefined) {\n    dimensions = computeDimensions(paths);\n  }\n\n  // Expected value to land on\n  const expected = t * (useWidth ? dimensions.totalWidth : dimensions.totalLength);\n  let soFar = 0;\n\n  // Use widths or lengths?\n  const l = useWidth ? dimensions.widths : dimensions.lengths;\n  for (const [ index, element ] of l.entries()) {\n    if (soFar + element >= expected) {\n      const relative = expected - soFar;\n      let amt = relative / element;\n      if (amt > 1) amt = 1;\n      return paths[ index ].interpolate(amt);\n    } else soFar += element;\n  }\n  return { x: 0, y: 0 };\n};\n\n/**\n * Returns the shortest distance of `point` to any point on `paths`.\n * @param paths \n * @param point \n * @returns \n */\nexport const distanceToPoint = (paths: readonly Path[], point: Point): number => {\n  if (paths.length === 0) return 0;\n  let distances = paths.map((p, index) => ({ path: p, index, distance: p.distanceToPoint(point) }));\n  distances = sortByNumericProperty(distances, `distance`);\n  if (distances.length === 0) throw new Error(`Could not look up distances`);\n  return distances[ 0 ].distance;\n}\n\n/**\n * Relative position\n * @param paths Paths\n * @param point Point\n * @param intersectionThreshold Threshold \n * @param dimensions Pre-computed dimensions\n * @returns \n */\nexport const relativePosition = (paths: readonly Path[], point: Point, intersectionThreshold: number, dimensions?: Dimensions): number => {\n  if (dimensions === undefined) {\n    dimensions = computeDimensions(paths);\n  }\n  let distances = paths.map((p, index) => ({ path: p, index, distance: p.distanceToPoint(point) }));\n  distances = sortByNumericProperty(distances, `distance`);\n  if (distances.length < 0) throw new Error(`Point does not intersect with path`);\n  const d = distances[ 0 ];\n  if (d.distance > intersectionThreshold) throw new Error(`Point does not intersect with path. Minimum distance: ${ d.distance }, threshold: ${ intersectionThreshold }`);\n\n  const relativePositionOnPath = d.path.relativePosition(point, intersectionThreshold);\n\n  // Add up distances\n  let accumulated = 0;\n  for (let index = 0; index < d.index; index++) {\n    // Add up length of paths before closest path segment\n    accumulated += dimensions.lengths[ index ];\n  }\n\n  // Add up partial amount of closest path\n  accumulated += dimensions.lengths[ d.index ] * relativePositionOnPath;\n  const accumulatedRel = accumulated / dimensions.totalLength;\n  console.log(`acc: ${ accumulated } rel: ${ accumulatedRel } on path: ${ relativePositionOnPath } path: ${ d.index }`);\n  return accumulatedRel;\n}\n\n/**\n * Computes the widths and lengths of all paths, adding them up as well\n *\n * @param paths\n * @returns\n */\nexport const computeDimensions = (paths: readonly Path[]): Dimensions => {\n  const widths = paths.map(l => l.bbox().width);\n  const lengths = paths.map(l => l.length());\n  let totalLength = 0;\n  let totalWidth = 0;\n  for (const length of lengths) {\n    totalLength += length;\n  }\n  for (const width of widths) {\n    totalWidth += width;\n  }\n\n  return { totalLength, totalWidth, widths, lengths };\n};\n\n/**\n * Computes the bounding box that encloses entire compoundpath\n *\n * @param paths\n * @returns\n */\nexport const bbox = (paths: readonly Path[]): RectPositioned => {\n  const boxes = paths.map(p => p.bbox());\n  const corners = boxes.flatMap(b => RectsCorners(b));\n\n  return PointsBbox(...corners);\n};\n\n/**\n * Produce a human-friendly representation of paths\n *\n * @param paths\n * @returns\n */\nexport const toString = (paths: readonly Path[]): string => paths.map(p => p.toString()).join(`, `);\n\n/**\n * Throws an error if paths are not connected together, in order\n *\n * @param paths\n */\nexport const guardContinuous = (paths: readonly Path[]) => {\n  let lastPos = getEnd(paths[ 0 ]);\n  for (let index = 1; index < paths.length; index++) {\n    const start = getStart(paths[ index ]);\n    if (!PointsIsEqual(start, lastPos)) throw new Error(`Path index ${ index } does not start at prior path end. Start: ${ start.x },${ start.y } expected: ${ lastPos.x },${ lastPos.y }`);\n    lastPos = getEnd(paths[ index ]);\n  }\n};\n\nexport const toSvgString = (paths: readonly Path[]): readonly string[] => paths.flatMap(p => p.toSvgString());\n\n/**\n * Create a compoundpath from an array of paths.\n * All this does is verify they are connected, and precomputes dimensions\n *\n * @param paths\n * @returns\n */\nexport const fromPaths = (...paths: readonly Path[]): CompoundPath => {\n  guardContinuous(paths); // Throws an error if paths are not connected\n  const dims = computeDimensions(paths);\n\n  return Object.freeze({\n    segments: paths,\n    length: () => dims.totalLength,\n    nearest: (_: Point) => { throw new Error(`not implemented`); },\n    interpolate: (t: number, useWidth = false) => interpolate(paths, t, useWidth, dims),\n    relativePosition: (point: Point, intersectionThreshold: number) => relativePosition(paths, point, intersectionThreshold, dims),\n    distanceToPoint: (point: Point) => distanceToPoint(paths, point),\n    bbox: () => bbox(paths),\n    toString: () => toString(paths),\n    toSvgString: () => toSvgString(paths),\n    kind: `compound`\n  });\n};\n","export * from './compound-path.js';\nexport type * from './path-type.js';\nexport * from './start-end.js';\n\n","import { guard } from \"./guard.js\";\nimport type { Rect } from \"./rect-types.js\";\n\n/**\n * Returns the area of `rect`\n *\n * ```js\n * const rect = { width: 100, height: 100, x: 100, y: 100 };\n * Rects.area(rect);\n * ```\n * @param rect\n * @returns\n */\nexport const area = (rect: Rect): number => {\n  guard(rect);\n  return rect.height * rect.width;\n};","import { guard } from \"./guard.js\";\nimport type { RectPositioned, Rect } from \"./rect-types.js\";\nimport { isRect, isRectPositioned, isPositioned } from \"./guard.js\";\n\n/**\n * An operation between two fields of a rectangle.\n * Used in the context of {@link applyMerge}\n * ```\n * // Multiply fields\n * const op = (a, b) => a*b;\n * ```\n */\nexport type ApplyMergeOp = (a: number, b: number) => number\n\nexport type ApplyFieldOp = (fieldValue: number, fieldName?: `x` | `y` | `width` | `height`) => number\n\nexport function applyFields(op: ApplyFieldOp, rect: RectPositioned): RectPositioned;\nexport function applyFields(op: ApplyFieldOp, rect: Rect): Rect;\nexport function applyFields(op: ApplyFieldOp, width: number, height: number): Rect;\n\n/**\n * Applies an operation over each field of a rectangle.\n * ```js\n * // Convert x,y,width,height to integer values\n * applyFields(v => Number.floor(v), someRect);\n * ```\n * @param op\n * @param rectOrWidth \n * @param heightValue \n * @returns \n */\nexport function applyFields(op: ApplyFieldOp, rectOrWidth: RectPositioned | Rect | number, heightValue?: number): RectPositioned | Rect {\n  let width = (typeof rectOrWidth === `number`) ? rectOrWidth : rectOrWidth.width;\n  let height = (typeof rectOrWidth === `number`) ? heightValue : rectOrWidth.height;\n  if (width === undefined) throw new Error(`Param 'width' undefined`);\n  if (height === undefined) throw new Error(`Param 'height' undefined`);\n\n  width = op(width, `width`);\n  height = op(height, `height`);\n\n  if (typeof rectOrWidth === `object`) {\n    if (isPositioned(rectOrWidth)) {\n      const x = op(rectOrWidth.x, `x`);\n      const y = op(rectOrWidth.y, `y`);\n      return { ...rectOrWidth, width, height, x, y };\n    } else {\n      return {\n        ...rectOrWidth, width, height\n      }\n    }\n  }\n  return { width, height };\n}\n\nexport function applyMerge(\n  op: ApplyMergeOp,\n  rect: RectPositioned,\n  width: number,\n  height?: number\n): RectPositioned;\nexport function applyMerge(op: ApplyMergeOp, rect: Rect, width: number, height: number): Rect;\nexport function applyMerge(op: ApplyMergeOp, a: RectPositioned, b: Rect): RectPositioned;\nexport function applyMerge(op: ApplyMergeOp, a: Rect, b: Rect): Rect;\n\n/**\n * Applies an joint operation field-wise on two rectangles, returning a single rectangle. This is used to support operations like summing two rectangles.\n * ```js\n * // Eg make a new rectangle by summing each field of rectangle A & B.\n * apply((valueA,valueB) => valueA+valueB, rectA, rectB);\n * ```\n * @param op \n * @param a \n * @param b \n * @param c \n * @returns \n */\nexport function applyMerge(\n  op: ApplyMergeOp,\n  a: RectPositioned | Rect,\n  b: Rect | number,\n  c?: number\n): RectPositioned | Rect {\n  guard(a, `a`);\n\n  if (isRect(b)) {\n    // Math op by another rectangle\n    return isRectPositioned(a) ? Object.freeze({\n      ...a,\n      x: op(a.x, b.width),\n      y: op(a.y, b.height),\n      width: op(a.width, b.width),\n      height: op(a.height, b.height),\n    }) : Object.freeze({\n      ...a,\n      width: op(a.width, b.width),\n      height: op(a.height, b.height),\n    });\n  } else {\n    // Math op with a series of values\n    if (typeof b !== `number`) {\n      throw new TypeError(\n        `Expected second parameter of type Rect or number. Got ${ JSON.stringify(\n          b\n        ) }`\n      );\n    }\n    if (typeof c !== `number`) throw new Error(`Expected third param as height. Got ${ JSON.stringify(c) }`);\n    return isRectPositioned(a) ? Object.freeze({\n      ...a,\n      x: op(a.x, b),\n      y: op(a.y, c),\n      width: op(a.width, b),\n      height: op(a.height, c),\n    }) : Object.freeze({\n      ...a,\n      width: op(a.width, b),\n      height: op(a.height, c),\n    });\n  }\n}\n\n/**\n * Uses `op` with `param` to width and height.\n * @param op \n * @param rect \n * @param parameter \n */\nexport function applyScalar(op: ApplyMergeOp, rect: Rect, parameter: number): Rect;\n\n/**\n * Uses `op` to apply with `param` to width, height, x & y.\n * Use `applyDim` to apply just to dimensions.\n * @param op \n * @param rect \n * @param parameter \n */\nexport function applyScalar(\n  op: ApplyMergeOp,\n  rect: RectPositioned,\n  parameter: number\n): RectPositioned;\n\nexport function applyScalar(\n  op: ApplyMergeOp,\n  rect: Rect | RectPositioned,\n  parameter: number\n): Rect | RectPositioned {\n  return isPositioned(rect) ? Object.freeze({\n    ...rect,\n    x: op(rect.x, parameter),\n    y: op(rect.y, parameter),\n    width: op(rect.width, parameter),\n    height: op(rect.height, parameter),\n  }) : Object.freeze({\n    ...rect,\n    width: op(rect.width, parameter),\n    height: op(rect.height, parameter),\n  });\n}\n\n/**\n * Applies `op` with `param` to `rect`'s width and height.\n * @param op \n * @param rect \n * @param parameter \n * @returns \n */\nexport function applyDim(\n  op: ApplyMergeOp,\n  rect: Rect | RectPositioned,\n  parameter: number\n): Rect | RectPositioned {\n  return Object.freeze({\n    ...rect,\n    width: op(rect.width, parameter),\n    height: op(rect.height, parameter),\n  });\n}","import type { RectPositioned } from \"./rect-types.js\";\nimport type { GridCardinalDirection } from '../grid/index.js';\nimport type { Point } from \"../point/point-type.js\";\n\n/**\n * Returns a point on cardinal direction, or 'center' for the middle.\n *\n * ```js\n * cardinal({x: 10, y:10, width:100, height: 20}, 'center');\n * ```\n * @param rect Rectangle\n * @param card Cardinal direction or 'center'\n * @returns Point\n */\nexport const cardinal = (\n  rect: RectPositioned,\n  card: GridCardinalDirection | `center`\n): Point => {\n  const { x, y, width, height } = rect;\n  switch (card) {\n    case `nw`: {\n      return Object.freeze({ x, y });\n    }\n    case `n`: {\n      return Object.freeze({\n        x: x + width / 2,\n        y,\n      });\n    }\n    case `ne`: {\n      return Object.freeze({\n        x: x + width,\n        y,\n      });\n    }\n    case `sw`: {\n      return Object.freeze({ x, y: y + height });\n    }\n    case `s`: {\n      return Object.freeze({\n        x: x + width / 2,\n        y: y + height,\n      });\n    }\n    case `se`: {\n      return Object.freeze({\n        x: x + width,\n        y: y + height,\n      });\n    }\n    case `w`: {\n      return Object.freeze({ x, y: y + height / 2 });\n    }\n    case `e`: {\n      return Object.freeze({ x: x + width, y: y + height / 2 });\n    }\n    case `center`: {\n      return Object.freeze({\n        x: x + width / 2,\n        y: y + height / 2,\n      });\n    }\n    default: {\n      // eslint-disable-next-line @typescript-eslint/restrict-template-expressions\n      throw new Error(`Unknown direction: ${ card }`);\n    }\n  }\n};","import type { Point } from \"../point/point-type.js\";\nimport { center } from \"./center.js\";\nimport type { RectPositioned } from \"./rect-types.js\";\n\n/**\n * Perform basic point translation using a rectangle where its center is the origin.\n * \n * Thus the relative coordinate { x: 0, y: 0} corresponds to the absolute middle of the\n * rectangle.\n * \n * The relative coordinate { x: -1, y: -1 } corresponds to the rectangle's {x,y} properties, and so on.\n * @param rectAbsolute \n * @returns \n */\nexport const centerOrigin = (rectAbsolute: RectPositioned) => {\n  const c = center(rectAbsolute);\n  const w = rectAbsolute.width / 2;\n  const h = rectAbsolute.height / 2;\n\n  const relativeToAbsolute = (point: Point) => {\n    return {\n      ...point,\n      x: point.x * w + c.x,\n      y: point.y * h + c.y\n    }\n  }\n\n  const absoluteToRelative = (point: Point) => {\n    return {\n      ...point,\n      x: ((point.x - rectAbsolute.x) / w) - 1,\n      y: ((point.y - rectAbsolute.y) / h) - 1\n    }\n  }\n\n  return { relativeToAbsolute, absoluteToRelative }\n}","import type { RectPositioned, Rect } from \"./rect-types.js\";\nimport { applyMerge, applyDim, applyScalar } from \"./apply.js\";\n\nconst divideOp = (a: number, b: number) => a / b;\n\n/**\n * Divides positioned `rect` by width/height. Useful for normalising a value.\n * x & y value of second parameter are ignored\n * ```js\n * // Normalise based on window size\n * const r = { x: 10, y: 200, width: 100, height: 30 };\n * const rr = Rects.divide(r, window.innerWidth, window.innerHeight);\n * ```\n *\n * Division applies to the first parameter's x/y fields. X is affected by `width`, Y is affected by `height`.\n */\nexport function divide(\n  rect: RectPositioned,\n  width: number,\n  height?: number\n): RectPositioned;\n\n/**\n * Divides `rect` by width/height. Useful for denormalising a value.\n *\n * ```js\n * // Normalise based on window size\n * const r = { width: 100, height: 30 };\n * const rr = Rects.divide(r, window.innerWidth, window.innerHeight);\n * ```\n *\n */\nexport function divide(rect: Rect, width: number, height: number): Rect;\n\n/**\n * Divides positioned rect `a` by width and height of rect `b`.\n * ```js\n * // Returns { ...a, width: a.width / b.width, height: a.height/b.height, x: a.x / b.width, y: a.y / b.height }\n * Rects.divide(a, b);\n * ```\n *\n * @param a \n * @param b \n */\nexport function divide(a: RectPositioned, b: Rect | RectPositioned): RectPositioned;\n\n/**\n * Divides rect `a` by width and height of rect `b`.\n * \n * ```js\n * // Returns {...a, width: a.width / b.width, height: a.height/b.height }\n * Rects.divide(a, b);\n * ```\n *\n * @param a \n * @param b \n */\nexport function divide(a: Rect, b: Rect): Rect;\n\n/**\n * @internal\n * @param a \n * @param b \n * @param c \n * @returns \n */\nexport function divide(\n  a: RectPositioned | Rect,\n  b: Rect | number,\n  c?: number\n): RectPositioned | Rect {\n  // @ts-ignore\n  return applyMerge(divideOp, a, b, c) as RectPositioned | Rect;\n}\n\n\n/**\n * Divides all components of `rect` by `amount`.\n * ```js\n * divideScalar({ width:10, height:20 }, 2); // { width:5, height: 10 }\n * ```\n * @param rect\n * @param amount\n */\nexport function divideScalar(rect: Rect, amount: number): Rect;\n\n/**\n * Divides all components of `rect` by `amount`.\n * This includes x,y if present.\n * \n * ```js\n * divideScalar({ width:10, height:20 }, 2); // { width:5, height: 10 }\n * divideScalar({ x: 1, y: 2, width:10, height:20 }, 2); // { x: 0.5, y: 1, width:5, height: 10 }\n * ```\n * @param rect\n * @param amount\n */\nexport function divideScalar(\n  rect: RectPositioned,\n  amount: number\n): RectPositioned;\n\n/**\n * Divides all components of `rect` by `amount`.\n * This includes x,y if present.\n * \n * ```js\n * divideScalar({ width:10, height:20 }, 2); // { width:5, height: 10 }\n * divideScalar({ x: 1, y: 2, width:10, height:20 }, 2); // { x: 0.5, y: 1, width:5, height: 10 }\n * ```\n * @param rect\n * @param amount\n */\nexport function divideScalar(\n  rect: Rect | RectPositioned,\n  amount: number\n): Rect | RectPositioned {\n  return applyScalar(divideOp, rect, amount);\n}\n\nexport function divideDim(\n  rect: Rect | RectPositioned,\n  amount: number\n): Rect | RectPositioned {\n  return applyDim(divideOp, rect, amount);\n}\n","import { isPoint } from \"../point/guard.js\";\nimport { guard } from \"./guard.js\";\nimport type { Rect, RectPositioned } from \"./rect-types.js\";\nimport { joinPointsToLines as LinesJoinPointsToLines } from '../line/join-points-to-lines.js';\n\nimport type { Point } from '../point/point-type.js';\nimport { corners } from \"./corners.js\";\nimport type { Line } from \"../line/line-type.js\";\n\n/**\n * Returns four lines based on each corner.\n * Lines are given in order: top, right, bottom, left\n *\n * ```js\n * const rect = { width: 100, height: 100, x: 100, y: 100 };\n * // Yields: array of length four\n * const lines = Rects.lines(rect);\n * ```\n *\n * @param {(RectPositioned|Rect)} rect\n * @param {Points.Point} [origin]\n * @returns {Lines.Line[]}\n */\nexport const edges = (\n  rect: RectPositioned | Rect,\n  origin?: Point\n): readonly Line[] => {\n  const c = corners(rect, origin);\n\n  // Connect all the corners, back to first corner again\n  return LinesJoinPointsToLines(...c, c[ 0 ]);\n};\n\n/**\n * Returns a point on the edge of rectangle\n * ```js\n * const r1 = {x: 10, y: 10, width: 100, height: 50};\n * Rects.getEdgeX(r1, `right`);  // Yields: 110\n * Rects.getEdgeX(r1, `bottom`); // Yields: 10\n *\n * const r2 = {width: 100, height: 50};\n * Rects.getEdgeX(r2, `right`);  // Yields: 100\n * Rects.getEdgeX(r2, `bottom`); // Yields: 0\n * ```\n * @param rect\n * @param edge Which edge: right, left, bottom, top\n * @returns\n */\nexport const getEdgeX = (\n  rect: RectPositioned | Rect,\n  edge: `right` | `bottom` | `left` | `top`\n): number => {\n  guard(rect);\n  switch (edge) {\n    case `top`: {\n      return isPoint(rect) ? rect.x : 0;\n    }\n    case `bottom`: {\n      return isPoint(rect) ? rect.x : 0;\n    }\n    case `left`: {\n      return isPoint(rect) ? rect.y : 0;\n    }\n    case `right`: {\n      return isPoint(rect) ? rect.x + rect.width : rect.width;\n    }\n  }\n};\n\n/**\n * Returns a point on the edge of rectangle\n *\n * ```js\n * const r1 = {x: 10, y: 10, width: 100, height: 50};\n * Rects.getEdgeY(r1, `right`);  // Yields: 10\n * Rects.getEdgeY(r1, `bottom`); // Yields: 60\n *\n * const r2 = {width: 100, height: 50};\n * Rects.getEdgeY(r2, `right`);  // Yields: 0\n * Rects.getEdgeY(r2, `bottom`); // Yields: 50\n * ```\n * @param rect\n * @param edge Which edge: right, left, bottom, top\n * @returns\n */\nexport const getEdgeY = (\n  rect: RectPositioned | Rect,\n  edge: `right` | `bottom` | `left` | `top`\n): number => {\n  guard(rect);\n  switch (edge) {\n    case `top`: {\n      return (isPoint(rect) ? rect.y : 0);\n    }\n    case `bottom`: {\n      return isPoint(rect) ? rect.y + rect.height : rect.height;\n    }\n    case `left`: {\n      return isPoint(rect) ? rect.y : 0;\n    }\n    case `right`: {\n      return isPoint(rect) ? rect.y : 0;\n    }\n  }\n};","export const Empty = Object.freeze({ width: 0, height: 0 });\nexport const EmptyPositioned = Object.freeze({\n  x: 0,\n  y: 0,\n  width: 0,\n  height: 0,\n});","import type { Point } from \"../point/point-type.js\";\nimport type { RectPositioned } from \"./rect-types.js\";\n\n/**\n * Returns a copy of `rect` with `rect` resized so it also encompasses `points`.\n * If provided point(s) are within bounds of `rect`, a copy of `rect` is returned.\n * @param rect \n * @param points \n * @returns \n */\nexport const encompass = (rect: RectPositioned, ...points: Point[]): RectPositioned => {\n  const x = points.map(p => p.x);\n  const y = points.map(p => p.y);\n\n  let minX = Math.min(...x, rect.x);\n  let minY = Math.min(...y, rect.y);\n  let maxX = Math.max(...x, rect.x + rect.width);\n  let maxY = Math.max(...y, rect.y + rect.height);\n\n  let rectW = Math.max(rect.width, maxX - minX);\n  let rectH = Math.max(rect.height, maxY - minY);\n\n  return Object.freeze({\n    ...rect,\n    x: minX,\n    y: minY,\n    width: rectW,\n    height: rectH\n  })\n} ","import type { Rect } from \"./rect-types.js\";\n\n/**\n * Initialise a rectangle based on the width and height of a HTML element.\n *\n * ```js\n * Rects.fromElement(document.querySelector(`body`));\n * ```\n * @param el\n * @returns\n */\nexport const fromElement = (el: HTMLElement): Rect => ({\n  width: el.clientWidth,\n  height: el.clientHeight,\n});","import type { RectPositioned, Rect } from \"./rect-types.js\";\n/**\n * Returns a rectangle from width, height\n * ```js\n * const r = Rects.fromNumbers(100, 200);\n * // {width: 100, height: 200}\n * ```\n *\n * Use {@link toArray} for the opposite conversion.\n *\n * @param width\n * @param height\n */\nexport function fromNumbers(width: number, height: number): Rect;\n\n/**\n * Returns a rectangle from x,y,width,height\n *\n * ```js\n * const r = Rects.fromNumbers(10, 20, 100, 200);\n * // {x: 10, y: 20, width: 100, height: 200}\n * ```\n *\n * Use the spread operator (...) if the source is an array:\n * ```js\n * const r3 = Rects.fromNumbers(...[10, 20, 100, 200]);\n * ```\n *\n * Use {@link toArray} for the opposite conversion.\n *\n * @param x\n * @param y\n * @param width\n * @param height\n */\nexport function fromNumbers(\n  x: number,\n  y: number,\n  width: number,\n  height: number\n): RectPositioned;\n\n/**\n * Returns a rectangle from a series of numbers: x, y, width, height OR width, height\n *\n * ```js\n * const r1 = Rects.fromNumbers(100, 200);\n * // {width: 100, height: 200}\n *\n * const r2 = Rects.fromNumbers(10, 20, 100, 200);\n * // {x: 10, y: 20, width: 100, height: 200}\n * ```\n * Use the spread operator (...) if the source is an array:\n *\n * ```js\n * const r3 = Rects.fromNumbers(...[10, 20, 100, 200]);\n * ```\n *\n * Use {@link toArray} for the opposite conversion.\n *\n * @see toArray\n * @param xOrWidth\n * @param yOrHeight\n * @param width\n * @param height\n * @returns\n */\n\nexport function fromNumbers(\n  xOrWidth: number,\n  yOrHeight: number,\n  width?: number,\n  height?: number\n): Rect | RectPositioned {\n  if (width === undefined || height === undefined) {\n    if (typeof xOrWidth !== `number`) throw new Error(`width is not an number`);\n    if (typeof yOrHeight !== `number`) {\n      throw new TypeError(`height is not an number`);\n    }\n    return Object.freeze({ width: xOrWidth, height: yOrHeight });\n  }\n  if (typeof xOrWidth !== `number`) throw new Error(`x is not an number`);\n  if (typeof yOrHeight !== `number`) throw new Error(`y is not an number`);\n  if (typeof width !== `number`) throw new Error(`width is not an number`);\n  if (typeof height !== `number`) throw new Error(`height is not an number`);\n\n  return Object.freeze({ x: xOrWidth, y: yOrHeight, width, height });\n}\n","import { isPoint } from \"../point/guard.js\";\nimport type { Point } from \"../point/point-type.js\";\nimport { isRect, isRectPositioned } from \"./guard.js\";\nimport type { Rect, RectPositioned } from \"./rect-types.js\";\n\n/**\n * Accepts:\n * * x,y,w,h\n * * x,y,rect\n * * point,rect\n * * RectPositioned\n * * Rect, x,y\n * * Rect, Point\n * @param a \n * @param b \n * @param c \n * @param d \n * @returns \n */\nexport function getRectPositionedParameter(a: number | Point | Rect | RectPositioned, b?: Rect | number | Point, c?: number | Rect, d?: number): RectPositioned {\n  if (typeof a === `number`) {\n    if (typeof b === `number`) {\n      if (typeof c === `number` && typeof d === `number`) {\n        return { x: a, y: b, width: c, height: d }\n      } else if (isRect(c)) {\n        return { x: a, y: b, width: c.width, height: c.height }\n      } else {\n        throw new TypeError(`If params 'a' & 'b' are numbers, expect following parameters to be x,y or Rect`);\n      }\n    } else {\n      throw new TypeError(`If parameter 'a' is a number, expect following parameters to be: y,w,h`);\n    }\n  } else if (isRectPositioned(a)) {\n    return a;\n  } else if (isRect(a)) {\n    if (typeof b === `number` && typeof c === `number`) {\n      return { width: a.width, height: a.height, x: b, y: c };\n    } else if (isPoint(b)) {\n      return { width: a.width, height: a.height, x: b.x, y: b.y };\n    } else {\n      throw new TypeError(`If param 'a' is a Rect, expects following parameters to be x,y`);\n    }\n  } else if (isPoint(a)) {\n    if (typeof b === `number` && typeof c === `number`) {\n      return { x: a.x, y: a.y, width: b, height: c };\n    } else if (isRect(b)) {\n      return { x: a.x, y: a.y, width: b.width, height: b.height };\n    } else {\n      throw new TypeError(`If parameter 'a' is a Point, expect following params to be: Rect or width,height`);\n    }\n  }\n  throw new TypeError(`Expect a first parameter to be x,RectPositioned,Rect or Point`);\n}\n\n","import { isPositioned } from \"./guard.js\";\nimport type { Rect, RectPositioned } from \"./rect-types.js\";\nimport { isEqual as PointsIsEqual } from '../point/is-equal.js';\n/**\n * Returns _true_ if the width & height of the two rectangles is the same.\n *\n * ```js\n * const rectA = { width: 10, height: 10, x: 10, y: 10 };\n * const rectB = { width: 10, height: 10, x: 20, y: 20 };\n *\n * // True, even though x,y are different\n * Rects.isEqualSize(rectA, rectB);\n *\n * // False, because coordinates are different\n * Rects.isEqual(rectA, rectB)\n * ```\n * @param a\n * @param b\n * @returns\n */\nexport const isEqualSize = (a: Rect, b: Rect): boolean => {\n  if (a === undefined) throw new Error(`a undefined`);\n  if (b === undefined) throw new Error(`b undefined`);\n  return a.width === b.width && a.height === b.height;\n};\n\n/**\n * Returns _true_ if two rectangles have identical values.\n * Both rectangles must be positioned or not.\n *\n * ```js\n * const rectA = { width: 10, height: 10, x: 10, y: 10 };\n * const rectB = { width: 10, height: 10, x: 20, y: 20 };\n *\n * // False, because coordinates are different\n * Rects.isEqual(rectA, rectB)\n *\n * // True, even though x,y are different\n * Rects.isEqualSize(rectA, rectB);\n * ```\n * @param a\n * @param b\n * @returns\n */\nexport const isEqual = (\n  a: Rect | RectPositioned,\n  b: Rect | RectPositioned\n): boolean => {\n  if (isPositioned(a) && isPositioned(b)) {\n    if (!PointsIsEqual(a, b)) return false;\n    return a.width === b.width && a.height === b.height;\n  } else if (!isPositioned(a) && !isPositioned(b)) {\n    return a.width === b.width && a.height === b.height;\n  } else {\n    // One param is positioned, the other is not\n    return false;\n  }\n};","import { length as LinesLength } from '../line/length.js';\n\nimport { edges } from './edges.js';\nimport { guardPositioned } from './guard.js';\nimport type { RectPositioned } from './rect-types.js';\n/**\n * Returns the length of each side of the rectangle (top, right, bottom, left)\n *\n * ```js\n * const rect = { width: 100, height: 100, x: 100, y: 100 };\n * // Yields: array of length four\n * const lengths = Rects.lengths(rect);\n * ```\n * @param rect\n * @returns\n */\nexport const lengths = (rect: RectPositioned): readonly number[] => {\n  guardPositioned(rect, `rect`);\n  return edges(rect).map((l) => LinesLength(l));\n};\n","import type { RectPositioned, Rect } from \"./rect-types.js\";\nimport { applyMerge, applyDim, applyScalar } from \"./apply.js\";\n\nconst multiplyOp = (a: number, b: number) => a * b;\n\n\n/**\n * Multiplies positioned `rect` by width/height. Useful for denormalising a value.\n * x/y value of second parameter are ignored.\n * ```js\n * // Normalised rectangle\n * const r = { x:0.5, y:0.5, width: 0.5, height: 0.5};\n *\n * // Map to window:\n * const rr = Rects.multiply(r, window.innerWidth, window.innerHeight);\n * ```\n *\n * Multiplication applies to the first parameter's x/y fields.\n */\nexport function multiply(\n  rect: RectPositioned,\n  width: number,\n  height?: number\n): RectPositioned;\n\n/**\n * Multiplies `rect` by width/height. Useful for denormalising a value.\n *\n * ```js\n * // Normalised rectangle of width 50%, height 50%\n * const r = { width: 0.5, height: 0.5 };\n *\n * // Map to window:\n * const rr = Rects.multiply(r, window.innerWidth, window.innerHeight);\n * ```\n *\n * Multiplication applies to the first parameter's x/y fields, if present.\n */\nexport function multiply(rect: Rect, width: number, height: number): Rect;\n\n/**\n * Multiplies positioned rect `a` by width and height of rect `b`.\n * ```js\n * // Returns {width: someRect.width * someOtherRect.width ...}\n * Rects.multiply(someRect, someOtherRect);\n * ```\n *\n * @param a \n * @param b \n */\nexport function multiply(a: RectPositioned, b: Rect | RectPositioned): RectPositioned;\n\n/**\n * Multiplies rect `a` by width and height of rect `b`.\n * \n * ```js\n * // Returns {width: someRect.width * someOtherRect.width ...}\n * Rects.multiply(someRect, someOtherRect);\n * ```\n *\n * @param a \n * @param b \n */\nexport function multiply(a: Rect, b: Rect): Rect;\n\n/**\n * @internal\n * @param a \n * @param b \n * @param c \n * @returns \n */\nexport function multiply(\n  a: RectPositioned | Rect,\n  b: Rect | number,\n  c?: number\n): RectPositioned | Rect {\n  // @ts-ignore\n  return applyMerge(multiplyOp, a, b, c) as RectPositioned | Rect;\n}\n\n\n/**\n * Multiplies all components of `rect` by `amount`.\n * ```js\n * multiplyScalar({ width:10, height:20 }, 2); // { width:20, height: 40 }\n * ```\n * @param rect\n * @param amount\n */\nexport function multiplyScalar(rect: Rect, amount: number): Rect;\n\n/**\n * Multiplies all components of `rect` by `amount`.\n * This includes x,y if present.\n * \n * ```js\n * multiplyScalar({ width:10, height:20 }, 2); // { width:20, height: 40 }\n * multiplyScalar({ x: 1, y: 2, width:10, height:20 }, 2); // { x: 2, y: 4, width:20, height: 40 }\n * ```\n * @param rect\n * @param amount\n */\nexport function multiplyScalar(\n  rect: RectPositioned,\n  amount: number\n): RectPositioned;\n\n/**\n * Multiplies all components of `rect` by `amount`.\n * This includes x,y if present.\n * \n * ```js\n * multiplyScalar({ width:10, height:20 }, 2); // { width:20, height: 40 }\n * multiplyScalar({ x: 1, y: 2, width:10, height:20 }, 2); // { x: 2, y: 4, width:20, height: 40 }\n * ```\n * \n * Use {@link multiplyDim} to only multiply width & height.\n * @param rect\n * @param amount\n */\nexport function multiplyScalar(\n  rect: Rect | RectPositioned,\n  amount: number\n): Rect | RectPositioned {\n  return applyScalar(multiplyOp, rect, amount);\n  // return isPositioned(rect) ? Object.freeze({\n  //   ...rect,\n  //   x: rect.x * amount,\n  //   y: rect.y * amount,\n  //   width: rect.width * amount,\n  //   height: rect.height * amount,\n  // }) : Object.freeze({\n  //   ...rect,\n  //   width: rect.width * amount,\n  //   height: rect.height * amount,\n  // });\n}\n\n\n/**\n * Multiplies only the width/height of `rect`, leaving `x` and `y` as they are.\n * ```js\n * multiplyDim({ x:1,y:2,width:3,height:4 }, 2);\n * // Yields: { x:1, y:2, width:6, height: 8 }\n * ```\n * \n * In comparison, {@link multiply} will also include x & y.\n * @param rect Rectangle\n * @param amount Amount to multiply by\n * @returns \n */\nexport function multiplyDim(\n  rect: Rect | RectPositioned,\n  amount: number\n): Rect | RectPositioned {\n  return applyDim(multiplyOp, rect, amount);\n  // return isPositioned(rect) ? Object.freeze({\n  //   ...rect,\n  //   x: rect.x * amount,\n  //   y: rect.y * amount,\n  //   width: rect.width * amount,\n  //   height: rect.height * amount,\n  // }) : Object.freeze({\n  //   ...rect,\n  //   width: rect.width * amount,\n  //   height: rect.height * amount,\n  // });\n}\n","import type { Point } from \"../point/point-type.js\";\nimport type { RectPositioned } from \"./rect-types.js\";\n\n/**\n * If `p` is inside of `rect`, a copy of `p` is returned.\n * If `p` is outside of `rect`, a point is returned closest to `p` on the edge\n * of the rectangle.\n * @param rect \n * @param p \n * @returns \n */\nexport const nearestInternal = (rect: RectPositioned, p: Point): Point => {\n  let { x, y } = p;\n  if (x < rect.x) x = rect.x;\n  else if (x > rect.x + rect.width) x = rect.x + rect.width;\n  if (y < rect.y) y = rect.y;\n  else if (y > rect.y + rect.height) y = rect.y + rect.height;\n  return Object.freeze({ ...p, x, y });\n}","export const Placeholder = Object.freeze({\n  width: Number.NaN,\n  height: Number.NaN,\n});\nexport const PlaceholderPositioned = Object.freeze({\n  x: Number.NaN,\n  y: Number.NaN,\n  width: Number.NaN,\n  height: Number.NaN,\n});\n","import { guard } from \"./guard.js\";\nimport type { Rect } from \"./rect-types.js\";\n\n/**\n * Returns the perimeter of `rect` (ie. sum of all edges)\n *  * ```js\n * const rect = { width: 100, height: 100, x: 100, y: 100 };\n * Rects.perimeter(rect);\n * ```\n * @param rect\n * @returns\n */\nexport const perimeter = (rect: Rect): number => {\n  guard(rect);\n  return rect.height + rect.height + rect.width + rect.width;\n};\n","import { isPoint, isPoint3d } from \"../point/guard.js\";\nimport type { Point } from \"../point/point-type.js\"\nimport type { Rect } from \"./rect-types.js\"\n\n/**\n * Returns a function that divides numbers or points by the largest dimension of `rect`.\n * \n * ```js\n * const d = dividerByLargestDimension({width:100,height:50});\n * d(50);                // 0.5 (50/100)\n * d({ x: 10, y: 20 }); // { x: 0.1, y: 0.2 }\n * ```\n * @param rect \n * @returns \n */\nexport const dividerByLargestDimension = (rect: Rect) => {\n  const largest = Math.max(rect.width, rect.height);\n  return (value: number | Point) => {\n    if (typeof value === `number`) {\n      return value / largest;\n    } else if (isPoint3d(value)) {\n      return Object.freeze({\n        ...value,\n        x: value.x / largest,\n        y: value.y / largest,\n        z: value.x / largest\n      });\n    } else if (isPoint(value)) {\n      return Object.freeze({\n        ...value,\n        x: value.x / largest,\n        y: value.y / largest\n      });\n    } else throw new Error(`Param 'value' is neither number nor Point`);\n  }\n}","import { type RandomSource } from '@ixfx/random';\nimport { sum as PointsSum } from '../point/sum.js';\nimport type { Point } from '../point/point-type.js';\nimport { isPositioned } from './guard.js';\nimport type { Rect, RectPositioned } from './rect-types.js';\n/**\n * Returns a random positioned Rect on a 0..1 scale.\n * ```js\n * const r = Rects.random(); // eg {x: 0.2549012, y:0.859301, width: 0.5212, height: 0.1423 }\n * ```\n *\n * A custom source of randomness can be provided:\n * ```js\n * import { Rects } from \"@ixfx/geometry.js\";\n * import { weightedSource } from \"@ixfx/random.js\"\n * const r = Rects.random(weightedSource(`quadIn`));\n * ```\n * @param rando\n * @returns\n */\nexport const random = (rando?: RandomSource): RectPositioned => {\n  rando ??= Math.random;\n\n  return Object.freeze({\n    x: rando(),\n    y: rando(),\n    width: rando(),\n    height: rando(),\n  });\n};\n\nexport type RectRandomPointOpts = {\n  readonly strategy?: `naive`;\n  readonly randomSource?: RandomSource;\n  readonly margin?: { readonly x: number; readonly y: number };\n};\n\n/**\n * Returns a random point within a rectangle.\n *\n * By default creates a uniform distribution.\n *\n * ```js\n * const pt = randomPoint({width: 5, height: 10});\n * ```'\n * @param within Rectangle to generate a point within\n * @param options Options\n * @returns\n */\nexport const randomPoint = (\n  within: Rect | RectPositioned,\n  options: RectRandomPointOpts = {}\n): Point => {\n  // TODO: Does not implement uniform distribution\n  // See: https://math.stackexchange.com/questions/366474/find-coordinates-of-n-points-uniformly-distributed-in-a-rectangle\n  const rand = options.randomSource ?? Math.random;\n  const margin = options.margin ?? { x: 0, y: 0 };\n\n  const x = rand() * (within.width - margin.x - margin.x);\n  const y = rand() * (within.height - margin.y - margin.y);\n\n  const pos = { x: x + margin.x, y: y + margin.y };\n  return isPositioned(within) ? PointsSum(pos, within) : Object.freeze(pos);\n};","import { applyMerge } from \"./apply.js\";\nimport { isPositioned } from \"./guard.js\";\nimport type { Rect, RectPositioned } from \"./rect-types.js\";\n\nconst subtractOp = (a: number, b: number) => a - b;\n\n/**\n * Subtracts width/height of `b` from `a` (ie: a - b), returning result.\n * x,y of second parameter is ignored.\n * ```js\n * const rectA = { width: 100, height: 100 };\n * const rectB = { width: 200, height: 200 };\n *\n * // Yields: { width: -100, height: -100 }\n * Rects.subtract(rectA, rectB);\n * ```\n * @param a\n * @param b\n */\nexport function subtract(a: Rect, b: Rect | RectPositioned): Rect;\nexport function subtract(a: RectPositioned, b: Rect | RectPositioned): RectPositioned;\n\n/**\n * Subtracts a width/height from `a`, returning result.\n * ```js\n * const rect = { width: 100, height: 100 };\n * Rects.subtract(rect, 200, 200);\n * // Yields: { width: -100, height: -100 }\n * ```\n * @param a\n * @param width\n * @param height\n */\nexport function subtract(a: Rect, width: number, height: number): Rect;\n\nexport function subtract(a: RectPositioned, width: number, height: number): RectPositioned;\n/**\n * Subtracts width/height from `a`.\n *\n * ```js\n * const rectA = { width: 100, height: 100 };\n * const rectB = { width: 200, height: 200 };\n *\n * // Yields: { width: -100, height: -100 }\n * Rects.subtract(rectA, rectB);\n * Rects.subtract(rectA, 200, 200);\n * ```\n * @param a\n * @param b\n * @param c\n * @returns\n */\nexport function subtract(a: Rect | undefined, b: RectPositioned | Rect | number, c?: number): Rect {\n  // @ts-ignore\n  return applyMerge(subtractOp, a, b, c);\n}\n\n/**\n * Subtracts a width & height from `a`. Leaves x & y as-is.\n * ```js\n * const rect = { x: 10, y: 20, width: 100, height: 200 };\n * subtractSize(rect, { width: 50, height: 100 });\n * subtractSize(rec, 50, 100);\n * // Both yields: { x:10, y: 20, width: 50, height: 100 }\n * ```\n * @param a Rectangle\n * @param b Rectangle to subtract by, or width\n * @param c Height, if second parameter is width\n */\nexport function subtractSize(a: RectPositioned, b: Rect | number, c?: number): RectPositioned;\n\n\n/**\n * Subtracts a width & height from `a`.\n * ```js\n * const rect = { width: 100, height: 200 };\n * subtractSize(rect, { width: 50, height: 100 });\n * subtractSize(rec, 50, 100);\n * // Both yields: { width: 50, height: 100 }\n * ```\n * @param a Rectangle\n * @param b Rectangle to subtract by, or width\n * @param c Height, if second parameter is width\n */\nexport function subtractSize(a: Rect, b: Rect | number, c?: number): Rect;\n\n\n\nexport function subtractSize(a: Rect | RectPositioned, b: Rect | number, c?: number): Rect | RectPositioned {\n  const w = typeof b === `number` ? b : b.width;\n  const h = typeof b === `number` ? c : b.height;\n  if (h === undefined) throw new Error(`Expected height as third parameter`);\n  const r = {\n    ...a,\n    width: a.width - w,\n    height: a.height - h\n  };\n  return r;\n}\n\n/**\n * Subtracts A-B. Applies to x, y, width & height\n * ```js\n * subtractOffset(\n *  { x:100, y:100, width:100, height:100 }, \n *  { x:10, y:20,   width: 30, height: 40 }\n * );\n * // Yields: {x: 90, y: 80, width: 70, height: 60 }\n * ```\n * If either `a` or `b` are missing x & y, 0 is used.\n * @param a \n * @param b \n * @returns \n */\nexport function subtractOffset(a: RectPositioned | Rect, b: RectPositioned | Rect): RectPositioned {\n  let x = 0;\n  let y = 0;\n  if (isPositioned(a)) {\n    x = a.x;\n    y = a.y;\n  }\n  let xB = 0;\n  let yB = 0;\n  if (isPositioned(b)) {\n    xB = b.x;\n    yB = b.y;\n  }\n  return Object.freeze({\n    ...a,\n    x: x - xB,\n    y: y - yB,\n    width: a.width - b.width,\n    height: a.height - b.height\n  })\n}","import { applyMerge } from \"./apply.js\";\nimport { getRectPositioned, isPositioned } from \"./guard.js\";\nimport type { Rect, RectPositioned } from \"./rect-types.js\";\n\nconst sumOp = (a: number, b: number) => a + b;\n/**\n * Sums width/height of `b` with `a` (ie: a + b), returning result.\n * x/y of second parameter are ignored\n * ```js\n * import { Rects } from \"@ixfx/geometry.js\";\n * const rectA = { width: 100, height: 100 };\n * const rectB = { width: 200, height: 200 };\n *\n * // Yields: { width: 300, height: 300 }\n * Rects.sum(rectA, rectB);\n * ```\n * @param a\n * @param b\n */\nexport function sum(a: Rect, b: Rect | RectPositioned): Rect;\n\n/**\n * Sums width/height of `b` with `a`, returning result.\n * \n * Note that width/height of `b` is also added to `a`'s x & y properties\n * ```js\n * // Yields: { x:101, y:202, width: 110, height: 220 }\n * sum({x:1, y:2, width:10, height:20}, {width:100, height: 200});\n * ```\n * \n * x & y values of `b` are ignored. If you want to sum with those, use `sumOffset`\n * @param a \n * @param b \n */\nexport function sum(a: RectPositioned, b: Rect | RectPositioned): RectPositioned;\n\n/**\n * Sums width/height of `rect` with given `width` and `height`\n * ```js\n * import { Rects } from \"@ixfx/geometry.js\";\n * const rect = { width: 100, height: 100 };\n *\n * // Yields: { width: 300, height: 300 }\n * Rects.subtract(rect, 200, 200);\n * ```\n * @param rect\n * @param width\n * @param height\n */\nexport function sum(rect: Rect, width: number, height: number): Rect;\n\n/**\n * Sums width/height of `rect` with `width` and `height`\n * \n * `width` and `height` is added to `rect`'s `x` and `y` values.\n * ```js\n * // Yields: { x:101, y:202, width: 110, height: 220 }\n * sum({x:1, y:2, width:10, height:20}, 100, 200);\n * ```\n * @param rect\n * @param width\n * @param height\n */\nexport function sum(rect: RectPositioned, width: number, height: number): RectPositioned;\n\n/**\n * Sums width/height of `b` with `a` (ie: a + b), returning result.\n *\n * ```js\n * const rectA = { width: 100, height: 100 };\n * const rectB = { width: 200, height: 200 };\n *\n * // Yields: { width: 300, height: 300 }\n * Rects.sum(rectA, rectB);\n * Rects.sum(rectA, 200, 200);\n * ```\n * @param a\n * @param b\n * @param c\n * @returns\n */\n\nexport function sum(a: Rect, b: RectPositioned | Rect | number, c?: number): Rect {\n  // @ts-ignore\n  return applyMerge(sumOp, a, b, c);\n}\n\n/**\n * Sums x,y,width,height of a+b.\n * ```js\n * sumOffset({x:100,y:100,width:100,height:100}, {x:10, y:20, width: 30, height: 40});\n * // Yields: {x: 110, y: 120, width: 130, height: 140 }\n * ```\n * If either `a` or `b` are missing x & y, 0 is used\n * @param a \n * @param b \n * @returns \n */\nexport function sumOffset(a: RectPositioned | Rect, b: RectPositioned | Rect): RectPositioned {\n  let x = 0;\n  let y = 0;\n  if (isPositioned(a)) {\n    x = a.x;\n    y = a.y;\n  }\n  let xB = 0;\n  let yB = 0;\n  if (isPositioned(b)) {\n    xB = b.x;\n    yB = b.y;\n  }\n  return Object.freeze({\n    ...a,\n    x: x + xB,\n    y: y + yB,\n    width: a.width + b.width,\n    height: a.height + b.height\n  })\n}","import { isPositioned, isRect } from \"./guard.js\";\nimport type { Rect, RectArray, RectPositioned, RectPositionedArray } from \"./rect-types.js\";\n\n/**\n * Converts a rectangle to an array of numbers. See {@link fromNumbers} for the opposite conversion.\n *\n * ```js\n *\n * const r1 = Rects.toArray({ x: 10, y:20, width: 100, height: 200 });\n * // [10, 20, 100, 200]\n * const r2 = Rects.toArray({ width: 100, height: 200 });\n * // [100, 200]\n * ```\n * @param rect\n * @see fromNumbers\n */\nexport function toArray(rect: Rect): RectArray;\n\n/**\n * Converts a rectangle to an array of numbers. See {@link fromNumbers} for the opposite conversion.\n *\n * ```js\n *\n * const r1 = Rects.toArray({ x: 10, y:20, width: 100, height: 200 });\n * // [10, 20, 100, 200]\n * const r2 = Rects.toArray({ width: 100, height: 200 });\n * // [100, 200]\n * ```\n * @param rect\n * @see fromNumbers\n */\nexport function toArray(rect: RectPositioned): RectPositionedArray;\n\n/**\n * Converts a rectangle to an array of numbers. See {@link fromNumbers} for the opposite conversion.\n *\n * ```js\n * const r1 = Rects.toArray({ x: 10, y:20, width: 100, height: 200 });\n * // [10, 20, 100, 200]\n * const r2 = Rects.toArray({ width: 100, height: 200 });\n * // [100, 200]\n * ```\n * @param rect\n * @see fromNumbers\n */\n\nexport function toArray(\n  rect: Rect | RectPositioned\n): RectArray | RectPositionedArray {\n  if (isPositioned(rect)) {\n    return [ rect.x, rect.y, rect.width, rect.height ];\n  } else if (isRect(rect)) {\n    return [ rect.width, rect.height ];\n  } else {\n    throw new Error(\n      `Param 'rect' is not a rectangle. Got: ${ JSON.stringify(rect) }`\n    );\n  }\n}\n","export * from './area.js';\nexport * from './apply.js';\nexport * from './cardinal.js';\nexport * from './center-origin.js';\nexport * from './center.js';\nexport * from './corners.js';\nexport * from './distance.js';\nexport * from './divide.js';\nexport * from './edges.js';\nexport * from './empty.js';\nexport * from './encompass.js';\nexport * from './from-center.js';\nexport * from './from-element.js';\nexport * from './from-numbers.js';\nexport * from './from-top-left.js';\nexport * from './get-rect-positionedparameter.js';\nexport * from './guard.js';\nexport * from './Intersects.js';\nexport * from './is-equal.js';\nexport * from './lengths.js';\nexport * from './max.js';\nexport * from './multiply.js';\nexport * from './nearest.js';\nexport * from './placeholder.js';\nexport * from './perimeter.js';\nexport * from './normalise-by-rect.js';\nexport * from './random.js';\nexport * from './subtract.js';\nexport * from './sum.js';\nexport * from './to-array.js';\nexport type * from './rect-types.js';","import type { Point } from \"../point/point-type.js\";\nimport type { Triangle } from \"./triangle-type.js\";\nimport { project as PointsProject } from \"../point/project.js\";\n// import { guard as PointGuard } from \"../point/Guard.js\";\n// import { throwNumberTest } from \"@ixfx/guards\";\n// import { piPi } from \"../pi.js\";\n\n/**\n * A triangle consisting of three empty points (Points.Empty)\n */\n\nexport const Empty = Object.freeze({\n  a: { x: 0, y: 0 },\n  b: { x: 0, y: 0 },\n  c: { x: 0, y: 0 },\n});\n\n/**\n * A triangle consisting of three placeholder points (Points.Placeholder)\n */\n\nexport const Placeholder = Object.freeze({\n  a: { x: Number.NaN, y: Number.NaN },\n  b: { x: Number.NaN, y: Number.NaN },\n  c: { x: Number.NaN, y: Number.NaN },\n});\n\n\n\n/**\n * Returns a triangle anchored at `origin` with a given `length` and `angleRadian`.\n * The origin will be point `b` of the triangle, and the angle will be the angle for b.\n * @param origin Origin\n * @param length Length\n * @param angleRadian Angle\n * @returns\n */\nexport const equilateralFromVertex = (\n  origin?: Point,\n  length = 10,\n  angleRadian: number = Math.PI / 2\n): Triangle => {\n  if (!origin) origin = Object.freeze({ x: 0, y: 0 })\n\n  const a = PointsProject(origin, length, Math.PI - -angleRadian / 2);\n  const c = PointsProject(origin, length, Math.PI - angleRadian / 2);\n  return { a, b: origin, c };\n};","import type { Point } from \"../point/point-type.js\";\nimport { equilateralFromVertex } from \"../triangle/create.js\";\nimport type { Triangle } from \"../triangle/triangle-type.js\";\nimport { corners as RectsCorners } from '../rect/corners.js';\nimport { fromTopLeft as RectsFromTopLeft } from '../rect/from-top-left.js';\nimport { rotate as PointsRotate } from \"../point/rotate.js\";\nexport type ArrowOpts = {\n  readonly arrowSize?: number;\n  readonly tailLength?: number;\n  readonly tailThickness?: number;\n  readonly angleRadian?: number;\n};\n\n\n/**\n * Returns the points forming an arrow.\n *\n * @example Create an arrow anchored by its tip at 100,100\n * ```js\n * const opts = {\n *  tailLength: 10,\n *  arrowSize: 20,\n *  tailThickness: 5,\n *  angleRadian: degreeToRadian(45)\n * }\n * const arrow = Shapes.arrow({x:100, y:100}, `tip`, opts); // Yields an array of points\n *\n * // Eg: draw points\n * Drawing.connectedPoints(ctx, arrow, {strokeStyle: `red`, loop: true});\n * ```\n *\n * @param origin Origin of arrow\n * @param from Does origin describe the tip, tail or middle?\n * @param opts Options for arrow\n * @returns\n */\nexport const arrow = (\n  origin: Point,\n  from: `tip` | `tail` | `middle`,\n  opts: ArrowOpts = {}\n): ReadonlyArray<Point> => {\n  const tailLength = opts.tailLength ?? 10;\n  const tailThickness = opts.tailThickness ?? Math.max(tailLength / 5, 5);\n  const angleRadian = opts.angleRadian ?? 0;\n  const arrowSize = opts.arrowSize ?? Math.max(tailLength / 5, 15);\n\n  const triAngle = Math.PI / 2;\n\n  let tri: Triangle;\n  let tailPoints: ReadonlyArray<Point>;\n\n  if (from === `tip`) {\n    tri = equilateralFromVertex(origin, arrowSize, triAngle);\n    tailPoints = RectsCorners(\n      RectsFromTopLeft(\n        { x: tri.a.x - tailLength, y: origin.y - tailThickness / 2 },\n        tailLength,\n        tailThickness\n      )\n    );\n  } else if (from === `middle`) {\n    const midX = tailLength + arrowSize / 2;\n    const midY = tailThickness / 2;\n    tri = equilateralFromVertex(\n      {\n        x: origin.x + arrowSize * 1.2,\n        y: origin.y,\n      },\n      arrowSize,\n      triAngle\n    );\n\n    tailPoints = RectsCorners(\n      RectsFromTopLeft(\n        { x: origin.x - midX, y: origin.y - midY },\n        tailLength + arrowSize,\n        tailThickness\n      )\n    );\n  } else {\n    //const midY = origin.y - tailThickness/2;\n    tailPoints = RectsCorners(\n      RectsFromTopLeft(\n        { x: origin.x, y: origin.y - tailThickness / 2 },\n        tailLength,\n        tailThickness\n      )\n    );\n    tri = equilateralFromVertex(\n      { x: origin.x + tailLength + arrowSize * 0.7, y: origin.y },\n      arrowSize,\n      triAngle\n    );\n  }\n\n  const arrow = PointsRotate(\n    [\n      tailPoints[ 0 ],\n      tailPoints[ 1 ],\n      tri.a,\n      tri.b,\n      tri.c,\n      tailPoints[ 2 ],\n      tailPoints[ 3 ],\n    ],\n    angleRadian,\n    origin\n  );\n\n  return arrow;\n};","import type { Triangle } from \"./triangle-type.js\";\nimport { isPoint, guard as PointsGuard, isPlaceholder as PointsIsPlaceholder, isEmpty as PointsIsEmpty } from '../point/guard.js'\nimport { isEqual as PointsIsEqual} from \"../point/is-equal.js\";\n\n/**\n * Throws an exception if the triangle is invalid\n * @param t\n * @param name\n */\nexport const guard = (t: Triangle, name = `t`) => {\n  if (t === undefined) throw new Error(`{$name} undefined`);\n  PointsGuard(t.a, name + `.a`);\n  PointsGuard(t.b, name + `.b`);\n  PointsGuard(t.c, name + `.c`);\n};\n\n/**\n * Returns true if the parameter appears to be a valid triangle\n * @param p\n * @returns\n */\nexport const isTriangle = (p: unknown): p is Triangle => {\n  if (p === undefined) return false;\n  const tri = p as Triangle;\n  if (!isPoint(tri.a)) return false;\n  if (!isPoint(tri.b)) return false;\n  if (!isPoint(tri.c)) return false;\n  return true;\n};\n\n\n/**\n * Returns true if triangle is empty\n * @param t\n * @returns\n */\nexport const isEmpty = (t: Triangle): boolean =>\n  PointsIsEmpty(t.a) && PointsIsEmpty(t.b) && PointsIsEmpty(t.c);\n\n/**\n * Returns true if triangle is a placeholder\n * @param t\n * @returns\n */\nexport const isPlaceholder = (t: Triangle): boolean =>\n  PointsIsPlaceholder(t.a) &&\n  PointsIsPlaceholder(t.b) &&\n  PointsIsPlaceholder(t.c);\n\n/**\n * Returns true if the two parameters have equal values\n * @param a\n * @param b\n * @returns\n */\nexport const isEqual = (a: Triangle, b: Triangle): boolean =>\n  PointsIsEqual(a.a, b.a) &&\n  PointsIsEqual(a.b, b.b) &&\n  PointsIsEqual(a.c, b.c);","import type { Point } from \"../point/point-type.js\";\nimport { guard } from \"./guard.js\";\nimport type { Triangle } from \"./triangle-type.js\";\nimport { reduce as PointsReduce } from '../point/index.js';\n\n/**\n * Returns simple centroid of triangle\n * @param t\n * @returns\n */\nexport const centroid = (t: Triangle): Point => {\n  guard(t);\n  const total = PointsReduce(\n    [ t.a, t.b, t.c ],\n    (p: Point, accumulator: Point) => ({\n      x: p.x + accumulator.x,\n      y: p.y + accumulator.y,\n    })\n  );\n  const div = {\n    x: total.x / 3,\n    y: total.y / 3,\n  };\n  return div;\n};","import type { RandomSource } from \"@ixfx/random\";\nimport type { ShapePositioned } from \"./shape-type.js\";\nimport { isCircle, isCirclePositioned } from \"../circle/guard.js\";\nimport { isRect, isRectPositioned } from \"../rect/guard.js\";\nimport { randomPoint as circleRandomPoint } from '../circle/random.js';\nimport { randomPoint as rectRandomPoint } from '../rect/random.js';\nimport type { Point } from \"../point/point-type.js\";\nimport type { Rect } from \"../rect/rect-types.js\";\nimport type { Triangle } from \"../triangle/triangle-type.js\";\nimport type { Circle } from \"../circle/circle-type.js\";\nimport { center as circleCenter } from '../circle/center.js';\nimport { isTriangle } from \"../triangle/guard.js\";\nimport { centroid as triangleCentroid } from \"../triangle/centroid.js\";\nimport { center as rectCenter } from '../rect/center.js';\n\nexport type ShapeRandomPointOpts = {\n  readonly randomSource: RandomSource;\n};\n\n/**\n * Returns a random point within a shape.\n * `shape` can be {@link Circles.CirclePositioned} or {@link Rects.RectPositioned}\n * @param shape \n * @param opts \n * @returns \n */\nexport const randomPoint = (\n  shape: ShapePositioned,\n  opts: Partial<ShapeRandomPointOpts> = {}\n): Point => {\n  if (isCirclePositioned(shape)) {\n    return circleRandomPoint(shape, opts);\n  } else if (isRectPositioned(shape)) {\n    return rectRandomPoint(shape, opts);\n  }\n  throw new Error(`Unknown shape. Only CirclePositioned and RectPositioned are supported.`);\n};\n\n// export type Shape = {\n//   intersects(x:Point|Shape):ContainsResult\n//   readonly kind:`circular`\n\n// }\n\n/**\n * Returns the center of a shape\n * Shape can be: rectangle, triangle, circle\n * @param shape\n * @returns\n */\nexport const center = (\n  shape?: Rect | Triangle | Circle\n): Point => {\n  if (shape === undefined) {\n    return Object.freeze({ x: 0.5, y: 0.5 });\n  } else if (isRect(shape)) {\n    return rectCenter(shape);\n  } else if (isTriangle(shape)) {\n    return triangleCentroid(shape);\n  } else if (isCircle(shape)) {\n    return circleCenter(shape);\n  } else {\n    throw new Error(`Unknown shape: ${ JSON.stringify(shape) }`);\n  }\n};\n","import { isCirclePositioned } from \"../circle/guard.js\";\nimport type { Point } from \"../point/point-type.js\";\nimport { isRectPositioned } from \"../rect/guard.js\";\nimport type { ShapePositioned } from \"./shape-type.js\";\nimport { isIntersecting as CirclesIsIntersecting } from '../circle/intersecting.js';\nimport { isIntersecting as RectsIsIntersecting } from '../rect/Intersects.js';\n\n/**\n * Returns the intersection result between a and b.\n * `a` can be a {@link Circles.CirclePositioned} or {@link Rects.RectPositioned}\n * `b` can be as above or a {@link Point}.\n * @param a\n * @param b\n */\nexport const isIntersecting = (\n  a: ShapePositioned,\n  b: ShapePositioned | Point\n): boolean => {\n  if (isCirclePositioned(a)) {\n    return CirclesIsIntersecting(a, b);\n  } else if (isRectPositioned(a)) {\n    return RectsIsIntersecting(a, b);\n  }\n  throw new Error(\n    `a or b are unknown shapes. a: ${ JSON.stringify(a) } b: ${ JSON.stringify(b) }`\n  );\n};","import { integerTest, resultThrow } from \"@ixfx/guards\";\nimport { toCartesian } from \"../polar/conversions.js\";\nimport { Empty as PointEmpty } from \"../point/empty.js\";\nimport type { Point } from \"../point/point-type.js\";\n/**\n * Generates a starburst shape, returning an array of points. By default, initial point is top and horizontally-centred.\n *\n * ```\n * // Generate a starburst with four spikes\n * const pts = starburst(4, 100, 200);\n * ```\n *\n * `points` of two produces a lozenge shape.\n * `points` of three produces a triangle shape.\n * `points` of five is the familiar 'star' shape.\n *\n * Note that the path will need to be closed back to the first point to enclose the shape.\n *\n * @example Create starburst and draw it. Note use of 'loop' flag to close the path\n * ```\n * const points = starburst(4, 100, 200);\n * Drawing.connectedPoints(ctx, pts, {loop: true, fillStyle: `orange`, strokeStyle: `red`});\n * ```\n *\n * Options:\n * * initialAngleRadian: angle offset to begin from. This overrides the `-Math.PI/2` default.\n *\n * @param points Number of points in the starburst. Defaults to five, which produces a typical star\n * @param innerRadius Inner radius. A proportionally smaller inner radius makes for sharper spikes. If unspecified, 50% of the outer radius is used.\n * @param outerRadius Outer radius. Maximum radius of a spike to origin\n * @param opts Options\n * @param origin Origin, or `{ x:0, y:0 }` by default.\n */\nexport const starburst = (\n  outerRadius: number,\n  points = 5,\n  innerRadius?: number,\n  origin: Point = PointEmpty,\n  opts?: { readonly initialAngleRadian?: number }\n): readonly Point[] => {\n  resultThrow(integerTest(points, `positive`, `points`));\n  const angle = (Math.PI * 2) / points;\n  const angleHalf = angle / 2;\n\n  const initialAngle = opts?.initialAngleRadian ?? -Math.PI / 2;\n  if (innerRadius === undefined) innerRadius = outerRadius / 2;\n\n  let a = initialAngle;\n  const pts: Point[] = [];\n\n  for (let index = 0; index < points; index++) {\n    const peak = toCartesian(outerRadius, a, origin);\n    const left = toCartesian(innerRadius, a - angleHalf, origin);\n    const right = toCartesian(innerRadius, a + angleHalf, origin);\n\n    pts.push(left, peak);\n    if (index + 1 < points) pts.push(right);\n    a += angle;\n  }\n  return pts;\n};\n","export type * from './shape-type.js';\nexport * from './arrow.js';\nexport * from './etc.js';\nexport * from './is-intersecting.js';\nexport * from './starburst.js';","import type { CirclePositioned } from \"./circle/circle-type.js\";\nimport type { Path } from \"./path/path-type.js\";\nimport type { Point } from \"./point/point-type.js\";\nimport { joinPointsToLines } from './line/join-points-to-lines.js';\nimport { toPath } from './line/to-path.js';\nimport { distance as PointsDistance } from \"./point/distance.js\";\nimport { sortByNumericProperty } from \"@ixfx/arrays\";\n\nexport type Waypoint = CirclePositioned;\n\nexport type WaypointOpts = {\n  readonly maxDistanceFromLine: number;\n  readonly enforceOrder: boolean;\n};\n\n/**\n * Create from set of points, connected in order starting at array position 0.\n * @param waypoints \n * @param opts \n * @returns \n */\nexport const fromPoints = (\n  waypoints: readonly Point[],\n  opts: Partial<WaypointOpts> = {}\n) => {\n  const lines = joinPointsToLines(...waypoints);\n  return init(\n    lines.map((l) => toPath(l)),\n    opts\n  );\n};\n\n/**\n * Result \n */\nexport type WaypointResult = {\n  /**\n   * Path being compared against\n   */\n  path: Path\n  /**\n   * Index of this path in original `paths` array\n   */\n  index: number\n  /**\n   * Nearest point on path. See also {@link distance}\n   */\n  nearest: Point\n  /**\n   * Closest distance to path. See also {@link nearest}\n   */\n  distance: number\n  /**\n   * Rank of this result, 0 being highest.\n   */\n  rank: number\n  /**\n   * Relative position on this path segment\n   * 0 being start, 0.5 middle and so on.\n   */\n  positionRelative: number\n}\n\n/**\n * Given point `pt`, returns a list of {@link WaypointResult}, comparing\n * this point to a set of paths.\n * ```js\n * // Init once with a set of paths\n * const w = init(paths);\n * // Now call with a point to get results\n * const results = w({ x: 10, y: 20 });\n * ```\n */\nexport type Waypoints = (pt: Point) => WaypointResult[]\n\n/**\n * Initialise\n * \n * Options:\n * * maxDistanceFromLine: Distances greater than this are not matched. Default 0.1\n * @param paths \n * @param opts \n * @returns \n */\nexport const init = (paths: readonly Path[], opts: Partial<WaypointOpts> = {}): Waypoints => {\n  //const enforceOrder = opts.enforceOrder ?? true;\n  const maxDistanceFromLine = opts.maxDistanceFromLine ?? 0.1;\n\n  const checkUnordered = (pt: Point): WaypointResult[] => {\n    const results = paths.map((p, index) => {\n      const nearest = p.nearest(pt);\n      const distance = PointsDistance(pt, nearest);\n\n      // Relative position of nearest point on this path segment\n      const positionRelative = p.relativePosition(nearest, maxDistanceFromLine);;\n      return { positionRelative, path: p, index, nearest, distance, rank: Number.MAX_SAFE_INTEGER };\n    });\n\n    const filtered = results.filter((v) => v.distance <= maxDistanceFromLine);\n    const sorted = sortByNumericProperty(filtered, `distance`);\n\n    // Assign ranks\n\n    for (let rank = 0; rank < sorted.length; rank++) {\n      sorted[ rank ].rank = rank;\n    }\n    return sorted;\n  };\n\n  // const checkUnordered = (p:Point) => {\n  //   // Calculate progress of pointer between all the waypoint lines\n  //   const progresses = lines.map((line, index) => (\n  //     {\n  //       index,\n  //       score: Points.progressBetween(p, line.a, line.b)\n  //     }));\n  //   // Sort by closest\n  //   const sorted = Arrays.sortByNumericProperty(progresses, `score`);\n  // };\n  return checkUnordered;\n};\n","import { sortByNumericProperty } from \"@ixfx/arrays\";\nimport type { RandomSource } from \"@ixfx/random\";\nimport { randomPoint as ShapesRandomPoint, type ShapePositioned } from \"./shape/index.js\";\nimport { isIntersecting as CirclesIsIntersecting } from \"./circle/intersecting.js\";\nimport type { Circle, CirclePositioned } from \"./circle/circle-type.js\";\nimport type { Point } from \"./point/point-type.js\";\n\nexport type RandomOpts = {\n  readonly attempts?: number\n  readonly randomSource?: RandomSource\n}\n/**\n * Naive randomised circle packing.\n * [Algorithm by Taylor Hobbs](https://tylerxhobbs.com/essays/2016/a-randomized-approach-to-cicle-packing)\n */\nexport const random = (circles: readonly Circle[], container: ShapePositioned, opts: RandomOpts = {}) => {\n  if (!Array.isArray(circles)) throw new Error(`Parameter 'circles' is not an array`);\n  const attempts = opts.attempts ?? 2000;\n\n  const sorted = sortByNumericProperty(circles, `radius`);\n  const positionedCircles: CirclePositioned[] = [];\n\n  const willHit = (b: Point, radius: number) => positionedCircles.some(v => CirclesIsIntersecting(v, b, radius));\n\n  while (sorted.length > 0) {\n    //eslint-disable-next-line functional/immutable-data\n    const circle = sorted.pop();\n    if (!circle) break;\n\n    const randomPointOpts = { ...opts, margin: { x: circle.radius, y: circle.radius } };\n\n    //eslint-disable-next-line functional/no-let\n    for (let index = 0; index < attempts; index++) {\n      const position = ShapesRandomPoint(container, randomPointOpts);\n      if (!willHit(position, circle.radius)) {\n        //eslint-disable-next-line functional/immutable-data\n        positionedCircles.push(Object.freeze({ ...circle, ...position }));\n        break;\n      }\n    }\n  }\n\n  return positionedCircles;\n};","export * as CirclePacking from './circle-packing.js';","\nimport type { Point } from './point/point-type.js';\nimport { degreeToRadian } from './angles.js';\nimport type { Path } from './path/index.js';\n\n/**\n * An ellipse\n */\nexport type Ellipse = {\n  readonly radiusX: number\n  readonly radiusY: number\n  /**\n   * Rotation, in radians\n   */\n  readonly rotation?: number\n  readonly startAngle?: number\n  readonly endAngle?: number\n}\n\n/**\n * A {@link Ellipse} with position\n */\nexport type EllipsePositioned = Point & Ellipse\n\n\nexport const fromDegrees = (radiusX: number, radiusY: number, rotationDeg = 0, startAngleDeg = 0, endAngleDeg = 360): Ellipse => ({\n  radiusX, radiusY,\n  rotation: degreeToRadian(rotationDeg),\n  startAngle: degreeToRadian(startAngleDeg),\n  endAngle: degreeToRadian(endAngleDeg)\n});\n\nexport type EllipticalPath = Ellipse & Path & {\n  readonly kind: `elliptical`\n};","import type { Point } from \"./point/point-type.js\";\nimport { distance } from \"./point/distance.js\";\n/**\n * Simplifies a curve by dropping points based on shortest distance.\n * \n * Values of `epsilon` approaching zero keep more of the original points.\n * Making `epsilon` larger will filter out more points, making the curve more lossy and jagged.\n * \n * ```js\n * // Source set of points that define the curve\n * const pts = [ {x:100,y:200}, {x:10, y:20}, ... ];\n * \n * const simplified = rdpShortestDistance(pts, 3); // Yields an array of points\n * ```\n * It is an implementation of the [Ramer Douglas Peucker algorithm](https://en.wikipedia.org/wiki/Ramer%E2%80%93Douglas%E2%80%93Peucker_algorithm)\n * by Marius Karthaus. Try the online playground: https://karthaus.nl/rdp/\n * \n * @param points \n * @param epsilon \n * @returns \n */\nexport const rdpShortestDistance = (points: Array<Point>, epsilon = 0.1): Array<Point> => {\n  const firstPoint = points[ 0 ];\n  // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n  const lastPoint = points.at(-1)!;\n  if (points.length < 3) {\n    return points;\n  }\n  let index = -1;\n  let distribution = 0;\n  for (let index_ = 1; index_ < points.length - 1; index_++) {\n    const cDistribution = distanceFromPointToLine(points[ index_ ], firstPoint, lastPoint);\n\n    if (cDistribution > distribution) {\n      distribution = cDistribution;\n      index = index_;\n    }\n  }\n  if (distribution > epsilon) {\n    // iterate\n    const l1 = points.slice(0, index + 1);\n    const l2 = points.slice(index);\n    const r1 = rdpShortestDistance(l1, epsilon);\n    const r2 = rdpShortestDistance(l2, epsilon);\n    // concat r2 to r1 minus the end/startpoint that will be the same\n    const rs = [ ...r1.slice(0, - 1), ...r2 ];//concat(r2);\n    return rs;\n  } else {\n    return [ firstPoint, lastPoint ];\n  }\n}\n\n/**\n * Simplifies a curve by dropping points based on perpendicular distance\n * \n * Values of `epsilon` approaching zero keep more of the original points.\n * Making `epsilon` larger will filter out more points, making the curve more lossy and jagged.\n * \n * ```js\n * // Source set of points that define the curve\n * const pts = [ {x:100,y:200}, {x:10, y:20}, ... ];\n * \n * const simplified = rdpShortestDistance(pts, 3); // Yields an array of points\n * ```\n * It is an implementation of the [Ramer Douglas Peucker algorithm](https://en.wikipedia.org/wiki/Ramer%E2%80%93Douglas%E2%80%93Peucker_algorithm)\n * by Marius Karthaus. Try the online playground: https://karthaus.nl/rdp/\n * \n * @param points \n * @param epsilon \n * @returns \n */\nexport const rdpPerpendicularDistance = (points: Array<Point>, epsilon = 0.1): Array<Point> => {\n  const firstPoint = points[ 0 ];\n  // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n  const lastPoint = points.at(-1)!;\n  if (points.length < 3) {\n    return points;\n  }\n  let index = -1;\n  let distribution = 0;\n  for (let index_ = 1; index_ < points.length - 1; index_++) {\n    const cDistribution = findPerpendicularDistance(points[ index_ ], firstPoint, lastPoint);\n    if (cDistribution > distribution) {\n      distribution = cDistribution;\n      index = index_;\n    }\n  }\n  if (distribution > epsilon) {\n    // iterate\n    const l1 = points.slice(0, index + 1);\n    const l2 = points.slice(index);\n    const r1 = rdpPerpendicularDistance(l1, epsilon);\n    const r2 = rdpPerpendicularDistance(l2, epsilon);\n    // concat r2 to r1 minus the end/startpoint that will be the same\n    const rs = [ ...r1.slice(0, - 1), ...r2 ];\n    return rs;\n  } else {\n    return [ firstPoint, lastPoint ];\n  }\n}\n\n\nfunction findPerpendicularDistance(p: Point, p1: Point, p2: Point) {\n  // if start and end point are on the same x the distance is the difference in X.\n  let result;\n  let slope;\n  let intercept;\n  if (p1.x == p2.x) {\n    result = Math.abs(p.x - p1.x);\n  } else {\n    slope = (p2.y - p1.y) / (p2.x - p1.x);\n    intercept = p1.y - (slope * p1.x);\n    result = Math.abs(slope * p.x - p.y + intercept) / Math.sqrt(Math.pow(slope, 2) + 1);\n  }\n\n  return result;\n}\n\n\nconst distanceFromPointToLine = (p: Point, index: Point, index_: Point) => {\n  const lineLength = distance(index, index_);//First, we need the length of the line segment.\n  if (lineLength == 0) {\t//if it's 0, the line is actually just a point.\n    return distance(p, index);\n  }\n  const t = ((p.x - index.x) * (index_.x - index.x) + (p.y - index.y) * (index_.y - index.y)) / lineLength;\n\n  //t is very important. t is a number that essentially compares the individual coordinates\n  //distances between the point and each point on the line.\n\n  if (t < 0) {\t//if t is less than 0, the point is behind i, and closest to i.\n    return distance(p, index);\n  }\t//if greater than 1, it's closest to j.\n  if (t > 1) {\n    return distance(p, index_);\n  }\n  return distance(p, { x: index.x + t * (index_.x - index.x), y: index.y + t * (index_.y - index.y) });\n}\n\n\n","import { type TraversableTree } from '@ixfx/collections';\nimport * as Shapes from './shape/index.js';\nimport type { Point } from './point/point-type.js';\nimport { fromTopLeft as RectsFromTopLeft } from './rect/from-top-left.js';\nimport { intersectsPoint as RectsIntersectsPoint } from './rect/Intersects.js';\nimport { fromNumbers as PointsFromNumbers } from './point/from.js';\nimport type { ShapePositioned } from './shape/index.js';\nimport type { RectPositioned } from './rect/rect-types.js';\n/**\n * Options for quad tree\n */\nexport type QuadTreeOpts = {\n  /**\n   * Maximum items per node\n   */\n  readonly maxItems: number;\n  /**\n   * Maximum level of sub-division\n   */\n  readonly maxLevels: number;\n};\n\n/**\n * Direction\n */\nexport enum Direction {\n  Nw,\n  Ne,\n  Sw,\n  Se,\n}\n\n/**\n * A Point or ShapePositioned\n */\nexport type QuadTreeItem = Point | ShapePositioned;\n\n/**\n * Creates a QuadTreeNode\n * @param bounds Bounds of region\n * @param initialData Initial items to place in quad tree\n * @param opts Options\n * @returns New quad tree\n */\nexport const quadTree = (bounds: RectPositioned, initialData: readonly QuadTreeItem[] = [], opts: Partial<QuadTreeOpts> = {}): QuadTreeNode => {\n  const o: QuadTreeOpts = {\n    maxItems: opts.maxItems ?? 4,\n    maxLevels: opts.maxLevels ?? 4\n  };\n\n  const n = new QuadTreeNode(undefined, bounds, 0, o);\n  for (const d of initialData) {\n    n.add(d);\n  }\n  return n;\n};\n\n/**\n * QuadTreeNode. The values of the node is an array of {@link QuadTreeItem}.\n *\n * To create, you probably want the {@link quadTree} function.\n * \n */\nexport class QuadTreeNode implements TraversableTree<QuadTreeItem[]> {\n  #items: QuadTreeItem[] = [];\n  #children: QuadTreeNode[] = [];\n  #parent: QuadTreeNode | undefined;\n  /**\n   * Constructor\n   * @param boundary\n   * @param level\n   * @param opts\n   */\n  constructor(\n    parent: QuadTreeNode | undefined,\n    readonly boundary: RectPositioned,\n    readonly level: number,\n    readonly opts: QuadTreeOpts\n  ) {\n    this.#parent = parent;\n  }\n\n  getLengthChildren(): number {\n    return this.#children.length;\n  }\n\n  *parents(): IterableIterator<QuadTreeNode> {\n    //eslint-disable-next-line functional/no-let,@typescript-eslint/no-this-alias\n    let n: QuadTreeNode | undefined = this;\n    while (n.#parent !== undefined) {\n      yield n.#parent;\n      n = n.#parent;\n    }\n  }\n\n  getParent() {\n    return this.#parent;\n  }\n\n  /**\n   * Iterates over immediate children\n   */\n  *children(): IterableIterator<QuadTreeNode> {\n    for (const c of this.#children) {\n      yield c;\n    }\n  }\n\n  /**\n   * Array of QuadTreeItem\n   * @returns\n   */\n  getValue() {\n    return this.#items;\n  }\n\n  getIdentity() {\n    return this;\n  }\n  /**\n   * Get a descendant node in a given direction\n   * @param d\n   * @returns\n   */\n  direction(d: Direction): QuadTreeNode | undefined {\n    return this.#children[ d ] as QuadTreeNode | undefined;\n  }\n\n  /**\n   * Add an item to the quadtree\n   * @param p\n   * @returns False if item is outside of boundary, True if item was added\n   */\n  add(p: QuadTreeItem): boolean {\n    if (!Shapes.isIntersecting(this.boundary, p)) return false;\n\n    if (this.#children.length > 0) {\n      for (const d of this.#children) (d).add(p);\n      return true;\n    }\n\n    this.#items.push(p);\n\n    if (\n      this.#items.length > this.opts.maxItems &&\n      this.level < this.opts.maxLevels\n    ) {\n      if (this.#children.length === 0) {\n        this.#subdivide();\n      }\n\n      // Add to child\n      for (const item of this.#items) {\n        for (const d of this.#children) (d).add(item);\n      }\n      //this.descendants.forEach(d => (d as QuadTreeNode).add(p));\n      this.#items = [];\n    }\n    return true;\n  }\n\n  /**\n   * Returns true if point is inside node's boundary\n   * @param p\n   * @returns\n   */\n  couldHold(p: Point) {\n    return RectsIntersectsPoint(this.boundary, p);\n  }\n\n  #subdivide() {\n    const w = this.boundary.width / 2;\n    const h = this.boundary.height / 2;\n    const x = this.boundary.x;\n    const y = this.boundary.y;\n\n    // top-left corners of each of the four new sections\n    const coords = PointsFromNumbers(x + w, y, x, y, x, y + h, x + w, y + h);\n    const rects = coords.map((p) => RectsFromTopLeft(p, w, h));\n    // rects.forEach((r, index) => {\n    //   this.descendants[index] = new QuadTreeNode(r, this.level + 1, this.opts);\n    // });\n    this.#children = rects.map(\n      (r) => new QuadTreeNode(this, r, this.level + 1, this.opts)\n    );\n  }\n}\n","\nimport type { Point } from './point/point-type.js';\nimport type { Rect } from './rect/index.js';\nimport { isPoint } from './point/index.js';\nimport { isRect } from './rect/guard.js';\nimport { Placeholder as PlaceholderRect } from './rect/placeholder.js';\n\n/**\n * A scale function that takes an input value to scale.\n * Input can be in the form of `{ x, y }` or two number parameters.\n *\n * ```js\n * scale(10, 20);\n * scale({ x:10, y:20 });\n * ```\n *\n * Output range can be specified as a `{ width, height }` or two number parameters.\n * If omitted, the default range\n * is used.\n *\n * ```js\n * // Scale 10,20 with range w:800 h:600\n * scale(10, 20, 800, 600);\n * scale({x:10, y:20}, 800, 600);\n * scale({x:10, y:20}, {width: 800, height: 600});\n * ```\n */\nexport type Scaler = (\n  a: number | Point,\n  b?: number | Rect,\n  c?: number | Rect,\n  d?: number\n) => Point;\n\n/**\n * A scaler than can convert to a from an output range\n */\nexport type ScalerCombined = {\n  /**\n   * Relative to absolute coordinates\n   */\n  readonly abs: Scaler;\n  /**\n   * Absolute to relative coordintes\n   */\n  readonly rel: Scaler;\n\n  readonly width: number;\n\n  readonly height: number;\n\n  computeScale(): Point\n};\n\nexport type ScaleBy = `both` | `min` | `max` | `width` | `height`;\n\n/**\n * Returns a set of scaler functions, to convert to and from ranges.\n *\n * ```js\n * const scaler = Scaler.scaler(`both`, {width:window.innerWidth, height:window.innerHeight});\n * // Assuming screen of 800x400...\n * scaler.abs(400,200);          // Yields { x:0.5, y:0.5 }\n * scaler.abs({ x:400, y:200 }); // Yields { x:0.5, y:0.5 }\n *\n * scaler.rel(0.5, 0.5);         // Yields: { x:400, y:200 }\n * scaler.rel({ x:0.5, y:0.5 }); // Yields: { x:400, y:200 }\n * ```\n *\n * If no default range is provided, it must be given each time the scale function is used.\n *\n * ```js\n * const scaler = Scaler.scaler(`both`);\n *\n * scaler.abs(400, 200, 800, 400);\n * scaler.abs(400, 200, { width: 800, height: 400 });\n * scaler.abs({ x:400, y: 200}, { width: 800, height: 400 });\n * scaler.abs({ x:400, y: 200}, 800, 400);\n * // All are the same, yielding { x:0.5, y:0.5 }\n *\n * scaler.abs(400, 200); // Throws an exception because there is no scale\n * ```\n * @param scaleBy Dimension to scale by\n * @param defaultRect Default range\n * @returns\n */\nexport const scaler = (\n  scaleBy: ScaleBy = `both`,\n  defaultRect?: Rect\n): ScalerCombined => {\n  const defaultBounds = defaultRect ?? PlaceholderRect;\n\n  let sw = 1;\n  let sh = 1;\n  let s = { x: 1, y: 1 };\n\n  const computeScale = () => {\n    switch (scaleBy) {\n      case `height`: {\n        return { x: sh, y: sh };\n      }\n      case `width`: {\n        return { x: sw, y: sw };\n      }\n      case `min`: {\n        return { x: Math.min(sw, sh), y: Math.min(sw, sh) };\n      }\n      case `max`: {\n        return { x: Math.max(sw, sh), y: Math.max(sw, sh) };\n      }\n      default: {\n        return { x: sw, y: sh };\n      }\n    }\n  };\n\n  const normalise = (\n    a: number | Point,\n    b?: number | Rect,\n    c?: number | Rect,\n    d?: number\n  ): [ x: number, y: number, w: number, h: number ] => {\n    let inX = Number.NaN;\n    let inY = Number.NaN;\n    let outW = defaultBounds.width;\n    let outH = defaultBounds.height;\n\n    if (typeof a === `number`) {\n      inX = a;\n      if (typeof b === `number`) {\n        inY = b;\n        if (c === undefined) return [ inX, inY, outW, outH ];\n        if (isRect(c)) {\n          outW = c.width;\n          outH = c.height;\n        } else if (typeof c === `number`) {\n          outW = c;\n          if (typeof d === `number`) {\n            outH = d;\n          } else {\n            throw new TypeError(`Missing final height value`);\n          }\n        } else throw new Error(`Missing valid output range`);\n      } else if (isRect(b)) {\n        outW = b.width;\n        outH = b.height;\n      } else {\n        throw new Error(\n          `Expected input y or output Rect to follow first number parameter`\n        );\n      }\n    } else if (isPoint(a)) {\n      inX = a.x;\n      inY = a.y;\n      if (b === undefined) return [ inX, inY, outW, outH ];\n      if (isRect(b)) {\n        outW = b.width;\n        outH = b.height;\n      } else if (typeof b === `number`) {\n        outW = b;\n        if (typeof c === `number`) {\n          outH = c;\n        } else {\n          throw new TypeError(\n            `Expected height as third parameter after Point and output width`\n          );\n        }\n      } else {\n        throw new TypeError(\n          `Expected Rect or width as second parameter when first parameter is a Point`\n        );\n      }\n    } else {\n      throw new Error(`Expected input Point or x value as first parameter`);\n    }\n    return [ inX, inY, outW, outH ];\n  };\n\n  const scaleAbs = (\n    a: number | Point,\n    b?: number | Rect,\n    c?: number | Rect,\n    d?: number\n  ): Point => {\n    const n = normalise(a, b, c, d);\n    return scaleNormalised(true, ...n);\n  };\n\n  const scaleRel = (\n    a: number | Point,\n    b?: number | Rect,\n    c?: number | Rect,\n    d?: number\n  ): Point => {\n    const n = normalise(a, b, c, d);\n    return scaleNormalised(false, ...n);\n  };\n\n  const scaleNormalised = (\n    abs: boolean,\n    x: number,\n    y: number,\n    w: number,\n    h: number\n  ): Point => {\n    if (Number.isNaN(w)) throw new Error(`Output width range missing`);\n    if (Number.isNaN(h)) throw new Error(`Output height range missing`);\n\n    // If output dimensions has changed since last, create a new scale\n    if (w !== sw || h !== sh) {\n      sw = w;\n      sh = h;\n      s = computeScale();\n    }\n\n    return abs ? {\n      x: x * s.x,\n      y: y * s.y,\n    } : {\n      x: x / s.x,\n      y: y / s.y,\n    };\n  };\n\n  return {\n    computeScale,\n    rel: scaleRel,\n    abs: scaleAbs,\n    width: defaultBounds.width,\n    height: defaultBounds.height\n  };\n};\n\n// export const scalerReactive = (scaleBy: ScaleBy = `both`,\n//   defaultRect?: ReactiveInitial<Rect>) => {\n\n//   const resolve = (a: Point | Rect | RectPositioned | number, b: Rect | number, c: number, d: number) => {\n//     if (typeof a === `number`) {\n//       if (typeof b === `number`) {\n//         return { x: a, y: b, width: undefined, height: undefined }\n//       } else {\n//         throw new TypeError(`Expected 'b' parameter to be the y value?`);\n//       }\n//     } else if (isPoint(a)) {\n//       if (isRect(b)) {\n//         // Positioned rect\n//         return {\n//           x: \n//       }\n//       }\n//     }\n//   }","import type { Point, Point3d } from './point/point-type.js';\nimport type { Circle, CirclePositioned } from './circle/circle-type.js';\nimport type { Sphere } from './shape/index.js';\n\nimport { toPositioned as circleToPositioned } from './circle/to-positioned.js';\nimport { scale, linearSpace } from '@ixfx/numbers';\nconst cos = Math.cos;\nconst sin = Math.sin;\nconst asin = Math.asin;\nconst sqrt = Math.sqrt;\nconst pow = Math.pow;\nconst pi = Math.PI;\nconst piPi = Math.PI * 2;\nconst goldenAngle = pi * (3 - sqrt(5));\nconst goldenSection = (1 + sqrt(5)) / 2;\n\n/**\n * Options for a Vogel spiral\n */\nexport type VogelSpiralOpts = {\n  /**\n   * Upper limit of points to produce.\n   * By default, 5000.\n   */\n  readonly maxPoints?: number;\n  /**\n   * Density value (0..1) which determines spacing of points.\n   * This is useful because it scales with whatever circle radius is given\n   * Use this parameter OR the `spacing` parameter.\n   */\n  readonly density?: number;\n  /**\n   * Spacing between points.\n   * Use this option OR the density value.\n   */\n  readonly spacing?: number;\n  /**\n   * Rotation offset to apply, in radians. 0 by default\n   */\n  readonly rotation?: number;\n};\n\n/**\n * Generates points on a Vogel spiral - a sunflower-like arrangement of points.\n *\n * @example With no arguments, assumes a unit circle\n * ```js\n * for (const pt of circleVogelSpiral()) {\n *  // Generate points on a unit circle, with 95% density\n * }\n * ```\n *\n *\n * @example Specifying a circle and options\n * ```js\n * const circle = { radius: 100, x: 100, y: 100 };\n * const opts = {\n *  maxPoints: 50,\n *  density: 0.99\n * };\n * for (const pt of circleVogelSpiral(circle, opts)) {\n *  // Do something with point...\n * }\n * ```\n *\n * @example Array format\n * ```js\n * const ptsArray = [...circleVogelSpiral(circle, opts)];\n * ```\n * @param circle\n * @param opts\n */\nexport function* circleVogelSpiral(\n  circle?: Circle,\n  opts: VogelSpiralOpts = {}\n): IterableIterator<Point> {\n  const maxPoints = opts.maxPoints ?? 5000;\n  const density = opts.density ?? 0.95;\n  const rotationOffset = opts.rotation ?? 0;\n\n  const c = circleToPositioned(circle ?? { radius: 1, x: 0, y: 0 });\n  const max = c.radius;\n  //eslint-disable-next-line functional/no-let\n  let spacing = c.radius * scale(density, 0, 1, 0.3, 0.01);\n  if (opts.spacing) spacing = opts.spacing;\n\n  //eslint-disable-next-line functional/no-let\n  let radius = 0;\n  //eslint-disable-next-line functional/no-let\n  let count = 0;\n  //eslint-disable-next-line functional/no-let\n  let angle = 0;\n  while (count < maxPoints && radius < max) {\n    radius = spacing * count ** 0.5;\n    angle = rotationOffset + (count * 2 * pi) / goldenSection;\n    yield Object.freeze({\n      x: c.x + radius * cos(angle),\n      y: c.y + radius * sin(angle),\n    });\n    count++;\n  }\n}\n\nexport type CircleRingsOpts = {\n  readonly rings?: number;\n  /**\n   * Rotation offset, in radians\n   */\n  readonly rotation?: number;\n};\n/**\n * Generates points spaced out on the given number of rings.\n *\n * Get points as array\n * ```js\n * const circle = { radius: 5, x: 100, y: 100 };\n * const opts = { rings: 5 };\n * const points = [...circleRings(circle, rings)];\n * ```\n *\n * Or iterate over them\n * ```js\n * for (const point of circleRings(circle, opts)) {\n * }\n * ```\n * Source: http://www.holoborodko.com/pavel/2015/07/23/generating-equidistant-points-on-unit-disk/#more-3453\n * @param circle\n */\nexport function* circleRings(\n  circle?: Circle | CirclePositioned,\n  opts: CircleRingsOpts = {}\n): IterableIterator<Point> {\n  const rings = opts.rings ?? 5;\n  const c = circleToPositioned(circle ?? { radius: 1, x: 0, y: 0 });\n  const ringR = 1 / rings;\n  const rotationOffset = opts.rotation ?? 0;\n\n  //eslint-disable-next-line functional/no-let\n  let ringCount = 1;\n\n  // Origin\n  yield Object.freeze({ x: c.x, y: c.y });\n\n  //eslint-disable-next-line functional/no-let\n  for (let r = ringR; r <= 1; r += ringR) {\n    const n = Math.round(pi / asin(1 / (2 * ringCount)));\n    for (const theta of linearSpace(0, piPi, n + 1)) {\n      yield Object.freeze({\n        x: c.x + r * cos(theta + rotationOffset) * c.radius,\n        y: c.y + r * sin(theta + rotationOffset) * c.radius,\n      });\n    }\n    ringCount++;\n  }\n}\n/**\n * Fibonacci sphere algorithm. Generates points\n * distributed on a sphere.\n *\n * @example Generate points of a unit sphere\n * ```js\n * for (const pt of sphereFibonacci(100)) {\n *  // pt.x, pt.y, pt.z\n * }\n * ```\n *\n * @example Generate points into an array\n * ```js\n * const sphere = { radius: 10, x: 10, y: 200 }\n * const pts = [...sphereFibonacci(100, 0, sphere)];\n * ```\n *\n * Source: https://codepen.io/elchininet/pen/vXeRyL\n *\n * @param samples\n * @returns\n */\nexport function* sphereFibonacci(\n  samples = 100,\n  rotationRadians = 0,\n  sphere?: Sphere\n): IterableIterator<Point3d> {\n  const offset = 2 / samples;\n  const s = sphere ?? { x: 0, y: 0, z: 0, radius: 1 };\n\n  for (let index = 0; index < samples; index++) {\n    const y = index * offset - 1 + offset / 2;\n    const r = sqrt(1 - pow(y, 2));\n    const a = ((index + 1) % samples) * goldenAngle + rotationRadians;\n    const x = cos(a) * r;\n    const z = sin(a) * r;\n    //eslint-disable-next-line functional/immutable-data\n    yield Object.freeze({\n      x: s.x + x * s.radius,\n      y: s.y + y * s.radius,\n      z: s.z + z * s.radius,\n    });\n  }\n}\n","import type { Triangle } from \"./triangle-type.js\";\nimport { angleRadian as PointsAngleRadian } from '../point/angle.js';\nimport { guard } from \"./guard.js\";\nimport { radianToDegree } from \"../angles.js\";\n\n/**\n * Return the three interior angles of the triangle, in radians.\n * @param t\n * @returns\n */\nexport const angles = (t: Triangle): ReadonlyArray<number> => {\n  guard(t);\n  return [\n    PointsAngleRadian(t.a, t.b),\n    PointsAngleRadian(t.b, t.c),\n    PointsAngleRadian(t.c, t.a),\n  ];\n};\n\n/**\n * Returns the three interior angles of the triangle, in degrees\n * @param t\n * @returns\n */\nexport const anglesDegrees = (t: Triangle): ReadonlyArray<number> => {\n  guard(t);\n  return radianToDegree(angles(t));\n};","\nimport type { Triangle } from \"./triangle-type.js\";\nimport type { PolyLine } from \"../line/line-type.js\";\nimport { joinPointsToLines } from \"../line/join-points-to-lines.js\";\nimport { guard } from \"./guard.js\";\n/**\n * Returns the edges (ie sides) of the triangle as an array of lines\n * @param t\n * @returns Array of length three\n */\nexport const edges = (t: Triangle): PolyLine => {\n  guard(t);\n  return joinPointsToLines(t.a, t.b, t.c, t.a);\n};","import { guard } from \"./guard.js\";\nimport { length as LinesLength } from '../line/length.js';\nimport { edges } from \"./edges.js\";\nimport type { Triangle } from \"./triangle-type.js\";\n\n/**\n * Calculates the area of a triangle\n * @param t\n * @returns\n */\nexport const area = (t: Triangle): number => {\n  guard(t, `t`);\n\n  // Get length of edges\n  const lengths = edges(t).map((l) => LinesLength(l));\n\n  // Add up length of edges, halve\n  const p = (lengths[ 0 ] + lengths[ 1 ] + lengths[ 2 ]) / 2;\n  return Math.sqrt(p * (p - lengths[ 0 ]) * (p - lengths[ 1 ]) * (p - lengths[ 2 ]));\n};","import { getPointParameter } from \"../point/get-point-parameter.js\";\nimport type { Point } from \"../point/point-type.js\";\nimport { guard } from \"./guard.js\";\nimport type { BarycentricCoord, Triangle } from \"./triangle-type.js\";\n\n\n/**\n * Returns the [Barycentric coordinate](https://en.wikipedia.org/wiki/Barycentric_coordinate_system) of a point within a triangle\n *\n * @param t\n * @param a\n * @param b\n * @returns\n */\nexport const barycentricCoord = (\n  t: Triangle,\n  a: Point | number,\n  b?: number\n): BarycentricCoord => {\n  const pt = getPointParameter(a, b);\n\n  const ab = (x: number, y: number, pa: Point, pb: Point) =>\n    (pa.y - pb.y) * x + (pb.x - pa.x) * y + pa.x * pb.y - pb.x * pa.y;\n\n  const alpha = ab(pt.x, pt.y, t.b, t.c) / ab(t.a.x, t.a.y, t.b, t.c);\n  const theta = ab(pt.x, pt.y, t.c, t.a) / ab(t.b.x, t.b.y, t.c, t.a);\n  const gamma = ab(pt.x, pt.y, t.a, t.b) / ab(t.c.x, t.c.y, t.a, t.b);\n\n  return {\n    a: alpha,\n    b: theta,\n    c: gamma,\n  };\n};\n\n/**\n * Convert Barycentric coordinate to Cartesian\n * @param t\n * @param bc\n * @returns\n */\nexport const barycentricToCartestian = (\n  t: Triangle,\n  bc: BarycentricCoord\n): Point => {\n  guard(t);\n  const { a, b, c } = t;\n\n  const x = a.x * bc.a + b.x * bc.b + c.x * bc.c;\n  const y = a.y * bc.a + b.y * bc.b + c.y * bc.c;\n\n  if (a.z && b.z && c.z) {\n    const z = a.z * bc.a + b.z * bc.b + c.z * bc.c;\n    return Object.freeze({ x, y, z });\n  } else {\n    return Object.freeze({ x, y });\n  }\n};\n","import type { RectPositioned } from \"../rect/rect-types.js\";\nimport type { Triangle } from \"./triangle-type.js\";\n\n/**\n * Returns the bounding box that encloses the triangle.\n * @param t\n * @param inflation If specified, box will be inflated by this much. Default: 0.\n * @returns\n */\nexport const bbox = (t: Triangle, inflation = 0): RectPositioned => {\n  const { a, b, c } = t;\n  const xMin = Math.min(a.x, b.x, c.x) - inflation;\n  const xMax = Math.max(a.x, b.x, c.x) + inflation;\n  const yMin = Math.min(a.y, b.y, c.y) - inflation;\n  const yMax = Math.max(a.y, b.y, c.y) + inflation;\n\n  const r: RectPositioned = {\n    x: xMin,\n    y: yMin,\n    width: xMax - xMin,\n    height: yMax - yMin,\n  };\n  return r;\n};","import type { Point } from \"../point/point-type.js\";\nimport { guard } from \"./guard.js\";\nimport type { Triangle } from \"./triangle-type.js\";\n\n/**\n * Returns the corners (vertices) of the triangle as an array of points\n * @param t\n * @returns Array of length three\n */\nexport const corners = (t: Triangle): ReadonlyArray<Point> => {\n  guard(t);\n  return [ t.a, t.b, t.c ];\n};","import { numberTest, resultThrow } from \"@ixfx/guards\";\nimport type { Triangle } from \"./triangle-type.js\";\nimport { fromNumbers as PointsFromNumbers } from \"../point/from.js\";\nimport { guard as PointGuard } from \"../point/guard.js\";\nimport type { Point } from \"../point/point-type.js\";\nimport { piPi } from \"../pi.js\";\nimport { toCartesian as PolarToCartesian } from \"../polar/conversions.js\";\n/**\n * Returns an equilateral triangle centered at the origin.\n *\n * ```js\n * // Create a triangle at 100,100 with radius of 60\n * const tri = fromRadius({x:100,y:100}, 60);\n *\n * // Triangle with point A upwards, B to the right, C to the left\n * constr tri2 = fromRadius({x:100,y:100}, 60, {initialAngleRadian: -Math.PI / 2});\n * ```\n *\n *\n * @param origin Origin\n * @param radius Radius of triangle\n * @param opts Options\n */\nexport const fromRadius = (\n  origin: Point,\n  radius: number,\n  opts: { readonly initialAngleRadian?: number } = {}\n): Triangle => {\n  resultThrow(numberTest(radius, `positive`, `radius`));\n  PointGuard(origin, `origin`);\n\n  const initialAngleRadian = opts.initialAngleRadian ?? 0;\n\n  const angles = [\n    initialAngleRadian,\n    initialAngleRadian + (piPi * 1) / 3,\n    initialAngleRadian + (piPi * 2) / 3,\n  ];\n  const points = angles.map((a) => PolarToCartesian(radius, a, origin));\n  return fromPoints(points);\n};\n\n\n/**\n * Returns a triangle from a set of coordinates in a flat array form:\n * [xA, yA, xB, yB, xC, yC]\n * @param coords\n * @returns\n */\nexport const fromFlatArray = (coords: readonly number[]): Triangle => {\n  if (!Array.isArray(coords)) throw new Error(`coords expected as array`);\n  if (coords.length !== 6) {\n    throw new Error(\n      `coords array expected with 6 elements. Got ${ coords.length }`\n    );\n  }\n  return fromPoints(PointsFromNumbers(...coords));\n};\n\n\n/**\n * Returns a triangle from an array of three points\n * @param points\n * @returns\n */\nexport const fromPoints = (points: readonly Point[]): Triangle => {\n  if (!Array.isArray(points)) throw new Error(`points expected as array`);\n  if (points.length !== 3) {\n    throw new Error(\n      `points array expected with 3 elements. Got ${ points.length }`\n    );\n  }\n  const t: Triangle = {\n    a: points[ 0 ],\n    b: points[ 1 ],\n    c: points[ 2 ],\n  };\n  return t;\n};\n","import { guard } from \"./guard.js\";\nimport type { Triangle } from \"./triangle-type.js\";\nimport { length as LinesLength } from '../line/length.js';\nimport { edges } from \"./edges.js\";\n\n/**\n * Calculates perimeter of a triangle\n * @param t\n * @returns\n */\nexport const perimeter = (t: Triangle): number => {\n  guard(t);\n  return edges(t).reduce((accumulator, v) => accumulator + LinesLength(v), 0);\n};","import type { CirclePositioned } from \"../circle/circle-type.js\";\nimport { area } from \"./area.js\";\nimport { centroid } from \"./centroid.js\";\nimport { perimeter } from \"./perimeter.js\";\nimport type { Triangle } from \"./triangle-type.js\";\n\n/**\n * Returns the largest circle enclosed by triangle `t`.\n * @param t\n */\nexport const innerCircle = (t: Triangle): CirclePositioned => {\n  const c = centroid(t);\n  const p = perimeter(t) / 2;\n  const a = area(t);\n  const radius = a / p;\n  return { radius, ...c };\n};","import type { Point } from \"../point/point-type.js\";\nimport type { Triangle } from \"./triangle-type.js\";\nimport { getPointParameter } from \"../point/get-point-parameter.js\";\nimport { bbox } from \"./bbox.js\";\nimport { intersectsPoint as RectsIntersectsPoint } from '../rect/Intersects.js';\nimport { barycentricCoord } from \"./barycentric.js\";\n\n/**\n * Returns true if point is within or on the boundary of triangle\n * @param t\n * @param a\n * @param b\n */\nexport const intersectsPoint = (\n  t: Triangle,\n  a: Point | number,\n  b?: number\n): boolean => {\n  const box = bbox(t);\n\n  const pt = getPointParameter(a, b);\n\n  // If it's not in the bounding box, can return false straight away\n  if (!RectsIntersectsPoint(box, pt)) return false;\n\n  const bc = barycentricCoord(t, pt);\n\n  return (\n    0 <= bc.a && bc.a <= 1 && 0 <= bc.b && bc.b <= 1 && 0 <= bc.c && bc.c <= 1\n  );\n};\n","import { guard } from \"./guard.js\";\nimport type { Triangle } from \"./triangle-type.js\";\nimport { distance } from \"../point/distance.js\";\n/**\n * Returns the lengths of the triangle sides\n * @param t\n * @returns Array of length three\n */\nexport const lengths = (t: Triangle): ReadonlyArray<number> => {\n  guard(t);\n  return [\n    distance(t.a, t.b),\n    distance(t.b, t.c),\n    distance(t.c, t.a),\n  ];\n};","import { angles } from \"./angles.js\";\nimport { guard } from \"./guard.js\";\nimport { lengths } from \"./lengths.js\";\nimport type { Triangle } from \"./triangle-type.js\";\n\n/**\n * Returns true if it is an equilateral triangle\n * @param t\n * @returns\n */\nexport const isEquilateral = (t: Triangle): boolean => {\n  guard(t);\n  const [ a, b, c ] = lengths(t);\n  return a === b && b === c;\n};\n\n/**\n * Returns true if it is an isosceles triangle\n * @param t\n * @returns\n */\nexport const isIsosceles = (t: Triangle): boolean => {\n  const [ a, b, c ] = lengths(t);\n  if (a === b) return true;\n  if (b === c) return true;\n  if (c === a) return true;\n  return false;\n};\n\n/**\n * Returns true if at least one interior angle is 90 degrees\n * @param t\n * @returns\n */\nexport const isRightAngle = (t: Triangle): boolean =>\n  angles(t).includes(Math.PI / 2);\n\n/**\n * Returns true if triangle is oblique: No interior angle is 90 degrees\n * @param t\n * @returns\n */\nexport const isOblique = (t: Triangle): boolean => !isRightAngle(t);\n\n/**\n * Returns true if triangle is actue: all interior angles less than 90 degrees\n * @param t\n * @returns\n */\nexport const isAcute = (t: Triangle): boolean =>\n  !angles(t).some((v) => v >= Math.PI / 2);\n\n/**\n * Returns true if triangle is obtuse: at least one interior angle is greater than 90 degrees\n * @param t\n * @returns\n */\nexport const isObtuse = (t: Triangle): boolean =>\n  angles(t).some((v) => v > Math.PI / 2);\n","import type { Point } from \"../point/point-type.js\";\nimport type { Triangle } from \"./triangle-type.js\";\n\n/**\n * Applies `fn` to each of a triangle's corner points, returning the result.\n *\n * @example Add some random to the x of each corner\n * ```\n * const t = apply(tri, p => {\n *  const r = 10;\n *  return {\n *    x: p.x + (Math.random()*r*2) - r,\n *    y: p.y\n *  }\n * });\n * ```\n * @param t\n * @param fn\n * @returns\n */\nexport const apply = (\n  t: Triangle,\n  fn: (p: Point, label?: string) => Point\n) =>\n  Object.freeze<Triangle>({\n    ...t,\n    a: fn(t.a, `a`),\n    b: fn(t.b, `b`),\n    c: fn(t.c, `c`),\n  });","import { length as LinesLength } from '../line/length.js';\nimport { edges } from \"./edges.js\";\nimport { centroid } from './centroid.js';\nimport type { Triangle } from \"./triangle-type.js\";\nimport type { CirclePositioned } from '../circle/circle-type.js';\n\n/**\n * Returns the largest circle touching the corners of triangle `t`.\n * @param t\n * @returns\n */\nexport const outerCircle = (t: Triangle): CirclePositioned => {\n  const [ a, b, c ] = edges(t).map((l) => LinesLength(l));\n  const cent = centroid(t);\n  const radius =\n    (a * b * c) /\n    Math.sqrt((a + b + c) * (-a + b + c) * (a - b + c) * (a + b - c));\n  return {\n    radius,\n    ...cent,\n  };\n};","import type { Point } from \"../point/point-type.js\";\nimport { centroid } from \"./centroid.js\";\nimport type { Triangle } from \"./triangle-type.js\";\nimport { rotate as PointsRotate } from \"../point/index.js\";\n/**\n * Returns a triangle that is rotated by `angleRad`. By default it rotates\n * around its center but an arbitrary `origin` point can be provided.\n *\n * ```js\n * let triangle = Triangles.fromPoints([a, b, c]);\n * \n * // Rotate triangle by 5 degrees\n * triangle = Triangles.rotate(triangle, degreeToRadian(5));\n *\n * // Rotate by 90 degrees\n * triangle = Triangles.rotate(triangle, Math.PI / 2);\n * ```\n * @param triangle Triangle to rotate\n * @param amountRadian Angle in radians to rotate by\n * @param origin Point to rotate around. If undefined, middle of triangle will be used\n * @returns A new triangle\n */\nexport const rotate = (\n  triangle: Triangle,\n  amountRadian?: number,\n  origin?: Point\n): Triangle => {\n  if (amountRadian === undefined || amountRadian === 0) return triangle;\n  if (origin === undefined) origin = centroid(triangle);\n  return Object.freeze({\n    ...triangle,\n    a: PointsRotate(triangle.a, amountRadian, origin),\n    b: PointsRotate(triangle.b, amountRadian, origin),\n    c: PointsRotate(triangle.c, amountRadian, origin),\n  });\n};\n\n/**\n * Rotates the vertices of the triangle around one point (by default, `b`), returning\n * as a new object.\n * \n * ```js\n * let triangle = Triangles.fromPoints([a, b, c]);\n * triangle = Triangles.rotateByVertex(triangle, Math.Pi, `a`);\n * ```\n * @param triangle Triangle\n * @param amountRadian Angle to rotate by\n * @param vertex Name of vertex: a, b or c.\n * @returns A new triangle\n */\nexport const rotateByVertex = (\n  triangle: Triangle,\n  amountRadian: number,\n  vertex: `a` | `b` | `c` = `b`\n): Triangle => {\n  const origin =\n    vertex === `a` ? triangle.a : (vertex === `b` ? triangle.b : triangle.c);\n  return Object.freeze({\n    a: PointsRotate(triangle.a, amountRadian, origin),\n    b: PointsRotate(triangle.b, amountRadian, origin),\n    c: PointsRotate(triangle.c, amountRadian, origin),\n  });\n};","import { guard } from \"./guard.js\";\nimport type { Triangle } from \"./triangle-type.js\";\n\n/**\n * Returns the coordinates of triangle in a flat array form:\n * [xA, yA, xB, yB, xC, yC]\n * @param t\n * @returns\n */\nexport const toFlatArray = (t: Triangle): readonly number[] => {\n  guard(t);\n  return [ t.a.x, t.a.y, t.b.x, t.b.y, t.c.x, t.c.y ];\n};","import type { Circle } from \"../circle/circle-type.js\";\nimport type { Point } from \"../point/point-type.js\";\nimport type { Triangle } from \"./triangle-type.js\";\n\nconst pi4over3 = (Math.PI * 4) / 3;\nconst pi2over3 = (Math.PI * 2) / 3;\n\nexport type TriangleEquilateral =\n  | {\n    readonly length: number;\n  }\n  | number;\n\nconst resolveLength = (t: TriangleEquilateral): number => {\n  if (typeof t === `number`) return t;\n  return t.length;\n};\n\n/**\n * Returns a positioned `Triangle` from an equilateral triangle definition.\n * By default the rotation is such that point `a` and `c` are lying on the horizontal,\n * and `b` is the upward-facing tip.\n *\n * Default is a triangle pointing upwards with b at the top, c to the left and b to right on the baseline.\n *\n * Example rotation values in radians:\n * *  0: a and c on vertical, b at the tip\n * *  Math.PI: `c`and `a` are on vertical, with `b` at the tip.\n * *  Math.PI/2: `c` and `a` are on horizontal, `c` to the left. `b` at the bottom.\n * *  Math.PI*1.5: `c` and `a` are on horizontal, `c` to the right. `b` at the top. (default)\n * @param t\n * @param origin\n * @param rotationRad\n * @returns\n */\nexport const fromCenter = (\n  t: TriangleEquilateral,\n  origin?: Point,\n  rotationRad?: number\n): Triangle => {\n  if (!origin) origin = Object.freeze({ x: 0, y: 0 })\n\n  const r = resolveLength(t) / Math.sqrt(3);\n  const rot = rotationRad ?? Math.PI * 1.5;\n  const b = {\n    x: r * Math.cos(rot) + origin.x,\n    y: r * Math.sin(rot) + origin.y,\n  };\n  const a = {\n    x: r * Math.cos(rot + pi4over3) + origin.x,\n    y: r * Math.sin(rot + pi4over3) + origin.y,\n  };\n  const c = {\n    x: r * Math.cos(rot + pi2over3) + origin.x,\n    y: r * Math.sin(rot + pi2over3) + origin.y,\n  };\n\n  return Object.freeze({ a, b, c });\n};\n\n/**\n * Calculate center from the given point A\n * @param t\n * @param ptA\n * @returns\n */\nexport const centerFromA = (\n  t: TriangleEquilateral,\n  ptA?: Point\n): Point => {\n  if (!ptA) ptA = Object.freeze({ x: 0, y: 0 })\n\n  const r = resolveLength(t);\n  const { radius } = incircle(t);\n  return {\n    x: ptA.x + r / 2,\n    y: ptA.y - radius,\n  };\n};\n\n/**\n * Calculate center from the given point B\n * @param t\n * @param ptB\n * @returns\n */\nexport const centerFromB = (\n  t: TriangleEquilateral,\n  ptB?: Point\n): Point => {\n  if (!ptB) ptB = Object.freeze({ x: 0, y: 0 })\n\n  const { radius } = incircle(t);\n  return {\n    x: ptB.x,\n    y: ptB.y + radius * 2,\n  };\n};\n\n/**\n * Calculate center from the given point C\n * @param t\n * @param ptC\n * @returns\n */\nexport const centerFromC = (\n  t: TriangleEquilateral,\n  ptC?: Point\n): Point => {\n  if (!ptC) ptC = Object.freeze({ x: 0, y: 0 })\n\n  const r = resolveLength(t);\n  const { radius } = incircle(t);\n\n  return {\n    x: ptC.x - r / 2,\n    y: ptC.y - radius,\n  };\n};\n\n/**\n * Returns the height (or rise) of an equilateral triangle.\n * Ie. from one vertex to the perpendicular edge.\n * (line marked x in the diagram below)\n *\n * ```\n *      .\n *     .x .\n *    . x  .\n *   .  x   .\n *  ..........\n * ```\n * @param t\n */\nexport const height = (t: TriangleEquilateral): number =>\n  (Math.sqrt(3) / 2) * resolveLength(t);\n\nexport const perimeter = (t: TriangleEquilateral): number =>\n  resolveLength(t) * 3;\n\nexport const area = (t: TriangleEquilateral): number =>\n  (Math.pow(resolveLength(t), 2) * Math.sqrt(3)) / 4;\n\n/**\n * Circle that encompasses all points of triangle\n * @param t\n */\nexport const circumcircle = (t: TriangleEquilateral): Circle => ({\n  radius: (Math.sqrt(3) / 3) * resolveLength(t),\n});\n\n/**\n * Circle that is inside the edges of the triangle\n * @param t\n * @returns\n */\nexport const incircle = (t: TriangleEquilateral): Circle => ({\n  radius: (Math.sqrt(3) / 6) * resolveLength(t),\n});\n","import type { Circle } from \"../circle/circle-type.js\";\nimport type { Point } from \"../point/point-type.js\";\nimport type { Triangle } from \"./triangle-type.js\";\nexport type Right = {\n  readonly adjacent?: number;\n  readonly hypotenuse?: number;\n  readonly opposite?: number;\n};\n\nexport type DefinedRight = {\n  readonly adjacent: number;\n  readonly hypotenuse: number;\n  readonly opposite: number;\n};\n\n/**\n * Returns a positioned triangle from a point for A.\n *\n * ```\n *             c (90 deg)\n *             .\n *          .   .\n *       .       .\n *    .           .\n * a .............. b\n * ```\n * @param t\n * @param origin\n * @returns\n */\nexport const fromA = (\n  t: Right,\n  origin?: Point\n): Triangle => {\n  if (!origin) origin = Object.freeze({ x: 0, y: 0 })\n  const tt = resolveLengths(t);\n  const seg = hypotenuseSegments(t);\n  const h = height(t);\n  const a = { x: origin.x, y: origin.y };\n  const b = { x: origin.x + tt.hypotenuse, y: origin.y };\n  const c = { x: origin.x + seg[ 1 ], y: origin.y - h };\n  return { a, b, c };\n};\n\n/**\n * Returns a positioned triangle from a point for B.\n *\n * ```\n *             c (90 deg)\n *             .\n *          .   .\n *       .       .\n *    .           .\n * a .............. b\n * ```\n * @param t\n * @param origin\n * @returns\n */\nexport const fromB = (\n  t: Right,\n  origin?: Point\n): Triangle => {\n  if (!origin) origin = Object.freeze({ x: 0, y: 0 })\n\n  const tt = resolveLengths(t);\n  const seg = hypotenuseSegments(t);\n  const h = height(t);\n  const b = { x: origin.x, y: origin.y };\n  const a = { x: origin.x - tt.hypotenuse, y: origin.y };\n  const c = { x: origin.x - seg[ 0 ], y: origin.y - h };\n  return { a, b, c };\n};\n\n/**\n * Returns a positioned triangle from a point for C.\n *\n * ```\n *             c (90 deg)\n *             .\n *          .   .\n *       .       .\n *    .           .\n * a .............. b\n * ```\n *\n *\n * ```js\n * // Triangle pointing up to 0,0 with sides of 15\n * Triangles.Right.fromC({ adjacent: 15, opposite:15 }, { x: 0, y: 0 });\n * ```\n * @param t\n * @param origin\n * @returns\n */\nexport const fromC = (\n  t: Right,\n  origin?: Point\n): Triangle => {\n  if (!origin) origin = Object.freeze({ x: 0, y: 0 })\n\n  const seg = hypotenuseSegments(t);\n  const h = height(t);\n  const c = { x: origin.x, y: origin.y };\n  const a = { x: origin.x - seg[ 1 ], y: origin.y + h };\n  const b = { x: origin.x + seg[ 0 ], y: origin.y + h };\n  return { a, b, c };\n};\n\n/**\n * Returns a right triangle with all lengths defined.\n * At least two lengths must already exist\n * @param t\n * @returns\n */\nexport const resolveLengths = (t: Right): DefinedRight => {\n  const a = t.adjacent;\n  const o = t.opposite;\n  const h = t.hypotenuse;\n\n  if (a !== undefined && o !== undefined) {\n    return {\n      ...t,\n      adjacent: a,\n      opposite: o,\n      hypotenuse: Math.hypot(a, o),\n    };\n  } else if (a && h) {\n    return {\n      ...t,\n      adjacent: a,\n      hypotenuse: h,\n      opposite: h * h - a * a,\n    };\n  } else if (o && h) {\n    return {\n      ...t,\n      hypotenuse: h,\n      opposite: o,\n      adjacent: h * h - o * o,\n    };\n  } else if (t.opposite && t.hypotenuse && t.adjacent) {\n    return t as DefinedRight;\n  }\n  throw new Error(`Missing at least two edges`);\n};\n\n/**\n * Height of right-triangle\n * @param t\n * @returns\n */\nexport const height = (t: Right): number => {\n  const tt = resolveLengths(t);\n  const p = (tt.opposite * tt.opposite) / tt.hypotenuse;\n  const q = (tt.adjacent * tt.adjacent) / tt.hypotenuse;\n  return Math.sqrt(p * q);\n};\n\n/**\n * Returns the lengths of the hypotenuse split into p and q segments.\n * In other words, if one makes a line from the right-angle vertex down to hypotenuse.\n *\n * [See here](https://rechneronline.de/pi/right-triangle.php)\n * @param t\n * @returns\n */\nexport const hypotenuseSegments = (\n  t: Right\n): readonly [ p: number, q: number ] => {\n  const tt = resolveLengths(t);\n  const p = (tt.opposite * tt.opposite) / tt.hypotenuse;\n  const q = (tt.adjacent * tt.adjacent) / tt.hypotenuse;\n  return [ p, q ];\n};\n\nexport const perimeter = (t: Right): number => {\n  const tt = resolveLengths(t);\n  return tt.adjacent + tt.hypotenuse + tt.opposite;\n};\n\nexport const area = (t: Right): number => {\n  const tt = resolveLengths(t);\n  return (tt.opposite * tt.adjacent) / 2;\n};\n\n/**\n * Angle (in radians) between hypotenuse and adjacent edge\n * @param t\n * @returns\n */\nexport const angleAtPointA = (t: Right): number => {\n  const tt = resolveLengths(t);\n  return Math.acos(\n    (tt.adjacent * tt.adjacent +\n      tt.hypotenuse * tt.hypotenuse -\n      tt.opposite * tt.opposite) /\n    (2 * tt.adjacent * tt.hypotenuse)\n  );\n};\n\n/**\n * Angle (in radians) between opposite edge and hypotenuse\n * @param t\n * @returns\n */\nexport const angleAtPointB = (t: Right): number => {\n  const tt = resolveLengths(t);\n  return Math.acos(\n    (tt.opposite * tt.opposite +\n      tt.hypotenuse * tt.hypotenuse -\n      tt.adjacent * tt.adjacent) /\n    (2 * tt.opposite * tt.hypotenuse)\n  );\n};\n\n/**\n * Returns the median line lengths a, b and c in an array.\n *\n * The median lines are the lines from each vertex to the center.\n *\n * @param t\n * @returns\n */\nexport const medians = (\n  t: Right\n): readonly [ a: number, b: number, c: number ] => {\n  const tt = resolveLengths(t);\n  const b = tt.adjacent * tt.adjacent;\n  const c = tt.hypotenuse * tt.hypotenuse;\n  const a = tt.opposite * tt.opposite;\n\n  return [\n    Math.sqrt(2 * (b + c) - a) / 2,\n    Math.sqrt(2 * (c + a) - b) / 2,\n    Math.sqrt(2 * (a + b) - c) / 2,\n  ];\n};\n\n/**\n * The circle which passes through the points of the triangle\n * @param t\n * @returns\n */\nexport const circumcircle = (t: Right): Circle => {\n  const tt = resolveLengths(t);\n  return { radius: tt.hypotenuse / 2 };\n};\n\n/**\n * Circle enclosed by triangle\n * @param t\n * @returns\n */\nexport const incircle = (t: Right): Circle => {\n  const tt = resolveLengths(t);\n  return {\n    radius: (tt.adjacent + tt.opposite - tt.hypotenuse) / 2,\n  };\n};\n\n/**\n * Returns the opposite length of a right-angle triangle,\n * marked here\n *\n * ```\n *    .  <\n *   ..  <\n * ....  <\n * ```\n *\n * This is just:\n * ```js\n * opposite = Math.tan(angle) * adjacent\n * ```\n * @param angleRad\n * @param adjacent\n * @returns\n */\nexport const oppositeFromAdjacent = (\n  angleRad: number,\n  adjacent: number\n): number => Math.tan(angleRad) * adjacent;\n\n/**\n * Returns the opposite length of a right-angle triangle,\n * marked here\n *\n * ```\n *    .  <\n *   ..  <\n * ....  <\n * ```\n *\n * This is just:\n * ```js\n * opposite = Math.tan(angle) * adjacent\n * ```\n * @param angleRad\n * @param hypotenuse\n * @returns\n */\nexport const oppositeFromHypotenuse = (\n  angleRad: number,\n  hypotenuse: number\n): number => Math.sin(angleRad) * hypotenuse;\n\n/**\n * Returns the adjecent length of a right-angle triangle,\n * marked here\n * ```\n *    .\n *   ..  o\n * ....\n * ^^^^\n * ```\n * This is just:\n * ```js\n * opposite = Math.tan(angle) * adjacent\n * ```\n * @param angleRadian\n * @param hypotenuse\n * @returns\n */\nexport const adjacentFromHypotenuse = (\n  angleRadian: number,\n  hypotenuse: number\n): number => Math.cos(angleRadian) * hypotenuse;\n\n/**\n * Returns the adjecent length of a right-angle triangle,\n * marked here\n * ```\n *    .\n *   ..  o\n * ....\n * ^^^^\n * ```\n * This is just:\n * ```js\n * opposite = Math.tan(angle) * adjacent\n * ```\n * @param angleRadian\n * @param opposite\n * @returns\n */\nexport const adjacentFromOpposite = (\n  angleRadian: number,\n  opposite: number\n): number => opposite / Math.tan(angleRadian);\n\n/**\n * Returns the hypotenuse length of a right-angle triangle,\n * marked here\n * ```\n *      .\n * >   ..\n * >  ...\n * > ....  opp\n *  .....\n *   adj\n * ```\n * This is just:\n * ```js\n * opposite = Math.tan(angle) * adjacent\n * ```\n * @param angleRadian\n * @param opposite\n * @returns\n */\nexport const hypotenuseFromOpposite = (\n  angleRadian: number,\n  opposite: number\n): number => opposite / Math.sin(angleRadian);\n\n/**\n * Returns the hypotenuse length of a right-angle triangle,\n * marked here\n * ```\n *      .\n * >   ..\n * >  ...\n * > ....  opp\n *  .....\n *   adj\n * ```\n * This is just:\n * ```js\n * opposite = Math.tan(angle) * adjacent\n * ```\n * @param angleRadian\n * @param adjacent\n * @returns\n */\nexport const hypotenuseFromAdjacent = (\n  angleRadian: number,\n  adjacent: number\n): number => adjacent / Math.cos(angleRadian);\n","\nimport type { Circle } from \"../circle/circle-type.js\";\nimport type { Point } from \"../point/point-type.js\";\nimport type { Triangle } from \"./triangle-type.js\";\nexport type Isosceles = {\n  readonly legs: number;\n  readonly base: number;\n};\n\nexport const baseAngle = (t: Isosceles): number =>\n  Math.acos(t.base / (2 * t.legs));\n\nexport const apexAngle = (t: Isosceles): number => {\n  const aa = t.legs * t.legs;\n  const cc = t.base * t.base;\n  return Math.acos((2 * aa - cc) / (2 * aa));\n};\n\nexport const height = (t: Isosceles): number => {\n  const aa = t.legs * t.legs;\n  const cc = t.base * t.base;\n  return Math.sqrt((4 * aa - cc) / 4);\n};\n\nexport const legHeights = (t: Isosceles): number => {\n  const b = baseAngle(t);\n  return t.base * Math.sin(b);\n};\n\nexport const perimeter = (t: Isosceles): number => 2 * t.legs + t.base;\n\nexport const area = (t: Isosceles): number => {\n  const h = height(t);\n  return (h * t.base) / 2;\n};\n\nexport const circumcircle = (t: Isosceles): Circle => {\n  const h = height(t);\n  const hh = h * h;\n  const cc = t.base * t.base;\n  return { radius: (4 * hh + cc) / (8 * h) };\n};\n\nexport const incircle = (t: Isosceles): Circle => {\n  const h = height(t);\n  return { radius: (t.base * h) / (2 * t.legs + t.base) };\n};\n\nexport const medians = (\n  t: Isosceles\n): readonly [ a: number, b: number, c: number ] => {\n  const aa = t.legs * t.legs;\n  const cc = t.base * t.base;\n  const medianAB = Math.sqrt(aa + 2 * cc) / 2;\n  const medianC = Math.sqrt(4 * aa - cc) / 2;\n  return [ medianAB, medianAB, medianC ];\n};\n\n/**\n * Returns a positioned `Triangle` based on a center origin.\n * Center is determined by the intesecting of the medians.\n *\n * See: https://rechneronline.de/pi/isosceles-triangle.php\n * @param t\n * @param origin\n * @returns\n */\nexport const fromCenter = (\n  t: Isosceles,\n  origin?: Point\n): Triangle => {\n  if (!origin) origin = Object.freeze({ x: 0, y: 0 })\n  const h = height(t);\n  const incircleR = incircle(t).radius;\n  const verticalToApex = h - incircleR;\n\n  const a = { x: origin.x - t.base / 2, y: origin.y + incircleR };\n  const b = { x: origin.x + t.base / 2, y: origin.y + incircleR };\n  const c = { x: origin.x, y: origin.y - verticalToApex };\n  return { a, b, c };\n};\n\nexport const fromA = (\n  t: Isosceles,\n  origin?: Point\n): Triangle => {\n  if (!origin) origin = Object.freeze({ x: 0, y: 0 })\n\n  const h = height(t);\n  const a = { x: origin.x, y: origin.y };\n  const b = { x: origin.x + t.base, y: origin.y };\n  const c = { x: origin.x + t.base / 2, y: origin.y - h };\n  return { a, b, c };\n};\n\nexport const fromB = (\n  t: Isosceles,\n  origin?: Point\n): Triangle => {\n  if (!origin) origin = Object.freeze({ x: 0, y: 0 })\n\n  const h = height(t);\n  const b = { x: origin.x, y: origin.y };\n  const a = { x: origin.x - t.base, y: origin.y };\n  const c = { x: origin.x - t.base / 2, y: origin.y - h };\n  return { a, b, c };\n};\n\nexport const fromC = (\n  t: Isosceles,\n  origin?: Point\n): Triangle => {\n  if (!origin) origin = Object.freeze({ x: 0, y: 0 })\n  const h = height(t);\n  const c = { x: origin.x, y: origin.y };\n  const a = { x: origin.x - t.base / 2, y: origin.y + h };\n  const b = { x: origin.x + t.base / 2, y: origin.y + h };\n  return { a, b, c };\n};\n","export type * from './triangle-type.js';\nexport * from './angles.js';\nexport * from './area.js';\nexport * from './barycentric.js';\nexport * from './bbox.js';\nexport * from './centroid.js';\nexport * from './corners.js';\nexport * from './create.js';\nexport * from './edges.js';\nexport * from './from.js';\nexport * from './inner-circle.js';\nexport * from './intersects.js';\nexport * from './kinds.js';\nexport * from './lengths.js';\nexport * from './math.js';\nexport * from './outer-circle.js';\nexport * from './perimeter.js';\nexport * from './rotate.js';\nexport * from './to.js';\nexport * from './guard.js';\n/**\n * Functions for working with equilateral triangles, defined by length\n */\nexport * as Equilateral from './equilateral.js';\n\n/**\n * Functions for working with right-angled triangles, defined by two of three edges\n */\nexport * as Right from './right.js';\n\nexport * as Isosceles from './isosceles.js';\n\n/**\n* Triangle.\n*\n* Helpers for creating:\n*  - {@link Triangles.fromFlatArray}: Create from [x1, y1, x2, y2, x3, y3]\n*  - {@link Triangles.fromPoints}: Create from three `{x,y}` sets\n*  - {@link Triangles.fromRadius}: Equilateral triangle of a given radius and center\n*/\n\n\n","import { type RandomSource } from \"./types.js\";\n\n/**\n* Returns a random number from 0..weightings.length, distributed by the weighting values.\n* \n* eg: produces 0 20% of the time, 1 50% of the time, 2 30% of the time\n* ```js\n* weightedIndex([0.2, 0.5, 0.3]);\n* ```\n* @param weightings \n* @param rand \n* @returns \n*/\nexport const weightedIndex = (weightings: Array<number>, rand: RandomSource = Math.random): () => number => {\n  const precompute: Array<number> = [];\n  let total = 0;\n  // eslint-disable-next-line unicorn/no-for-loop\n  for (let index = 0; index < weightings.length; index++) {\n    total += weightings[ index ];\n    precompute[ index ] = total;\n  }\n  if (total !== 1) throw new Error(`Weightings should add up to 1. Got: ${ total }`);\n\n  return (): number => {\n    const v = rand();\n    // eslint-disable-next-line unicorn/no-for-loop\n    for (let index = 0; index < precompute.length; index++) {\n      if (v <= precompute[ index ]) return index;\n    }\n    throw new Error(`Bug: weightedIndex could not select index`);\n  }\n}","import { arrayTest, resultThrow } from \"@ixfx/guards\";\nimport { weightedIndex } from \"./weighted-index.js\";\nimport type { RandomSource } from \"./types.js\";\n\n/**\n * Returns a random array index.\n *\n * ```js\n * const v = [`blue`, `red`, `orange`];\n * randomIndex(v); // Yields 0, 1 or 2\n * ```\n *\n * Use {@link randomElement} if you want a value from `array`, not index.\n *\n * @param array Array\n * @param rand Random generator. `Math.random` by default.\n * @returns\n */\nexport const randomIndex = <V>(\n  array: ArrayLike<V>,\n  rand: RandomSource = Math.random\n): number => Math.floor(rand() * array.length);\n\n\n/**\n * Returns a random value from `array`,\n * and removes it from the array.\n * \n * ```js\n * const data = [100,20,50];\n * const v = randomPluck(data, { mutate: true });\n * // eg: v: 20, data is now [100,50]\n * ```\n * @param array \n * @param options \n */\nexport function randomPluck<V>(\n  array: readonly V[] | V[],\n  options: { mutate: true, source?: RandomSource }\n): V | undefined;\n\n/**\n * Returns a random element from an array\n * along with the remaining elements. Does not\n * modify the original array.\n * ```js\n * const data = [100,20,50];\n * const {value,remainder} = randomPluck(data);\n * // eg: value: 20, remainder: [100,50], data remains [100,20,50]\n * ```\n * @param array \n * @param options \n */\nexport function randomPluck<V>(\n  array: readonly V[] | V[],\n  options?: { mutate: false, source?: RandomSource }\n): { value: V, remainder: V[] };\n\n/**\n * Plucks a random value from an array, optionally mutating\n * the original array.\n * \n * @example Get a random element without modifying array\n * ```js\n * const { value, remainder } = randomPluck(inputArray);\n * ```\n * \n * @example Get a random element, removing it from original array\n * ```js\n * const value = randomPluck(inputArray, { mutate: true });\n * ```\n * \n * If the input array is empty, _undefined_ is returned as the value.\n * @typeParam V - Type of items in array\n * @param array Array to pluck item from\n * @param options Options. By default { mutate: false, source: Math.random }\n * @param rand Random generator. `Math.random` by default.\n *\n */\nexport function randomPluck<V>(\n  array: readonly V[] | V[],\n  options: Partial<{ mutate: boolean, source: RandomSource }> = {}\n): undefined | V | { readonly value: V | undefined; readonly remainder: V[] } {\n  if (typeof array === `undefined`) throw new Error(`Param 'array' is undefined`);\n  if (!Array.isArray(array)) throw new Error(`Param 'array' is not an array`);\n\n  const mutate = options.mutate ?? false;\n  const rand = options.source ?? Math.random;\n\n  if (array.length === 0) {\n    if (mutate) return undefined;\n    return { value: undefined, remainder: [] };\n  }\n\n  const index = randomIndex(array, rand);\n  if (mutate) {\n    // Return bare value\n    const v = array[ index ];\n    array.splice(index, 1)\n    return v;\n  } else {\n    // Copy array, remove item from that\n    const inputCopy = [ ...array ];\n    inputCopy.splice(index, 1);\n    return {\n      value: array[ index ],\n      remainder: inputCopy,\n    };\n  }\n};\n\n\n/**\n * Returns random element.\n *\n * ```js\n * const v = [`blue`, `red`, `orange`];\n * randomElement(v); // Yields `blue`, `red` or `orange`\n * ```\n *\n * Use {@link randomIndex} if you want a random index within `array`.\n *\n * @param array\n * @param rand Random generator. `Math.random` by default.\n * @returns\n */\nexport const randomElement = <V>(\n  array: ArrayLike<V>,\n  rand: RandomSource = Math.random\n): V => {\n  resultThrow(arrayTest(array, `array`));\n  return array[ Math.floor(rand() * array.length) ];\n};\n\n\n/**\n * Selects a random array index, biased by the provided `weightings`.\n * \n * In the below example, `a` will be picked 20% of the time, `b` 50% and so on.\n * ```js\n * const data =    [  `a`,  `b`,  `c`,  `d` ]\n * const weights = [ 0.2,  0.5,  0.1,  0.2 ] \n * ```\n * @param array \n * @param weightings \n * @param randomSource \n */\nexport const randomElementWeightedSource = <V>(array: ArrayLike<V>, weightings: number[], randomSource: RandomSource = Math.random) => {\n  if (array.length !== weightings.length) throw new Error(`Lengths of 'array' and 'weightings' should be the same.`);\n  const r = weightedIndex(weightings, randomSource);\n  return (): V => {\n    const index = r();\n    return array[ index ];\n  }\n}\n\n/**\n * Returns a shuffled copy of the input array.\n * @example\n * ```js\n * const d = [1, 2, 3, 4];\n * const s = shuffle(d);\n * // d: [1, 2, 3, 4], s: [3, 1, 2, 4]\n * ```\n * @param dataToShuffle\n * @param rand Random generator. `Math.random` by default.\n * @returns Copy with items moved around randomly\n * @typeParam V - Type of array items\n */\nexport const shuffle = <V>(\n  dataToShuffle: readonly V[],\n  rand: RandomSource = Math.random\n): V[] => {\n  const array = [ ...dataToShuffle ];\n  for (let index = array.length - 1; index > 0; index--) {\n    const index_ = Math.floor(rand() * (index + 1));\n    [ array[ index ], array[ index_ ] ] = [ array[ index_ ], array[ index ] ];\n  }\n  return array;\n};","import { numberTest, resultThrow } from \"@ixfx/guards\";\nimport type { RandomSource } from \"./types.js\";\n\n/**\n * Chance of returning `a` or `b`, based on threshold `p`.\n * \n * `p` sets the threshold for picking `b`. The higher the value (up to 1),\n * the more likely `b` will be picked.\n * \n * ```js\n * // 50% of the time it will return 100, 50% 110\n * chance(0.5, 100, 110);\n * // 90% of the time it will yield 110, 10% it will yield 100\n * chance(0.9, 100, 110);\n * ```\n * \n * @param p Threshold to choose option B (value or function)\n * @param a Value or function for option A\n * @param b Value or function for option B\n * @param randomSource Source of random numbers\n * @returns \n */\nexport const chance = <T>(p: number | (() => number), a: T | (() => T), b: T | (() => T), randomSource?: RandomSource): T => {\n  const source = randomSource ?? Math.random;\n  const resolve = <V>(x: V | (() => V)): V => {\n    if (typeof x === `function`) return (x as () => V)();\n    return x;\n  }\n\n  const pp = resolve(p);\n\n  resultThrow(numberTest(pp, `percentage`, `p`));\n\n  if (source() <= pp) {\n    return resolve(b);\n  } else {\n    return resolve(a);\n  }\n}","import { numberTest, resultThrow } from '@ixfx/guards';\nimport { type RandomNumberOptions, type RandomSource } from \"./types.js\";\n\n/**\n * Source for random bipolar values\n * ```js\n * const r = bipolarSource();\n * r(); // Produce random value on -1...1 scale\n * ```\n * \n * Options can be provided, for example\n * ```js\n * // -0.5 to 0.5 range\n * bipolarSource({ max: 0.5 });\n * ```\n * \n * \n * @param maxOrOptions Maximum value (number) or options for random generation\n * @returns \n */\nexport const bipolarSource = (maxOrOptions?: number | RandomNumberOptions): RandomSource => {\n  const source = floatSource(maxOrOptions);\n  return () => (source() * 2) - 1;\n}\n\n/**\n * Returns a random bipolar value\n * ```js\n * const r = bipolar(); // -1...1 random\n * ```\n * \n * Options can be provided, eg.\n * ```js\n * bipolar({ max: 0.5 }); // -0.5..0.5 random\n * ```\n * \n * Use {@link bipolarSource} if you want to generate random\n * values with same settings repeatedly.\n * @param maxOrOptions \n * @returns \n */\nexport const bipolar = (maxOrOptions?: number | RandomNumberOptions): number => {\n  const source = bipolarSource(maxOrOptions);\n  return source();\n}\n\n/**\n * Returns a function that produces random float values.\n * Use {@link float} to produce a valued directly.\n *\n * Random float between `max` (exclusive) and 0 (inclusive). Max is 1 if unspecified.\n *\n *\n * ```js\n * // Random number between 0..1 (but not including 1)\n * // (this would be identical to Math.random())\n * const r = floatSource();\n * r(); // Execute to produce random value\n *\n * // Random float between 0..100 (but not including 100)\n * const v = floatSource(100)();\n * ```\n *\n * Options can be used:\n * ```js\n * // Random float between 20..40 (possibly including 20, but always lower than 40)\n * const r = floatSource({ min: 20, max: 40 });\n * ```\n * @param maxOrOptions Maximum value (exclusive) or options\n * @returns Random number\n */\nexport const floatSource = (maxOrOptions: (number | RandomNumberOptions) = 1): RandomSource => {\n  const options = typeof maxOrOptions === `number` ? { max: maxOrOptions } : maxOrOptions;\n  let max = options.max ?? 1;\n  let min = options.min ?? 0;\n  const source = options.source ?? Math.random;\n\n  resultThrow(\n    numberTest(min, ``, `min`),\n    numberTest(max, ``, `max`)\n  );\n\n  if (!options.min && max < 0) {\n    min = max;\n    max = 0;\n  }\n  if (min > max) {\n    throw new Error(`Min is greater than max. Min: ${ min.toString() } max: ${ max.toString() }`);\n  }\n\n  return () => source() * (max - min) + min;\n};\n\n/**\n * Returns a random float between `max` (exclusive) and 0 (inclusive). \n * \n * Max is 1 if unspecified.\n * Use {@link floatSource} to get a function that produces values. This is used internally.\n *\n * ```js\n * // Random number between 0..1 (but not including 1)\n * // (this would be identical to Math.random())\n * const v = float();\n * // Random float between 0..100 (but not including 100)\n * const v = float(100);\n * ```\n *\n * Options can be used:\n * ```js\n * // Random float between 20..40 (possibly including 20, but always lower than 40)\n * const v = float({ min: 20, max: 40 });\n * ```\n * @param maxOrOptions Maximum value (exclusive) or options\n * @returns Random number\n */\nexport const float = (maxOrOptions: (number | RandomNumberOptions) = 1): number =>\n  floatSource(maxOrOptions)();","import type { RandomSource } from \"./types.js\";\n\n/**\n * Keeps generating a random number until\n * it's not 0\n * @param source Random number generator \n * @returns Non-zero number\n */\nexport const calculateNonZero = (source: RandomSource = Math.random) => {\n  let v = 0;\n  while (v === 0) {\n    v = source();\n  }\n  return v;\n}","import { calculateNonZero } from \"./non-zero.js\";\nimport type { RandomSource } from \"./types.js\";\n\n/**\n * Returns a random number with gaussian (ie. bell-curved) distribution\n * \n * @example Random number between 0..1 with gaussian distribution\n * ```js\n * gaussian();\n * ```\n * \n * @example Distribution can be skewed\n * ```js\n * gaussian(10);\n * ```\n * \n * Use {@link gaussianSource} if you want a function with skew value baked-in.\n * @param skew Skew factor. Defaults to 1, no skewing. Above 1 will skew to left, below 1 will skew to right\n * @returns \n */\nexport const gaussian = (skew = 1) => gaussianSource(skew)();\n\n/**\n * Returns a function that generates a gaussian-distributed random number\n * @example\n * Random number between 0..1 with gaussian distribution\n * ```js\n * // Create function\n * const r = gaussianSource();\n *\n * // Generate random value\n * r();\n * ```\n *\n * @example\n * Pass the random number generator elsewhere\n * ```js\n * const r = gaussianSource(10);\n *\n * // Randomise array with gaussian distribution\n * Arrays.shuffle(r);\n * ```\n * \n * If you want to fit a value to a gaussian curve, see Modulation.gaussian instead.\n * @param skew\n * @returns\n */\nexport const gaussianSource = (skew = 1): RandomSource => {\n  const min = 0;\n  const max = 1;\n  // Source: https://stackoverflow.com/questions/25582882/javascript-math-random-normal-distribution-gaussian-bell-curve\n\n  const compute = (): number => {\n    const u = calculateNonZero();\n    const v = calculateNonZero();\n    let result = Math.sqrt(-2 * Math.log(u)) * Math.cos(2 * Math.PI * v);\n\n    result = result / 10 + 0.5; // Translate to 0 -> 1\n    if (result > 1 || result < 0) {\n      result = compute(); //;gaussian(skew); // resample between 0 and 1 if out of range\n    } else {\n      result = Math.pow(result, skew); // Skew\n      result *= max - min; // Stretch to fill range\n      result += min; // offset to min\n    }\n    return result;\n  };\n  return compute;\n};","import type { RandomSource } from \"./types.js\";\n\n/**\n * Generates a six-digit roughly unique id\n * ```js\n * const id = shortGuid();\n * ```\n * @param options Options.\n * @returns\n */\nexport const shortGuid = (options: Readonly<{ source?: RandomSource }> = {}) => {\n  const source = options.source ?? Math.random;\n  // Via Stackoverflow...\n  const firstPart = Math.trunc(source() * 46_656);\n  const secondPart = Math.trunc(source() * 46_656);\n  const firstPartString = `000${ firstPart.toString(36) }`.slice(-3);\n  const secondPartString = `000${ secondPart.toString(36) }`.slice(-3);\n  return firstPartString + secondPartString;\n};","import { integerTest, resultThrow } from \"@ixfx/guards\";\n\n/**\n * Yields `amount` integers, counting by one from zero. If a negative amount is used,\n * count decreases. If `offset` is provided, this is added to the return result.\n * @example\n * ```js\n * const a = [...count(5)]; // Yields five numbers: [0,1,2,3,4]\n * const b = [...count(-5)]; // Yields five numbers: [0,-1,-2,-3,-4]\n * for (const v of count(5, 5)) {\n *  // Yields: 5, 6, 7, 8, 9\n * }\n * const c = [...count(5,1)]; // Yields [1,2,3,4,5]\n * ```\n *\n * @example Used with forEach\n * ```js\n * // Prints `Hi` 5x\n * forEach(count(5), () => // do something);\n * ```\n *\n * If you want to accumulate return values, consider using Flow.repeat.\n *\n * @example Run some code every 100ms, 10 times:\n * ```js\n * import { interval } from '@ixfx/flow.js'\n * import { count } from '@ixfx/numbers.js'\n * const counter = count(10);\n * for await (const v of interval(counter, { fixedIntervalMs: 100 })) {\n *  // Do something\n * }\n * ```\n * @param amount Number of integers to yield\n * @param offset Added to result\n */\nexport function* count(amount: number, offset = 0): Generator<number, void, void> {\n  resultThrow(\n    integerTest(amount, ``, `amount`),\n    integerTest(offset, ``, `offset`)\n  );\n  if (amount === 0) return;\n\n  let index = 0;\n  do {\n    yield (amount < 0 ? -index + offset : index + offset);\n  } while (index++ < Math.abs(amount) - 1);\n};","import { numberTest, integerTest, resultThrow } from \"@ixfx/guards\";\nimport type { GenerateRandomOptions, RandomNumberOptions, RandomSource } from \"./types.js\";\nimport { count } from \"./util/count.js\";\nimport { shuffle } from \"./arrays.js\";\n\n/**\n * Returns a function that produces a random integer between `max` (exclusive) and 0 (inclusive)\n * Use {@link integer} if you want a random number directly.\n *\n * Invoke directly:\n * ```js\n * integerSource(10)();  // Random number 0-9\n * ```\n *\n * Or keep a reference to re-compute:\n * ```js\n * const r = integerSource(10);\n * r(); // Produce a random integer\n * ```\n *\n * If a negative value is given, this is assumed to be the\n * minimum (inclusive), with 0 as the max (inclusive)\n * ```js\n * integerSource(-5)();  // Random number from -5 to 0\n * ```\n *\n * Specify options for a custom minimum or source of random:\n * ```js\n * integerSource({ max: 5,  min: 10 })();  // Random number 4-10\n * integerSource({ max: -5, min: -10 })(); // Random number from -10 to -6\n * integerSource({ max: 10, source: Math.random })(); // Random number between 0-9, with custom source of random\n * ```\n *\n * Throws an error if max & min are equal\n * @param maxOrOptions Max value (exclusive), or set of options\n * @returns Random integer\n */\nexport const integerSource = (maxOrOptions: number | RandomNumberOptions): RandomSource => {\n  if (typeof maxOrOptions === `undefined`) {\n    throw new TypeError(`maxOrOptions is undefined`);\n  }\n  const options = typeof maxOrOptions === `number` ? { max: maxOrOptions } : maxOrOptions;\n  let max = Math.floor(options.max ?? 100);\n  let min = Math.floor(options.min ?? 0);\n\n  // If we just get -5 as the max, invert so\n  // max:1 and min: -5 instead for -5...0 range\n  if (!options.min && max < 0) {\n    max = 1;\n    min = options.max ?? 0;\n  }\n  const randomSource = options.source ?? Math.random;\n  if (min > max) {\n    throw new Error(`Min value is greater than max (min: ${ min.toString() } max: ${ max.toString() })`);\n  }\n\n  resultThrow(\n    numberTest(min, ``, `min`),\n    numberTest(max, ``, `max`)\n  );\n\n  if (max === min) {\n    throw new Error(`Max and min values cannot be the same (${ max.toString() })`);\n  }\n\n  // Distance\n  const amt = Math.abs(max - min);\n  return () => Math.floor(randomSource() * amt) + min;\n};\n\n/**\n * Returns a random integer between `max` (exclusive) and 0 (inclusive)\n * Use {@link integerSource} to return a function instead.\n *\n * ```js\n * integer(10);  // Random number 0,1..9\n * ```\n *\n * If a negative value is given, this is assumed to be the\n * minimum (inclusive), with 0 as the max (inclusive)\n * ```js\n * integer(-5);  // Random number -5,-4,...0\n * ```\n *\n * Specify options for a custom minimum or source of random:\n * ```js\n * integer({ max: 5,  min: 10 });  // Random number 4-10\n * integer({ max: -5, min: -10 }); // Random number from -10 to -6\n * integer({ max: 10, source: Math.random }); // Random number between 0-9, with custom source of random\n * ```\n *\n * Throws an error if max & min are equal\n * @param maxOrOptions Max value (exclusive), or set of options\n * @returns Random integer\n */\nexport const integer = (maxOrOptions: number | RandomNumberOptions): number =>\n  integerSource(maxOrOptions)();\n\n/**\n * Returns a generator over random unique integers, up to\n * but not including the given max value.\n *\n * @example 0..9 range\n * ```js\n * const rand = [ ...integerUniqueGen(10) ];\n * // eg: [2, 9, 6, 0, 8, 7, 3, 4, 5, 1]\n * ```\n *\n * @example Options can be provided:\n * ```js\n * // 5..9 range\n * const rand = [ ...integerUniqueGen({ min: 5, max: 10 })];\n * ```\n *\n * Range can be looped. Once the initial random walk through the number\n * range completes, it starts again in a new random way.\n *\n * ```js\n * for (const r of integerUniqueGen({ max: 10, loop: true })) {\n *  // Warning: loops forever\n * }\n * ```\n *\n * Behind the scenes, an array of numbers is created that captures the range, this is then\n * shuffled on the first run, and again whenever the iterator loops, if that's allowed.\n *\n * As a consequence, large ranges will consume larger amounts of memory.\n * @param maxOrOptions\n * @returns\n */\nexport function* integerUniqueGen(\n  maxOrOptions: number | GenerateRandomOptions\n): IterableIterator<number> {\n  const options = typeof maxOrOptions === `number` ? { max: maxOrOptions } : maxOrOptions;\n  const min = options.min ?? 0;\n  const max = options.max ?? 100;\n  const source = options.source ?? Math.random;\n  const loop = options.loop ?? false;\n\n  resultThrow(\n    integerTest(min, ``, `min`),\n    integerTest(max, ``, `max`)\n  )\n\n  if (min > max) {\n    throw new Error(`Min value is greater than max. Min: ${ min.toString() } Max: ${ max.toString() }`);\n  }\n\n  const origRange = [ ...count(max - min, min) ];\n  let numberRange = shuffle(origRange);\n  let index = 0;\n\n  while (true) {\n    if (index === numberRange.length) {\n      if (loop) numberRange = shuffle(origRange, source);\n      else return;\n    }\n    yield numberRange[ index++ ];\n  }\n}\n","/**\n * Reproducible random values using the Merseene Twister algorithm.\n * With the same seed value, it produces the same series of random values.\n * \n * ```js\n * // Seed with a value of 100\n * const r = mersenneTwister(100);\n * r.float();         // 0..1\n * ```\n * \n * Integer values can also be produced. First parameter\n * is the maximum value (exclusive), the optional second\n * parameter is the minimum value (inclusive).\n * ```js\n * r.integer(10);     // 0..9\n * r.integer(10, 5);  // 5..9\n * \n * // Eg random array index:\n * r.integer(someArray.length);\n * ```\n * \n * Adapted from George MacKerron's implementation. MIT License.\n * https://github.com/jawj/mtwist/\n * @param seed Seed value 0..4294967295. Default: random seed.\n */\nexport function mersenneTwister(seed?: number | undefined) {\n  if (!seed) seed = Math.random() * 4294967295;\n\n  // Initialisation\n  let mt = new Array(624);\n  mt[ 0 ] = seed >>> 0;\n  const n1 = 1812433253;\n  for (let mti = 1; mti < 624; mti++) {\n    const n2 = mt[ mti - 1 ] ^ (mt[ mti - 1 ] >>> 30);\n    // uint32 multiplication, low 16 bits and high 16 bits multiplied separately and reassembled:\n    mt[ mti ] = ((((n1 & 0xffff0000) * n2) >>> 0) + (((n1 & 0x0000ffff) * n2) >>> 0) + mti) >>> 0;\n  }\n  let mti = 624;\n\n  const randomUint32 = () => {\n    let y;\n    if (mti >= 624) {\n      for (let i = 0; i < 227; i++) {\n        y = ((mt[ i ] & 0x80000000) | (mt[ i + 1 ] & 0x7fffffff)) >>> 0;\n        mt[ i ] = (mt[ i + 397 ] ^ (y >>> 1) ^ (y & 1 ? 0x9908b0df : 0)) >>> 0;\n      }\n      for (let i = 227; i < 623; i++) {\n        y = ((mt[ i ] & 0x80000000) | (mt[ i + 1 ] & 0x7fffffff)) >>> 0;\n        mt[ i ] = (mt[ i - 227 ] ^ (y >>> 1) ^ (y & 1 ? 0x9908b0df : 0)) >>> 0;\n      }\n      y = ((mt[ 623 ] & 0x80000000) | (mt[ 0 ] & 0x7fffffff)) >>> 0;\n      mt[ 623 ] = (mt[ 396 ] ^ (y >>> 1) ^ (y & 1 ? 0x9908b0df : 0)) >>> 0;\n      mti = 0;\n    }\n    y = mt[ mti++ ];\n    y = (y ^ (y >>> 11)) >>> 0;\n    y = (y ^ ((y << 7) & 0x9d2c5680)) >>> 0;\n    y = (y ^ ((y << 15) & 0xefc60000)) >>> 0;\n    y = (y ^ (y >>> 18)) >>> 0;\n    return y;\n  }\n\n  const float = () => randomUint32() / 4294967296;// 2^32\n\n  // Max is exclusive\n  const integer = (maxExclusive: number, minInclusive: number = 0) => {\n    if (maxExclusive < 1) throw new Error(\"Upper bound must be greater than or equal to 1\");\n    if (maxExclusive > 4294967296) throw new Error(\"Upper bound must not be greater than 4294967296\");\n    if (maxExclusive === 1) return 0;\n    let range = maxExclusive - minInclusive;\n    const\n      bitsNeeded = Math.ceil(Math.log2(range)),\n      bitMask = (1 << bitsNeeded) - 1;\n    while (true) {\n      const int = randomUint32() & bitMask;\n      if (int < range) return minInclusive + int;\n    }\n  }\n\n  return { integer, float };\n}","import { type StringOptions } from \"./types.js\";\n\n/**\n * Returns a string of random letters and numbers of a given `length`.\n *\n * ```js\n * string();  // Random string of length 5\n * string(4); // eg. `4afd`\n * ```\n * @param lengthOrOptions Length of random string, or options.\n * @returns Random string\n */\nexport const string = (lengthOrOptions: number | StringOptions = 5) => {\n  const options =\n    typeof lengthOrOptions === `number` ? { length: lengthOrOptions } : lengthOrOptions;\n  const calculate = options.source ?? Math.random;\n  const length = options.length ?? 5\n  let returnValue = ``;\n  while (returnValue.length < length) {\n    returnValue += calculate()\n      .toString(36)\n      .slice(2);\n  }\n  return returnValue.substring(0, length);\n};\n","import { integer, integerSource } from \"./integer.js\";\nimport type { RandomNumberOptions, RandomSource } from \"./types.js\";\n\n/**\n * Returns a random number of minutes, with a unit of milliseconds.\n * \n * Max value is exclusive, defaulting to 5.\n * Use {@link minutesMs} to get a value directly, or {@link minutesMsSource} to return a function.\n *\n * @example Random value from 0 to one milli less than 5 * 60 * 1000\n * ```js\n * // Create function that returns value\n * const f = minutesMsSource(5);\n *\n * f(); // Generate value\n * ```\n *\n * @example Specified options:\n * ```js\n * // Random time between one minute and 5 minutes\n * const f = minutesMsSource({ max: 5, min: 1 });\n * f();\n * ```\n *\n * @remarks\n * It's a very minor function, but can make\n * code a little more literate:\n * ```js\n * // Random timeout of up to 5 mins\n * setTimeout(() => { ... }, minutesMsSource(5));\n * ```\n * @param maxMinutesOrOptions\n * @see {@link minutesMs}\n * @returns Function that produces a random value\n */\nexport const minutesMsSource = (\n  maxMinutesOrOptions: number | RandomNumberOptions\n): RandomSource => {\n  const options =\n    typeof maxMinutesOrOptions === `number`\n      ? { max: maxMinutesOrOptions }\n      : maxMinutesOrOptions;\n  const min = (options.min ?? 0) * 60 * 1000;\n  const max = (options.max ?? 5) * 60 * 1000;\n  return integerSource({ ...options, max, min });\n};\n\n\n/**\n * Return a random time value in milliseconds, using minute values to set range.\n * \n * @example Random value from 0 to one milli less than 5 * 60 * 1000\n * ```js\n * // Random value from 0 to one milli less than 5*60*1000\n * minuteMs(5);\n * ```\n *\n * @example Specified options:\n * ```js\n * // Random time between one minute and 5 minutes\n * minuteMs({ max: 5, min: 1 });\n * ```\n *\n * @param maxMinutesOrOptions\n * @see {@link minutesMsSource}\n * @returns Milliseconds\n */\nexport const minutesMs = (maxMinutesOrOptions: number | RandomNumberOptions): number =>\n  minutesMsSource(maxMinutesOrOptions)();\n\n\n/**\n * Returns function which produces a random number of seconds, with a unit of milliseconds.\n * \n * Maximum value is exclusive, defaulting to 5\n * Use {@link secondsMs} to return a random value directly, or {@link secondsMsSource} to return a function.\n *\n * @example Random milliseconds between 0..4999\n * ```js\n * // Create function\n * const f = secondsMsSource(5000);\n * // Produce a value\n * const value = f();\n * ```\n *\n * @example Options can be provided\n * ```js\n * // Random milliseconds between 1000-4999\n * const value = secondsMsSource({ max:5, min:1 })();\n * // Note the extra () at the end to execute the function\n * ```\n *\n * @remarks\n * It's a very minor function, but can make\n * code a little more literate:\n * ```js\n * // Random timeout of up to 5 seconds\n * setTimeout(() => { ...}, secondsMsSource(5));\n * ```\n * @param maxSecondsOrOptions Maximum seconds, or options.\n * @returns Milliseconds\n */\nexport const secondsMsSource = (\n  maxSecondsOrOptions: number | RandomNumberOptions\n): RandomSource => {\n  const options =\n    typeof maxSecondsOrOptions === `number`\n      ? { max: maxSecondsOrOptions }\n      : maxSecondsOrOptions;\n  const min = (options.min ?? 0) * 1000;\n  const max = (options.max ?? 5) * 1000;\n  return () => integer({ ...options, max, min });\n};\n\n/**\n * Generate random time in milliseconds, using seconds to set the bounds\n * \n * @example Random milliseconds between 0..4999\n * ```js\n * secondsMs(5000);\n * ```\n *\n * @example Options can be provided\n * ```js\n * // Random milliseconds between 1000-4999\n * secondsMs({ max:5, min:1 });\n * ```\n * @param maxSecondsOrOptions\n * @returns\n */\nexport const secondsMs = (maxSecondsOrOptions: number | RandomNumberOptions): number =>\n  secondsMsSource(maxSecondsOrOptions)();","export function clamp(v:number, min:number = 0, max:number = 1) {\n  if (v < min) return min;\n  if (v > max) return max;\n  return v;\n}","import { type RandomSource, type WeightedOptions } from \"./types.js\";\nimport { clamp } from \"./util/clamp.js\";\n/**\n * Random integer, weighted according to an easing function.\n * Number will be inclusive of `min` and below `max`.\n *\n * @example 0..99\n * ```js\n * const r = Random.weightedIntegerFn(100);\n * r(); // Produce value\n * ```\n *\n * @example 20..29\n * ```js\n * const r = Random.weightedIntegerFn({ min: 20, max: 30 });\n * r(); // Produce value\n * ```\n *\n * @example  0..99 with 'quadIn' easing\n * ```js\n * const r = Random.weightedInteger({ max: 100, easing: `quadIn` });\n * ```\n *\n * Note: result from easing function will be clamped to\n * the min/max (by default 0-1);\n *\n * @param options Options. By default { max:1, min: 0 }\n * @returns Function that produces a random weighted integer\n */\nexport const weightedIntegerSource = (\n  options: WeightedOptions\n): RandomSource => {\n\n  const source = options.source ?? Math.random;\n  if (typeof options.easingFunction === `undefined`) throw new Error(`Param 'easingFunction' is undefined`);\n\n  const max = options.max ?? 1;\n  const min = options.min ?? 0;\n\n  if (max === min) throw new Error(`Param 'max' is the same as  'min'`);\n  if (max < min) throw new Error(`Param 'max' should be greater than  'min'`);\n\n  const compute = (): number => {\n    const r = clamp(options.easingFunction(source()));\n    return Math.floor(r * (max - min)) + min;\n  };\n  return compute;\n};\n\n/**\n * Generate a weighted-random integer.\n * \n * @example 0..99\n * ```js\n * Random.weightedInteger(100);\n * ```\n *\n * @example 20..29\n * ```js\n * Random.weightedInteger({ min: 20, max: 30 });\n * ```\n *\n * @example  0..99 with 'quadIn' easing\n * ```js\n * Random.weightedInteger({ max: 100, easing: `quadIn` })\n * ```\n * @param options Options. Default: { max: 1, min: 0 }\n * @returns Random weighted integer\n */\nexport const weightedInteger = (options: WeightedOptions): number =>\n  weightedIntegerSource(options)();","import { type RandomSource, type WeightedOptions } from './types.js';\n\n\n/***\n * Returns a random number, 0..1, weighted by a given easing function.\n * See @ixfx/modulation.weighted to use a named easing function.\n * Use {@link weightedSource} to return a function instead.\n *\n * @see {@link weightedSource} Returns a function rather than value\n * @returns Random number (0-1)\n */\nexport const weighted = (\n  options: WeightedOptions\n): number => weightedSource(options)();\n\n/***\n * Returns a random number, 0..1, weighted by a given easing function.\n * See @ixfx/modulation.weighted to use a named easing function.\n * Use {@link weighted} to get a value directly.\n *\n * @see {@link weighted} Returns value instead of function\n * @returns Function which returns a weighted random value\n */\nexport const weightedSource = (\n  options: WeightedOptions\n): RandomSource => {\n  const source = options.source ?? Math.random;\n  if (typeof options.easing !== `undefined`) throw new Error(`Param 'easingName' unavailable. Use @ixfx/modulation.weighted instead.`);\n  if (typeof options.easingFunction === `undefined`) throw new Error(`Param 'easingFunction' is undefined`);\n  return (): number => options.easingFunction(source());\n};","import * as Mp from '@mediapipe/tasks-vision';\nimport { Points, type Point } from 'ixfx/geometry.js';\nimport { shortGuid } from 'ixfx/random.js';\nimport type { PoseData, PoseMatcherOptions, Verbosity } from '../types.js';\nimport { Log } from '../util/log.js';\n\nclass TrackedPose {\n  centroid: Point = Points.Empty;\n  firstSeen: number = performance.now();\n  lastSeen: number = performance.now();\n  id: string = shortGuid();\n  constructor() {\n\n  }\n}\n\n\n\nexport const getLowest = <T>(data: Array<T>, fn: (d: T) => number) => {\n  const ranked = data.map(d => fn(d));\n  let index = -1;\n  let score = Number.MAX_SAFE_INTEGER;\n  for (let i = 0; i < ranked.length; i++) {\n    if (ranked[ i ]! < score) {\n      score = ranked[ i ]!;\n      index = i;\n    }\n  }\n  if (index === -1) return undefined;\n  return { data: data[ index ], score };\n}\n\nexport class PoseMatcher {\n  tracked: TrackedPose[] = [];\n  distanceThreshold: number;\n  ageThreshold: number;\n  lastPrune = 0;\n  log;\n\n  constructor(opts: PoseMatcherOptions) {\n    this.distanceThreshold = opts.distanceThreshold;\n    this.ageThreshold = opts.maxAgeMs;\n    this.log = new Log(`PoseMatcher`, opts.verbosity);\n  }\n\n  *toPoses(poses: Mp.PoseLandmarkerResult) {\n    for (let i = 0; i < poses.landmarks.length; i++) {\n      yield this.toPose(poses.landmarks[ i ]!, poses.worldLandmarks[ i ]!);\n    }\n  }\n\n\n  toPose(n: Mp.NormalizedLandmark[], l: Mp.Landmark[]): PoseData {\n    const c = Points.centroid(n[ 12 ], n[ 11 ], n[ 24 ], n[ 23 ]);\n\n    const now = performance.now();\n    if (now - this.lastPrune > this.ageThreshold) {\n      // Remove dead poses\n      let pre = this.tracked.length;\n      this.tracked = this.tracked.filter(d => {\n        const age = (now - d.lastSeen);\n        if (age > this.ageThreshold) return false;\n        return true;\n      })\n      this.lastPrune = now;\n      let post = this.tracked.length;\n      if (post < pre) {\n        this.log.debug(`Pruned: ${ pre - post } expired pose(s)`);\n      }\n    }\n    // Get existing pose with closest distance\n    const closest = getLowest(this.tracked, d => Points.distance(d.centroid, c));\n\n    let target: TrackedPose | undefined;\n    if (!closest || closest.score > this.distanceThreshold) {\n      if (closest) {\n        this.log.info(`Closest match exceeds threshold. Score: ${ closest?.score } Threshold: ${ this.distanceThreshold }`);\n      } else {\n        this.log.info(`No poses`);\n      }\n      // No existing poses, or it exceeds threshold\n      target = new TrackedPose();\n      this.tracked.push(target);\n    } else {\n      target = closest.data!;\n    }\n    target.lastSeen = now;\n    target.centroid = c;\n    return {\n      poseid: target.id,\n      landmarks: n,\n      world: l\n    }\n  }\n\n}\n\n","export const makeModelPath = (basePath: string, provided: string, presets: Record<string, string>) => {\n  if (provided in presets) {\n    const url = presets[ provided ];\n    console.log(`Using model preset '${ provided }' Url: ${ url }`);\n    return url;\n  }\n  if (provided.startsWith(`http`)) return provided;\n  return basePath + provided;\n}","import * as Mp from '@mediapipe/tasks-vision';\nimport type { CommonModelOptions, ComputeCallback, IModel, Options, PoseDetectorOptions } from '../types.js';\nimport { PoseMatcher } from './pose-matcher.js';\nimport { Log } from '../util/log.js';\nimport { makeModelPath } from './makeModelPath.js';\n// https://ai.google.dev/edge/mediapipe/solutions/vision/pose_landmarker/web_js#configuration_options\n\nexport class PoseDetector implements IModel {\n  lp: Mp.PoseLandmarker | undefined;\n  opts: PoseDetectorOptions;\n  matcher: PoseMatcher;\n  log;\n\n  constructor(readonly p: CommonModelOptions, opts: Partial<PoseDetectorOptions> = {}) {\n    this.opts = {\n      ...PoseDetector.defaults(),\n      ...opts\n    };\n    this.log = new Log(`PoseDetector`, this.opts.verbosity);\n    this.matcher = new PoseMatcher(this.opts.matcher);\n  }\n\n  static defaults(): PoseDetectorOptions {\n    return {\n      numPoses: 5,\n      minPoseDetectionConfidence: 0.3,\n      minPosePresenceConfidence: 0.3,\n      minTrackingConfidence: 0.3,\n      outputSegmentationMasks: false,\n      modelPath: 'pose_landmarker_full.task',\n      verbosity: `errors`,\n      matcher: {\n        distanceThreshold: 0.1,\n        maxAgeMs: 2000,\n        verbosity: `errors`\n      },\n      presetModelPaths: {\n        lite: 'https://storage.googleapis.com/mediapipe-models/pose_landmarker/pose_landmarker_lite/float16/latest/pose_landmarker_lite.task',\n        full: 'https://storage.googleapis.com/mediapipe-models/pose_landmarker/pose_landmarker_full/float16/latest/pose_landmarker_full.task',\n        heavy: 'https://storage.googleapis.com/mediapipe-models/pose_landmarker/pose_landmarker_heavy/float16/latest/pose_landmarker_heavy.task'\n      }\n    }\n  }\n  compute(v: Mp.ImageSource, callback: ComputeCallback, timestamp: number) {\n    this.lp?.detectForVideo(v, timestamp, poses => {\n      const matched = [ ...this.matcher.toPoses(poses) ];\n      callback(matched);\n    });\n  }\n\n  async init() {\n    const p = this.p;\n    const v = await Mp.FilesetResolver.forVisionTasks(p.wasmBase);\n    const opts = this.opts;\n    const presets = this.opts.presetModelPaths ?? PoseDetector.defaults().presetModelPaths as Record<string, string>\n    const mpOpts: Mp.PoseLandmarkerOptions = {\n      baseOptions: {\n        modelAssetPath: makeModelPath(p.modelsBase, opts.modelPath, presets),\n        delegate: `GPU`\n      },\n      runningMode: `VIDEO`,\n      numPoses: opts.numPoses,\n      minPoseDetectionConfidence: opts.minPoseDetectionConfidence,\n      minPosePresenceConfidence: opts.minPosePresenceConfidence,\n      minTrackingConfidence: opts.minTrackingConfidence,\n      outputSegmentationMasks: opts.outputSegmentationMasks\n    };\n    this.log.info(mpOpts);\n    this.lp = await Mp.PoseLandmarker.createFromOptions(v, mpOpts);\n    return true;\n  }\n\n  set minPoseDetectionConfidence(value: number) {\n    this.opts = {\n      ...this.opts,\n      minPoseDetectionConfidence: value\n    }\n    this.lp?.setOptions({ minPoseDetectionConfidence: value });\n  }\n\n  get minPoseDetectionConfidence() {\n    return this.opts.minPoseDetectionConfidence;\n  }\n\n  set minPosePresenceConfidence(value: number) {\n    this.opts = {\n      ...this.opts,\n      minPosePresenceConfidence: value\n    }\n    this.lp?.setOptions({ minPosePresenceConfidence: value });\n  }\n\n  get minPosePresenceConfidence() {\n    return this.opts.minPosePresenceConfidence;\n  }\n\n  set minTrackingConfidence(value: number) {\n    this.opts = {\n      ...this.opts,\n      minTrackingConfidence: value\n    }\n    this.lp?.setOptions({ minTrackingConfidence: value });\n  }\n\n  get minTrackingConfidence() {\n    return this.opts.minTrackingConfidence;\n  }\n\n  set numPoses(value: number) {\n    this.opts = {\n      ...this.opts,\n      numPoses: value\n    }\n    this.lp?.setOptions({ numPoses: value });\n  }\n\n  get numPoses() {\n    return this.opts.numPoses;\n  }\n\n  dispose() {\n    this.lp?.close();\n    this.lp = undefined;\n  }\n}\n","import type { ImageSource } from \"@mediapipe/tasks-vision\";\nimport { type IModel, type ComputeCallback, type ObjectDetectorOptions, type Options, type CommonModelOptions } from \"../types.js\";\nimport * as Mp from '@mediapipe/tasks-vision';\nimport { Log } from \"../util/log.js\";\nimport { makeModelPath } from \"./makeModelPath.js\";\n\nexport class ObjectDetector implements IModel {\n  od: Mp.ObjectDetector | undefined;\n  opts: ObjectDetectorOptions;\n  log;\n\n  constructor(readonly p: CommonModelOptions, options: Partial<ObjectDetectorOptions> = {}) {\n    this.opts = {\n      ...ObjectDetector.defaults(),\n      ...options\n    };\n    this.log = new Log(`ObjectDetector`, this.opts.verbosity);\n  }\n\n\n  static defaults(): ObjectDetectorOptions {\n    return {\n      verbosity: `errors`,\n      modelPath: 'efficientdet_lite0.tflite',\n      scoreThreshold: 0.5,\n      presetModelPaths: {\n        'lite0-8': `https://storage.googleapis.com/mediapipe-models/object_detector/efficientdet_lite0/int8/latest/efficientdet_lite0.tflite`,\n        'lite0-16': `https://storage.googleapis.com/mediapipe-models/object_detector/efficientdet_lite0/float16/latest/efficientdet_lite0.tflite`,\n        'lite0-32': `https://storage.googleapis.com/mediapipe-models/object_detector/efficientdet_lite0/float16/latest/efficientdet_lite0.tflite`,\n        'lite2-8': `https://storage.googleapis.com/mediapipe-models/object_detector/efficientdet_lite2/int8/latest/efficientdet_lite2.tflite`,\n        'lite2-16': `https://storage.googleapis.com/mediapipe-models/object_detector/efficientdet_lite2/float16/latest/efficientdet_lite2.tflite`,\n        'lite2-32': `https://storage.googleapis.com/mediapipe-models/object_detector/efficientdet_lite2/float32/latest/efficientdet_lite2.tflite`,\n        'mobilenet2-8': `https://storage.googleapis.com/mediapipe-models/object_detector/ssd_mobilenet_v2/float16/latest/ssd_mobilenet_v2.tflite`,\n        'mobilenet2-32': `https://storage.googleapis.com/mediapipe-models/object_detector/ssd_mobilenet_v2/float32/latest/ssd_mobilenet_v2.tflite`\n      }\n    }\n  }\n\n  compute(v: ImageSource, callback: ComputeCallback, timestamp: number): void {\n    const results = this.od?.detectForVideo(v, timestamp);\n    callback(results);\n  }\n\n  dispose(): void {\n    this.od?.close();\n    this.od = undefined;\n  }\n\n  async init(): Promise<boolean> {\n    const p = this.p;\n    const opts = this.opts;\n    const presets = this.opts.presetModelPaths ?? ObjectDetector.defaults().presetModelPaths as Record<string, string>;\n\n    const vision = await Mp.FilesetResolver.forVisionTasks(p.wasmBase);\n    const mpOpts: Mp.ObjectDetectorOptions = {\n      baseOptions: {\n        modelAssetPath: makeModelPath(p.modelsBase, this.opts.modelPath, presets)\n      },\n      scoreThreshold: 0.5,\n      runningMode: `VIDEO`\n    }\n    this.od = await Mp.ObjectDetector.createFromOptions(vision, mpOpts);\n\n    this.log.info(mpOpts);\n    return true;\n  }\n\n}","import type { ImageSource } from \"@mediapipe/tasks-vision\";\nimport { type IModel, type ComputeCallback, type FaceDetectorOptions, type CommonModelOptions } from \"../types.js\";\nimport * as Mp from '@mediapipe/tasks-vision';\nimport { Log } from \"../util/log.js\";\nimport { makeModelPath } from \"./makeModelPath.js\";\n\nexport class FaceDetector implements IModel {\n  fd: Mp.FaceDetector | undefined;\n  opts: FaceDetectorOptions;\n  log;\n\n  constructor(readonly p: CommonModelOptions, options: Partial<FaceDetectorOptions> = {}) {\n    this.opts = {\n      ...FaceDetector.defaults(),\n      ...options\n    }\n    this.log = new Log(`FaceDetector`, this.opts.verbosity);\n  }\n\n  static defaults(): FaceDetectorOptions {\n    return {\n      verbosity: `errors`,\n      modelPath: 'blaze_face_short_range.tflite',\n      minDetectionConfidence: 0.5,\n      minSupressionThreshold: 0.3,\n      presetModelPaths: {\n        shortRange: `https://storage.googleapis.com/mediapipe-models/face_detector/blaze_face_short_range/float16/latest/blaze_face_short_range.tflite`\n      }\n    }\n  }\n\n  compute(v: ImageSource, callback: ComputeCallback, timestamp: number): void {\n    const results = this.fd?.detectForVideo(v, timestamp);\n    callback(results);\n  }\n\n  dispose(): void {\n    this.fd?.close();\n    this.fd = undefined;\n  }\n\n  async init(): Promise<boolean> {\n    const opts = this.opts;\n    const presets = this.opts.presetModelPaths ?? FaceDetector.defaults().presetModelPaths as Record<string, string>\n    const p = this.p;\n    const vision = await Mp.FilesetResolver.forVisionTasks(p.wasmBase);\n    const mpOpts: Mp.FaceDetectorOptions = {\n      baseOptions: {\n        modelAssetPath: makeModelPath(p.modelsBase, this.opts.modelPath, presets)\n      },\n      minDetectionConfidence: opts.minDetectionConfidence,\n      minSuppressionThreshold: opts.minSupressionThreshold,\n      runningMode: `VIDEO`\n    }\n    this.log.info(mpOpts);\n    this.fd = await Mp.FaceDetector.createFromOptions(vision, mpOpts);\n    return true;\n  }\n\n}","import type { ImageSource } from \"@mediapipe/tasks-vision\";\nimport { type IModel, type ComputeCallback, type HandDetectorOptions, type CommonModelOptions } from \"../types.js\";\nimport * as Mp from '@mediapipe/tasks-vision';\nimport { Log } from \"../util/log.js\";\nimport { makeModelPath } from \"./makeModelPath.js\";\n\nexport class HandDetector implements IModel {\n  hd: Mp.HandLandmarker | undefined;\n  opts: HandDetectorOptions;\n  log;\n\n  constructor(readonly p: CommonModelOptions, options: Partial<HandDetectorOptions> = {}) {\n    this.opts = {\n      ...HandDetector.defaults(),\n      ...options\n    }\n    this.log = new Log(`HandDetector`, this.opts.verbosity);\n  }\n\n  static defaults(): HandDetectorOptions {\n    return {\n      verbosity: `errors`,\n      numHands: 2,\n      modelPath: 'hand_landmarker.task',\n      minHandDetectionConfidence: 0.5,\n      minHandPresenceConfidence: 0.5,\n      minTrackingConfidence: 0.5,\n      presetModelPaths: {\n        full: `https://storage.googleapis.com/mediapipe-models/hand_landmarker/hand_landmarker/float16/latest/hand_landmarker.task`\n      }\n    }\n  }\n\n  compute(v: ImageSource, callback: ComputeCallback, timestamp: number): void {\n    const results = this.hd?.detectForVideo(v, timestamp);\n    callback(results);\n  }\n\n  dispose(): void {\n    this.hd?.close();\n    this.hd = undefined;\n  }\n\n  async init(): Promise<boolean> {\n    const opts = this.opts;\n    const presets = this.opts.presetModelPaths ?? HandDetector.defaults().presetModelPaths as Record<string, string>;\n    const p = this.p;\n    const vision = await Mp.FilesetResolver.forVisionTasks(p.wasmBase);\n    const mpOpts: Mp.HandLandmarkerOptions = {\n      baseOptions: {\n        modelAssetPath: makeModelPath(p.modelsBase, this.opts.modelPath, presets)\n      },\n      minHandDetectionConfidence: opts.minHandDetectionConfidence,\n      minHandPresenceConfidence: opts.minHandPresenceConfidence,\n      minTrackingConfidence: opts.minTrackingConfidence,\n      numHands: opts.numHands,\n      runningMode: `VIDEO`\n    }\n    this.hd = await Mp.HandLandmarker.createFromOptions(vision, mpOpts);\n\n    this.log.info(mpOpts);\n    return true;\n  }\n\n}","import { PoseDetector } from './mediapipe/pose-detector.js';\nimport { ObjectDetector } from './mediapipe/object-detector.js';\nimport type { CommonModelOptions, FaceDetectorOptions, HandDetectorOptions, IModel, ObjectDetectorOptions, Options, PoseDetectorOptions } from './types.js';\nimport { MlVision } from './ml-vision.js';\nimport { FaceDetector } from './mediapipe/face-detector.js';\nimport { HandDetector } from './mediapipe/hand-detector.js';\nimport { Log } from './util/log.js';\nimport { validateProcessorMode, type ProcessorModes } from './processor-modes.js';\n\nexport type ProcessingStates = `queued-start` | `starting` | `started` | `stopping` | `stopped`;\n\nexport class Processing extends EventTarget {\n  #state: ProcessingStates = `stopped`;\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  #updateTimer: any;\n  #model: IModel | undefined;\n  #currentMode: ProcessorModes = `face`;\n  #videoEl: HTMLVideoElement | undefined;\n  log;\n  dispatcher;\n\n  poseOptions: PoseDetectorOptions;\n  objectDetectorOptions: ObjectDetectorOptions;\n  faceDetectorOptions: FaceDetectorOptions;\n  handDetectorOptions: HandDetectorOptions;\n  computeFreqMs: number;\n  dispatcherBound;\n  wasmBase: string;\n  modelsBase: string;\n\n  constructor(readonly mlv: MlVision, opts: Options) {\n    super();\n    this.#currentMode = opts.mode;\n    this.wasmBase = opts.wasmBase;\n    this.modelsBase = opts.modelsBase;\n    this.log = new Log(`Processing`, opts.verbosity);\n    this.dispatcher = mlv.dispatcher;\n    this.dispatcherBound = this.dispatcher.receivedData.bind(this.dispatcher);\n    this.computeFreqMs = opts.computeFreqMs;\n    this.poseOptions = opts.pose ?? PoseDetector.defaults();\n    this.objectDetectorOptions = opts.objects ?? ObjectDetector.defaults();\n    this.faceDetectorOptions = opts.face ?? FaceDetector.defaults();\n    this.handDetectorOptions = opts.hand ?? HandDetector.defaults();\n  }\n\n  stop() {\n    if (this.#state === `stopping` || this.#state === `stopped`) return;\n    this.setState(`stopping`);\n    this.#model?.dispose();\n    this.#model = undefined;\n    this.setState(`stopped`);\n  }\n\n  setMode(mode: ProcessorModes) {\n    if (mode === this.currentMode) return;\n    if (typeof mode !== `string`) throw new Error(`Expected string. Got: ${ typeof mode }`);\n    validateProcessorMode(mode);\n\n    localStorage.setItem(`last-mode`, mode);\n    const video = this.#videoEl;\n    if (!video) return;\n    this.stop();\n    this.#currentMode = mode;\n    this.start(video);\n  }\n\n  getModelOptions() {\n    const modelOpts: CommonModelOptions = {\n      wasmBase: this.wasmBase,\n      modelsBase: this.modelsBase\n    }\n    return modelOpts;\n  }\n\n  async start(video: HTMLVideoElement) {\n    this.setState(`starting`);\n    this.#videoEl = video;\n    switch (this.#currentMode) {\n      case `pose`: {\n        this.log.info(this.poseOptions);\n        this.#model = new PoseDetector(this.getModelOptions(), this.poseOptions);\n        break;\n      }\n      case `objects`: {\n        this.log.info(this.objectDetectorOptions);\n        this.#model = new ObjectDetector(this.getModelOptions(), this.objectDetectorOptions);\n        break;\n      }\n      case `face`: {\n        this.log.info(this.faceDetectorOptions);\n        this.#model = new FaceDetector(this.getModelOptions(), this.faceDetectorOptions);\n        break;\n      }\n      case `hand`: {\n        this.log.info(this.handDetectorOptions);\n        this.#model = new HandDetector(this.getModelOptions(), this.handDetectorOptions);\n        break;\n      }\n      default: {\n        throw new Error(`Unsupported mode '${ this.#currentMode }'. Expected: 'hand', 'pose', 'objects' or 'face'`)\n      }\n    }\n    if (this.#model) {\n      this.#model.init();\n      this.setState(`started`);\n    }\n  }\n\n  #run() {\n    const v = this.#videoEl;\n    if (!v) {\n      console.warn(`No video element`);\n      return;\n    }\n\n    this.#model?.compute(v, (data) => this.dispatcher.receivedData(this.#currentMode, data), performance.now());\n\n    if (this.#state === `started`) {\n      this.#updateTimer = setTimeout(() => this.#run(), this.computeFreqMs);\n    }\n  }\n\n  setState(state: ProcessingStates) {\n    if (this.#state === state) return;\n    const prior = this.#state;\n\n    if (state === `starting`) {\n      if (prior !== `stopped` && prior !== `queued-start`) throw new Error(`Cannot start when in state: ${ prior }`);\n    }\n    if (state === `started`) {\n      if (prior !== `starting`) throw new Error(`Cannot go to 'started' when state is: ${ prior }`)\n    }\n\n    this.#state = state;\n\n    if (state === `started`) {\n      this.#updateTimer = setTimeout(() => this.#run(), this.computeFreqMs);\n    } else {\n      if (this.#updateTimer) {\n        clearTimeout(this.#updateTimer);\n      }\n      this.#updateTimer = 0;\n    }\n\n    this.log.debug(`State ${ prior } -> ${ state }`);\n    this.dispatchEvent(new CustomEvent(`state`, {\n      detail: {\n        priorState: prior,\n        newState: state\n      }\n    }));\n  }\n\n  get isStarted() {\n    return this.#state === `started`;\n  }\n\n  get state() {\n    return this.#state;\n  }\n\n  get currentMode() {\n    return this.#currentMode;\n  }\n\n  get currentModel() {\n    return this.#model;\n  }\n\n  get currentModelPoseDetector(): PoseDetector {\n    if (this.#currentMode !== `pose`) {\n      throw new Error(`Current mode is not 'pose': ${ this.#currentMode }`);\n    }\n    return this.#model as PoseDetector;\n  }\n\n}","export const snipBefore = (input: string, match: string) => {\n  const pos = input.indexOf(match);\n  if (pos >= 0) {\n    return input.substring(0, pos);\n  }\n  return input\n}\n\nexport const afterMatch = (input: string, match: string) => {\n  const pos = input.indexOf(match);\n  if (pos >= 0) {\n    return input.substring(pos + match.length);\n  }\n  return input;\n}","import type { CameraOptions, SourceData } from \"../types.js\";\nimport { snipBefore } from \"../util/text.js\";\nimport type { Sources } from \"./index.js\";\n\nexport class CameraSources {\n  #disabled = false;\n  #cameras: SourceData[] = [];\n\n  constructor(private readonly sources: Sources) {\n\n  }\n\n  init() {\n    this.updateDevices();\n  }\n\n  async updateDevices() {\n    if (this.#disabled) return;\n    if (!(`mediaDevices` in navigator)) {\n      console.warn(`navigator.mediaDevices is missing -- are you running over https:// or via localhost?`);\n      this.#disabled = true;\n      return;\n    }\n    if (!('getUserMedia' in navigator.mediaDevices)) {\n      this.#disabled = true;\n      console.warn(`navigator.getUserMedia is missing -- are you running over https:// or via localhost?`)\n      return;\n    }\n\n    await navigator.mediaDevices.getUserMedia({ video: true });\n    const devices = await navigator.mediaDevices.enumerateDevices();\n\n    this.#cameras = devices.filter(d => d.kind === `videoinput`).map(d => ({\n      id: d.deviceId,\n      kind: `camera`,\n      label: snipBefore(d.label, \"(\").trim()\n    }));\n\n    this.sources.notifySourceUpdated(this);\n  }\n\n\n\n  get cameras() {\n    return this.#cameras;\n  }\n}\n\n\n\n\n","import type { Dispatcher } from \"../dispatcher.js\";\nimport type { ProcessorModes } from \"../processor-modes.js\";\nimport type { ISource, RecordingData } from \"../types.js\";\n\nexport class RecordPlayer implements ISource {\n  #timer: number = 0;\n\n  constructor(readonly data: RecordingData, readonly dispatcher: Dispatcher) {\n\n  }\n\n  async start() {\n    let pos = 0;\n    const mode = this.data.mode as ProcessorModes;\n    const samples = this.data.samples;\n\n    this.#timer = setInterval(() => {\n      //callback(this.data.samples[ pos ]);\n      this.dispatcher.receivedData(mode, samples[ pos ])\n      pos++;\n      if (pos >= this.data.samples.length) pos = 0;\n    }, this.data.rateMs * 2);\n    return true;\n  }\n\n  stop() {\n    clearInterval(this.#timer);\n  }\n}\n","import type { RecordingData, SourceData } from \"../types.js\";\nimport type { Sources } from \"./index.js\";\n\nexport class Recordings {\n  #store: RecordingData[] = []\n\n  constructor(private readonly sources: Sources) {\n\n  }\n\n  delete(source: SourceData) {\n    const filtered = this.#store.filter(rd => rd.name !== source.id);\n    if (filtered.length !== this.#store.length) {\n      this.#store = filtered;\n      this.save();\n    }\n  }\n\n  getSources(): SourceData[] {\n    return this.#store.map<SourceData>(r => ({\n      id: r.name,\n      kind: `recording`,\n      label: r.name\n    }));\n  }\n\n  getRecording(name: string) {\n    return this.#store.find(r => r.name === name);\n  }\n\n  add(data: RecordingData) {\n    this.#store.push(data);\n    this.save();\n  }\n\n  save() {\n    localStorage.setItem(`recordings`, JSON.stringify(this.#store));\n    this.sources.notifySourceUpdated(this);\n  }\n\n  init() {\n    const s = localStorage.getItem(`recordings`);\n    if (!s) return;\n    try {\n      const o = JSON.parse(s) as any[];\n      for (const d of o) {\n        this.#store.push(d);\n      }\n      this.sources.notifySourceUpdated(this);\n    } catch (error) {\n      console.error(error);\n    }\n  }\n\n  promptName() {\n    const formatOpts: Intl.DateTimeFormatOptions = {\n      dateStyle: `short`,\n      timeStyle: `short`\n    }\n    const defaultName = new Intl.DateTimeFormat(\"se-SE\", formatOpts).format(Date.now()) + ' recording ' + this.#store.length + 1;\n\n    const name = window.prompt(`Name for recording`, defaultName);\n    return name;\n  }\n}","import type { VideoSourceElement } from \"../components/video-source.js\";\nimport type { CameraOptions, ISource, SourceData } from \"../types.js\";\n\nexport class VideoElementSource implements ISource {\n  mediaStream: MediaStream | undefined;\n\n  constructor(readonly src: VideoSourceElement, readonly data: SourceData, readonly camera: CameraOptions) {\n\n  }\n\n  async start(): Promise<boolean> {\n    let stream: undefined | MediaStream | string = undefined;\n    switch (this.data.kind) {\n      case \"camera\": {\n        stream = await this.getMediaStream();\n        this.mediaStream = stream;\n        break;\n      }\n      case \"file\": {\n        stream = this.data.id;\n        break;\n      }\n    }\n    this.src.setVideoSource(stream);\n    if (stream) {\n      this.src.start();\n      return true;\n    } else {\n      this.src.stop();\n      return false;\n    }\n  }\n\n  stop(): void {\n    if (this.mediaStream) {\n      for (const vt of this.mediaStream.getVideoTracks()) {\n        vt.stop();\n      }\n    }\n    this.src.stop();\n  }\n\n  async getMediaStream() {\n    if (this.data.id === `-`) return undefined;\n    const c = getConstraints(this.data, this.camera);\n    try {\n      const stream = await navigator.mediaDevices.getUserMedia(c);\n\n      return stream;\n    } catch (error: unknown) {\n      if (typeof error === `object`) {\n        // eslint-disable-next-line @typescript-eslint/no-explicit-any\n        const name = (error as any).name ?? ``;\n        if (name === `OverconstrainedError`) {\n          // eslint-disable-next-line @typescript-eslint/no-explicit-any\n          console.error(`Overconstrained error: ${ (error as any).constraint }`);\n          console.error(`Constraints: ${ JSON.stringify(c) }`);\n        }\n      }\n      throw error;\n    }\n  }\n}\n\nexport const getConstraints = (source: SourceData, options: CameraOptions) => {\n  const video: Partial<MediaTrackConstraints> = {}\n  if (source.id.length > 0) {\n    video.deviceId = { exact: source.id };\n  }\n  if (options.facingMode) {\n    video.facingMode = options.facingMode;\n  }\n  if (options.height) {\n    video.height = { ideal: options.height }\n  }\n  if (options.width) {\n    video.width = { ideal: options.width }\n  }\n  const constraints: MediaStreamConstraints = {\n    video\n  };\n  return constraints;\n}","import type { VideoSourceElement } from \"../components/video-source.js\";\nimport type { MlVision } from \"../ml-vision.js\";\nimport { Recorder } from \"../recorder.js\";\nimport type { CameraOptions, ISource, SourceData, SourceKinds, Verbosity } from \"../types.js\";\nimport { Log } from \"../util/log.js\";\nimport { CameraSources } from \"./camera-sources.js\";\nimport { RecordPlayer } from \"./record-player.js\";\nimport { Recordings } from \"./recording-sources.js\";\nimport { VideoElementSource } from \"./video-element-source.js\";\n\nexport type SourcesState = `starting` | `started` | `stopped`\nexport type SourceStateChangeArgs = {\n  priorState: SourcesState\n  newState: SourcesState\n}\n\n/**\n * Event: 'updated','state-change'\n */\nexport class Sources extends EventTarget {\n  #camera;\n  #recordings;\n\n  #state: SourcesState = `stopped`;\n  #current: ISource | undefined;\n  #currentData: SourceData | undefined;\n  #videoEl: VideoSourceElement | undefined;\n  #cameraOpts: CameraOptions;\n  log;\n  constructor(cameraOptions: CameraOptions, readonly mlv: MlVision) {\n    super();\n    this.log = new Log(`Sources`, mlv.log);\n    this.#cameraOpts = cameraOptions;\n    this.#camera = new CameraSources(this);\n    this.#recordings = new Recordings(this);\n  }\n\n  delete(source: SourceData) {\n    if (source.kind !== `recording`) throw new Error(`Cannot delete type: ${ source.kind }`);\n    this.#recordings.delete(source);\n  }\n\n  get isStarted() {\n    return this.#state === `started`;\n  }\n\n  createRecorder() {\n    return new Recorder(this.#recordings, this.mlv.dispatcher);\n  }\n\n  startStop(): boolean {\n    if (this.#state === `stopped`) {\n      this.start();\n      return true;\n    } else if (this.#state === `started`) {\n      this.stop();\n      return false;\n    } else {\n      console.warn(`Cannot start/stop in state: ${ this.#state }`);\n      return false;\n    }\n  }\n\n  kindMatch(kind: SourceKinds) {\n    if (this.#currentData) {\n      if (this.#currentData.kind === kind) return true;\n    }\n    return false;\n  }\n  async start() {\n    this.#setState(`starting`);\n\n    const sourceData = this.#currentData;\n    if (!sourceData) throw new Error(`Cannot start, no source data available`);\n\n    // Resolve source\n    let source: ISource | undefined;\n    let videoEl = this.#videoEl;\n    if (!videoEl) {\n      videoEl = this.#videoEl = this.mlv.el.getVideoSource();\n    }\n    switch (sourceData.kind) {\n      case `camera`: {\n        if (!videoEl) throw new Error(`No video element`);\n        source = new VideoElementSource(videoEl, sourceData, this.#cameraOpts);\n        break;\n      }\n      case `file`: {\n        if (!videoEl) throw new Error(`No video element`);\n        source = new VideoElementSource(videoEl, sourceData, this.#cameraOpts);\n        break;\n      }\n      case `recording`: {\n        const rec = this.#recordings.getRecording(sourceData.id);\n        if (rec) {\n          source = new RecordPlayer(rec, this.mlv.dispatcher);\n        } else {\n          console.warn(`Could not get recording: ${ sourceData.id }`);\n        }\n      }\n    }\n\n    this.#current = source;\n    if (await source?.start()) {\n      this.#setState(`started`);\n    } else {\n      this.#setState(`stopped`);\n    }\n  }\n\n  stop() {\n    const current = this.#current;\n    if (current) {\n      try {\n        current.stop();\n        this.#current = undefined;\n      } catch (error) {\n        console.error(error);\n      }\n    }\n    this.#setState(`stopped`);\n  }\n\n  get cameras() {\n    return this.#camera.cameras;\n  }\n\n  get recordings() {\n    return this.#recordings.getSources();\n  }\n\n  init() {\n    this.#camera.init();\n    this.#recordings.init();\n  }\n\n  setSource(sourceData: SourceData) {\n    this.log.debug(`setSource: ${ JSON.stringify(sourceData) }`);\n    this.#currentData = sourceData;\n    this.dispatchEvent(new CustomEvent(`source-change`, { detail: sourceData }));\n  }\n\n  getCurrentId() {\n    if (this.#currentData) return this.#currentData.id;\n    return ``;\n  }\n\n  notifySourceUpdated(source: any) {\n    this.dispatchEvent(new CustomEvent(`updated`, {\n      detail: source\n    }));\n    if (source === this.#camera && !this.#current) {\n      const c = this.#camera.cameras[ 0 ];\n      if (c) {\n        this.setSource(c);\n        this.start();\n      }\n    }\n  }\n\n  #setState(state: SourcesState) {\n    const prior = this.#state;\n    if (prior === state) return;\n    this.#state = state;\n    if (state === `starting` && prior !== `stopped`) throw new Error(`Cannot transition ${ prior } -> ${ state }`);\n    this.log.debug(`state ${ prior } -> ${ state } (current: ${ JSON.stringify(this.#currentData) })`);\n    const dict: SourceStateChangeArgs = {\n      priorState: prior,\n      newState: state\n    }\n    this.dispatchEvent(new CustomEvent(`state-change`, { detail: dict }));\n  }\n\n  get currentSourceData() {\n    return this.#currentData;\n  }\n\n}",null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,"import { Remote } from '@clinth/remote';\nimport type { OnDispatcherData, Options } from './types.js';\nimport type { ProcessorModes } from './processor-modes.js';\n\nexport type DispatcherDataArgs = {\n  data: any\n  mode: ProcessorModes\n}\nexport class Dispatcher extends EventTarget {\n  #remote;\n  onData: OnDispatcherData | undefined;\n\n  constructor(options: Options) {\n    super();\n    this.#remote = new Remote(options.remote);\n  }\n\n  receivedData(mode: ProcessorModes, data: any) {\n    if (!data) return;\n    if (this.#remote) {\n      this.#remote.send(JSON.stringify(data));\n    }\n\n    if (this.onData) this.onData(mode, data);\n\n    const args: DispatcherDataArgs = { data, mode }\n    this.dispatchEvent(new CustomEvent(`data`, {\n      detail: args\n    }));\n\n  }\n}","import { VisionElement } from \"./components/vision-element.js\";\nimport type { ISource, Options, SourceData, SourceKinds, Verbosity } from \"./types.js\";\nimport { OverlayElement } from \"./components/pose-overlay.js\";\nimport { Processing } from \"./processing.js\";\nimport { PoseDetector } from \"./mediapipe/pose-detector.js\";\nimport { ObjectDetector } from \"./mediapipe/object-detector.js\";\nimport { FaceDetector } from \"./mediapipe/face-detector.js\";\nimport { Sources, type SourceStateChangeArgs } from \"./sources/index.js\";\nimport { Dispatcher } from \"./dispatcher.js\";\nimport { Recorder } from \"./recorder.js\";\nimport { Log } from \"./util/log.js\";\nimport { validateProcessorMode, type ProcessorModes } from \"./processor-modes.js\";\n\nexport const defaults = (mode: ProcessorModes): Options => {\n  const opts: Options = {\n    overlay: {\n      label: true,\n      show: true\n    },\n    camera: {\n      facingMode: `user`,\n    },\n    computeFreqMs: 10,\n    mode: mode,\n    remote: {\n      allowNetwork: false,\n    },\n    verbosity: `errors`,\n    wasmBase: './wasm',\n    modelsBase: '/models'\n  }\n  if (mode === `pose`) opts.pose = PoseDetector.defaults();\n  else if (mode === `objects`) opts.objects = ObjectDetector.defaults();\n  else if (mode === `face`) opts.face = FaceDetector.defaults();\n  return opts;\n};\n\n\n/**\n * Events:\n * * processorstate: processor has changed state\n */\nexport class MlVision extends EventTarget {\n  el: VisionElement;\n  sources;\n  #overlayEl: OverlayElement | undefined;\n  #proc\n  dispatcher;\n  #opts: Options;\n  log\n  constructor(elQuery: string, options: Partial<Options> = {}) {\n    super();\n\n    const lastMode = validateProcessorMode(localStorage.getItem(`last-mode`), `pose`);\n    const opts = !options ? defaults(lastMode as ProcessorModes) : {\n      ...defaults(options.mode ?? lastMode),\n      ...options\n    }\n    this.#opts = opts;\n    this.log = new Log(`MlVision`, opts.verbosity);\n    const el = document.querySelector(elQuery) as VisionElement | null;\n    if (!el) throw new Error(`VisionElement not found with query: ${ elQuery }`);\n    this.el = el;\n\n    this.sources = new Sources(opts.camera, this);\n    this.dispatcher = new Dispatcher(opts);\n    this.#proc = new Processing(this, opts);\n    this.#proc.addEventListener(`state`, event => {\n      this.dispatchEvent(new CustomEvent(`processorstate`, { detail: this.#proc.state }));\n    })\n  }\n\n  get processing() {\n    return this.#proc;\n  }\n\n  init() {\n    const el = this.el;\n    const opts = this.#opts;\n    el.setOptions(opts);\n    el.addEventListener(`source-startstop`, (event) => {\n      const source = (event as CustomEvent).detail as SourceData;\n      if (source.id !== this.sources.getCurrentId()) {\n        // Different source\n        this.log.info(`Different source. Id: ${ source.id } Existing: ${ this.sources.getCurrentId() }`);\n        this.sources.stop();\n        this.sources.setSource(source);\n      }\n      const started = this.sources.startStop();\n    });\n\n    // User has switched camera/file\n    el.addEventListener(`request-source`, event => {\n      const detail = (event as CustomEvent).detail as SourceData;\n      this.sources.stop();\n      this.sources.setSource(detail);\n      this.sources.start();\n    });\n\n    el.addEventListener(`request-recorder`, () => {\n      const r = this.sources.createRecorder();\n      r.start(this.#proc.computeFreqMs);\n      el.recorder = r;\n    });\n\n    el.addEventListener(`request-source-delete`, event => {\n      const source = (event as CustomEvent).detail as SourceData;\n      this.sources.delete(source);\n    })\n\n    el.addEventListener(`request-mode`, event => {\n      const req = (event as CustomEvent).detail;\n      console.log(req);\n      this.#proc.setMode(validateProcessorMode(req.mode));\n    });\n\n    this.dispatcher.addEventListener(`data`, event => {\n      const data = (event as CustomEvent).detail;\n      el.onReceivedData(data.mode, data.data);\n    });\n\n    this.sources.addEventListener(`updated`, () => {\n      el.onSourcesUpdated(this.sources.cameras, this.sources.recordings);\n    })\n\n    // Source has changed\n    this.sources.addEventListener(`source-change`, event => {\n      const source = (event as CustomEvent).detail as SourceData;\n      el.notifySourceChange(source);\n    })\n\n    // Playback source video/camera has changed state\n    this.sources.addEventListener(`state-change`, (e) => {\n      const { priorState, newState } = (e as CustomEvent).detail as SourceStateChangeArgs;\n      this.log.debug(`${ priorState }->${ newState }`);\n      if (newState === `started`) {\n        // Make sure processor is running too\n        const video = el.getVideoElement();\n        if (video) {\n          this.#proc.stop();\n          this.#proc.start(video);\n        } else {\n          console.warn(`Could not start processing because not video element is found`);\n        }\n      } else if (newState === `stopped`) {\n        this.#proc.stop();\n      }\n      el.notifySourceState(newState, this.sources.currentSourceData);\n\n    })\n\n    this.sources.init();\n    if (opts.hideModelSelector) el.hideModelSelector = opts.hideModelSelector;\n  }\n\n}","import { Remote, type Options } from \"@clinth/remote\";\n\nexport type OnReceivedData = (msg: unknown) => void;\n\nexport class Client extends EventTarget {\n  #remote;\n  onData: OnReceivedData | undefined;\n\n  constructor(options: Options = {}) {\n    super();\n    options = {\n      allowNetwork: false,\n      ...options\n    }\n    this.#remote = new Remote(options);\n    this.#remote.onData = ((msg: unknown) => {\n      const asObj = typeof msg === `object` ? msg : JSON.parse(msg as string);\n      if (this.onData) this.onData(asObj);\n      this.dispatchEvent(new CustomEvent(`message`, {\n        detail: asObj\n      }))\n    });\n  }\n}","export const parseUrlParams = (url?: string) => {\n  const params = new URL(url ?? document.location.toString()).searchParams;\n\n  return {\n    params,\n    int: (name: string, defaultValue: number = Number.NaN) => intParamOrDefault(params, name, defaultValue),\n    float: (name: string, defaultValue: number = Number.NaN) => floatParamOrDefault(params, name, defaultValue),\n    string: (name: string, defaultValue: string = ``) => stringParamOrDefault(params, name, defaultValue),\n    bool: (name: string) => boolParamOrDefault(params, name)\n  }\n}\n\n/**\n * Return an integer value from URL parameter or use a default value.\n * Value is considered _false_ if it's not present, or it is explicitly 'false'\n * @returns \n */\nfunction boolParamOrDefault(params: URLSearchParams, name: string) {\n  const p = params.get(name);\n  if (p === null) return false;\n\n  if (p === `true`) return true;\n  return false;\n}\n\n/**\n * Return an integer value from URL parameter or use a default value\n * @returns \n */\nfunction intParamOrDefault(params: URLSearchParams, name: string, defaultValue: number) {\n  const p = params.get(name);\n  if (p !== null) {\n    const v = Number.parseInt(p);\n    return v;\n  }\n  return defaultValue;\n}\n\n/**\n * Return a float value from URL parameter or use a default value\n * @returns \n */\nfunction floatParamOrDefault(params: URLSearchParams, name: string, defaultValue: number) {\n  const p = params.get(name);\n  if (p !== null) {\n    const v = Number.parseFloat(p);\n    return v;\n  }\n  return defaultValue;\n}\n\n/**\n * Return a string value from URL parameter or use a default value\n * @returns \n */\nfunction stringParamOrDefault(params: URLSearchParams, name: string, defaultValue: string) {\n  const p = params.get(name);\n  if (p !== null) {\n    return p;\n  }\n  return defaultValue;\n}"],"mappings":"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,GAAG,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,IAAG,CAAC,GAAE,CAAC,GAAE,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,GAAE,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,CAAC,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,CAAC,GAAE,CAAC,GAAE,EAAE,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,CAAC,GAAE,CAAC,GAAE,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,CAAC,GAAE,CAAC,GAAE,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,CAAC,GAAE,CAAC,GAAE,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,CAAC,GAAE,CAAC,GAAE,CAAC,GAAE,CAAC,GAAE,EAAE,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,GAAE,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,CAAC,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,KAAI,CAAC,GAAE,CAAC,GAAE,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,GAAE,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,CAAC,GAAE,CAAC,IAAG,CAAC,GAAE,CAAC,GAAE,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,GAAE,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,CAAC,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,IAAG,CAAC,GAAE,CAAC,GAAE,CAAC,GAAE,CAAC,GAAE,EAAE,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,GAAE,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,CAAC,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,CAAC,GAAE,CAAC,GAAE,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,GAAE,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,CAAC,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,CAAC,GAAE,CAAC,GAAE,CAAC,GAAE,CAAC,GAAE,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,CAAC,GAAE,CAAC,GAAE,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,CAAC,GAAE,CAAC,GAAE,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,CAAC,GAAE,CAAC,GAAE,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,GAAE,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,CAAC,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,CAAC,GAAE,CAAC,GAAE,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,GAAE,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,CAAC,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,CAAC,GAAE,CAAC,GAAE,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,CAAC,GAAE,CAAC,GAAE,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,GAAE,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,CAAC,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,KAAI,CAAC,GAAE,CAAC,GAAE,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,GAAE,EAAE,GAAE,CAAC,IAAG,CAAC,GAAE,CAAC,GAAE,CAAC,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,CAAC,GAAE,CAAC,GAAE,EAAE,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,GAAE,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,CAAC,GAAE,CAAC,GAAE,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,CAAC,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,CAAC,GAAE,CAAC,GAAE,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,CAAC,GAAE,CAAC,GAAE,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,GAAE,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,CAAC,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,CAAC,GAAE,CAAC,GAAE,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,CAAC,GAAE,CAAC,GAAE,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,GAAE,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,CAAC,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,CAAC,GAAE,CAAC,GAAE,EAAE,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,IAAG,CAAC,GAAE,CAAC,GAAE,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,CAAC,GAAE,CAAC,GAAE,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,GAAE,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,CAAC,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,CAAC,GAAE,CAAC,GAAE,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,CAAC,GAAE,CAAC,GAAE,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,CAAC,GAAE,CAAC,GAAE,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,GAAE,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,CAAC,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,GAAE,GAAG,GAAE,CAAC,KAAI,CAAC,GAAE,CAAC,GAAE,CAAC,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,CAAC,GAAE,CAAC,GAAE,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,CAAC,GAAE,CAAC,GAAE,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,IAAG,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,GAAE,GAAG,GAAE,CAAC,KAAI,CAAC,GAAE,CAAC,GAAE,CAAC,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,IAAG,CAAC,GAAE,CAAC,GAAE,GAAG,GAAE,CAAC,KAAI,EAAE,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,GAAE,CAAC,KAAI,GAAG,CAAC;AAAE,SAAS,GAAGD,IAAE;AAAC,EAAAA,GAAE,IAAE,EAAC,eAAc,CAAC,GAAE,iBAAgB,CAAC,GAAE,8BAA6B,CAAC,EAAC;AAAC;AAAC,IAAI,KAAG,cAAc,GAAE;AAAA,EAAC,YAAYA,IAAEC,IAAE;AAAC,UAAM,IAAI,GAAGD,IAAEC,EAAC,GAAE,YAAW,aAAY,KAAE,GAAE,KAAK,IAAE,EAAC,eAAc,CAAC,GAAE,iBAAgB,CAAC,GAAE,8BAA6B,CAAC,EAAC,GAAE,KAAK,qCAAmC,KAAK,wBAAsB,OAAG,GAAGD,KAAE,KAAK,IAAE,IAAI,MAAG,GAAE,GAAEC,KAAE,IAAI,IAAE,GAAE,KAAK,IAAE,IAAI,MAAG,GAAG,KAAK,GAAE,GAAE,GAAE,KAAK,CAAC,GAAE,KAAK,IAAE,IAAI,MAAG,GAAG,KAAK,GAAE,GAAE,GAAE,KAAK,CAAC,GAAE,GAAG,KAAK,GAAE,GAAE,CAAC,GAAE,GAAG,KAAK,GAAE,GAAE,GAAE,GAAE,GAAG,KAAK,GAAE,GAAE,GAAE,GAAE,GAAG,KAAK,GAAE,GAAE,GAAE;AAAA,EAAC;AAAA,EAAC,IAAI,cAAa;AAAC,WAAO,GAAG,KAAK,GAAE,IAAG,CAAC;AAAA,EAAC;AAAA,EAAC,IAAI,YAAYD,IAAE;AAAC,OAAG,KAAK,GAAE,GAAE,GAAEA,EAAC;AAAA,EAAC;AAAA,EAAC,EAAEA,IAAE;AAAC,WAAM,cAAaA,MAAG,GAAG,KAAK,GAAE,GAAEA,GAAE,YAAU,CAAC,GAAE,gCAA+BA,MAAG,GAAG,KAAK,GAAE,GAAEA,GAAE,8BAA4B,GAAE,GAAE,2BAA0BA,MAAG,GAAG,KAAK,GAAE,GAAEA,GAAE,yBAAuB,GAAE,GAAE,+BAA8BA,MAAG,GAAG,KAAK,GAAE,GAAEA,GAAE,6BAA2B,GAAE,GAAE,2BAA0BA,OAAI,KAAK,wBAAsB,CAAC,CAACA,GAAE,wBAAuB,wCAAuCA,OAAI,KAAK,qCAAmC,CAAC,CAACA,GAAE,qCAAoC,KAAK,EAAEA,EAAC;AAAA,EAAC;AAAA,EAAC,EAAEA,IAAEC,IAAE;AAAC,WAAO,GAAG,IAAI,GAAE,GAAG,MAAKD,IAAEC,EAAC,GAAE,KAAK;AAAA,EAAC;AAAA,EAAC,EAAED,IAAEC,IAAEC,IAAE;AAAC,WAAO,GAAG,IAAI,GAAE,GAAG,MAAKF,IAAEE,IAAED,EAAC,GAAE,KAAK;AAAA,EAAC;AAAA,EAAC,IAAG;AAAC,QAAID,KAAE,IAAI;AAAG,OAAGA,IAAE,UAAU,GAAE,GAAGA,IAAE,WAAW,GAAE,GAAGA,IAAE,gBAAgB;AAAE,UAAMC,KAAE,IAAI;AAAG,OAAGA,IAAE,IAAG,KAAK,CAAC;AAAE,UAAMC,KAAE,IAAI;AAAG,OAAGA,IAAE,4DAA4D,GAAE,GAAGA,IAAE,gBAAgB,GAAE,GAAGA,IAAE,qBAAqB,GAAE,GAAGA,IAAE,+BAA+B,GAAEA,GAAE,EAAED,EAAC,GAAE,GAAGD,IAAEE,EAAC,GAAE,KAAK,EAAE,0BAA0B,kBAAkB,CAACF,IAAEC,OAAI;AAAC,iBAAUA,MAAKD,GAAE,CAAAA,KAAE,GAAGC,EAAC,GAAE,KAAK,EAAE,cAAc,KAAK,GAAGD,EAAC,CAAC;AAAE,SAAG,MAAKC,EAAC;AAAA,IAAC,CAAE,GAAE,KAAK,EAAE,0BAA0B,kBAAkB,CAAAD,OAAG;AAAC,SAAG,MAAKA,EAAC;AAAA,IAAC,CAAE,GAAE,KAAK,0BAAwB,GAAGA,IAAE,aAAa,GAAE,GAAGE,IAAE,yBAAyB,GAAE,KAAK,EAAE,0BAA0B,eAAe,CAACF,IAAEC,OAAI;AAAC,UAAG,KAAK,sBAAsB,YAAUA,MAAKD,GAAE,CAAAA,KAAE,GAAGC,EAAC,GAAE,KAAK,EAAE,gBAAgB,KAAK,GAAGD,GAAE,EAAE,KAAG,CAAC,CAAC,CAAC;AAAE,SAAG,MAAKC,EAAC;AAAA,IAAC,CAAE,GAAE,KAAK,EAAE,0BAA0B,eAAe,CAAAD,OAAG;AAAC,SAAG,MAAKA,EAAC;AAAA,IAAC,CAAE,IAAG,KAAK,uCAAqC,GAAGA,IAAE,eAAe,GAAE,GAAGE,IAAE,6BAA6B,GAAE,KAAK,EAAE,0BAA0B,iBAAiB,CAACF,IAAEC,OAAI;AAAC,UAAG,KAAK,mCAAmC,YAAUA,MAAKD,GAAE,EAACA,KAAE,GAAG,GAAGC,EAAC,GAAE,IAAG,CAAC,MAAI,KAAK,EAAE,6BAA6B,KAAK,EAAC,MAAK,GAAG,GAAGD,IAAE,CAAC,GAAE,CAAC,KAAG,GAAE,SAAQ,GAAG,GAAGA,IAAE,CAAC,GAAE,CAAC,KAAG,GAAE,MAAK,GAAGA,IAAE,GAAE,EAAE,EAAE,MAAM,KAAG,CAAC,EAAC,CAAC;AAAE,SAAG,MAAKC,EAAC;AAAA,IAAC,CAAE,GAAE,KAAK,EAAE,0BAA0B,iBAAiB,CAAAD,OAAG;AAAC,SAAG,MAAKA,EAAC;AAAA,IAAC,CAAE,IAAGA,KAAEA,GAAE,EAAE,GAAE,KAAK,SAAS,IAAI,WAAWA,EAAC,GAAE,IAAE;AAAA,EAAC;AAAC;AAAE,GAAG,UAAU,iBAAe,GAAG,UAAU,GAAE,GAAG,UAAU,SAAO,GAAG,UAAU,GAAE,GAAG,UAAU,aAAW,GAAG,UAAU,GAAE,GAAG,sBAAoB,SAASA,IAAEC,IAAE;AAAC,SAAO,GAAG,IAAGD,IAAE,EAAC,aAAY,EAAC,gBAAeC,GAAC,EAAC,CAAC;AAAC,GAAE,GAAG,wBAAsB,SAASD,IAAEC,IAAE;AAAC,SAAO,GAAG,IAAGD,IAAE,EAAC,aAAY,EAAC,kBAAiBC,GAAC,EAAC,CAAC;AAAC,GAAE,GAAG,oBAAkB,SAASD,IAAEC,IAAE;AAAC,SAAO,GAAG,IAAGD,IAAEC,EAAC;AAAC,GAAE,GAAG,sBAAoB,IAAG,GAAG,0BAAwB,IAAG,GAAG,8BAA4B,IAAG,GAAG,2BAAyB,IAAG,GAAG,2BAAyB,IAAG,GAAG,+BAA6B,IAAG,GAAG,4BAA0B,IAAG,GAAG,2BAAyB,IAAG,GAAG,0BAAwB,IAAG,GAAG,6BAA2B;AAAG,IAAI,KAAG,cAAc,GAAE;AAAA,EAAC,YAAYD,IAAEC,IAAE;AAAC,UAAM,IAAI,GAAGD,IAAEC,EAAC,GAAE,YAAW,aAAY,IAAE,GAAE,GAAGD,KAAE,KAAK,IAAE,IAAI,MAAG,GAAE,GAAEC,KAAE,IAAI,IAAE;AAAA,EAAC;AAAA,EAAC,IAAI,cAAa;AAAC,WAAO,GAAG,KAAK,GAAE,IAAG,CAAC;AAAA,EAAC;AAAA,EAAC,IAAI,YAAYD,IAAE;AAAC,OAAG,KAAK,GAAE,GAAE,GAAEA,EAAC;AAAA,EAAC;AAAA,EAAC,EAAEA,IAAE;AAAC,WAAO,MAAM,EAAEA,EAAC;AAAA,EAAC;AAAA,EAAC,GAAGA,IAAEC,IAAEC,IAAE;AAAC,UAAMC,KAAE,cAAY,OAAOF,KAAEA,KAAE,CAAC;AAAE,QAAG,KAAK,IAAE,cAAY,OAAOA,KAAEA,KAAEC,IAAE,GAAG,MAAKF,IAAEG,MAAG,CAAC,CAAC,GAAE,CAAC,KAAK,EAAE,QAAO,KAAK;AAAA,EAAC;AAAA,EAAC,IAAG;AAAC,QAAIH,KAAE,IAAI;AAAG,OAAGA,IAAE,UAAU,GAAE,GAAGA,IAAE,WAAW,GAAE,GAAGA,IAAE,gBAAgB;AAAE,UAAMC,KAAE,IAAI;AAAG,OAAGA,IAAE,IAAG,KAAK,CAAC;AAAE,UAAMC,KAAE,IAAI;AAAG,OAAGA,IAAE,wDAAwD,GAAE,GAAGA,IAAE,gBAAgB,GAAE,GAAGA,IAAE,qBAAqB,GAAE,GAAGA,IAAE,+BAA+B,GAAEA,GAAE,EAAED,EAAC,GAAE,GAAGD,IAAEE,EAAC,GAAE,KAAK,EAAE,EAAE,kBAAkB,CAACF,IAAEC,OAAI;AAAC,UAAIC,KAAE,CAAC,KAAK,GAAEC,KAAEH,GAAE,MAAKI,KAAEJ,GAAE;AAAM,YAAMK,KAAED,MAAGJ,KAAEA,GAAE;AAAQ,UAAGG,cAAa,WAAW,KAAGA,GAAE,WAAS,IAAEE,IAAE;AAAC,cAAMJ,KAAE,IAAI,kBAAkB,IAAEI,EAAC;AAAE,iBAAQL,KAAE,GAAEA,KAAEK,IAAE,EAAEL,GAAE,CAAAC,GAAE,IAAED,EAAC,IAAEG,GAAE,IAAEH,EAAC,GAAEC,GAAE,IAAED,KAAE,CAAC,IAAEG,GAAE,IAAEH,KAAE,CAAC,GAAEC,GAAE,IAAED,KAAE,CAAC,IAAEG,GAAE,IAAEH,KAAE,CAAC,GAAEC,GAAE,IAAED,KAAE,CAAC,IAAE;AAAI,QAAAG,KAAE,IAAI,UAAUF,IAAEG,IAAEJ,EAAC;AAAA,MAAC,OAAK;AAAC,YAAGG,GAAE,WAAS,IAAEE,GAAE,OAAM,MAAM,gCAA8BF,GAAE,SAAOE,EAAC;AAAE,QAAAF,KAAE,IAAI,UAAU,IAAI,kBAAkBA,GAAE,QAAOA,GAAE,YAAWA,GAAE,MAAM,GAAEC,IAAEJ,EAAC;AAAA,MAAC;AAAA,eAAS,EAAEG,cAAa,cAAc,OAAM,MAAM,uBAAuBA,GAAE,YAAY,IAAI,EAAE;AAAE,MAAAC,KAAE,IAAI,GAAG,CAACD,EAAC,GAAE,OAAG,OAAG,KAAK,EAAE,EAAE,QAAO,KAAK,GAAEC,IAAEJ,EAAC,GAAE,KAAK,IAAEE,KAAEA,KAAEE,GAAE,MAAM,IAAEA,IAAE,KAAK,KAAG,KAAK,EAAEF,EAAC,GAAE,GAAG,MAAKD,EAAC;AAAA,IAAC,CAAE,GAAE,KAAK,EAAE,0BAA0B,kBAAkB,CAAAD,OAAG;AAAC,WAAK,IAAE,MAAK,KAAK,KAAG,KAAK,EAAE,IAAI,GAAE,GAAG,MAAKA,EAAC;AAAA,IAAC,CAAE,GAAEA,KAAEA,GAAE,EAAE,GAAE,KAAK,SAAS,IAAI,WAAWA,EAAC,GAAE,IAAE;AAAA,EAAC;AAAC;AAAE,GAAG,UAAU,UAAQ,GAAG,UAAU,IAAG,GAAG,UAAU,aAAW,GAAG,UAAU,GAAE,GAAG,sBAAoB,SAASA,IAAEC,IAAE;AAAC,SAAO,GAAG,IAAGD,IAAE,EAAC,aAAY,EAAC,gBAAeC,GAAC,EAAC,CAAC;AAAC,GAAE,GAAG,wBAAsB,SAASD,IAAEC,IAAE;AAAC,SAAO,GAAG,IAAGD,IAAE,EAAC,aAAY,EAAC,kBAAiBC,GAAC,EAAC,CAAC;AAAC,GAAE,GAAG,oBAAkB,SAASD,IAAEC,IAAE;AAAC,SAAO,GAAG,IAAGD,IAAEC,EAAC;AAAC;AAAE,IAAI,KAAG,GAAG,CAAC,GAAE,CAAC,GAAE,CAAC,GAAE,CAAC,GAAE,CAAC,GAAE,CAAC,GAAE,CAAC,GAAE,CAAC,GAAE,CAAC,GAAE,CAAC,GAAE,CAAC,GAAE,CAAC,GAAE,CAAC,GAAE,CAAC,GAAE,CAAC,GAAE,CAAC,GAAE,CAAC,GAAE,CAAC,GAAE,CAAC,GAAE,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,GAAE,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,GAAE,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,EAAE,CAAC;AAAE,SAAS,GAAGD,IAAE;AAAC,EAAAA,GAAE,WAAS,CAAC,GAAEA,GAAE,YAAU,CAAC,GAAEA,GAAE,iBAAe,CAAC,GAAEA,GAAE,aAAW,CAAC;AAAC;AAAC,SAAS,GAAGA,IAAE;AAAC,SAAO,MAAIA,GAAE,SAAS,SAAO,EAAC,UAAS,CAAC,GAAE,WAAU,CAAC,GAAE,gBAAe,CAAC,GAAE,YAAW,CAAC,GAAE,cAAa,CAAC,EAAC,IAAE,EAAC,UAASA,GAAE,UAAS,WAAUA,GAAE,WAAU,gBAAeA,GAAE,gBAAe,YAAWA,GAAE,YAAW,cAAaA,GAAE,WAAU;AAAC;AAAC,SAAS,GAAGA,IAAEC,KAAE,MAAG;AAAC,QAAMC,KAAE,CAAC;AAAE,aAAUE,MAAKJ,IAAE;AAAC,QAAIG,KAAE,GAAGC,EAAC;AAAE,IAAAJ,KAAE,CAAC;AAAE,eAAUE,MAAKC,GAAE,EAAE,EAAE,CAAAA,KAAEF,MAAG,QAAM,GAAGC,IAAE,CAAC,IAAE,GAAG,GAAGA,IAAE,CAAC,GAAE,CAAC,IAAE,IAAGF,GAAE,KAAK,EAAC,OAAM,GAAGE,IAAE,CAAC,KAAG,GAAE,OAAMC,IAAE,cAAa,GAAGD,IAAE,CAAC,KAAG,IAAG,aAAY,GAAGA,IAAE,CAAC,KAAG,GAAE,CAAC;AAAE,IAAAA,GAAE,KAAKF,EAAC;AAAA,EAAC;AAAC,SAAOE;AAAC;AAAC,IAAI,KAAG,cAAc,GAAE;AAAA,EAAC,YAAYF,IAAEC,IAAE;AAAC,UAAM,IAAI,GAAGD,IAAEC,EAAC,GAAE,YAAW,aAAY,KAAE,GAAE,KAAK,WAAS,CAAC,GAAE,KAAK,YAAU,CAAC,GAAE,KAAK,iBAAe,CAAC,GAAE,KAAK,aAAW,CAAC,GAAE,GAAGD,KAAE,KAAK,IAAE,IAAI,MAAG,GAAE,GAAEC,KAAE,IAAI,IAAE,GAAE,KAAK,IAAE,IAAI,MAAG,GAAG,KAAK,GAAE,GAAE,GAAE,KAAK,CAAC,GAAE,KAAK,IAAE,IAAI,MAAG,GAAG,KAAK,GAAE,GAAE,GAAE,KAAK,CAAC,GAAE,KAAK,IAAE,IAAI,MAAG,GAAG,KAAK,GAAE,GAAE,GAAE,KAAK,CAAC,GAAE,KAAK,IAAE,IAAI,MAAG,GAAG,KAAK,GAAE,GAAE,GAAE,KAAK,CAAC,GAAE,GAAG,KAAK,GAAE,GAAE,GAAE,GAAE,GAAG,KAAK,GAAE,GAAE,GAAE,GAAE,GAAG,KAAK,GAAE,GAAE,GAAE;AAAA,EAAC;AAAA,EAAC,IAAI,cAAa;AAAC,WAAO,GAAG,KAAK,GAAE,IAAG,CAAC;AAAA,EAAC;AAAA,EAAC,IAAI,YAAYD,IAAE;AAAC,OAAG,KAAK,GAAE,GAAE,GAAEA,EAAC;AAAA,EAAC;AAAA,EAAC,EAAEA,IAAE;AAAC,QAAG,GAAG,KAAK,GAAE,GAAEA,GAAE,YAAU,CAAC,GAAE,gCAA+BA,MAAG,GAAG,KAAK,GAAE,GAAEA,GAAE,8BAA4B,GAAE,GAAE,2BAA0BA,MAAG,GAAG,KAAK,GAAE,GAAEA,GAAE,yBAAuB,GAAE,GAAE,+BAA8BA,MAAG,GAAG,KAAK,GAAE,GAAEA,GAAE,6BAA2B,GAAE,GAAEA,GAAE,iCAAgC;AAAC,UAAIC,KAAE,IAAI,MAAGC,KAAED,IAAEE,KAAE,GAAGH,GAAE,iCAAgC,GAAG,KAAK,GAAE,IAAG,CAAC,GAAG,EAAE,CAAC;AAAE,SAAGE,IAAE,GAAE,GAAEC,EAAC,GAAE,GAAG,KAAK,GAAE,GAAE,GAAEF,EAAC;AAAA,IAAC,MAAM,YAASD,GAAE,mCAAiC,GAAG,KAAK,GAAE,IAAG,CAAC,GAAG,EAAE;AAAE,WAAOA,GAAE,mCAAiC,GAAGE,KAAED,KAAE,IAAI,MAAG,GAAE,GAAEE,KAAE,GAAGH,GAAE,iCAAgC,GAAG,KAAK,GAAE,IAAG,CAAC,GAAG,EAAE,CAAC,CAAC,GAAE,GAAG,KAAK,GAAE,GAAE,GAAEC,EAAC,KAAG,WAASD,GAAE,mCAAiC,GAAG,KAAK,GAAE,IAAG,CAAC,GAAG,EAAE,GAAE,KAAK,EAAEA,EAAC;AAAA,EAAC;AAAA,EAAC,GAAGA,IAAEC,IAAE;AAAC,WAAO,GAAG,IAAI,GAAE,GAAG,MAAKD,IAAEC,EAAC,GAAE,GAAG,IAAI;AAAA,EAAC;AAAA,EAAC,GAAGD,IAAEC,IAAEC,IAAE;AAAC,WAAO,GAAG,IAAI,GAAE,GAAG,MAAKF,IAAEE,IAAED,EAAC,GAAE,GAAG,IAAI;AAAA,EAAC;AAAA,EAAC,IAAG;AAAC,QAAID,KAAE,IAAI;AAAG,OAAGA,IAAE,UAAU,GAAE,GAAGA,IAAE,WAAW,GAAE,GAAGA,IAAE,eAAe,GAAE,GAAGA,IAAE,gBAAgB,GAAE,GAAGA,IAAE,sBAAsB,GAAE,GAAGA,IAAE,YAAY;AAAE,UAAMC,KAAE,IAAI;AAAG,OAAGA,IAAE,IAAG,KAAK,CAAC;AAAE,UAAMC,KAAE,IAAI;AAAG,OAAGA,IAAE,kEAAkE,GAAE,GAAGA,IAAE,gBAAgB,GAAE,GAAGA,IAAE,qBAAqB,GAAE,GAAGA,IAAE,6BAA6B,GAAE,GAAGA,IAAE,0BAA0B,GAAE,GAAGA,IAAE,sCAAsC,GAAE,GAAGA,IAAE,uBAAuB,GAAEA,GAAE,EAAED,EAAC,GAAE,GAAGD,IAAEE,EAAC,GAAE,KAAK,EAAE,0BAA0B,kBAAkB,CAACF,IAAEC,OAAI;AAAC,iBAAUA,MAAKD,IAAE;AAAC,QAAAA,KAAE,GAAGC,EAAC;AAAE,cAAMC,KAAE,CAAC;AAAE,mBAAUD,MAAK,GAAGD,IAAE,IAAG,CAAC,EAAE,CAAAE,GAAE,KAAK,EAAC,GAAE,GAAGD,IAAE,CAAC,KAAG,GAAE,GAAE,GAAGA,IAAE,CAAC,KAAG,GAAE,GAAE,GAAGA,IAAE,CAAC,KAAG,GAAE,YAAW,GAAGA,IAAE,CAAC,KAAG,EAAC,CAAC;AAAE,aAAK,UAAU,KAAKC,EAAC;AAAA,MAAC;AAAC,SAAG,MAAKD,EAAC;AAAA,IAAC,CAAE,GAAE,KAAK,EAAE,0BAA0B,kBAAkB,CAAAD,OAAG;AAAC,SAAG,MAAKA,EAAC;AAAA,IAAC,CAAE,GAAE,KAAK,EAAE,0BAA0B,wBAAwB,CAACA,IAAEC,OAAI;AAAC,iBAAUA,MAAKD,IAAE;AAAC,QAAAA,KAAE,GAAGC,EAAC;AAAE,cAAMC,KAAE,CAAC;AAAE,mBAAUD,MAAK,GAAGD,IAAE,IAAG,CAAC,EAAE,CAAAE,GAAE,KAAK,EAAC,GAAE,GAAGD,IAAE,CAAC,KAAG,GAAE,GAAE,GAAGA,IAAE,CAAC,KAAG,GAAE,GAAE,GAAGA,IAAE,CAAC,KAAG,GAAE,YAAW,GAAGA,IAAE,CAAC,KAAG,EAAC,CAAC;AAAE,aAAK,eAAe,KAAKC,EAAC;AAAA,MAAC;AAAC,SAAG,MAAKD,EAAC;AAAA,IAAC,CAAE,GAAE,KAAK,EAAE,0BAA0B,wBAAwB,CAAAD,OAAG;AAAC,SAAG,MAAKA,EAAC;AAAA,IAAC,CAAE,GAAE,KAAK,EAAE,0BAA0B,iBAAiB,CAACA,IAAEC,OAAI;AAAC,WAAK,SAAS,KAAK,GAAG,GAAGD,IAAE,KAAE,CAAC,GAAE,GAAG,MAAKC,EAAC;AAAA,IAAC,CAAE,GAAE,KAAK,EAAE,0BAA0B,iBAAiB,CAAAD,OAAG;AAAC,SAAG,MAAKA,EAAC;AAAA,IAAC,CAAE,GAAE,KAAK,EAAE,0BAA0B,cAAc,CAACA,IAAEC,OAAI;AAAC,WAAK,WAAW,KAAK,GAAG,GAAGD,EAAC,CAAC,GAAE,GAAG,MAAKC,EAAC;AAAA,IAAC,CAAE,GAAE,KAAK,EAAE,0BAA0B,cAAc,CAAAD,OAAG;AAAC,SAAG,MAAKA,EAAC;AAAA,IAAC,CAAE,GAAEA,KAAEA,GAAE,EAAE,GAAE,KAAK,SAAS,IAAI,WAAWA,EAAC,GAAE,IAAE;AAAA,EAAC;AAAC;AAAE,SAAS,GAAGA,IAAE;AAAC,SAAM,EAAC,WAAUA,GAAE,WAAU,gBAAeA,GAAE,gBAAe,cAAaA,GAAE,YAAW,YAAWA,GAAE,WAAU;AAAC;AAAC,GAAG,UAAU,oBAAkB,GAAG,UAAU,IAAG,GAAG,UAAU,YAAU,GAAG,UAAU,IAAG,GAAG,UAAU,aAAW,GAAG,UAAU,GAAE,GAAG,sBAAoB,SAASA,IAAEC,IAAE;AAAC,SAAO,GAAG,IAAGD,IAAE,EAAC,aAAY,EAAC,gBAAeC,GAAC,EAAC,CAAC;AAAC,GAAE,GAAG,wBAAsB,SAASD,IAAEC,IAAE;AAAC,SAAO,GAAG,IAAGD,IAAE,EAAC,aAAY,EAAC,kBAAiBC,GAAC,EAAC,CAAC;AAAC,GAAE,GAAG,oBAAkB,SAASD,IAAEC,IAAE;AAAC,SAAO,GAAG,IAAGD,IAAEC,EAAC;AAAC,GAAE,GAAG,mBAAiB;AAAG,IAAI,KAAG,cAAc,GAAE;AAAA,EAAC,YAAYD,IAAEC,IAAE;AAAC,UAAM,IAAI,GAAGD,IAAEC,EAAC,GAAE,YAAW,aAAY,KAAE,GAAE,KAAK,YAAU,CAAC,GAAE,KAAK,iBAAe,CAAC,GAAE,KAAK,aAAW,CAAC,GAAE,GAAGD,KAAE,KAAK,IAAE,IAAI,MAAG,GAAE,GAAEC,KAAE,IAAI,IAAE,GAAE,KAAK,IAAE,IAAI,MAAG,GAAG,KAAK,GAAE,GAAE,GAAE,KAAK,CAAC,GAAE,KAAK,IAAE,IAAI,MAAG,GAAG,KAAK,GAAE,GAAE,GAAE,KAAK,CAAC,GAAE,GAAG,KAAK,GAAE,GAAE,CAAC,GAAE,GAAG,KAAK,GAAE,GAAE,GAAE,GAAE,GAAG,KAAK,GAAE,GAAE,GAAE,GAAE,GAAG,KAAK,GAAE,GAAE,GAAE;AAAA,EAAC;AAAA,EAAC,IAAI,cAAa;AAAC,WAAO,GAAG,KAAK,GAAE,IAAG,CAAC;AAAA,EAAC;AAAA,EAAC,IAAI,YAAYD,IAAE;AAAC,OAAG,KAAK,GAAE,GAAE,GAAEA,EAAC;AAAA,EAAC;AAAA,EAAC,EAAEA,IAAE;AAAC,WAAM,cAAaA,MAAG,GAAG,KAAK,GAAE,GAAEA,GAAE,YAAU,CAAC,GAAE,gCAA+BA,MAAG,GAAG,KAAK,GAAE,GAAEA,GAAE,8BAA4B,GAAE,GAAE,2BAA0BA,MAAG,GAAG,KAAK,GAAE,GAAEA,GAAE,yBAAuB,GAAE,GAAE,+BAA8BA,MAAG,GAAG,KAAK,GAAE,GAAEA,GAAE,6BAA2B,GAAE,GAAE,KAAK,EAAEA,EAAC;AAAA,EAAC;AAAA,EAAC,EAAEA,IAAEC,IAAE;AAAC,WAAO,KAAK,YAAU,CAAC,GAAE,KAAK,iBAAe,CAAC,GAAE,KAAK,aAAW,CAAC,GAAE,GAAG,MAAKD,IAAEC,EAAC,GAAE,GAAG,IAAI;AAAA,EAAC;AAAA,EAAC,EAAED,IAAEC,IAAEC,IAAE;AAAC,WAAO,KAAK,YAAU,CAAC,GAAE,KAAK,iBAAe,CAAC,GAAE,KAAK,aAAW,CAAC,GAAE,GAAG,MAAKF,IAAEE,IAAED,EAAC,GAAE,GAAG,IAAI;AAAA,EAAC;AAAA,EAAC,IAAG;AAAC,QAAID,KAAE,IAAI;AAAG,OAAGA,IAAE,UAAU,GAAE,GAAGA,IAAE,WAAW,GAAE,GAAGA,IAAE,gBAAgB,GAAE,GAAGA,IAAE,sBAAsB,GAAE,GAAGA,IAAE,YAAY;AAAE,UAAMC,KAAE,IAAI;AAAG,OAAGA,IAAE,IAAG,KAAK,CAAC;AAAE,UAAMC,KAAE,IAAI;AAAG,OAAGA,IAAE,4DAA4D,GAAE,GAAGA,IAAE,gBAAgB,GAAE,GAAGA,IAAE,qBAAqB,GAAE,GAAGA,IAAE,0BAA0B,GAAE,GAAGA,IAAE,sCAAsC,GAAE,GAAGA,IAAE,uBAAuB,GAAEA,GAAE,EAAED,EAAC,GAAE,GAAGD,IAAEE,EAAC,GAAE,KAAK,EAAE,0BAA0B,kBAAkB,CAACF,IAAEC,OAAI;AAAC,iBAAUA,MAAKD,GAAE,CAAAA,KAAE,GAAGC,EAAC,GAAE,KAAK,UAAU,KAAK,GAAGD,EAAC,CAAC;AAAE,SAAG,MAAKC,EAAC;AAAA,IAAC,CAAE,GAAE,KAAK,EAAE,0BAA0B,kBAAkB,CAAAD,OAAG;AAAC,SAAG,MAAKA,EAAC;AAAA,IAAC,CAAE,GAAE,KAAK,EAAE,0BAA0B,wBAAwB,CAACA,IAAEC,OAAI;AAAC,iBAAUA,MAAKD,GAAE,CAAAA,KAAE,GAAGC,EAAC,GAAE,KAAK,eAAe,KAAK,GAAGD,EAAC,CAAC;AAAE,SAAG,MAAKC,EAAC;AAAA,IAAC,CAAE,GAAE,KAAK,EAAE,0BAA0B,wBAAwB,CAAAD,OAAG;AAAC,SAAG,MAAKA,EAAC;AAAA,IAAC,CAAE,GAAE,KAAK,EAAE,0BAA0B,cAAc,CAACA,IAAEC,OAAI;AAAC,UAAIC,KAAE,KAAK,YAAWC,KAAED,GAAE;AAAK,YAAME,KAAE,CAAC;AAAE,iBAAUH,MAAKD,IAAE;AAAC,QAAAA,KAAE,GAAGC,EAAC;AAAE,cAAMC,KAAE,CAAC;AAAE,mBAAUD,MAAKD,GAAE,EAAE,EAAE,CAAAE,GAAE,KAAK,EAAC,OAAM,GAAGD,IAAE,CAAC,KAAG,GAAE,OAAM,GAAG,GAAGA,IAAE,CAAC,GAAE,CAAC,KAAG,IAAG,cAAa,GAAGA,IAAE,CAAC,KAAG,IAAG,aAAY,GAAGA,IAAE,CAAC,KAAG,GAAE,CAAC;AAAE,QAAAG,GAAE,KAAKF,EAAC;AAAA,MAAC;AAAC,MAAAC,GAAE,KAAKD,IAAE,GAAGE,EAAC,GAAE,GAAG,MAAKH,EAAC;AAAA,IAAC,CAAE,GAAE,KAAK,EAAE,0BAA0B,cAAc,CAAAD,OAAG;AAAC,SAAG,MAAKA,EAAC;AAAA,IAAC,CAAE,GAAEA,KAAEA,GAAE,EAAE,GAAE,KAAK,SAAS,IAAI,WAAWA,EAAC,GAAE,IAAE;AAAA,EAAC;AAAC;AAAE,GAAG,UAAU,iBAAe,GAAG,UAAU,GAAE,GAAG,UAAU,SAAO,GAAG,UAAU,GAAE,GAAG,UAAU,aAAW,GAAG,UAAU,GAAE,GAAG,sBAAoB,SAASA,IAAEC,IAAE;AAAC,SAAO,GAAG,IAAGD,IAAE,EAAC,aAAY,EAAC,gBAAeC,GAAC,EAAC,CAAC;AAAC,GAAE,GAAG,wBAAsB,SAASD,IAAEC,IAAE;AAAC,SAAO,GAAG,IAAGD,IAAE,EAAC,aAAY,EAAC,kBAAiBC,GAAC,EAAC,CAAC;AAAC,GAAE,GAAG,oBAAkB,SAASD,IAAEC,IAAE;AAAC,SAAO,GAAG,IAAGD,IAAEC,EAAC;AAAC,GAAE,GAAG,mBAAiB;AAAG,IAAI,KAAG,GAAG,CAAC,GAAE,CAAC,GAAE,CAAC,GAAE,CAAC,GAAE,CAAC,GAAE,CAAC,GAAE,CAAC,GAAE,CAAC,GAAE,CAAC,GAAE,CAAC,GAAE,CAAC,GAAE,CAAC,GAAE,CAAC,GAAE,CAAC,GAAE,CAAC,GAAE,CAAC,GAAE,CAAC,GAAE,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,EAAE,GAAE,CAAC,IAAG,EAAE,CAAC;AAAE,SAAS,GAAGD,IAAE;AAAC,EAAAA,GAAE,IAAE,EAAC,eAAc,CAAC,GAAE,iBAAgB,CAAC,GAAE,eAAc,CAAC,GAAE,oBAAmB,CAAC,GAAE,uBAAsB,CAAC,GAAE,mBAAkB,CAAC,GAAE,wBAAuB,CAAC,GAAE,oBAAmB,CAAC,GAAE,yBAAwB,CAAC,EAAC;AAAC;AAAC,SAAS,GAAGA,IAAE;AAAC,MAAG;AAAC,QAAG,CAACA,GAAE,EAAE,QAAOA,GAAE;AAAE,IAAAA,GAAE,EAAEA,GAAE,CAAC;AAAA,EAAC,UAAC;AAAQ,OAAGA,EAAC;AAAA,EAAC;AAAC;AAAC,SAAS,GAAGA,IAAEC,IAAE;AAAC,EAAAD,KAAE,GAAGA,EAAC,GAAEC,GAAE,KAAK,GAAGD,EAAC,CAAC;AAAC;AAAC,IAAI,KAAG,cAAc,GAAE;AAAA,EAAC,YAAYA,IAAEC,IAAE;AAAC,UAAM,IAAI,GAAGD,IAAEC,EAAC,GAAE,sBAAqB,MAAK,KAAE,GAAE,KAAK,IAAE,EAAC,eAAc,CAAC,GAAE,iBAAgB,CAAC,GAAE,eAAc,CAAC,GAAE,oBAAmB,CAAC,GAAE,uBAAsB,CAAC,GAAE,mBAAkB,CAAC,GAAE,wBAAuB,CAAC,GAAE,oBAAmB,CAAC,GAAE,yBAAwB,CAAC,EAAC,GAAE,KAAK,8BAA4B,KAAK,wBAAsB,OAAG,GAAGD,KAAE,KAAK,IAAE,IAAI,MAAG,GAAE,GAAEC,KAAE,IAAI,IAAE,GAAE,KAAK,IAAE,IAAI,MAAG,GAAG,KAAK,GAAE,GAAE,GAAE,KAAK,CAAC,GAAE,KAAK,KAAG,IAAI,MAAG,GAAG,KAAK,GAAE,GAAE,GAAE,KAAK,EAAE,GAAE,KAAK,IAAE,IAAI,MAAG,GAAG,KAAK,GAAE,GAAE,GAAE,KAAK,CAAC,GAAE,KAAK,IAAE,IAAI,MAAG,GAAG,KAAK,GAAE,GAAE,GAAE,KAAK,CAAC,GAAE,KAAK,IAAE,IAAI,MAAG,GAAG,KAAK,GAAE,GAAE,GAAE,KAAK,CAAC,GAAE,KAAK,IAAE,IAAI,MAAG,GAAG,KAAK,GAAE,GAAE,GAAE,KAAK,CAAC,GAAE,GAAG,KAAK,GAAE,GAAE,GAAE,GAAE,GAAG,KAAK,GAAE,GAAE,GAAE,GAAE,GAAG,KAAK,GAAE,GAAE,GAAE,GAAE,GAAG,KAAK,GAAE,GAAE,GAAE,GAAE,GAAG,KAAK,GAAE,GAAE,GAAE,GAAE,GAAG,KAAK,GAAE,GAAE,GAAE,GAAE,GAAG,KAAK,GAAE,GAAE,GAAE;AAAA,EAAC;AAAA,EAAC,IAAI,cAAa;AAAC,WAAO,GAAG,KAAK,GAAE,IAAG,CAAC;AAAA,EAAC;AAAA,EAAC,IAAI,YAAYD,IAAE;AAAC,OAAG,KAAK,GAAE,GAAE,GAAEA,EAAC;AAAA,EAAC;AAAA,EAAC,EAAEA,IAAE;AAAC,WAAM,gCAA+BA,MAAG,GAAG,KAAK,GAAE,GAAEA,GAAE,8BAA4B,GAAE,GAAE,iCAAgCA,MAAG,GAAG,KAAK,GAAE,GAAEA,GAAE,+BAA6B,GAAE,GAAE,+BAA8BA,MAAG,GAAG,KAAK,GAAE,GAAEA,GAAE,6BAA2B,GAAE,GAAE,2BAA0BA,OAAI,KAAK,wBAAsB,CAAC,CAACA,GAAE,wBAAuB,gCAA+BA,MAAG,GAAG,KAAK,GAAE,GAAEA,GAAE,8BAA4B,GAAE,GAAE,iCAAgCA,MAAG,GAAG,KAAK,GAAE,GAAEA,GAAE,+BAA6B,GAAE,GAAE,+BAA8BA,MAAG,GAAG,KAAK,GAAE,GAAEA,GAAE,6BAA2B,GAAE,GAAE,iCAAgCA,OAAI,KAAK,8BAA4B,CAAC,CAACA,GAAE,8BAA6B,gCAA+BA,MAAG,GAAG,KAAK,GAAE,GAAEA,GAAE,8BAA4B,GAAE,GAAE,KAAK,EAAEA,EAAC;AAAA,EAAC;AAAA,EAAC,EAAEA,IAAEC,IAAEC,IAAE;AAAC,UAAMC,KAAE,cAAY,OAAOF,KAAEA,KAAE,CAAC;AAAE,WAAO,KAAK,IAAE,cAAY,OAAOA,KAAEA,KAAEC,IAAE,GAAG,IAAI,GAAE,GAAG,MAAKF,IAAEG,EAAC,GAAE,GAAG,IAAI;AAAA,EAAC;AAAA,EAAC,EAAEH,IAAEC,IAAEC,IAAEC,IAAE;AAAC,UAAMC,KAAE,cAAY,OAAOF,KAAEA,KAAE,CAAC;AAAE,WAAO,KAAK,IAAE,cAAY,OAAOA,KAAEA,KAAEC,IAAE,GAAG,IAAI,GAAE,GAAG,MAAKH,IAAEI,IAAEH,EAAC,GAAE,GAAG,IAAI;AAAA,EAAC;AAAA,EAAC,IAAG;AAAC,QAAID,KAAE,IAAI;AAAG,OAAGA,IAAE,oBAAoB,GAAE,GAAGA,IAAE,gBAAgB,GAAE,GAAGA,IAAE,sBAAsB,GAAE,GAAGA,IAAE,gBAAgB,GAAE,GAAGA,IAAE,qBAAqB,GAAE,GAAGA,IAAE,2BAA2B,GAAE,GAAGA,IAAE,sBAAsB,GAAE,GAAGA,IAAE,4BAA4B;AAAE,UAAMC,KAAE,IAAI,MAAGC,KAAE,IAAI;AAAG,OAAGA,IAAE,GAAE,GAAG,qGAAqG,GAAE,EAAE,GAAE,SAASF,IAAEC,IAAE;AAAC,UAAG,QAAMA,GAAE,KAAG,MAAM,QAAQA,EAAC,EAAE,IAAGD,IAAE,GAAE,GAAGC,IAAE,IAAG,QAAO,QAAO,KAAE,CAAC;AAAA,WAAM;AAAC,YAAG,EAAE,YAAU,OAAOA,MAAGA,cAAakC,MAAGN,GAAE5B,EAAC,GAAG,OAAM,MAAM,uCAAqCA,KAAE,+EAA+E;AAAE,WAAGD,IAAE,GAAE,GAAGC,IAAE,OAAG,KAAE,GAAEiC,GAAE,CAAC;AAAA,MAAC;AAAA,IAAC,EAAEhC,IAAE,KAAK,EAAE,EAAE,CAAC;AAAE,UAAMC,KAAE,IAAI;AAAG,OAAGA,IAAE,oEAAoE,GAAE,GAAGA,IAAE,GAAE,IAAGD,EAAC,GAAE,GAAGC,IAAE,0BAA0B,GAAE,GAAGA,IAAE,+BAA+B,GAAE,GAAGA,IAAE,2CAA2C,GAAE,GAAGA,IAAE,+BAA+B,GAAE,GAAGA,IAAE,yCAAyC,GAAE,GAAGA,IAAE,qDAAqD,GAAE,GAAGA,IAAE,2CAA2C,GAAE,GAAGA,IAAE,uDAAuD,GAAEA,GAAE,EAAEF,EAAC,GAAE,GAAGD,IAAEG,EAAC,GAAE,GAAG,MAAKH,EAAC,GAAE,KAAK,EAAE,oBAAoB,kBAAkB,CAACA,IAAEC,OAAI;AAAC,SAAGD,IAAE,KAAK,EAAE,aAAa,GAAE,GAAG,MAAKC,EAAC;AAAA,IAAC,CAAE,GAAE,KAAK,EAAE,0BAA0B,kBAAkB,CAAAD,OAAG;AAAC,SAAG,MAAKA,EAAC;AAAA,IAAC,CAAE,GAAE,KAAK,EAAE,oBAAoB,wBAAwB,CAACA,IAAEC,OAAI;AAAC,UAAIC,KAAE,KAAK,EAAE;AAAmB,MAAAF,KAAE,GAAGA,EAAC,GAAEE,GAAE,KAAK,GAAGF,EAAC,CAAC,GAAE,GAAG,MAAKC,EAAC;AAAA,IAAC,CAAE,GAAE,KAAK,EAAE,0BAA0B,wBAAwB,CAAAD,OAAG;AAAC,SAAG,MAAKA,EAAC;AAAA,IAAC,CAAE,GAAE,KAAK,gCAA8B,GAAGG,IAAE,+CAA+C,GAAE,GAAG,MAAK,wBAAwB,GAAE,KAAK,EAAE,EAAE,0BAA0B,CAACH,IAAEC,OAAI;AAAC,WAAK,EAAE,wBAAsB,CAAC,GAAG,MAAKD,IAAE,MAAG,CAAC,KAAK,CAAC,CAAC,GAAE,GAAG,MAAKC,EAAC;AAAA,IAAC,CAAE,GAAE,KAAK,EAAE,0BAA0B,0BAA0B,CAAAD,OAAG;AAAC,WAAK,EAAE,wBAAsB,CAAC,GAAE,GAAG,MAAKA,EAAC;AAAA,IAAC,CAAE,IAAG,KAAK,EAAE,oBAAoB,kBAAkB,CAACA,IAAEC,OAAI;AAAC,SAAGD,IAAE,KAAK,EAAE,aAAa,GAAE,GAAG,MAAKC,EAAC;AAAA,IAAC,CAAE,GAAE,KAAK,EAAE,0BAA0B,kBAAkB,CAAAD,OAAG;AAAC,SAAG,MAAKA,EAAC;AAAA,IAAC,CAAE,GAAE,KAAK,0BAAwB,GAAGA,IAAE,mBAAmB,GAAE,GAAGG,IAAE,oCAAoC,GAAE,KAAK,EAAE,oBAAoB,qBAAqB,CAACH,IAAEC,OAAI;AAAC,UAAIC,KAAE,KAAK,EAAE;AAAgB,WAAK,0BAAwBF,KAAE,GAAGA,EAAC,GAAEE,GAAE,KAAK,GAAGF,GAAE,EAAE,KAAG,CAAC,CAAC,CAAC,IAAG,GAAG,MAAKC,EAAC;AAAA,IAAC,CAAE,GAAE,KAAK,EAAE,0BAA0B,qBAAqB,CAAAD,OAAG;AAAC,SAAG,MAAKA,EAAC;AAAA,IAAC,CAAE,IAAG,KAAK,EAAE,oBAAoB,uBAAuB,CAACA,IAAEC,OAAI;AAAC,SAAGD,IAAE,KAAK,EAAE,iBAAiB,GAAE,GAAG,MAAKC,EAAC;AAAA,IAAC,CAAE,GAAE,KAAK,EAAE,0BAA0B,uBAAuB,CAAAD,OAAG;AAAC,SAAG,MAAKA,EAAC;AAAA,IAAC,CAAE,GAAE,KAAK,EAAE,oBAAoB,6BAA6B,CAACA,IAAEC,OAAI;AAAC,UAAIC,KAAE,KAAK,EAAE;AAAuB,MAAAF,KAAE,GAAGA,EAAC,GAAEE,GAAE,KAAK,GAAGF,EAAC,CAAC,GAAE,GAAG,MAAKC,EAAC;AAAA,IAAC,CAAE,GAAE,KAAK,EAAE,0BAA0B,6BAA6B,CAAAD,OAAG;AAAC,SAAG,MAAKA,EAAC;AAAA,IAAC,CAAE,GAAE,KAAK,EAAE,oBAAoB,wBAAwB,CAACA,IAAEC,OAAI;AAAC,SAAGD,IAAE,KAAK,EAAE,kBAAkB,GAAE,GAAG,MAAKC,EAAC;AAAA,IAAC,CAAE,GAAE,KAAK,EAAE,0BAA0B,wBAAwB,CAAAD,OAAG;AAAC,SAAG,MAAKA,EAAC;AAAA,IAAC,CAAE,GAAE,KAAK,EAAE,oBAAoB,8BAA8B,CAACA,IAAEC,OAAI;AAAC,UAAIC,KAAE,KAAK,EAAE;AAAwB,MAAAF,KAAE,GAAGA,EAAC,GAAEE,GAAE,KAAK,GAAGF,EAAC,CAAC,GAAE,GAAG,MAAKC,EAAC;AAAA,IAAC,CAAE,GAAE,KAAK,EAAE,0BAA0B,8BAA8B,CAAAD,OAAG;AAAC,SAAG,MAAKA,EAAC;AAAA,IAAC,CAAE,GAAEA,KAAEA,GAAE,EAAE,GAAE,KAAK,SAAS,IAAI,WAAWA,EAAC,GAAE,IAAE;AAAA,EAAC;AAAC;AAAE,GAAG,UAAU,iBAAe,GAAG,UAAU,GAAE,GAAG,UAAU,SAAO,GAAG,UAAU,GAAE,GAAG,UAAU,aAAW,GAAG,UAAU,GAAE,GAAG,sBAAoB,SAASA,IAAEC,IAAE;AAAC,SAAO,GAAG,IAAGD,IAAE,EAAC,aAAY,EAAC,gBAAeC,GAAC,EAAC,CAAC;AAAC,GAAE,GAAG,wBAAsB,SAASD,IAAEC,IAAE;AAAC,SAAO,GAAG,IAAGD,IAAE,EAAC,aAAY,EAAC,kBAAiBC,GAAC,EAAC,CAAC;AAAC,GAAE,GAAG,oBAAkB,SAASD,IAAEC,IAAE;AAAC,SAAO,GAAG,IAAGD,IAAEC,EAAC;AAAC,GAAE,GAAG,mBAAiB,IAAG,GAAG,mBAAiB,IAAG,GAAG,sBAAoB,IAAG,GAAG,0BAAwB,IAAG,GAAG,8BAA4B,IAAG,GAAG,2BAAyB,IAAG,GAAG,2BAAyB,IAAG,GAAG,+BAA6B,IAAG,GAAG,4BAA0B,IAAG,GAAG,2BAAyB,IAAG,GAAG,0BAAwB,IAAG,GAAG,6BAA2B;AAAG,IAAI,KAAG,cAAc,GAAE;AAAA,EAAC,YAAYD,IAAEC,IAAE;AAAC,UAAM,IAAI,GAAGD,IAAEC,EAAC,GAAE,eAAc,aAAY,IAAE,GAAE,KAAK,IAAE,EAAC,iBAAgB,CAAC,EAAC,GAAE,GAAGD,KAAE,KAAK,IAAE,IAAI,MAAG,GAAE,GAAEC,KAAE,IAAI,IAAE;AAAA,EAAC;AAAA,EAAC,IAAI,cAAa;AAAC,WAAO,GAAG,KAAK,GAAE,IAAG,CAAC;AAAA,EAAC;AAAA,EAAC,IAAI,YAAYD,IAAE;AAAC,OAAG,KAAK,GAAE,GAAE,GAAEA,EAAC;AAAA,EAAC;AAAA,EAAC,EAAEA,IAAE;AAAC,WAAO,GAAG,KAAK,GAAE,GAAE,GAAE,GAAGA,IAAE,GAAG,KAAK,GAAE,IAAG,CAAC,CAAC,CAAC,GAAE,KAAK,EAAEA,EAAC;AAAA,EAAC;AAAA,EAAC,GAAGA,IAAEC,IAAE;AAAC,WAAO,KAAK,IAAE,EAAC,iBAAgB,CAAC,EAAC,GAAE,GAAG,MAAKD,IAAEC,EAAC,GAAE,KAAK;AAAA,EAAC;AAAA,EAAC,GAAGD,IAAEC,IAAEC,IAAE;AAAC,WAAO,KAAK,IAAE,EAAC,iBAAgB,CAAC,EAAC,GAAE,GAAG,MAAKF,IAAEE,IAAED,EAAC,GAAE,KAAK;AAAA,EAAC;AAAA,EAAC,IAAG;AAAC,QAAID,KAAE,IAAI;AAAG,OAAGA,IAAE,aAAa,GAAE,GAAGA,IAAE,WAAW,GAAE,GAAGA,IAAE,iBAAiB;AAAE,UAAMC,KAAE,IAAI;AAAG,OAAGA,IAAE,IAAG,KAAK,CAAC;AAAE,UAAMC,KAAE,IAAI;AAAG,OAAGA,IAAE,8DAA8D,GAAE,GAAGA,IAAE,mBAAmB,GAAE,GAAGA,IAAE,qBAAqB,GAAE,GAAGA,IAAE,iCAAiC,GAAEA,GAAE,EAAED,EAAC,GAAE,GAAGD,IAAEE,EAAC,GAAE,KAAK,EAAE,oBAAoB,mBAAmB,CAACF,IAAEC,OAAI;AAAC,WAAK,IAAE,SAASD,IAAE;AAAC,cAAMC,KAAE,EAAC,iBAAgB,GAAGD,IAAE,IAAG,CAAC,EAAE,IAAK,CAAAA,OAAG,GAAG,GAAGA,IAAE,IAAG,CAAC,GAAG,EAAE,KAAG,CAAC,GAAE,GAAG,GAAGA,IAAE,CAAC,GAAE,CAAC,GAAE,GAAGA,IAAE,CAAC,CAAC,CAAE,EAAC;AAAE,eAAO,QAAM,GAAG,GAAGA,IAAE,CAAC,CAAC,MAAIC,GAAE,cAAY,GAAG,GAAG,GAAGD,IAAE,CAAC,CAAC,GAAE,CAAC,IAAGC;AAAA,MAAC,EAAE,GAAGD,EAAC,CAAC,GAAE,GAAG,MAAKC,EAAC;AAAA,IAAC,CAAE,GAAE,KAAK,EAAE,0BAA0B,mBAAmB,CAAAD,OAAG;AAAC,SAAG,MAAKA,EAAC;AAAA,IAAC,CAAE,GAAEA,KAAEA,GAAE,EAAE,GAAE,KAAK,SAAS,IAAI,WAAWA,EAAC,GAAE,IAAE;AAAA,EAAC;AAAC;AAAE,GAAG,UAAU,mBAAiB,GAAG,UAAU,IAAG,GAAG,UAAU,WAAS,GAAG,UAAU,IAAG,GAAG,UAAU,aAAW,GAAG,UAAU,GAAE,GAAG,sBAAoB,SAASA,IAAEC,IAAE;AAAC,SAAO,GAAG,IAAGD,IAAE,EAAC,aAAY,EAAC,gBAAeC,GAAC,EAAC,CAAC;AAAC,GAAE,GAAG,wBAAsB,SAASD,IAAEC,IAAE;AAAC,SAAO,GAAG,IAAGD,IAAE,EAAC,aAAY,EAAC,kBAAiBC,GAAC,EAAC,CAAC;AAAC,GAAE,GAAG,oBAAkB,SAASD,IAAEC,IAAE;AAAC,SAAO,GAAG,IAAGD,IAAEC,EAAC;AAAC;AAAE,IAAI,KAAG,cAAc,GAAE;AAAA,EAAC,YAAYD,IAAEC,IAAE;AAAC,UAAM,IAAI,GAAGD,IAAEC,EAAC,GAAE,YAAW,aAAY,IAAE,GAAE,KAAK,IAAE,IAAI,MAAG,KAAK,aAAW,EAAC,YAAW,CAAC,EAAC,GAAE,GAAGD,KAAE,KAAK,GAAE,GAAE,GAAEC,KAAE,IAAI,IAAE;AAAA,EAAC;AAAA,EAAC,IAAI,cAAa;AAAC,WAAO,GAAG,KAAK,GAAE,IAAG,CAAC;AAAA,EAAC;AAAA,EAAC,IAAI,YAAYD,IAAE;AAAC,OAAG,KAAK,GAAE,GAAE,GAAEA,EAAC;AAAA,EAAC;AAAA,EAAC,EAAEA,IAAE;AAAC,QAAIC,KAAE,KAAK,GAAEC,KAAE,GAAG,KAAK,GAAE,IAAG,CAAC;AAAE,WAAOA,KAAEA,KAAEA,GAAE,MAAM,IAAE,IAAI,MAAG,WAASF,GAAE,cAAY,GAAGE,IAAE,GAAEF,GAAE,WAAW,IAAE,iBAAgBA,MAAG,GAAGE,IAAE,CAAC,GAAE,WAASF,GAAE,WAAS,GAAGE,IAAE,GAAEF,GAAE,QAAQ,IAAE,cAAaA,MAAG,GAAGE,IAAE,CAAC,GAAE,GAAGD,IAAE,GAAE,GAAEC,EAAC,GAAE,KAAK,EAAEF,EAAC;AAAA,EAAC;AAAA,EAAC,GAAGA,IAAEC,IAAE;AAAC,WAAO,GAAG,MAAKD,IAAEC,EAAC,GAAE,KAAK;AAAA,EAAU;AAAA,EAAC,GAAGD,IAAEC,IAAEC,IAAE;AAAC,WAAO,GAAG,MAAKF,IAAEE,IAAED,EAAC,GAAE,KAAK;AAAA,EAAU;AAAA,EAAC,IAAG;AAAC,QAAID,KAAE,IAAI;AAAG,OAAGA,IAAE,UAAU,GAAE,GAAGA,IAAE,WAAW,GAAE,GAAGA,IAAE,gBAAgB;AAAE,UAAMC,KAAE,IAAI;AAAG,OAAGA,IAAE,IAAG,KAAK,CAAC;AAAE,UAAMC,KAAE,IAAI;AAAG,OAAGA,IAAE,0DAA0D,GAAE,GAAGA,IAAE,gBAAgB,GAAE,GAAGA,IAAE,qBAAqB,GAAE,GAAGA,IAAE,2BAA2B,GAAEA,GAAE,EAAED,EAAC,GAAE,GAAGD,IAAEE,EAAC,GAAE,KAAK,EAAE,oBAAoB,kBAAkB,CAACF,IAAEC,OAAI;AAAC,MAAAD,KAAE,GAAGA,EAAC,GAAE,KAAK,aAAW,SAASA,IAAE;AAAC,eAAM,EAAC,YAAW,GAAGA,IAAE,IAAG,CAAC,EAAE,IAAK,CAAAA,OAAG;AAAC,gBAAMC,KAAE,EAAC,WAAU,GAAG,GAAGD,IAAE,CAAC,GAAE,CAAC,KAAG,IAAG,UAAS,GAAGA,IAAE,CAAC,KAAG,GAAE;AAAE,cAAG,WAAS,GAAGA,IAAE,IAAG,GAAGA,IAAE,CAAC,CAAC,EAAE,CAAAA,KAAE,GAAGA,KAAE,GAAGA,IAAE,IAAG,GAAGA,IAAE,CAAC,CAAC,GAAE,GAAE,EAAE,GAAEC,GAAE,iBAAeD,GAAE,MAAM;AAAA,eAAM;AAAC,kBAAME,KAAE,IAAI,WAAW,CAAC;AAAE,YAAAD,GAAE,qBAAmB,GAAGD,IAAE,IAAG,GAAGA,IAAE,CAAC,CAAC,GAAG,GAAG,GAAG,EAAE,KAAGE;AAAA,UAAC;AAAC,iBAAOD;AAAA,QAAC,CAAE,GAAE,aAAY,GAAG,GAAG,GAAGD,IAAE,CAAC,CAAC,GAAE,CAAC,EAAC;AAAA,MAAC,EAAEA,EAAC,GAAE,GAAG,MAAKC,EAAC;AAAA,IAAC,CAAE,GAAE,KAAK,EAAE,0BAA0B,kBAAkB,CAAAD,OAAG;AAAC,SAAG,MAAKA,EAAC;AAAA,IAAC,CAAE,GAAEA,KAAEA,GAAE,EAAE,GAAE,KAAK,SAAS,IAAI,WAAWA,EAAC,GAAE,IAAE;AAAA,EAAC;AAAC;AAAE,GAAG,mBAAiB,SAASA,IAAEC,IAAE;AAAC,MAAGD,GAAE,kBAAgBC,GAAE,eAAe,CAAAD,KAAE,GAAGA,GAAE,gBAAeC,GAAE,cAAc;AAAA,OAAM;AAAC,QAAG,CAACD,GAAE,sBAAoB,CAACC,GAAE,mBAAmB,OAAM,MAAM,0EAA0E;AAAE,IAAAD,KAAE,GAAG,GAAGA,GAAE,kBAAkB,GAAE,GAAGC,GAAE,kBAAkB,CAAC;AAAA,EAAC;AAAC,SAAOD;AAAC,GAAE,GAAG,UAAU,gBAAc,GAAG,UAAU,IAAG,GAAG,UAAU,QAAM,GAAG,UAAU,IAAG,GAAG,UAAU,aAAW,GAAG,UAAU,GAAE,GAAG,sBAAoB,SAASA,IAAEC,IAAE;AAAC,SAAO,GAAG,IAAGD,IAAE,EAAC,aAAY,EAAC,gBAAeC,GAAC,EAAC,CAAC;AAAC,GAAE,GAAG,wBAAsB,SAASD,IAAEC,IAAE;AAAC,SAAO,GAAG,IAAGD,IAAE,EAAC,aAAY,EAAC,kBAAiBC,GAAC,EAAC,CAAC;AAAC,GAAE,GAAG,oBAAkB,SAASD,IAAEC,IAAE;AAAC,SAAO,GAAG,IAAGD,IAAEC,EAAC;AAAC;AAAE,IAAI,KAAG,MAAK;AAAA,EAAC,YAAYD,IAAEC,IAAEC,IAAE;AAAC,SAAK,kBAAgBF,IAAE,KAAK,eAAaC,IAAE,KAAK,gBAAcC;AAAA,EAAC;AAAA,EAAC,QAAO;AAAC,SAAK,iBAAiB,QAAS,CAAAF,OAAG;AAAC,MAAAA,GAAE,MAAM;AAAA,IAAC,CAAE,GAAE,KAAK,cAAc,MAAM;AAAA,EAAC;AAAC;AAAE,SAAS,GAAGA,IAAE;AAAC,EAAAA,GAAE,eAAa,QAAOA,GAAE,kBAAgB,QAAOA,GAAE,gBAAc;AAAM;AAAC,SAAS,GAAGA,IAAE;AAAC,MAAG;AAAC,UAAMC,KAAE,IAAI,GAAGD,GAAE,iBAAgBA,GAAE,cAAaA,GAAE,aAAa;AAAE,QAAG,CAACA,GAAE,EAAE,QAAOC;AAAE,IAAAD,GAAE,EAAEC,EAAC;AAAA,EAAC,UAAC;AAAQ,OAAGD,EAAC;AAAA,EAAC;AAAC;AAAC,GAAG,UAAU,QAAM,GAAG,UAAU;AAAM,IAAI,KAAG,cAAc,GAAE;AAAA,EAAC,YAAYA,IAAEC,IAAE;AAAC,UAAM,IAAI,GAAGD,IAAEC,EAAC,GAAE,YAAW,aAAY,KAAE,GAAE,KAAK,IAAE,CAAC,GAAE,KAAK,qBAAmB,OAAG,KAAK,wBAAsB,MAAG,KAAK,IAAE,IAAI,MAAG,KAAK,IAAE,IAAI,MAAG,GAAG,KAAK,GAAE,GAAE,GAAE,KAAK,CAAC,GAAE,GAAGD,KAAE,KAAK,GAAE,GAAE,GAAEC,KAAE,IAAI,IAAE;AAAA,EAAC;AAAA,EAAC,IAAI,cAAa;AAAC,WAAO,GAAG,KAAK,GAAE,IAAG,CAAC;AAAA,EAAC;AAAA,EAAC,IAAI,YAAYD,IAAE;AAAC,OAAG,KAAK,GAAE,GAAE,GAAEA,EAAC;AAAA,EAAC;AAAA,EAAC,EAAEA,IAAE;AAAC,WAAO,WAASA,GAAE,qBAAmB,GAAG,KAAK,GAAE,GAAE,GAAGA,GAAE,kBAAkB,CAAC,IAAE,wBAAuBA,MAAG,GAAG,KAAK,GAAE,CAAC,GAAE,wBAAuBA,OAAI,KAAK,qBAAmBA,GAAE,sBAAoB,QAAI,2BAA0BA,OAAI,KAAK,wBAAsBA,GAAE,yBAAuB,OAAI,MAAM,EAAEA,EAAC;AAAA,EAAC;AAAA,EAAC,IAAG;AAAC,KAAC,SAASA,IAAE;AAAC,YAAMC,KAAE,GAAGD,GAAE,GAAG,GAAE,IAAG,CAAC,EAAE,OAAQ,CAAAA,OAAG,GAAGA,IAAE,CAAC,EAAE,SAAS,iDAAiD,CAAE;AAAE,UAAGA,GAAE,IAAE,CAAC,GAAE,IAAEC,GAAE,OAAO,OAAM,MAAM,8EAA8E;AAAE,YAAIA,GAAE,WAAS,GAAGA,GAAE,CAAC,GAAE,IAAG,CAAC,GAAG,EAAE,GAAG,EAAE,KAAG,oBAAI,OAAK,QAAS,CAACA,IAAEC,OAAI;AAAC,QAAAF,GAAE,EAAE,OAAOE,EAAC,CAAC,IAAE,GAAGD,IAAE,CAAC;AAAA,MAAC,CAAE;AAAA,IAAC,EAAE,IAAI;AAAA,EAAC;AAAA,EAAC,GAAGD,IAAEC,IAAEC,IAAE;AAAC,UAAMC,KAAE,cAAY,OAAOF,KAAEA,KAAE,CAAC;AAAE,WAAO,KAAK,IAAE,cAAY,OAAOA,KAAEA,KAAEC,IAAE,GAAG,IAAI,GAAE,GAAG,MAAKF,IAAEG,EAAC,GAAE,GAAG,IAAI;AAAA,EAAC;AAAA,EAAC,GAAGH,IAAEC,IAAEC,IAAEC,IAAE;AAAC,UAAMC,KAAE,cAAY,OAAOF,KAAEA,KAAE,CAAC;AAAE,WAAO,KAAK,IAAE,cAAY,OAAOA,KAAEA,KAAEC,IAAE,GAAG,IAAI,GAAE,GAAG,MAAKH,IAAEI,IAAEH,EAAC,GAAE,GAAG,IAAI;AAAA,EAAC;AAAA,EAAC,KAAI;AAAC,WAAO,KAAK;AAAA,EAAC;AAAA,EAAC,IAAG;AAAC,QAAID,KAAE,IAAI;AAAG,OAAGA,IAAE,UAAU,GAAE,GAAGA,IAAE,WAAW;AAAE,UAAMC,KAAE,IAAI;AAAG,OAAGA,IAAE,IAAG,KAAK,CAAC;AAAE,UAAMC,KAAE,IAAI;AAAG,OAAGA,IAAE,4DAA4D,GAAE,GAAGA,IAAE,gBAAgB,GAAE,GAAGA,IAAE,qBAAqB,GAAEA,GAAE,EAAED,EAAC,GAAE,GAAGD,IAAEE,EAAC,GAAE,GAAG,MAAKF,EAAC,GAAE,KAAK,0BAAwB,GAAGA,IAAE,kBAAkB,GAAE,GAAGE,IAAE,mCAAmC,GAAE,GAAG,MAAK,kBAAkB,GAAE,KAAK,EAAE,GAAG,oBAAoB,CAACF,IAAEC,OAAI;AAAC,WAAK,kBAAgBD,GAAE,IAAK,CAAAA,OAAG,GAAG,MAAKA,IAAE,MAAG,CAAC,KAAK,CAAC,CAAE,GAAE,GAAG,MAAKC,EAAC;AAAA,IAAC,CAAE,GAAE,KAAK,EAAE,0BAA0B,oBAAoB,CAAAD,OAAG;AAAC,WAAK,kBAAgB,CAAC,GAAE,GAAG,MAAKA,EAAC;AAAA,IAAC,CAAE,IAAG,KAAK,uBAAqB,GAAGA,IAAE,eAAe,GAAE,GAAGE,IAAE,6BAA6B,GAAE,GAAG,MAAK,eAAe,GAAE,KAAK,EAAE,EAAE,iBAAiB,CAACF,IAAEC,OAAI;AAAC,WAAK,eAAa,GAAG,MAAKD,IAAE,OAAG,CAAC,KAAK,CAAC,GAAE,GAAG,MAAKC,EAAC;AAAA,IAAC,CAAE,GAAE,KAAK,EAAE,0BAA0B,iBAAiB,CAAAD,OAAG;AAAC,WAAK,eAAa,QAAO,GAAG,MAAKA,EAAC;AAAA,IAAC,CAAE,IAAG,GAAGA,IAAE,gBAAgB,GAAE,GAAGE,IAAE,+BAA+B,GAAE,KAAK,EAAE,0BAA0B,kBAAkB,CAACF,IAAEC,OAAI;AAAC,WAAK,gBAAcD,IAAE,GAAG,MAAKC,EAAC;AAAA,IAAC,CAAE,GAAE,KAAK,EAAE,0BAA0B,kBAAkB,CAAAD,OAAG;AAAC,WAAK,eAAa,QAAO,GAAG,MAAKA,EAAC;AAAA,IAAC,CAAE,GAAEA,KAAEA,GAAE,EAAE,GAAE,KAAK,SAAS,IAAI,WAAWA,EAAC,GAAE,IAAE;AAAA,EAAC;AAAC;AAAE,GAAG,UAAU,YAAU,GAAG,UAAU,IAAG,GAAG,UAAU,kBAAgB,GAAG,UAAU,IAAG,GAAG,UAAU,UAAQ,GAAG,UAAU,IAAG,GAAG,UAAU,aAAW,GAAG,UAAU,GAAE,GAAG,sBAAoB,SAASA,IAAEC,IAAE;AAAC,SAAO,GAAG,IAAGD,IAAE,EAAC,aAAY,EAAC,gBAAeC,GAAC,EAAC,CAAC;AAAC,GAAE,GAAG,wBAAsB,SAASD,IAAEC,IAAE;AAAC,SAAO,GAAG,IAAGD,IAAE,EAAC,aAAY,EAAC,kBAAiBC,GAAC,EAAC,CAAC;AAAC,GAAE,GAAG,oBAAkB,SAASD,IAAEC,IAAE;AAAC,SAAO,GAAG,IAAGD,IAAEC,EAAC;AAAC;AAAE,IAAI,KAAG,MAAK;AAAA,EAAC,YAAYD,IAAEC,IAAEC,IAAE;AAAC,SAAK,kBAAgBF,IAAE,KAAK,eAAaC,IAAE,KAAK,gBAAcC;AAAA,EAAC;AAAA,EAAC,QAAO;AAAC,SAAK,iBAAiB,QAAS,CAAAF,OAAG;AAAC,MAAAA,GAAE,MAAM;AAAA,IAAC,CAAE,GAAE,KAAK,cAAc,MAAM;AAAA,EAAC;AAAC;AAAE,GAAG,UAAU,QAAM,GAAG,UAAU;AAAM,IAAI,KAAG,cAAc,GAAE;AAAA,EAAC,YAAYA,IAAE;AAAC,UAAMA,EAAC;AAAA,EAAC;AAAC;AAAhD,IAAkD,KAAG,CAAC,GAAE,IAAG,EAAE;AAA7D,IAA+D,KAAG,CAAC,GAAE,IAAG,IAAG,EAAE;AAA7E,IAA+E,KAAG,CAAC,GAAE,IAAG,IAAG,IAAG,IAAG,EAAE;AAAnG,IAAqG,KAAG,CAAC,GAAE,EAAE;AAA7G,IAA+G,KAAG,CAAC,GAAE,IAAG,EAAE;AAA1H,IAA4H,KAAG,CAAC,GAAE,IAAG,EAAE;AAAvI,IAAyI,KAAG,CAAC,GAAE,IAAG,IAAG,EAAE;AAAvJ,IAAyJ,KAAG,CAAC,GAAE,IAAG,EAAE;AAApK,IAAsK,KAAG,CAAC,GAAE,IAAG,IAAG,IAAG,IAAG,EAAE;AAA1L,IAA4L,KAAG,CAAC,GAAE,IAAG,IAAG,IAAG,EAAE;AAA7M,IAA+M,KAAG,cAAc,GAAE;AAAA,EAAC,YAAYA,IAAE;AAAC,UAAMA,EAAC;AAAA,EAAC;AAAC;AAA3P,IAA6P,KAAG,CAAC,GAAE,IAAG,IAAG,EAAE;AAA3Q,IAA6Q,KAAG,cAAc,GAAE;AAAA,EAAC,cAAa;AAAC,UAAM;AAAA,EAAC;AAAC;AAAE,GAAG,IAAE,CAAC,CAAC;AAAE,IAAI,KAAG,cAAc,GAAE;AAAA,EAAC,YAAYA,IAAE;AAAC,UAAMA,EAAC;AAAA,EAAC;AAAC;AAAhD,IAAkD,KAAG,CAAC,GAAE,GAAE,GAAE,GAAE,GAAE,GAAE,GAAE,GAAE,GAAE,IAAG,IAAG,EAAE;AAAhF,IAAkF,KAAG,CAAC,GAAE,IAAG,IAAG,IAAG,IAAG,IAAG,IAAG,IAAG,IAAG,IAAG,IAAG,IAAG,IAAG,IAAG,IAAG,IAAG,IAAG,CAAC,GAAE,IAAG,IAAG,IAAG,IAAG,IAAG,IAAG,IAAG,GAAE,IAAG,EAAE,GAAE,IAAG,IAAG,IAAG,IAAG,IAAG,IAAG,IAAG,IAAG,IAAG,IAAG,CAAC,GAAE,IAAG,EAAE,CAAC;AAAhN,IAAkN,KAAG,CAAC,GAAE,IAAG,IAAG,IAAG,EAAE;AAAnO,IAAqO,KAAG,cAAc,GAAE;AAAA,EAAC,cAAa;AAAC,UAAM;AAAA,EAAC;AAAC;AAAE,GAAG,IAAE,CAAC,CAAC,GAAE,GAAG,UAAU,IAAEkE,IAAG,CAAC,GAAE,IAAG,IAAG,IAAG,EAAE,CAAC;AAAE,IAAI,KAAG,cAAc,GAAE;AAAA,EAAC,YAAYlE,IAAEC,IAAE;AAAC,UAAM,IAAI,GAAGD,IAAEC,EAAC,GAAE,YAAW,gBAAe,KAAE,GAAE,KAAK,qBAAmB,OAAG,KAAK,wBAAsB,MAAG,KAAK,IAAE,IAAI,MAAG,KAAK,IAAE,IAAI,MAAG,GAAG,KAAK,GAAE,GAAE,GAAE,KAAK,CAAC,GAAE,GAAGD,KAAE,KAAK,GAAE,GAAE,GAAEC,KAAE,IAAI,IAAE;AAAA,EAAC;AAAA,EAAC,IAAI,cAAa;AAAC,WAAO,GAAG,KAAK,GAAE,IAAG,CAAC;AAAA,EAAC;AAAA,EAAC,IAAI,YAAYD,IAAE;AAAC,OAAG,KAAK,GAAE,GAAE,GAAEA,EAAC;AAAA,EAAC;AAAA,EAAC,EAAEA,IAAE;AAAC,WAAM,wBAAuBA,OAAI,KAAK,qBAAmBA,GAAE,sBAAoB,QAAI,2BAA0BA,OAAI,KAAK,wBAAsBA,GAAE,yBAAuB,OAAI,MAAM,EAAEA,EAAC;AAAA,EAAC;AAAA,EAAC,GAAGA,IAAEC,IAAEC,IAAEC,IAAE;AAAC,UAAMC,KAAE,cAAY,OAAOF,KAAEA,KAAE,CAAC;AAAE,SAAK,IAAE,cAAY,OAAOA,KAAEA,KAAEC,IAAE,KAAK,gBAAc,KAAK,eAAa,KAAK,kBAAgB,QAAOD,KAAE,KAAK,IAAE,GAAEC,KAAE,IAAI;AAAG,UAAME,KAAE,IAAI;AAAG,QAAIC,KAAE,IAAI;AAAG,QAAG,GAAGA,IAAE,GAAE,GAAG,GAAE,GAAGD,IAAE,GAAE,IAAGC,EAAC,GAAEL,GAAE,YAAUA,GAAE,SAAS,OAAM,MAAM,4CAA4C;AAAE,QAAGA,GAAE,UAAS;AAAC,UAAIM,KAAE,IAAI;AAAG,SAAGA,IAAE,GAAE,IAAE,GAAE,GAAGA,IAAE,GAAEN,GAAE,SAAS,CAAC,GAAE,GAAGM,IAAE,GAAEN,GAAE,SAAS,CAAC,GAAE,GAAGI,IAAE,GAAE,IAAGE,EAAC;AAAA,IAAC,OAAK;AAAC,UAAG,CAACN,GAAE,SAAS,OAAM,MAAM,+CAA+C;AAAE,WAAIM,OAAKD,KAAE,IAAI,MAAGL,GAAE,UAAU,IAAGA,KAAE,IAAI,MAAG,GAAE,IAAE,GAAE,GAAGA,IAAE,GAAEM,GAAE,CAAC,GAAE,GAAGN,IAAE,GAAEM,GAAE,CAAC,GAAE,GAAGD,IAAE,GAAE,IAAGL,EAAC;AAAE,SAAGI,IAAE,IAAG,IAAGC,EAAC;AAAA,IAAC;AAAC,OAAGH,IAAE,GAAE,IAAGE,EAAC,GAAE,KAAK,EAAE,iBAAiBF,GAAE,EAAE,GAAE,sBAAqB,UAASD,EAAC,GAAE,GAAG,MAAKF,IAAEI,EAAC;AAAE,OAAE;AAAC,UAAG;AAAC,cAAMJ,KAAE,IAAI,GAAG,KAAK,iBAAgB,KAAK,cAAa,KAAK,aAAa;AAAE,YAAG,CAAC,KAAK,GAAE;AAAC,cAAIQ,KAAER;AAAE,gBAAM;AAAA,QAAC;AAAC,aAAK,EAAEA,EAAC;AAAA,MAAC,UAAC;AAAQ,WAAG,IAAI;AAAA,MAAC;AAAC,MAAAQ,KAAE;AAAA,IAAM;AAAC,WAAOA;AAAA,EAAC;AAAA,EAAC,IAAG;AAAC,QAAIR,KAAE,IAAI;AAAG,OAAGA,IAAE,UAAU,GAAE,GAAGA,IAAE,QAAQ,GAAE,GAAGA,IAAE,cAAc;AAAE,UAAMC,KAAE,IAAI;AAAG,OAAGA,IAAE,IAAG,KAAK,CAAC;AAAE,UAAMC,KAAE,IAAI;AAAG,OAAGA,IAAE,wEAAwE,GAAE,GAAGA,IAAE,gBAAgB,GAAE,GAAGA,IAAE,YAAY,GAAE,GAAGA,IAAE,wBAAwB,GAAEA,GAAE,EAAED,EAAC,GAAE,GAAGD,IAAEE,EAAC,GAAE,GAAG,MAAKF,EAAC,GAAE,KAAK,0BAAwB,GAAGA,IAAE,kBAAkB,GAAE,GAAGE,IAAE,mCAAmC,GAAE,GAAG,MAAK,kBAAkB,GAAE,KAAK,EAAE,GAAG,oBAAoB,CAACF,IAAEC,OAAI;AAAC,WAAK,kBAAgBD,GAAE,IAAK,CAAAA,OAAG,GAAG,MAAKA,IAAE,MAAG,CAAC,KAAK,CAAC,CAAE,GAAE,GAAG,MAAKC,EAAC;AAAA,IAAC,CAAE,GAAE,KAAK,EAAE,0BAA0B,oBAAoB,CAAAD,OAAG;AAAC,WAAK,kBAAgB,CAAC,GAAE,GAAG,MAAKA,EAAC;AAAA,IAAC,CAAE,IAAG,KAAK,uBAAqB,GAAGA,IAAE,eAAe,GAAE,GAAGE,IAAE,6BAA6B,GAAE,GAAG,MAAK,eAAe,GAAE,KAAK,EAAE,EAAE,iBAAiB,CAACF,IAAEC,OAAI;AAAC,WAAK,eAAa,GAAG,MAAKD,IAAE,OAAG,CAAC,KAAK,CAAC,GAAE,GAAG,MAAKC,EAAC;AAAA,IAAC,CAAE,GAAE,KAAK,EAAE,0BAA0B,iBAAiB,CAAAD,OAAG;AAAC,WAAK,eAAa,QAAO,GAAG,MAAKA,EAAC;AAAA,IAAC,CAAE,IAAG,GAAGA,IAAE,gBAAgB,GAAE,GAAGE,IAAE,+BAA+B,GAAE,KAAK,EAAE,0BAA0B,kBAAkB,CAACF,IAAEC,OAAI;AAAC,WAAK,gBAAcD,IAAE,GAAG,MAAKC,EAAC;AAAA,IAAC,CAAE,GAAE,KAAK,EAAE,0BAA0B,kBAAkB,CAAAD,OAAG;AAAC,WAAK,eAAa,QAAO,GAAG,MAAKA,EAAC;AAAA,IAAC,CAAE,GAAEA,KAAEA,GAAE,EAAE,GAAE,KAAK,SAAS,IAAI,WAAWA,EAAC,GAAE,IAAE;AAAA,EAAC;AAAC;AAAE,GAAG,UAAU,UAAQ,GAAG,UAAU,IAAG,GAAG,UAAU,aAAW,GAAG,UAAU,GAAE,GAAG,sBAAoB,SAASA,IAAEC,IAAE;AAAC,SAAO,GAAG,IAAGD,IAAE,EAAC,aAAY,EAAC,gBAAeC,GAAC,EAAC,CAAC;AAAC,GAAE,GAAG,wBAAsB,SAASD,IAAEC,IAAE;AAAC,SAAO,GAAG,IAAGD,IAAE,EAAC,aAAY,EAAC,kBAAiBC,GAAC,EAAC,CAAC;AAAC,GAAE,GAAG,oBAAkB,SAASD,IAAEC,IAAE;AAAC,SAAO,GAAG,IAAGD,IAAEC,EAAC;AAAC;AAAE,IAAI,KAAG,cAAc,GAAE;AAAA,EAAC,YAAYD,IAAEC,IAAE;AAAC,UAAM,IAAI,GAAGD,IAAEC,EAAC,GAAE,mBAAkB,aAAY,KAAE,GAAE,KAAK,IAAE,EAAC,YAAW,CAAC,EAAC,GAAE,GAAGD,KAAE,KAAK,IAAE,IAAI,MAAG,GAAE,GAAEC,KAAE,IAAI,IAAE;AAAA,EAAC;AAAA,EAAC,IAAI,cAAa;AAAC,WAAO,GAAG,KAAK,GAAE,IAAG,CAAC;AAAA,EAAC;AAAA,EAAC,IAAI,YAAYD,IAAE;AAAC,OAAG,KAAK,GAAE,GAAE,GAAEA,EAAC;AAAA,EAAC;AAAA,EAAC,EAAEA,IAAE;AAAC,WAAO,WAASA,GAAE,qBAAmB,GAAG,KAAK,GAAE,GAAE,GAAGA,GAAE,kBAAkB,CAAC,IAAE,wBAAuBA,MAAG,GAAG,KAAK,GAAE,CAAC,GAAE,WAASA,GAAE,aAAW,GAAG,KAAK,GAAE,GAAEA,GAAE,UAAU,IAAE,gBAAeA,MAAG,GAAG,KAAK,GAAE,CAAC,GAAE,WAASA,GAAE,iBAAe,GAAG,KAAK,GAAE,GAAEA,GAAE,cAAc,IAAE,oBAAmBA,MAAG,GAAG,KAAK,GAAE,CAAC,GAAE,WAASA,GAAE,oBAAkB,GAAG,KAAK,GAAE,GAAEA,GAAE,iBAAiB,IAAE,uBAAsBA,MAAG,GAAG,KAAK,GAAE,CAAC,GAAE,WAASA,GAAE,mBAAiB,GAAG,KAAK,GAAE,GAAEA,GAAE,gBAAgB,IAAE,sBAAqBA,MAAG,GAAG,KAAK,GAAE,CAAC,GAAE,KAAK,EAAEA,EAAC;AAAA,EAAC;AAAA,EAAC,EAAEA,IAAEC,IAAE;AAAC,WAAO,KAAK,IAAE,EAAC,YAAW,CAAC,EAAC,GAAE,GAAG,MAAKD,IAAEC,EAAC,GAAE,KAAK;AAAA,EAAC;AAAA,EAAC,EAAED,IAAEC,IAAEC,IAAE;AAAC,WAAO,KAAK,IAAE,EAAC,YAAW,CAAC,EAAC,GAAE,GAAG,MAAKF,IAAEE,IAAED,EAAC,GAAE,KAAK;AAAA,EAAC;AAAA,EAAC,IAAG;AAAC,QAAID,KAAE,IAAI;AAAG,OAAGA,IAAE,iBAAiB,GAAE,GAAGA,IAAE,WAAW,GAAE,GAAGA,IAAE,YAAY;AAAE,UAAMC,KAAE,IAAI;AAAG,OAAGA,IAAE,IAAG,KAAK,CAAC;AAAE,UAAMC,KAAE,IAAI;AAAG,OAAGA,IAAE,4CAA4C,GAAE,GAAGA,IAAE,uBAAuB,GAAE,GAAGA,IAAE,qBAAqB,GAAE,GAAGA,IAAE,uBAAuB,GAAEA,GAAE,EAAED,EAAC,GAAE,GAAGD,IAAEE,EAAC,GAAE,KAAK,EAAE,0BAA0B,cAAc,CAACF,IAAEC,OAAI;AAAC,iBAAUA,MAAKD,GAAE,CAAAA,KAAE,GAAGC,EAAC,GAAE,KAAK,EAAE,WAAW,KAAK,GAAGD,EAAC,CAAC;AAAE,SAAG,MAAKC,EAAC;AAAA,IAAC,CAAE,GAAE,KAAK,EAAE,0BAA0B,cAAc,CAAAD,OAAG;AAAC,SAAG,MAAKA,EAAC;AAAA,IAAC,CAAE,GAAEA,KAAEA,GAAE,EAAE,GAAE,KAAK,SAAS,IAAI,WAAWA,EAAC,GAAE,IAAE;AAAA,EAAC;AAAC;AAAE,GAAG,UAAU,iBAAe,GAAG,UAAU,GAAE,GAAG,UAAU,SAAO,GAAG,UAAU,GAAE,GAAG,UAAU,aAAW,GAAG,UAAU,GAAE,GAAG,sBAAoB,eAAeA,IAAEC,IAAE;AAAC,SAAO,GAAG,IAAGD,IAAE,EAAC,aAAY,EAAC,gBAAeC,GAAC,EAAC,CAAC;AAAC,GAAE,GAAG,wBAAsB,SAASD,IAAEC,IAAE;AAAC,SAAO,GAAG,IAAGD,IAAE,EAAC,aAAY,EAAC,kBAAiBC,GAAC,EAAC,CAAC;AAAC,GAAE,GAAG,oBAAkB,SAASD,IAAEC,IAAE;AAAC,SAAO,GAAG,IAAGD,IAAEC,EAAC;AAAC;AAAE,IAAI,KAAG,MAAK;AAAA,EAAC,YAAYD,IAAEC,IAAEC,IAAE;AAAC,SAAK,YAAUF,IAAE,KAAK,iBAAeC,IAAE,KAAK,oBAAkBC;AAAA,EAAC;AAAA,EAAC,QAAO;AAAC,SAAK,mBAAmB,QAAS,CAAAF,OAAG;AAAC,MAAAA,GAAE,MAAM;AAAA,IAAC,CAAE;AAAA,EAAC;AAAC;AAAE,SAAS,GAAGA,IAAE;AAAC,EAAAA,GAAE,YAAU,CAAC,GAAEA,GAAE,iBAAe,CAAC,GAAEA,GAAE,oBAAkB;AAAM;AAAC,SAAS,GAAGA,IAAE;AAAC,MAAG;AAAC,UAAMC,KAAE,IAAI,GAAGD,GAAE,WAAUA,GAAE,gBAAeA,GAAE,iBAAiB;AAAE,QAAG,CAACA,GAAE,EAAE,QAAOC;AAAE,IAAAD,GAAE,EAAEC,EAAC;AAAA,EAAC,UAAC;AAAQ,OAAGD,EAAC;AAAA,EAAC;AAAC;AAAC,GAAG,UAAU,QAAM,GAAG,UAAU;AAAM,IAAI,KAAG,cAAc,GAAE;AAAA,EAAC,YAAYA,IAAEC,IAAE;AAAC,UAAM,IAAI,GAAGD,IAAEC,EAAC,GAAE,YAAW,aAAY,KAAE,GAAE,KAAK,YAAU,CAAC,GAAE,KAAK,iBAAe,CAAC,GAAE,KAAK,0BAAwB,OAAG,GAAGD,KAAE,KAAK,IAAE,IAAI,MAAG,GAAE,GAAEC,KAAE,IAAI,IAAE,GAAE,KAAK,IAAE,IAAI,MAAG,GAAG,KAAK,GAAE,GAAE,GAAE,KAAK,CAAC,GAAE,KAAK,IAAE,IAAI,MAAG,GAAG,KAAK,GAAE,GAAE,GAAE,KAAK,CAAC,GAAE,GAAG,KAAK,GAAE,GAAE,CAAC,GAAE,GAAG,KAAK,GAAE,GAAE,GAAE,GAAE,GAAG,KAAK,GAAE,GAAE,GAAE,GAAE,GAAG,KAAK,GAAE,GAAE,GAAE;AAAA,EAAC;AAAA,EAAC,IAAI,cAAa;AAAC,WAAO,GAAG,KAAK,GAAE,IAAG,CAAC;AAAA,EAAC;AAAA,EAAC,IAAI,YAAYD,IAAE;AAAC,OAAG,KAAK,GAAE,GAAE,GAAEA,EAAC;AAAA,EAAC;AAAA,EAAC,EAAEA,IAAE;AAAC,WAAM,cAAaA,MAAG,GAAG,KAAK,GAAE,GAAEA,GAAE,YAAU,CAAC,GAAE,gCAA+BA,MAAG,GAAG,KAAK,GAAE,GAAEA,GAAE,8BAA4B,GAAE,GAAE,2BAA0BA,MAAG,GAAG,KAAK,GAAE,GAAEA,GAAE,yBAAuB,GAAE,GAAE,+BAA8BA,MAAG,GAAG,KAAK,GAAE,GAAEA,GAAE,6BAA2B,GAAE,GAAE,6BAA4BA,OAAI,KAAK,0BAAwBA,GAAE,2BAAyB,QAAI,KAAK,EAAEA,EAAC;AAAA,EAAC;AAAA,EAAC,EAAEA,IAAEC,IAAEC,IAAE;AAAC,UAAMC,KAAE,cAAY,OAAOF,KAAEA,KAAE,CAAC;AAAE,WAAO,KAAK,IAAE,cAAY,OAAOA,KAAEA,KAAEC,IAAE,GAAG,IAAI,GAAE,GAAG,MAAKF,IAAEG,EAAC,GAAE,GAAG,IAAI;AAAA,EAAC;AAAA,EAAC,EAAEH,IAAEC,IAAEC,IAAEC,IAAE;AAAC,UAAMC,KAAE,cAAY,OAAOF,KAAEA,KAAE,CAAC;AAAE,WAAO,KAAK,IAAE,cAAY,OAAOA,KAAEA,KAAEC,IAAE,GAAG,IAAI,GAAE,GAAG,MAAKH,IAAEI,IAAEH,EAAC,GAAE,GAAG,IAAI;AAAA,EAAC;AAAA,EAAC,IAAG;AAAC,QAAID,KAAE,IAAI;AAAG,OAAGA,IAAE,UAAU,GAAE,GAAGA,IAAE,WAAW,GAAE,GAAGA,IAAE,sBAAsB,GAAE,GAAGA,IAAE,iBAAiB,GAAE,GAAGA,IAAE,oBAAoB;AAAE,UAAMC,KAAE,IAAI;AAAG,OAAGA,IAAE,IAAG,KAAK,CAAC;AAAE,UAAMC,KAAE,IAAI;AAAG,OAAGA,IAAE,4DAA4D,GAAE,GAAGA,IAAE,gBAAgB,GAAE,GAAGA,IAAE,qBAAqB,GAAE,GAAGA,IAAE,qCAAqC,GAAE,GAAGA,IAAE,iCAAiC,GAAEA,GAAE,EAAED,EAAC,GAAE,GAAGD,IAAEE,EAAC,GAAE,GAAG,MAAKF,EAAC,GAAE,KAAK,EAAE,0BAA0B,wBAAwB,CAACA,IAAEC,OAAI;AAAC,WAAK,YAAU,CAAC;AAAE,iBAAUA,MAAKD,GAAE,CAAAA,KAAE,GAAGC,EAAC,GAAE,KAAK,UAAU,KAAK,GAAGD,EAAC,CAAC;AAAE,SAAG,MAAKC,EAAC;AAAA,IAAC,CAAE,GAAE,KAAK,EAAE,0BAA0B,wBAAwB,CAAAD,OAAG;AAAC,WAAK,YAAU,CAAC,GAAE,GAAG,MAAKA,EAAC;AAAA,IAAC,CAAE,GAAE,KAAK,EAAE,0BAA0B,mBAAmB,CAACA,IAAEC,OAAI;AAAC,WAAK,iBAAe,CAAC;AAAE,iBAAUA,MAAKD,GAAE,CAAAA,KAAE,GAAGC,EAAC,GAAE,KAAK,eAAe,KAAK,GAAGD,EAAC,CAAC;AAAE,SAAG,MAAKC,EAAC;AAAA,IAAC,CAAE,GAAE,KAAK,EAAE,0BAA0B,mBAAmB,CAAAD,OAAG;AAAC,WAAK,iBAAe,CAAC,GAAE,GAAG,MAAKA,EAAC;AAAA,IAAC,CAAE,GAAE,KAAK,4BAA0B,GAAGE,IAAE,sCAAsC,GAAE,GAAG,MAAK,oBAAoB,GAAE,KAAK,EAAE,GAAG,sBAAsB,CAACF,IAAEC,OAAI;AAAC,WAAK,oBAAkBD,GAAE,IAAK,CAAAA,OAAG,GAAG,MAAKA,IAAE,MAAG,CAAC,KAAK,CAAC,CAAE,GAAE,GAAG,MAAKC,EAAC;AAAA,IAAC,CAAE,GAAE,KAAK,EAAE,0BAA0B,sBAAsB,CAAAD,OAAG;AAAC,WAAK,oBAAkB,CAAC,GAAE,GAAG,MAAKA,EAAC;AAAA,IAAC,CAAE,IAAGA,KAAEA,GAAE,EAAE,GAAE,KAAK,SAAS,IAAI,WAAWA,EAAC,GAAE,IAAE;AAAA,EAAC;AAAC;AAAE,GAAG,UAAU,iBAAe,GAAG,UAAU,GAAE,GAAG,UAAU,SAAO,GAAG,UAAU,GAAE,GAAG,UAAU,aAAW,GAAG,UAAU,GAAE,GAAG,sBAAoB,SAASA,IAAEC,IAAE;AAAC,SAAO,GAAG,IAAGD,IAAE,EAAC,aAAY,EAAC,gBAAeC,GAAC,EAAC,CAAC;AAAC,GAAE,GAAG,wBAAsB,SAASD,IAAEC,IAAE;AAAC,SAAO,GAAG,IAAGD,IAAE,EAAC,aAAY,EAAC,kBAAiBC,GAAC,EAAC,CAAC;AAAC,GAAE,GAAG,oBAAkB,SAASD,IAAEC,IAAE;AAAC,SAAO,GAAG,IAAGD,IAAEC,EAAC;AAAC,GAAE,GAAG,mBAAiB;;;ACC/sqI,IAAI,WAAW,OAAO;AACtB,IAAIkE,aAAY,OAAO;AACvB,IAAIC,oBAAmB,OAAO;AAC9B,IAAI,oBAAoB,OAAO;AAC/B,IAAI,eAAe,OAAO;AAC1B,IAAI,eAAe,OAAO,UAAU;AACpC,IAAI,aAAa,CAAC,IAAI,QAAQ,WAAW;AACxC,SAAO,QAAQ,GAAG,GAAG,kBAAkB,EAAE,EAAE,CAAC,CAAC,IAAI,MAAM,EAAE,SAAS,CAAC,EAAE,GAAG,SAAS,GAAG,GAAG,IAAI;AAC5F;AACA,IAAI,WAAW,CAAC,QAAQ,QAAQ;AAC/B,WAAS,QAAQ,IAAK,CAAAD,WAAU,QAAQ,MAAM;AAAA,IAC7C,KAAK,IAAI,IAAI;AAAA,IACb,YAAY;AAAA,EACb,CAAC;AACF;AACA,IAAI,cAAc,CAACE,KAAIC,OAAM,QAAQ,SAAS;AAC7C,MAAIA,SAAQ,OAAOA,UAAS,YAAY,OAAOA,UAAS,WAAY,UAAS,OAAO,kBAAkBA,KAAI,GAAGC,KAAI,GAAGC,KAAI,KAAK,QAAQ,KAAKD,KAAIC,IAAGD,MAAK;AACrJ,UAAM,KAAKA,EAAC;AACZ,QAAI,CAAC,aAAa,KAAKF,KAAI,GAAG,KAAK,QAAQ,OAAQ,CAAAF,WAAUE,KAAI,KAAK;AAAA,MACrE,MAAM,CAACI,OAAMH,MAAKG,EAAC,GAAG,KAAK,MAAM,GAAG;AAAA,MACpC,YAAY,EAAE,OAAOL,kBAAiBE,OAAM,GAAG,MAAM,KAAK;AAAA,IAC3D,CAAC;AAAA,EACF;AACA,SAAOD;AACR;AACA,IAAI,UAAU,CAAC,KAAK,YAAY,YAAY,SAAS,OAAO,OAAO,SAAS,aAAa,GAAG,CAAC,IAAI,CAAC,GAAG,YAAY,cAAc,CAAC,OAAO,CAAC,IAAI,aAAaF,WAAU,QAAQ,WAAW;AAAA,EACrL,OAAO;AAAA,EACP,YAAY;AACb,CAAC,IAAI,QAAQ,GAAG;;;AC7BhB,IAAa,kBAAkB,CAAC,OAAO;AACnC,MAAI,OAAO,OAAO,SACd,QAAO;AACX,MAAI,cAAc,MACd,QAAO,GAAG;AAEd,SAAO;AACV;AAOD,IAAa,gBAAgB,IAAI,YAAY;AACzC,QAAM,SAAS,QAAQ,OAAO,CAAAO,OAAK,cAAcA,EAAA,CAAE;AACnD,MAAI,OAAO,WAAW,EAClB;AACJ,QAAM,WAAW,OAAO,IAAI,CAAAC,OAAK,oBAAoBA,EAAA,CAAE;AACvD,QAAM,IAAI,MAAM,SAAS,KAAK,IAAI,CAAC;AACtC;AAMD,SAAgB,eAAe,SAAS;AACpC,aAAWD,MAAK,SAAS;AACrB,UAAME,MAAK,OAAOF,OAAM,WAAWA,KAAIA,GAAA;AACvC,QAAIE,QAAO,OACP;AACJ,QAAIA,IAAG,QACH;AACJ,UAAM,cAAcA,GAAA;EACvB;AACD,SAAO;AACV;AACD,SAAgB,kBAAkB,QAAQ;AACtC,MAAI,OAAO,QACP,QAAO;AACX,QAAM,cAAc,MAAA;AACvB;AAMD,IAAa,mBAAmB,IAAI,YAAY;AAC5C,aAAWF,MAAK,SAAS;AACrB,UAAME,MAAK,OAAOF,OAAM,WAAWA,KAAIA,GAAA;AACvC,QAAIE,QAAO,OACP;AACJ,QAAI,CAACA,IAAG,QACJ,QAAOA;EACd;AACJ;AAMD,SAAgB,cAAc,QAAQ;AAClC,MAAI,OAAO,WAAW,SAClB,QAAO;AACX,SAAO,CAAC,OAAO;AAClB;AAMD,SAAgB,WAAW,QAAQ;AAC/B,MAAI,OAAO,WAAW,SAClB,QAAO;AACX,SAAO,OAAO;AACjB;AAMD,SAAgB,cAAc,QAAQ;AAClC,MAAI,OAAO,OAAO,UAAU,SACxB,OAAM,IAAI,MAAM,OAAO,OAAO,EAAE,OAAO,OAAO,KAAM,CAAA;AAExD,MAAI,OAAO,iBAAiB,MACxB,OAAM,OAAO;AACjB,SAAO,IAAI,MAAM,KAAK,UAAU,OAAO,KAAA,GAAQ,EAAE,OAAO,OAAO,KAAM,CAAA;AACxE;AAOD,SAAgB,cAAc,QAAQ;AAClC,MAAI,WAAW,MAAA,EACX,QAAO,OAAO;AAElB,QAAM,cAAc,MAAA;AACvB;AAMD,SAAgB,oBAAoB,QAAQ;AACxC,MAAI,OAAO,iBAAiB,MACxB,QAAO,gBAAgB,OAAO,KAAA;AAClC,MAAI,OAAO,OAAO,UAAU,SACxB,QAAO,OAAO;AAClB,SAAO,KAAK,UAAU,OAAO,KAAA;AAChC;AAOD,SAAgB,YAAY,OAAO,MAAM;AACrC,SAAO;IACH,SAAS;IACT;IACA;EACH;AACJ;AAMD,IAAa,iBAAiB,IAAI,YAAY;AAC1C,MAAIA;AACJ,aAAWF,MAAK,SAAS;AACrB,IAAAE,MAAK,OAAOF,OAAM,WAAWA,KAAIA,GAAA;AACjC,QAAIE,QAAO,OACP;AACJ,QAAI,CAACA,IAAG,QACJ,QAAOA;EACd;AACD,MAAI,CAACA,IACD,OAAM,IAAI,MAAM,YAAY;AAChC,SAAOA;AACV;AAOD,IAAa,iBAAiB,CAAC,QAAQ,aAAa;AAChD,MAAI,cAAc,MAAA,EACd,UAAS,MAAA;AAEhB;ACpJD,IAAa,eAAe,CAACC,OAAM,KAAK,KAAKA,EAAA,IAAK,MAAM;AASxD,IAAa,QAAQ,CAACC,IAAG,aAAa;AAClC,MAAI,OAAOA,OAAM,SACb,OAAM,IAAI,UAAU,2BAA2B,OAAOA,EAAA,EAAG;AAE7D,MAAI,OAAO,MAAMA,EAAA,EACb,QAAO;AACX,SAAOA;AACV;AAqBD,IAAa,eAAe,CAACC,QAAO,QAAQ,IAAI,eAAe,QAAe;AAC1E,MAAI,OAAOA,WAAU,YACjB,QAAO;AACX,MAAIA,WAAU,KACV,QAAO;AACX,MAAI;AACA,UAAM,SAAS,OAAO,SAAS,OAAOA,WAAU,WAAWA,OAAM,SAAA,IAAaA,MAAA;AAC9E,UAAML,KAAI,YAAY,QAAQ,OAAO,QAAQ;AAC7C,WAAOA,GAAE,UAAU,SAAS;EAC/B,QACK;AACF,WAAO;EACV;AACJ;AAqBD,IAAa,aAAa,CAACK,QAAO,QAAQ,IAAI,gBAAgB,KAAK,SAAS;AACxE,MAAIA,WAAU,KACV,QAAO;IAAE,SAAS;IAAO,OAAO,cAAc,aAAA;IAA0B;EAAM;AAClF,MAAI,OAAOA,WAAU,YACjB,QAAO;IAAE,SAAS;IAAO,OAAO,cAAc,aAAA;IAA+B;EAAM;AAEvF,MAAI,OAAO,MAAMA,MAAA,EACb,QAAO;IAAE,SAAS;IAAO,OAAO,cAAc,aAAA;IAAyB;EAAM;AAEjF,MAAI,OAAOA,WAAU,SACjB,QAAO;IAAE,SAAS;IAAO,OAAO,cAAc,aAAA,sBAAmC,KAAK,UAAUA,MAAA,CAAM;IAAK;EAAM;AAErH,UAAQ,OAAR;IACI,KAAK,UAAU;AACX,UAAI,CAAC,OAAO,SAASA,MAAA,EACjB,QAAO;QAAE,SAAS;QAAO,OAAO,cAAc,aAAA,yBAAsCA,MAAA;QAAU;MAAM;AAExG;IACH;IACD,KAAK,YAAY;AACb,UAAIA,SAAQ,EACR,QAAO;QAAE,SAAS;QAAO,OAAO,cAAc,aAAA,4BAAyCA,MAAA;QAAU;MAAM;AAE3G;IACH;IACD,KAAK,YAAY;AACb,UAAIA,SAAQ,EACR,QAAO;QAAE,SAAS;QAAO,OAAO,cAAc,aAAA,4BAAyCA,MAAA;QAAU;MAAM;AAE3G;IACH;IACD,KAAK,aAAa;AACd,UAAIA,UAAS,EACT,QAAO;QACH,SAAS;QAAO,OAAO,cAAc,aAAA,yBAAsCA,MAAA;QAAU;MACxF;AAEL;IACH;IACD,KAAK,aAAa;AACd,UAAIA,UAAS,EACT,QAAO;QAAE,SAAS;QAAO,OAAO,cAAc,aAAA,yBAAsCA,MAAA;QAAU;MAAM;AAExG;IACH;IACD,KAAK,cAAc;AACf,UAAIA,SAAQ,KAAKA,SAAQ,EACrB,QAAO;QACH,SAAS;QAAO,OAAO,cAAc,aAAA,4CAAyDA,MAAA;QAAU;MAC3G;AAEL;IACH;IACD,KAAK,WAAW;AACZ,UAAIA,WAAU,EACV,QAAO;QAAE,SAAS;QAAO,OAAO,cAAc,aAAA,qBAAkCA,MAAA;QAAU;MAAM;AAEpG;IACH;IACD,KAAK,WAAW;AACZ,UAAIA,SAAQ,KAAKA,SAAQ,GACrB,QAAO;QAAE,SAAS;QAAO,OAAO,cAAc,aAAA,qDAAkEA,MAAA;QAAU;MAAM;AAEpI;IACH;EACJ;AACD,SAAO;IAAE,SAAS;IAAM,OAAAA;IAAO;EAAM;AACxC;AAqCD,IAAa,oBAAoB,CAACC,IAAGC,IAAG,WAAW,MAAM;AACrD,MAAI,aAAa,GAAG;AAChB,IAAAD,KAAI,KAAK,MAAMA,EAAA;AACf,IAAAC,KAAI,KAAK,MAAMA,EAAA;AACf,QAAID,OAAMC,GACN,QAAO;MAAE,SAAS;MAAM,OAAOD;IAAG;AACtC,WAAO;MAAE,SAAS;MAAO,OAAO;IAA2B;EAC9D;AACD,QAAM,OAAO,KAAK,IAAI,IAAI,QAAA;AAC1B,QAAME,MAAK,KAAK,MAAMF,KAAI,IAAA;AAC1B,QAAM,KAAK,KAAK,MAAMC,KAAI,IAAA;AAC1B,MAAIC,QAAO,GACP,QAAO;IAAE,SAAS;IAAO,OAAO,kCAAkCF,EAAA,OAAQC,EAAA,cAAe,QAAA;EAAY;AACzG,SAAO;IAAE,SAAS;IAAM,OAAOD;EAAG;AACrC;AAUD,IAAa,cAAc,CAACD,QAAO,gBAAgB,KAAK,SAAS,WAAWA,QAAO,cAAc,eAAe,IAAA;AAoBhH,IAAa,cAAc,CAACA,QAAO,QAAQ,IAAI,gBAAgB,QAAQ;AACnE,SAAO,eAAe,WAAWA,QAAO,OAAO,aAAA,GAAgB,MAAM;AACjE,QAAI,CAAC,OAAO,UAAUA,MAAA,EAClB,QAAO;MAAE,SAAS;MAAO,OAAO,UAAU,aAAA;IAAoC;AAElF,WAAO;MAAE,SAAS;MAAa,OAAAA;IAAO;EACzC,CAAA;AACJ;AACD,IAAa,mBAAmB,CAAC,YAAY;AACzC,aAAWD,MAAK,QACZ,KAAI,KAAK,IAAIA,EAAA,IAAK,MAAM,EACpB,QAAO;IAAE,SAAS;IAAO,OAAO,4BAA4BA,EAAA;EAAK;AAEzE,SAAO;IAAE,SAAS;IAAM,OAAO;EAAS;AAC3C;AAMD,IAAa,YAAY,CAACC,WAAU;AAChC,MAAI,OAAOA,WAAU,SACjB,CAAAA,SAAQ,OAAO,WAAWA,MAAA;AAC9B,QAAML,KAAI,YAAYK,MAAA;AACtB,SAAOL,GAAE;AACZ;AAMD,IAAa,2BAA2B,CAACK,QAAOI,MAAKC,MAAK,gBAAgB,QAAQ;AAC9E,MAAI,OAAOL,WAAU,SACjB,QAAO;IAAE,SAAS;IAAO,OAAO,UAAU,aAAA,sCAAmD,OAAOA,MAAA,aAAkB,KAAK,UAAUA,MAAA,CAAM;EAAK;AAEpJ,MAAI,OAAO,MAAMA,MAAA,EACb,QAAO;IAAE,SAAS;IAAO,OAAO,UAAU,aAAA,yBAAsCI,IAAA,IAAOC,IAAA;EAAiB;AAE5G,MAAI,OAAO,SAASL,MAAA,GAAQ;AACxB,QAAIA,SAAQI,KACR,QAAO;MAAE,SAAS;MAAO,OAAO,UAAU,aAAA,oBAAiCA,IAAA,IAAOC,IAAA,UAAaL,MAAA;IAAS;aAEnGA,SAAQK,KACb,QAAO;MAAE,SAAS;MAAO,OAAO,UAAU,aAAA,oBAAiCD,IAAA,IAAOC,IAAA,UAAaL,MAAA;IAAS;AAE5G,WAAO;MAAE,SAAS;MAAM,OAAAA;IAAO;EAClC,MAEG,QAAO;IAAE,SAAS;IAAO,OAAO,UAAU,aAAA,yBAAsCI,IAAA,IAAOC,IAAA;EAAsB;AAEpH;AC5QD,IAAa,YAAY,CAACL,QAAO,gBAAgB,QAAQ;AACrD,MAAI,CAAC,MAAM,QAAQA,MAAA,EACf,QAAO;IAAE,SAAS;IAAO,OAAO,cAAc,aAAA;EAA8C;AAEhG,SAAO;IAAE,SAAS;IAAM,OAAAA;EAAO;AAClC;AAUD,IAAa,iBAAiB,CAACM,QAAO,OAAO,OAAO,YAAY;AAC5D,SAAO,eAAe,UAAUA,MAAA,GAAQ,YAAY,OAAO,YAAY,IAAA,GAAO,yBAAyB,OAAO,GAAGA,OAAM,SAAS,GAAG,IAAA,CAAK;AAC3I;AAMD,IAAa,mBAAmB,CAACN,WAAU;AACvC,MAAI,CAAC,MAAM,QAAQA,MAAA,EACf,QAAO;IAAE,SAAS;IAAO,OAAO;EAAyB;AAC7D,MAAIA,OAAM,KAAK,CAACD,OAAM,OAAOA,OAAM,QAAQ,EACvC,QAAO;IAAE,SAAS;IAAO,OAAO;EAAmC;AAEvE,SAAO;IAAE,SAAS;IAAM,OAAAC;EAAO;AAClC;ACrCD,IAAa,gBAAgB,CAACA,QAAO,gBAAgB,QAAQ;AACzD,MAAI,OAAOA,WAAU,YACjB,QAAO;IAAE,SAAS;IAAO,OAAO,GAAG,aAAA;EAAoC;AAE3E,MAAIA,WAAU,KACV,QAAO;IAAE,SAAS;IAAO,OAAO,GAAG,aAAA;EAA+B;AACtE,SAAO;IAAE,SAAS;IAAM,OAAAA;EAAO;AAClC;AAMD,IAAa,YAAY,CAAC,aAAa,aAAa;ACbpD,IAAa,aAAa,CAAC,WAAW,kBAAkB;AAExD,IAAa,eAAe,CAACA,QAAO,gBAAgB,QAAQ;AACxD,MAAIA,WAAU,OACV,QAAO;IAAE,SAAS;IAAO,OAAO,UAAU,aAAA;EAAoD;AAClG,MAAIA,WAAU,KACV,QAAO;IAAE,SAAS;IAAO,OAAO,UAAU,aAAA;EAA+C;AAC7F,MAAI,OAAOA,WAAU,WACjB,QAAO;IAAE,SAAS;IAAO,OAAO,UAAU,aAAA,cAA2B,OAAOA,MAAA;EAA8B;AAC9G,SAAO;IAAE,SAAS;IAAM,OAAAA;EAAO;AAClC;ACCD,IAAa,kBAAkB,CAACA,WAAU;AACtC,MAAI,OAAOA,WAAU,YAAYA,WAAU,KACvC,QAAO;IAAE,SAAS;IAAO,OAAO;EAAoC;AACxE,QAAM,YAAY,OAAO,eAAeA,MAAA;AACxC,QAAMO,MAAK,cAAc,QAAQ,cAAc,OAAO,aAAa,OAAO,eAAe,SAAA,MAAe,SAAS,EAAE,OAAO,eAAeP,WAAU,EAAE,OAAO,YAAYA;AACxK,MAAIO,GACA,QAAO;IAAE,SAAS;IAAM,OAAAP;EAAO;AACnC,SAAO;IAAE,SAAS;IAAO,OAAO;EAAgB;AACnD;AAMD,IAAa,6BAA6B,CAACA,WAAU;AACjD,QAAMO,KAAI,OAAOP;AACjB,MAAIO,OAAM,SACN,QAAO;IAAE,SAAS;IAAO,OAAO;EAAe;AACnD,MAAIA,OAAM,WACN,QAAO;IAAE,SAAS;IAAO,OAAO;EAAiB;AACrD,MAAIA,OAAM,SACN,QAAO;IAAE,SAAS;IAAa,OAAAP;EAAO;AAC1C,MAAIO,OAAM,SACN,QAAO;IAAE,SAAS;IAAa,OAAAP;EAAO;AAC1C,MAAIO,OAAM,SACN,QAAO;IAAE,SAAS;IAAa,OAAAP;EAAO;AAC1C,MAAIO,OAAM,UACN,QAAO;IAAE,SAAS;IAAa,OAAAP;EAAO;AAC1C,SAAO,gBAAgBA,MAAA;AAC1B;ACtCD,IAAa,mBAAmB,CAACD,IAAG,aAAa;AAC7C,SAAO,eAAe,UAAUA,IAAG,QAAA,GAAW,iBAAiBA,EAAA,CAAE;AACpE;AASD,IAAa,YAAY,CAAC,SAAS,aAAa;AAC5C,aAAWA,MAAK,SAAS;AACrB,QAAI,SAAS,iBAAiB,QAC1B;UAAIA,MAAK,SAAS,aACd,QAAO;QAAE,SAAS;QAAO,OAAO,UAAUA,EAAA,wCAAyC,SAAS,YAAA;MAAiB;IAChH;AAEL,QAAI,SAAS,iBAAiB,QAC1B;UAAIA,KAAI,SAAS,aACb,QAAO;QAAE,SAAS;QAAO,OAAO,UAAUA,EAAA,iDAAkD,SAAS,YAAA;MAAiB;IACzH;AAEL,QAAI,SAAS,iBAAiB,QAC1B;UAAIA,MAAK,SAAS,aACd,QAAO;QAAE,SAAS;QAAO,OAAO,UAAUA,EAAA,sCAAuC,SAAS,YAAA;MAAiB;IAC9G;AAEL,QAAI,SAAS,iBAAiB,QAC1B;UAAIA,KAAI,SAAS,aACb,QAAO;QAAE,SAAS;QAAO,OAAO,UAAUA,EAAA,+CAAgD,SAAS,YAAA;MAAiB;IACvH;EAER;AACD,SAAO;IAAE,SAAS;IAAM,OAAO;EAAS;AAC3C;AChCD,IAAa,aAAa,CAACC,QAAO,QAAQ,IAAI,gBAAgB,QAAQ;AAClE,MAAI,OAAOA,WAAU,SACjB,QAAO;IAAE,SAAS;IAAO,OAAO,UAAU,aAAA,6BAA0C,OAAOA,MAAA;EAAS;AACxG,UAAQ,OAAR;IACI,KAAK;AACD,UAAIA,OAAM,WAAW,EACjB,QAAO;QAAE,SAAS;QAAO,OAAO,UAAU,aAAA;MAA0B;AACxE;EACP;AACD,SAAO;IAAE,SAAS;IAAM,OAAAA;EAAO;AAClC;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AEPD,SAAgB,YAAYQ,QAAO;AAC/B,MAAI,OAAOA,WAAU,SACjB,QAAO;AACX,MAAI,OAAOA,WAAU,SACjB,QAAO;AACX,MAAI,OAAOA,WAAU,SACjB,QAAO;AACX,MAAI,OAAOA,WAAU,UACjB,QAAO;AACX,SAAO;AACV;;;AClBD,IAAa,2BAA2B,CAACC,QAAO,cAAc,MAAM,OAAO,oBAAI,QAAA,GAAWC,QAAO,OAAO;AACpG,MAAID,WAAU,KACV,QAAOA;AACX,MAAI,OAAOA,WAAU,SACjB,OAAM,IAAI,UAAU,8CAA8C,OAAOA,MAAA,EAAO;AACpF,OAAK,IAAIA,MAAA;AACT,QAAME,WAAU,OAAO,QAAQF,MAAA;AAC/B,aAAW,SAASE,UAAS;AACzB,QAAI,MAAM,CAAA,MAAO,KACb;AACJ,QAAI,OAAO,MAAM,CAAA,MAAO,SACpB;AACJ,QAAI,KAAK,IAAI,MAAM,CAAA,CAAA,GAAK;AAEpB,YAAM,CAAA,IAAK;AACX;IACH;AACD,UAAM,CAAA,IAAK,yBAAyB,MAAM,CAAA,GAAI,aAAa,MAAM,GAAG,MAAM,CAAA,CAAA,GAAK;EAClF;AACD,SAAO,OAAO,YAAYA,QAAA;AAC7B;ACAD,IAAa,kBAAkB,CAAC,wBAAwB,OAAO,wBAAwB,WACjF,sBACA,KAAK,UAAU,mBAAA;AASrB,IAAa,kBAAkB,CAACC,WAAU;AAEtC,MAAIA,WAAU,KACV,QAAO;AACX,MAAI,OAAOA,WAAU,aAAa,OAAOA,WAAU,SAC/C,QAAOA,OAAM,SAAA;AAEjB,MAAI,OAAOA,WAAU,SACjB,QAAOA;AACX,MAAI,OAAOA,WAAU,SACjB,OAAM,IAAI,UAAU,sCAAsC;AAC9D,MAAI;AACA,UAAMC,KAAI,KAAK,UAAUD,MAAA;AACzB,WAAOC;EACV,SACM,OAAO;AAEV,QAAI,OAAOD,WAAU,SACjB,QAAO,KAAK,UAAU,yBAAyBA,QAAO,YAAY,CAAC;QAGnE,OAAM;EAEb;AACJ;AC9CD,IAAa,kBAAkB,CAAC,wBAAwB;AACpD,MAAI,OAAO,wBAAwB,SAC/B,QAAO;AACX,QAAM,UAAU,oBAAI,IAAA;AACpB,OAAK,UAAU,qBAAqB,CAAC,KAAKA,YAAW,QAAQ,IAAI,GAAA,GAAMA,OAAA;AACvE,SAAO,KAAK,UAAU,qBAAqB,CAAC,GAAG,OAAQ,EAAC,KAAA,CAAM;AACjE;AAKD,IAAa,iBAAiB,CAACE,IAAGC,OAAMD,OAAMC;AAwF9C,IAAa,0BAA0B,CAACC,IAAGC,OAAM;AAE7C,MAAID,OAAMC,GACN,QAAO;AACX,SAAO,gBAAgBD,EAAA,MAAO,gBAAgBC,EAAA;AACjD;AC3FD,IAAa,+BAA+B,CAACC,IAAGC,IAAG,KAAM,mBAAoB;AACzE,QAAM,SAAS,CAAE;AACjB,QAAM,UAAU,CAAE;AAClB,QAAM,UAAU,CAAE;AAClB,aAAW,cAAcD,IAAG;AACxB,QAAI,UAAU;AAEd,eAAW,cAAcC,GACrB,KAAI,GAAG,YAAY,UAAA,GAAa;AAC5B,gBAAU;AACV;IACH;AAEL,QAAI,QAEA,QAAO,KAAK,UAAA;QAIZ,SAAQ,KAAK,UAAA;EAEpB;AACD,aAAW,cAAcA,IAAG;AACxB,QAAI,UAAU;AAEd,eAAW,cAAcD,GACrB,KAAI,GAAG,YAAY,UAAA,EACf,WAAU;AAGlB,QAAI,CAAC,QAED,SAAQ,KAAK,UAAA;EAEpB;AAED,QAAM,SAAS,QAAQ,WAAW,KAAK,QAAQ,WAAW;AAC1D,SAAO;IACH;IACA;IACA,GAAG;IACH,GAAG;EACN;AACJ;AC9CD,SAAgB,MAAMA,IAAGC,IAAG,SAAS;AACjC,cAAY,YAAYD,IAAG,YAAY,eAAe,CAAC;AACvD,QAAM,KAAM,OAAOC,OAAM,YAAaA,KAAK,WAAW;AACtD,MAAI;AACJ,MAAID,OAAM,EACN,WAAU,KAAK;OAEd;AACD,UAAME,KAAI,KAAK,IAAI,IAAIF,EAAA;AACvB,QAAI,GACA,WAAU,CAACG,OAAM,KAAK,KAAKA,KAAID,EAAA,IAAKA;QAGpC,WAAU,CAACC,OAAM,KAAK,MAAMA,KAAID,EAAA,IAAKA;EAE5C;AACD,MAAI,OAAOD,OAAM,SACb,QAAO,QAAQA,EAAA;AACnB,SAAO;AACV;ACVD,SAAgB,aAAaG,WAAU,eAAe;AAClD,MAAI,WAAWA,SAAA,GAAW;AAEtB,QAAI,OAAOA,cAAa,SACpB,QAAOA;AACX,QAAIC,MAAKD,UAAS,UAAU;AAC5B,IAAAC,QAAOD,UAAS,SAAS,KAAK,KAAK,KAAK;AACxC,IAAAC,QAAOD,UAAS,QAAQ,KAAK,KAAK;AAClC,IAAAC,QAAOD,UAAS,QAAQ,KAAK;AAC7B,WAAOC;EACV,OACI;AACD,QAAI,OAAO,kBAAkB,YACzB,QAAO;AACX,UAAM,IAAI,MAAM,yBAAyB,KAAK,UAAUD,SAAA,CAAS,EAAE;EACtE;AACJ;AAMD,SAAgB,WAAWA,WAAU;AACjC,MAAI,OAAOA,cAAa,YACpB,QAAO;AACX,MAAIA,cAAa,KACb,QAAO;AACX,MAAI,OAAOA,cAAa,UAAU;AAC9B,QAAI,OAAO,MAAMA,SAAA,EACb,QAAO;AACX,QAAI,CAAC,OAAO,SAASA,SAAA,EACjB,QAAO;AACX,WAAO;EACV;AACD,MAAI,OAAOA,cAAa,SACpB,QAAO;AACX,QAAM,YAAY,YAAYA;AAC9B,QAAM,UAAU,UAAUA;AAC1B,QAAM,UAAU,UAAUA;AAC1B,QAAM,WAAW,WAAWA;AAC5B,MAAI,aAAa,CAAC,WAAWA,UAAS,MAAA,EAAQ,QAC1C,QAAO;AACX,MAAI,WAAW,CAAC,WAAWA,UAAS,IAAA,EAAM,QACtC,QAAO;AACX,MAAI,WAAW,CAAC,WAAWA,UAAS,IAAA,EAAM,QACtC,QAAO;AACX,MAAI,YAAY,CAAC,WAAWA,UAAS,KAAA,EAAO,QACxC,QAAO;AACX,MAAI,aAAa,WAAW,YAAY,QACpC,QAAO;AACX,SAAO;AACV;AAeD,IAAa,uBAAuB,CAAC,kBAAkB,WAAW,MAAM;AACpE,MAAIA,YAAW;AACf,MAAI,OAAO,qBAAqB,YAAY;AACxC,UAAM,iBAAiB,iBAAA;AACvB,WAAO,qBAAqB,cAAA;EAC/B,WACQ,OAAO,qBAAqB,SACjC,CAAAA,YAAW;WAEN,OAAO,qBAAqB,SACjC,CAAAA,YAAW,aAAaA,SAAA;AAE5B,MAAIC,MAAK,aAAaD,SAAA;AACtB,MAAI,OAAOC,QAAO,YACd,QAAO;AACX,MAAIA,MAAK,IACL,QAAO,GAAG,MAAM,UAAUA,GAAA,CAAG;AACjC,EAAAA,OAAM;AACN,MAAIA,MAAK,IACL,QAAO,GAAGA,IAAG,QAAQ,CAAA,CAAE;AAC3B,EAAAA,OAAM;AACN,MAAIA,MAAK,GACL,QAAO,GAAGA,IAAG,QAAQ,CAAA,CAAE;AAC3B,EAAAA,OAAM;AACN,SAAO,GAAGA,IAAG,QAAQ,CAAA,CAAE;AAC1B;;;ACpGD,IAAa,kBAAkB,CAACC,IAAGC,OAAM;AAErC,MAAID,OAAMC,GACN,QAAO;AACX,MAAID,KAAIC,GACJ,QAAO;AACX,SAAO;AACV;AAkBD,IAAa,aAAa,CAACC,IAAGC,OAAM;AAGhC,MAAID,OAAM,UAAaC,OAAM,OACzB,QAAO;AACX,MAAID,OAAM,OACN,QAAO;AACX,MAAIC,OAAM,OACN,QAAO;AACX,QAAM,UAAU,gBAAgBD,EAAA;AAChC,QAAM,UAAU,gBAAgBC,EAAA;AAChC,MAAI,UAAU,QACV,QAAO;AACX,MAAI,UAAU,QACV,QAAO;AACX,SAAO;AACV;AA4BD,IAAa,kBAAkB,CAACC,IAAGC,OAAM;AACrC,MAAI,OAAOD,OAAM,YAAY,OAAOC,OAAM,SACtC,QAAO,gBAAgBD,IAAGC,EAAA;AAE9B,SAAO,WAAWD,IAAGC,EAAA;AACxB;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACvED,IAAa,uBAAuB,CAAC,MAAM,WAAW;AAClD,WAAS,KAAK,MAAM,MAAA;AACpB,MAAI,KAAK,IAAI,MAAA,EACT,QAAO;OAEN;AACD,QAAIC,UAAS;AACb,WAAOA,UAAS,KAAM;AAClB,UAAI,KAAK,IAAI,SAASA,OAAA,EAClB,QAAO,SAASA;eACX,KAAK,IAAI,SAASA,OAAA,EACvB,QAAO,SAASA;AACpB,MAAAA;IACH;AACD,UAAM,IAAI,MAAM,yBAAyB,OAAO,SAAA,CAAU,EAAE;EAC/D;AACJ;AAaD,IAAa,gBAAgB,CAAC,MAAM,SAAS;AACzC,aAAW,OAAO,KACd,KAAI,KAAK,IAAI,GAAA,EACT,QAAO,KAAK,IAAI,GAAA;AAE3B;AAiBD,IAAa,cAAc,CAACC,MAAK,KAAKC,QAAO,WAAW,mBAAmB;AACvE,MAAI,CAACD,KAAI,IAAI,GAAA,EACT,QAAO;AACX,QAAME,UAAS,CAAC,GAAGF,KAAI,OAAA,CAAS;AAChC,SAAOE,QAAO,KAAK,CAACC,OAAM,SAASA,IAAGF,MAAA,CAAM;AAC/C;AAgBD,IAAa,6BAA6B,CAACD,MAAKC,QAAO,WAAW,mBAAmB;AACjF,aAAW,SAASD,KAAI,QAAA,EACpB,KAAI,SAAS,MAAM,CAAA,GAAIC,MAAA,EACnB,CAAAD,KAAI,OAAO,MAAM,CAAA,CAAA;AAG5B;AAoBD,IAAa,uBAAuB,CAACA,MAAK,cAAc;AACpD,aAAW,SAASA,KAAI,QAAA,EACpB,KAAI,UAAU,MAAM,CAAA,GAAI,MAAM,CAAA,CAAA,EAC1B,QAAO;AAElB;AAoBD,IAAa,mBAAmB,CAACA,MAAKC,QAAOG,WAAU,mBAAmB;AACtE,aAAW,SAASJ,KAAI,QAAA,EACpB,KAAII,SAAQ,MAAM,CAAA,GAAIH,MAAA,EAClB,QAAO;AAElB;AAkDD,IAAa,iBAAiB,CAACD,MAAK,QAAQ,oBAAoBE,YAAW;AACvE,QAAMG,KAAIL,QAAO,oBAAI,IAAA;AACrB,QAAMM,KAAI,gBAAgBD,IAAG,QAAQ,eAAA;AACrC,EAAAC,GAAE,GAAGJ,OAAA;AACL,SAAOG;AACV;AAYD,IAAa,WAAW,CAACL,MAAK,QAAQ,oBAAoBE,YAAW;AACjE,QAAMG,KAAIL,SAAQ,SAAY,oBAAI,IAAA,IAAQ,IAAI,IAAIA,IAAA;AAClD,aAAWG,MAAKD,SAAQ;AACpB,UAAM,aAAa,OAAOC,EAAA;AAC1B,QAAI,oBAAoB,aACpB;UAAIE,GAAE,IAAI,UAAA,GAAa;AACnB,YAAI,oBAAoB,QACpB,OAAM,IAAI,MAAM,QAAQ,UAAA,kBAA4B;AACxD,YAAI,oBAAoB,OACpB;MACP;;AAEL,IAAAA,GAAE,IAAI,YAAYF,EAAA;EACrB;AACD,SAAOE;AACV;AA4BD,IAAa,kBAAkB,CAACL,MAAK,QAAQ,kBAAkB,gBAAgB;AAC3E,SAAO,IAAIE,YAAW;AAClB,eAAWC,MAAKD,SAAQ;AACpB,YAAM,aAAa,OAAOC,EAAA;AAC1B,UAAI,oBAAoB,aACpB;YAAIH,KAAI,IAAI,UAAA,GAAa;AACrB,cAAI,oBAAoB,QACpB,OAAM,IAAI,MAAM,QAAQ,UAAA,kBAA4B;AACxD,cAAI,oBAAoB,OACpB;QACP;;AAEL,MAAAA,KAAI,IAAI,YAAYG,EAAA;IACvB;AACD,WAAOH;EACV;AACJ;AAqBD,IAAa,cAAc,CAACA,MAAK,aAAa;AAC1C,QAAMM,KAAI,YAAY;AACtB,SAAO,CAAC,GAAGN,KAAI,QAAA,CAAU,EAAC,KAAK,CAACO,IAAGC,OAAMF,GAAEC,GAAE,CAAA,GAAIC,GAAE,CAAA,CAAA,CAAG;AACzD;AAcD,IAAa,sBAAsB,CAACR,MAAK,UAAU,oBAAoB;AACnE,QAAM,MAAM,OAAO,oBAAoB,cAAc,kBAAkB;AACvE,SAAO,CAAC,GAAGA,KAAI,QAAA,CAAU,EAAC,KAAK,CAAC,IAAI,OAAO;AACvC,UAAMO,KAAI,GAAG,CAAA;AACb,UAAMC,KAAI,GAAG,CAAA;AACb,WAAO,IAAID,GAAE,QAAA,GAAWC,GAAE,QAAA,CAAA;EAC7B,CAAA;AACJ;AAkBD,IAAa,cAAc,CAACR,MAAKC,QAAO,aAAa;AACjD,QAAMQ,WAAU,CAAC,GAAGT,KAAI,QAAA,CAAU;AAClC,SAAOS,SAAQ,KAAK,CAAC,OAAO,SAAS,GAAG,CAAA,GAAIR,MAAA,CAAM;AACrD;AAmBD,UAAiB,aAAaD,MAAK,WAAW;AAC1C,aAAWG,MAAKH,KAAI,OAAA,EAChB,KAAI,UAAUG,EAAA,EACV,OAAMA;AAEjB;AAOD,IAAa,UAAU,CAACH,SAAQ,CAAC,GAAGA,KAAI,OAAA,CAAS;AAkBjD,IAAa,eAAe,CAAC,MAAM,cAAe,iBAAkB,kBAAkB,gBAAgB;AAClG,QAAMK,KAAI,oBAAI,IAAA;AACd,aAAWK,MAAK,MAAM;AAClB,UAAM,MAAM,YAAYA,EAAA;AACxB,QAAIL,GAAE,IAAI,GAAA,GAAM;AACZ,UAAI,oBAAoB,QACpB,OAAM,IAAI,MAAM,QAAQ,GAAA,oDAAuD;AACnF,UAAI,oBAAoB,OACpB;IACP;AACD,IAAAA,GAAE,IAAI,KAAKK,EAAA;EACd;AACD,SAAOL;AACV;AAkBD,IAAa,aAAa,CAAC,SAAS;AAChC,QAAML,OAAM,oBAAI,IAAA;AAChB,MAAI,MAAM,QAAQ,IAAA,EACd,YAAWU,MAAK,KACZ,wBAAuBV,MAAKU,EAAA;MAGhC,wBAAuBV,MAAK,IAAA;AAEhC,SAAOA;AACV;AAoBD,IAAa,yBAAyB,CAACA,MAAK,SAAS;AACjD,QAAMS,WAAU,OAAO,QAAQ,IAAA;AAC/B,aAAW,CAAC,KAAKR,MAAA,KAAUQ,SACvB,CAAAT,KAAI,IAAI,KAAKC,MAAA;AAEpB;AAgBD,IAAa,YAAY,CAACD,MAAK,cAAc,CAAC,GAAGA,KAAI,OAAA,CAAS,EAAC,KAAK,CAAAG,OAAK,UAAUA,EAAA,CAAE;AAerF,IAAa,OAAO,CAACH,MAAK,cAAc,CAAC,GAAGA,KAAI,OAAA,CAAS,EAAC,KAAK,CAAAG,OAAK,UAAUA,EAAA,CAAE;AAwBhF,IAAa,uBAAuB,CAACE,IAAG,mBAAmB,CAAC,GAAGA,EAAE,EAAC,OAAO,CAAC,QAAQ,CAAC,KAAKJ,MAAA,MAAW;AAC/F,QAAMU,KAAI,eAAeV,MAAA;AACzB,SAAO,GAAA,IAAOU;AACd,SAAO;AACV,GAAE,CAAE,CAAA;AAeL,IAAa,cAAc,CAAC,MAAMT,YAAW;AACzC,MAAI,KAAK,WAAWA,QAAO,OACvB,OAAM,IAAI,MAAM,8CAA8C;AAElE,SAAO,OAAO,YAAY,KAAK,IAAI,CAACU,IAAG,UAAU,CAACA,IAAGV,QAAO,KAAA,CAAO,CAAA,CAAC;AACvE;AA2BD,IAAa,eAAe,CAAC,QAAQ,gBAAgB,IAAI,IAAI,MAAM,KAAK,QAAQ,CAACC,OAAM,CAACA,GAAE,CAAA,GAAI,YAAYA,GAAE,CAAA,GAAIA,GAAE,CAAA,CAAA,CAAI,CAAA,CAAC;AAoBvH,IAAa,WAAW,CAACE,OAAM,CAAC,GAAGA,EAAE,EAAC,OAAO,CAAC,QAAQ,CAAC,KAAKJ,MAAA,MAAW;AACnE,SAAO,GAAA,IAAOA;AACd,SAAO;AACV,GAAE,CAAE,CAAA;AA+BL,IAAa,aAAa,CAACI,IAAG,gBAAgB,CAAC,GAAGA,GAAE,QAAA,CAAU,EAAC,IAAI,CAACR,OAAM,YAAYA,GAAE,CAAA,GAAIA,GAAE,CAAA,CAAA,CAAG;AAmCjG,IAAa,aAAa,CAAC,cAAc,SAAS;AAC9C,QAAM,SAAS,oBAAI,IAAA;AACnB,aAAWQ,MAAK,KACZ,YAAW,CAAC,IAAI,EAAA,KAAOA,IAAG;AACtB,QAAIF,KAAI,OAAO,IAAI,EAAA;AACnB,IAAAA,KAAIA,KAAI,UAAUA,IAAG,EAAA,IAAM;AAC3B,WAAO,IAAI,IAAIA,EAAA;EAClB;AAEL,SAAO;AACV;AAOD,IAAa,oBAAoB,CAACH,MAAKa,QAAO,CAAC,KAAK,SAAS;AACzD,MAAIZ,SAAQD,KAAI,IAAI,GAAA;AACpB,MAAIC,WAAU,OACV,QAAOA;AACX,EAAAA,SAAQY,IAAG,KAAK,IAAA;AAChB,EAAAb,KAAI,IAAI,KAAKC,MAAA;AACb,SAAOA;AACV;AAmBD,IAAa,gBAAgB,CAACD,MAAKa,QAAO,OAAO,KAAK,SAAS;AAC3D,MAAIZ,SAAQD,KAAI,IAAI,GAAA;AACpB,MAAIC,WAAU,OACV,QAAOA;AACX,EAAAA,SAAQ,MAAMY,IAAG,KAAK,IAAA;AACtB,MAAIZ,WAAU,OACV,OAAM,IAAI,MAAM,uBAAuB;AAC3C,EAAAD,KAAI,IAAI,KAAKC,MAAA;AACb,SAAOA;AACV;AC1mBD,IAAa,eAAe,CAAC,UAAUa,YAAW,GAAG,UAAU,CAAE,MAAK;AAClE,MAAI,aAAa,aAAaA,WAAU,CAAA;AACxC,cAAY,YAAY,YAAY,YAAY,UAAU,CAAC;AAC3D,QAAM,iBAAiB,QAAQ,kBAAkB;AACjD,QAAM,gBAAgB,QAAQ;AAC9B,QAAM,SAAS,QAAQ;AACvB,MAAI,WAAW;AACf,MAAI,WAAW;AACf,MAAI,aAAa;AACjB,MAAI,kBAAkB;AACtB,MAAI,YAAY,YAAY,IAAA;AAC5B,MAAI,eAAeA,aAAY;AAC/B,MAAI,YAAY;AAChB,MAAI;AACJ,QAAM,aAAa,MAAM;AACrB,QAAI,iBAAiB,OACjB;AACJ,eAAW,aAAa,YAAA;AACxB,mBAAe;AACf,iBAAa;AACb,gBAAY;EACf;AACD,QAAM,WAAW,CAAC,sBAAsB;AACpC,QAAI,eAAe,EACf,KAAI,OAAO,0BAA0B,YACjC,gBAAe,WAAW,WAAW,mBAAmB,CAAA;SAEvD;AACD,qBAAe;AACf,4BAAsB,iBAAA;IACzB;QAGD,gBAAe,WAAW,WAAW,mBAAmB,UAAA;EAE/D;AACD,QAAM,SAAS,MAAM;AACjB,QAAI,UACA;AACJ,gBAAY;AACZ,QAAI,aAAa,OACb;AACJ,eAAW;AACX,eAAA;EACH;AACD,QAAM,OAAO,YAAY;AACrB,QAAI,QAAQ,QACR,YAAW;AAEf,QAAI,aAAa,OACb;AACJ,eAAW;AACX;AACA;AACA,UAAM,iBAAiB,SAAS,YAAY,YAAY,IAAA,IAAQ,SAAA;AAChE,UAAMb,SAAQ,OAAO,mBAAmB,WAAY,MAAM,iBAAkB;AAC5E,QAAI,UACA;AAEJ,eAAW;AAEX,QAAIA,WAAU,UAAa,CAACA,QAAO;AAC/B,aAAA;AACA;IACH;AACD,QAAI,UACA;AAEJ,aAAS,IAAA;EACZ;AACD,QAAM,QAAQ,MAAM;AAChB,QAAI,SACA,OAAM,IAAI,MAAM,UAAU;AAC9B,gBAAY;AACZ,QAAI,kBAAkB,QAAW;AAE7B,YAAM,SAAS,cAAc,YAAY,YAAY,IAAA,IAAQ,SAAA;AAC7D,cAAQ,QAAR;QACI,KAAK,UAAU;AACX,iBAAA;AACA;QACH;QACD,KAAK,SAAS;AACV,UAAAc,OAAA;AACA;QACH;QACD,KAAK,WAAW;AACZ,qBAAW;AACX,iBAAA;AACA;QACH;MAEJ;IACJ;AACD,QAAI,aAAa,QAAQ;AAErB,mBAAa;AACb,kBAAY,YAAY,IAAA;AACxB,iBAAW;AACX,UAAI,eACK,MAAA;UAIL,UAAS,IAAA;IAEhB;EACJ;AACD,QAAMA,SAAQ,MAAM;AAChB,QAAI,SACA,OAAM,IAAI,MAAM,UAAU;AAC9B,gBAAY;AACZ,iBAAa;AACb,gBAAY;AAEZ,QAAI,aAAa,OACb,QAAA;AAEJ,UAAA;EACH;AACD,SAAO;IACH;IACA,OAAAA;IACA;IACA,IAAI,WAAW;AACX,aAAO;IACV;IACD,IAAI,WAAW;AACX,aAAO;IACV;IACD,IAAI,kBAAkB;AAClB,aAAO;IACV;IACD,IAAI,aAAa;AACb,aAAO;IACV;IACD,IAAI,SAASD,YAAU;AACnB,YAAME,MAAK,aAAaF,YAAU,CAAA;AAClC,kBAAY,YAAYE,KAAI,YAAY,UAAU,CAAC;AACnD,mBAAaA;AACb,qBAAeF;IAClB;IACD,IAAI,aAAa;AACb,aAAO;IACV;IACD,IAAI,YAAY;AACZ,aAAO,YAAY,IAAA,IAAQ;IAC9B;EACJ;AACJ;AC3MD,IAAa,eAAe,MAAM;AAC9B,QAAM,QAAQ,YAAY,IAAA;AAC1B,SAAO,MAAM;AACT,WAAO,YAAY,IAAA,IAAQ;EAC9B;AACJ;AAkED,IAAa,kBAAkB,MAAM;AACjC,SAAO,MAAM;AACT,WAAO,OAAO;EACjB;AACJ;AC3GD,IAAa,mBAAmB,CAAC,QAAQ,SAAS;AAC9C,SAAO,IAAI,QAAQ,CAAAG,aAAW;AAC1B,UAAM,UAAU,IAAI,SAAS;AACzB,aAAO,oBAAoB,MAAM,OAAA;AACjC,UAAI,MAAM,QAAQ,IAAA,KAAS,KAAK,WAAW,EACvC,CAAAA,SAAQ,KAAK,CAAA,CAAA;UAEb,CAAAA,SAAQ,IAAA;IACf;AACD,WAAO,iBAAiB,MAAM,OAAA;EACjC,CAAA;AACJ;ACTD,IAAI,OAAO,WAAW,eAAe,EAAE,2BAA2B,SAC9D;MAAI,OAAO,WAAW,YAGlB,YAAW,wBAAwB,CAAC,aAAa;AAC7C,eAAW,UAAU,CAAA;EACxB;AACJ;AA2CL,IAAa,QAAQ,CAAC,iBAAiB;AACnC,QAAM,YAAY,aAAa,cAAc,CAAA;AAC7C,QAAM,SAAS,aAAa;AAC5B,QAAMC,SAAQ,aAAa;AAC3B,cAAY,WAAW,WAAW,YAAY,WAAW,CAAC;AAC1D,MAAI,cAAc,EACd,QAAO,IAAI,QAAQ,CAACD,aAAY,sBAAsB,CAACE,OAAM;AACzD,IAAAF,SAAQC,MAAA;EACX,CAAA,CAAC;MAGF,QAAO,IAAI,QAAQ,CAACD,UAAS,WAAW;AACpC,UAAM,gBAAgB,MAAM;AACxB,mBAAaG,EAAA;AACb,UAAI,QAAQ;AACR,eAAO,oBAAoB,SAAS,aAAA;AACpC,eAAO,IAAI,MAAM,OAAO,MAAA,CAAA;MAC3B,MAEG,QAAO,oBAAI,MAAM,WAAW,CAAA;IAEnC;AACD,QAAI,OACA,QAAO,iBAAiB,SAAS,aAAA;AAErC,UAAMA,KAAI,WAAW,MAAM;AACvB,cAAQ,oBAAoB,SAAS,aAAA;AACrC,UAAI,QAAQ,SAAS;AACjB,eAAO,IAAI,MAAM,OAAO,MAAA,CAAA;AACxB;MACH;AACD,MAAAH,SAAQC,MAAA;IACX,GAAE,SAAA;EACN,CAAA;AAER;ACnFD,IAAa,MAAM,MAAM;AACrB,MAAIG,SAAM,OAAO;AACjB,QAAM,UAAU,CAACC,WAAU;AACvB,UAAM,aAAa,MAAM,QAAQA,MAAA,IAASA,SAAQ,CAACA,MAAM;AACzD,eAAW,YAAY,YAAY;AAC/B,UAAI,OAAO,aAAa,SACpB;AACJD,MAAAA,SAAM,KAAK,IAAI,UAAUA,MAAAA;IAC5B;AACD,WAAOA;EACV;AACD,SAAO;AACV;AAKD,IAAa,MAAM,MAAM;AACrB,MAAIE,SAAM,OAAO;AACjB,QAAM,UAAU,CAACD,WAAU;AACvB,UAAM,aAAa,MAAM,QAAQA,MAAA,IAASA,SAAQ,CAACA,MAAM;AACzD,eAAW,YAAY,YAAY;AAC/B,UAAI,OAAO,aAAa,SACpB;AACJC,MAAAA,SAAM,KAAK,IAAI,UAAUA,MAAAA;IAC5B;AACD,WAAOA;EACV;AACD,SAAO;AACV;AAKD,IAAa,MAAM,MAAM;AACrB,MAAIC,KAAI;AACR,QAAM,UAAU,CAACF,WAAU;AACvB,UAAM,aAAa,MAAM,QAAQA,MAAA,IAASA,SAAQ,CAACA,MAAM;AACzD,eAAW,YAAY,YAAY;AAC/B,UAAI,OAAO,aAAa,SACpB;AACJ,MAAAE,MAAK;IACR;AACD,WAAOA;EACV;AACD,SAAO;AACV;AAKD,IAAa,UAAU,MAAM;AACzB,MAAIC,SAAQ;AACZ,MAAIC,WAAQ;AACZ,QAAM,UAAU,CAACJ,WAAU;AACvB,UAAM,aAAa,MAAM,QAAQA,MAAA,IAASA,SAAQ,CAACA,MAAM;AACzD,eAAW,YAAY,YAAY;AAC/B,UAAI,OAAO,aAAa,SACpB;AACJI,MAAAA;AACA,MAAAD,UAAS;IACZ;AACD,WAAOA,SAAQC;EAClB;AACD,SAAO;AACV;AAMD,IAAa,QAAQ,CAAC,oBAAoB;AACtC,MAAIF,KAAI;AACR,QAAM,UAAU,CAACF,WAAU;AACvB,QAAI,gBACA,KAAI,MAAM,QAAQA,MAAA,EACd,CAAAE,MAAKF,OAAM;QAEX,CAAAE;QAGJ,CAAAA;AAEJ,WAAOA;EACV;AACD,SAAO;AACV;AAQD,SAAgB,KAAKG,IAAG,UAAU,CAAE,GAAE;AAClC,QAAM,cAAc,QAAQ;AAC5B,QAAM,kBAAkB,QAAQ,mBAAmB;AACnD,QAAM,oBAAoB,QAAQ,qBAAqB;AACvD,MAAI;AACJ,SAAO,CAACL,WAAU;AACd,QAAI,eAAe,OAAOA,WAAU,YAChC;AACJ,QAAI,SAAS,QAAW;AACpB,aAAOA;AACP,aAAO;IACV,OACI;AACD,YAAM,SAASK,GAAEL,QAAO,IAAA;AAExB,UAAI,UAAU,KAAK;AAEf,eAAOA;AACP,eAAO;MACV,WACQ,WAAW,QAAQ,gBAExB,QAAO;eAEF,kBAEL,QAAO;IAEd;EACJ;AACJ;;;ACjGD,IAAa,QAAQ,CAAC,YAAY;AAC9B,gBAAc,UAAU,SAAS,SAAS,CAAC;AAC3C,QAAM,OAAO,CAAC,GAAG,OAAQ;AACzB,MAAI,QAAQ;AACZ,QAAMM,QAAO,MAAM;AACf;AACA,QAAI,UAAU,KAAK,OACf,SAAQ;AACZ,WAAOC,OAAA;EACV;AAED,QAAM,OAAO,MAAM;AACf;AACA,QAAI,UAAU,GACV,SAAQ,KAAK,SAAS;AAC1B,WAAOA,OAAA;EACV;AACD,QAAMA,SAAQ,MAAM;AAEhB,WAAO,KAAK,GAAG,KAAA;EAClB;AACD,QAAMC,UAAS,CAAC,iBAAiB;AAC7B,QAAI,OAAO,iBAAiB,SACxB,SAAQ;SAEP;AACD,YAAM,QAAQ,KAAK,QAAQ,YAAA;AAC3B,UAAI,UAAU,GACV,OAAM,IAAI,MAAM,sBAAsB;AAC1C,cAAQ;IACX;EACJ;AACD,QAAMC,WAAU,MAAM,CAAC,GAAG,IAAK;AAC/B,SAAO;IAAE,SAAAA;IAAS,MAAAH;IAAM;IAAM,IAAI,UAAU;AAAE,aAAOC,OAAA;IAAU;IAAE,QAAAC;EAAQ;AAC5E;AC1CD,IAAa,SAAS,CAACE,SAAO,UAAU;AACpC,cAAY,WAAW,OAAO,IAAI,OAAO,CAAC;AAC1C,MAAI,CAAC,MAAM,QAAQA,OAAAA,EACf,OAAM,IAAI,MAAM,+BAA+B;AACnD,UAAQ,QAAQA,QAAM;AACtB,SAAOA,QAAM,GAAG,KAAA;AACnB;ACjBD,SAAgB,OAAOA,SAAO,MAAM;AAChC,gBAAc,YAAY,MAAM,aAAa,MAAM,GAAG,UAAUA,SAAO,OAAO,CAAC;AAE/E,QAAM,SAAS,CAAE;AACjB,WAAS,QAAQ,GAAG,QAAQA,QAAM,QAAQ,SAAS,KAC/C,QAAO,KAAKA,QAAM,MAAM,OAAO,QAAQ,IAAA,CAAK;AAEhD,SAAO;AACV;ACjBD,IAAaC,mBAAkB,CAAC,wBAAwB,OAAO,wBAAwB,WACjF,sBACA,KAAK,UAAU,mBAAA;ACcrB,IAAaC,kBAAiB,CAACC,IAAGC,OAAMD,OAAMC;AAmB9C,IAAa,sBAAsB,CAACD,IAAGC,OAAM;AAEzC,MAAID,OAAMC,GACN,QAAO;AACX,SAAOH,iBAAgBE,EAAA,MAAOF,iBAAgBG,EAAA;AACjD;ACxBD,IAAa,WAAW,CAAC,UAAU,SAAS,KAAMF,oBAAoB;AAClE,MAAI,CAAC,MAAM,QAAQ,QAAA,EACf,OAAM,IAAI,UAAU,2CAA2C;AAEnE,MAAI,CAAC,MAAM,QAAQ,OAAA,EACf,OAAM,IAAI,UAAU,kDAAkD,OAAO,OAAA,EAAS;AAE1F,aAAW,UAAU,SAAS;AAC1B,QAAI,QAAQ;AACZ,eAAW,WAAW,SAElB,KAAI,GAAG,QAAQ,OAAA,GAAU;AACrB,cAAQ;AACR;IACH;AAEL,QAAI,CAAC,MACD,QAAO;EAEd;AACD,SAAO;AACV;AAsBD,IAAa,0BAA0B,CAAC,MAAM,cAAeD,qBAAqB;AAC9E,MAAI,OAAO,SAAS,SAChB,OAAM,IAAI,MAAM,yDAAyD,OAAO,IAAA,EAAM;AAC1F,QAAMI,OAAM,oBAAI,IAAA;AAChB,aAAWC,MAAK,MAAM;AAClB,UAAM,UAAU,YAAYA,EAAA;AAC5B,QAAID,KAAI,IAAI,OAAA,EACR,QAAO;AACX,IAAAA,KAAI,IAAI,OAAA;EACX;AACD,SAAO;AACV;AAOD,IAAa,6BAA6B,CAACL,YAAU;AACjD,MAAI,CAAC,MAAM,QAAQA,OAAAA,EACf,OAAM,IAAI,MAAM,gCAAgC;AACpD,WAAS,QAAQ,GAAG,QAAQA,QAAM,QAAQ,QACtC,UAASO,KAAI,GAAGA,KAAIP,QAAM,QAAQO,MAAK;AACnC,QAAI,UAAUA,GACV;AACJ,QAAIP,QAAM,KAAA,MAAWA,QAAMO,EAAA,EACvB,QAAO;EACd;AAEL,SAAO;AACV;ACjED,SAAgB,aAAa,MAAMC,SAAQ,iBAAiB,aAAa,mBAAmB,YAAY;AACpG,MAAI,SAAS,OACT,OAAM,IAAI,MAAM,gBAAgB;AACpC,MAAI,CAAC,MAAM,QAAQ,IAAA,EACf,OAAM,IAAI,MAAM,sBAAsB;AAC1C,MAAI,KAAK,WAAWA,QAChB,QAAO,CAAC,GAAG,IAAK;AACpB,MAAI,KAAK,SAASA,QACd,KAAI,qBAAqB,WACrB,QAAO,KAAK,MAAM,GAAGA,OAAA;MAGrB,QAAO,KAAK,MAAM,KAAK,SAASA,OAAA;AAGxC,QAAMC,KAAI,CAAC,GAAG,IAAK;AACnB,QAAMC,OAAMF,UAASC,GAAE;AACvB,WAAS,QAAQ,GAAG,QAAQC,MAAK,QAC7B,SAAQ,gBAAR;IACI,KAAK,aAAa;AAEd,MAAAD,GAAE,KAAK,MAAA;AACP;IACH;IACD,KAAK,UAAU;AACX,MAAAA,GAAE,KAAK,KAAK,QAAQ,KAAK,MAAA,CAAA;AACzB;IACH;IACD,KAAK,SAAS;AACV,MAAAA,GAAE,KAAK,KAAK,CAAA,CAAA;AACZ;IACH;IACD,KAAK,QAAQ;AAET,MAAAA,GAAE,KAAK,KAAK,GAAG,EAAA,CAAG;AAClB;IACH;EAEJ;AAEL,SAAOA;AACV;AC1CD,IAAa,UAAU,CAAC,QAAQ,QAAQ,WAAYP,oBAAoB;AAEpE,cAAY,UAAU,QAAQ,QAAQ,GAAG,UAAU,QAAQ,QAAQ,CAAC;AACpE,MAAI,OAAO,WAAW,OAAO,OACzB,QAAO;AACX,WAAS,SAAS,GAAG,SAAS,OAAO,QAAQ,SACzC,KAAI,CAAE,SAAS,OAAO,MAAA,GAAS,OAAO,MAAA,CAAA,EAClC,QAAO;AAEf,SAAO;AACV;AA2BD,IAAa,0BAA0B,CAACF,SAAO,aAAa;AAExD,MAAI,CAAC,MAAM,QAAQA,OAAAA,EACf,OAAM,IAAI,MAAM,gCAAgC;AACpD,MAAIA,QAAM,WAAW,EACjB,QAAO;AACX,QAAM,KAAK,YAAY;AACvB,QAAMG,KAAIH,QAAM,CAAA;AAChB,QAAMW,KAAIX,QAAM,KAAK,CAACM,OAAM,CAAC,GAAGH,IAAGG,EAAA,CAAE;AACrC,MAAIK,GACA,QAAO;AACX,SAAO;AACV;AC3DD,IAAa,WAAW,CAAC,MAAMC,YAAW;AACtC,QAAMT,KAAI,CAAE;AACZ,QAAMC,KAAI,CAAE;AACZ,aAAW,SAAS,KAChB,KAAIQ,QAAO,KAAA,EACP,CAAAT,GAAE,KAAK,KAAA;MAEP,CAAAC,GAAE,KAAK,KAAA;AAEf,SAAO,CAACD,IAAGC,EAAE;AAChB;AAkBD,UAAiB,cAAcJ,SAAO,WAAW,YAAY,UAAU;AACnE,cAAY,UAAUA,SAAO,OAAO,CAAC;AACrC,MAAI,OAAO,eAAe,YACtB,cAAa;AACjB,MAAI,OAAO,aAAa,YACpB,YAAWA,QAAM;AACrB,cAAY,eAAeA,SAAO,YAAY,YAAY,CAAC;AAC3D,cAAY,eAAeA,SAAO,WAAW,GAAG,UAAU,CAAC;AAC3D,WAAS,QAAQ,YAAY,QAAQ,UAAU,QAC3C,KAAI,UAAUA,QAAM,KAAA,GAAQ,OAAOA,OAAAA,EAC/B,OAAMA,QAAM,KAAA;AAEvB;AC/CD,IAAa,UAAU,CAACA,YAAU,CAAC,GAAGA,OAAM,EAAC,KAAA;ACQ7C,IAAa,uBAAuB,CAACA,SAAOa,KAAI,aAAa;AACzD,MAAI,OAAOb,YAAU,YAAY,CAAC,MAAM,QAAQA,OAAAA,KAAUA,QAAM,WAAW,GAAG;AAC1E,QAAI,MAAM,QAAQ,QAAA,EACd,QAAO;AACX,WAAO,CAAC,QAAS;EACpB;AACD,SAAOA,QAAM,IAAIa,GAAA;AACpB;ACPD,IAAa,mBAAmB,CAACC,WAAS,SAAS;AAC/C,MAAI,CAAC,MAAM,QAAQ,IAAA,EACf,OAAM,IAAI,UAAU,wDAAwD,OAAO,IAAA,GAAO;AAC9F,QAAM,QAAQ,oBAAI,IAAA;AAClB,aAAWjB,UAAS,MAAM;AACtB,UAAMkB,SAAQD,UAAQjB,MAAA;AACtB,QAAI,OAAOkB,WAAU,YAAY,OAAOA,WAAU,SAC9C,OAAM,IAAI,UAAU,4EAA4E,OAAOA,MAAA,iBAAsBlB,MAAA,GAAQ;AAEzI,QAAI,aAAa,MAAM,IAAIkB,MAAA;AAC3B,mBAAe;AACf;AACA,UAAM,IAAIA,QAAO,UAAA;EACpB;AACD,SAAO;AACV;ACCD,IAAa,UAAU,CAACf,SAAO,YAAY;AACvC,QAAMgB,OAAM,oBAAI,IAAA;AAChB,aAAWb,MAAKH,SAAO;AACnB,UAAM,MAAM,QAAQG,EAAA;AACpB,QAAI,WAAWa,KAAI,IAAI,GAAA;AACvB,QAAI,CAAC,UAAU;AACX,iBAAW,CAAE;AACb,MAAAA,KAAI,IAAI,KAAK,QAAA;IAChB;AACD,aAAS,KAAKb,EAAA;EACjB;AACD,SAAOa;AACV;ACnBD,IAAa,aAAa,CAAC,QAAQ,WAAYd,oBAAoB;AAC/D,QAAMe,KAAI,CAAE;AACZ,QAAMC,aAAW,CAACZ,OAAM;AACpB,eAAW,UAAUW,GACjB,KAAI,SAAS,QAAQX,EAAA,EACjB,QAAO;AAEf,WAAO;EACV;AACD,QAAM,YAAY,OAAO,KAAK,EAAA;AAC9B,aAAWA,MAAK,UACZ,KAAI,CAACY,WAASZ,EAAA,EACV,CAAAW,GAAE,KAAKX,EAAA;AAEf,SAAOW;AACV;AA2BD,IAAa,SAAS,CAAC,QAAQE,YAAWlB,qBAAoB;AAC1D,QAAM,WAAW,oBAAI,IAAA;AACrB,QAAMgB,KAAI,CAAE;AACZ,QAAM,YAAY,OAAO,KAAK,EAAA;AAC9B,aAAWd,MAAK,WAAW;AACvB,UAAM,uBAAuBgB,UAAShB,EAAA;AACtC,QAAI,SAAS,IAAI,oBAAA,EACb;AACJ,aAAS,IAAI,oBAAA;AACb,IAAAc,GAAE,KAAKd,EAAA;EACV;AACD,SAAOc;AACV;AC5DD,IAAa,WAAW,CAAC,MAAM,UAAUG,YAAW;AAChD,gBAAc,UAAU,MAAM,MAAM,GAAG,eAAe,MAAM,OAAO,OAAO,CAAC;AAE3E,MAAI,UAAU,KAAK,SAAS,EACxB,QAAO,CAAC,GAAG,MAAM,GAAGA,OAAO;AAG/B,MAAI,UAAU,EACV,QAAO,CAAC,GAAGA,SAAQ,GAAG,IAAK;AAE/B,SAAO;IAAC,GAAG,KAAK,MAAM,GAAG,KAAA;IAAQ,GAAGA;IAAQ,GAAG,KAAK,MAAM,KAAA;EAAO;AACpE;ACjBD,IAAa,aAAa,IAAI,WAAW;AACrC,MAAI,OAAO,KAAK,CAACjB,OAAM,CAAC,MAAM,QAAQA,EAAA,CAAE,EACpC,OAAM,IAAI,MAAM,iCAAiC;AAErD,QAAMkB,WAAU,OAAO,IAAI,CAAAlB,OAAKA,GAAE,MAAA;AAClC,MAAI,CAAC,wBAAwBkB,QAAA,EACzB,OAAM,IAAI,MAAM,+BAA+B;AAEnD,QAAM,cAAc,CAAE;AACtB,QAAMb,UAASa,SAAQ,CAAA;AACvB,WAAS,QAAQ,GAAG,QAAQb,SAAQ,QAChC,YAAWR,WAAS,OAChB,aAAY,KAAKA,QAAM,KAAA,CAAA;AAG/B,SAAO;AACV;ACfD,IAAa,eAAe,CAAC,QAAQ,QAAQ,WAAWE,oBAAmB,OAAO,OAAO,CAAC,eAAe,OAAO,KAAK,CAAC,eAAe,SAAS,YAAY,UAAA,CAAW,CAAC;AC0BtK,IAAaoB,cAAa,CAAC,aAAa,cAAc,WAAW;AAC7D,QAAM,SAAS,oBAAI,IAAA;AACnB,aAAWC,MAAK,OACZ,YAAW,MAAMA,IAAG;AAChB,QAAI,OAAO,OACP;AACJ,UAAM,KAAK,YAAY,EAAA;AACvB,QAAIjB,KAAI,OAAO,IAAI,EAAA;AACnB,IAAAA,KAAIA,KAAI,UAAUA,IAAG,EAAA,IAAM;AAC3B,WAAO,IAAI,IAAIA,EAAA;EAClB;AAEL,SAAO,CAAC,GAAG,OAAO,OAAA,CAAS;AAC9B;ACzCD,UAAiB,SAASc,SAAQ;AAC9B,cAAY,UAAUA,SAAQ,QAAQ,CAAC;AACvC,MAAIA,QAAO,SAAS,EAChB,OAAM,IAAI,MAAM,qDAAqDA,QAAO,MAAA,EAAQ;AACxF,WAAS,QAAQ,GAAG,QAAQA,QAAO,QAAQ,QACvC,OAAM,CAACA,QAAO,QAAQ,CAAA,GAAIA,QAAO,KAAA,CAAO;AAE/C;AAyBD,IAAa,iBAAiB,CAACpB,SAAO,SAAS,YAAY;AACvD,cAAY,UAAUA,SAAO,KAAK,CAAC;AACnC,MAAIA,QAAM,SAAS,EACf,QAAO;AACX,WAAS,QAAQ,GAAG,QAAQA,QAAM,SAAS,GAAG,QAC1C,WAAU,QAAQ,SAASA,QAAM,KAAA,GAAQA,QAAM,QAAQ,CAAA,CAAA;AAE3D,SAAO;AACV;AChCD,IAAa,UAAU,CAAC,eAAe,OAAO,KAAK,WAAW;AAC1D,cAAY,UAAU,eAAe,eAAe,CAAC;AACrD,QAAMA,UAAQ,CAAC,GAAG,aAAc;AAChC,WAAS,QAAQA,QAAM,SAAS,GAAG,QAAQ,GAAG,SAAS;AACnD,UAAM,SAAS,KAAK,MAAM,KAAA,KAAU,QAAQ,EAAA;AAC5C,KAACA,QAAM,KAAA,GAAQA,QAAM,MAAA,CAAA,IAAW,CAACA,QAAM,MAAA,GAASA,QAAM,KAAA,CAAO;EAChE;AACD,SAAOA;AACV;AAmBD,IAAa,gBAAgB,CAACA,SAAO,OAAO,KAAK,WAAW;AACxD,cAAY,UAAUA,SAAO,OAAO,CAAC;AACrC,SAAOA,QAAM,KAAK,MAAM,KAAA,IAASA,QAAM,MAAA,CAAO;AACjD;AAeD,IAAa,cAAc,CAACA,SAAO,OAAO,KAAK,WAAW,KAAK,MAAM,KAAA,IAASA,QAAM,MAAA;AC7CpF,IAAa,SAAS,CAAC,MAAM,UAAU;AACnC,MAAI,CAAC,MAAM,QAAQ,IAAA,EACf,OAAM,IAAI,UAAU,qCAAqC;AAE7D,cAAY,eAAe,MAAM,OAAO,OAAO,CAAC;AAChD,SAAO,CAAC,GAAG,KAAK,MAAM,GAAG,KAAA,GAAQ,GAAG,KAAK,MAAM,QAAQ,CAAA,CAAG;AAC7D;ACAD,IAAa,SAAS,CAACA,SAAO,WAAW;AACrC,MAAI,CAAC,MAAM,QAAQA,OAAAA,EACf,OAAM,IAAI,UAAU,qDAAqD,OAAOA,OAAAA,EAAO;AAC3F,MAAI,iBAAiB;AACrB,MAAI,UAAU,GAAG;AAEb,UAAM,gBAAgBA,QAAM,SAAS;AACrC,qBAAiB,KAAK,MAAMA,QAAM,SAAS,aAAA;EAC9C,MAEG,kBAAiB;AAErB,cAAY,YAAY,gBAAgB,YAAY,QAAQ,CAAC;AAC7D,MAAI,iBAAiBA,QAAM,SAAS,EAChC,OAAM,IAAI,MAAM,sCAAsC;AAE1D,QAAMW,KAAI,CAAE;AACZ,WAAS,QAAQ,iBAAiB,GAAG,QAAQX,QAAM,QAAQ,SAAS,eAChE,CAAAW,GAAE,KAAKX,QAAM,KAAA,CAAA;AAEjB,SAAOW;AACV;AC7BD,IAAa,wBAAwB,CAAC,MAAM,iBAAiB,CAAC,GAAG,IAAK,EAAC,KAAK,CAACR,IAAGC,OAAM;AAClF,cAAY,UAAU,MAAM,MAAM,CAAC;AACnC,QAAM,KAAKD,GAAE,YAAA;AACb,QAAM,KAAKC,GAAE,YAAA;AACb,MAAI,KAAK,GACL,QAAO;AACX,MAAI,KAAK,GACL,QAAO;AACX,SAAO;AACV,CAAA;AAyBD,IAAa,iBAAiB,CAAC,MAAM,cAAc,aAAa,CAAC,GAAG,IAAK,EAAC,KAAK,CAACD,IAAGC,OAAM;AACrF,cAAY,UAAU,MAAM,MAAM,CAAC;AACnC,QAAM,KAAKD,GAAE,YAAA;AACb,QAAM,KAAKC,GAAE,YAAA;AACb,MAAI,aAAa,QAAW;AACxB,QAAI,KAAK,GACL,QAAO;AACX,QAAI,KAAK,GACL,QAAO;AACX,WAAO;EACV,MAEG,QAAO,SAAS,IAAI,EAAA;AAE3B,CAAA;AC5CD,UAAiB,MAAM,MAAM,WAAW,SAAS;AAC7C,MAAIoB,UAAQ;AACZ,aAAW,SAAS,MAAM;AACtB,UAAMb,KAAI,UAAU,OAAOa,OAAAA;AAC3B,QAAI,OAAOb,OAAM,WACb;UAAIA,GACA;IAAM,OAET;AACD,YAAM,CAAC,MAAM,WAAA,IAAeA;AAC5B,UAAI,KACA;AACJa,gBAAQ;IACX;AACD,UAAM;EACT;AACJ;ACjCD,IAAa,mBAAmB,CAAC,SAAS;AACtC,SAAO,KAAK,OAAO,CAAAlB,OAAKA,OAAM,MAAA;AACjC;AA0CD,IAAa,UAAU,CAAC,aAAa,UAAU,WAAWJ,oBAAmB;AACzE,MAAI,MAAM,QAAQ,QAAA,GAAW;AACzB,UAAM,cAAc,CAAE;AACtB,eAAW,UAAU,YACjB,KAAI,CAAC,SAAS,KAAK,CAAAI,OAAK,SAAS,QAAQA,EAAA,CAAE,EACvC,aAAY,KAAK,MAAA;AAGzB,WAAO;EACV,MAEG,QAAO,YAAY,OAAO,CAACA,OAAM,CAAC,SAASA,IAAG,QAAA,CAAS;AAE9D;ACxCD,IAAa,MAAM,IAAI,WAAW;AAC9B,MAAI,OAAO,KAAK,CAACH,OAAM,CAAC,MAAM,QAAQA,EAAA,CAAE,EACpC,OAAM,IAAI,MAAM,iCAAiC;AAErD,QAAMkB,WAAU,OAAO,IAAI,CAAClB,OAAMA,GAAE,MAAA;AACpC,MAAI,CAAC,wBAAwBkB,QAAA,EACzB,OAAM,IAAI,MAAM,+BAA+B;AAEnD,QAAM,cAAc,CAAE;AACtB,QAAMb,UAASa,SAAQ,CAAA;AACvB,WAAS,QAAQ,GAAG,QAAQb,SAAQ,QAChC,aAAY,KAAK,OAAO,IAAI,CAACL,OAAMA,GAAE,KAAA,CAAA,CAAO;AAEhD,SAAO;AACV;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AErBD,IAAa,gBAAgB,CAAC,QAAQsB,WAAU;AAC5C,QAAMC,KAAI,EAAE,GAAG,OAAQ;AACvB,aAAW,CAAC,KAAK7B,MAAA,KAAU,OAAO,QAAQ,MAAA,EACtC,KAAI,OAAOA,WAAU,SAGjB,CAAA6B,GAAE,GAAA,IAAOD,OAAM5B,MAAA;MAKf,CAAA6B,GAAE,GAAA,IAAO7B;AAGjB,SAAO6B;AACV;ACHD,IAAa,SAAS,CAAC,MAAMb,QAAO;AAChC,MAAI,CAAC,MAAM,QAAQ,IAAA,EACf,OAAM,IAAI,UAAU,sDAAsD,OAAO,IAAA,EAAM;AAC3F,QAAM,oBAAoBA,QAAO,CAACN,OAAMA;AACxC,SAAO,KAAK,IAAI,CAACV,QAAO,UAAU;AAC9B,QAAI,OAAOA,WAAU,SACjB,OAAM,IAAI,UAAU,+CAA+C,KAAA,aAAkB,OAAOA,MAAA,aAAkBA,MAAA,GAAQ;AAC1H,UAAM,cAAc,SAAS,KAAK,SAAS;AAC3C,UAAM,oBAAoB,kBAAkB,WAAA;AAC5C,QAAI,OAAO,sBAAsB,SAC7B,OAAM,IAAI,UAAU,qCAAqC,OAAO,iBAAA,oCAAqD,WAAA,GAAc;AACvI,UAAM,cAAcA,SAAQ;AAE5B,WAAO;EACV,CAAA;AACJ;AAOD,IAAa,eAAe,CAAC,SAAS,KAAK,OAAO,CAACY,OAAM,OAAOA,OAAM,YAAY,CAAC,OAAO,MAAMA,EAAA,CAAE;AAMlG,IAAa,aAAa,CAACW,YAAW;AAClC,MAAIT,KAAI;AACR,QAAMH,UAASY,QAAO,CAAA,EAAG;AACzB,WAAS,QAAQ,GAAG,QAAQZ,SAAQ,SAAS;AACzC,QAAIS,KAAI;AACR,eAAW,CAACU,IAAG9B,MAAA,KAAUuB,QAAO,QAAA,EAC5B,KAAIO,OAAM,EACN,CAAAV,KAAIpB,OAAM,KAAA;QAEV,CAAAoB,MAAKpB,OAAM,KAAA;AAGnB,IAAAc,MAAKM;EACR;AACD,SAAON;AACV;AAqBD,IAAaiB,WAAU,CAAC,SAAS;AAE7B,MAAI,SAAS,OACT,OAAM,IAAI,MAAM,6BAA6B;AACjD,QAAM,QAAQ,aAAa,IAAA;AAC3B,QAAMJ,UAAQ,MAAM,OAAO,CAAC,aAAalB,OAAM,cAAcA,IAAG,CAAA;AAChE,SAAOkB,UAAQ,MAAM;AACxB;AAWD,IAAaK,OAAM,CAAC,SAAS,KAAK,IAAI,GAAG,aAAa,IAAA,CAAK;AAU3D,IAAa,WAAW,CAAC,SAAS,KAAK,OAAO,CAAC,WAAWhC,QAAO,OAAOG,YAAUH,SAAQG,QAAM,SAAA,IAAa,QAAQ,WAAW,CAAA;AAWhI,IAAa,WAAW,IAAI,SAAS,KAAK,OAAO,CAAC,WAAWH,QAAO,OAAOG,YAAUH,SAAQG,QAAM,SAAA,IAAa,QAAQ,WAAW,CAAA;AAWnI,IAAa8B,OAAM,CAAC,SAAS,KAAK,IAAI,GAAG,aAAa,IAAA,CAAK;AAW3D,IAAa,QAAQ,CAAC,SAAS,KAAK,OAAO,CAAC,UAAU,YAAY;AAC9D,MAAI,OAAO,YAAY,SACnB,QAAO;AACX,MAAI,OAAO,MAAM,OAAA,EACb,QAAO;AACX,MAAI,CAAC,OAAO,SAAS,OAAA,EACjB,QAAO;AACX,SAAO,WAAW;AACrB,GAAE,CAAA;AAYH,IAAa,UAAU,CAAC,SAAS;AAC7B,MAAIP,KAAI,OAAO;AACf,aAAW,SAAS,KAChB,CAAAA,KAAI,KAAK,IAAIA,IAAG,KAAA;AAEpB,SAAOA;AACV;AAYD,IAAa,YAAY,CAAC,SAAS;AAC/B,MAAIA,KAAI;AACR,aAAW,SAAS,KAChB,CAAAA,MAAK;AAET,SAAOA;AACV;AAYD,IAAa,UAAU,CAAC,SAAS;AAC7B,MAAIA,KAAI,OAAO;AACf,aAAW,SAAS,KAChB,CAAAA,KAAI,KAAK,IAAIA,IAAG,KAAA;AAEpB,SAAOA;AACV;ACpLD,IAAa,kBAAkB,CAAC,MAAM,eAAe;AACjD,MAAI,OAAO,eAAe,WACtB,cAAa,OAAO,MAAM,UAAA;AAC9B,QAAM,KAAK,IAAI,MAAM,UAAA;AACrB,QAAM,CAAC,QAAQ,MAAA,IAAU,GAAG,OAAO,CAAC,aAAajB,OAAM,CAAC,YAAY,CAAA,IAAKA,GAAE,CAAA,IAAKA,GAAE,CAAA,GAAI,YAAY,CAAA,IAAKA,GAAE,CAAA,CAAG,GAAE,CAAC,GAAG,CAAE,CAAA;AACpH,SAAO,SAAS;AACnB;ACjBD,IAAa,QAAQ,CAACT,QAAOgC,SAAM,GAAGC,SAAM,MAAM;AAE9C,MAAI,OAAO,MAAMjC,MAAA,EACb,OAAM,IAAI,MAAM,sBAAsB;AAC1C,MAAI,OAAO,MAAMgC,MAAAA,EACb,OAAM,IAAI,MAAM,oBAAoB;AACxC,MAAI,OAAO,MAAMC,MAAAA,EACb,OAAM,IAAI,MAAM,oBAAoB;AACxC,MAAIjC,SAAQgC,OACR,QAAOA;AACX,MAAIhC,SAAQiC,OACR,QAAOA;AACX,SAAOjC;AACV;AAaD,IAAa,UAAU,CAACgC,SAAM,GAAGC,SAAM,MAAM;AACzC,MAAI,OAAO,MAAMD,MAAAA,EACb,OAAM,IAAI,MAAM,oBAAoB;AACxC,MAAI,OAAO,MAAMC,MAAAA,EACb,OAAM,IAAI,MAAM,oBAAoB;AACxC,SAAO,CAACxB,OAAM;AACV,QAAIA,KAAIwB,OACJ,QAAOA;AACX,QAAIxB,KAAIuB,OACJ,QAAOA;AACX,WAAOvB;EACV;AACJ;AAsBD,IAAa,aAAa,CAACA,IAAG,kBAAkB;AAE5C,MAAI,CAAC,OAAO,UAAUA,EAAA,EAClB,OAAM,IAAI,UAAU,mCAAmCA,EAAA,GAAI;AAE/D,QAAME,UAAS,MAAM,QAAQ,aAAA,IACvB,cAAc,SACd;AACN,MAAI,CAAC,OAAO,UAAUA,OAAA,EAClB,OAAM,IAAI,UAAU,wCAAwCA,OAAA,KAAW,OAAOA,OAAA,GAAS;AAE3F,EAAAF,KAAI,KAAK,MAAMA,EAAA;AACf,MAAIA,KAAI,EACJ,QAAO;AACX,MAAIA,MAAKE,QACL,QAAOA,UAAS;AACpB,SAAOF;AACV;AAWD,IAAa,SAAS,IAAIc,YAAW;AACjC,MAAI,QAAQ;AACZ,MAAI,OAAO,OAAO;AAClB,WAAS,SAAS,GAAG,SAASA,QAAO,QAAQ,UAAU;AACnD,UAAM,KAAK,KAAK,IAAIA,QAAO,MAAA,CAAA;AAC3B,QAAI,KAAK,MAAM;AACX,aAAO;AACP,cAAQ;IACX;EACJ;AACD,SAAOA,QAAO,KAAA;AACjB;ACzFD,UAAiB,MAAM,QAAQW,UAAS,GAAG;AACvC,cAAY,YAAY,QAAQ,IAAI,QAAQ,GAAG,YAAYA,SAAQ,IAAI,QAAQ,CAAC;AAChF,MAAI,WAAW,EACX;AACJ,MAAI,QAAQ;AACZ;AACI,UAAO,SAAS,IAAI,CAAC,QAAQA,UAAS,QAAQA;SACzC,UAAU,KAAK,IAAI,MAAA,IAAU;AACzC;ACTD,IAAa,sBAAsB,CAAC,SAAS,OAAO,eAAe,CAAClC,WAAU,eAAe,MAAMA,QAAO,OAAA;AAkD1G,IAAa,qBAAqB,CAAC,OAAO,YAAY,eAAe,QAAe;AAChF,MAAI,YAAY;AAChB,SAAO,CAACA,WAAU;AACd,UAAMU,KAAI,eAAe,MAAMV,QAAO,SAAA;AACtC,gBAAYA;AACZ,WAAOU;EACV;AACJ;AAsBD,IAAM,iBAAiB,CAAC,OAAO,YAAYV,QAAOmC,UAAS;AACvD,MAAI,OAAO,MAAMA,KAAA,EACb,QAAO;AAEX,QAAMvB,KAAIZ,SAAQmC;AAClB,MAAIrB,KAAI;AACR,MAAI,SAAS,WACT,CAAAA,KAAI,KAAK,IAAIF,EAAA;WAER,SAAS,YACd,CAAAE,KAAIF;WAEC,SAAS,WACd,CAAAE,KAAI,KAAK,IAAIF,KAAIuB,KAAA;WAEZ,SAAS,iBACd,CAAArB,KAAIF,KAAIuB;MAGR,OAAM,IAAI,UAAU,kBAAkB,IAAA,qEAAyE;AACnH,SAAOrB;AACV;AChID,IAAa,UAAU,CAAC,mBAAmB;AACvC,MAAI,OAAO,mBAAmB,SAC1B,QAAO;AACX,MAAI,OAAO,MAAM,cAAA,EACb,QAAO;AACX,SAAO;AACV;ACED,UAAiB,eAAesB,KAAI;AAChC,aAAW3B,MAAK2B,IACZ,KAAI,QAAQ3B,EAAA,EACR,OAAMA;AAEjB;AAaD,IAAa,mBAAmB,CAAC,cAAc;AAC3C,SAAO,CAACA,OAAM;AACV,WAAOA,MAAK;EACf;AACJ;AAiBD,IAAa,iBAAiB,CAACuB,QAAKC,WAAQ;AACxC,SAAO,CAACxB,OAAM;AACV,WAAOA,MAAKuB,UAAOvB,MAAKwB;EAC3B;AACJ;ACzCD,IAAa,OAAO,CAACxB,OAAM;AACvB,MAAI,OAAOA,OAAM,WACb,CAAAA,KAAIA,GAAA;AACR,cAAY,WAAWA,IAAG,cAAc,GAAG,CAAC;AAC5C,SAAO,IAAIA;AACd;ACJD,IAAa,kBAAkB,WAAW4B,WAAU,QAAQ,GAAG,KAAK,YAAY,OAAO;AACnF,MAAIA,aAAY,EACZ,OAAM,IAAI,MAAM,uCAAuC;AAC3D,MAAI,OAAO,QAAQ,YACf,OAAM,OAAO;AACjB,MAAI5B,KAAI;AACR;AACI,WAAOA,KAAI,KAAK;AACZ,YAAMA;AACN,MAAAA,MAAK4B;IACR;SACI;AACZ;AA4BD,IAAa,eAAe,WAAWA,WAAU,QAAQ,GAAG,KAAK,YAAY,OAAO,UAAU;AAC1F,cAAY,WAAWA,WAAU,SAAS,CAAC;AAC3C,QAAM,mBAAmBA,YAAW;AACpC,MAAI,QAAQ,QAAW;EAEtB,OACI;AACD,QAAI,oBAAoB,QAAQ,IAC5B,OAAM,IAAI,MAAM,eAAeA,UAAS,SAAA,CAAU,uBAAuB,MAAM,SAAA,CAAU,OAAO,IAAI,SAAA,CAAU,EAAE;AAEpH,QAAI,CAAC,oBAAoB,QAAQ,IAC7B,OAAM,IAAI,MAAM,eAAeA,UAAS,SAAA,CAAU,uBAAuB,MAAM,SAAA,CAAU,OAAO,IAAI,SAAA,CAAU,EAAE;EAEvH;AACD,aAAW,YAAY;AACvB,MAAI,QAAQ,OACR,OAAM,OAAO;MAEb,QAAO;AACX,EAAAA,YAAWA,YAAW;AACtB,KAAG;AACC,QAAI5B,KAAI,QAAQ;AAChB,WAAQ,CAAC,oBAAoBA,MAAK,OAAS,oBAAoBA,MAAK,KAAM;AACtE,YAAMA,KAAI;AACV,MAAAA,MAAK4B;IACR;EACJ,SAAQ;AACZ;AAqBD,IAAa,iBAAiB,SAAUA,YAAW,MAAM,YAAY,OAAO,QAAQ,GAAG,MAAM,GAAG;AAC5F,cAAY,WAAWA,WAAU,cAAc,UAAU,GAAG,WAAW,OAAO,cAAc,OAAO,GAAG,WAAW,KAAK,cAAc,KAAK,CAAC;AAC1I,SAAO,aAAaA,WAAU,OAAO,KAAK,SAAA;AAC7C;ACxFD,SAAgBC,OAAMhC,IAAGC,IAAG,SAAS;AACjC,cAAY,YAAYD,IAAG,YAAY,eAAe,CAAC;AACvD,QAAM,KAAM,OAAOC,OAAM,YAAaA,KAAK,WAAW;AACtD,MAAI;AACJ,MAAID,OAAM,EACN,WAAU,KAAK;OAEd;AACD,UAAMwB,KAAI,KAAK,IAAI,IAAIxB,EAAA;AACvB,QAAI,GACA,WAAU,CAACG,OAAM,KAAK,KAAKA,KAAIqB,EAAA,IAAKA;QAGpC,WAAU,CAACrB,OAAM,KAAK,MAAMA,KAAIqB,EAAA,IAAKA;EAE5C;AACD,MAAI,OAAOvB,OAAM,SACb,QAAO,QAAQA,EAAA;AACnB,SAAO;AACV;ACbD,SAAgB,SAAS,cAAc,WAAWE,IAAG;AACjD,cAAY,WAAW,cAAc,cAAc,cAAc,CAAC;AAElE,QAAM,QAAQ,KAAK,MAAM,eAAe,GAAA;AACxC,QAAM8B,QAAO,CAAC,MAAMvC,WAAU;AAC1B,QAAI;AACA,UAAI,OAAOA,WAAU,SACjB,QAAO;AACX,UAAI,OAAO,MAAMA,MAAA,EACb,QAAO;AACX,UAAI,CAAC,OAAO,SAASA,MAAA,EACjB,QAAO;AAEX,YAAM,OAAO,KAAK,IAAIA,SAAQ,IAAA;AAC9B,YAAMwC,YAAW,SAAS,IAAI,KAAK,MAAM,OAAO,GAAA,IAAO,KAAK,MAAO,OAAO,OAAQ,GAAA;AAElF,aAAOA,aAAY;IACtB,QACK;AACF,aAAO;IACV;EACJ;AACD,MAAI,cAAc,OACd,QAAOD;AACX,cAAY,WAAW,WAAW,IAAI,WAAW,CAAC;AAClD,MAAI9B,OAAM,OACN,QAAO,CAACT,WAAUuC,MAAK,WAAWvC,MAAA;MAGlC,QAAOuC,MAAK,WAAW9B,EAAA;AAE9B;AAyBD,IAAa,eAAe,CAAC,yBAAyB,YAAY;AAC9D,QAAM,aAAa,QAAQ,IAAI,CAAAW,OAAKA,KAAI,oBAAA;AACxC,QAAM,aAAa,QAAQ,IAAI,CAAAA,OAAKA,KAAI,oBAAA;AACxC,SAAO,IAAIG,YAAW;AAClB,eAAWd,MAAKc,QACZ,UAAS,QAAQ,GAAG,QAAQ,QAAQ,QAAQ,QACxC,KAAId,MAAK,WAAW,KAAA,KAAUA,MAAK,WAAW,KAAA,EAC1C,QAAO;AAGnB,WAAO;EACV;AACJ;;;;;;;;;;;AClED,IAAa,YAAY,CAAC,yBAAyB,MAAM;AACrD,MAAI,OAAO,2BAA2B,YAClC,OAAM,IAAI,MAAM,0BAA0B;AAC9C,QAAM,gBAAiB,OAAO,2BAA2B,WAAY,yBAAyB,uBAAuB;AACrH,MAAI,gBAAgB,EAChB,OAAM,IAAI,MAAM,qCAAqC;AACzD,MAAI,gBAAgB,GAChB,OAAM,IAAI,MAAM,uCAAuC;AAC3D,MAAI,OAAO,MAAM,aAAA,EACb,OAAM,IAAI,MAAM,oBAAoB;AACxC,QAAMA,KAAI;AACV,SAAO;IACH,CAAC,OAAO,WAAA,EAAa,MAAM;AACvB,UAAI,SAAS,SACT,QAAOA;eACF,SAAS,SACd,QAAOA,GAAE,SAAA;AACb,aAAO;IACV;IACD,OAAOA;IACP,YAAY,CAAC,QAAQ;AACjB,aAAO,UAAU,WAAWA,IAAG,GAAA,CAAI;IACtC;IACD,KAAK,CAAC,QAAQ;AACV,aAAO,UAAUgC,QAAMhC,KAAI,GAAA,CAAI;IAClC;IACD,UAAU,CAAC,QAAQ;AACf,aAAO,UAAUgC,QAAMhC,KAAI,GAAA,CAAI;IAClC;IACD,SAAS,MAAM;AACX,aAAO,UAAU,CAACA,EAAA;IACrB;IACD,aAAa,CAAC,KAAKF,OAAM;AACrB,aAAO,UAAUkC,QAAM,YAAY,KAAKhC,IAAGF,EAAA,CAAE,CAAC;IACjD;IACD,UAAU,CAAC0B,SAAM,GAAGD,SAAM,MAAM;AAC5B,aAAO,SAASvB,IAAGwB,QAAKD,MAAAA;IAC3B;EACJ;AACJ;AAqBD,IAAa,WAAW,CAAC,cAAcC,SAAM,GAAGD,SAAM,MAAM;AACxD,MAAI,OAAO,iBAAiB,SACxB,OAAM,IAAI,MAAM,mCAAmC,OAAO,YAAA,EAAc;AAC5E,MAAI,OAAO,MAAM,YAAA,EACb,OAAM,IAAI,MAAM,kBAAkB;AACtC,SAAOU,MAAY,cAAc,IAAI,GAAGV,QAAKC,MAAAA;AAChD;AAgBD,IAAa,aAAa,CAAC,gBAAgB;AACvC,cAAY,WAAW,aAAa,cAAc,GAAG,CAAC;AACtD,SAAQ,cAAc,IAAK;AAC9B;AAgBD,IAAaU,UAAQ,CAAC,YAAY,OAAO,UAAU;AAC/C,SAAOF,QAAMG,OAAa,OAAO,OAAO,IAAI,CAAA,EAAG,UAAA,CAAW;AAC7D;AAgBD,IAAa,iBAAiB,CAAC,YAAY,OAAO,UAAU;AACxD,SAAOA,OAAa,OAAO,OAAO,IAAI,CAAA,EAAG,UAAA;AAC5C;AAYD,IAAaH,UAAQ,CAAC,iBAAiB;AACnC,MAAI,OAAO,iBAAiB,SACxB,OAAM,IAAI,MAAM,+CAA+C,OAAO,YAAA,EAAc;AACxF,MAAI,OAAO,MAAM,YAAA,EACb,OAAM,IAAI,MAAM,6BAA6B;AACjD,MAAI,eAAe,EACf,QAAO;AACX,MAAI,eAAe,GACf,QAAO;AACX,SAAO;AACV;AAmBD,IAAa,aAAa,CAAC,cAAc,WAAW;AAChD,MAAI,OAAO,iBAAiB,SACxB,OAAM,IAAI,MAAM,wCAAwC,OAAO,YAAA,EAAc;AACjF,MAAI,OAAO,WAAW,SAClB,OAAM,IAAI,MAAM,0CAA0C,OAAO,MAAA,EAAQ;AAC7E,MAAI,SAAS,EACT,OAAM,IAAI,MAAM,kCAAkC;AACtD,MAAI,eAAe,GAAG;AAClB,oBAAgB;AAChB,QAAI,eAAe,EACf,gBAAe;EACtB,WACQ,eAAe,GAAG;AACvB,oBAAgB;AAChB,QAAI,eAAe,EACf,gBAAe;EACtB;AACD,SAAO;AACV;AClKD,IAAa,cAAc,CAAChC,IAAGuB,SAAM,GAAGC,SAAM,QAAQ;AAClD,cAAY,YAAYxB,IAAG,QAAW,GAAG,GAAG,YAAYuB,QAAK,QAAW,KAAK,GAAG,YAAYC,QAAK,QAAW,KAAK,CAAC;AAClH,MAAIxB,OAAMuB,OACN,QAAOA;AACX,MAAIvB,OAAMwB,OACN,QAAOD;AACX,MAAIvB,KAAI,KAAKA,KAAIuB,OACb,CAAAvB,MAAKuB;AACT,EAAAvB,MAAKuB;AACLC,EAAAA,UAAOD;AACP,EAAAvB,KAAIA,KAAIwB;AACR,MAAIxB,KAAI,EACJ,CAAAA,KAAIwB,SAAM,KAAK,IAAIxB,EAAA,IAAKuB;AAC5B,SAAOvB,KAAIuB;AACd;AAwBD,IAAaa,QAAO,CAACpC,IAAGuB,SAAM,GAAGC,SAAM,MAAM;AACzC,cAAY,WAAWxB,IAAG,IAAI,KAAK,GAAG,WAAWuB,QAAK,IAAI,KAAK,GAAG,WAAWC,QAAK,IAAI,KAAK,CAAC;AAC5F,MAAIxB,OAAMuB,OACN,QAAOA;AACX,MAAIvB,OAAMwB,OACN,QAAOD;AACX,SAAOvB,MAAKuB,UAAOvB,MAAKwB,QAAK;AACzB,QAAIxB,OAAMwB,OACN;AACJ,QAAIxB,OAAMuB,OACN;AACJ,QAAIvB,KAAIwB,OACJ,CAAAxB,KAAIuB,UAAOvB,KAAIwB;aAEVxB,KAAIuB,OACT,CAAAvB,KAAIwB,UAAOD,SAAMvB;EAExB;AACD,SAAOA;AACV;AA0BD,IAAa,YAAY,CAACuB,QAAKC,QAAKjB,KAAIV,IAAGC,OAAM;AAC7C,MAAIO,KAAI;AACR,QAAM,QAAQ,KAAK,IAAIP,KAAID,EAAA;AAE3B,QAAM,YAAY,KAAK,IAAI2B,SAAM3B,KAAIC,EAAA;AAErC,QAAM,YAAY,KAAK,IAAID,MAAK,MAAMC,GAAA;AACtC,QAAM,UAAU,KAAK,IAAI,OAAO,WAAW,SAAA;AAC3C,MAAI,YAAY,UAEZ,CAAAO,KAAIR,KAAIU,IAAG,OAAA;WAEN,YAAY,UAEjB,CAAAF,KAAIR,KAAIU,IAAG,OAAA;WAIPV,KAAIC,GAEJ,CAAAO,KAAIR,KAAIU,IAAG,OAAA;MAIX,CAAAF,KAAIR,KAAIU,IAAG,OAAA;AAGnB,SAAO,YAAYF,IAAGkB,QAAKC,MAAAA;AAC9B;AC5JD,IAAa,OAAO,KAAK,KAAK;ACiC9B,SAAgB,YAAY,MAAM,MAAM,MAAM,MAAM;AAChD,MAAI;AACJ,MAAI,SAAS;AACb,QAAM,eAAe,CAAC,WAAW;AAC7B,QAAI,cACA,UAAS,cAAc,MAAA;AAC3B,QAAI,WAAW,UAAa,WAAW,QACnC,UAAS,MAAM,MAAA;aAEV,WAAW,QAChB;UAAI,SAAS,EACT,UAAS,SAAS;eACb,SAAS,EACd,UAAS,IAAK,SAAS;IAC1B;AAEL,WAAO;EACV;AACD,QAAM,YAAY,CAAC,MAAMa,KAAI,OAAO;AAChC,gBAAY,WAAWA,KAAI,IAAI,GAAG,GAAG,WAAW,IAAI,IAAI,GAAG,GAAG,WAAW,MAAM,IAAI,QAAQ,CAAC;AAC5F,WAAO,aAAa,IAAA;AACpB,YAAQ,IAAI,QAAQA,MAAK,OAAO;EACnC;AACD,QAAM,WAAW,CAACjB,KAAI,CAAE,MAAK;AACzB,QAAIA,GAAE,WAAW;AACb,UAAI,OAAOA,GAAE,cAAc,WACvB,OAAM,IAAI,MAAM,wDAAwD,OAAOA,GAAE,SAAA,EAAW;AAChG,sBAAgBA,GAAE;IACrB;AACD,aAASA,GAAE,UAAU;EACxB;AACD,QAAM,UAAU,CAAC,MAAMiB,KAAI,QAAQ,IAAI,QAAQA,MAAK,OAAO;AAC3D,MAAI,OAAO,SAAS,SAChB,OAAM,IAAI,UAAU,gDAAgD,OAAO,IAAA,EAAM;AACrF,MAAI,OAAO,SAAS,UAAU;AAC1B,QAAIxC;AACJ,QAAIC;AACJ,QAAI,SAAS,UAAa,OAAO,SAAS,UAAU;AAEhD,MAAAD,KAAI;AACJ,MAAAC,KAAI;AACJ,eAAS,IAAA;AACT,aAAO,CAAC,WAAW,UAAU,QAAQD,IAAGC,EAAA;IAC3C,WACQ,OAAO,SAAS,UAAU;AAE/B,MAAAD,KAAI;AACJ,MAAAC,KAAI;AACJ,eAAS,IAAA;AACT,aAAO,UAAU,MAAMD,IAAGC,EAAA;IAC7B,MAEG,OAAM,IAAI,MAAM,oCAAoC;EAE3D,WACQ,SAAS,UAAa,OAAO,SAAS,UAAU;AAErD,UAAM,SAAS,aAAa,IAAA;AAC5B,aAAS,IAAA;AACT,gBAAY,WAAW,QAAQ,IAAI,QAAQ,CAAC;AAC5C,WAAO,CAAC,QAAQ,WAAW,QAAQ,QAAQ,QAAQ,MAAA;EACtD;AACJ;AAqCD,IAAa,sBAAsB,CAAC,iBAAiBD,KAAI,GAAGC,KAAI,GAAG,uBAAuB,GAAG,YAAY;AACrG,MAAI,SAAS;AACb,SAAO,CAAC,WAAW,cAAc;AAC7B,QAAI,cAAc,OACd,CAAAA,KAAI;AACR,QAAI,cAAc,OACd,CAAAD,KAAI;AACR,QAAI,UAAU,EACV,QAAOC;AACX,UAAMP,SAAQ,YAAY,QAAQM,IAAGC,IAAG,OAAA;AACxC,cAAU;AACV,WAAOP;EACV;AACJ;AAYD,IAAa,mBAAmB,CAAC,QAAQ,UAAU,UAAU,YAAY;AACrE,QAAMoB,KAAIyB,MAAK,WAAW,UAAU,GAAG,IAAA;AACvC,SAAO,YAAY,QAAQ,UAAU,YAAYzB,KAAI,KAAK,KAAKA,KAAI,OAAOA,KAAI,OAAA;AACjF;AC1ID,UAAiB,YAAY,OAAO,KAAK,OAAO,WAAW;AACvD,cAAY,WAAW,OAAO,IAAI,OAAO,GAAG,WAAW,KAAK,IAAI,KAAK,GAAG,WAAW,OAAO,IAAI,OAAO,CAAC;AACtG,QAAMN,KAAI,YAAYwB,OAAM,SAAA,IAAa,CAAC7B,OAAMA;AAChD,QAAM,QAAQ,MAAM,UAAU,QAAQ;AACtC,cAAY,WAAW,MAAM,IAAI,MAAM,CAAC;AACxC,MAAI,CAAC,OAAO,SAAS,IAAA,EACjB,OAAM,IAAI,UAAU,mCAAmC;AAE3D,WAAS,QAAQ,GAAG,QAAQ,OAAO,SAAS;AACxC,UAAMA,KAAI,QAAQ,OAAO;AACzB,UAAMK,GAAEL,EAAA;EACX;AACJ;AClCD,IAAa,oBAAb,MAA+B;EAC3B,SAAS,CAAE;EACX,QAAQ,MAAM;AACV,SAAKsC,OAAO,KAAK,IAAA;EACpB;EACD,UAAU;AACN,WAAO,KAAKA,OAAO,MAAA;EACtB;EACD,IAAI,OAAO;AACP,WAAO,KAAKA;EACf;EACD,IAAI,OAAO;AACP,WAAO,KAAKA,OAAO;EACtB;AACJ;ACVD,IAAMC,QAAO,KAAK,KAAK;AAuBvB,IAAa,qBAAqB,CAAC,UAAU,MAAM;AAC/C,cAAY,WAAW,SAAS,aAAa,SAAS,CAAC;AACvD,MAAIjB,aAAU;AACd,MAAIkB,UAAQ;AACZ,SAAO,CAACxC,OAAM;AACV,UAAMK,KAAI,WAAWL,IAAG,IAAI,GAAG;AAC/B,QAAIK,GAAE,WAAWL,OAAM,QAAW;AAE9BwC;AACAlB,MAAAA,aAAUA,cAAWtB,KAAIsB,cAAW,KAAK,IAAIkB,SAAO,OAAA;IACvD;AACD,WAAOlB;EACV;AACJ;AAqCD,IAAa,gBAAgB,CAAC,UAAU,KAAK,aAAa;AACtD,QAAMmB,KAAI,IAAI,kBAAA;AACd,SAAO,CAACzC,OAAM;AACV,UAAMK,KAAI,WAAWL,EAAA;AACrB,QAAIK,GAAE,WAAWL,OAAM,QAAW;AAC9B,MAAAyC,GAAE,QAAQzC,EAAA;AACV,aAAOyC,GAAE,OAAO,QACZ,CAAAA,GAAE,QAAA;IAET;AACD,WAAO,aAAa,SAAYnB,SAAQmB,GAAE,IAAA,IAAQ,gBAAgBA,GAAE,MAAM,QAAA;EAC7E;AACJ;AAuCD,IAAM,kBAAkB,CAAC,WAAW,WAAW;AAC3C,QAAMpC,KAAIkC,QAAO,SAAS;AAC1B,SAAOlC,MAAKA,KAAI;AACnB;AACD,IAAM,uBAAuB,CAACqC,mBAAiBnD,QAAO,aAAa;AAC/D,SAAOmD,oBAAkBnD,UAAS,IAAImD,qBAAmB;AAC5D;AAWD,IAAa,cAAc,CAAC,YAAY,GAAG,mBAAmB,GAAG,gBAAgB,MAAM;AACnF,MAAI,gBAAgB;AACpB,MAAI,iBAAiB;AACrB,MAAI,gBAAgB;AACpB,QAAM,UAAU,CAACnD,QAAOoD,eAAc;AAClC,IAAAA,eAAc,YAAY,IAAA;AAC1B,UAAM,YAAYA,aAAY;AAE9B,UAAMC,KAAI,gBAAgB,WAAW,aAAA;AACrC,UAAM,cAAcrD,SAAQ,iBAAiB;AAC7C,UAAM,aAAa,qBAAqBqD,IAAG,YAAY,cAAA;AAEvD,UAAM,SAAS,YAAY,mBAAmB,KAAK,IAAI,UAAA;AACvD,UAAM/C,KAAI,gBAAgB,WAAW,MAAA;AACrC,UAAM,WAAW,qBAAqBA,IAAGN,QAAO,aAAA;AAChD,oBAAgB;AAChB,qBAAiB;AACjB,oBAAgBoD;AAChB,WAAO;EACV;AACD,SAAO;AACV;ACjID,IAAa,QAAQ,CAAC3C,IAAG,OAAO,OAAO,QAAQ,QAAQ,WAAW,OAAO,OAAO,OAAO,QAAQ,QAAQ,MAAA,EAAQA,EAAA;AAW/G,IAAa,SAAS,CAAC,OAAO,OAAO,QAAQ,QAAQ,QAAQ,YAAY;AACrE,cAAY,WAAW,OAAO,UAAU,OAAO,GAAG,WAAW,OAAO,UAAU,OAAO,CAAC;AACtF,QAAM,OAAO,UAAU;AACvB,QAAM,OAAO,UAAU;AACvB,QAAM,gBAAgB,UAAU,QAAQ,QAAQ,MAAA,IAAU;AAC1D,SAAO,CAACA,OAAM;AACV,QAAI,UAAU,MACV,QAAO;AACX,QAAIH,MAAKG,KAAI,UAAU,QAAQ;AAC/B,QAAI,WAAW,OACX,CAAAH,KAAI,OAAOA,EAAA;AACf,UAAMI,KAAIJ,MAAK,OAAO,QAAQ;AAC9B,QAAI,cACA,QAAO,cAAcI,EAAA;AACzB,WAAOA;EACV;AACJ;AAKD,IAAa,aAAa,MAAM,CAACD,OAAMA;AAavC,IAAa,eAAe,CAACA,IAAG,OAAO,OAAO,QAAQ,QAAQ,WAAW;AACrE,MAAI,OAAO,WAAW,YAClB,UAAS;AACb,MAAI,OAAO,WAAW,YAClB,UAAS;AACb,MAAI,UAAU,MACV,QAAO;AACX,QAAMC,KAAI,MAAMD,IAAG,OAAO,OAAO,QAAQ,QAAQ,MAAA;AACjD,SAAO,MAAMC,IAAG,QAAQ,MAAA;AAC3B;AA0BD,IAAa,mBAAmB,CAAC,YAAY,QAAQ,SAAS,MAAM;AAChE,cAAY,WAAW,YAAY,cAAc,GAAG,GAAG,WAAW,QAAQ,cAAc,QAAQ,GAAG,WAAW,QAAQ,cAAc,QAAQ,CAAC;AAC7I,SAAO,MAAM,YAAY,GAAG,GAAG,QAAQ,MAAA;AAC1C;AAcD,IAAa,eAAe,CAACD,IAAG,QAAQ,WAAW,cAAc,QAAQ,MAAA,EAAQA,EAAA;AAQjF,IAAa,gBAAgB,CAAC,QAAQ,WAAW;AAC7C,SAAO,CAACA,OAAM;AACV,gBAAY,WAAWA,IAAG,cAAc,GAAG,CAAC;AAC5C,WAAO,MAAMA,IAAG,GAAG,GAAG,QAAQ,MAAA;EACjC;AACJ;AAmBD,IAAa,eAAe,CAAC,OAAO,OAAO,SAAS,GAAG,SAAS,GAAG,UAAU,OAAO,WAAW;AAC3F,QAAM,QAAQ,OAAO,OAAO,OAAO,QAAQ,QAAQ,QAAQ,OAAA;AAC3D,QAAM,OAAO,OAAO,QAAQ,QAAQ,OAAO,OAAO,QAAQ,OAAA;AAC1D,SAAO;IAAE,KAAK;IAAO,IAAI;EAAM;AAClC;ACjKD,IAAa,qBAAqB,CAAC,MAAM,OAAO,CAAE,MAAK;AACnD,MAAI,KAAK,WAAW,EAChB,QAAO;IACH,OAAO;IACP,KAAK;IACL,KAAK;IACL,KAAK;IACL,OAAO;EACV;AAEL,QAAM,aAAa,KAAK,cAAc;AACtC,MAAIkB,UAAQ;AACZ,MAAIK,SAAM,OAAO;AACjB,MAAIC,SAAM,OAAO;AACjB,MAAIgB,UAAQ;AACZ,WAAS,QAAQ,GAAG,QAAQ,KAAK,QAAQ,SAAS;AAC9C,QAAIjD,SAAQ,KAAK,KAAA;AACjB,QAAI,OAAOA,WAAU,UAAU;AAC3B,UAAI,eAAe,SACf;AACJ,UAAI,eAAe,QACf,OAAM,IAAI,MAAM,gDAAgD,MAAM,SAAA,CAAU,EAAE;AACtF,UAAI,eAAe,MACf,CAAAA,SAAQ;IACf;AACD,QAAI,OAAO,MAAMA,MAAA,EACb;AACJ,QAAIA,WAAU,QAAW;AACrBgC,MAAAA,SAAM,KAAK,IAAIA,QAAKhC,MAAA;AACpBiC,MAAAA,SAAM,KAAK,IAAIA,QAAKjC,MAAA;AACpB2B,iBAAS3B;AACTiD;IACH;EACJ;AACD,SAAO;IACH,OAAA;IAAO,KAAAK;IAAK,KAAAC;IAAK,OAAA;IACjB,KAAK5B,UAAQsB;EAChB;AACJ;;;;;;;;ACtBD,IAAa,oBAAoB,CAAC,YAAY,eAAe;AACzD,MAAIjB,SAAM,cAAc,OAAO;AAC/B,MAAIC,SAAM,cAAc,OAAO;AAC/B,cAAY,WAAWD,MAAAA,GAAM,WAAWC,MAAAA,CAAI;AAC5C,SAAO;IACH,MAAM,CAACxB,OAAM;AACT,kBAAY,WAAWA,EAAA,CAAE;AACzBuB,MAAAA,SAAM,KAAK,IAAIA,QAAKvB,EAAA;AACpBwB,MAAAA,SAAM,KAAK,IAAIA,QAAKxB,EAAA;AACpB,aAAO,MAAMA,IAAGuB,QAAKC,MAAAA;IACxB;IACD,OAAO,CAACuB,cAAYC,iBAAe;AAC/BzB,MAAAA,SAAMwB,gBAAc,OAAO;AAC3BvB,MAAAA,SAAMwB,gBAAc,OAAO;IAC9B;IACD,IAAI,MAAM;AACN,aAAOzB;IACV;IACD,IAAI,MAAM;AACN,aAAOC;IACV;IACD,IAAI,QAAQ;AACR,aAAO,KAAK,IAAIA,SAAMD,MAAAA;IACzB;EACJ;AACJ;AAqCD,IAAa,SAAS,CAAC,YAAY,eAAe;AAC9C,QAAM0B,KAAI,kBAAkB,YAAY,UAAA;AACxC,SAAOA,GAAE;AACZ;AAgBD,IAAa,mBAAmB,CAACnC,SAAQ,WAAW,cAAc;AAC9D,MAAI,CAAC,MAAM,QAAQA,OAAA,EACf,OAAM,IAAI,UAAU,2CAA2C,OAAOA,OAAA,EAAQ;AAElF,QAAM,MAAM,mBAAmBA,OAAA;AAC/B,QAAMS,SAAM,aAAa,IAAI;AAC7B,QAAMC,SAAM,aAAa,IAAI;AAC7B,SAAO;IACH,QAAQV,QAAO,IAAI,CAACd,OAAM,MAAM,MAAMA,IAAGuB,QAAKC,MAAAA,CAAI,CAAC;IACnD,UAAUV;IACV,KAAAgC;IAAK,KAAAD;IACL,OAAO,KAAK,IAAIrB,SAAMD,MAAAA;EACzB;AACJ;AA4BD,IAAa,QAAQ,CAACT,SAAQ,WAAW,cAAc;AACnD,QAAMmC,KAAI,iBAAiBnC,SAAQ,WAAW,SAAA;AAC9C,SAAOmC,GAAE;AACZ;ACzID,IAAa,aAAa,CAACjD,IAAGW,OAAM;AAChC,MAAI,OAAOX,OAAM,WACb,CAAAA,KAAIA,GAAA;AACR,MAAI,OAAOW,OAAM,WACb,CAAAA,KAAIA,GAAA;AACR,cAAY,WAAWX,IAAG,cAAc,GAAG,GAAG,WAAWW,IAAG,cAAc,GAAG,CAAC;AAC9E,SAAOX,KAAIW;AACd;ACGD,IAAa,gBAAgB,CAACX,IAAGkD,QAAO,iBAAiB,SAAS;AAC9D,QAAM,cAAcA,OAAM,SAAA;AAC1B,QAAM,UAAU,YAAY,QAAQ,GAAG;AACvC,MAAI,aAAa;AACjB,MAAI,WAAW,GAAG;AACd,UAAM/C,KAAI,YAAY,UAAU,UAAU,CAAA,EAAG;AAC7C,iBAAa,KAAKA;AAClB,IAAA+C,SAAQ,KAAK,MAAM,aAAaA,MAAA;AAChC,IAAAlD,KAAIA,KAAI;EACX;AACD,cAAY,WAAWA,IAAG,IAAI,GAAG,GAAG,YAAYkD,QAAO,IAAI,OAAO,CAAC;AACnE,MAAI,MAAMlD,KAAIkD;AACd,QAAM,YAAY,MAAM;AACxB,QAAM,KAAK,MAAM,GAAA;AACjB,MAAK,cAAc,OAAO,kBAAmB,YAAY,IACrD;AACJ,QAAM,KAAMA,SAAQ,MAAO;AAC3B,SAAO;AACV;AC7BD,SAAgB,gBAAgB3D,QAAO,UAAU,oBAAoB,QAAQ;AACzE,MAAI,OAAOA,WAAU,UAAU;AAC3B,QAAI,OAAO,MAAMA,MAAA,KAAU,CAAC,OAAO,SAASA,MAAA,GAAQ;AAChD,UAAI,sBAAsB,QACtB,OAAM,IAAI,UAAU,2EAA2E;AACnG,aAAO;IACV;AAED,QAAIA,UAAS,SAAS,OAAOA,UAAS,SAAS,IAC3C,QAAO;AAEX,WAAO;MACH,KAAK,KAAK,IAAIA,QAAO,SAAS,GAAA;MAC9B,KAAK,KAAK,IAAIA,QAAO,SAAS,GAAA;IACjC;EACJ,WACQ,sBAAsB,QAC3B,OAAM,IAAI,UAAU,yCAAyC,OAAOA,MAAA,4CAAiD;AAEzH,SAAO;AACV;AAeD,SAAgB,YAAY,OAAO,SAAS,GAAG,SAAS,GAAG,QAAQ,UAAU,MAAM;AAC/E,SAAO,OAAO,MAAM,KAAK,MAAM,KAAK,QAAQ,QAAQ,QAAQ,OAAA;AAC/D;AAQD,SAAgB,gBAAgB,UAAU,eAAe;AACrD,MAAI,SAAS,OAAO,cAAc,OAAO,SAAS,OAAO,cAAc,IACnE,QAAO;AACX,SAAO;IACH,KAAK,KAAK,IAAI,SAAS,KAAK,cAAc,GAAA;IAC1C,KAAK,KAAK,IAAI,SAAS,KAAK,cAAc,GAAA;EAC7C;AACJ;AAWD,IAAa,YAAY,OAAO;EAAE,KAAK,OAAO;EAAkB,KAAK,OAAO;AAAkB;AAQ9F,IAAa,eAAe,CAACM,IAAGC,OAAM;AAClC,MAAI,OAAOD,OAAM,YACb,QAAO;AACX,MAAI,OAAOC,OAAM,YACb,QAAO;AACX,SAAQD,GAAE,QAAQC,GAAE,OAAOD,GAAE,QAAQC,GAAE;AAC1C;AAQD,IAAa,gBAAgB,CAACD,IAAGC,OAAM;AACnC,MAAI,OAAOD,OAAM,YACb,QAAO;AACX,MAAI,OAAOC,OAAM,YACb,QAAO;AACX,MAAID,GAAE,OAAOC,GAAE,OAAOD,GAAE,OAAOC,GAAE,IAC7B,QAAO;AACX,SAAO;AACV;AAoBD,IAAa,cAAc,CAAC,WAAW,UAAA,MAAgB;AACnD,MAAI,EAAE,KAAAgD,QAAK,KAAAD,OAAA,IAAQ;AACnB,QAAM,OAAO,CAAC7C,OAAM;AAChB,QAAI,OAAOA,OAAM,UACb;UAAI,CAAC,OAAO,MAAMA,EAAA,KAAM,OAAO,SAASA,EAAA,GAAI;AACxCuB,QAAAA,SAAM,KAAK,IAAIA,QAAKvB,EAAA;AACpBwB,QAAAA,SAAM,KAAK,IAAIA,QAAKxB,EAAA;MACvB;;AAEL,WAAO;MAAE,KAAA8C;MAAK,KAAAD;IAAK;EACtB;AACD,QAAMM,SAAQ,MAAM;AAChB5B,IAAAA,SAAM,OAAO;AACbC,IAAAA,SAAM,OAAO;EAChB;AACD,SAAO;IACH;IAAM,OAAA2B;IACN,IAAI,QAAQ;AACR,aAAO;QAAE,KAAAL;QAAK,KAAAD;MAAK;IACtB;IACD,IAAI,MAAM;AACN,aAAOtB;IACV;IACD,IAAI,MAAM;AACN,aAAOC;IACV;EACJ;AACJ;AAQD,SAAgB,aAAaV,SAAQ,oBAAoB,QAAQ;AAC7D,MAAIS,SAAM,OAAO;AACjB,MAAIC,SAAM,OAAO;AACjB,MAAI,WAAW;AACf,aAAWxB,MAAKc,SAAQ;AACpB,QAAI,OAAOd,OAAM,UACb;UAAI,OAAO,MAAMA,EAAA,KAAM,CAAC,OAAO,SAASA,EAAA,GAAI;AACxC,YAAI,sBAAsB,QACtB,OAAM,IAAI,MAAM,sCAAsC,QAAA,EAAU;AACpE;MACH;WAEA;AACD,UAAI,sBAAsB,QACtB,OAAM,IAAI,MAAM,qCAAqC,OAAOA,EAAA,eAAgB,QAAA,EAAU;AAC1F;IACH;AACD,QAAIA,KAAIuB,OACJA,CAAAA,SAAMvB;AACV,QAAIA,KAAIwB,OACJA,CAAAA,SAAMxB;AACV;EACH;AACD,SAAO;IAAE,KAAA8C;IAAK,KAAAD;EAAK;AACtB;ACnLD,IAAa,UAAU,CAAC,WAAW;AAC/B,QAAM,WAAW,OAAO,OAAO,CAAChD,IAAGC,OAAM,KAAK,IAAID,IAAGC,EAAA,GAAI,OAAO,iBAAA;AAChE,QAAM,SAAS,OAAO,IAAI,CAACsD,OAAM,KAAK,IAAIA,KAAI,QAAA,CAAS;AACvD,QAAM,QAAQ,OAAO,OAAO,CAACvD,IAAGC,OAAMD,KAAIC,EAAA;AAC1C,SAAO,OAAO,IAAI,CAAC8C,OAAMA,KAAI,KAAA;AAChC;ACVD,IAAa,cAAc,MAAM;AAC7B,MAAIJ,UAAQ;AACZ,MAAIjB,SAAM,OAAO;AACjB,MAAIC,SAAM,OAAO;AACjB,MAAIN,UAAQ;AACZ,QAAM,OAAO,CAAClB,OAAM;AAChBuB,IAAAA,SAAM,KAAK,IAAIvB,IAAGuB,MAAAA;AAClBC,IAAAA,SAAM,KAAK,IAAIxB,IAAGwB,MAAAA;AAClBN,eAASlB;AACTwC;EACH;AACD,QAAMW,SAAQ,MAAM;AAChBX,cAAQ;AACRjB,IAAAA,SAAM,OAAO;AACbC,IAAAA,SAAM,OAAO;AACbN,cAAQ;EACX;AACD,QAAM,gBAAgB,CAAC,SAAS,MAAM;AAClC,WAAO,GAAGK,OAAI,QAAQ,CAAA,CAAE,MAAMC,OAAI,QAAQ,CAAA,CAAE;EAC/C;AACD,SAAO;IACH;IAAM,OAAA2B;IAAO;IACb,IAAI,MAAM;AACN,aAAOjC,UAAQsB;IAClB;IACD,IAAI,MAAM;AACN,aAAOjB;IACV;IACD,IAAI,MAAM;AACN,aAAOC;IACV;IACD,IAAI,QAAQ;AACR,aAAON;IACV;IACD,IAAI,QAAQ;AACR,aAAOsB;IACV;EACJ;AACJ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AEhCD,IAAa,eAAe,CAACa,OAAM;AAC/B,SAAO,OAAOA,OAAM,WAAWA,KAAI,KAAK,UAAUA,EAAA;AACrD;ACgID,IAAa,aAAa,CAAC,QAAQ,YAAY,OAAO;AAClD,cAAY,YAAY,WAAW,aAAa,WAAW,CAAC;AAC5D,MAAI,OAAO,WAAW,SAClB,OAAM,IAAI,MAAM,oCAAoC;AACxD,MAAI,OAAO,SAAS,aAAa,OAAO,SAAS,GAAG;AAChD,QAAI,YAAY,IAAI;AAChB,YAAMC,UAAQ,KAAK,OAAO,YAAY,KAAK,CAAA;AAC3C,aAAO,OAAO,MAAM,GAAGA,OAAAA,IAAS,QAAQ,OAAO,MAAM,CAACA,OAAAA;IACzD;AACD,WAAO,OAAO,MAAM,GAAG,SAAA,IAAa;EACvC;AACD,SAAO;AACV;AAOD,IAAa,qBAAqB,CAAC,QAAQ,YAAY,OAAO;AAC1D,MAAI,WAAW,OACX,QAAO;AACX,MAAI,WAAW,KACX,QAAO;AACX,SAAO,WAAW,KAAK,UAAU,MAAA,GAAS,SAAA;AAC7C;AAgLD,IAAa,aAAa,CAAC,QAAQ,OAAO,UAAU,CAAE,MAAK;AACvD,QAAMC,MAAK,iBAAiB,QAAQ,OAAO,OAAA;AAC3C,SAAOA,IAAG,CAAA;AACb;AAYD,IAAa,mBAAmB,CAAC,QAAQ,OAAO,UAAU,CAAE,MAAK;AAC7D,MAAI,WAAW,OACX,OAAM,IAAI,MAAM,6BAA6B;AACjD,MAAI,WAAW,QAAQ;AACvB,QAAM,YAAY,QAAQ,cAAc,WAAW,aAAa;AAChE,MAAI,cAAc,WACd,YAAW;AACf,MAAI,cAAc,cAAc,aAAa,OACzC,OAAM,IAAI,MAAM,2BAA2B;AAC/C,QAAM,WAAW,QAAQ,YAAY;AACrC,QAAM,UAAU,QAAQ,WAAW;AACnC,QAAMC,KAAI,UACJ,OAAO,YAAY,OAAO,QAAA,IAC1B,OAAO,QAAQ,OAAO,QAAA;AAC5B,MAAIA,KAAI,KAAK,cAAc,QACvB,OAAM,IAAI,MAAM,UAAU,KAAA,wBAA6B;AAC3D,MAAIA,KAAI,KAAK,cAAc,WACvB,QAAO,CAAC,QAAQ,MAAO;AAC3B,MAAIA,KAAI,KAAK,cAAc,WAEvB,QAAO,CAAC,UAAU,QAAS;AAE/B,SAAO,CACH,OAAO,MAAM,GAAGA,EAAA,GAChB,OAAO,MAAM,KAAK,IAAI,GAAGA,KAAI,MAAM,MAAA,CAAO,CAC7C;AACJ;AC1XD,IAAa,kBAAkB,CAACC,OAAM;AAClC,MAAI,OAAOA,OAAM,SACb,QAAO;AACX,MAAIA,OAAM,KACN,QAAO;AACX,SAAO,OAAO,iBAAiBA;AAClC;AACD,IAAa,aAAa,CAACA,OAAM;AAC7B,MAAI,OAAOA,OAAM,SACb,QAAO;AACX,MAAIA,OAAM,KACN,QAAO;AACX,SAAO,OAAO,YAAYA;AAC7B;ACbD,UAAiBC,QAAMC,KAAI,QAAQ,GAAG,MAAM,OAAO,mBAAmB;AAClE,MAAI,MAAM,MACN,OAAM,IAAI,MAAM,yCAAyC;AAC7D,MAAI,QAAQ,EACR,OAAM,IAAI,MAAM,oCAAoC;AACxD,MAAI,QAAQ;AACZ,aAAWF,MAAKE,KAAI;AAChB,QAAI,QAAQ,OAAO;AACf;AACA;IACH;AACD,QAAI,QAAQ,IACR;AAEJ,UAAMF;AACN;EACH;AACJ;ACjBD,SAAgBG,SAAOD,KAAIE,IAAG,OAAO;AAEjC,aAAWJ,MAAKE,IACZ,SAAQE,GAAE,OAAOJ,EAAA;AACrB,SAAO;AACV;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACAD,UAAiBK,gBAAc,OAAOC,YAAW,iBAAiB,OAAO,oBAAI,IAAA,GAAO;AAChF,aAAWN,MAAK,OAAO;AACnB,UAAM,MAAMM,UAASN,EAAA;AACrB,QAAI,KAAK,IAAI,GAAA,EACT;AACJ,SAAK,IAAI,GAAA;AACT,UAAMA;EACT;AACJ;AAuBD,SAAgBO,aAAW,OAAO,UAAU,QAAQ;AAChD,aAAWC,UAAS,MAChB,UAASA,MAAA;AAEb,MAAI,OACA,QAAA;AACP;AAyBD,SAAgB,YAAY,WAAW,cAAc;AACjD,SAAO,MAAM;AACT,UAAMR,KAAI,UAAU,KAAA,EAAO;AAC3B,QAAIA,OAAM,OACN,QAAO;AACX,WAAOA;EACV;AACJ;AAOD,SAAgB,MAAME,KAAI;AACtB,aAAWM,UAASN,IAChB,QAAOM;AAEd;AAMD,SAAgBC,OAAKP,KAAI;AACrB,MAAI;AACJ,aAAWM,UAASN,IAChB,eAAcM;AAElB,SAAO;AACV;AAaD,UAAiB,kBAAkBN,KAAI,MAAM;AACzC,MAAI,QAAQ,EACR,OAAM,IAAI,MAAM,2BAA2B;AAE/C,MAAI,SAAS,CAAE;AACf,aAAWF,MAAKE,KAAI;AAEhB,WAAO,KAAKF,EAAA;AACZ,QAAI,OAAO,WAAW,MAAM;AACxB,YAAM;AAEN,eAAS,CAAC,OAAO,GAAG,EAAA,CAAI;IAC3B;EACJ;AACD,MAAI,OAAO,UAAU,EACjB;AACJ,MAAI,OAAO,SAAS,EAChB,OAAM;AACb;AACD,UAAiBU,SAAOR,KAAI,MAAM;AAE9B,MAAI,SAAS,CAAE;AACf,aAAWF,MAAKE,KAAI;AAEhB,WAAO,KAAKF,EAAA;AACZ,QAAI,OAAO,WAAW,MAAM;AACxB,YAAM;AACN,eAAS,CAAE;IACd;EACJ;AACD,MAAI,OAAO,SAAS,EAChB,OAAM;AACb;AACD,UAAiBW,YAAU,KAAK;AAC5B,aAAWT,OAAM,IACb,QAAOA;AACd;AACD,UAAiBU,YAAUV,KAAIE,IAAG;AAC9B,aAAWJ,MAAKE,IACZ,KAAI,CAACE,GAAEJ,EAAA,EACH,OAAMA;AAGjB;AAiBD,IAAaa,UAAQ,CAACX,KAAI,aAAa;AACnC,aAAWY,MAAKZ,KAAI;AAChB,UAAMM,SAAQ,SAAA;AACd,QAAI,OAAOA,WAAU,aAAa,CAACA,OAC/B;EACP;AACJ;AACD,IAAa,OAAO,CAACN,QAAO;AACxB,SAAO,MAAM;AACT,UAAMa,KAAIb,IAAG,KAAA;AACb,QAAIa,GAAE,KACF;AACJ,WAAOA,GAAE;EACZ;AACJ;AASD,SAAgBC,SAAO,KAAK,KAAK,UAAU;AAGvC,SAAO,MAAM;AACT,UAAM,SAAS,IAAI,KAAA,GAAQ,SAAS,IAAI,KAAA;AACxC,QAAI,aAAa,QACb;UAAI,CAAC,SAAS,OAAO,OAAO,OAAO,KAAA,EAC/B,QAAO;IAAM,WAEZ,OAAO,UAAU,OAAO,MAC7B,QAAO;AACX,QAAI,OAAO,QAAQ,OAAO,KACtB,QAAO,OAAO,QAAQ,OAAO;EACpC;AACJ;AACD,SAAgBC,QAAMf,KAAIE,IAAG;AACzB,aAAWJ,MAAKE,KAAI;AAChB,UAAM,SAASE,GAAEJ,EAAA;AACjB,QAAI,CAAC,OACD,QAAO;EACd;AACD,SAAO;AACV;AACD,UAAiBkB,OAAKhB,KAAIF,IAAG;AAEzB,aAAWc,MAAKZ,IACZ,OAAMF;AACb;AAwBD,SAAgBmB,UAAQ,UAAUC,KAAI;AAClC,aAAWpB,MAAK,UAAU;AACtB,UAAM,SAASoB,IAAGpB,EAAA;AAClB,QAAI,OAAO,WAAW,aAAa,CAAC,OAChC;EACP;AACJ;AASD,UAAiBqB,SAAOnB,KAAIE,IAAG;AAE3B,aAAWJ,MAAKE,KAAI;AAChB,QAAI,CAACE,GAAEJ,EAAA,EACH;AACJ,UAAMA;EACT;AACJ;AACD,SAAgBsB,OAAKpB,KAAIE,IAAG;AAExB,aAAWJ,MAAKE,IACZ,KAAIE,GAAEJ,EAAA,EACF,QAAOA;AAElB;AACD,UAAiBuB,UAAQrB,KAAI;AAEzB,aAAWF,MAAKE,IACZ,KAAI,OAAOF,OAAM,UACb;QAAI,MAAM,QAAQA,EAAA,EACd,YAAW,MAAMA,GACb,OAAM;aAEL,WAAWA,EAAA,EAChB,YAAW,MAAMA,GACb,OAAM;EAEb,MAGD,OAAMA;AAGjB;AAUD,UAAiBwB,MAAItB,KAAIE,IAAG;AAExB,aAAWJ,MAAKE,IACZ,OAAME,GAAEJ,EAAA;AAEf;AACD,UAAiByB,MAAIvB,KAAIwB,MAAK,CAACC,IAAGC,OAAMD,KAAIC,IAAG;AAC3C,MAAIH;AACJ,aAAWzB,MAAKE,KAAI;AAChB,QAAIuB,UAAQ,QAAW;AACnBA,cAAMzB;AACN,YAAMyB;AACN;IACH;AACD,QAAIC,IAAG1B,IAAGyB,KAAAA,GAAM;AACZA,cAAMzB;AACN,YAAMyB;IACT;EACJ;AACD,SAAOA;AACV;AACD,UAAiBI,MAAI3B,KAAIwB,MAAK,CAACC,IAAGC,OAAMD,KAAIC,IAAG;AAC3C,MAAIC;AACJ,aAAW7B,MAAKE,KAAI;AAChB,QAAI2B,UAAQ,QAAW;AACnBA,cAAM7B;AACN,YAAM6B;IACT;AACD,QAAIH,IAAGG,OAAK7B,EAAA,GAAI;AACZ6B,cAAM7B;AACN,YAAM6B;IACT;EACJ;AACJ;AACD,SAAgBC,OAAK5B,KAAIE,IAAG;AAExB,aAAWJ,MAAKE,IACZ,KAAIE,GAAEJ,EAAA,EACF,QAAO;AAEf,SAAO;AACV;AAQD,UAAiB+B,SAAO,YAAY,iBAAiB;AACjD,QAAM,UAAU,OAAO,oBAAoB,WAAW,kBAAkB,OAAO;AAC/E,QAAM,SAAS,OAAO,oBAAoB,WAAW,SAAY;AACjE,MAAIC,SAAQ;AACZ,SAAO,MAAM;AACT,eAAWhC,MAAK,WAAA,GAAc;AAC1B,YAAMA;AACN,UAAI,QAAQ,QACR;IACP;AACD,QAAI,OAAO,SAAS,OAAA,GAAU;AAC1B,MAAAgC;AACA,UAAIA,WAAU,EACV;IACP;AACD,QAAI,QAAQ,QACR;EACP;AACJ;AACD,UAAiBC,SAAOC,YAAU;AAE9B,QAAM,SAAS,CAAE;AACjB,MAAI,QAAQ,CAAE;AACd,UAAQ,MAAM,QAAQA,UAAAA,IAAYA,aAAW,CAACA,UAAS;AACvD,aAAWhC,OAAM,MACb,YAAWF,MAAKE,KAAI;AAChB,QAAI,OAAO,SAASF,EAAA,EAChB;AACJ,WAAO,KAAKA,EAAA;AACZ,UAAMA;EACT;AAER;AAUD,UAAiBmC,SAAO,KAAK;AAEzB,QAAM,OAAO,IAAI,IAAI,CAACjC,QAAOA,IAAG,OAAO,QAAA,EAAA,CAAW;AAClD,SAAO,MAAM;AACT,UAAMkC,MAAK,KAAK,IAAI,CAAClC,QAAOA,IAAG,KAAA,CAAM;AACrC,QAAIkC,IAAG,KAAK,CAACpC,OAAMA,GAAE,IAAA,EACjB;AACJ,UAAMoC,IAAG,IAAI,CAACpC,OAAMA,GAAE,KAAA;EACzB;AACJ;AACD,UAAiBqC,eAAaH,YAAU;AACpC,aAAWlC,MAAKkC,WACZ,OAAMlC;AAEb;AAeD,SAAgBsC,UAAQpC,KAAI,UAAU,CAAE,GAAE;AACtC,QAAM,SAAS,CAAE;AACjB,QAAM,UAAU,KAAK,IAAA;AACrB,QAAM,gBAAgB,QAAQ;AAC9B,QAAM,WAAW,QAAQ,SAAS,OAAO;AACzC,QAAM,aAAa,aAAa,QAAQ,SAAS,OAAO,iBAAA;AACxD,aAAWF,MAAKE,KAAI;AAChB,QAAI,eACA;UAAI,CAAC,cAAc,OAAO,MAAA,EACtB;IAAM;AAEd,QAAI,OAAO,UAAU,SACjB;AACJ,QAAI,KAAK,IAAA,IAAQ,UAAU,WACvB;AACJ,WAAO,KAAKF,EAAA;EACf;AACD,SAAO;AACV;AAOD,UAAiBuC,YAAUC,SAAO;AAC9B,aAAWxC,MAAKwC,QACZ,OAAMxC;AAEb;ACncD,IAAa,cAAb,MAAyB;EACrB,SAAS,oBAAI,IAAA;;;;;;;EAOb,IAAI,KAAK;AACL,UAAM,MAAM,KAAKyC,OAAO,IAAI,GAAA;AAC5B,QAAI,CAAC,IACD,QAAO,CAAE;AACb,WAAO,CAAC,GAAG,GAAI;EAClB;;;;;;EAMD,KAAK,KAAK;AACN,UAAM,MAAM,KAAKA,OAAO,IAAI,GAAA;AAC5B,QAAI,CAAC,IACD,QAAO;AACX,WAAO,IAAI;EACd;;;;;;EAMD,CAAC,WAAW,KAAK;AACb,UAAM,MAAM,KAAKA,OAAO,IAAI,GAAA;AAC5B,QAAI,CAAC,IACD;AACJ,WAAO,IAAI,OAAA;EACd;;;;EAID,CAAC,gBAAgB;AACb,eAAW,OAAO,KAAKA,OAAO,KAAA,EAC1B,QAAO,KAAK,WAAW,GAAA;EAE9B;;;;EAID,CAAC,cAAc;AACX,WAAO,KAAKA,OAAO,KAAA;EACtB;EACD,eAAe,QAAQC,SAAQ;AAC3B,QAAI,MAAM,KAAKD,OAAO,IAAI,GAAA;AAC1B,QAAI,CAAC,KAAK;AACN,YAAM,CAAE;AACR,WAAKA,OAAO,IAAI,KAAK,GAAA;IACxB;AACD,QAAI,KAAK,GAAGC,OAAA;EACf;EACD,eAAe,KAAKlC,QAAO;AACvB,UAAM,MAAM,KAAKiC,OAAO,IAAI,GAAA;AAC5B,QAAI,CAAC,IACD,QAAO;AACX,UAAM,UAAU,IAAI,OAAO,CAAAzC,OAAKA,OAAMQ,MAAA;AACtC,QAAI,QAAQ,WAAW,IAAI,OACvB,QAAO;AACX,SAAKiC,OAAO,IAAI,KAAK,OAAA;AACrB,WAAO;EACV;EACD,QAAQ;AACJ,SAAKA,OAAO,MAAA;EACf;AACJ;ACtED,IAAa,qBAAb,MAAgC;EAC5B,aAAa,IAAI,YAAA;EACjB,YAAY;EACZ,UAAU;AACN,QAAI,KAAKE,UACL;AACJ,SAAK,oBAAA;EACR;EACD,IAAI,aAAa;AACb,WAAO,KAAKA;EACf;;;;;;;EAOD,UAAU,MAAM,MAAM;AAClB,QAAI,KAAKA,UACL,OAAM,IAAI,MAAM,UAAU;AAE9B,eAAWC,MAAK,KAAKC,WAAW,WAAW,IAAA,EACvC,CAAAD,GAAE,MAAM,IAAA;EAEf;;;;;;;;;EASD,iBAAiB,MAAM,UAAU;AAC7B,QAAI,KAAKD,UACL,OAAM,IAAI,MAAM,UAAU;AAC9B,SAAKE,WAAW,eAAe,MAAM,QAAA;EACxC;;;;;;EAMD,oBAAoB,MAAM,UAAU;AAChC,QAAI,KAAKF,UACL;AAEJ,SAAKE,WAAW,eAAe,MAAM,QAAA;EACxC;;;;;EAKD,sBAAsB;AAClB,QAAI,KAAKF,UACL;AACJ,SAAKE,WAAW,MAAA;EACnB;AACJ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AEhDD,gBAAuBN,YAAUC,SAAOM,YAAW,GAAG;AAClD,aAAW9C,MAAKwC,SAAO;AACnB,UAAMxC;AACN,UAAM,MAAM8C,SAAA;EACf;AACJ;AAQD,gBAAuBT,eAAaH,YAAUY,YAAW,GAAG;AACxD,mBAAiB9C,MAAKkC,YAAU;AAC5B,UAAMlC;AACN,UAAM,MAAM8C,SAAA;EACf;AACJ;AACD,gBAAuBpC,SAAOR,KAAI,MAAM;AAEpC,MAAI,SAAS,CAAE;AACf,mBAAiBF,MAAKE,KAAI;AACtB,WAAO,KAAKF,EAAA;AACZ,QAAI,OAAO,WAAW,MAAM;AACxB,YAAM;AACN,eAAS,CAAE;IACd;EACJ;AACD,MAAI,OAAO,SAAS,EAChB,OAAM;AACb;AACD,gBAAuBW,YAAU,KAAK;AAElC,mBAAiBT,OAAM,IACnB,QAAOA;AACd;AACD,gBAAuBU,YAAUV,KAAIE,IAAG;AACpC,mBAAiBJ,MAAKE,IAClB,KAAI,CAACE,GAAEJ,EAAA,EACH,OAAMA;AAGjB;AAoBD,IAAaa,UAAQ,OAAOX,KAAI,aAAa;AACzC,mBAAiBY,MAAKZ,KAAI;AACtB,UAAMM,SAAQ,MAAM,SAAA;AACpB,QAAI,OAAOA,WAAU,aAAa,CAACA,OAC/B;EACP;AACJ;AAoCD,IAAa,SAAS,iBAAiB,YAAY,iBAAiB;AAChE,QAAM,UAAU,OAAO,oBAAoB,WAAW,kBAAkB,OAAO;AAC/E,QAAM,SAAS,OAAO,oBAAoB,WAAW,SAAY;AACjE,MAAIwB,SAAQ;AACZ,SAAO,MAAM;AACT,qBAAiBhC,MAAK,WAAA,GAAc;AAChC,YAAMA;AACN,UAAI,QAAQ,QACR;IACP;AACD,QAAI,OAAO,SAAS,OAAA,GAAU;AAC1B,MAAAgC;AACA,UAAIA,WAAU,EACV;IACP;AACD,QAAI,QAAQ,QACR;EACP;AACJ;AAUD,eAAsBhB,SAAO,KAAK,KAAK,UAAU;AAE7C,QAAM,OAAO,IAAI,OAAO,aAAA,EAAA;AACxB,QAAM,OAAO,IAAI,OAAO,aAAA,EAAA;AACxB,SAAO,MAAM;AACT,UAAM,SAAS,MAAM,KAAK,KAAA;AAC1B,UAAM,SAAS,MAAM,KAAK,KAAA;AAC1B,QAAI,aAAa,QACb;UAAI,CAAC,SAAS,OAAO,OAAO,OAAO,KAAA,EAC/B,QAAO;IAAM,WAEZ,OAAO,UAAU,OAAO,MAC7B,QAAO;AACX,QAAI,OAAO,QAAQ,OAAO,KACtB,QAAO,OAAO,QAAQ,OAAO;EACpC;AACJ;AACD,eAAsBC,QAAMf,KAAIE,IAAG;AAC/B,mBAAiBJ,MAAKE,KAAI;AACtB,UAAM,SAAS,MAAME,GAAEJ,EAAA;AACvB,QAAI,CAAC,OACD,QAAO;EACd;AACD,SAAO;AACV;AACD,gBAAuBkB,OAAKhB,KAAIF,IAAG;AAE/B,mBAAiBc,MAAKZ,IAClB,OAAMF;AACb;AAWD,gBAAuBqB,SAAOnB,KAAIE,IAAG;AAEjC,mBAAiBJ,MAAKE,KAAI;AACtB,QAAI,CAAC,MAAME,GAAEJ,EAAA,EACT;AACJ,UAAMA;EACT;AACJ;AACD,eAAsBsB,OAAKpB,KAAIE,IAAG;AAE9B,mBAAiBJ,MAAKE,IAClB,KAAI,MAAME,GAAEJ,EAAA,EACR,QAAOA;AAElB;AACD,gBAAuBuB,UAAQrB,KAAI;AAE/B,mBAAiBF,MAAKE,IAClB,KAAI,OAAOF,OAAM,UACb;QAAI,MAAM,QAAQA,EAAA,EACd,YAAW,MAAMA,GACb,OAAM;aAEL,gBAAgBA,EAAA,EACrB,kBAAiB,MAAMA,GACnB,OAAM;aAGL,WAAWA,EAAA,EAChB,YAAW,MAAMA,GACb,OAAM;EAEb,MAGD,OAAMA;AAGjB;AA4BD,IAAamB,YAAU,eAAgB,UAAUC,KAAI,UAAU,CAAE,GAAE;AAC/D,QAAM0B,YAAW,QAAQ;AACzB,MAAI,MAAM,QAAQ,QAAA,EAEd,YAAWC,MAAK,UAAU;AACtB,UAAMhC,KAAI,MAAMK,IAAG2B,EAAA;AACnB,QAAI,OAAOhC,OAAM,aAAa,CAACA,GAC3B;AACJ,QAAI+B,UACA,OAAM,MAAMA,SAAA;EACnB;MAID,kBAAiBC,MAAK,UAAU;AAC5B,UAAMhC,KAAI,MAAMK,IAAG2B,EAAA;AACnB,QAAI,OAAOhC,OAAM,aAAa,CAACA,GAC3B;AACJ,QAAI+B,UACA,OAAM,MAAMA,SAAA;EACnB;AAER;AAaD,eAAsBrC,OAAKP,KAAI,OAAO,CAAE,GAAE;AACtC,QAAM,QAAQ,KAAK;AACnB,MAAI;AACJ,mBAAiBM,UAASN,KAAI;AAC1B,QAAI,OAAO,QACP,QAAO;AACX,kBAAcM;EACjB;AACD,SAAO;AACV;AAiBD,gBAAuBgB,MAAItB,KAAIE,IAAG;AAE9B,mBAAiBJ,MAAKE,IAClB,OAAME,GAAEJ,EAAA;AAEf;AACD,gBAAuByB,MAAIvB,KAAIwB,MAAM,CAACC,IAAGC,OAAMD,KAAIC,IAAI;AACnD,MAAIH;AACJ,mBAAiBzB,MAAKE,KAAI;AACtB,QAAIuB,UAAQ,QAAW;AACnBA,cAAMzB;AACN,YAAOyB;AACP;IACH;AAED,QAAIC,IAAG1B,IAAGyB,KAAAA,GAAM;AACZA,cAAMzB;AACN,YAAMA;IACT;EACJ;AACJ;AAsBD,gBAAuB6B,MAAI3B,KAAIwB,MAAK,CAACC,IAAGC,OAAMD,KAAIC,IAAG;AACjD,MAAIC;AACJ,mBAAiB7B,MAAKE,KAAI;AACtB,QAAI2B,UAAQ,QAAW;AACnBA,cAAM7B;AACN,YAAM6B;AACN;IACH;AAED,QAAIH,IAAGG,OAAK7B,EAAA,GAAI;AACZ6B,cAAM7B;AACN,YAAMA;IACT;EACJ;AACD,SAAO6B;AACV;AACD,eAAsB1B,SAAOD,KAAIE,IAAG,OAAO;AAEvC,mBAAiBJ,MAAKE,IAClB,SAAQE,GAAE,OAAOJ,EAAA;AACrB,SAAO;AACV;AAuBD,eAAsBO,aAAW,OAAO,UAAU,QAAQ;AACtD,mBAAiBC,UAAS,MACtB,UAASA,MAAA;AAEb,MAAI,OACA,QAAA;AACP;AACD,gBAAuBP,QAAMC,KAAI,QAAQ,GAAG,MAAM,OAAO,mBAAmB;AACxE,UAAQ,IAAI,sBAAsB,KAAA,EAAO;AAEzC,QAAM,MAAMA,IAAG,OAAO,aAAA,EAAA;AACtB,MAAI,MAAM,MACN,OAAM,IAAI,MAAM,yCAAyC;AAC7D,SAAO,QAAQ,GAAG,SAAS,MACvB,OAAM,IAAI,KAAA;AACd,mBAAiBF,MAAKE,IAClB,KAAI,QAAQ,EACR,OAAMF;MAGN;AAGX;AAMD,gBAAuB,UAAUE,KAAI8C,SAAO;AACxC,aAAWhD,MAAKE,KAAI;AAChB,UAAM,MAAM8C,OAAAA;AACZ,UAAMhD;EACT;AACJ;AAMD,eAAsB,gBAAgBE,KAAI,SAAS;AAC/C,QAAM+C,MAAK,aAAa,SAAS,GAAA;AACjC,QAAMzC,SAAQ,MAAM,QAAQ,KAAK,EAC5B,YAAY;AACT,UAAM,MAAM;MAAE,QAAQyC;MAAI,QAAQ,QAAQ;IAAQ,CAAA;AAClD,WAAO;EACV,GAAA,IACA,YAAY;AACT,WAAO,MAAM/C,IAAG,KAAA;EACnB,GAAA,CACJ,CAAA;AACD,MAAIM,WAAU,OACV,OAAM,IAAI,MAAM,SAAS;AAC7B,SAAOA;AACV;AACD,eAAsBsB,OAAK5B,KAAIE,IAAG;AAE9B,mBAAiBJ,MAAKE,IAClB,KAAI,MAAME,GAAEJ,EAAA,EACR,QAAO;AAEf,SAAO;AACV;AA+BD,eAAsBsC,UAAQpC,KAAI,UAAU,CAAE,GAAE;AAE5C,QAAM,SAAS,CAAE;AACjB,QAAM,WAAWA,IAAG,OAAO,aAAA,EAAA;AAC3B,QAAM,UAAU,KAAK,IAAA;AACrB,QAAM,WAAW,QAAQ,SAAS,OAAO;AACzC,QAAM,gBAAgB,QAAQ;AAC9B,QAAM,aAAa,aAAa,QAAQ,SAAS,OAAO,iBAAA;AACxD,SAAO,OAAO,SAAS,YAAa,KAAK,IAAA,IAAQ,UAAU,YAAa;AACpE,QAAI,eACA;UAAI,CAAC,cAAc,OAAO,MAAA,EACtB;IAAM;AAEd,UAAMa,KAAI,MAAM,SAAS,KAAA;AACzB,QAAIA,GAAE,KACF;AAEJ,WAAO,KAAKA,GAAE,KAAA;EACjB;AACD,SAAO;AACV;AACD,gBAAuBkB,SAAOC,YAAU;AACpC,QAAM,SAAS,CAAE;AACjB,QAAM,QAAQ,MAAM,QAAQA,UAAAA,IAAYA,aAAW,CAACA,UAAS;AAC7D,mBAAiBhC,OAAM,MACnB,kBAAiBF,MAAKE,KAAI;AACtB,QAAI,OAAO,SAASF,EAAA,EAChB;AACJ,WAAO,KAAKA,EAAA;AACZ,UAAMA;EACT;AAER;AACD,gBAAuBK,gBAAc,OAAOC,YAAW,iBAAiB,OAAO,oBAAI,IAAA,GAAO;AACtF,mBAAiBN,MAAK,OAAO;AACzB,UAAM,MAAMM,UAASN,EAAA;AACrB,QAAI,KAAK,IAAI,GAAA,EACT;AACJ,SAAK,IAAI,GAAA;AACT,UAAMA;EACT;AACJ;AA+BD,gBAAuBmC,SAAO,KAAK;AAE/B,QAAM,OAAO,IAAI,IAAI,CAACjC,QAAOA,IAAG,OAAO,aAAA,EAAA,CAAgB;AACvD,SAAO,MAAM;AACT,UAAMkC,MAAK,MAAM,QAAQ,IAAI,KAAK,IAAI,CAAClC,QAAOA,IAAG,KAAA,CAAM,CAAC;AACxD,QAAIkC,IAAG,KAAK,CAACpC,OAAMA,GAAE,IAAA,EACjB;AACJ,UAAMoC,IAAG,IAAI,CAACpC,OAAMA,GAAE,KAAA;EACzB;AACJ;ACxjBD,SAAgB,oBAAoBkD,IAAG;AACnC,MAAI,EAAE,WAAWA,IACb,QAAO;AAEX,MAAIA,GAAE,UAAU,oBACZ,QAAO;AACX,SAAO;AACV;AAKD,UAAU,qBAAqB1C,QAAO;AAClC,QAAMA;AACT;AAKD,gBAAgB,0BAA0BA,QAAO;AAC7C,QAAMA;AACN,QAAM,MAAM,CAAA;AACf;AAMD,SAAgB,aAAa,OAAO;AAChC,MAAI,MAAM,QAAQ,KAAA,GAAQ;AACtB,UAAMmB,KAAI,MAAM,OAAA;AAEhB,IAAAA,GAAE,QAAQ;AACV,WAAOA;EACV,WACQ,OAAO,UAAU,YAAY,OAAO,UAAU,aAAa,OAAO,UAAU,SAEjF,QAAO,qBAAqB,KAAA;WAEvB,OAAO,UAAU,WACtB,QAAO,MAAA;AAEX,SAAO;AACV;AAMD,SAAgB,kBAAkB,OAAO;AACrC,MAAI,UAAU,OACV;AACJ,MAAI,MAAM,QAAQ,KAAA,EACd,QAAA,YAAuB,KAAA;WAElB,OAAO,UAAU,YAAY,OAAO,UAAU,aAAa,OAAO,UAAU,SAEjF,QAAO,0BAA0B,KAAA;WAE5B,OAAO,UAAU,WACtB,QAAO,MAAA;WAEF,gBAAgB,KAAA,EACrB,QAAO;AAEX,SAAA,eAA0B,KAAA;AAC7B;ACrED,SAAgB,UAAU,WAAW;AACjC,MAAI,OAAO,cAAc,UAAU;AAC/B,UAAMwB,MAAK,SAAS,cAAc,SAAA;AAClC,QAAI,CAACA,IACD,OAAM,IAAI,MAAM,sBAAsB,SAAA,GAAY;AACtD,WAAOA;EACV;AACD,SAAO;AACV;;;;;;ACLD,IAAM,YAAY,CAAC,QAAQ;AACvB,QAAM,cAAc,QAAQ,CAAC3C,WAAUA;AACvC,QAAMgB,QAAM,oBAAI,IAAA;AAChB,SAAO;IACH,IAAI4B,OAAK;AACL,aAAO5B,MAAI,IAAI,YAAY4B,KAAAA,CAAI;IAClC;IACD,IAAIA,OAAK;AACL,aAAO5B,MAAI,IAAI,YAAY4B,KAAAA,CAAI;IAClC;IACD,IAAIA,OAAK5C,QAAO;AAEZgB,YAAI,IAAI,YAAY4B,KAAAA,GAAM5C,MAAA;IAC7B;IACD,UAAU;AACN,aAAOgB,MAAI,QAAA;IACd;IACD,OAAO4B,OAAK;AACR5B,YAAI,OAAO4B,KAAAA;IACd;EACJ;AACJ;AA2BD,SAAgB,SAAS,UAAU,CAAE,GAAE;AACnC,QAAM,cAAc,QAAQ;AAC5B,QAAM,UAAU,QAAQ,WAAW;AACnC,MAAI,eAAe,QAAQ,IACvB,OAAM,IAAI,MAAM,oDAAoD;AACxE,QAAM,cAAc,cAAc,SAAY,QAAQ,OAAO;AAC7D,QAAM5B,QAAM,UAAU,WAAA;AACtB,QAAM,uBAAuB,QAAQ,YAAY,SAAS;AAC1D,QAAM,WAAW,UAAU,oBAAA;AAC3B,QAAM,eAAe,oBAAI,IAAA;AACzB,kBAAgB6B,WAAS,OAAO;AAC5B,qBAAiB7C,UAAS,aAAa,KAAA,GAAQ;AAC3C,UAAI2C,MAAK3B,MAAI,IAAIhB,MAAA;AACjB,UAAI,CAAC2C,KAAI;AACL,QAAAA,MAAK,SAAS,cAAc,OAAA;AAC5B3B,cAAI,IAAIhB,QAAO2C,GAAA;AACf,YAAI,QAAQ,aACR,SAAQ,aAAaA,GAAA;AACzB,iBAAS,OAAOA,GAAA;AAChB,YAAI,QAAQ,YACR,SAAQ,YAAYA,GAAA;MAC3B;AACD,mBAAa,IAAIA,GAAA;AACjB,YAAM;QAAE,IAAAA;QAAI,OAAA3C;MAAO;IACtB;AAED,eAAW,CAAC,IAAI2C,GAAA,KAAO3B,MAAI,QAAA,GAAW;AAClC,UAAI,aAAa,IAAI2B,GAAA,EACjB;AACJ,UAAI,QAAQ,aACR,SAAQ,aAAaA,GAAA;AACzB,MAAAA,IAAG,OAAA;AACH3B,YAAI,OAAO,EAAA;IACd;EACJ;AACD6B,aAAS,QAAQ;AACjB,SAAOA;AACV;AAOD,SAAgB,MAAM,UAAU,CAAE,GAAE;AAChC,QAAM,cAAc,QAAQ,eAAe;AAC3C,kBAAgBC,QAAM,OAAO;AACzB,UAAM,MAAM,aAAa,KAAA;AACzB,qBAAiB9C,UAAS,IACtB,YAAW,WAAW,YAAY,iBAAiBA,MAAA,EAC/C,OAAM;EAGjB;AACD8C,UAAM,QAAQ;AACd,SAAOA;AACV;;;;;;;;;;;;;;;;;;;;AClGD,SAAgB,UAAU,aAAa;AACnC,kBAAgBC,YAAU,OAAO;AAC7B,YAAQ,aAAa,KAAA;AACrB,qBAAiB/C,UAAS,MACtB,OAAM,YAAYA,MAAA;EAEzB;AACD+C,cAAU,QAAQ;AAClB,SAAOA;AACV;AAMD,SAAgB,KAAKC,QAAO;AACxB,kBAAgBC,OAAK,OAAO;AACxB,YAAQ,aAAa,KAAA;AACrB,QAAI,UAAU;AACd,qBAAiBjD,UAAS,OAAO;AAC7B,UAAI,EAAE,UAAUgD,OACZ;AACJ,YAAMhD;IACT;EACJ;AACDiD,SAAK,QAAQ;AACb,SAAOA;AACV;AAcD,SAAgBtD,SAAO,SAAS;AAC5B,kBAAgBA,SAAO,OAAO;AAC1B,YAAQ,aAAa,KAAA;AACrB,qBAAiBK,UAAS,MACtB,OAAM,QAAQA,MAAA;EAErB;AACDL,WAAO,QAAQ;AACf,SAAOA;AACV;AAOD,SAAgB,SAASuD,UAAS;AAC9B,QAAM,aAAa,aAAaA,UAAS,CAAA;AACzC,kBAAgBC,WAAS,OAAO;AAC5B,YAAQ,aAAa,KAAA;AACrB,UAAMD,YAAU,aAAA;AAChB,qBAAiBlD,UAAS,OAAO;AAC7B,UAAIkD,UAAAA,IAAY,WACZ;AACJ,YAAMlD;IACT;EACJ;AACDmD,aAAS,QAAQ;AACjB,SAAOA;AACV;AAMD,SAAgB,MAAM,SAAS;AAC3B,QAAM,SAAS,aAAa,QAAQ,QAAQ,CAAA;AAC5C,QAAM,QAAQ,aAAa,QAAQ,OAAO,CAAA;AAC1C,kBAAgBX,QAAM,OAAO;AACzB,YAAQ,aAAa,KAAA;AACrB,qBAAiBxC,UAAS,OAAO;AAC7B,UAAI,SAAS,EACT,OAAM,MAAM,MAAA;AAEhB,YAAMA;AACN,UAAI,QAAQ,EACR,OAAM,MAAM,KAAA;IAEnB;EACJ;AACDwC,UAAM,QAAQ;AACd,SAAOA;AACV;AAiBD,SAAgB,SAASY,OAAM;AAC3B,QAAM,SAAS,aAAaA,OAAM,CAAA;AAClC,kBAAgBC,WAAS,OAAO;AAC5B,YAAQ,aAAa,KAAA;AACrB,QAAIH,WAAU,aAAA;AACd,qBAAiBlD,UAAS,OAAO;AAC7B,UAAIkD,SAAA,IAAY,OACZ;AACJ,YAAMlD;AACN,MAAAkD,WAAU,aAAA;IACb;EACJ;AACDG,aAAS,QAAQ;AACjB,SAAOA;AACV;AAkBD,SAAgBC,QAAM,kBAAkB,MAAM;AAC1C,kBAAgBA,QAAM,OAAO;AACzB,YAAQ,aAAa,KAAA;AACrB,UAAMC,KAAA,MAA0B,eAAA;AAChC,qBAAiB/D,MAAK,MAClB,OAAM+D,GAAE/D,EAAA;EAEf;AACD8D,UAAM,QAAQ;AACd,SAAOA;AACV;AAOD,SAAgBjC,QAAM;AAClB,kBAAgBA,MAAI,OAAO;AACvB,YAAQ,aAAa,KAAA;AACrB,UAAMkC,KAAA,IAAA;AACN,qBAAiBvD,UAAS,OAAO;AAC7B,YAAMuC,KAAIgB,GAAEvD,MAAA;AACZ,UAAIuC,OAAM,OACN;AACJ,YAAMA;IACT;EACJ;AACDlB,QAAI,QAAQ;AACZ,SAAOA;AACV;AAOD,SAAgBJ,QAAM;AAClB,kBAAgBA,MAAI,OAAO;AACvB,YAAQ,aAAa,KAAA;AACrB,UAAMsC,KAAA,IAAA;AACN,qBAAiBvD,UAAS,OAAO;AAC7B,YAAMuC,KAAIgB,GAAEvD,MAAA;AACZ,UAAIuC,OAAM,OACN;AACJ,YAAMA;IACT;EACJ;AACDtB,QAAI,QAAQ;AACZ,SAAOA;AACV;AA2CD,SAAgBuC,OAAKjD,IAAG,UAAU,CAAE,GAAE;AAClC,kBAAgBiD,OAAK,OAAO;AACxB,YAAQ,aAAa,KAAA;AAErB,UAAMD,KAAA,KAAyBhD,IAAG,OAAA;AAClC,qBAAiBP,UAAS,OAAO;AAC7B,YAAMuC,KAAIgB,GAAEvD,MAAA;AACZ,UAAIuC,OAAM,OACN;AACJ,YAAMA;IACT;EACJ;AACDiB,SAAK,QAAQ;AACb,SAAOA;AACV;AAmCD,SAAgB,UAAUjD,IAAG,UAAU,CAAE,GAAE;AACvC,QAAM,cAAc,QAAQ;AAC5B,QAAM,kBAAkB,QAAQ,mBAAmB;AACnD,QAAM,oBAAoB,QAAQ,qBAAqB;AACvD,QAAM,eAAe,QAAQ,gBAAgB;AAC7C,kBAAgBkD,YAAU,OAAO;AAC7B,YAAQ,aAAa,KAAA;AACrB,QAAI;AACJ,qBAAiBzD,UAAS,OAAO;AAC7B,UAAI,OAAO;AACX,UAAI,aACA,QAAO;AACX,iBAAW,YAAYA,QAAO;AAC1B,YAAI,eAAe,OAAO,aAAa,YACnC;AACJ,YAAI,SAAS,QAAW;AACpB,iBAAO;AACP,iBAAO;QACV,OACI;AACD,gBAAM,SAASO,GAAE,UAAU,IAAA;AAC3B,cAAI,UAAU,KAAK;AAEf,mBAAO;AACP,mBAAO;UACV,WACQ,WAAW,QAAQ,gBAExB,QAAO;mBAEF,kBAEL,QAAO;QAEd;MACJ;AACD,UAAI,QAAQ,KACR,OAAM;IACb;EACJ;AACDkD,cAAU,QAAQ;AAClB,SAAOA;AACV;AAMD,SAAgBC,YAAU;AACtB,kBAAgBA,UAAQ,OAAO;AAC3B,YAAQ,aAAa,KAAA;AACrB,UAAMH,KAAA,QAAA;AACN,qBAAiBvD,UAAS,OAAO;AAC7B,YAAMuC,KAAIgB,GAAEvD,MAAA;AACZ,UAAIuC,OAAM,OACN;AACJ,YAAMA;IACT;EACJ;AACDmB,YAAQ,QAAQ;AAChB,SAAOA;AACV;AAMD,SAAgBC,QAAM;AAClB,kBAAgBC,OAAM,OAAO;AACzB,YAAQ,aAAa,KAAA;AACrB,UAAML,KAAA,IAAA;AACN,qBAAiBvD,UAAS,OAAO;AAC7B,YAAMuC,KAAIgB,GAAEvD,MAAA;AACZ,UAAIuC,OAAM,OACN;AACJ,YAAMA;IACT;EACJ;AACD,EAAAqB,OAAM,QAAQ;AACd,SAAOA;AACV;AAeD,SAAgB,MAAM,MAAM,mBAAmB,MAAM;AACjD,cAAY,YAAY,MAAM,aAAa,MAAM,CAAC;AAClD,kBAAgBC,QAAM,OAAO;AACzB,YAAQ,aAAa,KAAA;AACrB,QAAI,SAAS,CAAE;AACf,qBAAiB7D,UAAS,OAAO;AAC7B,aAAO,KAAKA,MAAA;AACZ,UAAI,OAAO,UAAU,MAAM;AACvB,cAAM;AACN,iBAAS,CAAE;MACd;IACJ;AACD,QAAI,oBAAoB,OAAO,SAAS,EACpC,OAAM;EACb;AACD6D,UAAM,QAAQ;AACd,SAAOA;AACV;AASD,SAAgBhD,SAAO,WAAW;AAC9B,kBAAgBA,SAAO,OAAO;AAC1B,YAAQ,aAAa,KAAA;AACrB,qBAAiBb,UAAS,MACtB,KAAI,UAAUA,MAAA,EACV,OAAMA;EAGjB;AACDa,WAAO,QAAQ;AACf,SAAOA;AACV;AAQD,SAAgB,KAAK,WAAW;AAC5B,kBAAgBiD,OAAK,OAAO;AACxB,YAAQ,aAAa,KAAA;AACrB,qBAAiB9D,UAAS,MACtB,KAAI,CAAC,UAAUA,MAAA,EACX,OAAMA;EAGjB;AACD8D,SAAK,QAAQ;AACb,SAAOA;AACV;ACrbD,SAAgB9B,OAAMtC,KAAI8C,UAAQ,GAAG;AACjC,kBAAgBT,cAAY;AACxB,eAAWvC,MAAKE,KAAI;AAChB,YAAM,MAAM8C,OAAAA;AACZ,YAAMhD;IACT;EACJ;AACDuC,cAAU,QAAQ;AAClBA,cAAU,QAAQ;AAClB,SAAOA;AACV;ACVD,SAAgB,MAAM,QAAQ,MAAM;AAChC,kBAAgBgC,UAAQ;AAEpB,WAAO,KACH,OAAM,MAAM,iBAAiB,QAAQ,IAAA;EAE5C;AACDA,UAAM,QAAQ;AACdA,UAAM,QAAQ;AACd,SAAOA;AACV;ACYD,SAAgB,KAAK,UAAU;AAC3B,kBAAgBC,iBAAe;AAE3B,WAAO,MAAM;AACT,YAAMxE,KAAI,MAAM,SAAA;AAChB,UAAI,OAAOA,OAAM,YACb;AACJ,YAAMA;IACT;EACJ;AACDwE,iBAAa,QAAQ;AACrBA,iBAAa,QAAQ;AACrB,SAAOA;AACV;ACrCD,SAAgB,SAAStE,KAAI;AACzB,kBAAgBmC,iBAAe;AAC3B,qBAAiBrC,MAAKE,IAClB,OAAMF;EAEb;AACDqC,iBAAa,QAAQ;AACrBA,iBAAa,QAAQ;AACrB,SAAOA;AACV;ACDD,SAAgB,UAAU,SAAS;AAC/B,QAAM,aAAa,aAAa,QAAQ,UAAU,CAAA;AAClD,QAAM,cAAc,QAAQ,eAAe;AAC3C,QAAM,QAAQ,QAAQ,SAAS,OAAO;AACtC,MAAI,SAAS;AACb,QAAM,eAAe,aAAa,QAAQ,SAAS,OAAO,gBAAA;AAC1D,kBAAgBoC,MAAK;AACjB,UAAMf,WAAU,aAAA;AAChB,WAAO,SAAS,SAASA,SAAA,IAAY,cAAc;AAC/C,YAAM,cAAc,KAAK,IAAA,IAAQA,SAAA;AAEjC,YAAM,mBAAoB,SAAS,aAAcA,SAAA;AACjD,YAAM,MAAM,KAAK,IAAI,GAAG,aAAa,gBAAA,CAAiB;AACtD;IACH;EACJ;AACD,EAAAe,IAAG,QAAQ;AACX,EAAAA,IAAG,QAAQ;AACX,SAAOA;AACV;;;;;;;;;AEpBD,eAAsB,WAAWjC,SAAO,aAAa;AACjD,QAAM,aAAc,OAAO,gBAAgB,aAAc,YAAA,IAAgB;AACzE,mBAAiBhC,UAAS,WACtBgC,SAAM,KAAKhC,MAAA;AAElB;ACCD,eAAsB,QAAQ,aAAa,UAAU,CAAE,GAAE;AACrD,QAAM,aAAc,OAAO,gBAAgB,aAAc,YAAA,IAAgB;AACzE,SAAOkE,UAAa,YAAY,OAAA;AACnC;ACCD,eAAsBnE,aAAW,aAAa,UAAU,QAAQ;AAC5D,QAAM,aAAc,OAAO,gBAAgB,aAAc,YAAA,IAAgB;AACzE,mBAAiBC,UAAS,WACtB,UAASA,MAAA;AAEb,MAAI,OACA,QAAA;AACP;AChBD,SAAgB,UAAU,aAAa;AACnC,MAAI;AACJ,QAAM,aAAc,OAAO,gBAAgB,aAAc,YAAA,IAAgB;AACzE,iBAAemE,cAAY;AACvB,UAAM3E,KAAI,MAAM,WAAW,KAAA;AAC3B,QAAIA,GAAE,KACF;AACJ,gBAAYA,GAAE;AACd,WAAO;EACV;AACD,SAAO2E;AACV;ACND,SAAgB,QAAQ,aAAa,cAAc;AAC/C,MAAI,YAAY;AAChB,MAAI,WAAW;AACf,QAAM,aAAc,OAAO,gBAAgB,aAAc,YAAA,IAAgB;AACzE,WAASC,YAAU;AACf,QAAI,CAAC,UAAU;AACX,iBAAW;AACX,iBAAW,KAAA,EAAO,KAAK,CAAA5E,OAAK;AAExB,oBAAYA,GAAE;AACd,mBAAW;MACd,CAAA,EAAE,MAAM,CAAC,UAAU;AAChB,mBAAW;AACX,cAAM;MACT,CAAA;IACJ;AACD,WAAO;EACV;AACD,SAAO4E;AACV;AClBD,gBAAuB,qBAAqB,SAAS,UAAU,CAAE,GAAE;AAC/D,QAAM,eAAe,QAAQ,gBAAgB;AAC7C,QAAM,aAAa,QAAQ,cAAc;AACzC,QAAM,YAAY,QAAQ,aAAa;AACvC,QAAM,SAAS,QAAQ,IAAI,CAAC,QAAQ,WAAW;IAAE,SAAS;IAAW;IAAO,KAAK,aAAa,MAAA;IAAS,MAAM;IAAO,WAAW;EAAW,EAAA;AAC1I,QAAMC,UAAS,MAAM,CAAC,OAAO,KAAK,CAAA7E,OAAK,CAACA,GAAE,IAAA;AAC1C,QAAM,YAAY,MAAM,OAAO,KAAK,CAAAA,OAAKA,GAAE,YAAY,MAAA;AACvD,QAAM,WAAW,CAAC8E,OAAM,CAACA,GAAE,KAAK,CAAA9E,OAAKA,OAAM,MAAA;AAC3C,MAAI,cAAc,CAAE;AAEpB,SAAO,MAAM;AACT,UAAM,WAAW,CAAE;AACnB,eAAW,SAAS,QAAQ;AAExB,UAAI,MAAM,KACN;AACJ,UAAI,MAAM,YAAY,QAAW;AAC7B,iBAAS,KAAK,MAAM,OAAA;AACpB;MACH;AACD,YAAM+D,KAAI,QAAQ,SAAS,YAAY;AACnC,YAAI,MAAM,KACN,QAAO;AACX,cAAM/D,KAAI,MAAM,MAAM,IAAI,KAAA;AAC1B,cAAM,UAAU;AAChB,YAAIA,GAAE,MAAM;AACR,gBAAM,OAAO;AACb,cAAI,eAAe,YACf,OAAM,YAAY;QACzB,MAGG,OAAM,YAAYA,GAAE;AAExB,eAAO;MACV,GAAA,CAAG;AACJ,YAAM,UAAU+D;AAChB,eAAS,KAAKA,EAAA;IACjB;AAED,UAAM,MAAM,MAAM,QAAQ,KAAK,QAAA;AAC/B,QAAI,UAAU,KAEV;UAAI,IAAI,QAAQ,iBAAiB,QAC7B;IAAM,MAGV,OAAM,IAAI,MAAM,yBAAyB;AAG7C,UAAMe,KAAI,OAAO,IAAI,CAAA9E,OAAKA,GAAE,SAAA;AAC5B,QAAI8E,GAAE,WAAW,EACb;AAEJ,UAAM,YAAY,SAASA,EAAA;AAC3B,QAAI,aAAa,CAAC,UAAA,EACd;AAEJ,QAAI,CAAC,QAAQ,aAAaA,EAAA,KAAM,CAAC,WAAW;AACxC,oBAAcA;AACd,YAAMA;IACT;AACD,QAAI,cAAc,YACd,YAAW,SAAS,QAAQ;AACxB,UAAI,MAAM,YAAY,OAClB;AACJ,YAAM,YAAY;IACrB;AAEL,QAAID,QAAA,EACA;EAEP;AACJ;ACxED,gBAAuB,sBAAsB,SAAS,UAAU,CAAE,GAAE;AAChE,QAAM,eAAe,QAAQ,gBAAgB;AAC7C,QAAM,aAAa,QAAQ,cAAc;AACzC,QAAM,YAAY,QAAQ,aAAa;AACvC,QAAM,SAAS,oBAAI,IAAA;AACnB,aAAW,CAAC,KAAKrE,MAAA,KAAU,OAAO,QAAQ,OAAA,EACtC,QAAO,IAAI,KAAK;IACZ,KAAK,aAAaA,MAAA;IAClB,MAAM;IACN,WAAW;IACX,SAAS;IACT;EACH,CAAA;AAEL,QAAMqE,UAAS,MAAM,CAAA,KAAa,QAAQ,CAAA7E,OAAK,CAACA,GAAE,IAAA;AAClD,QAAM,YAAY,MAAA,KAAkB,QAAQ,CAAAA,OAAKA,GAAE,YAAY,MAAA;AAC/D,QAAM,WAAW,CAAC8E,OAAM;AACpB,eAAW9E,MAAK,OAAO,OAAO8E,EAAA,EAC1B,KAAI9E,OAAM,OACN,QAAO;AAEf,WAAO;EACV;AACD,QAAM,UAAU,MAAM;AAClB,UAAMe,KAAI,CAAE;AACZ,eAAW,CAAC,KAAK,KAAA,KAAU,OAEvB,CAAAA,GAAE,GAAA,IAAO,MAAM;AAEnB,WAAOA;EACV;AACD,MAAI;AAEJ,SAAO,MAAM;AACT,UAAM,WAAW,CAAE;AACnB,eAAW,SAAS,OAAO,OAAA,GAAU;AAEjC,UAAI,MAAM,KACN;AACJ,UAAI,MAAM,YAAY,QAAW;AAC7B,iBAAS,KAAK,MAAM,OAAA;AACpB;MACH;AACD,YAAMgD,KAAI,QAAQ,SAAS,YAAY;AACnC,YAAI,MAAM,KACN,QAAO;AACX,cAAM/D,KAAI,MAAM,MAAM,IAAI,KAAA;AAC1B,cAAM,UAAU;AAChB,YAAIA,GAAE,MAAM;AACR,gBAAM,OAAO;AACb,cAAI,eAAe,YACf,OAAM,YAAY;QACzB,MAGG,OAAM,YAAYA,GAAE;AAExB,eAAO;MACV,GAAA,CAAG;AACJ,YAAM,UAAU+D;AAChB,eAAS,KAAKA,EAAA;IACjB;AAED,UAAM,MAAM,MAAM,QAAQ,KAAK,QAAA;AAC/B,QAAI,UAAU,KAEV;UAAI,IAAI,QAAQ,iBAAiB,QAC7B;IAAM,MAGV,OAAM,IAAI,MAAM,gCAAgC;AAEpD,UAAMe,KAAI,QAAA;AAMV,UAAM,YAAY,SAASA,EAAA;AAC3B,QAAI,aAAa,CAAC,UAAA,EAEd;AAEJ,QAAI,CAAC,wBAAwB,aAAaA,EAAA,KAAM,CAAC,WAAW;AAExD,oBAAcA;AACd,YAAMA;IACT;AACD,QAAI,cAAc,YACd,YAAW,SAAS,OAAO,OAAA,GAAU;AACjC,UAAI,MAAM,YAAY,OAClB;AACJ,YAAM,YAAY;IACrB;AAEL,QAAID,QAAA,EACA;EAEP;AACJ;ACnHD,IAAM,cAAc,CAAC3B,OAAM;AAEvB,SAAOA,GAAE,SAASA,GAAE;AACvB;AACD,SAAgB,OAAO;AACnB,QAAM,UAAU,CAAE;AAClB,MAAI;AACJ,QAAM,cAAc,CAAC,SAAS;AAC1B,QAAI,SAAS,OACT,QAAO;AACX,QAAI4B,KAAI,kBAAkB,IAAA;AAC1B,eAAW5B,MAAK,QACZ,KAAI4B,OAAM,OACN,KAAI,oBAAoB5B,EAAA,EACpB,CAAA4B,KAAI5B,GAAA;QAGJ,OAAM,IAAI,MAAM,aAAa,YAAYA,EAAA,CAAE,wEAAwE;QAIvH,CAAA4B,KAAI5B,GAAE4B,EAAA;AAGd,WAAOA;EACV;AACD,QAAMC,KAAI;IACN,WAAW,CAAChE,IAAG,YAAY;AACvB,cAAQ,KAAA,UAAiBA,IAAG,OAAA,CAAQ;AACpC,aAAOgE;IACV;IACD,MAAM,CAAChE,IAAG,YAAY;AAClB,cAAQ,KAAA,OAAYA,IAAG,OAAA,CAAQ;AAC/B,aAAOgE;IACV;IACD,WAAW,CAAC,gBAAgB;AACxB,cAAQ,KAAA,UAAiB,WAAA,CAAY;AACrC,aAAOA;IACV;IACD,QAAQ,CAAC,YAAY;AACjB,cAAQ,KAAA,SAAc,OAAA,CAAQ;AAC9B,aAAOA;IACV;IACD,MAAM,CAAC,cAAc;AACjB,cAAQ,KAAA,KAAY,SAAA,CAAU;AAC9B,aAAOA;IACV;IACD,OAAO,CAAC,YAAY;AAChB,cAAQ,KAAA,MAAa,OAAA,CAAQ;AAC7B,aAAOA;IACV;IACD,UAAU,CAACrB,aAAY;AACnB,cAAQ,KAAA,SAAgBA,QAAA,CAAQ;AAChC,aAAOqB;IACV;IACD,UAAU,CAACnB,UAAS;AAChB,cAAQ,KAAA,SAAgBA,KAAA,CAAK;AAC7B,aAAOmB;IACV;IACD,cAAc,CAAC,aAAa;AACxB,cAAQ,KAAKP,KAAa,QAAA,CAAS;AACnC,aAAOO;IACV;IACD,MAAM,CAACvB,WAAU;AACb,cAAQ,KAAA,KAAYA,MAAA,CAAM;AAC1B,aAAOuB;IACV;IACD,OAAO,CAAC,MAAM,mBAAmB,SAAS;AACtC,cAAQ,KAAA,MAAa,MAAM,gBAAA,CAAiB;AAC5C,aAAOA;IACV;IACD,QAAQ,CAAC,cAAc;AACnB,cAAQ,KAAA,SAAc,CAAA/E,OAAK,UAAUA,EAAA,CAAE,CAAC;AACxC,aAAO+E;IACV;IACD,KAAK,MAAM;AACP,cAAQ,KAAA,MAAA,CAAY;AACpB,aAAOA;IACV;IACD,KAAK,MAAM;AACP,cAAQ,KAAA,MAAA,CAAY;AACpB,aAAOA;IACV;IACD,SAAS,MAAM;AACX,cAAQ,KAAA,UAAA,CAAgB;AACxB,aAAOA;IACV;IACD,KAAK,MAAM;AACP,cAAQ,KAAA,MAAA,CAAY;AACpB,aAAOA;IACV;IACD,OAAO,CAAC,oBAAoB;AACxB,cAAQ,KAAA,QAAa,eAAA,CAAgB;AACrC,aAAOA;IACV;IACD,MAAM,MAAM;AACR,kBAAY;AACZ,aAAOA;IACV;IACD;IACA,QAAQ,MAAM;AACV,UAAID,KAAI,QAAQ;AAChB,iBAAW5B,MAAK,QACZ,KAAI4B,OAAM,UAAa,oBAAoB5B,EAAA,EACvC,CAAA4B,KAAI5B,GAAA;eAEC4B,OAAM,OACX,OAAM,IAAI,MAAM,aAAa,YAAY5B,EAAA,CAAE,wEAAwE;UAGnH,CAAA4B,KAAI5B,GAAE4B,EAAA;AAGd,aAAOC;IACV;IACD,SAAS,OAAO,SAAS;AACrB,YAAMC,KAAI,YAAY,IAAA;AACtB,aAAO,MAAA,UAAoBA,EAAA;IAC9B;IACD,aAAa,OAAO,SAAS;AACzB,YAAMA,KAAI,YAAY,IAAA;AACtB,YAAMhF,KAAI,MAAMgF,GAAE,KAAA;AAClB,aAAOhF,GAAE;IACZ;IACD,YAAY,OAAO,SAAS;AACxB,YAAMgF,KAAI,YAAY,IAAA;AACtB,UAAI;AACJ,uBAAiBhF,MAAKgF,GAClB,aAAYhF;AAEhB,aAAO;IACV;EACJ;AACD,SAAO+E;AACV;AC1ID,IAAa,eAAb,MAA0B;EACtB,SAAS,CAAE;EACX,QAAQ,MAAM;AACV,SAAKtC,OAAO,KAAK,IAAA;EACpB;EACD,UAAU;AACN,WAAO,KAAKA,OAAO,MAAA;EACtB;AACJ;ACID,gBAAuB,aAAa,SAAS;AACzC,QAAM,eAAe,QAAQ,IAAI,CAAA,WAAU,kBAAkB,MAAA,CAAO;AACpE,QAAM,SAAS,IAAI,aAAA;AACnB,MAAI,YAAY;AAChB,QAAM,WAAW,OAAO,WAAW;AAC/B,QAAI,WAAW,QAAW;AACtB;AACA;IACH;AACD,UAAMM,KAAI,MAAM,OAAO,KAAA;AACvB,QAAIA,GAAE,KACF;SAEC;AACD,aAAO,QAAQA,GAAE,KAAA;AAEjB,iBAAW,MAAM,SAAS,MAAA,GAAS,CAAA;IACtC;EACJ;AACD,aAAW,UAAU,aAEjB,YAAW,MAAM,SAAS,MAAA,GAAS,CAAA;AAEvC,QAAM,YAAY;AAClB,MAAI,aAAa;AACjB,SAAO,YAAY,aAAa,QAAQ;AACpC,UAAM+B,KAAI,OAAO,QAAA;AACjB,QAAIA,OAAM,OAEN,cAAa,KAAK,IAAI,aAAa,GAAG,EAAA;SAErC;AACD,YAAMA;AAEN,mBAAa;IAChB;AACD,UAAM,MAAM,YAAY,UAAA;EAC3B;AACJ;AChBD,gBAAuB,QAAQ,WAAW;AACtC,MAAI;AACJ,aAAW,YAAY,UACnB,SAAQ,OAAO,aAAa,aAAa,SAAS,SAAS,CAAE,CAAA,IAAI,aAAa,QAAA;AAElF,MAAI,UAAU,OACV;AACJ,mBAAiB9E,MAAK,MAClB,OAAMA;AAEb;AAuCD,gBAAuB,IAAI,KAAK,IAAI,IAAIiF,KAAI,IAAI,IAAI,IAAI;AACpD,MAAI;AAEJ,QAAM,YAAY;AAClB,aAAW,YAAY,UACnB,KAAI,OAAO,aAAa,WAEpB,SAAQ,SAAS,SAAS,CAAE,CAAA;MAI5B,SAAQ,aAAa,QAAA;AAG7B,MAAI,UAAU,OACV;AACJ,mBAAiBjF,MAAK,MAClB,OAAMA;AAEb;ACrFD,SAAgB,WAAW,WAAW;AAClC,QAAMe,KAAI,CAAC,WAAW;AAClB,WAAO,KAAK,QAAQ,GAAG,SAAA;EAC1B;AACD,SAAOA;AACV;ACPD,eAAsB,OAAOX,IAAG,OAAO;AACnC,QAAM,WAAW,MAAMA,GAAE,CAAC,KAAM,CAAA,EAAE,KAAA;AAClC,SAAO,SAAS;AACnB;ACOD,gBAAuB,YAAY,SAAS,UAAU,CAAE,GAAE;AACtD,QAAM,eAAe,QAAQ,gBAAgB;AAE7C,QAAM,gBAAgB,aAAa,QAAQ,aAAa,GAAA;AACxD,QAAM,aAAa,QAAQ,cAAc;AACzC,QAAM,SAAS,QAAQ,IAAI,CAAA,YAAW;IAAE,KAAK;IAAG,WAAW;IAAW,KAAK,aAAa,MAAA;IAAS,MAAM;EAAO,EAAA;AAC9G,QAAM,sBAAsB,EACxB,QAAQ,cACX;AACD,MAAI,MAAM;AACV,QAAM,YAAY,MAAM,CAAC,OAAO,KAAK,CAAAJ,OAAK,CAACA,GAAE,IAAA;AAC7C,MAAIkF,MAAK;AACT,SAAOA,KAAI;AACP;AACA,eAAW,SAAS,QAAQ;AACxB,UAAI,MAAM,MAAM;AACZ,cAAM,MAAM;AACZ;MACH;AAED,YAAMlF,KAAI,MAAA,gBAA4B,MAAM,KAAK,mBAAA;AAEjD,UAAIA,GAAE,MAAM;AACR,cAAM,OAAO;AACb,cAAM,MAAM;AACZ,YAAI,eAAe,YACf,OAAM,YAAY;AAEtB,YAAI,iBAAiB,QACjB;MAEP,OACI;AAGD,cAAM,YAAYA,GAAE;AACpB,cAAM,MAAM;MACf;IACJ;AAED,QAAIkF,KAAI;AAEJ,YAAMJ,KAAI,OAAO,OAAO,CAAA9E,OAAKA,GAAE,QAAQ,GAAA,EAAK,IAAI,CAAAA,OAAKA,GAAE,SAAA;AACvD,UAAI8E,GAAE,WAAW,EACb;AACJ,UAAI,CAACA,GAAE,KAAK,CAAA9E,OAAK,OAAOA,OAAM,WAAW,EACrC;AACJ,YAAM8E;IACT;AACD,QAAI,UAAA,EACA,CAAAI,MAAK;EACZ;AAuBJ;;;;;;;;;;;;;;;;;;;;;;;;AE3FD,IAAa,WAAW,CAAChD,YAAU,WAAW;AAC1C,MAAI;AACJ,MAAI,eAAe,OAAO;AAC1B,aAAW1B,UAAS0B,YAAU;AAC1B,UAAM,QAAQ,OAAO1B,MAAA;AACrB,QAAI,SAAS,cAAc;AACvB,qBAAe;AACf,qBAAeA;IAClB;EACJ;AACD,SAAO;AACV;AAQD,IAAa,WAAW,CAAC0B,YAAU,WAAW;AAC1C,MAAI;AACJ,MAAI,cAAc,OAAO;AACzB,aAAW1B,UAAS0B,YAAU;AAC1B,UAAM,QAAQ,OAAO1B,MAAA;AACrB,QAAI,SAAS,aAAa;AACtB,oBAAc;AACd,oBAAcA;IACjB;EACJ;AACD,SAAO;AACV;AA2BD,IAAa,wBAAwB,CAAC,WAAW,WAAW,OAAO;AAC/D,QAAM,cAAc,6BAA6B,WAAW,WAAW,EAAA;AACvE,SAAO,YAAY,EAAE,WAAW,KAAK,YAAY,EAAE,WAAW;AACjE;AC5DD,IAAa,qBAAqB,CAAC,YAAY;AAC3C,QAAM,UAAU,aAAa,QAAQ,OAAO,EAAA;AAC5C,MAAI;AACJ,QAAM,UAAU,QAAQ;AACxB,MAAI,QAAQ;AACZ,QAAM,OAAO,aAAa,YAAY;AAClC,QAAI,KAAK;AACL,YAAMO,KAAI,MAAM,IAAI,KAAA;AACpB,UAAIA,GAAE,MAAM;AACR,gBAAQ;AACR,eAAO;MACV;AACD,YAAMoE,MAAK,QAAQpE,GAAE,KAAA;AACrB,UAAI,OAAOoE,QAAO,WAAW;AACzB,YAAI,CAACA,IACD,SAAQ;AAEZ,eAAOA;MACV;AACD,aAAO;IACV,OACI;AACD,cAAQ;AACR,aAAO;IACV;EACJ,GAAE,OAAA;AACH,QAAM,SAAS,MAAM;AACjB,QAAI,UAAU,UACV;AACJ,UAAM;AACN,SAAK,OAAA;AACL,YAAQ;EACX;AACD,QAAM,QAAQ,MAAM;AAChB,QAAI,UAAU,SACV;AACJ,SAAK,OAAA;AACL,YAAQ;EACX;AACD,QAAM,QAAQ,MAAM;AAChB,QAAI,UAAU,UACV;AACJ,QAAI,CAAC,IACD,QAAA;AAEJ,YAAQ;AACR,SAAK,MAAA;EACR;AACD,QAAM,SAAS,MAAM;AACjB,QAAI,QAAQ,SACR,OAAM,QAAQ,SAAA;QAGd,OAAM,IAAI,MAAM,oBAAoB;EAE3C;AACD,QAAM,UAAU,MAAM;AAClB,WAAA;AACA,UAAA;EACH;AACD,SAAO;IACH;IAAO;IAAQ;IAAS;IACxB,IAAI,QAAQ;AACR,aAAO;IACV;EACJ;AACJ;AC1ED,IAAa,YAAY,CAAC,aAAa,cAAc;AACjD,QAAM,YAAY,CAAE;AACpB,QAAM,YAAY,CAAE;AACpB,MAAI,OAAO;AACX,QAAM,YAAY,CAAC,SAAS;AACxB,QAAI,UAAU,SAAS,GAAG;AAEtB,YAAM,WAAW,UAAU,MAAA;AAE3B,eAAS,GAAG,IAAA;IACf,MAEG,WAAU,KAAK,IAAA;EAEtB;AACD,QAAM,YAAY,MAAM,IAAI,QAAQ,CAACC,aAAY;AAC7C,QAAI,UAAU,SAAS,GAAG;AAEtB,YAAM,aAAa,UAAU,MAAA;AAE7B,MAAAA,SAAQ,GAAG,UAAA;IACd,MAEG,WAAU,KAAKA,QAAA;EAEtB,CAAA;AACD,QAAM,UAAU,IAAI,eAAe;AAC/B,cAAU,UAAA;EACb;AACD,cAAY,iBAAiB,WAAW,OAAA;AACxC,QAAMrE,KAAI;IACN,MAAM,YAAY;AACd,UAAI,KACA,QAAO;QAAE,MAAM;QAAM,OAAO;MAAW;AAC3C,aAAO;QACH,MAAM;QACN,OAAO,MAAM,UAAA;MAChB;IACJ;IAED,QAAQ,YAAY;AAChB,aAAO;AACP,kBAAY,oBAAoB,WAAW,OAAA;AAC3C,aAAO;QAAE,MAAM;QAAM,OAAO;MAAW;IAC1C;IAED,OAAO,OAAO,UAAU;AACpB,aAAO;AACP,aAAO;QACH,MAAM;QACN,OAAO,QAAQ,OAAO,IAAI,MAAM,KAAA,CAAA;MACnC;IACJ;EACJ;AACD,SAAOA;AACV;AC3BD,IAAa,iBAAiB,CAAC,MAAM,UAAU,CAAE,MAAK;AAClD,MAAI,OAAO,SAAS,YAChB,OAAM,IAAI,MAAM,2BAA2B;AAC/C,MAAI,MAAM,QAAQ,IAAA,EACd,QAAO,mBAAmB,MAAM,OAAA;AAEpC,MAAI,WAAW,IAAA,EACX,QAAO,uBAAuB,MAAM,OAAA;AAExC,QAAM,IAAI,MAAM,+CAA+C;AAClE;AACD,SAAS,uBAAuB,MAAM,UAAU,CAAE,GAAE;AAIhD,MAAIqD,SAAQ;AACZ,QAAM,aAAa,QAAQ,cAAc;AACzC,MAAIvC,QAAM,OAAO;AACjB,MAAIJ,QAAM,OAAO;AACjB,MAAIO,SAAQ;AACZ,WAAShC,MAAK,MAAM;AAChB,QAAI,OAAOA,OAAM,YAAY,OAAO,MAAMA,EAAA,GAAI;AAC1C,UAAI,eAAe,QACf,OAAM,IAAI,UAAU,mDAAmD,OAAOA,EAAA,GAAI;AACtF,UAAI,eAAe,MACf,CAAAA,KAAI;AACR,UAAI,eAAe,SACf;IACP;AACD,IAAAoE,UAASpE;AACT,IAAAgC;AACAH,YAAM,KAAK,IAAIA,OAAK7B,EAAA;AACpByB,YAAM,KAAK,IAAIA,OAAKzB,EAAA;EACvB;AACD,SAAO;IACH,KAAKoE,SAAQpC;IACb,OAAAoC;IAAO,KAAA;IAAK,KAAA;IAAK,OAAApC;EACpB;AACJ;AACD,SAAgB,eAAe,MAAM,UAAU,CAAE,GAAE;AAC/C,MAAIA,SAAQ;AACZ,MAAIoC,SAAQ;AACZ,QAAM,aAAa,QAAQ,cAAc;AACzC,WAASU,MAAK,MAAM;AAChB,QAAI,OAAOA,OAAM,YAAY,OAAO,MAAMA,EAAA,GAAI;AAC1C,UAAI,eAAe,QACf,OAAM,IAAI,UAAU,mDAAmD,OAAOA,EAAA,GAAI;AACtF,UAAI,eAAe,MACf,CAAAA,KAAI;AACR,UAAI,eAAe,SACf;IACP;AACD,IAAAV,UAASU;AACT,IAAA9C;EACH;AACD,SAAOoC,SAAQpC;AAClB;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AClDD,SAAgBH,MAAI3B,KAAIwB,MAAK,CAACC,IAAGC,OAAMD,KAAIC,IAAG;AAC1C,SAAO,gBAAgB1B,GAAA,IAAG,MAAaA,KAAIwB,GAAA,IAAG,MAAYxB,KAAIwB,GAAA;AACjE;AAoBD,SAAgBD,MAAIvB,KAAIwB,MAAK,CAACC,IAAGC,OAAMD,KAAIC,IAAG;AAC1C,SAAO,gBAAgB1B,GAAA,IAAG,MAAaA,KAAIwB,GAAA,IAAG,MAAYxB,KAAIwB,GAAA;AACjE;AAYD,SAAgB,UAAUxB,KAAIE,IAAG;AAC7B,SAAO,gBAAgBF,GAAA,IAAG,YAAmBA,KAAIE,EAAA,IAAE,YAAkBF,KAAIE,EAAA;AAC5E;AAkBD,SAAgBS,OAAMX,KAAI,UAAU;AAChC,MAAI,gBAAgBA,GAAA,EAChB,QAAA,QAAmBA,KAAI,QAAA;eAGZA,KAAI,QAAA;AAEtB;AAaD,SAAgBQ,QAAOR,KAAI,MAAM;AAC7B,SAAO,gBAAgBA,GAAA,IAAG,SAAgBA,KAAI,IAAA,IAAK,SAAeA,KAAI,IAAA;AACzE;AAaD,SAAgB,OAAOA,KAAIE,IAAG;AAC1B,SAAO,gBAAgBF,GAAA,IAAG,SAAgBA,KAAIE,EAAA,IAAE,SAAeF,KAAIE,EAAA;AACtE;AAaD,SAAgB,KAAKF,KAAIF,IAAG;AACxB,SAAO,gBAAgBE,GAAA,IAAG,OAAcA,KAAIF,EAAA,IAAE,OAAaE,KAAIF,EAAA;AAClE;AAQD,SAAgB,UAAU,KAAK;AAC3B,SAAO,gBAAgB,IAAI,CAAA,CAAA,IAAG,SAAgB,GAAG,GAAA,IAAI,SAAe,GAAG,GAAA;AAC1E;AAaD,SAAgB,KAAKE,KAAIE,IAAG;AACxB,SAAO,gBAAgBF,GAAA,IAAG,OAAcA,KAAIE,EAAA,IAAE,OAAaF,KAAIE,EAAA;AAClE;AAeD,SAAgB,QAAQF,KAAIkB,KAAI,UAAU,CAAE,GAAE;AAC1C,MAAI,gBAAgBlB,GAAA,EAChB,QAAA,UAAqBA,KAAIkB,KAAI,OAAA;iBAGhBlB,KAAIkB,GAAA;AAExB;AAiBD,SAAgB,IAAIlB,KAAIE,IAAG;AACvB,SAAO,gBAAgBF,GAAA,IAAG,MAAaA,KAAIE,EAAA,IAAE,MAAYF,KAAIE,EAAA;AAChE;AASD,SAAgB,UAAUoC,SAAOM,WAAU;AACvC,SAAOA,cAAa,SAAA,YAA2BN,OAAAA,IAAM,YAAmBA,SAAOM,SAAA;AAClF;AAUD,SAAgBvB,SAAQrB,KAAI;AACxB,SAAO,gBAAgBA,GAAA,IAAG,UAAiBA,GAAA,IAAG,UAAgBA,GAAA;AACjE;AAYD,SAAgB4B,OAAK5B,KAAIE,IAAG;AACxB,SAAO,gBAAgBF,GAAA,IAAG,OAAcA,KAAIE,EAAA,IAAE,OAAaF,KAAIE,EAAA;AAClE;AAMD,SAAgB,KAAKF,KAAI;AACrB,SAAO,gBAAgBA,GAAA,IAAG,OAAcA,GAAA,IAAG,OAAaA,GAAA;AAC3D;AAYD,SAAgB,OAAOA,KAAIE,IAAG,OAAO;AACjC,SAAO,gBAAgBF,GAAA,IAAG,SAAgBA,KAAIE,IAAG,KAAA,IAAM,SAAeF,KAAIE,IAAG,KAAA;AAChF;AAcD,SAAgB,MAAMF,KAAI,QAAQ,GAAG,MAAM,OAAO,mBAAmB;AACjE,SAAO,gBAAgBA,GAAA,IAAG,QAAeA,KAAI,OAAO,GAAA,IAAI,QAAcA,KAAI,OAAO,GAAA;AACpF;AAgBD,SAAgB+B,QAAOC,YAAU;AAC7B,MAAI,MAAM,QAAQA,UAAAA,GAAW;AACzB,QAAIA,WAAS,WAAW,EACpB,QAAA,YAAsB,CAAE,CAAA;AAC5B,WAAO,gBAAgBA,WAAS,CAAA,CAAA,IAAG,SAAgBA,UAAAA,IAAS,SAAeA,UAAAA;EAC9E,WACQ,gBAAgBA,UAAAA,EACrB,QAAA,SAAoBA,UAAAA;MAGpB,QAAA,SAAmBA,UAAAA;AAE1B;AAgDD,UAAiB,cAAc,OAAO5B,YAAW,iBAAiB,OAAO,oBAAI,IAAA,GAAO;AAChF,SAAO,gBAAgB,KAAA,IAAM,gBAAuB,OAAOA,WAAU,IAAA,IAAK,gBAAsB,OAAOA,WAAU,IAAA;AACpH;AAeD,SAAgBgC,SAAQpC,KAAI,UAAU,CAAE,GAAE;AACtC,SAAO,gBAAgBA,GAAA,IAAG,UAAiBA,KAAI,OAAA,IAAQ,UAAgBA,KAAI,OAAA;AAC9E;AAUD,SAAgB,MAAMA,KAAIE,IAAG;AACzB,SAAO,gBAAgBF,GAAA,IAAG,QAAeA,KAAIE,EAAA,IAAE,QAAcF,KAAIE,EAAA;AACpE;AAUD,SAAgB,OAAO,KAAK,KAAK,UAAU;AACvC,QAAMiF,MAAK,gBAAgB,GAAA,KAAQ,gBAAgB,GAAA;AACnD,SAAOA,MAAA,SAAkB,KAAK,KAAK,QAAA,IAAS,SAAe,KAAK,KAAK,QAAA;AACxE;AAUD,SAAgBlD,QAAO,KAAK;AACxB,MAAI,IAAI,WAAW,EACf,QAAA,YAAsB,CAAE,CAAA;AAC5B,SAAO,gBAAgB,IAAI,CAAA,CAAA,IAAG,MAAa,GAAG,GAAA,IAAI,MAAY,GAAG,GAAA;AACpE;AAQD,SAAgBE,cAAaH,YAAUY,WAAU;AAC7C,MAAI,gBAAgBZ,UAAAA,KAAaY,cAAa,OAC1C,QAAA,eAA0BZ,YAAUY,SAAA;AACxC,SAAA,eAAyBZ,UAAAA;AAC5B;AAaD,UAAiB,aAAa,UAAU;AACpC,SAAO,MAAM;AACT,UAAMlC,KAAI,SAAA;AACV,UAAMA;EACT;AACJ;AAeD,gBAAuB,oBAAoB,UAAU;AACjD,SAAO,MAAM;AACT,UAAMA,KAAI,MAAM,SAAA;AAChB,UAAMA;EACT;AACJ;AAuBD,SAAgB,WAAW,OAAO,UAAU,QAAQ;AAChD,MAAI,gBAAgB,KAAA,EAChB,QAAA,aAAwB,OAAO,QAAA;OAE9B;iBACe,OAAO,QAAA;AACvB;EACH;AACJ;;;AC7bD,IAAa,gBAAb,MAAasF,uBAAyB,MAAM;EAC1C;EACA;EAEA,YAAY,WAAW,GAAG;AACxB,UAAA;AAEA,gBAAY,YAAY,UAAU,YAAY,UAAU,CAAC;AAGzD,SAAKC,YAAY;AACjB,SAAKC,WAAW;EACjB;;;;;;EAOD,IAAIC,SAA4B;AAC9B,UAAMC,MAAKJ,eAAc,KAAK,IAAA;AAC9B,IAAAI,IAAI,KAAKF,QAAAA,IAAaG;AACtB,IAAAD,IAAGH,YAAY,KAAKA;AACpB,QAAI,KAAKA,YAAY,EACnB,CAAAG,IAAGF,WACD,KAAKA,WAAW,MAAM,KAAKD,YAAY,IAAI,KAAKC,WAAW;QAE7D,CAAAE,IAAGF,WAAW,KAAKA,WAAW;AAEhC,WAAOE;EACR;EAED,IAAI,UAAkB;AACpB,WAAO,KAAKF;EACb;EAED,IAAI,SAAkB;AACpB,QAAI,KAAKD,cAAc,EAAG,QAAO;AACjC,WAAO,KAAK,WAAW,KAAKA;EAC7B;AACF;AC3FD,IAAa,QAAQ,CAACK,MAAsBC,YAA0B;AACpE,OAAK,SAAQ,QAAQ,IAAI,SAAU,OAAA,EAAU;AAC9C;AAED,IAAa,YAAY,CACvBC,MACAC,OACAC,UACqB;AACrB,QAAM,kBAAkB,MAAM,SAAS,MAAM;AAC7C,QAAM,WAAW,KAAK,YAAY;AAClC,QAAM,WAAW,kBAAkB;AACnC,QAAM,SAAS,KAAK,iBAAiB;AAOrC,UAAQ,QAAR;IAEE,KAAK,aAAa;AAOhB,UAAI,MAAM,WAAW,EAAG,QAAO,MAAM,MAAM,GAAG,MAAM,SAAS,QAAA;AAE7D,UAAI,MAAM,WAAW,KAAK,SACxB,QAAO;UAGP,QAAO,CAAE,GAAG,OAAO,GAAG,MAAM,MAAM,GAAG,WAAW,CAAA,CAAI;IAEvD;IAED,KAAK;AACH,UAAI,YAAY,MAAM,QAAQ;AAG5B,YAAI,MAAM,WAAW,EAGnB,QAAO,CAAE,GAAG,MAAM,MAAM,GAAG,WAAW,CAAA,GAAI,MAAM,GAAG,EAAA,CAAM;AAE3D,eAAO,MAAM,MACX,KAAK,IAAI,GAAG,MAAM,SAAS,QAAA,GAC3B,KAAK,IAAI,MAAM,QAAQ,QAAA,IAAY,CAAA;MAItC,OAAM;AAOL,cAAM,aAAa,KAAK,IAAI,GAAG,MAAM,SAAS,MAAM,MAAA;AACpD,cAAM,aAAa,MAAM,MAAM,MAAM,SAAS,YAAY,MAAM,MAAA;AAChE,cAAM,SAAS,MAAM,MAAM,GAAG,KAAK,IAAI,MAAM,QAAQ,WAAW,CAAA,CAAE;AAWlE,cAAMC,KAAI,CAAE,GAAG,QAAQ,GAAG,UAAY;AAEtC,eAAOA;MACR;IAGH,KAAK;AAEH,aAAO,CAAE,GAAG,OAAO,GAAG,KAAO,EAAC,MAAM,QAAA;IAEtC;AAEE,YAAM,IAAI,MAAM,2BAA4B,MAAA,EAAS;EAExD;AACF;AAWD,IAAa,UAAU,CACrBH,MACAC,UACG,UACkB;AACrB,MAAI,SAAS,OAAW,OAAM,IAAI,MAAM,0BAA0B;AAElE,QAAM,kBAAkB,MAAM,SAAS,MAAM;AAC7C,QAAM,WAAW,KAAK,YAAY,kBAAkB,KAAK;AAEzD,QAAM,WAAW,WACb,UAAU,MAAM,OAAO,KAAA,IACvB,CAAE,GAAG,OAAO,GAAG,KAAO;AAC1B,MAAI,KAAK,YAAY,SAAS,WAAW,KAAK,YAAY,SACxD,OAAM,IAAI,MACR,uDAAwD,SAAS,MAAA,cAClD,KAAK,QAAA,UAAoB,KAAK,UAAU,IAAA,CAAK,EAAG;AAGnE,MAAI,CAAC,KAAK,YAAY,SAAS,WAAW,gBACxC,OAAM,IAAI,MACR,gDAAiD,SAAS,MAAA,cAC3C,eAAA,UAA2B,KAAK,UAAU,IAAA,CAAK,EAAG;AAGrE,SAAO;AACR;AAGD,IAAa,UAAU,CACrBD,MACAC,UACqB;AACrB,MAAI,MAAM,WAAW,EAAG,OAAM,IAAI,MAAM,gBAAgB;AACxD,SAAO,MAAM,MAAM,CAAA;AACpB;AAUD,IAAa,OAAO,CAClBD,MACAC,UACkB,MAAO,CAAA;AAE3B,IAAa,UAAU,CAAID,MAAoBC,UAC7C,MAAM,WAAW;AAEnB,IAAa,SAAS,CACpBD,MACAC,UACY;AACZ,MAAI,KAAK,SACP,QAAO,MAAM,UAAU,KAAK;AAE9B,SAAO;AACR;ACrHD,IAAaG,gBAAb,cAAqC,mBAAsE;EAChG;EACT;EACA;EAEA,YAAYJ,OAAqB,CAAE,GAAEK,OAAqB,CAAE,GAAE;AAC5D,UAAA;AACA,QAAI,SAAS,OAAW,OAAM,IAAI,MAAM,0BAA0B;AAClE,SAAK,UAAU;AACf,SAAK,OAAO;AACZ,SAAK,KAAK,KAAK,MAAM;EACtB;EAED,QAAQ;AACN,UAAM,OAAO,CAAE,GAAG,KAAK,IAAM;AAC7B,SAAK,OAAO,CAAE;AACd,SAAK,UAAU,WAAW;MAAE,WAAW,KAAK;MAAM,SAAS;IAAM,CAAA;AACjE,SAAK,QAAA;EACN;;;;EAKS,UAAU;EACnB;EAED,GAAGC,OAAkB;AACnB,QAAI,SAAS,KAAK,KAAK,OAAQ,OAAM,IAAI,MAAM,+BAA+B;AAC9E,UAAMC,KAAI,KAAK,KAAK,GAAG,KAAA;AACvB,QAAIA,OAAM,OAAW,OAAM,IAAI,MAAM,4CAA4C;AACjF,WAAOA;EACR;EAED,WAAW,OAA6B;AACtC,SAAK,OAAO,QAAQ,KAAK,SAAS,KAAK,MAAM,GAAG,KAAA;AAChD,UAAMC,UAAS,KAAK,KAAK;AACzB,SAAK,UAAU,KAAK,MAAM,KAAA;AAC1B,WAAOA;EACR;EAES,UAAUC,QAAsBC,gBAA8B;AACtE,SAAK,UAAU,WAAW;MAAE,OAAO;MAAgB,WAAW;IAAQ,CAAA;EACvE;EAED,UAAyB;AACvB,UAAMH,KAAI,KAAK,KAAK,SAAS,KAAK,IAAA;AAClC,QAAIA,OAAM,OAAW;AAErB,SAAK,OAAO,QAAQ,KAAK,SAAS,KAAK,IAAA;AACvC,SAAK,UAAU,WAAW;MAAE,SAASA;MAAG,WAAW,KAAK;IAAM,CAAA;AAC9D,SAAK,UAAU,CAAEA,EAAG,GAAE,KAAK,IAAA;AAC3B,WAAOA;EACR;EAES,UAAUI,SAAuBC,WAAyB;AAClE,SAAK,UAAU,WAAW;MAAE;MAAS;IAAW,CAAA;EACjD;;;;;;EAOD,YAAYC,WAAyC;AACnD,UAAM,WAAW,KAAK,KAAK;AAC3B,UAAM,WAAW,KAAK,KAAK,OAAO,CAAAN,OAAK,UAAUA,EAAA,CAAE;AACnD,QAAI,SAAS,WAAW,EAAG,QAAO;AAClC,SAAK,OAAO,KAAK,KAAK,OAAO,CAAC,YAAY,CAAC,UAAU,OAAA,CAAQ;AAC7D,SAAK,UAAU,UAAU,KAAK,IAAA;AAC9B,WAAO,WAAW,KAAK,KAAK;EAC7B;;;;;EAMD,UAAe;AACb,WAAO,CAAE,GAAG,KAAK,IAAM;EACxB;EAED,IAAI,UAAmB;AACrB,WAAO,QAAQ,KAAK,SAAS,KAAK,IAAA;EACnC;EAED,IAAI,SAAkB;AACpB,WAAO,OAAO,KAAK,SAAS,KAAK,IAAA;EAClC;EAED,IAAI,SAAiB;AACnB,WAAO,KAAK,KAAK;EAClB;EAED,IAAI,OAAsB;AACxB,WAAO,KAAK,KAAK,SAAS,KAAK,IAAA;EAChC;AACF;AAQD,SAAgBO,UACdC,UAAwB,CAAE,MACvB,eACyB;AAC5B,SAAO,IAAIX,cAAa,EAAE,GAAG,QAAS,GAAE,CAAE,GAAG,aAAe,CAAA;AAC7D;ACvJD,IAAa,YAAY,CACvBY,MACAC,OACAf,UACqB;AACrB,QAAM,kBAAkB,MAAM,SAAS,MAAM;AAC7C,QAAM,SAAS,KAAK,iBAAiB;AACrC,QAAM,WAAW,KAAK,YAAY;AAClC,QAAM,WAAW,kBAAkB;AACnC,MAAI,KAAK,MACP,SAAQ,IACN,yBAA0B,MAAM,MAAA,kBAA0B,eAAA,cAA+B,QAAA,YAAsB,MAAA,EAAS;AAG5H,UAAQ,QAAR;IACE,KAAK,aAAa;AAChB,UAAI,KAAK,MACP,SAAQ,IACN,0CAA2C,MAAM,MAAA,WAAmB,kBAAkB,QAAA,cACvE,MAAM,MAAA,EAAS;AAKlC,UAAI,MAAM,WAAW,KAAK,SACxB,QAAO;UAGP,QAAO,CAAE,GAAG,OAAO,GAAG,MAAM,MAAM,GAAG,MAAM,SAAS,QAAA,CAAW;IAElE;IACD,KAAK;AACH,UAAI,YAAY,MAAM,OAEpB,QAAO,MAAM,MACX,KAAK,IAAI,GAAG,MAAM,SAAS,QAAA,GAC3B,KAAK,IAAI,MAAM,QAAQ,QAAA,IAAY,CAAA;WAEhC;AAGL,YAAI,KAAK,MACP,SAAQ,IAAI,eAAgB,KAAK,UAAU,MAAM,MAAM,GAAG,MAAM,SAAS,QAAA,CAAS,CAAC,EAAG;AAExF,eAAO,CACL,GAAG,MAAM,MAAM,GAAG,MAAM,SAAS,QAAA,GACjC,GAAG,MAAM,MAAM,GAAG,KAAK,IAAI,MAAM,QAAQ,WAAW,WAAW,CAAA,CAAE,CAClE;MACF;IAEH,KAAK;AAEH,aAAO,CAAE,GAAG,OAAO,GAAG,KAAO,EAAC,MAAM,QAAA;IAEtC;AAEE,YAAM,IAAI,MAAM,0BAA2B,MAAA,EAAS;EAEvD;AACF;AAGD,IAAa,OAAO,CAClBc,MACAC,UACG,UACkB;AAGrB,QAAM,kBAAkB,MAAM,SAAS,MAAM;AAE7C,QAAM,WAAW,KAAK,YAAY,kBAAkB,KAAK;AACzD,QAAM,WAAW,WACb,UAAU,MAAM,OAAO,KAAA,IACvB,CAAE,GAAG,OAAO,GAAG,KAAO;AAC1B,SAAO;AACR;AAGD,IAAa,MAAM,CACjBD,MACAC,UACqB;AACrB,MAAI,MAAM,WAAW,EAAG,OAAM,IAAI,MAAM,gBAAgB;AACxD,SAAO,MAAM,MAAM,GAAG,EAAA;AACvB;AAUD,IAAaC,SAAO,CAClBF,MACAC,UACkB,MAAM,GAAG,EAAA;AAE7B,IAAaE,YAAU,CAAIH,MAAiBC,UAC1C,MAAM,WAAW;AAEnB,IAAaG,WAAS,CACpBJ,MACAC,UACY;AACZ,MAAI,KAAK,SACP,QAAO,MAAM,UAAU,KAAK;AAE9B,SAAO;AACR;ACrFD,IAAa,eAAb,MAAyD;EAC9C;EACT;EAEA,YAAYD,OAAkB,CAAE,GAAEX,OAAqB,CAAE,GAAE;AACzD,SAAK,OAAO;AACZ,SAAK,OAAO;EACb;;;;;;;EAQD,QAAQ,OAA6B;AACnC,QAAI,MAAM,WAAW,EAAG,QAAO,KAAK,KAAK;AACzC,SAAK,OAAO,KAAK,KAAK,MAAM,KAAK,MAAM,GAAG,KAAA;AAC1C,WAAO,KAAK,KAAK;EAClB;EAED,QAAQgB,KAA0B;AAChC,SAAK,KAAK,QAAQC,GAAA;EACnB;EAED,eAAeD,KAA0B;AACvC,KAAE,GAAG,KAAK,IAAM,EAAC,QAAA,EAAU,QAAQC,GAAA;EACpC;EAED,MAAqB;AACnB,UAAMf,KAAIW,OAAK,KAAK,MAAM,KAAK,IAAA;AAC/B,SAAK,OAAO,IAAI,KAAK,MAAM,KAAK,IAAA;AAChC,WAAOX;EACR;EAED,IAAI,UAAmB;AACrB,WAAOY,UAAQ,KAAK,MAAM,KAAK,IAAA;EAChC;EAED,IAAI,SAAkB;AACpB,WAAOC,SAAO,KAAK,MAAM,KAAK,IAAA;EAC/B;EAED,IAAI,OAAsB;AACxB,WAAOF,OAAK,KAAK,MAAM,KAAK,IAAA;EAC7B;EAED,IAAI,SAAiB;AACnB,WAAO,KAAK,KAAK;EAClB;AACF;AAsBD,IAAaJ,YAAU,CACrBE,OAAkB,CAAE,MACjB,kBACkB,IAAI,aAAa,EAAE,GAAG,KAAM,GAAE,CAAE,GAAG,aAAe,CAAA;ACpEzE,IAAa,UAAU,CAAIO,IAAuBC,IAAuBC,KAAiB,yBAAyBC,WAAsC;AACvJ,QAAM,aAAa,qBAAqBC,IAAGC,IAAG,EAAA;AAI9C,QAAM,kBAAkB,gBAAgBD,IAAGC,IAAG,EAAA;AAE9C,QAAMC,OAA0B;IAC9B,cAAc,CAAC;IAAY,GAAAF;IAAG,GAAAC;IAC9B,OAAO,gBAAgB;IACvB,SAAS,gBAAgB;IACzB,cAAc;EACf;AACD,QAAME,WAAwB;IAC5B,OAAO;IACP,eAAe,CAAE;IACjB;EACD;AAED,QAAM,eAAe,gBAAgB,UAAU,IAAI,CAAAC,OAAK,QAAQA,GAAG,CAAA,GAAKA,GAAG,CAAA,GAAK,IAAI,QAAA,CAAS;AAE7F,QAAM,kBAAkB,UAAU,IAAA,KAAS,aAAa,KAAK,CAAAxB,OAAK,UAAUA,GAAE,KAAA,CAAO;cAC7D,UAAU,YAAA;AAGlC,WAAS,WAAW,MAAMyB,WAAS,UAAU,CAAA;AAE7C,WAAS,MAAO,eAAe;gBACL,QAAA;AAE1B,SAAO;AACR;AAED,IAAM,YAAY,CAACC,OAAqC;AACtD,MAAI,OAAO,OAAW,QAAO;AAC7B,MAAI,GAAG,aAAc,QAAO;AAC5B,MAAI,GAAG,aAAc,QAAO;AAC5B,MAAI,GAAG,MAAM,SAAS,EAAG,QAAO;AAChC,MAAI,GAAG,QAAQ,SAAS,EAAG,QAAO;AAClC,SAAO;AACR;AAGD,IAAM,kBAAkB,CAAIV,IAAuBC,IAAuBC,KAAiB,4BAA4B;AACrH,QAAM,cAAc,CAAE,GAAGE,GAAE,SAAA,CAAY;AACvC,QAAM,cAAc,CAAE,GAAGC,GAAE,SAAA,CAAY;AAEvC,QAAMM,YAAgE,CAAE;AACxE,QAAMC,UAAgC,CAAE;AACxC,aAAW,UAAU,aAAa;AAChC,QAAI,aAAa;AACjB,eAAW,CAAE,OAAO,QAAA,KAAc,YAAY,QAAA,GAAW;AACvD,YAAMC,KAAI,qBAAqB,QAAQ,UAAU,EAAA;AACjD,UAAIA,IAAG;AACL,kBAAU,KAAK,CAAE,QAAQ,QAAU,CAAA;AACnC,qBAAa;AACb;MACD;IACF;AACD,QAAI,eAAe,GAEjB,SAAQ,KAAK,MAAA;QAGb,aAAY,OAAO,YAAY,CAAA;EAElC;AACD,QAAM,QAAQ,CAAE,GAAG,WAAa;AAChC,SAAO;IAAE;IAAO;IAAW;EAAS;AACrC;AAED,IAAM,uBAAuB,CAAIb,IAAuBC,IAAuBC,OAA4B;AACzG,MAAIE,GAAE,YAAA,MAAkBC,GAAE,YAAA,EAAe,QAAO;AAChD,MAAI,GAAGD,GAAE,SAAA,GAAYC,GAAE,SAAA,CAAU,EAAG,QAAO;AAC3C,SAAO;AACR;AAED,IAAM,iBAAiB,CAAIS,OAAkC;AAC3D,SAAO,KAAK,UAAUC,GAAE,SAAA,CAAU;AACnC;AAED,IAAMN,aAAW,CAAIO,IAAgB,SAAS,MAAc;AAC1D,MAAID,OAAM,OAAW,QAAO;AAC5B,MAAInC,KAAI,aAAamC,GAAE,OAAO,MAAA;AAC9B,aAAWP,MAAKO,GAAE,cAChB,CAAAnC,MAAK6B,WAASD,IAAG,SAAS,CAAA;AAE5B,SAAO5B;AACR;AAED,IAAM,eAAe,CAAIqC,IAAkCC,WAA2B;AACpF,QAAM,SAAS,IAAI,OAAO,MAAA;AAC1B,MAAIH,OAAM,OAAW,QAAO,GAAI,MAAA;AAChC,QAAMI,KAAc,CAAE;AACtB,EAAAvC,GAAE,KAAK,MAAO,eAAemC,GAAE,CAAA,CAAE,OAAS,eAAeA,GAAE,CAAA,CAAE,EAAG;AAChE,MAAIA,GAAE,aAAc,CAAAnC,GAAE,KAAK,iCAAkCmC,GAAE,YAAA,EAAe;MACzE,CAAAnC,GAAE,KAAK,mCAAoCmC,GAAE,YAAA,EAAe;AAEjE,MAAIA,GAAE,MAAM,SAAS,GAAG;AACtB,IAAAnC,GAAE,KAAK,QAAQ;AACf,eAAW4B,MAAKO,GAAE,MAChB,CAAAnC,GAAE,KAAK,QAAQ,eAAe4B,EAAA,CAAE;EAEnC;AACD,MAAIO,GAAE,QAAQ,SAAS,GAAG;AACxB,IAAAnC,GAAE,KAAK,YAAamC,GAAE,QAAQ,MAAA,EAAS;AACvC,eAAWP,MAAKO,GAAE,QAChB,CAAAnC,GAAE,KAAK,QAAQ,eAAe4B,EAAA,CAAE;EAEnC;AACD,EAAA5B,GAAE,KAAK;CAAQ;AACf,SAAOA,GAAE,IAAI,CAAAwC,UAAQ,SAASA,KAAA,EAAM,KAAK;CAAI;AAC9C;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AChID,IAAaC,YAAU,CAAIC,IAAgBC,IAAgBC,OAAoB;AAC7E,SAAOC,QAAYC,uBAAqBtB,EAAA,GAAIsB,uBAAqBrB,EAAA,GAAI,EAAA;AACtE;AAWD,IAAa,iBAAiB,CAAIsB,SAAyC;AACzE,QAAMC,KAAuB;IAC3B,OAAO,KAAK;IACZ,eAAe,KAAK,cAAc,IAAI,CAAApB,OAAK,eAAeA,EAAA,CAAE;EAC7D;AACD,SAAOO;AACR;AAED,IAAM,YAAY,CAAIc,SAAwC,WAAW,OAAQ,KAAK,QAAQ;AAC9F,IAAM,UAAU,CAAIA,SAAwC,WAAW,OAAQ,OAAOC,MAAK,IAAA;AAS3F,IAAaA,QAAO,CAAIC,OAAmC;AACzD,SAAO;IACL,CAAC,WAAW;AACV,iBAAWvB,MAAKO,GAAE,cAChB,OAAMe,MAAKtB,EAAA;IAEd;IACD,UAAU,MAAMO,GAAE;IAClB,aAAa,MAAMA;IACnB,CAAC,WAAWiB,SAA4C;AACtD,iBAAWhD,MAAK,aAAaV,SAAO,UAAUyC,EAAA,CAAE,EAC9C,OAAMe,MAAK9C,EAAA;IAEd;IACD,CAAC,kBAAqBiD,OAAqCD,SAAUR,IAAmD;AACtH,iBAAWxC,MAAK,kBAAkB,UAAU,KAAA,GAAQV,SAAO,EAAA,EACzD,OAAMwD,MAAK9C,EAAA;IAEd;IACD,CAAC,cAAiBiD,OAA0D;AAC1E,aAAO,cAAc,UAAU,KAAA,CAAM;IACtC;IACD,iBAAoBC,OAAoBF,SAAU9B,IAA4C;AAC5F,YAAMa,MAAI,iBAAiB,OAAOzC,SAAO,EAAA;AACzC,UAAIyC,QAAM,OAAW,QAAOe,MAAKf,GAAAA;IAClC;IACD,WAAW,MAAMA,GAAE,WAAW,SAAY,SAAYe,MAAKf,GAAE,MAAA;IAC7D,WAAW,CAACoB,WAAkD;AAC5D,aAAOC,YAAUrB,IAAG,UAAU,MAAA,CAAO;IACtC;IACD,cAAc,CAACoB,WAAkD;AAC/D,aAAOE,eAAatB,IAAG,UAAU,MAAA,CAAO;IACzC;IACD,UAAU,CAACuB,UAAiD;AAC1D,aAAOC,WAAS,UAAU,KAAA,GAAQxB,EAAA;IACnC;IACD,aAAa,CAACuB,UAAiD;AAC7D,aAAOE,cAAY,UAAU,KAAA,GAAQzB,EAAA;IACtC;IACD,QAAQ,MAAM;AACZ,MAAA0B,QAAO1B,EAAA;IACR;IACD,UAAU,CAACiB,YAA6B;AACtC,YAAM,YAAYU,WAASpE,SAAOyC,EAAA;AAClC,aAAOe,MAAK,SAAA;IACb;IACD,KAAK,CAACQ,UAAwD;AAC5DK,YAAI,UAAU,KAAA,GAAQ5B,EAAA;AACtB,aAAO,QAAQ,KAAA;IAChB;IACD,OAAOA;EACR;AACF;AAQD,IAAa0B,UAAS,CAAIP,UAAuB;AAC/C,QAAMU,KAAI,MAAM;AAChB,MAAIA,OAAM,OAAW;AACrB,QAAM,SAAS;AACf,EAAAA,GAAE,gBAAgB,QAAQA,GAAE,eAAe,KAAA;AAC5C;AAOD,UAAiBC,aAAclB,MAAkD;AAC/E,MAAI,CAAC,KAAM;AACX,QAAM,QAAQ,IAAI,aAAA;AAClB,QAAM,KAAK,GAAG,KAAK,aAAA;AACnB,MAAImB,QAAiC,MAAM,IAAA;AAC3C,SAAO,OAAO;AACZ,UAAM;AACN,QAAI,MACF,OAAM,KAAK,GAAG,MAAM,aAAA;AAEtB,QAAI,MAAM,QAAS;AACnB,YAAQ,MAAM,IAAA;EACf;AACF;AAOD,UAAiBC,eAAgBpB,MAAkD;AACjF,MAAI,CAAC,KAAM;AACX,QAAM,QAAQ,IAAI9C,cAAA;AAClB,QAAM,QAAQ,GAAG,KAAK,aAAA;AACtB,MAAIiE,QAAiC,MAAM,QAAA;AAC3C,SAAO,OAAO;AACZ,UAAM;AACN,QAAI,MACF,OAAM,QAAQ,GAAG,MAAM,aAAA;AAEzB,QAAI,MAAM,QAAS;AACnB,YAAQ,MAAM,QAAA;EACf;AACF;AAQD,SAAgB,SAAYE,QAAmBC,OAAsB,CAAE,GAAmD;AACxH,MAAIC,OAAK,WAAWA,OAAM,QAAO;IAAE;IAAO;IAA6BA;EAAM;AAC7E,MAAI,KAAK,SAASA,MAAAA,EAAO,QAAO;IAAE;IAAO;IAAmDA;EAAM;AAClG,OAAK,KAAKA,MAAAA;AACV,MAAI,2BAA2BA,OAAK,aAAA,EAAgB,QAAO;IAAE;IAAO;IAAqCA;EAAM;AAE/G,aAAW1C,MAAK0C,OAAK,eAAe;AAClC,QAAI1C,GAAE,WAAW0C,OAAM,QAAO;MAAE;MAAO;MAAqD1C;IAAG;AAC/F,QAAIgC,cAAYU,QAAM1C,EAAA,EAAI,QAAO;MAAE;MAAO;MAAqCA;IAAG;AAClF,UAAMxB,KAAI,SAASwB,IAAG,IAAA;AACtB,QAAI,CAACxB,GAAG,CAAA,EAAK,QAAOA;EACrB;AACD,SAAO;IAAE;IAAM;IAAIkE;EAAM;AAC1B;AAOD,SAAgB,cAAiBF,QAAmB;AAClD,QAAMhE,KAAI,SAASkE,MAAAA;AACnB,MAAIlE,GAAG,CAAA,EAAK;AACZ,QAAM,IAAI,MAAM,GAAIA,GAAG,CAAA,CAAA,UAAe,mBAAmBA,GAAG,CAAA,EAAI,OAAO,EAAA,CAAG,IAAK,EAAE,OAAOA,GAAG,CAAA,EAAK,CAAA;AACjG;AAOD,UAAiBmE,WAAYH,QAAkD;AAC7E,aAAWxC,MAAK0C,OAAK,cACnB,OAAM1C;AAET;AAOD,UAAiB,eAAkBwC,QAAwC;AACzE,aAAWxC,MAAK0C,OAAK,cACnB,KAAI,OAAO1C,GAAE,UAAU,YAAa,OAAMA,GAAE;AAE/C;AAMD,UAAiB4C,UAAWJ,QAAkD;AAC5E,MAAIJ,KAAIM,OAAK;AACb,SAAON,IAAG;AACR,UAAMA;AACN,IAAAA,KAAIA,GAAE;EACP;AACF;AAOD,SAAgB,UAAUS,MAA6B;AACrD,QAAMT,KAAI,CAAE,GAAGQ,UAAQ,IAAA,CAAO;AAC9B,SAAOR,GAAE;AACV;AAED,IAAaL,aAAW,CAAIL,OAAoBoB,WAAwB;AACtE,aAAW9C,MAAK,OAAO,cACrB,KAAIA,OAAM,MAAO,QAAO;AAE1B,SAAO;AACR;AAWD,IAAa+C,qBAAmB,CAAIvB,SAAUsB,QAAqBpD,KAAiB,mBAA4C;AAC9H,aAAWM,MAAK,OAAO,cACrB,KAAI,GAAGlC,SAAOkC,GAAE,KAAA,EAAa,QAAOA;AAEvC;AAUD,UAAiB,aAAgBwB,SAAUsB,QAAqBpD,KAAiB,gBAA+C;AAC9H,aAAWM,MAAK,OAAO,cACrB,KAAI,GAAGlC,SAAOkC,GAAE,KAAA,EAAa,OAAMA;AAEtC;AAWD,IAAagC,gBAAc,CAAIgB,kBAA+BF,WAAwB;AACpF,aAAW9C,MAAKuC,eAAa,MAAA,EAC3B,KAAIvC,OAAM,iBAAkB,QAAO;AAErC,SAAO;AACR;AAED,IAAaiD,wBAAsB,CAAIzB,SAAUsB,QAAqBpD,KAAiB,mBAAmB;AACxG,aAAWM,MAAKuC,eAAa,MAAA,EAC3B,KAAI,GAAGvC,GAAE,OAAYlC,OAAAA,EAAQ,QAAOkC;AAEvC;AAED,IAAa,UAAU,CAAImB,SAAmC;AAC5D,MAAI,KAAK,OAAQ,QAAO,QAAQ,KAAK,MAAA;AACrC,SAAO;AACR;AAWD,IAAaU,iBAAe,CAAIH,OAAoBwB,sBAAmC;AACrF,aAAWd,MAAKQ,UAAQ,KAAA,EACtB,KAAIR,OAAM,kBAAmB,QAAO;AAEtC,SAAO;AACR;AAUD,UAAiB,cAAiBV,OAAoB;AACpD,aAAWU,MAAKQ,UAAQ,KAAA,EACtB,KAAI,OAAOR,GAAE,UAAU,YACrB,OAAMA,GAAE;AAGZ,SAAO;AACR;AAUD,UAAiB,kBAAqBV,OAAoBF,SAAU9B,KAAiB,gBAAgB;AACnG,aAAW0C,MAAKQ,UAAQ,KAAA,EACtB,KAAI,OAAOR,GAAE,UAAU,aACrB;QAAI,GAAGA,GAAE,OAAOtE,OAAAA,EAAQ,OAAMsE;EAAE;AAGpC,SAAO;AACR;AASD,SAAgB,iBAAoBV,OAAoBF,SAAU9B,KAAiB,gBAAgB;AACjG,aAAW0C,MAAK,kBAAkB,OAAOtE,SAAO,EAAA,EAC9C,QAAOsE;AAEV;AAUD,IAAaR,cAAY,CAAIF,OAAoBwB,sBAAmC;AAClF,SAAO,MAAM,WAAW;AACzB;AAcD,IAAa,kBAAkB,CAAI/B,SAAsB;AACvD,SAAO,oBAAoB,MAAM,CAAA;AAClC;AAED,IAAM,sBAAsB,CAAIA,MAAmB,gBAAgB,MAAM;AACvE,MAAI,QAAQ;AACZ,aAAWnB,MAAK,KAAK,cACnB,SAAQ,KAAK,IAAI,OAAO,oBAAoBA,IAAG,gBAAgB,CAAA,CAAE;AAEnE,SAAO;AACR;AAED,IAAamC,QAAM,CAAIT,OAAoBoB,WAAwB;AACjE,sBAAoB,OAAO,MAAA;AAG3B,QAAMV,KAAI,MAAM;AAChB,SAAO,gBAAgB,CAAE,GAAG,OAAO,eAAe,KAAO;AACzD,QAAM,SAAS;AACf,MAAIA,GACF,CAAAA,GAAE,gBAAgB,QAAQA,GAAE,eAAe,KAAA;AAE9C;AAED,IAAaF,aAAW,CAAIiB,SAAsBL,WAAwB;AACxE,SAAO,WAAWhF,SAAO,MAAA;AAC1B;AAQD,IAAa,OAAO,CAAIsF,YAAc;AACpC,SAAO,WAAWtF,OAAAA;AACnB;AAED,IAAa,kBAAkB,CAACuF,SAA4B,QAAQ,IAAIC,QAAwBC,OAAc,CAAE,MAAyC;AACvJ,QAAMC,WAAU,OAAO,QAAQ1F,OAAAA;AAC/B,WAAS,WAAW,SAAY,KAAA,IAASoE,WAAmC;IAAE;IAAO,OAAA;EAAO,GAAE,MAAA;AAC9F,aAAW,SAASsB,UAAS;AAC3B,UAAM1F,UAAQ,MAAO,CAAA;AAErB,QAAI,KAAK,SAASA,OAAAA,EAAQ;AAC1B,SAAK,KAAKA,OAAAA;AAEV,QAAI,OAAO,MAAO,CAAA,MAAQ,SACxB,iBAAgBA,SAAO,MAAO,CAAA,GAAK,QAAQ,IAAA;QAE3CoE,YAAmC;MAAE,OAAO,MAAO,CAAA;MAAK,OAAOpE;IAAO,GAAE,MAAA;EAE3E;AACD,SAAO;AACR;AAQD,IAAa,cAAc,CAAIqF,YAAyB;AACtD,SAAO7B,MAAK,WAAWxD,OAAAA,CAAM;AAC9B;AASD,IAAa,aAAa,CAAIqF,SAAsBM,WAAsC;AACxF,QAAMlC,KAAiB;IACrB,eAAe,CAAE;IACT;IACR,OAAOzD;EACR;AACD,MAAI,WAAW,OACb,QAAO,gBAAgB,CAAE,GAAG,OAAO,eAAeyC,EAAG;AAEvD,SAAOA;AACR;AAED,IAAamD,mBAAiB,CAAIvC,SAA8B;AAC9D,SAAO,KAAK,cAAc;AAC3B;AAED,IAAa,QAAQ,CAAIA,SAAqC;AAC5D,SAAO,KAAK;AACb;AASD,IAAaD,yBAAuB,CAAIC,SAA0C;AAChF,QAAMwC,KAAwB;IAC5B,CAAC,WAAW;AACV,iBAAW3D,MAAK,KAAK,cACnB,OAAMkB,uBAAqBlB,EAAA;IAE9B;IACD,YAAY;AACV,UAAI,KAAK,WAAW,OAAW;AAC/B,aAAOkB,uBAAqB,KAAK,MAAA;IAClC;IACD,WAAgB;AACd,aAAO,KAAK;IACb;IACD,cAAc;AACZ,aAAO;IACR;EACF;AACD,SAAO9C;AACR;AAED,IAAM,sBAAsB,CAAIwF,IAAgBd,WAAwB;AACtE,MAAI,WAAW9C,GAAG,OAAM,IAAI,MAAM,0BAA0B;AAC5D,MAAIA,GAAE,WAAW,OAAQ;AACzB,MAAI6B,eAAa,QAAQ7B,EAAA,EAAI,OAAM,IAAI,MAAM,6BAA6B,EAAE,OAAOA,GAAG,CAAA;AACtF,MAAI6B,eAAa7B,IAAG,MAAA,EAAS,OAAM,IAAI,MAAM,iCAAiC,EAAE,OAAOA,GAAG,CAAA;AAC1F,MAAIgC,cAAY,QAAQhC,EAAA,EAAI,OAAM,IAAI,MAAM,6BAA6B,EAAE,OAAOA,GAAG,CAAA;AACtF;AAED,IAAa,cAAc,CAAI8C,QAAqBe,eAA4B;AAE9E,aAAW7D,MAAK2C,WACd,qBAAoB3C,IAAG,MAAA;AAGzB,SAAO,gBAAgB,CAAE,GAAG2C,UAAU;AACtC,aAAW3C,MAAK2C,WACd,CAAA3C,GAAE,SAAS;AAEd;AAED,IAAa8D,iBAAe,CAAI3C,MAAmB,SAAS,MAAc;AACxE,QAAM/C,KAAI,GAAI,KAAK,OAAO,MAAA,CAAO,MAAQ,KAAK,QAAQ,KAAK,UAAU,KAAK,KAAA,IAAS,GAAG;AACtF,SAAO,KAAK,cAAc,SAAS,IACjCA,KACA;IACA,KAAK,cAAc,IAAI,CAACiC,OAAMyD,eAAazD,IAAG,SAAS,CAAA,CAAE,EAAE,KAAK;CAAI,IAClEjC;AACL;AAED,UAAiB2F,cAAevB,QAAmBwB,mBAA6D,QAAQ,GAAoC;AAC1J,aAAWhE,MAAK0C,OAAK,eAAe;AAClC,UAAM5E,UAAQkC,GAAE;AAChB,QAAIlC,YAAU,OAAW;AACzB,QAAI,kBAAkBA,SAAO,KAAA,GAAQ;AACnC,YAAMkC,GAAE;AACR,aAAO+D,cAAY/D,IAAG,mBAAmB,QAAQ,CAAA;IAClD;EACF;AACF;;;;;;;;;;;;;;;ACjhBD,SAAgB,mBAAmBiE,UAAyC;AAC1E,MAAIT,SAAQ,WAAW,EAAG,QAAO;AACjC,MAAIpF,KAAI;AACR,aAAW,CAAE,OAAO,KAAA,KAAWoF,SAAQ,QAAA,GAAW;AAChD,IAAApF,MAAK,KAAK,OAAO,KAAA;AACjB,IAAAA,MAAK,MAAM,OAAO,QAAQ,KAAK,UAAU,MAAM,SAAA,IAAa;;EAC7D;AACD,SAAOA;AACR;AAYD,IAAa,cAAc,CACzB8F,MACA,SAAS,GACTC,UAAoC,CAAE,MAC3B;AACX,cAAY,cAAc,MAAM,MAAM,CAAC;AACvC,QAAM,cAAc,QAAQ,QAAQ;AACpC,QAAM,QAAQ,cAAc,MAAM,WAAA;AAClC,QAAM/F,KAAI,GAAI,KAAK,OAAO,MAAA,CAAO,YAAc,MAAM,IAAA,WAAiB,KAAK,UAAU,MAAM,SAAA,CAAU;AACrG,QAAM,kBAAkB,CAAE,GAAG,SAAS,MAAM,OAAA,CAAU;AACtD,SAAO,gBAAgB,SAAS,IAC9BA,KACA;IACA,gBAAgB,IAAI,CAACiC,OAAM,YAAYA,GAAE,WAAqB,SAAS,GAAG;IAAE,GAAG;IAAS,MAAMA,GAAE;EAAM,CAAA,CAAC,EAAE,KAAK;CAAI,IAChHjC;AACL;AAQD,IAAa0F,iBAAe,CAACM,MAAiE,SAAS,MAAM;AAC3G,MAAIhG,KAAI,IAAI,OAAO,MAAA,IAAU,IAAK,KAAK,OAAO,IAAA;AAC9C,MAAI,KAAK,UAAU,QAAW;AAC5B,QAAI,iBAAiB,KAAK,SAAS,eAAe,KAAK,OAAO;AAC5D,UAAI,cAAc,mBAAmB,KAAK,MAAM,aAAa,EAAA;AAC7D,YAAM,YAAY,mBAAmB,KAAK,MAAM,WAAW,EAAA;AAC3D,oBAAc,gBAAgB,YAAY,KAAK,aAAa;AAC5D,MAAAA,MAAK,MAAO,SAAA,IAAe,WAAA;IAC5B,WAAU,iBAAiB,KAAK,SAAS,KAAK,MAAM,gBAAgB,OAAW,CAAAA,MAAK,MAAO,KAAK,MAAM,WAAA;AAEvG,QAAI,eAAe,KAAK,MAEtB,CAAAA,MAAK,gBAAkB,KAAK,MAAM,UAAW,KAAK,IAAI,CAAC;EAE1D;AACD,EAAAA,MAAK;;AACL,aAAW4B,MAAK,KAAK,cACnB,CAAA5B,MAAK0F,eAAa9D,IAAG,SAAS,CAAA;AAEhC,SAAO5B;AACR;AAqED,UAAiB,SACf8F,MACAC,UAAoC,CAAE,GACC;AACvC,cAAY,cAAc,MAAM,MAAM,CAAC;AAEvC,QAAM,kBAAkB,QAAQ,UAAU;AAE1C,QAAM,gBAAgB,CAACE,OAAsD;AAC3E,QAAI,oBAAoB,OAAQ,QAAO,CAAE,MAAM,YAAY7F,EAAA,CAAI;aACtD,oBAAoB,YAAY,YAAYA,EAAA,EAAI,QAAO,CAAE,MAAM,IAAM;aACrE,oBAAoB,cAAc,CAAC,YAAYA,EAAA,EAAI,QAAO,CAAE,MAAM,KAAO;AAClF,WAAO,CAAE,OAAO,YAAYA,EAAA,CAAI;EACjC;AAED,MAAI,MAAM,QAAQ,IAAA,EAEhB,YAAW,CAAE,OAAO,OAAA,KAAa,KAAK,QAAA,GAAW;AAC/C,UAAM8F,KAAI,cAAc,OAAA;AACxB,QAAIA,GAAG,CAAA,EACL,OAAM;MAAE,MAAM,MAAM,SAAA;MAAY,OAAO;MAAS,aAAa;MAAS,WAAWA,GAAG,CAAA,IAAM,UAAU;IAAW;EAGlH;WACQ,OAAO,SAAS,UAAU;AACnC,UAAM,cAAe,aAAa,OAAS,KAA8B,QAAA,IAAY,OAAO,QAAQ,IAAA;AACpG,eAAW,CAAE,MAAMxG,OAAAA,KAAW,aAAa;AAEzC,YAAM,CAAEyG,SAAQC,aAAAA,IAAgB,cAAc1G,OAAAA;AAC9C,UAAIyG,QACF,OAAM;QAAQ;QAAM,OAAO;QAAS,aAAazG;QAAO,WAAW0G,gBAAc1G,UAAQ;MAAW;IAEvG;EACF;AACF;AAED,UAAiBuE,aAAW6B,MAAcC,UAAoC,CAAE,GAAEM,YAAsB,CAAE,GAAsD;AAC9J,aAAWzE,MAAK,SAAS,MAAM,OAAA,GAAU;AAEvC,UAAM;MAAE,GAAGA;MAAG,WAAW,CAAE,GAAG,SAAW;MAAE,OAAO;IAAmB;AACrE,WAAOqC,aAAWrC,GAAE,aAAuB,SAAS,CAAE,GAAG,WAAWA,GAAE,IAAM,CAAA;EAC7E;AACF;AAQD,SAAS,YACP0E,MACAR,MACiC;AACjC,aAAW7D,MAAK,SAAS,IAAA,EACvB,KAAIA,GAAE,SAAS,KAAM,QAAOA;AAE/B;AA4BD,SAAgB,UACdsE,OACAT,MACAU,UAAkC,CAAE,GACF;AAElC,QAAMpG,KAAI,OAAK,YAAYqG,OAAM,MAAM,OAAA,CAAQ;AAC/C,MAAI,CAACrG,GAAG,OAAM,IAAI,MAAM,yBAA0BqG,KAAA,GAAQ;AAC1D,SAAOrG;AACR;AAkCD,UAAiB,YACfmG,OACAT,MACAU,UAAkC,CAAE,GACQ;AAC5C,cACE,cAAcC,OAAM,MAAM,GAC1B,cAAc,MAAM,MAAM,CAAC;AAG7B,QAAM,YAAY,QAAQ,aAAa;AAEvC,QAAM,YAAYA,MAAK,MAAM,SAAA;AAE7B,QAAMJ,YAAsB,CAAE;AAC9B,aAAWrC,MAAK,WAAW;AACzB,UAAM,QAAQ,YAAYA,IAAG,IAAA;AAiB7B,QAAI,CAAC,OAAO;AACV,YAAM;QAAE,MAAMA;QAAG,aAAa;QAAW,WAAW;QAAW;QAAW,OAAO;MAAmB;AACpG;IACD;AACD,WAAO,MAAM;AACb,UAAM;MAAE,GAAG;MAAO,WAAW,CAAE,GAAG,SAAW;MAAE,OAAO;IAAmB;AACzE,cAAU,KAAKA,EAAA;EAChB;AACF;AAoDD,IAAa,uBAAuB,CAAC8B,MAAcC,UAAoC,CAAE,GAAEM,YAAsB,CAAE,GAAEK,WAAoG;AACvN,QAAM,OAAO,QAAQ,QAAQ;AAC7B,QAAMC,KAAgD;IACpD,CAAC,WAAW;AACV,iBAAW,EAAE,MAAM,WAAW,aAAa,UAAA,KAAe,SAAS,MAAM,OAAA,EACvE,OAAM,qBAAqB,aAAuB;QAAE,GAAG;QAAS,MAAM;MAAW,GAAE,CAAE,GAAG,WAAW,IAAM,GAAE3G,EAAA;IAE9G;IACD,YAAY;AACV,aAAO;IACR;IACD,WAAW;AACT,aAAO;QAAE;QAAM,aAAa;QAAM;QAAW,OAAO;MAAgB;IACrE;IACD,cAAc;AACZ,aAAO;IACR;EACF;AACD,SAAOA;AACR;AAQD,IAAa,gBAAgB,CAAC8F,MAAcc,YAAsD;AAChG,SAAA1D,MAA4B2D,SAAO,MAAM,OAAA,CAAQ;AAClD;AAmDD,IAAaA,WAAS,CAACf,MAAcc,UAAkC,CAAE,MAA0C;AACjH,QAAM,iBAAiB,QAAQ,kBAAkB;AAEjD,QAAM,WAAW,iBAAiB,CAACX,OAAW;AAAE,QAAI,YAAY7F,EAAA,EAAI,QAAOA;EAAI,IAAG,CAAC6F,OAAW7F;AAC9F,SAAO,WAAW,MAAM,SAAS,IAAA,GAAO,SAAS,CAAE,CAAA;AACpD;AAED,IAAM,aAAa,CAAmB0G,aAAgBC,WAAcH,UAAkC,CAAE,GAAEP,cAA6D;AACrK,QAAM,cAAc,QAAQ,QAAQ;AAEpC,QAAMW,KAAA,KAAoD;IAAE,MAAM;IAAa,aAAa;IAAW,WAAW,CAAE,GAAG,SAAW;IAAE,OAAO;EAAgB,CAAA;AAC3J,cAAY,CAAE,GAAG,WAAW,WAAa;AACzC,aAAWpF,MAAK,SAAS,aAAa,OAAA,GAAU;AAC9C,UAAMxB,KAAI,QAAQ,iBAAiBwB,GAAE,YAAYA,GAAE;UAC/B,WAAWA,GAAE,aAAaxB,IAAG;MAAE,GAAG;MAAS,MAAMwB,GAAE;IAAM,GAAE,SAAA,GAAYoF,EAAA;EAC5F;AACD,SAAOA;AACR;AAQD,IAAa,mBAAmB,CAAClB,MAAcc,UAAkC,CAAE,MAAgD;AACjI,SAAA,eAAsCC,SAAO,MAAM,OAAA,CAAQ;AAC5D;AASD,SAAS,cAAcf,MAAc,cAAc,IAAyB;AAC1E,MAAI,UAAU,QAAQ,eAAe,QAAQ,iBAAiB,KAAM,QAAO;IACzE,MAAM,KAAK;IACX,OAAO;IACP,WAAW,KAAK;IAChB,aAAa,KAAK;EACnB;AACD,MAAI,UAAU,KACZ,QAAO;IAAE,MAAM,KAAK;IAAgB,WAAW;IAAM,aAAa;IAAM,OAAO;EAAS;AAE1F,SAAO;IAAE,MAAM;IAAa,WAAW;IAAM,aAAa;IAAM,OAAO;EAAS;AACjF;;;;;;;;;;;ACzbD,IAAae,WAAS,CAAII,WAA8B,CAAE,MAAK;AAC7D,MAAIC;AAEJ,QAAMnD,QAAM,CAACX,SAAUmD,UAAiB;AACtC,UAAMpE,KAAI,eAAezC,SAAO+G,OAAMnC,QAAM,QAAA;AAC5C,QAAIA,WAAS,OACXA,UAAAA,QAA+BnC,EAAA;EAElC;AAED,QAAMgF,gBAAc,MAAM;AACxB,QAAI7C,WAAS,OAAW,QAAO;AAC/B,WAAA,eAAoCA,MAAAA;EACrC;AAED,QAAM,WAAW,CAACiC,UAAgC;AAChD,QAAIjC,WAAS,OAAW;AACxB,WAAO,YAAYmC,OAAMnC,QAAM,QAAA;EAChC;AAED,QAAMT,WAAS,CAAC0C,UAA0B;AACxC,QAAIjC,WAAS,OAAW,QAAO;AAC/B,WAAO,aAAamC,OAAMnC,QAAM,QAAA;EACjC;AAED,QAAM,UAAU,CAACiC,UAA0B;AACzC,QAAIjC,WAAS,OAAW,QAAO;AAC/B,UAAM1C,KAAI,gBAAgB6E,OAAMnC,QAAM,QAAA;AACtC,WAAO1C,OAAM;EACd;AAED,QAAM,UAAU,CAAC2E,UAA8C;AAC7D,QAAIjC,WAAS,OAAW;AACxB,UAAM1C,KAAI,gBAAgB6E,OAAMnC,QAAM,QAAA;AACtC,WAAO1C;EACR;AAED,QAAM0D,mBAAiB,CAACiB,UAAyB;AAC/C,QAAIjC,WAAS,OAAW,QAAO;AAC/B,UAAM1C,KAAI,gBAAgB6E,OAAMnC,QAAM,QAAA;AACtC,QAAI1C,OAAM,OAAW,QAAO;AAC5B,WAAOA,GAAE,cAAc;EACxB;AAED,QAAM,YAAY,CAAC2E,UAAsB;AACvC,QAAIjC,WAAS,OAAW,QAAO,CAAE;AACjC,WAAO,aAAamC,OAAMnC,QAAM,QAAA;EACjC;AAED,QAAM8C,YAAU,MAAM;AACpB,WAAO9C;EACR;AACD,QAAM,cAAc,CAACiC,UAA0B;AAC7C,QAAIjC,WAAS,OAAW,QAAO;AAC/B,WAAO,kBAAkBmC,OAAMnC,QAAM,QAAA;EACtC;AACD,SAAO;IAAE,SAAA;IAAS,KAAA;IAAK,aAAA;IAAa,QAAA;IAAQ;IAAU;IAAW;IAAS,gBAAA;IAAgB;IAAS;EAAa;AACjH;AAuBD,IAAa,iBAAiB,CAAIlB,SAAUmD,OAAcc,MAAwBJ,WAA8B,CAAE,MAAsB;AACtI,QAAM,YAAY,SAAS,aAAa;AACxC,QAAM,gBAAgB,SAAS,cAAc;AAC7C,QAAM,QAAQR,MAAK,MAAM,SAAA;AACzB,MAAIa,SAAQ;AACZ,aAAWtD,MAAK,OAAO;AACrB,UAAM,YAAYsD,WAAU,MAAM,SAAS;AAE3C,UAAM,QAAQ,iBAAiBtD,IAAG,IAAA;AAClC,QAAI,UAAU,QAAW;AAEvB,YAAMuD,WAA6B;QACjC,OAAQ,YAAY7H,UAAQ;QAC5B,OAAOsE;MACR;AACD,aAAA,WAAkC,UAAU,IAAA;IAC7C,OAAM;AACL,aAAO;AACP,UAAI,UACF,SAAQ,eAAR;QACE,KAAK;AACH;QAEF,KAAK,SAAS;AACZ,gBAAM,WAAW,kBAAkB,IAAA;AACnC,eAAK,QAAQ;YACX,QAAQ,CAAE,GAAG,UAAUtE,OAAO;YAC9B,OAAOsE;UACR;AACD;QACD;QACD,KAAK,aAAa;AAChB,eAAK,QAAQ;YACX,OAAA;YACA,OAAOA;UACR;AACD;QACD;MACF;UAGD,QAAO;IAEV;AACD,IAAAsD;EACD;AACD,MAAI,SAAS,OAAW,OAAM,IAAI,MAAM,uBAAuB;AAC/D,SAAO;AACR;AAED,IAAa,eAAe,CAAIf,OAAciB,QAAuBP,WAA8B,CAAE,MAAc;AACjH,MAAI3C,WAAS,OAAW,QAAO;AAC/B,QAAM1C,KAAI,gBAAgB6E,OAAMnC,QAAM,QAAA;AACtC,MAAI1C,OAAM,OAAW,QAAO;UACLA,EAAA;AACvB,SAAO;AACR;AAED,IAAa,oBAAoB,CAAI2E,OAAciB,QAAuBP,WAA8B,CAAE,MAAc;AACtH,MAAI3C,WAAS,OAAW,QAAO;AAC/B,QAAM1C,KAAI,gBAAgB6E,OAAMnC,QAAM,QAAA;AACtC,MAAI1C,OAAM,OAAW,QAAO;AAC5B,EAAAA,GAAE,QAAQ;IACR,OAAOA,GAAE,OAAO,SAAS;IACzB,OAAO;EACR;AACD,SAAO;AACR;AACD,IAAa,uBAAuB,CAAI2E,OAAckB,MAAuBR,WAA8B,CAAE,MAAa;AACxH,MAAI,SAAS,OAAW,QAAO;AAC/B,QAAMrF,KAAI,gBAAgB6E,OAAM,MAAM,QAAA;AACtC,MAAI7E,OAAM,OAAW,QAAO;AAC5B,SAAOA,GAAE,cAAc;AACxB;AAMD,IAAM,mBAAmB,CAAI8F,OAAeC,SAAmE;AAC7G,MAAI,SAAS,OAAW,QAAO;AAC/B,MAAI,UAAU,OAAW,OAAM,IAAI,MAAM,uCAAuC;AAChF,MAAI,KAAK,OAAO,UAAU,MAAO,QAAO;AACxC,aAAW/F,MAAK,KAAK,cACnB,KAAIA,GAAE,OAAO,UAAU,MAAO,QAAOA;AAExC;AAED,IAAa,cAAc,CAAI2E,OAAckB,MAAuBR,WAA8B,CAAE,MAAoB;AACtH,QAAMW,UAAS,aAAanB,OAAM,MAAM,QAAA;AACxC,MAAImB,QAAO,WAAW,EAAG,QAAO;AAChC,MAAIA,QAAO,SAAS,EAAG,OAAM,IAAI,MAAM,gDAAgD;AACvF,SAAOA,QAAQ,CAAA;AAChB;AAED,IAAM,oBAAoB,CAAIC,OAA4B;AACxD,MAAIjG,GAAE,UAAU,OAAW,QAAO,CAAE;AACpC,MAAI,YAAYA,GAAE,MAAO,QAAOA,GAAE,MAAM;AACxC,MAAI,WAAWA,GAAE,OAAO;AACtB,QAAIA,GAAE,MAAM,UAAU,OAAW,QAAO,CAAE;AAC1C,WAAO,CAAEA,GAAE,MAAM,KAAO;EACzB;AACD,SAAO,CAAE;AACV;AAED,IAAM,kBAAkB,CAAI2E,OAAckB,MAAuBR,WAA8B,CAAE,MAAK;AACpG,QAAM,YAAY,SAAS,aAAa;AACxC,QAAM,QAAQR,MAAK,MAAM,SAAA;AACzB,MAAIqB,KAAiC;AACrC,aAAW9D,MAAK,OAAO;AACrB,IAAApC,KAAI,iBAAiBoC,IAAGpC,EAAA;AACxB,QAAIA,OAAM,OACR;EAEH;AACD,SAAOA;AACR;AAED,IAAa,eAAe,CAAI2E,OAAckB,MAAuBR,WAA8B,CAAE,MAAU;AAC7G,QAAM,YAAY,SAAS,aAAa;AACxC,QAAM,QAAQR,MAAK,MAAM,SAAA;AACzB,MAAIqB,KAAiC;AACrC,aAAW9D,MAAK,OAAO;AAErB,IAAApC,KAAI,iBAAiBoC,IAAGpC,EAAA;AACxB,QAAIA,OAAM,OAER,QAAO,CAAE;EAEZ;AACD,SAAO,kBAAkBA,EAAA;AAC1B;;;;;;;;;;;;;;;;;;;;;;;;;;;AChQD,IAAa,iBAAiB,CAAImG,SAAqC;AACrE,SAAO,CAAE,GAAG,KAAK,SAAA,CAAY,EAAC;AAC/B;AASD,IAAa,eAAe,CAC1BC,OACAC,gBACArF,OACY;AACZ,SAAO,UAAU,OAAO,gBAAgB,IAAI,OAAO,gBAAA;AACpD;AAED,IAAa,oBAAoB,CAC/BoF,OACAE,qBACAC,OACY;AACZ,MAAI,OAAO,UAAU,YAAa,OAAM,IAAI,UAAU,4BAA4B;AAElF,SAAO,eAAsB,OAAO,qBAAqB,IAAI,OAAO,gBAAA;AACrE;AAED,IAAa,uBAAuB,CAClCC,OACAC,qBACAC,OACwC;AACxC,SAAO,kBAAkB,OAAO,qBAAqB,IAAI,OAAO,gBAAA;AACjE;AAWD,IAAa,YAAY,CACvBN,OACAC,gBACA3G,KAAiB,gBACjB,WAAW,MACC;AACZ,MAAI,WAAW,EAAG,QAAO;AACzB,QAAM,cAAc,cAAc,KAAA;AAClC,QAAM,eAAe,cAAc,cAAA;AACnC,QAAM0C,KAAK,cAAc,MAAM,UAAA,IAAc,MAAM;AACnD,MAAI,OAAOA,OAAM,YAAa,QAAO;AACrC,MAAI,GAAGA,IAAG,cAAA,EAAiB,QAAO;AAGlC,QAAM,MAAM,cAAeA,GAA0B,YAAA,IAAiBA,GAAmB;AAEzF,QAAM,OAAO,eAAgB,eAAgB,YAAA,IAAiB,eAAuC;AAGrG,MAAI,GAAG,KAAK,IAAA,EAAO,QAAO;AAE1B,SAAO,UAAUA,IAAG,gBAAgB,IAAI,WAAW,CAAA;AACpD;AAaD,IAAa,iBAAiB,CAC5BgE,OACAE,qBACAK,KAAkB,gBAClB,WAAW,MACC;AACZ,MAAI,UAAU,OAAW,OAAM,IAAI,MAAM,4BAA4B;AACrE,MAAI,WAAW,EACb,QAAO;AAET,QAAMvE,KAAI,eAAe,QAAQ,MAAM,UAAA,IAAc,MAAM;AAC3D,MAAIA,OAAM,OACR,QAAO;AAET,QAAMtE,UAAQ,cAAcsE,KAAIA,GAAE,SAAA,IAAaA,GAAE;AAEjD,MAAI,GAAGtE,SAAQ,mBAAA,EAAsB,QAAO;AAC5C,SAAO,eAAesE,IAAG,qBAAqB,IAAI,WAAW,CAAA;AAC9D;AAED,IAAa,oBAAoB,CAC/BgE,OACAE,qBACAK,KAAkB,gBAClB,WAAW,MACO;AAClB,MAAI,WAAW,EAAG;AAClB,QAAMvE,KAAK,eAAe,QAAQ,MAAM,UAAA,IAAc,MAAM;AAC5D,MAAIA,OAAM,OAAW;AACrB,QAAMtE,UAAQ,cAAcsE,KAAIA,GAAE,SAAA,IAAaA,GAAE;AAEjD,MAAI,GAAGtE,SAAQ,mBAAA,EAAsB,QAAOsE;AAC5C,SAAO,kBAAkBA,IAAG,qBAAqB,IAAI,WAAW,CAAA;AACjE;AAcD,IAAa,gBAAgB,CAC3BwE,QACAC,kBACAC,KAAkC,mBAC/B;AAEH,MAAI,GAAG,QAAQ,gBAAA,EAAmB,OAAM,IAAI,MAAM,qBAAqB;AACvE,MAAI,YAAY,QAAQ,kBAAkB,EAAA,EACxC,OAAM,IAAI,MAAM,oCAAoC;AAEtD,MAAI,YAAY,kBAAkB,QAAQ,EAAA,EACxC,OAAM,IAAI,MAAM,gDAAgD;AAEnE;AAUD,IAAa,cAAc,CACzBC,QACAC,eACAtH,KAAiB,mBACL;AACZ,SAAO,SAAS,QAAQ,eAAe,IAAI,OAAO,gBAAA;AACnD;AAED,IAAa,mBAAmB,CAC9BkH,QACAK,oBACAvH,KAAiB,mBACL;AACZ,SAAO,cAAc,QAAQ,oBAAoB,IAAI,OAAO,gBAAA;AAC7D;AAoBD,IAAa,WAAW,CACtBqH,QACAC,eACAtH,KAAiB,gBACjB,WAAW,MACC;AAEZ,MAAI,WAAW,EAAG,QAAO;AACzB,MAAI,GAAG,QAAQ,aAAA,EAAgB,QAAO;AACtC,QAAM,MAAM,iBAAiB,SAAS,OAAO,YAAA,IAAgB,OAAO;AACpE,QAAM,OAAO,iBAAiB,gBAAgB,cAAc,YAAA,IAAgB,cAAc;AAC1F,MAAI,GAAG,KAAK,IAAA,EAAO,QAAO;AAC1B,aAAWM,MAAK,aAAa,QAAQ,QAAA,GAAW;AAC9C,UAAM,MAAM,iBAAiBA,KAAIA,GAAE,YAAA,IAAgBA,GAAE;AACrD,QAAI,GAAGA,IAAG,aAAA,EAAgB,QAAO;AACjC,QAAI,GAAG,KAAK,IAAA,EAAO,QAAO;EAC3B;AACD,SAAO;AACR;AAED,IAAa,gBAAgB,CAC3B4G,QACAM,eACAxH,KAAiB,gBACjB,WAAW,MACC;AAEZ,MAAI,WAAW,EAAG,QAAO;AAEzB,MAAI,GAAG,OAAO,SAAA,GAAY,aAAA,EAAgB,QAAO;AACjD,aAAWM,MAAK,aAAa,QAAQ,QAAA,GAAW;AAC9C,UAAMxB,KAAIwB,GAAE,SAAA;AACZ,QAAI,GAAGxB,IAAG,aAAA,EAAgB,QAAO;EAClC;AACD,SAAO;AACR;AAaD,UAAiB,SAAY2I,MAAgE;AAC3F,QAAM/E,KAAI,KAAK,UAAA;AACf,MAAIA,OAAM,OAAW;AACrB,aAAWgF,MAAKhF,GAAE,SAAA,GAAY;AAC5B,QAAIgF,OAAM,KAAM;AAChB,UAAMA;EACP;AACF;AAgBD,UAAiB,QAA0DC,MAA8B;AACvG,MAAI,cAAc,IAAA,GAAO;AACvB,QAAIjF,KAAI,KAAK,UAAA;AACb,WAAOA,OAAM,QAAW;AACtB,YAAMA;AACN,MAAAA,KAAIA,GAAE,UAAA;IACP;EACF,OAAM;AACL,QAAIA,KAAI,KAAK;AACb,WAAOA,OAAM,QAAW;AACtB,YAAMA;AACN,MAAAA,KAAIA,GAAE;IACP;EACF;AACF;AAmBD,SAAgB,oBAAsE2E,QACpFO,eACAX,KAAkB,gBACH;AACf,SAAO,iBAAiB,QAAQ,eAAe,IAAI,OAAO,gBAAA;AAC3D;AAuBD,SAAgB,iBAAmEI,QACjFO,eACAX,KAAkB,gBAClB,WAAW,GACI;AAEf,MAAI,WAAW,EAAG;AAClB,QAAM,WAAW,cAAc,MAAA;AAC/B,MAAI,UACF;QAAI,GAAG,OAAO,SAAA,GAAY,aAAA,EAAgB,QAAO;EAAO,WAEpD,GAAG,OAAO,OAAQ,aAAA,EAAgB,QAAO;AAG/C,aAAWtG,MAAK,aAAoB,QAAQ,QAAA,EAE1C,KAAI,UACF;QAAI,GAAIA,GAA0B,SAAA,GAAY,aAAA,EAAgB,QAAOA;EAAE,WAEnE,GAAIA,GAAmB,OAAQ,aAAA,EAAgB,QAAOA;AAG9D;AACD;AAaD,UAAiB,WAA6DkH,QAAuB;AACnG,MAAI,CAAC7E,OAAM;AACX,QAAM,QAAQ,IAAI,aAAA;AAClB,MAAI8E,QAAuB9E;AAC3B,SAAO,OAAO;AACZ,UAAMc,WAAU,cAAc,KAAA,IAC5B,CAAE,GAAG,MAAM,SAAA,CAAY,IACvB,CAAE,GAAG,MAAM,aAAe;AAC5B,UAAM,KAAK,GAAGA,QAAA;AACd,QAAI,MAAM,QAAS;AACnB,YAAQ,MAAM,IAAA;AACd,QAAI,MAAO,OAAM;EAClB;AACF;AA6BD,UAAiB,aAA+D+D,QAAS,QAAQ,OAAO,kBAAuC;AAC7I,MAAI,CAAC7E,OAAM;AACX,QAAM,SAAS,cAAcA,MAAAA;AAC7B,QAAM,QAAQ,SAAS,IAAIrE,cAAA,IAAqC,IAAIA,cAAA;AAEpE,MAAImJ,QAAuB9E;AAC3B,SAAO,OAAO;AACZ,QAAI,QAAQ,EAAG;AACf,QAAI,UAAU,QAAW;AACvB,YAAM,OAAO,mBAAmB,QAAQ,MAAM,gBAAgB,MAAM,SAAA;AACpE,iBAAW1C,MAAK,MAAM;AACpB,cAAMA;AACN,cAAM,QAAQA,EAAA;MACf;IACF;AACD,YAAQ,MAAM,QAAA;AACd;EACD;AACF;AAWD,SAAgByH,MAAQC,QAA0BC,WAAkDC,QAA6B,WAA2C;AAC1K,MAAI,UAAUlF,MAAAA,EAAO,QAAOA;AAC5B,QAAM,OAAO,UAAU,YAAY,eAAe;AAClD,aAAW1C,MAAK,KAAK0C,MAAAA,EACnB,KAAI,UAAU1C,EAAA,EAAI,QAAOA;AAE5B;AAeD,SAAgB,YAAe0H,QAA0BG,WAAsCD,QAA6B,WAA2C;AACrK,MAAI,UAAUlF,OAAK,SAAA,CAAU,EAAG,QAAOA;AACvC,QAAM,OAAO,UAAU,YAAY,eAAe;AAElD,aAAW1C,MAAK,KAAK0C,MAAAA,EACnB,KAAI,UAAU1C,GAAE,SAAA,CAAU,EAAG,QAAOA;AAEvC;AAqCD,UAAiB,YAAe0H,QAA0B1D,mBAA6D,QAAQ,GAAwB;AACrJ,aAAWhE,MAAK0C,OAAK,SAAA,EACnB,KAAI,kBAAkB1C,GAAE,SAAA,GAAY,KAAA,GAAQ;AAC1C,UAAMA,GAAE,SAAA;AACR,WAAO,YAAYA,IAAG,mBAAmB,QAAQ,CAAA;EAClD;AAEJ;AAED,SAAgB,aAAgBmH,MAA0B,QAAQ,GAAG;AACnE,MAAI,SAAS,OAAW,QAAO;AAC/B,MAAI,SAAS,KAAM,QAAO;AAC1B,QAAM3I,KAAI,KAAK,SAAA;AACf,MAAIsJ,OAAe,OAAOtJ;AAC1B,MAAI,MAAM,QAAQA,EAAA,EAAI,QAAO;AAC7B,MAAIJ,KAAI,KAAK,OAAO,KAAA,IAAS,UAAW,KAAK,UAAUI,EAAA,CAAE,KAAO,IAAA;;AAChE,aAAW+B,MAAK,KAAK,SAAA,EACnB,CAAAnC,MAAK,aAAamC,IAAG,QAAQ,CAAA;AAE/B,SAAOnC;AACR;AAED,SAAgB,YAAY,OAA+B;AACzD,MAAIA,KAAI;AACR,aAAW,QAAQ,OAAO;AACxB,UAAMI,KAAI,KAAK,SAAA;AACf,UAAM,UAAU,mBAAmBA,EAAA;AACnC,UAAMmE,aAAW,CAAE,GAAG,KAAK,SAAA,CAAY;AACvC,UAAM,SAAS,KAAK,UAAA;AACpB,QAAImF,OAAe,OAAOtJ;AAC1B,QAAI,MAAM,QAAQA,EAAA,EAAI,QAAO;AAC7B,IAAAJ,MAAK,UAAW,OAAA,KAAc,IAAA,WAAiBuE,WAAS,MAAA,cAAsB,SAAS,MAAM,GAAG;;EACjG;AACD,SAAOvE;AACR;;;;;;;;;;;;ACjgBD,IAAa,gBAAgB,CAAI2J,SAAoD;AACnF,MAAI,cAAc,IAAA,EAAO,QAAO;AAChC,MAAI,WAAW,IAAA,EAAO,QAAOC,uBAAsB,IAAA;AACnD,MAAI,OAAO,SAAS,SAAU,QAAOC,qBAAoB,IAAA;AACzD,QAAM,IAAI,MAAM,kCAAkC;AACnD;AASD,IAAa,aAAa,CAACC,SAAqC;AAC9D,MAAI,YAAY,QAAQ,mBAAmB,QAAQ,WAAW,MAC5D;QAAI,MAAM,QAAQ,KAAK,aAAA,EAAgB,QAAO;EAAK;AAErD,SAAO;AACR;AASD,IAAa,gBAAgB,CAACA,SAA4C;AACxE,SAAQ,cAAc,QAAQ,eAAe,QAAQ,cAAc,QAAQ,iBAAiB;AAC7F;ACxCD,IAAa,iBAAb,MAAaC,gBAAgD;EAC1C;EAER;EAET,YAAYlJ,OAAkB,CAAE,GAAEmJ,OAAyB,CAAE,GAAE;AAC7D,SAAK,OAAO;AACZ,SAAK,OAAO;EACb;EAED,QAAQ,OAA4C;AAClD,WAAO,IAAID,gBACT,KAAK,MACL,KAAK,KAAK,MAAM,KAAK,MAAM,GAAG,KAAA,CAAM;EAEvC;EAED,MAA0B;AACxB,WAAO,IAAIA,gBAAkB,KAAK,MAAM,IAAI,KAAK,MAAM,KAAK,IAAA,CAAK;EAClE;EAED,QAAQ7I,KAA0B;AAChC,SAAK,KAAK,QAAQC,GAAA;EACnB;EAED,eAAeD,KAA0B;AACvC,KAAE,GAAG,KAAK,IAAM,EAAC,QAAA,EAAU,QAAQC,GAAA;EACpC;EAED,IAAI,UAAmB;AACrB,WAAOH,UAAQ,KAAK,MAAM,KAAK,IAAA;EAChC;EAED,IAAI,SAAkB;AACpB,WAAOC,SAAO,KAAK,MAAM,KAAK,IAAA;EAC/B;EAED,IAAI,OAAsB;AACxB,WAAOF,OAAK,KAAK,MAAM,KAAK,IAAA;EAC7B;EAED,IAAI,SAAiB;AACnB,WAAO,KAAK,KAAK;EAClB;AACF;AAyBD,IAAakJ,cAAY,CACvBC,UAAqB,CAAE,MACpB,kBACoB,IAAI,eAAe,EAAE,GAAG,QAAS,GAAE,CAAE,GAAG,aAAe,CAAA;;;;;;;;;;;;;;AEpEhF,IAAavJ,YAAU,CACrBwJ,cACmB,IAAI,iBAAiB,SAAA;AAK1C,IAAa,mBAAb,cACU,mBACkB;EAG1B,QAAQ,oBAAI,IAAA;EACZ;;;;;EAMA,YAAYC,WAAoC;AAC9C,UAAA;AACA,SAAK,YAAY,aAAa;EAC/B;;;;EAKD,IAAI,OAAO;AACT,WAAO,KAAK,MAAM;EACnB;;;;;EAMD,OAAOxC,SAAsB;AAE3B,QAAI,iBAAiB;AACrB,eAAWlI,WAASkI,SAAQ;AAC1B,YAAM,YAAY,KAAK,IAAIlI,OAAAA;AAC3B,WAAK,MAAM,IAAI,KAAK,UAAUA,OAAAA,GAAQA,OAAAA;AACtC,YAAM,UAAU,OAAO;QAAE,OAAOA;QAAO,SAAS;MAAW,CAAA;AAC3D,UAAI,CAAC,UAAW,kBAAiB;IAClC;AACD,WAAO;EACR;;;;;EAOD,SAAS;AACP,WAAO,KAAK,MAAM,OAAA;EACnB;;;;EAKD,QAAQ;AACN,SAAK,MAAM,MAAA;AACX,UAAM,UAAU,SAAS,IAAA;EAC1B;;;;;;EAOD,OAAO2K,IAAe;AACpB,UAAM,YAAY,KAAK,MAAM,OAAO,KAAK,UAAUjK,EAAA,CAAE;AACrD,QAAI,UAAW,OAAM,UAAU,UAAUA,EAAA;AACzC,WAAO;EACR;;;;;;EAOD,IAAIiK,IAAe;AACjB,WAAO,KAAK,MAAM,IAAI,KAAK,UAAUjK,EAAA,CAAE;EACxC;;;;;EAMD,UAAe;AACb,WAAO,CAAE,GAAG,KAAK,MAAM,OAAA,CAAU;EAClC;AACF;ACnGD,IAAa,qBAAb,MAAakK,oBAAkD;EACrD;EACA;EAGR,YAAYH,WAAyBI,QAAsB;AACzD,SAAK,QAAQC,UAAO,oBAAI,IAAA;AACxB,SAAK,YAAY,aAAa;EAC/B;EAED,IAAI,OAAe;AACjB,WAAO,KAAK,MAAM;EACnB;EAED,OAAO5C,SAAwC;AAC7C,UAAMoB,KAAI,IAAI,IAAe,KAAK,KAAA;AAClC,eAAW5I,MAAKwH,SAAQ;AACtB,YAAM,MAAM,KAAK,UAAUxH,EAAA;AAC3B,MAAA4I,GAAE,IAAI,KAAK5I,EAAA;IACZ;AACD,WAAO,IAAIkK,oBAAsB,KAAK,WAAWtB,EAAA;EAClD;EAED,OAAOqB,IAAwB;AAC7B,UAAMrB,KAAI,IAAI,IAAe,KAAK,KAAA;AAClC,UAAM,MAAM,KAAK,UAAU5I,EAAA;AAC3B,QAAI4I,GAAE,OAAO,GAAA,EAAM,QAAO,IAAIsB,oBAAmB,KAAK,WAAWtB,EAAA;AACjE,WAAO;EACR;EAED,IAAIqB,IAAe;AACjB,UAAM,MAAM,KAAK,UAAUjK,EAAA;AAC3B,WAAO,KAAK,MAAM,IAAI,GAAA;EACvB;EAED,UAAe;AACb,WAAO,CAAE,GAAG,KAAK,MAAM,OAAA,CAAU;EAClC;EAED,CAAC,SAAS;AACR,WAAO,KAAK,MAAM,OAAA;EACnB;AACF;AAQD,IAAa6J,cAAY,CACvBQ,YAAyB,oBACJ,IAAI,mBAAmB,SAAA;ACjC9C,IAAa,aAAb,MAAaC,YAAW;EACtB;EACA;EACA,WAAW,oBAAI,IAAA;EACf,SAAwB,CAAE;EAE1B,YAAY,WAAW,GAAG,QAAQ,GAAG;AACnC,SAAKC,SAAS;AACd,SAAKC,YAAY;EAClB;;;;;EAMD,YAAY;AACV,WAAO,KAAK,OAAO;EACpB;;;;;;EAOD,eAAe;AACb,WAAO,CAAE,GAAG,KAAK,SAAS,OAAA,CAAU,EAAC;EACtC;EAED,mBAAmB;AACjB,QAAI5K,KAAI,KAAK,aAAA;AACb,eAAW4B,MAAK,KAAK,SAAS,OAAA,EAC5B,CAAA5B,MAAK4B,GAAE,iBAAA;AAET,WAAO5B;EACR;;;;EAKD,OAAO;AACL,QAAI6K,KAAI,KAAK,OAAO;AACpB,eAAWC,UAAO,KAAK,SAAS,OAAA,EAC9B,CAAAD,MAAKC,OAAI,KAAA;AAEX,WAAOD;EACR;EAED,IAAIE,SAAe;AACjB,QAAI,OAAOrL,YAAU,SAAU,OAAM,IAAI,MAAM,wCAAyC,OAAOA,OAAAA,EAAQ;AAEvG,QAAIA,QAAM,WAAW,EAAG,OAAM,IAAI,MAAM,wBAAwB;AAEhE,UAAM,cAAc,KAAKsL,UAAUtL,SAAO,IAAA;AAC1C,QAAI,gBAAgB,MAAM;AACxB,UAAI,CAAC,KAAK,SAASA,OAAAA,EACjB,MAAK,OAAO,KAAKA,OAAAA;AAEnB;IACD;AAED,QAAI,CAAC,YAAa,OAAM,IAAI,MAAM,mCAAoCA,OAAAA,EAAQ;AAC9E,gBAAY,IAAIA,OAAAA;EACjB;EAED,OAAOqL,SAAwB;AAC7B,QAAI,OAAOrL,YAAU,SAAU,OAAM,IAAI,MAAM,wCAAyC,OAAOA,OAAAA,EAAQ;AACvG,QAAIA,QAAM,WAAW,EAAG,OAAM,IAAI,MAAM,wBAAwB;AAEhE,UAAM,cAAc,KAAKsL,UAAUtL,SAAO,KAAA;AAC1C,QAAI,gBAAgB,OAAW,QAAO;AACtC,QAAI,gBAAgB,MAAM;AACxB,UAAI,KAAK,SAASA,OAAAA,GAAQ;AACxB,aAAK,SAAS,KAAK,OAAO,OAAO,CAAAU,OAAKA,OAAMV,OAAAA;AAC5C,eAAO;MACR;AACD,aAAO;IACR;AACD,WAAO,YAAY,OAAOA,OAAAA;EAC3B;EAED,YAAY;AACV,UAAMsH,KAAI,KAAKiE,aAAAA;AACf,eAAWC,OAAMlE,GACf,SAAQ,IAAIkE,GAAA;EAEf;EAED,aAAa,QAAQ,GAAG;AACtB,UAAMC,KAAmB,CAAE;AAC3B,IAAAnE,GAAE,KAAK,UAAW,KAAK2D,MAAAA,SAAiB,KAAKC,SAAAA,EAAY;AACzD,eAAW,CAAE,KAAKlL,OAAAA,KAAW,KAAK,SAAS,QAAA,GAAW;AACpD,YAAM,SAASA,QAAMuL,aAAa,QAAQ,CAAA;AAC1C,MAAAjE,GAAE,KAAK,SAAU,GAAA,EAAM;AACvB,iBAAW/E,MAAK,OACd,CAAA+E,GAAE,KAAK,IAAI,OAAO,QAAQ,CAAA,IAAK/E,EAAA;IAElC;AAED,IAAA+E,GAAE,KAAK,YAAa,KAAK,OAAO,MAAA,GAAU;AAC1C,eAAW5G,MAAK,KAAK,OACnB,CAAA4G,GAAE,KAAK,IAAK5G,EAAA,EAAI;AAElB,WAAO4G,GAAE,IAAI,CAAAxE,UAAQ,IAAI,OAAO,KAAA,IAASA,KAAA;EAC1C;EAED,UAAUuI,SAAeK,WAAiB;AACxC,QAAI1L,YAAU,OAAW,OAAM,IAAI,MAAM,yBAAyB;AAClE,QAAI,KAAKiL,WAAW,KAAKC,UAAW,QAAO;AAC3C,QAAIlL,QAAM,UAAU,KAAKiL,OAAQ,QAAO;AACxC,UAAMU,KAAI3L,QAAO,KAAKiL,MAAAA;AACtB,QAAIU,OAAM,OAAW,OAAM,IAAI,MAAM,uBAAwB,KAAKV,MAAAA,SAAiBjL,QAAM,MAAA,EAAS;AAClG,QAAI,QAAQ,KAAK,SAAS,IAAI2L,EAAA;AAC9B,QAAI,UAAU,UAAaxE,WAAQ;AACjC,cAAQ,IAAI6D,YAAW,KAAKE,WAAW,KAAKD,SAAS,CAAA;AACrD,WAAK,SAAS,IAAIU,IAAG,KAAA;IACtB;AACD,WAAO;EACR;;;;;;EAOD,SAASN,SAAe;AACtB,eAAW3K,MAAK,KAAK,OACnB,KAAIA,OAAMV,QAAO,QAAO;AAE1B,WAAO;EACR;EAED,IAAIqL,SAAwB;AAC1B,QAAI,OAAOrL,YAAU,SAAU,QAAO;AAEtC,UAAM,cAAc,KAAKsL,UAAUtL,SAAO,KAAA;AAC1C,QAAI,gBAAgB,OAAW,QAAO;AACtC,QAAI,gBAAgB,KAAM,QAAO,KAAK,SAASA,OAAAA;AAC/C,WAAO,YAAY,IAAIA,OAAAA;EACxB;AACF;;;;;;;;;AE7ID,IAAa,kBAAb,cAAwCO,cAAkE;EACxG,YAAYqL,OAAmC,CAAE,GAAE;AACjD,QAAI,KAAK,OAAO,OACd,QAAO;MACL,GAAG;MACH,IAAI,CAAC9J,IAAGC,OAAM;AACZ,eAAO,eAAeD,GAAE,MAAMC,GAAE,IAAA;MACjC;IACF;AAEH,UAAM,IAAA;EACP;;;;;;EAOD,oBAAoB8J,MAASC,YAAkB;AAC7C,gBAAY,WAAWC,YAAU,UAAU,CAAC;AAC5C,UAAM,QAAQ;MAAE;MAAM,UAAA;IAAU,CAAA;EACjC;EAED,eAAeF,MAASC,YAAkB,eAAe,OAAOE,IAAiB;AAC/E,QAAI,SAAS,OAAW,OAAM,IAAI,MAAM,0BAA0B;AAClE,QAAIC;AACJ,eAAW1J,MAAK,KAAK,KACnB,KAAI,IACF;UAAI,GAAGA,GAAE,MAAM,IAAA,GAAO;AACpB,mBAAWA;AACX;MACD;eAEG,KAAK,GAAGA,IAAG;MAAE;MAAM,UAAU;IAAG,CAAA,GAAG;AACrC,iBAAWA;AACX;IACD;AAGL,QAAI,aAAa,UAAa,CAAC,aAAc,OAAM,IAAI,MAAM,2CAA4C,KAAK,UAAU,IAAA,CAAK,EAAG;AAChI,QAAI,aAAa,OACf,MAAK,YAAY,CAAA,WAAQ,aAAa2J,MAAAA;AAExC,SAAK,oBAAoB,MAAMH,UAAAA;EAChC;EAED,aAA4B;AAE1B,UAAMI,KAAIC,KAAcC,MAAa,KAAK,MAAM,CAACvK,IAAGC,OAAMD,GAAE,YAAYC,GAAE,QAAA,CAAS;AAEnF,QAAIoK,OAAM,OAAW;AACrB,SAAK,YAAY,CAAA,SAAQ,SAASA,EAAA;AAClC,WAAOA,GAAE;EACV;EAED,aAA4B;AAC1B,UAAMA,KAAIC,KAAcC,MAAa,KAAK,MAAM,CAACvK,IAAGC,OAAMD,GAAE,YAAYC,GAAE,QAAA,CAAS;AAEnF,QAAIoK,OAAM,OAAW;AACrB,SAAK,YAAY,CAAA,SAAQ,KAAK,SAASA,EAAA;AACvC,WAAOA,GAAE;EACV;EAED,UAAyB;AACvB,UAAMA,KAAIC,KAAcC,MAAa,KAAK,MAAM,CAACvK,IAAGC,OAAMD,GAAE,YAAYC,GAAE,QAAA,CAAS;AAEnF,QAAIoK,OAAM,OAAW;AACrB,WAAOA,GAAE;EACV;EAED,UAAyB;AAEvB,UAAMA,KAAIC,KAAcE,MAAa,KAAK,MAAM,CAACxK,IAAGC,OAAMD,GAAE,YAAYC,GAAE,QAAA,CAAS;AACnF,QAAIoK,OAAM,OAAW;AACrB,WAAOA,GAAE;EACV;AACF;AAYD,SAAgB,SACdP,OAAmC,CAAE,GACX;AAC1B,SAAO,IAAI,gBAAgB,IAAA;AAC5B;ACzGD,IAAa,iBAAb,MAAaW,gBAAgD;EAClD;EACT;;;;;;EAOA,YAAYpM,OAAqB,CAAE,GAAEK,OAAqB,CAAE,GAAE;AAC5D,QAAI,SAAS,OAAW,OAAM,IAAI,MAAM,0BAA0B;AAElE,SAAK,OAAO;AACZ,SAAKgM,QAAQ;EACd;EAED,QAAQhL,KAAoB;AAE1B,aAAS,QAAQ,KAAKgL,MAAM,SAAS,GAAG,SAAS,GAAG,QAClD,CAAA/K,IAAG,KAAK+K,MAAO,KAAA,CAAA;EAElB;EAED,iBAAiBhL,KAAoB;AAGnC,SAAKgL,MAAM,QAAQ,CAAA,SAAQ;AAAE,MAAA/K,IAAG,IAAA;IAAO,CAAA;EACxC;EAED,WAAW,OAA8C;AACvD,WAAO,IAAI8K,gBACT,KAAK,MACL,QAAQ,KAAK,MAAM,KAAKC,OAAO,GAAG,KAAA,CAAM;EAE3C;EAED,UAA6B;AAC3B,WAAO,IAAID,gBAAkB,KAAK,MAAM,QAAQ,KAAK,MAAM,KAAKC,KAAAA,CAAM;EACvE;EAED,IAAI,UAAmB;AACrB,WAAO,QAAQ,KAAK,MAAM,KAAKA,KAAAA;EAChC;EAED,IAAI,SAAkB;AACpB,WAAO,OAAO,KAAK,MAAM,KAAKA,KAAAA;EAC/B;EAED,IAAI,SAAiB;AACnB,WAAO,KAAKA,MAAM;EACnB;EAED,IAAI,OAAsB;AACxB,WAAO,KAAK,KAAK,MAAM,KAAKA,KAAAA;EAC7B;EAED,UAAU;AACR,WAAO,CAAE,GAAG,KAAKA,KAAO;EACzB;AACF;AAuBD,IAAajC,cAAY,CACvBrJ,UAAwB,CAAE,MACvB,kBACoB;AACvB,YAAU,EAAE,GAAG,QAAS;AACxB,SAAO,IAAI,eAAe,SAAS,CAAE,GAAG,aAAe,CAAA;AACxD;;;;;;;;;;;;;;;;;AE5BD,IAAa,SAAS,CAAOuL,UAAgB,CAAE,MAC7C,IAAI,YAAY,OAAA;AA8DlB,IAAa,cAAb,cAAuC,mBAErC;EACQ;EACA;EAEA;EAEA;EACA;EACA;EACA,WAAW;EACnB,YAAYC,OAAa,CAAE,GAAE;AAC3B,UAAA;AACA,SAAK,WAAW,KAAK,YAAY;AAEjC,gBAAY,YAAY,KAAK,UAAU,WAAW,UAAU,CAAC;AAC7D,SAAK,QAAQ,oBAAI,IAAA;AAGjB,QAAI,KAAK,eAAe,KAAK,YAAY,EACvC,OAAM,IAAI,MAAM,kDAAkD;AAEpE,SAAK,cAAc,KAAK,eAAe;AACvC,SAAK,sBAAsB,KAAK,uBAAuB;AACvD,SAAK,mBAAmB,KAAK,oBAAoB;AAEjD,QAAI,KAAK,sBAAsB,EAC7B,MAAK,kBAAkB,YACrB,MAAM;AAAE,WAAKC,UAAAA;IAAc,GAC3B,KAAK,IAAI,KAAM,KAAK,sBAAsB,CAAA,CAAE;EAGjD;EAED,UAAU;AACR,QAAI,KAAK,SAAU;AACnB,SAAK,WAAW;AAChB,QAAI,KAAK,iBAAiB;AACxB,oBAAc,KAAK,eAAA;AACnB,WAAK,kBAAkB;IACxB;EACF;;;;EAID,IAAI,YAAY;AACd,WAAO,KAAK,MAAM;EACnB;EAED,CAAC,UAA4C;AAC3C,eAAW,SAAS,KAAK,MAAM,QAAA,EAC7B,OAAM,CAAE,MAAO,CAAA,GAAK,MAAO,CAAA,EAAI,KAAO;EAEzC;EAED,CAAC,SAA8B;AAC7B,eAAWjM,MAAK,KAAK,MAAM,OAAA,EACzB,OAAMA,GAAE;EAEX;EAED,CAAC,OAA4B;AAC3B,WAAO,KAAK,MAAM,KAAA;EACnB;;;;;;EAOD,WAAWkM,KAA4B;AACrC,UAAMlM,KAAI,KAAK,MAAM,IAAI,GAAA;AACzB,QAAI,OAAOA,OAAM,YAAa;AAC9B,WAAO,KAAK,IAAA,IAAQA,GAAE;EACvB;;;;;;EAOD,WAAWkM,KAA4B;AACrC,UAAMlM,KAAI,KAAK,MAAM,IAAI,GAAA;AACzB,QAAI,OAAOA,OAAM,YAAa;AAC9B,WAAO,KAAK,IAAA,IAAQA,GAAE;EACvB;;;;;;;EAQD,IAAIkM,KAAiB;AACnB,WAAO,KAAK,MAAM,IAAI,GAAA;EACvB;;;;;;;EAQD,IAAIA,KAAuB;AACzB,UAAMlM,KAAI,KAAK,MAAM,IAAI,GAAA;AACzB,QAAIA,IAAG;AACL,UAAI,KAAK,qBAAqB,YAAY,KAAK,qBAAqB,MAClE,MAAK,MAAM,IAAI,KAAK;QAClB,GAAGA;QACH,SAAS,YAAY,IAAA;MACtB,CAAA;AAEH,aAAOA,GAAE;IACV;EACF;;;;;;;;EASD,OAAOkM,KAAiB;AACtB,UAAM5M,UAAQ,KAAK,MAAM,IAAI,GAAA;AAC7B,QAAI,CAACA,QAAO,QAAO;AACnB,UAAMuC,KAAI,KAAK,MAAM,OAAO,GAAA;AAE5B,SAAK,UAAU,WAAW;MACxB;MACA,OAAOvC,QAAM;IACd,CAAA;AACD,WAAOuC;EACR;;;;;EAMD,QAAQ;AACN,SAAK,MAAM,MAAA;EACZ;;;;;;;;;EAUD,MAAMqK,KAAiB;AACrB,UAAMlM,KAAI,KAAK,MAAM,IAAI,GAAA;AACzB,QAAI,CAACA,GAAG,QAAO;AACf,SAAK,MAAM,IAAI,KAAK;MAClB,GAAGA;MACH,SAAS,KAAK,IAAA;MACd,SAAS,KAAK,IAAA;IACf,CAAA;AACD,WAAO;EACR;EAEO,iBAAgC;AACtC,QAAI,KAAK,gBAAgB,OAAQ;AACjC,QAAI,SAAS;AACb,QAAI,KAAK,gBAAgB,YAAa,UAAS;aACtC,KAAK,gBAAgB,YAAa,UAAS;QAC/C,OAAM,IAAI,MAAM,2BAA4B,KAAK,WAAA,EAAc;AACpE,UAAM,SAAS,oBAAoB,KAAK,OAAO,MAAA;AAC/C,WAAO,OAAQ,CAAA,EAAK,CAAA;EACrB;EAED,YAAY;AACV,QAAI,KAAK,qBAAqB,OAAQ;AACtC,SAAK,kBAAkB,KAAK,qBAAqB,KAAK,gBAAA;EACvD;;;;;;;;;;;;;;;EAgBD,kBACEmM,WACAC,UACkB;AAClB,UAAMpH,WAAU,CAAE,GAAG,KAAK,MAAM,QAAA,CAAW;AAC3C,UAAMqH,QAA0B,CAAE;AAClC,UAAM,aAAa,aAAaC,WAAU,GAAA;AAC1C,UAAM,MAAM,YAAY,IAAA;AACxB,eAAW,SAAStH,UAAS;AAC3B,YAAM,aAAa,MAAM,MAAO,CAAA,EAAI;AACpC,YAAM,aAAa,MAAM,MAAO,CAAA,EAAI;AACpC,YAAMuH,WACJ,aAAa,QACT,aACC,aAAa,QACZ,aACA,KAAK,IAAI,YAAY,UAAA;AAC7B,UAAIA,YAAW,WACb,OAAM,KAAK,CAAE,MAAO,CAAA,GAAK,MAAO,CAAA,EAAI,KAAO,CAAA;IAE9C;AAED,eAAW,SAAS,OAAO;AACzB,WAAK,MAAM,OAAO,MAAO,CAAA,CAAA;AAEzB,YAAM,iBAAiB;QACrB,KAAK,MAAO,CAAA;QACZ,OAAO,MAAO,CAAA;MACf;AACD,WAAK,UAAU,WAAW,cAAA;AAC1B,WAAK,UAAU,WAAW,cAAA;IAC3B;AACD,WAAO;EACR;;;;;;;;;;;;EAaD,IAAIL,KAAQ9M,SAAU;AACpB,UAAM,WAAW,KAAK,MAAM,IAAI,GAAA;AAEhC,QAAI,UAAU;AAEZ,WAAK,MAAM,IAAI,KAAK;QAClB,GAAG;QACH,SAAS,YAAY,IAAA;MACtB,CAAA;AACD;IACD;AAGD,QAAI,KAAK,cAAc,KAAK,YAAY,KAAK,WAAW,GAAG;AAEzD,YAAMoN,QAAM,KAAK,eAAA;AACjB,UAAI,CAACA,MACH,OAAM,IAAI,MAAM,+BAAgC,KAAK,QAAA,GAAY;AAEnE,YAAMC,aAAW,KAAK,MAAM,IAAID,KAAAA;AAChC,WAAK,MAAM,OAAOA,KAAAA;AAElB,UAAIC,YAAU;AACZ,cAAM,iBAAiB;UAAE,KAAA;UAAK,OAAOA,WAAS;QAAO;AACrD,aAAK,UAAU,WAAW,cAAA;AAC1B,aAAK,UAAU,WAAW,cAAA;MAC3B;IACF;AAGD,SAAK,MAAM,IAAI,KAAK;MAClB,SAAS;MACT,SAAS,YAAY,IAAA;MACrB,OAAOnN;IACR,CAAA;AAED,SAAK,UAAU,UAAU;MAAE;MAAK,OAAA;IAAO,CAAA;EACxC;AACF;AC7XD,IAAa,aAAa,CACxBoN,QACAC,cACwD;AACxD,aAAWC,MAAKxC,OAAI,QAAA,GAAW;AAC7B,UAAM9K,UAAQsN,GAAG,CAAA;AACjB,eAAW,YAAYtN,QACrB,KAAI,UAAU,UAAUsN,GAAG,CAAA,CAAA,EAAM,QAAOA;EAE3C;AACF;AAKD,IAAa,YAAY,CAAIC,WAA2B;AAEtD,MAAIC,UAAuC,CAAE,IAAI,CAAG;AACpD,aAAWF,MAAKxC,OAAI,cAAA,EAClB,KAAIwC,GAAG,CAAA,IAAM,QAAS,CAAA,EACpB,WAAUA;AAGd,SAAO,QAAS,CAAA;AACjB;AAoBD,IAAa,oBAAoB,CAC/BF,QACAtN,SACA2N,WAAsB,mBACkC;AACxD,aAAWH,MAAKxC,OAAI,QAAA,GAAW;AAC7B,UAAM,SAASwC,GAAG,CAAA;AAClB,eAAW,YAAY,OACrB,KAAII,SAAQ,UAAU1N,OAAAA,EAAQ,QAAOsN;EAExC;AACF;AC7ED,IAAa,kBAAb,MAAgC;EACpB;EACS;EACT;;;;;;EAOV,YACEK,WAAgC,cAChCC,UAAsB,gBACtBC,UAAsC,CAAE,GACxC;AACA,SAAK,UAAUC;AACf,SAAK,UAAU;AACf,SAAK,MAAM,IAAI,IAAI,OAAA;EACpB;;;;;;EAOD,IAAIC,KAAsB;AACxB,WAAO,KAAK,IAAI,IAAI,GAAA;EACrB;;;;;;;EAQD,YAAYA,KAAajO,SAAmB;AAC1C,UAAMoI,UAAS,KAAK,IAAI,IAAI,GAAA;AAC5B,QAAI,CAACA,QAAQ,QAAO;AACpB,eAAWxH,MAAKwH,QACd,KAAI,KAAK,QAAQxH,IAAGV,OAAAA,EAAQ,QAAO;AAErC,WAAO;EACR;;;;;EAMD,cAAsB;AACpB,QAAIsH,KAAI;AACR,UAAM,OAAO,CAAE,GAAG,KAAK,IAAI,KAAA,CAAQ;AACnC,SAAK,MAAM,CAACqE,OAAM;AAChB,YAAMjL,KAAI,KAAK,IAAI,IAAIiL,EAAA;AACvB,UAAIjL,OAAM,OAAW;AACrB,MAAA4G,MAAKqE,KAAI,KAAMjL,GAAE,MAAA,OAAe,KAAK,UAAUA,EAAA,CAAE;;IAClD,CAAA;AACD,WAAO4G;EACR;;;;;;;EAQD,MAAMyG,KAAqB;AACzB,UAAM7F,UAAS,KAAK,IAAI,IAAI,GAAA;AAC5B,QAAI,CAACA,QAAQ,QAAO;AACpB,WAAOA,QAAO;EACf;;;;;;;EASD,gBAAgBpI,SAAUkO,KAAiB,gBAAgB;AACzD,UAAM,QAAQ,kBAAkB,MAAMhO,SAAO,EAAA;AAC7C,QAAI,MAAO,QAAO,MAAO,CAAA;EAC1B;;;;EAKD,CAAC,cAA2D;AAC1D,eAAW,OAAO,KAAK,IAAI,KAAA,EACzB,YAAWA,WAAS,KAAK,IAAI,IAAI,GAAA,EAC/B,OAAM,CAAE,KAAKA,OAAO;EAGzB;;;;EAKD,CAAC,UAAyD;AACxD,eAAW,CAAE2L,IAAGjL,EAAA,KAAO,KAAK,IAAI,QAAA,EAC9B,OAAM,CAAEiL,IAAG,CAAE,GAAGjL,EAAG,CAAE;EAExB;;;;;;EAQD,CAAC,IAAIqN,KAAkC;AACrC,UAAM5B,KAAI,KAAK,IAAI,IAAI,GAAA;AACvB,QAAI,CAACA,GAAG;AACR,WAAOA,GAAE,OAAA;EACV;;;;EAKD,CAAC,OAAiC;AAChC,WAAO,KAAK,IAAI,KAAA;EACjB;;;;;EAMD,CAAC,aAAkC;AACjC,eAAWzG,YAAW,KAAK,IACzB,QAAOA,SAAS,CAAA;EAEnB;;;;;EAMD,CAAC,SAAyC;AACxC,eAAWA,YAAW,KAAK,IACzB,OAAMA,SAAS,CAAA;EAElB;;;;EAID,CAAC,gBAAsD;AACrD,eAAWA,YAAW,KAAK,IACzB,OAAM,CAAEA,SAAS,CAAA,GAAKA,SAAS,CAAA,EAAI,MAAQ;EAE9C;;;;EAKD,IAAI,aAAa;AACf,WAAO,KAAK,IAAI;EACjB;;;;EAKD,IAAI,UAAmB;AACrB,WAAO,KAAK,IAAI,SAAS;EAC1B;AAEF;AC7ID,IAAa,qBAAb,cACU,gBACoB;EAE5B,eAAeqI,QAAgB7F,SAAsB;AACnD,UAAM,WAAW,KAAK,IAAI,IAAI,GAAA;AAC9B,QAAI,aAAa,OACf,MAAK,IAAI,IAAI,KAAKA,OAAA;QAElB,MAAK,IAAI,IAAI,KAAK,CAAE,GAAG,UAAU,GAAGA,OAAQ,CAAA;EAE/C;;;;;;;EAQD,UAAU6F,KAAaE,SAAsB;AAC3C,SAAK,IAAI,IAAI,KAAK/F,OAAA;EACnB;;;;;;EAOD,YAAYA,SAAsB;AAChC,eAAWxH,MAAKwH,SAAQ;AACtB,YAAM,MAAM,KAAK,QAAQxH,EAAA;AACzB,WAAK,eAAe,KAAKA,EAAA;IAC1B;EACF;;;;;;;EAQD,eAAeqN,KAAajO,SAAmB;AAC7C,UAAM,WAAW,KAAK,IAAI,IAAI,GAAA;AAC9B,QAAI,aAAa,OAAW,QAAO;AACnC,UAAMoO,YAAU,SAAS,OAAO,CAAC,kBAAkB,CAAC,KAAK,QAAQ,eAAelO,OAAAA,CAAM;AACtF,SAAK,IAAI,IAAI,KAAKkO,SAAAA;AAClB,WAAOA,UAAQ,SAAS,SAAS;EAClC;;;;;;;;EASD,cAAcpO,SAAmB;AAC/B,QAAIqO,QAAM;AACV,UAAMzI,WAAU,CAAE,GAAG,KAAK,IAAI,QAAA,CAAW;AACzC,eAAW,cAAcA,SACvB,YAAWwC,WAAU,WAAY,CAAA,EAC/B,KAAI,KAAK,QAAQA,SAAQlI,OAAAA,GAAQ;AAC/BmO,cAAM;AACN,WAAK,eAAe,WAAY,CAAA,GAAKnO,OAAAA;IACtC;AAGL,WAAOmO;EACR;;;;;;EAOD,OAAOJ,KAAsB;AAC3B,UAAM7F,UAAS,KAAK,IAAI,IAAI,GAAA;AAC5B,QAAI,CAACA,QAAQ,QAAO;AACpB,QAAIA,QAAO,WAAW,EAAG,QAAO;AAChC,SAAK,IAAI,OAAO,GAAA;AAChB,WAAO;EACR;;;;EAKD,QAAQ;AACN,SAAK,IAAI,MAAA;EACV;AACF;AAoBD,IAAa,kBAAkB,CAC7ByF,WAAgC,cAChCC,UAAsB,mBACD,IAAI,mBAAsBE,UAAS,OAAA;AClI1D,IAAM,WAAW,CACfM,QACAC,SACsB;AACtB,QAAMlD,KAAI,IAAI,IAAUL,OAAI,QAAA,CAAS;AACrC,aAAWvI,MAAK,MAAM;AACpB,QAAIA,GAAG,CAAA,MAAQ,OAAW,OAAM,IAAI,MAAM,yBAAyB;AACnE,QAAIA,GAAG,CAAA,MAAQ,OAAW,OAAM,IAAI,MAAM,2BAA2B;AACrE,IAAA4I,GAAE,IAAI5I,GAAG,CAAA,GAAKA,GAAG,CAAA,CAAA;EAClB;AACD,SAAO4I;AACR;AAQD,IAAM,aAAa,CACjBiD,QACAE,SACsB;AACtB,QAAMnD,KAAI,IAAI,IAAUL,OAAI,QAAA,CAAS;AACrC,aAAWvI,MAAK,MAAM;AACpB,QAAIA,GAAE,QAAQ,OAAW,OAAM,IAAI,MAAM,yBAAyB;AAClE,QAAIA,GAAE,UAAU,OAAW,OAAM,IAAI,MAAM,2BAA2B;AAEtE,IAAA4I,GAAE,IAAI5I,GAAE,KAAKA,GAAE,KAAA;EAChB;AACD,SAAO4I;AACR;AAaD,IAAa,MAAM,CAAOiD,QAAwBxB,QAChD9B,OAAI,IAAI,GAAA;AAgBV,IAAa,MAAM,CACjBsD,WACG,SACmB;AACtB,MAAItD,WAAQ,OAAW,OAAM,IAAI,MAAM,4BAA4B;AACnE,MAAI,SAAS,OAAW,OAAM,IAAI,MAAM,8BAA8B;AACtE,MAAI,KAAK,WAAW,EAAG,QAAOA;AAE9B,QAAM,cAAc,KAAM,CAAA;AAC1B,QAAM,WACJ,OAAQ,YAAuD,QAC/D,eACA,OAAQ,YAAuD,UAC/D;AACF,SAAO,WACH,WAAWA,QAAK,IAAA,IAChB,SAASA,QAAK,IAAA;AACnB;AASD,IAAa,MAAM,CAAOsD,QAAwBxB,KAAQ9M,YAAa;AACrE,QAAMqL,KAAI,IAAI,IAAUL,OAAI,QAAA,CAAS;AACrC,EAAAK,GAAE,IAAI,KAAKnL,OAAAA;AACX,SAAOmL;AACR;AAQD,IAAa,MAAM,CACjBiD,QACAxB,QACsB;AACtB,QAAMzB,KAAI,IAAI,IAAUL,OAAI,QAAA,CAAS;AACrC,EAAAK,GAAE,OAAO,GAAA;AACT,SAAOA;AACR;ACfD,IAAaZ,aAAY,CACvBgE,cACwB;AACxB,MAAI,cAAc,OAAW,QAAOhE,WAAU,CAAE,CAAA;AAChD,MAAI,MAAM,QAAQ,SAAA,EAAY,QAAOA,WAAgB,IAAI,oBAAI,IAAA,GAAO,GAAG,SAAA,CAAU;AAEjF,QAAM,OAAO;AACb,SAAO;IACL,KAAK,IAAI,eAAgC;AACvC,YAAMjB,KAAI,IAAI,MAAM,GAAG,UAAA;AACvB,aAAOiB,WAAUjB,EAAA;IAClB;IACD,KAAK,CAACsD,KAAQ9M,YAAa;AACzB,YAAMwJ,KAAI,IAAI,MAAM,KAAKtJ,OAAAA;AACzB,aAAOuK,WAAUjB,EAAA;IAClB;IACD,KAAK,CAACsD,QAAW,KAAK,IAAI,GAAA;IAC1B,QAAQ,CAACA,QAAWrC,WAAU,IAAI,MAAM,GAAA,CAAI;IAE5C,OAAO,MAAMA,WAAA;IACb,KAAK,CAACqC,QAAW,KAAK,IAAI,GAAA;IAC1B,SAAS,MAAM,KAAK,QAAA;IACpB,QAAQ,MAAM,KAAK,OAAA;IACnB,SAAS,MAAM,KAAK,SAAS;EAC9B;AACF;AC5DD,IAAa,UAAU,IAAU,SAA6C;AAE5E,MAAIT,KAAI,IAAI,oBAAI,IAAA,GAAa,GAAG,IAAA;AAChC,SAAO;IACL,KAAK,IAAIqC,WAA0B;AACjC,MAAArC,KAAI,IAAIA,IAAG,GAAGqC,MAAAA;IACf;IACD,QAAQ,CAAC5B,QAAW;AAClB,MAAAT,KAAI,IAAIA,IAAG,GAAA;IACZ;IACD,OAAO,MAAM;AACX,MAAAA,KAAI,IAAI,oBAAI,IAAA,CAAA;IACb;IACD,KAAK,CAACS,KAAQ9M,YAAmB;AAC/B,MAAAqM,KAAI,IAAIA,IAAG,KAAKnM,OAAAA;IACjB;IACD,KAAK,CAAC4M,QAA0BT,GAAE,IAAI,GAAA;IACtC,SAAS,MAAMA,GAAE,QAAA;IACjB,QAAQ,MAAMA,GAAE,OAAA;IAChB,SAAS,MAAMA,GAAE,SAAS;IAC1B,KAAK,CAACS,QAAW,IAAIT,IAAG,GAAA;EACzB;AACF;ACtED,IAAa,mBAAb,cACU,mBAC+B;EAC9BsC,OAAO,oBAAI,IAAA;EACX;EACA;EAET,YAAYC,MAAwBC,OAAwB,CAAE,GAAE;AAC9D,UAAA;AACA,SAAK,OAAO;AACZ,SAAK,UAAU,KAAK,WAAW;EAChC;;;;EAKD,IAAI,WAAW;AACb,WAAO,KAAK,KAAK;EAClB;;;;EAKD,IAAI,aAAqB;AACvB,WAAO,KAAKF,KAAK;EAClB;;;;EAKD,IAAI,YAAY;AACd,QAAItC,KAAI;AACR,eAAWzL,MAAK,KAAK+N,KAAK,OAAA,EACxB,CAAAtC,KAAI,KAAK,IAAIA,IAAG,KAAK,KAAK,MAAMzL,EAAA,CAAE;AAEpC,WAAOyL;EACR;EAED,cAAsB;AACpB,UAAM,OAAO,CAAE,GAAG,KAAKsC,KAAK,KAAA,CAAQ;AACpC,QAAInH,KAAI,SAAU,KAAK,KAAK,IAAI,CAAC;;AACjC,eAAWqE,MAAK,MAAM;AACpB,YAAMjL,KAAI,KAAK+N,KAAK,IAAI9C,EAAA;AACxB,UAAIjL,OAAM,OACR,CAAA4G,MAAK,MAAOqE,EAAA;;WACP;AACL,cAAMiD,WAAU,KAAK,KAAK,QAAQlO,EAAA;AAClC,YAAIkO,aAAY,OACd,CAAAtH,MAAK,MAAOqE,EAAA,KAAQ,KAAK,KAAK,MAAMjL,EAAA,CAAE,OAAS,KAAK,UAClDkO,QAAA,CACD;;MAEJ;IACF;AACD,WAAOtH;EACR;EAED,IAAI,UAAmB;AACrB,WAAO,KAAKmH,KAAK,SAAS;EAC3B;EAED,QAAQ;AACN,SAAKA,KAAK,MAAA;AACV,UAAM,UAAU,SAAS,IAAA;EAC1B;EAED,eAAeV,QAAgB7F,SAAa;AAC1C,UAAMkD,SAAM,KAAKqD,KAAK,IAAI,GAAA;AAC1B,QAAIrD,WAAQ,QAAW;AACrB,WAAKqD,KAAK,IAAI,KAAK,KAAK,KAAK,eAAe,QAAWvG,OAAA,CAAO;AAC9D,YAAM,UAAU,YAAY,EAAO,IAAK,CAAA;AACxC,YAAM,UAAU,eAAe,EAAU,QAAAA,QAAQ,CAAA;IAClD,OAAM;AACL,WAAKuG,KAAK,IAAI,KAAK,KAAK,KAAK,eAAerD,QAAKlD,OAAA,CAAO;AACxD,YAAM,UAAU,eAAe,EAAU,QAAAA,QAAQ,CAAA;IAClD;EACF;EACD,IAAI6F,KAAac,SAAa;AAC5B,SAAK,eAAe,KAAK,GAAG3G,OAAA;AAC5B,WAAO;EACR;EAED,YAAYA,SAAsB;AAChC,eAAWxH,MAAKwH,QAAQ,MAAK,eAAe,KAAK,QAAQxH,EAAA,GAAIA,EAAA;EAC9D;EAED,YAAYqN,KAAajO,SAAUkO,IAAyB;AAC1D,UAAM7B,KAAI,KAAKsC,KAAK,IAAI,GAAA;AACxB,QAAItC,OAAM,OAAW,QAAO;AAC5B,WAAO,KAAK,KAAK,IAAIA,IAAGnM,SAAO,EAAA;EAChC;EAED,IAAI+N,KAAsB;AACxB,WAAO,KAAKU,KAAK,IAAI,GAAA;EACtB;EAED,eAAeV,KAAajO,SAAmB;AAC7C,UAAMgC,KAAI,KAAK2M,KAAK,IAAI,GAAA;AACxB,QAAI3M,OAAM,OAAW,QAAO;AAC5B,WAAO,KAAK,sBAAsBA,IAAG,KAAK9B,OAAAA;EAC3C;EAEO,sBAAsB8O,QAAQf,KAAajO,SAAmB;AACpE,UAAM,WAAW,KAAK,KAAK,MAAMgL,MAAAA;AACjC,UAAM,WAAW,KAAK,KAAK,QAAQA,QAAK9K,OAAAA;AACxC,UAAM,YAAY,SAAS;AAC3B,SAAKyO,KAAK,IAAI,KAAK,KAAK,KAAK,eAAe,QAAW,QAAA,CAAS;AAChE,WAAO,WAAW;EACnB;EAED,cAAc3O,SAAmB;AAC/B,QAAI,YAAY;AAChB,KAAE,GAAG,KAAK2O,KAAK,KAAA,CAAQ,EAAC,OAAO,CAAC,QAAQ;AACtC,YAAM3M,KAAI,KAAK2M,KAAK,IAAI,GAAA;AACxB,UAAI,CAAC3M,GAAG,OAAM,IAAI,MAAM,gCAAgC;AACxD,UAAI,KAAK,sBAAsBA,IAAG,KAAK9B,OAAAA,GAAQ;AAC7C,oBAAY;AAGZ,YAAI,KAAK,MAAM,GAAA,MAAS,EAAG,MAAK,OAAO,GAAA;MACxC;IACF,CAAA;AACD,WAAO;EACR;EAED,OAAO+N,KAAsB;AAC3B,UAAMjM,KAAI,KAAK2M,KAAK,IAAI,GAAA;AACxB,QAAI3M,OAAM,OAAW,QAAO;AAC5B,SAAK2M,KAAK,OAAO,GAAA;AACjB,SAAK,UAAU,aAAa,EAAO,IAAK,CAAA;AACxC,WAAO;EACR;EAED,gBACE3O,SACAkO,KAAiB,gBACG;AACpB,UAAM,OAAO,CAAE,GAAG,KAAKS,KAAK,KAAA,CAAQ;AACpC,UAAM,QAAQ,KAAK,KAAK,CAAC,QAAQ;AAC/B,YAAM3M,KAAI,KAAK2M,KAAK,IAAI,GAAA;AACxB,UAAI3M,OAAM,OAAW,OAAM,IAAI,MAAM,gCAAgC;AACrE,YAAMwF,KAAI,KAAK,KAAK,IAAIxF,IAAG9B,SAAO,EAAA;AAClC,aAAOsH;IACR,CAAA;AACD,WAAO;EACR;EAED,MAAMyG,KAAqB;AACzB,UAAM,QAAQ,KAAKU,KAAK,IAAI,GAAA;AAC5B,QAAI,UAAU,OAAW,QAAO;AAChC,WAAO,KAAK,KAAK,MAAM,KAAA;EACxB;;;;;EAMD,CAAC,IAAIV,KAAkC;AACrC,UAAM5B,KAAI,KAAKsC,KAAK,IAAI,GAAA;AACxB,QAAItC,OAAM,OAAW;AACrB,WAAO,KAAK,KAAK,SAASA,EAAA;EAC3B;;;;;;;EAQD,CAAC,UAAU4B,KAAa;AACtB,UAAM5B,KAAI,KAAKsC,KAAK,IAAI,GAAA;AACxB,QAAItC,OAAM,OAAW;AACrB,WAAO,KAAK,KAAK,SAASA,EAAA;EAC3B;EAED,UAAU4B,KAA4B;AACpC,WAAO,KAAKU,KAAK,IAAI,GAAA;EACtB;EAED,CAAC,OAAiC;AAChC,WAAO,KAAKA,KAAK,KAAA;EAElB;EAED,CAAC,cAA2D;AAC1D,eAAW,SAAS,KAAKA,KAAK,QAAA,EAC5B,YAAW/N,MAAK,KAAK,KAAK,SAAS,MAAO,CAAA,CAAA,EACxC,OAAM,CAAE,MAAO,CAAA,GAAKA,EAAG;EAG5B;EAED,CAAC,aAAkC;AACjC,eAAW,SAAS,KAAK+N,KAAK,QAAA,EAC5B,QAAO,KAAK,KAAK,SAAS,MAAO,CAAA,CAAA;EAEpC;EAED,CAAC,UAAyD;AACxD,eAAW,CAAE9C,IAAGjL,EAAA,KAAO,KAAK+N,KAAK,QAAA,GAAW;AAC1C,YAAM,YAAY,CAAE,GAAG,KAAK,KAAK,SAAS/N,EAAA,CAAI;AAC9C,YAAM,CAAEiL,IAAG,SAAW;IACvB;EACF;EAED,CAAC,gBAAsD;AACrD,eAAW,OAAO,KAAK,KAAA,EACrB,OAAM,CAAE,KAAK,KAAK,MAAM,GAAA,CAAM;EAEjC;EAED,MAAMoD,OAAkB;AACtB,eAAW,OAAO,MAAM,KAAA,GAAQ;AAC9B,YAAM,OAAO,MAAM,IAAI,GAAA;AACvB,WAAK,eAAe,KAAK,GAAG,IAAA;IAC7B;EACF;EAED,IAAI,OAAO;AACT,WAAO,KAAKN,KAAK;EAClB;EAGD,KAAM,OAAO,WAAA,IAAgB;AAC3B,WAAO,KAAKA,KAAM,OAAO,WAAA;EAC1B;AACF;AC1MD,IAAa,eAAe,CAC1BO,YACqD;AACrD,QAAM,OAAO,SAAS,QAAQ;AAC9B,QAAM,WAAW,CAACC,IAAMC,OAAS,KAAKpN,EAAA,MAAO,KAAKC,EAAA;AAElD,QAAMoN,KAA2C;IAC/C,IAAI,OAAO;AACT,aAAO;IACR;IACD,UAAU,CAAC,WAAW,OAAO,OAAA;IAC7B,gBAAgB,CAAC,MAAMjH,YAAWkH,SAAY,MAAM,MAAM,QAAQ,GAAGlH,OAAA;IACrE,OAAO,CAAC,WAAW,OAAO;IAC1B,MAAM,CAAC,QAAQ,cAAcmH,UAAa,QAAQ,SAAA;IAClD,QAAQ,CAAC,QAAQ,cAAcC,aAAgB,QAAQ,SAAA;IACvD,SAAS,CAAC,WAAWC,QAAW,MAAA;IAChC,KAAK,CAAC,QAAQvP,YAAUwP,YAAe,QAAQxP,SAAO,QAAA;IACtD,SAAS,CAAC,QAAQA,YAAU,QAAQuP,QAAW,MAAA,GAASvP,SAAO,QAAA;EAChE;AACD,QAAMmM,KAAI,IAAI,iBAA4C7L,IAAG,OAAA;AAC7D,SAAO6L;AACR;AChCD,IAAa,oBAAoB,CAC/BsD,YACgD;AAChD,QAAM,WAAW;AAEjB,QAAMC,KAAsC;IAC1C,IAAI,OAAO;AACT,aAAO;IACR;IACD,gBAAgB,CAAC,aAAaxH,YAAW;AACvC,UAAIyH,MAAwB,eAAe,IAAI,cAAiB,QAAQ,QAAA;AACxE,iBAAWjP,MAAKwH,QACd,CAAAnI,MAAKA,IAAG,IAAIW,EAAA;AAEd,aAAOX;IACR;IACD,OAAO,CAAC,WAAW,OAAO;IAC1B,MAAM,CAAC,QAAQ,cAAc,OAAO,KAAK,SAAA;IACzC,QAAQ,CAAC,QAAQ,cAAc,OAAO,OAAO,SAAA;IAC7C,SAAS,CAAC,WAAW;IACrB,UAAU,CAAC,WAAW,OAAO,OAAA;IAC7B,KAAK,CAAC,QAAQC,YACZ,OAAO,KAAK,CAACU,OAAM,SAASA,IAAGV,OAAAA,CAAM,MAAM;IAC7C,SAAS,CAAC,QAAQA,YAAU,OAAO,OAAO,CAACU,OAAM,CAAC,SAASA,IAAGV,OAAAA,CAAM;EACrE;AACD,SAAO,IAAI,iBAAuCM,IAAG,OAAA;AACtD;AClBD,IAAa,YAAb,cAAkC,IAAe;EACtC;EAET,YAAY,eAAe,GAAG;AAC5B,UAAA;AACA,SAAK,eAAe;EACrB;EAED,IAAIsM,KAAgB;AAClB,UAAMlM,KAAI,MAAM,IAAI,GAAA;AACpB,QAAIA,OAAM,OAAW,QAAO,KAAK;AACjC,WAAOA;EACR;EAED,MAAMkM,KAAgB;AACpB,UAAM,IAAI,KAAK,KAAK,YAAA;AACpB,WAAO,KAAK;EACb;EAED,SAASA,KAAQgD,QAAwB;AACvC,UAAMlP,KAAI,MAAM,IAAI,GAAA;AACpB,QAAIV,UAAQU,MAAK,KAAK;AACtBV,eAAS;AACT,UAAM,IAAI,KAAKA,OAAAA;AACf,WAAOA;EACR;EAED,IAAI4M,KAAQ,SAAS,GAAW;AAC9B,UAAMlM,KAAI,MAAM,IAAI,GAAA;AACpB,QAAIV,UAAQU,MAAK,KAAK;AACtBV,eAAS;AACT,UAAM,IAAI,KAAKA,OAAAA;AACf,WAAOA;EACR;EAED,SAAS4M,KAAQ,SAAS,GAAW;AACnC,UAAMlM,KAAI,MAAM,IAAI,GAAA;AACpB,QAAIV,UAAQU,MAAK,KAAK;AACtBV,eAAS;AACT,UAAM,IAAI,KAAKA,OAAAA;AACf,WAAOA;EACR;AACF;AChCD,IAAa,iBAAiB,CAC5B6P,UAA2B,CAAE,MACc;AAe3C,QAAMC,mBAAkB,QAAQ;AAChC,QAAMC,mBAA+B,OAAOD,qBAAoB,cAAc,iBAAiB,CAACb,IAAMC,OAASY,iBAAgBhO,EAAA,MAAOgO,iBAAgB/N,EAAA;AAEtJ,QAAM,WAAW,QAAQ,YAAY;AAErC,QAAMiO,KAAiC;IACrC,IAAI,OAAO;AACT,aAAO;IACR;IACD,gBAAgB,CAAC,aAAa9H,YAAW;AACvC,UAAI,gBAAgB,OAAW,QAAO,CAAE,GAAGA,OAAQ;AACnD,aAAO,CAAE,GAAG,aAAa,GAAGA,OAAQ;IACrC;IACD,UAAU,CAAC,WAAW,OAAO,OAAA;IAC7B,OAAO,CAAC,WAAW,OAAO;IAC1B,MAAM,CAAC,QAAQ,cAAc,OAAO,KAAK,CAAA1B,OAAK,UAAUA,EAAA,CAAE;IAC1D,QAAQ,CAAC,QAAQ,cAAc,OAAO,OAAO,CAAAA,OAAK,UAAUA,EAAA,CAAE;IAC9D,SAAS,CAAC,WAAW;IACrB,KAAK,CAAC,QAAQxG,YAAU,OAAO,KAAK,CAACU,OAAM,SAASA,IAAGV,OAAAA,CAAM;IAC7D,SAAS,CAAC,QAAQA,YAAU,OAAO,OAAO,CAACU,OAAM,CAAC,SAASA,IAAGV,OAAAA,CAAM;EAErE;AACD,QAAMmM,KAAI,IAAI,iBAAkC7L,IAAG,OAAA;AACnD,SAAO6L;AACR;AC/ED,IAAa8D,eAAb,MAAaA,qBACH,gBACiC;EACzC,eAAelC,QAAgB7F,SAA0C;AAGvE,WAAO,KAAK,SAAS,CAAE,CAAE,KAAKA,OAAQ,CAAE,CAAA;EACzC;EAED,YAAYA,SAA0C;AACpD,UAAM,YAAYA,QAAO,IAAI,CAACxH,OAAM,CAAE,KAAK,QAAQA,EAAA,GAAIA,EAAG,CAAA;AAI1D,WAAO,KAAK,SAAS,SAAA;EACtB;EAGD,SAASwP,UAAqE;AAE5E,UAAM,YAAY,IAAI,IACpB,CAAE,GAAG,KAAK,IAAI,QAAA,CAAW,EAAC,IAAI,CAAC5C,OAAM,CAAEA,GAAG,CAAA,GAAK,CAAE,GAAGA,GAAG,CAAA,CAAK,CAAE,CAAA,CAAC;AAGjE,eAAW,CAAE,KAAK,IAAA,KAAU5H,UAAS;AAEnC,YAAM,eAAe,UAAU,IAAI,GAAA;AACnC,UAAI,OAAO,iBAAiB,YAG1B,WAAU,IAAI,KAAK,IAAA;UAGnB,cAAa,KAAK,GAAG,IAAA;IAExB;AACD,WAAO,IAAIuK,aAAe,KAAK,SAAS,KAAK,SAAS,CAAE,GAAG,UAAU,QAAA,CAAW,CAAA;EACjF;EAED,QAA4B;AAC1B,WAAO,IAAIA,aAAe,KAAK,SAAS,KAAK,OAAA;EAC9C;EAED,eAAeE,MAAcC,QAA+B;AAC1D,UAAM,IAAI,MAAM,yBAAyB;EAC1C;EAED,cAActQ,SAAUkM,IAAqC;AAC3D,UAAMtG,WAAU,CAAE,GAAG,KAAK,IAAI,QAAA,CAAW;AACzC,UAAM,aAAa,MAAM,KAAK;AAC9B,UAAMyF,KAAIzF,SAAQ,IAAI,CAAC,UAAU;AAC/B,YAAM,MAAM,MAAO,CAAA;AACnB,YAAMwC,UAAS,MAAO,CAAA,EAAI,OAAO,CAAC,OAAO,CAAC,WAAW,IAAIlI,OAAAA,CAAM;AAC/D,aAAO,CAAE,KAAKkI,OAAQ;IACvB,CAAA;AACD,WAAO,IAAI+H,aAAe,KAAK,SAAS,KAAK,SAAS9E,EAAA;EACvD;EAED,OAAO4C,KAAiC;AACtC,UAAMrI,WAAU,CAAE,GAAG,KAAK,IAAI,QAAA,CAAW,EAAC,OAAO,CAAC4H,OAAMA,GAAG,CAAA,MAAQ,GAAA;AACnE,WAAO,IAAI2C,aAAe,KAAK,SAAS,KAAK,SAASvK,QAAA;EACvD;AACF;AAoBD,IAAa,WAAW,CACtB2K,WAAuB,cACvBzC,UAAsB,mBACC,IAAIqC,aAAenC,UAAS,OAAA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AEvFrD,IAAa,QAAb,MAAsB;EACpB,OAAsB,CAAE;EACxB,YAAsB,CAAE;EACxB,YAAsB,CAAE;;;;EAIxB,kBAAkB;;;;;;;;;EAUlB,oBAAoB9F,OAAmC;AACrD,eAAW,CAAE,OAAOsI,EAAA,KAAO,KAAK,UAAU,QAAA,EACxC,KAAIA,OAAM,MAAO,QAAO;EAE3B;;;;;;;;;EAUD,iBAAiBtI,OAAmC;AAClD,eAAW,CAAE,OAAOsI,EAAA,KAAO,KAAK,UAAU,QAAA,EACxC,KAAIA,OAAM,MAAO,QAAO;EAE3B;;;;EAID,QAAQ;AACN,YAAQ,MAAM,CAAE,GAAG,KAAK,qBAAA,CAAwB,CAAA;EACjD;;;;;;;;;;;;;;;;;;;;;;EAyBD,UAA+B;AAC7B,UAAMC,KAAyB,CAAE;AACjC,eAAW,OAAO,KAAK,KACrB,KAAI,QAAQ,OAAW,CAAAjJ,GAAE,KAAK,CAAE,CAAA;QAC3B,CAAAA,GAAE,KAAK,CAAE,GAAG,GAAK,CAAA;AAExB,WAAOA;EACR;;;;EAKD,IAAI,WAAW;AACb,WAAO,KAAK,KAAK;EAClB;;;;EAKD,IAAI,cAAc;AAChB,WAAO,KAAK;EAGb;;;;;EAMD,CAAC,uBAAuB;AACtB,aAAS,QAAQ,GAAG,QAAQ,KAAK,KAAK,QAAQ,SAAS;AACrD,YAAM,cAAc,KAAK,uBAAuB,KAAA;AAChD,YAAM;IACP;EACF;;;;;EAMD,CAAC,sBAAsB;AACrB,aAAS,QAAQ,GAAG,QAAQ,KAAK,KAAK,QAAQ,SAAS;AACrD,YAAM,cAAc,KAAK,sBAAsB,KAAA;AAC/C,YAAM;IACP;EACF;;;;;EAMD,gBAAgB,QAAkB;AAChC,SAAK,YAAY;EAClB;;;;;;;EAQD,YAAYkJ,aAAqBxI,OAAe;AAC9C,SAAK,UAAW,WAAA,IAAgB;EACjC;;;;;EAMD,aAAa,QAAkB;AAC7B,SAAK,YAAY;EAClB;;;;;;;EAQD,SAASyI,UAAkBzI,OAAe;AACxC,SAAK,UAAW,QAAA,IAAa;EAC9B;;;;;EAMD,aAAa,MAAoC;AAC/C,SAAK,kBAAkB,KAAK,IAAI,KAAK,iBAAiB,KAAK,MAAA;AAC3D,SAAK,KAAK,KAAK,IAAA;AACf,WAAO;EACR;;;;;;EAOD,sBAAsByI,UAAqF;AACzG,UAAM,MAAM,KAAK,KAAK,GAAG,QAAA;AACzB,QAAI,QAAQ,OAAW,QAAO;AAC9B,WAAO,IAAI,IAAI,CAACzQ,SAAO,UAAU,CAAE,KAAK,UAAU,GAAG,KAAA,GAAQA,OAAO,CAAA;EACrE;;;;;;;;;;;;EAaD,uBAAuByQ,UAAsC;AAC3D,UAAM,MAAM,KAAK,KAAK,GAAG,QAAA;AACzB,QAAI,QAAQ,OAAW,QAAO;AAC9B,UAAM,SAAS,CAAE;AACjB,aAAS,QAAQ,GAAG,QAAQ,KAAK,UAAU,QAAQ,SAAS;AAC1D,YAAM,QAAQ,KAAK,UAAU,GAAG,KAAA,KAAU,MAAM,SAAA;AAChD,aAAQ,KAAA,IAAU,IAAK,KAAA;IACxB;AACD,WAAO;EACR;;;;;;EAOD,mBAAmBC,KAE2B;AAC5C,UAAM,QAAQ,OAAO,QAAQ,WAAW,MAAM,KAAK,iBAAiB,GAAA;AAEpE,QAAI,UAAU,OAAW,QAAO;MAAE,SAAS;MAAO,OAAO;IAAsB;AAG/E,QAAI,QAAQ,EAAG,QAAO;MAAE,SAAS;MAAO,OAAO;IAAqB;AAGpE,QAAI,QAAQ,KAAK,KAAK,OACpB,QAAO;MAAE,SAAS;MAAM,OAAO,KAAK,KAAM,KAAA;IAAS;AAGrD,UAAM,SAAS,CAAE;AACjB,SAAK,KAAM,KAAA,IAAU;AAErB,WAAO;MAAE,SAAS;MAAM,OAAO;IAAQ;EACxC;;;;;;EAOD,IAAIA,KAA8D;AAChE,UAAMpJ,KAAI,KAAKqJ,WAAW,GAAA;AAC1B,QAAI,cAAcrJ,EAAA,EAChB,OAAM,IAAI,MAAMA,GAAE,KAAA;AAEpB,WAAO,CAAE,GAAGA,GAAE,KAAO;EACtB;;;;;;;;EASD,IAAIoJ,KAAsBE,QAAyBC,SAAsB;AACvE,UAAM,SAAS,KAAKC,mBAAmB,GAAA;AACvC,QAAI,cAAc,MAAA,EAAS,OAAM,IAAI,MAAM,OAAO,KAAA;AAGlD,UAAMxJ,KAAI,OAAO;AACjB,UAAM,cAAc,OAAO,WAAW,WAAW,SAAS,KAAK,oBAAoB,MAAA;AACnF,QAAI,OAAO,gBAAgB,YAAa,OAAM,IAAI,MAAM,iBAAkB,MAAA,2BAAkC;AAE5G,QAAI,cAAc,EAAG,OAAM,IAAI,MAAM,uCAAuC;AAG5E,IAAAA,GAAG,WAAA,IAAgBtH;EACpB;;;;;;;;EASD,IAAI0Q,KAAsBE,QAAwC;AAChE,UAAM,OAAO,KAAKD,WAAW,GAAA;AAC7B,QAAI,cAAc,IAAA,EAAO,OAAM,IAAI,MAAM,KAAK,KAAA;AAE9C,UAAM,OAAO,KAAKI,cAAc,KAAK,OAAO,MAAA;AAC5C,QAAI,cAAc,IAAA,EAAO,OAAM,IAAI,MAAM,KAAK,KAAA;AAE9C,WAAO,KAAK,MAAM;EACnB;EAED,WAAWL,KAA4G;AACrH,QAAIM,QAA4B;AAChC,QAAI,OAAO,QAAQ,SACjB,SAAQ;SACH;AACL,cAAQ,KAAK,iBAAiB,GAAA;AAC9B,UAAI,OAAO,UAAU,SAAU,QAAO;QAAE,OAAO;QAAsB,SAAS;MAAO;IACtF;AACD,QAAI,OAAO,UAAU,SAAU,QAAO;MAAE,OAAO;MAAe,SAAS;IAAO;AAE9E,QAAI,QAAQ,KAAK,SAAS,KAAK,KAAK,OAAQ,QAAO;MAAE,OAAO;MAA0B,SAAS;IAAO;AACtG,WAAO;MAAE,SAAS;MAAM,OAAO,KAAK,KAAM,KAAA;IAAS;EACpD;EAED,cAAcC,KAAkBL,QAA2H;AACzJ,UAAM,WAAW,OAAO,WAAW,WAAW,SAAS,KAAK,oBAAoB,MAAA;AAChF,QAAI,OAAO,aAAa,SAAU,QAAO;MAAE,SAAS;MAAO,OAAO;IAAsB;AACxF,QAAI,WAAW,KAAK,YAAY,IAAI,OAAQ,QAAO;MAAE,SAAS;MAAO,OAAO;IAA0B;AACtG,WAAO;MACL,SAAS;MAAM,OAAO;QAAE,OAAO;QAAU,OAAO,IAAK,QAAA;MAAY;IAClE;EACF;;;;;;;;;;;EAYD,OAAOF,KAAsBG,SAAsBK,SAA8B;AAE/E,UAAM,YAAY,KAAKJ,mBAAmB,GAAA;AAC1C,QAAI,cAAc,SAAA,EAAY,OAAM,IAAI,MAAM,UAAU,KAAA;AAGxD,UAAMxJ,KAAI,UAAU;AACpB,UAAM,QAAQ,OAAO3G,YAAW,WAAWA,UAAS,KAAK;AACzD,aAAS,eAAe,GAAG,eAAe,OAAO,eAC/C,CAAA2G,GAAG,YAAA,IAAiBtH;AAEtB,WAAOsH;EACR;AACF;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACnRD,IAAa6J,iBAAe,CAACC,OAAuB;AAClD,SAAO;IACL;IACA,KAAK,CAAE;EACR;AACF;AA4CD,SAAgB,OAAOC,SAAsBtD,KAAsB;AACjE,cAAY,UAAUuD,OAAAA,CAAM;AAC5B,SAAOA,QAAM,SAAS,IAAI,GAAA;AAC3B;AAcD,SAAgB,IAAID,SAAsBtD,KAAiC;AACzE,cAAY,UAAUuD,OAAAA,CAAM;AAE5B,cAAY,WAAW,KAAK,aAAa,KAAK,CAAC;AAC/C,SAAOA,QAAM,SAAS,IAAI,GAAA;AAE3B;AAeD,SAAgBC,oBAAkBF,SAAsC;AACtE,cAAY,UAAUC,OAAAA,CAAM;AAE5B,QAAM5Q,KAAI,CAAE,GAAG4Q,QAAM,SAAS,OAAA,CAAU;AAExC,QAAM,QAAQ,IAAI,MAAA;AAClB,QAAM,aAAa,GAAG5Q,GAAE,IAAI,CAAA,OAAM,GAAG,EAAA,CAAG;AACxC,QAAM,UAAU,GAAGA,GAAE,IAAI,CAAA,OAAM,GAAG,EAAA,CAAG;AAQrC,WAAS8Q,KAAI,GAAGA,KAAI9Q,GAAE,QAAQ8Q,MAAK;AAEjC,UAAM,OAAOA,IAAG,OAAO9Q,GAAE,MAAA;AACzB,UAAM+Q,MAAK/Q,GAAG8Q,EAAA;AAEd,eAAW,CAAEE,IAAG,EAAA,KAAQhR,GAAE,QAAA,EACxB,KAAI+Q,IAAG,IAAI,KAAK,CAAAE,OAAKA,GAAE,OAAO,GAAG,EAAA,EAE/B,OAAM,IAAIH,IAAGE,IAAG,IAAA;EAGrB;AACD,SAAO;AACR;AAOD,IAAaE,cAAY,CAACC,YAAoD;AAC5E,QAAM,QAAQC,oBAAkBR,OAAAA;AAChC,SAAO,MAAM,KAAK;CAAI;AACvB;AAOD,IAAMQ,sBAAoB,CAACD,YAAsD;AAE/E,QAAME,KAAc,CAAE;AACtB,QAAMC,aAAY,cAAcV,UAASA,QAAM,SAAS,OAAA,IAAWA;AAEnE,aAAW5Q,MAAKsR,YAAU;AAExB,UAAM,MAAM,gBAAgBtR,EAAA;AAC5B,IAAA4G,GAAE,KAAK,GAAG,IAAI,IAAI,CAAAxE,UAAQ,IAAKA,KAAA,EAAO,CAAC;EACxC;AACD,SAAOwE;AACR;AASD,IAAa,WAAW,CAAC+J,SAAsBY,SAAuB;AACpE,MAAI,KAAK,WAAW,OAAW,QAAO,KAAK;AAC3C,SAAO;AACR;AAMD,UAAiB,MAAMZ,SAAsB;AAC3C,cAAY,UAAUC,OAAAA,CAAM;AAE5B,QAAMU,aAAW,CAAE,GAAGV,QAAM,SAAS,OAAA,CAAU;AAC/C,aAAW,UAAUU,WACnB,YAAW,QAAQ,OAAO,IACxB,OAAM;AAGX;AAMD,UAAiB,SAASX,SAAsB;AAC9C,cAAY,UAAUC,OAAAA,CAAM;AAE5B,QAAMU,aAAW,CAAE,GAAGV,QAAM,SAAS,OAAA,CAAU;AAC/C,aAAW,UAAUU,WACnB,OAAM;AAET;AAED,SAAS,UAAUE,IAAkB,gBAAgB,SAAwC;AAC3F,MAAIC,OAAM,OAAW,QAAO;IAAE,SAAS;IAAO,OAAO,UAAW,aAAA;EAAgD;AAChH,MAAIA,OAAM,KAAM,QAAO;IAAE,SAAS;IAAO,OAAO,UAAW,aAAA;EAA2C;AACtG,MAAI,OAAOA,OAAM,UACf;QAAI,EAAE,cAAcA,IAAI,QAAO;MAC7B,SAAS;MAAO,OAAO,UAAW,aAAA;IACnC;EAAC,MAEF,QAAO;IAAE,SAAS;IAAO,OAAO,UAAW,aAAA,aAA4B,OAAOA,EAAA;EAAiC;AAEjH,SAAO;IAAE,SAAS;IAAM,OAAOA;EAAG;AACnC;AAcD,UAAiBC,mBAAiBf,SAAsBgB,SAAsC;AAC5F,cAAY,UAAUf,OAAAA,CAAM;AAC5B,MAAI,YAAY,OAAW;AAC3B,QAAM,SAAS,OAAO,YAAY,WAAWA,QAAM,SAAS,IAAI,OAAA,IAAW;AAC3E,MAAI,WAAW,OAAW,OAAM,IAAI,MAAM,oBAAqB,KAAK,UAAU,OAAA,CAAQ,EAAG;AAEzF,aAAW,QAAQ,OAAO,KAAK;AAC7B,UAAM,QAAQA,QAAM,SAAS,IAAI,KAAK,EAAA;AACtC,QAAI,UAAU,OAAW,OAAM,IAAI,MAAM,0BAA2B,KAAK,EAAA,EAAK;AAC9E,UAAM;EACP;AACF;AAWD,IAAa,eAAe,CAACgB,QAAgBC,kBAA4C;AACvF,MAAI,WAAW,OAAW,QAAO;AACjC,QAAM,QAAQ,OAAO,kBAAkB,WAAW,gBAAgB,cAAc;AAChF,SAAO,OAAO,IAAI,KAAK,CAAA,SAAQ,KAAK,OAAO,KAAA;AAC5C;AAQD,IAAa,YAAY,CAAClB,SAAsBmB,WAAqC;AACnF,cAAY,UAAUlB,OAAAA,CAAM;AAC5B,QAAM,UAAU,OAAO,WAAW,WAAWA,QAAM,SAAS,IAAI,MAAA,IAAU;AAC1E,MAAI,YAAY,OAAW,QAAO;AAClC,SAAO,QAAQ,IAAI,WAAW;AAC/B;AAUD,IAAa,cAAc,CAACD,SAAsBmB,WAA4B,kBAAgD;AAC5H,cAAY,UAAUlB,OAAAA,CAAM;AAE5B,QAAM,UAAUmB,gBAAcnB,SAAO,MAAA;AACrC,QAAM,OAAO,cAAc,IAAI,CAAAK,OAAKc,gBAAcnB,SAAOK,EAAA,CAAE;AAE3D,MAAI,KAAK,WAAW,QAAQ,IAAI,OAE9B,QAAO;AAET,aAAW,OAAO,KAEhB,KAAI,CAAC,OAAOL,SAAO,SAAS,GAAA,EAE1B,QAAO;AAGX,SAAO;AACR;AASD,IAAa,SAAS,CAACD,SAAsBmB,QAAyBD,kBAA4C;AAChH,cAAY,UAAUjB,OAAAA,CAAM;AAE5B,QAAM,UAAUmB,gBAAcnB,SAAO,MAAA;AACrC,QAAM,QAAQ,OAAO,kBAAkB,WAAW,gBAAgB,cAAc;AAChF,SAAO,QAAQ,IAAI,KAAK,CAAA,SAAQ,KAAK,OAAO,KAAA;AAC7C;AAgBD,IAAaoB,gBAAc,CAACrB,SAAsBD,OAAmE;AACnH,cAAY,UAAUE,OAAAA,CAAM;AAE5B,QAAM5Q,KAAI4Q,QAAM,SAAS,IAAI,EAAA;AAC7B,MAAI5Q,OAAM,OAAW,QAAO;IAAE,OAAA;IAAO,QAAQA;EAAG;AAEhD,QAAM,KAAKyQ,eAAa,EAAA;AACxB,QAAM,KAAKwB,oBAAkBrB,SAAO,EAAA;AACpC,SAAO;IAAE,OAAO;IAAI,QAAQ;EAAI;AACjC;AAQD,IAAa,YAAY,CAACD,SAAsBD,OAAuB;AACrE,cAAY,UAAUE,OAAAA,CAAM;AAE5B,QAAM5Q,KAAI4Q,QAAM,SAAS,IAAI,EAAA;AAC7B,MAAI5Q,OAAM,OAAW,OAAM,IAAI,MAAM,WAAY,EAAA,sBAAyB;AAC1E,SAAOA;AACR;AAQD,IAAaiS,sBAAoB,CAACtB,SAAsBiB,WAAkC;AACxF,cAAY,UAAUhB,OAAAA,CAAM;AAE5B,QAAMsB,MAAK;IACT,GAAGtB;IACH,UAAUA,QAAM,SAAS,IAAI,OAAO,IAAI,MAAA;EACzC;AACD,SAAOsB;AACR;AAQD,IAAa,kBAAkB,CAACvB,SAAsBY,SAAuB;AAC3E,MAAI,KAAK,WAAW,OAAW,QAAO,KAAK;AAC3C,SAAO;AACR;AAWD,SAAgB,WAAWZ,SAAsBwB,OAAuBC,KAAoC;AAC1G,cAAY,UAAUxB,OAAAA,CAAM;AAE5B,QAAM,QAAQmB,gBAAcnB,SAAOyB,KAAA;AACnC,QAAM,MAAMN,gBAAcnB,SAAO0B,GAAA;AAEjC,SAAO,OAAO1B,SAAO,OAAO,GAAA,IAAOqB,oBAAkBrB,SAAO;IAC1D,GAAG;IACH,KAAK,MAAM,IAAI,OAAO,CAAAhR,OAAKA,GAAE,OAAO,IAAI,EAAA;EACzC,CAAA,IAAIgR;AACN;AAWD,SAAgB2B,YAAU5B,SAAsB6B,OAAcC,KAAYC,SAAuD;AAC/H,cAAY,UAAU9B,OAAAA,CAAM;AAE5B,QAAM,aAAaoB,cAAYpB,SAAOyB,KAAA;AACtCzB,YAAQ,WAAW;AACnB,QAAM,WAAWoB,cAAYpB,SAAO0B,GAAA;AACpC1B,YAAQ,SAAS;AAEjB,QAAMW,OAAa;IACjB,IAAIe;IACJ,QAAAK;EACD;AAED,MAAI,CAAC,OAAO/B,SAAO,WAAW,QAAQ,SAAS,MAAA,EAC7CA,WAAQqB,oBAAkBrB,SAAO;IAC/B,GAAG,WAAW;IAEd,KAAK,CAAE,GAAG,WAAW,OAAO,KAAK,IAAM;EACxC,CAAA;AAEH,SAAO;IAAE,OAAA;IAAO;EAAM;AACvB;AAaD,SAAgBgC,UAAQjC,SAAsBkC,SAAwC;AACpF,MAAI,OAAOjC,YAAU,SAAU,OAAM,IAAI,UAAU,gEAAiE,OAAOA,OAAAA,EAAQ;AACnI,MAAI,OAAO,YAAY,SAAU,OAAM,IAAI,UAAU,iEAAkE,OAAO,OAAA,EAAU;AAExI,QAAM,SAASkC,mBAAiBlC,SAAO,OAAA;AACvC,SAAO,OAAO;AACf;AAaD,SAAgBkC,mBAAiBnC,SAAsBkC,SAAkE;AACvH,cAAY,UAAUjC,OAAAA,CAAM;AAE5B,QAAM,EAAE,IAAA0B,KAAI,QAAAK,SAAQ,MAAAN,MAAA,IAAS;AAC7B,QAAM,OAAO,QAAQ,QAAQ;AAC7B,QAAM,SAAS,MAAM,QAAQC,GAAA,IAAMA,MAAK,CAAEA,GAAI;AAE9C,QAAMS,WAAgB,CAAE;AAExB,aAAW,YAAY,QAAQ;AAC7B,UAAM,SAASR,YAAU3B,SAAOyB,OAAM,UAAUM,OAAA;AAChD/B,cAAQ,OAAO;AACfoC,IAAAA,SAAM,KAAK,OAAO,IAAA;EACnB;AAED,MAAI,CAAC,KAAM,QAAO;IAAE,OAAA;IAAO,OAAAC;EAAO;AAIlC,aAAW,YAAY,QAAQ;AAC7B,UAAM,SAASV,YAAU3B,SAAO,UAAUyB,OAAMM,OAAA;AAChD/B,cAAQ,OAAO;AACfoC,IAAAA,SAAM,KAAK,OAAO,IAAA;EACnB;AACD,SAAO;IAAE,OAAA;IAAO,OAAAC;EAAO;AACxB;AAOD,IAAM,kBAAkB,CAACC,OAAwB;AAC/C,QAAMtM,KAAI,CACR5G,GAAE,EACH;AACD,QAAMmT,kBAAgB,CAAC5B,SAAe,KAAK,WAAW,SAAY,KAAK,KAAK,GAAI,KAAK,EAAA,KAAS,KAAK,MAAA;AAKnG,aAAW,QAAQvR,GAAE,IACnB,CAAA4G,GAAE,KAAK,OAAQuM,gBAAc,IAAA,CAAK,EAAG;AAEvC,MAAInT,GAAE,IAAI,WAAW,EAAG,CAAA4G,GAAG,CAAA,KAAO;AAElC,SAAOA;AACR;AASD,SAAgB,YAAY+J,SAAsByC,IAAWC,IAAW;AACtE,cAAY,UAAUzC,OAAAA,CAAM;AAE5B,MAAI,OAAOA,SAAOxP,IAAGC,GAAE,EAAA,EAAK,QAAO;AACnC,MAAI,OAAOuP,SAAOvP,IAAGD,GAAE,EAAA,EAAK,QAAO;AACpC;AASD,SAAS2Q,gBAAcpB,SAAsB2C,YAAqC;AAChF,cAAY,UAAU1C,OAAAA,CAAM;AAE5B,MAAI,eAAe,OAAW,OAAM,IAAI,MAAM,4DAA4D;AAE1G,QAAM5Q,KAAI,OAAO,eAAe,WAAW4Q,QAAM,SAAS,IAAI,UAAA,IAAc;AAC5E,MAAI5Q,OAAM,OAAW,OAAM,IAAI,MAAM,gBAAiB,UAAA,EAAuB;AAC7E,SAAOA;AACR;AASD,UAAiB,IAAI2Q,SAAsB4C,iBAAkCC,kBAAoC;AAC/G,cAAY,UAAU5C,OAAAA,CAAM;AAE5B,QAAM,QAAQmB,gBAAcnB,SAAO,eAAA;AACnC,QAAM,SAAS,qBAAqB,SAAY,SAAYmB,gBAAcnB,SAAO,gBAAA;AAEjF,QAAM,QAAQ,IAAI/Q,cAAA;AAClB,QAAM,OAAO,oBAAI,IAAA;AACjB,QAAM,QAAQ,KAAA;AACd,SAAO,CAAC,MAAM,SAAS;AACrB,UAAMG,KAAI,MAAM,QAAA;AAChB,UAAMA;AACN,QAAI,WAAW,UAAa,WAAWA,GAAG;AAC1C,eAAW,QAAQ0R,mBAAiBd,SAAO5Q,EAAA,EACzC,KAAI,CAAC,KAAK,IAAI,KAAK,EAAA,GAAK;AACtB,WAAK,IAAI,KAAK,EAAA;AACd,YAAM,QAAQ+R,gBAAcnB,SAAO,KAAK,EAAA,CAAG;IAC5C;EAEJ;AACF;AAOD,UAAiB,IAAID,SAAsB4C,iBAAkC;AAC3E,cAAY,UAAU3C,OAAAA,CAAM;AAE5B,QAAM,SAASmB,gBAAcnB,SAAO,eAAA;AAEpC,QAAMhI,KAAI,IAAI,aAAA;AACd,QAAM,OAAO,oBAAI,IAAA;AACjB,EAAAA,GAAE,KAAK,MAAA;AACP,SAAO,CAACA,GAAE,SAAS;AACjB,UAAM5I,KAAI4I,GAAE,IAAA;AACZ,QAAI5I,OAAM,OAAW;AACrB,QAAI,CAAC,KAAK,IAAIA,GAAE,EAAA,GAAK;AACnB,WAAK,IAAIA,GAAE,EAAA;AACX,YAAMA;AACN,iBAAW,QAAQA,GAAE,KAAK;AACxB,cAAM,cAAc4Q,QAAM,SAAS,IAAI,KAAK,EAAA;AAC5C,YAAI,YACF,CAAAhI,GAAE,KAAK,WAAA;MAEV;IACF;EACF;AACF;AAQD,IAAa,eAAe,CAAC+H,SAAsB8C,eAAgC;AACjF,cAAY,UAAU7C,OAAAA,CAAM;AAE5B,QAAM,SAAS,OAAO,eAAe,WAAWA,QAAM,SAAS,IAAI,UAAA,IAAc;AACjF,MAAI,WAAW,OAAW,OAAM,IAAI,MAAM,yBAAyB;AAEnE,QAAM,YAAY,oBAAI,IAAA;AACtB,QAAM,WAAW,oBAAI,IAAA;AAErB,YAAU,IAAI,OAAO,IAAI,CAAA;AAEzB,QAAM,KAAK,IAAI,gBAAA;AAEf,QAAMU,aAAW,CAAE,GAAGV,QAAM,SAAS,OAAA,CAAU;AAC/C,aAAW5Q,MAAKsR,YAAU;AACxB,QAAItR,GAAE,OAAO,OAAO,IAAI;AACtB,gBAAU,IAAIA,GAAE,IAAI,OAAO,gBAAA;AAE3B,eAAS,IAAIA,GAAE,IAAI,IAAA;IACpB;AACD,OAAG,oBAAoBA,GAAE,IAAI,OAAO,gBAAA;EACrC;AAED,SAAO,CAAC,GAAG,SAAS;AAClB,UAAM0T,KAAI,GAAG,WAAA;AACb,QAAIA,OAAM,OAAW,OAAM,IAAI,MAAM,+BAA+B;AACpE,UAAM,UAAU9C,QAAM,SAAS,IAAI8C,EAAA;AACnC,eAAW,aAAa,QAAQ,KAAK;AAEnC,YAAM,MAAM,UAAU,IAAIA,EAAA,IAAM,SAAS9C,SAAO,SAAA;AAChD,UAAI,MAAM,UAAU,IAAI,UAAU,EAAA,GAAM;AACtC,kBAAU,IAAI,UAAU,IAAI,GAAA;AAC5B,iBAAS,IAAI,UAAU,IAAI,OAAA;AAC3B,WAAG,eAAe,UAAU,IAAI,KAAK,IAAA;MACtC;IACF;EACF;AAED,QAAM,SAAS,CAACF,OAAuB;AACrC,UAAMiD,QAAe,CAAE;AACvB,WAAO,MAAM;AACX,UAAI,OAAO,OAAO,GAAI;AACtB,YAAM3T,KAAI,SAAS,IAAI,EAAA;AACvB,UAAIA,OAAM,UAAaA,OAAM,KAAM,OAAM,IAAI,MAAM,mBAAoB,EAAA,EAAK;AAC5E,MAAAqG,MAAK,KAAK;QAAE;QAAI,QAAQ,UAAU,IAAI,EAAA;MAAK,CAAA;AAC3C,WAAKrG,GAAE;IACR;AACD,WAAOqG;EACR;AACD,SAAO;IACL;IAAW;IAAU;EACtB;AACF;AAOD,IAAa,QAAQ,CAACsK,YAAwC;AAC5D,cAAY,UAAUC,OAAAA,CAAM;AAE5B,QAAMY,KAAmB,EACvB,UAAUoC,WAA6B,CAAE,GAAGhD,QAAM,SAAS,QAAA,CAAW,CAAA,EACvE;AACD,SAAOa;AACR;AAkBD,IAAab,UAAQ,IAAI,uBAAwD;AAC/E,MAAIY,KAAmB,EACrB,UAAUoC,WAAAA,EACX;AACD,aAAWC,OAAM,mBACf,CAAApC,KAAImB,UAAQnB,IAAGoC,GAAA;AAEjB,SAAOpC;AACR;AAeD,SAAgB,UAAUd,SAA+B;AACvD,cAAY,UAAUC,OAAAA,CAAM;AAE5B,QAAM,SAAS,UAAUA,OAAAA;AACzB,SAAO,OAAO,WAAW;AAC1B;AAOD,SAAgB,gBAAgBD,SAAqC;AACnE,cAAY,UAAUC,OAAAA,CAAM;AAE5B,QAAM,YAAY,IAAI,UAAU,CAAA;AAGhC,aAAW,QAAQ,MAAMA,OAAAA,EACvB,WAAU,IAAI,KAAK,IAAI,CAAA;AAIzB,QAAM,QAAQ,IAAI/Q,cAAA;AAClB,MAAI,cAAc;AAClB,aAAW,UAAU,SAAS+Q,OAAAA,GAAQ;AACpC,QAAI,UAAU,IAAI,OAAO,EAAA,MAAQ,EAC/B,OAAM,QAAQ,MAAA;AAEhB;EACD;AAED,QAAMkD,WAAqB,CAAE;AAC7B,SAAO,CAAC,MAAM,SAAS;AAErB,UAAMJ,KAAI,MAAM,QAAA;AAChB,aAAS,KAAKA,EAAA;AAGd,eAAW,aAAaA,GAAE,KAAK;AAC7B,YAAM,SAAS,UAAU,SAAS,UAAU,IAAI,CAAA;AAChD,UAAI,WAAW,EACb,OAAM,QAAQ9C,QAAM,SAAS,IAAI,UAAU,EAAA,CAAG;IAEjD;EACF;AAED,MAAI,SAAS,WAAW,YACtB,OAAM,IAAI,MAAM,uBAAuB;AAEzC,SAAO,kBAAkB,QAAA;AAC1B;AAOD,SAAgB,kBAAkBmD,YAA2C;AAE3E,QAAM,YAAA,MAAqBzC,YAAU,CAAAxL,OAAK;AACxC,WAAO,CAAEA,GAAE,IAAIA,EAAG;EACnB,CAAA;AACD,QAAM2F,KAAImI,WAA6B,CAAE,GAAG,SAAW,CAAA;AACvD,SAAO,EACL,UAAUnI,GACX;AACF;AAQD,SAAgB,UAAUkF,SAAkC;AAC1D,cAAY,UAAUC,OAAAA,CAAM;AAE5B,MAAI,QAAQ;AACZ,QAAM,QAAQ,IAAI,aAAA;AAClB,QAAMU,aAAW,oBAAI,IAAA;AACrB,QAAM0C,MAAkB,CAAE;AAE1B,aAAWhU,MAAK4Q,QAAM,SAAS,OAAA,EAC7BU,YAAS,IAAItR,GAAE,IAAI;IACjB,GAAGA;IACH,SAAS;IACT,OAAO;IACP,SAAS;EACV,CAAA;AAGH,QAAM,gBAAgB,CAACiU,WAAyB;AAC9C,WAAO,QAAQ;AACf,WAAO,UAAU;AACjB;AACA,UAAM,KAAK,MAAA;AACX,WAAO,UAAU;AAEjB,eAAW,QAAQ,OAAO,KAAK;AAC7B,YAAM,QAAQ3C,WAAS,IAAI,KAAK,EAAA;AAChC,UAAI,OAAO,MAAM,MAAM,KAAA,GAAQ;AAC7B,sBAAc,KAAA;AACd,eAAO,UAAU,KAAK,IAAI,OAAO,SAAS,MAAM,OAAA;MACjD,WAAU,MAAM,QACf,QAAO,UAAU,KAAK,IAAI,OAAO,SAAS,MAAM,OAAA;IAEnD;AAED,QAAI,OAAO,YAAY,OAAO,OAAO;AACnC,YAAM4C,oBAA8B,CAAE;AACtC,UAAIC;AACJ,aAAO,WAAWC,IAAG;AACnB,QAAAA,KAAI,MAAM,IAAA;AACV,QAAAA,GAAE,UAAU;AACZ,0BAAkB,KAAK;UAAE,IAAIA,GAAE;UAAI,KAAKA,GAAE;QAAK,CAAA;MAEhD;AACD,UAAI,kBAAkB,SAAS,EAC7B,KAAI,KAAK,iBAAA;IACZ;EACF;AAED,aAAWpU,MAAKsR,WAAS,OAAA,EACvB,KAAI,OAAO,MAAMtR,GAAE,KAAA,EACjB,eAAcA,EAAA;AAGlB,SAAO;AACR;AAQD,SAAgB,oBAAoB2Q,SAAsB;AACxD,cAAY,UAAUC,OAAAA,CAAM;AAE5B,aAAW8C,MAAK,SAAS9C,OAAAA,EACvB,YAAW5Q,MAAK0R,mBAAiBd,SAAO8C,EAAA,EACtC,YAAW,MAAM,IAAI9C,SAAO5Q,EAAA,GAAI;AAC9B,QAAIA,GAAE,OAAO,GAAG,GAAI;AACpB,QAAI,OAAO4Q,SAAO8C,IAAG,EAAA,GAAK;AACxB,YAAMjC,KAAI,WAAWb,SAAO8C,IAAG,EAAA;AAC/B,aAAO,oBAAoBjC,EAAA;IAC5B;EACF;AAGL,SAAOb;AACR;;;;;;;;;;;;;;;;;ACr2BD,IAAa,eAAe,CAACF,OAAuB;AAClD,SAAO,EACL,GACD;AACF;AAED,IAAa,oBAAoB,CAAC2D,SAAczC,WAA0B;AACxE,QAAMM,MAAK;IACT,GAAGtB;IACH,UAAUA,QAAM,SAAS,IAAI,OAAO,IAAI,MAAA;EACzC;AACD,SAAOsB;AACR;AAED,IAAa,cAAc,CAACmC,SAAc3D,OAA2D;AACnG,QAAM1Q,KAAI4Q,QAAM,SAAS,IAAI,EAAA;AAC7B,MAAI5Q,OAAM,OAAW,QAAO;IAAE,OAAA;IAAO,QAAQA;EAAG;AAEhD,QAAM,KAAK,aAAa,EAAA;AACxB,QAAM,KAAK,kBAAkB4Q,SAAO,EAAA;AACpC,SAAO;IAAE,OAAO;IAAI,QAAQ;EAAI;AACjC;AAED,SAAS,cAAcyD,SAAcf,YAAqC;AACxE,MAAI,eAAe,OAAW,OAAM,IAAI,MAAM,4DAA4D;AAC1G,MAAI1C,YAAU,OAAW,OAAM,IAAI,MAAM,4CAA4C;AACrF,QAAM5Q,KAAI,OAAO,eAAe,WAAW4Q,QAAM,SAAS,IAAI,UAAA,IAAc;AAC5E,MAAI5Q,OAAM,OAAW,OAAM,IAAI,MAAM,gBAAiB,UAAA,EAAuB;AAC7E,SAAOA;AACR;AAUD,IAAa,gBAAgB,CAACqU,SAAcC,IAAoBC,OAAgC;AAC9F,QAAM,OAAO,cAAc3D,SAAOxP,IAAGC,EAAA;AACrC,SAAO,SAAS;AACjB;AAWD,IAAa,gBAAgB,CAACgT,SAAcC,IAAoBC,OAAyC;AACvG,MAAInT,OAAM,OAAW,OAAM,IAAI,MAAM,mDAAmD;AACxF,MAAIC,OAAM,OAAW,OAAM,IAAI,MAAM,mDAAmD;AACxF,MAAIuP,YAAU,OAAW,OAAM,IAAI,MAAM,4CAA4C;AAErF,QAAM4D,MAAK,cAAc5D,SAAOxP,EAAA;AAChC,QAAM,KAAK,cAAcwP,SAAOvP,EAAA;AAChC,aAAW,QAAQuP,QAAM,OAAO;AAC9B,QAAI,KAAK,KAAK4D,IAAG,MAAM,KAAK,MAAM,GAAG,GAAI,QAAO;AAChD,QAAI,KAAK,KAAK,GAAG,MAAM,KAAK,MAAMA,IAAG,GAAI,QAAO;EACjD;AACD;AACD;AAWD,SAAgB,UAAUH,SAAcI,IAAWC,IAAWhC,SAA+C;AAC3G,QAAM,UAAU,YAAY9B,SAAOxP,EAAA;AACnCwP,YAAQ,QAAQ;AAChB,QAAM,UAAU,YAAYA,SAAOvP,EAAA;AACnCuP,YAAQ,QAAQ;AAEhB,MAAI,OAAO,cAAcA,SAAOxP,IAAGC,EAAA;AACnC,MAAI,SAAS,OAAW,QAAO;IAAE,OAAA;IAAO;EAAM;AAC9C,SAAO;IACL,GAAAD;IACA,GAAAC;IACA,QAAAsR;EACD;AAED,QAAMgC,eAAsB;IAC1B,GAAG/D;IACH,OAAO,CAAE,GAAGA,QAAM,OAAO,IAAM;EAChC;AACD,SAAO;IAAE,OAAO;IAAc;EAAM;AACrC;AAkBD,SAAgB,QAAQyD,SAAcxB,SAAgC;AACpE,QAAM,SAAS,iBAAiBjC,SAAO,OAAA;AACvC,SAAO,OAAO;AACf;AAkBD,SAAgB,iBAAiByD,SAAcxB,SAA0D;AACvG,QAAM,EAAE,GAAAzR,IAAG,QAAAuR,SAAQ,GAAAtR,GAAA,IAAM;AACzB,QAAM,eAAe,MAAM,QAAQA,EAAA,IAAKA,KAAI,CAAEA,EAAG;AACjD,QAAM0R,WAAgB,CAAE;AACxB,aAAW,eAAe,cAAc;AACtC,UAAM,SAAS,UAAUnC,SAAOxP,IAAG,aAAauR,OAAA;AAChD/B,cAAQ,OAAO;AACfoC,IAAAA,SAAM,KAAK,OAAO,IAAA;EACnB;AAED,SAAO;IAAE,OAAA;IAAO,OAAAC;EAAO;AACxB;AAED,IAAa,QAAQ,IAAI,uBAAgD;AACvE,MAAI2B,KAAW;IACb,UAAUhB,WAAAA;IACV,OAAO,CAAE;EACV;AACD,aAAWC,OAAM,mBACf,CAAApC,KAAI,QAAQA,IAAGoC,GAAA;AAEjB,SAAOpC;AACR;AAED,SAAgB,kBAAkB4C,SAA8B;AAC9D,QAAMrU,KAAI,CAAE,GAAG4Q,QAAM,SAAS,OAAA,CAAU;AAExC,QAAM,QAAQ,IAAI,MAAA;AAClB,QAAM,aAAa,GAAG5Q,GAAE,IAAI,CAAA,OAAM,GAAG,EAAA,CAAG;AACxC,QAAM,UAAU,GAAGA,GAAE,IAAI,CAAA,OAAM,GAAG,EAAA,CAAG;AAGrC,WAAS8Q,KAAI,GAAGA,KAAI9Q,GAAE,QAAQ8Q,MAAK;AACjC,UAAM,OAAOA,IAAG,OAAO9Q,GAAE,MAAA;AAEzB,UAAM+Q,MAAK/Q,GAAG8Q,EAAA;AAEd,eAAW,CAAEE,IAAG,EAAA,KAAQhR,GAAE,QAAA,GAAW;AACnC,YAAM,YAAY,cAAc4Q,SAAOG,KAAI,EAAA;AAC3C,UAAI,UACF,OAAM,IAAID,IAAGE,IAAG,IAAA;IAEnB;EACF;AACD,SAAO;AACR;AAOD,IAAa,YAAY,CAACqD,YAAyB;AACjD,QAAM,QAAQ,kBAAkBzD,OAAAA;AAChC,SAAO,MAAM,KAAK;CAAI;AACvB;AAOD,IAAM,oBAAoB,CAACyD,YAA2B;AACpD,QAAMhD,KAAc,CAAE;AAEtB,EAAAzK,GAAE,KAAK,aAAc,CAAE,GAAGgK,QAAM,SAAS,OAAA,CAAU,EAAC,IAAI,CAAA5Q,OAAKA,GAAE,EAAA,EAAI,KAAK,IAAI,CAAC,EAAG;AAEhF,EAAA4G,GAAE,KAAK,QAAQ;AACf,aAAW,QAAQgK,QAAM,MACvB,CAAAhK,GAAE,KAAK,cAAc,IAAA,CAAK;AAE5B,SAAOA;AACR;AAED,IAAM,gBAAgB,CAAC2K,SAAe;AACpC,QAAMoB,UAAS,KAAK,SAAS,KAAM,KAAK,MAAA,MAAa;AACrD,SAAO,GAAI,KAAK,CAAA,QAAW,KAAK,CAAA,GAAMA,OAAA;AACvC;AAQD,UAAiB,iBAAiB0B,SAAc1C,SAAsC;AACpF,MAAI,YAAY,OAAW;AAC3B,QAAM,SAAS,OAAO,YAAY,WAAWf,QAAM,SAAS,IAAI,OAAA,IAAW;AAC3E,MAAI,WAAW,OAAW,OAAM,IAAI,MAAM,oBAAqB,KAAK,UAAU,OAAA,CAAQ,EAAG;AAEzF,aAAW,QAAQA,QAAM,MACvB,KAAI,KAAK,MAAM,QAAS,OAAM,cAAcA,SAAO,KAAK,CAAA;WAC/C,KAAK,MAAM,QAAS,OAAM,cAAcA,SAAO,KAAK,CAAA;AAEhE;AAED,UAAiB,eAAeyD,SAAc1C,SAAsC;AAClF,MAAI,YAAY,OAAW;AAC3B,QAAM,SAAS,OAAO,YAAY,WAAWf,QAAM,SAAS,IAAI,OAAA,IAAW;AAC3E,MAAI,WAAW,OAAW,OAAM,IAAI,MAAM,oBAAqB,KAAK,UAAU,OAAA,CAAQ,EAAG;AAEzF,aAAW,QAAQA,QAAM,MACvB,KAAI,KAAK,MAAM,QAAS,OAAM;WACrB,KAAK,MAAM,QAAS,OAAM;AAEtC;;;;;;;;AExPD,IAAa,gBAAgB,CAAC,QAAQ,gBAAgB;AAClD,QAAM,oBAAoB,CAAE;AAC5B,aAAWiE,YAAW,OAAO,QAAQ,MAAA,GAAS;AAC1C,UAAM,MAAM,YAAYA,SAAQ,CAAA,CAAA;AAChC,sBAAkB,GAAA,IAAOA,SAAQ,CAAA;EACpC;AACD,SAAO;AACV;ACND,IAAa,oBAAoB,CAACC,IAAGC,OAAM;AACvC,QAAMC,KAAI,6BAA6B,OAAO,KAAKF,EAAA,GAAI,OAAO,KAAKC,EAAA,CAAE;AACrE,SAAOC;AACV;AAmBD,IAAa,0BAA0B,CAACF,IAAGC,OAAM;AAC7C,QAAME,KAAI,kBAAkBH,IAAGC,IAAG,IAAA;AAClC,MAAI,OAAO,QAAQE,GAAE,KAAA,EAAO,SAAS,EACjC,OAAM,IAAI,MAAM,2BAA2B;AAC/C,MAAI,OAAO,QAAQA,GAAE,OAAA,EAAS,SAAS,EACnC,OAAM,IAAI,MAAM,2BAA2B;AAC/C,QAAM,SAAS,sBAAsBA,IAAGF,EAAA;AACxC,SAAO;AACV;AACD,IAAM,wBAAwB,CAACE,IAAGF,OAAM;AACpC,QAAM,SAAS,CAAE;AACjB,MAAIE,GAAE,QACF,QAAOF;AAEX,aAAW,SAAS,OAAO,QAAQE,GAAE,OAAA,EACjC,QAAO,MAAM,CAAA,CAAA,IAAM,MAAM,CAAA;AAE7B,aAAW,SAAS,OAAO,QAAQA,GAAE,KAAA,EACjC,QAAO,MAAM,CAAA,CAAA,IAAM,MAAM,CAAA;AAE7B,aAAW,cAAc,OAAO,QAAQA,GAAE,QAAA,GAAW;AACjD,UAAM,cAAc,WAAW,CAAA;AAC/B,QAAI,YAAY,WAEZ,QAAO,WAAW,CAAA,CAAA,IAAM,sBAAsB,aAAaF,GAAE,WAAW,CAAA,CAAA,CAAA;EAE/E;AACD,SAAO;AACV;AASD,IAAa,gBAAgB,CAACD,IAAGC,IAAG,KAAM,mBAAoB;AAC1D,MAAI,CAAC,MAAM,QAAQD,EAAA,EACf,OAAM,IAAI,MAAM,2BAA2B;AAC/C,MAAI,CAAC,MAAM,QAAQC,EAAA,EACf,OAAM,IAAI,MAAM,2BAA2B;AAC/C,QAAMC,KAAI,kBAAkBF,IAAGC,IAAG,OAAO,EAAA;AACzC,MAAI,CAACC,GAAE,QACH,OAAM,IAAI,MAAM,+CAA+C;AACnE,QAAME,WAAU,CAAC,QAAQ;AACrB,QAAI,IAAI,WAAW,GAAG,EAClB,QAAO,OAAO,SAAS,IAAI,MAAM,CAAA,CAAE;QAGnC,OAAM,IAAI,MAAM,mBAAmB,GAAA,GAAM;EAChD;AACD,QAAM,KAAK;IACP,GAAGF;IACH,OAAO,cAAcA,GAAE,OAAOE,QAAA;IAC9B,SAAS,cAAcF,GAAE,SAASE,QAAA;IAClC,SAASF,GAAE,QAAQ,IAAI,CAAAG,OAAKD,SAAQC,EAAA,CAAE;IACtC,SAASH,GAAE,QAAQ,IAAI,CAAAI,WAAS;AAC5B,aAAO;QAACA,OAAM,CAAA;QAAIF,SAAQE,OAAM,CAAA,CAAA;QAAKA,OAAM,CAAA;MAAG;IACjD,CAAA;EACJ;AACD,SAAO;AACV;AASD,IAAa,oBAAoB,CAACN,IAAGC,IAAG,kBAAkB,OAAO,KAAK,mBAAmB;AACrF,EAAAD,OAAM,CAAE;AACR,EAAAC,OAAM,CAAE;AACR,QAAM,WAAW,OAAO,QAAQD,EAAA;AAChC,QAAM,WAAW,OAAO,QAAQC,EAAA;AAChC,QAAM,cAAc,oBAAI,IAAA;AACxB,QAAM,UAAU,CAAE;AAClB,QAAM,QAAQ,CAAE;AAChB,QAAMM,YAAW,CAAE;AACnB,QAAM,UAAU,CAAE;AAClB,QAAM,UAAU,MAAM,QAAQP,EAAA;AAC9B,QAAM,UAAU,IAAI,MAAA;AACpB,MAAI,aAAa;AAEjB,aAAW,SAAS,UAAU;AAC1B,UAAM,YAAY,UAAU,IAAI,MAAM,CAAA,CAAA,KAAO,MAAM,CAAA;AACnD,UAAM,SAAS,MAAM,CAAA;AACrB,UAAM,SAASC,GAAE,MAAM,CAAA,CAAA;AACvB,gBAAY,IAAI,MAAM,CAAA,CAAA;AACtB,QAAI,WAAW,QAAW;AAEtB,mBAAa;AACb,UAAI,mBAAmB,CAAC,SAAS;AAE7B,gBAAQ,SAAA,IAAa;AACrB,gBAAQ,KAAK;UAAC;UAAU;UAAW;QAAO,CAAA;MAC7C,OACI;AAED,gBAAQ,KAAK,SAAA;AACb,gBAAQ,KAAK;UAAC;UAAO;UAAW;QAAO,CAAA;MAC1C;AACD;IACH;AACD,QAAI,OAAO,WAAW,UAAU;AAC5B,YAAME,KAAI,kBAAkB,QAAQ,QAAQ,iBAAiB,EAAA;AAC7D,UAAIA,GAAE,WACF,cAAa;AACjB,MAAAI,UAAS,SAAA,IAAaJ;AACtB,YAAM,eAAeA,GAAE,QAAQ,IAAI,CAAAK,SAAO;AAAE,eAAO;UAACA,KAAI,CAAA;UAAI,YAAY,MAAMA,KAAI,CAAA;UAAIA,KAAI,CAAA;QAAG;MAAG,CAAA;AAChG,cAAQ,KAAK,GAAG,YAAA;IACnB,WAEO,CAAC,GAAG,QAAQ,MAAA,GAAS;AACrB,cAAQ,SAAA,IAAa;AACrB,mBAAa;AACb,cAAQ,KAAK;QAAC;QAAU;QAAW;MAAO,CAAA;IAC7C;EAER;AAED,MAAI,CAAC,mBAAmB,QACpB,YAAW,SAAS,UAAU;AAC1B,UAAM,MAAM,UAAU,IAAI,MAAM,CAAA,CAAA,KAAO,MAAM,CAAA;AAC7C,QAAI,YAAY,IAAI,MAAM,CAAA,CAAA,EACtB;AACJ,UAAM,GAAA,IAAO,MAAM,CAAA;AACnB,iBAAa;AACb,YAAQ,KAAK;MAAC;MAAO;MAAK,MAAM,CAAA;IAAG,CAAA;EACtC;AAEL,SAAO;IACH;IAAS;IAAO;IAAS,UAAAD;IAAU;IAAY;IAAS;EAC3D;AACJ;AC7KD,IAAa,kBAAkB,CAAC,WAAW;AACvC,QAAMR,WAAU,CAAE;AAClB,aAAW,SAAS,QAAQ;AACxB,UAAMO,SAAS,OAAQ,KAAA;AACvB,QAAI,2BAA2BA,MAAA,EAC3B,CAAAP,SAAQ,KAAK,CAAC,OAAOO,MAAM,CAAA;EAElC;AACD,SAAO,OAAO,YAAYP,QAAA;AAC7B;ACyCD,IAAa,mBAAmB,CAAC,QAAQ,gBAAgB;AACrD,QAAMA,WAAU,OAAO,QAAQ,MAAA;AAC/B,QAAM,SAASA,SAAQ,IAAI,CAAC,CAAC,aAAa,gBAAA,GAAmB,UAAU,CACnE,aACA,YAAY;IAAE,OAAO;IAAkB,OAAO;IAAa;IAAO,MAAM;EAAa,CAAA,CACxF,CAAA;AACD,SAAO,OAAO,YAAY,MAAA;AAC7B;AAuBD,SAAgB,kBAAkB,MAAM,QAAQ;AAC5C,QAAMA,WAAU,OAAO,QAAQ,IAAA;AAC/B,aAAW,SAASA,SAChB,KAAI,MAAM,CAAA,KAAM,QAAQ;AACpB,UAAMU,KAAI,OAAO,MAAM,CAAA,CAAA;AACvB,UAAM,CAAA,IAAM,OAAOA,OAAM,WACrB,kBAAkB,MAAM,CAAA,GAAIA,EAAA,IAC5BA,GAAE,MAAM,CAAA,GAAI,IAAA;EACnB;AAEL,SAAO,OAAO,YAAYV,QAAA;AAC7B;ACrFD,SAAgBW,oBAAmBX,UAAS;AACxC,MAAIA,SAAQ,WAAW,EACnB,QAAO;AACX,MAAIY,KAAI;AACR,aAAW,CAAC,OAAO,KAAA,KAAUZ,SAAQ,QAAA,GAAW;AAC5C,IAAAY,MAAK,KAAK,OAAO,KAAA;AACjB,IAAAA,MAAK,MAAM,OAAO,QAAQ,KAAK,UAAU,MAAM,SAAA,IAAa;;EAC/D;AACD,SAAOA;AACV;AAWD,IAAa,yBAAyB,CAAC,MAAM,SAAS,GAAG,UAAU,CAAE,MAAK;AACtE,cAAY,cAAc,MAAM,MAAM,CAAC;AACvC,QAAM,cAAc,QAAQ,QAAQ;AACpC,QAAM,QAAQ,oBAAoB,MAAM,WAAA;AACxC,QAAMA,KAAI,GAAG,KAAK,OAAO,MAAA,CAAO,YAAY,MAAM,IAAA,WAAe,KAAK,UAAU,MAAM,SAAA,CAAU;AAChG,QAAM,kBAAkB,CAAC,GAAG,eAAe,MAAM,OAAA,CAAS;AAC1D,SAAO,gBAAgB,SAAS,IAAKA,KACjC;IACA,gBAAgB,IAAI,CAACC,OAAM,uBAAuBA,GAAE,WAAW,SAAS,GAAG;IAAE,GAAG;IAAS,MAAMA,GAAE;EAAM,CAAA,CAAC,EAAE,KAAK;CAAI,IAAKD;AAC/H;AAyCD,UAAiB,eAAe,MAAM,UAAU,CAAE,GAAE;AAChD,cAAY,cAAc,MAAM,MAAM,CAAC;AACvC,QAAME,UAAS,QAAQ,UAAU;AACjC,QAAM,gBAAgB,CAACR,OAAM;AACzB,QAAIQ,YAAW,OACX,QAAO,CAAC,MAAM,YAAYR,EAAA,CAAG;aACxBQ,YAAW,YAAY,YAAYR,EAAA,EACxC,QAAO,CAAC,MAAM,IAAK;aACdQ,YAAW,cAAc,CAAC,YAAYR,EAAA,EAC3C,QAAO,CAAC,MAAM,KAAM;AACxB,WAAO,CAAC,OAAO,YAAYA,EAAA,CAAG;EACjC;AACD,MAAI,MAAM,QAAQ,IAAA,EAEd,YAAW,CAAC,OAAO,OAAA,KAAY,KAAK,QAAA,GAAW;AAC3C,UAAMS,KAAI,cAAc,OAAA;AACxB,QAAIA,GAAE,CAAA,EACF,OAAM;MAAE,MAAM,MAAM,SAAA;MAAY,aAAa;MAAS,WAAWA,GAAE,CAAA,IAAK,UAAU;IAAW;EAGpG;WAEI,OAAO,SAAS,UAAU;AAC/B,UAAM,cAAe,aAAa,OAAQ,KAAK,QAAA,IAAY,OAAO,QAAQ,IAAA;AAC1E,eAAW,CAAC,MAAMR,MAAA,KAAU,aAAa;AAErC,YAAMQ,KAAI,cAAcR,MAAA;AACxB,UAAIQ,GAAE,CAAA,EACF,OAAM;QAAQ;QAAM,aAAaR;QAAO,WAAWQ,GAAE,CAAA,IAAKR,SAAQ;MAAW;IAEpF;EACJ;AACJ;AACD,UAAiB,wBAAwB,MAAM,UAAU,CAAE,GAAE,YAAY,CAAE,GAAE;AACzE,aAAWJ,MAAK,eAAe,MAAM,OAAA,GAAU;AAE3C,UAAM;MAAE,GAAGA;MAAG,WAAW,CAAC,GAAG,SAAU;IAAE;AACzC,WAAO,wBAAwBA,GAAE,aAAa,SAAS,CAAC,GAAG,WAAWA,GAAE,IAAK,CAAA;EAChF;AACJ;AAOD,SAAS,uBAAuB,MAAM,MAAM;AACxC,aAAWU,MAAK,eAAe,IAAA,EAC3B,KAAIA,GAAE,SAAS,KACX,QAAOA;AAElB;AA2BD,SAAgB,qBAAqBG,OAAM,MAAM,UAAU,CAAE,GAAE;AAC3D,QAAMC,SAAQ,CAAC,GAAG,uBAAuBD,OAAM,MAAM,OAAA,CAAS;AAC9D,MAAIC,OAAM,WAAW,EACjB,OAAM,IAAI,MAAM,yBAAyBD,KAAA,GAAO;AACpD,SAAOC,OAAM,GAAG,EAAA;AACnB;AAiCD,UAAiB,uBAAuBD,OAAM,MAAM,UAAU,CAAE,GAAE;AAC9D,cAAY,cAAcA,OAAM,MAAM,GAAG,cAAc,MAAM,MAAM,CAAC;AACpE,QAAM,YAAY,QAAQ,aAAa;AACvC,QAAM,YAAYA,MAAK,MAAM,SAAA;AAC7B,QAAM,YAAY,CAAE;AACpB,aAAWE,MAAK,WAAW;AACvB,UAAM,QAAQ,uBAAuBA,IAAG,IAAA;AACxC,QAAI,CAAC,OAAO;AACR,YAAM;QAAE,MAAMA;QAAG,aAAa;QAAW,WAAW;QAAW;MAAW;AAC1E;IACH;AACD,WAAO,MAAM;AACb,UAAM;MAAE,GAAG;MAAO,WAAW,CAAC,GAAG,SAAU;IAAE;AAC7C,cAAU,KAAKA,EAAA;EAClB;AACJ;AAQD,SAAS,oBAAoB,MAAM,cAAc,IAAI;AACjD,MAAI,UAAU,QAAQ,eAAe,QAAQ,iBAAiB,KAC1D,QAAO;AACX,MAAI,UAAU,KACV,QAAO;IAAE,MAAM,KAAK;IAAM,WAAW;IAAM,aAAa;EAAM;AAElE,SAAO;IAAE,MAAM;IAAa,WAAW;IAAM,aAAa;EAAM;AACnE;AC7ND,SAAgB,gBAAgBjB,IAAG;AAC/B,SAAO,OAAO,OAAO,CAAE,GAAE,GAAGA,EAAA;AAC/B;ACsBD,IAAa,gBAAgB,CAAC,QAAQ,eAAe,YAAY;AAC7D,QAAM,eAAe,CAAE;AACvB,aAAW,SAAS,OAAO,QAAQ,MAAA,GAAS;AACxC,UAAM,WAAW,OAAO,SAAS,MAAM,CAAA,CAAA;AACvC,QAAI,OAAO,MAAM,QAAA,EACb,SAAQ,cAAR;MACI,KAAK;AACD,cAAM,IAAI,UAAU,uBAAuB,MAAM,CAAA,CAAA,iBAAmB;MAExE,KAAK;AACD;MAEJ,KAAK,QAAQ;AAET,qBAAa,MAAM,CAAA,CAAA,IAAM,MAAM,CAAA;AAC/B;MACH;MACD;AACI,cAAM,IAAI,MAAM,8DAA8D;IAErF;AAEL,iBAAa,QAAA,IAAY,MAAM,CAAA;EAClC;AACD,SAAO;AACV;;;;;;;;;;;;;;;;;;;;;;AEjDD,IAAM,qBAAqB,CAAC,OAAOkB,WAAU,UAAU;AACnD,SAAO,CAACC,YAAW;AACf,UAAMC,KAAID,QAAO,SAAS,CAACE,IAAGC,OAAM;AAChC,aAAO,gBAAgBD,GAAE,KAAA,GAAQC,GAAE,KAAA,CAAA;IACtC,CAAA;AACD,QAAIJ,SACA,QAAOE,GAAE,QAAA;AACb,WAAOA;EACV;AACJ;AACD,IAAa,iBAAiB,CAAC,cAAc;AACzC,UAAQ,WAAR;IACI,KAAK;AACD,aAAO,mBAAmB,GAAG,KAAA;IAEjC,KAAK;AACD,aAAO,mBAAmB,GAAG,IAAA;IAEjC,KAAK;AACD,aAAO,mBAAmB,GAAG,KAAA;IAEjC,KAAK;AACD,aAAO,mBAAmB,GAAG,IAAA;IAEjC;AACI,YAAM,IAAI,MAAM,0BAA0B,SAAA,wDAAiE;EAElH;AACJ;;;ACeD,IAAa,kBAAkB,MAAM;AACjC,QAAMG,OAAM,oBAAI,IAAA;AAChB,SAAO,CAACC,WAAU;AACd,QAAIA,WAAU,KACV,OAAM,IAAI,UAAU,8BAA8B;AACtD,QAAIA,WAAU,OACV,OAAM,IAAI,UAAU,mCAAmC;AAC3D,QAAID,KAAI,IAAIC,MAAA,EACR,QAAO;AACX,IAAAD,KAAI,IAAIC,MAAA;AACR,WAAO;EACV;AACJ;;GCzDA,SAAU,QAAQ,SAAS;AAC3B,WAAO,YAAY,YAAY,OAAO,WAAW,cAAc,OAAO,UAAU,QAAA,IAChF,OAAO,WAAW,cAAc,OAAO,MAAM,OAAO,OAAA,IACnD,OAAO,QAAQ,QAAA;EAChB,GAAA,SAAQ,WAAY;AAAE;AAEtB,aAAS,qBAAqBC,KAAIC,UAAQ;AACzC,aAAOA,WAAS,EAAE,SAAS,CAAE,EAAE,GAAED,IAAGC,UAAQA,SAAO,OAAA,GAAUA,SAAO;IACpE;AAED,QAAI,UAAU,qBAAqB,SAAUA,UAAQ;AAErD,UAAI,SAASA,SAAO,UAAU,OAAO,UAAU,eAAe,OAAO,QAAQ,OACzE,SAAS,OAAO,QAAQ,eAAe,KAAK,QAAQ,OAAO,OAE3D,SAAS,aAAA,EAAc;AAC3B,UAAI,OAAO,OAAO,SAAY,OAAM;IACnC,CAAA;AAED,QAAI,QAAQ,qBAAqB,SAAUA,UAAQ;AACnD,UAAI,OAAOA,SAAO,UAAU,EAAE,SAAS,QAAS;AAChD,UAAI,OAAO,OAAO,SAAY,OAAM;IACnC,CAAA;AACD,QAAI,UAAU,MAAM;AAEpB,QAAI,YAAY,SAAUC,KAAI;AAC5B,aAAO,OAAOA,QAAO,WAAWA,QAAO,OAAO,OAAOA,QAAO;IAC7D;AAED,QAAI,YAAY,SAAUA,KAAI;AAC5B,UAAI,CAAC,UAAUA,GAAA,EAAO,OAAM,UAAUA,MAAK,oBAAA;AAC3C,aAAOA;IACR;AAED,QAAI,SAAS,SAAU,MAAM;AAC3B,UAAI;AACF,eAAO,CAAC,CAAC,KAAA;MACV,SAAQC,IAAG;AACV,eAAO;MACR;IACF;AAGD,QAAI,eAAe,CAAC,OAAO,WAAY;AACrC,aAAO,OAAO,eAAe,CAAE,GAAE,KAAK,EAAE,KAAK,WAAY;AAAE,eAAO;MAAI,EAAE,CAAA,EAAE,KAAK;IAChF,CAAA;AAED,QAAIC,YAAW,QAAQ;AAEvB,QAAIC,MAAK,UAAUD,SAAA,KAAa,UAAUA,UAAS,aAAA;AACnD,QAAI,aAAa,SAAUF,KAAI;AAC7B,aAAOG,MAAKD,UAAS,cAAcF,GAAA,IAAM,CAAE;IAC5C;AAED,QAAI,gBAAgB,CAAC,gBAAgB,CAAC,OAAO,WAAY;AACvD,aAAO,OAAO,eAAe,WAAW,KAAA,GAAQ,KAAK,EAAE,KAAK,WAAY;AAAE,eAAO;MAAI,EAAE,CAAA,EAAE,KAAK;IAC/F,CAAA;AAMD,QAAI,eAAe,SAAUA,KAAII,IAAG;AAClC,UAAI,CAAC,UAAUJ,GAAA,EAAO,QAAOA;AAC7B,UAAIF,KAAI;AACR,UAAIM,MAAK,QAAQN,MAAKE,IAAG,aAAa,cAAc,CAAC,UAAU,MAAMF,IAAG,KAAKE,GAAA,CAAG,EAAK,QAAO;AAC5F,UAAI,QAAQF,MAAKE,IAAG,YAAY,cAAc,CAAC,UAAU,MAAMF,IAAG,KAAKE,GAAA,CAAG,EAAK,QAAO;AACtF,UAAI,CAACI,MAAK,QAAQN,MAAKE,IAAG,aAAa,cAAc,CAAC,UAAU,MAAMF,IAAG,KAAKE,GAAA,CAAG,EAAK,QAAO;AAC7F,YAAM,UAAU,yCAAA;IACjB;AAED,QAAI,KAAK,OAAO;AAEhB,QAAIK,KAAI,eAAe,OAAO,iBAAiB,SAAS,eAAeC,IAAGC,IAAG,YAAY;AACvF,gBAAUD,EAAA;AACV,MAAAC,KAAI,aAAaA,IAAG,IAAA;AACpB,gBAAU,UAAA;AACV,UAAI,cAAiB,KAAI;AACvB,eAAO,GAAGD,IAAGC,IAAG,UAAA;MACjB,SAAQN,IAAG;MAAe;AAC3B,UAAI,SAAS,cAAc,SAAS,WAAc,OAAM,UAAU,0BAAA;AAClE,UAAI,WAAW,WAAc,CAAAK,GAAEC,EAAA,IAAK,WAAW;AAC/C,aAAOD;IACR;AAED,QAAI,YAAY,EACZ,GAAAD,GACH;AAED,QAAI,gBAAgB,SAAU,QAAQR,QAAO;AAC3C,aAAO;QACL,YAAY,EAAE,SAAS;QACvB,cAAc,EAAE,SAAS;QACzB,UAAU,EAAE,SAAS;QACd,OAAAA;MACR;IACF;AAED,QAAI,QAAQ,eAAe,SAAU,QAAQW,OAAKX,QAAO;AACvD,aAAO,UAAU,EAAE,QAAQW,OAAK,cAAc,GAAGX,MAAA,CAAM;IACxD,IAAG,SAAU,QAAQW,OAAKX,QAAO;AAChC,aAAOW,KAAAA,IAAOX;AACd,aAAO;IACR;AAED,QAAI,iBAAiB,CAAE,EAAC;AACxB,QAAI,OAAO,SAAUG,KAAIQ,OAAK;AAC5B,aAAO,eAAe,KAAKR,KAAIQ,KAAAA;IAChC;AAED,QAAI,KAAK;AACT,QAAI,KAAK,KAAK,OAAA;AACd,QAAI,OAAO,SAAUA,OAAK;AACxB,aAAO,UAAU,OAAOA,UAAQ,SAAY,KAAKA,OAAK,OAAO,EAAE,KAAK,IAAI,SAAS,EAAA,CAAG;IACrF;AAED,QAAI,WAAW;AAEf,QAAI,UAAU,qBAAqB,SAAUT,UAAQ;AACrD,UAAI,SAAS;AACb,UAAI,QAAQ,QAAQ,MAAA,MAAY,QAAQ,MAAA,IAAU,CAAE;OAEnDA,SAAO,UAAU,SAAUS,OAAKX,QAAO;AACtC,eAAO,MAAMW,KAAAA,MAAS,MAAMA,KAAAA,IAAOX,WAAU,SAAYA,SAAQ,CAAE;MACpE,GAAE,YAAY,CAAE,CAAA,EAAE,KAAK;QACtB,SAAS,MAAM;QACf,MAAM,WAAW,SAAS;QAC1B,WAAW;MACZ,CAAA;IACA,CAAA;AAED,QAAI,oBAAoB,QAAQ,6BAA6B,SAAS,QAAA;AAEtE,QAAI,YAAY,qBAAqB,SAAUE,UAAQ;AACvD,UAAI,MAAM,KAAK,KAAA;AAEf,UAAI,YAAY;AAChB,UAAI,OAAO,KAAK,mBAAmB,MAAM,SAAA;AAEzC,YAAM,gBAAgB,SAAUC,KAAI;AAClC,eAAO,kBAAkB,KAAKA,GAAA;MAC/B;OAEAD,SAAO,UAAU,SAAUO,IAAGE,OAAK,KAAK,MAAM;AAC7C,YAAIC,cAAa,OAAO,OAAO;AAC/B,YAAIA,YAAc,MAAK,KAAK,MAAA,KAAW,MAAM,KAAK,QAAQD,KAAAA;AAC1D,YAAIF,GAAEE,KAAAA,MAAS,IAAO;AACtB,YAAIC,YAAc,MAAK,KAAK,GAAA,KAAQ,MAAM,KAAK,KAAKH,GAAEE,KAAAA,IAAO,KAAKF,GAAEE,KAAAA,IAAO,IAAI,KAAK,OAAOA,KAAAA,CAAI,CAAC;AAChG,YAAIF,OAAM,QACR,CAAAA,GAAEE,KAAAA,IAAO;iBACA,CAAC,MAAM;AAChB,iBAAOF,GAAEE,KAAAA;AACT,gBAAMF,IAAGE,OAAK,GAAA;QACf,WAAUF,GAAEE,KAAAA,EACX,CAAAF,GAAEE,KAAAA,IAAO;YAET,OAAMF,IAAGE,OAAK,GAAA;MAGjB,GAAE,SAAS,WAAW,WAAW,SAASE,YAAW;AACpD,eAAO,OAAO,QAAQ,cAAc,KAAK,GAAA,KAAQ,kBAAkB,KAAK,IAAA;MACzE,CAAA;IACA,CAAA;AAED,QAAI,aAAa,SAAUV,KAAI;AAC7B,UAAI,OAAOA,OAAM,WAAc,OAAM,UAAUA,MAAK,qBAAA;AACpD,aAAOA;IACR;AAID,QAAI,OAAO,SAAUF,KAAI,MAAMa,SAAQ;AACrC,iBAAWb,GAAA;AACX,UAAI,SAAS,OAAa,QAAOA;AACjC,cAAQa,SAAR;QACE,KAAK;AAAG,iBAAO,SAAUC,IAAG;AAC1B,mBAAOd,IAAG,KAAK,MAAMc,EAAA;UACtB;QACD,KAAK;AAAG,iBAAO,SAAUA,IAAGC,IAAG;AAC7B,mBAAOf,IAAG,KAAK,MAAMc,IAAGC,EAAA;UACzB;QACD,KAAK;AAAG,iBAAO,SAAUD,IAAGC,IAAGC,KAAG;AAChC,mBAAOhB,IAAG,KAAK,MAAMc,IAAGC,IAAGC,GAAAA;UAC5B;MACF;AACD,aAAO,WAAyB;AAC9B,eAAOhB,IAAG,MAAM,MAAM,SAAA;MACvB;IACF;AAED,QAAI,YAAY;AAEhB,QAAI,UAAU,SAAU,MAAM,MAAMiB,UAAQ;AAC1C,UAAI,YAAY,OAAO,QAAQ;AAC/B,UAAI,YAAY,OAAO,QAAQ;AAC/B,UAAI,YAAY,OAAO,QAAQ;AAC/B,UAAI,WAAW,OAAO,QAAQ;AAC9B,UAAI,UAAU,OAAO,QAAQ;AAC7B,UAAI,SAAS,YAAY,UAAU,YAAY,QAAQ,IAAA,MAAU,QAAQ,IAAA,IAAQ,CAAE,MAAK,QAAQ,IAAA,KAAS,CAAE,GAAE,SAAA;AAC7G,UAAIC,YAAU,YAAY,QAAQ,MAAM,IAAA,MAAU,MAAM,IAAA,IAAQ,CAAE;AAClE,UAAI,WAAWA,UAAQ,SAAA,MAAeA,UAAQ,SAAA,IAAa,CAAE;AAC7D,UAAIR,OAAK,KAAK,KAAK;AACnB,UAAI,UAAaO,YAAS;AAC1B,WAAKP,SAAOO,UAAQ;AAElB,cAAM,CAAC,aAAa,UAAU,OAAOP,KAAAA,MAAS;AAE9C,eAAO,MAAM,SAASO,UAAQP,KAAAA;AAE9B,cAAM,WAAW,MAAM,KAAK,KAAK,OAAA,IAAW,YAAY,OAAO,OAAO,aAAa,KAAK,SAAS,MAAM,GAAA,IAAO;AAE9G,YAAI,OAAU,WAAU,QAAQA,OAAK,KAAK,OAAO,QAAQ,CAAA;AAEzD,YAAIQ,UAAQR,KAAAA,KAAQ,IAAO,OAAMQ,WAASR,OAAK,GAAA;AAC/C,YAAI,YAAY,SAASA,KAAAA,KAAQ,IAAO,UAASA,KAAAA,IAAO;MACzD;IACF;AACD,YAAQ,OAAO;AAEf,YAAQ,IAAI;AACZ,YAAQ,IAAI;AACZ,YAAQ,IAAI;AACZ,YAAQ,IAAI;AACZ,YAAQ,IAAI;AACZ,YAAQ,IAAI;AACZ,YAAQ,IAAI;AACZ,YAAQ,IAAI;AACZ,QAAI,UAAU;AAGd,QAAI,OAAO,KAAK;AAChB,QAAI,QAAQ,KAAK;AACjB,QAAI,aAAa,SAAUR,KAAI;AAC7B,aAAO,MAAMA,MAAK,CAACA,GAAA,IAAM,KAAKA,MAAK,IAAI,QAAQ,MAAMA,GAAA;IACtD;AAGD,QAAI,WAAW,SAAUA,KAAI;AAC3B,UAAIA,OAAM,OAAa,OAAM,UAAU,2BAA2BA,GAAA;AAClE,aAAOA;IACR;AAID,QAAI,YAAY,SAAU,WAAW;AACnC,aAAO,SAAU,MAAMiB,OAAK;AAC1B,YAAIC,KAAI,OAAO,SAAS,IAAA,CAAK;AAC7B,YAAIC,KAAI,WAAWF,KAAAA;AACnB,YAAIG,KAAIF,GAAE;AACV,YAAIN,IAAGC;AACP,YAAIM,KAAI,KAAKA,MAAKC,GAAK,QAAO,YAAY,KAAK;AAC/C,QAAAR,KAAIM,GAAE,WAAWC,EAAA;AACjB,eAAOP,KAAI,SAAUA,KAAI,SAAUO,KAAI,MAAMC,OAAMP,KAAIK,GAAE,WAAWC,KAAI,CAAA,KAAM,SAAUN,KAAI,QACxF,YAAYK,GAAE,OAAOC,EAAA,IAAKP,KAC1B,YAAYM,GAAE,MAAMC,IAAGA,KAAI,CAAA,KAAMP,KAAI,SAAU,OAAOC,KAAI,SAAU;MACzE;IACF;AAED,QAAI,MAAM,UAAU,KAAA;AACpB,YAAQ,QAAQ,GAAG,UAAU,EAE3B,aAAa,SAASQ,cAAYJ,OAAK;AACrC,aAAO,IAAI,MAAMA,KAAAA;IAClB,EACF,CAAA;AAED,QAAI,cAAc,MAAM,OAAO;AAE/B,QAAIK,OAAM,KAAK;AACf,QAAIC,OAAM,KAAK;AACf,QAAI,mBAAmB,SAAU,OAAOZ,SAAQ;AAC9C,cAAQ,WAAW,KAAA;AACnB,aAAO,QAAQ,IAAIW,KAAI,QAAQX,SAAQ,CAAA,IAAKY,KAAI,OAAOZ,OAAA;IACxD;AAED,QAAI,eAAe,OAAO;AAC1B,QAAI,iBAAiB,OAAO;AAG5B,YAAQ,QAAQ,IAAI,QAAQ,KAAK,CAAC,CAAC,kBAAkB,eAAe,UAAU,IAAI,UAAU,EAE1F,eAAe,SAASa,gBAAcC,IAAG;AACvC,UAAI,cAAc;AAElB,UAAI,MAAM,CAAE;AACZ,UAAI,OAAO,UAAU;AACrB,UAAIN,KAAI;AACR,UAAI;AACJ,aAAO,OAAOA,IAAG;AACf,eAAO,CAAC,YAAYA,IAAA;AACpB,YAAI,iBAAiB,MAAM,OAAA,MAAc,KAAQ,OAAM,WAAW,OAAO,4BAAA;AACzE,YAAI,KAAK,OAAO,QACZ,aAAa,IAAA,IACb,eAAe,QAAQ,UAAY,MAAM,OAAQ,OAAO,OAAQ,KAAA,CAAO;MAE5E;AAAC,aAAO,IAAI,KAAK,EAAA;IACnB,EACF,CAAA;AAED,QAAI,gBAAgB,MAAM,OAAO;AAGjC,QAAI,kBAAkB;AACtB,QAAI,WAAW;AACf,QAAI,cAAc;AAElB,QAAI,UAAU;MACI;MACP;MACG;IACb;AAED,QAAI,OAAO;MACP,kBAAkB,SAAS,iBAAkBL,KAAG;AAC5C,eAAO,OAAOA,QAAM,YAAY,QAAQ,gBAAgB,KAAKA,GAAAA;MAChE;MAED,eAAe,SAAS,cAAeA,KAAG;AACtC,eAAO,OAAOA,QAAM,aACfA,OAAK,OAAOA,OAAK,OACrBA,OAAK,OAAOA,OAAK,OACjBA,QAAM,OAASA,QAAM,OACtB,QAAQ,SAAS,KAAKA,GAAAA;MAEzB;MAED,kBAAkB,SAAS,iBAAkBA,KAAG;AAC5C,eAAO,OAAOA,QAAM,aACfA,OAAK,OAAOA,OAAK,OACrBA,OAAK,OAAOA,OAAK,OACjBA,OAAK,OAAOA,OAAK,OACjBA,QAAM,OAASA,QAAM,OACrBA,QAAM,YAAcA,QAAM,YAC3B,QAAQ,YAAY,KAAKA,GAAAA;MAE5B;MAED,SAAS,SAAS,QAASA,KAAG;AAC1B,eAAO,OAAOA,QAAM,YAAY,QAAQ,KAAKA,GAAAA;MAChD;MAED,YAAY,SAAS,WAAYA,KAAG;AAChC,eAAO,OAAOA,QAAM,YAAY,cAAc,KAAKA,GAAAA;MACtD;IACJ;AAED,QAAI;AACJ,QAAI;AACJ,QAAI;AACJ,QAAI;AACJ,QAAIY;AACJ,QAAI;AACJ,QAAI;AACJ,QAAI;AACJ,QAAIC;AAEJ,QAAI,QAAQ,SAASC,QAAOC,OAAM,SAAS;AACvC,eAAS,OAAOA,KAAA;AAChB,mBAAa;AACb,cAAQ,CAAE;AACV,YAAM;AACN,MAAAH,QAAO;AACP,eAAS;AACT,cAAQ;AACR,YAAM;AACN,MAAAC,QAAO;AAEP,SAAG;AACC,gBAAQ,IAAA;AAOR,oBAAY,UAAA,EAAA;MACf,SAAQ,MAAM,SAAS;AAExB,UAAI,OAAO,YAAY,WACnB,QAAO,YAAY,EAAC,IAAIA,MAAK,GAAE,IAAI,OAAA;AAGvC,aAAOA;IACV;AAED,aAAS,YAAa,QAAQ,MAAM,SAAS;AACzC,UAAI9B,SAAQ,OAAO,IAAA;AACnB,UAAIA,UAAS,QAAQ,OAAOA,WAAU,SAClC,KAAI,MAAM,QAAQA,MAAA,EACd,UAASsB,KAAI,GAAGA,KAAItB,OAAM,QAAQsB,MAAK;AACnC,YAAIX,QAAM,OAAOW,EAAA;AACjB,YAAI,cAAc,YAAYtB,QAAOW,OAAK,OAAA;AAC1C,YAAI,gBAAgB,OAChB,QAAOX,OAAMW,KAAAA;YAEb,QAAO,eAAeX,QAAOW,OAAK;UAC9B,OAAO;UACP,UAAU;UACV,YAAY;UACZ,cAAc;QACjB,CAAA;MAER;UAED,UAASsB,WAASjC,QAAO;AACrB,YAAI,gBAAgB,YAAYA,QAAOiC,SAAO,OAAA;AAC9C,YAAI,kBAAkB,OAClB,QAAOjC,OAAMiC,OAAAA;YAEb,QAAO,eAAejC,QAAOiC,SAAO;UAChC,OAAO;UACP,UAAU;UACV,YAAY;UACZ,cAAc;QACjB,CAAA;MAER;AAIT,aAAO,QAAQ,KAAK,QAAQ,MAAMjC,MAAA;IACrC;AAED,QAAI;AACJ,QAAI;AACJ,QAAI;AACJ,QAAIkC;AACJ,QAAIjB;AAEJ,aAAS,MAAO;AACZ,iBAAW;AACX,eAAS;AACT,oBAAc;AACd,MAAAiB,QAAO;AAEP,iBAAS;AACL,QAAAjB,KAAIkB,MAAA;AAOJ,YAAIC,UAAQ,UAAU,QAAA,EAAA;AACtB,YAAIA,QACA,QAAOA;MAEd;IACJ;AAED,aAASD,QAAQ;AACb,UAAI,OAAO,GAAA,EACP,QAAO,OAAO,cAAc,OAAO,YAAY,GAAA,CAAI;IAE1D;AAED,aAAS,OAAQ;AACb,UAAIlB,MAAIkB,MAAA;AAER,UAAIlB,QAAM,MAAM;AACZ,QAAAY;AACA,iBAAS;MACZ,WAAUZ,IACP,WAAUA,IAAE;UAEZ;AAGJ,UAAIA,IACA,QAAOA,IAAE;AAGb,aAAOA;IACV;AAED,QAAI,YAAY;MACZ,SAAS,SAAS,YAAa;AAC3B,gBAAQA,IAAR;UACA,KAAK;UACL,KAAK;UACL,KAAK;UACL,KAAK;UACL,KAAK;UACL,KAAK;UACL,KAAK;UACL,KAAK;UACL,KAAK;UACL,KAAK;AACD,iBAAA;AACA;UAEJ,KAAK;AACD,iBAAA;AACA,uBAAW;AACX;UAEJ,KAAK;AACD,iBAAA;AACA,mBAAO,SAAS,KAAA;QACnB;AAED,YAAI,KAAK,iBAAiBA,EAAA,GAAI;AAC1B,eAAA;AACA;QACH;AAOD,eAAO,UAAU,UAAA,EAAA;MACpB;MAED,SAAS,SAAS,UAAW;AACzB,gBAAQA,IAAR;UACA,KAAK;AACD,iBAAA;AACA,uBAAW;AACX;UAEJ,KAAK;AACD,iBAAA;AACA,uBAAW;AACX;QACH;AAED,cAAM,YAAY,KAAA,CAAM;MAC3B;MAED,kBAAkB,SAAS,mBAAoB;AAC3C,gBAAQA,IAAR;UACA,KAAK;AACD,iBAAA;AACA,uBAAW;AACX;UAEJ,KAAK;AACD,kBAAM,YAAY,KAAA,CAAM;QAC3B;AAED,aAAA;MACH;MAED,0BAA0B,SAAS,2BAA4B;AAC3D,gBAAQA,IAAR;UACA,KAAK;AACD,iBAAA;AACA;UAEJ,KAAK;AACD,iBAAA;AACA,uBAAW;AACX;UAEJ,KAAK;AACD,kBAAM,YAAY,KAAA,CAAM;QAC3B;AAED,aAAA;AACA,mBAAW;MACd;MAED,mBAAmB,SAAS,oBAAqB;AAC7C,gBAAQA,IAAR;UACA,KAAK;UACL,KAAK;UACL,KAAK;UACL,KAAK;AACD,iBAAA;AACA,uBAAW;AACX;UAEJ,KAAK;AACD,iBAAA;AACA,mBAAO,SAAS,KAAA;QACnB;AAED,aAAA;MACH;MAED,OAAO,SAASjB,SAAS;AACrB,gBAAQiB,IAAR;UACA,KAAK;UACL,KAAK;AACD,mBAAO,SAAS,cAAc,KAAA,CAAM;UAExC,KAAK;AACD,iBAAA;AACA,oBAAQ,KAAA;AACR,mBAAO,SAAS,QAAQ,IAAA;UAE5B,KAAK;AACD,iBAAA;AACA,oBAAQ,KAAA;AACR,mBAAO,SAAS,WAAW,IAAA;UAE/B,KAAK;AACD,iBAAA;AACA,oBAAQ,MAAA;AACR,mBAAO,SAAS,WAAW,KAAA;UAE/B,KAAK;UACL,KAAK;AACD,gBAAI,KAAA,MAAW,IACX,CAAAiB,QAAO;AAGX,uBAAW;AACX;UAEJ,KAAK;AACD,qBAAS,KAAA;AACT,uBAAW;AACX;UAEJ,KAAK;AACD,qBAAS,KAAA;AACT,uBAAW;AACX;UAEJ,KAAK;UACL,KAAK;UACL,KAAK;UACL,KAAK;UACL,KAAK;UACL,KAAK;UACL,KAAK;UACL,KAAK;UACL,KAAK;AACD,qBAAS,KAAA;AACT,uBAAW;AACX;UAEJ,KAAK;AACD,iBAAA;AACA,oBAAQ,SAAA;AACR,mBAAO,SAAS,WAAW,QAAA;UAE/B,KAAK;AACD,iBAAA;AACA,oBAAQ,IAAA;AACR,mBAAO,SAAS,WAAW,GAAA;UAE/B,KAAK;UACL,KAAK;AACD,0BAAe,KAAA,MAAW;AAC1B,qBAAS;AACT,uBAAW;AACX;QACH;AAED,cAAM,YAAY,KAAA,CAAM;MAC3B;MAED,2BAA2B,SAAS,4BAA6B;AAC7D,YAAIjB,OAAM,IACN,OAAM,YAAY,KAAA,CAAM;AAG5B,aAAA;AACA,YAAIoB,KAAI,cAAA;AACR,gBAAQA,IAAR;UACA,KAAK;UACL,KAAK;AACD;UAEJ;AACI,gBAAI,CAAC,KAAK,cAAcA,EAAA,EACpB,OAAM,kBAAA;AAGV;QACH;AAED,kBAAUA;AACV,mBAAW;MACd;MAED,gBAAgB,SAAS,iBAAkB;AACvC,gBAAQpB,IAAR;UACA,KAAK;UACL,KAAK;UACL,KAAK;UACL,KAAK;AACD,sBAAU,KAAA;AACV;UAEJ,KAAK;AACD,iBAAA;AACA,uBAAW;AACX;QACH;AAED,YAAI,KAAK,iBAAiBA,EAAA,GAAI;AAC1B,oBAAU,KAAA;AACV;QACH;AAED,eAAO,SAAS,cAAc,MAAA;MACjC;MAED,sBAAsB,SAAS,uBAAwB;AACnD,YAAIA,OAAM,IACN,OAAM,YAAY,KAAA,CAAM;AAG5B,aAAA;AACA,YAAIoB,KAAI,cAAA;AACR,gBAAQA,IAAR;UACA,KAAK;UACL,KAAK;UACL,KAAK;UACL,KAAK;AACD;UAEJ;AACI,gBAAI,CAAC,KAAK,iBAAiBA,EAAA,EACvB,OAAM,kBAAA;AAGV;QACH;AAED,kBAAUA;AACV,mBAAW;MACd;MAED,MAAM,SAAS,SAAU;AACrB,gBAAQpB,IAAR;UACA,KAAK;AACD,qBAAS,KAAA;AACT,uBAAW;AACX;UAEJ,KAAK;AACD,qBAAS,KAAA;AACT,uBAAW;AACX;UAEJ,KAAK;UACL,KAAK;UACL,KAAK;UACL,KAAK;UACL,KAAK;UACL,KAAK;UACL,KAAK;UACL,KAAK;UACL,KAAK;AACD,qBAAS,KAAA;AACT,uBAAW;AACX;UAEJ,KAAK;AACD,iBAAA;AACA,oBAAQ,SAAA;AACR,mBAAO,SAAS,WAAWiB,QAAO,QAAA;UAEtC,KAAK;AACD,iBAAA;AACA,oBAAQ,IAAA;AACR,mBAAO,SAAS,WAAW,GAAA;QAC9B;AAED,cAAM,YAAY,KAAA,CAAM;MAC3B;MAED,MAAM,SAAS,OAAQ;AACnB,gBAAQjB,IAAR;UACA,KAAK;AACD,sBAAU,KAAA;AACV,uBAAW;AACX;UAEJ,KAAK;UACL,KAAK;AACD,sBAAU,KAAA;AACV,uBAAW;AACX;UAEJ,KAAK;UACL,KAAK;AACD,sBAAU,KAAA;AACV,uBAAW;AACX;QACH;AAED,eAAO,SAAS,WAAWiB,QAAO,CAAA;MACrC;MAED,gBAAgB,SAAS,iBAAkB;AACvC,gBAAQjB,IAAR;UACA,KAAK;AACD,sBAAU,KAAA;AACV,uBAAW;AACX;UAEJ,KAAK;UACL,KAAK;AACD,sBAAU,KAAA;AACV,uBAAW;AACX;QACH;AAED,YAAI,KAAK,QAAQA,EAAA,GAAI;AACjB,oBAAU,KAAA;AACV;QACH;AAED,eAAO,SAAS,WAAWiB,QAAO,OAAO,MAAA,CAAO;MACnD;MAED,qBAAqB,SAAS,sBAAuB;AACjD,YAAI,KAAK,QAAQjB,EAAA,GAAI;AACjB,oBAAU,KAAA;AACV,qBAAW;AACX;QACH;AAED,cAAM,YAAY,KAAA,CAAM;MAC3B;MAED,cAAc,SAAS,eAAgB;AACnC,gBAAQA,IAAR;UACA,KAAK;UACL,KAAK;AACD,sBAAU,KAAA;AACV,uBAAW;AACX;QACH;AAED,YAAI,KAAK,QAAQA,EAAA,GAAI;AACjB,oBAAU,KAAA;AACV,qBAAW;AACX;QACH;AAED,eAAO,SAAS,WAAWiB,QAAO,OAAO,MAAA,CAAO;MACnD;MAED,iBAAiB,SAAS,kBAAmB;AACzC,gBAAQjB,IAAR;UACA,KAAK;UACL,KAAK;AACD,sBAAU,KAAA;AACV,uBAAW;AACX;QACH;AAED,YAAI,KAAK,QAAQA,EAAA,GAAI;AACjB,oBAAU,KAAA;AACV;QACH;AAED,eAAO,SAAS,WAAWiB,QAAO,OAAO,MAAA,CAAO;MACnD;MAED,iBAAiB,SAAS,kBAAmB;AACzC,gBAAQjB,IAAR;UACA,KAAK;UACL,KAAK;AACD,sBAAU,KAAA;AACV,uBAAW;AACX;QACH;AAED,YAAI,KAAK,QAAQA,EAAA,GAAI;AACjB,oBAAU,KAAA;AACV,qBAAW;AACX;QACH;AAED,cAAM,YAAY,KAAA,CAAM;MAC3B;MAED,qBAAqB,SAAS,sBAAuB;AACjD,YAAI,KAAK,QAAQA,EAAA,GAAI;AACjB,oBAAU,KAAA;AACV,qBAAW;AACX;QACH;AAED,cAAM,YAAY,KAAA,CAAM;MAC3B;MAED,wBAAwB,SAAS,yBAA0B;AACvD,YAAI,KAAK,QAAQA,EAAA,GAAI;AACjB,oBAAU,KAAA;AACV;QACH;AAED,eAAO,SAAS,WAAWiB,QAAO,OAAO,MAAA,CAAO;MACnD;MAED,aAAa,SAAS,cAAe;AACjC,YAAI,KAAK,WAAWjB,EAAA,GAAI;AACpB,oBAAU,KAAA;AACV,qBAAW;AACX;QACH;AAED,cAAM,YAAY,KAAA,CAAM;MAC3B;MAED,oBAAoB,SAAS,qBAAsB;AAC/C,YAAI,KAAK,WAAWA,EAAA,GAAI;AACpB,oBAAU,KAAA;AACV;QACH;AAED,eAAO,SAAS,WAAWiB,QAAO,OAAO,MAAA,CAAO;MACnD;MAED,QAAQ,SAASI,UAAU;AACvB,gBAAQrB,IAAR;UACA,KAAK;AACD,iBAAA;AACA,sBAAU,OAAA;AACV;UAEJ,KAAK;AACD,gBAAI,aAAa;AACb,mBAAA;AACA,qBAAO,SAAS,UAAU,MAAA;YAC7B;AAED,sBAAU,KAAA;AACV;UAEJ,KAAK;AACD,gBAAI,CAAC,aAAa;AACd,mBAAA;AACA,qBAAO,SAAS,UAAU,MAAA;YAC7B;AAED,sBAAU,KAAA;AACV;UAEJ,KAAK;UACL,KAAK;AACD,kBAAM,YAAY,KAAA,CAAM;UAE5B,KAAK;UACL,KAAK;AACD,0BAAcA,EAAA;AACd;UAEJ,KAAK;AACD,kBAAM,YAAY,KAAA,CAAM;QAC3B;AAED,kBAAU,KAAA;MACb;MAED,OAAO,SAAS,QAAS;AACrB,gBAAQA,IAAR;UACA,KAAK;UACL,KAAK;AACD,mBAAO,SAAS,cAAc,KAAA,CAAM;QAKvC;AAED,mBAAW;MACd;MAED,oBAAoB,SAAS,qBAAsB;AAC/C,gBAAQA,IAAR;UACA,KAAK;UACL,KAAK;AACD,qBAAS,KAAA;AACT,uBAAW;AACX;UAEJ,KAAK;AACD,iBAAA;AACA,uBAAW;AACX;UAEJ,KAAK;AACD,mBAAO,SAAS,cAAc,KAAA,CAAM;UAExC,KAAK;UACL,KAAK;AACD,0BAAe,KAAA,MAAW;AAC1B,uBAAW;AACX;QACH;AAED,YAAI,KAAK,cAAcA,EAAA,GAAI;AACvB,oBAAU,KAAA;AACV,qBAAW;AACX;QACH;AAED,cAAM,YAAY,KAAA,CAAM;MAC3B;MAED,mBAAmB,SAAS,oBAAqB;AAC7C,YAAIA,OAAM,IACN,QAAO,SAAS,cAAc,KAAA,CAAM;AAGxC,cAAM,YAAY,KAAA,CAAM;MAC3B;MAED,qBAAqB,SAAS,sBAAuB;AACjD,mBAAW;MACd;MAED,oBAAoB,SAAS,qBAAsB;AAC/C,gBAAQA,IAAR;UACA,KAAK;UACL,KAAK;AACD,mBAAO,SAAS,cAAc,KAAA,CAAM;QACvC;AAED,cAAM,YAAY,KAAA,CAAM;MAC3B;MAED,kBAAkB,SAAS,mBAAoB;AAC3C,YAAIA,OAAM,IACN,QAAO,SAAS,cAAc,KAAA,CAAM;AAGxC,mBAAW;MACd;MAED,iBAAiB,SAAS,kBAAmB;AACzC,gBAAQA,IAAR;UACA,KAAK;UACL,KAAK;AACD,mBAAO,SAAS,cAAc,KAAA,CAAM;QACvC;AAED,cAAM,YAAY,KAAA,CAAM;MAC3B;MAED,KAAK,SAAS,MAAO;AAOjB,cAAM,YAAY,KAAA,CAAM;MAC3B;IACJ;AAED,aAAS,SAAU,MAAMjB,QAAO;AAC5B,aAAO;QACG;QACC,OAAAA;QACD,MAAA6B;QACE;MACX;IACJ;AAED,aAAS,QAASR,IAAG;AACjB,eAASC,KAAI,GAAG,OAAOD,IAAGC,KAAI,KAAK,QAAQA,MAAK,GAAG;AAC/C,YAAIL,MAAI,KAAKK,EAAA;AAEb,YAAIiB,KAAIJ,MAAA;AAER,YAAII,OAAMtB,IACN,OAAM,YAAY,KAAA,CAAM;AAG5B,aAAA;MACH;IACJ;AAED,aAAS,SAAU;AACf,UAAIA,MAAIkB,MAAA;AACR,cAAQlB,KAAR;QACA,KAAK;AACD,eAAA;AACA,iBAAO;QAEX,KAAK;AACD,eAAA;AACA,iBAAO;QAEX,KAAK;AACD,eAAA;AACA,iBAAO;QAEX,KAAK;AACD,eAAA;AACA,iBAAO;QAEX,KAAK;AACD,eAAA;AACA,iBAAO;QAEX,KAAK;AACD,eAAA;AACA,iBAAO;QAEX,KAAK;AACD,eAAA;AACA,cAAI,KAAK,QAAQkB,MAAA,CAAM,EACnB,OAAM,YAAY,KAAA,CAAM;AAG5B,iBAAO;QAEX,KAAK;AACD,eAAA;AACA,iBAAO,UAAA;QAEX,KAAK;AACD,eAAA;AACA,iBAAO,cAAA;QAEX,KAAK;QACL,KAAK;QACL,KAAK;AACD,eAAA;AACA,iBAAO;QAEX,KAAK;AACD,eAAA;AACA,cAAIA,MAAA,MAAW,KACX,MAAA;AAGJ,iBAAO;QAEX,KAAK;QACL,KAAK;QACL,KAAK;QACL,KAAK;QACL,KAAK;QACL,KAAK;QACL,KAAK;QACL,KAAK;QACL,KAAK;AACD,gBAAM,YAAY,KAAA,CAAM;QAE5B,KAAK;AACD,gBAAM,YAAY,KAAA,CAAM;MAC3B;AAED,aAAO,KAAA;IACV;AAED,aAAS,YAAa;AAClB,UAAIK,WAAS;AACb,UAAIvB,MAAIkB,MAAA;AAER,UAAI,CAAC,KAAK,WAAWlB,GAAAA,EACjB,OAAM,YAAY,KAAA,CAAM;AAG5BuB,kBAAU,KAAA;AAEVvB,YAAIkB,MAAA;AACJ,UAAI,CAAC,KAAK,WAAWlB,GAAAA,EACjB,OAAM,YAAY,KAAA,CAAM;AAG5BuB,kBAAU,KAAA;AAEV,aAAO,OAAO,cAAc,SAASA,UAAQ,EAAA,CAAG;IACnD;AAED,aAAS,gBAAiB;AACtB,UAAIA,WAAS;AACb,UAAIC,SAAQ;AAEZ,aAAOA,WAAU,GAAG;AAChB,YAAIxB,MAAIkB,MAAA;AACR,YAAI,CAAC,KAAK,WAAWlB,GAAAA,EACjB,OAAM,YAAY,KAAA,CAAM;AAG5BuB,oBAAU,KAAA;MACb;AAED,aAAO,OAAO,cAAc,SAASA,UAAQ,EAAA,CAAG;IACnD;AAED,QAAI,cAAc;MACd,OAAO,SAAS,QAAS;AACrB,YAAI,MAAM,SAAS,MACf,OAAM,WAAA;AAGV,QAAAE,MAAA;MACH;MAED,oBAAoB,SAAS,qBAAsB;AAC/C,gBAAQ,MAAM,MAAd;UACA,KAAK;UACL,KAAK;AACD,kBAAM,MAAM;AACZ,yBAAa;AACb;UAEJ,KAAK;AAMD,YAAAC,KAAA;AACA;UAEJ,KAAK;AACD,kBAAM,WAAA;QACT;MAIJ;MAED,mBAAmB,SAAS,oBAAqB;AAM7C,YAAI,MAAM,SAAS,MACf,OAAM,WAAA;AAGV,qBAAa;MAChB;MAED,qBAAqB,SAAS,sBAAuB;AACjD,YAAI,MAAM,SAAS,MACf,OAAM,WAAA;AAGV,QAAAD,MAAA;MACH;MAED,kBAAkB,SAAS,mBAAoB;AAC3C,YAAI,MAAM,SAAS,MACf,OAAM,WAAA;AAGV,YAAI,MAAM,SAAS,gBAAgB,MAAM,UAAU,KAAK;AACpD,UAAAC,KAAA;AACA;QACH;AAED,QAAAD,MAAA;MACH;MAED,oBAAoB,SAAS,qBAAsB;AAM/C,YAAI,MAAM,SAAS,MACf,OAAM,WAAA;AAGV,gBAAQ,MAAM,OAAd;UACA,KAAK;AACD,yBAAa;AACb;UAEJ,KAAK;AACD,YAAAC,KAAA;QACH;MAIJ;MAED,iBAAiB,SAAS,kBAAmB;AAMzC,YAAI,MAAM,SAAS,MACf,OAAM,WAAA;AAGV,gBAAQ,MAAM,OAAd;UACA,KAAK;AACD,yBAAa;AACb;UAEJ,KAAK;AACD,YAAAA,KAAA;QACH;MAIJ;MAED,KAAK,SAAS,MAAO;MAKpB;IACJ;AAED,aAASD,QAAQ;AACb,UAAI1C;AAEJ,cAAQ,MAAM,MAAd;QACA,KAAK;AACD,kBAAQ,MAAM,OAAd;YACA,KAAK;AACD,cAAAA,SAAQ,CAAE;AACV;YAEJ,KAAK;AACD,cAAAA,SAAQ,CAAE;AACV;UACH;AAED;QAEJ,KAAK;QACL,KAAK;QACL,KAAK;QACL,KAAK;AACD,UAAAA,SAAQ,MAAM;AACd;MAKH;AAED,UAAI8B,UAAS,OACT,CAAAA,QAAO9B;WACJ;AACH,YAAI,SAAS,MAAM,MAAM,SAAS,CAAA;AAClC,YAAI,MAAM,QAAQ,MAAA,EACd,QAAO,KAAKA,MAAA;YAEZ,QAAO,eAAe,QAAQ,KAAK;UACxB,OAAAA;UACP,UAAU;UACV,YAAY;UACZ,cAAc;QACjB,CAAA;MAER;AAED,UAAIA,WAAU,QAAQ,OAAOA,WAAU,UAAU;AAC7C,cAAM,KAAKA,MAAA;AAEX,YAAI,MAAM,QAAQA,MAAA,EACd,cAAa;YAEb,cAAa;MAEpB,OAAM;AACH,YAAI,UAAU,MAAM,MAAM,SAAS,CAAA;AACnC,YAAI,WAAW,KACX,cAAa;iBACN,MAAM,QAAQ,OAAA,EACrB,cAAa;YAEb,cAAa;MAEpB;IACJ;AAED,aAAS2C,OAAO;AACZ,YAAM,IAAA;AAEN,UAAI,UAAU,MAAM,MAAM,SAAS,CAAA;AACnC,UAAI,WAAW,KACX,cAAa;eACN,MAAM,QAAQ,OAAA,EACrB,cAAa;UAEb,cAAa;IAEpB;AAYD,aAAS,YAAa1B,KAAG;AACrB,UAAIA,QAAM,OACN,QAAO,YAAa,oCAAoCY,QAAO,MAAM,MAAA;AAGzE,aAAO,YAAa,+BAAgC,WAAWZ,GAAAA,IAAM,UAAUY,QAAO,MAAM,MAAA;IAC/F;AAED,aAAS,aAAc;AACnB,aAAO,YAAa,oCAAoCA,QAAO,MAAM,MAAA;IACxE;AAYD,aAAS,oBAAqB;AAC1B,gBAAU;AACV,aAAO,YAAa,4CAA4CA,QAAO,MAAM,MAAA;IAChF;AAED,aAAS,cAAeZ,KAAG;AACvB,cAAQ,KAAM,aAAc,WAAWA,GAAAA,IAAM,yDAAA;IAChD;AAED,aAAS,WAAYA,KAAG;AACpB,UAAI,eAAe;QACf,KAAK;QACL,KAAK;QACL,MAAM;QACN,MAAM;QACN,MAAM;QACN,MAAM;QACN,MAAM;QACN,KAAM;QACN,MAAM;QACN,MAAM;QACN,UAAU;QACV,UAAU;MACb;AAED,UAAI,aAAaA,GAAAA,EACb,QAAO,aAAaA,GAAAA;AAGxB,UAAIA,MAAI,KAAK;AACT,YAAI,YAAYA,IAAE,WAAW,CAAA,EAAG,SAAS,EAAA;AACzC,eAAO,SAAS,OAAO,WAAW,UAAU,UAAU,MAAA;MACzD;AAED,aAAOA;IACV;AAED,aAAS,YAAa,SAAS;AAC3B,UAAI,MAAM,IAAI,YAAY,OAAA;AAC1B,UAAI,aAAaY;AACjB,UAAI,eAAe;AACnB,aAAO;IACV;AAED,QAAI,YAAY,SAASe,YAAW5C,QAAO,UAAU,OAAO;AACxD,UAAI6C,UAAQ,CAAE;AACd,UAAI,SAAS;AACb,UAAI;AACJ,UAAI;AACJ,UAAI,MAAM;AACV,UAAI;AAEJ,UACI,YAAY,QACZ,OAAO,aAAa,YACpB,CAAC,MAAM,QAAQ,QAAA,GACjB;AACE,gBAAQ,SAAS;AACjB,gBAAQ,SAAS;AACjB,mBAAW,SAAS;MACvB;AAED,UAAI,OAAO,aAAa,WACpB,gBAAe;eACR,MAAM,QAAQ,QAAA,GAAW;AAChC,uBAAe,CAAE;AACjB,iBAASvB,KAAI,GAAG,OAAO,UAAUA,KAAI,KAAK,QAAQA,MAAK,GAAG;AACtD,cAAIwB,KAAI,KAAKxB,EAAA;AAEb,cAAI,OAAQ;AAEZ,cAAI,OAAOwB,OAAM,SACb,QAAOA;mBAEP,OAAOA,OAAM,YACbA,cAAa,UACbA,cAAa,OAEb,QAAO,OAAOA,EAAA;AAGlB,cAAI,SAAS,UAAa,aAAa,QAAQ,IAAA,IAAQ,EACnD,cAAa,KAAK,IAAA;QAEzB;MACJ;AAED,UAAI,iBAAiB,OACjB,SAAQ,OAAO,KAAA;eACR,iBAAiB,OACxB,SAAQ,OAAO,KAAA;AAGnB,UAAI,OAAO,UAAU,UACjB;YAAI,QAAQ,GAAG;AACX,kBAAQ,KAAK,IAAI,IAAI,KAAK,MAAM,KAAA,CAAM;AACtC,gBAAM,aAAa,OAAO,GAAG,KAAA;QAChC;iBACM,OAAO,UAAU,SACxB,OAAM,MAAM,OAAO,GAAG,EAAA;AAG1B,aAAO,kBAAkB,IAAI,EAAC,IAAI9C,OAAM,CAAA;AAExC,eAAS,kBAAmBW,OAAK,QAAQ;AACrC,YAAIX,UAAQ,OAAOW,KAAAA;AACnB,YAAIX,WAAS,MACT;cAAI,OAAOA,QAAM,YAAY,WACzBA,WAAQA,QAAM,QAAQW,KAAAA;mBACf,OAAOX,QAAM,WAAW,WAC/BA,WAAQA,QAAM,OAAOW,KAAAA;QACxB;AAGL,YAAI,aACAX,WAAQ,aAAa,KAAK,QAAQW,OAAKX,OAAAA;AAG3C,YAAIA,mBAAiB,OACjBA,WAAQ,OAAOA,OAAAA;iBACRA,mBAAiB,OACxBA,WAAQ,OAAOA,OAAAA;iBACRA,mBAAiB,QACxBA,WAAQA,QAAM,QAAA;AAGlB,gBAAQA,SAAR;UACA,KAAK;AAAM,mBAAO;UAClB,KAAK;AAAM,mBAAO;UAClB,KAAK;AAAO,mBAAO;QAClB;AAED,YAAI,OAAOA,YAAU,SACjB,QAAO,YAAYA,SAAO,KAAA;AAG9B,YAAI,OAAOA,YAAU,SACjB,QAAO,OAAOA,OAAAA;AAGlB,YAAI,OAAOA,YAAU,SACjB,QAAO,MAAM,QAAQA,OAAAA,IAAS,eAAeA,OAAAA,IAAS,gBAAgBA,OAAAA;AAG1E,eAAO;MACV;AAED,eAAS,YAAaA,SAAO;AACzB,YAAI,SAAS;UACT,KAAK;UACL,KAAK;QACR;AAED,YAAI,eAAe;UACf,KAAK;UACL,KAAK;UACL,MAAM;UACN,MAAM;UACN,MAAM;UACN,MAAM;UACN,MAAM;UACN,KAAM;UACN,MAAM;UACN,MAAM;UACN,UAAU;UACV,UAAU;QACb;AAED,YAAI,UAAU;AAEd,iBAASsB,MAAI,GAAGA,MAAItB,QAAM,QAAQsB,OAAK;AACnC,cAAIL,MAAIjB,QAAMsB,GAAAA;AACd,kBAAQL,KAAR;YACA,KAAK;YACL,KAAK;AACD,qBAAOA,GAAAA;AACP,yBAAWA;AACX;YAEJ,KAAK;AACD,kBAAI,KAAK,QAAQjB,QAAMsB,MAAI,CAAA,CAAA,GAAK;AAC5B,2BAAW;AACX;cACH;UACJ;AAED,cAAI,aAAaL,GAAAA,GAAI;AACjB,uBAAW,aAAaA,GAAAA;AACxB;UACH;AAED,cAAIA,MAAI,KAAK;AACT,gBAAI,YAAYA,IAAE,WAAW,CAAA,EAAG,SAAS,EAAA;AACzC,uBAAW,SAAS,OAAO,WAAW,UAAU,UAAU,MAAA;AAC1D;UACH;AAED,qBAAWA;QACd;AAED,YAAI,YAAY,SAAS,OAAO,KAAK,MAAA,EAAQ,OAAO,SAAUF,IAAGC,IAAG;AAAE,iBAAQ,OAAOD,EAAA,IAAK,OAAOC,EAAA,IAAMD,KAAIC;QAAI,CAAA;AAE/G,kBAAU,QAAQ,QAAQ,IAAI,OAAO,WAAW,GAAA,GAAM,aAAa,SAAA,CAAA;AAEnE,eAAO,YAAY,UAAU;MAChC;AAED,eAAS,gBAAiBhB,SAAO;AAC7B,YAAI6C,QAAM,QAAQ7C,OAAAA,KAAU,EACxB,OAAM,UAAU,wCAAA;AAGpB6C,gBAAM,KAAK7C,OAAAA;AAEX,YAAI,WAAW;AACf,iBAAS,SAAS;AAElB,YAAI,OAAO,gBAAgB,OAAO,KAAKA,OAAAA;AACvC,YAAI,UAAU,CAAE;AAChB,iBAASsB,MAAI,GAAGyB,SAAO,MAAMzB,MAAIyB,OAAK,QAAQzB,OAAK,GAAG;AAClD,cAAIX,QAAMoC,OAAKzB,GAAAA;AAEf,cAAI,iBAAiB,kBAAkBX,OAAKX,OAAAA;AAC5C,cAAI,mBAAmB,QAAW;AAC9B,gBAAI,SAAS,aAAaW,KAAAA,IAAO;AACjC,gBAAI,QAAQ,GACR,WAAU;AAEd,sBAAU;AACV,oBAAQ,KAAK,MAAA;UAChB;QACJ;AAED,YAAI;AACJ,YAAI,QAAQ,WAAW,EACnB,SAAQ;aACL;AACH,cAAI;AACJ,cAAI,QAAQ,IAAI;AACZ,yBAAa,QAAQ,KAAK,GAAA;AAC1B,oBAAQ,MAAM,aAAa;UAC9B,OAAM;AACH,gBAAI,YAAY,QAAQ;AACxB,yBAAa,QAAQ,KAAK,SAAA;AAC1B,oBAAQ,QAAQ,SAAS,aAAa,QAAQ,WAAW;UAC5D;QACJ;AAEDkC,gBAAM,IAAA;AACN,iBAAS;AACT,eAAO;MACV;AAED,eAAS,aAAclC,OAAK;AACxB,YAAIA,MAAI,WAAW,EACf,QAAO,YAAYA,OAAK,IAAA;AAG5B,YAAI,YAAY,OAAO,cAAcA,MAAI,YAAY,CAAA,CAAE;AACvD,YAAI,CAAC,KAAK,cAAc,SAAA,EACpB,QAAO,YAAYA,OAAK,IAAA;AAG5B,iBAASW,MAAI,UAAU,QAAQA,MAAIX,MAAI,QAAQW,MAC3C,KAAI,CAAC,KAAK,iBAAiB,OAAO,cAAcX,MAAI,YAAYW,GAAAA,CAAE,CAAC,EAC/D,QAAO,YAAYX,OAAK,IAAA;AAIhC,eAAOA;MACV;AAED,eAAS,eAAgBX,SAAO;AAC5B,YAAI6C,QAAM,QAAQ7C,OAAAA,KAAU,EACxB,OAAM,UAAU,wCAAA;AAGpB6C,gBAAM,KAAK7C,OAAAA;AAEX,YAAI,WAAW;AACf,iBAAS,SAAS;AAElB,YAAI,UAAU,CAAE;AAChB,iBAASsB,MAAI,GAAGA,MAAItB,QAAM,QAAQsB,OAAK;AACnC,cAAI,iBAAiB,kBAAkB,OAAOA,GAAAA,GAAItB,OAAAA;AAClD,kBAAQ,KAAM,mBAAmB,SAAa,iBAAiB,MAAA;QAClE;AAED,YAAI;AACJ,YAAI,QAAQ,WAAW,EACnB,SAAQ;iBAEJ,QAAQ,IAAI;AACZ,cAAI,aAAa,QAAQ,KAAK,GAAA;AAC9B,kBAAQ,MAAM,aAAa;QAC9B,OAAM;AACH,cAAI,YAAY,QAAQ;AACxB,cAAI,eAAe,QAAQ,KAAK,SAAA;AAChC,kBAAQ,QAAQ,SAAS,eAAe,QAAQ,WAAW;QAC9D;AAGL6C,gBAAM,IAAA;AACN,iBAAS;AACT,eAAO;MACV;IACJ;AAED,QAAI,QAAQ;MACD;MACI;IACd;AAED,QAAI,MAAM;AAEV,QAAI,MAAM;AAEV,WAAO;EAEP,CAAA;;;;ACnsDD,IAAa,aAAa,CAAC,OAAO;AAC9B,MAAI,OAAO,OAAO,SACd,QAAO;AACX,MAAI,OAAO,KACP,QAAO;AACX,SAAQ,QAAQ,MAAM,aAAa;AACtC;AAQD,IAAa,UAAU,CAAC,OAAO;AAC3B,MAAI,CAAC,WAAW,EAAA,EACZ,QAAO;AACX,MAAI,UAAU,IAAI;AAEd,UAAMG,KAAI,GAAG,KAAA;AACb,QAAIA,OAAM,OACN,QAAO;EACd;AACD,SAAO;AACV;AC7BD,IAAaC,qBAAoB,CAACC,MAAKC,QAAO,CAAC,KAAK,SAAS;AACzD,MAAIC,SAAQF,KAAI,IAAI,GAAA;AACpB,MAAIE,WAAU,OACV,QAAOA;AACX,EAAAA,SAAQD,IAAG,KAAK,IAAA;AAChB,EAAAD,KAAI,IAAI,KAAKE,MAAA;AACb,SAAOA;AACV;AC0BD,IAAa,SAAS,CAAC,QAAQ,OAAO,OAAO,cAAc,CAACC,OAAM;AAC9D,MAAIA,OAAM,OACN,CAAAA,KAAI;WAEC,OAAOA,OAAM,SAClB,CAAAA,KAAI,KAAK,UAAUA,EAAA;AAEvB,QAAM,SAAS,aAAa;AAC5B,UAAQ,MAAR;IACI,KAAK,OAAO;AACR,cAAQ,IAAI,KAAK,MAAA,IAAUA,EAAA,IAAK,UAAU,WAAW,MAAA,CAAO,EAAE;AAC9D;IACH;IACD,KAAK,QAAQ;AACT,cAAQ,KAAK,QAAQA,EAAA;AACrB;IACH;IACD,KAAK,SAAS;AACV,cAAQ,MAAM,QAAQA,EAAA;AACtB;IACH;EACJ;AACJ;AAwBD,IAAa,SAAS,CAAC,QAAQ,UAAU,MAAM,cAAc;AACzD,MAAI,QACA,QAAO;IACH,KAAK,OAAO,QAAQ,OAAO,SAAA;IAC3B,MAAM,OAAO,QAAQ,QAAQ,SAAA;IAC7B,OAAO,OAAO,QAAQ,SAAS,SAAA;EAClC;AAEL,SAAO;IACH,KAAK,CAACC,OAAM;IAEX;IACD,MAAM,OAAO,QAAQ,QAAQ,SAAA;IAC7B,OAAO,OAAO,QAAQ,SAAS,SAAA;EAClC;AACJ;AAMD,IAAa,mBAAmB,CAACC,IAAGC,YAAW,CAAE,MAAK;AAClD,MAAID,OAAM,UAAc,OAAOA,OAAM,aAAa,CAACA,GAC/C,QAAO,CAACD,OAAM;EAEb;AAEL,QAAM,aAAaE,UAAS,YAAY;AACxC,QAAM,cAAcA,UAAS,QAAQ;AACrC,MAAI,OAAOD,OAAM,UACb,QAAO,CAAC,oBAAoB;AACxB,UAAMF,KAAI,OAAO,oBAAoB,WAAW,EAAE,KAAK,gBAAiB,IAAG;AAC3E,UAAM,OAAOA,GAAE,QAAQ;AACvB,UAAM,WAAWA,GAAE,YAAY;AAC/B,QAAI,UAAUA,GAAE;AAChB,QAAI,SACA,WAAU,IAAI,QAAA,KAAa,OAAA;AAC/B,YAAQ,MAAR;MACI,KAAK,SAAS;AACV,gBAAQ,MAAM,OAAA;AACd;MACH;MACD,KAAK,QAAQ;AACT,gBAAQ,KAAK,OAAA;AACb;MACH;MACD,KAAK,QAAQ;AACT,gBAAQ,KAAK,OAAA;AACb;MACH;MACD;AACI,gBAAQ,IAAI,OAAA;IAEnB;EACJ;AAEL,SAAOE;AACV;AACD,IAAI,iBAAiB;AACrB,IAAa,aAAaN,mBAAkB,oBAAI,IAAA,GAAO,MAAM;AACzD,QAAM,MAAM,EAAE,iBAAiB;AAC/B,SAAO,OAAO,GAAA;AACjB,CAAA;AC1HD,IAAa,aAAa,CAAC,cAAc,MAAM,qBAAqB,QAAQ;AACxE,MAAIQ,SAAQ;AACZ,MAAI,UAAU;AACd,MAAI,aAAa,YAAY,IAAA;AAC7B,SAAO,MAAM;AACT,QAAIA,YAAW,oBAAoB;AAC/B,YAAMC,WAAU,YAAY,IAAA,IAAQ;AACpC,mBAAa,YAAY,IAAA;AACzB,MAAAD,SAAQ;AACR,gBAAU,KAAK,MAAO,qBAAqBC,WAAW,GAAA;AACtD,UAAI,YACA,SAAQ,IAAI,QAAQ,OAAA,EAAS;IACpC;AACD,WAAO;EACV;AACJ;AC7BD,IAAaC,mBAAkB,CAAC,OAAO;AACnC,MAAI,OAAO,OAAO,SACd,QAAO;AACX,MAAI,cAAc,MACd,QAAO,GAAG;AAEd,SAAO;AACV;;;;;;;;;;AEiBD,eAAsB,QAAQ,eAAe,MAAM;AAC/C,MAAI,OAAO,eAAe,SACtB,KAAI,UAAU,YAAY;AACtB,UAAM,MAAM,WAAW,OAAO,WAAA;AAC9B,QAAI,QAAQ,eAAe,OAAO,kBAAkB;AAChD,YAAMX,KAAI,WAAW,KAAA;AACrB,UAAI,UAAUA,MAAK,WAAWA,GAC1B,QAAOA,GAAE;AACb,aAAOA;IACV,WACQ,QAAQ,kBAAkB;AAC/B,YAAMA,KAAI,MAAM,WAAW,KAAA;AAE3B,UAAI,UAAUA,MAAK,WAAWA,GAC1B,QAAOA,GAAE;AACb,aAAOA;IACV,MAEG,OAAM,IAAI,MAAM,wHAAwH,GAAA,GAAM;EAErJ,WACQ,WAAW,UAAA,GAAa;AAE7B,QAAI,QAAQ,UAAA,EACR,QAAO,WAAW,KAAA;AACtB,UAAM,IAAI,MAAM,mCAAmC;EACtD,MAGG,QAAO;WAGN,OAAO,eAAe,YAAY;AACvC,UAAMA,KAAI,MAAM,WAAW,GAAG,IAAA;AAC9B,WAAOA;EACV,MAGG,QAAO;AAEd;AAOD,SAAgB,YAAY,eAAe,MAAM;AAC7C,MAAI,OAAO,eAAe,SACtB,KAAI,UAAU,YAAY;AACtB,UAAM,MAAM,WAAW,OAAO,WAAA;AAC9B,QAAI,QAAQ,eAAe,OAAO,kBAAkB;AAChD,YAAMA,KAAI,WAAW,KAAA;AACrB,UAAI,UAAUA,MAAK,WAAWA,GAC1B,QAAOA,GAAE;AACb,aAAOA;IACV,WACQ,QAAQ,iBACb,OAAM,IAAI,MAAM,iDAAiD;QAGjE,OAAM,IAAI,MAAM,sGAAsG,GAAA,GAAM;EAEnI,WACQ,WAAW,UAAA,GAAa;AAE7B,QAAI,QAAQ,UAAA,EACR,QAAO,WAAW,KAAA;AACtB,UAAM,IAAI,MAAM,mCAAmC;EACtD,MAGG,QAAO;WAGN,OAAO,eAAe,WAC3B,QAAO,WAAW,GAAG,IAAA;MAIrB,QAAO;AAEd;;;ACtFD,IAAaY,iBAAb,MAAaA,uBAAsB,MAAM;EACrC;EACA;EACA,YAAY,WAAW,GAAG;AACtB,UAAA;AAEA,gBAAY,YAAY,UAAU,YAAY,UAAU,CAAC;AAEzD,SAAKC,YAAY;AACjB,SAAKC,WAAW;EACnB;;;;;;EAMD,IAAIC,SAAO;AACP,UAAMC,MAAKJ,eAAc,KAAK,IAAA;AAC9B,IAAAI,IAAG,KAAKF,QAAAA,IAAYC;AACpB,IAAAC,IAAGH,YAAY,KAAKA;AACpB,QAAI,KAAKA,YAAY,EACjB,CAAAG,IAAGF,WACC,KAAKA,WAAW,MAAM,KAAKD,YAAY,IAAI,KAAKC,WAAW;QAG/D,CAAAE,IAAGF,WAAW,KAAKA,WAAW;AAElC,WAAOE;EACV;EACD,IAAI,UAAU;AACV,WAAO,KAAKF;EACf;EACD,IAAI,SAAS;AACT,QAAI,KAAKD,cAAc,EACnB,QAAO;AACX,WAAO,KAAK,WAAW,KAAKA;EAC/B;AACJ;AC9DD,IAAaI,SAAQ,CAAC,MAAM,YAAY;AACpC,OAAK,SAAQ,QAAQ,IAAI,SAAS,OAAA,EAAS;AAC9C;AACD,IAAaC,aAAY,CAAC,MAAM,OAAO,UAAU;AAC7C,QAAM,kBAAkB,MAAM,SAAS,MAAM;AAC7C,QAAM,WAAW,KAAK,YAAY;AAClC,QAAM,WAAW,kBAAkB;AACnC,QAAM,SAAS,KAAK,iBAAiB;AAMrC,UAAQ,QAAR;IAEI,KAAK,aAAa;AAOd,UAAI,MAAM,WAAW,EACjB,QAAO,MAAM,MAAM,GAAG,MAAM,SAAS,QAAA;AAEzC,UAAI,MAAM,WAAW,KAAK,SACtB,QAAO;UAIP,QAAO,CAAC,GAAG,OAAO,GAAG,MAAM,MAAM,GAAG,WAAW,CAAA,CAAG;IAEzD;IAED,KAAK;AACD,UAAI,YAAY,MAAM,QAAQ;AAG1B,YAAI,MAAM,WAAW,EAGjB,QAAO,CAAC,GAAG,MAAM,MAAM,GAAG,WAAW,CAAA,GAAI,MAAM,GAAG,EAAA,CAAI;AAE1D,eAAO,MAAM,MAAM,KAAK,IAAI,GAAG,MAAM,SAAS,QAAA,GAAW,KAAK,IAAI,MAAM,QAAQ,QAAA,IAAY,CAAA;MAG/F,OACI;AAOD,cAAM,aAAa,KAAK,IAAI,GAAG,MAAM,SAAS,MAAM,MAAA;AACpD,cAAM,aAAa,MAAM,MAAM,MAAM,SAAS,YAAY,MAAM,MAAA;AAChE,cAAM,SAAS,MAAM,MAAM,GAAG,KAAK,IAAI,MAAM,QAAQ,WAAW,CAAA,CAAE;AAWlE,cAAMC,KAAI,CAAC,GAAG,QAAQ,GAAG,UAAW;AAEpC,eAAOA;MACV;IAGL,KAAK;AAED,aAAO,CAAC,GAAG,OAAO,GAAG,KAAM,EAAC,MAAM,QAAA;IAEtC;AAEI,YAAM,IAAI,MAAM,2BAA2B,MAAA,EAAQ;EAE1D;AACJ;AAUD,IAAaC,WAAU,CAAC,MAAM,UAAU,UAAU;AAC9C,MAAI,SAAS,OACT,OAAM,IAAI,MAAM,0BAA0B;AAC9C,QAAM,kBAAkB,MAAM,SAAS,MAAM;AAC7C,QAAM,WAAW,KAAK,YAAY,kBAAkB,KAAK;AACzD,QAAM,WAAW,WACXF,WAAU,MAAM,OAAO,KAAA,IACvB,CAAC,GAAG,OAAO,GAAG,KAAM;AAC1B,MAAI,KAAK,YAAY,SAAS,WAAW,KAAK,YAAY,SACtD,OAAM,IAAI,MAAM,uDAAuD,SAAS,MAAA,cAAoB,KAAK,QAAA,UAAkB,KAAK,UAAU,IAAA,CAAK,EAAE;AAErJ,MAAI,CAAC,KAAK,YAAY,SAAS,WAAW,gBACtC,OAAM,IAAI,MAAM,gDAAgD,SAAS,MAAA,cAAoB,eAAA,UAAyB,KAAK,UAAU,IAAA,CAAK,EAAE;AAEhJ,SAAO;AACV;AAED,IAAaG,WAAU,CAAC,MAAM,UAAU;AACpC,MAAI,MAAM,WAAW,EACjB,OAAM,IAAI,MAAM,gBAAgB;AACpC,SAAO,MAAM,MAAM,CAAA;AACtB;AASD,IAAaC,QAAO,CAAC,MAAM,UAAU,MAAM,CAAA;AAC3C,IAAaC,WAAU,CAAC,MAAM,UAAU,MAAM,WAAW;AACzD,IAAaC,UAAS,CAAC,MAAM,UAAU;AACnC,MAAI,KAAK,SACL,QAAO,MAAM,UAAU,KAAK;AAEhC,SAAO;AACV;ACrFD,IAAaC,gBAAb,cAAkC,mBAAmB;EACjD;EACA;EACA;EACA,YAAY,OAAO,CAAE,GAAE,OAAO,CAAE,GAAE;AAC9B,UAAA;AACA,QAAI,SAAS,OACT,OAAM,IAAI,MAAM,0BAA0B;AAC9C,SAAK,UAAU;AACf,SAAK,OAAO;AACZ,SAAK,KAAK,KAAK,MAAM;EACxB;EACD,QAAQ;AACJ,UAAM,OAAO,CAAC,GAAG,KAAK,IAAK;AAC3B,SAAK,OAAO,CAAE;AACd,SAAK,UAAU,WAAW;MAAE,WAAW,KAAK;MAAM,SAAS;IAAM,CAAA;AACjE,SAAK,QAAA;EACR;;;;EAID,UAAU;EACT;EACD,GAAG,OAAO;AACN,QAAI,SAAS,KAAK,KAAK,OACnB,OAAM,IAAI,MAAM,+BAA+B;AACnD,UAAMC,KAAI,KAAK,KAAK,GAAG,KAAA;AACvB,QAAIA,OAAM,OACN,OAAM,IAAI,MAAM,4CAA4C;AAChE,WAAOA;EACV;EACD,WAAW,OAAO;AACd,SAAK,OAAON,SAAQ,KAAK,SAAS,KAAK,MAAM,GAAG,KAAA;AAChD,UAAMO,UAAS,KAAK,KAAK;AACzB,SAAK,UAAU,KAAK,MAAM,KAAA;AAC1B,WAAOA;EACV;EACD,UAAU,QAAQ,gBAAgB;AAC9B,SAAK,UAAU,WAAW;MAAE,OAAO;MAAgB,WAAW;IAAQ,CAAA;EACzE;EACD,UAAU;AACN,UAAMD,KAAIJ,MAAK,KAAK,SAAS,KAAK,IAAA;AAClC,QAAII,OAAM,OACN;AAEJ,SAAK,OAAOL,SAAQ,KAAK,SAAS,KAAK,IAAA;AACvC,SAAK,UAAU,WAAW;MAAE,SAASK;MAAG,WAAW,KAAK;IAAM,CAAA;AAC9D,SAAK,UAAU,CAACA,EAAE,GAAE,KAAK,IAAA;AACzB,WAAOA;EACV;EACD,UAAU,SAAS,WAAW;AAC1B,SAAK,UAAU,WAAW;MAAE;MAAS;IAAW,CAAA;EACnD;;;;;;EAMD,YAAY,WAAW;AACnB,UAAM,WAAW,KAAK,KAAK;AAC3B,UAAM,WAAW,KAAK,KAAK,OAAO,CAAAA,OAAK,UAAUA,EAAA,CAAE;AACnD,QAAI,SAAS,WAAW,EACpB,QAAO;AACX,SAAK,OAAO,KAAK,KAAK,OAAO,CAAC,YAAY,CAAC,UAAU,OAAA,CAAQ;AAC7D,SAAK,UAAU,UAAU,KAAK,IAAA;AAC9B,WAAO,WAAW,KAAK,KAAK;EAC/B;;;;;EAKD,UAAU;AACN,WAAO,CAAC,GAAG,KAAK,IAAK;EACxB;EACD,IAAI,UAAU;AACV,WAAOH,SAAQ,KAAK,SAAS,KAAK,IAAA;EACrC;EACD,IAAI,SAAS;AACT,WAAOC,QAAO,KAAK,SAAS,KAAK,IAAA;EACpC;EACD,IAAI,SAAS;AACT,WAAO,KAAK,KAAK;EACpB;EACD,IAAI,OAAO;AACP,WAAOF,MAAK,KAAK,SAAS,KAAK,IAAA;EAClC;AACJ;AAOD,SAAgBM,WAAQ,UAAU,CAAE,MAAK,eAAe;AACpD,SAAO,IAAIH,cAAa,EAAE,GAAG,QAAS,GAAE,CAAC,GAAG,aAAc,CAAA;AAC7D;AC3ID,IAAaI,aAAY,CAAC,MAAM,OAAO,UAAU;AAC7C,QAAM,kBAAkB,MAAM,SAAS,MAAM;AAC7C,QAAM,SAAS,KAAK,iBAAiB;AACrC,QAAM,WAAW,KAAK,YAAY;AAClC,QAAM,WAAW,kBAAkB;AACnC,MAAI,KAAK,MACL,SAAQ,IAAI,yBAAyB,MAAM,MAAA,kBAAwB,eAAA,cAA6B,QAAA,YAAoB,MAAA,EAAQ;AAEhI,UAAQ,QAAR;IACI,KAAK,aAAa;AACd,UAAI,KAAK,MACL,SAAQ,IAAI,0CAA0C,MAAM,MAAA,WAAiB,kBAAkB,QAAA,cAAsB,MAAM,MAAA,EAAQ;AAGvI,UAAI,MAAM,WAAW,KAAK,SACtB,QAAO;UAIP,QAAO,CAAC,GAAG,OAAO,GAAG,MAAM,MAAM,GAAG,MAAM,SAAS,QAAA,CAAU;IAEpE;IACD,KAAK;AACD,UAAI,YAAY,MAAM,OAElB,QAAO,MAAM,MAAM,KAAK,IAAI,GAAG,MAAM,SAAS,QAAA,GAAW,KAAK,IAAI,MAAM,QAAQ,QAAA,IAAY,CAAA;WAE3F;AAGD,YAAI,KAAK,MACL,SAAQ,IAAI,eAAe,KAAK,UAAU,MAAM,MAAM,GAAG,MAAM,SAAS,QAAA,CAAS,CAAC,EAAE;AAExF,eAAO,CACH,GAAG,MAAM,MAAM,GAAG,MAAM,SAAS,QAAA,GACjC,GAAG,MAAM,MAAM,GAAG,KAAK,IAAI,MAAM,QAAQ,WAAW,WAAW,CAAA,CAAE,CACpE;MACJ;IAEL,KAAK;AAED,aAAO,CAAC,GAAG,OAAO,GAAG,KAAM,EAAC,MAAM,QAAA;IAEtC;AAEI,YAAM,IAAI,MAAM,0BAA0B,MAAA,EAAQ;EAEzD;AACJ;AAED,IAAaC,QAAO,CAAC,MAAM,UAAU,UAAU;AAG3C,QAAM,kBAAkB,MAAM,SAAS,MAAM;AAC7C,QAAM,WAAW,KAAK,YAAY,kBAAkB,KAAK;AACzD,QAAM,WAAW,WACXD,WAAU,MAAM,OAAO,KAAA,IACvB,CAAC,GAAG,OAAO,GAAG,KAAM;AAC1B,SAAO;AACV;AAED,IAAaE,OAAM,CAAC,MAAM,UAAU;AAChC,MAAI,MAAM,WAAW,EACjB,OAAM,IAAI,MAAM,gBAAgB;AACpC,SAAO,MAAM,MAAM,GAAG,EAAA;AACzB;AASD,IAAaT,UAAO,CAAC,MAAM,UAAU,MAAM,GAAG,EAAA;AAC9C,IAAaC,aAAU,CAAC,MAAM,UAAU,MAAM,WAAW;AACzD,IAAaC,YAAS,CAAC,MAAM,UAAU;AACnC,MAAI,KAAK,SACL,QAAO,MAAM,UAAU,KAAK;AAEhC,SAAO;AACV;ACzDD,IAAaQ,gBAAb,MAA0B;EACtB;EACA;EACA,YAAY,OAAO,CAAE,GAAE,OAAO,CAAE,GAAE;AAC9B,SAAK,OAAO;AACZ,SAAK,OAAO;EACf;;;;;;;EAOD,QAAQ,OAAO;AACX,QAAI,MAAM,WAAW,EACjB,QAAO,KAAK,KAAK;AACrB,SAAK,OAAOF,MAAK,KAAK,MAAM,KAAK,MAAM,GAAG,KAAA;AAC1C,WAAO,KAAK,KAAK;EACpB;EACD,QAAQG,KAAI;AACR,SAAK,KAAK,QAAQA,GAAA;EACrB;EACD,eAAeA,KAAI;AACf,KAAC,GAAG,KAAK,IAAK,EAAC,QAAA,EAAU,QAAQA,GAAA;EACpC;EACD,MAAM;AACF,UAAMP,KAAIJ,QAAK,KAAK,MAAM,KAAK,IAAA;AAC/B,SAAK,OAAOS,KAAI,KAAK,MAAM,KAAK,IAAA;AAChC,WAAOL;EACV;EACD,IAAI,UAAU;AACV,WAAOH,WAAQ,KAAK,MAAM,KAAK,IAAA;EAClC;EACD,IAAI,SAAS;AACT,WAAOC,UAAO,KAAK,MAAM,KAAK,IAAA;EACjC;EACD,IAAI,OAAO;AACP,WAAOF,QAAK,KAAK,MAAM,KAAK,IAAA;EAC/B;EACD,IAAI,SAAS;AACT,WAAO,KAAK,KAAK;EACpB;AACJ;AAqBD,IAAaM,aAAU,CAAC,OAAO,CAAE,MAAK,kBAAkB,IAAII,cAAa,EAAE,GAAG,KAAM,GAAE,CAAC,GAAG,aAAc,CAAA;ACrFxG,IAAaE,WAAU,CAACC,IAAGC,IAAG,KAAK,yBAAyB,WAAW;AACnE,QAAM,aAAaC,sBAAqBF,IAAGC,IAAG,EAAA;AAI9C,QAAM,kBAAkBE,iBAAgBH,IAAGC,IAAG,EAAA;AAC9C,QAAM,OAAO;IACT,cAAc,CAAC;IAAY,GAAAD;IAAG,GAAAC;IAC9B,OAAO,gBAAgB;IACvB,SAAS,gBAAgB;IACzB,cAAc;EACjB;AACD,QAAM,WAAW;IACb,OAAO;IACP,eAAe,CAAE;IACjB;EACH;AACD,QAAM,eAAe,gBAAgB,UAAU,IAAI,CAAAG,OAAKL,SAAQK,GAAE,CAAA,GAAIA,GAAE,CAAA,GAAI,IAAI,QAAA,CAAS;AAEzF,QAAM,kBAAkBC,WAAU,IAAA,KAAS,aAAa,KAAK,CAAAd,OAAKc,WAAUd,GAAE,KAAA,CAAM;eAC5D,UAAU,YAAA;AAElC,WAAS,WAAW,MAAMe,YAAS,UAAU,CAAA;AAE7C,WAAS,MAAM,eAAe;iBACJ,QAAA;AAC1B,SAAO;AACV;AACD,IAAMD,aAAY,CAAC,OAAO;AACtB,MAAI,OAAO,OACP,QAAO;AACX,MAAI,GAAG,aACH,QAAO;AACX,MAAI,GAAG,aACH,QAAO;AACX,MAAI,GAAG,MAAM,SAAS,EAClB,QAAO;AACX,MAAI,GAAG,QAAQ,SAAS,EACpB,QAAO;AACX,SAAO;AACV;AACD,IAAMF,mBAAkB,CAACH,IAAGC,IAAG,KAAK,4BAA4B;AAC5D,QAAM,cAAc,CAAC,GAAGD,GAAE,SAAA,CAAW;AACrC,QAAM,cAAc,CAAC,GAAGC,GAAE,SAAA,CAAW;AACrC,QAAM,YAAY,CAAE;AACpB,QAAM,UAAU,CAAE;AAClB,aAAW,UAAU,aAAa;AAC9B,QAAI,aAAa;AACjB,eAAW,CAAC,OAAO,QAAA,KAAa,YAAY,QAAA,GAAW;AACnD,YAAMM,KAAIL,sBAAqB,QAAQ,UAAU,EAAA;AACjD,UAAIK,IAAG;AACH,kBAAU,KAAK,CAAC,QAAQ,QAAS,CAAA;AACjC,qBAAa;AACb;MACH;IACJ;AACD,QAAI,eAAe,GAEf,SAAQ,KAAK,MAAA;QAIb,aAAY,OAAO,YAAY,CAAA;EAEtC;AACD,QAAM,QAAQ,CAAC,GAAG,WAAY;AAC9B,SAAO;IAAE;IAAO;IAAW;EAAS;AACvC;AACD,IAAML,wBAAuB,CAACF,IAAGC,IAAG,OAAO;AACvC,MAAID,GAAE,YAAA,MAAkBC,GAAE,YAAA,EACtB,QAAO;AACX,MAAI,GAAGD,GAAE,SAAA,GAAYC,GAAE,SAAA,CAAU,EAC7B,QAAO;AACX,SAAO;AACV;AACD,IAAMO,kBAAiB,CAACC,OAAM;AAC1B,SAAO,KAAK,UAAUA,GAAE,SAAA,CAAU;AACrC;AACD,IAAMH,cAAW,CAACG,IAAG,SAAS,MAAM;AAChC,MAAIA,OAAM,OACN,QAAO;AACX,MAAIzB,KAAI0B,cAAaD,GAAE,OAAO,MAAA;AAC9B,aAAWL,MAAKK,GAAE,cACd,CAAAzB,MAAKsB,YAASF,IAAG,SAAS,CAAA;AAE9B,SAAOpB;AACV;AACD,IAAM0B,gBAAe,CAACD,IAAG,WAAW;AAChC,QAAM,SAAS,IAAI,OAAO,MAAA;AAC1B,MAAIA,OAAM,OACN,QAAO,GAAG,MAAA;AACd,QAAMzB,KAAI,CAAE;AACZ,EAAAA,GAAE,KAAK,MAAMwB,gBAAeC,GAAE,CAAA,CAAE,OAAOD,gBAAeC,GAAE,CAAA,CAAE,EAAE;AAC5D,MAAIA,GAAE,aACF,CAAAzB,GAAE,KAAK,iCAAiCyB,GAAE,YAAA,EAAc;MAExD,CAAAzB,GAAE,KAAK,mCAAmCyB,GAAE,YAAA,EAAc;AAC9D,MAAIA,GAAE,MAAM,SAAS,GAAG;AACpB,IAAAzB,GAAE,KAAK,QAAQ;AACf,eAAWoB,MAAKK,GAAE,MACd,CAAAzB,GAAE,KAAK,QAAQwB,gBAAeJ,EAAA,CAAE;EAEvC;AACD,MAAIK,GAAE,QAAQ,SAAS,GAAG;AACtB,IAAAzB,GAAE,KAAK,YAAYyB,GAAE,QAAQ,MAAA,EAAQ;AACrC,eAAWL,MAAKK,GAAE,QACd,CAAAzB,GAAE,KAAK,QAAQwB,gBAAeJ,EAAA,CAAE;EAEvC;AACD,EAAApB,GAAE,KAAK;CAAQ;AACf,SAAOA,GAAE,IAAI,CAAA2B,UAAQ,SAASA,KAAA,EAAM,KAAK;CAAI;AAChD;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AChGD,IAAaZ,aAAU,CAACC,IAAGC,IAAG,OAAO;AACjC,SAAOW,SAAYC,wBAAqBb,EAAA,GAAIa,wBAAqBZ,EAAA,GAAI,EAAA;AACxE;AAUD,IAAaa,kBAAiB,CAAC,SAAS;AACpC,QAAML,KAAI;IACN,OAAO,KAAK;IACZ,eAAe,KAAK,cAAc,IAAI,CAAAL,OAAKU,gBAAeV,EAAA,CAAE;EAC/D;AACD,SAAOK;AACV;AACD,IAAMM,aAAY,CAAC,SAAU,WAAW,OAAQ,KAAK,QAAQ;AAC7D,IAAMC,WAAU,CAAC,SAAU,WAAW,OAAQ,OAAOC,MAAK,IAAA;AAQ1D,IAAaA,QAAO,CAACR,OAAM;AACvB,SAAO;IACH,CAAC,WAAW;AACR,iBAAWL,MAAKK,GAAE,cACd,OAAMQ,MAAKb,EAAA;IAElB;IACD,UAAU,MAAMK,GAAE;IAClB,aAAa,MAAMA;IACnB,CAAC,WAAW7B,SAAO;AACf,iBAAWW,MAAK2B,cAAatC,SAAOmC,WAAUN,EAAA,CAAE,EAC5C,OAAMQ,MAAK1B,EAAA;IAElB;IACD,CAAC,kBAAkB,OAAOX,SAAO,IAAI;AACjC,iBAAWW,MAAK4B,mBAAkBJ,WAAU,KAAA,GAAQnC,SAAO,EAAA,EACvD,OAAMqC,MAAK1B,EAAA;IAElB;IACD,CAAC,cAAc,OAAO;AAClB,aAAO6B,eAAcL,WAAU,KAAA,CAAM;IACxC;IACD,iBAAiB,OAAOnC,SAAO,IAAI;AAC/B,YAAM6B,MAAIY,kBAAiB,OAAOzC,SAAO,EAAA;AACzC,UAAI6B,QAAM,OACN,QAAOQ,MAAKR,GAAAA;IACnB;IACD,WAAW,MAAMA,GAAE,WAAW,SAAY,SAAYQ,MAAKR,GAAE,MAAA;IAC7D,WAAW,CAAC,WAAW;AACnB,aAAOa,aAAUb,IAAGM,WAAU,MAAA,CAAO;IACxC;IACD,cAAc,CAAC,WAAW;AACtB,aAAOQ,gBAAad,IAAGM,WAAU,MAAA,CAAO;IAC3C;IACD,UAAU,CAAC,UAAU;AACjB,aAAOS,YAAST,WAAU,KAAA,GAAQN,EAAA;IACrC;IACD,aAAa,CAAC,UAAU;AACpB,aAAOgB,eAAYV,WAAU,KAAA,GAAQN,EAAA;IACxC;IACD,QAAQ,MAAM;AACV,MAAAiB,QAAOjB,EAAA;IACV;IACD,UAAU,CAAC7B,YAAU;AACjB,YAAM,YAAY+C,YAAS/C,SAAO6B,EAAA;AAClC,aAAOQ,MAAK,SAAA;IACf;IACD,KAAK,CAAC,UAAU;AACZW,MAAAA,OAAIb,WAAU,KAAA,GAAQN,EAAA;AACtB,aAAOO,SAAQ,KAAA;IAClB;IACD,OAAOP;EACV;AACJ;AAOD,IAAaiB,UAAS,CAAC,UAAU;AAC7B,QAAMG,KAAI,MAAM;AAChB,MAAIA,OAAM,OACN;AACJ,QAAM,SAAS;AACf,EAAAA,GAAE,gBAAgB,QAAQA,GAAE,eAAe,KAAA;AAC9C;AAMD,UAAiBC,cAAW,MAAM;AAC9B,MAAI,CAACC,MACD;AACJ,QAAM,QAAQ,IAAIlC,cAAA;AAClB,QAAM,KAAK,GAAG,KAAK,aAAA;AACnB,MAAI,QAAQ,MAAM,IAAA;AAClB,SAAO,OAAO;AACV,UAAM;AACN,QAAI,MACA,OAAM,KAAK,GAAG,MAAM,aAAA;AAExB,QAAI,MAAM,QACN;AACJ,YAAQ,MAAM,IAAA;EACjB;AACJ;AAMD,UAAiBmC,gBAAa,MAAM;AAChC,MAAI,CAAC,KACD;AACJ,QAAM,QAAQ,IAAI1C,cAAA;AAClB,QAAM,QAAQ,GAAG,KAAK,aAAA;AACtB,MAAI,QAAQ,MAAM,QAAA;AAClB,SAAO,OAAO;AACV,UAAM;AACN,QAAI,MACA,OAAM,QAAQ,GAAG,MAAM,aAAA;AAE3B,QAAI,MAAM,QACN;AACJ,YAAQ,MAAM,QAAA;EACjB;AACJ;AAOD,SAAgB2C,UAASF,QAAM,OAAO,CAAE,GAAE;AACtC,MAAIA,OAAK,WAAWA,OAChB,QAAO;IAAC;IAAO;IAA6BA;EAAK;AACrD,MAAI,KAAK,SAASA,MAAAA,EACd,QAAO;IAAC;IAAO;IAAmDA;EAAK;AAC3E,OAAK,KAAKA,MAAAA;AACV,MAAI,2BAA2BA,OAAK,aAAA,EAChC,QAAO;IAAC;IAAO;IAAqCA;EAAK;AAC7D,aAAW3B,MAAK2B,OAAK,eAAe;AAChC,QAAI3B,GAAE,WAAW2B,OACb,QAAO;MAAC;MAAO;MAAqD3B;IAAE;AAC1E,QAAIqB,eAAYM,QAAM3B,EAAA,EAClB,QAAO;MAAC;MAAO;MAAqCA;IAAE;AAC1D,UAAMb,KAAI0C,UAAS7B,IAAG,IAAA;AACtB,QAAI,CAACb,GAAE,CAAA,EACH,QAAOA;EACd;AACD,SAAO;IAAC;IAAM;IAAIwC;EAAK;AAC1B;AAMD,SAAgBG,eAAcH,QAAM;AAChC,QAAMxC,KAAI0C,UAASF,MAAAA;AACnB,MAAIxC,GAAE,CAAA,EACF;AACJ,QAAM,IAAI,MAAM,GAAGA,GAAE,CAAA,CAAA,UAAY,mBAAmBA,GAAE,CAAA,EAAG,OAAO,EAAA,CAAG,IAAI,EAAE,OAAOA,GAAE,CAAA,EAAI,CAAA;AACzF;AAMD,UAAiB4C,YAASJ,QAAM;AAC5B,aAAW3B,MAAK2B,OAAK,cACjB,OAAM3B;AAEb;AAMD,UAAiBgC,gBAAeL,QAAM;AAClC,aAAW3B,MAAK2B,OAAK,cACjB,KAAI,OAAO3B,GAAE,UAAU,YACnB,OAAMA,GAAE;AAEnB;AAKD,UAAiBiC,WAAQN,QAAM;AAC3B,MAAIF,KAAIE,OAAK;AACb,SAAOF,IAAG;AACN,UAAMA;AACN,IAAAA,KAAIA,GAAE;EACT;AACJ;AAMD,SAAgBS,WAAU,MAAM;AAC5B,QAAMT,KAAI,CAAC,GAAGQ,WAAQ,IAAA,CAAM;AAC5B,SAAOR,GAAE;AACZ;AACD,IAAaL,cAAW,CAAC,OAAO,WAAW;AACvC,aAAWpB,MAAK,OAAO,cACnB,KAAIA,OAAM,MACN,QAAO;AAEf,SAAO;AACV;AAUD,IAAamC,sBAAmB,CAAC3D,SAAO,QAAQ,KAAK,mBAAmB;AACpE,aAAWwB,MAAK,OAAO,cACnB,KAAI,GAAGxB,SAAOwB,GAAE,KAAA,EACZ,QAAOA;AAElB;AASD,UAAiBc,cAAatC,SAAO,QAAQ,KAAK,gBAAgB;AAC9D,aAAWwB,MAAK,OAAO,cACnB,KAAI,GAAGxB,SAAOwB,GAAE,KAAA,EACZ,OAAMA;AAEjB;AAUD,IAAaqB,iBAAc,CAAC,kBAAkB,WAAW;AACrD,aAAWrB,MAAK4B,gBAAa,MAAA,EACzB,KAAI5B,OAAM,iBACN,QAAO;AAEf,SAAO;AACV;AACD,IAAaoC,yBAAsB,CAAC5D,SAAO,QAAQ,KAAK,mBAAmB;AACvE,aAAWwB,MAAK4B,gBAAa,MAAA,EACzB,KAAI,GAAG5B,GAAE,OAAOxB,OAAAA,EACZ,QAAOwB;AAElB;AACD,IAAaqC,WAAU,CAAC,SAAS;AAC7B,MAAI,KAAK,OACL,QAAOA,SAAQ,KAAK,MAAA;AACxB,SAAO;AACV;AAUD,IAAalB,kBAAe,CAAC,OAAO,sBAAsB;AACtD,aAAWM,MAAKQ,WAAQ,KAAA,EACpB,KAAIR,OAAM,kBACN,QAAO;AAEf,SAAO;AACV;AASD,UAAiBT,eAAc,OAAO;AAClC,aAAWS,MAAKQ,WAAQ,KAAA,EACpB,KAAI,OAAOR,GAAE,UAAU,YACnB,OAAMA,GAAE;AAGhB,SAAO;AACV;AASD,UAAiBV,mBAAkB,OAAOvC,SAAO,KAAK,gBAAgB;AAClE,aAAWiD,MAAKQ,WAAQ,KAAA,EACpB,KAAI,OAAOR,GAAE,UAAU,aACnB;QAAI,GAAGA,GAAE,OAAOjD,OAAAA,EACZ,OAAMiD;EAAE;AAGpB,SAAO;AACV;AAQD,SAAgBR,kBAAiB,OAAOzC,SAAO,KAAK,gBAAgB;AAChE,aAAWiD,MAAKV,mBAAkB,OAAOvC,SAAO,EAAA,EAC5C,QAAOiD;AAEd;AAUD,IAAaP,eAAY,CAAC,OAAO,sBAAsB;AACnD,SAAO,MAAM,WAAW;AAC3B;AAYD,IAAaoB,mBAAkB,CAAC,SAAS;AACrC,SAAOC,qBAAoB,MAAM,CAAA;AACpC;AACD,IAAMA,uBAAsB,CAAC,MAAM,gBAAgB,MAAM;AACrD,MAAI,QAAQ;AACZ,aAAWvC,MAAK,KAAK,cACjB,SAAQ,KAAK,IAAI,OAAOuC,qBAAoBvC,IAAG,gBAAgB,CAAA,CAAE;AAErE,SAAO;AACV;AACD,IAAawB,SAAM,CAAC,OAAO,WAAW;AAClC,EAAAgB,qBAAoB,OAAO,MAAA;AAG3B,QAAMf,KAAI,MAAM;AAChB,SAAO,gBAAgB,CAAC,GAAG,OAAO,eAAe,KAAM;AACvD,QAAM,SAAS;AACf,MAAIA,GACA,CAAAA,GAAE,gBAAgB,QAAQA,GAAE,eAAe,KAAA;AAElD;AACD,IAAaF,cAAW,CAAC/C,SAAO,WAAW;AACvC,SAAOiE,YAAWjE,SAAO,MAAA;AAC5B;AAOD,IAAamD,QAAO,CAACnD,YAAU;AAC3B,SAAOiE,YAAWjE,OAAAA;AACrB;AACD,IAAakE,mBAAkB,CAAClE,SAAO,QAAQ,IAAI,QAAQ,OAAO,CAAE,MAAK;AACrE,QAAMmE,YAAU,OAAO,QAAQnE,OAAAA;AAC/B,WAAS,WAAW,SAAYmD,MAAA,IAASJ,YAAS;IAAE;IAAO,OAAA;EAAO,GAAE,MAAA;AACpE,aAAW,SAASoB,WAAS;AACzB,UAAMnE,UAAQ,MAAM,CAAA;AAEpB,QAAI,KAAK,SAASA,OAAAA,EACd;AACJ,SAAK,KAAKA,OAAAA;AACV,QAAI,OAAO,MAAM,CAAA,MAAO,SACpB,CAAAkE,iBAAgBlE,SAAO,MAAM,CAAA,GAAI,QAAQ,IAAA;QAGzC+C,CAAAA,YAAS;MAAE,OAAO,MAAM,CAAA;MAAI,OAAO/C;IAAO,GAAE,MAAA;EAEnD;AACD,SAAO;AACV;AAOD,IAAaoE,eAAc,CAACpE,YAAU;AAClC,SAAOqC,MAAK4B,YAAWjE,OAAAA,CAAM;AAChC;AAQD,IAAaiE,cAAa,CAACjE,SAAO,WAAW;AACzC,QAAM6B,KAAI;IACN,eAAe,CAAE;IACT;IACR,OAAO7B;EACV;AACD,MAAI,WAAW,OACX,QAAO,gBAAgB,CAAC,GAAG,OAAO,eAAe6B,EAAE;AAEvD,SAAOA;AACV;AACD,IAAawC,oBAAiB,CAAC,SAAS;AACpC,SAAO,KAAK,cAAc;AAC7B;AACD,IAAarE,SAAQ,CAAC,SAAS;AAC3B,SAAO,KAAK;AACf;AAQD,IAAaiC,0BAAuB,CAAC,SAAS;AAC1C,QAAM7B,KAAI;IACN,CAAC,WAAW;AACR,iBAAWoB,MAAK,KAAK,cACjB,OAAMS,wBAAqBT,EAAA;IAElC;IACD,YAAY;AACR,UAAI,KAAK,WAAW,OAChB;AACJ,aAAOS,wBAAqB,KAAK,MAAA;IACpC;IACD,WAAW;AACP,aAAO,KAAK;IACf;IACD,cAAc;AACV,aAAO;IACV;EACJ;AACD,SAAO7B;AACV;AACD,IAAM4D,uBAAsB,CAACxC,IAAG,WAAW;AACvC,MAAI,WAAWA,GACX,OAAM,IAAI,MAAM,0BAA0B;AAC9C,MAAIA,GAAE,WAAW,OACb;AACJ,MAAImB,gBAAa,QAAQnB,EAAA,EACrB,OAAM,IAAI,MAAM,6BAA6B,EAAE,OAAOA,GAAG,CAAA;AAC7D,MAAImB,gBAAanB,IAAG,MAAA,EAChB,OAAM,IAAI,MAAM,iCAAiC,EAAE,OAAOA,GAAG,CAAA;AACjE,MAAIqB,eAAY,QAAQrB,EAAA,EACpB,OAAM,IAAI,MAAM,6BAA6B,EAAE,OAAOA,GAAG,CAAA;AAChE;AACD,IAAa8C,eAAc,CAAC,QAAQf,eAAa;AAE7C,aAAW/B,MAAK+B,WACZ,CAAAS,qBAAoBxC,IAAG,MAAA;AAE3B,SAAO,gBAAgB,CAAC,GAAG+B,UAAS;AACpC,aAAW/B,MAAK+B,WACZ,CAAA/B,GAAE,SAAS;AAElB;AACD,IAAa+C,kBAAe,CAAC,MAAM,SAAS,MAAM;AAC9C,QAAMnE,KAAI,GAAG,KAAK,OAAO,MAAA,CAAO,MAAM,KAAK,QAAQ,KAAK,UAAU,KAAK,KAAA,IAAS,GAAG;AACnF,SAAO,KAAK,cAAc,SAAS,IAAKA,KACpC;IACA,KAAK,cAAc,IAAI,CAACuB,OAAM4C,gBAAa5C,IAAG,SAAS,CAAA,CAAE,EAAE,KAAK;CAAI,IAAKvB;AAChF;AACD,UAAiBoE,eAAYrB,QAAM,mBAAmB,QAAQ,GAAG;AAC7D,aAAW3B,MAAK2B,OAAK,eAAe;AAChC,UAAMnD,UAAQwB,GAAE;AAChB,QAAIxB,YAAU,OACV;AACJ,QAAI,kBAAkBA,SAAO,KAAA,GAAQ;AACjC,YAAMwB,GAAE;AACR,aAAOgD,eAAYhD,IAAG,mBAAmB,QAAQ,CAAA;IACpD;EACJ;AACJ;;;;;;;;;;;;;;;ACtgBD,SAAgBiD,oBAAmBN,WAAS;AACxC,MAAIA,UAAQ,WAAW,EACnB,QAAO;AACX,MAAI/D,KAAI;AACR,aAAW,CAAC,OAAO,KAAA,KAAU+D,UAAQ,QAAA,GAAW;AAC5C,IAAA/D,MAAK,KAAK,OAAO,KAAA;AACjB,IAAAA,MAAK,MAAM,OAAO,QAAQ,KAAK,UAAU,MAAM,SAAA,IAAa;;EAC/D;AACD,SAAOA;AACV;AAWD,IAAasE,eAAc,CAAC,MAAM,SAAS,GAAG,UAAU,CAAE,MAAK;AAC3D,cAAY,cAAc,MAAM,MAAM,CAAC;AACvC,QAAM,cAAc,QAAQ,QAAQ;AACpC,QAAM,QAAQC,eAAc,MAAM,WAAA;AAClC,QAAMvE,KAAI,GAAG,KAAK,OAAO,MAAA,CAAO,YAAY,MAAM,IAAA,WAAe,KAAK,UAAU,MAAM,SAAA,CAAU;AAChG,QAAM,kBAAkB,CAAC,GAAGmD,UAAS,MAAM,OAAA,CAAS;AACpD,SAAO,gBAAgB,SAAS,IAAKnD,KACjC;IACA,gBAAgB,IAAI,CAACuB,OAAM+C,aAAY/C,GAAE,WAAW,SAAS,GAAG;IAAE,GAAG;IAAS,MAAMA,GAAE;EAAM,CAAA,CAAC,EAAE,KAAK;CAAI,IAAKvB;AACpH;AAOD,IAAamE,kBAAe,CAAC,MAAM,SAAS,MAAM;AAC9C,MAAInE,KAAI,IAAI,OAAO,MAAA,IAAU,IAAI,KAAK,OAAO,IAAA;AAC7C,MAAI,KAAK,UAAU,QAAW;AAC1B,QAAI,iBAAiB,KAAK,SAAS,eAAe,KAAK,OAAO;AAC1D,UAAI,cAAc,mBAAmB,KAAK,MAAM,aAAa,EAAA;AAC7D,YAAM,YAAY,mBAAmB,KAAK,MAAM,WAAW,EAAA;AAC3D,oBAAc,gBAAgB,YAAY,KAAK,aAAa;AAC5D,MAAAA,MAAK,MAAM,SAAA,IAAa,WAAA;IAC3B,WACQ,iBAAiB,KAAK,SAAS,KAAK,MAAM,gBAAgB,OAC/D,CAAAA,MAAK,MAAM,KAAK,MAAM,WAAA;AAC1B,QAAI,eAAe,KAAK,MACpB,CAAAA,MAAK,gBAAiB,KAAK,MAAM,UAAW,KAAK,IAAI,CAAC;EAE7D;AACD,EAAAA,MAAK;;AACL,aAAWoB,MAAK,KAAK,cACjB,CAAApB,MAAKmE,gBAAa/C,IAAG,SAAS,CAAA;AAElC,SAAOpB;AACV;AAyDD,UAAiBmD,UAAS,MAAM,UAAU,CAAE,GAAE;AAC1C,cAAY,cAAc,MAAM,MAAM,CAAC;AACvC,QAAM,kBAAkB,QAAQ,UAAU;AAC1C,QAAM,gBAAgB,CAAC5C,OAAM;AACzB,QAAI,oBAAoB,OACpB,QAAO,CAAC,MAAM,YAAYA,EAAA,CAAG;aACxB,oBAAoB,YAAY,YAAYA,EAAA,EACjD,QAAO,CAAC,MAAM,IAAK;aACd,oBAAoB,cAAc,CAAC,YAAYA,EAAA,EACpD,QAAO,CAAC,MAAM,KAAM;AACxB,WAAO,CAAC,OAAO,YAAYA,EAAA,CAAG;EACjC;AACD,MAAI,MAAM,QAAQ,IAAA,EAEd,YAAW,CAAC,OAAO,OAAA,KAAY,KAAK,QAAA,GAAW;AAC3C,UAAMiE,KAAI,cAAc,OAAA;AACxB,QAAIA,GAAE,CAAA,EACF,OAAM;MAAE,MAAM,MAAM,SAAA;MAAY,OAAO;MAAS,aAAa;MAAS,WAAWA,GAAE,CAAA,IAAK,UAAU;IAAW;EAGpH;WAEI,OAAO,SAAS,UAAU;AAC/B,UAAM,cAAe,aAAa,OAAQ,KAAK,QAAA,IAAY,OAAO,QAAQ,IAAA;AAC1E,eAAW,CAAC,MAAM5E,OAAAA,KAAU,aAAa;AAErC,YAAM,CAAC6E,SAAQC,aAAAA,IAAe,cAAc9E,OAAAA;AAC5C,UAAI6E,QACA,OAAM;QAAQ;QAAM,OAAO;QAAS,aAAa7E;QAAO,WAAW8E,gBAAc9E,UAAQ;MAAW;IAE3G;EACJ;AACJ;AACD,UAAiBkD,cAAW,MAAM,UAAU,CAAE,GAAE,YAAY,CAAE,GAAE;AAC5D,aAAW1B,MAAK+B,UAAS,MAAM,OAAA,GAAU;AAErC,UAAM;MAAE,GAAG/B;MAAG,WAAW,CAAC,GAAG,SAAU;MAAE,OAAO;IAAmB;AACnE,WAAO0B,cAAW1B,GAAE,aAAa,SAAS,CAAC,GAAG,WAAWA,GAAE,IAAK,CAAA;EACnE;AACJ;AAOD,SAASuD,aAAY,MAAM,MAAM;AAC7B,aAAWpD,MAAK4B,UAAS,IAAA,EACrB,KAAI5B,GAAE,SAAS,KACX,QAAOA;AAElB;AA2BD,SAAgBqD,WAAUC,OAAM,MAAM,UAAU,CAAE,GAAE;AAEhD,QAAMtE,KAAI,OAAKuE,aAAYD,OAAM,MAAM,OAAA,CAAQ;AAC/C,MAAI,CAACtE,GACD,OAAM,IAAI,MAAM,yBAAyBsE,KAAA,GAAO;AACpD,SAAOtE;AACV;AAiCD,UAAiBuE,aAAYD,OAAM,MAAM,UAAU,CAAE,GAAE;AACnD,cAAY,cAAcA,OAAM,MAAM,GAAG,cAAc,MAAM,MAAM,CAAC;AACpE,QAAM,YAAY,QAAQ,aAAa;AAEvC,QAAM,YAAYA,MAAK,MAAM,SAAA;AAC7B,QAAM,YAAY,CAAE;AACpB,aAAWhC,MAAK,WAAW;AACvB,UAAM,QAAQ8B,aAAY9B,IAAG,IAAA;AAgB7B,QAAI,CAAC,OAAO;AACR,YAAM;QAAE,MAAMA;QAAG,aAAa;QAAW,WAAW;QAAW;QAAW,OAAO;MAAmB;AACpG;IACH;AACD,WAAO,MAAM;AACb,UAAM;MAAE,GAAG;MAAO,WAAW,CAAC,GAAG,SAAU;MAAE,OAAO;IAAmB;AACvE,cAAU,KAAKA,EAAA;EAClB;AACJ;AAmDD,IAAahB,wBAAuB,CAAC,MAAM,UAAU,CAAE,GAAE,YAAY,CAAE,GAAE,WAAW;AAChF,QAAM,OAAO,QAAQ,QAAQ;AAC7B,QAAM7B,KAAI;IACN,CAAC,WAAW;AACR,iBAAW,EAAE,MAAM,WAAW,aAAa,UAAA,KAAemD,UAAS,MAAM,OAAA,EACrE,OAAMtB,sBAAqB,aAAa;QAAE,GAAG;QAAS,MAAM;MAAW,GAAE,CAAC,GAAG,WAAW,IAAK,GAAE7B,EAAA;IAEtG;IACD,YAAY;AACR,aAAO;IACV;IACD,WAAW;AACP,aAAO;QAAE;QAAM,aAAa;QAAM;QAAW,OAAO;MAAgB;IACvE;IACD,cAAc;AACV,aAAO;IACV;EACJ;AACD,SAAOA;AACV;AAOD,IAAa+E,iBAAgB,CAAC,MAAM,YAAY;AAC5C,SAAA9C,MAA4B+C,SAAO,MAAM,OAAA,CAAQ;AACpD;AAuBD,IAAaA,WAAS,CAAC,MAAM,UAAU,CAAE,MAAK;AAC1C,QAAM,iBAAiB,QAAQ,kBAAkB;AACjD,QAAM,WAAW,iBAAiB,CAACzE,OAAM;AAAE,QAAI,YAAYA,EAAA,EACvD,QAAOA;EAAI,IAAG,CAACA,OAAMA;AACzB,SAAO0E,YAAW,MAAM,SAAS,IAAA,GAAO,SAAS,CAAE,CAAA;AACtD;AACD,IAAMA,cAAa,CAAC,aAAa,WAAW,UAAU,CAAE,GAAE,cAAc;AACpE,QAAM,cAAc,QAAQ,QAAQ;AAEpC,QAAMC,KAAAnC,MAAyB;IAAE,MAAM;IAAa,aAAa;IAAW,WAAW,CAAC,GAAG,SAAU;IAAE,OAAO;EAAgB,CAAA;AAC9H,cAAY,CAAC,GAAG,WAAW,WAAY;AACvC,aAAW3B,MAAK+B,UAAS,aAAa,OAAA,GAAU;AAC5C,UAAM5C,KAAI,QAAQ,iBAAiBa,GAAE,YAAYA,GAAE;WAC/B6D,YAAW7D,GAAE,aAAab,IAAG;MAAE,GAAG;MAAS,MAAMa,GAAE;IAAM,GAAE,SAAA,GAAY8D,EAAA;EAC9F;AACD,SAAOA;AACV;AAOD,IAAaC,oBAAmB,CAAC,MAAM,UAAU,CAAE,MAAK;AACpD,SAAArD,gBAAsCkD,SAAO,MAAM,OAAA,CAAQ;AAC9D;AAQD,SAAST,eAAc,MAAM,cAAc,IAAI;AAC3C,MAAI,UAAU,QAAQ,eAAe,QAAQ,iBAAiB,KAC1D,QAAO;IACH,MAAM,KAAK;IACX,OAAO;IACP,WAAW,KAAK;IAChB,aAAa,KAAK;EACrB;AACL,MAAI,UAAU,KACV,QAAO;IAAE,MAAM,KAAK;IAAM,WAAW;IAAM,aAAa;IAAM,OAAO;EAAS;AAElF,SAAO;IAAE,MAAM;IAAa,WAAW;IAAM,aAAa;IAAM,OAAO;EAAS;AACnF;;;;;;;;;;;AClYD,IAAaS,YAAS,CAAC,WAAW,CAAE,MAAK;AACrC,MAAIjC;AACJ,QAAMH,QAAM,CAAChD,SAAOiF,UAAS;AACzB,UAAMpD,KAAI2D,gBAAexF,SAAOiF,OAAM9B,QAAM,QAAA;AAC5C,QAAIA,WAAS,OACTA,UAAAA,SAA+BtB,EAAA;EAEtC;AACD,QAAM6C,gBAAc,MAAM;AACtB,QAAIvB,WAAS,OACT,QAAO;AACX,WAAAsC,gBAAoCtC,MAAAA;EACvC;AACD,QAAM,WAAW,CAAC8B,UAAS;AACvB,QAAI9B,WAAS,OACT;AACJ,WAAOuC,aAAYT,OAAM9B,QAAM,QAAA;EAClC;AACD,QAAML,WAAS,CAACmC,UAAS;AACrB,QAAI9B,WAAS,OACT,QAAO;AACX,WAAOwC,cAAaV,OAAM9B,QAAM,QAAA;EACnC;AACD,QAAM,UAAU,CAAC8B,UAAS;AACtB,QAAI9B,WAAS,OACT,QAAO;AACX,UAAM3B,KAAIoE,iBAAgBX,OAAM9B,QAAM,QAAA;AACtC,WAAO3B,OAAM;EAChB;AACD,QAAM,UAAU,CAACyD,UAAS;AACtB,QAAI9B,WAAS,OACT;AACJ,UAAM3B,KAAIoE,iBAAgBX,OAAM9B,QAAM,QAAA;AACtC,WAAO3B;EACV;AACD,QAAM6C,mBAAiB,CAACY,UAAS;AAC7B,QAAI9B,WAAS,OACT,QAAO;AACX,UAAM3B,KAAIoE,iBAAgBX,OAAM9B,QAAM,QAAA;AACtC,QAAI3B,OAAM,OACN,QAAO;AACX,WAAOA,GAAE,cAAc;EAC1B;AACD,QAAM,YAAY,CAACyD,UAAS;AACxB,QAAI9B,WAAS,OACT,QAAO,CAAE;AACb,WAAO0C,cAAaZ,OAAM9B,QAAM,QAAA;EACnC;AACD,QAAMU,YAAU,MAAM;AAClB,WAAOV;EACV;AACD,QAAM,cAAc,CAAC8B,UAAS;AAC1B,QAAI9B,WAAS,OACT,QAAO;AACX,WAAO2C,mBAAkBb,OAAM9B,QAAM,QAAA;EACxC;AACD,SAAO;IAAE,SAAA;IAAS,KAAA;IAAK,aAAA;IAAa,QAAA;IAAQ;IAAU;IAAW;IAAS,gBAAA;IAAgB;IAAS;EAAa;AACnH;AAsBD,IAAaqC,kBAAiB,CAACxF,SAAOiF,OAAM,MAAM,WAAW,CAAE,MAAK;AAChE,QAAM,YAAY,SAAS,aAAa;AACxC,QAAM,gBAAgB,SAAS,cAAc;AAC7C,QAAM,QAAQA,MAAK,MAAM,SAAA;AACzB,MAAIc,SAAQ;AACZ,aAAW9C,MAAK,OAAO;AACnB,UAAM,YAAY8C,WAAU,MAAM,SAAS;AAE3C,UAAM,QAAQC,kBAAiB/C,IAAG,IAAA;AAClC,QAAI,UAAU,QAAW;AAErB,YAAM,WAAW;QACb,OAAQ,YAAYjD,UAAQ;QAC5B,OAAOiD;MACV;AACD,aAAAgB,YAAkC,UAAU,IAAA;IAC/C,OACI;AACD,aAAO;AACP,UAAI,UACA,SAAQ,eAAR;QACI,KAAK;AACD;QAEJ,KAAK,SAAS;AACV,gBAAM,WAAWgC,mBAAkB,IAAA;AACnC,eAAK,QAAQ;YACT,QAAQ,CAAC,GAAG,UAAUjG,OAAM;YAC5B,OAAOiD;UACV;AACD;QACH;QACD,KAAK,aAAa;AACd,eAAK,QAAQ;YACT,OAAA;YACA,OAAOA;UACV;AACD;QACH;MACJ;UAID,QAAO;IAEd;AACD,IAAA8C;EACH;AACD,MAAI,SAAS,OACT,OAAM,IAAI,MAAM,uBAAuB;AAC3C,SAAO;AACV;AACD,IAAaJ,gBAAe,CAACV,OAAM9B,QAAM,WAAW,CAAE,MAAK;AACvD,MAAIA,WAAS,OACT,QAAO;AACX,QAAM3B,KAAIoE,iBAAgBX,OAAM9B,QAAM,QAAA;AACtC,MAAI3B,OAAM,OACN,QAAO;UACYA,EAAA;AACvB,SAAO;AACV;AACD,IAAasE,qBAAoB,CAACb,OAAM9B,QAAM,WAAW,CAAE,MAAK;AAC5D,MAAIA,WAAS,OACT,QAAO;AACX,QAAM3B,KAAIoE,iBAAgBX,OAAM9B,QAAM,QAAA;AACtC,MAAI3B,OAAM,OACN,QAAO;AACX,EAAAA,GAAE,QAAQ;IACN,OAAOA,GAAE,OAAO,SAAS;IACzB,OAAO;EACV;AACD,SAAO;AACV;AACD,IAAa0E,wBAAuB,CAACjB,OAAM,MAAM,WAAW,CAAE,MAAK;AAC/D,MAAI,SAAS,OACT,QAAO;AACX,QAAMzD,KAAIoE,iBAAgBX,OAAM,MAAM,QAAA;AACtC,MAAIzD,OAAM,OACN,QAAO;AACX,SAAOA,GAAE,cAAc;AAC1B;AAMD,IAAMwE,oBAAmB,CAAC,OAAO,SAAS;AACtC,MAAI,SAAS,OACT,QAAO;AACX,MAAI,UAAU,OACV,OAAM,IAAI,MAAM,uCAAuC;AAC3D,MAAI,KAAK,OAAO,UAAU,MACtB,QAAO;AACX,aAAWxE,MAAK,KAAK,cACjB,KAAIA,GAAE,OAAO,UAAU,MACnB,QAAOA;AAElB;AACD,IAAakE,eAAc,CAACT,OAAM,MAAM,WAAW,CAAE,MAAK;AACtD,QAAMkB,UAASN,cAAaZ,OAAM,MAAM,QAAA;AACxC,MAAIkB,QAAO,WAAW,EAClB,QAAO;AACX,MAAIA,QAAO,SAAS,EAChB,OAAM,IAAI,MAAM,gDAAgD;AACpE,SAAOA,QAAO,CAAA;AACjB;AACD,IAAMF,qBAAoB,CAACzE,OAAM;AAC7B,MAAIA,GAAE,UAAU,OACZ,QAAO,CAAE;AACb,MAAI,YAAYA,GAAE,MACd,QAAOA,GAAE,MAAM;AACnB,MAAI,WAAWA,GAAE,OAAO;AACpB,QAAIA,GAAE,MAAM,UAAU,OAClB,QAAO,CAAE;AACb,WAAO,CAACA,GAAE,MAAM,KAAM;EACzB;AACD,SAAO,CAAE;AACZ;AACD,IAAMoE,mBAAkB,CAACX,OAAM,MAAM,WAAW,CAAE,MAAK;AACnD,QAAM,YAAY,SAAS,aAAa;AACxC,QAAM,QAAQA,MAAK,MAAM,SAAA;AACzB,MAAIzD,KAAI;AACR,aAAWyB,MAAK,OAAO;AACnB,IAAAzB,KAAIwE,kBAAiB/C,IAAGzB,EAAA;AACxB,QAAIA,OAAM,OACN;EAEP;AACD,SAAOA;AACV;AACD,IAAaqE,gBAAe,CAACZ,OAAM,MAAM,WAAW,CAAE,MAAK;AACvD,QAAM,YAAY,SAAS,aAAa;AACxC,QAAM,QAAQA,MAAK,MAAM,SAAA;AACzB,MAAIzD,KAAI;AACR,aAAWyB,MAAK,OAAO;AAEnB,IAAAzB,KAAIwE,kBAAiB/C,IAAGzB,EAAA;AACxB,QAAIA,OAAM,OAEN,QAAO,CAAE;EAEhB;AACD,SAAOyE,mBAAkBzE,EAAA;AAC5B;;;;;;;;;;;;;;;;;;;;;;;;;;;ACzPD,IAAa6C,kBAAiB,CAAC,SAAS;AACpC,SAAO,CAAC,GAAG,KAAK,SAAA,CAAW,EAAC;AAC/B;AAQD,IAAa1B,gBAAe,CAAC,OAAO,gBAAgB,OAAO;AACvD,SAAOD,WAAU,OAAO,gBAAgB,IAAI,OAAO,gBAAA;AACtD;AACD,IAAa0D,qBAAoB,CAAC,OAAO,qBAAqB,OAAO;AACjE,MAAI,OAAO,UAAU,YACjB,OAAM,IAAI,UAAU,4BAA4B;AACpD,SAAOC,gBAAe,OAAO,qBAAqB,IAAI,OAAO,gBAAA;AAChE;AACD,IAAaC,wBAAuB,CAAC,OAAO,qBAAqB,OAAO;AACpE,SAAOC,mBAAkB,OAAO,qBAAqB,IAAI,OAAO,gBAAA;AACnE;AAUD,IAAa7D,aAAY,CAAC,OAAO,gBAAgB,KAAM,gBAAiB,WAAW,MAAM;AACrF,MAAI,WAAW,EACX,QAAO;AACX,QAAM,cAAc8D,eAAc,KAAA;AAClC,QAAM,eAAeA,eAAc,cAAA;AACnC,QAAMvD,KAAK,cAAc,MAAM,UAAA,IAAc,MAAM;AACnD,MAAI,OAAOA,OAAM,YACb,QAAO;AACX,MAAI,GAAGA,IAAG,cAAA,EACN,QAAO;AACX,QAAM,MAAM,cAAcA,GAAE,YAAA,IAAgBA,GAAE;AAC9C,QAAM,OAAO,eAAgB,eAAgB,YAAA,IAAgB,eAAe;AAE5E,MAAI,GAAG,KAAK,IAAA,EACR,QAAO;AAEX,SAAOP,WAAUO,IAAG,gBAAgB,IAAI,WAAW,CAAA;AACtD;AAYD,IAAaoD,kBAAiB,CAAC,OAAO,qBAAqB,KAAM,gBAAiB,WAAW,MAAM;AAC/F,MAAI,UAAU,OACV,OAAM,IAAI,MAAM,4BAA4B;AAChD,MAAI,WAAW,EACX,QAAO;AAEX,QAAMpD,KAAI,eAAe,QAAQ,MAAM,UAAA,IAAc,MAAM;AAC3D,MAAIA,OAAM,OACN,QAAO;AAEX,QAAMjD,UAAQ,cAAciD,KAAIA,GAAE,SAAA,IAAaA,GAAE;AACjD,MAAI,GAAGjD,SAAO,mBAAA,EACV,QAAO;AACX,SAAOqG,gBAAepD,IAAG,qBAAqB,IAAI,WAAW,CAAA;AAChE;AACD,IAAasD,qBAAoB,CAAC,OAAO,qBAAqB,KAAM,gBAAiB,WAAW,MAAM;AAClG,MAAI,WAAW,EACX;AACJ,QAAMtD,KAAK,eAAe,QAAQ,MAAM,UAAA,IAAc,MAAM;AAC5D,MAAIA,OAAM,OACN;AACJ,QAAMjD,UAAQ,cAAciD,KAAIA,GAAE,SAAA,IAAaA,GAAE;AACjD,MAAI,GAAGjD,SAAO,mBAAA,EACV,QAAOiD;AACX,SAAOsD,mBAAkBtD,IAAG,qBAAqB,IAAI,WAAW,CAAA;AACnE;AAaD,IAAawD,iBAAgB,CAAC,QAAQ,kBAAkB,KAAK,mBAAmB;AAC5E,MAAI,GAAG,QAAQ,gBAAA,EACX,OAAM,IAAI,MAAM,qBAAqB;AACzC,MAAI5D,aAAY,QAAQ,kBAAkB,EAAA,EACtC,OAAM,IAAI,MAAM,oCAAoC;AAExD,MAAIA,aAAY,kBAAkB,QAAQ,EAAA,EACtC,OAAM,IAAI,MAAM,gDAAgD;AAEvE;AASD,IAAaA,eAAc,CAAC,QAAQ,eAAe,KAAK,mBAAmB;AACvE,SAAOD,UAAS,QAAQ,eAAe,IAAI,OAAO,gBAAA;AACrD;AACD,IAAa8D,oBAAmB,CAAC,QAAQ,oBAAoB,KAAK,mBAAmB;AACjF,SAAOC,eAAc,QAAQ,oBAAoB,IAAI,OAAO,gBAAA;AAC/D;AAmBD,IAAa/D,YAAW,CAAC,QAAQ,eAAe,KAAK,gBAAgB,WAAW,MAAM;AAClF,MAAI,WAAW,EACX,QAAO;AACX,MAAI,GAAG,QAAQ,aAAA,EACX,QAAO;AACX,QAAM,MAAM,iBAAiB,SAAS,OAAO,YAAA,IAAgB,OAAO;AACpE,QAAM,OAAO,iBAAiB,gBAAgB,cAAc,YAAA,IAAgB,cAAc;AAC1F,MAAI,GAAG,KAAK,IAAA,EACR,QAAO;AACX,aAAWpB,MAAK4B,cAAa,QAAQ,QAAA,GAAW;AAC5C,UAAM,MAAM,iBAAiB5B,KAAIA,GAAE,YAAA,IAAgBA,GAAE;AACrD,QAAI,GAAGA,IAAG,aAAA,EACN,QAAO;AACX,QAAI,GAAG,KAAK,IAAA,EACR,QAAO;EACd;AACD,SAAO;AACV;AACD,IAAamF,iBAAgB,CAAC,QAAQ,eAAe,KAAK,gBAAgB,WAAW,MAAM;AACvF,MAAI,WAAW,EACX,QAAO;AACX,MAAI,GAAG,OAAO,SAAA,GAAY,aAAA,EACtB,QAAO;AACX,aAAWnF,MAAK4B,cAAa,QAAQ,QAAA,GAAW;AAC5C,UAAMzC,KAAIa,GAAE,SAAA;AACZ,QAAI,GAAGb,IAAG,aAAA,EACN,QAAO;EACd;AACD,SAAO;AACV;AAYD,UAAiBiG,UAAS,MAAM;AAC5B,QAAM3D,KAAI,KAAK,UAAA;AACf,MAAIA,OAAM,OACN;AACJ,aAAW4D,MAAK5D,GAAE,SAAA,GAAY;AAC1B,QAAI4D,OAAM,KACN;AACJ,UAAMA;EACT;AACJ;AAcD,UAAiBpD,SAAQ,MAAM;AAC3B,MAAI+C,eAAc,IAAA,GAAO;AACrB,QAAIvD,KAAI,KAAK,UAAA;AACb,WAAOA,OAAM,QAAW;AACpB,YAAMA;AACN,MAAAA,KAAIA,GAAE,UAAA;IACT;EACJ,OACI;AACD,QAAIA,KAAI,KAAK;AACb,WAAOA,OAAM,QAAW;AACpB,YAAMA;AACN,MAAAA,KAAIA,GAAE;IACT;EACJ;AACJ;AAiBD,SAAgBW,qBAAoB,QAAQ,eAAe,KAAK,gBAAgB;AAC5E,SAAOD,kBAAiB,QAAQ,eAAe,IAAI,OAAO,gBAAA;AAC7D;AAqBD,SAAgBA,kBAAiB,QAAQ,eAAe,KAAK,gBAAgB,WAAW,GAAG;AACvF,MAAI,WAAW,EACX;AACJ,QAAM,WAAW6C,eAAc,MAAA;AAC/B,MAAI,UACA;QAAI,GAAG,OAAO,SAAA,GAAY,aAAA,EACtB,QAAO;EAAO,WAGd,GAAG,OAAO,OAAO,aAAA,EACjB,QAAO;AAEf,aAAW7E,MAAKyB,cAAa,QAAQ,QAAA,EAEjC,KAAI,UACA;QAAI,GAAGzB,GAAE,SAAA,GAAY,aAAA,EACjB,QAAOA;EAAE,WAGT,GAAGA,GAAE,OAAO,aAAA,EACZ,QAAOA;AAGnB;AACH;AAaD,UAAiBuB,YAAWC,QAAM;AAC9B,MAAI,CAACA,OACD;AACJ,QAAM,QAAQ,IAAIlC,cAAA;AAClB,MAAI,QAAQkC;AACZ,SAAO,OAAO;AACV,UAAMgB,YAAUqC,eAAc,KAAA,IAC1B,CAAC,GAAG,MAAM,SAAA,CAAW,IACrB,CAAC,GAAG,MAAM,aAAc;AAC5B,UAAM,KAAK,GAAGrC,SAAAA;AACd,QAAI,MAAM,QACN;AACJ,YAAQ,MAAM,IAAA;AACd,QAAI,MACA,OAAM;EACb;AACJ;AA4BD,UAAiBf,cAAaD,QAAM,QAAQ,OAAO,kBAAkB;AACjE,MAAI,CAACA,OACD;AACJ,QAAM,SAASqD,eAAcrD,MAAAA;AAC7B,QAAM,QAAQ,SAAS,IAAIzC,cAAA,IAAiB,IAAIA,cAAA;AAChD,MAAI,QAAQyC;AACZ,SAAO,OAAO;AACV,QAAI,QAAQ,EACR;AACJ,QAAI,UAAU,QAAW;AACrB,YAAM,OAAO,mBAAmB,QAAQ,MAAM,gBAAgB,MAAM,SAAA;AACpE,iBAAW3B,MAAK,MAAM;AAClB,cAAMA;AACN,cAAM,QAAQA,EAAA;MACjB;IACJ;AACD,YAAQ,MAAM,QAAA;AACd;EACH;AACJ;AAUD,SAAgBsF,MAAK3D,QAAM,WAAW,QAAQ,WAAW;AACrD,MAAI,UAAUA,MAAAA,EACV,QAAOA;AACX,QAAM,OAAO,UAAU,YAAYC,gBAAeF;AAClD,aAAW1B,MAAK,KAAK2B,MAAAA,EACjB,KAAI,UAAU3B,EAAA,EACV,QAAOA;AAElB;AAcD,SAAgBuF,aAAY5D,QAAM,WAAW,QAAQ,WAAW;AAC5D,MAAI,UAAUA,OAAK,SAAA,CAAU,EACzB,QAAOA;AACX,QAAM,OAAO,UAAU,YAAYC,gBAAeF;AAClD,aAAW1B,MAAK,KAAK2B,MAAAA,EACjB,KAAI,UAAU3B,GAAE,SAAA,CAAU,EACtB,QAAOA;AAElB;AAoCD,UAAiBgD,aAAYrB,QAAM,mBAAmB,QAAQ,GAAG;AAC7D,aAAW3B,MAAK2B,OAAK,SAAA,EACjB,KAAI,kBAAkB3B,GAAE,SAAA,GAAY,KAAA,GAAQ;AACxC,UAAMA,GAAE,SAAA;AACR,WAAOgD,aAAYhD,IAAG,mBAAmB,QAAQ,CAAA;EACpD;AAER;AACD,SAAgB+C,cAAa,MAAM,QAAQ,GAAG;AAC1C,MAAI,SAAS,OACT,QAAO;AACX,MAAI,SAAS,KACT,QAAO;AACX,QAAM5D,KAAI,KAAK,SAAA;AACf,MAAI,OAAO,OAAOA;AAClB,MAAI,MAAM,QAAQA,EAAA,EACd,QAAO;AACX,MAAIP,KAAI,KAAK,OAAO,KAAA,IAAS,UAAU,KAAK,UAAUO,EAAA,CAAE,KAAK,IAAA;;AAC7D,aAAWkB,MAAK,KAAK,SAAA,EACjB,CAAAzB,MAAKmE,cAAa1C,IAAG,QAAQ,CAAA;AAEjC,SAAOzB;AACV;AACD,SAAgBsB,aAAY,OAAO;AAC/B,MAAItB,KAAI;AACR,aAAW,QAAQ,OAAO;AACtB,UAAMO,KAAI,KAAK,SAAA;AACf,UAAM,UAAU,mBAAmBA,EAAA;AACnC,UAAM4C,aAAW,CAAC,GAAG,KAAK,SAAA,CAAW;AACrC,UAAM,SAAS,KAAK,UAAA;AACpB,QAAI,OAAO,OAAO5C;AAClB,QAAI,MAAM,QAAQA,EAAA,EACd,QAAO;AACX,IAAAP,MAAK,UAAU,OAAA,KAAY,IAAA,WAAemD,WAAS,MAAA,cAAoB,SAAS,MAAM,GAAG;;EAC5F;AACD,SAAOnD;AACV;;;;;;;;;;;;AC9cD,IAAa4G,iBAAgB,CAAC,SAAS;AACnC,MAAIR,eAAc,IAAA,EACd,QAAO;AACX,MAAIS,YAAW,IAAA,EACX,QAAOC,wBAAsB,IAAA;AACjC,MAAI,OAAO,SAAS,SAChB,QAAOC,sBAAoB,IAAA;AAC/B,QAAM,IAAI,MAAM,kCAAkC;AACrD;AAQD,IAAaF,cAAa,CAAC,SAAS;AAChC,MAAI,YAAY,QAAQ,mBAAmB,QAAQ,WAAW,MAC1D;QAAI,MAAM,QAAQ,KAAK,aAAA,EACnB,QAAO;EAAK;AAEpB,SAAO;AACV;AAQD,IAAaT,iBAAgB,CAAC,SAAS;AACnC,SAAQ,cAAc,QAAQ,eAAe,QAAQ,cAAc,QAAQ,iBAAiB;AAC/F;AC5CD,IAAaY,kBAAb,MAAaA,gBAAe;EACxB;EAEA;EACA,YAAY,OAAO,CAAE,GAAE,OAAO,CAAE,GAAE;AAC9B,SAAK,OAAO;AACZ,SAAK,OAAO;EACf;EACD,QAAQ,OAAO;AACX,WAAO,IAAIA,gBAAe,KAAK,MAAMrG,MAAK,KAAK,MAAM,KAAK,MAAM,GAAG,KAAA,CAAM;EAC5E;EACD,MAAM;AACF,WAAO,IAAIqG,gBAAe,KAAK,MAAMpG,KAAI,KAAK,MAAM,KAAK,IAAA,CAAK;EACjE;EACD,QAAQE,KAAI;AACR,SAAK,KAAK,QAAQA,GAAA;EACrB;EACD,eAAeA,KAAI;AACf,KAAC,GAAG,KAAK,IAAK,EAAC,QAAA,EAAU,QAAQA,GAAA;EACpC;EACD,IAAI,UAAU;AACV,WAAOV,WAAQ,KAAK,MAAM,KAAK,IAAA;EAClC;EACD,IAAI,SAAS;AACT,WAAOC,UAAO,KAAK,MAAM,KAAK,IAAA;EACjC;EACD,IAAI,OAAO;AACP,WAAOF,QAAK,KAAK,MAAM,KAAK,IAAA;EAC/B;EACD,IAAI,SAAS;AACT,WAAO,KAAK,KAAK;EACpB;AACJ;AAwBD,IAAa8G,eAAY,CAAC,UAAU,CAAE,MAAK,kBAAkB,IAAID,gBAAe,EAAE,GAAG,QAAS,GAAE,CAAC,GAAG,aAAc,CAAA;;;;;;;;;;;;;;AE/ClH,IAAavG,aAAU,CAAC,cAAc,IAAIyG,kBAAiB,SAAA;AAI3D,IAAaA,oBAAb,cAAsC,mBAAmB;EAGrD,QAAQ,oBAAI,IAAA;EACZ;;;;;EAKA,YAAY,WAAW;AACnB,UAAA;AACA,SAAK,YAAY,aAAc;EAClC;;;;EAID,IAAI,OAAO;AACP,WAAO,KAAK,MAAM;EACrB;;;;;EAKD,OAAOnB,SAAQ;AAEX,QAAI,iBAAiB;AACrB,eAAWnG,WAASmG,SAAQ;AACxB,YAAM,YAAY,KAAK,IAAInG,OAAAA;AAC3B,WAAK,MAAM,IAAI,KAAK,UAAUA,OAAAA,GAAQA,OAAAA;AACtC,YAAM,UAAU,OAAO;QAAE,OAAOA;QAAO,SAAS;MAAW,CAAA;AAC3D,UAAI,CAAC,UACD,kBAAiB;IACxB;AACD,WAAO;EACV;;;;;EAMD,SAAS;AACL,WAAO,KAAK,MAAM,OAAA;EACrB;;;;EAID,QAAQ;AACJ,SAAK,MAAM,MAAA;AACX,UAAM,UAAU,SAAS,IAAA;EAC5B;;;;;;EAMD,OAAOW,IAAG;AACN,UAAM,YAAY,KAAK,MAAM,OAAO,KAAK,UAAUA,EAAA,CAAE;AACrD,QAAI,UACA,OAAM,UAAU,UAAUA,EAAA;AAC9B,WAAO;EACV;;;;;;EAMD,IAAIA,IAAG;AACH,WAAO,KAAK,MAAM,IAAI,KAAK,UAAUA,EAAA,CAAE;EAC1C;;;;;EAKD,UAAU;AACN,WAAO,CAAC,GAAG,KAAK,MAAM,OAAA,CAAS;EAClC;AACJ;ACxFD,IAAa4G,sBAAb,MAAaA,oBAAmB;EAC5B;EACA;EAEA,YAAY,WAAWC,QAAK;AACxB,SAAK,QAAQA,UAAO,oBAAI,IAAA;AACxB,SAAK,YAAY,aAAc;EAClC;EACD,IAAI,OAAO;AACP,WAAO,KAAK,MAAM;EACrB;EACD,OAAOrB,SAAQ;AACX,UAAMU,KAAI,IAAI,IAAI,KAAK,KAAA;AACvB,eAAWlG,MAAKwF,SAAQ;AACpB,YAAM,MAAM,KAAK,UAAUxF,EAAA;AAC3B,MAAAkG,GAAE,IAAI,KAAKlG,EAAA;IACd;AACD,WAAO,IAAI4G,oBAAmB,KAAK,WAAWV,EAAA;EACjD;EACD,OAAOlG,IAAG;AACN,UAAMkG,KAAI,IAAI,IAAI,KAAK,KAAA;AACvB,UAAM,MAAM,KAAK,UAAUlG,EAAA;AAC3B,QAAIkG,GAAE,OAAO,GAAA,EACT,QAAO,IAAIU,oBAAmB,KAAK,WAAWV,EAAA;AAClD,WAAO;EACV;EACD,IAAIlG,IAAG;AACH,UAAM,MAAM,KAAK,UAAUA,EAAA;AAC3B,WAAO,KAAK,MAAM,IAAI,GAAA;EACzB;EACD,UAAU;AACN,WAAO,CAAC,GAAG,KAAK,MAAM,OAAA,CAAS;EAClC;EACD,CAAC,SAAS;AACN,WAAO,KAAK,MAAM,OAAA;EACrB;AACJ;AAOD,IAAa0G,eAAY,CAAC,YAAY,oBAAoB,IAAIE,oBAAmB,SAAA;ACvBjF,IAAaE,cAAb,MAAaA,YAAW;EACpB;EACA;EACA,WAAW,oBAAI,IAAA;EACf,SAAS,CAAE;EACX,YAAY,WAAW,GAAG,QAAQ,GAAG;AACjC,SAAKC,SAAS;AACd,SAAKC,YAAY;EACpB;;;;;EAKD,YAAY;AACR,WAAO,KAAK,OAAO;EACtB;;;;;;EAMD,eAAe;AACX,WAAO,CAAC,GAAG,KAAK,SAAS,OAAA,CAAS,EAAC;EACtC;EACD,mBAAmB;AACf,QAAIvH,KAAI,KAAK,aAAA;AACb,eAAWoB,MAAK,KAAK,SAAS,OAAA,EAC1B,CAAApB,MAAKoB,GAAE,iBAAA;AAEX,WAAOpB;EACV;;;;EAID,OAAO;AACH,QAAIwH,KAAI,KAAK,OAAO;AACpB,eAAWC,UAAO,KAAK,SAAS,OAAA,EAC5B,CAAAD,MAAKC,OAAI,KAAA;AAEb,WAAOD;EACV;EACD,IAAI5H,SAAO;AACP,QAAI,OAAOA,YAAU,SACjB,OAAM,IAAI,MAAM,wCAAwC,OAAOA,OAAAA,EAAO;AAC1E,QAAIA,QAAM,WAAW,EACjB,OAAM,IAAI,MAAM,wBAAwB;AAC5C,UAAM,cAAc,KAAK8H,UAAU9H,SAAO,IAAA;AAC1C,QAAI,gBAAgB,MAAM;AACtB,UAAI,CAAC,KAAK,SAASA,OAAAA,EACf,MAAK,OAAO,KAAKA,OAAAA;AAErB;IACH;AACD,QAAI,CAAC,YACD,OAAM,IAAI,MAAM,mCAAmCA,OAAAA,EAAO;AAC9D,gBAAY,IAAIA,OAAAA;EACnB;EACD,OAAOA,SAAO;AACV,QAAI,OAAOA,YAAU,SACjB,OAAM,IAAI,MAAM,wCAAwC,OAAOA,OAAAA,EAAO;AAC1E,QAAIA,QAAM,WAAW,EACjB,OAAM,IAAI,MAAM,wBAAwB;AAC5C,UAAM,cAAc,KAAK8H,UAAU9H,SAAO,KAAA;AAC1C,QAAI,gBAAgB,OAChB,QAAO;AACX,QAAI,gBAAgB,MAAM;AACtB,UAAI,KAAK,SAASA,OAAAA,GAAQ;AACtB,aAAK,SAAS,KAAK,OAAO,OAAO,CAAAW,OAAKA,OAAMX,OAAAA;AAC5C,eAAO;MACV;AACD,aAAO;IACV;AACD,WAAO,YAAY,OAAOA,OAAAA;EAC7B;EACD,YAAY;AACR,UAAMsF,KAAI,KAAKyC,aAAAA;AACf,eAAWC,OAAM1C,GACb,SAAQ,IAAI0C,GAAA;EAEnB;EACD,aAAa,QAAQ,GAAG;AACpB,UAAM1C,KAAI,CAAE;AACZ,IAAAA,GAAE,KAAK,UAAU,KAAKoC,MAAAA,SAAe,KAAKC,SAAAA,EAAW;AACrD,eAAW,CAAC,KAAK3H,OAAAA,KAAU,KAAK,SAAS,QAAA,GAAW;AAChD,YAAM,SAASA,QAAM+H,aAAa,QAAQ,CAAA;AAC1C,MAAAzC,GAAE,KAAK,SAAS,GAAA,EAAK;AACrB,iBAAW3D,MAAK,OACZ,CAAA2D,GAAE,KAAK,IAAI,OAAO,QAAQ,CAAA,IAAK3D,EAAA;IAEtC;AACD,IAAA2D,GAAE,KAAK,YAAY,KAAK,OAAO,MAAA,GAAS;AACxC,eAAW3E,MAAK,KAAK,OACjB,CAAA2E,GAAE,KAAK,IAAI3E,EAAA,EAAG;AAElB,WAAO2E,GAAE,IAAI,CAAAvD,UAAQ,IAAI,OAAO,KAAA,IAASA,KAAA;EAC5C;EACD,UAAU/B,SAAOoF,UAAQ;AACrB,QAAIpF,YAAU,OACV,OAAM,IAAI,MAAM,yBAAyB;AAC7C,QAAI,KAAK0H,WAAW,KAAKC,UACrB,QAAO;AACX,QAAI3H,QAAM,UAAU,KAAK0H,OACrB,QAAO;AACX,UAAMO,KAAIjI,QAAM,KAAK0H,MAAAA;AACrB,QAAIO,OAAM,OACN,OAAM,IAAI,MAAM,uBAAuB,KAAKP,MAAAA,SAAe1H,QAAM,MAAA,EAAQ;AAC7E,QAAI,QAAQ,KAAK,SAAS,IAAIiI,EAAA;AAC9B,QAAI,UAAU,UAAa7C,UAAQ;AAC/B,cAAQ,IAAIqC,YAAW,KAAKE,WAAW,KAAKD,SAAS,CAAA;AACrD,WAAK,SAAS,IAAIO,IAAG,KAAA;IACxB;AACD,WAAO;EACV;;;;;;EAMD,SAASjI,SAAO;AACZ,eAAWW,MAAK,KAAK,OACjB,KAAIA,OAAMX,QACN,QAAO;AAEf,WAAO;EACV;EACD,IAAIA,SAAO;AACP,QAAI,OAAOA,YAAU,SACjB,QAAO;AACX,UAAM,cAAc,KAAK8H,UAAU9H,SAAO,KAAA;AAC1C,QAAI,gBAAgB,OAChB,QAAO;AACX,QAAI,gBAAgB,KAChB,QAAO,KAAK,SAASA,OAAAA;AACzB,WAAO,YAAY,IAAIA,OAAAA;EAC1B;AACJ;;;;;;;;;AE5ID,IAAakI,mBAAb,cAAqCxH,cAAa;EAC9C,YAAY,OAAO,CAAE,GAAE;AACnB,QAAI,KAAK,OAAO,OACZ,QAAO;MACH,GAAG;MACH,IAAI,CAACU,IAAGC,OAAM;AACV,eAAO,eAAeD,GAAE,MAAMC,GAAE,IAAA;MACnC;IACJ;AAEL,UAAM,IAAA;EACT;;;;;;EAMD,oBAAoB,MAAM8G,YAAU;AAChC,gBAAY,WAAWA,YAAU,UAAU,CAAC;AAC5C,UAAM,QAAQ;MAAE;MAAM,UAAA;IAAU,CAAA;EACnC;EACD,eAAe,MAAMA,YAAU,eAAe,OAAO,IAAI;AACrD,QAAI,SAAS,OACT,OAAM,IAAI,MAAM,0BAA0B;AAC9C,QAAI;AACJ,eAAWxG,MAAK,KAAK,KACjB,KAAI,IACA;UAAI,GAAGA,GAAE,MAAM,IAAA,GAAO;AAClB,mBAAWA;AACX;MACH;eAGG,KAAK,GAAGA,IAAG;MAAE;MAAM,UAAU;IAAG,CAAA,GAAG;AACnC,iBAAWA;AACX;IACH;AAGT,QAAI,aAAa,UAAa,CAAC,aAC3B,OAAM,IAAI,MAAM,2CAA2C,KAAK,UAAU,IAAA,CAAK,EAAE;AACrF,QAAI,aAAa,OACb,MAAK,YAAY,CAAA,WAAQ,aAAayG,MAAAA;AAE1C,SAAK,oBAAoB,MAAMD,UAAAA;EAClC;EACD,aAAa;AAET,UAAME,KAAIC,KAAcC,MAAa,KAAK,MAAM,CAACnH,IAAGC,OAAMD,GAAE,YAAYC,GAAE,QAAA,CAAS;AACnF,QAAIgH,OAAM,OACN;AACJ,SAAK,YAAY,CAAA,SAAQ,SAASA,EAAA;AAClC,WAAOA,GAAE;EACZ;EACD,aAAa;AACT,UAAMA,KAAIC,KAAcC,MAAa,KAAK,MAAM,CAACnH,IAAGC,OAAMD,GAAE,YAAYC,GAAE,QAAA,CAAS;AAEnF,QAAIgH,OAAM,OACN;AACJ,SAAK,YAAY,CAAA,SAAQ,KAAK,SAASA,EAAA;AACvC,WAAOA,GAAE;EACZ;EACD,UAAU;AACN,UAAMA,KAAIC,KAAcC,MAAa,KAAK,MAAM,CAACnH,IAAGC,OAAMD,GAAE,YAAYC,GAAE,QAAA,CAAS;AAEnF,QAAIgH,OAAM,OACN;AACJ,WAAOA,GAAE;EACZ;EACD,UAAU;AAEN,UAAMA,KAAIC,KAAcE,MAAa,KAAK,MAAM,CAACpH,IAAGC,OAAMD,GAAE,YAAYC,GAAE,QAAA,CAAS;AACnF,QAAIgH,OAAM,OACN;AACJ,WAAOA,GAAE;EACZ;AACJ;AAWD,SAAgBF,UAAS,OAAO,CAAE,GAAE;AAChC,SAAO,IAAID,iBAAgB,IAAA;AAC9B;ACrGD,IAAaO,kBAAb,MAAaA,gBAAe;EACxB;EACA;;;;;;EAMA,YAAY,OAAO,CAAE,GAAE,OAAO,CAAE,GAAE;AAC9B,QAAI,SAAS,OACT,OAAM,IAAI,MAAM,0BAA0B;AAC9C,SAAK,OAAO;AACZ,SAAKC,QAAQ;EAChB;EACD,QAAQxH,KAAI;AAER,aAAS,QAAQ,KAAKwH,MAAM,SAAS,GAAG,SAAS,GAAG,QAChD,CAAAxH,IAAG,KAAKwH,MAAM,KAAA,CAAA;EAErB;EACD,iBAAiBxH,KAAI;AAEjB,SAAKwH,MAAM,QAAQ,CAAA,SAAQ;AAAE,MAAAxH,IAAG,IAAA;IAAQ,CAAA;EAC3C;EACD,WAAW,OAAO;AACd,WAAO,IAAIuH,gBAAe,KAAK,MAAMpI,SAAQ,KAAK,MAAM,KAAKqI,OAAO,GAAG,KAAA,CAAM;EAChF;EACD,UAAU;AACN,WAAO,IAAID,gBAAe,KAAK,MAAMnI,SAAQ,KAAK,MAAM,KAAKoI,KAAAA,CAAM;EACtE;EACD,IAAI,UAAU;AACV,WAAOlI,SAAQ,KAAK,MAAM,KAAKkI,KAAAA;EAClC;EACD,IAAI,SAAS;AACT,WAAOjI,QAAO,KAAK,MAAM,KAAKiI,KAAAA;EACjC;EACD,IAAI,SAAS;AACT,WAAO,KAAKA,MAAM;EACrB;EACD,IAAI,OAAO;AACP,WAAOnI,MAAK,KAAK,MAAM,KAAKmI,KAAAA;EAC/B;EACD,UAAU;AACN,WAAO,CAAC,GAAG,KAAKA,KAAM;EACzB;AACJ;AAsBD,IAAarB,eAAY,CAAC,UAAU,CAAE,MAAK,kBAAkB;AACzD,YAAU,EAAE,GAAG,QAAS;AACxB,SAAO,IAAIoB,gBAAe,SAAS,CAAC,GAAG,aAAc,CAAA;AACxD;;;;;;;;;;;;;;;;;AElED,IAAarD,YAAS,CAAC,UAAU,CAAE,MAAK,IAAIuD,aAAY,OAAA;AA8DxD,IAAaA,eAAb,cAAiC,mBAAmB;EAChD;EACA;EAEA;EACA;EACA;EACA;EACA,WAAW;EACX,YAAY,OAAO,CAAE,GAAE;AACnB,UAAA;AACA,SAAK,WAAW,KAAK,YAAY;AACjC,gBAAY,YAAY,KAAK,UAAU,WAAW,UAAU,CAAC;AAC7D,SAAK,QAAQ,oBAAI,IAAA;AAEjB,QAAI,KAAK,eAAe,KAAK,YAAY,EACrC,OAAM,IAAI,MAAM,kDAAkD;AAEtE,SAAK,cAAc,KAAK,eAAe;AACvC,SAAK,sBAAsB,KAAK,uBAAuB;AACvD,SAAK,mBAAmB,KAAK,oBAAoB;AACjD,QAAI,KAAK,sBAAsB,EAC3B,MAAK,kBAAkB,YAAY,MAAM;AAAE,WAAKC,UAAAA;IAAc,GAAE,KAAK,IAAI,KAAM,KAAK,sBAAsB,CAAA,CAAE;EAEnH;EACD,UAAU;AACN,QAAI,KAAK,SACL;AACJ,SAAK,WAAW;AAChB,QAAI,KAAK,iBAAiB;AACtB,oBAAc,KAAK,eAAA;AACnB,WAAK,kBAAkB;IAC1B;EACJ;;;;EAID,IAAI,YAAY;AACZ,WAAO,KAAK,MAAM;EACrB;EACD,CAAC,UAAU;AACP,eAAW,SAAS,KAAK,MAAM,QAAA,EAC3B,OAAM,CAAC,MAAM,CAAA,GAAI,MAAM,CAAA,EAAG,KAAM;EAEvC;EACD,CAAC,SAAS;AACN,eAAWjI,MAAK,KAAK,MAAM,OAAA,EACvB,OAAMA,GAAE;EAEf;EACD,CAAC,OAAO;AACJ,WAAO,KAAK,MAAM,KAAA;EACrB;;;;;;EAMD,WAAW,KAAK;AACZ,UAAMA,KAAI,KAAK,MAAM,IAAI,GAAA;AACzB,QAAI,OAAOA,OAAM,YACb;AACJ,WAAO,KAAK,IAAA,IAAQA,GAAE;EACzB;;;;;;EAMD,WAAW,KAAK;AACZ,UAAMA,KAAI,KAAK,MAAM,IAAI,GAAA;AACzB,QAAI,OAAOA,OAAM,YACb;AACJ,WAAO,KAAK,IAAA,IAAQA,GAAE;EACzB;;;;;;;EAOD,IAAI,KAAK;AACL,WAAO,KAAK,MAAM,IAAI,GAAA;EACzB;;;;;;;EAOD,IAAI,KAAK;AACL,UAAMA,KAAI,KAAK,MAAM,IAAI,GAAA;AACzB,QAAIA,IAAG;AACH,UAAI,KAAK,qBAAqB,YAAY,KAAK,qBAAqB,MAChE,MAAK,MAAM,IAAI,KAAK;QAChB,GAAGA;QACH,SAAS,YAAY,IAAA;MACxB,CAAA;AAEL,aAAOA,GAAE;IACZ;EACJ;;;;;;;;EAQD,OAAO,KAAK;AACR,UAAMX,UAAQ,KAAK,MAAM,IAAI,GAAA;AAC7B,QAAI,CAACA,QACD,QAAO;AACX,UAAM2B,KAAI,KAAK,MAAM,OAAO,GAAA;AAE5B,SAAK,UAAU,WAAW;MACtB;MACA,OAAO3B,QAAM;IAChB,CAAA;AACD,WAAO2B;EACV;;;;;EAKD,QAAQ;AACJ,SAAK,MAAM,MAAA;EACd;;;;;;;;;EASD,MAAM,KAAK;AACP,UAAMhB,KAAI,KAAK,MAAM,IAAI,GAAA;AACzB,QAAI,CAACA,GACD,QAAO;AACX,SAAK,MAAM,IAAI,KAAK;MAChB,GAAGA;MACH,SAAS,KAAK,IAAA;MACd,SAAS,KAAK,IAAA;IACjB,CAAA;AACD,WAAO;EACV;EACD,iBAAiB;AACb,QAAI,KAAK,gBAAgB,OACrB;AACJ,QAAI,SAAS;AACb,QAAI,KAAK,gBAAgB,YACrB,UAAS;aACJ,KAAK,gBAAgB,YAC1B,UAAS;QAET,OAAM,IAAI,MAAM,2BAA2B,KAAK,WAAA,EAAa;AACjE,UAAM,SAAS,oBAAoB,KAAK,OAAO,MAAA;AAC/C,WAAO,OAAO,CAAA,EAAG,CAAA;EACpB;EACD,YAAY;AACR,QAAI,KAAK,qBAAqB,OAC1B;AACJ,SAAK,kBAAkB,KAAK,qBAAqB,KAAK,gBAAA;EACzD;;;;;;;;;;;;;;;EAeD,kBAAkBkI,WAAU,UAAU;AAClC,UAAM1E,YAAU,CAAC,GAAG,KAAK,MAAM,QAAA,CAAU;AACzC,UAAM,QAAQ,CAAE;AAChB,UAAM,aAAa,aAAa0E,WAAU,GAAA;AAC1C,UAAM,MAAM,YAAY,IAAA;AACxB,eAAW,SAAS1E,WAAS;AACzB,YAAM,aAAa,MAAM,MAAM,CAAA,EAAG;AAClC,YAAM,aAAa,MAAM,MAAM,CAAA,EAAG;AAClC,YAAM2E,WAAU,aAAa,QACvB,aACC,aAAa,QACV,aACA,KAAK,IAAI,YAAY,UAAA;AAC/B,UAAIA,YAAW,WACX,OAAM,KAAK,CAAC,MAAM,CAAA,GAAI,MAAM,CAAA,EAAG,KAAM,CAAA;IAE5C;AACD,eAAW,SAAS,OAAO;AACvB,WAAK,MAAM,OAAO,MAAM,CAAA,CAAA;AAExB,YAAM,iBAAiB;QACnB,KAAK,MAAM,CAAA;QACX,OAAO,MAAM,CAAA;MAChB;AACD,WAAK,UAAU,WAAW,cAAA;AAC1B,WAAK,UAAU,WAAW,cAAA;IAC7B;AACD,WAAO;EACV;;;;;;;;;;;;EAYD,IAAI,KAAK9I,SAAO;AACZ,UAAM,WAAW,KAAK,MAAM,IAAI,GAAA;AAChC,QAAI,UAAU;AAEV,WAAK,MAAM,IAAI,KAAK;QAChB,GAAG;QACH,SAAS,YAAY,IAAA;MACxB,CAAA;AACD;IACH;AAED,QAAI,KAAK,cAAc,KAAK,YAAY,KAAK,WAAW,GAAG;AAEvD,YAAM+I,QAAM,KAAK,eAAA;AACjB,UAAI,CAACA,MACD,OAAM,IAAI,MAAM,+BAA+B,KAAK,QAAA,GAAW;AAEnE,YAAMC,aAAW,KAAK,MAAM,IAAID,KAAAA;AAChC,WAAK,MAAM,OAAOA,KAAAA;AAElB,UAAIC,YAAU;AACV,cAAM,iBAAiB;UAAE,KAAA;UAAK,OAAOA,WAAS;QAAO;AACrD,aAAK,UAAU,WAAW,cAAA;AAC1B,aAAK,UAAU,WAAW,cAAA;MAC7B;IACJ;AAED,SAAK,MAAM,IAAI,KAAK;MAChB,SAAS;MACT,SAAS,YAAY,IAAA;MACrB,OAAOhJ;IACV,CAAA;AACD,SAAK,UAAU,UAAU;MAAE;MAAK,OAAA;IAAO,CAAA;EAC1C;AACJ;AC/SD,IAAaiJ,cAAa,CAACzB,QAAK,cAAc;AAC1C,aAAW0B,MAAK1B,OAAI,QAAA,GAAW;AAC3B,UAAMxH,UAAQkJ,GAAE,CAAA;AAChB,eAAW,YAAYlJ,QACnB,KAAI,UAAU,UAAUkJ,GAAE,CAAA,CAAA,EACtB,QAAOA;EAElB;AACJ;AAID,IAAaC,aAAY,CAAC3B,WAAQ;AAE9B,MAAI,UAAU,CAAC,IAAI,CAAE;AACrB,aAAW0B,MAAK1B,OAAI,cAAA,EAChB,KAAI0B,GAAE,CAAA,IAAK,QAAQ,CAAA,EACf,WAAUA;AAGlB,SAAO,QAAQ,CAAA;AAClB;AAmBD,IAAaE,qBAAoB,CAAC5B,QAAKxH,SAAOqJ,WAAU,mBAAmB;AACvE,aAAWH,MAAK1B,OAAI,QAAA,GAAW;AAC3B,UAAM,SAAS0B,GAAE,CAAA;AACjB,eAAW,YAAY,OACnB,KAAIG,SAAQ,UAAUrJ,OAAAA,EAClB,QAAOkJ;EAElB;AACJ;ACnED,IAAaI,mBAAb,MAA6B;EACzB;EACA;EACA;;;;;;EAMA,YAAYC,WAAU,cAAc,UAAW,gBAAiB,UAAU,CAAE,GAAE;AAC1E,SAAK,UAAUA;AACf,SAAK,UAAU;AACf,SAAK,MAAM,IAAI,IAAI,OAAA;EACtB;;;;;;EAMD,IAAI,KAAK;AACL,WAAO,KAAK,IAAI,IAAI,GAAA;EACvB;;;;;;;EAOD,YAAY,KAAKvJ,SAAO;AACpB,UAAMmG,UAAS,KAAK,IAAI,IAAI,GAAA;AAC5B,QAAI,CAACA,QACD,QAAO;AACX,eAAWxF,MAAKwF,QACZ,KAAI,KAAK,QAAQxF,IAAGX,OAAAA,EAChB,QAAO;AAEf,WAAO;EACV;;;;;EAKD,cAAc;AACV,QAAIsF,KAAI;AACR,UAAM,OAAO,CAAC,GAAG,KAAK,IAAI,KAAA,CAAO;AACjC,SAAK,MAAM,CAAC2C,OAAM;AACd,YAAMtH,KAAI,KAAK,IAAI,IAAIsH,EAAA;AACvB,UAAItH,OAAM,OACN;AACJ,MAAA2E,MAAK2C,KAAI,KAAKtH,GAAE,MAAA,OAAa,KAAK,UAAUA,EAAA,CAAE;;IACjD,CAAA;AACD,WAAO2E;EACV;;;;;;;EAOD,MAAM,KAAK;AACP,UAAMa,UAAS,KAAK,IAAI,IAAI,GAAA;AAC5B,QAAI,CAACA,QACD,QAAO;AACX,WAAOA,QAAO;EACjB;;;;;;;EAOD,gBAAgBnG,SAAO,KAAK,gBAAgB;AACxC,UAAM,QAAQoJ,mBAAkB,MAAMpJ,SAAO,EAAA;AAC7C,QAAI,MACA,QAAO,MAAM,CAAA;EACpB;;;;EAID,CAAC,cAAc;AACX,eAAW,OAAO,KAAK,IAAI,KAAA,EACvB,YAAWA,WAAS,KAAK,IAAI,IAAI,GAAA,EAC7B,OAAM,CAAC,KAAKA,OAAM;EAG7B;;;;EAID,CAAC,UAAU;AACP,eAAW,CAACiI,IAAGtH,EAAA,KAAM,KAAK,IAAI,QAAA,EAC1B,OAAM,CAACsH,IAAG,CAAC,GAAGtH,EAAE,CAAC;EAExB;;;;;;EAMD,CAAC,IAAI,KAAK;AACN,UAAM0H,KAAI,KAAK,IAAI,IAAI,GAAA;AACvB,QAAI,CAACA,GACD;AACJ,WAAOA,GAAE,OAAA;EACZ;;;;EAID,CAAC,OAAO;AACJ,WAAO,KAAK,IAAI,KAAA;EACnB;;;;;EAKD,CAAC,aAAa;AACV,eAAWlE,aAAW,KAAK,IACvB,QAAOA,UAAQ,CAAA;EAEtB;;;;;EAKD,CAAC,SAAS;AACN,eAAWA,aAAW,KAAK,IACvB,OAAMA,UAAQ,CAAA;EAErB;;;;EAID,CAAC,gBAAgB;AACb,eAAWA,aAAW,KAAK,IACvB,OAAM,CAACA,UAAQ,CAAA,GAAIA,UAAQ,CAAA,EAAG,MAAO;EAE5C;;;;EAID,IAAI,aAAa;AACb,WAAO,KAAK,IAAI;EACnB;;;;EAID,IAAI,UAAU;AACV,WAAO,KAAK,IAAI,SAAS;EAC5B;AACJ;AC/HD,IAAaqF,sBAAb,cAAwCF,iBAAgB;EACpD,eAAe,QAAQnD,SAAQ;AAC3B,UAAM,WAAW,KAAK,IAAI,IAAI,GAAA;AAC9B,QAAI,aAAa,OACb,MAAK,IAAI,IAAI,KAAKA,OAAA;QAGlB,MAAK,IAAI,IAAI,KAAK,CAAC,GAAG,UAAU,GAAGA,OAAO,CAAA;EAEjD;;;;;;;EAOD,UAAU,KAAKA,SAAQ;AACnB,SAAK,IAAI,IAAI,KAAKA,OAAA;EACrB;;;;;;EAMD,YAAYA,SAAQ;AAChB,eAAWxF,MAAKwF,SAAQ;AACpB,YAAM,MAAM,KAAK,QAAQxF,EAAA;AACzB,WAAK,eAAe,KAAKA,EAAA;IAC5B;EACJ;;;;;;;EAOD,eAAe,KAAKX,SAAO;AACvB,UAAM,WAAW,KAAK,IAAI,IAAI,GAAA;AAC9B,QAAI,aAAa,OACb,QAAO;AACX,UAAMyJ,YAAU,SAAS,OAAO,CAAC,kBAAkB,CAAC,KAAK,QAAQ,eAAezJ,OAAAA,CAAM;AACtF,SAAK,IAAI,IAAI,KAAKyJ,SAAAA;AAClB,WAAOA,UAAQ,SAAS,SAAS;EACpC;;;;;;;;EAQD,cAAczJ,SAAO;AACjB,QAAI0J,QAAM;AACV,UAAMvF,YAAU,CAAC,GAAG,KAAK,IAAI,QAAA,CAAU;AACvC,eAAW,cAAcA,UACrB,YAAWgC,WAAU,WAAW,CAAA,EAC5B,KAAI,KAAK,QAAQA,SAAQnG,OAAAA,GAAQ;AAC7B0J,cAAM;AACN,WAAK,eAAe,WAAW,CAAA,GAAI1J,OAAAA;IACtC;AAGT,WAAO0J;EACV;;;;;;EAMD,OAAO,KAAK;AACR,UAAMvD,UAAS,KAAK,IAAI,IAAI,GAAA;AAC5B,QAAI,CAACA,QACD,QAAO;AACX,QAAIA,QAAO,WAAW,EAClB,QAAO;AACX,SAAK,IAAI,OAAO,GAAA;AAChB,WAAO;EACV;;;;EAID,QAAQ;AACJ,SAAK,IAAI,MAAA;EACZ;AACJ;AAmBD,IAAawD,mBAAkB,CAACJ,WAAU,cAAc,UAAW,mBAAoB,IAAIC,oBAAmBD,UAAS,OAAA;ACzHvH,IAAMK,YAAW,CAACpC,QAAK,SAAS;AAC5B,QAAMI,KAAI,IAAI,IAAIJ,OAAI,QAAA,CAAS;AAC/B,aAAW7F,MAAK,MAAM;AAClB,QAAIA,GAAE,CAAA,MAAO,OACT,OAAM,IAAI,MAAM,yBAAyB;AAC7C,QAAIA,GAAE,CAAA,MAAO,OACT,OAAM,IAAI,MAAM,2BAA2B;AAC/C,IAAAiG,GAAE,IAAIjG,GAAE,CAAA,GAAIA,GAAE,CAAA,CAAA;EACjB;AACD,SAAOiG;AACV;AAOD,IAAMiC,cAAa,CAACrC,QAAK,SAAS;AAC9B,QAAMI,KAAI,IAAI,IAAIJ,OAAI,QAAA,CAAS;AAC/B,aAAW7F,MAAK,MAAM;AAClB,QAAIA,GAAE,QAAQ,OACV,OAAM,IAAI,MAAM,yBAAyB;AAC7C,QAAIA,GAAE,UAAU,OACZ,OAAM,IAAI,MAAM,2BAA2B;AAC/C,IAAAiG,GAAE,IAAIjG,GAAE,KAAKA,GAAE,KAAA;EAClB;AACD,SAAOiG;AACV;AAYD,IAAakC,OAAM,CAACtC,QAAK,QAAQA,OAAI,IAAI,GAAA;AAezC,IAAaxE,OAAM,CAACwE,WAAQ,SAAS;AACjC,MAAIA,WAAQ,OACR,OAAM,IAAI,MAAM,4BAA4B;AAChD,MAAI,SAAS,OACT,OAAM,IAAI,MAAM,8BAA8B;AAClD,MAAI,KAAK,WAAW,EAChB,QAAOA;AACX,QAAM,cAAc,KAAK,CAAA;AACzB,QAAM,WAAW,OAAO,YAAY,QAChC,eACA,OAAO,YAAY,UACf;AACR,SAAO,WACDqC,YAAWrC,QAAK,IAAA,IAChBoC,UAASpC,QAAK,IAAA;AACvB;AAQD,IAAaK,OAAM,CAACL,QAAK,KAAKxH,YAAU;AACpC,QAAM4H,KAAI,IAAI,IAAIJ,OAAI,QAAA,CAAS;AAC/B,EAAAI,GAAE,IAAI,KAAK5H,OAAAA;AACX,SAAO4H;AACV;AAOD,IAAa8B,OAAM,CAAClC,QAAK,QAAQ;AAC7B,QAAMI,KAAI,IAAI,IAAIJ,OAAI,QAAA,CAAS;AAC/B,EAAAI,GAAE,OAAO,GAAA;AACT,SAAOA;AACV;ACtDD,IAAaP,aAAY,CAAC,cAAc;AACpC,MAAI,cAAc,OACd,QAAOA,WAAU,CAAE,CAAA;AACvB,MAAI,MAAM,QAAQ,SAAA,EACd,QAAOA,WAAUrE,KAAI,oBAAI,IAAA,GAAO,GAAG,SAAA,CAAU;AACjD,QAAM,OAAO;AACb,SAAO;IACH,KAAK,IAAI,eAAe;AACpB,YAAM6D,KAAI7D,KAAI,MAAM,GAAG,UAAA;AACvB,aAAOqE,WAAUR,EAAA;IACpB;IACD,KAAK,CAAC,KAAK7G,YAAU;AACjB,YAAM6G,KAAIgB,KAAI,MAAM,KAAK7H,OAAAA;AACzB,aAAOqH,WAAUR,EAAA;IACpB;IACD,KAAK,CAAC,QAAQ,KAAK,IAAI,GAAA;IACvB,QAAQ,CAAC,QAAQQ,WAAUqC,KAAI,MAAM,GAAA,CAAI;IAEzC,OAAO,MAAMrC,WAAA;IACb,KAAK,CAAC,QAAQ,KAAK,IAAI,GAAA;IACvB,SAAS,MAAM,KAAK,QAAA;IACpB,QAAQ,MAAM,KAAK,OAAA;IACnB,SAAS,MAAM,KAAK,SAAS;EAChC;AACJ;AC/CD,IAAaxG,WAAU,IAAI,SAAS;AAEhC,MAAIwH,KAAIrF,KAAI,oBAAI,IAAA,GAAO,GAAG,IAAA;AAC1B,SAAO;IACH,KAAK,IAAI+G,WAAS;AACd,MAAA1B,KAAIrF,KAAIqF,IAAG,GAAG0B,MAAAA;IACjB;IACD,QAAQ,CAAC,QAAQ;AACb,MAAA1B,KAAIqB,KAAIrB,IAAG,GAAA;IACd;IACD,OAAO,MAAM;AACT,MAAAA,KAAIrF,KAAI,oBAAI,IAAA,CAAA;IACf;IACD,KAAK,CAAC,KAAKhD,YAAU;AACjB,MAAAqI,KAAIR,KAAIQ,IAAG,KAAKrI,OAAAA;IACnB;IACD,KAAK,CAAC,QAAQqI,GAAE,IAAI,GAAA;IACpB,SAAS,MAAMA,GAAE,QAAA;IACjB,QAAQ,MAAMA,GAAE,OAAA;IAChB,SAAS,MAAMA,GAAE,SAAS;IAC1B,KAAK,CAAC,QAAQyB,KAAIzB,IAAG,GAAA;EACxB;AACJ;ACrCD,IAAa2B,oBAAb,cAAsC,mBAAmB;EACrD,OAAO,oBAAI,IAAA;EACX;EACA;EACA,YAAY,MAAM,OAAO,CAAE,GAAE;AACzB,UAAA;AACA,SAAK,OAAO;AACZ,SAAK,UAAU,KAAK,WAAW;EAClC;;;;EAID,IAAI,WAAW;AACX,WAAO,KAAK,KAAK;EACpB;;;;EAID,IAAI,aAAa;AACb,WAAO,KAAKC,KAAK;EACpB;;;;EAID,IAAI,YAAY;AACZ,QAAI5B,KAAI;AACR,eAAW1H,MAAK,KAAKsJ,KAAK,OAAA,EACtB,CAAA5B,KAAI,KAAK,IAAIA,IAAG,KAAK,KAAK,MAAM1H,EAAA,CAAE;AAEtC,WAAO0H;EACV;EACD,cAAc;AACV,UAAM,OAAO,CAAC,GAAG,KAAK4B,KAAK,KAAA,CAAO;AAClC,QAAI3E,KAAI,SAAS,KAAK,KAAK,IAAI,CAAC;;AAChC,eAAW2C,MAAK,MAAM;AAClB,YAAMtH,KAAI,KAAKsJ,KAAK,IAAIhC,EAAA;AACxB,UAAItH,OAAM,OACN,CAAA2E,MAAK,MAAM2C,EAAA;;WAEV;AACD,cAAMiC,WAAU,KAAK,KAAK,QAAQvJ,EAAA;AAClC,YAAIuJ,aAAY,OACZ,CAAA5E,MAAK,MAAM2C,EAAA,KAAM,KAAK,KAAK,MAAMtH,EAAA,CAAE,OAAO,KAAK,UAAUuJ,QAAA,CAAQ;;MAExE;IACJ;AAED,WAAO5E;EACV;EACD,IAAI,UAAU;AACV,WAAO,KAAK2E,KAAK,SAAS;EAC7B;EACD,QAAQ;AACJ,SAAKA,KAAK,MAAA;AACV,UAAM,UAAU,SAAS,IAAA;EAC5B;EACD,eAAe,QAAQ9D,SAAQ;AAC3B,UAAM0B,SAAM,KAAKoC,KAAK,IAAI,GAAA;AAC1B,QAAIpC,WAAQ,QAAW;AACnB,WAAKoC,KAAK,IAAI,KAAK,KAAK,KAAK,eAAe,QAAW9D,OAAA,CAAO;AAC9D,YAAM,UAAU,YAAY,EAAO,IAAK,CAAA;AACxC,YAAM,UAAU,eAAe,EAAU,QAAAA,QAAQ,CAAA;IACpD,OACI;AACD,WAAK8D,KAAK,IAAI,KAAK,KAAK,KAAK,eAAepC,QAAK1B,OAAA,CAAO;AACxD,YAAM,UAAU,eAAe,EAAU,QAAAA,QAAQ,CAAA;IACpD;EACJ;EACD,IAAI,KAAKA,SAAQ;AACb,SAAK,eAAe,KAAK,GAAGA,OAAA;AAC5B,WAAO;EACV;EACD,YAAYA,SAAQ;AAChB,eAAWxF,MAAKwF,QACZ,MAAK,eAAe,KAAK,QAAQxF,EAAA,GAAIA,EAAA;EAC5C;EACD,YAAY,KAAKX,SAAO,IAAI;AACxB,UAAMqI,KAAI,KAAK4B,KAAK,IAAI,GAAA;AACxB,QAAI5B,OAAM,OACN,QAAO;AACX,WAAO,KAAK,KAAK,IAAIA,IAAGrI,SAAO,EAAA;EAClC;EACD,IAAI,KAAK;AACL,WAAO,KAAKiK,KAAK,IAAI,GAAA;EACxB;EACD,eAAe,KAAKjK,SAAO;AACvB,UAAMoB,KAAI,KAAK6I,KAAK,IAAI,GAAA;AACxB,QAAI7I,OAAM,OACN,QAAO;AACX,WAAO,KAAK,sBAAsBA,IAAG,KAAKpB,OAAAA;EAC7C;EACD,sBAAsBwH,QAAK,KAAKxH,SAAO;AACnC,UAAM,WAAW,KAAK,KAAK,MAAMwH,MAAAA;AACjC,UAAM,WAAW,KAAK,KAAK,QAAQA,QAAKxH,OAAAA;AACxC,UAAM,YAAY,SAAS;AAC3B,SAAKiK,KAAK,IAAI,KAAK,KAAK,KAAK,eAAe,QAAW,QAAA,CAAS;AAChE,WAAO,WAAW;EACrB;EACD,cAAcjK,SAAO;AACjB,QAAI,YAAY;AAChB,KAAC,GAAG,KAAKiK,KAAK,KAAA,CAAO,EAAC,OAAO,CAAC,QAAQ;AAClC,YAAM7I,KAAI,KAAK6I,KAAK,IAAI,GAAA;AACxB,UAAI,CAAC7I,GACD,OAAM,IAAI,MAAM,gCAAgC;AACpD,UAAI,KAAK,sBAAsBA,IAAG,KAAKpB,OAAAA,GAAQ;AAC3C,oBAAY;AAEZ,YAAI,KAAK,MAAM,GAAA,MAAS,EACpB,MAAK,OAAO,GAAA;MACnB;IACJ,CAAA;AACD,WAAO;EACV;EACD,OAAO,KAAK;AACR,UAAMoB,KAAI,KAAK6I,KAAK,IAAI,GAAA;AACxB,QAAI7I,OAAM,OACN,QAAO;AACX,SAAK6I,KAAK,OAAO,GAAA;AACjB,SAAK,UAAU,aAAa,EAAO,IAAK,CAAA;AACxC,WAAO;EACV;EACD,gBAAgBjK,SAAO,KAAK,gBAAgB;AACxC,UAAM,OAAO,CAAC,GAAG,KAAKiK,KAAK,KAAA,CAAO;AAClC,UAAM,QAAQ,KAAK,KAAK,CAAC,QAAQ;AAC7B,YAAM7I,KAAI,KAAK6I,KAAK,IAAI,GAAA;AACxB,UAAI7I,OAAM,OACN,OAAM,IAAI,MAAM,gCAAgC;AACpD,YAAMkE,KAAI,KAAK,KAAK,IAAIlE,IAAGpB,SAAO,EAAA;AAClC,aAAOsF;IACV,CAAA;AACD,WAAO;EACV;EACD,MAAM,KAAK;AACP,UAAM,QAAQ,KAAK2E,KAAK,IAAI,GAAA;AAC5B,QAAI,UAAU,OACV,QAAO;AACX,WAAO,KAAK,KAAK,MAAM,KAAA;EAC1B;;;;;EAKD,CAAC,IAAI,KAAK;AACN,UAAM5B,KAAI,KAAK4B,KAAK,IAAI,GAAA;AACxB,QAAI5B,OAAM,OACN;AACJ,WAAO,KAAK,KAAK,SAASA,EAAA;EAC7B;;;;;;;EAOD,CAAC,UAAU,KAAK;AACZ,UAAMA,KAAI,KAAK4B,KAAK,IAAI,GAAA;AACxB,QAAI5B,OAAM,OACN;AACJ,WAAO,KAAK,KAAK,SAASA,EAAA;EAC7B;EACD,UAAU,KAAK;AACX,WAAO,KAAK4B,KAAK,IAAI,GAAA;EACxB;EACD,CAAC,OAAO;AACJ,WAAO,KAAKA,KAAK,KAAA;EAEpB;EACD,CAAC,cAAc;AACX,eAAW,SAAS,KAAKA,KAAK,QAAA,EAC1B,YAAWtJ,MAAK,KAAK,KAAK,SAAS,MAAM,CAAA,CAAA,EACrC,OAAM,CAAC,MAAM,CAAA,GAAIA,EAAE;EAG9B;EACD,CAAC,aAAa;AACV,eAAW,SAAS,KAAKsJ,KAAK,QAAA,EAC1B,QAAO,KAAK,KAAK,SAAS,MAAM,CAAA,CAAA;EAEvC;EACD,CAAC,UAAU;AACP,eAAW,CAAChC,IAAGtH,EAAA,KAAM,KAAKsJ,KAAK,QAAA,GAAW;AACtC,YAAM,YAAY,CAAC,GAAG,KAAK,KAAK,SAAStJ,EAAA,CAAG;AAC5C,YAAM,CAACsH,IAAG,SAAU;IACvB;EACJ;EACD,CAAC,gBAAgB;AACb,eAAW,OAAO,KAAK,KAAA,EACnB,OAAM,CAAC,KAAK,KAAK,MAAM,GAAA,CAAK;EAEnC;EACD,MAAM,OAAO;AACT,eAAW,OAAO,MAAM,KAAA,GAAQ;AAC5B,YAAM,OAAO,MAAM,IAAI,GAAA;AACvB,WAAK,eAAe,KAAK,GAAG,IAAA;IAC/B;EACJ;EACD,IAAI,OAAO;AACP,WAAO,KAAKgC,KAAK;EACpB;EACD,KAAK,OAAO,WAAA,IAAe;AACvB,WAAO,KAAKA,KAAK,OAAO,WAAA;EAC3B;AACJ;ACjLD,IAAaE,gBAAe,CAAC,YAAY;AACrC,QAAM,OAAO,SAAS,QAAQ;AAC9B,QAAM,WAAW,CAAC/I,IAAGC,OAAM,KAAKD,EAAA,MAAO,KAAKC,EAAA;AAC5C,QAAMjB,KAAI;IACN,IAAI,OAAO;AACP,aAAO;IACV;IACD,UAAU,CAAC,WAAW,OAAO,OAAA;IAC7B,gBAAgB,CAAC,MAAM+F,YAAWiE,SAAY,MAAM,MAAM,QAAQ,GAAGjE,OAAA;IACrE,OAAO,CAAC,WAAW,OAAO;IAC1B,MAAM,CAAC,QAAQ,cAAckE,UAAa,QAAQ,SAAA;IAClD,QAAQ,CAAC,QAAQ,cAAcC,aAAgB,QAAQ,SAAA;IACvD,SAAS,CAAC,WAAWC,QAAW,MAAA;IAChC,KAAK,CAAC,QAAQvK,YAAUwK,YAAe,QAAQxK,SAAO,QAAA;IACtD,SAAS,CAAC,QAAQA,YAAU,QAAQuK,QAAW,MAAA,GAASvK,SAAO,QAAA;EAClE;AACD,QAAMqI,KAAI,IAAI2B,kBAAiB5J,IAAG,OAAA;AAClC,SAAOiI;AACV;AC3BD,IAAaoC,qBAAoB,CAAC,YAAY;AAC1C,QAAM,WAAW;AACjB,QAAMrK,KAAI;IACN,IAAI,OAAO;AACP,aAAO;IACV;IACD,gBAAgB,CAAC,aAAa+F,YAAW;AACrC,UAAIlG,MAAK,eAAe,IAAIJ,eAAc,QAAQ,QAAA;AAClD,iBAAWc,MAAKwF,QACZ,CAAAlG,MAAKA,IAAG,IAAIU,EAAA;AAEhB,aAAOV;IACV;IACD,OAAO,CAAC,WAAW,OAAO;IAC1B,MAAM,CAAC,QAAQ,cAAc,OAAO,KAAK,SAAA;IACzC,QAAQ,CAAC,QAAQ,cAAc,OAAO,OAAO,SAAA;IAC7C,SAAS,CAAC,WAAW;IACrB,UAAU,CAAC,WAAW,OAAO,OAAA;IAC7B,KAAK,CAAC,QAAQD,YAAU,OAAO,KAAK,CAACW,OAAM,SAASA,IAAGX,OAAAA,CAAM,MAAM;IACnE,SAAS,CAAC,QAAQA,YAAU,OAAO,OAAO,CAACW,OAAM,CAAC,SAASA,IAAGX,OAAAA,CAAM;EACvE;AACD,SAAO,IAAIgK,kBAAiB5J,IAAG,OAAA;AAClC;ACPD,IAAasK,aAAb,cAA+B,IAAI;EAC/B;EACA,YAAY,eAAe,GAAG;AAC1B,UAAA;AACA,SAAK,eAAe;EACvB;EACD,IAAI,KAAK;AACL,UAAM/J,KAAI,MAAM,IAAI,GAAA;AACpB,QAAIA,OAAM,OACN,QAAO,KAAK;AAChB,WAAOA;EACV;EACD,MAAM,KAAK;AACP,UAAM,IAAI,KAAK,KAAK,YAAA;AACpB,WAAO,KAAK;EACf;EACD,SAAS,KAAK,QAAQ;AAClB,UAAMA,KAAI,MAAM,IAAI,GAAA;AACpB,QAAIX,UAAQW,MAAK,KAAK;AACtBX,eAAS;AACT,UAAM,IAAI,KAAKA,OAAAA;AACf,WAAOA;EACV;EACD,IAAI,KAAK,SAAS,GAAG;AACjB,UAAMW,KAAI,MAAM,IAAI,GAAA;AACpB,QAAIX,UAAQW,MAAK,KAAK;AACtBX,eAAS;AACT,UAAM,IAAI,KAAKA,OAAAA;AACf,WAAOA;EACV;EACD,SAAS,KAAK,SAAS,GAAG;AACtB,UAAMW,KAAI,MAAM,IAAI,GAAA;AACpB,QAAIX,UAAQW,MAAK,KAAK;AACtBX,eAAS;AACT,UAAM,IAAI,KAAKA,OAAAA;AACf,WAAOA;EACV;AACJ;AC3CD,IAAa2K,kBAAiB,CAAC,UAAU,CAAE,MAAK;AAc5C,QAAMC,mBAAkB,QAAQ;AAChC,QAAM,mBAAmB,OAAOA,qBAAoB,cAAc,iBAAiB,CAACxJ,IAAGC,OAAMuJ,iBAAgBxJ,EAAA,MAAOwJ,iBAAgBvJ,EAAA;AACpI,QAAM,WAAW,QAAQ,YAAY;AACrC,QAAMjB,KAAI;IACN,IAAI,OAAO;AACP,aAAO;IACV;IACD,gBAAgB,CAAC,aAAa+F,YAAW;AACrC,UAAI,gBAAgB,OAChB,QAAO,CAAC,GAAGA,OAAO;AACtB,aAAO,CAAC,GAAG,aAAa,GAAGA,OAAO;IACrC;IACD,UAAU,CAAC,WAAW,OAAO,OAAA;IAC7B,OAAO,CAAC,WAAW,OAAO;IAC1B,MAAM,CAAC,QAAQ,cAAc,OAAO,KAAK,CAAAvB,OAAK,UAAUA,EAAA,CAAE;IAC1D,QAAQ,CAAC,QAAQ,cAAc,OAAO,OAAO,CAAAA,OAAK,UAAUA,EAAA,CAAE;IAC9D,SAAS,CAAC,WAAW;IACrB,KAAK,CAAC,QAAQ5E,YAAU,OAAO,KAAK,CAACW,OAAM,SAASA,IAAGX,OAAAA,CAAM;IAC7D,SAAS,CAAC,QAAQA,YAAU,OAAO,OAAO,CAACW,OAAM,CAAC,SAASA,IAAGX,OAAAA,CAAM;EAEvE;AACD,QAAMqI,KAAI,IAAI2B,kBAAiB5J,IAAG,OAAA;AAClC,SAAOiI;AACV;AC/DD,IAAawC,eAAb,MAAaA,qBAAoBvB,iBAAgB;EAC7C,eAAe,QAAQnD,SAAQ;AAG3B,WAAO,KAAK,SAAS,CAAC,CAAC,KAAKA,OAAO,CAAC,CAAA;EACvC;EACD,YAAYA,SAAQ;AAChB,UAAM,YAAYA,QAAO,IAAI,CAACxF,OAAM,CAAC,KAAK,QAAQA,EAAA,GAAIA,EAAE,CAAA;AACxD,WAAO,KAAK,SAAS,SAAA;EACxB;EAED,SAASwD,WAAS;AAEd,UAAM,YAAY,IAAI,IAAI,CAAC,GAAG,KAAK,IAAI,QAAA,CAAU,EAAC,IAAI,CAAC+E,OAAM,CAACA,GAAE,CAAA,GAAI,CAAC,GAAGA,GAAE,CAAA,CAAG,CAAC,CAAA,CAAC;AAC/E,eAAW,CAAC,KAAK,IAAA,KAAS/E,WAAS;AAE/B,YAAM,eAAe,UAAU,IAAI,GAAA;AACnC,UAAI,OAAO,iBAAiB,YAGxB,WAAU,IAAI,KAAK,IAAA;UAInB,cAAa,KAAK,GAAG,IAAA;IAE5B;AACD,WAAO,IAAI0G,aAAY,KAAK,SAAS,KAAK,SAAS,CAAC,GAAG,UAAU,QAAA,CAAU,CAAA;EAC9E;EACD,QAAQ;AACJ,WAAO,IAAIA,aAAY,KAAK,SAAS,KAAK,OAAA;EAC7C;EACD,eAAe,MAAM,QAAQ;AACzB,UAAM,IAAI,MAAM,yBAAyB;EAC5C;EACD,cAAc7K,SAAO,IAAI;AACrB,UAAMmE,YAAU,CAAC,GAAG,KAAK,IAAI,QAAA,CAAU;AACvC,UAAM,aAAa,MAAM,KAAK;AAC9B,UAAMyD,KAAIzD,UAAQ,IAAI,CAAC,UAAU;AAC7B,YAAM,MAAM,MAAM,CAAA;AAClB,YAAMgC,UAAS,MAAM,CAAA,EAAG,OAAO,CAAC,OAAO,CAAC,WAAW,IAAInG,OAAAA,CAAM;AAC7D,aAAO,CAAC,KAAKmG,OAAO;IACvB,CAAA;AACD,WAAO,IAAI0E,aAAY,KAAK,SAAS,KAAK,SAASjD,EAAA;EACtD;EACD,OAAO,KAAK;AACR,UAAMzD,YAAU,CAAC,GAAG,KAAK,IAAI,QAAA,CAAU,EAAC,OAAO,CAAC+E,OAAMA,GAAE,CAAA,MAAO,GAAA;AAC/D,WAAO,IAAI2B,aAAY,KAAK,SAAS,KAAK,SAAS1G,SAAAA;EACtD;AACJ;AAmBD,IAAa2G,YAAW,CAACvB,WAAU,cAAc,UAAW,mBAAoB,IAAIsB,aAAYtB,UAAS,OAAA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AErEzG,IAAawB,SAAb,MAAmB;EACf,OAAO,CAAE;EACT,YAAY,CAAE;EACd,YAAY,CAAE;;;;EAId,kBAAkB;;;;;;;;;EASlB,oBAAoB,OAAO;AACvB,eAAW,CAAC,OAAOC,EAAA,KAAM,KAAK,UAAU,QAAA,EACpC,KAAIA,OAAM,MACN,QAAO;EAElB;;;;;;;;;EASD,iBAAiB,OAAO;AACpB,eAAW,CAAC,OAAOA,EAAA,KAAM,KAAK,UAAU,QAAA,EACpC,KAAIA,OAAM,MACN,QAAO;EAElB;;;;EAID,QAAQ;AACJ,YAAQ,MAAM,CAAC,GAAG,KAAK,qBAAA,CAAuB,CAAA;EACjD;;;;;;;;;;;;;;;;;;;;;;EAsBD,UAAU;AACN,UAAM1F,KAAI,CAAE;AACZ,eAAW,OAAO,KAAK,KACnB,KAAI,QAAQ,OACR,CAAAA,GAAE,KAAK,CAAE,CAAA;QAET,CAAAA,GAAE,KAAK,CAAC,GAAG,GAAI,CAAA;AAEvB,WAAOA;EACV;;;;EAID,IAAI,WAAW;AACX,WAAO,KAAK,KAAK;EACpB;;;;EAID,IAAI,cAAc;AACd,WAAO,KAAK;EAGf;;;;;EAKD,CAAC,uBAAuB;AACpB,aAAS,QAAQ,GAAG,QAAQ,KAAK,KAAK,QAAQ,SAAS;AACnD,YAAM,cAAc,KAAK,uBAAuB,KAAA;AAChD,YAAM;IACT;EACJ;;;;;EAKD,CAAC,sBAAsB;AACnB,aAAS,QAAQ,GAAG,QAAQ,KAAK,KAAK,QAAQ,SAAS;AACnD,YAAM,cAAc,KAAK,sBAAsB,KAAA;AAC/C,YAAM;IACT;EACJ;;;;;EAKD,gBAAgB,QAAQ;AACpB,SAAK,YAAY;EACpB;;;;;;;EAOD,YAAY,aAAa,OAAO;AAC5B,SAAK,UAAU,WAAA,IAAe;EACjC;;;;;EAKD,aAAa,QAAQ;AACjB,SAAK,YAAY;EACpB;;;;;;;EAOD,SAAS,UAAU,OAAO;AACtB,SAAK,UAAU,QAAA,IAAY;EAC9B;;;;;EAKD,aAAa,MAAM;AACf,SAAK,kBAAkB,KAAK,IAAI,KAAK,iBAAiB,KAAK,MAAA;AAC3D,SAAK,KAAK,KAAK,IAAA;AACf,WAAO;EACV;;;;;;EAMD,sBAAsB,UAAU;AAC5B,UAAM,MAAM,KAAK,KAAK,GAAG,QAAA;AACzB,QAAI,QAAQ,OACR,QAAO;AACX,WAAO,IAAI,IAAI,CAACtF,SAAO,UAAU,CAAC,KAAK,UAAU,GAAG,KAAA,GAAQA,OAAM,CAAA;EACrE;;;;;;;;;;;;EAYD,uBAAuB,UAAU;AAC7B,UAAM,MAAM,KAAK,KAAK,GAAG,QAAA;AACzB,QAAI,QAAQ,OACR,QAAO;AACX,UAAM,SAAS,CAAE;AACjB,aAAS,QAAQ,GAAG,QAAQ,KAAK,UAAU,QAAQ,SAAS;AACxD,YAAM,QAAQ,KAAK,UAAU,GAAG,KAAA,KAAU,MAAM,SAAA;AAChD,aAAO,KAAA,IAAS,IAAI,KAAA;IACvB;AACD,WAAO;EACV;;;;;;EAMD,mBAAmB,KAAK;AACpB,UAAM,QAAQ,OAAO,QAAQ,WAAW,MAAM,KAAK,iBAAiB,GAAA;AAEpE,QAAI,UAAU,OACV,QAAO;MAAE,SAAS;MAAO,OAAO;IAAsB;AAE1D,QAAI,QAAQ,EACR,QAAO;MAAE,SAAS;MAAO,OAAO;IAAqB;AAEzD,QAAI,QAAQ,KAAK,KAAK,OAClB,QAAO;MAAE,SAAS;MAAM,OAAO,KAAK,KAAK,KAAA;IAAQ;AAErD,UAAM,SAAS,CAAE;AACjB,SAAK,KAAK,KAAA,IAAS;AACnB,WAAO;MAAE,SAAS;MAAM,OAAO;IAAQ;EAC1C;;;;;;EAMD,IAAI,KAAK;AACL,UAAMsF,KAAI,KAAK2F,WAAW,GAAA;AAC1B,QAAI,cAAc3F,EAAA,EACd,OAAM,IAAI,MAAMA,GAAE,KAAA;AAEtB,WAAO,CAAC,GAAGA,GAAE,KAAM;EACtB;;;;;;;;EAQD,IAAI,KAAK,QAAQtF,SAAO;AACpB,UAAM,SAAS,KAAKkL,mBAAmB,GAAA;AACvC,QAAI,cAAc,MAAA,EACd,OAAM,IAAI,MAAM,OAAO,KAAA;AAE3B,UAAM5F,KAAI,OAAO;AACjB,UAAM,cAAc,OAAO,WAAW,WAAW,SAAS,KAAK,oBAAoB,MAAA;AACnF,QAAI,OAAO,gBAAgB,YACvB,OAAM,IAAI,MAAM,iBAAiB,MAAA,2BAAiC;AACtE,QAAI,cAAc,EACd,OAAM,IAAI,MAAM,uCAAuC;AAE3D,IAAAA,GAAE,WAAA,IAAetF;EACpB;;;;;;;;EAQD,IAAI,KAAK,QAAQ;AACb,UAAM,OAAO,KAAKiL,WAAW,GAAA;AAC7B,QAAI,cAAc,IAAA,EACd,OAAM,IAAI,MAAM,KAAK,KAAA;AACzB,UAAM,OAAO,KAAKE,cAAc,KAAK,OAAO,MAAA;AAC5C,QAAI,cAAc,IAAA,EACd,OAAM,IAAI,MAAM,KAAK,KAAA;AACzB,WAAO,KAAK,MAAM;EACrB;EACD,WAAW,KAAK;AACZ,QAAI,QAAQ;AACZ,QAAI,OAAO,QAAQ,SACf,SAAQ;SAEP;AACD,cAAQ,KAAK,iBAAiB,GAAA;AAC9B,UAAI,OAAO,UAAU,SACjB,QAAO;QAAE,OAAO;QAAsB,SAAS;MAAO;IAC7D;AACD,QAAI,OAAO,UAAU,SACjB,QAAO;MAAE,OAAO;MAAe,SAAS;IAAO;AACnD,QAAI,QAAQ,KAAK,SAAS,KAAK,KAAK,OAChC,QAAO;MAAE,OAAO;MAA0B,SAAS;IAAO;AAC9D,WAAO;MAAE,SAAS;MAAM,OAAO,KAAK,KAAK,KAAA;IAAQ;EACpD;EACD,cAAc,KAAK,QAAQ;AACvB,UAAM,WAAW,OAAO,WAAW,WAAW,SAAS,KAAK,oBAAoB,MAAA;AAChF,QAAI,OAAO,aAAa,SACpB,QAAO;MAAE,SAAS;MAAO,OAAO;IAAsB;AAC1D,QAAI,WAAW,KAAK,YAAY,IAAI,OAChC,QAAO;MAAE,SAAS;MAAO,OAAO;IAA0B;AAC9D,WAAO;MACH,SAAS;MAAM,OAAO;QAAE,OAAO;QAAU,OAAO,IAAI,QAAA;MAAW;IAClE;EACJ;;;;;;;;;;;EAWD,OAAO,KAAKnL,SAAOY,SAAQ;AAEvB,UAAM,YAAY,KAAKsK,mBAAmB,GAAA;AAC1C,QAAI,cAAc,SAAA,EACd,OAAM,IAAI,MAAM,UAAU,KAAA;AAE9B,UAAM5F,KAAI,UAAU;AACpB,UAAM,QAAQ,OAAO1E,YAAW,WAAWA,UAAS,KAAK;AACzD,aAAS,eAAe,GAAG,eAAe,OAAO,eAC7C,CAAA0E,GAAE,YAAA,IAAgBtF;AAEtB,WAAOsF;EACV;AACJ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AClSD,IAAa8F,kBAAe,CAAC,OAAO;AAChC,SAAO;IACH;IACA,KAAK,CAAE;EACV;AACJ;AAYD,SAAgBC,QAAOC,SAAO,KAAK;AAC/B,cAAYC,WAAUD,OAAAA,CAAM;AAC5B,SAAOA,QAAM,SAAS,IAAI,GAAA;AAC7B;AAaD,SAAgBE,KAAIF,SAAO,KAAK;AAC5B,cAAYC,WAAUD,OAAAA,CAAM;AAC5B,cAAY,WAAW,KAAK,aAAa,KAAK,CAAC;AAC/C,SAAOA,QAAM,SAAS,IAAI,GAAA;AAC7B;AAaD,SAAgBG,qBAAkBH,SAAO;AACrC,cAAYC,WAAUD,OAAAA,CAAM;AAC5B,QAAM3K,KAAI,CAAC,GAAG2K,QAAM,SAAS,OAAA,CAAS;AAEtC,QAAM,QAAQ,IAAIP,OAAA;AAClB,QAAM,aAAa,GAAGpK,GAAE,IAAI,CAAA,OAAM,GAAG,EAAA,CAAG;AACxC,QAAM,UAAU,GAAGA,GAAE,IAAI,CAAA,OAAM,GAAG,EAAA,CAAG;AAMrC,WAAS+K,KAAI,GAAGA,KAAI/K,GAAE,QAAQ+K,MAAK;AAE/B,UAAM,OAAOA,IAAG,OAAO/K,GAAE,MAAA;AACzB,UAAMgL,MAAKhL,GAAE+K,EAAA;AAEb,eAAW,CAACE,IAAG,EAAA,KAAOjL,GAAE,QAAA,EACpB,KAAIgL,IAAG,IAAI,KAAK,CAAAE,OAAKA,GAAE,OAAO,GAAG,EAAA,EAE7B,OAAM,IAAIH,IAAGE,IAAG,IAAA;EAG3B;AACD,SAAO;AACV;AAMD,IAAaE,eAAY,CAACR,YAAU;AAChC,QAAM,QAAQS,qBAAkBT,OAAAA;AAChC,SAAO,MAAM,KAAK;CAAI;AACzB;AAMD,IAAMS,uBAAoB,CAACT,YAAU;AACjC,QAAMhG,KAAI,CAAE;AACZ,QAAM0G,aAAY,cAAcV,UAASA,QAAM,SAAS,OAAA,IAAWA;AACnE,aAAW3K,MAAKqL,YAAU;AAEtB,UAAM,MAAMC,iBAAgBtL,EAAA;AAC5B,IAAA2E,GAAE,KAAK,GAAG,IAAI,IAAI,CAAAvD,UAAQ,IAAIA,KAAA,EAAM,CAAC;EACxC;AACD,SAAOuD;AACV;AAOD,IAAa4G,YAAW,CAACZ,SAAO,SAAS;AACrC,MAAI,KAAK,WAAW,OAChB,QAAO,KAAK;AAChB,SAAO;AACV;AAKD,UAAiBa,OAAMb,SAAO;AAC1B,cAAYC,WAAUD,OAAAA,CAAM;AAC5B,QAAMU,aAAW,CAAC,GAAGV,QAAM,SAAS,OAAA,CAAS;AAC7C,aAAW,UAAUU,WACjB,YAAW,QAAQ,OAAO,IACtB,OAAM;AAGjB;AAKD,UAAiBA,UAASV,SAAO;AAC7B,cAAYC,WAAUD,OAAAA,CAAM;AAC5B,QAAMU,aAAW,CAAC,GAAGV,QAAM,SAAS,OAAA,CAAS;AAC7C,aAAW,UAAUU,WACjB,OAAM;AAEb;AACD,SAAST,WAAUa,IAAG,gBAAgB,SAAS;AAC3C,MAAIA,OAAM,OACN,QAAO;IAAE,SAAS;IAAO,OAAO,UAAU,aAAA;EAA+C;AAC7F,MAAIA,OAAM,KACN,QAAO;IAAE,SAAS;IAAO,OAAO,UAAU,aAAA;EAA0C;AACxF,MAAI,OAAOA,OAAM,UACb;QAAI,EAAE,cAAcA,IAChB,QAAO;MACH,SAAS;MAAO,OAAO,UAAU,aAAA;IACpC;EAAC,MAGN,QAAO;IAAE,SAAS;IAAO,OAAO,UAAU,aAAA,aAA0B,OAAOA,EAAA;EAAgC;AAE/G,SAAO;IAAE,SAAS;IAAM,OAAOA;EAAG;AACrC;AAYD,UAAiBC,oBAAiBf,SAAO,SAAS;AAC9C,cAAYC,WAAUD,OAAAA,CAAM;AAC5B,MAAI,YAAY,OACZ;AACJ,QAAM,SAAS,OAAO,YAAY,WAAWA,QAAM,SAAS,IAAI,OAAA,IAAW;AAC3E,MAAI,WAAW,OACX,OAAM,IAAI,MAAM,oBAAoB,KAAK,UAAU,OAAA,CAAQ,EAAE;AACjE,aAAW,QAAQ,OAAO,KAAK;AAC3B,UAAM,QAAQA,QAAM,SAAS,IAAI,KAAK,EAAA;AACtC,QAAI,UAAU,OACV,OAAM,IAAI,MAAM,0BAA0B,KAAK,EAAA,EAAI;AACvD,UAAM;EACT;AACJ;AAUD,IAAagB,gBAAe,CAAC,QAAQ,kBAAkB;AACnD,MAAI,WAAW,OACX,QAAO;AACX,QAAM,QAAQ,OAAO,kBAAkB,WAAW,gBAAgB,cAAc;AAChF,SAAO,OAAO,IAAI,KAAK,CAAA,SAAQ,KAAK,OAAO,KAAA;AAC9C;AAOD,IAAaC,aAAY,CAACjB,SAAO,WAAW;AACxC,cAAYC,WAAUD,OAAAA,CAAM;AAC5B,QAAM,UAAU,OAAO,WAAW,WAAWA,QAAM,SAAS,IAAI,MAAA,IAAU;AAC1E,MAAI,YAAY,OACZ,QAAO;AACX,SAAO,QAAQ,IAAI,WAAW;AACjC;AASD,IAAakB,eAAc,CAAClB,SAAO,WAAW,kBAAkB;AAC5D,cAAYC,WAAUD,OAAAA,CAAM;AAC5B,QAAM,UAAUmB,iBAAcnB,SAAO,MAAA;AACrC,QAAM,OAAO,cAAc,IAAI,CAAAO,OAAKY,iBAAcnB,SAAOO,EAAA,CAAE;AAC3D,MAAI,KAAK,WAAW,QAAQ,IAAI,OAE5B,QAAO;AAEX,aAAW,OAAO,KAEd,KAAI,CAACa,QAAOpB,SAAO,SAAS,GAAA,EAExB,QAAO;AAGf,SAAO;AACV;AAQD,IAAaoB,UAAS,CAACpB,SAAO,QAAQ,kBAAkB;AACpD,cAAYC,WAAUD,OAAAA,CAAM;AAC5B,QAAM,UAAUmB,iBAAcnB,SAAO,MAAA;AACrC,QAAM,QAAQ,OAAO,kBAAkB,WAAW,gBAAgB,cAAc;AAChF,SAAO,QAAQ,IAAI,KAAK,CAAA,SAAQ,KAAK,OAAO,KAAA;AAC/C;AAaD,IAAaqB,iBAAc,CAACrB,SAAO,OAAO;AACtC,cAAYC,WAAUD,OAAAA,CAAM;AAC5B,QAAM3K,KAAI2K,QAAM,SAAS,IAAI,EAAA;AAC7B,MAAI3K,OAAM,OACN,QAAO;IAAE,OAAA;IAAO,QAAQA;EAAG;AAC/B,QAAM,KAAKyK,gBAAa,EAAA;AACxB,QAAM,KAAKwB,qBAAkBtB,SAAO,EAAA;AACpC,SAAO;IAAE,OAAO;IAAI,QAAQ;EAAI;AACnC;AAOD,IAAauB,aAAY,CAACvB,SAAO,OAAO;AACpC,cAAYC,WAAUD,OAAAA,CAAM;AAC5B,QAAM3K,KAAI2K,QAAM,SAAS,IAAI,EAAA;AAC7B,MAAI3K,OAAM,OACN,OAAM,IAAI,MAAM,WAAW,EAAA,sBAAwB;AACvD,SAAOA;AACV;AAOD,IAAaiM,uBAAoB,CAACtB,SAAO,WAAW;AAChD,cAAYC,WAAUD,OAAAA,CAAM;AAC5B,QAAMwB,MAAK;IACP,GAAGxB;IACH,UAAUA,QAAM,SAAS,IAAI,OAAO,IAAI,MAAA;EAC3C;AACD,SAAOwB;AACV;AAOD,IAAaC,mBAAkB,CAACzB,SAAO,SAAS;AAC5C,MAAI,KAAK,WAAW,OAChB,QAAO,KAAK;AAChB,SAAO;AACV;AAUD,SAAgB0B,YAAW1B,SAAO2B,OAAMC,MAAI;AACxC,cAAY3B,WAAUD,OAAAA,CAAM;AAC5B,QAAM,QAAQmB,iBAAcnB,SAAO2B,KAAA;AACnC,QAAM,MAAMR,iBAAcnB,SAAO4B,IAAAA;AACjC,SAAOR,QAAOpB,SAAO,OAAO,GAAA,IAAOsB,qBAAkBtB,SAAO;IACxD,GAAG;IACH,KAAK,MAAM,IAAI,OAAO,CAAAlL,OAAKA,GAAE,OAAO,IAAI,EAAA;EAC3C,CAAA,IAAIkL;AACR;AAUD,SAAgB6B,aAAU7B,SAAO2B,OAAMC,MAAIE,SAAQ;AAC/C,cAAY7B,WAAUD,OAAAA,CAAM;AAC5B,QAAM,aAAaqB,eAAYrB,SAAO2B,KAAA;AACtC3B,YAAQ,WAAW;AACnB,QAAM,WAAWqB,eAAYrB,SAAO4B,IAAAA;AACpC5B,YAAQ,SAAS;AACjB,QAAM,OAAO;IACT,IAAI4B;IACJ,QAAAE;EACH;AACD,MAAI,CAACV,QAAOpB,SAAO,WAAW,QAAQ,SAAS,MAAA,EAC3CA,WAAQsB,qBAAkBtB,SAAO;IAC7B,GAAG,WAAW;IAEd,KAAK,CAAC,GAAG,WAAW,OAAO,KAAK,IAAK;EACxC,CAAA;AAEL,SAAO;IAAE,OAAA;IAAO;EAAM;AACzB;AAYD,SAAgB+B,WAAQ/B,SAAO,SAAS;AACpC,MAAI,OAAOA,YAAU,SACjB,OAAM,IAAI,UAAU,gEAAgE,OAAOA,OAAAA,EAAO;AACtG,MAAI,OAAO,YAAY,SACnB,OAAM,IAAI,UAAU,iEAAiE,OAAO,OAAA,EAAS;AACzG,QAAM,SAASgC,oBAAiBhC,SAAO,OAAA;AACvC,SAAO,OAAO;AACjB;AAYD,SAAgBgC,oBAAiBhC,SAAO,SAAS;AAC7C,cAAYC,WAAUD,OAAAA,CAAM;AAC5B,QAAM,EAAE,IAAA,MAAI,QAAA8B,SAAQ,MAAAH,MAAA,IAAS;AAC7B,QAAM,OAAO,QAAQ,QAAQ;AAC7B,QAAM,SAAS,MAAM,QAAQC,IAAAA,IAAMA,OAAK,CAACA,IAAG;AAC5C,QAAMf,WAAQ,CAAE;AAEhB,aAAW,YAAY,QAAQ;AAC3B,UAAM,SAASgB,aAAU7B,SAAO2B,OAAM,UAAUG,OAAA;AAChD9B,cAAQ,OAAO;AACfa,IAAAA,SAAM,KAAK,OAAO,IAAA;EACrB;AACD,MAAI,CAAC,KACD,QAAO;IAAE,OAAA;IAAO,OAAAoB;EAAO;AAG3B,aAAW,YAAY,QAAQ;AAC3B,UAAM,SAASJ,aAAU7B,SAAO,UAAU2B,OAAMG,OAAA;AAChD9B,cAAQ,OAAO;AACfa,IAAAA,SAAM,KAAK,OAAO,IAAA;EACrB;AACD,SAAO;IAAE,OAAA;IAAO,OAAAoB;EAAO;AAC1B;AAMD,IAAMtB,mBAAkB,CAACtL,OAAM;AAC3B,QAAM2E,KAAI,CACN3E,GAAE,EACL;AACD,QAAM6M,kBAAgB,CAAC,SAAS,KAAK,WAAW,SAAY,KAAK,KAAK,GAAG,KAAK,EAAA,KAAO,KAAK,MAAA;AAI1F,aAAW,QAAQ7M,GAAE,IACjB,CAAA2E,GAAE,KAAK,OAAOkI,gBAAc,IAAA,CAAK,EAAE;AAEvC,MAAI7M,GAAE,IAAI,WAAW,EACjB,CAAA2E,GAAE,CAAA,KAAM;AACZ,SAAOA;AACV;AAQD,SAAgBmI,aAAYnC,SAAOlK,IAAGC,IAAG;AACrC,cAAYkK,WAAUD,OAAAA,CAAM;AAC5B,MAAIoB,QAAOpB,SAAOlK,IAAGC,GAAE,EAAA,EACnB,QAAO;AACX,MAAIqL,QAAOpB,SAAOjK,IAAGD,GAAE,EAAA,EACnB,QAAO;AACd;AAQD,SAASqL,iBAAcnB,SAAO,YAAY;AACtC,cAAYC,WAAUD,OAAAA,CAAM;AAC5B,MAAI,eAAe,OACf,OAAM,IAAI,MAAM,4DAA4D;AAChF,QAAM3K,KAAI,OAAO,eAAe,WAAW2K,QAAM,SAAS,IAAI,UAAA,IAAc;AAC5E,MAAI3K,OAAM,OACN,OAAM,IAAI,MAAM,gBAAgB,UAAA,EAAY;AAChD,SAAOA;AACV;AAQD,UAAiB+M,KAAIpC,SAAO,iBAAiB,kBAAkB;AAC3D,cAAYC,WAAUD,OAAAA,CAAM;AAC5B,QAAM,QAAQmB,iBAAcnB,SAAO,eAAA;AACnC,QAAM,SAAS,qBAAqB,SAAY,SAAYmB,iBAAcnB,SAAO,gBAAA;AACjF,QAAM,QAAQ,IAAI5K,cAAA;AAClB,QAAM,OAAO,oBAAI,IAAA;AACjB,QAAM,QAAQ,KAAA;AACd,SAAO,CAAC,MAAM,SAAS;AACnB,UAAMC,KAAI,MAAM,QAAA;AAChB,UAAMA;AACN,QAAI,WAAW,UAAa,WAAWA,GACnC;AACJ,eAAW,QAAQ0L,oBAAiBf,SAAO3K,EAAA,EACvC,KAAI,CAAC,KAAK,IAAI,KAAK,EAAA,GAAK;AACpB,WAAK,IAAI,KAAK,EAAA;AACd,YAAM,QAAQ8L,iBAAcnB,SAAO,KAAK,EAAA,CAAG;IAC9C;EAER;AACJ;AAMD,UAAiBqC,KAAIrC,SAAO,iBAAiB;AACzC,cAAYC,WAAUD,OAAAA,CAAM;AAC5B,QAAM,SAASmB,iBAAcnB,SAAO,eAAA;AACpC,QAAMzE,KAAI,IAAI5F,cAAA;AACd,QAAM,OAAO,oBAAI,IAAA;AACjB,EAAA4F,GAAE,KAAK,MAAA;AACP,SAAO,CAACA,GAAE,SAAS;AACf,UAAMlG,KAAIkG,GAAE,IAAA;AACZ,QAAIlG,OAAM,OACN;AACJ,QAAI,CAAC,KAAK,IAAIA,GAAE,EAAA,GAAK;AACjB,WAAK,IAAIA,GAAE,EAAA;AACX,YAAMA;AACN,iBAAW,QAAQA,GAAE,KAAK;AACtB,cAAM,cAAc2K,QAAM,SAAS,IAAI,KAAK,EAAA;AAC5C,YAAI,YACA,CAAAzE,GAAE,KAAK,WAAA;MAEd;IACJ;EACJ;AACJ;AAOD,IAAa+G,gBAAe,CAACtC,SAAO,eAAe;AAC/C,cAAYC,WAAUD,OAAAA,CAAM;AAC5B,QAAM,SAAS,OAAO,eAAe,WAAWA,QAAM,SAAS,IAAI,UAAA,IAAc;AACjF,MAAI,WAAW,OACX,OAAM,IAAI,MAAM,yBAAyB;AAC7C,QAAM,YAAY,oBAAI,IAAA;AACtB,QAAM,WAAW,oBAAI,IAAA;AACrB,YAAU,IAAI,OAAO,IAAI,CAAA;AACzB,QAAM,KAAK,IAAIpD,iBAAA;AACf,QAAM8D,aAAW,CAAC,GAAGV,QAAM,SAAS,OAAA,CAAS;AAC7C,aAAW3K,MAAKqL,YAAU;AACtB,QAAIrL,GAAE,OAAO,OAAO,IAAI;AACpB,gBAAU,IAAIA,GAAE,IAAI,OAAO,gBAAA;AAC3B,eAAS,IAAIA,GAAE,IAAI,IAAA;IACtB;AACD,OAAG,oBAAoBA,GAAE,IAAI,OAAO,gBAAA;EACvC;AACD,SAAO,CAAC,GAAG,SAAS;AAChB,UAAMkN,KAAI,GAAG,WAAA;AACb,QAAIA,OAAM,OACN,OAAM,IAAI,MAAM,+BAA+B;AACnD,UAAM,UAAUvC,QAAM,SAAS,IAAIuC,EAAA;AACnC,eAAW,aAAa,QAAQ,KAAK;AAEjC,YAAM,MAAM,UAAU,IAAIA,EAAA,IAAK3B,UAASZ,SAAO,SAAA;AAC/C,UAAI,MAAM,UAAU,IAAI,UAAU,EAAA,GAAK;AACnC,kBAAU,IAAI,UAAU,IAAI,GAAA;AAC5B,iBAAS,IAAI,UAAU,IAAI,OAAA;AAC3B,WAAG,eAAe,UAAU,IAAI,KAAK,IAAA;MACxC;IACJ;EACJ;AACD,QAAM,SAAS,CAAC,OAAO;AACnB,UAAMrG,QAAO,CAAE;AACf,WAAO,MAAM;AACT,UAAI,OAAO,OAAO,GACd;AACJ,YAAMtE,KAAI,SAAS,IAAI,EAAA;AACvB,UAAIA,OAAM,UAAaA,OAAM,KACzB,OAAM,IAAI,MAAM,mBAAmB,EAAA,EAAI;AAC3C,MAAAsE,MAAK,KAAK;QAAE;QAAI,QAAQ,UAAU,IAAI,EAAA;MAAK,CAAA;AAC3C,WAAKtE,GAAE;IACV;AACD,WAAOsE;EACV;AACD,SAAO;IACH;IAAW;IAAU;EACxB;AACJ;AAMD,IAAa6I,SAAQ,CAACxC,YAAU;AAC5B,cAAYC,WAAUD,OAAAA,CAAM;AAC5B,QAAMc,KAAI,EACN,UAAU2B,WAAa,CAAC,GAAGzC,QAAM,SAAS,QAAA,CAAU,CAAA,EACvD;AACD,SAAOc;AACV;AAiBD,IAAad,WAAQ,IAAI,uBAAuB;AAC5C,MAAIc,KAAI,EACJ,UAAU2B,WAAAA,EACb;AACD,aAAWC,OAAM,mBACb,CAAA5B,KAAIiB,WAAQjB,IAAG4B,GAAA;AAEnB,SAAO5B;AACV;AAKD,SAAgB6B,WAAU3C,SAAO;AAC7B,cAAYC,WAAUD,OAAAA,CAAM;AAC5B,QAAM,SAAS4C,WAAU5C,OAAAA;AACzB,SAAO,OAAO,WAAW;AAC5B;AAMD,SAAgB6C,iBAAgB7C,SAAO;AACnC,cAAYC,WAAUD,OAAAA,CAAM;AAC5B,QAAM,YAAY,IAAIZ,WAAU,CAAA;AAEhC,aAAW,QAAQyB,OAAMb,OAAAA,EACrB,WAAU,IAAI,KAAK,IAAI,CAAA;AAG3B,QAAM,QAAQ,IAAI5K,cAAA;AAClB,MAAI,cAAc;AAClB,aAAW,UAAUsL,UAASV,OAAAA,GAAQ;AAClC,QAAI,UAAU,IAAI,OAAO,EAAA,MAAQ,EAC7B,OAAM,QAAQ,MAAA;AAElB;EACH;AACD,QAAM,WAAW,CAAE;AACnB,SAAO,CAAC,MAAM,SAAS;AAEnB,UAAMuC,KAAI,MAAM,QAAA;AAChB,aAAS,KAAKA,EAAA;AAEd,eAAW,aAAaA,GAAE,KAAK;AAC3B,YAAM,SAAS,UAAU,SAAS,UAAU,IAAI,CAAA;AAChD,UAAI,WAAW,EACX,OAAM,QAAQvC,QAAM,SAAS,IAAI,UAAU,EAAA,CAAG;IAErD;EACJ;AACD,MAAI,SAAS,WAAW,YACpB,OAAM,IAAI,MAAM,uBAAuB;AAE3C,SAAO8C,mBAAkB,QAAA;AAC5B;AAMD,SAAgBA,mBAAkBpC,YAAU;AACxC,QAAM,YAAA,MAAqBA,YAAU,CAAApH,OAAK;AACtC,WAAO,CAACA,GAAE,IAAIA,EAAE;EACnB,CAAA;AACD,QAAMyD,KAAI0F,WAAa,CAAC,GAAG,SAAU,CAAA;AACrC,SAAO,EACH,UAAU1F,GACb;AACJ;AAOD,SAAgB6F,WAAU5C,SAAO;AAC7B,cAAYC,WAAUD,OAAAA,CAAM;AAC5B,MAAI,QAAQ;AACZ,QAAM,QAAQ,IAAIrK,cAAA;AAClB,QAAM+K,aAAW,oBAAI,IAAA;AACrB,QAAM,MAAM,CAAE;AACd,aAAWrL,MAAK2K,QAAM,SAAS,OAAA,EAC3BU,YAAS,IAAIrL,GAAE,IAAI;IACf,GAAGA;IACH,SAAS;IACT,OAAO;IACP,SAAS;EACZ,CAAA;AAEL,QAAM,gBAAgB,CAAC,WAAW;AAC9B,WAAO,QAAQ;AACf,WAAO,UAAU;AACjB;AACA,UAAM,KAAK,MAAA;AACX,WAAO,UAAU;AACjB,eAAW,QAAQ,OAAO,KAAK;AAC3B,YAAM,QAAQqL,WAAS,IAAI,KAAK,EAAA;AAChC,UAAI,OAAO,MAAM,MAAM,KAAA,GAAQ;AAC3B,sBAAc,KAAA;AACd,eAAO,UAAU,KAAK,IAAI,OAAO,SAAS,MAAM,OAAA;MACnD,WACQ,MAAM,QACX,QAAO,UAAU,KAAK,IAAI,OAAO,SAAS,MAAM,OAAA;IAEvD;AACD,QAAI,OAAO,YAAY,OAAO,OAAO;AACjC,YAAM,oBAAoB,CAAE;AAC5B,UAAIqC;AACJ,aAAO,WAAWA,IAAG;AACjB,QAAAA,KAAI,MAAM,IAAA;AACV,QAAAA,GAAE,UAAU;AACZ,0BAAkB,KAAK;UAAE,IAAIA,GAAE;UAAI,KAAKA,GAAE;QAAK,CAAA;MAClD;AACD,UAAI,kBAAkB,SAAS,EAC3B,KAAI,KAAK,iBAAA;IAChB;EACJ;AACD,aAAW1N,MAAKqL,WAAS,OAAA,EACrB,KAAI,OAAO,MAAMrL,GAAE,KAAA,EACf,eAAcA,EAAA;AAGtB,SAAO;AACV;AAOD,SAAgB2N,qBAAoBhD,SAAO;AACvC,cAAYC,WAAUD,OAAAA,CAAM;AAC5B,aAAWuC,MAAK7B,UAASV,OAAAA,EACrB,YAAW3K,MAAK0L,oBAAiBf,SAAOuC,EAAA,EACpC,YAAW,MAAMF,KAAIrC,SAAO3K,EAAA,GAAI;AAC5B,QAAIA,GAAE,OAAO,GAAG,GACZ;AACJ,QAAI+L,QAAOpB,SAAOuC,IAAG,EAAA,GAAK;AACtB,YAAMzB,KAAIY,YAAW1B,SAAOuC,IAAG,EAAA;AAC/B,aAAOS,qBAAoBlC,EAAA;IAC9B;EACJ;AAGT,SAAOd;AACV;;;;;;;;;;;;;;;;;AC1uBD,IAAaF,gBAAe,CAAC,OAAO;AAChC,SAAO,EACH,GACH;AACJ;AACD,IAAawB,qBAAoB,CAACtB,SAAO,WAAW;AAChD,QAAMwB,MAAK;IACP,GAAGxB;IACH,UAAUA,QAAM,SAAS,IAAI,OAAO,IAAI,MAAA;EAC3C;AACD,SAAOwB;AACV;AACD,IAAaH,eAAc,CAACrB,SAAO,OAAO;AACtC,QAAM3K,KAAI2K,QAAM,SAAS,IAAI,EAAA;AAC7B,MAAI3K,OAAM,OACN,QAAO;IAAE,OAAA;IAAO,QAAQA;EAAG;AAC/B,QAAM,KAAKyK,cAAa,EAAA;AACxB,QAAM,KAAKwB,mBAAkBtB,SAAO,EAAA;AACpC,SAAO;IAAE,OAAO;IAAI,QAAQ;EAAI;AACnC;AACD,SAASmB,eAAcnB,SAAO,YAAY;AACtC,MAAI,eAAe,OACf,OAAM,IAAI,MAAM,4DAA4D;AAChF,MAAIA,YAAU,OACV,OAAM,IAAI,MAAM,4CAA4C;AAChE,QAAM3K,KAAI,OAAO,eAAe,WAAW2K,QAAM,SAAS,IAAI,UAAA,IAAc;AAC5E,MAAI3K,OAAM,OACN,OAAM,IAAI,MAAM,gBAAgB,UAAA,EAAY;AAChD,SAAOA;AACV;AASD,IAAa4N,iBAAgB,CAACjD,SAAOlK,IAAGC,OAAM;AAC1C,QAAM,OAAOmN,eAAclD,SAAOlK,IAAGC,EAAA;AACrC,SAAO,SAAS;AACnB;AAUD,IAAamN,iBAAgB,CAAClD,SAAOlK,IAAGC,OAAM;AAC1C,MAAID,OAAM,OACN,OAAM,IAAI,MAAM,mDAAmD;AACvE,MAAIC,OAAM,OACN,OAAM,IAAI,MAAM,mDAAmD;AACvE,MAAIiK,YAAU,OACV,OAAM,IAAI,MAAM,4CAA4C;AAChE,QAAMmD,MAAKhC,eAAcnB,SAAOlK,EAAA;AAChC,QAAM,KAAKqL,eAAcnB,SAAOjK,EAAA;AAChC,aAAW,QAAQiK,QAAM,OAAO;AAC5B,QAAI,KAAK,KAAKmD,IAAG,MAAM,KAAK,MAAM,GAAG,GACjC,QAAO;AACX,QAAI,KAAK,KAAK,GAAG,MAAM,KAAK,MAAMA,IAAG,GACjC,QAAO;EACd;AACD;AACH;AAUD,SAAgBtB,WAAU7B,SAAOlK,IAAGC,IAAG+L,SAAQ;AAC3C,QAAM,UAAUT,aAAYrB,SAAOlK,EAAA;AACnCkK,YAAQ,QAAQ;AAChB,QAAM,UAAUqB,aAAYrB,SAAOjK,EAAA;AACnCiK,YAAQ,QAAQ;AAChB,MAAI,OAAOkD,eAAclD,SAAOlK,IAAGC,EAAA;AACnC,MAAI,SAAS,OACT,QAAO;IAAE,OAAA;IAAO;EAAM;AAC1B,SAAO;IACH,GAAAD;IACA,GAAAC;IACA,QAAA+L;EACH;AACD,QAAM,eAAe;IACjB,GAAG9B;IACH,OAAO,CAAC,GAAGA,QAAM,OAAO,IAAK;EAChC;AACD,SAAO;IAAE,OAAO;IAAc;EAAM;AACvC;AAgBD,SAAgB+B,SAAQ/B,SAAO,SAAS;AACpC,QAAM,SAASgC,kBAAiBhC,SAAO,OAAA;AACvC,SAAO,OAAO;AACjB;AAiBD,SAAgBgC,kBAAiBhC,SAAO,SAAS;AAC7C,QAAM,EAAE,GAAAlK,IAAG,QAAAgM,SAAQ,GAAA/L,GAAA,IAAM;AACzB,QAAM,eAAe,MAAM,QAAQA,EAAA,IAAKA,KAAI,CAACA,EAAE;AAC/C,QAAM8K,WAAQ,CAAE;AAChB,aAAW,eAAe,cAAc;AACpC,UAAM,SAASgB,WAAU7B,SAAOlK,IAAG,aAAagM,OAAA;AAChD9B,cAAQ,OAAO;AACfa,IAAAA,SAAM,KAAK,OAAO,IAAA;EACrB;AACD,SAAO;IAAE,OAAA;IAAO,OAAAoB;EAAO;AAC1B;AACD,IAAajC,SAAQ,IAAI,uBAAuB;AAC5C,MAAIc,KAAI;IACJ,UAAU2B,WAAAA;IACV,OAAO,CAAE;EACZ;AACD,aAAWC,OAAM,mBACb,CAAA5B,KAAIiB,SAAQjB,IAAG4B,GAAA;AAEnB,SAAO5B;AACV;AACD,SAAgBX,mBAAkBH,SAAO;AACrC,QAAM3K,KAAI,CAAC,GAAG2K,QAAM,SAAS,OAAA,CAAS;AACtC,QAAM,QAAQ,IAAIP,OAAA;AAClB,QAAM,aAAa,GAAGpK,GAAE,IAAI,CAAA,OAAM,GAAG,EAAA,CAAG;AACxC,QAAM,UAAU,GAAGA,GAAE,IAAI,CAAA,OAAM,GAAG,EAAA,CAAG;AAErC,WAAS+K,KAAI,GAAGA,KAAI/K,GAAE,QAAQ+K,MAAK;AAC/B,UAAM,OAAOA,IAAG,OAAO/K,GAAE,MAAA;AACzB,UAAMgL,MAAKhL,GAAE+K,EAAA;AAEb,eAAW,CAACE,IAAG,EAAA,KAAOjL,GAAE,QAAA,GAAW;AAC/B,YAAM,YAAY4N,eAAcjD,SAAOK,KAAI,EAAA;AAC3C,UAAI,UACA,OAAM,IAAID,IAAGE,IAAG,IAAA;IAEvB;EACJ;AACD,SAAO;AACV;AAMD,IAAaE,aAAY,CAACR,YAAU;AAChC,QAAM,QAAQS,mBAAkBT,OAAAA;AAChC,SAAO,MAAM,KAAK;CAAI;AACzB;AAMD,IAAMS,qBAAoB,CAACT,YAAU;AACjC,QAAMhG,KAAI,CAAE;AACZ,EAAAA,GAAE,KAAK,aAAa,CAAC,GAAGgG,QAAM,SAAS,OAAA,CAAS,EAAC,IAAI,CAAA3K,OAAKA,GAAE,EAAA,EAAI,KAAK,IAAI,CAAC,EAAE;AAC5E,EAAA2E,GAAE,KAAK,QAAQ;AACf,aAAW,QAAQgG,QAAM,MACrB,CAAAhG,GAAE,KAAKkI,eAAc,IAAA,CAAK;AAE9B,SAAOlI;AACV;AACD,IAAMkI,iBAAgB,CAAC,SAAS;AAC5B,QAAMJ,UAAS,KAAK,SAAS,KAAK,KAAK,MAAA,MAAY;AACnD,SAAO,GAAG,KAAK,CAAA,QAAS,KAAK,CAAA,GAAIA,OAAA;AACpC;AAOD,UAAiBf,kBAAiBf,SAAO,SAAS;AAC9C,MAAI,YAAY,OACZ;AACJ,QAAM,SAAS,OAAO,YAAY,WAAWA,QAAM,SAAS,IAAI,OAAA,IAAW;AAC3E,MAAI,WAAW,OACX,OAAM,IAAI,MAAM,oBAAoB,KAAK,UAAU,OAAA,CAAQ,EAAE;AACjE,aAAW,QAAQA,QAAM,MACrB,KAAI,KAAK,MAAM,QACX,OAAMmB,eAAcnB,SAAO,KAAK,CAAA;WAC3B,KAAK,MAAM,QAChB,OAAMmB,eAAcnB,SAAO,KAAK,CAAA;AAE3C;AACD,UAAiBoD,gBAAepD,SAAO,SAAS;AAC5C,MAAI,YAAY,OACZ;AACJ,QAAM,SAAS,OAAO,YAAY,WAAWA,QAAM,SAAS,IAAI,OAAA,IAAW;AAC3E,MAAI,WAAW,OACX,OAAM,IAAI,MAAM,oBAAoB,KAAK,UAAU,OAAA,CAAQ,EAAE;AACjE,aAAW,QAAQA,QAAM,MACrB,KAAI,KAAK,MAAM,QACX,OAAM;WACD,KAAK,MAAM,QAChB,OAAM;AAEjB;;;;;;;;;;;;;;;;;;;;;;;;;AGpND,IAAM,UAAU,CAAClL,IAAG,eAAe,OAAO;AACtC,MAAI,OAAOA,OAAM,YAAY,UAAUA,MAAKA,GAAE,SAAS,OACnD,QAAOA,GAAE;AACb,SAAO;AACV;AAED,UAAiB,eAAeA,IAAG,YAAY;AAC3C,MAAI,OAAO,eAAe,YACtB,cAAa,QAAQA,EAAA;AAEzB,aAAW,CAAC,OAAOyB,EAAA,KAAM,QAAQzB,EAAA,EAC7B,OAAM,CAACyB,IAAG,UAAW;AAEzB,aAAW,CAAC,OAAOA,EAAA,KAAM,QAAQzB,EAAA,GAAI;AACjC,UAAM,OAAO,QAAQyB,IAAG,GAAG;AAC3B,UAAM,SAAS,WAAW,SAAS,IAAI,aAAa,MAAM,OAAO;AACjE,WAAO,eAAeA,IAAG,MAAA;EAC5B;AACJ;AAED,UAAiB,aAAazB,IAAG,YAAY;AACzC,MAAI,OAAO,eAAe,YACtB,cAAa,QAAQA,EAAA;AAEzB,aAAW,CAAC,OAAOyB,EAAA,KAAM,QAAQzB,EAAA,GAAI;AACjC,UAAM,CAACyB,IAAG,UAAW;AACrB,UAAM,OAAO,QAAQA,IAAG,GAAG;AAC3B,UAAM,SAAS,WAAW,SAAS,IAAI,aAAa,MAAM,OAAO;AACjE,WAAO,eAAeA,IAAG,MAAA;EAC5B;AACJ;AAED,SAAS,UAAUA,IAAG;AAClB,SAAOA,GAAE,QAAQ;AACpB;AAED,SAAS,UAAUA,IAAG;AAClB,SAAOA,GAAE,QAAQ;AACpB;AAED,UAAU,QAAQA,IAAG;AACjB,MAAI,UAAUA,EAAA,EACV,QAAOA,GAAE,IAAI,QAAA;WAER,UAAUA,EAAA,EACf,QAAOA,GAAE,IAAI,QAAA;WAER,OAAOA,OAAM,UAAU;EAE/B,MAEG,OAAM,IAAI,UAAU,2CAA2C;AAEtE;ACzBD,IAAa8M,SAAQ,OAAO,UAE5B,iBAAiB;AACb,QAAM,OAAO,OAAO,iBAAiB,WAAW,EAAE,QAAQ,aAAc,IAAG;AAC3E,QAAM,YAAY,KAAK,SAAS;AAChC,MAAI,cAAc,YAAY,cAAc,OACxC,OAAM,MAAM,IAAA;AAEhB,QAAMrJ,KAAI,QAAQ,QAAQ,MAAM,SAAA,CAAU;AAC1C,MAAI,cAAc,WAAW,cAAc,OACvC,OAAM,MAAM,IAAA;AAEhB,SAAOA;AACV;AA2FD,gBAAgB,qBAAqB;AACjC,MAAIsJ;AACJ,MAAI3L,KAAI,IAAI,QAAQ,CAACqC,OAAOsJ,YAAUtJ,EAAA;AACtC,MAAI,QAAQ;AACZ,QAAM,WAAW,MAAM;AACnB,QAAIsJ,UACAA,WAAAA;AACJ,IAAA3L,KAAI,IAAI,QAAQ,CAACqC,OAAOsJ,YAAUtJ,EAAA;EACrC;AACD,MAAI;AACA,WAAO,MAAM;AACT,cAAQ,WAAW,sBAAsB,QAAA;AAEzC,YAAMuJ,KAAI,MAAM5L;AAChB,YAAM4L;IACT;EACJ,UAAA;AAEG,QAAID,UACAA,WAAAA;AACJ,eAAW,qBAAqB,KAAA;EACnC;AACJ;AAqCD,gBAAuB,UAAUE,WAAS;AACtC,QAAM,YAAY,aAAaA,SAAAA;AAC/B,MAAI,OAAO,cAAc,YACrB,OAAM,IAAI,MAAM,sBAAsB;AAC1C,MAAI,YAAY,EACZ,OAAM,IAAI,MAAM,2BAA2B;AAC/C,MAAI,cAAc,EACd,QAAO,OAAO,mBAAA;AAClB,MAAIF;AACJ,MAAI3L,KAAI,IAAI,QAAQ,CAACqC,OAAOsJ,YAAUtJ,EAAA;AACtC,MAAI;AACJ,QAAM,WAAW,MAAM;AACnB,QAAIsJ,UACAA,WAAAA;AACJ,IAAA3L,KAAI,IAAI,QAAQ,CAACqC,OAAOsJ,YAAUtJ,EAAA;EACrC;AACD,MAAI;AACA,WAAO,MAAM;AACT,cAAQ,WAAW,WAAW,UAAU,SAAA;AAExC,YAAMuJ,KAAI,MAAM5L;AAChB,YAAM4L;IACT;EACJ,UAAA;AAEG,QAAID,UACAA,WAAAA;AACJ,QAAI,UAAU,OACV,YAAW,aAAa,KAAA;AAC5B,YAAQ;EACX;AACJ;AC/LD,IAAa,UAAU,CAAC,UAAU/F,cAAa;AAC3C,MAAI,aAAa,OACb,OAAM,IAAI,MAAM,iCAAiC;AAErD,QAAM,aAAa,aAAaA,SAAA;AAChC,cAAY,YAAY,YAAY,aAAa,UAAU,CAAC;AAC5D,MAAI;AACJ,MAAI,YAAY;AAChB,MAAI,aAAa;AACjB,MAAI,kBAAkB;AACtB,MAAI,QAAQ;AACZ,QAAMkG,SAAQ,MAAM;AAChB,gBAAY;AACZ,eAAW,aAAa,KAAA;AACxB,YAAQ;EACX;AACD,QAAM,QAAQ,OAAO,cAAclG,WAAU,SAAS;AAClD,UAAM5F,KAAI,IAAI,QAAQ,CAAC2L,WAAS,WAAW;AACvC,kBAAY,YAAY,IAAA;AACxB,YAAM,eAAe,aAAa,WAAA;AAClC,YAAMI,MAAK,YAAY,cAAc,aAAa,cAAc;AAChE,UAAI,cAAcA,GAAA,GAAK;AACnB,eAAO,cAAcA,GAAA,CAAG;AACxB;MACH;AACD,cAAQ,OAAR;QACI,KAAK,aAAa;AAEd,iBAAA;AACA;QACH;QACD,KAAK;AAED;MAEP;AACD,cAAQ;AAER,cAAQ,WAAW,WAAW,YAAY;AACtC,YAAI,UAAU,aAAa;AACvB,kBAAQ,KAAK,2DAA2D;AACxE,UAAAD,OAAA;AACA;QACH;AACD,cAAM,QAAQ,QAAQ,CAAE;AACxB;AACA;AACA,gBAAQ;AACR,cAAM,SAAS,YAAY,IAAA,IAAQ,WAAW,GAAG,KAAA;AACjD,gBAAQ;AACR,QAAAA,OAAA;AACAH,kBAAAA;MACH,GAAE,YAAA;IACN,CAAA;AACD,WAAO3L;EACV;AACD,QAAM,SAAS,MAAM;AACjB,QAAI,UAAU,OACV;AACJ,IAAA8L,OAAA;EACH;AACD,SAAO;IACH;IACA;IACA,IAAI,WAAW;AACX,aAAO;IACV;IACD,IAAI,aAAa;AACb,aAAO;IACV;IACD,IAAI,kBAAkB;AAClB,aAAO;IACV;EACJ;AACJ;AC7DD,IAAaE,YAAW,CAAC,UAAUpG,cAAa;AAC5C,QAAMzI,KAAI,QAAQ,UAAUyI,SAAA;AAC5B,SAAO,IAAI,SAAS;AAAE,IAAAzI,GAAE,MAAM,QAAW,IAAA;EAAQ;AACpD;ACnDD,IAAa,eAAb,MAA0B;EACtB;EACA,WAAW;EACX,MAAM,KAAK,MAAM,KAAK,OAAA,IAAW,GAAA;EACjC,cAAc;AACV,SAAK8O,YAAY,CAAE;EACtB;;;;;EAKD,UAAU;AACN,WAAO,KAAKA,UAAU,WAAW;EACpC;;;;;;;;;;;EAWD,IAAI,SAAS,UAAU,CAAE,GAAE;AACvB,SAAKC;AACL,UAAM,OAAO,QAAQ,QAAQ;AAC7B,UAAM9M,UAAO;MACT,IAAI,GAAG,KAAK+M,GAAAA,MAAS,KAAKD,QAAAA;MAC1B;MACA;IACH;AACD,SAAKD,UAAU,KAAK7M,OAAAA;AACpB,WAAOA,QAAK;EACf;;;;;;EAMD,OAAO,IAAI;AACP,UAAMzB,UAAS,KAAKsO,UAAU;AAC9B,SAAKA,YAAY,KAAKA,UAAU,OAAO,CAAA,YAAW,QAAQ,OAAO,EAAA;AACjE,WAAO,KAAKA,UAAU,WAAWtO;EACpC;;;;;EAKD,OAAOZ,SAAO;AACV,eAAW,WAAW,KAAKkP,WAAW;AAClC,cAAQ,QAAQlP,OAAAA;AAChB,UAAI,QAAQ,KACR,MAAK,OAAO,QAAQ,EAAA;IAE3B;EACJ;;;;EAID,QAAQ;AACJ,SAAKkP,YAAY,CAAE;EACtB;AACJ;ACpDD,IAAa,WAAW,CAAC,KAAK,aAAa;AACvC,cAAY,YAAY,KAAK,YAAY,KAAK,CAAC;AAC/C,MAAI,UAAU;AACd,SAAO,CAAC,SAAS;AACb;AACA,QAAI,YAAY,KAAK;AACjB,gBAAU;AACV,UAAI,SACA,UAAS,IAAA;AACb,aAAO;IACV;AACD,WAAO;EACV;AACJ;AC8BD,IAAaG,OAAM,OAAO,aAAa,OAAO,CAAE,GAAE,SAAS;AACvD,QAAM,UAAU,CAAE;AAClB,QAAM,kBAAkB,KAAK,QAAQ;AACrC,MAAI,mBAAmB,MAAM,QAAQ,WAAA,IAC9B,cACD,CAAC,WAAY;AACnB,MAAI,KAAK,QACL,oBAAmB,QAAQ,gBAAA;AAC/B,WAAS,QAAQ,GAAG,QAAQ,iBAAiB,QAAQ,SAAS;AAC1D,UAAM,MAAM,iBAAiB,KAAA;AAC7B,QAAI/J;AACJ,QAAI,OAAO,QAAQ,WAEf,CAAAA,KAAI,MAAM,IAAI,IAAA;QAGd,CAAAA,KAAI;AAER,QAAIA,OAAM,QAAW;AACjB,cAAQ,KAAKA,EAAA;AACb,cAAQ,KAAK,eAAA;IAChB;AACD,QAAI,OAAO,KAAK,SAAS,aACrB;UAAI,KAAK,KAAKA,IAAG,OAAA,EACb;IACH;EAER;AACD,MAAI,KAAK,OACL,QAAO,QAAQ,OAAO,KAAK,MAAA;AAE/B,SAAO;AACV;AAWD,IAAa,YAAY,OAAO,aAAa,OAAO,CAAE,GAAE,SAAS;AAC7D,QAAM,UAAU,MAAM+J,KAAI,aAAa,MAAM,IAAA;AAC7C,MAAI,CAAC,QACD;AACJ,MAAI,QAAQ,WAAW,EACnB;AACJ,QAAMC,MAAK,KAAK,MAAM;AACtB,SAAO,QAAQ,GAAGA,GAAA;AACrB;ACtGD,IAAa,YAAY,CAAC,QAAQ,YAAY,UAAU,CAAE,MAAK;AAC3D,QAAM,aAAa,QAAQ,aAAa;AACxC,QAAM,SAAS,QAAQ;AACvB,MAAI,YAAY;AAChB,MAAI,WAAW;AACf,MAAIR;AACJ,QAAM,UAAU,IAAI,QAAQ,CAACF,WAAS,WAAW;AAC7C,UAAM,UAAU,CAACW,WAAU;AACvB,UAAI,UAAUA,OACV,KAAI,WAAW,SAASA,OAAM,IAAA,GAAO;AACjC,oBAAY;AACZX,kBAAQW,MAAA;AACR,gBAAA;MACH,MAEG,SAAQ,KAAK,yBAAyBA,OAAM,IAAA,4BAAgC;WAG/E;AACD,gBAAQ,KAAK,2DAA2D;AACxE,gBAAQ,IAAIA,MAAA;MACf;IACJ;AACD,eAAW,QAAQ,WACf,QAAO,iBAAiB,MAAM,OAAA;AAElC,UAAM,UAAU,MAAM;AAClB,UAAI,SACA;AACJ,UAAIT,cAAY,OACZ,cAAaA,SAAAA;AACjBA,kBAAU;AACV,iBAAW;AACX,iBAAW,QAAQ,WACf,QAAO,oBAAoB,MAAM,OAAA;IAExC;AACDA,gBAAU,WAAW,MAAM;AACvB,UAAI,aAAa,SACb;AACJ,cAAA;AACA,aAAO,oBAAI,MAAM,wDAAwD,KAAK,UAAU,UAAA,CAAW,cAAc,UAAA,EAAY,CAAA;IAChI,GAAE,UAAA;AACH,YAAQ,iBAAiB,SAAS,MAAM;AACpC,UAAI,aAAa,SACb;AACJ,cAAA;AACA,aAAO,oBAAI,MAAM,yBAAyB,OAAO,MAAA,EAAQ,CAAA;IAC5D,CAAA;EACJ,CAAA;AACD,SAAO;AACV;AC9CD,IAAa,qBAAqB,CAAC,YAAY;AAC3C,QAAMU,WAAU,mBAAA;AAChB,QAAM,KAAK,YAAY;IACnB,GAAG;IACH,YAAY,CAACtD,gBAAa;AACtB,MAAAsD,SAAQtD,WAAAA;IACX;IACD,WAAW;AACP,aAAO,QAAQ,WAAW;IAC7B;EACJ,CAAA;AACD,SAAO,CAACvL,OAAM;AACV,OAAGA,EAAA;AACH,WAAO6O,SAAA;EACV;AACJ;AC/BD,IAAa,WAAb,cAA8B,mBAAmB;EAC7C;EACA;EACA;EACA;EACA;EACA;;;;;;EAMA,YAAY,KAAK,UAAU;AACvB,UAAA;AACA,SAAK,MAAM;AACX,SAAK,WAAW;AAChB,SAAK,cAAc,YAAY,IAAA;AAC/B,SAAK,QAAQ,SAAS;AACtB,SAAK,qBAAqB,KAAK,MAAM;AACrC,SAAK,SAAS;AACd,SAAK,MAAM,IAAI,IAAI,sBAAsB,KAAK,GAAA,EAAK;EACtD;;;;;EAKD,WAAW;AACP,QAAI,KAAK,WACL,QAAO;AACX,WAAO,oBAAoB,KAAK,MAAA,aAAmB,YAAY,IAAA,IAAQ,KAAK,WAAA,UAAqB,KAAK,UAAU,KAAK,SAAS,IAAA,CAAK;EACtI;;;;;EAKD,YAAY;AACR,QAAI,KAAK,WAAW,WAChB,OAAM,IAAI,MAAM,mBAAmB;AACvC,SAAK,cAAc,YAAY,IAAA;EAClC;;;;;;EAMD,SAAS,QAAQ,MAAM;AACnB,QAAI,KAAK,WAAW,WAChB;AACJ,UAAM,WAAW,KAAK;AAEtB,SAAK,SAAS;AACd,aAAS,SAAS,IAAA;AAClB,SAAK,MAAM,IAAI,IAAI,yBAAyB,KAAK,GAAA,YAAe,MAAA,EAAQ;AACxE,SAAK,UAAU,YAAY;MAAE;MAAM;IAAQ,CAAA;AAC3C,UAAM,oBAAA;EACT;;;;;EAKD,QAAQ,QAAQ;AACZ,QAAI,KAAK,WACL,OAAM,IAAI,MAAM,eAAe;AACnC,UAAM,WAAW,KAAK;AACtB,UAAM,OAAO,SAAS;AACtB,SAAK,MAAM,IAAI,IAAI,yBAAyB,KAAK,GAAA,YAAe,MAAA,EAAQ;AACxE,SAAK,UAAU,YAAY;MAAE;MAAM;IAAQ,CAAA;AAC3C,SAAK,SAAS,WAAW,MAAA,IAAU,IAAA;EACtC;EAED,IAAI,OAAO;AACP,QAAI,KAAK,WACL,OAAM,IAAI,MAAM,eAAe;AACnC,WAAO,KAAK,SAAS;EACxB;;;;;EAKD,IAAI,YAAY;AACZ,QAAI,KAAK,qBAAqB,EAC1B,QAAO,YAAY,IAAA,IAAQ,KAAK,cAAc,KAAK;AAEvD,WAAO;EACV;;;;EAID,IAAI,UAAU;AACV,WAAO,YAAY,IAAA,IAAQ,KAAK;EACnC;;;;EAID,IAAI,aAAa;AACb,WAAO,KAAK,WAAW;EAC1B;;;;EAID,IAAI,UAAU;AACV,QAAI,KAAK,cAAc,KAAK,UACxB,QAAO;AACX,QAAI,KAAK,SAAS,WACd,QAAO;AACX,WAAO;EACV;AACJ;AAID,IAAa,WAAb,MAAsB;EAClB;EACA;EACA;EACA;EACA;EACA;EACA;;;;;;EAMA,YAAY,MAAM,MAAM;AACpB,SAAK,OAAO;AACZ,QAAI,SAAS,OACT,OAAM,IAAI,MAAM,+BAA+B;AACnD,QAAI,SAAS,OACT,OAAM,IAAI,MAAM,+BAA+B;AACnD,SAAK9G,QAAQ;AACb,SAAK+G,mBAAmB;AACxB,SAAKC,qCACD,KAAK;AACT,SAAKC,uBAAuB,KAAK;AACjC,SAAKC,SAAS,CAAE;AAChB,SAAKC,SAAS;EACjB;;;;;EAKD,IAAI,OAAO;AACP,QAAI,KAAKA,WAAW,WAChB,OAAM,IAAI,MAAM,mBAAmB;AACvC,WAAO,KAAKnH;EACf;;;;;;EAMD,WAAW,MAAM;AACb,QAAI,KAAKmH,WAAW,WAChB,OAAM,IAAI,MAAM,mBAAmB;AACvC,QAAI,SAAS,OACT,OAAM,IAAI,MAAM,+BAA+B;AACnD,SAAKnH,QAAQ;EAChB;;;;;EAKD,WAAW;AACP,WAAO,sBAAsB,KAAK,kBAAA,WAA6B,KAAKkH,OAAO,MAAA,YAAkB,KAAKC,MAAAA,WAAiB,KAAK,UAAU,KAAK,IAAA,CAAK;EAC/I;;;;;;EAMD,QAAQ,MAAM;AACV,UAAM,WAAW,KAAKD,OAAO,KAAK,CAAC/B,OAAMA,OAAM,QAAQA,GAAE,QAAQ,KAAK,GAAA;AACtE,QAAI,SACA,OAAM,IAAI,MAAM,4CAA4C;AAChE,SAAK+B,OAAO,KAAK,IAAA;AACjB,SAAKH,mBAAmB,YAAY,IAAA;EACvC;;;;;;EAMD,SAAS,MAAM;AACX,SAAKG,SAAS,KAAKA,OAAO,OAAO,CAAC/B,OAAMA,OAAM,IAAA;AAC9C,SAAK,KAAK,SAAS,IAAA;AACnB,SAAK4B,mBAAmB,YAAY,IAAA;EACvC;;;;EAID,IAAI,kBAAkB;AAClB,WAAO,KAAK,aAAa,KAAKE;EACjC;;;;EAID,IAAI,aAAa;AACb,WAAO,KAAKC,OAAO;EACtB;;;;;EAKD,IAAI,qBAAqB;AACrB,QAAI,KAAKF,sCAAsC,EAC3C,QAAO;AACX,QAAI,KAAKE,OAAO,SAAS,EACrB,QAAO;AACX,WAAQ,YAAY,IAAA,IAChB,KAAKF,qCAAqC,KAAKD;EACtD;;;;EAID,IAAI,aAAa;AACb,WAAO,KAAKI,WAAW;EAC1B;;;;;;;EAOD,QAAQ,QAAQ;AACZ,QAAI,KAAKA,WAAW,WAChB;AACJ,UAAM,OAAO,KAAKnH;AAClB,SAAKmH,SAAS;AACd,SAAK,KAAK,IAAI,IAAI,sBAAsB,MAAA,GAAS;AACjD,eAAWhC,MAAK,KAAK+B,OACjB,CAAA/B,GAAE,SAAS,YAAY,MAAA,IAAU,IAAA;AAErC,SAAK+B,SAAS,CAAE;AAChB,SAAKH,mBAAmB,YAAY,IAAA;AACpC,SAAK,KAAK,iBAAiB,MAAM,MAAA;AACjC,QAAI,KAAK,KAAK,aACV,MAAK,KAAK,aAAa,IAAA;EAC9B;AACJ;AAYD,IAAa,OAAb,MAAkB;EACd;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA,MAAA,OAAmB,MAAM;;;;;;;EAOzB,YAAY,UAAU,CAAE,GAAE;AACtB,SAAK,WAAW,QAAQ,YAAY;AACpC,SAAK,aAAa,QAAQ,cAAc;AACxC,SAAK,sBAAsB,QAAQ,uBAAuB;AAC1D,SAAK,oBAAoB,QAAQ,qBAAqB;AACtD,SAAK,oCACD,QAAQ,qCAAqC;AACjD,SAAK,mBAAmB,QAAQ;AAChC,SAAK,eAAe,QAAQ;AAC5B,SAAK,SAAS,oBAAI,IAAA;AAClB,SAAK,aAAa,CAAE;AACpB,SAAK,MAAA,OAAmB,QAAQ,QAAQ,SAAS,KAAA;AAGjD,UAAM,QAAQ,KAAK,IAAI,KAAK,mBAAmB,KAAK,iCAAA;AACpD,QAAI,QAAQ,EACR,aAAY,MAAM;AACd,WAAK,SAAA;IACR,GAAE,QAAQ,GAAA;EAElB;;;;;EAKD,eAAe;AACX,QAAInK,KAAI;gBACA,KAAK,QAAA,uBAA+B,KAAK,iBAAA,yBAA0C,KAAK,mBAAA;uBACjF,KAAK,WAAW,MAAA;AAC/B,UAAM,WAAW,KAAK,WAAW,IAAI,CAACA,QAAMA,IAAE,SAAA,CAAU,EAAE,KAAK;EAAQ;AACvE,IAAAA,MAAK;;KAAyB;AAC9B,IAAAA,MAAK;;;AACL,eAAW,CAAC2C,IAAGtH,EAAA,KAAM,KAAK,OAAO,QAAA,EAC7B,CAAA2E,MAAK,OAAQ2C,EAAA,OAAQtH,GAAE,SAAA,CAAU;;AAErC,WAAO2E;EACV;;;;;EAKD,2BAA2B;AACvB,WAAO,CAAC,GAAG,KAAK,OAAO,OAAA,CAAS,EAAC,KAAK,CAAClE,IAAGC,OAAM;AAC5C,YAAMoN,MAAKrN,GAAE;AACb,YAAM,KAAKC,GAAE;AACb,UAAIoN,QAAO,GACP,QAAO;AACX,UAAIA,MAAK,GACL,QAAO;AACX,aAAO;IACV,CAAA;EACJ;;;;;EAKD,0BAA0B;AACtB,WAAO,CAAC,GAAG,KAAK,UAAW,EAAC,KAAK,CAACrN,IAAGC,OAAM;AACvC,UAAID,GAAE,eAAeC,GAAE,WACnB,QAAO;AACX,UAAID,GAAE,aAAaC,GAAE,WACjB,QAAO;AACX,aAAO;IACV,CAAA;EACJ;;;;;;;EAOD,YAAY,UAAU;AAClB,QAAI,aAAa,OACb,OAAM,IAAI,MAAM,+BAA+B;AAEnD,QAAI,aAAa,KACb,OAAM,IAAI,UAAU,0BAA0B;AAClD,QAAI,KAAK,WAAW,KAAK,KAAK,WAAW,WAAW,KAAK,SACrD,OAAM,IAAI,MAAM,mBAAmB,KAAK,QAAA,6BAAqC;AAEjF,SAAK,IAAI,IAAI,oBAAoB,KAAK,UAAU,QAAA,CAAS,EAAE;AAC3D,UAAMyO,MAAK,IAAI,SAAS,MAAM,QAAA;AAC9B,SAAK,WAAW,KAAKA,GAAA;AACrB,WAAOA;EACV;;;;;EAKD,WAAW;AACP,QAAI,UAAU;AAEd,UAAM,OAAO,CAAE;AACf,eAAW7M,MAAK,KAAK,WACjB,KAAIA,GAAE,YAAY;AACd,WAAK,IAAI,IAAI,gCAAgC,KAAK,UAAUA,GAAE,IAAA,CAAK,EAAE;AACrE,WAAK,KAAKA,EAAA;IACb,WACQA,GAAE,oBAAoB;AAC3B,WAAK,IAAI,IAAI,+BAA+B,KAAK,UAAUA,GAAE,IAAA,CAAK,EAAE;AACpE,WAAK,KAAKA,EAAA;IACb;AAGL,QAAI,KAAK,SAAS,GAAG;AACjB,iBAAW,YAAY,KACnB,UAAS,QAAQ,iBAAiB;AAEtC,gBAAU;IACb;AAED,UAAM,mBAAmB,CAAE;AAC3B,eAAW,CAAC,KAAK,IAAA,KAAS,KAAK,OAAO,QAAA,EAClC,KAAI,CAAC,KAAK,SAAS;AACf,WAAK,IAAI,IAAI,2BAA2B,KAAK,GAAA,eAAkB,KAAK,UAAA,aAAuB,KAAK,SAAA,uBAAgC,KAAK,SAAS,UAAA,GAAa;AAC3J,uBAAiB,KAAK,GAAA;AACtB,WAAK,SAAS,WAAW,KAAK,IAAA;IACjC;AAEL,eAAW,WAAW,kBAAkB;AACpC,WAAK,OAAO,OAAO,OAAA;AACnB,gBAAU;IACb;AACD,QAAI,QACA,MAAK,IAAI,IAAI,sBAAsB,KAAK,WAAW,MAAA,WAAiB,KAAK,WAAA,EAAa;EAE7F;;;;;;EAMD,CAAC,YAAY;AACT,UAAM,WAAW,CAAC,GAAG,KAAK,UAAW;AACrC,eAAWqC,MAAK,SACZ,OAAMA;EAEb;;;;;;;;EAQD,CAAC,SAAS;AACN,UAAM,WAAW,CAAC,GAAG,KAAK,UAAW;AACrC,eAAWA,MAAK,SACZ,OAAMA,GAAE;EAEf;;;;;EAKD,QAAQ,SAAS,QAAQ;AACrB,UAAMwK,MAAK,KAAK,OAAO,IAAI,OAAA;AAC3B,QAAI,CAACA,IACD;AACJ,IAAAA,IAAG,QAAQ,UAAU,cAAc;EACtC;;;;;EAKD,SAAS,MAAM;AACX,SAAK,OAAO,OAAO,KAAK,GAAA;EAC3B;;;;;;EAMD,iBAAiB,UAAUjB,IAAG;AAC1B,SAAK,aAAa,KAAK,WAAW,OAAO,CAAClO,OAAMA,OAAM,QAAA;EACzD;;;;;;EAMD,YAAY,UAAU;AAClB,UAAM,QAAQ,KAAK,WAAW,KAAK,CAACA,OAAMA,GAAE,SAAS,QAAA;AACrD,WAAO,UAAU;EACpB;;;;;;EAMD,QAAQ,SAAS;AACb,WAAO,KAAK,OAAO,IAAI,OAAA;EAC1B;;;;;;;EAOD,QAAQ,KAAK,UAAU;AACnB,UAAMkN,KAAI,IAAI,SAAS,KAAK,QAAA;AAC5B,SAAK,OAAO,IAAI,KAAKA,EAAA;AACrB,aAAS,QAAQA,EAAA;AACjB,WAAOA;EACV;;;;;;;EAOD,kBAAkB,SAAS;AAEvB,UAAM,SAAS,KAAK,wBAAA;AAIpB,QAAI,OAAO,SAAS,KAAK,OAAO,CAAA,EAAG,iBAAiB;AAGhD,YAAMA,KAAI,KAAK,QAAQ,SAAS,OAAO,CAAA,CAAA;AACvC,aAAOA;IACV;AAED,QAAI,KAAK,qBACJ,KAAK,WAAW,KAAK,KAAK,WAAW,SAAS,KAAK,WAAW;AAC/D,WAAK,IAAI,IAAI,aAAa,KAAK,QAAA,eAAuB,KAAK,WAAW,MAAA,EAAQ;AAC9E,YAAM,oBAAoB,KAAK,YAAY,KAAK,iBAAA,CAAkB;AAClE,YAAMA,KAAI,KAAK,QAAQ,SAAS,iBAAA;AAChC,aAAOA;IACV;EACJ;;;;EAID,IAAI,cAAc;AACd,WAAO,CAAC,GAAG,KAAK,OAAO,OAAA,CAAS,EAAC;EACpC;;;;;;EAMD,SAAS,SAAS;AACd,UAAM,WAAW,KAAK,IAAI,OAAA;AAC1B,WAAO,SAAS,SAAS;EAC5B;;;;;;;;;;;;;;;;;;EAkBD,IAAI,SAAS;AACT,UAAMiC,MAAK,KAAK,OAAO,IAAI,OAAA;AAC3B,QAAIA,KAAI;AACJ,MAAAA,IAAG,UAAA;AACH,aAAOA;IACV;AACD,SAAK,SAAA;AACL,UAAM,QAAQ,KAAKC,kBAAkB,OAAA;AACrC,QAAI,MACA,QAAO;AAEX,QAAI,KAAK,eAAe,QAEpB,OAAM,IAAI,MAAM,mCAAmC,KAAK,UAAA,eAAyB,KAAK,QAAA,GAAW;AAGrG,QAAI,KAAK,eAAe,mBAAmB;AACvC,YAAM,QAAQ,KAAK,yBAAA;AACnB,UAAI,MAAM,SAAS,GAAG;AAClB,aAAK,QAAQ,MAAM,CAAA,EAAG,KAAK,mBAAmB;AAC9C,cAAM,SAAS,KAAKA,kBAAkB,OAAA;AACtC,YAAI,OACA,QAAO;MACd;IACJ;AAGD,UAAM,IAAI,MAAM,uBAAuB,KAAK,UAAA,GAAa;EAC5D;AACJ;AAMD,IAAa3K,UAAS,CAAC,UAAU,CAAE,MAAK,IAAI,KAAK,OAAA;AC5iBjD,SAAgB,uBAAuB;AACnC,MAAIwJ;AACJ,MAAI;AACJ,QAAM,UAAU,IAAI,QAAQ,CAAC,UAAU,YAAY;AAC/CA,gBAAU;AACV,aAAS;EACZ,CAAA;AAED,SAAO;IAAE;IAAS,SAASA;IAAiB;EAAQ;AACvD;ACqBD,IAAa,cAAc,CAAC,YAAY;AACpC,MAAI,WAAW;AACf,QAAMxO,KAAI,QAAQ,MAAM;AACpB,QAAI,SACA;AACJ,IAAAA,GAAE,MAAA;AACF,YAAQ,WAAW,QAAQ,SAAA,CAAU;EACxC,GAAE,QAAQ,QAAA;AACX,MAAI,QAAQ,MACR,SAAQ,MAAM,iBAAiB,SAAS,CAAAyO,OAAK;AACzC,eAAW;AACX,IAAAzO,GAAE,OAAA;EACL,CAAA;AAEL,EAAAA,GAAE,MAAA;AACF,SAAO,CAAC,SAAS;AACb,QAAI,SACA,OAAM,IAAI,MAAM,4BAA4B;AAChD,IAAAA,GAAE,MAAA;AACF,YAAQ,WAAW,IAAA;EACtB;AACJ;AC7BD,gBAAuB4P,QAAO,SAAS,MAAM;AACzC,QAAM,SAAS,KAAK,UAAU;AAC9B,QAAM,YAAY,KAAK,aAAa;AACpC,QAAMjK,SAAQ,KAAK,SAAS;AAC5B,QAAM,iBAAiB,KAAK,kBAAkB;AAC9C,QAAM,gBAAgB,KAAK,eAAe,aAAa,KAAK,YAAA,IAAgB;AAC5E,QAAM,gBAAgB,KAAK;AAC3B,MAAI,YAAY;AAChB,MAAI,UAAU,aAAa,KAAK,OAAO,aAAa,KAAK,cAAc,CAAA,CAAE;AACzE,MAAI,UAAU,YAAY,IAAA;AAC1B,QAAM,UAAU,YAAY;AACxB,UAAM+C,WAAU,YAAY,IAAA,IAAQ;AACpC,QAAI,OAAO,kBAAkB,YACzB,WAAU,KAAK,IAAI,GAAG,gBAAgBA,QAAA;AAE1C,QAAI,QACA,OAAM,MAAM;MAAE,QAAQ;MAAS;IAAQ,CAAA;AAE3C,cAAU,YAAY,IAAA;AACtB,QAAI,QAAQ,QACR,OAAM,IAAI,MAAM,kBAAkB,OAAO,MAAA,EAAQ;EACxD;AACD,MAAI,MAAM,QAAQ,OAAA,EACd,WAAU,QAAQ,OAAA;AACtB,MAAI,KAAK,QACL,MAAK,QAAA;AACT,MAAI,UAAU;AACd,MAAI,cAAc;AAClB,MAAI;AACA,WAAO,CAAC,WAAW;AACf;AACA,UAAI,cAAc,YAAY,cAAc,OACxC,OAAM,QAAA;AACV,YAAM,SAAS,MAAM,QAAQ,OAAA;AAC7B,UAAI,OAAO,WAAW,eAAe,CAAC,eAClC,aAAY;WAEX;AACD,cAAM;AACN,YAAI,cAAc,WAAW,cAAc,OACvC,OAAM,QAAA;AACV,YAAI/C,WAAU,UAAa,eAAeA,OACtC,aAAY;MACnB;AACD,UAAI,eACA;YAAI,CAAC,cAAc,WAAA,EACf,aAAY;MACf;IAER;AACD,cAAU;EACb,UAAA;AAEG,gBAAY;AACZ,QAAI,KAAK,WACL,MAAK,WAAW,OAAA;EACvB;AACJ;AAiBD,UAAiB,WAAW,SAAS,MAAM;AACvC,QAAM,SAAS,KAAK,UAAU;AAC9B,QAAMA,SAAQ,KAAK,SAAS;AAC5B,QAAM,iBAAiB,KAAK,kBAAkB;AAC9C,MAAI,YAAY;AAChB,MAAI,MAAM,QAAQ,OAAA,EACd,WAAU,QAAQ,OAAA;AACtB,MAAI,KAAK,QACL,MAAK,QAAA;AACT,MAAI,UAAU;AACd,MAAI,cAAc;AAClB,MAAI;AACA,WAAO,CAAC,WAAW;AACf;AACA,YAAM,SAAS,YAAY,OAAA;AAC3B,UAAI,OAAO,WAAW,eAAe,CAAC,eAClC,aAAY;WAEX;AACD,cAAM;AACN,YAAIA,WAAU,UAAa,eAAeA,OACtC,aAAY;AAChB,YAAI,QAAQ,QACR,aAAY;MACnB;IACJ;AACD,cAAU;EACb,UAAA;AAEG,gBAAY;AACZ,QAAI,KAAK,WACL,MAAK,WAAW,OAAA;EACvB;AACJ;ACpFD,IAAa,uBAAb,cAA0C,mBAAmB;EACzD;EACA;EACA;EACA;EACA,YAAY,oBAAI,IAAA;EAChB;EACA,YAAY,UAAU,CAAE,GAAE;AACtB,UAAA;AACA,QAAI,OAAO,WAAW,YAClB,YAAW,SAAS;MACJ;MACE;IACjB;AAEL,SAAK,YAAY,QAAQ,aAAa;AACtC,SAAK,wBAAwB,QAAQ,yBAAyB;AAC9D,SAAKkK,gBAAgB,aAAa,MAAM,KAAKrH,UAAAA,GAAa,KAAK,YAAY,CAAA;AAC3E,QAAI,QAAQ,KAAK;AACb,UAAI,QAAQ,WACR,OAAM,IAAI,MAAM,4CAA4C;AAChE,UAAI,QAAQ,YACR,OAAM,IAAI,MAAM,6CAA6C;AACjE,WAAK,aAAa,QAAQ;AAC1B,WAAK,cAAc,QAAQ;IAC9B,OACI;AACD,UAAI,CAAC,QAAQ,cAAc,CAAC,QAAQ,YAChC,OAAM,IAAI,MAAM,2EAA2E;AAE/F,WAAK,aAAa,QAAQ;AAC1B,WAAK,cAAc,QAAQ;IAC9B;EACJ;EACD,YAAY;AACR,UAAMzC,UAAS,CAAC,GAAG,KAAK+J,UAAU,OAAA,CAAS;AAC3C,UAAM,MAAM,KAAK,IAAA;AACjB,eAAWvP,MAAKwF,QACZ,KAAIxF,GAAE,aAAa,KAAK;AACpB,UAAIA,GAAE,cACF,CAAAA,GAAE,cAAc,iBAAiB;AAErC,YAAM,WAAWA,GAAE;AACnB,UAAI,SACA,YAAW,MAAM;AACb,iBAAS,MAAM,iBAAiB;MACnC,GAAE,CAAA;AAEP,WAAK,UAAU,aAAa;QAAE,SAASA,GAAE;QAAK,UAAU;QAAmB,SAAS;MAAO,CAAA;AAC3F,WAAKuP,UAAU,OAAOvP,GAAE,EAAA;IAC3B;AAEL,SAAK,UAAA;AACL,WAAO,KAAKuP,UAAU,OAAO;EAChC;EACD,YAAY;AACR,UAAM/J,UAAS,CAAC,GAAG,KAAK+J,UAAU,OAAA,CAAS;AAC3C,UAAM,MAAM,KAAK,IAAA;AACjB,eAAWvP,MAAKwF,SAAQ;AACpB,YAAM,SAAS,MAAMxF,GAAE;AACvB,cAAQ,IAAI,GAAGA,GAAE,EAAA,gBAAkB,KAAK,MAAM,SAAS,GAAA,EAAM,SAAA,CAAU,GAAG;IAC7E;EACJ;;;;;;;;;EASD,QAAQ,SAAS,UAAU;AACvB,QAAI,aAAa,QAAW;AACxB,WAAKwP,iBAAiB,SAAS,QAAA;AAC/B;IACH;AACD,WAAO,KAAKC,cAAc,OAAA;EAC7B;;;;;EAKD,iBAAiB,SAAS;AACtB,UAAM,KAAK,KAAK,WAAW,OAAA;AAC3B,QAAI,KAAKF,UAAU,IAAI,EAAA,EACnB,OAAM,IAAI,MAAM,sCAAsC,EAAA,GAAK;AAC/D,UAAM5K,KAAI;MACN,WAAW,KAAK,IAAA,IAAQ,KAAK;MAC7B;MACA,KAAK;IACR;AACD,SAAK4K,UAAU,IAAI,IAAI5K,EAAA;AACvB,SAAK2K,cAAc,MAAA;EACtB;;;;;;;EAOD,cAAc,SAAS;AACnB,UAAM,KAAK,KAAK,WAAW,OAAA;AAC3B,QAAI,KAAKC,UAAU,IAAI,EAAA,EACnB,OAAM,IAAI,MAAM,sCAAsC,EAAA,GAAK;AAC/D,UAAMjN,KAAI,IAAI,QAAQ,CAAC2L,WAAS,WAAW;AACvC,YAAMtJ,KAAI;QACN,WAAW,KAAK,IAAA,IAAQ,KAAK;QAC7B;QACA,KAAK;QACL,gBAAgBsJ;QAChB,eAAe;MAClB;AACD,WAAKsB,UAAU,IAAI,IAAI5K,EAAA;AACvB,WAAK2K,cAAc,MAAA;IACtB,CAAA;AACD,WAAOhN;EACV;;;;;;EAMD,iBAAiB,SAAS,UAAU;AAChC,UAAM,KAAK,KAAK,WAAW,OAAA;AAC3B,QAAI,KAAKiN,UAAU,IAAI,EAAA,EACnB,OAAM,IAAI,MAAM,sCAAsC,EAAA,GAAK;AAC/D,UAAM5K,KAAI;MACN,WAAW,KAAK,IAAA,IAAQ,KAAK;MAC7B;MACA,KAAK;MACL;IACH;AACD,SAAK4K,UAAU,IAAI,IAAI5K,EAAA;AACvB,SAAK2K,cAAc,MAAA;EACtB;;;;;;EAMD,SAAS,UAAU,WAAW;AAC1B,UAAM,KAAK,KAAK,YAAY,QAAA;AAC5B,UAAM,UAAU,KAAKC,UAAU,IAAI,EAAA;AACnC,QAAI,CAAC,SAAS;AACV,UAAI,KAAK,0BAA0B,QAC/B,OAAM,IAAI,MAAM,gCAAgC,EAAA,KAAO,EAAE,OAAO,SAAU,CAAA;AAE9E,aAAO;IACV;AACD,QAAI,UAEA,SAAQ,YAAY,KAAK,IAAA,IAAQ,KAAK;QAGtC,MAAKA,UAAU,OAAO,EAAA;AAE1B,QAAI,QAAQ,eACR,SAAQ,eAAe,QAAA;AAE3B,QAAI,QAAQ,SACR,SAAQ,SAAS,OAAO,QAAA;AAE5B,SAAK,UAAU,SAAS;MAAE,SAAS,QAAQ;MAAe;IAAU,CAAA;AACpE,QAAI,CAAC,UACD,MAAK,UAAU,aAAa;MAAE,SAAS,QAAQ;MAAe;MAAU,SAAS;IAAM,CAAA;AAE3F,WAAO;EACV;AACJ;ACpMD,UAAiB,iBAAiB,UAAU,CAAE,GAAE;AAC5C,QAAM,UAAU,QAAQ,WAAW;AACnC,MAAI,gBAAgB,QAAQ,iBAAiB,OAAO;AACpD,QAAM,aAAa,QAAQ;AAC3B,QAAM,QAAQ,QAAQ,SAAS;AAC/B,MAAIlQ,UAAQ;AACZ,cAAY,YAAY,eAAe,aAAa,eAAe,GAAG,WAAW,SAAS,IAAI,SAAS,GAAG,WAAW,eAAe,IAAI,eAAe,GAAG,MAAO,eAAe,SAAa,WAAW,YAAY,IAAI,YAAY,IAAI,QAAW,WAAW,OAAO,IAAI,OAAO,CAAC;AACjR,SAAO,gBAAgB,GAAG;AAEtB,QAAI,cAAcA,WAAS,WACvB;AACJ;AACA,UAAMA;AAENA,eAAS,KAAK,IAAIA,SAAO,KAAA;EAC5B;AACJ;AAyCD,IAAa,gBAAgB,CAAC,UAAU,UAAU,CAAE,MAAK;AACrD,QAAM,OAAO,EACT,MAAM,QAAQ;AACV,QAAI;AACA,YAAMW,KAAI,MAAM,SAAA;AAChB,UAAIA,OAAM,OACN,QAAO;QAAE,OAAO,QAAQ;QAAmB,OAAO;QAAY,SAAS;MAAO;AAClF,aAAO;QAAE,OAAOA;QAAG,SAAS;MAAM;IACrC,SACM,OAAO;AACV,aAAO;QAAE,SAAS;QAAc;MAAO;IAC1C;EACJ,EACJ;AACD,SAAO,UAAU,MAAM,OAAA;AAC1B;AAqBD,IAAa,YAAY,OAAO,MAAM,OAAO,CAAE,MAAK;AAChD,QAAM,SAAS,KAAK;AACpB,QAAM0P,OAAM,iBAAiB,KAAK,GAAA;AAClC,QAAM,aAAa,KAAK,cAAc;AACtC,QAAM,YAAY,aAAA;AAClB,MAAI,WAAW;AACf,QAAM,eAAe,KAAK,WAAW;AACrC,QAAM,gBAAgB,KAAK,iBAAiB,OAAO;AACnD,QAAM,aAAa,iBAAiB;IAAE,GAAG;IAAM,SAAS;IAAc;EAAe,CAAA;AACrF,MAAI,gBAAgB,EAChB,OAAM,IAAI,MAAM,yCAAyC;AAC7D,MAAI,aAAa,EACb,KAAI;AACA,UAAM,MAAM;MAAE,QAAQ;MAAoB;IAAQ,CAAA;EACrD,SACM,OAAO;AAEV,WAAO;MACH,SAAS;MACT;MACA,OAAO,KAAK;MACZ,SAAS,UAAA;MACT,SAASC,iBAAgB,KAAA;IAC5B;EACJ;AAEL,aAAWlQ,MAAK,YAAY;AACxB;AAEA,UAAM,SAAS,MAAM,KAAK,MAAM,QAAA;AAChC,QAAI,OAAO,QACP,QAAO;MAAE,SAAS,OAAO;MAAS,OAAO,OAAO;MAAO;MAAU,SAAS,UAAA;IAAa;AAE3F,IAAAiQ,KAAI,EACA,KAAK,mBAAmB,SAAS,SAAA,CAAU,OAAO,qBAAqBjQ,EAAA,CAAE,GAC5E,CAAA;AAED,QAAI,YAAY,cACZ;AAGJ,QAAI;AACA,YAAM,MAAM;QAAE,QAAQA;QAAG;MAAQ,CAAA;IACpC,SACM,OAAO;AAEV,aAAO;QACH,SAAS;QACT;QACA,OAAO,KAAK;QACZ,SAASkQ,iBAAgB,KAAA;QACzB,SAAS,UAAA;MACZ;IACJ;EACJ;AACD,SAAO;IACH,SAAS,mBAAmB,SAAS,SAAA,CAAU;IAC/C,SAAS;IACT;IACA,OAAO,KAAK;IACZ,SAAS,UAAA;EACZ;AACJ;AChLD,IAAa,UAAU,CAAC,UAAU;AAC9B,MAAIjB,QAAM;AACV,MAAI,UAAU;AACd,SAAO,MAAM;AACT,QAAIA,MACA,QAAO;AACXA,YAAM;AACN,cAAU,MAAA;AACV,WAAO;EACV;AACJ;ACHD,IAAa,WAAb,MAAsB;EAClB;EACA;EACA;EACA,SAAS;AACL,QAAI,KAAKkB,UAAU;AACf,WAAKA,SAAAA;AACL,WAAKA,WAAW;IACnB;AACD,SAAKC,WAAW,QAAQ,QAAA;EAC3B;;;;;EAKD,QAAQ;AACJ,QAAI,KAAKC,SAAS;AACd,WAAKA,QAAQ,SAAS;AACtB,WAAKA,UAAU;IAClB;AACD,SAAKF,WAAW;AAChB,SAAKC,WAAW;EACnB;EACD,eAAe;AACX,UAAMvN,KAAI,IAAI,QAAQ,CAAC2L,WAAS,WAAW;AACvC,WAAK2B,WAAW3B;AAChB,WAAK6B,UAAU;IAClB,CAAA;AACD,SAAKD,WAAWvN;AAChB,WAAOA;EACV;;;;;;EAMD,MAAM,UAAU,eAAe;AAC3B,QAAIA,KAAI,KAAKuN;AACb,IAAAvN,OAAM,KAAKyN,aAAAA;AACX,QAAI,eAAe;AACf,YAAM,SAAS,KAAKD;AACpB,iBAAW,MAAM;AACb,YAAI,OACA,QAAO,mBAAmB,cAAc,SAAA,CAAU,EAAE;MAE3D,GAAE,aAAA;IACN;AACD,UAAMxN;AACN,SAAKuN,WAAW;AAChB,SAAKD,WAAW;AAChB,SAAKE,UAAU;EAClB;;;;;;;;;;;EAWD,MAAM,UAAU,eAAe;AAC3B,QAAI;AACA,YAAM,KAAK,UAAU,aAAA;AACrB,aAAO;IACV,QACK;AACF,aAAO;IACV;EACJ;AACJ;AC1DD,IAAa,mBAAb,MAAaE,0BAAyB,mBAAmB;EACrD,OAAO,SAAS,IAAIA,kBAAA;EACpB;EACA;EACA,cAAc;AACV,UAAA;AACA,SAAK,SAAAC,WAAA;AACL,SAAK,QAAQ,aAAa,MAAM;AAC5B,aAAO,KAAK,aAAA;IACf,GAAE,GAAA;EACN;;;;;;;;;;;EAWD,QAAQ,MAAM;AACV,UAAMhQ,UAAS,KAAK,OAAO,QAAQ,IAAA;AACnC,QAAI,KAAK,MAAM,aAAa,QAAQ;AAChC,WAAK,UAAU,WAAW,CAAE,CAAA;AAC5B,WAAK,MAAM,MAAA;IACd;AACD,WAAOA;EACV;EACD,UAAU;AACN,WAAO,KAAK,OAAO,QAAA;EACtB;EACD,MAAM,eAAe;AACjB,UAAM,OAAO,KAAK,OAAO,QAAA;AACzB,QAAI,SAAS,QAAW;AACpB,WAAK,UAAU,SAAS,CAAE,CAAA;AAC1B,aAAO;IACV;AACD,QAAI;AACA,YAAM,KAAA;IACT,SACM,OAAO;AACV,cAAQ,MAAM,KAAA;IACjB;EACJ;;;;;;EAMD,QAAQ;AACJ,QAAI,KAAK,OAAO,WAAW,EACvB;AACJ,SAAK,OAAO,MAAA;AACZ,SAAK,MAAM,OAAA;AACX,SAAK,UAAU,SAAS,CAAE,CAAA;EAC7B;;;;EAID,IAAI,UAAU;AACV,WAAO,KAAK,OAAO;EACtB;;;;EAID,IAAI,SAAS;AACT,WAAO,KAAK,OAAO;EACtB;AACJ;AC7ED,IAAa,WAAW,CAAC,UAAU,kBAAkB;AACjD,MAAI,UAAU;AACd,SAAO,UAAU,SAAS;AACtB,UAAMkI,WAAU,YAAY,IAAA,IAAQ;AACpC,QAAIA,YAAW,eAAe;AAC1B,YAAMxD,KAAI,SAASwD,UAAS,GAAG,IAAA;AAC/B,UAAI,OAAOxD,OAAM,SACb,OAAMA;AACV,gBAAU,YAAY,IAAA;IACzB;EACJ;AACJ;ACrBD,SAAgB,WAAWwD,UAAS;AAChC,QAAM1I,KAAI,SAAS,aAAa0I,UAAS,CAAA,GAAI;IAAE,OAAO,4BAAA;IAA+B,YAAY;EAAM,CAAA;AACvG,SAAO,MAAM1I,GAAE;AAClB;AAgCD,SAAgB,QAAQyQ,WAAU,OAAO,CAAE,GAAE;AACzC,QAAM,UAAU,aAAaA,SAAA;AAC7B,MAAI,CAAC,QACD,OAAM,IAAI,MAAM,4BAA4B;AAChD,QAAM,YAAY;IACd,GAAG;IACH,OAAO,4BAAA;EACV;AACD,MAAIzQ;AACJ,SAAO,MAAM;AACT,IAAAA,OAAM,SAAS,SAAS,SAAA;AACxB,WAAOA,GAAE;EACZ;AACJ;AAqBD,SAAgB,aAAa,YAAY,OAAO,CAAE,GAAE;AAChD,QAAM,YAAY;IACd,GAAG;IACH,OAAO,qBAAA;EACV;AACD,MAAIA;AACJ,SAAO,MAAM;AACT,IAAAA,OAAM,SAAS,YAAY,SAAA;AAC3B,WAAOA,GAAE;EACZ;AACJ;AAMD,IAAa,kBAAkB,OAAO;EAClC,SAAS;EACT,QAAQ;EAER,QAAQ;EACP;EAED,IAAI,KAAK;EACR;AACJ;AAMD,IAAa,iBAAiB,OAAO;EACjC,SAAS;EACT,QAAQ;EAER,QAAQ;EACP;EAED,MAAM;EACL;AACJ;AA6CD,IAAa,WAAW,CAAC0Q,QAAO,UAAU,CAAE,MAAK;AAC7C,MAAI,CAAC,OAAO,SAASA,MAAA,EACjB,QAAO,gBAAA;WAEF,OAAO,MAAMA,MAAA,EAClB,QAAO,eAAA;AAEX,QAAM,aAAa,QAAQ,cAAc;AACzC,QAAM,YAAY,QAAQ,aAAa;AACvC,MAAI,cAAc,UACd,OAAM,IAAI,MAAM,iDAAiD;AACrE,MAAI,mBAAmB;AAEvB,QAAM,QAAQ,QAAQ,SAAS,4BAAA;AAE/B,MAAI,YAAY;AAChB,QAAM,iBAAiB,CAAC9Q,YAAU;AAC9B,gBAAYA;AACZ,QAAIW,KAAIX,WAAS8Q,SAAQ;AACzB,QAAI,WACA,CAAAnQ,KAAI,MAAMA,EAAA;aACL,aAAaA,MAAK,EACvB,CAAAA,KAAIA,KAAI;AACZ,WAAOA;EACV;AACD,SAAO;IACH,IAAI,KAAK;AACL,yBAAmB;IACtB;IACD,IAAI,SAAS;AAGT,aAAO,eAAe,SAAA,KAAc;IACvC;IACD,IAAI,UAAU;AACV,aAAO,eAAe,MAAM,OAAA;IAC/B;IACD,OAAO,MAAM;AACT,YAAM,MAAA;IACT;EACJ;AACJ;AAuBD,IAAa,iBAAiB,CAACoQ,YAAW,UAAU,CAAE,MAAK;AACvD,QAAM,QAAQ,QAAQ,SAAS,4BAAA;AAC/B,QAAM,kBAAkBA,aAAY;AACpC,MAAI,mBAAmB;AACvB,QAAM,iBAAiB,MAAM;AAEzB,UAAMpQ,KAAI,MAAM,WAAW,kBAAkB;AAE7C,UAAMiE,KAAIjE,KAAI,KAAK,MAAMA,EAAA;AACzB,QAAIiE,KAAI,EACJ,OAAM,IAAI,MAAM,mDAAmDjE,EAAA,OAAQiE,EAAA,EAAG;AAElF,QAAIA,KAAI,EACJ,OAAM,IAAI,MAAM,mDAAmDjE,EAAA,OAAQiE,EAAA,EAAG;AAElF,WAAOA;EACV;AACD,SAAO;IACH,KAAK,CAAC,QAAQ;AACV,yBAAmB;IACtB;IACD,OAAO,MAAM;AACT,YAAM,MAAA;IACT;IACD,IAAI,SAAS;AACT,aAAO,eAAA,KAAoB;IAC9B;IACD,IAAI,UAAU;AACV,aAAO,eAAA;IACV;EACJ;AACJ;AAYD,IAAa,8BAA8B,MAAM;AAC7C,MAAI,QAAQ,YAAY,IAAA;AACxB,SAAO;IAIH,OAAO,MAAM;AACT,cAAQ,YAAY,IAAA;IACvB;IAID,IAAI,UAAU;AACV,aAAO,YAAY,IAAA,IAAQ;IAC9B;EACJ;AACJ;AAkBD,IAAa,uBAAuB,MAAM;AACtC,MAAI,QAAQ;AACZ,SAAO;IAIH,OAAO,MAAM;AACT,cAAQ;IACX;IAID,IAAI,OAAO;AACP,aAAO;IACV;IASD,IAAI,UAAU;AACV,aAAO,EAAE;IACZ;EACJ;AACJ;AAkBD,IAAa,oBAAoB,CAAC1D,KAAI,UAAU;AAC5C,MAAI,OAAOA,QAAO,WACd,OAAM,IAAI,MAAM,yCAAyC,OAAOA,GAAA,EAAI;AACxE,MAAI,aAAa;AACjB,SAAO;IACH,IAAI,UAAU;AACV,aAAO,MAAM;IAChB;IACD,IAAI,SAAS;AACT,aAAO,MAAM;IAChB;IACD,IAAI,WAAW;AACX,UAAI,MAAM,OACN,QAAO;AACX,aAAO;IACV;IAID,IAAI,aAAa;AACb,aAAO;IACV;IACD,IAAI,kBAAkB;AAClB,aAAO;IACV;IACD,SAAS,MAAM;AACX,YAAM4H,WAAU,MAAM;AACtB,aAAO5H,IAAG4H,QAAA;IACb;IACD,OAAO,MAAM;AACT,YAAM,MAAA;AACN;IACH;EACJ;AACJ;ACnWD,IAAa,iBAAiB,CAAC5H,KAAI2H,WAAU,aAAa,WAAW;AACjE,MAAI,UAAU;AACd,MAAI;AACJ,MAAI,oBAAoB,aAAaA,WAAU,GAAA;AAC/C,SAAO,MAEP,IAAI,QAAQ,OAAO+F,WAAS,WAAW;AACnC,UAAM9F,WAAU,YAAY,IAAA,IAAQ;AACpC,QAAI,cAAc,UAAaA,WAAU,kBACrC,KAAI;AACA,gBAAU,YAAY,IAAA;AACtB,kBAAY,MAAM5H,IAAG4H,QAAA;AACrB,0BAAoB,aAAaD,WAAU,GAAA;IAC9C,SACM,OAAO;AACV,UAAI,eAAe,QAAQ;AACvB,oBAAY;AACZ,kBAAU;MACb,WACQ,eAAe,UACpB,qBAAoB,KAAK,MAAM,oBAAoB,GAAA;AAGvD,aAAO,KAAA;AACP;IACH;AAEL+F,cAAQ,SAAA;EACX,CAAA;AACJ;ACxCD,IAAa,eAAb,MAA0B;EACtB;EACA;EACA,WAAW;EACX,cAAc;AACV,UAAM,EAAE,SAAS,SAAA,UAAA,IAAY,qBAAA;AAC7B,SAAK4B,WAAW;AAChB,SAAKD,WAAW3B;EACnB;;;;;;;;;;EAUD,MAAM;AACF,WAAO,KAAK4B;EACf;;;;;;;EAOD,IAAIxQ,SAAO;AACP,QAAI,KAAKgR,SACL,OAAM,IAAI,MAAM,sCAAsC;AAC1D,SAAKA,WAAW;AAChB,SAAKT,SAASvQ,OAAAA;EACjB;;;;;EAKD,IAAI,SAAS;AACT,WAAO,KAAKgR;EACf;AACJ;AAID,IAAa,aAAa,MAAM,IAAI,aAAA;ACUpC,IAAa,UAAU,CAAC,WAAW,WAAW,eAAe;AACzD,MAAI5Q;AACJ,MAAI,UAAU;AACd,QAAM,OAAO,CAAC,UAAU;AACpB,QAAIA,OAAM,QAAW;AACjB,aAAO,aAAaA,EAAA;AACpB,MAAAA,KAAI;IACP;AACD,QAAI,MACA,WAAU,KAAA;QAGV,WAAU;AAEd,QAAI,eAAe,OACf,YAAW,OAAA;EAClB;AACD,EAAAA,KAAI,WAAW,WAAW,MAAM;AAC5B,IAAAA,KAAI;AACJ,QAAI;AACA,gBAAU,iBAAiB,SAAA,IAAa;IAC3C,UAAA;AAEG,UAAI,eAAe,OACf,YAAW,OAAA;IAClB;EACJ,GAAE,SAAA;AACH,SAAO;AACV;ACpGD,IAAa,aAAa,CAAC,YAAY;AACnC,SAAO,OAAO,OAAO;IACjB,OAAO,QAAQ;IACf,SAAS,CAAC,GAAG,QAAQ,OAAQ;IAC7B,SAAS,QAAQ;EACpB,CAAA;AACJ;AA2BD,IAAa,OAAO,CAAC,cAAc,iBAAiB;AAChD,QAAM,CAAC,SAAS,sBAAA,IAA0B,gBAAgB,YAAA;AAC1D,MAAI,CAAC,QACD,OAAM,IAAI,MAAM,sBAAA;AACpB,QAAM,QAEL,gBAAiB,OAAO,KAAK,QAAQ,MAAA,EAAQ,CAAA;AAC9C,MAAI,OAAO,QAAQ,OAAO,KAAA,MAAW,YACjC,OAAM,IAAI,UAAU,mBAAmB,KAAA,cAAmB;AAG9D,QAAM,cAAc,gCAAgC,QAAQ,MAAA;AAC5D,MAAI,gBAAgB,OAChB,OAAM,IAAI,MAAM,iCAAiC;AAErD,SAAO,OAAO,OAAO;IACjB,OAAO;IACP,SAAS,CAAE;IACX,SAAS,OAAO,OAAO,OAAO,YAAY,WAAA,CAAY;EACzD,CAAA;AACJ;AACD,IAAa,QAAQ,CAAC,OAAO;AACzB,SAAO,KAAK,GAAG,OAAA;AAClB;AACD,IAAa,kBAAkB,CAAC,oBAAoB;AAChD,MAAI,OAAO,oBAAoB,YAC3B,QAAO,CAAC,QAAW,qBAAsB;AAE7C,MAAI,oBAAoB,KACpB,QAAO,CAAC,QAAW,gBAAiB;AAExC,MAAI,YAAY,gBAEZ,QAAO,CAAC,iBAAiB,EAAG;AAEhC,MAAI,OAAO,oBAAoB,SAC3B,QAAO,CACH,EACI,QAAQ,gBACX,GACD,EACH;AAEL,SAAO,CACH,QACA,oBAAoB,OAAO,eAAA,mBAC9B;AACJ;AA8BD,IAAa,SAAS,CAAC,OAAO;AAC1B,SAAO,SAAS,EAAA,EAAI,WAAW;AAClC;AAOD,IAAa,kBAAkB,CAAC,OAAO;AAEnC,uBAAqB,EAAA;AAErB,QAAM,QAAQ,GAAG,QAAQ,GAAG,KAAA;AAC5B,MAAI,MAAM,WAAW,KAAK,MAAM,CAAA,EAAG,UAAU,KACzC,QAAO,CAAE;AACb,SAAO;AACV;AAQD,IAAa,WAAW,CAAC,OAAO;AAC5B,QAAM,UAAU,gBAAgB,EAAA;AAChC,SAAO,QAAQ,IAAI,CAACO,OAAMA,GAAE,KAAA;AAC/B;AACD,IAAa,mBAAmB,CAAC,YAAY;AACzC,QAAM,wBAAwB,CAAC,WAAW;AAEtC,QAAI,WAAW,KACX,QAAO,EAAE,OAAO,KAAM;AAE1B,QAAI,OAAO,WAAW,SAClB,QAAO,EACH,OAAO,OACV;aAEI,OAAO,WAAW,YAAY,WAAW,QAAQ;AACtD,YAAM,cAAc,OAAO;AAC3B,UAAI,OAAO,gBAAgB,SACvB,OAAM,IAAI,UAAU,8CAA8C,OAAO,WAAA,EAAa;AAE1F,UAAI,mBAAmB,OACnB,QAAO;QACH,OAAO;QACP,eAAe,OAAO;MACzB;AAEL,aAAO,EAAE,OAAO,YAAa;IAChC,MAEG,OAAM,IAAI,MAAM,oBAAoB,OAAO,MAAA,iDAAuD;EAEzG;AAED,MAAI,MAAM,QAAQ,OAAA,GAAU;AACxB,QAAI,eAAe;AACnB,UAAM,aAAa,QAAQ,IAAI,CAACP,OAAM;AAClC,YAAMkF,KAAI,sBAAsBlF,EAAA;AAChC,UAAI,CAACkF,GACD,OAAM,IAAI,MAAM,gBAAgB;AACpC,qBAAe,gBAAgBA,GAAE,UAAU;AAC3C,aAAOA;IACV,CAAA;AACD,QAAI,gBAAgB,WAAW,SAAS,EACpC,OAAM,IAAI,MAAM,uCAAuC;AAE3D,WAAO;EACV,OACI;AACD,UAAM,SAAS,sBAAsB,OAAA;AACrC,QAAI,CAAC,OACD;AACJ,WAAO,CAAC,MAAO;EAClB;AACJ;AACD,IAAM,kCAAkC,CAAC3D,OAAM;AAC3C,QAAM,YAAY,oBAAI,IAAA;AAEtB,aAAW,CAAC,eAAe,eAAA,KAAoB,OAAO,QAAQA,EAAA,GAAI;AAC9D,QAAI,OAAO,kBAAkB,YACzB,OAAM,IAAI,UAAU,2BAA2B;AAEnD,QAAI,OAAO,oBAAoB,YAC3B,OAAM,IAAI,UAAU,8BAA8B,aAAA,EAAe;AAErE,QAAI,UAAU,IAAI,aAAA,EACd,OAAM,IAAI,MAAM,wBAAwB,aAAA,EAAe;AAE3D,QAAI,cAAc,SAAS,GAAG,EAC1B,OAAM,IAAI,MAAM,mCAAmC;AAEvD,cAAU,IAAI,eAAe,CAAE,CAAA;EAClC;AAED,aAAW,CAAC,eAAe,eAAA,KAAoB,OAAO,QAAQA,EAAA,GAAI;AAC9D,UAAM,UAAU,iBAAiB,eAAA;AACjC,QAAI,YAAY,OACZ,OAAM,IAAI,MAAM,4BAA4B;AAChD,QAAI,YAAY,MAAM;AAElB,YAAM,aAAa,oBAAI,IAAA;AACvB,iBAAW,UAAU,SAAS;AAC1B,YAAI,WAAW,IAAI,OAAO,KAAA,EACtB,OAAM,IAAI,MAAM,iBAAiB,OAAO,KAAA,yBAA8B,aAAA,GAAgB;AAE1F,mBAAW,IAAI,OAAO,KAAA;AACtB,YAAI,OAAO,UAAU,KACjB;AACJ,YAAI,CAAC,UAAU,IAAI,OAAO,KAAA,EACtB,OAAM,IAAI,MAAM,iBAAiB,OAAO,KAAA,0DAA+D,aAAA,GAAgB;MAE9H;AACD,gBAAU,IAAI,eAAe,OAAA;IAChC;EACJ;AACD,SAAO;AACV;AAOD,IAAM,uBAAuB,CAAC,UAAU;AACpC,MAAI,OAAO,UAAU,YACjB,OAAM,IAAI,UAAU,4BAA4B;AAEpD,MAAI,OAAO,MAAM,UAAU,SACvB,OAAM,IAAI,UAAU,gCAAgC;AAE3D;AAgBD,IAAauL,MAAK,CAAC,IAAI,YAAY;AAC/B,uBAAqB,EAAA;AACrB,qBAAmB,IAAI,OAAA;AACvB,SAAO,OAAO,OAAO;IACjB,OAAO;IACP,SAAS,GAAG;IACZ,SAAS,OAAO,CAAC,GAAG,SAAS,CAAC,GAAG,KAAM,CAAC,CAAA;EAC3C,CAAA;AACJ;AACD,IAAa+D,QAAO,CAAC,OAAO;AAExB,QAAMC,SAAQ,gBAAgB,EAAA,EAAI,GAAG,CAAA;AAErC,MAAI,CAACA,UAASA,OAAM,UAAU,KAC1B,OAAM,IAAI,MAAM,8CAA8C,GAAG,KAAA,EAAO;AAE5E,SAAOhE,IAAG,IAAIgE,OAAM,KAAA;AACvB;AAOD,IAAa,oBAAoB,CAAC,IAAI,YAAY;AAC9C,MAAI;AACA,uBAAmB,IAAI,OAAA;AACvB,WAAO;EACV,QACK;AACF,WAAO;EACV;AACJ;AACD,IAAa,qBAAqB,CAAC,IAAI,YAAY;AAC/C,MAAI,YAAY,KACZ,OAAM,IAAI,MAAM,iCAAiC;AACrD,MAAI,OAAO,YAAY,YACnB,OAAM,IAAI,MAAM,sCAAsC;AAE1D,MAAI,OAAO,YAAY,SACnB,OAAM,IAAI,UAAU,gDAAgD,OAAO,OAAA,EAAS;AAIxF,QAAMjO,KAAI,SAAS,EAAA;AACnB,MAAIA,GAAE,WAAW,EACb,OAAM,IAAI,MAAM,8BAA8B;AAClD,MAAI,CAACA,GAAE,SAAS,OAAA,EACZ,OAAM,IAAI,MAAM,iBAAiB,OAAA,qCAA4C,GAAG,KAAA,uBAA4BA,GAAE,KAAK,IAAI,CAAC,EAAE;AAEjI;AAkBD,IAAa,WAAW,IAAI,WAAW;AACnC,QAAM7C,KAAI,CAAE;AACZ,MAAI,CAAC,MAAM,QAAQ,MAAA,EACf,OAAM,IAAI,MAAM,2BAA2B;AAC/C,MAAI,OAAO,UAAU,EACjB,OAAM,IAAI,MAAM,6BAA6B;AACjD,WAAS,QAAQ,GAAG,QAAQ,OAAO,QAAQ,SAAS;AAChD,UAAMyG,KAAI,OAAO,KAAA;AACjB,QAAI,OAAOA,OAAM,SACb,OAAM,IAAI,UAAU,wCAAwC,OAAOA,EAAA,cAAe,MAAM,SAAA,CAAU,EAAE;AAExG,IAAAzG,GAAEyG,EAAA,IAAM,UAAU,OAAO,SAAS,IAAK,OAAO,OAAO,QAAQ,CAAA;EAChE;AACD,SAAOzG;AACV;AAkBD,IAAa,wBAAwB,IAAI,WAAW;AAChD,QAAMA,KAAI,CAAE;AACZ,MAAI,CAAC,MAAM,QAAQ,MAAA,EACf,OAAM,IAAI,MAAM,2BAA2B;AAC/C,MAAI,OAAO,SAAS,EAChB,OAAM,IAAI,MAAM,6BAA6B;AACjD,aAAW,CAAC,OAAOyG,EAAA,KAAM,OAAO,QAAA,GAAW;AACvC,QAAI,OAAOA,OAAM,SACb,OAAM,IAAI,UAAU,wCAAwC,OAAOA,EAAA,cAAe,MAAM,SAAA,CAAU,EAAE;AAExG,IAAAzG,GAAEyG,EAAA,IAAK,CAAE;EACZ;AACD,WAAS,QAAQ,GAAG,QAAQ,OAAO,QAAQ,SAAS;AAChD,UAAMlG,KAAIP,GAAE,OAAO,KAAA,CAAA;AACnB,QAAI,UAAU,OAAO,SAAS,EAC1B,KAAI,OAAO,SAAS,EAChB,CAAAO,GAAE,KAAK,OAAO,QAAQ,CAAA,CAAA;QAGtB,CAAAP,GAAE,OAAO,KAAA,CAAA,IAAU;SAGtB;AACD,MAAAO,GAAE,KAAK,OAAO,QAAQ,CAAA,CAAA;AACtB,UAAI,QAAQ,EACR,CAAAA,GAAE,KAAK,OAAO,QAAQ,CAAA,CAAA;IAC7B;EACJ;AACD,SAAOP;AACV;AChUD,eAAsB,OAAO,SAAS,gBAAgB;AAClD,QAAM,OAAO,MAAM,QAAQ,cAAA,IACrB,EACE,UAAU,eACb,IACC;AACN,QAAMF,UAAAA,iBAA+B,KAAK,OAAO,EAC7C,UAAU,qBACb,CAAA;AAGD,QAAM,UAAU,oBAAI,IAAA;AACpB,aAAWiR,MAAK,KAAK,UAAU;AAC3B,UAAM,UAAU,MAAM,QAAQA,GAAE,EAAA,IAAMA,GAAE,KAAK,CAACA,GAAE,EAAG;AACnD,eAAW,SAAS,SAAS;AACzB,UAAI,OAAO,UAAU,SACjB,OAAM,IAAI,UAAU,iEAAiE,OAAO,KAAA,IAAS;AAEzG,UAAI,QAAQ,IAAI,KAAA,EACZ,OAAM,IAAI,MAAM,wCAAwC,KAAA,iCAAsC;AAElG,cAAQ,IAAI,OAAOA,EAAA;IACtB;EACJ;AACD,QAAM,UAAU;IAEZ,MAAM,CAAC/P,IAAGC,OAAM;AACZ,aAAO,gBAAgBD,GAAE,SAAS,GAAGC,GAAE,SAAS,CAAA;IACnD;IACD,SAAS,KAAK,mBAAmB;EACpC;AACD,MAAI,KAAK+P,KAAY,OAAA;AAErB,aAAW,CAAC,OAAA,KAAY,QAEpB,KAAI,OAAO,GAAG,QAAQ,OAAA,MAAa,eAC/B,YAAY,aACZ,OAAM,IAAI,MAAM,mDAAmD,OAAA,iFAAwF;AAGnK,QAAM/B,QAAM,YAAY;AACpBnP,YAAM,eAAe,GAAG,KAAA,EAAO;AAC/B,UAAM,QAAQ,GAAG;AACjB,QAAI,UAAU,QAAQ,IAAI,KAAA;AAC1B,QAAI,YAAY,QAAW;AACvBA,cAAM,2BAA2B,KAAA,sBAA2B;AAE5D,gBAAU,QAAQ,IAAI,YAAY;IACrC;AACD,QAAI,YAAY,QAAW;AACvBA,cAAM,yBAAyB;AAC/B;IACH;AAGD,UAAM,uBAAuB,QAAQ,iBAAiB,UAChD;MACE,GAAG;MACH,MAAM,CAAC,WAAW;AACd,YAAI,CAAC,OACD,QAAO;AACX,YAAI,WAAW,OACX,QAAO;AACX,YAAI,UAAU,UAAU,OAAO,SAAS,OACpC,QAAO;AACX,eAAO;MACV;IACJ,IACC;AACN,UAAM,UAAU,MAAAmP,KAAkB,QAAQ,MAAM,sBAAsB,EAAA;AACtEnP,YAAM,eAAe,GAAG,KAAA,cAAmB,QAAQ,MAAA,aAAmB,QAAQ,YAAA,EAAc;AAG5F,QAAIoF;AACJ,YAAQ,QAAQ,gBAAgB,WAAhC;MACI,KAAK,WAAW;AACZ,QAAAA,KAAI,QAAQ,GAAG,EAAA;AACf;MACH;MACD,KAAK,SAAS;AACV,QAAAA,KAAI,QAAQ,CAAA;AACZ;MACH;MACD,KAAK,UAAU;AACX,QAAAA,KAAI,QAAQ,GAAG,CAAA;AACf;MACH;MACD,KAAK,UAAU;AACX,QAAAA,KAAI,cAAc,OAAA;AAClB;MACH;MACD;AACI,cAAM,IAAI,MAAM,kCAAkC,QAAQ,YAAA,6CAAyD;IAE1H;AACDpF,YAAM,oBAAoB,KAAK,UAAUoF,EAAA,CAAE,EAAE;AAE7C,QAAIA,IAAG,MACH,MAAK+L,MAAa,EAAA;aAEb/L,MAAKA,GAAE,KACZ,KAAI,OAAOA,GAAE,SAAS,UAClB,MAAKgM,MAAY,EAAA;SAEhB;AACDpR,cAAM,KAAK,UAAU,OAAA,CAAQ;AAC7B,WAAKqR,IAAU,IAAIjM,GAAE,IAAA;IACxB;AAEL,WAAO;EACV;AACD,SAAO;IACH,OAAO,MAAM;AACT,WAAK+L,MAAa,EAAA;IACrB;IACD,UAAU,MAAM,GAAG;IACnB,KAAA;IACA,IAAI,CAAC,UAAU;AACX,WAAKE,IAAU,IAAI,KAAA;AACnB,aAAO;IACV;EACJ;AACJ;ACpLD,IAAa,yBAAb,cAA4C,mBAAmB;EAC3D;EACA;EACA;EACA,qBAAqB;EACrB,UAAU;EACV,aAAa,gBAAA;;;;;;EAMb,YAAYlJ,IAAG,OAAO,CAAE,GAAE;AACtB,UAAA;AACA,SAAKmJ,SAAS,KAAK,SAAS;AAC5B,SAAKC,MAAAA,KAAwBpJ,IAAG,KAAK,OAAA;AACrC,SAAKqJ,aAAAA,WAAqC,KAAKD,GAAAA;EAClD;EACD,WAAW9Q,IAAG;AACV,QAAI,KAAKgR,YAAYhR,GACjB;AACJ,SAAKgR,UAAUhR;AACf,QAAIA,IAAG;AACH,WAAKiR,qBAAqB;AAC1B,iBAAW,MAAM;AACb,YAAI,CAAC,KAAKA,mBACN;AACJ,aAAKA,qBAAqB;AAE1B,aAAK,UAAU,QAAQ,EAAE,OAAO,KAAKH,IAAI,MAAO,CAAA;MACnD,GAAE,CAAA;IACN,MAEG,MAAKG,qBAAqB;EAEjC;;;;;;;EAOD,IAAI,iBAAiB;AACjB,WAAA,SAA6B,KAAKH,GAAAA;EACrC;;;;EAID,IAAI,gBAAgB;AAChB,WAAO,OAAO,KAAK,KAAKA,IAAI,OAAA;EAC/B;;;;;;;EAOD,OAAO;AACH,UAAMxO,KAAA,SAA0B,KAAKwO,GAAAA;AACrC,QAAIxO,GAAE,WAAW,EACb,QAAO;AACX,SAAK,QAAQA,GAAE,CAAA;AACf,WAAOA,GAAE,CAAA;EACZ;;;;;;EAMD,IAAI,SAAS;AACT,WAAA,OAA2B,KAAKwO,GAAAA;EACnC;;;;EAID,QAAQ;AACJ,SAAKI,WAAW,KAAA;AAChB,SAAKJ,MAAAA,WAA8B,KAAKC,UAAAA;AACxC,SAAKI,aAAa,aAAA;EACrB;;;;;;EAMD,mBAAmB,UAAU;uBACO,KAAKL,KAAK,QAAA;EAC7C;;;;;;;EAOD,QAAQ,UAAU;AACd,WAAA,kBAAsC,KAAKA,KAAK,QAAA;EACnD;;;;;;;EAOD,IAAI,MAAM,UAAU;AAChB,UAAM,aAAa,KAAKA,IAAI;AAC5B,QAAI,aAAa,KAAKA,IAAI,MACtB;AAEJ,SAAKA,MAAAA,IAAsB,KAAKA,KAAK,QAAA;AACrC,QAAI,KAAKD,OACL,SAAQ,IAAI,iBAAiB,UAAA,OAAiB,QAAA,EAAU;AAE5D,SAAKM,aAAa,aAAA;AAClB,eAAW,MAAM;AACb,WAAK,UAAU,UAAU;QAAY;QAAsB;MAAY,CAAA;IAC1E,GAAE,CAAA;AACH,QAAA,OAAwB,KAAKL,GAAAA,EACzB,MAAKI,WAAW,IAAA;EACvB;EACD,IAAI,QAAQ;AACR,WAAO,KAAKJ,IAAI;EACnB;;;;;EAKD,IAAI,YAAY;AACZ,WAAO,KAAKK,WAAAA;EACf;;;;;EAKD,IAAI,UAAU;AACV,WAAO,KAAKA,WAAAA;EACf;AACJ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AG7ID,IAAa,gBAAgB,CAAC,YAAY,OAAO,KAAK,WAAW;AAC7D,QAAM,aAAa,CAAE;AACrB,MAAIC,SAAQ;AAEZ,WAAS,QAAQ,GAAG,QAAQ,WAAW,QAAQ,SAAS;AACpD,IAAAA,UAAS,WAAW,KAAA;AACpB,eAAW,KAAA,IAASA;EACvB;AACD,MAAIA,WAAU,EACV,OAAM,IAAI,MAAM,uCAAuCA,MAAA,EAAO;AAClE,SAAO,MAAM;AACT,UAAMC,KAAI,KAAA;AAEV,aAAS,QAAQ,GAAG,QAAQ,WAAW,QAAQ,QAC3C,KAAIA,MAAK,WAAW,KAAA,EAChB,QAAO;AAEf,UAAM,IAAI,MAAM,2CAA2C;EAC9D;AACJ;ACfD,IAAaC,eAAc,CAACC,QAAO,OAAO,KAAK,WAAW,KAAK,MAAM,KAAA,IAASA,OAAM,MAAA;AAsBpF,SAAgB,YAAYA,QAAO,UAAU,CAAE,GAAE;AAC7C,MAAI,OAAOA,WAAU,YACjB,OAAM,IAAI,MAAM,4BAA4B;AAChD,MAAI,CAAC,MAAM,QAAQA,MAAA,EACf,OAAM,IAAI,MAAM,+BAA+B;AACnD,QAAM,SAAS,QAAQ,UAAU;AACjC,QAAM,OAAO,QAAQ,UAAU,KAAK;AACpC,MAAIA,OAAM,WAAW,GAAG;AACpB,QAAI,OACA,QAAO;AACX,WAAO;MAAE,OAAO;MAAW,WAAW,CAAE;IAAE;EAC7C;AACD,QAAM,QAAQD,aAAYC,QAAO,IAAA;AACjC,MAAI,QAAQ;AAER,UAAMF,KAAIE,OAAM,KAAA;AAChB,IAAAA,OAAM,OAAO,OAAO,CAAA;AACpB,WAAOF;EACV,OACI;AAED,UAAM,YAAY,CAAC,GAAGE,MAAM;AAC5B,cAAU,OAAO,OAAO,CAAA;AACxB,WAAO;MACH,OAAOA,OAAM,KAAA;MACb,WAAW;IACd;EACJ;AACJ;AAgBD,IAAaC,iBAAgB,CAACD,QAAO,OAAO,KAAK,WAAW;AACxD,cAAY,UAAUA,QAAO,OAAO,CAAC;AACrC,SAAOA,OAAM,KAAK,MAAM,KAAA,IAASA,OAAM,MAAA,CAAO;AACjD;AAaD,IAAa,8BAA8B,CAACA,QAAO,YAAY,eAAe,KAAK,WAAW;AAC1F,MAAIA,OAAM,WAAW,WAAW,OAC5B,OAAM,IAAI,MAAM,yDAAyD;AAC7E,QAAME,KAAI,cAAc,YAAY,YAAA;AACpC,SAAO,MAAM;AACT,UAAM,QAAQA,GAAA;AACd,WAAOF,OAAM,KAAA;EAChB;AACJ;AAcD,IAAaG,WAAU,CAAC,eAAe,OAAO,KAAK,WAAW;AAC1D,QAAMH,SAAQ,CAAC,GAAG,aAAc;AAChC,WAAS,QAAQA,OAAM,SAAS,GAAG,QAAQ,GAAG,SAAS;AACnD,UAAM,SAAS,KAAK,MAAM,KAAA,KAAU,QAAQ,EAAA;AAC5C,KAACA,OAAM,KAAA,GAAQA,OAAM,MAAA,CAAA,IAAW,CAACA,OAAM,MAAA,GAASA,OAAM,KAAA,CAAO;EAChE;AACD,SAAOA;AACV;AC3GD,IAAa,SAAS,CAACI,IAAGC,IAAGC,IAAG,iBAAiB;AAC7C,QAAM,SAAS,gBAAgB,KAAK;AACpC,QAAMC,WAAU,CAACC,OAAM;AACnB,QAAI,OAAOA,OAAM,WACb,QAAOA,GAAA;AACX,WAAOA;EACV;AACD,QAAM,KAAKD,SAAQH,EAAA;AACnB,cAAY,WAAW,IAAI,cAAc,GAAG,CAAC;AAC7C,MAAI,OAAA,KAAY,GACZ,QAAOG,SAAQD,EAAA;MAGf,QAAOC,SAAQF,EAAA;AAEtB;AChBD,IAAa,gBAAgB,CAAC,iBAAiB;AAC3C,QAAM,SAAS,YAAY,YAAA;AAC3B,SAAO,MAAO,OAAA,IAAW,IAAK;AACjC;AAiBD,IAAa,UAAU,CAAC,iBAAiB;AACrC,QAAM,SAAS,cAAc,YAAA;AAC7B,SAAO,OAAA;AACV;AA0BD,IAAa,cAAc,CAAC,eAAe,MAAM;AAC7C,QAAM,UAAU,OAAO,iBAAiB,WAAW,EAAE,KAAK,aAAc,IAAG;AAC3E,MAAII,SAAM,QAAQ,OAAO;AACzB,MAAIC,SAAM,QAAQ,OAAO;AACzB,QAAM,SAAS,QAAQ,UAAU,KAAK;AACtC,cAAY,WAAWA,QAAK,IAAI,KAAK,GAAG,WAAWD,QAAK,IAAI,KAAK,CAAC;AAClE,MAAI,CAAC,QAAQ,OAAOA,SAAM,GAAG;AACzBC,IAAAA,SAAMD;AACNA,IAAAA,SAAM;EACT;AACD,MAAIC,SAAMD,OACN,OAAM,IAAI,MAAM,iCAAiCC,OAAI,SAAA,CAAU,SAASD,OAAI,SAAA,CAAU,EAAE;AAE5F,SAAO,MAAM,OAAA,KAAYA,SAAMC,UAAOA;AACzC;AAuBD,IAAa,QAAQ,CAAC,eAAe,MAAM,YAAY,YAAA,EAAa;ACnGpE,IAAa,mBAAmB,CAAC,SAAS,KAAK,WAAW;AACtD,MAAIZ,KAAI;AACR,SAAOA,OAAM,EACT,CAAAA,KAAI,OAAA;AAER,SAAOA;AACV;ACMD,IAAa,WAAW,CAAC,OAAO,MAAM,eAAe,IAAA,EAAK;AA0B1D,IAAa,iBAAiB,CAAC,OAAO,MAAM;AACxC,QAAMY,SAAM;AACZ,QAAMD,SAAM;AAEZ,QAAM,UAAU,MAAM;AAClB,UAAME,KAAI,iBAAA;AACV,UAAMb,KAAI,iBAAA;AACV,QAAI,SAAS,KAAK,KAAK,KAAK,KAAK,IAAIa,EAAA,CAAE,IAAI,KAAK,IAAI,IAAI,KAAK,KAAKb,EAAA;AAClE,aAAS,SAAS,KAAK;AACvB,QAAI,SAAS,KAAK,SAAS,EACvB,UAAS,QAAA;SAER;AACD,eAAS,KAAK,IAAI,QAAQ,IAAA;AAC1B,gBAAUW,SAAMC;AAChB,gBAAUA;IACb;AACD,WAAO;EACV;AACD,SAAO;AACV;ACxDD,IAAa,YAAY,CAAC,UAAU,CAAE,MAAK;AACvC,QAAM,SAAS,QAAQ,UAAU,KAAK;AAEtC,QAAM,YAAY,KAAK,MAAM,OAAA,IAAW,KAAA;AACxC,QAAM,aAAa,KAAK,MAAM,OAAA,IAAW,KAAA;AACzC,QAAM,kBAAkB,MAAM,UAAU,SAAS,EAAA,CAAG,GAAG,MAAM,EAAA;AAC7D,QAAM,mBAAmB,MAAM,WAAW,SAAS,EAAA,CAAG,GAAG,MAAM,EAAA;AAC/D,SAAO,kBAAkB;AAC5B;ACkBD,UAAiBE,OAAM,QAAQC,UAAS,GAAG;AACvC,cAAY,YAAY,QAAQ,IAAI,QAAQ,GAAG,YAAYA,SAAQ,IAAI,QAAQ,CAAC;AAChF,MAAI,WAAW,EACX;AACJ,MAAI,QAAQ;AACZ;AACI,UAAO,SAAS,IAAI,CAAC,QAAQA,UAAS,QAAQA;SACzC,UAAU,KAAK,IAAI,MAAA,IAAU;AACzC;ACPD,IAAa,gBAAgB,CAAC,iBAAiB;AAC3C,MAAI,OAAO,iBAAiB,YACxB,OAAM,IAAI,UAAU,2BAA2B;AAEnD,QAAM,UAAU,OAAO,iBAAiB,WAAW,EAAE,KAAK,aAAc,IAAG;AAC3E,MAAIJ,SAAM,KAAK,MAAM,QAAQ,OAAO,GAAA;AACpC,MAAIC,SAAM,KAAK,MAAM,QAAQ,OAAO,CAAA;AAGpC,MAAI,CAAC,QAAQ,OAAOD,SAAM,GAAG;AACzBA,IAAAA,SAAM;AACNC,IAAAA,SAAM,QAAQ,OAAO;EACxB;AACD,QAAM,eAAe,QAAQ,UAAU,KAAK;AAC5C,MAAIA,SAAMD,OACN,OAAM,IAAI,MAAM,uCAAuCC,OAAI,SAAA,CAAU,SAASD,OAAI,SAAA,CAAU,GAAG;AAEnG,cAAY,WAAWC,QAAK,IAAI,KAAK,GAAG,WAAWD,QAAK,IAAI,KAAK,CAAC;AAClE,MAAIA,WAAQC,OACR,OAAM,IAAI,MAAM,0CAA0CD,OAAI,SAAA,CAAU,GAAG;AAG/E,QAAM,MAAM,KAAK,IAAIA,SAAMC,MAAAA;AAC3B,SAAO,MAAM,KAAK,MAAM,aAAA,IAAiB,GAAA,IAAOA;AACnD;AA0BD,IAAa,UAAU,CAAC,iBAAiB,cAAc,YAAA,EAAa;AAiCpE,UAAiB,iBAAiB,cAAc;AAC5C,QAAM,UAAU,OAAO,iBAAiB,WAAW,EAAE,KAAK,aAAc,IAAG;AAC3E,QAAMA,SAAM,QAAQ,OAAO;AAC3B,QAAMD,SAAM,QAAQ,OAAO;AAC3B,QAAM,SAAS,QAAQ,UAAU,KAAK;AACtC,QAAM,OAAO,QAAQ,QAAQ;AAC7B,cAAY,YAAYC,QAAK,IAAI,KAAK,GAAG,YAAYD,QAAK,IAAI,KAAK,CAAC;AACpE,MAAIC,SAAMD,OACN,OAAM,IAAI,MAAM,uCAAuCC,OAAI,SAAA,CAAU,SAASD,OAAI,SAAA,CAAU,EAAE;AAElG,QAAM,YAAY,CAAC,GAAGG,OAAMH,SAAMC,QAAKA,MAAAA,CAAK;AAC5C,MAAI,cAAcP,SAAQ,SAAA;AAC1B,MAAI,QAAQ;AACZ,SAAO,MAAM;AACT,QAAI,UAAU,YAAY,OACtB,KAAI,KACA,eAAcA,SAAQ,WAAW,MAAA;QAEjC;AAER,UAAM,YAAY,OAAA;EACrB;AACJ;ACnHD,SAAgB,gBAAgB,MAAM;AAClC,MAAI,CAAC,KACD,QAAO,KAAK,OAAA,IAAW;AAE3B,MAAIW,MAAK,IAAI,MAAM,GAAA;AACnB,EAAAA,IAAG,CAAA,IAAK,SAAS;AACjB,QAAM,KAAK;AACX,WAASC,QAAM,GAAGA,QAAM,KAAKA,SAAO;AAChC,UAAMC,MAAKF,IAAGC,QAAM,CAAA,IAAMD,IAAGC,QAAM,CAAA,MAAO;AAE1C,IAAAD,IAAGC,KAAAA,MAAW,KAAK,cAAcC,QAAQ,OAAQ,KAAK,SAAcA,QAAQ,KAAKD,UAAS;EAC7F;AACD,MAAI,MAAM;AACV,QAAM,eAAe,MAAM;AACvB,QAAIE;AACJ,QAAI,OAAO,KAAK;AACZ,eAASC,KAAI,GAAGA,KAAI,KAAKA,MAAK;AAC1B,QAAAD,MAAMH,IAAGI,EAAA,IAAK,aAAeJ,IAAGI,KAAI,CAAA,IAAK,gBAAiB;AAC1D,QAAAJ,IAAGI,EAAA,KAAMJ,IAAGI,KAAI,GAAA,IAAQD,OAAM,KAAMA,KAAI,IAAI,aAAa,QAAQ;MACpE;AACD,eAASC,KAAI,KAAKA,KAAI,KAAKA,MAAK;AAC5B,QAAAD,MAAMH,IAAGI,EAAA,IAAK,aAAeJ,IAAGI,KAAI,CAAA,IAAK,gBAAiB;AAC1D,QAAAJ,IAAGI,EAAA,KAAMJ,IAAGI,KAAI,GAAA,IAAQD,OAAM,KAAMA,KAAI,IAAI,aAAa,QAAQ;MACpE;AACD,MAAAA,MAAMH,IAAG,GAAA,IAAO,aAAeA,IAAG,CAAA,IAAK,gBAAiB;AACxD,MAAAA,IAAG,GAAA,KAAQA,IAAG,GAAA,IAAQG,OAAM,KAAMA,KAAI,IAAI,aAAa,QAAQ;AAC/D,YAAM;IACT;AACD,IAAAA,KAAIH,IAAG,KAAA;AACP,IAAAG,MAAKA,KAAKA,OAAM,QAAS;AACzB,IAAAA,MAAKA,KAAMA,MAAK,IAAK,gBAAiB;AACtC,IAAAA,MAAKA,KAAMA,MAAK,KAAM,gBAAiB;AACvC,IAAAA,MAAKA,KAAKA,OAAM,QAAS;AACzB,WAAOA;EACV;AACD,QAAME,UAAQ,MAAM,aAAA,IAAiB;AAErC,QAAMC,YAAU,CAAC,cAAc,eAAe,MAAM;AAChD,QAAI,eAAe,EACf,OAAM,IAAI,MAAM,gDAAA;AACpB,QAAI,eAAe,WACf,OAAM,IAAI,MAAM,iDAAA;AACpB,QAAI,iBAAiB,EACjB,QAAO;AACX,QAAI,QAAQ,eAAe;AAC3B,UAAM,aAAa,KAAK,KAAK,KAAK,KAAK,KAAA,CAAM,GAAG,WAAW,KAAK,cAAc;AAC9E,WAAO,MAAM;AACT,YAAM,MAAM,aAAA,IAAiB;AAC7B,UAAI,MAAM,MACN,QAAO,eAAe;IAC7B;EACJ;AACD,SAAO;IAAE,SAAA;IAAS,OAAA;EAAO;AAC5B;ACnED,IAAa,SAAS,CAAC,kBAAkB,MAAM;AAC3C,QAAM,UAAU,OAAO,oBAAoB,WAAW,EAAE,QAAQ,gBAAiB,IAAG;AACpF,QAAM,YAAY,QAAQ,UAAU,KAAK;AACzC,QAAMC,UAAS,QAAQ,UAAU;AACjC,MAAI,cAAc;AAClB,SAAO,YAAY,SAASA,QACxB,gBAAe,UAAA,EACV,SAAS,EAAA,EACT,MAAM,CAAA;AAEf,SAAO,YAAY,UAAU,GAAGA,OAAA;AACnC;ACWD,IAAa,kBAAkB,CAAC,wBAAwB;AACpD,QAAM,UAAU,OAAO,wBAAwB,WACzC,EAAE,KAAK,oBAAqB,IAC5B;AACN,QAAMX,UAAO,QAAQ,OAAO,KAAK,KAAK;AACtC,QAAMD,UAAO,QAAQ,OAAO,KAAK,KAAK;AACtC,SAAO,cAAc;IAAE,GAAG;IAAS,KAAAa;IAAK,KAAAC;EAAK,CAAA;AAChD;AAoBD,IAAa,YAAY,CAAC,wBAAwB,gBAAgB,mBAAA,EAAoB;AAgCtF,IAAa,kBAAkB,CAAC,wBAAwB;AACpD,QAAM,UAAU,OAAO,wBAAwB,WACzC,EAAE,KAAK,oBAAqB,IAC5B;AACN,QAAMb,UAAO,QAAQ,OAAO,KAAK;AACjC,QAAMD,UAAO,QAAQ,OAAO,KAAK;AACjC,SAAO,MAAM,QAAQ;IAAE,GAAG;IAAS,KAAAa;IAAK,KAAAC;EAAK,CAAA;AAChD;AAiBD,IAAa,YAAY,CAAC,wBAAwB,gBAAgB,mBAAA,EAAoB;ACpHtF,SAAgBC,OAAM1B,IAAGY,SAAM,GAAGD,SAAM,GAAG;AACvC,MAAIX,KAAIY,OACJ,QAAOA;AACX,MAAIZ,KAAIW,OACJ,QAAOA;AACX,SAAOX;AACV;ACuBD,IAAa,wBAAwB,CAAC,YAAY;AAC9C,QAAM,SAAS,QAAQ,UAAU,KAAK;AACtC,MAAI,OAAO,QAAQ,mBAAmB,YAClC,OAAM,IAAI,MAAM,qCAAqC;AACzD,QAAMW,SAAM,QAAQ,OAAO;AAC3B,QAAMC,SAAM,QAAQ,OAAO;AAC3B,MAAID,WAAQC,OACR,OAAM,IAAI,MAAM,mCAAmC;AACvD,MAAID,SAAMC,OACN,OAAM,IAAI,MAAM,2CAA2C;AAC/D,QAAM,UAAU,MAAM;AAClB,UAAMR,KAAIsB,OAAM,QAAQ,eAAe,OAAA,CAAQ,CAAC;AAChD,WAAO,KAAK,MAAMtB,MAAKO,SAAMC,OAAAA,IAAQA;EACxC;AACD,SAAO;AACV;AAqBD,IAAa,kBAAkB,CAAC,YAAY,sBAAsB,OAAA,EAAQ;ACxD1E,IAAa,WAAW,CAAC,YAAY,eAAe,OAAA,EAAQ;AAS5D,IAAa,iBAAiB,CAAC,YAAY;AACvC,QAAM,SAAS,QAAQ,UAAU,KAAK;AACtC,MAAI,OAAO,QAAQ,WAAW,YAC1B,OAAM,IAAI,MAAM,wEAAwE;AAC5F,MAAI,OAAO,QAAQ,mBAAmB,YAClC,OAAM,IAAI,MAAM,qCAAqC;AACzD,SAAO,MAAM,QAAQ,eAAe,OAAA,CAAQ;AAC/C;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AEZD,SAAgB,mBAAmB,SAAS,WAAW,cAAc;AACjE,SAAO,CAACZ,OAAM;AACV,UAAMI,KAAI,QAAQJ,EAAA;AAClB,QAAII,GAAE,QACF,WAAUJ,IAAGI,GAAE,SAASA,GAAE,KAAA;aAErB,OAAO,iBAAiB,YAC7B,cAAaJ,IAAGI,GAAE,cAAcA,GAAE,KAAA;EAEzC;AACJ;AAqBD,SAAgB,kBAAkB,UAAU,CAAE,GAAE;AAC5C,QAAM,cAAc,QAAQ,eAAe;AAC3C,QAAM,2BAA2B,QAAQ,4BAA4B;AACrE,MAAI,YAAY,QAAQ;AACxB,MAAI,UAAU;AACd,MAAIL,SAAQ;AACZ,MAAI,eAAe;AACnB,SAAO,CAACC,OAAM;AACV,QAAI,OAAOA,OAAM,SACb,OAAM,IAAI,UAAU,yCAAyC,OAAOA,EAAA,EAAG;AAC3E,QAAI,OAAO,MAAMA,EAAA,EACb,SAAQ,aAAR;MACI,KAAK;AACD,cAAM,IAAI,MAAM,kBAAkB;MACtC,KAAK;AACD,eAAO;UAAE,SAAS;UAAO;UAAS,OAAAD;UAAO;QAAc;IAC9D;AAEL,IAAAA;AACA,QAAI,KAAK,cAAcC;AAEvB,QAAI,OAAO,MAAM,SAAA,KAAc,OAAO,MAAMA,EAAA,EACxC,MAAK;AACT,QAAI,CAAC,IAAI;AACL,qBAAe;AACf,UAAI,cAAc,UAAa,yBAC3B;AAEJ,kBAAYA;AACZ,aAAO;QAAE,SAAS;QAAM;QAAS,OAAAD;QAAO;MAAc;IACzD,MAEG;AAEJ,WAAO;MAAE,SAAS;MAAO;MAAS,OAAAA;MAAO;IAAc;EAC1D;AACJ;AAeD,SAAgB,mBAAmB,UAAU,CAAE,GAAE;AAC7C,QAAM,2BAA2B,QAAQ,4BAA4B;AACrE,MAAI,YAAY,QAAQ;AACxB,MAAI,UAAU;AACd,MAAIA,SAAQ;AACZ,MAAI,eAAe;AACnB,SAAO,CAACC,OAAM;AACV,QAAI,OAAOA,OAAM,UACb,OAAM,IAAI,UAAU,0CAA0C,OAAOA,EAAA,EAAG;AAC5E,IAAAD;AACA,QAAI,cAAcC,IAAG;AACjB,qBAAe;AACf,UAAI,cAAc,UAAa,yBAC3B;AAEJ,kBAAYA;AACZ,aAAO;QAAE,SAAS;QAAM;QAAS,OAAAD;QAAO;MAAc;IACzD,MAEG;AAEJ,WAAO;MAAE,SAAS;MAAO;MAAS,OAAAA;MAAO;IAAc;EAC1D;AACJ;AC7ED,IAAa,mBAAb,cAAsC,mBAAmB;EACrD;EACA;;;;;EAKA,YAAY,WAAW;AACnB,UAAA;AACA,SAAK4B,SAAS,oBAAI,IAAA;AAClB,QAAI,OAAO,cAAc,YACrB,aAAY,CAACpB,OAAM;AACf,UAAIA,OAAM,OACN,OAAM,IAAI,MAAM,iCAAiC;AACrD,aAAO,OAAOA,OAAM,WAAWA,KAAI,KAAK,UAAUA,EAAA;IACrD;AAEL,SAAKqB,aAAa;EACrB;;;;EAID,QAAQ;AACJ,SAAKD,OAAO,MAAA;AACZ,SAAK,UAAU,UAAU,EAAE,SAAS,KAAM,CAAA;EAC7C;;;;EAID,OAAO;AACH,WAAO,KAAKA,OAAO,KAAA;EACtB;;;;EAID,SAAS;AACL,WAAO,KAAKA,OAAO,OAAA;EACtB;;;;EAID,UAAU;AACN,WAAO,CAAC,GAAG,KAAKA,OAAO,QAAA,CAAU;EACpC;;;;;EAKD,cAAc;AACV,QAAIE,MAAI;AACR,eAAW,CAAC,KAAKf,OAAAA,KAAU,KAAKa,OAAO,QAAA,EACnCE,QAAK,GAAG,GAAA,KAAQf,QAAM,SAAA,CAAU;AAEpC,QAAIe,IAAE,SAAS,IAAI,EACf,QAAOA,IAAE,MAAM,GAAG,KAAK,IAAI,GAAGA,IAAE,SAAS,CAAA,CAAE;AAC/C,WAAOA;EACV;;;;;;EAMD,YAAYC,QAAO;AACf,QAAI,OAAOA,WAAU,SACjB,QAAO,KAAKH,OAAO,IAAIG,MAAA;AAC3B,UAAM,MAAM,KAAKF,WAAWE,MAAA;AAC5B,WAAO,KAAKH,OAAO,IAAI,GAAA;EAC1B;;;;;;EAMD,oBAAoBG,QAAO;AACvB,QAAI;AACJ,QAAI,OAAOA,WAAU,SACjB,QAAO,KAAKH,OAAO,IAAIG,MAAA;SACtB;AACD,YAAM,MAAM,KAAKF,WAAWE,MAAA;AAC5B,aAAO,KAAKH,OAAO,IAAI,GAAA;IAC1B;AACD,QAAI,SAAS,OACT;AACJ,UAAM,MAAM,KAAK,cAAA;AACjB,WAAO,OAAO,IAAI;EACrB;;;;;EAKD,UAAU;AACN,WAAO,CAAC,GAAG,KAAKA,OAAO,QAAA,CAAU;EACpC;;;;;EAKD,gBAAgB;AACZ,UAAM,kBAAkB,CAAC,GAAG,KAAK,OAAA,CAAS;AAC1C,WAAO,mBAAmB,eAAA;EAC7B;;;;;;EAMD,cAAc,YAAY,SAAS;AAC/B,UAAMI,KAAI,eAAe,SAAA;AACzB,WAAOA,GAAE,KAAK,QAAA,CAAS;EAC1B;;;;;EAKD,OAAOC,SAAQ;AACX,QAAI,OAAOA,YAAW,YAClB,OAAM,IAAI,MAAM,0BAA0B;AAC9C,UAAM,OAAOA,QAAO,IAAI,CAAAhC,OAAK,KAAK4B,WAAW5B,EAAA,CAAE;AAE/C,eAAW,OAAO,MAAM;AACpB,YAAM,QAAQ,KAAK2B,OAAO,IAAI,GAAA,KAAQ;AACtC,WAAKA,OAAO,IAAI,KAAK,QAAQ,CAAA;IAChC;AACD,SAAK,UAAU,UAAU,EAAE,SAAS,KAAM,CAAA;EAC7C;AACJ;AACD,IAAa,YAAY,CAAC,cAAc,IAAI,iBAAiB,SAAA;ACpK7D,IAAa,cAAb,MAAyB;;;;EAIrB;;;;EAIA;;;;EAIA;;;;EAIA;EACA;EACA;EACA,YAAY,OAAO,CAAE,GAAE;AACnB,SAAK,KAAK,KAAK,MAAM;AACrB,SAAK,QAAQ,KAAK,SAAS;AAC3B,SAAK,cAAc,KAAK,eAAe;AACvC,SAAK,oBAAoB,KAAK,qBAAqB;AACnD,SAAK,oBACD,KAAK,sBACA,KAAK,cAAc,MAAM,KAAK,oBAAoB;AAC3D,SAAK,YAAY;AACjB,QAAI,KAAK,MACL,SAAQ,IAAI,6BAA6B,KAAK,WAAA,gBAA2B,KAAK,iBAAA,WAA4B,KAAK,iBAAA,EAAmB;EAEzI;;;;EAID,QAAQ;AACJ,SAAK,YAAY;AACjB,SAAK,QAAA;EACR;;;;;;;;;;EAUD,QAAQrB,IAAG;AACP,QAAI,KAAK,oBAAoB,KAAK,KAAK,YAAY,KAAK,kBACpD,MAAK,MAAA;aAEA,KAAK,cAAc,KAAK,KAAK,YAAY,KAAK,cAAc,GAAG;AACpE,WAAK,YAAY,KAAK,UAAU,KAAK,WAAA;AACrC,WAAK,UAAU,QAAQ;IAC1B;AACD,SAAK,aAAaA,GAAE;AACpB,UAAMuB,MAAI,KAAK,WAAWvB,EAAA;AAC1B,WAAO,KAAK,eAAeuB,GAAAA;EAC9B;AACJ;AC9DD,IAAa,mBAAb,cAAsC,YAAY;EAC9C;EACA;EACA,YAAY,MAAM;AACd,UAAM,IAAA;AACN,SAAK,SAAS,CAAE;AAChB,SAAK,aAAa,CAAE;EACvB;;;;;;EAMD,UAAUI,QAAO;AACb,QAAIA,UAAS,KAAK,OAAO,OACrB,QAAO,KAAK,OAAO;AACvB,SAAK,SAAS,KAAK,OAAO,MAAM,CAACA,MAAA;AACjC,SAAK,aAAa,KAAK,WAAW,MAAM,CAACA,MAAA;AACzC,WAAO,KAAK,OAAO;EACtB;EACD,UAAU,QAAQ;EAEjB;EACD,IAAI,OAAO;AACP,WAAO,KAAK,OAAO,GAAG,EAAA;EACzB;EACD,IAAI,UAAU;AACV,WAAO,KAAK,OAAO,GAAG,CAAA;EACzB;;;;EAID,IAAI,OAAO;AACP,WAAO,KAAK,OAAO;EACtB;;;;EAID,IAAI,UAAU;AACV,QAAI,KAAK,OAAO,SAAS,EACrB,OAAM,IAAI,MAAM,oBAAoB;AACxC,WAAO,KAAK,IAAA,IAAQ,KAAK,WAAW,CAAA;EACvC;;;;;EAKD,IAAI,WAAW;AACX,UAAM,SAAS,KAAK,WAAW,GAAG,CAAA;AAClC,UAAM,SAAS,KAAK,WAAW,GAAG,EAAA;AAClC,QAAI,WAAW,OACX,QAAO;AACX,QAAI,WAAW,OACX,QAAO;AACX,WAAO,SAAS;EACnB;EACD,UAAU;AACN,SAAK,SAAS,CAAE;AAChB,SAAK,aAAa,CAAE;EACvB;;;;EAID,WAAW,WAAW;AAClB,UAAM,YAAY,UAAU,GAAG,EAAA;AAC/B,UAAMC,QAAO;MAAE,OAAO;MAAW,IAAI,YAAY,IAAA;IAAO;AACxD,UAAMF,UAAS,UAAU,IAAI,CAAAF,YAAU;MACnC,IAAI,YAAY,IAAA;MACT,OAAAA;IACV,EAAA;AAED,QAAI,KAAK,mBAAmB;AACxB,WAAK,OAAO,KAAK,GAAG,SAAA;AACpB,WAAK,WAAW,KAAK,GAAGE,QAAO,IAAI,CAAAhC,OAAKA,GAAE,EAAA,CAAG;IAChD,MAEG,SAAQ,KAAK,OAAO,QAApB;MACI,KAAK,GAAG;AAEJ,aAAK,OAAO,KAAKkC,MAAK,KAAA;AACtB,aAAK,WAAW,KAAKA,MAAK,EAAA;AAC1B;MACH;MACD,KAAK,GAAG;AAEJ,aAAK,OAAO,CAAA,IAAKA,MAAK;AACtB,aAAK,WAAW,CAAA,IAAKA,MAAK;AAC1B;MACH;MACD,KAAK,GAAG;AAEJ,aAAK,OAAO,KAAKA,MAAK,KAAA;AACtB,aAAK,WAAW,KAAKA,MAAK,EAAA;AAC1B;MACH;IAEJ;AACL,WAAOF;EACV;AACJ;AClGD,IAAa,gBAAb,cAAmC,iBAAiB;EAChD,SAAS;EACT,OAAO,OAAO;EACd,OAAO,OAAO;;;;;;EAMd,aAAa;AACT,QAAI,KAAK,SAAS,OACd;AACJ,QAAI,KAAK,YAAY,OACjB;AACJ,WAAO,KAAK,OAAO,KAAK;EAC3B;;;;;EAKD,qBAAqB;AACjB,QAAI,KAAK,SAAS,OACd;AACJ,QAAI,KAAK,YAAY,OACjB;AACJ,WAAO,KAAK,OAAO,KAAK;EAC3B;EACD,UAAU;AACN,SAAKG,OAAO,OAAO;AACnB,SAAKC,OAAO,OAAO;AACnB,SAAKC,SAAS;AACd,UAAM,QAAA;EACT;;;;;;EAMD,UAAU,QAAQ;AACd,SAAKF,OAAO,QAAQ,KAAK,MAAA;AACzB,SAAKC,OAAO,QAAQ,KAAK,MAAA;AACzB,SAAKC,SAAS,UAAU,KAAK,MAAA;EAChC;EACD,eAAeL,SAAQ;AACnB,QAAIA,QAAO,KAAK,CAAChC,OAAM,OAAO,MAAMA,EAAA,CAAE,EAClC,OAAM,IAAI,MAAM,gBAAgB;AACpC,UAAM,UAAUgC,QAAO,IAAI,CAAAF,WAASA,OAAM,KAAA;AAC1C,SAAKO,SAAS,QAAQ,OAAO,CAAC,aAAarC,OAAM,cAAcA,IAAG,KAAKqC,MAAAA;AACvE,SAAKF,OAAO,KAAK,IAAI,GAAG,SAAS,KAAKA,IAAAA;AACtC,SAAKC,OAAO,KAAK,IAAI,GAAG,SAAS,KAAKA,IAAAA;AACtC,WAAO;MACH,KAAK,KAAKA;MACV,KAAK,KAAKD;MACV,OAAO,KAAKE;MACZ,KAAK,KAAK;IACb;EACJ;EACD,eAAe;AACX,WAAO;MACH,KAAK,KAAKF;MACV,KAAK,KAAKC;MACV,KAAK,KAAK;IACb;EACJ;EACD,IAAI,MAAM;AACN,WAAO,KAAKA;EACf;EACD,IAAI,QAAQ;AACR,WAAO,KAAKC;EACf;EACD,IAAI,MAAM;AACN,WAAO,KAAKF;EACf;EACD,IAAI,MAAM;AACN,WAAO,KAAKE,SAAS,KAAK;EAC7B;AACJ;AAkDD,IAAa,SAAS,CAAC,OAAO,CAAE,MAAK,IAAI,cAAc,IAAA;AC5HvD,IAAa,kBAAb,cAAqC,cAAc;EAC/C,WAAW;EACX,OAAO;AACH,QAAI,KAAK,WAAW,EAChB,MAAK,KAAK,YAAY,IAAA,IAAQ,KAAK,QAAA;AAEvC,SAAK,WAAW,YAAY,IAAA;EAC/B;AACJ;AA+BD,IAAa,WAAW,CAAC,YAAY,IAAI,gBAAgB,OAAA;ACXzD,IAAa,cAAb,MAAyB;EACrB,UAAU,CAAE;EACZ;EACA;EACA;EACA;EACA,YAAY,OAAO,CAAE,GAAE;AACnB,SAAKC,qBAAqB,KAAK,qBAAqB,OAAO;AAC3D,SAAKC,eAAe,KAAK,eAAe,OAAO;AAC/C,QAAI,KAAK,gBACL,MAAKC,cAAc,QAAQ,MAAM;AAC7B,WAAK,MAAA;IACR,GAAE,KAAK,eAAA;AAEZ,SAAKC,YAAY,YAAY,IAAA;EAChC;;;;EAID,OAAO;AACH,QAAI,KAAKC,QAAQ,UAAU,KAAKJ,mBAC5B,MAAK,MAAA;aAEA,KAAKI,QAAQ,UAAU,KAAKH,cAAc;AAC/C,WAAKG,UAAU,KAAKA,QAAQ,MAAM,CAAA;AAClC,WAAKD,YAAY,KAAKC,QAAQ,CAAA;IACjC;AACD,SAAKA,QAAQ,KAAK,YAAY,IAAA,CAAK;AACnC,QAAI,KAAKF,YACL,MAAKA,YAAY,MAAA;EAExB;;;;;EAKD,mBAAmB;AACf,UAAM,YAAY,CAAE;AACpB,QAAI5B,SAAM,OAAO;AACjB,QAAID,SAAM,OAAO;AACjB,QAAIZ,SAAQ;AACZ,QAAIe,UAAQ;AACZ,QAAI,QAAQ;AACZ,eAAW6B,UAAS,KAAKD,SAAS;AAC9B,UAAI5B,UAAQ,GAAG;AACX,cAAM,QAAQ6B,SAAQ;AACtB/B,QAAAA,SAAM,KAAK,IAAI,OAAOA,MAAAA;AACtBD,QAAAA,SAAM,KAAK,IAAI,OAAOA,MAAAA;AACtB,QAAAZ,UAAS;AACT,kBAAU,KAAK,KAAA;MAClB;AACD,cAAQ4C;AACR7B;IACH;AACD,UAAM,MAAMf,SAAQe;AACpB,WAAO;MACH,KAAAW;MAAK,KAAAD;MAAK;IACb;EACJ;;;;;;EAMD,IAAI,UAAU;AACV,WAAO,YAAY,IAAA,IAAQ,KAAKiB;EACnC;;;;EAID,QAAQ;AACJ,SAAKC,UAAU,CAAE;AACjB,SAAKD,YAAY,YAAY,IAAA;EAChC;;;;EAID,IAAI,YAAY;AACZ,WAAO,KAAKC,QAAQ,UAAU,KAAK,UAAU;EAChD;;;;EAID,IAAI,YAAY;AACZ,WAAO,KAAKA,QAAQ,UAAU,KAAK,UAAU,MAAO;EACvD;AACJ;AAMD,IAAa,OAAO,CAAC,OAAO,CAAE,MAAK,IAAI,YAAY,IAAA;ACxHnD,IAAa,gBAAb,cAAmC,YAAY;EAC3C;EACA,YAAY,OAAO,CAAE,GAAE;AACnB,UAAM,IAAA;AACN,SAAK,SAAS,CAAE;EACnB;EACD,UAAU,QAAQ;EAEjB;;;;;;EAMD,UAAUT,QAAO;AACb,QAAIA,UAAS,KAAK,OAAO,OACrB,QAAO,KAAK,OAAO;AAEvB,SAAK,SAAS,KAAK,OAAO,MAAM,CAACA,MAAA;AACjC,WAAO,KAAK,OAAO;EACtB;;;;;EAKD,UAAU;AACN,SAAK,SAAS,CAAE;EACnB;;;;;EAKD,WAAW3B,IAAG;AAEV,UAAMsC,MAAKtC,GAAE,IAAI,CAACN,OAAM,QAAQA,KAC1BA,KACA;MACE,GAAGA;MACH,IAAI,KAAK,IAAA;IACZ,CAAA;AAEL,UAAMkC,QAAOU,IAAG,GAAG,EAAA;AACnB,QAAI,KAAK,kBACL,MAAK,OAAO,KAAK,GAAGA,GAAA;QAEpB,SAAQ,KAAK,OAAO,QAApB;MACI,KAAK,GAAG;AAEJ,aAAK,OAAO,KAAKV,KAAA;AACjB;MACH;MACD,KAAK,GAAG;AAEJ,aAAK,OAAO,KAAKA,KAAA;AACjB;MACH;MACD,KAAK,GAAG;AAEJ,aAAK,OAAO,CAAA,IAAKA;AACjB;MACH;IACJ;AACL,WAAOU;EACV;;;;EAID,IAAI,OAAO;AACP,QAAI,KAAK,OAAO,WAAW,EACvB,QAAO,KAAK,OAAO,CAAA;AAEvB,WAAO,KAAK,OAAO,GAAG,EAAA;EACzB;;;;EAID,IAAI,UAAU;AACV,WAAO,KAAK,OAAO,GAAG,CAAA;EACzB;;;;EAID,IAAI,OAAO;AACP,WAAO,KAAK,OAAO;EACtB;;;;EAID,IAAI,UAAU;AACV,WAAO,KAAK,IAAA,IAAQ,KAAK,OAAO,CAAA,EAAG;EACtC;;;;;EAKD,IAAI,WAAW;AACX,UAAM,SAAS,KAAK;AACpB,UAAM,SAAS,KAAK;AACpB,QAAI,CAAC,OACD,QAAO;AACX,QAAI,CAAC,OACD,QAAO;AACX,WAAO,OAAO,KAAK,OAAO;EAC7B;AACJ;ACpFD,IAAa,kBAAb,MAA6B;EACzB;EACA;EACA,YAAY,SAAS;AACjB,SAAK,QAAQ,oBAAI,IAAA;AACjB,SAAK,MAAM,kBAAkB,KAAK,OAAO,OAAA;EAC5C;;;;EAID,IAAI,OAAO;AACP,WAAO,KAAK,MAAM;EACrB;;;;;;EAMD,IAAI,IAAI;AACJ,WAAO,KAAK,MAAM,IAAI,EAAA;EACzB;;;;;;;EAOD,KAAK,OAAOZ,SAAQ;AAChB,UAAM,eAAe,KAAK,gBAAgB,IAAI,GAAGA,OAAA;AAEjD,UAAM,SAAS,aAAa,KAAK,GAAGA,OAAA;AACpC,WAAO;EACV;;;;;;;EAOD,gBAAgB,OAAOA,SAAQ;AAC3B,QAAI,OAAO,KACP,OAAM,IAAI,MAAM,6BAA6B;AACjD,QAAI,OAAO,OACP,OAAM,IAAI,MAAM,kCAAkC;AAEtD,UAAM,eAAe,KAAK,IAAI,IAAIA,QAAO,CAAA,CAAA;AACzC,WAAO;EACV;;;;;;EAMD,OAAO,IAAI;AACP,SAAK,MAAM,OAAO,EAAA;EACrB;;;;;EAKD,QAAQ;AACJ,SAAK,QAAQ,oBAAI,IAAA;EACpB;;;;EAID,CAAC,MAAM;AACH,WAAO,KAAK,MAAM,KAAA;EACrB;;;;EAID,CAAC,UAAU;AACP,WAAO,KAAK,MAAM,OAAA;EACrB;;;;;EAKD,CAAC,eAAe;AACZ,UAAM,KAAK,CAAC,GAAG,KAAK,MAAM,OAAA,CAAS;AACnC,OAAG,KAAK,CAACzB,IAAGC,OAAM;AACd,YAAMqC,MAAKtC,GAAE;AACb,YAAM,KAAKC,GAAE;AACb,UAAIqC,QAAO,GACP,QAAO;AACX,UAAIA,MAAK,GACL,QAAO;AACX,aAAO;IACV,CAAA;AACD,eAAWhB,OAAK,GACZ,OAAMA;EAEb;;;;;;EAMD,CAAC,cAAc;AACX,eAAW,MAAM,KAAK,aAAA,EAClB,OAAM,GAAG;EAEhB;;;;;;;;;;EAUD,CAAC,OAAO;AACJ,eAAWvB,MAAK,KAAK,MAAM,OAAA,EACvB,OAAMA,GAAE;EAEf;;;;EAID,CAAC,gBAAgB;AACb,eAAWA,MAAK,KAAK,MAAM,OAAA,EACvB,OAAMA,GAAE;EAEf;;;;;;EAMD,IAAI,IAAI;AACJ,WAAO,KAAK,MAAM,IAAI,EAAA;EACzB;AACJ;;;;;;;;;;;;;;;;;;;AE3JD,IAAM,EAAE,KAAA,OAAK,KAAA,OAAK,KAAA,OAAK,MAAA,QAAM,OAAO,MAAA,QAAM,IAAA,IAAQ;AAGlD,SAAS,IAAIN,IAAG;AACd,SAAOA,KAAI,IAAI,CAAC,IAAI,CAACA,IAAG,IAAI,CAAA,IAAK,IAAIA,IAAG,IAAI,CAAA;AAC7C;AAGD,IAAM8C,OAAK,KAAK;AAAhB,IACE,MAAM,IAAIA;AADZ,IAEE,QAAQA,OAAK;AAFf,IAIE,UAAU;AAJZ,IAME,OAAO,OAAO,oBAAoB;AANpC,IAOE,OAAO,OAAO,oBAAoB;AAPpC,IASE,OAAO;EAAE,GAAG;EAAG,GAAG;EAAG,GAAG;AAAG;AAG7B,IAAM,QAAQ;EAEZ,SAAS;IACP;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;EACD;EAGD,SAAS;IACP;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;EACD;EAED,OAAO,SAAUjB,KAAG,cAAc;AAChC,UAAMkB,KAAI,aAAalB,GAAAA;AACvB,QAAImB,KAAID,GAAE,IAAIA,GAAE,IAAIA,GAAE,IAAIA,GAAE;AAC5B,QAAI,OAAOA,GAAE,MAAM,YACjB,CAAAC,MAAKD,GAAE,IAAIA,GAAE;AAEf,WAAOE,OAAKD,EAAA;EACb;EAED,SAAS,SAAUnB,KAAG,QAAQ,KAAK;AAEjC,QAAIA,QAAM,GAAG;AACX,aAAO,CAAA,EAAG,IAAI;AACd,aAAO,OAAO,CAAA;IACf;AAED,UAAM,QAAQ,OAAO,SAAS;AAE9B,QAAIA,QAAM,GAAG;AACX,aAAO,KAAA,EAAO,IAAI;AAClB,aAAO,OAAO,KAAA;IACf;AAED,UAAMb,MAAK,IAAIa;AACf,QAAIvB,KAAI;AAGR,QAAI,UAAU,GAAG;AACf,aAAO,CAAA,EAAG,IAAIuB;AACd,aAAO,OAAO,CAAA;IACf;AAGD,QAAI,UAAU,GAAG;AACf,YAAM,MAAM;QACV,GAAGb,MAAKV,GAAE,CAAA,EAAG,IAAIuB,MAAIvB,GAAE,CAAA,EAAG;QAC1B,GAAGU,MAAKV,GAAE,CAAA,EAAG,IAAIuB,MAAIvB,GAAE,CAAA,EAAG;QAC1B,GAAGuB;MACJ;AACD,UAAI,IACF,KAAI,IAAIb,MAAKV,GAAE,CAAA,EAAG,IAAIuB,MAAIvB,GAAE,CAAA,EAAG;AAEjC,aAAO;IACR;AAGD,QAAI,QAAQ,GAAG;AACb,UAAI4C,OAAMlC,MAAKA,KACbmC,MAAKtB,MAAIA,KACTtB,IACAC,IACA4C,IACAL,KAAI;AACN,UAAI,UAAU,GAAG;AACf,QAAAzC,KAAI;UAACA,GAAE,CAAA;UAAIA,GAAE,CAAA;UAAIA,GAAE,CAAA;UAAI;QAAK;AAC5B,QAAAC,KAAI2C;AACJ,QAAA1C,KAAIQ,MAAKa,MAAI;AACb,QAAAuB,KAAID;MACL,WAAU,UAAU,GAAG;AACtB,QAAA5C,KAAI2C,OAAMlC;AACV,QAAAR,KAAI0C,OAAMrB,MAAI;AACd,QAAAuB,KAAIpC,MAAKmC,MAAK;AACd,QAAAJ,KAAIlB,MAAIsB;MACT;AACD,YAAM,MAAM;QACV,GAAG5C,KAAID,GAAE,CAAA,EAAG,IAAIE,KAAIF,GAAE,CAAA,EAAG,IAAI8C,KAAI9C,GAAE,CAAA,EAAG,IAAIyC,KAAIzC,GAAE,CAAA,EAAG;QACnD,GAAGC,KAAID,GAAE,CAAA,EAAG,IAAIE,KAAIF,GAAE,CAAA,EAAG,IAAI8C,KAAI9C,GAAE,CAAA,EAAG,IAAIyC,KAAIzC,GAAE,CAAA,EAAG;QACnD,GAAGuB;MACJ;AACD,UAAI,IACF,KAAI,IAAItB,KAAID,GAAE,CAAA,EAAG,IAAIE,KAAIF,GAAE,CAAA,EAAG,IAAI8C,KAAI9C,GAAE,CAAA,EAAG,IAAIyC,KAAIzC,GAAE,CAAA,EAAG;AAE1D,aAAO;IACR;AAGD,UAAM,QAAQ,KAAK,MAAM,KAAK,UAAU,MAAA,CAAO;AAC/C,WAAO,MAAM,SAAS,GAAG;AACvB,eAASc,KAAI,GAAGA,KAAI,MAAM,SAAS,GAAGA,MAAK;AACzC,cAAMA,EAAA,IAAK;UACT,GAAG,MAAMA,EAAA,EAAG,KAAK,MAAMA,KAAI,CAAA,EAAG,IAAI,MAAMA,EAAA,EAAG,KAAKS;UAChD,GAAG,MAAMT,EAAA,EAAG,KAAK,MAAMA,KAAI,CAAA,EAAG,IAAI,MAAMA,EAAA,EAAG,KAAKS;QACjD;AACD,YAAI,OAAO,MAAMT,EAAA,EAAG,MAAM,YACxB,OAAMA,EAAA,EAAG,IAAI,MAAMA,EAAA,EAAG,KAAK,MAAMA,KAAI,CAAA,EAAG,IAAI,MAAMA,EAAA,EAAG,KAAKS;MAE7D;AACD,YAAM,OAAO,MAAM,SAAS,GAAG,CAAA;IAChC;AACD,UAAM,CAAA,EAAG,IAAIA;AACb,WAAO,MAAM,CAAA;EACd;EAED,mBAAmB,SAAUA,KAAG,QAAQ,QAAQ,KAAK;AACnD,UAAMb,MAAK,IAAIa,KACbzB,KAAI,QACJE,KAAI;AAEN,QAAI,KAAKF,GAAE,CAAA,GACTiD,MAAKjD,GAAE,CAAA,GACPkD,MAAKlD,GAAE,CAAA,GACPmD,MAAKnD,GAAE,CAAA,GACP2C;AAGF,UAAM/B;AACN,IAAAqC,OAAMxB;AAEN,QAAIvB,GAAE,WAAW,GAAG;AAClB,MAAAyC,KAAI,KAAKM;AACT,aAAO;QACL,IAAI,KAAK/C,GAAE,CAAA,EAAG,IAAI+C,MAAK/C,GAAE,CAAA,EAAG,KAAKyC;QACjC,IAAI,KAAKzC,GAAE,CAAA,EAAG,IAAI+C,MAAK/C,GAAE,CAAA,EAAG,KAAKyC;QACjC,GAAG,CAAC,MAAM,SAAS,KAAKzC,GAAE,CAAA,EAAG,IAAI+C,MAAK/C,GAAE,CAAA,EAAG,KAAKyC;QAChD,GAAGlB;MACJ;IACF;AAGD,UAAMb;AACN,IAAAqC,OAAM,IAAIrC;AACV,IAAAsC,OAAMzB,MAAIA;AAEV,QAAIvB,GAAE,WAAW,GAAG;AAClB,MAAAyC,KAAI,KAAKM,MAAKC;AACd,aAAO;QACL,IAAI,KAAKhD,GAAE,CAAA,EAAG,IAAI+C,MAAK/C,GAAE,CAAA,EAAG,IAAIgD,MAAKhD,GAAE,CAAA,EAAG,KAAKyC;QAC/C,IAAI,KAAKzC,GAAE,CAAA,EAAG,IAAI+C,MAAK/C,GAAE,CAAA,EAAG,IAAIgD,MAAKhD,GAAE,CAAA,EAAG,KAAKyC;QAC/C,GAAG,CAAC,MAAM,SAAS,KAAKzC,GAAE,CAAA,EAAG,IAAI+C,MAAK/C,GAAE,CAAA,EAAG,IAAIgD,MAAKhD,GAAE,CAAA,EAAG,KAAKyC;QAC9D,GAAGlB;MACJ;IACF;AAGD,UAAMb;AACN,IAAAqC,OAAM,MAAMrC;AACZ,IAAAsC,OAAM,IAAItC;AACV,IAAAuC,OAAM1B,MAAIA,MAAIA;AAEd,QAAIvB,GAAE,WAAW,GAAG;AAClB,MAAAyC,KAAI,KAAKM,MAAKC,MAAKC;AACnB,aAAO;QACL,IAAI,KAAKjD,GAAE,CAAA,EAAG,IAAI+C,MAAK/C,GAAE,CAAA,EAAG,IAAIgD,MAAKhD,GAAE,CAAA,EAAG,IAAIiD,MAAKjD,GAAE,CAAA,EAAG,KAAKyC;QAC7D,IAAI,KAAKzC,GAAE,CAAA,EAAG,IAAI+C,MAAK/C,GAAE,CAAA,EAAG,IAAIgD,MAAKhD,GAAE,CAAA,EAAG,IAAIiD,MAAKjD,GAAE,CAAA,EAAG,KAAKyC;QAC7D,GAAG,CAAC,MACA,SACC,KAAKzC,GAAE,CAAA,EAAG,IAAI+C,MAAK/C,GAAE,CAAA,EAAG,IAAIgD,MAAKhD,GAAE,CAAA,EAAG,IAAIiD,MAAKjD,GAAE,CAAA,EAAG,KAAKyC;QAC9D,GAAGlB;MACJ;IACF;EACF;EAED,QAAQ,SAAU,QAAQ,KAAK;AAC7B,UAAM,UAAU,CAAE;AAClB,aAASvB,KAAI,QAAQyC,KAAIzC,GAAE,QAAQ8C,KAAIL,KAAI,GAAGA,KAAI,GAAGA,MAAKK,MAAK;AAC7D,YAAM,OAAO,CAAE;AACf,eAASI,KAAI,GAAG,KAAKA,KAAIJ,IAAGI,MAAK;AAC/B,cAAM;UACJ,GAAGJ,MAAK9C,GAAEkD,KAAI,CAAA,EAAG,IAAIlD,GAAEkD,EAAA,EAAG;UAC1B,GAAGJ,MAAK9C,GAAEkD,KAAI,CAAA,EAAG,IAAIlD,GAAEkD,EAAA,EAAG;QAC3B;AACD,YAAI,IACF,KAAI,IAAIJ,MAAK9C,GAAEkD,KAAI,CAAA,EAAG,IAAIlD,GAAEkD,EAAA,EAAG;AAEjC,aAAK,KAAK,GAAA;MACX;AACD,cAAQ,KAAK,IAAA;AACb,MAAAlD,KAAI;IACL;AACD,WAAO;EACR;EAED,SAAS,SAAUN,IAAGyD,IAAGC,IAAG;AAC1B,WACGD,MAAKzD,MAAKA,MAAK0D,MAChB,MAAM,cAAc1D,IAAGyD,EAAA,KACvB,MAAM,cAAczD,IAAG0D,EAAA;EAE1B;EAED,eAAe,SAAUnD,IAAGC,IAAG,WAAW;AACxC,WAAOmD,MAAIpD,KAAIC,EAAA,MAAO,aAAa;EACpC;EAED,QAAQ,SAAU,cAAc;AAC9B,UAAMoD,KAAI,KACR,MAAM,MAAM,QAAQ;AAEtB,QAAIC,OAAM;AAEV,aAASzC,KAAI,GAAGS,KAAGT,KAAI,KAAKA,MAAK;AAC/BS,YAAI+B,KAAI,MAAM,QAAQxC,EAAA,IAAKwC;AAC3B,MAAAC,QAAO,MAAM,QAAQzC,EAAA,IAAK,MAAM,MAAMS,KAAG,YAAA;IAC1C;AACD,WAAO+B,KAAIC;EACZ;EAED,KAAK,SAAU7D,IAAG8D,KAAIC,KAAInB,KAAIoB,KAAI;AAChC,UAAM,KAAKD,MAAKD,KACdG,MAAKD,MAAKpB,KACVsB,MAAKlE,KAAI8D,KACT1D,KAAI8D,MAAK;AACX,WAAOtB,MAAKqB,MAAK7D;EAClB;EAED,MAAM,SAAUA,IAAG,IAAI8D,KAAI;AACzB,UAAM,MAAM;MACV,GAAG,GAAG,IAAI9D,MAAK8D,IAAG,IAAI,GAAG;MACzB,GAAG,GAAG,IAAI9D,MAAK8D,IAAG,IAAI,GAAG;IAC1B;AACD,QAAI,GAAG,MAAM,UAAaA,IAAG,MAAM,OACjC,KAAI,IAAI,GAAG,IAAI9D,MAAK8D,IAAG,IAAI,GAAG;AAEhC,WAAO;EACR;EAED,eAAe,SAAU5D,IAAG;AAC1B,QAAIyB,KAAIzB,GAAE,IAAI,MAAMA,GAAE;AACtB,QAAI,OAAOA,GAAE,MAAM,YACjB,CAAAyB,MAAK,MAAMzB,GAAE;AAEf,WAAOyB;EACR;EAED,gBAAgB,SAAU,QAAQ;AAChC,WAAO,MAAM,OAAO,IAAI,MAAM,aAAA,EAAe,KAAK,IAAA,IAAQ;EAC3D;EAED,MAAM,SAAU,KAAK;AACnB,WAAO,KAAK,MAAM,KAAK,UAAU,GAAA,CAAI;EACtC;EAED,OAAO,SAAUoC,IAAG,IAAID,KAAI;AAC1B,UAAM,MAAM,GAAG,IAAIC,GAAE,GACnB,MAAM,GAAG,IAAIA,GAAE,GACf,MAAMD,IAAG,IAAIC,GAAE,GACf,MAAMD,IAAG,IAAIC,GAAE,GACf,QAAQ,MAAM,MAAM,MAAM,KAC1BC,OAAM,MAAM,MAAM,MAAM;AAC1B,WAAO,MAAM,OAAOA,IAAA;EACrB;EAGD,OAAO,SAAUpE,IAAG+C,IAAG;AACrB,UAAMhB,KAAI,KAAK/B;AACf,UAAM,MAAM+B,GAAE,QAAQ,GAAA;AACtB,WAAO,WAAWA,GAAE,UAAU,GAAG,MAAM,IAAIgB,EAAA,CAAE;EAC9C;EAED,MAAM,SAAU,IAAIsB,KAAI;AACtB,UAAM,KAAK,GAAG,IAAIA,IAAG,GACnB,KAAK,GAAG,IAAIA,IAAG;AACjB,WAAOpB,OAAK,KAAK,KAAK,KAAK,EAAA;EAC5B;EAED,SAAS,SAAU,KAAKqB,QAAO;AAC7B,QAAI,QAAQ,IAAI,GAAG,EAAA,GACjB,MACAvB;AACF,QAAI,QAAQ,SAAUzC,IAAG,KAAK;AAC5B,MAAAyC,KAAI,MAAM,KAAKuB,QAAOhE,EAAA;AACtB,UAAIyC,KAAI,OAAO;AACb,gBAAQA;AACR,eAAO;MACR;IACF,CAAA;AACD,WAAO;MAAS;MAAa;IAAM;EACpC;EAED,UAAU,SAAUlB,KAAG0C,IAAG;AAExB,QAAIA,OAAM,KAAKA,OAAM,EACnB,QAAO;AAET,QAAI,OAAO1C,QAAM,YACfA,OAAI;aACKA,QAAM,KAAKA,QAAM,EAC1B,QAAOA;AAET,UAAM,SAAS,IAAIA,KAAG0C,EAAA,IAAK,IAAI,IAAI1C,KAAG0C,EAAA,GACpC,MAAM,SAAS;AACjB,WAAOZ,MAAI,MAAM,MAAA;EAClB;EAED,iBAAiB,SAAU9B,KAAG0C,IAAG;AAE/B,QAAIA,OAAM,KAAKA,OAAM,EACnB,QAAO;AAET,QAAI,OAAO1C,QAAM,YACfA,OAAI;aACKA,QAAM,KAAKA,QAAM,EAC1B,QAAOA;AAET,UAAM,MAAM,IAAI,IAAIA,KAAG0C,EAAA,GACrB,SAAS,IAAI1C,KAAG0C,EAAA,IAAK;AACvB,WAAO,MAAM;EACd;EAED,MAAM,SAAU,IAAI,IAAIC,KAAIC,KAAI,IAAI,IAAI,IAAI,IAAI;AAC9C,UAAM,MACD,KAAKA,MAAK,KAAKD,QAAO,KAAK,OAAO,KAAKA,QAAO,KAAK,KAAK,KAAK,KAChE,MAAM,KAAKC,MAAK,KAAKD,QAAO,KAAK,OAAO,KAAKC,QAAO,KAAK,KAAK,KAAK,KACnE1B,MAAK,KAAKyB,QAAO,KAAK,OAAO,KAAKC,QAAO,KAAK;AAChD,QAAI1B,MAAK,EACP,QAAO;AAET,WAAO;MAAE,GAAG,KAAKA;MAAG,GAAG,KAAKA;IAAG;EAChC;EAED,MAAM,SAAU,IAAIsB,KAAI,IAAI,IAAI;AAC9B,UAAM,KAAK,GAAG,GACZ,KAAK,GAAG,GACRG,MAAKH,IAAG,GACRI,MAAKJ,IAAG,GACR,KAAK,GAAG,GACR,KAAK,GAAG,GACR,KAAK,GAAG,GACR,KAAK,GAAG;AACV,WAAO,MAAM,KAAK,IAAI,IAAIG,KAAIC,KAAI,IAAI,IAAI,IAAI,EAAA;EAC/C;EAED,KAAK,SAAU,IAAIP,KAAI;AACrB,WAAO,MAAM,KAAK,IAAI,GAAG,GAAGA,KAAIA,IAAG,CAAA;EACpC;EAED,UAAU,SAAU,IAAIG,KAAI;AAC1B,WAAO,IAAI,OACT,GAAG,GACH,GAAG,IACF,GAAG,IAAIA,IAAG,KAAK,IACf,GAAG,IAAIA,IAAG,KAAK,GAChBA,IAAG,GACHA,IAAG,CAAA;EAEN;EAED,UAAU,SAAU,UAAU;AAC5B,QAAI,KAAK,MACP,KAAK,MACL,KAAK,MACL,KAAK;AACP,aAAS,QAAQ,SAAUtC,IAAG;AAC5B,YAAM2C,QAAO3C,GAAE,KAAA;AACf,UAAI,KAAK2C,MAAK,EAAE,IAAK,MAAKA,MAAK,EAAE;AACjC,UAAI,KAAKA,MAAK,EAAE,IAAK,MAAKA,MAAK,EAAE;AACjC,UAAI,KAAKA,MAAK,EAAE,IAAK,MAAKA,MAAK,EAAE;AACjC,UAAI,KAAKA,MAAK,EAAE,IAAK,MAAKA,MAAK,EAAE;IAClC,CAAA;AACD,WAAO;MACL,GAAG;QAAE,KAAK;QAAI,MAAM,KAAK,MAAM;QAAG,KAAK;QAAI,MAAM,KAAK;MAAI;MAC1D,GAAG;QAAE,KAAK;QAAI,MAAM,KAAK,MAAM;QAAG,KAAK;QAAI,MAAM,KAAK;MAAI;IAC3D;EACF;EAED,oBAAoB,SAClB,IACA,OACAC,KACAC,QACA,4BACA;AACA,QAAI,CAAC,MAAM,YAAY,OAAOA,MAAA,EAAQ,QAAO,CAAE;AAC/C,UAAMC,iBAAgB,CAAE;AACxB,UAAM,KAAK;MAAC,GAAG;MAAU,GAAG;MAAS,GAAG;MAAM,GAAG;IAAO;AACxD,UAAMC,MAAK;MAACH,IAAG;MAAUA,IAAG;MAASA,IAAG;MAAMA,IAAG;IAAO;AACxD,OAAG,QAAQ,SAAU,IAAI;AACvB,UAAI,GAAG,QAAS;AAChB,MAAAG,IAAG,QAAQ,SAAUC,KAAI;AACvB,YAAIA,IAAG,QAAS;AAChB,cAAM,MAAM,GAAG,WAAWA,KAAI,0BAAA;AAC9B,YAAI,IAAI,SAAS,GAAG;AAClB,cAAI,KAAK;AACT,cAAI,KAAKA;AACT,cAAI,KAAK;AACT,cAAI,KAAKJ;AACT,UAAAE,eAAc,KAAK,GAAA;QACpB;MACF,CAAA;IACF,CAAA;AACD,WAAOA;EACR;EAED,WAAW,SAAU,SAAS,MAAM,4BAA4B;AAC9D,UAAM,MAAM,KAAK,OAAO;AACxB,UAAM,MAAM,QAAQ,OAAO;AAC3B,UAAM,QAAQ,MAAM,SAAS,KAAK,OAAO,MAAM,CAAA,GAAI,QAAQ,OAAO,CAAA,CAAA;AAClE,UAAM,MAAM,MAAM,SAAS,QAAQ,OAAO,MAAM,CAAA,GAAI,KAAK,OAAO,CAAA,CAAA;AAChE,UAAM,QAAQ;MACZ,UAAU;MACD;MACH;MACN,QAAQ;MACR,MAAM,MAAM,SAAS;QAAC;QAAO;QAAS;QAAM;MAAI,CAAA;IACjD;AACD,UAAM,gBAAgB,SAAUF,KAAI;AAClC,aAAO,MAAM,mBACX,OACA,MAAM,MACNA,KACAA,IAAG,MACH,0BAAA;IAEH;AACD,WAAO;EACR;EAED,WAAW,SAAU,OAAO5B,IAAG,MAAM;AACnC,QAAI,CAAC,KAAM,QAAO;MAAE,KAAK;MAAG,KAAK;IAAG;AACpC,QAAInC,SAAM,MACRD,SAAM,MACNkB,KACAuB;AACF,QAAI,KAAK,QAAQ,CAAA,MAAO,GACtB,QAAO,CAAC,CAAE,EAAC,OAAO,IAAA;AAEpB,QAAI,KAAK,QAAQ,CAAA,MAAO,GACtB,MAAK,KAAK,CAAA;AAEZ,aAAShC,KAAI,GAAG,MAAM,KAAK,QAAQA,KAAI,KAAKA,MAAK;AAC/CS,YAAI,KAAKT,EAAA;AACT,MAAAgC,KAAI,MAAM,IAAIvB,GAAAA;AACd,UAAIuB,GAAEL,EAAA,IAAKnC,OACTA,CAAAA,SAAMwC,GAAEL,EAAA;AAEV,UAAIK,GAAEL,EAAA,IAAKpC,OACTA,CAAAA,SAAMyC,GAAEL,EAAA;IAEX;AACD,WAAO;MAAE,KAAKnC;MAAK,MAAMA,SAAMD,UAAO;MAAG,KAAKA;MAAK,MAAMA,SAAMC;IAAK;EACrE;EAED,OAAO,SAAU,QAAQoE,OAAM;AAC7B,UAAM,KAAKA,MAAK,GAAG,GACjB,KAAKA,MAAK,GAAG,GACbzE,KAAI,CAAC,MAAMyE,MAAK,GAAG,IAAI,IAAIA,MAAK,GAAG,IAAI,EAAA,GACvCjC,KAAI,SAAU/C,IAAG;AACf,aAAO;QACL,IAAIA,GAAE,IAAI,MAAMiF,MAAI1E,EAAA,KAAMP,GAAE,IAAI,MAAMkF,MAAI3E,EAAA;QAC1C,IAAIP,GAAE,IAAI,MAAMkF,MAAI3E,EAAA,KAAMP,GAAE,IAAI,MAAMiF,MAAI1E,EAAA;MAC3C;IACF;AACH,WAAO,OAAO,IAAIwC,EAAA;EACnB;EAED,OAAO,SAAU,QAAQiC,OAAM;AAC7B,IAAAA,QAAOA,SAAQ;MAAE,IAAI;QAAE,GAAG;QAAG,GAAG;MAAG;MAAE,IAAI;QAAE,GAAG;QAAG,GAAG;MAAG;IAAE;AAEzD,UAAM,QAAQ,OAAO,SAAS;AAC9B,UAAM,UAAU,MAAM,MAAM,QAAQA,KAAA;AACpC,UAAMG,UAAS,SAAUtD,KAAG;AAC1B,aAAO,KAAKA,OAAKA,OAAK;IACvB;AAED,QAAI,UAAU,GAAG;AACf,YAAMtB,MAAI,QAAQ,CAAA,EAAG,GACnBC,MAAI,QAAQ,CAAA,EAAG,GACf4C,MAAI,QAAQ,CAAA,EAAG,GACfL,MAAIxC,MAAI,IAAIC,MAAI4C;AAClB,UAAIL,QAAM,GAAG;AACX,cAAM,KAAK,CAACE,OAAKzC,MAAIA,MAAID,MAAI6C,GAAAA,GAC3BgC,MAAK,CAAC7E,MAAIC,KACV6E,OAAK,EAAE,KAAKD,OAAMrC,KAClBmB,MAAK,EAAE,CAAC,KAAKkB,OAAMrC;AACrB,eAAO,CAACsC,MAAInB,GAAG,EAAC,OAAOiB,OAAA;MACxB,WAAU3E,QAAM4C,OAAKL,QAAM,EAC1B,QAAO,EAAE,IAAIvC,MAAI4C,QAAM,IAAI5C,MAAI,IAAI4C,IAAG,EAAC,OAAO+B,OAAA;AAEhD,aAAO,CAAE;IACV;AAGD,UAAMG,MAAK,QAAQ,CAAA,EAAG,GACpB,KAAK,QAAQ,CAAA,EAAG,GAChB,KAAK,QAAQ,CAAA,EAAG,GAChB,KAAK,QAAQ,CAAA,EAAG;AAElB,QAAIvC,KAAI,CAACuC,MAAK,IAAI,KAAK,IAAI,KAAK,IAC9B/E,KAAI,IAAI+E,MAAK,IAAI,KAAK,IAAI,IAC1B9E,KAAI,KAAK8E,MAAK,IAAI,IAClBlC,KAAIkC;AAEN,QAAI,MAAM,cAAcvC,IAAG,CAAA,GAAI;AAE7B,UAAI,MAAM,cAAcxC,IAAG,CAAA,GAAI;AAE7B,YAAI,MAAM,cAAcC,IAAG,CAAA,EAEzB,QAAO,CAAE;AAGX,eAAO,CAAC,CAAC4C,KAAI5C,EAAE,EAAC,OAAO2E,OAAA;MACxB;AAED,YAAMI,MAAItC,OAAKzC,KAAIA,KAAI,IAAID,KAAI6C,EAAA,GAC7B0B,MAAK,IAAIvE;AACX,aAAO,EAAEgF,MAAI/E,MAAKsE,MAAK,CAACtE,KAAI+E,OAAKT,GAAG,EAAC,OAAOK,OAAA;IAC7C;AAID,IAAA5E,MAAKwC;AACL,IAAAvC,MAAKuC;AACL,IAAAK,MAAKL;AAEL,UAAMzC,MAAK,IAAIE,KAAID,KAAIA,MAAK,GAC1BiF,MAAKlF,KAAI,GACTiF,MAAK,IAAIhF,KAAIA,KAAIA,KAAI,IAAIA,KAAIC,KAAI,KAAK4C,MAAK,IAC3CqC,MAAKF,KAAI,GACT,eAAeE,MAAKA,MAAKD,MAAKA,MAAKA;AAErC,QAAI,IAAI,IAAI,IAAIhB,KAAI;AACpB,QAAI,eAAe,GAAG;AACpB,YAAM,MAAM,CAAClE,KAAI,GACf,OAAO,MAAM,MAAM,KACnBF,KAAI6C,OAAK,IAAA,GACTpB,MAAI,CAAC0D,MAAK,IAAInF,KACd,SAASyB,MAAI,KAAK,KAAKA,MAAI,IAAI,IAAIA,KACnC,MAAM6D,OAAK,MAAA,GACX,OAAO,IAAItF,EAAA,GACX,KAAK,IAAI;AACX,WAAK,KAAK6E,MAAI,MAAM,CAAA,IAAK1E,KAAI;AAC7B,MAAAiE,MAAK,KAAKS,OAAK,MAAM,OAAO,CAAA,IAAK1E,KAAI;AACrC,WAAK,KAAK0E,OAAK,MAAM,IAAI,OAAO,CAAA,IAAK1E,KAAI;AACzC,aAAO;QAAC;QAAIiE;QAAI;MAAG,EAAC,OAAOW,OAAA;IAC5B,WAAU,iBAAiB,GAAG;AAC7B,WAAKM,MAAK,IAAI,IAAI,CAACA,GAAA,IAAM,CAAC,IAAIA,GAAA;AAC9B,WAAK,IAAI,KAAKlF,KAAI;AAClB,MAAAiE,MAAK,CAAC,KAAKjE,KAAI;AACf,aAAO,CAAC,IAAIiE,GAAG,EAAC,OAAOW,OAAA;IACxB,OAAM;AACL,YAAM,KAAKlC,OAAK,YAAA;AAChB,WAAK,IAAI,CAACwC,MAAK,EAAA;AACf,WAAK,IAAIA,MAAK,EAAA;AACd,aAAO,CAAC,KAAK,KAAKlF,KAAI,CAAE,EAAC,OAAO4E,OAAA;IACjC;EACF;EAED,QAAQ,SAAU7E,IAAG;AAEnB,QAAIA,GAAE,WAAW,GAAG;AAClB,YAAMC,KAAID,GAAE,CAAA,GACVE,KAAIF,GAAE,CAAA,GACN8C,KAAI9C,GAAE,CAAA,GACNyC,KAAIxC,KAAI,IAAIC,KAAI4C;AAClB,UAAIL,OAAM,GAAG;AACX,cAAM,KAAK,CAACE,OAAKzC,KAAIA,KAAID,KAAI6C,EAAA,GAC3BgC,MAAK,CAAC7E,KAAIC,IACV,KAAK,EAAE,KAAK4E,OAAMrC,IAClBmB,MAAK,EAAE,CAAC,KAAKkB,OAAMrC;AACrB,eAAO,CAAC,IAAImB,GAAG;MAChB,WAAU1D,OAAM4C,MAAKL,OAAM,EAC1B,QAAO,EAAE,IAAIvC,KAAI4C,OAAM,KAAK5C,KAAI4C,IAAI;AAEtC,aAAO,CAAE;IACV;AAGD,QAAI9C,GAAE,WAAW,GAAG;AAClB,YAAMC,KAAID,GAAE,CAAA,GACVE,KAAIF,GAAE,CAAA;AACR,UAAIC,OAAMC,GACR,QAAO,CAACD,MAAKA,KAAIC,GAAG;AAEtB,aAAO,CAAE;IACV;AAED,WAAO,CAAE;EACV;EAED,WAAW,SAAUqB,KAAG,IAAIoC,KAAI,KAAK,OAAO;AAC1C,QAAI,KACF,KACA,KACA,IACA0B,KAAI,GACJvF,KAAI;AAkBN,UAAM2C,KAAI,MAAM,QAAQlB,KAAG,EAAA;AAC3B,UAAM,KAAK,MAAM,QAAQA,KAAGoC,GAAA;AAC5B,UAAM,QAAQlB,GAAE,IAAIA,GAAE,IAAIA,GAAE,IAAIA,GAAE;AAElC,QAAI,KAAK;AACP,YAAME,OACJ,IAAIF,GAAE,IAAI,GAAG,IAAI,GAAG,IAAIA,GAAE,GAAG,CAAA,IAC3B,IAAIA,GAAE,IAAI,GAAG,IAAI,GAAG,IAAIA,GAAE,GAAG,CAAA,IAC7B,IAAIA,GAAE,IAAI,GAAG,IAAI,GAAG,IAAIA,GAAE,GAAG,CAAA,CAAE;AAEnC,YAAM,IAAI,QAAQA,GAAE,IAAIA,GAAE,GAAG,IAAI,CAAA;IAClC,OAAM;AACL,YAAMA,GAAE,IAAI,GAAG,IAAIA,GAAE,IAAI,GAAG;AAC5B,YAAM,IAAI,OAAO,IAAI,CAAA;IACtB;AAED,QAAI,QAAQ,KAAK,QAAQ,EACvB,QAAO;MAAE,GAAG;MAAG,GAAG;IAAG;AAGvB,IAAA4C,KAAI,MAAM;AACV,IAAAvF,KAAI,MAAM;AAMV,QAAI,CAAC,OAAO;AAGV,YAAM,KAAK,MAAM,UAAUyB,MAAI,MAAO,IAAIoC,KAAI,KAAK,IAAA,EAAM;AACzD,YAAM,KAAK,MAAM,UAAUpC,MAAI,MAAO,IAAIoC,KAAI,KAAK,IAAA,EAAM;AACzD,YAAM,KAAK0B,MAAKA,KAAI,OAAO;AAC3B,aAAOhC,MAAI,KAAKgC,EAAA,IAAKhC,MAAIgC,KAAI,EAAA,KAAO;IACrC;AAED,WAAO;MAAK,GAAAA;MAAM,GAAAvF;MAAO;MAAS;IAAK;EACxC;EAED,aAAa,SAAU,QAAQ;AAC7B,QAAI,OAAO,SAAS,EAAG,QAAO,CAAE;AAIhC,UAAME,KAAI,MAAM,MAAM,QAAQ;MAAE,IAAI,OAAO,CAAA;MAAI,IAAI,OAAO,MAAM,EAAA,EAAI,CAAA;IAAI,CAAA,GACtEC,KAAID,GAAE,CAAA,EAAG,IAAIA,GAAE,CAAA,EAAG,GAClBE,KAAIF,GAAE,CAAA,EAAG,IAAIA,GAAE,CAAA,EAAG,GAClB8C,KAAI9C,GAAE,CAAA,EAAG,IAAIA,GAAE,CAAA,EAAG,GAClByC,KAAIzC,GAAE,CAAA,EAAG,IAAIA,GAAE,CAAA,EAAG,GAClB,KAAK,MAAM,KAAKC,KAAI,IAAIC,KAAI,IAAI4C,KAAIL,KACpCmB,MAAK,MAAM,IAAI3D,KAAIC,KAAI,IAAI4C,KAC3B,KAAK,MAAMA,KAAI7C;AAEjB,QAAI,MAAM,cAAc,IAAI,CAAA,GAAI;AAC9B,UAAI,CAAC,MAAM,cAAc2D,KAAI,CAAA,GAAI;AAC/B,YAAIrC,MAAI,CAAC,KAAKqC;AACd,YAAI,KAAKrC,OAAKA,OAAK,EAAG,QAAO,CAACA,GAAE;MACjC;AACD,aAAO,CAAE;IACV;AAED,UAAMoC,MAAK,IAAI;AAEf,QAAI,MAAM,cAAcA,KAAI,CAAA,EAAI,QAAO,CAAE;AAEzC,UAAM,MAAMC,MAAKA,MAAK,IAAI,KAAK;AAE/B,QAAI,MAAM,EAAG,QAAO,CAAE;AAEtB,UAAM,KAAK,KAAK,KAAK,GAAA;AAErB,WAAO,EAAE,KAAKA,OAAMD,KAAI,EAAEC,MAAK,MAAMD,GAAG,EAAC,OAAO,SAAU7D,IAAG;AAC3D,aAAO,KAAKA,MAAKA,MAAK;IACvB,CAAA;EACF;EAED,aAAa,SAAU,IAAIwF,KAAI;AAC7B,UAAM,OAAO,CAAC,KAAK,GAAI,GACrB,MAAM,KAAK;AAEb,aAASxE,KAAI,GAAG,KAAK4B,IAAGnB,KAAGkB,IAAG3B,KAAI,KAAKA,MAAK;AAC1C,YAAM,KAAKA,EAAA;AACX,MAAA4B,KAAI,GAAG,GAAA,EAAK;AACZnB,YAAI+D,IAAG,GAAA,EAAK;AACZ,MAAA7C,MAAK,GAAG,GAAA,EAAK,OAAO6C,IAAG,GAAA,EAAK,QAAQ;AACpC,UAAIjC,MAAIX,KAAInB,GAAAA,KAAMkB,GAAG,QAAO;IAC7B;AACD,WAAO;EACR;EAED,WAAW,SAAU2B,OAAM,OAAO;AAChC,QAAI,MAAM,EAAE,MAAMA,MAAK,EAAE,IACvB,CAAAA,MAAK,EAAE,MAAM,MAAM,EAAE;AAEvB,QAAI,MAAM,EAAE,MAAMA,MAAK,EAAE,IACvB,CAAAA,MAAK,EAAE,MAAM,MAAM,EAAE;AAEvB,QAAI,MAAM,KAAK,MAAM,EAAE,MAAMA,MAAK,EAAE,IAClC,CAAAA,MAAK,EAAE,MAAM,MAAM,EAAE;AAEvB,QAAI,MAAM,EAAE,MAAMA,MAAK,EAAE,IACvB,CAAAA,MAAK,EAAE,MAAM,MAAM,EAAE;AAEvB,QAAI,MAAM,EAAE,MAAMA,MAAK,EAAE,IACvB,CAAAA,MAAK,EAAE,MAAM,MAAM,EAAE;AAEvB,QAAI,MAAM,KAAK,MAAM,EAAE,MAAMA,MAAK,EAAE,IAClC,CAAAA,MAAK,EAAE,MAAM,MAAM,EAAE;AAEvB,IAAAA,MAAK,EAAE,OAAOA,MAAK,EAAE,MAAMA,MAAK,EAAE,OAAO;AACzC,IAAAA,MAAK,EAAE,OAAOA,MAAK,EAAE,MAAMA,MAAK,EAAE,OAAO;AACzC,QAAIA,MAAK,EACP,CAAAA,MAAK,EAAE,OAAOA,MAAK,EAAE,MAAMA,MAAK,EAAE,OAAO;AAE3C,IAAAA,MAAK,EAAE,OAAOA,MAAK,EAAE,MAAMA,MAAK,EAAE;AAClC,IAAAA,MAAK,EAAE,OAAOA,MAAK,EAAE,MAAMA,MAAK,EAAE;AAClC,QAAIA,MAAK,EACP,CAAAA,MAAK,EAAE,OAAOA,MAAK,EAAE,MAAMA,MAAK,EAAE;EAErC;EAED,eAAe,SAAU,IAAImB,KAAI,4BAA4B;AAC3D,UAAM,MAAM,GAAG,KAAA,GACb,MAAMA,IAAG,KAAA,GACTzF,KAAI,KACJ,YAAY,8BAA8B;AAE5C,QACE,IAAI,EAAE,OAAO,IAAI,EAAE,OAAO,aAC1B,IAAI,EAAE,OAAO,IAAI,EAAE,OAAO,UAE1B,QAAO,EACFA,MAAK,GAAG,MAAM,GAAG,OAAQ,IAAK,KAAKA,KACpC,OACGA,MAAKyF,IAAG,MAAMA,IAAG,OAAQ,IAAK,KAAKzF,EACzC;AAGH,QAAI,MAAM,GAAG,MAAM,GAAA,GACjB,MAAMyF,IAAG,MAAM,GAAA,GACf,QAAQ;MACN;QAAE,MAAM,IAAI;QAAM,OAAO,IAAI;MAAM;MACnC;QAAE,MAAM,IAAI;QAAM,OAAO,IAAI;MAAO;MACpC;QAAE,MAAM,IAAI;QAAO,OAAO,IAAI;MAAO;MACrC;QAAE,MAAM,IAAI;QAAO,OAAO,IAAI;MAAM;IACrC;AAEH,YAAQ,MAAM,OAAO,SAAU,MAAM;AACnC,aAAO,MAAM,YAAY,KAAK,KAAK,KAAA,GAAQ,KAAK,MAAM,KAAA,CAAM;IAC7D,CAAA;AAED,QAAI,UAAU,CAAE;AAEhB,QAAI,MAAM,WAAW,EAAG,QAAO;AAE/B,UAAM,QAAQ,SAAU,MAAM;AAC5B,gBAAU,QAAQ,OAChB,MAAM,cAAc,KAAK,MAAM,KAAK,OAAO,SAAA,CAAU;IAExD,CAAA;AAED,cAAU,QAAQ,OAAO,SAAU7F,IAAGoB,IAAG;AACvC,aAAO,QAAQ,QAAQpB,EAAA,MAAOoB;IAC/B,CAAA;AAED,WAAO;EACR;EAED,YAAY,SAAU,IAAIiD,KAAI,IAAI;AAChC,UAAM,MAAMA,IAAG,IAAI,GAAG,GACpB,MAAMA,IAAG,IAAI,GAAG,GAChB,MAAM,GAAG,IAAIA,IAAG,GAChB,MAAM,GAAG,IAAIA,IAAG,GAChB,OAAO,MAAMY,MAAI,KAAA,IAAS,MAAMC,MAAI,KAAA,GACpC,OAAO,MAAMA,MAAI,KAAA,IAAS,MAAMD,MAAI,KAAA,GACpC,OAAO,MAAMA,MAAI,KAAA,IAAS,MAAMC,MAAI,KAAA,GACpC,OAAO,MAAMA,MAAI,KAAA,IAAS,MAAMD,MAAI,KAAA,GAEpC,OAAO,GAAG,IAAIZ,IAAG,KAAK,GACtB,OAAO,GAAG,IAAIA,IAAG,KAAK,GACtB,OAAOA,IAAG,IAAI,GAAG,KAAK,GACtB,OAAOA,IAAG,IAAI,GAAG,KAAK,GAEtB,OAAO,MAAM,MACb,OAAO,MAAM,MACb,OAAO,MAAM,MACb,OAAO,MAAM,MAEbyB,OAAM,MAAM,KAAK,KAAK,KAAK,MAAM,MAAM,KAAK,KAAK,MAAM,IAAA,GACvD1F,KAAI,MAAM,KAAK0F,MAAK,EAAA;AAGtB,QAAI/D,KAAI,MAAM,GAAG,IAAI+D,KAAI,GAAG,GAAG,IAAIA,KAAI,CAAA,GACrCrC,KAAI,MAAMY,IAAG,IAAIyB,KAAI,GAAGzB,IAAG,IAAIyB,KAAI,CAAA,GACnCC,KAAI,MAAM,GAAG,IAAID,KAAI,GAAG,GAAG,IAAIA,KAAI,CAAA,GACnCE;AAGF,QAAIjE,KAAIgE,IAAG;AAIT,UAAIhE,KAAI0B,MAAKA,KAAIsC,GACf,CAAAhE,MAAK;AAEP,UAAIA,KAAIgE,IAAG;AACT,QAAAC,KAAID;AACJ,QAAAA,KAAIhE;AACJ,QAAAA,KAAIiE;MACL;IACF,WAIKD,KAAItC,MAAKA,KAAI1B,IAAG;AAClB,MAAAiE,KAAID;AACJ,MAAAA,KAAIhE;AACJ,MAAAA,KAAIiE;IACL,MACC,CAAAD,MAAK;AAIT,IAAAD,KAAI,IAAI/D;AACR,IAAA+D,KAAI,IAAIC;AACR,IAAAD,KAAI,IAAI1F;AACR,WAAO0F;EACR;EAED,YAAY,SAAUvF,IAAGC,IAAG;AAC1B,WAAOD,KAAIC;EACZ;AACF;ACp4BD,IAAM,aAAN,MAAMyF,YAAW;EACf,YAAY,QAAQ;AAClB,SAAK,SAAS,CAAE;AAChB,SAAK,MAAM;AACX,QAAI,CAAC,CAAC,QAAQ;AACZ,WAAK,SAAS;AACd,WAAK,MAAM,KAAK,OAAO,CAAA,EAAG;IAC3B;EACF;EAED,UAAU;AACR,WAAO,KAAK,SAAA;EACb;EAED,WAAW;AACT,WACE,MACA,KAAK,OACF,IAAI,SAAU,OAAO;AACpB,aAAO,MAAM,eAAe,MAAM,MAAA;IACnC,CAAA,EACA,KAAK,IAAA,IACR;EAEH;EAED,SAAS,OAAO;AACd,SAAK,OAAO,KAAK,KAAA;AACjB,SAAK,MAAM,KAAK,OAAO,MAAM;EAC9B;EAED,SAAS;AACP,WAAO,KAAK,OACT,IAAI,SAAUjG,IAAG;AAChB,aAAOA,GAAE,OAAA;IACV,CAAA,EACA,OAAO,SAAUO,IAAGC,IAAG;AACtB,aAAOD,KAAIC;IACZ,CAAA;EACJ;EAED,MAAM,KAAK;AACT,WAAO,KAAK,OAAO,GAAA;EACpB;EAED,OAAO;AACL,UAAM4C,KAAI,KAAK;AACf,QAAIsB,QAAOtB,GAAE,CAAA,EAAG,KAAA;AAChB,aAAShC,KAAI,GAAGA,KAAIgC,GAAE,QAAQhC,KAC5B,OAAM,UAAUsD,OAAMtB,GAAEhC,EAAA,EAAG,KAAA,CAAM;AAEnC,WAAOsD;EACR;EAED,OAAO3B,IAAG;AACR,UAAMhC,UAAS,CAAE;AACjB,SAAK,OAAO,QAAQ,SAAUf,IAAG;AAC/B,MAAAe,QAAO,KAAK,GAAGf,GAAE,OAAO+C,EAAA,CAAE;IAC3B,CAAA;AACD,WAAO,IAAIkD,YAAWlF,OAAA;EACvB;AACF;ACvDD,IAAM,EAAE,KAAK,KAAAH,MAAK,KAAAD,MAAK,KAAK,KAAK,MAAM,KAAA,IAAS;AAChD,IAAMmC,MAAK,KAAK;AAShB,IAAM,SAAN,MAAMoD,QAAO;EACX,YAAY,QAAQ;AAClB,QAAI,OACF,UAAU,OAAO,UAAU,SAAS,MAAM,KAAK,SAAA,EAAW,MAAA;AAC5D,QAAI,WAAW;AAEf,QAAI,OAAO,KAAK,CAAA,MAAO,UAAU;AAC/B,iBAAW,KAAK;AAChB,YAAM,UAAU,CAAE;AAClB,WAAK,QAAQ,SAAU5B,SAAO;AAC5B;UAAC;UAAK;UAAK;QAAI,EAAC,QAAQ,SAAUvB,IAAG;AACnC,cAAI,OAAOuB,QAAMvB,EAAA,MAAO,YACtB,SAAQ,KAAKuB,QAAMvB,EAAA,CAAA;QAEtB,CAAA;MACF,CAAA;AACD,aAAO;IACR;AAED,QAAI,SAAS;AACb,UAAM,MAAM,KAAK;AAEjB,QAAI,UACF;UAAI,WAAW,GAAG;AAChB,YAAI,UAAU,WAAW,EACvB,OAAM,IAAI,MACR,sEAAA;AAGJ,iBAAS;MACV;eAEG,QAAQ,KAAK,QAAQ,KAAK,QAAQ,KAAK,QAAQ,IACjD;UAAI,UAAU,WAAW,EACvB,OAAM,IAAI,MACR,sEAAA;IAEH;AAIL,UAAM,MAAO,KAAK,MACf,CAAC,WAAW,QAAQ,KAAK,QAAQ,OACjC,UAAU,OAAO,CAAA,KAAM,OAAO,OAAO,CAAA,EAAG,MAAM;AAEjD,UAAM,SAAU,KAAK,SAAS,CAAE;AAChC,aAAS,MAAM,GAAG,OAAO,MAAM,IAAI,GAAG,MAAM,KAAK,OAAO,MAAM;AAC5D,UAAIuB,SAAQ;QACV,GAAG,KAAK,GAAA;QACR,GAAG,KAAK,MAAM,CAAA;MACf;AACD,UAAI,IACF,CAAAA,OAAM,IAAI,KAAK,MAAM,CAAA;AAEvB,aAAO,KAAKA,MAAA;IACb;AACD,UAAM,QAAS,KAAK,QAAQ,OAAO,SAAS;AAE5C,UAAM,OAAQ,KAAK,OAAO,CAAC,KAAK,GAAI;AACpC,QAAI,IAAK,MAAK,KAAK,GAAA;AACnB,SAAK,SAAS,KAAK;AAGnB,UAAM,UAAU,MAAM,MAAM,QAAQ;MAAE,IAAI,OAAO,CAAA;MAAI,IAAI,OAAO,KAAA;IAAQ,CAAA;AACxE,UAAM,aAAa,MAAM,KAAK,OAAO,CAAA,GAAI,OAAO,KAAA,CAAA;AAChD,SAAK,UAAU,QAAQ,OAAO,CAACzC,KAAGvB,OAAMuB,MAAI,IAAIvB,GAAE,CAAA,GAAI,CAAA,IAAK,aAAa;AAExE,SAAK,OAAO,CAAE;AACd,SAAK,MAAM;AACX,SAAK,MAAM;AACX,SAAK,OAAA;EACN;EAED,OAAO,oBAAoB,IAAI+D,KAAI,IAAIxC,KAAG;AACxC,QAAI,OAAOA,QAAM,YACfA,OAAI;AAGN,QAAIA,QAAM,EACR,QAAO,IAAIqE,QAAO7B,KAAIA,KAAI,EAAA;AAE5B,QAAIxC,QAAM,EACR,QAAO,IAAIqE,QAAO,IAAI7B,KAAIA,GAAA;AAG5B,UAAM,MAAM6B,QAAO,OAAO,GAAG,IAAI7B,KAAI,IAAIxC,GAAAA;AACzC,WAAO,IAAIqE,QAAO,IAAI,IAAI,GAAG,EAAA;EAC9B;EAED,OAAO,gBAAgBC,IAAGC,IAAGC,IAAGxE,KAAG,IAAI;AACrC,QAAI,OAAOA,QAAM,YACfA,OAAI;AAEN,UAAM,MAAMqE,QAAO,OAAO,GAAGC,IAAGC,IAAGC,IAAGxE,GAAAA;AACtC,QAAI,OAAO,OAAO,YAChB,MAAK,MAAM,KAAKuE,IAAG,IAAI,CAAA;AAEzB,UAAMnC,MAAM,MAAM,IAAIpC,OAAMA;AAE5B,UAAM,QAAQ,MAAM,KAAKsE,IAAGE,EAAA,GAC1B,MAAMA,GAAE,IAAIF,GAAE,KAAK,OACnB,MAAME,GAAE,IAAIF,GAAE,KAAK,OACnB,MAAM,KAAK,IACX,MAAM,KAAK,IACX,MAAMlC,MAAK,IACX,MAAMA,MAAK;AAEb,UAAM,KAAK;MAAE,GAAGmC,GAAE,IAAI;MAAK,GAAGA,GAAE,IAAI;IAAK,GACvCE,MAAK;MAAE,GAAGF,GAAE,IAAI;MAAK,GAAGA,GAAE,IAAI;IAAK,GACnCG,KAAI,IAAI,GACR,KAAK;MAAE,GAAGA,GAAE,KAAK,GAAG,IAAIA,GAAE,MAAM,IAAI1E;MAAI,GAAG0E,GAAE,KAAK,GAAG,IAAIA,GAAE,MAAM,IAAI1E;IAAI,GACzEqC,MAAK;MAAE,GAAGqC,GAAE,KAAKD,IAAG,IAAIC,GAAE,KAAK1E;MAAG,GAAG0E,GAAE,KAAKD,IAAG,IAAIC,GAAE,KAAK1E;IAAG,GAC7D,MAAM;MAAE,GAAGsE,GAAE,KAAK,GAAG,IAAIA,GAAE,KAAKtE;MAAG,GAAGsE,GAAE,KAAK,GAAG,IAAIA,GAAE,KAAKtE;IAAG,GAC9D,MAAM;MACJ,GAAGwE,GAAE,KAAKnC,IAAG,IAAImC,GAAE,MAAM,IAAIxE;MAC7B,GAAGwE,GAAE,KAAKnC,IAAG,IAAImC,GAAE,MAAM,IAAIxE;IAC9B;AAEH,WAAO,IAAIqE,QAAOC,IAAG,KAAK,KAAKE,EAAA;EAChC;EAED,OAAO,WAAW;AAChB,WAAO;EACR;EAED,WAAW;AACT,WAAOH,QAAO,SAAA;EACf;EAED,WAAW,aAAa;AACtB,WAAO;EACR;EAED,UAAU;AACR,WAAO,KAAK,SAAA;EACb;EAED,WAAW;AACT,WAAO,MAAM,eAAe,KAAK,MAAA;EAClC;EAED,QAAQ;AACN,QAAI,KAAK,IAAK,QAAO;AACrB,UAAM5F,KAAI,KAAK,QACbI,KAAIJ,GAAE,CAAA,EAAG,GACTa,KAAIb,GAAE,CAAA,EAAG,GACTyB,KAAI;MAAC;MAAKrB;MAAGS;MAAG,KAAK,UAAU,IAAI,MAAM;IAAI;AAC/C,aAASC,KAAI,GAAGc,QAAO5B,GAAE,QAAQc,KAAIc,OAAMd,MAAK;AAC9C,MAAAW,GAAE,KAAKzB,GAAEc,EAAA,EAAG,CAAA;AACZ,MAAAW,GAAE,KAAKzB,GAAEc,EAAA,EAAG,CAAA;IACb;AACD,WAAOW,GAAE,KAAK,GAAA;EACf;EAED,UAAU,QAAQ;AAChB,QAAI,OAAO,WAAW,KAAK,OAAO,OAChC,OAAM,IAAI,MAAM,kCAAA;AAElB,SAAK,SAAS;AACd,SAAK,OAAO,CAAE;EACf;EAED,SAAS;AACP,UAAM,QAAQ,KAAK,YAAA;AACnB,QAAI,UAAU,KAAK,QAAQ;AACzB,WAAK,SAAS;AACd,WAAK,OAAA;IACN;EACF;EAED,cAAc;AACZ,WAAO,KAAK,OACT,IAAI,SAAUqB,IAAG,KAAK;AACrB,aAAO,KAAK,MAAMA,GAAE,IAAIA,GAAE,KAAKA,GAAE,IAAIA,GAAE,IAAI;IAC5C,CAAA,EACA,KAAK,EAAA;EACT;EAED,SAAS;AAEP,SAAK,OAAO,CAAE;AACd,SAAK,UAAU,MAAM,OAAO,KAAK,QAAQ,KAAK,GAAA;AAC9C,SAAK,iBAAA;EACN;EAED,mBAAmB;AACjB,UAAM,SAAS,KAAK;AACpB,UAAM,QAAQ,MAAM,MAAM,OAAO,CAAA,GAAI,OAAO,KAAK,KAAA,GAAQ,OAAO,CAAA,CAAA;AAChE,SAAK,YAAY,QAAQ;EAC1B;EAED,SAAS;AACP,WAAO,MAAM,OAAO,KAAK,WAAW,KAAK,IAAA,CAAK;EAC/C;EAED,OAAO,OAAO,QAAQ,GAAG+C,IAAGC,IAAGC,IAAGxE,MAAI,KAAK;AACzC,UAAMhB,KAAI,MAAM,gBAAgBgB,KAAG,KAAA,GACjC,KAAK,IAAIhB,IACT2F,KAAI;MACF,GAAG3F,KAAIsF,GAAE,IAAI,KAAKE,GAAE;MACpB,GAAGxF,KAAIsF,GAAE,IAAI,KAAKE,GAAE;IACrB,GACDtE,KAAI,MAAM,SAASF,KAAG,KAAA,GACtB0E,KAAI;MACF,GAAGH,GAAE,KAAKA,GAAE,IAAII,GAAE,KAAKzE;MACvB,GAAGqE,GAAE,KAAKA,GAAE,IAAII,GAAE,KAAKzE;IACxB;AACH,WAAO;MAAE,GAAAwE;MAAG,GAAAH;MAAG,GAAAI;MAAG,GAAAL;MAAG,GAAAE;IAAG;EACzB;EAED,OAAOxE,KAAGuE,IAAG;AACX,IAAAA,KAAIA,MAAK,KAAK,IAAIvE,GAAAA;AAClB,QAAIsE,KAAI,KAAK,OAAO,CAAA;AACpB,QAAIE,KAAI,KAAK,OAAO,KAAK,KAAA;AACzB,WAAOH,QAAO,OAAO,KAAK,OAAOC,IAAGC,IAAGC,IAAGxE,GAAAA;EAC3C;EAED,OAAO,OAAO;AACZ,SAAK,OAAA;AACL,YAAQ,SAAS;AACjB,QAAI,KAAK,KAAK,WAAW,QAAQ,EAC/B,QAAO,KAAK;AAEd,SAAK,OAAO,CAAE;AAEd;AACA,SAAK,OAAO,CAAE;AACd,aAAST,KAAI,GAAGd,IAAGuB,KAAGT,KAAI,OAAOA,MAAK;AACpCS,YAAIT,MAAK,QAAQ;AACjB,MAAAd,KAAI,KAAK,QAAQuB,GAAAA;AACjB,MAAAvB,GAAE,IAAIuB;AACN,WAAK,KAAK,KAAKvB,EAAA;IAChB;AACD,WAAO,KAAK;EACb;EAED,GAAGgE,QAAO,OAAO;AACf,YAAQ,SAAS;AACjB,UAAM,MAAM,KAAK,OAAA,GACf,OAAO,CAAE;AACX,aAASlD,KAAI,GAAGgC,IAAGvB,MAAI,GAAGT,KAAI,IAAI,QAAQA,MAAK;AAC7C,MAAAgC,KAAI,IAAIhC,EAAA;AACR,UAAI,MAAM,KAAKgC,IAAGkB,MAAA,IAAS,OAAO;AAChC,aAAK,KAAKlB,EAAA;AACVvB,eAAKT,KAAI,IAAI;MACd;IACF;AACD,QAAI,CAAC,KAAK,OAAQ,QAAO;AACzB,WAAQ,KAAK,KAAK;EACnB;EAED,QAAQkD,QAAO;AAEb,UAAM,MAAM,KAAK,OAAA,GACftB,KAAI,IAAI,SAAS,GACjB,UAAU,MAAM,QAAQ,KAAKsB,MAAA,GAC7B,OAAO,QAAQ,MACf,MAAM,OAAO,KAAKtB,IAClBG,OAAM,OAAO,KAAKH,IAClB,OAAO,MAAMA;AAGf,QAAI,QAAQ,QAAQ,OAClBnB,MAAI,IACJ4E,MAAK5E,KACLvB;AACF,aAAS;AACT,aAASyC,IAAGlB,MAAIsB,MAAK,MAAMtB,OAAK,MAAM;AACpC,MAAAvB,KAAI,KAAK,QAAQuB,GAAAA;AACjB,MAAAkB,KAAI,MAAM,KAAKuB,QAAOhE,EAAA;AACtB,UAAIyC,KAAI,OAAO;AACb,gBAAQA;AACR,QAAA0D,MAAK5E;MACN;IACF;AACD,IAAA4E,MAAKA,MAAK,IAAI,IAAIA,MAAK,IAAI,IAAIA;AAC/B,IAAAnG,KAAI,KAAK,QAAQmG,GAAA;AACjB,IAAAnG,GAAE,IAAImG;AACN,IAAAnG,GAAE,IAAI;AACN,WAAOA;EACR;EAED,IAAIuB,KAAG;AACL,WAAO,KAAK,QAAQA,GAAAA;EACrB;EAED,MAAM,KAAK;AACT,WAAO,KAAK,OAAO,GAAA;EACpB;EAED,QAAQA,KAAG;AACT,QAAI,KAAK,OACP,QAAO,MAAM,kBAAkBA,KAAG,KAAK,QAAQ,KAAK,QAAQ,KAAK,GAAA;AAEnE,WAAO,MAAM,QAAQA,KAAG,KAAK,QAAQ,KAAK,KAAK,KAAK,MAAA;EACrD;EAED,QAAQ;AACN,UAAMvB,KAAI,KAAK,QACb,KAAK,CAACA,GAAE,CAAA,CAAG,GACXqF,KAAIrF,GAAE;AACR,aAASc,KAAI,GAAG0B,MAAI,KAAK1B,KAAIuE,IAAGvE,MAAK;AACnC0B,aAAKxC,GAAEc,EAAA;AACP,YAAMd,GAAEc,KAAI,CAAA;AACZ,SAAGA,EAAA,IAAK;QACN,IAAKuE,KAAIvE,MAAKuE,KAAK7C,KAAG,IAAK1B,KAAIuE,KAAK,IAAI;QACxC,IAAKA,KAAIvE,MAAKuE,KAAK7C,KAAG,IAAK1B,KAAIuE,KAAK,IAAI;MACzC;IACF;AACD,OAAGA,EAAA,IAAKrF,GAAEqF,KAAI,CAAA;AACd,WAAO,IAAIO,QAAO,EAAA;EACnB;EAED,WAAWrE,KAAG;AACZ,WAAO,MAAM,QAAQA,KAAG,KAAK,QAAQ,CAAA,GAAI,KAAK,GAAA;EAC/C;EAED,YAAYA,KAAG;AACb,WAAO,MAAM,QAAQA,KAAG,KAAK,QAAQ,CAAA,GAAI,KAAK,GAAA;EAC/C;EAED,QAAQ;AACN,QAAIvB,KAAI,KAAK;AACb,WAAO,IAAI4F,QAAO,MAAM,MAAM5F,IAAG;MAAE,IAAIA,GAAE,CAAA;MAAI,IAAIA,GAAEA,GAAE,SAAS,CAAA;IAAI,CAAA,CAAC;EACpE;EAED,UAAUuB,KAAG;AACX,WAAO,MAAM,UAAUA,KAAG,KAAK,QAAQ,CAAA,GAAI,KAAK,QAAQ,CAAA,GAAI,KAAK,GAAA;EAClE;EAED,cAAc;AACZ,WAAO,MAAM,YAAY,KAAK,MAAA;EAC/B;EAED,OAAOA,KAAG;AACR,WAAO,KAAK,MAAM,KAAK,UAAUA,GAAAA,IAAK,KAAK,UAAUA,GAAAA;EACtD;EAED,UAAUA,KAAG;AACX,UAAMkB,KAAI,KAAK,WAAWlB,GAAAA;AAC1B,UAAM0D,KAAI,KAAKxC,GAAE,IAAIA,GAAE,IAAIA,GAAE,IAAIA,GAAE,CAAA;AACnC,WAAO;MAAE,GAAA;MAAG,GAAG,CAACA,GAAE,IAAIwC;MAAG,GAAGxC,GAAE,IAAIwC;IAAG;EACtC;EAED,UAAU1D,KAAG;AAEX,UAAM,KAAK,KAAK,WAAWA,GAAAA,GACzB6E,MAAK,KAAK,WAAW7E,MAAI,IAAA,GACzB,KAAK,KAAK,GAAG,IAAI,GAAG,IAAI,GAAG,IAAI,GAAG,IAAI,GAAG,IAAI,GAAG,CAAA,GAChD4D,MAAK,KAAKiB,IAAG,IAAIA,IAAG,IAAIA,IAAG,IAAIA,IAAG,IAAIA,IAAG,IAAIA,IAAG,CAAA;AAClD,OAAG,KAAK;AACR,OAAG,KAAK;AACR,OAAG,KAAK;AACR,IAAAA,IAAG,KAAKjB;AACR,IAAAiB,IAAG,KAAKjB;AACR,IAAAiB,IAAG,KAAKjB;AAER,UAAMrC,KAAI;MACR,GAAGsD,IAAG,IAAI,GAAG,IAAIA,IAAG,IAAI,GAAG;MAC3B,GAAGA,IAAG,IAAI,GAAG,IAAIA,IAAG,IAAI,GAAG;MAC3B,GAAGA,IAAG,IAAI,GAAG,IAAIA,IAAG,IAAI,GAAG;IAC5B;AACD,UAAMjD,KAAI,KAAKL,GAAE,IAAIA,GAAE,IAAIA,GAAE,IAAIA,GAAE,IAAIA,GAAE,IAAIA,GAAE,CAAA;AAC/C,IAAAA,GAAE,KAAKK;AACP,IAAAL,GAAE,KAAKK;AACP,IAAAL,GAAE,KAAKK;AAEP,UAAMkD,KAAI;MACRvD,GAAE,IAAIA,GAAE;MACRA,GAAE,IAAIA,GAAE,IAAIA,GAAE;MACdA,GAAE,IAAIA,GAAE,IAAIA,GAAE;MACdA,GAAE,IAAIA,GAAE,IAAIA,GAAE;MACdA,GAAE,IAAIA,GAAE;MACRA,GAAE,IAAIA,GAAE,IAAIA,GAAE;MACdA,GAAE,IAAIA,GAAE,IAAIA,GAAE;MACdA,GAAE,IAAIA,GAAE,IAAIA,GAAE;MACdA,GAAE,IAAIA,GAAE;IACT;AAED,UAAMmB,KAAI;MACR,GAAA;MACA,GAAGoC,GAAE,CAAA,IAAK,GAAG,IAAIA,GAAE,CAAA,IAAK,GAAG,IAAIA,GAAE,CAAA,IAAK,GAAG;MACzC,GAAGA,GAAE,CAAA,IAAK,GAAG,IAAIA,GAAE,CAAA,IAAK,GAAG,IAAIA,GAAE,CAAA,IAAK,GAAG;MACzC,GAAGA,GAAE,CAAA,IAAK,GAAG,IAAIA,GAAE,CAAA,IAAK,GAAG,IAAIA,GAAE,CAAA,IAAK,GAAG;IAC1C;AACD,WAAOpC;EACR;EAED,KAAK1C,KAAG;AACN,QAAIvB,KAAI,KAAK,QACX,KAAK,CAAE,GACPiF,KAAI,CAAE,GACN,MAAM;AACR,IAAAA,GAAE,KAAA,IAASjF,GAAE,CAAA;AACb,IAAAiF,GAAE,KAAA,IAASjF,GAAE,CAAA;AACb,IAAAiF,GAAE,KAAA,IAASjF,GAAE,CAAA;AACb,QAAI,KAAK,UAAU,EACjB,CAAAiF,GAAE,KAAA,IAASjF,GAAE,CAAA;AAGf,WAAOA,GAAE,SAAS,GAAG;AACnB,WAAK,CAAE;AACP,eAASc,KAAI,GAAGwF,KAAI5D,KAAI1C,GAAE,SAAS,GAAGc,KAAI4B,IAAG5B,MAAK;AAChD,QAAAwF,MAAK,MAAM,KAAK/E,KAAGvB,GAAEc,EAAA,GAAId,GAAEc,KAAI,CAAA,CAAA;AAC/B,QAAAmE,GAAE,KAAA,IAASqB;AACX,WAAG,KAAKA,GAAA;MACT;AACD,MAAAtG,KAAI;IACL;AACD,WAAOiF;EACR;EAED,MAAM,IAAIpC,KAAI;AAEZ,QAAI,OAAO,KAAK,CAAC,CAACA,IAChB,QAAO,KAAK,MAAMA,GAAA,EAAI;AAExB,QAAIA,QAAO,EACT,QAAO,KAAK,MAAM,EAAA,EAAI;AAIxB,UAAMoC,KAAI,KAAK,KAAK,EAAA;AACpB,UAAM,SAAS;MACb,MACE,KAAK,UAAU,IACX,IAAIW,QAAO;QAACX,GAAE,CAAA;QAAIA,GAAE,CAAA;QAAIA,GAAE,CAAA;MAAG,CAAA,IAC7B,IAAIW,QAAO;QAACX,GAAE,CAAA;QAAIA,GAAE,CAAA;QAAIA,GAAE,CAAA;QAAIA,GAAE,CAAA;MAAG,CAAA;MACzC,OACE,KAAK,UAAU,IACX,IAAIW,QAAO;QAACX,GAAE,CAAA;QAAIA,GAAE,CAAA;QAAIA,GAAE,CAAA;MAAG,CAAA,IAC7B,IAAIW,QAAO;QAACX,GAAE,CAAA;QAAIA,GAAE,CAAA;QAAIA,GAAE,CAAA;QAAIA,GAAE,CAAA;MAAG,CAAA;MACzC,MAAMA;IACP;AAGD,WAAO,KAAK,MAAM,MAAM,IAAI,GAAG,GAAG,GAAG,KAAK,KAAK,KAAK,GAAA;AACpD,WAAO,KAAK,MAAM,MAAM,IAAI,IAAI,GAAG,GAAG,KAAK,KAAK,KAAK,GAAA;AACrD,WAAO,MAAM,MAAM,MAAM,IAAI,IAAI,GAAG,GAAG,KAAK,KAAK,KAAK,GAAA;AACtD,WAAO,MAAM,MAAM,MAAM,IAAI,GAAG,GAAG,GAAG,KAAK,KAAK,KAAK,GAAA;AAGrD,QAAI,CAACpC,IACH,QAAO;AAIT,IAAAA,MAAK,MAAM,IAAIA,KAAI,IAAI,GAAG,GAAG,CAAA;AAC7B,WAAO,OAAO,MAAM,MAAMA,GAAA,EAAI;EAC/B;EAED,UAAU;AACR,UAAM,SAAS,CAAE;AACjB,QAAI,QAAQ,CAAE;AAEd,SAAK,KAAK,QACR,SAAU,KAAK;AACb,UAAI,MAAM,SAAUnD,IAAG;AACrB,eAAOA,GAAE,GAAA;MACV;AACD,UAAIM,KAAI,KAAK,QAAQ,CAAA,EAAG,IAAI,GAAA;AAC5B,aAAO,GAAA,IAAO,MAAM,OAAOA,EAAA;AAC3B,UAAI,KAAK,UAAU,GAAG;AACpB,QAAAA,KAAI,KAAK,QAAQ,CAAA,EAAG,IAAI,GAAA;AACxB,eAAO,GAAA,IAAO,OAAO,GAAA,EAAK,OAAO,MAAM,OAAOA,EAAA,CAAE;MACjD;AACD,aAAO,GAAA,IAAO,OAAO,GAAA,EAAK,OAAO,SAAUuB,KAAG;AAC5C,eAAOA,OAAK,KAAKA,OAAK;MACvB,CAAA;AACD,cAAQ,MAAM,OAAO,OAAO,GAAA,EAAK,KAAK,MAAM,UAAA,CAAW;IACxD,EAAC,KAAK,IAAA,CAAK;AAGd,WAAO,SAAS,MAAM,KAAK,MAAM,UAAA,EAAY,OAAO,SAAU7B,IAAG,KAAK;AACpE,aAAO,MAAM,QAAQA,EAAA,MAAO;IAC7B,CAAA;AAED,WAAO;EACR;EAED,OAAO;AACL,UAAM,UAAU,KAAK,QAAA,GACnB,SAAS,CAAE;AACb,SAAK,KAAK,QACR,SAAU+C,IAAG;AACX,aAAOA,EAAA,IAAK,MAAM,UAAU,MAAMA,IAAG,QAAQA,EAAA,CAAA;IAC9C,EAAC,KAAK,IAAA,CAAK;AAEd,WAAO;EACR;EAED,SAAS,OAAO;AACd,UAAM,QAAQ,KAAK,KAAA,GACjB,QAAQ,MAAM,KAAA;AAChB,WAAO,MAAM,YAAY,OAAO,KAAA;EACjC;EAED,OAAOlB,KAAGkB,IAAG;AACX,QAAI,OAAOA,OAAM,aAAa;AAC5B,YAAMK,KAAI,KAAK,IAAIvB,GAAAA,GACjB0C,KAAI,KAAK,OAAO1C,GAAAA;AAClB,YAAM,MAAM;QACP,GAAAuB;QACA,GAAAmB;QACH,GAAGnB,GAAE,IAAImB,GAAE,IAAIxB;QACf,GAAGK,GAAE,IAAImB,GAAE,IAAIxB;MAChB;AACD,UAAI,KAAK,IACP,KAAI,IAAIK,GAAE,IAAImB,GAAE,IAAIxB;AAEtB,aAAO;IACR;AACD,QAAI,KAAK,SAAS;AAChB,YAAM,KAAK,KAAK,OAAO,CAAA,GACrB,SAAS,KAAK,OAAO,IAAI,SAAUzC,IAAG;AACpC,cAAM,MAAM;UACV,GAAGA,GAAE,IAAIuB,MAAI,GAAG;UAChB,GAAGvB,GAAE,IAAIuB,MAAI,GAAG;QACjB;AACD,YAAIvB,GAAE,KAAK,GAAG,EACZ,KAAI,IAAIA,GAAE,IAAIuB,MAAI,GAAG;AAEvB,eAAO;MACR,CAAA;AACH,aAAO,CAAC,IAAIqE,QAAO,MAAA,CAAQ;IAC5B;AACD,WAAO,KAAK,OAAA,EAAS,IAAI,SAAUnE,IAAG;AACpC,UAAIA,GAAE,QACJ,QAAOA,GAAE,OAAOF,GAAAA,EAAG,CAAA;AAErB,aAAOE,GAAE,MAAMF,GAAAA;IAChB,CAAA;EACF;EAED,SAAS;AACP,QAAI,KAAK,UAAU,GAAG;AACpB,YAAM,KAAK,MAAM,MAAM,KAAK,OAAO,CAAA,GAAI,KAAK,OAAO,CAAA,GAAI,KAAK,OAAO,CAAA,CAAA;AACnE,YAAMiD,MAAK,MAAM,MAAM,KAAK,OAAO,CAAA,GAAI,KAAK,OAAO,CAAA,GAAI,KAAK,OAAO,CAAA,CAAA;AACnE,UAAK,KAAK,KAAKA,MAAK,KAAO,KAAK,KAAKA,MAAK,EAAI,QAAO;IACtD;AACD,UAAM,KAAK,KAAK,OAAO,CAAA;AACvB,UAAM5D,MAAK,KAAK,OAAO,CAAA;AACvB,QAAIa,KAAI,GAAG,IAAIb,IAAG,IAAI,GAAG,IAAIA,IAAG;AAChC,QAAI,KAAK,IACP,CAAAa,MAAK,GAAG,IAAIb,IAAG;AAEjB,WAAO,IAAI,KAAKa,EAAA,CAAE,IAAIe,MAAK;EAC5B;EAED,SAAS;AAEP,QAAI1B,IACF,KAAK,GACL+B,MAAK,GACL,OAAO,MACP,SACA,QAAQ,CAAE,GACV,QAAQ,CAAE;AAEZ,QAAI,UAAU,KAAK,QAAA,EAAU;AAC7B,QAAI,QAAQ,QAAQ,CAAA,MAAO,GACzB,WAAU,CAAC,CAAE,EAAC,OAAO,OAAA;AAEvB,QAAI,QAAQ,QAAQ,CAAA,MAAO,GACzB,SAAQ,KAAK,CAAA;AAGf,SAAK,KAAK,QAAQ,CAAA,GAAI/B,KAAI,GAAGA,KAAI,QAAQ,QAAQA,MAAK;AACpD,MAAA+B,MAAK,QAAQ/B,EAAA;AACb,gBAAU,KAAK,MAAM,IAAI+B,GAAA;AACzB,cAAQ,MAAM;AACd,cAAQ,MAAMA;AACd,YAAM,KAAK,OAAA;AACX,WAAKA;IACN;AAGD,UAAM,QAAQ,SAAU,IAAI;AAC1B,WAAK;AACL,MAAAA,MAAK;AACL,aAAOA,OAAM,EACX,MAAKA,MAAK,KAAK,MAAMA,OAAM,IAAI,MAAMA,OAAM,MAAM;AAC/C,kBAAU,GAAG,MAAM,IAAIA,GAAA;AACvB,YAAI,CAAC,QAAQ,OAAA,GAAU;AACrB,UAAAA,OAAM;AACN,cAAI,IAAI,KAAKA,GAAA,IAAM,KAEjB,QAAO,CAAE;AAEX,oBAAU,GAAG,MAAM,IAAIA,GAAA;AACvB,kBAAQ,MAAM,MAAM,IAAI,IAAI,GAAG,GAAG,GAAG,KAAK,GAAG,GAAA;AAC7C,kBAAQ,MAAM,MAAM,IAAIA,KAAI,GAAG,GAAG,GAAG,KAAK,GAAG,GAAA;AAC7C,gBAAM,KAAK,OAAA;AACX,eAAKA;AACL;QACD;MACF;AAEH,UAAI,KAAK,GAAG;AACV,kBAAU,GAAG,MAAM,IAAI,CAAA;AACvB,gBAAQ,MAAM,MAAM,IAAI,IAAI,GAAG,GAAG,GAAG,KAAK,GAAG,GAAA;AAC7C,gBAAQ,MAAM,GAAG;AACjB,cAAM,KAAK,OAAA;MACZ;IACF,CAAA;AACD,WAAO;EACR;EAED,UAAUnD,IAAG,IAAIiE,KAAI;AACnB,IAAAA,MAAK,OAAOA,QAAO,WAAWA,MAAK;AAKnC,UAAME,KAAI,KAAK;AACf,QAAIpB,KAAI,KAAK,OAAO,IAAI,CAACiD,IAAG5E,QAAO,IAAIA,KAAI+C,MAAK,KAAM/C,KAAI+C,KAAKF,GAAA;AAC/D,WAAO,IAAIiC,QACT,KAAK,OAAO,IAAI,CAAC5F,IAAGc,QAAO;MACzB,GAAGd,GAAE,IAAIN,GAAE,IAAI+C,GAAE3B,EAAA;MACjB,GAAGd,GAAE,IAAIN,GAAE,IAAI+C,GAAE3B,EAAA;IAClB,EAAA,CAAE;EAEN;EAED,MAAM2B,IAAG;AACP,UAAM,QAAQ,KAAK;AACnB,QAAI,aAAa;AACjB,QAAI,OAAOA,OAAM,WACf,cAAaA;AAEf,QAAI,cAAc,UAAU,EAC1B,QAAO,KAAK,MAAA,EAAQ,MAAM,UAAA;AAK5B,UAAM,YAAY,KAAK;AACvB,UAAM,SAAS,KAAK;AAEpB,QAAI,KAAK,QACP,QAAO,KAAK,UACV,KAAK,OAAO,CAAA,GACZ,aAAa,WAAW,CAAA,IAAKA,IAC7B,aAAa,WAAW,CAAA,IAAKA,EAAA;AAIjC,UAAM,KAAK,aAAa,WAAW,CAAA,IAAKA;AACxC,UAAM2D,MAAK,aAAa,WAAW,CAAA,IAAK3D;AACxC,UAAM/C,KAAI,CAAC,KAAK,OAAO,GAAG,EAAA,GAAK,KAAK,OAAO,GAAG,EAAA,CAAI;AAClD,UAAM,KAAK,CAAE;AACb,UAAMmE,KAAI,MAAM,KAAKnE,GAAE,CAAA,GAAIA,GAAE,CAAA,EAAG,GAAGA,GAAE,CAAA,GAAIA,GAAE,CAAA,EAAG,CAAA;AAE9C,QAAI,CAACmE,GACH,OAAM,IAAI,MAAM,iDAAA;AAKlB,KAAC,GAAG,CAAE,EAAC,QAAQ,SAAUtC,KAAG;AAC1B,YAAMvB,KAAK,GAAGuB,MAAI,KAAA,IAAS,MAAM,KAAK,OAAOA,MAAI,KAAA,CAAA;AACjD,MAAAvB,GAAE,MAAMuB,MAAI6E,MAAK,MAAM1G,GAAE6B,GAAAA,EAAG,EAAE;AAC9B,MAAAvB,GAAE,MAAMuB,MAAI6E,MAAK,MAAM1G,GAAE6B,GAAAA,EAAG,EAAE;IAC/B,CAAA;AAED,QAAI,CAAC,YAAY;AAGf,OAAC,GAAG,CAAE,EAAC,QAAQ,CAACA,QAAM;AACpB,YAAI,UAAU,KAAK,CAAC,CAACA,IAAG;AACxB,cAAMvB,KAAI,GAAGuB,MAAI,KAAA;AACjB,cAAMkB,MAAI,KAAK,WAAWlB,GAAAA;AAC1B,cAAMwC,MAAK;UAAE,GAAG/D,GAAE,IAAIyC,IAAE;UAAG,GAAGzC,GAAE,IAAIyC,IAAE;QAAG;AACzC,WAAGlB,MAAI,CAAA,IAAK,MAAM,KAAKvB,IAAG+D,KAAIF,IAAG,OAAOtC,MAAI,CAAA,CAAA;MAC7C,CAAA;AACD,aAAO,IAAIqE,QAAO,EAAA;IACnB;AAID,KAAC,GAAG,CAAE,EAAC,QAAQ,SAAUrE,KAAG;AAC1B,UAAI,UAAU,KAAK,CAAC,CAACA,IAAG;AACxB,UAAIvB,KAAI,OAAOuB,MAAI,CAAA;AACnB,UAAI,KAAK;QACP,GAAGvB,GAAE,IAAI6D,GAAE;QACX,GAAG7D,GAAE,IAAI6D,GAAE;MACZ;AACD,UAAI0C,MAAK,aAAa,YAAYhF,MAAI,KAAK,KAAA,IAASkB;AACpD,UAAI,cAAc,CAAC,UAAW,CAAA8D,MAAK,CAACA;AACpC,UAAIpD,KAAI,KAAK,GAAG,IAAI,GAAG,IAAI,GAAG,IAAI,GAAG,CAAA;AACrC,SAAG,KAAKA;AACR,SAAG,KAAKA;AACR,SAAG5B,MAAI,CAAA,IAAK;QACV,GAAGvB,GAAE,IAAIuG,MAAK,GAAG;QACjB,GAAGvG,GAAE,IAAIuG,MAAK,GAAG;MAClB;IACF,CAAA;AACD,WAAO,IAAIX,QAAO,EAAA;EACnB;EAED,QAAQ,IAAIjC,KAAI,IAAI,IAAI;AACtB,IAAAA,MAAKA,QAAO,SAAY,KAAKA;AAE7B,QAAI,KAAK,SAAS;AAIhB,YAAMM,KAAI,KAAK,OAAO,CAAA;AACtB,YAAM,QAAQ,KAAK,OAAO,CAAA;AAC1B,YAAM,MAAM,KAAK,OAAO,KAAK,OAAO,SAAS,CAAA;AAC7C,UAAIxC,IAAG,KAAKgE;AAEZ,UAAI,OAAO,QAAW;AACpB,aAAK;AACL,aAAK9B;MACN;AAED,MAAAlC,KAAI;QAAE,GAAG,MAAM,IAAIwC,GAAE,IAAI;QAAI,GAAG,MAAM,IAAIA,GAAE,IAAI;MAAI;AACpD,MAAAwB,KAAI;QAAE,GAAG,IAAI,IAAIxB,GAAE,IAAI;QAAI,GAAG,IAAI,IAAIA,GAAE,IAAI;MAAI;AAChD,YAAM;QAAE,IAAIxC,GAAE,IAAIgE,GAAE,KAAK;QAAG,IAAIhE,GAAE,IAAIgE,GAAE,KAAK;MAAG;AAChD,YAAM,QAAQ;QAAChE;QAAG;QAAKgE;MAAE;AAEzB,MAAAhE,KAAI;QAAE,GAAG,MAAM,IAAIwC,GAAE,IAAIN;QAAI,GAAG,MAAM,IAAIM,GAAE,IAAIN;MAAI;AACpD,MAAA8B,KAAI;QAAE,GAAG,IAAI,IAAIxB,GAAE,IAAI;QAAI,GAAG,IAAI,IAAIA,GAAE,IAAI;MAAI;AAChD,YAAM;QAAE,IAAIxC,GAAE,IAAIgE,GAAE,KAAK;QAAG,IAAIhE,GAAE,IAAIgE,GAAE,KAAK;MAAG;AAChD,YAAM,QAAQ;QAACA;QAAG;QAAKhE;MAAE;AAEzB,YAAM+E,OAAK,MAAM,SAAS,MAAM,CAAA,GAAI,MAAM,CAAA,CAAA;AAC1C,YAAMC,OAAK,MAAM,SAAS,MAAM,CAAA,GAAI,MAAM,CAAA,CAAA;AAC1C,YAAMC,aAAW;QAACF;QAAI,IAAIZ,QAAO,KAAA;QAAQa;QAAI,IAAIb,QAAO,KAAA;MAAO;AAC/D,aAAO,IAAI,WAAWc,UAAAA;IACvB;AAED,UAAM,UAAU,KAAK,OAAA,GACnB,MAAM,QAAQ,QACd,UAAU,CAAE;AAEd,QAAI,UAAU,CAAE,GACd1G,IACA,OAAO,GACP,OAAO,KAAK,OAAA;AAEd,UAAM,YAAY,OAAO,OAAO,eAAe,OAAO,OAAO;AAE7D,aAAS,uBAAuByB,IAAGgE,IAAGkB,QAAMC,QAAM,MAAM;AACtD,aAAO,SAAUlH,IAAG;AAClB,cAAM,KAAKkH,SAAOD,QAChB5D,OAAM6D,SAAO,QAAQD,QACrBlE,KAAIgD,KAAIhE;AACV,eAAO,MAAM,IAAI/B,IAAG,GAAG,GAAG+B,KAAI,KAAKgB,IAAGhB,KAAIsB,MAAKN,EAAA;MAChD;IACF;AAGD,YAAQ,QAAQ,SAAU,SAAS;AACjC,YAAM,OAAO,QAAQ,OAAA;AACrB,UAAI,WAAW;AACb,gBAAQ,KACN,QAAQ,MAAM,uBAAuB,IAAI,IAAI,MAAM,MAAM,IAAA,CAAK,CAAC;AAEjE,gBAAQ,KACN,QAAQ,MAAM,uBAAuB,CAACkB,KAAI,CAAC,IAAI,MAAM,MAAM,IAAA,CAAK,CAAC;MAEpE,OAAM;AACL,gBAAQ,KAAK,QAAQ,MAAM,EAAA,CAAG;AAC9B,gBAAQ,KAAK,QAAQ,MAAM,CAACA,GAAA,CAAG;MAChC;AACD,cAAQ;IACT,CAAA;AAGD,cAAU,QACP,IAAI,SAAUlC,IAAG;AAChB,MAAAzB,KAAIyB,GAAE;AACN,UAAIzB,GAAE,CAAA,EACJ,CAAAyB,GAAE,SAAS;QAACzB,GAAE,CAAA;QAAIA,GAAE,CAAA;QAAIA,GAAE,CAAA;QAAIA,GAAE,CAAA;MAAG;UAEnC,CAAAyB,GAAE,SAAS;QAACzB,GAAE,CAAA;QAAIA,GAAE,CAAA;QAAIA,GAAE,CAAA;MAAG;AAE/B,aAAOyB;IACR,CAAA,EACA,QAAA;AAGH,UAAMoF,MAAK,QAAQ,CAAA,EAAG,OAAO,CAAA,GAC3BC,MAAK,QAAQ,MAAM,CAAA,EAAG,OAAO,QAAQ,MAAM,CAAA,EAAG,OAAO,SAAS,CAAA,GAC9DC,MAAK,QAAQ,MAAM,CAAA,EAAG,OAAO,QAAQ,MAAM,CAAA,EAAG,OAAO,SAAS,CAAA,GAC9DC,MAAK,QAAQ,CAAA,EAAG,OAAO,CAAA,GACvBR,MAAK,MAAM,SAASO,KAAIF,GAAA,GACxBJ,MAAK,MAAM,SAASK,KAAIE,GAAA,GACxB,WAAW,CAACR,GAAG,EAAC,OAAO,OAAA,EAAS,OAAO,CAACC,GAAG,CAAA,EAAE,OAAO,OAAA;AAEtD,WAAO,IAAI,WAAW,QAAA;EACvB;EAED,cAAc,IAAI9C,KAAI,4BAA4B;AAChD,IAAAA,MAAKA,OAAM;AACX,UAAM,UAAU,KAAK,QAAQ,IAAIA,GAAA,EAAI;AACrC,UAAM,SAAS,CAAE;AACjB,aAAS7C,KAAI,GAAG,MAAM,QAAQ,QAAQA,KAAI,MAAM,GAAGA,MAAK;AACtD,YAAM,QAAQ,MAAM,UAClB,QAAQA,EAAA,GACR,QAAQ,MAAMA,EAAA,GACd,0BAAA;AAEF,YAAM,SAAS,UAAUA,KAAI;AAC7B,YAAM,OAAO,UAAUA,KAAI,MAAM,IAAI;AACrC,aAAO,KAAK,KAAA;IACb;AACD,WAAO;EACR;EAED,WAAW,OAAO,4BAA4B;AAC5C,QAAI,CAAC,MAAO,QAAO,KAAK,eAAe,0BAAA;AACvC,QAAI,MAAM,MAAM,MAAM,GACpB,QAAO,KAAK,eAAe,KAAA;AAE7B,QAAI,iBAAiB8E,QACnB,SAAQ,MAAM,OAAA;AAEhB,WAAO,KAAK,gBACV,KAAK,OAAA,GACL,OACA,0BAAA;EAEH;EAED,eAAelB,OAAM;AACnB,UAAM,KAAKpE,KAAIoE,MAAK,GAAG,GAAGA,MAAK,GAAG,CAAA,GAChC,KAAKpE,KAAIoE,MAAK,GAAG,GAAGA,MAAK,GAAG,CAAA,GAC5B,KAAKrE,KAAIqE,MAAK,GAAG,GAAGA,MAAK,GAAG,CAAA,GAC5B,KAAKrE,KAAIqE,MAAK,GAAG,GAAGA,MAAK,GAAG,CAAA;AAC9B,WAAO,MAAM,MAAM,KAAK,QAAQA,KAAA,EAAM,OAAO,CAACnD,QAAM;AAClD,UAAIvB,KAAI,KAAK,IAAIuB,GAAAA;AACjB,aAAO,MAAM,QAAQvB,GAAE,GAAG,IAAI,EAAA,KAAO,MAAM,QAAQA,GAAE,GAAG,IAAI,EAAA;IAC7D,CAAA;EACF;EAED,eAAe,4BAA4B;AAKzC,UAAM,UAAU,KAAK,OAAA,GACnB,MAAM,QAAQ,SAAS,GACvB,UAAU,CAAE;AAEd,aAASc,KAAI,GAAG,QAAQ,MAAM,OAAOA,KAAI,KAAKA,MAAK;AACjD,aAAO,QAAQ,MAAMA,IAAGA,KAAI,CAAA;AAC5B,cAAQ,QAAQ,MAAMA,KAAI,CAAA;AAC1B,eAAS,KAAK,gBAAgB,MAAM,OAAO,0BAAA;AAC3C,cAAQ,KAAK,GAAG,MAAA;IACjB;AACD,WAAO;EACR;EAED,gBAAgB,IAAIyE,KAAI,4BAA4B;AAClD,UAAM,QAAQ,CAAE;AAEhB,OAAG,QAAQ,SAAU7C,IAAG;AACtB,MAAA6C,IAAG,QAAQ,SAAUzF,IAAG;AACtB,YAAI4C,GAAE,SAAS5C,EAAA,EACb,OAAM,KAAK;UAAE,MAAM4C;UAAG,OAAO5C;QAAG,CAAA;MAEnC,CAAA;IACF,CAAA;AAED,QAAIyE,iBAAgB,CAAE;AACtB,UAAM,QAAQ,SAAU,MAAM;AAC5B,YAAM,SAAS,MAAM,cACnB,KAAK,MACL,KAAK,OACL,0BAAA;AAEF,UAAI,OAAO,SAAS,EAClB,CAAAA,iBAAgBA,eAAc,OAAO,MAAA;IAExC,CAAA;AACD,WAAOA;EACR;EAED,KAAK,gBAAgB;AACnB,qBAAiB,kBAAkB;AACnC,WAAO,KAAK,SAAS,gBAAgB,CAAE,CAAA;EACxC;EAED,OAAO,IAAI,KAAK9C,IAAGgE,IAAG;AACpB,UAAMR,MAAKQ,KAAIhE,MAAK,GAClB,KAAK,KAAK,IAAIA,KAAIwD,EAAA,GAClBM,MAAK,KAAK,IAAIE,KAAIR,EAAA,GAClB,MAAM,MAAM,KAAK,IAAI,GAAA,GACrB,KAAK,MAAM,KAAK,IAAI,EAAA,GACpBtB,MAAK,MAAM,KAAK,IAAI4B,GAAA;AACtB,WAAO,IAAI,KAAK,GAAA,IAAO,IAAI5B,MAAK,GAAA;EACjC;EAED,SAAS,gBAAgB,SAAS;AAChC,QAAI,MAAM,GACR,MAAM,GACN;AAEF,OAAG;AACD,eAAS;AAGT,YAAM;AAGN,UAAI,MAAM,KAAK,IAAI,GAAA,GACjB,KACA,KACA6B,MACA;AAGF,UAAI,YAAY,OACd,YAAY,OACZ;AAGF,UAAI,MAAM,KACR,SAAS,GACT,OAAO;AAGT,SAAG;AACD,oBAAY;AACZ,mBAAWA;AACX,eAAO,MAAM,OAAO;AACpB;AAEA,cAAM,KAAK,IAAI,GAAA;AACf,cAAM,KAAK,IAAI,GAAA;AAEf,QAAAA,OAAM,MAAM,WAAW,KAAK,KAAK,GAAA;AAGjC,QAAAA,KAAI,WAAW;UACb,OAAO;UACP,KAAK;QACN;AAED,YAAI,QAAQ,KAAK,OAAOA,MAAK,KAAK,KAAK,GAAA;AACvC,oBAAY,SAAS;AAErB,eAAO,aAAa,CAAC;AACrB,YAAI,CAAC,KAAM,UAAS;AAGpB,YAAI,WAAW;AAEb,cAAI,OAAO,GAAG;AAEZ,YAAAA,KAAI,SAAS,MAAM,SAAS;AAC5B,uBAAWA;AAGX,gBAAI,MAAM,GAAG;AACX,kBAAI/C,KAAI;gBACN,GAAG+C,KAAI,IAAIA,KAAI,IAAI,IAAIA,KAAI,CAAA;gBAC3B,GAAGA,KAAI,IAAIA,KAAI,IAAI,IAAIA,KAAI,CAAA;cAC5B;AACD,cAAAA,KAAI,KAAK,MAAM,MAAM;gBAAE,GAAGA,KAAI;gBAAG,GAAGA,KAAI;cAAG,GAAE/C,IAAG,KAAK,IAAI,CAAA,CAAE;YAC5D;AACD;UACD;AAED,gBAAM,OAAO,MAAM,OAAO;QAC3B,MAEC,OAAM;MAET,SAAQ,CAAC,QAAQ,WAAW;AAE7B,UAAI,UAAU,IACZ;AAKF,iBAAW,WAAW,WAAW+C;AACjC,cAAQ,KAAK,QAAA;AACb,YAAM;IACP,SAAQ,MAAM;AACf,WAAO;EACR;AACF;;;AC1+BD,IAAa,SAAS,CAACyB,OAAM;AACzB,MAAI,UAAUA,EAAA,GACV;QAAIA,GAAE,MAAM,KACR,QAAO;EAAM;AAErB,SAAOA,GAAE,MAAM,QAAQA,GAAE,MAAM;AAClC;AAID,IAAaC,UAAQ,CAACD,OAAM;AACxB,MAAI,UAAUA,EAAA,GACV;QAAI,CAAC,OAAO,MAAMA,GAAE,CAAA,EAChB,QAAO;EAAM;AAErB,SAAO,OAAO,MAAMA,GAAE,CAAA,KAAM,OAAO,MAAMA,GAAE,CAAA;AAC9C;AACD,SAAgB,KAAKA,IAAG,OAAO,SAAS,YAAY,IAAI;AACpD,MAAIA,OAAM,OACN,QAAO,YAAY,IAAI,IAAA,sCAA0C,KAAK,UAAUA,EAAA,CAAE,IAAI,SAAA;AAE1F,MAAIA,OAAM,KACN,QAAO,YAAY,IAAI,IAAA,iCAAqC,KAAK,UAAUA,EAAA,CAAE,IAAI,SAAA;AAErF,MAAI,OAAOA,OAAM,SACb,QAAO,YAAY,IAAI,IAAA,cAAkB,OAAOA,EAAA,uBAAwB,SAAA;AAC5E,MAAIA,GAAE,MAAM,OACR,QAAO,YAAY,IAAI,IAAA,wCAA4C,KAAK,UAAUA,EAAA,CAAE,IAAI,SAAA;AAE5F,MAAIA,GAAE,MAAM,OACR,QAAO,YAAY,IAAI,IAAA,wCAA4C,KAAK,UAAUA,EAAA,CAAE,IAAI,SAAA;AAE5F,MAAI,OAAOA,GAAE,MAAM,SACf,QAAO,YAAY,IAAI,IAAA,6BAAiC,OAAOA,GAAE,CAAA,IAAK,SAAA;AAE1E,MAAI,OAAOA,GAAE,MAAM,SACf,QAAO,YAAY,IAAI,IAAA,6BAAiC,OAAOA,GAAE,CAAA,IAAK,SAAA;AAE1E,MAAIA,GAAE,MAAM,QAAW;AACnB,QAAI,OAAOA,GAAE,MAAM,SACf,QAAO,YAAY,GAAG,IAAA,6BAAiC,OAAOA,GAAE,CAAA,IAAK,SAAA;AACzE,QAAI,OAAO,MAAMA,GAAE,CAAA,EACf,QAAO,YAAY,IAAI,IAAA,oBAAwB,KAAK,UAAUA,EAAA,CAAE,IAAI,SAAA;EAC3E;AACD,MAAIA,GAAE,MAAM,KACR,QAAO,YAAY,IAAI,IAAA,eAAmB,SAAA;AAC9C,MAAIA,GAAE,MAAM,KACR,QAAO,YAAY,IAAI,IAAA,eAAmB,SAAA;AAC9C,MAAI,OAAO,MAAMA,GAAE,CAAA,EACf,QAAO,YAAY,IAAI,IAAA,cAAkB,SAAA;AAC7C,MAAI,OAAO,MAAMA,GAAE,CAAA,EACf,QAAO,YAAY,IAAI,IAAA,cAAkB,SAAA;AAC7C,SAAO;IAAE,SAAS;IAAM,OAAOA;EAAG;AACrC;AAMD,SAAgBE,QAAMF,IAAG,OAAO,SAAS,MAAM;AAC3C,cAAY,KAAKA,IAAG,MAAM,IAAA,CAAK;AAmClC;AAMD,IAAa,oBAAoB,CAACG,KAAI,OAAO,SAAS;AAClDD,UAAMC,KAAI,IAAA;AACV,cAAY,WAAWA,IAAG,GAAG,WAAW,GAAG,IAAA,IAAQ,GAAG,WAAWA,IAAG,GAAG,WAAW,GAAG,IAAA,IAAQ,GAAG,MAAM;AAClG,QAAI,OAAOA,IAAG,MAAM,YAChB,QAAO,WAAWA,IAAG,GAAG,WAAW,GAAG,IAAA,IAAQ;EAErD,CAAA;AACD,SAAO;AACV;AASD,SAAgB,QAAQH,IAAG;AACvB,MAAIA,OAAM,OACN,QAAO;AACX,MAAIA,OAAM,KACN,QAAO;AACX,MAAIA,GAAE,MAAM,OACR,QAAO;AACX,MAAIA,GAAE,MAAM,OACR,QAAO;AACX,SAAO;AACV;AAQD,IAAa,YAAY,CAACA,OAAM;AAC5B,MAAIA,OAAM,OACN,QAAO;AACX,MAAIA,OAAM,KACN,QAAO;AACX,MAAIA,GAAE,MAAM,OACR,QAAO;AACX,MAAIA,GAAE,MAAM,OACR,QAAO;AACX,MAAIA,GAAE,MAAM,OACR,QAAO;AACX,SAAO;AACV;AAOD,IAAaI,WAAU,CAACJ,OAAM;AAC1B,MAAI,UAAUA,EAAA,GACV;QAAIA,GAAE,MAAM,EACR,QAAO;EAAM;AAErB,SAAOA,GAAE,MAAM,KAAKA,GAAE,MAAM;AAC/B;AASD,IAAa,gBAAgB,CAACA,OAAM;AAChC,MAAI,UAAUA,EAAA,GACV;QAAI,CAAC,OAAO,MAAMA,GAAE,CAAA,EAChB,QAAO;EAAM;AAErB,SAAO,OAAO,MAAMA,GAAE,CAAA,KAAM,OAAO,MAAMA,GAAE,CAAA;AAC9C;AChLD,IAAa,WAAW,CAACK,IAAG,OAAO,gBAAgB;AAC/C,MAAIA,OAAM,OACN,OAAM,IAAI,MAAM,GAAG,IAAA,eAAmB;AAC1C,MAAI,OAAO,MAAMA,EAAA,EACb,OAAM,IAAI,MAAM,GAAG,IAAA,SAAa;AACpC,MAAIA,KAAI,EACJ,OAAM,IAAI,MAAM,GAAG,IAAA,qBAAyB;AACnD;AAcD,IAAaH,UAAQ,CAACI,OAAM,OAAO,WAAW;AAC1C,MAAIA,UAAS,OACT,OAAM,IAAI,MAAM,mBAAmB;AACvC,MAAIC,eAAaD,KAAA,EACbE,SAAYF,OAAM,IAAA;AACtB,WAASA,MAAK,OAAO,OAAO,QAAQ;AACpC,WAASA,MAAK,QAAQ,OAAO,SAAS;AACzC;AAoBD,IAAa,oBAAoB,CAACA,OAAM,WAAW;AAC/CJ,UAAMI,KAAA;AACN,MAAIC,eAAaD,KAAA,KAAS,WAAW,OACjC,QAAOA;AAEX,MAAI,WAAW,OACX,OAAM,IAAI,MAAM,0CAA0C;AAC9D,SAAO,OAAO,OAAO;IAAE,GAAGA;IAAM,GAAG;EAAQ,CAAA;AAC9C;AAOD,IAAaG,oBAAkB,CAACH,OAAM,OAAO,WAAW;AACpD,MAAI,CAACC,eAAaD,KAAA,EACd,OAAM,IAAI,MAAM,YAAY,IAAA,cAAkB;AAClDJ,UAAMI,OAAM,IAAA;AACf;AAOD,IAAaF,YAAU,CAACE,UAASA,MAAK,UAAU,KAAKA,MAAK,WAAW;AAOrE,IAAaI,kBAAgB,CAACJ,UAAS,OAAO,MAAMA,MAAK,KAAA,KAAU,OAAO,MAAMA,MAAK,MAAA;AAMrF,IAAaC,iBAAe,CAACD,UAASA,MAAK,MAAM,UAAaA,MAAK,MAAM;AAMzE,IAAa,SAAS,CAACA,UAAS;AAC5B,MAAIA,UAAS,OACT,QAAO;AACX,MAAIA,MAAK,UAAU,OACf,QAAO;AACX,MAAIA,MAAK,WAAW,OAChB,QAAO;AACX,SAAO;AACV;AAOD,IAAa,mBAAmB,CAACA,UAAS,OAAOA,KAAA,KAASC,eAAaD,KAAA;ACvGvE,IAAaK,SAAO,CAACL,UAAS;AAC1BJ,UAAMI,KAAA;AACN,SAAOA,MAAK,SAASA,MAAK;AAC7B;ACDD,SAAgB,YAAY,IAAI,aAAa,aAAa;AACtD,MAAI,QAAS,OAAO,gBAAgB,WAAY,cAAc,YAAY;AAC1E,MAAIM,WAAU,OAAO,gBAAgB,WAAY,cAAc,YAAY;AAC3E,MAAI,UAAU,OACV,OAAM,IAAI,MAAM,yBAAyB;AAC7C,MAAIA,aAAW,OACX,OAAM,IAAI,MAAM,0BAA0B;AAC9C,UAAQ,GAAG,OAAO,OAAO;AACzBA,aAAS,GAAGA,UAAQ,QAAQ;AAC5B,MAAI,OAAO,gBAAgB,SACvB,KAAIL,eAAa,WAAA,GAAc;AAC3B,UAAMM,KAAI,GAAG,YAAY,GAAG,GAAG;AAC/B,UAAMC,KAAI,GAAG,YAAY,GAAG,GAAG;AAC/B,WAAO;MAAE,GAAG;MAAa;MAAO,QAAA;MAAQ,GAAAD;MAAG,GAAAC;IAAG;EACjD,MAEG,QAAO;IACH,GAAG;IAAa;IAAO,QAAA;EAC1B;AAGT,SAAO;IAAE;IAAO,QAAA;EAAQ;AAC3B;AAaD,SAAgB,WAAW,IAAIC,IAAGC,IAAGC,IAAG;AACpCf,UAAMa,IAAG,GAAG;AACZ,MAAI,OAAOC,EAAA,EAEP,QAAO,iBAAiBD,EAAA,IAAK,OAAO,OAAO;IACvC,GAAGA;IACH,GAAG,GAAGA,GAAE,GAAGC,GAAE,KAAA;IACb,GAAG,GAAGD,GAAE,GAAGC,GAAE,MAAA;IACb,OAAO,GAAGD,GAAE,OAAOC,GAAE,KAAA;IACrB,QAAQ,GAAGD,GAAE,QAAQC,GAAE,MAAA;EAC1B,CAAA,IAAI,OAAO,OAAO;IACf,GAAGD;IACH,OAAO,GAAGA,GAAE,OAAOC,GAAE,KAAA;IACrB,QAAQ,GAAGD,GAAE,QAAQC,GAAE,MAAA;EAC1B,CAAA;OAEA;AAED,QAAI,OAAOA,OAAM,SACb,OAAM,IAAI,UAAU,yDAAyD,KAAK,UAAUA,EAAA,CAAE,EAAE;AAEpG,QAAI,OAAOC,OAAM,SACb,OAAM,IAAI,MAAM,uCAAuC,KAAK,UAAUA,EAAA,CAAE,EAAE;AAC9E,WAAO,iBAAiBF,EAAA,IAAK,OAAO,OAAO;MACvC,GAAGA;MACH,GAAG,GAAGA,GAAE,GAAGC,EAAA;MACX,GAAG,GAAGD,GAAE,GAAGE,EAAA;MACX,OAAO,GAAGF,GAAE,OAAOC,EAAA;MACnB,QAAQ,GAAGD,GAAE,QAAQE,EAAA;IACxB,CAAA,IAAI,OAAO,OAAO;MACf,GAAGF;MACH,OAAO,GAAGA,GAAE,OAAOC,EAAA;MACnB,QAAQ,GAAGD,GAAE,QAAQE,EAAA;IACxB,CAAA;EACJ;AACJ;AACD,SAAgB,YAAY,IAAIX,OAAM,WAAW;AAC7C,SAAOC,eAAaD,KAAA,IAAQ,OAAO,OAAO;IACtC,GAAGA;IACH,GAAG,GAAGA,MAAK,GAAG,SAAA;IACd,GAAG,GAAGA,MAAK,GAAG,SAAA;IACd,OAAO,GAAGA,MAAK,OAAO,SAAA;IACtB,QAAQ,GAAGA,MAAK,QAAQ,SAAA;EAC3B,CAAA,IAAI,OAAO,OAAO;IACf,GAAGA;IACH,OAAO,GAAGA,MAAK,OAAO,SAAA;IACtB,QAAQ,GAAGA,MAAK,QAAQ,SAAA;EAC3B,CAAA;AACJ;AAQD,SAAgB,SAAS,IAAIA,OAAM,WAAW;AAC1C,SAAO,OAAO,OAAO;IACjB,GAAGA;IACH,OAAO,GAAGA,MAAK,OAAO,SAAA;IACtB,QAAQ,GAAGA,MAAK,QAAQ,SAAA;EAC3B,CAAA;AACJ;ACpGD,IAAa,WAAW,CAACA,OAAM,SAAS;AACpC,QAAM,EAAE,GAAAO,IAAG,GAAAC,IAAG,OAAO,QAAA,SAAA,IAAWR;AAChC,UAAQ,MAAR;IACI,KAAK;AACD,aAAO,OAAO,OAAO;QAAE,GAAAO;QAAG,GAAAC;MAAG,CAAA;IAEjC,KAAK;AACD,aAAO,OAAO,OAAO;QACjB,GAAGD,KAAI,QAAQ;QACf,GAAAC;MACH,CAAA;IAEL,KAAK;AACD,aAAO,OAAO,OAAO;QACjB,GAAGD,KAAI;QACP,GAAAC;MACH,CAAA;IAEL,KAAK;AACD,aAAO,OAAO,OAAO;QAAE,GAAAD;QAAG,GAAGC,KAAIF;MAAQ,CAAA;IAE7C,KAAK;AACD,aAAO,OAAO,OAAO;QACjB,GAAGC,KAAI,QAAQ;QACf,GAAGC,KAAIF;MACV,CAAA;IAEL,KAAK;AACD,aAAO,OAAO,OAAO;QACjB,GAAGC,KAAI;QACP,GAAGC,KAAIF;MACV,CAAA;IAEL,KAAK;AACD,aAAO,OAAO,OAAO;QAAE,GAAAC;QAAG,GAAGC,KAAIF,WAAS;MAAG,CAAA;IAEjD,KAAK;AACD,aAAO,OAAO,OAAO;QAAE,GAAGC,KAAI;QAAO,GAAGC,KAAIF,WAAS;MAAG,CAAA;IAE5D,KAAK;AACD,aAAO,OAAO,OAAO;QACjB,GAAGC,KAAI,QAAQ;QACf,GAAGC,KAAIF,WAAS;MACnB,CAAA;IAEL;AAEI,YAAM,IAAI,MAAM,sBAAsB,IAAA,EAAM;EAEnD;AACJ;AC9CD,IAAaM,WAAS,CAACZ,OAAM,WAAW;AACpCJ,UAAMI,KAAA;AACN,MAAI,WAAW,UAAa,QAAQA,KAAA,EAChC,UAASA;WACJ,WAAW,OAChB,UAAS;IAAE,GAAG;IAAG,GAAG;EAAG;AAC3B,QAAMa,KAAI,kBAAkBb,OAAM,MAAA;AAClC,SAAO,OAAO,OAAO;IACjB,GAAG,OAAO,IAAIA,MAAK,QAAQ;IAC3B,GAAG,OAAO,IAAIA,MAAK,SAAS;EAC/B,CAAA;AACJ;ACdD,IAAa,eAAe,CAAC,iBAAiB;AAC1C,QAAMW,KAAIC,SAAO,YAAA;AACjB,QAAME,KAAI,aAAa,QAAQ;AAC/B,QAAMC,KAAI,aAAa,SAAS;AAChC,QAAM,qBAAqB,CAACC,YAAU;AAClC,WAAO;MACH,GAAGA;MACH,GAAGA,QAAM,IAAIF,KAAIH,GAAE;MACnB,GAAGK,QAAM,IAAID,KAAIJ,GAAE;IACtB;EACJ;AACD,QAAM,qBAAqB,CAACK,YAAU;AAClC,WAAO;MACH,GAAGA;MACH,IAAKA,QAAM,IAAI,aAAa,KAAKF,KAAK;MACtC,IAAKE,QAAM,IAAI,aAAa,KAAKD,KAAK;IACzC;EACJ;AACD,SAAO;IAAE;IAAoB;EAAoB;AACpD;ACxBD,IAAaE,gBAAc,OAAO,OAAO;EAAE,GAAG;EAAY,GAAG;AAAY,CAAA;AAMzE,IAAa,gBAAgB,OAAO,OAAO;EAAE,GAAG;EAAY,GAAG;EAAY,GAAG;AAAY,CAAA;ACI1F,IAAaC,YAAU,CAAClB,OAAM,WAAW;AACrC,QAAMa,KAAI,kBAAkBb,OAAM,MAAA;AAClC,SAAO;IACH;MAAE,GAAGa,GAAE;MAAG,GAAGA,GAAE;IAAG;IAClB;MAAE,GAAGA,GAAE,IAAIA,GAAE;MAAO,GAAGA,GAAE;IAAG;IAC5B;MAAE,GAAGA,GAAE,IAAIA,GAAE;MAAO,GAAGA,GAAE,IAAIA,GAAE;IAAQ;IACvC;MAAE,GAAGA,GAAE;MAAG,GAAGA,GAAE,IAAIA,GAAE;IAAQ;EAChC;AACJ;AClBD,IAAajB,UAAQ,CAACuB,SAAQ,gBAAgB,aAAa;AACvD,MAAI,mBAAmBA,OAAA,EACnBC,SAAWD,SAAQ,QAAQ;AAE/B,MAAI,OAAO,MAAMA,QAAO,MAAA,EACpB,OAAM,IAAI,MAAM,GAAG,aAAA,gBAA6B;AACpD,MAAIA,QAAO,UAAU,EACjB,OAAM,IAAI,MAAM,GAAG,aAAA,mCAAgD;AAC1E;AAOD,IAAa,kBAAkB,CAACA,SAAQ,gBAAgB,aAAa;AACjE,MAAI,CAAC,mBAAmBA,OAAA,EACpB,OAAM,IAAI,MAAM,uCAAuC;AAC3DvB,UAAMuB,SAAQ,aAAA;AACjB;AAID,IAAaxB,SAAQ,CAACc,OAAM;AACxB,MAAI,OAAO,MAAMA,GAAE,MAAA,EACf,QAAO;AACX,MAAI,mBAAmBA,EAAA,GAAI;AACvB,QAAI,OAAO,MAAMA,GAAE,CAAA,EACf,QAAO;AACX,QAAI,OAAO,MAAMA,GAAE,CAAA,EACf,QAAO;EACd;AACD,SAAO;AACV;AAcD,IAAaR,iBAAe,CAACP,OAAMA,GAAE,MAAM,UAAaA,GAAE,MAAM;AAChE,IAAa,WAAW,CAACA,OAAMA,GAAE,WAAW;AAC5C,IAAa,qBAAqB,CAACA,OAAM,SAASA,EAAA,KAAMO,eAAaP,EAAA;ACtCrE,IAAa2B,YAAU,CAACZ,IAAGC,OAAM;AAC7B,MAAID,GAAE,WAAWC,GAAE,OACf,QAAO;AACX,MAAI,mBAAmBD,EAAA,KAAM,mBAAmBC,EAAA,GAAI;AAChD,QAAID,GAAE,MAAMC,GAAE,EACV,QAAO;AACX,QAAID,GAAE,MAAMC,GAAE,EACV,QAAO;AACX,QAAID,GAAE,MAAMC,GAAE,EACV,QAAO;AACX,WAAO;EACV,WACQ,CAAC,mBAAmBD,EAAA,KAAM,CAAC,mBAAmBC,EAAA,GAAI;EAE1D,MAEG,QAAO;AACX,SAAO;AACV;AClCD,SAAgB,sBAAsB,IAAI,KAAK,KAAK,KAAK,KAAK,KAAK;AAC/D,MAAI,UAAU,EAAA,KAAO,UAAU,GAAA,EAC3B,QAAO,CAAC,IAAI,GAAI;AACpB,MAAI,QAAQ,EAAA,KAAO,QAAQ,GAAA,EACvB,QAAO,CAAC,IAAI,GAAI;AACpB,MAAI,UAAU,EAAA,GAAK;AACf,UAAMA,MAAI;MACN,GAAG;MACH,GAAG;MACH,GAAG;IACN;AACD,QAAI,CAAC,UAAUA,GAAAA,EACX,OAAM,IAAI,MAAM,8BAA8B;AAClD,WAAO,CAAC,IAAIA,GAAE;EACjB;AACD,MAAI,QAAQ,EAAA,GAAK;AACb,UAAMA,MAAI;MACN,GAAG;MACH,GAAG;IACN;AACD,QAAI,CAAC,QAAQA,GAAAA,EACT,OAAM,IAAI,MAAM,2BAA2B;AAC/C,WAAO,CAAC,IAAIA,GAAE;EACjB;AACD,MAAI,OAAO,QAAQ,eAAe,OAAO,QAAQ,aAAa;AAC1D,UAAMD,MAAI;MACN,GAAG;MACH,GAAG;MACH,GAAG;IACN;AACD,UAAMC,MAAI;MACN,GAAG;MACH,GAAG;MACH,GAAG;IACN;AACD,QAAI,CAAC,UAAUD,GAAAA,EACX,OAAM,IAAI,MAAM,gCAAgC;AACpD,QAAI,CAAC,UAAUC,GAAAA,EACX,OAAM,IAAI,MAAM,iCAAiC;AACrD,WAAO,CAACD,KAAGC,GAAE;EAChB;AACD,QAAMD,KAAI;IACN,GAAG;IACH,GAAG;EACN;AACD,QAAMC,KAAI;IACN,GAAG;IACH,GAAG;EACN;AACD,MAAI,CAAC,QAAQD,EAAA,EACT,OAAM,IAAI,MAAM,8BAA8B;AAClD,MAAI,CAAC,QAAQC,EAAA,EACT,OAAM,IAAI,MAAM,+BAA+B;AACnD,SAAO,CAACD,IAAGC,EAAE;AAChB;AASD,SAAgB,kBAAkBD,IAAGC,IAAGC,IAAG;AACvC,MAAIF,OAAM,OACN,QAAO;IAAE,GAAG;IAAG,GAAG;EAAG;AACzB,MAAI,MAAM,QAAQA,EAAA,GAAI;AAClB,QAAIA,GAAE,WAAW,EACb,QAAO,OAAO,OAAO;MAAE,GAAG;MAAG,GAAG;IAAG,CAAA;AACvC,QAAIA,GAAE,WAAW,EACb,QAAO,OAAO,OAAO;MAAE,GAAGA,GAAE,CAAA;MAAI,GAAG;IAAG,CAAA;AAC1C,QAAIA,GAAE,WAAW,EACb,QAAO,OAAO,OAAO;MAAE,GAAGA,GAAE,CAAA;MAAI,GAAGA,GAAE,CAAA;IAAI,CAAA;AAC7C,QAAIA,GAAE,WAAW,EACb,QAAO,OAAO,OAAO;MAAE,GAAGA,GAAE,CAAA;MAAI,GAAGA,GAAE,CAAA;MAAI,GAAGA,GAAE,CAAA;IAAI,CAAA;AACtD,UAAM,IAAI,MAAM,oDAAoDA,GAAE,MAAA,GAAS;EAClF;AACD,MAAI,QAAQA,EAAA,EACR,QAAOA;WAEF,OAAOA,OAAM,YAAY,OAAOC,OAAM,SAC3C,OAAM,IAAI,UAAU,gDAAgD,KAAK,UAAUD,EAAA,CAAE,OAAO,KAAK,UAAUC,EAAA,CAAE,EAAE;AAGnH,MAAI,OAAOC,OAAM,SACb,QAAO,OAAO,OAAO;IAAE,GAAGF;IAAG,GAAGC;IAAG,GAAGC;EAAG,CAAA;AAG7C,SAAO,OAAO,OAAO;IAAE,GAAGF;IAAG,GAAGC;EAAG,CAAA;AACtC;AC3ED,SAAgBY,KAAI,IAAI,KAAK,KAAK,KAAK,KAAK,KAAK;AAC7C,QAAM,CAAC,KAAK,GAAA,IAAO,sBAAsB,IAAI,KAAK,KAAK,KAAK,KAAK,GAAA;AACjE1B,UAAM,KAAK,GAAG;AACdA,UAAM,KAAK,GAAG;AACd,QAAMC,MAAK;IACP,GAAG,IAAI,IAAI,IAAI;IACf,GAAG,IAAI,IAAI,IAAI;EAClB;AACD,MAAI,UAAU,GAAA,KAAQ,UAAU,GAAA,EAC5B,CAAAA,IAAG,KAAK,IAAI,KAAK,MAAM,IAAI,KAAK;AAGpC,SAAO,OAAO,OAAOA,GAAA;AACxB;ACbD,SAAgB,SAAS,IAAI,KAAK,KAAK,KAAK,KAAK,KAAK;AAClD,QAAM,CAAC,KAAK,GAAA,IAAO,sBAAsB,IAAI,KAAK,KAAK,KAAK,KAAK,GAAA;AACjED,UAAM,KAAK,GAAG;AACdA,UAAM,KAAK,GAAG;AACd,QAAMC,MAAK;IACP,GAAG,IAAI,IAAI,IAAI;IACf,GAAG,IAAI,IAAI,IAAI;EAClB;AACD,MAAI,UAAU,GAAA,KAAQ,UAAU,GAAA,EAC5B,CAAAA,IAAG,KAAK,IAAI,KAAK,MAAM,IAAI,KAAK;AAGpC,SAAO,OAAO,OAAOA,GAAA;AACxB;ACbD,IAAa,mBAAmB,CAACsB,SAAQI,UAAS;AAC9C,QAAM,KAAK;IACP,GAAGA,MAAK,EAAE,IAAIA,MAAK,EAAE;IACrB,GAAGA,MAAK,EAAE,IAAIA,MAAK,EAAE;EACxB;AACD,QAAMC,MAAK;IACP,GAAGD,MAAK,EAAE,IAAIJ,QAAO;IACrB,GAAGI,MAAK,EAAE,IAAIJ,QAAO;EACxB;AACD,QAAMT,MAAK,GAAG,IAAIc,IAAG,IAAI,GAAG,IAAIA,IAAG,KAAK;AACxC,QAAMb,KAAI,KAAK,GAAG,IAAI,GAAG,IAAI,GAAG,IAAI,GAAG;AACvC,QAAMZ,KAAI,KAAK,KAAKW,KAAIA,KAAI,IAAIC,MAAKa,IAAG,IAAIA,IAAG,IAAIA,IAAG,IAAIA,IAAG,IAAIL,QAAO,SAASA,QAAO,OAAA;AACxF,MAAI,OAAO,MAAMpB,EAAA,EACb,QAAO,CAAE;AACb,QAAM,MAAMW,KAAIX,MAAKY;AACrB,QAAMc,OAAMf,KAAIX,MAAKY;AACrB,QAAM,cAAc,CAAE;AACtB,MAAI,MAAM,KAAK,MAAM,EACjB,aAAY,KAAK;IACb,GAAGY,MAAK,EAAE,IAAI,GAAG,IAAI;IACrB,GAAGA,MAAK,EAAE,IAAI,GAAG,IAAI;EACxB,CAAA;AAEL,MAAIE,OAAM,KAAKA,OAAM,EACjB,aAAY,KAAK;IACb,GAAGF,MAAK,EAAE,IAAI,GAAG,IAAIE;IACrB,GAAGF,MAAK,EAAE,IAAI,GAAG,IAAIE;EACxB,CAAA;AAEL,SAAO;AACV;AAWD,IAAa,gBAAgB,CAAChB,IAAGC,OAAM;AACnC,QAAM,SAASgB,SAAehB,IAAGD,EAAA;AACjC,QAAM,UAAU,KAAK,MAAO,OAAO,GAAK,OAAO,CAAA;AAE/C,MAAI,UAAUA,GAAE,SAASC,GAAE,OACvB,QAAO,CAAE;AAEb,MAAI,UAAU,KAAK,IAAID,GAAE,SAASC,GAAE,MAAA,EAChC,QAAO,CAAE;AAEb,MAAIW,UAAQZ,IAAGC,EAAA,EACX,QAAO,CAAE;AACb,QAAM,aAAcD,GAAE,SAASA,GAAE,SAAWC,GAAE,SAASA,GAAE,SAAW,UAAU,YAAa,IAAI;AAC/F,QAAMiB,aAAW;IACb,GAAGlB,GAAE,IAAK,OAAO,IAAI,YAAY;IACjC,GAAGA,GAAE,IAAK,OAAO,IAAI,YAAY;EACpC;AACD,QAAM,wBAAwB,KAAK,KAAMA,GAAE,SAASA,GAAE,SAAW,YAAY,SAAA;AAC7E,QAAMmB,gBAAe;IACjB,GAAG,CAAC,OAAO,KAAK,wBAAwB;IACxC,GAAG,OAAO,KAAK,wBAAwB;EAC1C;AACD,SAAO,CACHC,KAAUF,YAAUC,aAAA,GACpBF,SAAeC,YAAUC,aAAA,CAC5B;AACJ;ACjFD,IAAa,aAAa,CAACnB,IAAGC,OAAM;AAEhC,QAAM,SAASD,GAAE,IAAI,KAAK,IAAIC,GAAE,GAAG,KAAK,IAAID,GAAE,GAAGC,GAAE,IAAIA,GAAE,KAAA,CAAM;AAC/D,QAAM,SAASD,GAAE,IAAI,KAAK,IAAIC,GAAE,GAAG,KAAK,IAAID,GAAE,GAAGC,GAAE,IAAIA,GAAE,MAAA,CAAO;AAChE,SAAQ,SAAS,SAAS,SAAS,SAAWD,GAAE,SAASA,GAAE;AAC9D;AACD,IAAa,eAAe,CAACA,IAAGC,OAAMoB,cAAoBrB,IAAGC,EAAA,EAAG,WAAW;ACU3E,SAAgB,gBAAgBV,OAAMS,IAAGC,IAAG;AACxCd,UAAMI,OAAM,MAAM;AAClB,MAAIO,KAAI;AACR,MAAIC,KAAI;AACR,MAAI,OAAOC,OAAM,UAAU;AACvB,QAAIC,OAAM,OACN,OAAM,IAAI,MAAM,2BAA2B;AAC/C,IAAAH,KAAIE;AACJ,IAAAD,KAAIE;EACP,OACI;AACD,IAAAH,KAAIE,GAAE;AACN,IAAAD,KAAIC,GAAE;EACT;AACD,MAAIR,eAAaD,KAAA,GAAO;AACpB,QAAIO,KAAIP,MAAK,IAAIA,MAAK,SAASO,KAAIP,MAAK,EACpC,QAAO;AACX,QAAIQ,KAAIR,MAAK,IAAIA,MAAK,UAAUQ,KAAIR,MAAK,EACrC,QAAO;EACd,OACI;AAED,QAAIO,KAAIP,MAAK,SAASO,KAAI,EACtB,QAAO;AACX,QAAIC,KAAIR,MAAK,UAAUQ,KAAI,EACvB,QAAO;EACd;AACD,SAAO;AACV;AAMD,IAAauB,mBAAiB,CAACtB,IAAGC,OAAM;AACpC,MAAI,CAAC,iBAAiBD,EAAA,EAClB,OAAM,IAAI,MAAM,sCAAsC;AAE1D,MAAI,mBAAmBC,EAAA,EACnB,QAAA,WAA6BA,IAAGD,EAAA;WAE3B,QAAQC,EAAA,EACb,QAAO,gBAAgBD,IAAGC,EAAA;AAE9B,QAAM,IAAI,MAAM,wBAAwB,KAAK,UAAUA,EAAA,CAAE,EAAE;AAC9D;ACpCD,SAAgBsB,UAASvB,IAAG,MAAMD,IAAGyB,IAAG;AACpC,QAAMpC,MAAK,kBAAkB,MAAMW,IAAGyB,EAAA;AACtCrC,UAAMC,KAAI,GAAG;AACbD,UAAMa,IAAG,GAAG;AACZ,SAAO,UAAUZ,GAAA,KAAO,UAAUY,EAAA,IAAK,KAAK,MAAMZ,IAAG,IAAIY,GAAE,GAAGZ,IAAG,IAAIY,GAAE,GAAGZ,IAAG,IAAIY,GAAE,CAAA,IAAK,KAAK,MAAMZ,IAAG,IAAIY,GAAE,GAAGZ,IAAG,IAAIY,GAAE,CAAA;AAC3H;AASD,SAAgB,WAAWA,IAAG,MAAMD,IAAG;AACnC,QAAMX,MAAK,kBAAkB,MAAMW,EAAA;AACnCZ,UAAMC,KAAI,GAAG;AACbD,UAAMa,IAAG,GAAG;AACZ,SAAO,KAAK,MAAMZ,IAAG,IAAIY,GAAE,GAAGZ,IAAG,IAAIY,GAAE,CAAA;AAC1C;ACzBD,IAAa,uBAAuB,CAACT,OAAMH,QAAO;AAC9CM,oBAAgBH,OAAM,MAAM;AAC5BE,UAAYL,KAAI,IAAI;AACpB,MAAI,gBAAgBG,OAAMH,GAAA,EACtB,QAAO;AACX,QAAM,KAAK,KAAK,IAAIG,MAAK,IAAIH,IAAG,GAAG,GAAGA,IAAG,IAAIG,MAAK,IAAIA,MAAK,KAAA;AAC3D,QAAM,KAAK,KAAK,IAAIA,MAAK,IAAIH,IAAG,GAAG,GAAGA,IAAG,IAAIG,MAAK,IAAIA,MAAK,MAAA;AAC3D,SAAO,KAAK,MAAM,IAAI,EAAA;AACzB;AAYD,IAAa,qBAAqB,CAACA,OAAMH,QAAOqC,UAAetB,SAAOZ,KAAA,GAAOH,GAAA;ACvC7E,IAAM,WAAW,CAACY,IAAGC,OAAMD,KAAIC;AAQ/B,SAAgByB,SAAO1B,IAAGC,IAAGC,IAAG;AAE5B,SAAO,WAAW,UAAUF,IAAGC,IAAGC,EAAA;AACrC;AAYD,SAAgB,aAAaX,OAAM,QAAQ;AACvC,SAAO,YAAY,UAAUA,OAAM,MAAA;AACtC;AACD,SAAgB,UAAUA,OAAM,QAAQ;AACpC,SAAO,SAAS,UAAUA,OAAM,MAAA;AACnC;AChBD,IAAaoC,eAAa,CAAC3B,IAAGC,OAAM;AAChCU,UAAWX,IAAG,GAAG;AACjBW,UAAWV,IAAG,GAAG;AACjB,EAAAD,KAAI,OAAO,OAAO,EAAE,GAAGA,GAAG,CAAA;AAC1B,EAAAC,KAAI,OAAO,OAAO,EAAE,GAAGA,GAAG,CAAA;AAC1B,SAAO,OAAO,OAAO;IACd,GAAAD;IACA,GAAAC;EACN,CAAA;AACJ;ACTD,IAAa,oBAAoB,IAAI,WAAW;AAC5C,QAAM,QAAQ,CAAE;AAChB,MAAI,QAAQ,OAAO,CAAA;AACnB,WAAS,QAAQ,GAAG,QAAQ,OAAO,QAAQ,SAAS;AAChD,UAAM,KAAK0B,aAAW,OAAO,OAAO,KAAA,CAAA,CAAO;AAC3C,YAAQ,OAAO,KAAA;EAClB;AACD,SAAO;AACV;ACHD,IAAaC,UAAQ,CAACrC,OAAM,WAAW;AACnC,QAAMW,KAAIO,UAAQlB,OAAM,MAAA;AAExB,SAAOsC,kBAAuB,GAAG3B,IAAGA,GAAE,CAAA,CAAA;AACzC;AAgBD,IAAa,WAAW,CAACX,OAAM,SAAS;AACpCJ,UAAMI,KAAA;AACN,UAAQ,MAAR;IACI,KAAK;AACD,aAAO,QAAQA,KAAA,IAAQA,MAAK,IAAI;IAEpC,KAAK;AACD,aAAO,QAAQA,KAAA,IAAQA,MAAK,IAAI;IAEpC,KAAK;AACD,aAAO,QAAQA,KAAA,IAAQA,MAAK,IAAI;IAEpC,KAAK;AACD,aAAO,QAAQA,KAAA,IAAQA,MAAK,IAAIA,MAAK,QAAQA,MAAK;EAEzD;AACJ;AAiBD,IAAa,WAAW,CAACA,OAAM,SAAS;AACpCJ,UAAMI,KAAA;AACN,UAAQ,MAAR;IACI,KAAK;AACD,aAAQ,QAAQA,KAAA,IAAQA,MAAK,IAAI;IAErC,KAAK;AACD,aAAO,QAAQA,KAAA,IAAQA,MAAK,IAAIA,MAAK,SAASA,MAAK;IAEvD,KAAK;AACD,aAAO,QAAQA,KAAA,IAAQA,MAAK,IAAI;IAEpC,KAAK;AACD,aAAO,QAAQA,KAAA,IAAQA,MAAK,IAAI;EAEvC;AACJ;ACvFD,IAAauC,UAAQ,OAAO,OAAO;EAAE,OAAO;EAAG,QAAQ;AAAG,CAAA;AAC1D,IAAa,kBAAkB,OAAO,OAAO;EACzC,GAAG;EACH,GAAG;EACH,OAAO;EACP,QAAQ;AACX,CAAA;ACCD,IAAa,YAAY,CAACvC,UAAS,WAAW;AAC1C,QAAMO,KAAI,OAAO,IAAI,CAAAb,OAAKA,GAAE,CAAA;AAC5B,QAAMc,KAAI,OAAO,IAAI,CAAAd,OAAKA,GAAE,CAAA;AAC5B,MAAI,OAAO,KAAK,IAAI,GAAGa,IAAGP,MAAK,CAAA;AAC/B,MAAI,OAAO,KAAK,IAAI,GAAGQ,IAAGR,MAAK,CAAA;AAC/B,MAAI,OAAO,KAAK,IAAI,GAAGO,IAAGP,MAAK,IAAIA,MAAK,KAAA;AACxC,MAAI,OAAO,KAAK,IAAI,GAAGQ,IAAGR,MAAK,IAAIA,MAAK,MAAA;AACxC,MAAI,QAAQ,KAAK,IAAIA,MAAK,OAAO,OAAO,IAAA;AACxC,MAAI,QAAQ,KAAK,IAAIA,MAAK,QAAQ,OAAO,IAAA;AACzC,SAAO,OAAO,OAAO;IACjB,GAAGA;IACH,GAAG;IACH,GAAG;IACH,OAAO;IACP,QAAQ;EACX,CAAA;AACJ;ACRD,IAAawC,eAAa,CAAC,QAAQ,OAAOlC,aAAW;AACjDJ,UAAY,QAAQ,QAAQ;AAC5B,WAAS,OAAO,OAAO;AACvB,WAASI,UAAQ,QAAQ;AACzB,QAAM,QAAQ,QAAQ;AACtB,QAAM,QAAQA,WAAS;AACvB,SAAO;IACH,GAAG,OAAO,IAAI;IACd,GAAG,OAAO,IAAI;IACP;IACP,QAAQA;EACX;AACJ;AClBD,IAAa,cAAc,CAACmC,SAAQ;EAChC,OAAOA,IAAG;EACV,QAAQA,IAAG;AACd;ACaD,SAAgBC,cAAY,UAAU,WAAW,OAAOpC,UAAQ;AAC5D,MAAI,UAAU,UAAaA,aAAW,QAAW;AAC7C,QAAI,OAAO,aAAa,SACpB,OAAM,IAAI,MAAM,wBAAwB;AAC5C,QAAI,OAAO,cAAc,SACrB,OAAM,IAAI,UAAU,yBAAyB;AAEjD,WAAO,OAAO,OAAO;MAAE,OAAO;MAAU,QAAQ;IAAW,CAAA;EAC9D;AACD,MAAI,OAAO,aAAa,SACpB,OAAM,IAAI,MAAM,oBAAoB;AACxC,MAAI,OAAO,cAAc,SACrB,OAAM,IAAI,MAAM,oBAAoB;AACxC,MAAI,OAAO,UAAU,SACjB,OAAM,IAAI,MAAM,wBAAwB;AAC5C,MAAI,OAAOA,aAAW,SAClB,OAAM,IAAI,MAAM,yBAAyB;AAC7C,SAAO,OAAO,OAAO;IAAE,GAAG;IAAU,GAAG;IAAW;IAAO,QAAA;EAAQ,CAAA;AACpE;AC7BD,IAAa,cAAc,CAAC,QAAQ,OAAOA,aAAW;AAClD,WAAS,OAAO,OAAO;AACvB,WAASA,UAAQ,QAAQ;AACzBJ,UAAY,QAAQ,QAAQ;AAC5B,SAAO;IAAE,GAAG,OAAO;IAAG,GAAG,OAAO;IAAU;IAAO,QAAQI;EAAQ;AACpE;ACHD,SAAgB,2BAA2BG,IAAGC,IAAGC,IAAGZ,IAAG;AACnD,MAAI,OAAOU,OAAM,SACb,KAAI,OAAOC,OAAM,SACb,KAAI,OAAOC,OAAM,YAAY,OAAOZ,OAAM,SACtC,QAAO;IAAE,GAAGU;IAAG,GAAGC;IAAG,OAAOC;IAAG,QAAQZ;EAAG;WAErC,OAAOY,EAAA,EACZ,QAAO;IAAE,GAAGF;IAAG,GAAGC;IAAG,OAAOC,GAAE;IAAO,QAAQA,GAAE;EAAQ;MAGvD,OAAM,IAAI,UAAU,gFAAgF;MAIxG,OAAM,IAAI,UAAU,wEAAwE;WAG3F,iBAAiBF,EAAA,EACtB,QAAOA;WAEF,OAAOA,EAAA,EACZ,KAAI,OAAOC,OAAM,YAAY,OAAOC,OAAM,SACtC,QAAO;IAAE,OAAOF,GAAE;IAAO,QAAQA,GAAE;IAAQ,GAAGC;IAAG,GAAGC;EAAG;WAElD,QAAQD,EAAA,EACb,QAAO;IAAE,OAAOD,GAAE;IAAO,QAAQA,GAAE;IAAQ,GAAGC,GAAE;IAAG,GAAGA,GAAE;EAAG;MAG3D,OAAM,IAAI,UAAU,gEAAgE;WAGnF,QAAQD,EAAA,EACb,KAAI,OAAOC,OAAM,YAAY,OAAOC,OAAM,SACtC,QAAO;IAAE,GAAGF,GAAE;IAAG,GAAGA,GAAE;IAAG,OAAOC;IAAG,QAAQC;EAAG;WAEzC,OAAOD,EAAA,EACZ,QAAO;IAAE,GAAGD,GAAE;IAAG,GAAGA,GAAE;IAAG,OAAOC,GAAE;IAAO,QAAQA,GAAE;EAAQ;MAG3D,OAAM,IAAI,UAAU,kFAAkF;AAG9G,QAAM,IAAI,UAAU,+DAA+D;AACtF;AC/CD,IAAaW,WAAU,IAAI3B,OAAM;AAC7B,MAAIA,OAAM,OACN,OAAM,IAAI,MAAM,4BAA4B;AAChD,MAAIA,GAAE,SAAS,EACX,QAAO;AACX,WAAS,QAAQ,GAAG,QAAQA,GAAE,QAAQ,SAAS;AAC3C,QAAIA,GAAE,KAAA,EAAO,MAAMA,GAAE,CAAA,EAAG,EACpB,QAAO;AACX,QAAIA,GAAE,KAAA,EAAO,MAAMA,GAAE,CAAA,EAAG,EACpB,QAAO;EACd;AACD,SAAO;AACV;ACLD,IAAa,cAAc,CAACe,IAAGC,OAAM;AACjC,MAAID,OAAM,OACN,OAAM,IAAI,MAAM,aAAa;AACjC,MAAIC,OAAM,OACN,OAAM,IAAI,MAAM,aAAa;AACjC,SAAOD,GAAE,UAAUC,GAAE,SAASD,GAAE,WAAWC,GAAE;AAChD;AAmBD,IAAaW,YAAU,CAACZ,IAAGC,OAAM;AAC7B,MAAIT,eAAaQ,EAAA,KAAMR,eAAaS,EAAA,GAAI;AACpC,QAAI,CAACiC,SAAclC,IAAGC,EAAA,EAClB,QAAO;AACX,WAAOD,GAAE,UAAUC,GAAE,SAASD,GAAE,WAAWC,GAAE;EAChD,WACQ,CAACT,eAAaQ,EAAA,KAAM,CAACR,eAAaS,EAAA,EACvC,QAAOD,GAAE,UAAUC,GAAE,SAASD,GAAE,WAAWC,GAAE;MAI7C,QAAO;AAEd;AChDD,IAAa,SAAS,CAAChB,OAAM;AACzB,MAAIA,OAAM,OACN,QAAO;AACX,MAAIA,GAAE,MAAM,OACR,QAAO;AACX,MAAIA,GAAE,MAAM,OACR,QAAO;AACX,MAAI,CAAC,QAAQA,GAAE,CAAA,EACX,QAAO;AACX,MAAI,CAAC,QAAQA,GAAE,CAAA,EACX,QAAO;AACX,SAAO;AACV;AAOD,IAAa,aAAa,CAACA,OAAM;AAC7B,MAAI,CAAC,MAAM,QAAQA,EAAA,EACf,QAAO;AACX,QAAM,QAAQ,CAACA,GAAE,KAAK,CAAAkD,OAAK,CAAC,OAAOA,EAAA,CAAE;AACrC,SAAO;AACV;AAUD,IAAahD,UAAQ,CAAC2B,OAAM,OAAO,WAAW;AAC1C,MAAIA,UAAS,OACT,OAAM,IAAI,MAAM,GAAG,IAAA,YAAgB;AACvC,MAAIA,MAAK,MAAM,OACX,OAAM,IAAI,MAAM,GAAG,IAAA,mDAAuD,KAAK,UAAUA,KAAA,CAAK,EAAE;AACpG,MAAIA,MAAK,MAAM,OACX,OAAM,IAAI,MAAM,GAAG,IAAA,kDAAsD,KAAK,UAAUA,KAAA,CAAK,EAAE;AACtG;ACvCD,IAAasB,sBAAoB,CAAC,SAASnC,OAAM;AAC7C,MAAID;AACJ,MAAI,OAAO,OAAA,GAAU;AACjB,IAAAC,KAAI,QAAQ;AACZ,IAAAD,KAAI,QAAQ;EACf,OACI;AACD,IAAAA,KAAI;AACJ,QAAIC,OAAM,OACN,OAAM,IAAI,MAAM,wEAAwE,KAAK,UAAUD,EAAA,CAAE,OAAO,KAAK,UAAUC,EAAA,CAAE,EAAE;EAC1I;AACDU,UAAWX,IAAG,GAAG;AACjBW,UAAWX,IAAG,GAAG;AACjB,SAAO,CAACA,IAAGC,EAAE;AAChB;AChBD,SAAgB,OAAO,SAAS,QAAQ;AACpC,MAAI,WAAW,OAAA,GAAU;AACrB,UAAMY,QAAM,QAAQ,OAAO,CAAC,aAAasB,OAAM,OAAOA,EAAA,IAAK,aAAa,CAAA;AACxE,WAAOtB;EACV;AACD,MAAI,YAAY,OACZ,OAAM,IAAI,UAAU,kCAAkC;AAC1D,QAAM,CAACb,IAAGC,EAAA,IAAKmC,oBAAkB,SAAS,MAAA;AAC1C,QAAMtC,KAAIG,GAAE,IAAID,GAAE;AAClB,QAAMD,KAAIE,GAAE,IAAID,GAAE;AAClB,MAAIA,GAAE,MAAM,UAAaC,GAAE,MAAM,QAAW;AACxC,UAAMuB,KAAIvB,GAAE,IAAID,GAAE;AAClB,WAAO,KAAK,MAAMF,IAAGC,IAAGyB,EAAA;EAC3B,MAEG,QAAO,KAAK,MAAM1B,IAAGC,EAAA;AAE5B;ACZD,IAAasC,YAAU,CAAC9C,UAAS;AAC7BG,oBAAgBH,OAAM,MAAM;AAC5B,SAAOqC,QAAMrC,KAAA,EAAM,IAAI,CAAC+C,OAAMC,OAAYD,EAAA,CAAE;AAC/C;ACLD,IAAa,iBAAiB,CAAC,SAAS,UAAU,aAAa,eAAe;AAC1E,MAAI,QAAQ,IAAI,YAAY,EACxB,OAAM,IAAI,MAAM,sCAAsC;AAE1D,MAAI,QAAQ,IAAI,WAAW,EACvB,OAAM,IAAI,MAAM,qCAAqC;AAEzD,QAAM,KAAK,SAAS,IAAI,QAAQ;AAChC,QAAME,MAAK,YAAY,IAAI,WAAW;AACtC,QAAM,KAAK,KAAK,IAAI,WAAW,IAAI,QAAQ,CAAA;AAC3C,QAAMC,MAAK,KAAK,IAAI,YAAY,IAAI,SAAS,CAAA;AAC7C,SAAO;IACH,GAAG,KAAK,IAAI,QAAQ,GAAG,WAAW,CAAA;IAClC,GAAG,KAAK,IAAI,SAAS,GAAG,QAAQ,CAAA;IAChC,OAAO,KAAK,IAAI,IAAID,GAAA;IACpB,QAAQ,KAAK,IAAI,IAAIC,GAAA;EACxB;AACJ;AC5BD,IAAM,aAAa,CAACzC,IAAGC,OAAMD,KAAIC;AAQjC,SAAgByC,WAAS1C,IAAGC,IAAGC,IAAG;AAE9B,SAAO,WAAW,YAAYF,IAAGC,IAAGC,EAAA;AACvC;AAcD,SAAgByC,iBAAepD,OAAM,QAAQ;AACzC,SAAO,YAAY,YAAYA,OAAM,MAAA;AAYxC;AAaD,SAAgB,YAAYA,OAAM,QAAQ;AACtC,SAAO,SAAS,YAAYA,OAAM,MAAA;AAYrC;ACzDD,IAAa,kBAAkB,CAACA,OAAMN,OAAM;AACxC,MAAI,EAAE,GAAAa,IAAG,GAAAC,GAAA,IAAMd;AACf,MAAIa,KAAIP,MAAK,EACT,CAAAO,KAAIP,MAAK;WACJO,KAAIP,MAAK,IAAIA,MAAK,MACvB,CAAAO,KAAIP,MAAK,IAAIA,MAAK;AACtB,MAAIQ,KAAIR,MAAK,EACT,CAAAQ,KAAIR,MAAK;WACJQ,KAAIR,MAAK,IAAIA,MAAK,OACvB,CAAAQ,KAAIR,MAAK,IAAIA,MAAK;AACtB,SAAO,OAAO,OAAO;IAAE,GAAGN;IAAG,GAAAa;IAAG,GAAAC;EAAG,CAAA;AACtC;ACnBD,IAAa,cAAc,OAAO,OAAO;EACrC,OAAO;EACP,QAAQ;AACX,CAAA;AACD,IAAa,wBAAwB,OAAO,OAAO;EAC/C,GAAG;EACH,GAAG;EACH,OAAO;EACP,QAAQ;AACX,CAAA;ACCD,IAAa6C,cAAY,CAACrD,UAAS;AAC/BJ,UAAMI,KAAA;AACN,SAAOA,MAAK,SAASA,MAAK,SAASA,MAAK,QAAQA,MAAK;AACxD;ACDD,IAAa,4BAA4B,CAACA,UAAS;AAC/C,QAAM,UAAU,KAAK,IAAIA,MAAK,OAAOA,MAAK,MAAA;AAC1C,SAAO,CAACsD,WAAU;AACd,QAAI,OAAOA,WAAU,SACjB,QAAOA,SAAQ;aAEV,UAAUA,MAAA,EACf,QAAO,OAAO,OAAO;MACjB,GAAGA;MACH,GAAGA,OAAM,IAAI;MACb,GAAGA,OAAM,IAAI;MACb,GAAGA,OAAM,IAAI;IAChB,CAAA;aAEI,QAAQA,MAAA,EACb,QAAO,OAAO,OAAO;MACjB,GAAGA;MACH,GAAGA,OAAM,IAAI;MACb,GAAGA,OAAM,IAAI;IAChB,CAAA;QAGD,OAAM,IAAI,MAAM,2CAA2C;EAClE;AACJ;AClBD,IAAaC,WAAS,CAAC,UAAU;AAC7B,YAAU,KAAK;AACf,SAAO,OAAO,OAAO;IACjB,GAAG,MAAA;IACH,GAAG,MAAA;IACH,OAAO,MAAA;IACP,QAAQ,MAAA;EACX,CAAA;AACJ;AAaD,IAAaC,gBAAc,CAAC,QAAQ,UAAU,CAAE,MAAK;AAGjD,QAAM,OAAO,QAAQ,gBAAgB,KAAK;AAC1C,QAAM,SAAS,QAAQ,UAAU;IAAE,GAAG;IAAG,GAAG;EAAG;AAC/C,QAAMjD,KAAI,KAAA,KAAU,OAAO,QAAQ,OAAO,IAAI,OAAO;AACrD,QAAMC,KAAI,KAAA,KAAU,OAAO,SAAS,OAAO,IAAI,OAAO;AACtD,QAAM,MAAM;IAAE,GAAGD,KAAI,OAAO;IAAG,GAAGC,KAAI,OAAO;EAAG;AAChD,SAAOP,eAAa,MAAA,IAAU4B,KAAU,KAAK,MAAA,IAAU,OAAO,OAAO,GAAA;AACxE;AC9CD,IAAM,aAAa,CAACpB,IAAGC,OAAMD,KAAIC;AAiBjC,SAAgB+C,WAAShD,IAAGC,IAAGC,IAAG;AAE9B,SAAO,WAAW,YAAYF,IAAGC,IAAGC,EAAA;AACvC;AACD,SAAgB,aAAaF,IAAGC,IAAGC,IAAG;AAClC,QAAMG,KAAI,OAAOJ,OAAM,WAAWA,KAAIA,GAAE;AACxC,QAAMK,KAAI,OAAOL,OAAM,WAAWC,KAAID,GAAE;AACxC,MAAIK,OAAM,OACN,OAAM,IAAI,MAAM,oCAAoC;AACxD,QAAMF,KAAI;IACN,GAAGJ;IACH,OAAOA,GAAE,QAAQK;IACjB,QAAQL,GAAE,SAASM;EACtB;AACD,SAAOF;AACV;AAeD,SAAgB,eAAeJ,IAAGC,IAAG;AACjC,MAAIH,KAAI;AACR,MAAIC,KAAI;AACR,MAAIP,eAAaQ,EAAA,GAAI;AACjB,IAAAF,KAAIE,GAAE;AACN,IAAAD,KAAIC,GAAE;EACT;AACD,MAAI,KAAK;AACT,MAAI,KAAK;AACT,MAAIR,eAAaS,EAAA,GAAI;AACjB,SAAKA,GAAE;AACP,SAAKA,GAAE;EACV;AACD,SAAO,OAAO,OAAO;IACjB,GAAGD;IACH,GAAGF,KAAI;IACP,GAAGC,KAAI;IACP,OAAOC,GAAE,QAAQC,GAAE;IACnB,QAAQD,GAAE,SAASC,GAAE;EACxB,CAAA;AACJ;ACnED,IAAM,QAAQ,CAACD,IAAGC,OAAMD,KAAIC;AAiB5B,SAAgBY,MAAIb,IAAGC,IAAGC,IAAG;AAEzB,SAAO,WAAW,OAAOF,IAAGC,IAAGC,EAAA;AAClC;AAYD,SAAgB,UAAUF,IAAGC,IAAG;AAC5B,MAAIH,KAAI;AACR,MAAIC,KAAI;AACR,MAAIP,eAAaQ,EAAA,GAAI;AACjB,IAAAF,KAAIE,GAAE;AACN,IAAAD,KAAIC,GAAE;EACT;AACD,MAAI,KAAK;AACT,MAAI,KAAK;AACT,MAAIR,eAAaS,EAAA,GAAI;AACjB,SAAKA,GAAE;AACP,SAAKA,GAAE;EACV;AACD,SAAO,OAAO,OAAO;IACjB,GAAGD;IACH,GAAGF,KAAI;IACP,GAAGC,KAAI;IACP,OAAOC,GAAE,QAAQC,GAAE;IACnB,QAAQD,GAAE,SAASC,GAAE;EACxB,CAAA;AACJ;ACzCD,SAAgBgD,WAAQ1D,OAAM;AAC1B,MAAIC,eAAaD,KAAA,EACb,QAAO;IAACA,MAAK;IAAGA,MAAK;IAAGA,MAAK;IAAOA,MAAK;EAAO;WAE3C,OAAOA,KAAA,EACZ,QAAO,CAACA,MAAK,OAAOA,MAAK,MAAO;MAGhC,OAAM,IAAI,MAAM,yCAAyC,KAAK,UAAUA,KAAA,CAAK,EAAE;AAEtF;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AEZD,SAAgB2D,KAAI9D,KAAI;AACpB,MAAI,UAAUA,GAAA,EACV,QAAO,OAAO,OAAO;IACjB,GAAGA;IACH,GAAG,KAAK,IAAIA,IAAG,CAAA;IACf,GAAG,KAAK,IAAIA,IAAG,CAAA;IACf,GAAG,KAAK,IAAIA,IAAG,CAAA;EAClB,CAAA;WAEI,QAAQA,GAAA,EACb,QAAO,OAAO,OAAO;IACjB,GAAGA;IACH,GAAG,KAAK,IAAIA,IAAG,CAAA;IACf,GAAG,KAAK,IAAIA,IAAG,CAAA;EAClB,CAAA;MAGD,OAAM,IAAI,UAAU,2BAA2B;AACtD;AC7BD,IAAa+D,QAAO,KAAK,KAAK;ACmB9B,IAAa,cAAc,CAACnD,IAAGC,IAAGC,OAAM;AACpCf,UAAMa,IAAG,GAAG;AACZ,MAAIC,OAAM,OACN,QAAO,KAAK,MAAMD,GAAE,GAAGA,GAAE,CAAA;AAE7Bb,UAAMc,IAAG,GAAG;AACZ,MAAIC,OAAM,OACN,QAAO,KAAK,MAAMD,GAAE,IAAID,GAAE,GAAGC,GAAE,IAAID,GAAE,CAAA;AAEzCb,UAAMe,IAAG,GAAG;AACZ,SAAO,KAAK,MAAMD,GAAE,IAAID,GAAE,GAAGC,GAAE,IAAID,GAAE,CAAA,IAAK,KAAK,MAAME,GAAE,IAAIF,GAAE,GAAGE,GAAE,IAAIF,GAAE,CAAA;AAC3E;AAiBD,IAAa,oBAAoB,CAACA,IAAGC,IAAGC,OAAM;AAC1C,QAAM,QAAQ,YAAYF,IAAGC,IAAGC,EAAA;AAChC,MAAI,QAAQ,EACR,QAAO,QAAQiD;AACnB,SAAO;AACV;AAUD,IAAa,wBAAwB,CAACnD,IAAGC,IAAGC,OAAM;AAC9C,QAAM,KAAK,KAAK,KAAK,KAAK,IAAID,GAAE,IAAID,GAAE,GAAG,CAAA,IAAK,KAAK,IAAIC,GAAE,IAAID,GAAE,GAAG,CAAA,CAAE;AACpE,QAAM,KAAK,KAAK,KAAK,KAAK,IAAIC,GAAE,IAAIC,GAAE,GAAG,CAAA,IAAK,KAAK,IAAID,GAAE,IAAIC,GAAE,GAAG,CAAA,CAAE;AACpE,QAAMkD,MAAK,KAAK,KAAK,KAAK,IAAIlD,GAAE,IAAIF,GAAE,GAAG,CAAA,IAAK,KAAK,IAAIE,GAAE,IAAIF,GAAE,GAAG,CAAA,CAAE;AACpE,SAAO,KAAK,MAAM,KAAK,KAAK,KAAK,KAAKoD,MAAKA,QAAO,IAAI,KAAK,GAAA;AAC9D;AC7CD,SAAgBC,QAAMjE,KAAIkE,KAAI;AAC1BnE,UAAMC,KAAI,IAAI;AACd,MAAI,UAAUA,GAAA,EACV,QAAO,OAAO,OAAO;IACjB,GAAGA;IACH,GAAGkE,IAAGlE,IAAG,GAAG,GAAG;IACf,GAAGkE,IAAGlE,IAAG,GAAG,GAAG;IACf,GAAGkE,IAAGlE,IAAG,GAAG,GAAG;EAClB,CAAA;AAEL,SAAO,OAAO,OAAO;IACjB,GAAGA;IACH,GAAGkE,IAAGlE,IAAG,GAAG,GAAG;IACf,GAAGkE,IAAGlE,IAAG,GAAG,GAAG;EAClB,CAAA;AACJ;ACnCD,SAAgB,SAAS,MAAM,OAAO,CAAE,GAAE;AACtC,MAAIU;AACJ,MAAIC;AACJ,MAAIyB;AACJ,UAAQ,MAAR;IACI,KAAK,wBACD;AACI,YAAM,UAAU,KAAK,WAAW;AAChC,MAAA1B,KAAIyD,mBAAI,OAAA;AACR,MAAAxD,KAAIwD,mBAAI,OAAA;AACR,MAAA/B,KAAI+B,mBAAI,OAAA;AACR;IACH;IACL;AACI,YAAM,IAAI,MAAM,2BAA2B,IAAA,qCAAyC;EAC3F;AACD,SAAO,CAAChD,YAAU;AACd,UAAM,KAAKT,GAAES,QAAM,CAAA;AACnB,UAAM,KAAKR,GAAEQ,QAAM,CAAA;AACnB,QAAI,UAAUA,OAAAA,GAAQ;AAClB,YAAM,KAAKiB,GAAEjB,QAAM,CAAA;AACnB,aAAO,OAAO,OAAO;QACjB,GAAG;QACH,GAAG;QACH,GAAG;MACN,CAAA;IACJ,MAEG,QAAO,OAAO,OAAO;MACjB,GAAG;MACH,GAAG;IACN,CAAA;EAER;AACJ;AChBD,SAAgB,YAAY,aAAa,QAAQ;AAC7C,MAAI,OAAO,WAAW,EAClB,OAAM,IAAI,MAAM,oBAAoB;AACxC,MAAIiD,OAAM,OAAO,CAAA;AACjB,aAAWvE,MAAK,OACZ,KAAI,UAAUuE,IAAA,KAAQ,UAAUvE,EAAA,EAC5B,CAAAuE,OAAM,SAASA,MAAKvE,EAAA;MAGpB,CAAAuE,OAAM,SAASA,MAAKvE,EAAA;AAG5B,SAAOuE;AACV;AC1BD,IAAaC,SAAO,IAAI,WAAW;AAC/B,QAAM,WAAW,YAAY,CAACzD,IAAGC,OAAM;AACnC,WAAOD,GAAE,IAAIC,GAAE,IAAID,KAAIC;EAC1B,GAAE,GAAG,MAAA;AACN,QAAM,YAAY,YAAY,CAACD,IAAGC,OAAM;AACpC,WAAOD,GAAE,IAAIC,GAAE,IAAID,KAAIC;EAC1B,GAAE,GAAG,MAAA;AACN,QAAM,UAAU,YAAY,CAACD,IAAGC,OAAM;AAClC,WAAOD,GAAE,IAAIC,GAAE,IAAID,KAAIC;EAC1B,GAAE,GAAG,MAAA;AACN,QAAM,aAAa,YAAY,CAACD,IAAGC,OAAM;AACrC,WAAOD,GAAE,IAAIC,GAAE,IAAID,KAAIC;EAC1B,GAAE,GAAG,MAAA;AACN,QAAM,UAAU;IAAE,GAAG,SAAS;IAAG,GAAG,QAAQ;EAAG;AAC/C,QAAM,WAAW;IAAE,GAAG,UAAU;IAAG,GAAG,QAAQ;EAAG;AACjD,QAAM,cAAc;IAAE,GAAG,UAAU;IAAG,GAAG,WAAW;EAAG;AACvD,QAAM,aAAa;IAAE,GAAG,SAAS;IAAG,GAAG,WAAW;EAAG;AACrD,SAAOyD,eAAoB,SAAS,UAAU,aAAa,UAAA;AAC9D;AACD,IAAa,SAAS,IAAI,WAAW;AACjC,QAAM,MAAMD,OAAK,GAAG,MAAA;AACpB,QAAM,OAAO,YAAY,CAACzD,IAAGC,OAAM;AAC/B,WAAOD,GAAE,IAAIC,GAAE,IAAID,KAAIC;EAC1B,GAAE,GAAG,MAAA;AACN,QAAM,OAAO,YAAY,CAACD,IAAGC,OAAM;AAC/B,WAAOD,GAAE,IAAIC,GAAE,IAAID,KAAIC;EAC1B,GAAE,GAAG,MAAA;AACN,SAAO;IACH,GAAG;IACH,GAAG,KAAK;IACR,OAAO,KAAK,IAAI,KAAK;EACxB;AACJ;ACxBD,IAAaiB,aAAW,IAAI,WAAW;AACnC,MAAI,CAAC,MAAM,QAAQ,MAAA,EACf,OAAM,IAAI,MAAM,yBAAyB;AAE7C,QAAML,QAAM,OAAO,OAAO,CAAC,UAAU5B,OAAM;AACvC,QAAIA,OAAM,OACN,QAAO;AACX,QAAI,MAAM,QAAQA,EAAA,EACd,OAAM,IAAI,UAAU,uEAAuE;AAE/F,QAAI,CAAC,QAAQA,EAAA,EACT,OAAM,IAAI,MAAM,qDAAqD,KAAK,UAAUA,EAAA,CAAE,EAAE;AAE5F,WAAO;MACH,GAAG,SAAS,IAAIA,GAAE;MAClB,GAAG,SAAS,IAAIA,GAAE;IACrB;EACJ,GAAE;IAAE,GAAG;IAAG,GAAG;EAAG,CAAA;AACjB,SAAO,OAAO,OAAO;IACjB,GAAG4B,MAAI,IAAI,OAAO;IAClB,GAAGA,MAAI,IAAI,OAAO;EACrB,CAAA;AACJ;AC7BD,SAAgB8C,SAAM3D,IAAGwD,OAAM,GAAGI,OAAM,GAAG;AACvC,MAAI,UAAU5D,EAAA,EACV,QAAO,OAAO,OAAO;IACjB,GAAG6D,MAAY7D,GAAE,GAAGwD,MAAKI,IAAA;IACzB,GAAGC,MAAY7D,GAAE,GAAGwD,MAAKI,IAAA;IACzB,GAAGC,MAAY7D,GAAE,GAAGwD,MAAKI,IAAA;EAC5B,CAAA;MAGD,QAAO,OAAO,OAAO;IACjB,GAAGC,MAAY7D,GAAE,GAAGwD,MAAKI,IAAA;IACzB,GAAGC,MAAY7D,GAAE,GAAGwD,MAAKI,IAAA;EAC5B,CAAA;AAER;ACVD,IAAaE,WAAU,CAAC9D,IAAGC,OAAM;AAC7B,MAAID,GAAE,IAAIC,GAAE,KAAKD,GAAE,IAAIC,GAAE,EACrB,QAAO;AACX,MAAID,GAAE,IAAIC,GAAE,KAAKD,GAAE,IAAIC,GAAE,EACrB,QAAO;AACX,MAAID,GAAE,IAAIC,GAAE,KAAKD,GAAE,IAAIC,GAAE,EACrB,QAAO;AACX,MAAID,GAAE,IAAIC,GAAE,KAAKD,GAAE,IAAIC,GAAE,EACrB,QAAO;AACX,MAAID,GAAE,MAAMC,GAAE,KAAKD,GAAE,MAAMC,GAAE,EACzB,QAAO;AACX,SAAO;AACV;AAkBD,IAAa,aAAa,CAACD,IAAGC,OAAM;AAChC,MAAID,GAAE,MAAMC,GAAE,EACV,QAAO;AACX,MAAID,GAAE,IAAIC,GAAE,EACR,QAAO;AACX,SAAO;AAEV;AAiBD,IAAa,aAAa,CAACD,IAAGC,OAAM;AAChC,MAAID,GAAE,MAAMC,GAAE,EACV,QAAO;AACX,MAAID,GAAE,IAAIC,GAAE,EACR,QAAO;AACX,SAAO;AACV;AAiBD,IAAa,aAAa,CAACD,IAAGC,OAAM;AAChC,MAAID,GAAE,MAAMC,GAAE,EACV,QAAO;AACX,MAAID,GAAE,IAAIC,GAAE,EACR,QAAO;AACX,SAAO;AACV;ACrFD,IAAa,aAAa,IAAI,QAAQ;AAClC,QAAM,SAAS,CAAC,GAAG,GAAI,EAAC,KAAK,UAAA;AAC7B,MAAI,OAAO,WAAW,EAClB,QAAO;AACX,QAAMH,KAAI,CAAC,WAAW;AAClB,UAAMqC,KAAI,CAAE;AACZ,eAAWlD,MAAK,QAAQ;AACpB,aAAOkD,GAAE,UAAU,GAAG;AAElB,cAAM4B,KAAI5B,GAAE,GAAG,EAAA;AAEf,cAAM/B,KAAI+B,GAAE,GAAG,EAAA;AACf,aAAK4B,GAAE,IAAI3D,GAAE,MAAMnB,GAAE,IAAImB,GAAE,OAAO2D,GAAE,IAAI3D,GAAE,MAAMnB,GAAE,IAAImB,GAAE,GAEpD,CAAA+B,GAAE,IAAA;YAGF;MACP;AAED,MAAAA,GAAE,KAAKlD,EAAA;IACV;AAED,IAAAkD,GAAE,IAAA;AACF,WAAOA;EACV;AACD,QAAM,QAAQrC,GAAE,MAAA;AAEhB,QAAM,QAAQA,GAAE,OAAO,QAAA,CAAS;AAChC,MAAI,MAAM,WAAW,KAAK,MAAM,WAAW,KAAKc,SAAQ,MAAM,CAAA,GAAI,MAAM,CAAA,CAAA,EACpE,QAAO;AAEX,SAAO,CAAC,GAAG,OAAO,GAAG,KAAM;AAC9B;AC5BD,IAAa,iBAAiB,CAACZ,IAAGC,OAAM;AACpC,kBAAgBD,IAAG,GAAG;AACtB,MAAI,mBAAmBC,EAAA,EACnB,iBAAgBA,IAAG,GAAG;AAE1B,SAAO+D,UAAehE,IAAGC,EAAA;AAC5B;ACLD,IAAagE,yBAAuB,CAACjE,IAAGC,OAAM;AAC1C,kBAAgBD,IAAG,GAAG;AACtB,MAAI,mBAAmBC,EAAA,EACnB,QAAO,KAAK,IAAI,GAAG,eAAeD,IAAGC,EAAA,IAAKD,GAAE,SAASC,GAAE,MAAA;WAElDiE,QAAcjE,EAAA,GAAI;AACvB,UAAM,eAAewB,UAAezB,IAAGC,EAAA;AACvC,QAAI,eAAeD,GAAE,OACjB,QAAO;AACX,WAAO;EACV,MAEG,OAAM,IAAI,MAAM,+BAA+B;AACtD;ACjBD,IAAa,mBAAmB,CAACA,IAAG,UAAU;AAC1C,MAAI,iBAAiB,KAAA,EACjB,QAAOmE,qBAAyB,OAAOnE,EAAA;AAE3C,MAAI,mBAAmB,KAAA,EACnB,QAAOoE,uBAA2B,OAAOpE,EAAA;AAE7C,MAAI,QAAQ,KAAA,EACR,QAAOuB,UAASvB,IAAG,KAAA;AACvB,QAAM,IAAI,MAAM,eAAe;AAClC;ACOD,IAAa,qBAAqB,CAACA,IAAG,UAAU;AAC5C,MAAI,iBAAiB,KAAA,EACjB,QAAOmE,qBAAyB,OAAOnE,EAAA;AAE3C,MAAI,mBAAmB,KAAA,EACnB,QAAOoE,uBAA2B,OAAOpE,EAAA;AAE7C,MAAI,QAAQ,KAAA,EACR,QAAOuB,UAASvB,IAAG,KAAA;AACvB,QAAM,IAAI,MAAM,eAAe;AAClC;ACxBD,SAAgB0B,SAAO,IAAI,KAAK,KAAK,KAAK,KAAK,KAAK;AAChD,QAAM,CAAC,KAAK,GAAA,IAAO,sBAAsB,IAAI,KAAK,KAAK,KAAK,KAAK,GAAA;AACjEvC,UAAM,KAAK,GAAG;AACdA,UAAM,KAAK,GAAG;AACd,MAAI,IAAI,MAAM,EACV,OAAM,IAAI,UAAU,kCAAA;AACxB,MAAI,IAAI,MAAM,EACV,OAAM,IAAI,UAAU,kCAAA;AACxB,QAAMC,MAAK;IACP,GAAG,IAAI,IAAI,IAAI;IACf,GAAG,IAAI,IAAI,IAAI;EAClB;AACD,MAAI,UAAU,GAAA,KAAQ,UAAU,GAAA,GAAM;AAClC,QAAI,IAAI,MAAM,EACV,OAAM,IAAI,UAAU,kCAAA;AACxB,IAAAA,IAAG,KAAK,IAAI,KAAK,MAAM,IAAI,KAAK;EACnC;AAED,SAAO,OAAO,OAAOA,GAAA;AACxB;AA8BD,SAAgB,QAAQY,IAAGC,IAAGC,IAAG;AAC7B,QAAM,UAAU,kBAAkBF,IAAGC,IAAGC,EAAA;AACxC,oBAAkB,SAAS,SAAS;AACpC,SAAO,CAACmE,KAAI,IAAI,OAAO;AACnB,UAAM,WAAW,kBAAkBA,KAAI,IAAI,EAAA;AAC3C,WAAO,OAAO,SAAS,MAAM,cAAc,OAAO,OAAO;MACrD,GAAG,SAAS,IAAI,QAAQ;MACxB,GAAG,SAAS,IAAI,QAAQ;IAC3B,CAAA,IAAI,OAAO,OAAO;MACf,GAAG,SAAS,IAAI,QAAQ;MACxB,GAAG,SAAS,IAAI,QAAQ;MACxB,GAAG,SAAS,KAAK,QAAQ,KAAK;IACjC,CAAA;EACJ;AACJ;ACnED,IAAapB,WAAU,CAAChE,OAAM,CAACA,GAAE,GAAGA,GAAE,CAAE;ACTxC,IAAaqF,eAAa,IAAI,QAAQ;AAClC,QAAMtE,KAAI,IAAI,IAAI,CAAAf,OAAKgE,SAAQhE,EAAA,CAAE;AACjC,SAAOsF,WAAiBvE,EAAA;AAC3B;ACCD,IAAa,QAAQ;EAAE,GAAG;EAAG,GAAG;AAAG;AAInC,IAAa,OAAO;EAAE,GAAG;EAAG,GAAG;AAAG;AAMlC,IAAa,UAAU;EAAE,GAAG;EAAG,GAAG;EAAG,GAAG;AAAG;AAI3C,IAAa,SAAS;EAAE,GAAG;EAAG,GAAG;EAAG,GAAG;AAAG;ACN1C,SAAgB,KAAK,UAAUD,IAAGyB,IAAG;AACjC,MAAI,MAAM,QAAQ,QAAA,EACd,KAAI,SAAS,WAAW,EACpB,QAAO,OAAO,OAAO;IACjB,GAAG,SAAS,CAAA;IACZ,GAAG,SAAS,CAAA;IACZ,GAAG,SAAS,CAAA;EACf,CAAA;WAEI,SAAS,WAAW,EACzB,QAAO,OAAO,OAAO;IACjB,GAAG,SAAS,CAAA;IACZ,GAAG,SAAS,CAAA;EACf,CAAA;MAGD,OAAM,IAAI,MAAM,8CAA8C,SAAS,MAAA,EAAQ;OAGlF;AACD,QAAI,aAAa,OACb,OAAM,IAAI,MAAM,uDAAuD;aAClE,OAAO,MAAM,QAAA,EAClB,OAAM,IAAI,MAAM,UAAU;AAC9B,QAAIzB,OAAM,OACN,OAAM,IAAI,MAAM,sBAAsB;aACjC,OAAO,MAAMA,EAAA,EAClB,OAAM,IAAI,MAAM,UAAU;AAC9B,QAAIyB,OAAM,OACN,QAAO,OAAO,OAAO;MAAE,GAAG;MAAa,GAAAzB;IAAG,CAAA;QAG1C,QAAO,OAAO,OAAO;MAAE,GAAG;MAAU,GAAAA;MAAG,GAAAyB;IAAG,CAAA;EAEjD;AACJ;AAgBD,IAAa,aAAa,CAAC,YAAY;AACnC,MAAI,OAAO,YAAY,SACnB,OAAM,IAAI,UAAU,0CAA0C,OAAO,OAAA,EAAS;AAClF,QAAM,QAAQ,QAAQ,QAAQ,GAAG;AACjC,QAAM1B,KAAI,OAAO,WAAW,QAAQ,UAAU,GAAG,KAAA,CAAM;AACvD,QAAM,YAAY,QAAQ,QAAQ,KAAK,QAAQ,CAAA;AAC/C,MAAI,YAAY,GAAG;AAEf,UAAMC,KAAI,OAAO,WAAW,QAAQ,UAAU,QAAQ,GAAG,YAAY,QAAQ,CAAA,CAAE;AAC/E,UAAMyB,KAAI,OAAO,WAAW,QAAQ,UAAU,YAAY,CAAA,CAAE;AAC5D,WAAO;MAAE,GAAA1B;MAAG,GAAAC;MAAG,GAAAyB;IAAG;EACrB,OACI;AACD,UAAMzB,KAAI,OAAO,WAAW,QAAQ,UAAU,QAAQ,CAAA,CAAE;AACxD,WAAO;MAAE,GAAAD;MAAG,GAAAC;IAAG;EAClB;AACJ;AAgBD,IAAa,cAAc,IAAI,WAAW;AACtC,QAAM,MAAM,CAAE;AACd,MAAI,MAAM,QAAQ,OAAO,CAAA,CAAA,EAErB,YAAW,SAAS,QAAQ;AACxB,QAAI,EAAE,MAAM,SAAS,MAAM,GACvB,OAAM,IAAI,MAAM,sCAAsC;AAE1D,QAAI,KAAK,OAAO,OAAO;MAAE,GAAG,MAAM,CAAA;MAAI,GAAG,MAAM,CAAA;IAAI,CAAA,CAAC;EACvD;OAEA;AAED,QAAI,OAAO,SAAS,MAAM,EACtB,OAAM,IAAI,MAAM,gDAAgD;AAEpE,aAAS,QAAQ,GAAG,QAAQ,OAAO,QAAQ,SAAS,EAChD,KAAI,KAAK,OAAO,OAAO;MAAE,GAAG,OAAO,KAAA;MAAQ,GAAG,OAAO,QAAQ,CAAA;IAAI,CAAA,CAAC;EAEzE;AACD,SAAO;AACV;AC1GD,SAAgB,QAAQe,OAAM;AAC1B3B,UAAM2B,OAAM,MAAM;AAClB,SAAO;IAAE,GAAGA,MAAK;IAAG,GAAGA,MAAK;EAAG;AAClC;ACFD,SAAgB0D,cAAY,QAAQ,SAAS,uBAAuB,eAAe;AAC/E,MAAI,OAAO,0BAA0B,WAAW;AAC5C,oBAAgB;AAChB,4BAAwB;EAC3B;AACD,MAAI,CAAC,cACD,aAAY,YAAY,QAAQ,QAAQ,CAAC;MAEzC,aAAY,WAAW,QAAQ,IAAI,QAAQ,CAAC;AAChD,QAAM,CAACxE,IAAGC,EAAA,IAAKmC,oBAAkB,SAAS,qBAAA;AAC1C,QAAM9C,KAAI,OAAOU,IAAGC,EAAA;AACpB,QAAMwE,MAAKnF,MAAK,IAAI;AAEpB,MAAIA,OAAM,KAAKmF,QAAO,EAClB,QAAO,OAAO,OAAO,EAAE,GAAGxE,GAAG,CAAA;AACjC,QAAMH,KAAIG,GAAE,IAAKwE,OAAMxE,GAAE,IAAID,GAAE,KAAKV;AACpC,QAAMS,KAAIE,GAAE,IAAKwE,OAAMxE,GAAE,IAAID,GAAE,KAAKV;AACpC,SAAO,OAAO,OAAO;IACjB,GAAGW;IACA,GAAAH;IACA,GAAAC;EACN,CAAA;AACJ;AAQD,SAAgB,gBAAgBe,OAAMS,YAAUmD,UAAQ,MAAM;AAC1D,MAAI,CAACA,QACD,CAAA5D,QAAO,QAAQA,KAAA;AACnB,QAAM,KAAKA,MAAK,EAAE,IAAIA,MAAK,EAAE;AAC7B,QAAM,KAAKA,MAAK,EAAE,IAAIA,MAAK,EAAE;AAC7B,QAAM,QAAQ,KAAK,MAAM,IAAI,EAAA;AAC7B,QAAM,KAAKS,aAAW,KAAK,IAAI,KAAA;AAC/B,QAAM,KAAKA,aAAW,KAAK,IAAI,KAAA;AAC/B,SAAO;IAAE,GAAG,KAAKT,MAAK,EAAE;IAAG,GAAG,KAAKA,MAAK,EAAE;EAAG;AAChD;ACpCD,IAAa0D,gBAAc,CAAC,QAAQxE,IAAGC,IAAG,gBAAgB,UAAU0E,cAAgB,QAAQ3E,IAAGC,IAAG,aAAA;ACLlG,IAAa2E,WAAS,CAACxF,KAAI,OAAO,WAAW;AACzC,UAAQ,MAAR;IACI,KAAK;AACD,aAAO,UAAUA,GAAA,IAAM,OAAO,OAAO;QACjC,GAAGA;QACH,GAAGA,IAAG,IAAI;QACV,GAAGA,IAAG,IAAI;QACV,GAAGA,IAAG,IAAI;MACb,CAAA,IAAI,OAAO,OAAO;QACf,GAAGA;QACH,GAAGA,IAAG,IAAI;QACV,GAAGA,IAAG,IAAI;MACb,CAAA;IAEL,KAAK;AACD,aAAO,OAAO,OAAO;QACjB,GAAGA;QACH,GAAGA,IAAG,IAAI;MACb,CAAA;IAEL,KAAK;AACD,aAAO,OAAO,OAAO;QACjB,GAAGA;QACH,GAAGA,IAAG,IAAI;MACb,CAAA;IAEL,KAAK;AACD,UAAI,UAAUA,GAAA,EACV,QAAO,OAAO,OAAO;QACjB,GAAGA;QACH,GAAGA,IAAG,IAAI;MACb,CAAA;UAGD,OAAM,IAAI,MAAM,2BAA2B;IAEnD;AACI,YAAM,IAAI,MAAM,sDAAsD;EAE7E;AACJ;ACpCD,SAAgBsD,WAAS,IAAI,KAAK,KAAK,KAAK,KAAK,KAAK;AAClD,QAAM,CAAC,KAAK,GAAA,IAAO,sBAAsB,IAAI,KAAK,KAAK,KAAK,KAAK,GAAA;AACjEvD,UAAM,KAAK,GAAG;AACdA,UAAM,KAAK,GAAG;AACd,QAAMC,MAAK;IACP,GAAG,IAAI,IAAI,IAAI;IACf,GAAG,IAAI,IAAI,IAAI;EAClB;AACD,MAAI,UAAU,GAAA,KAAQ,UAAU,GAAA,EAC5B,CAAAA,IAAG,KAAK,IAAI,KAAK,MAAM,IAAI,KAAK;AAGpC,SAAO,OAAO,OAAOA,GAAA;AACxB;AAcD,IAAa,iBAAiB,CAACA,KAAI+C,OAAM;AACrC,SAAO,UAAU/C,GAAA,IAAM,OAAO,OAAO;IACjC,GAAGA;IACH,GAAGA,IAAG,IAAI+C;IACV,GAAG/C,IAAG,IAAI+C;IACV,GAAG/C,IAAG,IAAI+C;EACb,CAAA,IAAI,OAAO,OAAO;IACf,GAAG/C;IACH,GAAGA,IAAG,IAAI+C;IACV,GAAG/C,IAAG,IAAI+C;EACb,CAAA;AACJ;AC3CD,IAAa,iBAAiB,CAAC/C,KAAIwE,OAAM,GAAGJ,OAAM,MAAM;AACpD,QAAMqB,WAAStD,UAASnC,GAAA;AACxB,MAAI,QAAQ;AACZ,MAAIyF,WAASjB,KACT,SAAQA,OAAMiB;WAETA,WAASrB,KACd,SAAQA,OAAMqB;AAElB,SAAO,UAAU,IAAIzF,MAAKsD,WAAStD,KAAI,OAAO,KAAA;AACjD;ACLD,IAAa,WAAW,IAAI,WAAW,YAAY,CAACY,IAAGC,OAAOD,GAAE,KAAKC,GAAE,IAAID,KAAIC,IAAI,GAAG,MAAA;AAetF,IAAa,YAAY,IAAI,WAAW,YAAY,CAACD,IAAGC,OAAOD,GAAE,KAAKC,GAAE,IAAID,KAAIC,IAAI,GAAG,MAAA;AC3BvF,IAAM4E,WAAS,CAAC,OAAO9E,OAAM;AACzB,MAAI,QAAQ,KAAA,GAAQ;AAChB,IAAAA,KAAI,MAAM;AACV,YAAQ,MAAM;EACjB;AACD,MAAIA,OAAM,OACN,OAAM,IAAI,MAAM,YAAY;AAChC,SAAO,KAAK,MAAM,OAAOA,EAAA;AAC5B;AAYD,IAAa,YAAY,CAAC,OAAOA,OAAM;AACnC,QAAMX,MAAK,kBAAkB,OAAOW,EAAA;AACpC,QAAMuC,KAAIuC,SAAOzF,GAAA;AACjB,MAAIkD,OAAM,EACN,QAAO;AACX,SAAO,OAAO,OAAO;IACjB,GAAGlD;IACH,GAAGA,IAAG,IAAIkD;IACV,GAAGlD,IAAG,IAAIkD;EACb,CAAA;AACJ;AChBD,SAAgB,gBAAgBtC,IAAGC,IAAGC,IAAGZ,IAAG;AACxC,MAAI,QAAQU,EAAA,GAAI;AACZ,QAAI,OAAOC,OAAM,YAAYC,OAAM,OAC/B,aAAY,WAAWD,IAAG,YAAY,OAAO,GAAG,WAAWC,IAAG,YAAY,QAAQ,CAAC;SAElF;AACD,UAAI,CAAC,OAAOD,EAAA,EACR,OAAM,IAAI,MAAM,wCAAwC;AAE5D,MAAAC,KAAID,GAAE;AACN,MAAAA,KAAIA,GAAE;IACT;AACD,WAAO,OAAO,OAAO;MACjB,GAAGD,GAAE,IAAIC;MACT,GAAGD,GAAE,IAAIE;IACZ,CAAA;EACJ,OACI;AACD,gBAAY,WAAWF,IAAG,YAAY,GAAG,CAAC;AAC1C,QAAI,OAAOC,OAAM,SACb,OAAM,IAAI,UAAU,mDAAmD;AAE3E,QAAI,OAAOC,OAAM,SACb,OAAM,IAAI,UAAU,mDAAmD;AAE3E,gBAAY,WAAWD,IAAG,YAAY,GAAG,CAAC;AAC1C,gBAAY,WAAWC,IAAG,YAAY,OAAO,CAAC;AAC9C,QAAIZ,OAAM,OACN,OAAM,IAAI,MAAM,2BAA2B;AAC/C,gBAAY,WAAWA,IAAG,YAAY,QAAQ,CAAC;AAC/C,WAAO,OAAO,OAAO;MACjB,GAAGU,KAAIE;MACP,GAAGD,KAAIX;IACV,CAAA;EACJ;AACJ;ACxCD,IAAa,gBAAgB,CAACiB,YAAU,gBAAgB,SAAS,GAAG,WAAA,EAAaA,OAAAA;AAgBjF,IAAa,WAAW,IAAIuE,eAAa,CAAC1F,QAAO0F,WAAS,OAAO,CAAC,UAAU,YAAY,QAAQ,QAAA,GAAW1F,GAAA;ACvB3G,IAAa,eAAe,CAACH,OAAM;AAC/B,MAAIA,GAAE,aAAa,OACf,QAAO;AACX,MAAIA,GAAE,gBAAgB,OAClB,QAAO;AACX,SAAO;AACV;AAMD,IAAaE,UAAQ,CAACF,IAAG,OAAO,YAAY;AACxC,MAAIA,OAAM,OACN,OAAM,IAAI,MAAM,IAAI,IAAA,wDAA4D,KAAK,UAAUA,EAAA,CAAE,EAAE;AAEvG,MAAIA,OAAM,KACN,OAAM,IAAI,MAAM,IAAI,IAAA,mDAAuD,KAAK,UAAUA,EAAA,CAAE,EAAE;AAElG,MAAIA,GAAE,gBAAgB,OAClB,OAAM,IAAI,MAAM,IAAI,IAAA,oEAAwE,KAAK,UAAUA,EAAA,CAAE,EAAE;AAEnH,MAAIA,GAAE,aAAa,OACf,OAAM,IAAI,MAAM,IAAI,IAAA,iEAAqE,KAAK,UAAUA,EAAA,CAAE,EAAE;AAEhH,MAAI,OAAOA,GAAE,gBAAgB,SACzB,OAAM,IAAI,UAAU,IAAI,IAAA,uCAA2CA,GAAE,WAAA,EAAa;AAEtF,MAAI,OAAOA,GAAE,aAAa,SACtB,OAAM,IAAI,UAAU,IAAI,IAAA,oCAAwCA,GAAE,QAAA,EAAU;AAEhF,MAAIA,GAAE,gBAAgB,KAClB,OAAM,IAAI,MAAM,IAAI,IAAA,uBAA2B;AACnD,MAAIA,GAAE,aAAa,KACf,OAAM,IAAI,MAAM,IAAI,IAAA,oBAAwB;AAChD,MAAI,OAAO,MAAMA,GAAE,WAAA,EACf,OAAM,IAAI,UAAU,IAAI,IAAA,sBAA0B;AAEtD,MAAI,OAAO,MAAMA,GAAE,QAAA,EACf,OAAM,IAAI,MAAM,IAAI,IAAA,mBAAuB;AAClD;AC5CD,SAAgB,eAAe,gBAAgB;AAC3C,SAAO,MAAM,QAAQ,cAAA,IAAkB,eAAe,IAAI,CAAAkD,OAAKA,MAAK,KAAK,KAAK,IAAA,IAAQ,kBAAkB,KAAK,KAAK;AACrH;AAMD,SAAgB,aAAa,gBAAgB;AACzC,UAAQ,iBAAiB,KAAK,OAAO,IAAI,KAAK;AACjD;AACD,SAAgB,gBAAgB,gBAAgB;AAC5C,SAAO,iBAAiB;AAC3B;AAQD,SAAgB,gBAAgB,iBAAiB4C,SAAO,MAAM;AAC1D,MAAIA,OACA,QAAQ,kBAAkB,MAAO;AACrC,SAAO,kBAAkB;AAC5B;AACD,SAAgB,gBAAgB,gBAAgB;AAC5C,SAAO,iBAAiB;AAC3B;AACD,SAAgB,gBAAgB,gBAAgB;AAC5C,SAAO,iBAAiB;AAC3B;AACD,SAAgB,eAAe,gBAAgB;AAC3C,SAAO,MAAM,QAAQ,cAAA,IAAkB,eAAe,IAAI,CAAA5C,OAAKA,KAAI,MAAM,KAAK,EAAA,IAAM,iBAAiB,MAAM,KAAK;AACnH;AAMD,IAAa,mBAAmB,CAAC5B,YAAU,KAAK,MAAMA,QAAM,GAAGA,QAAM,CAAA;AA2BrE,IAAa,aAAa,CAAC,OAAO,QAAQ,YAAY,SAAS;AAC3D,MAAI,WAAW;AACX,QAAIT,KAAI,QAAQ;AAChB,QAAIA,MAAKqD,MACL,CAAArD,KAAIA,KAAIqD;AACZ,WAAOrD;EACV,OACI;AACD,UAAMA,KAAI,QAAQ;AAClB,QAAIA,KAAI,EACJ,QAAOqD,QAAOrD;AAElB,WAAOA;EACV;AACJ;AA0BD,IAAa,aAAa,CAAC,OAAO,QAAQ,YAAY,SAAS,eAAe,WAAW,eAAe,KAAA,GAAQ,eAAe,MAAA,GAAS,SAAA,CAAU;AA+BlJ,IAAa,YAAY,CAAC,OAAO,KAAK,YAAY,SAAS;AACvD,MAAIkF,KAAI;AACR,MAAI,MAAMA,IAAG;AACT,IAAAA,KAAI;AACJ,UAAM7B,QAAO,QAAQ;EACxB;AACD,MAAI7D,KAAI,MAAM0F;AACd,MAAI,UACA,CAAA1F,KAAI6D,QAAO7D;AACf,MAAIA,MAAK6D,MACL,QAAO7D,KAAI6D;AACf,SAAO7D;AACV;AA6BD,IAAa,YAAY,CAAC,OAAO,KAAK,YAAY,SAAS,eAAe,UAAU,eAAe,KAAA,GAAQ,eAAe,GAAA,GAAM,SAAA,CAAU;AAoB1I,IAAa,aAAa,CAACuD,WAAU;AACjC,MAAI,QAAQA,MAAA,EACR,QAAOA;AACX,MAAI,OAAOA,WAAU,SACjB,QAAO;IACH,OAAAA;IAAO,MAAM;EAChB;AAEL,EAAAA,SAAQA,OAAM,YAAA;AACd,MAAI,OAAO;AACX,MAAI,cAAc;AAClB,MAAIA,OAAM,SAAS,MAAM,GAAG;AACxB,kBAAc,OAAO,WAAWA,OAAM,UAAU,GAAGA,OAAM,SAAS,CAAA,CAAE;AACpE,WAAO;EACV,WACQA,OAAM,SAAS,KAAK,GAAG;AAC5B,kBAAc,OAAO,WAAWA,OAAM,UAAU,GAAGA,OAAM,SAAS,CAAA,CAAE;AACpE,WAAO;EACV,WACQA,OAAM,SAAS,MAAM,GAAG;AAC7B,kBAAc,OAAO,WAAWA,OAAM,UAAU,GAAGA,OAAM,SAAS,CAAA,CAAE;AACpE,WAAO;EACV,WACQA,OAAM,SAAS,KAAK,GAAG;AAC5B,kBAAc,OAAO,WAAWA,OAAM,UAAU,GAAGA,OAAM,SAAS,CAAA,CAAE;AACpE,WAAO;EACV,MAEG,eAAc,OAAO,WAAWA,MAAA;AAEpC,MAAI,OAAO,MAAM,WAAA,EACb,OAAM,IAAI,MAAM,4BAA4B;AAChD,MAAI,KAAK,WAAW,EAChB,OAAM,IAAI,MAAM,yBAAyB;AAC7C,SAAO;IACH,OAAO;IACD;EACT;AACJ;AACD,IAAM,UAAU,CAACV,OAAM;AACnB,MAAI,OAAOA,OAAM,SACb,QAAO;AACX,MAAI,UAAUA,MAAK,WAAWA,IAAG;AAC7B,QAAI,OAAOA,GAAE,SAAS,SAClB,QAAO;AACX,QAAI,OAAOA,GAAE,UAAU,SACnB,QAAO;AACX,WAAO;EACV;AACD,SAAO;AACV;AAuBD,IAAa,eAAe,CAAC,gBAAgB,gBAAgB;AACzD,QAAM,QAAQ,OAAO,mBAAmB,WAAW,iBAAiB,WAAW,cAAA;AAC/E,UAAQ,aAAR;IACI,KAAK;AACD,UAAI,MAAM,SAAS,MACf,QAAO;AACX,UAAI,MAAM,SAAS,MACf,QAAO;QAAE,OAAO,eAAe,MAAM,KAAA;QAAQ,MAAM;MAAO;AAC9D,UAAI,MAAM,SAAS,OACf,QAAO;QAAE,OAAO,gBAAgB,MAAM,KAAA;QAAQ,MAAM;MAAO;AAC/D,UAAI,MAAM,SAAS,OACf,QAAO;QAAE,OAAO,aAAa,MAAM,KAAA;QAAQ,MAAM;MAAO;AAC5D,YAAM,IAAI,MAAM,iBAAiB,MAAM,IAAA,EAAM;IACjD,KAAK;AACD,UAAI,MAAM,SAAS,MACf,QAAO;QAAE,OAAO,gBAAgB,MAAM,KAAA;QAAQ,MAAM;MAAQ;AAChE,UAAI,MAAM,SAAS,MACf,QAAO;QAAE,OAAO,gBAAgB,MAAM,KAAA;QAAQ,MAAM;MAAQ;AAChE,UAAI,MAAM,SAAS,OACf,QAAO;AACX,UAAI,MAAM,SAAS,OACf,QAAO;QAAE,OAAO,gBAAgB,aAAa,MAAM,KAAA,CAAM;QAAG,MAAM;MAAQ;AAC9E,YAAM,IAAI,MAAM,iBAAiB,MAAM,IAAA,EAAM;IACjD,KAAK;AACD,UAAI,MAAM,SAAS,MACf,QAAO;QAAE,OAAO,eAAe,MAAM,KAAA;QAAQ,MAAM;MAAO;AAC9D,UAAI,MAAM,SAAS,MACf,QAAO;AACX,UAAI,MAAM,SAAS,OACf,QAAO;QAAE,OAAO,gBAAgB,MAAM,KAAA;QAAQ,MAAM;MAAO;AAC/D,UAAI,MAAM,SAAS,OACf,QAAO;QAAE,OAAO,gBAAgB,aAAa,MAAM,KAAA,CAAM;QAAG,MAAM;MAAQ;AAC9E,YAAM,IAAI,MAAM,iBAAiB,MAAM,IAAA,EAAM;IACjD,KAAK;AACD,UAAI,MAAM,SAAS,MACf,QAAO;QAAE,OAAO,aAAa,MAAM,KAAA;QAAQ,MAAM;MAAQ;AAC7D,UAAI,MAAM,SAAS,MACf,QAAO;QAAE,OAAO,aAAa,MAAM,KAAA;QAAQ,MAAM;MAAQ;AAC7D,UAAI,MAAM,SAAS,OACf,QAAO;QAAE,OAAO,aAAa,gBAAgB,MAAM,KAAA,CAAM;QAAG,MAAM;MAAQ;AAC9E,UAAI,MAAM,SAAS,OACf,QAAO;AACX,YAAM,IAAI,MAAM,iBAAiB,MAAM,IAAA,EAAM;IACjD;AACI,YAAM,IAAI,MAAM,8BAA8B,WAAA,oCAA+C;EACpG;AACJ;AAQD,IAAa,eAAe,CAAC,OAAO4C,SAAO,SAAS;AAChD,MAAIA,OACA,QAAQ,QAAQ,MAAO;AAC3B,SAAO,QAAQ;AAClB;AACD,IAAa,eAAe,CAAC,UAAU,QAAQ5B;AAC/C,IAAa,eAAe,CAAC,YAAY,UAAU;AACnD,IAAa,eAAe,CAAC,YAAY,UAAUA;ACtUnD,IAAa8B,WAAS,CAAC/E,IAAG,iBAAiB,OAAO,OAAO;EACrD,GAAGA;EACH,aAAaA,GAAE,cAAc;AAChC,CAAA;AAMD,IAAa,SAAS,CAACjB,OAAM;AACzBE,UAAMF,IAAG,GAAG;AACZ,SAAO,OAAO,OAAO;IACjB,GAAGA;IACH,aAAaA,GAAE,cAAc,KAAK;EACrC,CAAA;AACJ;AAOD,IAAa,aAAa,CAACe,IAAGC,OAAM;AAChCd,UAAMa,IAAG,GAAG;AACZb,UAAMc,IAAG,GAAG;AACZ,MAAID,GAAE,aAAaC,GAAE,SACjB,QAAO;AACX,SAAOD,GAAE,gBAAgB,CAACC,GAAE;AAC/B;AAOD,IAAa,aAAa,CAACD,IAAGC,OAAM;AAChCd,UAAMa,IAAG,GAAG;AACZb,UAAMc,IAAG,GAAG;AACZ,SAAOD,GAAE,gBAAgBC,GAAE;AAC9B;AAOD,IAAa,iBAAiB,CAACD,IAAGC,OAAM;AACpCd,UAAMa,IAAG,GAAG;AACZb,UAAMc,IAAG,GAAG;AACZ,SAAOD,GAAE,gBAAgB,CAACC,GAAE;AAC/B;AAOD,IAAa,gBAAgB,CAACC,IAAG,cAAc,OAAO,OAAO;EACzD,GAAGA;EACH,aAAaA,GAAE,cAAc,eAAe,SAAA;AAC/C,CAAA;ACjDD,IAAagF,WAAS,CAAChF,IAAG,UAAU;AAChC,QAAMD,KAAI,YAAYC,IAAG,KAAA;AACzB,SAAO;IAAE,GAAG;IAAO,GAAAD;EAAG;AACzB;AAuBD,IAAa,cAAc,CAACD,IAAGC,IAAGC,OAAM;AACpC,MAAI,aAAaF,EAAA,GAAI;AACjB,QAAI,OAAOC,OAAM,YACb,CAAAA,KAAIkF;AACR,QAAI,QAAQlF,EAAA,EACR,QAAO,iBAAiBD,GAAE,UAAUA,GAAE,aAAaC,EAAA;AAEvD,UAAM,IAAI,MAAM,2DAA2D;EAC9E,WACQ,OAAOD,OAAM,SAClB,OAAM,IAAI,UAAU,8CAA8C,KAAK,UAAUA,EAAA,CAAE,EAAE;WAGjF,OAAOA,OAAM,YAAY,OAAOC,OAAM,UAAU;AAChD,QAAI,OAAOC,OAAM,YACb,CAAAA,KAAIiF;AACR,QAAI,CAAC,QAAQjF,EAAA,EACT,OAAM,IAAI,MAAM,2DAA2D;AAE/E,WAAO,iBAAiBF,IAAGC,IAAGC,EAAA;EACjC,MAEG,OAAM,IAAI,UAAU,mDAAmD,OAAOF,EAAA,KAAM,OAAOC,EAAA,KAAM,OAAOC,EAAA,SAAU,KAAK,UAAUF,EAAA,CAAE,EAAE;AAGhJ;AAeD,IAAa,gBAAgB,CAACO,SAAO,WAAW;AAC5C,MAAI,OAAOA,YAAU,YACjB,OAAM,IAAI,MAAM,0CAA0C;AAC9D,MAAI,OAAO,WAAW,YAClB,OAAM,IAAI,MAAM,2CAA2C;AAC/DA,YAAQ6E,SAAc7E,SAAO,MAAA;AAC7B,QAAM,QAAQ,KAAK,MAAMA,QAAM,GAAGA,QAAM,CAAA;AACxC,QAAMgB,aAAW,KAAK,MAAMhB,QAAM,GAAGA,QAAM,CAAA;AAC3C,QAAM,QAAQ;IACV,GAAGA;IACH,aAAa;IACb,UAAA;EACH;AACD,SAAO,MAAM;AACb,SAAO,MAAM;AACb,SAAO,OAAO,OAAO,KAAA;AACxB;AAQD,IAAM,mBAAmB,CAACgB,YAAU,cAAc,SAAS4D,UAAe;AACtExE,UAAW,MAAA;AACX,SAAO,OAAO,OAAO;IACjB,GAAG,OAAO,IAAIY,aAAW,KAAK,IAAI,YAAA;IAClC,GAAG,OAAO,IAAIA,aAAW,KAAK,IAAI,YAAA;EACrC,CAAA;AACJ;AAOD,IAAa8D,aAAW,CAACpG,IAAG,WAAW;AACnC,MAAIA,OAAM,OACN,QAAO;AACX,MAAIA,OAAM,KACN,QAAO;AACX,QAAM,WAAW,eAAeA,GAAE,WAAA;AAClC,QAAMK,KAAI,SAASL,GAAE,SAAS,QAAQ,MAAA,IAAUA,GAAE;AAClD,QAAMe,KAAI,SAAS,SAAS,QAAQ,MAAA,IAAU;AAC9C,SAAO,IAAIV,EAAA,IAAKU,EAAA;AACnB;AACD,IAAa,UAAU,CAACmC,IAAG,SAASgD,UAAe;AAC/ChG,UAAMgD,IAAG,GAAG;AACZ,SAAO,OAAO,OAAO;IACjB,GAAG,OAAO,IAAIA,GAAE,WAAW,KAAK,IAAIA,GAAE,WAAA;IACtC,GAAG,OAAO,IAAIA,GAAE,WAAW,KAAK,IAAIA,GAAE,WAAA;EACzC,CAAA;AACJ;ACxID,IAAamD,cAAY,CAACpF,OAAM;AAE5B,MAAIA,GAAE,aAAa,EACf,OAAM,IAAI,MAAM,qCAAqC;AACzD,SAAO,OAAO,OAAO;IACjB,GAAGA;IACH,UAAU;EACb,CAAA;AACJ;AAQD,IAAaqF,mBAAiB,CAACpD,IAAGyB,OAAM,GAAGJ,OAAM,MAAM;AACnD,MAAI,MAAMrB,GAAE;AACZ,MAAI,MAAMyB,KACN,OAAMA;AACV,MAAI,MAAMJ,KACN,OAAMA;AACV,SAAO,OAAO,OAAO;IACjB,GAAGrB;IACH,UAAU;EACb,CAAA;AACJ;AAYD,IAAamC,eAAa,CAACtE,IAAGC,OAAM;AAChCd,UAAMa,IAAG,GAAG;AACZb,UAAMc,IAAG,GAAG;AACZ,SAAOD,GAAE,WAAWC,GAAE,WAAW,KAAK,IAAIA,GAAE,cAAcD,GAAE,WAAA;AAC/D;AAQD,IAAa0C,aAAW,CAACP,IAAG,QAAQ;AAChChD,UAAMgD,EAAA;AACN,cAAY,WAAW,KAAK,IAAI,KAAK,CAAC;AACtC,SAAO,OAAO,OAAO;IACjB,GAAGA;IACH,UAAUA,GAAE,WAAW;EAC1B,CAAA;AACJ;AAQD,IAAaT,WAAS,CAACS,IAAG,QAAQ;AAC9BhD,UAAMgD,EAAA;AACN,cAAY,WAAW,KAAK,IAAI,KAAK,CAAC;AACtC,SAAO,OAAO,OAAO;IACjB,GAAGA;IACH,UAAUA,GAAE,WAAW;EAC1B,CAAA;AACJ;AC5DD,IAAa,kBAAkB,CAAC/C,KAAI,UAAU,KAAK,UAAU;AACzDD,UAAMC,KAAI,IAAI;AACd,SAAO,OAAO,OAAO;IACjB,GAAG,QAAQA,IAAG,CAAA;IACd,GAAG,QAAQA,IAAG,CAAA;EACjB,CAAA;AACJ;AAOD,IAAa,OAAO,CAACA,QAAO;AACxBD,UAAMC,KAAI,IAAI;AACd,MAAI,OAAO,EACP,GAAGA,IACN;AACD,SAAO,KAAK;AACZ,SAAO,OAAO,OAAO,IAAA;AACxB;AAQD,IAAa,OAAO,CAACA,KAAIoC,KAAI,MAAM;AAC/BrC,UAAMC,KAAI,IAAI;AACd,SAAO,OAAO,OAAO;IACjB,GAAGA;IACH,GAAAoC;EACH,CAAA;AACJ;AAOD,SAAgB6D,WAASpG,IAAG,QAAQ;AAChC,MAAIA,OAAM,OACN,QAAO;AACX,MAAIA,OAAM,KACN,QAAO;AACXE,UAAMF,IAAG,IAAI;AACb,QAAMa,KAAI,SAASb,GAAE,EAAE,QAAQ,MAAA,IAAUA,GAAE;AAC3C,QAAMc,KAAI,SAASd,GAAE,EAAE,QAAQ,MAAA,IAAUA,GAAE;AAC3C,MAAIA,GAAE,MAAM,OACR,QAAO,IAAIa,EAAA,IAAKC,EAAA;OAEf;AACD,UAAMyB,KAAI,SAASvC,GAAE,EAAE,QAAQ,MAAA,IAAUA,GAAE;AAC3C,WAAO,IAAIa,EAAA,IAAKC,EAAA,IAAKyB,EAAA;EACxB;AACJ;;;;;;;ACrDD,IAAagE,gBAAc,CAAC,KAAK,WAAW;AACxC,QAAMC,KAAI,UAAU,KAAK,MAAA;AACzB,QAAMzF,KAAI0F,YAAiB,IAAI,QAAQ,IAAI,aAAaD,EAAA;AACxD,QAAMxF,KAAIyF,YAAiB,IAAI,SAAS,IAAI,QAAQ,IAAI,aAAaD,EAAA;AACrE,SAAO;IAAE,GAAAzF;IAAG,GAAAC;EAAG;AAClB;AACD,IAAM,YAAY,CAAC,KAAK,WAAW;AAC/B,MAAI,WAAW,OACX,QAAO;AACX,MAAI,IAAI,WAAW,OACf,QAAO,IAAI;AACf,SAAO;IAAE,GAAG;IAAG,GAAG;EAAG;AACxB;AAmCD,IAAaoF,aAAW,CAAC,QAAQ;AAC7B,MAAI,QAAQ,mBAAmB,IAAI,WAAA,YAAuB,IAAI,MAAA,SAAe,IAAI,MAAA;AACjF,MAAI,IAAI,OACJ,UAAS,YAAYM,WAAc,IAAI,MAAA,CAAO;AAElD,WAAS;AACT,SAAO;AACV;AAUD,IAAa,WAAW,CAAC7E,OAAM,WAAW;AACtC,QAAM2E,KAAI,UAAU3E,MAAK;AACzB,SAAO;IACH,aAAa,YAAYA,MAAK,GAAG2E,EAAA;IACjC,QAAQlE,UAAST,MAAK,GAAG2E,EAAA;IACzB,QAAQlE,UAAST,MAAK,GAAGA,MAAK,CAAA;IAC9B,QAAQ2E;EACX;AACJ;AC3ED,UAAiB,OAAO,YAAY,MAAM;AACtC,MAAI,OAAO;AACX,SAAO,MAAM;AACT,UAAMzF,KAAI,aAAa;AACvB,UAAM;MACF,UAAU,OAAOA;MACjB,aAAaA;MACP;IACT;EACJ;AACJ;AAQD,IAAa,YAAY,CAAC,MAAM,YAAY,SAAS;AACjD,QAAMA,KAAI,aAAa;AACvB,SAAO,OAAO,OAAO;IACjB,UAAU,OAAOA;IACjB,aAAaA;EAChB,CAAA;AACJ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AEzBD,IAAM,iBAAiB,OAAO,OAAO;EAAE,GAAG;EAAG,GAAG;AAAG,CAAA;AACnD,IAAMmD,SAAO,KAAK,KAAK;AACvB,IAAMyC,QAAK,KAAK;AAKhB,IAAa,cAAc,CAAC,YAAY;AACpC,SAAO,OAAO,OAAO;IACjB,GAAG,KAAK,IAAI,OAAA;IACZ,GAAG,KAAK,IAAI,OAAA;EACf,CAAA;AACJ;AACD,IAAa,YAAY,CAACrF,YAAU;AAChC,SAAO,KAAK,MAAMA,QAAM,GAAGA,QAAM,CAAA;AACpC;AAWD,IAAa,iBAAiB,CAACnB,KAAI,qBAAqB,IAAI,SAAS,mBAAmB;AACpF,EAAAA,MAAK6B,SAAe7B,KAAI,MAAA;AACxB,MAAI,YAAY,KAAK,MAAMA,IAAG,GAAGA,IAAG,CAAA;AACpC,MAAI,uBAAuB,cAAc,YAAY,EACjD,cAAa+D;WACR,uBAAuB,WAC5B;QAAI,YAAYyC,MACZ,cAAazC;aACR,aAAa,CAACyC,MACnB,cAAazC;EAAK;AAE1B,SAAO,OAAO,OAAO;IACjB,UAAU1B,UAAerC,GAAA;IACzB,aAAa;EAChB,CAAA;AACJ;AAMD,IAAa,oBAAoB,CAAC0B,UAASG,SAAeH,MAAK,GAAGA,MAAK,CAAA;AAMvE,IAAa,gBAAgB,CAACA,UAAS;AACnC+E,UAAW/E,OAAM,MAAM;AACvB,QAAM1B,MAAK6B,SAAeH,MAAK,GAAGA,MAAK,CAAA;AACvC,SAAO,eAAe1B,GAAA;AACzB;AACD,IAAM,UAAU,CAAC+C,OAAM;AACnB,MAAA,aAAuBA,EAAA,EACnB,QAAO;AACX,SAAO;AACV;AACD,IAAM,cAAc,CAACA,OAAM;AACvB,MAAI,QAAQA,EAAA,EACR,QAAO;AACX,SAAO;AACV;AAQD,IAAamD,cAAY,CAACnD,OAAM;AAC5B,MAAI,QAAQA,EAAA,EACR,QAAA,YAAuBA,EAAA;WAElB,YAAYA,EAAA,EACjB,QAAO2D,UAAgB3D,EAAA;AAE3B,QAAM,IAAI,MAAM,yCAAyCA,EAAA,EAAG;AAC/D;AACD,IAAa,sBAAsB,CAAClD,OAAM;AACtC,MAAIA,GAAE,KAAK,KAAKA,GAAE,KAAK,EACnB,QAAO;AACX,MAAIA,GAAE,IAAI,KAAKA,GAAE,KAAK,EAClB,QAAO2G;AACX,MAAI3G,GAAE,IAAI,KAAKA,GAAE,IAAI,EACjB,QAAO2G;AACX,SAAOzC;AACV;AAQD,IAAa,UAAU,CAAChB,IAAG,SAAS4D,UAAe;AAC/C,MAAI,QAAQ5D,EAAA,EACR,QAAOA;WAEF,YAAYA,EAAA,EACjB,QAAA,cAA2BA,IAAG,MAAA;AAElC,QAAM,IAAI,MAAM,yCAAyCA,EAAA,EAAG;AAC/D;AAOD,IAAaqD,gBAAc,CAACrD,OAAM;AAC9B,MAAI,QAAQA,EAAA,EACR,QAAA,QAAqBA,EAAA;WAEhB,YAAYA,EAAA,EACjB,QAAOA;AAEX,QAAM,IAAI,MAAM,yCAAyCA,EAAA,EAAG;AAC/D;AAOD,IAAakD,aAAW,CAAClD,IAAG,WAAW;AACnC,MAAI,QAAQA,EAAA,EACR,QAAA,WAAsBA,IAAG,MAAA;WAEpB,YAAYA,EAAA,EACjB,QAAO6D,WAAe7D,IAAG,MAAA;AAE7B,QAAM,IAAI,MAAM,yCAAyCA,EAAA,EAAG;AAC/D;AAOD,IAAamC,eAAa,CAACtE,IAAGC,OAAM;AAChC,MAAI,QAAQD,EAAA,KAAM,QAAQC,EAAA,EACtB,QAAA,aAAwBD,IAAGC,EAAA;WAEtB,YAAYD,EAAA,KAAM,YAAYC,EAAA,EACnC,QAAOgG,aAAiBjG,IAAGC,EAAA;AAE/B,QAAM,IAAI,MAAM,uCAAuC;AAC1D;AAQD,IAAasF,mBAAiB,CAACpD,IAAGyB,OAAM,GAAGJ,OAAM,MAAM;AACnD,MAAI,QAAQrB,EAAA,EACR,QAAA,iBAA4BA,IAAGyB,MAAKJ,IAAA;WAE/B,YAAYrB,EAAA,EACjB,QAAO+D,eAAqB/D,IAAGyB,MAAKJ,IAAA;AAExC,QAAM,IAAI,MAAM,2CAA2C;AAC9D;AASD,IAAa3C,QAAM,CAACb,IAAGC,OAAM;AACzB,QAAM,QAAQ,QAAQD,EAAA;AACtB,EAAAA,KAAIwF,cAAYxF,EAAA;AAChB,EAAAC,KAAIuF,cAAYvF,EAAA;AAChB,QAAMC,KAAIkB,KAAUpB,IAAGC,EAAA;AACvB,SAAO,QAAQ,QAAQC,EAAA,IAAKA;AAC/B;AAQD,IAAa8C,aAAW,CAAChD,IAAGC,OAAM;AAC9B,QAAM,QAAQ,QAAQD,EAAA;AACtB,EAAAA,KAAIwF,cAAYxF,EAAA;AAChB,EAAAC,KAAIuF,cAAYvF,EAAA;AAChB,QAAMC,KAAIe,SAAejB,IAAGC,EAAA;AAC5B,SAAO,QAAQ,QAAQC,EAAA,IAAKA;AAC/B;AAQD,IAAawC,aAAW,CAAC1C,IAAGC,OAAM;AAC9B,QAAM,QAAQ,QAAQD,EAAA;AACtB,EAAAA,KAAIwF,cAAYxF,EAAA;AAChB,EAAAC,KAAIuF,cAAYvF,EAAA;AAChB,QAAMC,KAAIiG,WAAenG,IAAGC,EAAA;AAC5B,SAAO,QAAQ,QAAQC,EAAA,IAAKA;AAC/B;AAQD,IAAawB,WAAS,CAAC1B,IAAGC,OAAM;AAC5B,QAAM,QAAQ,QAAQD,EAAA;AACtB,EAAAA,KAAIwF,cAAYxF,EAAA;AAChB,EAAAC,KAAIuF,cAAYvF,EAAA;AAChB,QAAMC,KAAIkG,SAAYpG,IAAGC,EAAA;AACzB,SAAO,QAAQ,QAAQC,EAAA,IAAKA;AAC/B;ACjOD,IAAamG,YAAU,CAACvF,OAAMP,YAAU;AACpC,QAAM+F,KAAI,CAACxF,YAAS;AAChB,UAAM,EAAE,GAAAd,IAAG,GAAAC,GAAA,IAAMa;AACjB,UAAMyF,QAAO;MAAE,GAAGtG,GAAE,IAAID,GAAE;MAAG,GAAGC,GAAE,IAAID,GAAE;IAAG;AAC3C,UAAM,OAAO;MAAE,GAAGO,QAAM,IAAIP,GAAE;MAAG,GAAGO,QAAM,IAAIP,GAAE;IAAG;AACnD,UAAM6E,WAAS0B,MAAK,IAAIA,MAAK,IAAIA,MAAK,IAAIA,MAAK;AAC/C,QAAIC,OAAM,KAAK,IAAID,MAAK,IAAI,KAAK,IAAIA,MAAK;AAC1C,UAAME,KAAI,KAAK,IAAI,GAAG,KAAK,IAAI,GAAGD,OAAM3B,QAAAA,CAAO;AAC/C,IAAA2B,QAAOvG,GAAE,IAAID,GAAE,MAAMO,QAAM,IAAIP,GAAE,MAAMC,GAAE,IAAID,GAAE,MAAMO,QAAM,IAAIP,GAAE;AACjE,WAAO;MAAE,GAAGA,GAAE,IAAIuG,MAAK,IAAIE;MAAG,GAAGzG,GAAE,IAAIuG,MAAK,IAAIE;IAAG;EACtD;AACD,MAAI,MAAM,QAAQ3F,KAAA,GAAO;AACrB,UAAM,MAAMA,MAAK,IAAI,CAAAwB,OAAKgE,GAAEhE,EAAA,CAAE;AAC9B,UAAM,QAAQ,IAAI,IAAI,CAAArD,OAAKwC,UAAexC,IAAGsB,OAAAA,CAAM;AACnD,WAAO,OAAO,OAAO,IAAI,SAAS,GAAG,KAAA,CAAM,CAAA;EAC9C,MAEG,QAAO,OAAO,OAAO+F,GAAExF,KAAA,CAAK;AAEnC;ACnBD,IAAa,qBAAqB,CAACA,OAAMP,YAAU;AAC/CpB,UAAM2B,OAAM,MAAM;AAClBH,UAAWJ,SAAO,OAAO;AACzB,MAAI,OAAOO,KAAA,MAAU,EAEjB,QAAO,OAAOA,MAAK,GAAGP,OAAAA;AAE1B,QAAM,OAAO8F,UAAQvF,OAAMP,OAAAA;AAC3B,SAAO,OAAO,MAAMA,OAAAA;AACvB;ACrBD,IAAM,kBAAkB,CAACO,WAAU;EAC/B,GAAGA,MAAK,EAAE,IAAIA,MAAK,EAAE;EACrB,GAAGA,MAAK,EAAE,IAAIA,MAAK,EAAE;AACxB;AACD,IAAM,4BAA4B,CAACA,UAAS;AACxC,QAAMwB,KAAI,OAAOxB,KAAA;AACjB,QAAMqB,KAAI,gBAAgBrB,KAAA;AAC1B,SAAO;IACH,GAAGqB,GAAE,IAAIG;IACT,GAAGH,GAAE,IAAIG;EACZ;AACJ;AAUD,IAAa,WAAW,CAACxB,OAAMS,eAAa;AACxC,QAAM,KAAK,gBAAgBT,KAAA;AAC3B,QAAM,MAAM,0BAA0BA,KAAA;AACtC,QAAMd,KAAI;IACN,GAAGc,MAAK,EAAE,IAAI,IAAI,IAAIS;IACtB,GAAGT,MAAK,EAAE,IAAI,IAAI,IAAIS;EACzB;AACD,SAAO;IACH,GAAAvB;IACA,GAAG;MACC,GAAGA,GAAE,IAAI,GAAG;MACZ,GAAGA,GAAE,IAAI,GAAG;IACf;EACJ;AACJ;AAYD,IAAa,qBAAqB,CAACc,OAAMS,YAAU,SAAS,MAAM;AAC9D,QAAM,SAASiD,cAAY,QAAQ1D,KAAA;AACnC,QAAM,MAAM,0BAA0BA,KAAA;AACtC,SAAO;IACH,GAAG,OAAO,IAAI,IAAI,IAAIS;IACtB,GAAG,OAAO,IAAI,IAAI,IAAIA;EACzB;AACJ;AChDD,IAAakC,SAAO,CAAC3C,UAAS4F,OAAW5F,MAAK,GAAGA,MAAK,CAAA;ACOtD,IAAa,SAAS,CAACA,OAAMP,YAAU,OAAO,OAAO;EACjD,GAAGO;EACH,GAAGsF,SAAYtF,MAAK,GAAGP,OAAAA;EACvB,GAAG6F,SAAYtF,MAAK,GAAGP,OAAAA;AAC1B,CAAA;ACLD,IAAa0B,gBAAc,CAAC,IAAI,IAAI0E,KAAIC,QAAO;AAC3C,MAAI,OAAO,MAAM,EAAA,EACb,OAAM,IAAI,MAAM,WAAW;AAC/B,MAAI,OAAO,MAAMD,GAAA,EACb,OAAM,IAAI,MAAM,WAAW;AAC/B,MAAI,OAAO,MAAM,EAAA,EACb,OAAM,IAAI,MAAM,WAAW;AAC/B,MAAI,OAAO,MAAMC,GAAA,EACb,OAAM,IAAI,MAAM,WAAW;AAC/B,QAAM5G,KAAI;IAAE,GAAG;IAAI,GAAG;EAAI;AAC1B,QAAMC,KAAI;IAAE,GAAG0G;IAAI,GAAGC;EAAI;AAC1B,SAAOjF,aAAW3B,IAAGC,EAAA;AACxB;ACbD,IAAa4G,kBAAgB,CAACC,WAAU;AACpC,MAAI,CAAC,MAAM,QAAQA,MAAA,EACf,OAAM,IAAI,MAAM,+BAA+B;AACnD,MAAIA,OAAM,WAAW,EACjB,OAAM,IAAI,MAAM,uCAAuC;AAC3D,SAAO7E,cAAY6E,OAAM,CAAA,GAAIA,OAAM,CAAA,GAAIA,OAAM,CAAA,GAAIA,OAAM,CAAA,CAAA;AAC1D;ACKD,IAAa,YAAY,CAAC,SAAS;EAAE,GAAG;EAAK,GAAG;AAAK,GAAEjC,WAAS,GAAGkC,gBAAc,GAAG,UAAU,QAAQ;AAClG,QAAM,OAAOlC,WAAS;AACtB,QAAM,QAAQA,YAAU,IAAI;AAC5B,QAAM7E,KAAA,YAAsB,MAAM,aAAa+G,aAAAA,GAAc,MAAA;AAC7D,QAAM9G,KAAA,YAAsB,OAAO8G,eAAa,MAAA;AAChD,SAAO,OAAO,OAAO;IACjB,GAAA/G;IAAG,GAAAC;EACN,CAAA;AACJ;ACpBD,IAAa,WAAW,CAAC,SAAS,WAAW;AACzC,QAAM,CAACD,IAAGC,EAAA,IAAKmC,oBAAkB,SAAS,MAAA;AAC1C,SAAOoC,cAAY,KAAKxE,IAAGC,EAAA;AAC9B;ACPD,IAAa+G,qBAAmB,CAAClG,OAAM1B,QAAO;AAC1C,QAAM,YAAYqC,UAAeX,MAAK,GAAG1B,GAAA;AACzC,QAAM6H,SAAQ,OAAOnG,KAAA;AACrB,SAAO,YAAYmG;AACtB;ACED,IAAapG,SAAM,CAACC,OAAMP,YAAU,OAAO,OAAO;EAC9C,GAAGO;EACH,GAAGM,KAAUN,MAAK,GAAGP,OAAAA;EACrB,GAAGa,KAAUN,MAAK,GAAGP,OAAAA;AACxB,CAAA;ACOD,IAAa0E,WAAS,CAACnE,OAAM,cAAc,WAAW;AAClD,MAAI,OAAO,iBAAiB,eAAe,iBAAiB,EACxD,QAAOA;AACX,MAAI,OAAO,WAAW,YAClB,UAAS;AACb,MAAI,OAAO,WAAW,SAClB,UAAS0D,cAAY,QAAQ1D,MAAK,GAAGA,MAAK,CAAA;AAE9C,SAAO,OAAO,OAAO;IACjB,GAAGA;IACH,GAAGoG,OAAYpG,MAAK,GAAG,cAAc,MAAA;IACrC,GAAGoG,OAAYpG,MAAK,GAAG,cAAc,MAAA;EACxC,CAAA;AACJ;ACrBD,IAAaF,YAAU,CAACZ,IAAGC,OAAMiC,SAAclC,GAAE,GAAGC,GAAE,CAAA,KAAMiC,SAAclC,GAAE,GAAGC,GAAE,CAAA;ACFjF,IAAa,WAAW,CAACa,OAAMP,YAAW,OAAO,OAAO;EACpD,GAAGO;EACH,GAAGqF,WAAerF,MAAK,GAAGP,OAAAA;EAC1B,GAAG4F,WAAerF,MAAK,GAAGP,OAAAA;AAC7B,CAAA;ACND,IAAayC,aAAW,CAAClC,OAAMP,YAAU,OAAO,OAAO;EACnD,GAAGO;EACH,GAAGG,SAAeH,MAAK,GAAGP,OAAAA;EAC1B,GAAGU,SAAeH,MAAK,GAAGP,OAAAA;AAC7B,CAAA;ACTD,SAAgB8E,YAASrF,IAAGC,IAAG;AAC3B,MAAI,OAAOD,EAAA,GAAI;AACXb,YAAMa,IAAG,GAAG;AACZ,IAAAC,KAAID,GAAE;AACN,IAAAA,KAAIA,GAAE;EACT,WACQC,OAAM,OACX,OAAM,IAAI,MAAM,yCAAyC;AAC7D,SAAO+F,WAAehG,EAAA,IAAK,MAAMgG,WAAe/F,EAAA;AACnD;ACqBD,IAAa,SAAS,CAACa,UAAS;AAC5B,QAAM,EAAE,GAAAd,IAAG,GAAAC,GAAA,IAAMa;AACjB,SAAO,OAAO,OAAO;IACjB,GAAGA;IACH,QAAQ,MAAM,OAAOd,IAAGC,EAAA;IACxB,aAAa,CAAC,WAAWuE,cAAY,QAAQxE,IAAGC,EAAA;IAChD,kBAAkB,CAACM,YAAUyG,mBAAiBlG,OAAMP,OAAAA;IACpD,MAAM,MAAMkD,OAAK3C,KAAA;IACjB,UAAU,MAAMuE,YAASrF,IAAGC,EAAA;IAC5B,aAAa,MAAMkH,cAAYnH,IAAGC,EAAA;IAClC,aAAa,MAAMmH,cAAYpH,IAAGC,EAAA;IAClC,UAAU,MAAM,CAACD,IAAGC,EAAE;IACtB,QAAQ,CAAC,cAAc,WAAW,OAAOgF,SAAOnE,OAAM,cAAc,MAAA,CAAO;IAC3E,SAAS,CAACP,YAAU8F,UAAQvF,OAAMP,OAAAA;IAClC,KAAK,CAACA,YAAU,OAAOM,OAAIC,OAAMP,OAAAA,CAAM;IACvC,QAAQ,CAACA,YAAU,OAAO,OAAOO,OAAMP,OAAAA,CAAM;IAC7C,UAAU,CAACA,YAAU,OAAO,SAASO,OAAMP,OAAAA,CAAM;IACjD,UAAU,CAACA,YAAU,OAAOyC,WAASlC,OAAMP,OAAAA,CAAM;IACjD,UAAU,MAAM,SAASP,IAAGC,EAAA;IAC5B,iBAAiB,CAACM,YAAU,mBAAmBO,OAAMP,OAAAA;IACrD,UAAU,CAACgB,eAAa,SAAST,OAAMS,UAAAA;IACvC,oBAAoB,CAACA,YAAU,WAAW,mBAAmBT,OAAMS,YAAU,MAAA;IAC7E,OAAO,MAAM,MAAMT,KAAA;IACnB,aAAa,CAACP,SAAO,aAAa8G,cAAYvG,OAAMP,SAAO,QAAA;IAC3D,SAAS,CAAC,cAAcK,UAAQE,OAAM,SAAA;IACtC,OAAO,CAACwC,QAAO,OAAOD,QAAMvC,OAAMwC,GAAA,CAAG;IACrC,MAAM;EACT,CAAA;AACJ;ACtDD,IAAa,mBAAmB,CAACtD,IAAGC,OAAM,OAAO0B,aAAW3B,IAAGC,EAAA,CAAE;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACqBjE,IAAa6B,UAAQ,OAAO,OAAO;EAC/B,GAAG,OAAO,OAAO;IAAE,GAAG;IAAG,GAAG;EAAG,CAAA;EAC/B,GAAG,OAAO,OAAO;IAAE,GAAG;IAAG,GAAG;EAAG,CAAA;AAClC,CAAA;AACD,IAAatB,gBAAc,OAAO,OAAO;EACrC,GAAG,OAAO,OAAO;IAAE,GAAG;IAAY,GAAG;EAAY,CAAA;EACjD,GAAG,OAAO,OAAO;IAAE,GAAG;IAAY,GAAG;EAAY,CAAA;AACpD,CAAA;AAOD,IAAanB,YAAU,CAACiD,OAAMgF,SAAahF,GAAE,CAAA,KAAMgF,SAAahF,GAAE,CAAA;AAClE,IAAa3C,kBAAgB,CAAC2C,OAAMiF,cAAmBjF,GAAE,CAAA,KAAMiF,cAAmBjF,GAAE,CAAA;AAqBpF,IAAae,UAAQ,CAACvC,OAAMwC,QAAO,OAAO,OAAO;EAC7C,GAAGxC;EACH,GAAGwC,IAAGxC,MAAK,CAAA;EACX,GAAGwC,IAAGxC,MAAK,CAAA;AACd,CAAA;AAWD,IAAaiG,gBAAc,CAAC,aAAa9G,OAAM;AAC3C,MAAID;AACJ,MAAI,OAAO,WAAA,GAAc;AACrB,IAAAA,KAAI,YAAY;AAChB,IAAAC,KAAI,YAAY;EACnB,OACI;AACD,IAAAD,KAAI;AACJ,QAAIC,OAAM,OACN,OAAM,IAAI,MAAM,0BAA0B;EACjD;AACD,SAAO,KAAK,MAAMA,GAAE,IAAID,GAAE,GAAGC,GAAE,IAAID,GAAE,CAAA;AACxC;AAiBD,IAAawH,oBAAkB,CAAC1G,OAAM,OAAOjB,aAAW,OAAO,OAAO;EAClE,GAAGiB;EACH,GAAG2G,gBAAsB3G,MAAK,GAAG,OAAOjB,QAAAA;EACxC,GAAG4H,gBAAsB3G,MAAK,GAAG,OAAOjB,QAAAA;AAC3C,CAAA;AAaD,IAAawH,gBAAc,CAACvG,OAAMP,SAAO,aAAa;AAClD,QAAM,qBAAqBgB,WAAST,OAAMP,OAAAA;AAC1C,SAAO,sBAAsB;AAChC;AAaD,IAAa,QAAQ,CAAC,aAAaN,OAAM;AACrC,MAAID;AACJ,MAAI,OAAO,WAAA,GAAc;AACrB,IAAAA,KAAI,YAAY;AAChB,IAAAC,KAAI,YAAY;EACnB,OACI;AACD,IAAAD,KAAI;AACJ,QAAIC,OAAM,OACN,OAAM,IAAI,MAAM,sBAAsB;EAC7C;AACD,MAAIA,OAAM,OACN,OAAM,IAAI,UAAU,sBAAsB;MAG1C,SAAQA,GAAE,IAAID,GAAE,MAAMC,GAAE,IAAID,GAAE;AAErC;AAcD,IAAa,oBAAoB,CAACc,OAAM,WAAW;AAC/C,QAAMd,KAAIwE,cAAY,SAAS,GAAG1D,KAAA;AAClC,QAAMb,KAAIuE,cAAY,MAAM,SAAS,GAAG1D,KAAA;AACxC,SAAO;IAAE,GAAAd;IAAG,GAAAC;EAAG;AAClB;AAMD,IAAa,WAAW,CAACa,OAAMhB,OAAM;AACjC,QAAMC,KAAIe,MAAK,EAAE,KAAKhB,KAAIgB,MAAK,EAAE,KAAK,MAAMA,KAAA;AAC5C,SAAO,OAAO,OAAO;IAAK,GAAAhB;IAAG,GAAAC;EAAG,CAAA;AACnC;AAYD,IAAa,cAAc,CAACe,OAAMS,eAAa;AAC3C,QAAM,mBAAmB,OAAOT,KAAA;AAChC,SAAO,OAAO,OAAO;IACjB,GAAGA;IACH,GAAGA,MAAK;IACR,GAAG,OAAO,OAAO;MACb,GAAGA,MAAK,EAAE,KAAKA,MAAK,EAAE,IAAIA,MAAK,EAAE,KAAK,mBAAmBS;MACzD,GAAGT,MAAK,EAAE,KAAKA,MAAK,EAAE,IAAIA,MAAK,EAAE,KAAK,mBAAmBS;IAC5D,CAAA;EACJ,CAAA;AACJ;AAkBD,UAAiB,SAAST,OAAM;AAE5B,QAAM,EAAE,GAAAd,IAAG,GAAAC,GAAA,IAAMa;AACjB,MAAI,KAAK,KAAK,MAAMd,GAAE,CAAA;AACtB,MAAI,KAAK,KAAK,MAAMA,GAAE,CAAA;AACtB,QAAM,KAAK,KAAK,MAAMC,GAAE,CAAA;AACxB,QAAM,KAAK,KAAK,MAAMA,GAAE,CAAA;AACxB,QAAM,KAAK,KAAK,IAAI,KAAK,EAAA;AACzB,QAAM,KAAK,CAAC,KAAK,IAAI,KAAK,EAAA;AAC1B,QAAM,KAAK,KAAK,KAAK,IAAI;AACzB,QAAM,KAAK,KAAK,KAAK,IAAI;AAEzB,MAAI,MAAM,KAAK;AACf,SAAO,MAAM;AACT,UAAM;MAAE,GAAG;MAAI,GAAG;IAAI;AACtB,QAAI,OAAO,MAAM,OAAO,GACpB;AAEJ,UAAMyH,MAAK,IAAI;AACf,QAAIA,OAAM,IAAI;AACV,aAAO;AACP,YAAM;IACT;AACD,QAAIA,OAAM,IAAI;AACV,aAAO;AACP,YAAM;IACT;EACJ;AACJ;AAcD,IAAanG,aAAW,CAACT,OAAMP,YAAU;AACrC,MAAI,MAAM,QAAQO,KAAA,GAAO;AACrB,UAAM,YAAYA,MAAK,IAAI,CAAAwB,OAAK,mBAAmBA,IAAG/B,OAAAA,CAAM;AAC5D,WAAO,QAAQ,SAAA;EAClB,MAEG,QAAO,mBAAmBO,OAAMP,OAAAA;AAEvC;AAcD,IAAa4G,gBAAc,CAACnH,IAAGC,OAAM;AACjC,MAAI,OAAOD,EAAA,EACP,QAAO;IAACA,GAAE,EAAE;IAAGA,GAAE,EAAE;IAAGA,GAAE,EAAE;IAAGA,GAAE,EAAE;EAAE;WAE9B,QAAQA,EAAA,KAAM,QAAQC,EAAA,EAC3B,QAAO;IAACD,GAAE;IAAGA,GAAE;IAAGC,GAAE;IAAGA,GAAE;EAAE;MAG3B,OAAM,IAAI,MAAM,mDAAmD;AAE1E;AAYD,UAAiB,SAAS,OAAO;AAC7B,aAAWqC,MAAK,OAAO;AACnB,UAAMA,GAAE;AACR,UAAMA,GAAE;EACX;AACJ;AAUD,IAAa8E,gBAAc,CAACpH,IAAGC,OAAM,CAAC,IAAID,GAAE,CAAA,IAAKA,GAAE,CAAA,MAAOC,GAAE,CAAA,IAAKA,GAAE,CAAA,EAAI;AClSvE,IAAa,WAAW,CAACD,IAAGC,OAAM;AAC9B,QAAM,QAAQ,kBAAkBD,IAAGC,EAAA;AACnC,MAAI,SAAS;AACb,MAAI,SAAS;AACb,MAAI0H,SAAQ;AACZ,MAAI,aAAa,YAAY,IAAA;AAC7B,MAAI,YAAY;AAChB,QAAM,SAAS,CAACtD,KAAI,OAAO;AACvB,UAAMpF,KAAI,kBAAkBoF,KAAI,EAAA;AAChC,cAAUpF,GAAE;AACZ,cAAUA,GAAE;AACZ,IAAA0I;AACA,UAAM,oBAAoBpG,UAAStC,IAAG,KAAA;AACtC,UAAM,mBAAmBsC,UAAStC,IAAG,SAAA;AAErC,UAAM,MAAM,YAAY,IAAA;AACxB,UAAM,QAAQ,oBAAoB,MAAM;AACxC,iBAAa;AACb,gBAAYA;AACZ,WAAO,OAAO,OAAO;MACjB,OAAO,YAAYA,IAAG,KAAA;MACtB;MACA;MACA;MACA,UAAUiC,WAASjC,IAAG,KAAA;MACtB,SAAS;QACL,GAAG,SAAS0I;QACZ,GAAG,SAASA;MACf;IACJ,CAAA;EACJ;AACD,SAAO;AACV;ACFD,IAAa,eAAb,cAAkC,cAAc;EAC5C;EACA;EACA;EACA,YAAY,OAAO,CAAE,GAAE;AACnB,UAAM,IAAA;EACT;;;;;;EAMD,UAAU,SAAS;AAEf,SAAK,kBAAkB;EAC1B;;;;EAID,UAAU;AACN,UAAM,QAAA;AACN,SAAK,aAAa;AAClB,SAAK,kBAAkB;AACvB,SAAK,eAAe;EACvB;;;;;EAKD,OAAO;AACH,SAAK,eAAe,SAAS,KAAK,IAAA;EACrC;;;;;;;;;EASD,eAAe,IAAI;AACf,UAAM,cAAc,KAAK;AACzB,UAAM,eAAe,KAAK,OAAO,GAAG,EAAA;AACpC,QAAI,KAAK,oBAAoB,UAAa,KAAK,QAG3C,MAAK,kBAAkB,SAAS,KAAK,OAAA;aAEhC,KAAK,oBAAoB,OAE9B,OAAM,IAAI,MAAM,wDAAwD;AAG5E,UAAM,eAAe,iBAAiB,SAAY,SAAS,WAAA,IAAe,SAAS,YAAA;AAEnF,UAAM,aAAa,KAAK,gBAAgB,WAAA;AACxC,UAAM,UAAW,KAAK,iBAAiB,SAAa,KAAK,aAAa,WAAA,IAAe;AACrF,UAAM,QAAQ,iBAAiB,SAAY,IAAIC,OAAW,cAAc,WAAA,KAAgB,YAAY,KAAK,aAAa;AAEtH,UAAM,UAAU;MACZ,GAAG,aAAa,WAAA;MAChB;IACH;AACD,UAAMxH,KAAI;MACN,aAAa;MACb,UAAU;MACV,UAAU;MACV,QAAQ,CAAC,GAAG,KAAK,MAAO;IAC3B;AACD,SAAK,aAAaA;AAClB,WAAOA;EACV;;;;;EAKD,IAAI,OAAO;AACP,QAAI,KAAK,OAAO,WAAW,EACvB,QAAO,CAAE;AACb,WAAO,kBAAkB,GAAG,KAAK,MAAA;EACpC;;;;;EAKD,IAAI,cAAc;AACd,WAAA,cAA6B,KAAK,YAAA;EACrC;;;;;EAKD,IAAI,kBAAkB;AAClB,WAAA,kBAAiC,KAAK,YAAA;EACzC;;;;;;EAMD,IAAI,eAAe;AACf,UAAM,UAAU,KAAK;AACrB,QAAI,KAAK,OAAO,SAAS,KAAK,CAAC,QAC3B,QAAOyH;AACX,WAAO;MACH,GAAG;MACH,GAAG,KAAK;IACX;EACJ;;;;;;;;;EASD,oBAAoB;AAChB,UAAM,UAAU,KAAK;AACrB,WAAO,KAAK,OAAO,UAAU,KAAK,YAAY,SAAYtG,UAAS,SAAS,KAAK,IAAA,IAAQ;EAC5F;;;;;;;EAOD,iBAAiB;AACb,UAAMjC,KAAI,KAAK;AACf,UAAMmH,KAAI,KAAK;AACf,QAAI,OAAO,MAAMA,EAAA,EACb,QAAO;AACX,QAAInH,OAAM,EACN,QAAO;AACX,WAAO,KAAK,IAAIA,EAAA,IAAKmH;EACxB;;;;;;;EAOD,aAAa;AACT,UAAM,UAAU,KAAK;AACrB,WAAO,KAAK,OAAO,UAAU,KAAK,YAAY,SAAY,SAAS,KAAK,MAAM,OAAA,IAAWqB;EAC5F;;;;;;EAMD,iBAAiB;AACb,UAAM,UAAU,KAAK;AACrB,QAAI,YAAY,UAAa,KAAK,OAAO,SAAS,EAC9C,QAAO,YAAY,SAAS,KAAK,IAAA;EAExC;;;;;EAKD,IAAI,SAAS;AACT,QAAI,KAAK,OAAO,WAAW,EACvB,QAAO;AACX,UAAMxF,KAAI,KAAK;AACf,WAAOsF,OAAWtF,EAAA;EACrB;;;;EAID,IAAI,IAAI;AACJ,WAAO,KAAK,KAAK;EACpB;;;;EAID,IAAI,IAAI;AACJ,WAAO,KAAK,KAAK;EACpB;;;;EAID,IAAI,IAAI;AACJ,WAAO,KAAK,KAAK;EACpB;AACJ;AAKD,IAAa,gBAAb,cAAmC,gBAAgB;EAC/C,YAAY,OAAO,CAAE,GAAE;AACnB,UAAM,CAAC,KAAK,UAAU;AAClB,UAAI,UAAU,OACV,OAAM,IAAI,MAAM,sBAAsB;AAC1C,YAAMrD,KAAI,IAAI,aAAa;QACvB,GAAG;QACH,IAAI;MACP,CAAA;AACD,MAAAA,GAAE,KAAK,KAAA;AACP,aAAOA;IACV,CAAA;EACJ;EACD,IAAI,IAAI;AACJ,UAAMkD,KAAI,MAAM,IAAI,EAAA;AACpB,WAAOA;EACV;AACJ;AACD,IAAa,qBAAb,cAAwC,aAAa;;;;;;;EAOjD,UAAUlD,IAAG;AACT,QAAI,wBAAwBA,IAAG;AAC3B,YAAM,SAASA,GAAE,mBAAA;AACjB,YAAM8I,aAAW,OAAO,IAAI,CAAAC,YAAU;QAAE,GAAGA,OAAM;QAAS,GAAGA,OAAM;MAAS,EAAA;AAC5E,aAAO,KAAK,KAAK,GAAGD,UAAAA;IACvB,MAEG,QAAO,KAAK,KAAK;MAAE,GAAI9I,GAAG;MAAS,GAAIA,GAAG;IAAS,CAAA;EAE1D;AACJ;AACD,IAAa,sBAAb,cAAyC,gBAAgB;EACrD,YAAY,OAAO,CAAE,GAAE;AACnB,UAAM,CAAC,KAAK,UAAU;AAClB,UAAI,UAAU,OACV,OAAM,IAAI,MAAM,sBAAsB;AAC1C,YAAMA,KAAI,IAAI,mBAAmB;QAC7B,GAAG;QACH,IAAI;MACP,CAAA;AACD,MAAAA,GAAE,KAAK,KAAA;AACP,aAAOA;IACV,CAAA;EACJ;EACD,IAAI,IAAI;AACJ,UAAMkD,KAAI,MAAM,IAAI,EAAA;AACpB,WAAOA;EACV;;;;;EAKD,UAAU6F,QAAO;AACb,QAAI,wBAAwBA,QAAO;AAC/B,YAAM,SAASA,OAAM,mBAAA;AACrB,YAAM,QAAQ,OAAO,IAAI,CAAA,aAAY,MAAM,KAAK,SAAS,UAAU,SAAA,GAAY,QAAA,CAAS;AACxF,aAAO,QAAQ,IAAI,KAAA;IACtB,MAEG,QAAO,QAAQ,IAAI,CAAC,MAAM,KAAKA,OAAM,UAAU,SAAA,GAAYA,MAAA,CAAO,CAAA;EAEzE;AACJ;AC7TD,IAAa,kBAAkB,CAAC,UAAU,WAAW,cAAc;AAG/D,QAAMhI,KAAI,SAAS,UAAU,SAAA;AAE7B,QAAMC,KAAI,SAAS,WAAW,SAAA;AAC9B,SAAO,UAAUD,EAAA,KAAM,UAAUC,EAAA,KAAOD,GAAE,IAAIC,GAAE,IAAID,GAAE,IAAIC,GAAE,IAAID,GAAE,IAAIC,GAAE,MAAMA,GAAE,IAAIA,GAAE,IAAIA,GAAE,IAAIA,GAAE,IAAIA,GAAE,IAAIA,GAAE,MAAOD,GAAE,IAAIC,GAAE,IAAID,GAAE,IAAIC,GAAE,MAAMA,GAAE,IAAIA,GAAE,IAAIA,GAAE,IAAIA,GAAE;AACtK;ACAD,IAAa,UAAU,CAAC,QAAQsB,YAAU,UAAU;AAChD,QAAMzB,KAAI,KAAK,IAAI,KAAA,IAASyB,aAAW,OAAO;AAC9C,QAAMxB,KAAI,KAAK,IAAI,KAAA,IAASwB,aAAW,OAAO;AAC9C,SAAO;IAAE,GAAAzB;IAAG,GAAAC;EAAG;AAClB;ACbD,SAAgBkI,gBAAc7I,KAAI,MAAM,iBAAiB,MAAM;AAC3DD,UAAMC,KAAI,IAAI;AACdD,UAAM,MAAM,MAAM;AAClB,MAAI,UAAUC,GAAA,GAAK;AACf,QAAI,CAAC,UAAU,IAAA,EACX,OAAM,IAAI,UAAU,mCAAmC;AAC3D,WAAO,OAAO,OAAO;MACjB,GAAG8I,cAAoB9I,IAAG,GAAG,KAAK,GAAG,cAAA;MACrC,GAAG8I,cAAoB9I,IAAG,GAAG,KAAK,GAAG,cAAA;MACrC,GAAG8I,cAAoB9I,IAAG,GAAG,KAAK,GAAG,cAAA;IACxC,CAAA;EACJ;AACD,SAAO,OAAO,OAAO;IACjB,GAAG8I,cAAoB9I,IAAG,GAAG,KAAK,GAAG,cAAA;IACrC,GAAG8I,cAAoB9I,IAAG,GAAG,KAAK,GAAG,cAAA;EACxC,CAAA;AACJ;ACRD,IAAa0D,WAAS,CAAC,UAAU;AAC7B,MAAI,OAAO,UAAU,YACjB,SAAQ,KAAK;AACjB,SAAO,OAAO,OAAO;IACjB,GAAG,MAAA;IACH,GAAG,MAAA;EACN,CAAA;AACJ;AAiBD,IAAa,WAAW,CAAC,UAAU;AAC/B,MAAI,OAAO,UAAU,YACjB,SAAQ,KAAK;AACjB,SAAO,OAAO,OAAO;IACjB,GAAG,MAAA;IACH,GAAG,MAAA;IACH,GAAG,MAAA;EACN,CAAA;AACJ;ACnCD,IAAaqF,UAAS,CAAC,KAAK7E,KAAI,YAAY;AACxC,MAAI,YAAY,OACZ,WAAU;IAAE,GAAG;IAAG,GAAG;EAAG;AAC5B,MAAI,cAAc;AAClB,aAAWrE,MAAK,IACZ,eAAcqE,IAAGrE,IAAG,WAAA;AAGxB,SAAO;AACV;ACnBD,SAAgB,OAAOG,KAAI,cAAc,QAAQ;AAC7C,MAAI,OAAO,WAAW,YAClB,UAAS;IAAE,GAAG;IAAG,GAAG;EAAG;AAC3BD,UAAM,QAAQ,QAAQ;AACtB,cAAY,WAAW,cAAc,IAAI,cAAc,CAAC;AACxD,QAAM,aAAa,MAAM,QAAQC,GAAA;AAEjC,MAAI,iBAAiB,EACjB,QAAOA;AACX,MAAI,CAAC,WACD,CAAAA,MAAK,CAACA,GAAG;AAEb,QAAM,OAAOA;AACb,aAAW,CAAC,OAAOH,EAAA,KAAM,KAAK,QAAA,EAC1BE,SAAMF,IAAG,MAAM,KAAA,GAAQ;AAC3B,QAAM,UAAU,KAAK,IAAI,CAACA,OAAMmJ,cAAmBnJ,IAAG,MAAA,CAAO;AAC7D,QAAM,UAAU,QAAQ,IAAI,CAACA,OAAMoJ,SAAYpJ,IAAG,YAAA,CAAa;AAC/D,QAAM,eAAe,QAAQ,IAAI,CAACA,OAAMqJ,YAAiBrJ,IAAG,MAAA,CAAO;AACnE,SAAO,aAAa,eAAe,aAAa,CAAA;AACnD;ACtBD,IAAa,mBAAmB,CAACkD,IAAG,iBAAiB;AACjD,QAAM,MAAM,CACR,CAAC,KAAK,IAAI,YAAA,GAAe,CAAC,KAAK,IAAI,YAAA,CAAc,GACjD,CAAC,KAAK,IAAI,YAAA,GAAe,KAAK,IAAI,YAAA,CAAc,CACnD;AACD,QAAM,SAAS,CAAE;AACjB,aAAW,CAAC,OAAO,OAAA,KAAYA,GAAE,QAAA,EAC7B,QAAO,KAAA,IAAS,CACZ,IAAI,CAAA,EAAG,CAAA,IAAK,QAAQ,CAAA,IAAK,IAAI,CAAA,EAAG,CAAA,IAAK,QAAQ,CAAA,GAC7C,IAAI,CAAA,EAAG,CAAA,IAAK,QAAQ,CAAA,IAAK,IAAI,CAAA,EAAG,CAAA,IAAK,QAAQ,CAAA,CAChD;AAEL,SAAO;AACV;ACLD,IAAaoG,UAAQ,CAAC,OAAO,WAAW,WAAW;AAC/C,QAAMnJ,MAAK,kBAAkB,OAAO,SAAA;AACpC,WAAS,UAAU;AACnB,WAAS,UAAU;AACnB,SAAO,OAAO,OAAO;IACjB,GAAGA;IACH,GAAGoJ,OAAY,QAAQpJ,IAAG,CAAA;IAC1B,GAAGoJ,OAAY,QAAQpJ,IAAG,CAAA;EAC7B,CAAA;AACJ;ACGD,IAAa,cAAc,CAACY,IAAGC,IAAG,aAAa;AAC3Cd,UAAMa,IAAG,GAAG;AACZb,UAAMc,IAAG,GAAG;AACZ,MAAI,OAAO,aAAa,UAAU;AAC9B,gBAAY,WAAW,UAAU,YAAY,UAAU,CAAC;AACxD,eAAW;MAAE,GAAG;MAAU,GAAG;IAAU;EAC1C,MAEGd,SAAM,UAAU,UAAU;AAE9B,QAAMW,KAAI,KAAK,IAAIG,GAAE,IAAID,GAAE,CAAA;AAC3B,QAAMD,KAAI,KAAK,IAAIE,GAAE,IAAID,GAAE,CAAA;AAC3B,SAAOF,MAAK,SAAS,KAAKC,MAAK,SAAS;AAC3C;ACZD,IAAagF,SAAO,CAAC3F,KAAI,OAAO,UAAU;AACtC,MAAI,UAAU,OACV,SAAQ;IAAE,GAAG;IAAG,GAAG;EAAG;AAC1B,MAAI,UAAU,OACV,SAAQ;IAAE,GAAG;IAAG,GAAG;EAAG;AAE1BD,UAAMC,KAAI,IAAI;AACdD,UAAM,OAAO,OAAO;AACpBA,UAAM,OAAO,OAAO;AACpB,SAAO,OAAO,OAAO;IACjB,GAAGsJ,MAAWrJ,IAAG,GAAG,MAAM,GAAG,MAAM,CAAA;IACnC,GAAGqJ,MAAWrJ,IAAG,GAAG,MAAM,GAAG,MAAM,CAAA;EACtC,CAAA;AACJ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AEvBD,IAAa,QAAQ,CAACH,OAAM,OAAOA,GAAE,gBAAgB,eAAe,OAAOA,GAAE,cAAc,eAAe,OAAOA,GAAE,cAAc;AAMjI,IAAa,eAAe,CAACA,OAAM,OAAOA,GAAE,MAAM,eAAe,OAAOA,GAAE,MAAM;AAUhF,SAAgByJ,cAAY,QAAQ,cAAc,YAAY,WAAW,QAAQ;AAC7E,QAAM1I,KAAI;IACN;IACA,aAAa,eAAe,YAAA;IAC5B,WAAW,eAAe,UAAA;IAC1B;EACH;AACD,MAAI,QAAQ,MAAA,GAAS;AACjBW,YAAW,MAAA;AACX,UAAM,KAAK;MACP,GAAGX;MACH,GAAG,OAAO;MACV,GAAG,OAAO;IACb;AACD,WAAO,OAAO,OAAO,EAAA;EACxB,MAEG,QAAO,OAAO,OAAOA,EAAA;AAE5B;AAOD,IAAa,SAAS,CAAC2I,SAAQC,aAAgB,MAAMD,MAAKA,KAAI,WAAA,GAAc,MAAMA,MAAKA,KAAI,SAAA,CAAU;AAYrG,IAAa,cAAc,CAACA,MAAK,WAAW;AACxCxJ,UAAMwJ,IAAA;AACN,QAAM,QAAQ,MAAMA,MAAKA,KAAI,aAAa,MAAA;AAC1C,QAAM,MAAM,MAAMA,MAAKA,KAAI,WAAW,MAAA;AACtC,SAAO,CAAC,OAAO,GAAI;AACtB;AAaD,IAAa,QAAQ,CAACA,MAAK5B,eAAa,WAAW;AAC/C,MAAI,OAAO,WAAW,YAClB,UAAS,aAAa4B,IAAA,IAAOA,OAAM;IAAE,GAAG;IAAG,GAAG;EAAG;AAErD,SAAO;IACH,GAAI,KAAK,IAAI5B,aAAAA,IAAe4B,KAAI,SAAU,OAAO;IACjD,GAAI,KAAK,IAAI5B,aAAAA,IAAe4B,KAAI,SAAU,OAAO;EACpD;AACJ;AAKD,IAAaxJ,UAAQ,CAACwJ,SAAQ;AAC1B,MAAI,OAAOA,SAAQ,YACf,OAAM,IAAI,UAAU,kBAAkB;AAC1C,MAAI,aAAaA,IAAA,EACbhI,SAAWgI,MAAK,KAAK;AAEzB,MAAI,OAAOA,KAAI,WAAW,YACtB,OAAM,IAAI,UAAU,4BAA4B,KAAK,UAAUA,IAAA,CAAI,GAAG;AAC1E,MAAI,OAAOA,KAAI,WAAW,SACtB,OAAM,IAAI,UAAU,yBAAyB;AACjD,MAAI,OAAO,MAAMA,KAAI,MAAA,EACjB,OAAM,IAAI,UAAU,eAAe;AACvC,MAAIA,KAAI,UAAU,EACd,OAAM,IAAI,UAAU,kCAAkC;AAC1D,MAAI,OAAOA,KAAI,gBAAgB,YAC3B,OAAM,IAAI,UAAU,oCAAoC;AAC5D,MAAI,OAAOA,KAAI,cAAc,YACzB,OAAM,IAAI,UAAU,oCAAoC;AAC5D,MAAI,OAAO,MAAMA,KAAI,SAAA,EACjB,OAAM,IAAI,UAAU,sBAAsB;AAC9C,MAAI,OAAO,MAAMA,KAAI,WAAA,EACjB,OAAM,IAAI,UAAU,sBAAsB;AAC9C,MAAI,OAAOA,KAAI,cAAc,YACzB,OAAM,IAAI,UAAU,iCAAiC;AACzD,MAAIA,KAAI,eAAeA,KAAI,UACvB,OAAM,IAAI,UAAU,kDAAkD;AAC7E;AAaD,IAAanE,gBAAc,CAAC,QAAQmE,MAAK,eAAe,WAAW;AAC/DxJ,UAAMwJ,IAAA;AACN,QAAM,aAAa,iBAAiB;AACpC,MAAI,CAAC,YAAY;AACb,QAAI,SAAS,EACT,OAAM,IAAI,MAAM,2DAA2D;AAC/E,QAAI,SAAS,EACT,OAAM,IAAI,MAAM,uDAAuD;EAC9E;AACD,QAAM,OAAO,YAAYA,IAAA;AACzB,QAAM,MAAM,OAAO;AACnB,QAAM,QAAQ,WAAWA,KAAI,aAAa,KAAKA,KAAI,SAAA;AAEnD,SAAO,MAAMA,MAAK,OAAO,MAAA;AAE5B;AAMD,IAAa,cAAc,CAACA,SAAQ,UAAUA,KAAI,aAAaA,KAAI,WAAWA,KAAI,SAAA;AAMlF,IAAaE,WAAS,CAACF,SAAQ;AAC3BxJ,UAAMwJ,IAAA;AACN,SAAO,OAAO,OAAO;IACjB,GAAGA;IACH,SAAS,CAAC,WAAW;AAAE,YAAM,IAAI,MAAM,iBAAiB;IAAI;IAC5D,aAAa,CAAC,WAAWnE,cAAY,QAAQmE,IAAA;IAC7C,MAAM,MAAMlF,OAAKkF,IAAA;IACjB,QAAQ,MAAM9D,SAAO8D,IAAA;IACrB,aAAa,MAAMG,QAAMH,IAAA;IACzB,kBAAkB,CAAC,QAAQ,2BAA2B;AAClD,YAAM,IAAI,MAAM,iBAAiB;IACpC;IACD,iBAAiB,CAAC,WAAW;AACzB,YAAM,IAAI,MAAM,iBAAiB;IACpC;IACD,MAAM;EACT,CAAA;AACJ;AAUD,IAAa,aAAa,CAACjI,SAAQ,aAAa,WAAW,YAAY,SAAS;AAC5E,QAAMV,KAAI,OAAO,OAAO;IACpB,GAAGU;IACH;IACA;IACA;EACH,CAAA;AACD,SAAOV;AACV;AAUD,IAAa,mBAAmB,CAACU,SAAQ,aAAa,YAAY,YAAY,SAAS;AACnF,QAAM,YAAY,WAAW,aAAa,YAAY,SAAA;AACtD,SAAO,WAAWA,SAAQ,aAAa,SAAA;AAC1C;AAMD,IAAamE,WAAS,CAAC8D,SAAQxF,QAAOwF,KAAI,WAAWA,KAAI,cAAcA,KAAI,aAAaxF;AAMxF,IAAaM,SAAO,CAACkF,SAAQ;AACzB,MAAI,aAAaA,IAAA,GAAM;AACnB,UAAM,SAASnE,cAAY,KAAKmE,IAAA;AAChC,UAAM,SAAS,OAAOA,IAAA;AACtB,WAAOI,OAAW,QAAQ,OAAO,GAAG,OAAO,CAAA;EAC9C,MAEG,QAAO;IACH,OAAOJ,KAAI,SAAS;IACpB,QAAQA,KAAI,SAAS;EACxB;AAER;AAMD,IAAaG,UAAQ,CAAC9I,IAAGC,IAAGC,IAAGZ,IAAG0J,OAAM;AACpC,MAAI,MAAMhJ,EAAA,EACN,KAAI,aAAaA,EAAA,EACb,KAAI,QAAQC,EAAA,EAER,QAAOgJ,YAAUhJ,IAAGD,GAAE,QAAQA,GAAE,aAAaA,GAAE,WAAWE,EAAA;MAI1D,QAAO+I,YAAUjJ,IAAGA,GAAE,QAAQA,GAAE,aAAaA,GAAE,WAAWC,EAAA;MAI9D,QAAO,QAAQA,EAAA,IAAKgJ,YAAUhJ,IAAGD,GAAE,QAAQA,GAAE,aAAaA,GAAE,WAAWE,EAAA,IAAK+I,YAAU;IAAE,GAAG;IAAG,GAAG;EAAG,GAAEjJ,GAAE,QAAQA,GAAE,aAAaA,GAAE,SAAA;OAGpI;AACD,QAAIE,OAAM,OACN,OAAM,IAAI,MAAM,sBAAsB;AAC1C,QAAIZ,OAAM,OACN,OAAM,IAAI,MAAM,oBAAoB;AACxC,QAAI,QAAQU,EAAA,EACR,KAAI,OAAOC,OAAM,YAAY,OAAOC,OAAM,YAAY,OAAOZ,OAAM,SAC/D,QAAO2J,YAAUjJ,IAAGC,IAAGC,IAAGZ,IAAG0J,EAAA;QAG7B,OAAM,IAAI,UAAU,mEAAmE;QAI3F,OAAM,IAAI,MAAM,gEAAgE;EAEvF;AACJ;AACD,IAAMC,cAAY,CAAC,QAAQ,QAAQ,aAAa,WAAW,SAAS;AAIhE,MAAI,SAAS,UAAa,OAAO,SAAS,SACtC,QAAO,CAAE;AACb,QAAM,eAAe,YAAY,gBAAgB;AACjD,QAAM,QAAQ,YAAY,QAAQ,YAAY,MAAM,MAAA;AACpD,QAAM,MAAM,YAAY,QAAQ,aAAa,MAAA;AAC7C,QAAM,EAAE,WAAW,OAAO,QAAQ,MAAA,IAAU;AAC5C,QAAM3J,KAAI,CAAC;QACP,MAAM,CAAA,IAAK,MAAM,CAAA;QACjB,MAAA,IAAU,MAAA,MAAY,WAAW,MAAM,GAAG,IAAI,QAAQ,MAAM,GAAG,IAAI,IAAI,CAAA,IAAK,IAAI,CAAA;GACpF;AACA,MAAI,aACA,CAAAA,GAAE,KAAK,GAAG;AACd,SAAOA;AACV;AAOD,IAAa4J,mBAAiB,CAAClJ,IAAGC,OAAM+D,UAAehE,IAAGC,EAAA;AAc1D,IAAaW,YAAU,CAACZ,IAAGC,OAAM;AAC7B,MAAID,GAAE,WAAWC,GAAE,OACf,QAAO;AACX,MAAID,GAAE,cAAcC,GAAE,UAClB,QAAO;AACX,MAAID,GAAE,gBAAgBC,GAAE,YACpB,QAAO;AACX,MAAID,GAAE,cAAcC,GAAE,UAClB,QAAO;AACX,MAAI,aAAaD,EAAA,KAAM,aAAaC,EAAA,GAAI;AACpC,QAAID,GAAE,MAAMC,GAAE,EACV,QAAO;AACX,QAAID,GAAE,MAAMC,GAAE,EACV,QAAO;AACX,QAAID,GAAE,MAAMC,GAAE,EACV,QAAO;EACd,WACQ,CAAC,aAAaD,EAAA,KAAM,CAAC,aAAaC,EAAA,GAAI;EAE9C,MAEG,QAAO;AACX,SAAO;AACV;AChVD,IAAa,oBAAoB,CAACkJ,UAASA,MAAK,cAAc;AAC9D,IAAa,gBAAgB,CAACA,UAASA,MAAK,WAAW,UAAaA,MAAK,WAAW;;;;;;;;;;;;ACwBpF,IAAa,kBAAkB,CAAC,OAAO,KAAK,OAAO,MAAM;AACrD,MAAI,OAAO,MAAM,IAAA,EACb,OAAM,IAAI,MAAM,aAAa;AACjC,MAAI,OAAO,MAAM,OAAO,EACpB,OAAM,IAAI,MAAM,+BAA+B;AACnD,QAAM,SAASC,cAAiB,KAAK,OAAO,GAAA;AAC5C,MAAI,SAAS;AACb,MAAI,IAAI,IAAI,MAAM,EAEd,UAAS,OAAO,IAAI;IAAE,GAAG,KAAK,IAAI,MAAM,GAAG,IAAI,CAAA;IAAI,GAAG,KAAK,IAAI,MAAM,GAAG,IAAI,CAAA;EAAI,IAC5E;IAAE,GAAG,KAAK,IAAI,MAAM,GAAG,IAAI,CAAA;IAAI,GAAG,KAAK,IAAI,MAAM,GAAG,IAAI,CAAA;EAAI;MAIhE,UAAS,OAAO,IAAI;IAAE,GAAG,KAAK,IAAI,MAAM,GAAG,IAAI,CAAA;IAAI,GAAG,KAAK,IAAI,MAAM,GAAG,IAAI,CAAA;EAAI,IAC5E;IAAE,GAAG,KAAK,IAAI,MAAM,GAAG,IAAI,CAAA;IAAI,GAAG,KAAK,IAAI,MAAM,GAAG,IAAI,CAAA;EAAI;AAEpE,QAAM,SAASA,cAAiB,KAAK,IAAI,IAAA,GAAO,QAAQ,MAAA;AACxD,SAAO,UAAU,OAAO,KAAK,MAAA;AAChC;AAyBD,IAAa,eAAe,CAACrF,OAAM;AAI/B,QAAM,MAAM,cAAcA,EAAA,IACtB,IAAIsF,OAActF,GAAE,EAAE,GAAGA,GAAE,EAAE,GAAGA,GAAE,OAAO,GAAGA,GAAE,OAAO,GAAGA,GAAE,OAAO,GAAGA,GAAE,OAAO,GAAGA,GAAE,EAAE,GAAGA,GAAE,EAAE,CAAA,IAC3F,IAAIsF,OAActF,GAAE,GAAGA,GAAE,WAAWA,GAAE,CAAA;AAC1C,SAAO,CAAC,WAAW,IAAI,QAAQ,MAAA;AAClC;AAED,IAAa,uBAAuB,CAAC,OAAO,KAAK,WAAW,CAAC,KAAK,MAAM,CAAA,IAAK,MAAM,CAAA,MAAO,OAAO,CAAA,IAAK,OAAO,CAAA,IAAK,IAAI,CAAA,IAAK,IAAI,CAAA,EAAI;AACnI,IAAa8E,WAAS,CAAC,qBAAqB;AACxC,MAAI,cAAc,gBAAA,EACd,QAAO,YAAY,gBAAA;WAEd,kBAAkB,gBAAA,EACvB,QAAO,gBAAgB,gBAAA;MAGvB,OAAM,IAAI,MAAM,qBAAqB;AAE5C;AACD,IAAa,QAAQ,CAAC,OAAO,KAAK,QAAQS,aAAY;EAClD,GAAG,OAAO,OAAO,KAAA;EACjB,GAAG,OAAO,OAAO,GAAA;EACjB,QAAQ,OAAO,OAAO,MAAA;EACtB,QAAQ,OAAO,OAAOA,OAAA;AACzB;AACD,IAAM,cAAc,CAACC,YAAU;AAC3B,QAAM,EAAE,GAAAvJ,IAAG,QAAQ,QAAAsJ,SAAQ,GAAArJ,GAAA,IAAMsJ;AACjC,QAAM,MAAM,IAAIF,OAAcrJ,IAAG,QAAQsJ,SAAQrJ,EAAA;AACjD,SAAO,OAAO,OAAO;IACjB,GAAGsJ;IACH,QAAQ,MAAM,IAAI,OAAA;IAClB,aAAa,CAAC9C,OAAM,IAAI,QAAQA,EAAA;IAChC,SAAS,CAAC+C,OAAM;AAAE,YAAM,IAAI,MAAM,iBAAiB;IAAI;IACvD,MAAM,MAAM;AACR,YAAM,EAAE,GAAA1J,IAAG,GAAAC,GAAA,IAAM,IAAI,KAAA;AACrB,YAAM,QAAQD,GAAE;AAChB,YAAM,QAAQC,GAAE;AAChB,UAAI,UAAU,OACV,OAAM,IAAI,MAAM,uCAAuC;AAC3D,UAAI,UAAU,OACV,OAAM,IAAI,MAAM,uCAAuC;AAC3D,aAAO0J,YAAiB;QAAE,GAAG3J,GAAE;QAAK,GAAGC,GAAE;MAAK,GAAE,OAAO,KAAA;IAC1D;IACD,kBAAkB,CAAC,QAAQ,2BAA2B;AAClD,YAAM,IAAI,MAAM,iBAAiB;IACpC;IACD,iBAAiB,CAAC,WAAW;AACzB,YAAM,IAAI,MAAM,iBAAiB;IACpC;IACD,aAAa,MAAM,CAAC,OAAQ;IAC5B,MAAM;EACT,CAAA;AACJ;AACD,IAAa,YAAY,CAAC,OAAO,KAAK,YAAY;EAC9C,GAAG,OAAO,OAAO,KAAA;EACjB,GAAG,OAAO,OAAO,GAAA;EACjB,WAAW,OAAO,OAAO,MAAA;AAC5B;AACD,IAAM,kBAAkB,CAAC2J,qBAAoB;AACzC,QAAM,EAAE,GAAA1J,IAAG,GAAAC,IAAG,WAAA,YAAA,IAAcyJ;AAC5B,QAAM,MAAM,IAAIL,OAAcrJ,IAAG2J,aAAW1J,EAAA;AAC5C,SAAO,OAAO,OAAO;IACjB,GAAGyJ;IACH,QAAQ,MAAM,IAAI,OAAA;IAClB,aAAa,CAACjD,OAAM,IAAI,QAAQA,EAAA;IAChC,SAAS,CAAC+C,OAAM;AAAE,YAAM,IAAI,MAAM,iBAAiB;IAAI;IACvD,MAAM,MAAM;AACR,YAAM,EAAE,GAAA1J,IAAG,GAAAC,GAAA,IAAM,IAAI,KAAA;AACrB,YAAM,QAAQD,GAAE;AAChB,YAAM,QAAQC,GAAE;AAChB,UAAI,UAAU,OACV,OAAM,IAAI,MAAM,uCAAuC;AAC3D,UAAI,UAAU,OACV,OAAM,IAAI,MAAM,uCAAuC;AAC3D,aAAO0J,YAAiB;QAAE,GAAG3J,GAAE;QAAK,GAAGC,GAAE;MAAK,GAAE,OAAO,KAAA;IAC1D;IACD,iBAAiB,CAAC,WAAW;AACzB,YAAM,IAAI,MAAM,iBAAiB;IACpC;IACD,kBAAkB,CAAC,QAAQ,2BAA2B;AAClD,YAAM,IAAI,MAAM,iBAAiB;IACpC;IACD,UAAU,MAAM,IAAI,SAAA;IACpB,aAAa,MAAM,qBAAqBC,IAAGC,IAAG0J,WAAAA;IAC9C,MAAM;EACT,CAAA;AACJ;ACxJD,IAAa/J,SAAO,CAACc,YAAW;AAC5BvB,UAAMuB,OAAA;AACN,SAAO,KAAK,KAAKA,QAAO,SAASA,QAAO;AAC3C;ACFD,IAAa+C,SAAO,CAAC/C,YAAW;AAC5B,SAAO,mBAAmBA,OAAA,IACtBkJ,aAAgBlJ,SAAQA,QAAO,SAAS,GAAGA,QAAO,SAAS,CAAA,IAC3D;IAAE,OAAOA,QAAO,SAAS;IAAG,QAAQA,QAAO,SAAS;IAAG,GAAG;IAAG,GAAG;EAAG;AAC1E;ACOD,IAAa,SAAS,CAACA,YAAW;AAC9B,SAAO,mBAAmBA,OAAA,IAAU,OAAO,OAAO;IAAE,GAAGA,QAAO;IAAG,GAAGA,QAAO;EAAG,CAAA,IAAI,OAAO,OAAO;IAAE,GAAGA,QAAO;IAAQ,GAAGA,QAAO;EAAQ,CAAA;AACzI;ACND,UAAiB,sBAAsBA,SAAQ;AAC3C,QAAM,EAAE,GAAAZ,IAAG,GAAAC,IAAG,OAAA,IAAWW;AACzB,MAAI,KAAK;AACT,MAAI,KAAK;AACT,MAAI,cAAc,IAAIZ;AACtB,SAAO,MAAM,IAAI;AACb,UAAM;MAAE,GAAG,KAAKA;MAAG,GAAG,KAAKC;IAAG;AAC9B,UAAM;MAAE,GAAG,KAAKD;MAAG,GAAG,KAAKC;IAAG;AAC9B,UAAM;MAAE,GAAG,CAAC,KAAKD;MAAG,GAAG,KAAKC;IAAG;AAC/B,UAAM;MAAE,GAAG,CAAC,KAAKD;MAAG,GAAG,KAAKC;IAAG;AAC/B,UAAM;MAAE,GAAG,CAAC,KAAKD;MAAG,GAAG,CAAC,KAAKC;IAAG;AAChC,UAAM;MAAE,GAAG,CAAC,KAAKD;MAAG,GAAG,CAAC,KAAKC;IAAG;AAChC,UAAM;MAAE,GAAG,KAAKD;MAAG,GAAG,CAAC,KAAKC;IAAG;AAC/B,UAAM;MAAE,GAAG,KAAKD;MAAG,GAAG,CAAC,KAAKC;IAAG;AAC/B;AACA,QAAI,cAAc,EACd,gBAAe,IAAI,KAAK;SAEvB;AACD;AACA,qBAAe,KAAK,KAAK,KAAK;IACjC;EACJ;AACJ;ACzBD,UAAiB,sBAAsBW,SAAQ;AAC3C,QAAM,OAAOA,QAAO,IAAIA,QAAO;AAC/B,QAAM,OAAOA,QAAO,IAAIA,QAAO;AAC/B,QAAM,OAAOA,QAAO,IAAIA,QAAO;AAC/B,QAAM,OAAOA,QAAO,IAAIA,QAAO;AAC/B,WAASZ,KAAI,MAAMA,KAAI,MAAMA,KACzB,UAASC,KAAI,MAAMA,KAAI,MAAMA,MAAK;AAC9B,UAAMK,KAAI,KAAK,IAAImB,UAASb,SAAQZ,IAAGC,EAAA,CAAE;AACzC,QAAIK,MAAKM,QAAO,OACZ,OAAM;MAAE,GAAAZ;MAAG,GAAAC;IAAG;EACrB;AAER;ACrBD,IAAMoD,SAAO,KAAK,KAAK;AAavB,IAAa,UAAU,CAACzC,SAAQH,YAAU;AACtC,QAAM+F,KAAI,CAACtG,OAAM;AACb,UAAMsC,KAAI,KAAK,KAAK,KAAK,IAAI/B,QAAM,IAAIP,GAAE,GAAG,CAAA,IAAK,KAAK,IAAIO,QAAM,IAAIP,GAAE,GAAG,CAAA,CAAE;AAC3E,UAAMF,KAAIE,GAAE,IAAKA,GAAE,WAAWO,QAAM,IAAIP,GAAE,KAAKsC;AAC/C,UAAMvC,KAAIC,GAAE,IAAKA,GAAE,WAAWO,QAAM,IAAIP,GAAE,KAAKsC;AAC/C,WAAO;MAAE,GAAAxC;MAAG,GAAAC;IAAG;EAClB;AACD,MAAI,MAAM,QAAQW,OAAA,GAAS;AACvB,UAAM,MAAMA,QAAO,IAAI,CAAA4B,OAAKgE,GAAEhE,EAAA,CAAE;AAChC,UAAM,QAAQ,IAAI,IAAI,CAAArD,OAAKwC,UAAexC,IAAGsB,OAAAA,CAAM;AACnD,WAAO,OAAO,OAAO,IAAI,SAAS,GAAG,KAAA,CAAM,CAAA;EAC9C,MAEG,QAAO,OAAO,OAAO+F,GAAE5F,OAAA,CAAO;AAErC;AAoBD,IAAa,mBAAmB,CAACA,SAAQqG,eAAa,WAAW;AAC7D,MAAI,WAAW,OACX,UAAS,mBAAmBrG,OAAA,IAAUA,UAAS;IAAE,GAAG;IAAG,GAAG;EAAG;AAEjE,SAAO;IACH,GAAI,KAAK,IAAI,CAACqG,aAAAA,IAAerG,QAAO,SAAU,OAAO;IACrD,GAAI,KAAK,IAAI,CAACqG,aAAAA,IAAerG,QAAO,SAAU,OAAO;EACxD;AACJ;AAMD,IAAa,gBAAgB,CAACA,YAAW;AACrCvB,UAAMuB,OAAA;AACN,SAAOyC,SAAOzC,QAAO;AACxB;AAMD,IAAamE,WAAS,CAACnE,YAAW,cAAcA,OAAA;ACzEhD,IAAMyC,SAAO,KAAK,KAAK;AAevB,IAAaqB,gBAAc,CAAC9D,SAAQ+F,OAAM,iBAAiB/F,SAAQ+F,KAAItD,MAAAA;ACKvE,IAAa,gBAAgB,CAACnD,IAAGC,IAAGC,OAAM;AACtC,QAAMZ,KAAI,eAAeU,IAAGC,EAAA;AAC5B,MAAI,SAASA,EAAA,EACT,QAAQX,KAAI,KAAK,IAAIU,GAAE,SAASC,GAAE,MAAA;WAE7B,QAAQA,EAAA,EAEb,KAAIC,OAAM,OACN,QAAOZ,MAAKU,GAAE;MAId,QAAQV,KAAI,KAAK,IAAIU,GAAE,SAASE,EAAA;MAIpC,OAAM,IAAI,MAAM,yDAAyD;AAChF;ACtBD,IAAa,iBAAiB,CAACF,IAAGC,IAAGC,OAAM;AACvC,MAAIgC,SAAclC,IAAGC,EAAA,EACjB,QAAO;AACX,MAAI,cAAcD,IAAGC,IAAGC,EAAA,EACpB,QAAO;AACX,MAAI,SAASD,EAAA,EACT,QAAA,aAA+BD,IAAGC,EAAA;WAE7B,iBAAiBA,EAAA,EACtB,QAAA,WAA6BD,IAAGC,EAAA;WAE3B,QAAQA,EAAA,KAAMC,OAAM,OACzB,QAAA,aAA+BF,IAAG;IAAE,GAAGC;IAAG,QAAQC;EAAG,CAAA;AAEzD,SAAO;AACV;AClBD,SAAgByC,iBAAe3C,IAAG6C,QAAO;AACrC,MAAI,mBAAmB7C,EAAA,GAAI;AACvB,UAAMZ,MAAKyK,eAAqB7J,IAAG6C,MAAA;AACnC,WAAO,OAAO,OAAO;MACjB,GAAG7C;MACH,GAAGZ;MACH,QAAQY,GAAE,SAAS6C;IACtB,CAAA;EACJ,MAEG,QAAO,OAAO,OAAO;IACjB,GAAG7C;IACH,QAAQA,GAAE,SAAS6C;EACtB,CAAA;AAER;ACzBD,IAAMM,SAAO,KAAK,KAAK;AAqBvB,IAAaJ,gBAAc,CAAC,QAAQ,OAAO,CAAE,MAAK;AAC9C,QAAM+G,WAAS,mBAAmB,MAAA,IAAU,SAAS;IAAE,GAAG;IAAG,GAAG;EAAG;AACnE,QAAM,WAAW,KAAK,YAAY;AAClC,QAAM,SAAS,KAAK,UAAU;AAC9B,QAAM,SAAS,OAAO,SAAS;AAC/B,QAAM,OAAO,KAAK,gBAAgB,KAAK;AACvC,UAAQ,UAAR;IACI,KAAK;AACD,aAAO1I,KAAU0I,UAAQxB,YAAiB,KAAA,IAAS,QAAQ,KAAA,IAASnF,MAAAA,CAAK;IAE7E,KAAK;AACD,aAAO/B,KAAU0I,UAAQxB,YAAiB,KAAK,KAAK,KAAA,CAAM,IAAI,QAAQ,KAAA,IAASnF,MAAAA,CAAK;IAExF;AACI,YAAM,IAAI,MAAM,qBAAqB,QAAA,iCAAyC;EAErF;AACJ;ACjCD,IAAa,QAAQ,CAACnD,IAAG,OAAO,WAAW;AACvC,MAAI,SAASA,EAAA,GAAI;AACb,QAAI,WAAW,OACX,QAAO,UAAUA,GAAE,QAAQ,QAAQ,KAAA;AAEvC,QAAI,mBAAmBA,EAAA,EACnB,QAAO,UAAUA,GAAE,QAAQA,IAAG,KAAA;QAG9B,OAAM,IAAI,MAAM,mDAAmD;EAC1E,WAEO,WAAW,OACX,OAAM,IAAI,MAAM,yBAAyB;MAGzC,QAAO,UAAUA,IAAG,QAAQ,KAAA;AAGvC;AACD,IAAM,YAAY,CAAC,QAAQ,QAAQ,UAAU;AAEzC,QAAM,EAAE,GAAAF,IAAG,GAAAC,GAAA,IAAM;AACjB,QAAMiF,KAAI,QAAQ,MAAM;AACxB,SAAO;QACHlF,EAAA,KAAMC,EAAA;SACL,MAAA;QACD,MAAA,IAAU,MAAA,QAAciF,EAAA,IAAK,SAAS,CAAA;QACtC,MAAA,IAAU,MAAA,QAAcA,EAAA,KAAM,SAAS,CAAA;IAC3C,MAAM;CAAI;AACb;AC1BD,IAAa6D,WAAS,CAACnI,YAAW;AAC9BvB,UAAMuB,OAAA;AACN,SAAO;IACH,GAAGA;IACH,SAAS,CAACH,YAAU,QAAQG,SAAQH,OAAAA;IAMpC,aAAa,CAACkG,OAAMjC,cAAY9D,SAAQ+F,EAAA;IACxC,MAAM,MAAMhD,OAAK/C,OAAA;IACjB,QAAQ,MAAM,cAAcA,OAAA;IAC5B,aAAa,CAAC,QAAQ,SAAS,MAAMA,SAAQ,KAAA;IAC7C,kBAAkB,CAAC,QAAQ,2BAA2B;AAClD,YAAM,IAAI,MAAM,iBAAiB;IACpC;IACD,iBAAiB,CAAC,WAAW;AACzB,YAAM,IAAI,MAAM,iBAAiB;IACpC;IACD,MAAM;EACT;AACJ;ACvBD,IAAa,eAAe,CAACA,SAAQ,oBAAoBX,OAAM;AAC3D,MAAI,mBAAmBW,OAAA,EACnB,QAAOA;AAEX,QAAMtB,MAAK,kBAAkB,oBAAoBW,EAAA;AACjD,SAAO,OAAO,OAAO;IACjB,GAAGW;IACH,GAAGtB;EACN,CAAA;AACJ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AEbD,IAAa,SAAS,CAAC2K,OAAM,SAAS;AAClC,MAAI,KAAK,IAAI,KAAK,KAAK,IAAI,EACvB,QAAO;AACX,MAAI,KAAK,KAAKA,MAAK,QAAQ,KAAK,KAAKA,MAAK,KACtC,QAAO;AACX,SAAO;AACV;ACLD,IAAa,SAAS,CAAC,SAAS;AAC5B,MAAI,SAAS,OACT,QAAO;AACX,SAAO,OAAO,QAAQ,OAAO;AAChC;AAQD,IAAa,YAAY,CAAC,MAAM,gBAAgB,SAASA,UAAS;AAC9D,MAAI,SAAS,OACT,OAAM,IAAI,MAAM,gBAAgB,gCAAgC;AAEpE,MAAI,KAAK,MAAM,OACX,OAAM,IAAI,MAAM,gBAAgB,iBAAiB;AACrD,MAAI,KAAK,MAAM,OACX,OAAM,IAAI,MAAM,gBAAgB,iBAAiB;AACrD,MAAI,OAAO,MAAM,KAAK,CAAA,EAClB,OAAM,IAAI,MAAM,gBAAgB,WAAW;AAC/C,MAAI,OAAO,MAAM,KAAK,CAAA,EAClB,OAAM,IAAI,MAAM,gBAAgB,WAAW;AAC/C,MAAI,CAAC,OAAO,UAAU,KAAK,CAAA,EACvB,OAAM,IAAI,UAAU,gBAAgB,mBAAmB;AAE3D,MAAI,CAAC,OAAO,UAAU,KAAK,CAAA,EACvB,OAAM,IAAI,UAAU,gBAAgB,mBAAmB;AAE3D,MAAIA,UAAS,UAAa,CAAC,OAAOA,OAAM,IAAA,EACpC,OAAM,IAAI,MAAM,GAAG,aAAA,8BAA2C,KAAK,CAAA,IAAK,KAAK,CAAA,UAAWA,MAAK,IAAA,KAASA,MAAK,IAAA,EAAM;AAExH;AAMD,IAAa,YAAY,CAACA,OAAM,gBAAgB,YAAY;AACxD,MAAIA,UAAS,OACT,OAAM,IAAI,MAAM,GAAG,aAAA,gCAA6C;AAEpE,MAAI,EAAE,UAAUA,OACZ,OAAM,IAAI,MAAM,GAAG,aAAA,oBAAiC;AACxD,MAAI,EAAE,UAAUA,OACZ,OAAM,IAAI,MAAM,GAAG,aAAA,oBAAiC;AACxD,MAAI,CAAC,OAAO,UAAUA,MAAK,IAAA,EACvB,OAAM,IAAI,UAAU,GAAG,aAAA,yBAAsC;AAEjE,MAAI,CAAC,OAAO,UAAUA,MAAK,IAAA,EACvB,OAAM,IAAI,UAAU,GAAG,aAAA,yBAAsC;AAEpE;ACnDD,IAAa,cAAc,SAAUA,OAAM,MAAMhF,SAAO,aAAa;AACjE,YAAUgF,OAAM,MAAM;AACtB,YAAU,MAAM,MAAM;AACtB,MAAIjK,KAAI,KAAK;AACb,MAAIC,KAAI,KAAK;AACb,UAAQgF,QAAR;IACI,KAAK,QAAQ;AACT,MAAAjF,KAAIA,KAAIiK,MAAK;AACb,MAAAhK,KAAIA,KAAIgK,MAAK;AACb,UAAIjK,KAAI,EACJ,CAAAA,KAAIiK,MAAK,OAAOjK;eACXA,MAAKiK,MAAK,KACf,CAAAjK,MAAKiK,MAAK;AAEd,UAAIhK,KAAI,EACJ,CAAAA,KAAIgK,MAAK,OAAOhK;eACXA,MAAKgK,MAAK,KACf,CAAAhK,MAAKgK,MAAK;AAEd,MAAAjK,KAAI,KAAK,IAAIA,EAAA;AACb,MAAAC,KAAI,KAAK,IAAIA,EAAA;AACb;IACH;IACD,KAAK,QAAQ;AACT,MAAAD,KAAI,WAAWA,IAAGiK,MAAK,IAAA;AACvB,MAAAhK,KAAI,WAAWA,IAAGgK,MAAK,IAAA;AACvB;IACH;IACD,KAAK,aAAa;AACd,UAAIjK,KAAI,KAAKC,KAAI,EACb;AACJ,UAAID,MAAKiK,MAAK,QAAQhK,MAAKgK,MAAK,KAC5B;AACJ;IACH;IACD,KAAK;AACD;IAEJ;AACI,YAAM,IAAI,MAAM,wBAAwBhF,MAAAA,iDAAqD;EAEpG;AACD,SAAO,OAAO,OAAO;IAAE,GAAAjF;IAAG,GAAAC;EAAG,CAAA;AAChC;;;;;;;;;;;AClCD,IAAaiK,WAAS,CAAClD,QAAO,SAAS;AACnC,QAAMiD,QAAO,wBAAwBjD,QAAO,IAAA;AAC5C,QAAMxD,MAAK,CAAC,MAAMyB,SAAO,gBAAgBkF,iBAAeF,OAAMjD,QAAO,MAAM/B,MAAAA;AAC3E,SAAOzB;AACV;AACD,IAAM2G,mBAAiB,CAACF,OAAMjD,QAAO,MAAM/B,WAAS;AAChD,QAAM,QAAQ,cAAcgF,OAAM,MAAMhF,MAAAA;AACxC,MAAI,UAAU,OACV,QAAO;AACX,SAAO+B,OAAM,KAAA;AAChB;AAuBD,IAAaoD,cAAY,CAACpD,QAAO,SAAS;AACtC,QAAMiD,QAAO,wBAAwBjD,QAAO,IAAA;AAC5C,SAAO,CAACjE,QAAO,MAAMkC,SAAO,gBAAgBoF,oBAAkBJ,OAAMjD,QAAOjE,QAAO,MAAMkC,MAAAA;AAC3F;AACD,IAAMoF,sBAAoB,CAACJ,OAAMjD,QAAOjE,QAAO,MAAMkC,WAAS;AAC1D,QAAM,QAAQ,cAAcgF,OAAM,MAAMhF,MAAAA;AACxC,MAAI,UAAU,OACV,OAAM,IAAI,WAAW,SAAS,KAAK,CAAA,IAAK,KAAK,CAAA,mCAAoCgF,MAAK,IAAA,UAAcA,MAAK,IAAA,EAAM;AACnH,EAAAjD,OAAM,KAAA,IAASjE;AACf,SAAOiE;AACV;AACD,IAAasD,QAAM,CAACtD,QAAO,SAAS;AAChC,QAAMiD,QAAO,wBAAwBjD,QAAO,IAAA;AAC5C,SAAO,CAACjE,QAAO,MAAMkC,WAASsF,cAAYN,OAAMjD,QAAOjE,QAAO,MAAMkC,MAAAA;AACvE;AACD,IAAMsF,gBAAc,CAACN,OAAMjD,QAAOjE,QAAO,MAAMkC,WAAS;AACpD,QAAM,QAAQ,cAAcgF,OAAM,MAAMhF,MAAAA;AACxC,MAAI,UAAU,OACV,OAAM,IAAI,WAAW,SAAS,KAAK,CAAA,IAAK,KAAK,CAAA,mCAAoCgF,MAAK,IAAA,UAAcA,MAAK,IAAA,EAAM;AACnH,QAAM,OAAO,CAAC,GAAGjD,MAAM;AACvB,OAAK,KAAA,IAASjE;AACd,EAAAiE,SAAQ;AACR,SAAO;AACV;AAOD,IAAM,0BAA0B,CAACA,QAAO,SAAS;AAC7C,QAAMiD,QAAO;IAAE;IAAM,MAAM,KAAK,KAAKjD,OAAM,SAAS,IAAA;EAAO;AAC3D,SAAOiD;AACV;AAkBD,IAAaO,gBAAc,CAACxD,QAAO,SAAS;AACxC,QAAMiD,QAAO,wBAAwBjD,QAAO,IAAA;AAC5C,SAAO;IACH,GAAGiD;IACH,KAAKC,SAAOlD,QAAO,IAAA;IACnB,KAAKoD,YAAUpD,QAAO,IAAA;IACtB,IAAI,QAAQ;AACR,aAAOA;IACV;EACJ;AACJ;AAwBD,IAAa/B,SAAO,CAAC+B,QAAO,SAAS;AACjC,QAAMiD,QAAO,wBAAwBjD,QAAO,IAAA;AAC5C,SAAO;IACH,GAAGiD;IACH,KAAK,CAAC,MAAM,cAAc,gBAAgBE,iBAAeF,OAAMjD,QAAO,MAAM,WAAA;IAC5E,KAAK,CAACjE,QAAO,MAAM,cAAc,gBAAgB;AAC7C,MAAAiE,SAAQuD,cAAYN,OAAMjD,QAAOjE,QAAO,MAAM,WAAA;AAC9C,aAAOkC,OAAK+B,QAAO,IAAA;IACtB;IACD,IAAI,QAAQ;AACR,aAAOA;IACV;EACJ;AACJ;AAeD,IAAa,cAAc,CAAC,cAAc,YAAYyD,cAAY;AAC9D,QAAMC,SAAO,OAAO,eAAe,WAAW,aAAa,WAAW;AACtE,QAAM,OAAO,OAAO,eAAe,WAAW,WAAW,OAAOD;AAChE,MAAI,CAAC,KACD,OAAM,IAAI,MAAM,6BAA6B;AACjD,cAAY,YAAYC,QAAM,aAAa,MAAM,GAAG,YAAY,MAAM,aAAa,MAAM,CAAC;AAC1F,QAAM/D,KAAI,CAAE;AACZ,QAAMQ,SAAQuD,SAAO;AACrB,WAAS,QAAQ,GAAG,QAAQvD,QAAO,QAC/B,CAAAR,GAAE,KAAA,IAAS;AAEf,SAAOA;AACV;AAeD,IAAa,gBAAgB,CAAC,cAAc,YAAY8D,cAAY;AAChE,QAAMC,SAAO,OAAO,eAAe,WAAW,aAAa,WAAW;AACtE,QAAM,OAAO,OAAO,eAAe,WAAW,WAAW,OAAOD;AAChE,MAAI,CAAC,KACD,OAAM,IAAI,MAAM,6BAA6B;AACjD,QAAMzD,SAAQ,YAAY,cAAc0D,QAAM,IAAA;AAC9C,SAAOF,cAAYxD,QAAO,IAAA;AAC7B;;;;;;;;;;ACzLD,IAAa2D,YAAS,CAAC3D,WAAU;AAC7B,MAAI,SAAS;AACb,aAAW,OAAOA,OACd,KAAI,OAAO,MAAM,MAAA,EACb,UAAS,IAAI;WAGT,WAAW,IAAI,OACf,OAAM,IAAI,MAAM,2CAA2C;AAGvE,SAAO;IAAE,MAAMA,OAAM;IAAQ,MAAM;EAAQ;AAC9C;AACD,IAAa,YAAY,CAACA,WAAU;AAChC,QAAMiD,QAAOU,UAAO3D,MAAA;AACpB,SAAO,CAACjE,QAAO,MAAMkC,SAAO,gBAAgB,kBAAkBgF,OAAMjD,QAAOjE,QAAO,MAAMkC,MAAAA;AAC3F;AAaD,IAAM,oBAAoB,CAACgF,OAAMjD,QAAOjE,QAAO,MAAM,WAAW;AAC5D,MAAI,YAAY,YAAYkH,OAAM,MAAM,MAAA;AACxC,MAAI,cAAc,OACd,OAAM,IAAI,WAAW,SAAS,KAAK,CAAA,IAAK,KAAK,CAAA,mCAAoCA,MAAK,IAAA,UAAcA,MAAK,IAAA,EAAM;AACnH,EAAAjD,OAAM,UAAU,CAAA,EAAG,UAAU,CAAA,IAAKjE;AAClC,SAAOiE;AACV;AAeD,IAAa,SAAS,CAACA,WAAU;AAC7B,QAAMiD,QAAOU,UAAO3D,MAAA;AACpB,QAAMxD,MAAK,CAAC,MAAMyB,SAAO,gBAAgB,eAAegF,OAAMjD,QAAO,MAAM/B,MAAAA;AAC3E,SAAOzB;AACV;AACD,IAAM,iBAAiB,CAACyG,OAAMjD,QAAO,MAAM/B,WAAS;AAChD,MAAI,YAAY,YAAYgF,OAAM,MAAMhF,MAAAA;AACxC,MAAI,cAAc,OACd,QAAO;AACX,SAAO+B,OAAM,UAAU,CAAA,EAAG,UAAU,CAAA;AACvC;AACD,IAAa,cAAc,CAACA,WAAU;AAClC,QAAMiD,QAAOU,UAAO3D,MAAA;AACpB,SAAO;IACH,GAAGiD;IACH,KAAK,OAAOjD,MAAA;IACZ,KAAK,UAAUA,MAAA;IACf,IAAI,QAAQ;AACR,aAAOA;IACV;EACJ;AACJ;AACD,IAAasD,OAAM,CAACtD,WAAU;AAC1B,QAAMiD,QAAOU,UAAO3D,MAAA;AACpB,SAAO,CAACjE,QAAO,MAAMkC,WAAS,YAAYgF,OAAMjD,QAAOjE,QAAO,MAAMkC,MAAAA;AACvE;AACD,IAAM,cAAc,CAACgF,OAAMjD,QAAOjE,QAAO,MAAMkC,WAAS;AACpD,MAAI,YAAY,YAAYgF,OAAM,MAAMhF,MAAAA;AACxC,MAAI,cAAc,OACd,OAAM,IAAI,WAAW,SAAS,KAAK,CAAA,IAAK,KAAK,CAAA,mCAAoCgF,MAAK,IAAA,UAAcA,MAAK,IAAA,EAAM;AACnH,MAAI,YAAY,CAAC,GAAGjD,MAAM;AAC1B,MAAI,UAAU,CAAC,GAAG,UAAU,UAAU,CAAA,CAAG;AACzC,UAAQ,UAAU,CAAA,IAAKjE;AACvB,YAAU,UAAU,CAAA,IAAK;AACzB,EAAAiE,SAAQ;AACR,SAAO;AACV;AAsBD,IAAa/B,SAAO,CAAC+B,WAAU;AAC3B,QAAMiD,QAAOU,UAAO3D,MAAA;AACpB,SAAO;IACH,GAAGiD;IACH,KAAK,CAAC,MAAM,cAAc,gBAAgB,eAAeA,OAAMjD,QAAO,MAAM,WAAA;IAC5E,KAAK,CAACjE,QAAO,MAAM,cAAc,gBAAgB;AAC7C,MAAAiE,SAAQ,YAAYiD,OAAMjD,QAAOjE,QAAO,MAAM,WAAA;AAC9C,aAAOkC,OAAK+B,MAAA;IACf;IACD,IAAI,QAAQ;AACR,aAAOA;IACV;EACJ;AACJ;ACpHD,UAAiB,OAAOiD,OAAM,MAAM;AAChC,aAAWzK,MAAK,KACZ,KAAI,MAAM,QAAQA,EAAA,EACd,OAAMA,GAAE,IAAI,CAAA6C,OAAK4H,MAAK,IAAI5H,IAAG,WAAW,CAAC;MAGzC,OAAM4H,MAAK,IAAIzK,IAAG,WAAW;AAGxC;ACFD,UAAiB,MAAMyK,OAAM,OAAOhF,SAAO,MAAM;AAC7C,MAAI,CAAC,MACD,SAAQ;IAAE,GAAG;IAAG,GAAG;EAAG;AAC1B,YAAUgF,OAAM,MAAM;AACtB,YAAU,OAAO,SAASA,KAAA;AAC1B,MAAI,EAAE,GAAAjK,IAAG,GAAAC,GAAA,IAAM;AACf,MAAI,UAAU;AACd,KAAG;AACC,UAAM;MAAE,GAAAD;MAAG,GAAAC;IAAG;AACd,IAAAD;AACA,QAAIA,OAAMiK,MAAK,MAAM;AACjB,MAAAhK;AACA,MAAAD,KAAI;IACP;AACD,QAAIC,OAAMgK,MAAK,KACX,KAAIhF,QAAM;AACN,MAAAhF,KAAI;AACJ,MAAAD,KAAI;IACP,MAEG,WAAU;AAGlB,QAAIA,OAAM,MAAM,KAAKC,OAAM,MAAM,EAC7B,WAAU;EACjB,SAAQ;AACZ;AAiBD,UAAiB,WAAWgK,OAAM,OAAOhF,SAAO,MAAM;AAClD,SAAO,OAAOgF,OAAM,MAAMA,OAAM,OAAOhF,MAAAA,CAAK;AAC/C;AAWD,UAAiB,eAAegF,OAAM,OAAOhF,SAAO,MAAM;AACtD,aAAW,QAAQ,MAAMgF,OAAM,OAAOhF,MAAAA,EAClC,OAAM;IAAE;IAAM,OAAOgF,MAAK,IAAI,IAAA;EAAO;AAE5C;;;;;;AClED,IAAa,OAAO,WAAWA,OAAM,OAAO;AACxC,MAAI,CAAC,MACD,SAAQ;IAAE,GAAG;IAAG,GAAG;EAAG;AAC1B,MAAI,MAAM,MAAM;AAChB,MAAI,WAAW,CAAE;AACjB,aAAW7J,MAAK,MAAM6J,OAAM,KAAA,EACxB,KAAI7J,GAAE,MAAM,IACR,UAAS,KAAKA,EAAA;OAEb;AACD,UAAM;AACN,eAAW,CAACA,EAAE;AACd,UAAMA,GAAE;EACX;AAEL,MAAI,SAAS,SAAS,EAClB,OAAM;AACb;AAkBD,UAAiB,QAAQ6J,OAAM,OAAO;AAClC,MAAI,CAAC,MACD,SAAQ;IAAE,GAAG;IAAG,GAAG;EAAG;AAC1B,WAASjK,KAAI,MAAM,GAAGA,KAAIiK,MAAK,MAAMjK,MAAK;AACtC,QAAI,WAAW,CAAE;AACjB,aAASC,KAAI,MAAM,GAAGA,KAAIgK,MAAK,MAAMhK,KACjC,UAAS,KAAK;MAAE,GAAAD;MAAG,GAAAC;IAAG,CAAA;AAE1B,UAAM;EACT;AACJ;ACjDD,IAAa,SAAS,SAAUgK,OAAM,OAAO,QAAQ,SAAS,aAAa;AACvE,SAAO,YAAYA,OAAM;IACrB,GAAG,MAAM,IAAI,OAAO;IACpB,GAAG,MAAM,IAAI,OAAO;EACvB,GAAE,MAAA;AA+CN;AC5DD,IAAa,gBAAgB,OAAO,OAAO;EACvC;EACA;EACA;EACA;EACA;EACA;EACA;EACA;AACH,CAAA;AAID,IAAa,kBAAkB,OAAO,OAAO;EACzC;EACA;EACA;EACA;AACH,CAAA;AAUD,IAAa,kBAAkB,CAACA,OAAM,OAAO,OAAO,SAAS,WAAW;AACpE,YAAUA,OAAM,MAAM;AACtB,YAAU,OAAO,OAAO;AACxB,cAAY,YAAY,OAAO,aAAa,OAAO,CAAC;AACpD,QAAM,aAAa;AACnB,QAAM,UAAU,WAAW,IAAI,CAACzK,OAAM,sBAAsBA,IAAG,KAAA,CAAM;AACrE,QAAMoL,UAAQ,WAAW,IAAI,CAACpL,IAAG,UAAU,OAAOyK,OAAM,OAAO,QAAQ,KAAA,GAAQ,MAAA,CAAO;AACtF,SAAO,YAAY,YAAYW,OAAAA;AAClC;AAiBD,IAAa,wBAAwB,CAACC,YAAU,aAAa,MAAM;AAC/D,MAAIxI;AACJ,UAAQwI,YAAR;IACI,KAAK,KAAK;AACN,MAAAxI,KAAI;QAAE,GAAG;QAAG,GAAG,KAAK;MAAY;AAChC;IACH;IACD,KAAK,MAAM;AACP,MAAAA,KAAI;QAAE,GAAG,IAAI;QAAY,GAAG,KAAK;MAAY;AAC7C;IACH;IACD,KAAK,KAAK;AACN,MAAAA,KAAI;QAAE,GAAG,IAAI;QAAY,GAAG;MAAG;AAC/B;IACH;IACD,KAAK,MAAM;AACP,MAAAA,KAAI;QAAE,GAAG,IAAI;QAAY,GAAG,IAAI;MAAY;AAC5C;IACH;IACD,KAAK,KAAK;AACN,MAAAA,KAAI;QAAE,GAAG;QAAG,GAAG,IAAI;MAAY;AAC/B;IACH;IACD,KAAK,MAAM;AACP,MAAAA,KAAI;QAAE,GAAG,KAAK;QAAY,GAAG,IAAI;MAAY;AAC7C;IACH;IACD,KAAK,KAAK;AACN,MAAAA,KAAI;QAAE,GAAG,KAAK;QAAY,GAAG;MAAG;AAChC;IACH;IACD,KAAK,MAAM;AACP,MAAAA,KAAI;QAAE,GAAG,KAAK;QAAY,GAAG,KAAK;MAAY;AAC9C;IACH;IACD;AACI,MAAAA,KAAI;QAAE,GAAG;QAAG,GAAG;MAAG;EAEzB;AACD,SAAO,OAAO,OAAOA,EAAA;AACxB;;;;;;;AEtFD,IAAa,UAAU,CAAC,OAAO,QAAQ;AAEnC,YAAU,KAAA;AACV,YAAU,GAAA;AACV,MAAI,SAAS,MAAM;AACnB,MAAI,SAAS,MAAM;AACnB,QAAM,KAAK,KAAK,IAAI,IAAI,IAAI,MAAA;AAC5B,QAAM,KAAK,KAAK,IAAI,IAAI,IAAI,MAAA;AAC5B,QAAM,KAAK,SAAS,IAAI,IAAI,IAAI;AAChC,QAAM,KAAK,SAAS,IAAI,IAAI,IAAI;AAChC,MAAI,QAAQ,KAAK;AACjB,QAAMuI,UAAQ,CAAE;AAEhB,SAAO,MAAM;AACTA,YAAM,KAAK,OAAO,OAAO;MAAE,GAAG;MAAQ,GAAG;IAAQ,CAAA,CAAC;AAClD,QAAI,WAAW,IAAI,KAAK,WAAW,IAAI,EACnC;AACJ,UAAM,SAAS,IAAI;AACnB,QAAI,SAAS,CAAC,IAAI;AACd,eAAS;AACT,gBAAU;IACb;AACD,QAAI,SAAS,IAAI;AACb,eAAS;AACT,gBAAU;IACb;EACJ;AACD,SAAOA;AACV;AAWD,IAAa,aAAa,SAAU,OAAO,KAAK,eAAe,OAAO;AAClE,QAAMA,UAAQ,CAAE;AAChB,MAAI,MAAM,MAAM,IAAI,GAAG;AAEnB,UAAM,QAAQ,eAAe,IAAI,IAAI,IAAI,IAAI;AAC7C,aAAS3K,KAAI,MAAM,GAAGA,KAAI,OAAOA,KAC7B2K,SAAM,KAAK;MAAE,GAAG,MAAM;MAAM,GAAA3K;IAAG,CAAA;EAEtC,WACQ,MAAM,MAAM,IAAI,GAAG;AAExB,UAAM,QAAQ,eAAe,IAAI,IAAI,IAAI,IAAI;AAC7C,aAASD,KAAI,MAAM,GAAGA,KAAI,OAAOA,KAC7B4K,SAAM,KAAK;MAAK,GAAA5K;MAAG,GAAG,MAAM;IAAG,CAAA;EAEtC,MAEG,OAAM,IAAI,MAAM,sCAAsC,MAAM,CAAA,IAAK,MAAM,CAAA,MAAO,IAAI,CAAA,IAAK,IAAI,CAAA,EAAG;AAElG,SAAO4K;AACV;AC/CD,IAAa,gBAAgB,CAACX,OAAM,MAAMhF,WAAS;AAC/C,YAAUgF,OAAM,MAAM;AACtB,MAAI,KAAK,IAAI,EACT,SAAQhF,QAAR;IACI,KAAK,QAAQ;AACT,aAAO;QAAE,GAAG;QAAM,GAAG;MAAG;AACxB;IACH;IACD,KAAK;AACD,YAAM,IAAI,MAAM,yBAAyB;IAE7C,KAAK;AACD,aAAO;IAEX,KAAK,QAAQ;AAET,aAAO,OAAOgF,OAAM;QAAE,GAAG;QAAG,GAAG,KAAK;MAAG,GAAE;QAAE,GAAG,KAAK;QAAG,GAAG;MAAG,GAAE,MAAM;AACpE;IACH;EACJ;AAEL,MAAI,KAAK,IAAI,EACT,SAAQhF,QAAR;IACI,KAAK,QAAQ;AACT,aAAO;QAAE,GAAG;QAAM,GAAG;MAAG;AACxB;IACH;IACD,KAAK;AACD,YAAM,IAAI,MAAM,yBAAyB;IAE7C,KAAK;AACD,aAAO;IAEX,KAAK,QAAQ;AACT,aAAO;QAAE,GAAG;QAAM,GAAGgF,MAAK,OAAO,KAAK;MAAG;AACzC;IACH;EACJ;AAEL,MAAI,KAAK,KAAKA,MAAK,KACf,SAAQhF,QAAR;IACI,KAAK,QAAQ;AACT,aAAO;QAAE,GAAG;QAAM,GAAGgF,MAAK,OAAO;MAAG;AACpC;IACH;IACD,KAAK;AACD,YAAM,IAAI,MAAM,yBAAyB;IAE7C,KAAK;AACD,aAAO;IAEX,KAAK,QAAQ;AACT,aAAO;QAAE,GAAG;QAAM,GAAG,KAAK,IAAIA,MAAK;MAAM;AACzC;IACH;EACJ;AAEL,MAAI,KAAK,KAAKA,MAAK,KACf,SAAQhF,QAAR;IACI,KAAK,QAAQ;AACT,aAAO;QAAE,GAAG;QAAM,GAAGgF,MAAK,OAAO;MAAG;AACpC;IACH;IACD,KAAK;AACD,YAAM,IAAI,MAAM,yBAAyB;IAE7C,KAAK;AACD,aAAO;IAEX,KAAK,QAAQ;AACT,aAAO;QAAE,GAAG;QAAM,GAAG,KAAK,IAAIA,MAAK;MAAM;AACzC;IACH;EACJ;AAEL,QAAM,QAAQ,KAAK,IAAIA,MAAK,OAAO,KAAK;AACxC,SAAO;AACV;AAmBD,IAAa,gBAAgB,CAAC,YAAY,UAAU;AAChD,MAAI,OAAO;AACX,SAAO,OAAO,eAAe,WAAW,aAAa,WAAW;AAChE,cAAY,YAAY,MAAM,aAAa,YAAY,CAAC;AACxD,SAAO;IACH,GAAG,QAAQ;IACX,GAAG,KAAK,MAAM,QAAQ,IAAA;EACzB;AACJ;AC1HD,IAAanJ,YAAU,CAACZ,IAAGC,OAAM;AAC7B,MAAIA,OAAM,OACN,QAAO;AACX,MAAID,OAAM,OACN,QAAO;AACX,MAAI,UAAUA,MAAK,UAAUA,GACzB,KAAI,UAAUC,MAAK,UAAUA,IACzB;QAAID,GAAE,SAASC,GAAE,QAAQD,GAAE,SAASC,GAAE,KAClC,QAAO;EAAM,MAGjB,QAAO;AAEf,MAAI,UAAUD,GACV,KAAI,UAAUC,IACV;QAAID,GAAE,SAASC,GAAE,KACb,QAAO;EAAM,MAGjB,QAAO;AAEf,SAAO;AACV;AASD,IAAa,aAAa,CAACD,IAAGC,OAAM;AAChC,MAAIA,OAAM,OACN,QAAO;AACX,MAAID,OAAM,OACN,QAAO;AACX,SAAOA,GAAE,MAAMC,GAAE,KAAKD,GAAE,MAAMC,GAAE;AACnC;ACzCD,IAAa,kBAAkB,CAAC,SAAS2K,eAAc,IAAA;AAOvD,IAAM,cAAc,CAACtE,OAAM;AACvB,MAAIA,OAAM,OACN,QAAO;AACX,MAAIA,GAAE,CAAA,MAAO,OACT,QAAO;AACX,SAAO;AACV;AAkBD,IAAa,gBAAgB,CAACyD,OAAM,MAAM,YAAY,WAAW;AAE7D,QAAM,iBAAiB,WAAWA,OAAM,MAAM,QAAQ,UAAA;AAEtD,QAAMc,WAAU,OAAO,QAAQ,cAAA;AAC/B,SAAOA,SAAQ,OAAO,CAAAvE,OAAK,YAAYA,EAAA,CAAE;AAC5C;AA6BD,IAAa,aAAa,CAACyD,OAAM,MAAM,SAAS,aAAa,eAAe;AACxE,QAAM,cAAc,cAAc;AAClC,QAAM,SAAS,YAAY,IAAI,CAAC7J,OAAM,OAAO6J,OAAM,MAAM,sBAAsB7J,EAAA,GAAI,MAAA,CAAO;AAC1F,SAAO,YAAY,aAAa,MAAA;AACnC;ACxDD,IAAa,YAAY,CAAC6J,OAAM,iBAAiB;AAC7C,QAAM,cAAc,CAAE;AACtB,WAAS,MAAM,GAAG,MAAMA,MAAK,MAAM,OAAO;AACtC,gBAAY,GAAA,IAAO,MAAM,KAAK,EAAE,QAAQA,MAAK,KAAM,CAAA;AACnD,QAAI,aACA,UAAS,MAAM,GAAG,MAAMA,MAAK,MAAM,MAC/B,aAAY,GAAA,EAAK,GAAA,IAAO;EAGnC;AACD,SAAO;AACV;AClBD,IAAa,gBAAgB,CAAC5H,OAAM,QAAQA,GAAE,CAAA,IAAKA,GAAE,CAAA;ACIrD,UAAiB,aAAa4H,OAAM;AAChC,aAAW7J,MAAK,MAAM6J,KAAA,EAClB,OAAM,iBAAiBA,OAAM7J,EAAA;AAEpC;AAWD,IAAa,cAAc,CAAC6J,OAAM,aAAa;AAC3C,QAAM,OAAOA,MAAK;AAClB,cAAY,WAAW,MAAM,YAAY,WAAW,CAAC;AACrD,MAAI,SAAS,IAAI,KAAK,SAAS,IAAI,EAC/B;AACJ,QAAMjK,KAAI,KAAK,MAAM,SAAS,IAAI,IAAA;AAClC,QAAMC,KAAI,KAAK,MAAM,SAAS,IAAI,IAAA;AAClC,MAAID,MAAKiK,MAAK,KACV;AACJ,MAAIhK,MAAKgK,MAAK,KACV;AACJ,SAAO;IAAE,GAAAjK;IAAG,GAAAC;EAAG;AAClB;AAkBD,IAAa,mBAAmB,CAACgK,OAAM,SAAS;AAC5C,YAAU,IAAA;AACV,QAAM,OAAOA,MAAK;AAClB,QAAMjK,KAAI,KAAK,IAAI;AACnB,QAAMC,KAAI,KAAK,IAAI;AACnB,QAAMK,KAAIqJ,YAAiB;IAAK,GAAA3J;IAAM,GAAAC;EAAG,GAAE,MAAM,IAAA;AACjD,SAAOK;AACV;AAQD,IAAa,aAAa,CAAC2J,OAAM,SAAS;AACtC,YAAU,IAAA;AACV,QAAM,OAAOA,MAAK;AAClB,QAAMjK,KAAI,KAAK,IAAI;AACnB,QAAMC,KAAI,KAAK,IAAI;AACnB,SAAO,OAAO,OAAO;IAAE,GAAGD,KAAI,OAAO;IAAG,GAAGC,KAAI,OAAO;EAAG,CAAA;AAC5D;ACnED,IAAa,eAAe,MAAM;AAC9B,SAAO,EACH,QAAQ,CAAC,SAAS,KAAK,CAAA,EAC1B;AACJ;ACFD,IAAa,kBAAkB,MAAM;AACjC,SAAO;IACH,QAAQ,CAAC+K,iBAAe;AACpB,aAAOA,aAAW,GAAG,CAAA;IACxB;IACD,eAAe,CAACf,OAAM,SAAS;AAC3B,aAAO,cAAcA,OAAM,MAAM,eAAe,WAAW;IAC9D;EACJ;AACJ;ACpBD,IAAa,cAAc,CAAC,OAAO,CAAE,MAAK;AACtC,QAAM,WAAW,KAAK,YAAY;AAClC,SAAO;IACH,QAAQ,CAAC,SAAS,KAAK,KAAK,CAACzD,OAAMA,GAAE,CAAA,OAAQ,WAAW,MAAM,IAAG;IACjE,eAAe,CAACyD,OAAM,SAAS;AAC3B,UAAI,SAEA,KAAI,KAAK,IAAI,EAET,QAAO;QAAE,GAAG,KAAK;QAAG,GAAG,KAAK,IAAI;MAAG;eAI/B,KAAK,MAAM,EAEX,QAAO;QAAE,GAAGA,MAAK,OAAO;QAAG,GAAGA,MAAK,OAAO;MAAG;UAG7C,QAAO;QAAE,GAAG,KAAK,IAAI;QAAG,GAAGA,MAAK,OAAO;MAAG;eAM9C,KAAK,IAAIA,MAAK,OAAO,EAErB,QAAO;QAAE,GAAG,KAAK;QAAG,GAAG,KAAK,IAAI;MAAG;eAI/B,KAAK,IAAIA,MAAK,OAAO,EAErB,QAAO;QAAE,GAAG,KAAK,IAAI;QAAG,GAAG;MAAG;UAI9B,QAAO;QAAE,GAAG;QAAG,GAAG;MAAG;AAIjC,aAAO,CAAC,CAAC,WAAW,MAAM,KAAK,IAAK,CAAC;IACxC;EACJ;AACJ;ACvCD,IAAa,aAAa,MAAM;AAC5B,SAAO,EACH,QAAQ,CAAC,SAAS,KAAK,GAAG,EAAA,EAC7B;AACJ;ACAD,IAAa,cAAc,MAAM;AAC7B,SAAO;IACH,eAAe,CAACA,OAAM,SAAS;AAC3B,YAAMtD,KAAI,CAAE;AACZ,iBAAWvG,MAAK,MAAM6J,OAAM,IAAA,EACxB,CAAAtD,GAAE,KAAK,CAAC,KAAKvG,EAAE,CAAA;AAEnB,aAAOuG;IACV;IACD,QAAQ;EACX;AACJ;ACZD,IAAa,wBAAwB,MAAM;AACvC,SAAO,EACH,QAAQ,gBACX;AACJ;ACXD,IAAa,WAAW,CAAC,OAAO,CAAE,MAAK;AACnC,QAAM,WAAW,KAAK,YAAY;AAClC,SAAO;IACH,QAAQ,CAAC,SAAS,KAAK,KAAK,CAACH,OAAMA,GAAE,CAAA,OAAQ,WAAW,MAAM,IAAG;IACjE,eAAe,CAACyD,OAAM,SAAS;AAC3B,UAAI,SAEA,KAAI,KAAK,IAAI,EAET,QAAO;QAAE,GAAG,KAAK,IAAI;QAAG,GAAG,KAAK;MAAG;eAI/B,KAAK,IAAI,EAET,QAAO;QAAE,GAAGA,MAAK,OAAO;QAAG,GAAG,KAAK,IAAI;MAAG;UAI1C,QAAO;QAAE,GAAGA,MAAK,OAAO;QAAG,GAAGA,MAAK,OAAO;MAAG;eAQjD,KAAK,IAAIA,MAAK,OAAO,EAErB,QAAO;QAAE,GAAG,KAAK,IAAI;QAAG,GAAG,KAAK;MAAG;eAK/B,KAAK,IAAIA,MAAK,OAAO,EAErB,QAAO;QAAE,GAAG;QAAG,GAAG,KAAK,IAAI;MAAG;UAI9B,QAAO;QAAE,GAAG;QAAG,GAAG;MAAG;AAIjC,aAAO,CAAC,CAAC,WAAW,MAAM,KAAK,IAAK,CAAC;IACxC;EACJ;AACJ;ACTD,UAAiB,kBAAkB,OAAOA,OAAM,OAAO,CAAE,GAAE;AACvD,YAAUA,OAAM,MAAM;AACtB,QAAM,QAAQ,KAAK,SAAS;IAAE,GAAG;IAAG,GAAG;EAAG;AAC1C,YAAU,OAAO,cAAcA,KAAA;AAC/B,QAAM5H,KAAI,KAAK,WAAW4I,WAAQ,aAAA;AAClC,QAAM,qBAAqB,MAAM,kBAAkB,CAACC,IAAG9K,OAAM,cAAc8K,IAAG9K,IAAG,iBAAiB,WAAW;AAC7G,MAAI,YAAY,CAAC,KAAM;AACvB,MAAI,YAAY,CAAE;AAClB,MAAI,UAAU;AACd,SAAO,UAAU,SAAS,GAAG;AACzB,QAAI,YAAY,QAAW;AACvB,YAAM,KAAK,UAAU,IAAA;AACrB,UAAI,OAAO,OACP;AAEJ,gBAAU;IACb;AACD,QAAI,CAACiC,GAAE,IAAI,OAAA,GAAU;AACjB,MAAAA,GAAE,IAAI,OAAA;AACN,YAAM;AACN,YAAM,YAAY,mBAAmB4H,OAAM,OAAA,EAAS,OAAO,CAAC,SAAS;AACjE,YAAI,KAAK,CAAA,MAAO,OACZ,QAAO;AACX,eAAO,CAAC5H,GAAE,IAAI,KAAK,CAAA,CAAA;MACtB,CAAA;AACD,UAAI,UAAU,WAAW,GAErB;YAAI,YAAY,OACZ,aAAY,UAAU,OAAO,CAAC,OAAO,WAAW,IAAI,OAAA,CAAQ;MAC/D,MAGD,YAAWmE,MAAK,WAAW;AACvB,YAAIA,OAAM,OACN;AACJ,YAAIA,GAAE,CAAA,MAAO,OACT;AACJ,kBAAU,KAAKA,EAAA;MAClB;IAER;AAED,gBAAY,UAAU,OAAO,CAAC,SAAS,CAACnE,GAAE,IAAI,KAAK,CAAA,CAAA,CAAG;AACtD,QAAI,UAAU,WAAW,EACrB,WAAU;SAET;AAED,YAAM,YAAY,MAAM,OAAO,SAAA;AAC/B,UAAI,cAAc,QAAW;AACzB,kBAAU,KAAK,UAAU,CAAA,CAAA;AACzB,kBAAU,UAAU,CAAA;MACvB;IACJ;EACJ;AACJ;AC9ED,IAAa,UAAU,CAAC4H,OAAM,eAAe,QAAQ;EAAE,GAAG;EAAG,GAAG;AAAG,GAAE,aAAa,MAAM;AACpF,YAAUA,OAAM,MAAM;AACtB,YAAU,OAAO,OAAO;AACxB,cAAY,YAAY,YAAY,IAAI,YAAY,CAAC;AAErD,QAAM,QAAQ,CAAE;AAChB,MAAIpC,SAAQ;AACZ,MAAI,WAAW;AACf,aAAWzH,MAAK,cAAc6J,OAAM;IAAE;IAAO,YAAY;EAAa,CAAA,GAAG;AACrE,IAAApC;AACA,QAAKA,SAAQ,eAAgB,EACzB;AACJ,UAAM,KAAKzH,EAAA;EACd;AACD,SAAO,CAAC,MAAM,YAAY,UAAU;AAChC,gBAAY,YAAY,MAAM,IAAI,MAAM,CAAC;AACzC,QAAI,UACA,YAAW;QAEX,aAAY;AAEhB,WAAO,MAAM,GAAG,WAAW,MAAM,MAAA;EACpC;AACJ;;;;;;;;;;;;;;;ACbD,IAAauK,UAAS,CAAC,MAAM,OAAO,CAAE,MAAK;AACvC,UAAQ,MAAR;IACI,KAAK;AACD,aAAO,UAAU,sBAAA,GAAyB,IAAA;IAC9C,KAAK;AACD,aAAO,UAAU,YAAA,GAAe,IAAA;IACpC,KAAK;AACD,aAAO,UAAU,WAAA,GAAc,IAAA;IACnC,KAAK;AACD,aAAO,UAAU,aAAA,GAAgB,IAAA;IACrC,KAAK;AACD,aAAO,UAAU,gBAAA,GAAmB,IAAA;IACxC,KAAK;AACD,aAAO,UAAU,SAAS,IAAA,GAAO,IAAA;IACrC,KAAK;AACD,aAAO,UAAU,YAAY,IAAA,GAAO,IAAA;IACxC;AACI,YAAM,IAAI,UAAU,gCAAgC,IAAA,EAAM;EACjE;AACJ;AACD,IAAa,YAAY,CAAC,OAAO,UAAU,CAAE,MAAK;AAC9C,SAAO,CAACV,OAAM,kBAAkB,CAAE,MAAK;AACnC,WAAO,kBAAkB,OAAOA,OAAM;MAAE,GAAG;MAAS,GAAG;IAAiB,CAAA;EAC3E;AACJ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AE9CD,IAAa,WAAW,SAAUZ,OAAM;AACpC,MAAI,kBAAkBA,KAAA,EAClB,QAAOA,MAAK;WACP,OAAOA,KAAA,EACZ,QAAOA,MAAK;MAEZ,OAAM,IAAI,MAAM,qBAAqB,KAAK,UAAUA,KAAA,CAAK,EAAE;AAClE;AAOD,IAAa,SAAS,SAAUA,OAAM;AAClC,MAAI,kBAAkBA,KAAA,EAClB,QAAOA,MAAK;WACP,OAAOA,KAAA,EACZ,QAAOA,MAAK;MAEZ,OAAM,IAAI,MAAM,qBAAqB,KAAK,UAAUA,KAAA,CAAK,EAAE;AAClE;;;;;;;;;;;;;;AChBD,IAAa,aAAa,CAAC,cAAc,OAAOA,UAAS;AACrD,QAAM,WAAW,CAAC,GAAG,aAAa,QAAS;AAE3C,WAAS,KAAA,IAASA;AAClB,SAAO,UAAU,GAAG,QAAA;AACvB;AAUD,IAAa3E,eAAc,CAACyG,QAAOxE,IAAG,UAAU,eAAe;AAC3D,MAAI,eAAe,OACf,cAAa,kBAAkBwE,MAAA;AAGnC,QAAM,WAAWxE,MAAK,WAAW,WAAW,aAAa,WAAW;AACpE,MAAI,QAAQ;AAEZ,QAAMnE,KAAI,WAAW,WAAW,SAAS,WAAW;AACpD,aAAW,CAAC,OAAO,OAAA,KAAYA,GAAE,QAAA,EAC7B,KAAI,QAAQ,WAAW,UAAU;AAC7B,UAAM4I,YAAW,WAAW;AAC5B,QAAI,MAAMA,YAAW;AACrB,QAAI,MAAM,EACN,OAAM;AACV,WAAOD,OAAM,KAAA,EAAO,YAAY,GAAA;EACnC,MAEG,UAAS;AAEjB,SAAO;IAAE,GAAG;IAAG,GAAG;EAAG;AACxB;AAOD,IAAa,kBAAkB,CAACA,QAAO1K,YAAU;AAC7C,MAAI0K,OAAM,WAAW,EACjB,QAAO;AACX,MAAI,YAAYA,OAAM,IAAI,CAAChM,IAAG,WAAW;IAAE,MAAMA;IAAG;IAAO,UAAUA,GAAE,gBAAgBsB,OAAAA;EAAQ,EAAA;AAC/F,cAAY,sBAAsB,WAAW,UAAU;AACvD,MAAI,UAAU,WAAW,EACrB,OAAM,IAAI,MAAM,6BAA6B;AACjD,SAAO,UAAU,CAAA,EAAG;AACvB;AASD,IAAa,mBAAmB,CAAC0K,QAAO1K,SAAO,uBAAuB,eAAe;AACjF,MAAI,eAAe,OACf,cAAa,kBAAkB0K,MAAA;AAEnC,MAAI,YAAYA,OAAM,IAAI,CAAChM,IAAG,WAAW;IAAE,MAAMA;IAAG;IAAO,UAAUA,GAAE,gBAAgBsB,OAAAA;EAAQ,EAAA;AAC/F,cAAY,sBAAsB,WAAW,UAAU;AACvD,MAAI,UAAU,SAAS,EACnB,OAAM,IAAI,MAAM,oCAAoC;AACxD,QAAMjB,KAAI,UAAU,CAAA;AACpB,MAAIA,GAAE,WAAW,sBACb,OAAM,IAAI,MAAM,yDAAyDA,GAAE,QAAA,gBAAwB,qBAAA,EAAuB;AAC9H,QAAM,yBAAyBA,GAAE,KAAK,iBAAiBiB,SAAO,qBAAA;AAE9D,MAAI,cAAc;AAClB,WAAS,QAAQ,GAAG,QAAQjB,GAAE,OAAO,QAEjC,gBAAe,WAAW,QAAQ,KAAA;AAGtC,iBAAe,WAAW,QAAQA,GAAE,KAAA,IAAS;AAC7C,QAAM,iBAAiB,cAAc,WAAW;AAChD,UAAQ,IAAI,QAAQ,WAAA,SAAoB,cAAA,aAA2B,sBAAA,UAAgCA,GAAE,KAAA,EAAO;AAC5G,SAAO;AACV;AAOD,IAAa,oBAAoB,CAAC2L,WAAU;AACxC,QAAM,SAASA,OAAM,IAAI,CAAA3I,OAAKA,GAAE,KAAA,EAAO,KAAA;AACvC,QAAMD,YAAU4I,OAAM,IAAI,CAAA3I,OAAKA,GAAE,OAAA,CAAQ;AACzC,MAAI,cAAc;AAClB,MAAI,aAAa;AACjB,aAAWuC,YAAUxC,UACjB,gBAAewC;AAEnB,aAAW,SAAS,OAChB,eAAc;AAElB,SAAO;IAAE;IAAa;IAAY;IAAQ,SAAA;EAAS;AACtD;AAOD,IAAapB,SAAO,CAACwH,WAAU;AAC3B,QAAM,QAAQA,OAAM,IAAI,CAAAhM,OAAKA,GAAE,KAAA,CAAM;AACrC,QAAMwB,YAAU,MAAM,QAAQ,CAAAR,OAAKkL,UAAalL,EAAA,CAAE;AAClD,SAAOyG,OAAW,GAAGjG,SAAAA;AACxB;AAOD,IAAa4E,YAAW,CAAC4F,WAAUA,OAAM,IAAI,CAAAhM,OAAKA,GAAE,SAAA,CAAU,EAAE,KAAK,IAAI;AAMzE,IAAa,kBAAkB,CAACgM,WAAU;AACtC,MAAI,UAAU,OAAOA,OAAM,CAAA,CAAA;AAC3B,WAAS,QAAQ,GAAG,QAAQA,OAAM,QAAQ,SAAS;AAC/C,UAAM,QAAQ,SAASA,OAAM,KAAA,CAAA;AAC7B,QAAI,CAAC/I,SAAc,OAAO,OAAA,EACtB,OAAM,IAAI,MAAM,cAAc,KAAA,6CAAkD,MAAM,CAAA,IAAK,MAAM,CAAA,cAAe,QAAQ,CAAA,IAAK,QAAQ,CAAA,EAAG;AAC5I,cAAU,OAAO+I,OAAM,KAAA,CAAA;EAC1B;AACJ;AACD,IAAa,cAAc,CAACA,WAAUA,OAAM,QAAQ,CAAAhM,OAAKA,GAAE,YAAA,CAAa;AAQxE,IAAa,YAAY,IAAIgM,WAAU;AACnC,kBAAgBA,MAAA;AAChB,QAAM,OAAO,kBAAkBA,MAAA;AAC/B,SAAO,OAAO,OAAO;IACjB,UAAUA;IACV,QAAQ,MAAM,KAAK;IACnB,SAAS,CAACzB,OAAM;AAAE,YAAM,IAAI,MAAM,iBAAiB;IAAI;IACvD,aAAa,CAAC/C,IAAG,WAAW,UAAUjC,aAAYyG,QAAOxE,IAAG,UAAU,IAAA;IACtE,kBAAkB,CAAClG,SAAO,0BAA0B,iBAAiB0K,QAAO1K,SAAO,uBAAuB,IAAA;IAC1G,iBAAiB,CAACA,YAAU,gBAAgB0K,QAAO1K,OAAAA;IACnD,MAAM,MAAMkD,OAAKwH,MAAA;IACjB,UAAU,MAAM5F,UAAS4F,MAAA;IACzB,aAAa,MAAM,YAAYA,MAAA;IAC/B,MAAM;EACT,CAAA;AACJ;;;;;;;;;;;;;;;;AEpKD,IAAanJ,UAAQ,OAAO,OAAO;EAC/B,GAAG;IAAE,GAAG;IAAG,GAAG;EAAG;EACjB,GAAG;IAAE,GAAG;IAAG,GAAG;EAAG;EACjB,GAAG;IAAE,GAAG;IAAG,GAAG;EAAG;AACpB,CAAA;AAID,IAAatB,gBAAc,OAAO,OAAO;EACrC,GAAG;IAAE,GAAG;IAAY,GAAG;EAAY;EACnC,GAAG;IAAE,GAAG;IAAY,GAAG;EAAY;EACnC,GAAG;IAAE,GAAG;IAAY,GAAG;EAAY;AACtC,CAAA;AASD,IAAa,wBAAwB,CAAC,QAAQqE,WAAS,IAAIkC,gBAAc,KAAK,KAAK,MAAM;AACrF,MAAI,CAAC,OACD,UAAS,OAAO,OAAO;IAAE,GAAG;IAAG,GAAG;EAAG,CAAA;AACzC,QAAM/G,KAAIoL,QAAc,QAAQvG,UAAQ,KAAK,KAAK,CAACkC,gBAAc,CAAA;AACjE,QAAM7G,KAAIkL,QAAc,QAAQvG,UAAQ,KAAK,KAAKkC,gBAAc,CAAA;AAChE,SAAO;IAAE,GAAA/G;IAAG,GAAG;IAAQ,GAAAE;EAAG;AAC7B;ACRD,IAAa,QAAQ,CAAC,QAAQmL,QAAM,OAAO,CAAE,MAAK;AAC9C,QAAM,aAAa,KAAK,cAAc;AACtC,QAAM,gBAAgB,KAAK,iBAAiB,KAAK,IAAI,aAAa,GAAG,CAAA;AACrE,QAAMtE,gBAAc,KAAK,eAAe;AACxC,QAAM,YAAY,KAAK,aAAa,KAAK,IAAI,aAAa,GAAG,EAAA;AAC7D,QAAM,WAAW,KAAK,KAAK;AAC3B,MAAI;AACJ,MAAI;AACJ,MAAIsE,WAAS,OAAO;AAChB,UAAM,sBAAsB,QAAQ,WAAW,QAAA;AAC/C,iBAAaF,UAAa1B,YAAiB;MAAE,GAAG,IAAI,EAAE,IAAI;MAAY,GAAG,OAAO,IAAI,gBAAgB;IAAG,GAAE,YAAY,aAAA,CAAc;EACtI,WACQ4B,WAAS,UAAU;AACxB,UAAM,OAAO,aAAa,YAAY;AACtC,UAAM,OAAO,gBAAgB;AAC7B,UAAM,sBAAsB;MACxB,GAAG,OAAO,IAAI,YAAY;MAC1B,GAAG,OAAO;IACb,GAAE,WAAW,QAAA;AACd,iBAAaF,UAAa1B,YAAiB;MAAE,GAAG,OAAO,IAAI;MAAM,GAAG,OAAO,IAAI;IAAM,GAAE,aAAa,WAAW,aAAA,CAAc;EAChI,OACI;AAED,iBAAa0B,UAAa1B,YAAiB;MAAE,GAAG,OAAO;MAAG,GAAG,OAAO,IAAI,gBAAgB;IAAG,GAAE,YAAY,aAAA,CAAc;AACvH,UAAM,sBAAsB;MAAE,GAAG,OAAO,IAAI,aAAa,YAAY;MAAK,GAAG,OAAO;IAAG,GAAE,WAAW,QAAA;EACvG;AACD,QAAM6B,UAAQC,OAAa;IACvB,WAAW,CAAA;IACX,WAAW,CAAA;IACX,IAAI;IACJ,IAAI;IACJ,IAAI;IACJ,WAAW,CAAA;IACX,WAAW,CAAA;EACd,GAAExE,eAAa,MAAA;AAChB,SAAOuE;AACV;ACvDD,IAAa,QAAQ,CAAC7E,IAAG,OAAO,QAAQ;AACpC,MAAIA,OAAM,OACN,OAAM,IAAI,MAAM,mBAAmB;AACvChH,UAAYgH,GAAE,GAAG,OAAO,IAAI;AAC5BhH,UAAYgH,GAAE,GAAG,OAAO,IAAI;AAC5BhH,UAAYgH,GAAE,GAAG,OAAO,IAAI;AAC/B;AAMD,IAAa,aAAa,CAACxH,OAAM;AAC7B,MAAIA,OAAM,OACN,QAAO;AACX,QAAM,MAAMA;AACZ,MAAI,CAAC,QAAQ,IAAI,CAAA,EACb,QAAO;AACX,MAAI,CAAC,QAAQ,IAAI,CAAA,EACb,QAAO;AACX,MAAI,CAAC,QAAQ,IAAI,CAAA,EACb,QAAO;AACX,SAAO;AACV;AAMD,IAAaI,aAAU,CAACoH,OAAM+E,SAAc/E,GAAE,CAAA,KAAM+E,SAAc/E,GAAE,CAAA,KAAM+E,SAAc/E,GAAE,CAAA;AAM1F,IAAa9G,kBAAgB,CAAC8G,OAAMgF,cAAoBhF,GAAE,CAAA,KACtDgF,cAAoBhF,GAAE,CAAA,KACtBgF,cAAoBhF,GAAE,CAAA;AAO1B,IAAa7F,YAAU,CAACZ,IAAGC,OAAMiC,SAAclC,GAAE,GAAGC,GAAE,CAAA,KAClDiC,SAAclC,GAAE,GAAGC,GAAE,CAAA,KACrBiC,SAAclC,GAAE,GAAGC,GAAE,CAAA;AC9CzB,IAAa,WAAW,CAACwG,OAAM;AAC3B,QAAMA,EAAA;AACN,QAAMQ,SAAQyE,QAAa;IAACjF,GAAE;IAAGA,GAAE;IAAGA,GAAE;EAAE,GAAE,CAACxH,IAAG,iBAAiB;IAC7D,GAAGA,GAAE,IAAI,YAAY;IACrB,GAAGA,GAAE,IAAI,YAAY;EACxB,EAAA;AACD,QAAM,MAAM;IACR,GAAGgI,OAAM,IAAI;IACb,GAAGA,OAAM,IAAI;EAChB;AACD,SAAO;AACV;ACHD,IAAa,cAAc,CAAC,OAAO,OAAO,CAAE,MAAK;AAC7C,MAAI,mBAAmB,KAAA,EACnB,QAAO0E,cAAkB,OAAO,IAAA;WAE3B,iBAAiB,KAAA,EACtB,QAAOC,cAAgB,OAAO,IAAA;AAElC,QAAM,IAAI,MAAM,wEAAwE;AAC3F;AAWD,IAAazL,WAAS,CAAC,UAAU;AAC7B,MAAI,UAAU,OACV,QAAO,OAAO,OAAO;IAAE,GAAG;IAAK,GAAG;EAAK,CAAA;WAElC,OAAO,KAAA,EACZ,QAAO0L,SAAW,KAAA;WAEb,WAAW,KAAA,EAChB,QAAOC,SAAiB,KAAA;WAEnB,SAAS,KAAA,EACd,QAAOC,OAAa,KAAA;MAGpB,OAAM,IAAI,MAAM,kBAAkB,KAAK,UAAU,KAAA,CAAM,EAAE;AAEhE;ACvCD,IAAazK,mBAAiB,CAACtB,IAAGC,OAAM;AACpC,MAAI,mBAAmBD,EAAA,EACnB,QAAOgM,eAAsBhM,IAAGC,EAAA;WAE3B,iBAAiBD,EAAA,EACtB,QAAOiM,iBAAoBjM,IAAGC,EAAA;AAElC,QAAM,IAAI,MAAM,iCAAiC,KAAK,UAAUD,EAAA,CAAE,OAAO,KAAK,UAAUC,EAAA,CAAE,EAAE;AAC/F;ACaD,IAAa,YAAY,CAAC,aAAa,SAAS,GAAG,aAAa,SAAS8F,OAAY,SAAS;AAC1F,cAAY,YAAY,QAAQ,YAAY,QAAQ,CAAC;AACrD,QAAM,QAAS,KAAK,KAAK,IAAK;AAC9B,QAAM,YAAY,QAAQ;AAC1B,QAAM,eAAe,MAAM,sBAAsB,CAAC,KAAK,KAAK;AAC5D,MAAI,gBAAgB,OAChB,eAAc,cAAc;AAChC,MAAI/F,KAAI;AACR,QAAM,MAAM,CAAE;AACd,WAAS,QAAQ,GAAG,QAAQ,QAAQ,SAAS;AACzC,UAAM,OAAO,YAAY,aAAaA,IAAG,MAAA;AACzC,UAAM,OAAO,YAAY,aAAaA,KAAI,WAAW,MAAA;AACrD,UAAM,QAAQ,YAAY,aAAaA,KAAI,WAAW,MAAA;AACtD,QAAI,KAAK,MAAM,IAAA;AACf,QAAI,QAAQ,IAAI,OACZ,KAAI,KAAK,KAAA;AACb,IAAAA,MAAK;EACR;AACD,SAAO;AACV;;;;;;;;;;;;;;AEzCD,IAAa2B,eAAa,CAAC,WAAW,OAAO,CAAE,MAAK;AAChD,QAAM,QAAQ,kBAAkB,GAAG,SAAA;AACnC,SAAOuK,MAAK,MAAM,IAAI,CAAC5J,OAAM,OAAOA,EAAA,CAAE,GAAG,IAAA;AAC5C;AAUD,IAAa4J,QAAO,CAACjB,QAAO,OAAO,CAAE,MAAK;AAEtC,QAAM,sBAAsB,KAAK,uBAAuB;AACxD,QAAM,iBAAiB,CAAC7L,QAAO;AAC3B,UAAM,UAAU6L,OAAM,IAAI,CAAChM,IAAG,UAAU;AACpC,YAAMoH,YAAUpH,GAAE,QAAQG,GAAA;AAC1B,YAAMmC,aAAWE,UAAerC,KAAIiH,SAAAA;AAEpC,YAAM8F,oBAAmBlN,GAAE,iBAAiBoH,WAAS,mBAAA;AAErD,aAAO;QAAE,kBAAA8F;QAAkB,MAAMlN;QAAG;QAAO,SAAA;QAAS,UAAA;QAAU,MAAM,OAAO;MAAkB;IAChG,CAAA;AACD,UAAM,WAAW,QAAQ,OAAO,CAACkD,OAAMA,GAAE,YAAY,mBAAA;AACrD,UAAM,SAAS,sBAAsB,UAAU,UAAU;AAEzD,aAASiK,QAAO,GAAGA,QAAO,OAAO,QAAQA,QACrC,QAAOA,KAAA,EAAM,OAAOA;AAExB,WAAO;EACV;AAWD,SAAO;AACV;;;AC/CD,IAAa,SAAS,CAAC,SAAS,WAAW,OAAO,CAAE,MAAK;AACrD,MAAI,CAAC,MAAM,QAAQ,OAAA,EACf,OAAM,IAAI,MAAM,qCAAqC;AACzD,QAAM,WAAW,KAAK,YAAY;AAClC,QAAM,SAAS,sBAAsB,SAAS,QAAQ;AACtD,QAAM,oBAAoB,CAAE;AAC5B,QAAM,UAAU,CAACnM,IAAG,WAAW,kBAAkB,KAAK,CAAAkC,OAAK6J,eAAsB7J,IAAGlC,IAAG,MAAA,CAAO;AAC9F,SAAO,OAAO,SAAS,GAAG;AAEtB,UAAMS,UAAS,OAAO,IAAA;AACtB,QAAI,CAACA,QACD;AACJ,UAAM,kBAAkB;MAAE,GAAG;MAAM,QAAQ;QAAE,GAAGA,QAAO;QAAQ,GAAGA,QAAO;MAAQ;IAAE;AAEnF,aAAS,QAAQ,GAAG,QAAQ,UAAU,SAAS;AAC3C,YAAM,WAAW2L,YAAkB,WAAW,eAAA;AAC9C,UAAI,CAAC,QAAQ,UAAU3L,QAAO,MAAA,GAAS;AAEnC,0BAAkB,KAAK,OAAO,OAAO;UAAE,GAAGA;UAAQ,GAAG;QAAU,CAAA,CAAC;AAChE;MACH;IACJ;EACJ;AACD,SAAO;AACV;;;;;AE9BD,IAAa,cAAc,CAAC,SAAS,SAAS,cAAc,GAAG,gBAAgB,GAAG,cAAc,SAAS;EACrG;EAAS;EACT,UAAU,eAAe,WAAA;EACzB,YAAY,eAAe,aAAA;EAC3B,UAAU,eAAe,WAAA;AAC5B;;;;;;ACcD,IAAa,sBAAsB,CAAC,QAAQ4L,WAAU,QAAQ;AAC1D,QAAM,aAAa,OAAO,CAAA;AAE1B,QAAM,YAAY,OAAO,GAAG,EAAA;AAC5B,MAAI,OAAO,SAAS,EAChB,QAAO;AAEX,MAAI,QAAQ;AACZ,MAAI,eAAe;AACnB,WAAS,SAAS,GAAG,SAAS,OAAO,SAAS,GAAG,UAAU;AACvD,UAAM,gBAAgB,wBAAwB,OAAO,MAAA,GAAS,YAAY,SAAA;AAC1E,QAAI,gBAAgB,cAAc;AAC9B,qBAAe;AACf,cAAQ;IACX;EACJ;AACD,MAAI,eAAeA,UAAS;AAExB,UAAM,KAAK,OAAO,MAAM,GAAG,QAAQ,CAAA;AACnC,UAAMC,MAAK,OAAO,MAAM,KAAA;AACxB,UAAM,KAAK,oBAAoB,IAAID,QAAA;AACnC,UAAME,MAAK,oBAAoBD,KAAID,QAAA;AAEnC,UAAMG,MAAK,CAAC,GAAG,GAAG,MAAM,GAAG,EAAA,GAAK,GAAGD,GAAG;AACtC,WAAOC;EACV,MAEG,QAAO,CAAC,YAAY,SAAU;AAErC;AAoBD,IAAa,2BAA2B,CAAC,QAAQH,WAAU,QAAQ;AAC/D,QAAM,aAAa,OAAO,CAAA;AAE1B,QAAM,YAAY,OAAO,GAAG,EAAA;AAC5B,MAAI,OAAO,SAAS,EAChB,QAAO;AAEX,MAAI,QAAQ;AACZ,MAAI,eAAe;AACnB,WAAS,SAAS,GAAG,SAAS,OAAO,SAAS,GAAG,UAAU;AACvD,UAAM,gBAAgB,0BAA0B,OAAO,MAAA,GAAS,YAAY,SAAA;AAC5E,QAAI,gBAAgB,cAAc;AAC9B,qBAAe;AACf,cAAQ;IACX;EACJ;AACD,MAAI,eAAeA,UAAS;AAExB,UAAM,KAAK,OAAO,MAAM,GAAG,QAAQ,CAAA;AACnC,UAAMC,MAAK,OAAO,MAAM,KAAA;AACxB,UAAM,KAAK,yBAAyB,IAAID,QAAA;AACxC,UAAME,MAAK,yBAAyBD,KAAID,QAAA;AAExC,UAAMG,MAAK,CAAC,GAAG,GAAG,MAAM,GAAG,EAAA,GAAK,GAAGD,GAAG;AACtC,WAAOC;EACV,MAEG,QAAO,CAAC,YAAY,SAAU;AAErC;AACD,SAAS,0BAA0BxN,IAAG,IAAIyN,KAAI;AAE1C,MAAI;AACJ,MAAIC;AACJ,MAAI;AACJ,MAAI,GAAG,KAAKD,IAAG,EACX,UAAS,KAAK,IAAIzN,GAAE,IAAI,GAAG,CAAA;OAE1B;AACD0N,eAASD,IAAG,IAAI,GAAG,MAAMA,IAAG,IAAI,GAAG;AACnC,gBAAY,GAAG,IAAKC,UAAQ,GAAG;AAC/B,aAAS,KAAK,IAAIA,UAAQ1N,GAAE,IAAIA,GAAE,IAAI,SAAA,IAAa,KAAK,KAAK,KAAK,IAAI0N,SAAO,CAAA,IAAK,CAAA;EACrF;AACD,SAAO;AACV;AACD,IAAM,0BAA0B,CAAC1N,IAAG,OAAO,WAAW;AAClD,QAAM,aAAasC,UAAS,OAAO,MAAA;AACnC,MAAI,cAAc,EACd,QAAOA,UAAStC,IAAG,KAAA;AAEvB,QAAMwH,OAAMxH,GAAE,IAAI,MAAM,MAAM,OAAO,IAAI,MAAM,MAAMA,GAAE,IAAI,MAAM,MAAM,OAAO,IAAI,MAAM,MAAM;AAG9F,MAAIwH,KAAI,EACJ,QAAOlF,UAAStC,IAAG,KAAA;AAEvB,MAAIwH,KAAI,EACJ,QAAOlF,UAAStC,IAAG,MAAA;AAEvB,SAAOsC,UAAStC,IAAG;IAAE,GAAG,MAAM,IAAIwH,MAAK,OAAO,IAAI,MAAM;IAAI,GAAG,MAAM,IAAIA,MAAK,OAAO,IAAI,MAAM;EAAI,CAAA;AACtG;;;;;;;ACzHD,IAAW;CACV,SAAUmG,aAAW;AAClBA,cAAUA,YAAU,IAAA,IAAQ,CAAA,IAAK;AACjCA,cAAUA,YAAU,IAAA,IAAQ,CAAA,IAAK;AACjCA,cAAUA,YAAU,IAAA,IAAQ,CAAA,IAAK;AACjCA,cAAUA,YAAU,IAAA,IAAQ,CAAA,IAAK;AACpC,GAAE,cAAc,YAAY,CAAE,EAAA;AAQ/B,IAAa,WAAW,CAAC,QAAQ,cAAc,CAAE,GAAE,OAAO,CAAE,MAAK;AAC7D,QAAMnH,KAAI;IACN,UAAU,KAAK,YAAY;IAC3B,WAAW,KAAK,aAAa;EAChC;AACD,QAAMa,KAAI,IAAI,aAAa,QAAW,QAAQ,GAAGb,EAAA;AACjD,aAAWnG,MAAK,YACZ,CAAAgH,GAAE,IAAIhH,EAAA;AAEV,SAAOgH;AACV;AAOD,IAAa,eAAb,MAAauG,cAAa;EACtB;EACA;EACA;EACA,SAAS,CAAE;EACX,YAAY,CAAE;EACd;;;;;;;EAOA,YAAY,QAAQ,UAAU,OAAO,MAAM;AACvC,SAAK,WAAW;AAChB,SAAK,QAAQ;AACb,SAAK,OAAO;AACZ,SAAKC,UAAU;EAClB;EACD,oBAAoB;AAChB,WAAO,KAAKC,UAAU;EACzB;EACD,CAAC,UAAU;AAEP,QAAIzG,KAAI;AACR,WAAOA,GAAEwG,YAAY,QAAW;AAC5B,YAAMxG,GAAEwG;AACR,MAAAxG,KAAIA,GAAEwG;IACT;EACJ;EACD,YAAY;AACR,WAAO,KAAKA;EACf;;;;EAID,CAAC,WAAW;AACR,eAAW5M,MAAK,KAAK6M,UACjB,OAAM7M;EAEb;;;;;EAKD,WAAW;AACP,WAAO,KAAK8M;EACf;EACD,cAAc;AACV,WAAO;EACV;;;;;;EAMD,UAAU1N,IAAG;AACT,WAAO,KAAKyN,UAAUzN,EAAA;EACzB;;;;;;EAMD,IAAIL,IAAG;AACH,QAAI,CAAA,iBAAuB,KAAK,UAAUA,EAAA,EACtC,QAAO;AACX,QAAI,KAAK8N,UAAU,SAAS,GAAG;AAC3B,iBAAWzN,MAAK,KAAKyN,UAChB,CAAAzN,GAAG,IAAIL,EAAA;AACZ,aAAO;IACV;AACD,SAAK+N,OAAO,KAAK/N,EAAA;AACjB,QAAI,KAAK+N,OAAO,SAAS,KAAK,KAAK,YAC/B,KAAK,QAAQ,KAAK,KAAK,WAAW;AAClC,UAAI,KAAKD,UAAU,WAAW,EAC1B,MAAKE,WAAAA;AAGT,iBAAW,QAAQ,KAAKD,OACpB,YAAW1N,MAAK,KAAKyN,UAChB,CAAAzN,GAAG,IAAI,IAAA;AAGhB,WAAK0N,SAAS,CAAE;IACnB;AACD,WAAO;EACV;;;;;;EAMD,UAAU/N,IAAG;AACT,WAAOiO,gBAAqB,KAAK,UAAUjO,EAAA;EAC9C;EACD,aAAa;AACT,UAAMoB,KAAI,KAAK,SAAS,QAAQ;AAChC,UAAMC,KAAI,KAAK,SAAS,SAAS;AACjC,UAAMR,KAAI,KAAK,SAAS;AACxB,UAAMC,KAAI,KAAK,SAAS;AAExB,UAAM,SAASoN,YAAkBrN,KAAIO,IAAGN,IAAGD,IAAGC,IAAGD,IAAGC,KAAIO,IAAGR,KAAIO,IAAGN,KAAIO,EAAA;AACtE,UAAM,QAAQ,OAAO,IAAI,CAACrB,OAAMwK,YAAiBxK,IAAGoB,IAAGC,EAAA,CAAE;AAIzD,SAAKyM,YAAY,MAAM,IAAI,CAAC3M,OAAM,IAAIyM,cAAa,MAAMzM,IAAG,KAAK,QAAQ,GAAG,KAAK,IAAA,CAAA;EACpF;AACJ;ACnHD,IAAagN,UAAS,CAAC,UAAU,QAAQ,gBAAgB;AACrD,QAAM,gBAAgB,eAAeC;AACrC,MAAI,KAAK;AACT,MAAIC,MAAK;AACT,MAAItI,KAAI;IAAE,GAAG;IAAG,GAAG;EAAG;AACtB,QAAM,eAAe,MAAM;AACvB,YAAQ,SAAR;MACI,KAAK;AACD,eAAO;UAAE,GAAGsI;UAAI,GAAGA;QAAI;MAE3B,KAAK;AACD,eAAO;UAAE,GAAG;UAAI,GAAG;QAAI;MAE3B,KAAK;AACD,eAAO;UAAE,GAAG,KAAK,IAAI,IAAIA,GAAA;UAAK,GAAG,KAAK,IAAI,IAAIA,GAAA;QAAK;MAEvD,KAAK;AACD,eAAO;UAAE,GAAG,KAAK,IAAI,IAAIA,GAAA;UAAK,GAAG,KAAK,IAAI,IAAIA,GAAA;QAAK;MAEvD;AACI,eAAO;UAAE,GAAG;UAAI,GAAGA;QAAI;IAE9B;EACJ;AACD,QAAMhI,cAAY,CAACtF,IAAGC,IAAGC,IAAGZ,OAAM;AAC9B,QAAI,MAAM;AACV,QAAI,MAAM;AACV,QAAI,OAAO,cAAc;AACzB,QAAI,OAAO,cAAc;AACzB,QAAI,OAAOU,OAAM,UAAU;AACvB,YAAMA;AACN,UAAI,OAAOC,OAAM,UAAU;AACvB,cAAMA;AACN,YAAIC,OAAM,OACN,QAAO;UAAC;UAAK;UAAK;UAAM;QAAK;AACjC,YAAI,OAAOA,EAAA,GAAI;AACX,iBAAOA,GAAE;AACT,iBAAOA,GAAE;QACZ,WACQ,OAAOA,OAAM,UAAU;AAC5B,iBAAOA;AACP,cAAI,OAAOZ,OAAM,SACb,QAAOA;cAGP,OAAM,IAAI,UAAU,4BAA4B;QAEvD,MAEG,OAAM,IAAI,MAAM,4BAA4B;MACnD,WACQ,OAAOW,EAAA,GAAI;AAChB,eAAOA,GAAE;AACT,eAAOA,GAAE;MACZ,MAEG,OAAM,IAAI,MAAM,kEAAkE;IAEzF,WACQ,QAAQD,EAAA,GAAI;AACjB,YAAMA,GAAE;AACR,YAAMA,GAAE;AACR,UAAIC,OAAM,OACN,QAAO;QAAC;QAAK;QAAK;QAAM;MAAK;AACjC,UAAI,OAAOA,EAAA,GAAI;AACX,eAAOA,GAAE;AACT,eAAOA,GAAE;MACZ,WACQ,OAAOA,OAAM,UAAU;AAC5B,eAAOA;AACP,YAAI,OAAOC,OAAM,SACb,QAAOA;YAGP,OAAM,IAAI,UAAU,iEAAiE;MAE5F,MAEG,OAAM,IAAI,UAAU,4EAA4E;IAEvG,MAEG,OAAM,IAAI,MAAM,oDAAoD;AAExE,WAAO;MAAC;MAAK;MAAK;MAAM;IAAK;EAChC;AACD,QAAM,WAAW,CAACF,IAAGC,IAAGC,IAAGZ,OAAM;AAC7B,UAAMgH,KAAIhB,YAAUtF,IAAGC,IAAGC,IAAGZ,EAAA;AAC7B,WAAO,gBAAgB,MAAM,GAAGgH,EAAA;EACnC;AACD,QAAM,WAAW,CAACtG,IAAGC,IAAGC,IAAGZ,OAAM;AAC7B,UAAMgH,KAAIhB,YAAUtF,IAAGC,IAAGC,IAAGZ,EAAA;AAC7B,WAAO,gBAAgB,OAAO,GAAGgH,EAAA;EACpC;AACD,QAAM,kBAAkB,CAACpD,QAAKpD,IAAGC,IAAGM,IAAGC,OAAM;AACzC,QAAI,OAAO,MAAMD,EAAA,EACb,OAAM,IAAI,MAAM,4BAA4B;AAChD,QAAI,OAAO,MAAMC,EAAA,EACb,OAAM,IAAI,MAAM,6BAA6B;AAEjD,QAAID,OAAM,MAAMC,OAAMgN,KAAI;AACtB,WAAKjN;AACL,MAAAiN,MAAKhN;AACL,MAAA0E,KAAI,aAAA;IACP;AACD,WAAO9B,SAAM;MACT,GAAGpD,KAAIkF,GAAE;MACT,GAAGjF,KAAIiF,GAAE;IACZ,IAAG;MACA,GAAGlF,KAAIkF,GAAE;MACT,GAAGjF,KAAIiF,GAAE;IACZ;EACJ;AACD,SAAO;IACH;IACA,KAAK;IACL,KAAK;IACL,OAAO,cAAc;IACrB,QAAQ,cAAc;EACzB;AACJ;;;;;;;ACvJD,IAAMuI,OAAM,KAAK;AACjB,IAAMC,OAAM,KAAK;AACjB,IAAM,OAAO,KAAK;AAClB,IAAMC,QAAO,KAAK;AAClB,IAAMC,OAAM,KAAK;AACjB,IAAM9H,MAAK,KAAK;AAChB,IAAMzC,SAAO,KAAK,KAAK;AACvB,IAAM,cAAcyC,OAAM,IAAI6H,MAAK,CAAA;AACnC,IAAM,iBAAiB,IAAIA,MAAK,CAAA,KAAM;AA+BtC,UAAiB,kBAAkB/M,SAAQ,OAAO,CAAE,GAAE;AAClD,QAAM,YAAY,KAAK,aAAa;AACpC,QAAM,UAAU,KAAK,WAAW;AAChC,QAAM,iBAAiB,KAAK,YAAY;AACxC,QAAMR,KAAIyN,aAAmBjN,WAAU;IAAE,QAAQ;IAAG,GAAG;IAAG,GAAG;EAAG,CAAA;AAChE,QAAMkD,OAAM1D,GAAE;AAEd,MAAI,UAAUA,GAAE,SAAS,MAAM,SAAS,GAAG,GAAG,KAAK,IAAA;AACnD,MAAI,KAAK,QACL,WAAU,KAAK;AAEnB,MAAI,SAAS;AAEb,MAAIyH,SAAQ;AAEZ,MAAI,QAAQ;AACZ,SAAOA,SAAQ,aAAa,SAAS/D,MAAK;AACtC,aAAS,UAAU+D,UAAS;AAC5B,YAAQ,iBAAkBA,SAAQ,IAAI/B,MAAM;AAC5C,UAAM,OAAO,OAAO;MAChB,GAAG1F,GAAE,IAAI,SAASqN,KAAI,KAAA;MACtB,GAAGrN,GAAE,IAAI,SAASsN,KAAI,KAAA;IACzB,CAAA;AACD,IAAA7F;EACH;AACJ;AAmBD,UAAiB,YAAYjH,SAAQ,OAAO,CAAE,GAAE;AAC5C,QAAM,QAAQ,KAAK,SAAS;AAC5B,QAAMR,KAAIyN,aAAmBjN,WAAU;IAAE,QAAQ;IAAG,GAAG;IAAG,GAAG;EAAG,CAAA;AAChE,QAAM,QAAQ,IAAI;AAClB,QAAM,iBAAiB,KAAK,YAAY;AAExC,MAAI,YAAY;AAEhB,QAAM,OAAO,OAAO;IAAE,GAAGR,GAAE;IAAG,GAAGA,GAAE;EAAG,CAAA;AAEtC,WAASE,KAAI,OAAOA,MAAK,GAAGA,MAAK,OAAO;AACpC,UAAMkG,KAAI,KAAK,MAAMV,MAAK,KAAK,KAAK,IAAI,UAAA,CAAW;AACnD,eAAW,SAAS,YAAY,GAAGzC,QAAMmD,KAAI,CAAA,EACzC,OAAM,OAAO,OAAO;MAChB,GAAGpG,GAAE,IAAIE,KAAImN,KAAI,QAAQ,cAAA,IAAkBrN,GAAE;MAC7C,GAAGA,GAAE,IAAIE,KAAIoN,KAAI,QAAQ,cAAA,IAAkBtN,GAAE;IAChD,CAAA;AAEL;EACH;AACJ;AAuBD,UAAiB,gBAAgB,UAAU,KAAK,kBAAkB,GAAG,QAAQ;AACzE,QAAM4J,WAAS,IAAI;AACnB,QAAM9E,KAAI,UAAU;IAAE,GAAG;IAAG,GAAG;IAAG,GAAG;IAAG,QAAQ;EAAG;AACnD,WAAS,QAAQ,GAAG,QAAQ,SAAS,SAAS;AAC1C,UAAMjF,KAAI,QAAQ+J,WAAS,IAAIA,WAAS;AACxC,UAAM1J,KAAIqN,MAAK,IAAIC,KAAI3N,IAAG,CAAA,CAAE;AAC5B,UAAMC,MAAM,QAAQ,KAAK,UAAW,cAAc;AAClD,UAAMF,KAAIyN,KAAIvN,EAAA,IAAKI;AACnB,UAAMoB,KAAIgM,KAAIxN,EAAA,IAAKI;AAEnB,UAAM,OAAO,OAAO;MAChB,GAAG4E,GAAE,IAAIlF,KAAIkF,GAAE;MACf,GAAGA,GAAE,IAAIjF,KAAIiF,GAAE;MACf,GAAGA,GAAE,IAAIxD,KAAIwD,GAAE;IAClB,CAAA;EACJ;AACJ;ACxID,IAAa,SAAS,CAACyB,OAAM;AACzB,QAAMA,EAAA;AACN,SAAO;IACHmH,YAAkBnH,GAAE,GAAGA,GAAE,CAAA;IACzBmH,YAAkBnH,GAAE,GAAGA,GAAE,CAAA;IACzBmH,YAAkBnH,GAAE,GAAGA,GAAE,CAAA;EAC5B;AACJ;AAMD,IAAa,gBAAgB,CAACA,OAAM;AAChC,QAAMA,EAAA;AACN,SAAO,eAAe,OAAOA,EAAA,CAAE;AAClC;ACjBD,IAAa7E,SAAQ,CAAC6E,OAAM;AACxB,QAAMA,EAAA;AACN,SAAO,kBAAkBA,GAAE,GAAGA,GAAE,GAAGA,GAAE,GAAGA,GAAE,CAAA;AAC7C;ACFD,IAAa7G,SAAO,CAAC6G,OAAM;AACvB,QAAMA,IAAG,GAAG;AAEZ,QAAMpE,YAAUT,OAAM6E,EAAA,EAAG,IAAI,CAACnE,OAAMC,OAAYD,EAAA,CAAE;AAElD,QAAMrD,MAAKoD,UAAQ,CAAA,IAAKA,UAAQ,CAAA,IAAKA,UAAQ,CAAA,KAAM;AACnD,SAAO,KAAK,KAAKpD,MAAKA,KAAIoD,UAAQ,CAAA,MAAOpD,KAAIoD,UAAQ,CAAA,MAAOpD,KAAIoD,UAAQ,CAAA,EAAA;AAC3E;ACLD,IAAa,mBAAmB,CAACoE,IAAGzG,IAAGC,OAAM;AACzC,QAAMb,MAAK,kBAAkBY,IAAGC,EAAA;AAChC,QAAM,KAAK,CAACH,IAAGC,IAAG8N,KAAI,QAAQA,IAAG,IAAI,GAAG,KAAK/N,MAAK,GAAG,IAAI+N,IAAG,KAAK9N,KAAI8N,IAAG,IAAI,GAAG,IAAI,GAAG,IAAIA,IAAG;AAC7F,QAAM,QAAQ,GAAGzO,IAAG,GAAGA,IAAG,GAAGqH,GAAE,GAAGA,GAAE,CAAA,IAAK,GAAGA,GAAE,EAAE,GAAGA,GAAE,EAAE,GAAGA,GAAE,GAAGA,GAAE,CAAA;AACjE,QAAM,QAAQ,GAAGrH,IAAG,GAAGA,IAAG,GAAGqH,GAAE,GAAGA,GAAE,CAAA,IAAK,GAAGA,GAAE,EAAE,GAAGA,GAAE,EAAE,GAAGA,GAAE,GAAGA,GAAE,CAAA;AACjE,QAAM,QAAQ,GAAGrH,IAAG,GAAGA,IAAG,GAAGqH,GAAE,GAAGA,GAAE,CAAA,IAAK,GAAGA,GAAE,EAAE,GAAGA,GAAE,EAAE,GAAGA,GAAE,GAAGA,GAAE,CAAA;AACjE,SAAO;IACH,GAAG;IACH,GAAG;IACH,GAAG;EACN;AACJ;AAOD,IAAa,0BAA0B,CAACA,IAAG,OAAO;AAC9C,QAAMA,EAAA;AACN,QAAM,EAAE,GAAAzG,IAAG,GAAAC,IAAG,GAAAC,GAAA,IAAMuG;AACpB,QAAM3G,KAAIE,GAAE,IAAI,GAAG,IAAIC,GAAE,IAAI,GAAG,IAAIC,GAAE,IAAI,GAAG;AAC7C,QAAMH,KAAIC,GAAE,IAAI,GAAG,IAAIC,GAAE,IAAI,GAAG,IAAIC,GAAE,IAAI,GAAG;AAC7C,MAAIF,GAAE,KAAKC,GAAE,KAAKC,GAAE,GAAG;AACnB,UAAMsB,KAAIxB,GAAE,IAAI,GAAG,IAAIC,GAAE,IAAI,GAAG,IAAIC,GAAE,IAAI,GAAG;AAC7C,WAAO,OAAO,OAAO;MAAE,GAAAJ;MAAG,GAAAC;MAAG,GAAAyB;IAAG,CAAA;EACnC,MAEG,QAAO,OAAO,OAAO;IAAE,GAAA1B;IAAG,GAAAC;EAAG,CAAA;AAEpC;AClCD,IAAa,OAAO,CAAC0G,IAAG,YAAY,MAAM;AACtC,QAAM,EAAE,GAAAzG,IAAG,GAAAC,IAAG,GAAAC,GAAA,IAAMuG;AACpB,QAAM,OAAO,KAAK,IAAIzG,GAAE,GAAGC,GAAE,GAAGC,GAAE,CAAA,IAAK;AACvC,QAAM,OAAO,KAAK,IAAIF,GAAE,GAAGC,GAAE,GAAGC,GAAE,CAAA,IAAK;AACvC,QAAM,OAAO,KAAK,IAAIF,GAAE,GAAGC,GAAE,GAAGC,GAAE,CAAA,IAAK;AACvC,QAAM,OAAO,KAAK,IAAIF,GAAE,GAAGC,GAAE,GAAGC,GAAE,CAAA,IAAK;AACvC,QAAME,KAAI;IACN,GAAG;IACH,GAAG;IACH,OAAO,OAAO;IACd,QAAQ,OAAO;EAClB;AACD,SAAOA;AACV;ACbD,IAAa,UAAU,CAACqG,OAAM;AAC1B,QAAMA,EAAA;AACN,SAAO;IAACA,GAAE;IAAGA,GAAE;IAAGA,GAAE;EAAE;AACzB;ACYD,IAAa,aAAa,CAAC,QAAQ,QAAQ,OAAO,CAAE,MAAK;AACrD,cAAY,WAAW,QAAQ,YAAY,QAAQ,CAAC;AACpDqH,UAAW,QAAQ,QAAQ;AAC3B,QAAM,qBAAqB,KAAK,sBAAsB;AACtD,QAAMC,WAAS;IACX;IACA,qBAAsB5K,QAAO,IAAK;IAClC,qBAAsBA,QAAO,IAAK;EACrC;AACD,QAAM,SAAS4K,SAAO,IAAI,CAAC/N,OAAMsI,YAAiB,QAAQtI,IAAG,MAAA,CAAO;AACpE,SAAO,WAAW,MAAA;AACrB;AAOD,IAAa,gBAAgB,CAAC,WAAW;AACrC,MAAI,CAAC,MAAM,QAAQ,MAAA,EACf,OAAM,IAAI,MAAM,0BAA0B;AAC9C,MAAI,OAAO,WAAW,EAClB,OAAM,IAAI,MAAM,8CAA8C,OAAO,MAAA,EAAQ;AAEjF,SAAO,WAAWmN,YAAkB,GAAG,MAAA,CAAO;AACjD;AAMD,IAAa,aAAa,CAAC,WAAW;AAClC,MAAI,CAAC,MAAM,QAAQ,MAAA,EACf,OAAM,IAAI,MAAM,0BAA0B;AAC9C,MAAI,OAAO,WAAW,EAClB,OAAM,IAAI,MAAM,8CAA8C,OAAO,MAAA,EAAQ;AAEjF,QAAM1G,KAAI;IACN,GAAG,OAAO,CAAA;IACV,GAAG,OAAO,CAAA;IACV,GAAG,OAAO,CAAA;EACb;AACD,SAAOA;AACV;ACxDD,IAAa7D,cAAY,CAAC6D,OAAM;AAC5B,QAAMA,EAAA;AACN,SAAO7E,OAAM6E,EAAA,EAAG,OAAO,CAAC,aAAatE,OAAM,cAAcI,OAAYJ,EAAA,GAAI,CAAA;AAC5E;ACJD,IAAa,cAAc,CAACsE,OAAM;AAC9B,QAAMvG,KAAI,SAASuG,EAAA;AACnB,QAAMxH,KAAI2D,YAAU6D,EAAA,IAAK;AACzB,QAAMzG,KAAIJ,OAAK6G,EAAA;AACf,QAAM,SAASzG,KAAIf;AACnB,SAAO;IAAE;IAAQ,GAAGiB;EAAG;AAC1B;ACHD,IAAa8N,oBAAkB,CAACvH,IAAGzG,IAAGC,OAAM;AACxC,QAAM,MAAM,KAAKwG,EAAA;AACjB,QAAMrH,MAAK,kBAAkBY,IAAGC,EAAA;AAEhC,MAAI,CAACiN,gBAAqB,KAAK9N,GAAA,EAC3B,QAAO;AACX,QAAM,KAAK,iBAAiBqH,IAAGrH,GAAA;AAC/B,SAAQ,KAAK,GAAG,KAAK,GAAG,KAAK,KAAK,KAAK,GAAG,KAAK,GAAG,KAAK,KAAK,KAAK,GAAG,KAAK,GAAG,KAAK;AACpF;ACXD,IAAa,UAAU,CAACqH,OAAM;AAC1B,QAAMA,EAAA;AACN,SAAO;IACHlF,UAASkF,GAAE,GAAGA,GAAE,CAAA;IAChBlF,UAASkF,GAAE,GAAGA,GAAE,CAAA;IAChBlF,UAASkF,GAAE,GAAGA,GAAE,CAAA;EACnB;AACJ;ACND,IAAa,gBAAgB,CAACA,OAAM;AAChC,QAAMA,EAAA;AACN,QAAM,CAACzG,IAAGC,IAAGC,EAAA,IAAK,QAAQuG,EAAA;AAC1B,SAAOzG,OAAMC,MAAKA,OAAMC;AAC3B;AAMD,IAAa,cAAc,CAACuG,OAAM;AAC9B,QAAM,CAACzG,IAAGC,IAAGC,EAAA,IAAK,QAAQuG,EAAA;AAC1B,MAAIzG,OAAMC,GACN,QAAO;AACX,MAAIA,OAAMC,GACN,QAAO;AACX,MAAIA,OAAMF,GACN,QAAO;AACX,SAAO;AACV;AAMD,IAAa,eAAe,CAACyG,OAAM,OAAOA,EAAA,EAAG,SAAS,KAAK,KAAK,CAAA;AAMhE,IAAa,YAAY,CAACA,OAAM,CAAC,aAAaA,EAAA;AAM9C,IAAa,UAAU,CAACA,OAAM,CAAC,OAAOA,EAAA,EAAG,KAAK,CAACtE,OAAMA,MAAK,KAAK,KAAK,CAAA;AAMpE,IAAa,WAAW,CAACsE,OAAM,OAAOA,EAAA,EAAG,KAAK,CAACtE,OAAMA,KAAI,KAAK,KAAK,CAAA;AClCnE,IAAa,QAAQ,CAACsE,IAAGnD,QAAO,OAAO,OAAO;EAC1C,GAAGmD;EACH,GAAGnD,IAAGmD,GAAE,GAAG,GAAG;EACd,GAAGnD,IAAGmD,GAAE,GAAG,GAAG;EACd,GAAGnD,IAAGmD,GAAE,GAAG,GAAG;AACjB,CAAA;ACdD,IAAa,cAAc,CAACA,OAAM;AAC9B,QAAM,CAACzG,IAAGC,IAAGC,EAAA,IAAK0B,OAAM6E,EAAA,EAAG,IAAI,CAACnE,OAAMC,OAAYD,EAAA,CAAE;AACpD,QAAM,OAAO,SAASmE,EAAA;AACtB,QAAM,SAAUzG,KAAIC,KAAIC,KACpB,KAAK,MAAMF,KAAIC,KAAIC,OAAM,CAACF,KAAIC,KAAIC,OAAMF,KAAIC,KAAIC,OAAMF,KAAIC,KAAIC,GAAA;AAClE,SAAO;IACH;IACA,GAAG;EACN;AACJ;ACGD,IAAa+E,WAAS,CAACgJ,WAAU,cAAc,WAAW;AACtD,MAAI,iBAAiB,UAAa,iBAAiB,EAC/C,QAAOA;AACX,MAAI,WAAW,OACX,UAAS,SAASA,SAAA;AACtB,SAAO,OAAO,OAAO;IACjB,GAAGA;IACH,GAAG1C,OAAa0C,UAAS,GAAG,cAAc,MAAA;IAC1C,GAAG1C,OAAa0C,UAAS,GAAG,cAAc,MAAA;IAC1C,GAAG1C,OAAa0C,UAAS,GAAG,cAAc,MAAA;EAC7C,CAAA;AACJ;AAcD,IAAa,iBAAiB,CAACA,WAAU,cAAc,SAAS,QAAQ;AACpE,QAAM,SAAS,WAAW,MAAMA,UAAS,IAAK,WAAW,MAAMA,UAAS,IAAIA,UAAS;AACrF,SAAO,OAAO,OAAO;IACjB,GAAG1C,OAAa0C,UAAS,GAAG,cAAc,MAAA;IAC1C,GAAG1C,OAAa0C,UAAS,GAAG,cAAc,MAAA;IAC1C,GAAG1C,OAAa0C,UAAS,GAAG,cAAc,MAAA;EAC7C,CAAA;AACJ;AC7CD,IAAa,cAAc,CAACxH,OAAM;AAC9B,QAAMA,EAAA;AACN,SAAO;IAACA,GAAE,EAAE;IAAGA,GAAE,EAAE;IAAGA,GAAE,EAAE;IAAGA,GAAE,EAAE;IAAGA,GAAE,EAAE;IAAGA,GAAE,EAAE;EAAE;AACpD;;;;;;;;;;;;;ACVD,IAAM,WAAY,KAAK,KAAK,IAAK;AACjC,IAAM,WAAY,KAAK,KAAK,IAAK;AACjC,IAAM,gBAAgB,CAACA,OAAM;AACzB,MAAI,OAAOA,OAAM,SACb,QAAOA;AACX,SAAOA,GAAE;AACZ;AAkBD,IAAa1E,eAAa,CAAC0E,IAAG,QAAQ,gBAAgB;AAClD,MAAI,CAAC,OACD,UAAS,OAAO,OAAO;IAAE,GAAG;IAAG,GAAG;EAAG,CAAA;AACzC,QAAMrG,KAAI,cAAcqG,EAAA,IAAK,KAAK,KAAK,CAAA;AACvC,QAAM,MAAM,eAAe,KAAK,KAAK;AACrC,QAAMxG,KAAI;IACN,GAAGG,KAAI,KAAK,IAAI,GAAA,IAAO,OAAO;IAC9B,GAAGA,KAAI,KAAK,IAAI,GAAA,IAAO,OAAO;EACjC;AACD,QAAMJ,KAAI;IACN,GAAGI,KAAI,KAAK,IAAI,MAAM,QAAA,IAAY,OAAO;IACzC,GAAGA,KAAI,KAAK,IAAI,MAAM,QAAA,IAAY,OAAO;EAC5C;AACD,QAAMF,KAAI;IACN,GAAGE,KAAI,KAAK,IAAI,MAAM,QAAA,IAAY,OAAO;IACzC,GAAGA,KAAI,KAAK,IAAI,MAAM,QAAA,IAAY,OAAO;EAC5C;AACD,SAAO,OAAO,OAAO;IAAE,GAAAJ;IAAG,GAAAC;IAAG,GAAAC;EAAG,CAAA;AACnC;AAOD,IAAa,cAAc,CAACuG,IAAG,QAAQ;AACnC,MAAI,CAAC,IACD,OAAM,OAAO,OAAO;IAAE,GAAG;IAAG,GAAG;EAAG,CAAA;AACtC,QAAMrG,KAAI,cAAcqG,EAAA;AACxB,QAAM,EAAE,OAAA,IAAWyH,WAASzH,EAAA;AAC5B,SAAO;IACH,GAAG,IAAI,IAAIrG,KAAI;IACf,GAAG,IAAI,IAAI;EACd;AACJ;AAOD,IAAa,cAAc,CAACqG,IAAG,QAAQ;AACnC,MAAI,CAAC,IACD,OAAM,OAAO,OAAO;IAAE,GAAG;IAAG,GAAG;EAAG,CAAA;AACtC,QAAM,EAAE,OAAA,IAAWyH,WAASzH,EAAA;AAC5B,SAAO;IACH,GAAG,IAAI;IACP,GAAG,IAAI,IAAI,SAAS;EACvB;AACJ;AAOD,IAAa,cAAc,CAACA,IAAG,QAAQ;AACnC,MAAI,CAAC,IACD,OAAM,OAAO,OAAO;IAAE,GAAG;IAAG,GAAG;EAAG,CAAA;AACtC,QAAMrG,KAAI,cAAcqG,EAAA;AACxB,QAAM,EAAE,OAAA,IAAWyH,WAASzH,EAAA;AAC5B,SAAO;IACH,GAAG,IAAI,IAAIrG,KAAI;IACf,GAAG,IAAI,IAAI;EACd;AACJ;AAeD,IAAaP,WAAS,CAAC4G,OAAO,KAAK,KAAK,CAAA,IAAK,IAAK,cAAcA,EAAA;AAChE,IAAa7D,cAAY,CAAC6D,OAAM,cAAcA,EAAA,IAAK;AACnD,IAAa7G,SAAO,CAAC6G,OAAO,KAAK,IAAI,cAAcA,EAAA,GAAI,CAAA,IAAK,KAAK,KAAK,CAAA,IAAM;AAK5E,IAAa0H,iBAAe,CAAC1H,QAAO,EAChC,QAAS,KAAK,KAAK,CAAA,IAAK,IAAK,cAAcA,EAAA,EAC9C;AAMD,IAAayH,aAAW,CAACzH,QAAO,EAC5B,QAAS,KAAK,KAAK,CAAA,IAAK,IAAK,cAAcA,EAAA,EAC9C;;;;;;;;;;;;;;;;;;;;;;;AC1GD,IAAa/B,UAAQ,CAAC+B,IAAG,WAAW;AAChC,MAAI,CAAC,OACD,UAAS,OAAO,OAAO;IAAE,GAAG;IAAG,GAAG;EAAG,CAAA;AACzC,QAAM2H,MAAK,eAAe3H,EAAA;AAC1B,QAAM,MAAM,mBAAmBA,EAAA;AAC/B,QAAMnG,KAAIT,SAAO4G,EAAA;AACjB,QAAMzG,KAAI;IAAE,GAAG,OAAO;IAAG,GAAG,OAAO;EAAG;AACtC,QAAMC,KAAI;IAAE,GAAG,OAAO,IAAImO,IAAG;IAAY,GAAG,OAAO;EAAG;AACtD,QAAMlO,KAAI;IAAE,GAAG,OAAO,IAAI,IAAI,CAAA;IAAI,GAAG,OAAO,IAAII;EAAG;AACnD,SAAO;IAAE,GAAAN;IAAG,GAAAC;IAAG,GAAAC;EAAG;AACrB;AAgBD,IAAamO,UAAQ,CAAC5H,IAAG,WAAW;AAChC,MAAI,CAAC,OACD,UAAS,OAAO,OAAO;IAAE,GAAG;IAAG,GAAG;EAAG,CAAA;AACzC,QAAM2H,MAAK,eAAe3H,EAAA;AAC1B,QAAM,MAAM,mBAAmBA,EAAA;AAC/B,QAAMnG,KAAIT,SAAO4G,EAAA;AACjB,QAAMxG,KAAI;IAAE,GAAG,OAAO;IAAG,GAAG,OAAO;EAAG;AACtC,QAAMD,KAAI;IAAE,GAAG,OAAO,IAAIoO,IAAG;IAAY,GAAG,OAAO;EAAG;AACtD,QAAMlO,KAAI;IAAE,GAAG,OAAO,IAAI,IAAI,CAAA;IAAI,GAAG,OAAO,IAAII;EAAG;AACnD,SAAO;IAAE,GAAAN;IAAG,GAAAC;IAAG,GAAAC;EAAG;AACrB;AAsBD,IAAaoO,UAAQ,CAAC7H,IAAG,WAAW;AAChC,MAAI,CAAC,OACD,UAAS,OAAO,OAAO;IAAE,GAAG;IAAG,GAAG;EAAG,CAAA;AACzC,QAAM,MAAM,mBAAmBA,EAAA;AAC/B,QAAMnG,KAAIT,SAAO4G,EAAA;AACjB,QAAMvG,KAAI;IAAE,GAAG,OAAO;IAAG,GAAG,OAAO;EAAG;AACtC,QAAMF,KAAI;IAAE,GAAG,OAAO,IAAI,IAAI,CAAA;IAAI,GAAG,OAAO,IAAIM;EAAG;AACnD,QAAML,KAAI;IAAE,GAAG,OAAO,IAAI,IAAI,CAAA;IAAI,GAAG,OAAO,IAAIK;EAAG;AACnD,SAAO;IAAE,GAAAN;IAAG,GAAAC;IAAG,GAAAC;EAAG;AACrB;AAOD,IAAa,iBAAiB,CAACuG,OAAM;AACjC,QAAMzG,KAAIyG,GAAE;AACZ,QAAMhB,KAAIgB,GAAE;AACZ,QAAMnG,KAAImG,GAAE;AACZ,MAAIzG,OAAM,UAAayF,OAAM,OACzB,QAAO;IACH,GAAGgB;IACH,UAAUzG;IACV,UAAUyF;IACV,YAAY,KAAK,MAAMzF,IAAGyF,EAAA;EAC7B;WAEIzF,MAAKM,GACV,QAAO;IACH,GAAGmG;IACH,UAAUzG;IACV,YAAYM;IACZ,UAAUA,KAAIA,KAAIN,KAAIA;EACzB;WAEIyF,MAAKnF,GACV,QAAO;IACH,GAAGmG;IACH,YAAYnG;IACZ,UAAUmF;IACV,UAAUnF,KAAIA,KAAImF,KAAIA;EACzB;WAEIgB,GAAE,YAAYA,GAAE,cAAcA,GAAE,SACrC,QAAOA;AAEX,QAAM,IAAI,MAAM,4BAA4B;AAC/C;AAMD,IAAa5G,WAAS,CAAC4G,OAAM;AACzB,QAAM2H,MAAK,eAAe3H,EAAA;AAC1B,QAAMxH,KAAKmP,IAAG,WAAWA,IAAG,WAAYA,IAAG;AAC3C,QAAMrK,KAAKqK,IAAG,WAAWA,IAAG,WAAYA,IAAG;AAC3C,SAAO,KAAK,KAAKnP,KAAI8E,EAAA;AACxB;AASD,IAAa,qBAAqB,CAAC0C,OAAM;AACrC,QAAM2H,MAAK,eAAe3H,EAAA;AAC1B,QAAMxH,KAAKmP,IAAG,WAAWA,IAAG,WAAYA,IAAG;AAC3C,QAAMrK,KAAKqK,IAAG,WAAWA,IAAG,WAAYA,IAAG;AAC3C,SAAO,CAACnP,IAAG8E,EAAE;AAChB;AACD,IAAanB,cAAY,CAAC6D,OAAM;AAC5B,QAAM2H,MAAK,eAAe3H,EAAA;AAC1B,SAAO2H,IAAG,WAAWA,IAAG,aAAaA,IAAG;AAC3C;AACD,IAAaxO,SAAO,CAAC6G,OAAM;AACvB,QAAM2H,MAAK,eAAe3H,EAAA;AAC1B,SAAQ2H,IAAG,WAAWA,IAAG,WAAY;AACxC;AAMD,IAAa,gBAAgB,CAAC3H,OAAM;AAChC,QAAM2H,MAAK,eAAe3H,EAAA;AAC1B,SAAO,KAAK,MAAM2H,IAAG,WAAWA,IAAG,WAC/BA,IAAG,aAAaA,IAAG,aACnBA,IAAG,WAAWA,IAAG,aAChB,IAAIA,IAAG,WAAWA,IAAG,WAAA;AAC7B;AAMD,IAAa,gBAAgB,CAAC3H,OAAM;AAChC,QAAM2H,MAAK,eAAe3H,EAAA;AAC1B,SAAO,KAAK,MAAM2H,IAAG,WAAWA,IAAG,WAC/BA,IAAG,aAAaA,IAAG,aACnBA,IAAG,WAAWA,IAAG,aAChB,IAAIA,IAAG,WAAWA,IAAG,WAAA;AAC7B;AASD,IAAaG,YAAU,CAAC9H,OAAM;AAC1B,QAAM2H,MAAK,eAAe3H,EAAA;AAC1B,QAAMxG,KAAImO,IAAG,WAAWA,IAAG;AAC3B,QAAMlO,KAAIkO,IAAG,aAAaA,IAAG;AAC7B,QAAMpO,KAAIoO,IAAG,WAAWA,IAAG;AAC3B,SAAO;IACH,KAAK,KAAK,KAAKnO,KAAIC,MAAKF,EAAA,IAAK;IAC7B,KAAK,KAAK,KAAKE,KAAIF,MAAKC,EAAA,IAAK;IAC7B,KAAK,KAAK,KAAKD,KAAIC,MAAKC,EAAA,IAAK;EAChC;AACJ;AAMD,IAAaiO,iBAAe,CAAC1H,OAAM;AAC/B,QAAM2H,MAAK,eAAe3H,EAAA;AAC1B,SAAO,EAAE,QAAQ2H,IAAG,aAAa,EAAG;AACvC;AAMD,IAAaF,aAAW,CAACzH,OAAM;AAC3B,QAAM2H,MAAK,eAAe3H,EAAA;AAC1B,SAAO,EACH,SAAS2H,IAAG,WAAWA,IAAG,WAAWA,IAAG,cAAc,EACzD;AACJ;AAmBD,IAAa,uBAAuB,CAAC,UAAU,aAAa,KAAK,IAAI,QAAA,IAAY;AAmBjF,IAAa,yBAAyB,CAAC,UAAU,eAAe,KAAK,IAAI,QAAA,IAAY;AAkBrF,IAAa,yBAAyB,CAACrH,eAAa,eAAe,KAAK,IAAIA,aAAAA,IAAe;AAkB3F,IAAa,uBAAuB,CAACA,eAAa,aAAa,WAAW,KAAK,IAAIA,aAAAA;AAoBnF,IAAa,yBAAyB,CAACA,eAAa,aAAa,WAAW,KAAK,IAAIA,aAAAA;AAoBrF,IAAa,yBAAyB,CAACA,eAAa,aAAa,WAAW,KAAK,IAAIA,aAAAA;;;;;;;;;;;;;;;;;AC3UrF,IAAa,YAAY,CAACN,OAAM,KAAK,KAAKA,GAAE,QAAQ,IAAIA,GAAE,KAAA;AAC1D,IAAa,YAAY,CAACA,OAAM;AAC5B,QAAMpC,MAAKoC,GAAE,OAAOA,GAAE;AACtB,QAAM,KAAKA,GAAE,OAAOA,GAAE;AACtB,SAAO,KAAK,MAAM,IAAIpC,MAAK,OAAO,IAAIA,IAAA;AACzC;AACD,IAAa,SAAS,CAACoC,OAAM;AACzB,QAAMpC,MAAKoC,GAAE,OAAOA,GAAE;AACtB,QAAM,KAAKA,GAAE,OAAOA,GAAE;AACtB,SAAO,KAAK,MAAM,IAAIpC,MAAK,MAAM,CAAA;AACpC;AACD,IAAa,aAAa,CAACoC,OAAM;AAC7B,QAAMxG,KAAI,UAAUwG,EAAA;AACpB,SAAOA,GAAE,OAAO,KAAK,IAAIxG,EAAA;AAC5B;AACD,IAAa,YAAY,CAACwG,OAAM,IAAIA,GAAE,OAAOA,GAAE;AAC/C,IAAa,OAAO,CAACA,OAAM;AACvB,QAAMnG,KAAI,OAAOmG,EAAA;AACjB,SAAQnG,KAAImG,GAAE,OAAQ;AACzB;AACD,IAAa,eAAe,CAACA,OAAM;AAC/B,QAAMnG,KAAI,OAAOmG,EAAA;AACjB,QAAM+H,MAAKlO,KAAIA;AACf,QAAM,KAAKmG,GAAE,OAAOA,GAAE;AACtB,SAAO,EAAE,SAAS,IAAI+H,MAAK,OAAO,IAAIlO,IAAI;AAC7C;AACD,IAAa,WAAW,CAACmG,OAAM;AAC3B,QAAMnG,KAAI,OAAOmG,EAAA;AACjB,SAAO,EAAE,QAASA,GAAE,OAAOnG,MAAM,IAAImG,GAAE,OAAOA,GAAE,MAAO;AAC1D;AACD,IAAa,UAAU,CAACA,OAAM;AAC1B,QAAMpC,MAAKoC,GAAE,OAAOA,GAAE;AACtB,QAAM,KAAKA,GAAE,OAAOA,GAAE;AACtB,QAAM,WAAW,KAAK,KAAKpC,MAAK,IAAI,EAAA,IAAM;AAC1C,QAAM,UAAU,KAAK,KAAK,IAAIA,MAAK,EAAA,IAAM;AACzC,SAAO;IAAC;IAAU;IAAU;EAAQ;AACvC;AAUD,IAAa,aAAa,CAACoC,IAAG,WAAW;AACrC,MAAI,CAAC,OACD,UAAS,OAAO,OAAO;IAAE,GAAG;IAAG,GAAG;EAAG,CAAA;AACzC,QAAMnG,KAAI,OAAOmG,EAAA;AACjB,QAAM,YAAY,SAASA,EAAA,EAAG;AAC9B,QAAM,iBAAiBnG,KAAI;AAC3B,QAAMN,KAAI;IAAE,GAAG,OAAO,IAAIyG,GAAE,OAAO;IAAG,GAAG,OAAO,IAAI;EAAW;AAC/D,QAAMxG,KAAI;IAAE,GAAG,OAAO,IAAIwG,GAAE,OAAO;IAAG,GAAG,OAAO,IAAI;EAAW;AAC/D,QAAMvG,KAAI;IAAE,GAAG,OAAO;IAAG,GAAG,OAAO,IAAI;EAAgB;AACvD,SAAO;IAAE,GAAAF;IAAG,GAAAC;IAAG,GAAAC;EAAG;AACrB;AACD,IAAa,QAAQ,CAACuG,IAAG,WAAW;AAChC,MAAI,CAAC,OACD,UAAS,OAAO,OAAO;IAAE,GAAG;IAAG,GAAG;EAAG,CAAA;AACzC,QAAMnG,KAAI,OAAOmG,EAAA;AACjB,QAAMzG,KAAI;IAAE,GAAG,OAAO;IAAG,GAAG,OAAO;EAAG;AACtC,QAAMC,KAAI;IAAE,GAAG,OAAO,IAAIwG,GAAE;IAAM,GAAG,OAAO;EAAG;AAC/C,QAAMvG,KAAI;IAAE,GAAG,OAAO,IAAIuG,GAAE,OAAO;IAAG,GAAG,OAAO,IAAInG;EAAG;AACvD,SAAO;IAAE,GAAAN;IAAG,GAAAC;IAAG,GAAAC;EAAG;AACrB;AACD,IAAa,QAAQ,CAACuG,IAAG,WAAW;AAChC,MAAI,CAAC,OACD,UAAS,OAAO,OAAO;IAAE,GAAG;IAAG,GAAG;EAAG,CAAA;AACzC,QAAMnG,KAAI,OAAOmG,EAAA;AACjB,QAAMxG,KAAI;IAAE,GAAG,OAAO;IAAG,GAAG,OAAO;EAAG;AACtC,QAAMD,KAAI;IAAE,GAAG,OAAO,IAAIyG,GAAE;IAAM,GAAG,OAAO;EAAG;AAC/C,QAAMvG,KAAI;IAAE,GAAG,OAAO,IAAIuG,GAAE,OAAO;IAAG,GAAG,OAAO,IAAInG;EAAG;AACvD,SAAO;IAAE,GAAAN;IAAG,GAAAC;IAAG,GAAAC;EAAG;AACrB;AACD,IAAa,QAAQ,CAACuG,IAAG,WAAW;AAChC,MAAI,CAAC,OACD,UAAS,OAAO,OAAO;IAAE,GAAG;IAAG,GAAG;EAAG,CAAA;AACzC,QAAMnG,KAAI,OAAOmG,EAAA;AACjB,QAAMvG,KAAI;IAAE,GAAG,OAAO;IAAG,GAAG,OAAO;EAAG;AACtC,QAAMF,KAAI;IAAE,GAAG,OAAO,IAAIyG,GAAE,OAAO;IAAG,GAAG,OAAO,IAAInG;EAAG;AACvD,QAAML,KAAI;IAAE,GAAG,OAAO,IAAIwG,GAAE,OAAO;IAAG,GAAG,OAAO,IAAInG;EAAG;AACvD,SAAO;IAAE,GAAAN;IAAG,GAAAC;IAAG,GAAAC;EAAG;AACrB;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AGvED,IAAauO,aAAY,CAAC,iBAAiB;AACvC,QAAMC,KAAI,kBAAkB,YAAA;AAC5B,MAAIA,GAAE,QACF,QAAOA,GAAE;AACb,QAAM,cAAcA,EAAA;AACvB;AAeD,IAAa,oBAAoB,CAAC,iBAAiB;AAC/C,MAAI,OAAO,iBAAiB,UAAU;AAClC,UAAMC,KAAI,SAAS,cAAc,YAAA;AACjC,QAAIA,OAAM,MAAM;AACZ,YAAM,QAAQ,aAAa,WAAW,GAAG,IAAI,UAAU,YAAA,4DACjD,UAAU,YAAA,4CAAwD,YAAA;AACxE,aAAO;QAAE,SAAS;QAAO;MAAO;IACnC;AACD,mBAAeA;EAClB,WACQ,iBAAiB,KACtB,QAAO;IAAE,SAAS;IAAO,OAAO;EAAiD;WAE5E,iBAAiB,OACtB,QAAO;IAAE,SAAS;IAAO,OAAO;EAAqC;AAEzE,QAAMC,OAAK;AACX,SAAO;IAAE,SAAS;IAAM,OAAOA;EAAI;AACtC;AASD,IAAa,aAAa,CAAC,cAAc;AACrC,MAAI,cAAc,OACd,QAAO,CAAE;AACb,MAAI,cAAc,KACd,QAAO,CAAE;AACb,MAAI,MAAM,QAAQ,SAAA,EACd,QAAO;AACX,MAAI,OAAO,cAAc,UAAU;AAC/B,UAAM,WAAW,CAAC,GAAG,SAAS,iBAAiB,SAAA,CAAW;AAC1D,WAAO;EACV;AACD,SAAO,CAAC,SAAU;AACrB;;;;;;;ACpED,IAAM,UAAU,CAACC,IAAG,YAAY;AAC5B,MAAI,QAAQ,aACR;QAAIA,GAAE,SAAS,QAAQ,YACnB,QAAO,SAAS,OAAO,QAAQ,cAAcA,GAAE,MAAA,IAAUA;EAAE;AAEnE,SAAOA;AACV;AACD,IAAM,gBAAgB,CAACA,IAAGC,OAAM;AAC5B,EAAAD,KAAKC,GAAE,iBAAiB,SAAaC,OAAMD,GAAE,cAAcD,EAAA,IAAKA;AAChE,MAAI,WAAYC,GAAE,cAAc,SAAaD,GAAE,QAAQC,GAAE,SAAA,IAAaD,GAAE,SAAA;AACxE,aAAW,QAAQ,SAAS,SAAA,GAAYC,EAAA;AACxC,SAAO;AACV;AACD,IAAM,eAAe,CAACD,IAAG,YAAY;AACjC,MAAIA,OAAM,KACN,QAAO;AACX,MAAIA,OAAM,OACN,QAAO;AACX,MAAI,OAAOA,OAAM,UACb,QAAOA,KAAI,SAAS;AACxB,MAAI,OAAOA,OAAM,SACb,QAAO,IAAIA,EAAA;AACf,MAAI,OAAOA,OAAM,SACb,QAAO,cAAcA,IAAG,QAAQ,OAAA;AACpC,MAAI,OAAOA,OAAM,SACb,QAAO,cAAcA,IAAG,OAAA;AAC5B,SAAOG,cAAAA,QAAM,UAAUH,EAAA;AAC1B;AACD,IAAM,gBAAgB,CAACA,IAAG,YAAY;AAClC,MAAI,OAAO;AACX,aAAW,SAAS,OAAO,QAAQA,EAAA,GAAI;AACnC,UAAMI,SAAQ,aAAa,MAAM,CAAA,GAAI,OAAA;AACrC,YAAQ,iDAAiD,MAAM,CAAA,CAAA;qDAClBA,MAAA;EAChD;AACD,UAAQ;AACR,SAAO;AACV;AAQD,IAAaC,YAAW,CAAC,eAAe,SAAS;AAC7C,QAAM,SAASC,WAAe,aAAA;AAC9B,MAAI,YAAY,SAAS,cAAc,KAAK;AAC5C,SAAO,OAAO,SAAA;AACd,QAAM,UAAU;IACZ,SAAS,CAAE;IACX,iBAAiB;EACpB;AACD,QAAMC,UAAS,MAAM;AACjB,QAAI,CAAC,UACD,QAAO;AACX,cAAU,OAAA;AACV,gBAAY;AACZ,WAAO;EACV;AACD,QAAM,SAAS,CAACC,WAAS;AACrB,UAAM,aAAa,oBAAI,IAAA;AACvB,eAAW,CAAC,KAAKJ,MAAA,KAAUI,QAAM;AAC7B,YAAM,OAAO,SAAS,GAAA;AACtB,iBAAW,IAAI,IAAA;AACf,UAAIC,KAAI,OAAO,cAAc,IAAI,IAAA,EAAM;AACvC,UAAIA,OAAM,MAAM;AACZ,QAAAA,KAAI,SAAS,cAAc,OAAO;AAClC,YAAI,CAACA,GACD,OAAM,IAAI,MAAM,gCAAgC;AACpD,QAAAA,GAAE,KAAK;AACP,eAAO,OAAOA,EAAA;MACjB;AACD,oBAAcA,IAAGL,QAAO,OAAA;IAC3B;AAED,UAAM,SAAS,MAAM,KAAK,OAAO,iBAAiB,OAAO,CAAC;AAC1D,eAAWK,MAAK,OACZ,KAAI,CAAC,WAAW,IAAIA,GAAE,EAAA,EAClB,CAAAA,GAAE,OAAA;EAGb;AACD,MAAI,KACA,QAAO,IAAA;AACX,SAAO;IAAE;IAAQ,QAAAF;EAAQ;AAI5B;AAWD,IAAM,gBAAgB,CAACE,IAAG,MAAM,YAAY;AACxC,QAAM,mBAAmB,QAAQ,WAAW,CAAE;AAE9C,QAAM,WAAW,QAAQ,YAAY;AACrC,QAAM,kBAAkB,QAAQ,mBAAmB;AACnD,MAAI,SAAS,QAAW;AACpB,IAAAA,GAAE,YAAY;AACd;EACH;AACD,QAAM,WAAW,oBAAI,IAAA;AACrB,aAAW,CAAC,KAAKL,MAAA,KAAU,OAAO,QAAQ,IAAA,GAAO;AAC7C,UAAM,SAAS,GAAG,QAAA,QAAgB,GAAA;AAElC,aAAS,IAAI,MAAA;AAEb,QAAI,QAAQK,GAAE,cAAc,gBAAgB,MAAA,IAAU;AACtD,QAAI,UAAU,MAAM;AAEhB,cAAQ,SAAS,cAAc,IAAI;AACnC,MAAAA,GAAE,OAAO,KAAA;AACT,YAAM,aAAa,YAAY,MAAA;AAC/B,YAAM,QAAQ,SAAS,cAAc,IAAI;AACzC,YAAM,cAAc;AACpB,YAAM,UAAU,IAAI,OAAO;AAC3B,YAAM,OAAO,KAAA;IAChB;AAED,QAAI,QAAQ,MAAM,cAAc,gBAAgB,MAAA,QAAc;AAC9D,QAAI,UAAU,MAAM;AAEhB,cAAQ,SAAS,cAAc,IAAI;AACnC,YAAM,UAAU,IAAI,MAAM;AAC1B,YAAM,aAAa,YAAY,GAAG,MAAA,MAAY;AAC9C,YAAM,OAAO,KAAA;IAChB;AAED,QAAI;AACJ,QAAI,QAAQ,UACR,aAAY,QAAQ,UAAUL,QAAO,GAAA;AAGzC,QAAI,cAAc,OACd,KAAI,OAAOA,WAAU,SACjB,aAAY,kBAAkB,cAAcA,QAAO,OAAA,IAAWD,cAAAA,QAAM,UAAUC,MAAA;aAEzE,OAAOA,WAAU,SACtB,aAAY,cAAcA,QAAO,gBAAA;aAK5B,OAAOA,WAAU,UACtB,aAAYA,SAAQ,SAAS;aAExB,OAAOA,WAAU,SACtB,aAAY,IAAIA,MAAA;QAGhB,aAAY,KAAK,UAAUA,MAAA;AAInC,UAAM,YAAY;EACrB;AAED,QAAMM,QAAO,MAAM,KAAKD,GAAE,iBAAiB,IAAI,CAAC;AAChD,aAAWZ,MAAKa,OAAM;AAClB,UAAM,MAAMb,GAAE,aAAa,UAAU;AACrC,QAAI,CAAC,SAAS,IAAI,GAAA,EACd,CAAAA,GAAE,OAAA;EAET;AACJ;AAkBD,IAAac,cAAa,CAAC,eAAe,MAAM,OAAO,CAAE,MAAK;AAC1D,QAAM,SAASL,WAAe,aAAA;AAC9B,QAAM,WAAW,KAAK,YAAY,KAAK,MAAM,KAAK,OAAA,IAAW,GAAA,EAAM,SAAA;AACnE,QAAM,UAAU;IACZ,SAAS,CAAE;IACX,iBAAiB;IACjB,UAAU;IACV,GAAG;EACN;AACD,MAAIG,KAAI,SAAS,cAAc,OAAO;AACtC,SAAO,OAAOA,EAAA;AACd,QAAMF,UAAS,MAAM;AACjB,QAAI,CAACE,GACD,QAAO;AACX,IAAAA,GAAE,OAAA;AACF,IAAAA,KAAI;AACJ,WAAO;EACV;AAED,MAAI,KACA,eAAcA,IAAG,MAAM,OAAA;AAC3B,QAAM,SAAS,CAACX,OAAM;AAClB,QAAI,CAACW,GACD,OAAM,IAAI,MAAM,gBAAgB;AACpC,kBAAcA,IAAGX,IAAG;MAAE,GAAG;MAAS;IAAU,CAAA;EAC/C;AACD,SAAO;IAAE,QAAAS;IAAQ;EAAQ;AAC5B;;;ACvND,IAAa,YAAY,CAAC,aAAa,UAAU,UAAU,CAAE,MAAK;AAC9D,QAAM,OAAOX,WAAU,WAAA;AAIvB,MAAI,yBAAyBgB;AAC7B,MAAI;AACJ,QAAM,gBAAgB,QAAQ,iBAAiB;AAC/C,QAAM,YAAY,QAAQ,aAAa;AACvC,QAAM,QAAQ,QAAQ,QAAQhB,WAAU,QAAQ,KAAA,IAAS;AACzD,QAAM,gBAAgB,QAAQ;AAC9B,MAAI,cAAciB;AAClB,QAAMC,oBAAmB,OAAO,iBAAiB,IAAA,EAAM,aAAa;AAEpE,QAAM,gBAAgB,MAAM;AACxB,UAAM,WAAW,KAAK,UAAU,SAAS,UAAU;AACnD,QAAI,SACA,MAAK,UAAU,OAAO,UAAU;EAEvC;AAED,QAAM,iBAAiB,CAACC,WAAU;AAC9B,UAAM,WAAW,KAAK,UAAU,SAAS,UAAU;AACnD,QAAI,SACA,MAAK,UAAU,OAAO,UAAU;QAGhC,MAAK,UAAU,IAAI,UAAU;AAEjC,IAAAA,OAAM,gBAAA;EACT;AACD,OAAK,cAAc,iBAAiB,SAAS,aAAA;AAC7C,OAAK,iBAAiB,SAAS,cAAA;AAE/B,QAAM,cAAc,MAAM;AACtB,SAAK,UAAU,OAAO,eAAe;AACrC,SAAK,cAAc,oBAAoB,eAAe,aAAA;AACtD,SAAK,cAAc,oBAAoB,aAAa,WAAA;AACpD,SAAK,cAAc,oBAAoB,iBAAiB,YAAA;EAC3D;AACD,QAAM,UAAU,MAAM;AAClB,QAAI,KAAK,UAAU,SAAS,eAAe,EACvC,cAAa,QAAW,SAAS;QAGjC,aAAA;AAEJ,SAAK,cAAc,oBAAoB,SAAS,aAAA;AAChD,SAAK,oBAAoB,SAAS,cAAA;EACrC;AACD,QAAM,yBAAyB,CAACC,SAAQC,IAAGC,OAAM;AAC7C,QAAI,CAACC,gBAAmB,WAAA,GAAc;AAClC,MAAAH,UAAS;QACL,GAAG,MAAMA,QAAO,GAAG,YAAY,GAAG,YAAY,KAAA;QAC9C,GAAG,MAAMA,QAAO,GAAG,YAAY,GAAG,YAAY,MAAA;MACjD;AACD,UAAI,eAAe;AACf,QAAAC,KAAI,MAAMA,IAAG,cAAc,GAAG,cAAc,IAAI,cAAc,KAAA;AAC9D,QAAAC,KAAI,MAAMA,IAAG,cAAc,GAAG,cAAc,IAAI,cAAc,MAAA;MACjE;IACJ;AACD,WAAO,CAACF,SAAQ;MAAE,GAAAC;MAAG,GAAAC;IAAG,CAAC;EAC5B;AAED,MAAI,iBAAiBE;AACrB,QAAM,gBAAgB,CAAC,cAAc;AACjC,cAAU,eAAA;AACV,cAAU,gBAAA;AACV,UAAM,EAAE,GAAAH,IAAG,GAAAC,GAAA,IAAM;AACjB,QAAIF,UAASK,cAAoB,sBAAA,IAC3B;MAAE,GAAG,UAAU;MAAS,GAAG,UAAU;IAAS,IAC9C;MACE,GAAGJ,KAAI,uBAAuB;MAC9B,GAAGC,KAAI,uBAAuB;IACjC;AACL,UAAMrB,KAAI,uBAAuBmB,SAAQC,IAAGC,EAAA;AAC5C,IAAAF,UAASnB,GAAE,CAAA;AACX,UAAM,QAAQ;MACV,OAAOmB;MACP,SAAS;MACT;MACA,UAAUnB,GAAE,CAAA;IACf;AACD,QAAI,OAAO,SAAS,aAAa,aAAa;AAC1C,YAAMyB,KAAI,SAAS,SAAS,KAAA;AAC5B,UAAIA,GAAE,OAAO;AACT,qBAAa,QAAW,cAAc;AACtC;MACH;AACD,UAAIA,GAAE,SACF,CAAAN,UAAS;QACL,GAAGM,GAAE,SAAS,IAAI,uBAAuB;QACzC,GAAGA,GAAE,SAAS,IAAI,uBAAuB;MAC5C;IAER;AACD,qBAAiBN;AACjB,QAAI,eAAe;AACf,YAAM,UAAUA,QAAO;AACvB,YAAM,UAAUA,QAAO;AACvB,WAAK,MAAM,YAAY,GAAG,OAAA,MAAa,OAAA;IAC1C;EACJ;AAED,QAAM,cAAc,CAAC,YAAY;AAC7B,UAAM,SAAS,KAAK,sBAAA;AACpB,gBAAA;AACA,UAAM,EAAE,GAAAC,IAAG,GAAAC,GAAA,IAAM;AAKjB,UAAMrB,KAAI,uBAAuB,gBAAgBoB,IAAGC,EAAA;AACpD,UAAM,QAAQ;MACV,SAAS;MACT;MACA,OAAOrB,GAAE,CAAA;MACT,UAAUA,GAAE,CAAA;IACf;AACD,QAAI,eAAe;AACf,WAAK,MAAM,YAAY;AACvB,UAAIiB,mBAAkB;AAElB,cAAM,SAAS,KAAK,eAAe,sBAAA;AACnC,aAAK,MAAM,OAAO,GAAG,OAAO,IAAI,OAAO,IAAA;AACvC,aAAK,MAAM,MAAM,GAAG,OAAO,IAAI,OAAO,GAAA;MACzC,OACI;AACD,aAAK,MAAM,OAAO,GAAG,OAAO,CAAA;AAC5B,aAAK,MAAM,MAAM,GAAG,OAAO,CAAA;MAC9B;IACJ;AACD,QAAI,OAAO,SAAS,YAAY,YAC5B,UAAS,QAAQ,KAAA;EAExB;AAED,QAAM,eAAe,CAACC,QAAO,SAAS,oBAAoB;AACtD,gBAAA;AACA,QAAI,WAAWH;AACf,QAAIG,UAAS,OAAOA,UAAS,OAAOA,OAChC,YAAW;MAAE,GAAGA,OAAM;MAAG,GAAGA,OAAM;IAAG;AAEzC,UAAM,QAAQ;MACV;MACA,SAAS;MACT,OAAO;QAAE,GAAG;QAAI,GAAG;MAAI;MACvB;IACH;AACD,QAAI,OAAO,SAAS,UAAU,YAC1B,UAAS,MAAM,QAAQ,KAAA;EAE9B;AACD,OAAK,iBAAiB,eAAe,CAACA,WAAU;AAC5C,UAAM,WAAW,KAAK,UAAU,SAAS,UAAU;AACnD,QAAI,CAAC,YAAY,CAAC,UACd;AACJ,UAAM,SAASA;AACf,6BAAyB;MAAE,GAAG,OAAO;MAAG,GAAG,OAAO;IAAG;AACrD,UAAMQ,KAAI,OAAO,SAAS,UAAU,cAC9B;MAAE,OAAO;MAAM;IAAO,IACtB,SAAS,MAAA;AACf,QAAI,CAACA,GAAE,MACH;AACJ,YAAQA,GAAE;AACV,QAAI,OAAO;AACP,YAAM,cAAc,MAAM,sBAAA;AAC1B,oBAAc;QACV,GAAG,YAAY,IAAI,uBAAuB;QAC1C,GAAG,YAAY,IAAI,uBAAuB;QAC1C,OAAO,YAAY,IAAI,YAAY,QAAQ,uBAAuB;QAClE,QAAQ,YAAY,IAAI,YAAY,SAAS,uBAAuB;MACvE;IACJ,WACQ,cACL,eAAc;MACV,GAAG,cAAc,IAAI,uBAAuB;MAC5C,GAAG,cAAc,IAAI,uBAAuB;MAC5C,OAAQ,cAAc,QAAQ,cAAc,IAAK,uBAAuB;MACxE,QAAS,cAAc,SAAS,cAAc,IAAK,uBAAuB;IAC7E;AAEL,SAAK,UAAU,IAAI,eAAe;AAClC,SAAK,cAAc,iBAAiB,eAAe,aAAA;AACnD,SAAK,cAAc,iBAAiB,aAAa,WAAA;AACjD,SAAK,cAAc,iBAAiB,iBAAiB,YAAA;EACxD,CAAA;AACD,SAAO;AACV;;;;;;;;;;AC5LD,IAAa,mBAAmB,CAACxB,SAAO;AACpCA,OAAG,iBAAiB,WAAW,CAACgB,WAAU;AACtC,UAAM,eAAehB,KAAG;AACxB,UAAM,QAAQA,KAAG;AACjB,UAAM,MAAMA,KAAG;AACf,QAAIgB,OAAM,QAAQ,SAASA,OAAM,UAAU;AACvC,UAAIhB,KAAG,MAAM,UAAU,QAAQ,GAAG,KAAA,MAAW,KACzCA,MAAG,QAAQ,aAAa,MAAM,GAAG,KAAK,IAAI,GAAG,QAAQ,CAAA,CAAE,IAAI,aAAa,MAAM,KAAK,IAAI,GAAG,GAAA,CAAI;AAElGA,WAAG,iBAAiBA,KAAG,eAAe,QAAQ;AAC9C,MAAAgB,OAAM,eAAA;AACN,aAAO;IACV,WACQA,OAAM,QAAQ,OAAO;AAC1BhB,WAAG,QAAQ,aAAa,MAAM,GAAG,KAAK,IAAI,GAAG,KAAA,CAAM,IAAI,OAAO,aAAa,MAAM,KAAK,IAAI,GAAG,GAAA,CAAI;AACjGA,WAAG,iBAAiBA,KAAG,eAAe,QAAQ;AAC9C,MAAAgB,OAAM,eAAA;AACN,aAAO;IACV;EACJ,CAAA;AACJ;AAkBD,IAAa,WAAW,CAAC,WAAW,cAAc;AAC9C,QAAMhB,OAAKH,WAAU,SAAA;AACrB,MAAI,UACAG,MAAG,iBAAiB,UAAU,MAAM;AAChC,cAAUA,KAAG,OAAA;EAChB,CAAA;AAEL,SAAO;IACH,IAAI,UAAU;AACV,aAAOA,KAAG;IACb;IACD,IAAI,QAAQK,QAAO;AACfL,WAAG,UAAUK;IAChB;EACJ;AACJ;AAmBD,IAAa,UAAU,CAAC,WAAW,WAAW,SAAS;AACnD,QAAML,OAAKH,WAAU,SAAA;AACrB,QAAM,YAAY,OAAO,WAAW;AACpC,MAAI,UACAG,MAAG,iBAAiB,WAAW,MAAM;AACjC,cAAU,OAAO,SAASA,KAAG,KAAA,CAAM;EACtC,CAAA;AAEL,SAAO;IACH,IAAI,QAAQ;AACR,aAAO,OAAO,SAASA,KAAG,KAAA;IAC7B;IACD,IAAI,MAAMK,QAAO;AACbL,WAAG,QAAQK,OAAM,SAAA;IACpB;EACJ;AACJ;AAkBD,IAAa,SAAS,CAAC,cAAc,mBAAmB;AACpD,QAAML,OAAKH,WAAU,YAAA;AACrB,QAAM,WAAW,MAAM;AACnB,QAAI,eACAG,MAAG,iBAAiB,SAAS,cAAA;EAEpC;AACD,QAAM,cAAc,MAAM;AACtB,QAAI,eACAA,MAAG,oBAAoB,SAAS,cAAA;EAEvC;AACD,WAAA;AACA,SAAO;IAIH,IAAI,QAAQ;AACR,aAAOA,KAAG;IACb;IAID,IAAI,MAAMK,QAAO;AACbL,WAAG,cAAcK;IACpB;IAMD,QAAQ,gBAAgB,OAAO;AAC3B,kBAAA;AACA,UAAI,cACAL,MAAG,OAAA;IACV;IAKD,QAAQ,SAAS;AACb,kBAAA;AACA,uBAAiB;AACjB,eAAA;IACH;IAID,QAAQ;AACJ,UAAI,eACA,gBAAA;IACP;IAID,IAAI,SAASK,QAAO;AAChBL,WAAG,WAAWK;IACjB;IAID,IAAI,KAAK;AACL,aAAOL;IACV;EACJ;AACJ;AAWD,IAAa,eAAe,CAAC,OAAO,YAAY;AAC5C,QAAMA,OAAK,SAAS,cAAc,QAAQ;AAC1C,QAAMyB,KAAI,OAAOzB,MAAI,OAAA;AACrB,EAAAyB,GAAE,QAAQ;AACV,SAAOA;AACV;AA0CD,IAAa,SAAS,CAAC,cAAc,WAAW,UAAU,CAAE,MAAK;AAC7D,QAAMzB,OAAKH,WAAU,YAAA;AACrB,QAAM,EAAE,gBAAgB,6BAA6B,OAAO,wBAAwB,GAAA,IAAQ;AAC5F,QAAM,SAAS,MAAM;AACjB,QAAI,cAAc,OACd,WAAUG,KAAG,KAAA;AACjB,QAAI,yBAAyB,EACzBA,MAAG,gBAAgB;EAC1B;AACD,MAAI,UACAA,MAAG,iBAAiB,UAAU,CAAC,WAAW;AACtC,WAAA;EACH,CAAA;AAEL,SAAO;IACH,IAAI,SAASK,QAAO;AAChBL,WAAG,WAAWK;IACjB;IACD,IAAI,QAAQ;AACR,aAAOL,KAAG;IACb;IACD,IAAI,QAAQ;AACR,aAAOA,KAAG;IACb;IACD,IAAI,wBAAwB;AACxB,cAAS,8BAA8B,QAAQ,mBAAmB,WAC9DA,KAAG,kBAAkB;IAC5B;IACD,QAAQ,MAAM,WAAW;AACrBA,WAAG,QAAQ,SAAS;AACpB,UAAI,2BACA,QAAO,CAAC,gBAAgB,GAAG,IAAK;eAC3B,mBAAmB,OACxB,QAAO,CAAC,gBAAgB,GAAG,IAAK;AACpC,UAAI,WAAW;AACf,iBAAW,CAAC,OAAOE,EAAA,KAAM,KAAK,QAAA,GAAW;AACrC,cAAM,QAAQ,SAAS,cAAc,QAAQ;AAC7C,cAAM,QAAQA;AACd,cAAM,YAAYA;AAClB,YAAI,cAAc,UAAaA,OAAM,UACjC,YAAW;AACfF,aAAG,QAAQ,IAAI,KAAA;MAClB;AACDA,WAAG,gBAAgB;IACtB;IACD,OAAO,QAAQ,GAAG,UAAU,OAAO;AAC/BA,WAAG,gBAAgB;AACnB,UAAI,WAAW,UACX,QAAA;IAEP;EACJ;AACJ;AC7RD,SAAgB,cAAcE,IAAG;AAE7B,SAAQ,OAAO,gBAAgB,WAAWA,cAAa,cACnDA,MAAK,OAAOA,OAAM,YAAYA,OAAM,QAAQA,GAAE,aAAa,KAAK,OAAOA,GAAE,aAAa;AAC7F;ACuBD,IAAa,gCAAgC,CAAC,YAAY;AACtD,SAAO,QAAQ,IAAI,CAAA,QAAO;AACtB,QAAI;AAEJ,QAAI,MAAM,QAAQ,GAAA,GAAM;AACpB,qBAAe,IAAI,CAAA;AACnB,YAAM,IAAI,CAAA;IACb;AACD,UAAM,OAAO,IAAI,QAAQ,GAAG;AAC5B,QAAI,OAAO,EACP,OAAM,IAAI,MAAM,0DAA0D;AAC9E,WAAO;MACH,UAAU;MACV,WAAW,IAAI,MAAM,OAAO,CAAA;MAC5B,IAAI,IAAI,MAAM,GAAG,IAAA;MACjB;IACH;EACJ,CAAA;AACJ;AAwBD,IAAa,sBAAsB,CAAC,YAAY,YAAY;AACxD,QAAM,YAAYL,WAAU,OAAA;AAC5B,QAAM,QAAQ,OAAO,iBAAiB,SAAA;AACtC,aAAW,OAAO,SAAS;AACvB,UAAM,WAAA,WAA2B,IAAI,UAAU,IAAI;AACnD,QAAII,KAAI,MAAM,iBAAiB,KAAK,QAAA,EAAU;AAC9C,QAAIA,OAAM,QAAQA,GAAE,WAAW,EAC3B,KAAI,IAAI,iBAAiB,OACrB;QAGA,CAAAA,KAAI,IAAI;AAGhB,QAAIyB;AACJ,QAAI;AACJ,QAAI,WAAW,OAAO,IAAI,UAAU,OAChCA,WAAQ,IAAI;aAEP,QAAQ,OAAO,IAAI,OAAO,OAC/BA,WAAQ,IAAI,IAAI,EAAA;aAEX,YAAY,OAAO,IAAI,WAAW,OACvC,OAAM,MAAM,QAAQ,IAAI,MAAA,IAAU,IAAI,SAAS,CAAC,IAAI,MAAO;AAE/D,QAAIA,YAAU,QAEV;UAAI,QAAQ,OAER,OAAM,IAAI,MAAM,0CAA0C;IAC7D,MAID,OAAM,CAAC,GAAG,UAAU,iBAAiBA,OAAAA,CAAO;AAEhD,QAAI,QAAQ,KACR;AACJ,QAAI,QAAQ,OACR;AACJ,QAAI,IAAI,UACJ,YAAW1B,QAAM,IACb,KAAI,cAAcA,IAAAA,EACdA,MAAG,aAAa,IAAI,WAAWC,EAAA;QAG/B,OAAM,IAAI,MAAM,8DAA8D,EAAE,OAAOD,KAAI,CAAA;aAI9F,IAAI,MACT,YAAWA,QAAM,IACb,KAAI,OAAOA,SAAO,SACbA,MAAI,IAAI,KAAA,IAASC;QAGlB,OAAM,IAAI,MAAM,2DAA2D,OAAOD,IAAAA,KAAO,EAAE,OAAOA,KAAI,CAAA;QAK9G,OAAM,IAAI,MAAM,+DAA+D,KAAK,UAAU,GAAA,CAAI,GAAG;EAE5G;AACJ;AAwBD,SAAgB,4BAA4B,UAAU,KAAK;AACvD,QAAM,SAAS,iBAAiB,OAAO,SAAS,IAAA;AAChD,QAAM2B,WAAU,OAAO,QAAQ,QAAA;AAC/B,QAAM,gBAAgBA,SAAQ,IAAI,CAAA,UAAS;AACvC,WAAO,CAAC,MAAM,CAAA,GAAI,0BAA0B,QAAQ,MAAM,CAAA,GAAI,MAAM,CAAA,CAAA,CAAI;EAC3E,CAAA;AACD,SAAO,OAAO,YAAY,aAAA;AAC7B;AAgBD,SAAgB,eAAe,aAAa,eAAe;AACvD,MAAI,CAAC,YAAY,WAAW,IAAI,EAC5B,eAAc,KAAK,WAAA;AACvB,QAAMC,WAAU,iBAAiB,SAAS,IAAA,EAAM,iBAAiB,WAAA,EAAa,KAAA;AAC9E,MAAIA,SAAQ,WAAW,EACnB,QAAO;AACX,SAAOA;AACV;AAwBD,SAAgB,gBAAgB,WAAW,YAAY;AACnD,QAAM,SAAS,eAAe,SAAY,SAAS,KAAK,QACpD,cAAc,UAAA,IAAc,WAAW,QAAQ;AACnD,aAAW,CAAC,KAAKvB,MAAA,KAAU,OAAO,QAAQ,SAAA,GAAY;AAClD,QAAI,eAAe,IAAI,WAAW,KAAK,GAAA;AACvC,QAAI,CAAC,aAAa,WAAW,IAAI,EAC7B,gBAAe,OAAO;AAC1B,WAAO,YAAY,cAAcA,OAAM,SAAA,CAAU;EACpD;AACJ;AAcD,SAAgB,0BAA0B,QAAQ,MAAM,UAAU;AAC9D,MAAI,CAAC,KAAK,WAAW,IAAI,EACrB,QAAO,OAAO;AAClB,SAAO,KAAK,WAAW,KAAK,GAAG;AAC/B,QAAMJ,KAAI,OAAO,iBAAiB,IAAA;AAClC,MAAIA,GAAE,WAAW,EACb,QAAO;AAEX,MAAI,OAAO,aAAa,SACpB,QAAO,WAAWA,EAAA;AACtB,MAAI,OAAO,aAAa,WACpB;QAAIA,OAAM,OACN,QAAO;aACFA,OAAM,QACX,QAAO;EAAM;AAErB,SAAOA;AACV;ACtPD,IAAa,kCAAkC,CAAC,cAAc;AAC1D,MAAID,OAAKH,WAAU,SAAA;AACnB,QAAM,OAAOG,KAAG,sBAAA;AAChB,MAAIA,gBAAc,WACdA,QAAKA,KAAG;AAEZ,QAAM,SAAS,kBAAkBA,MAAI,kBAAkB,mBAAmB,oBAAoB,mBAAmB;AACjH,SAAO;IACH,GAAG,KAAK;IACR,GAAG,KAAK;IACR,OAAO,KAAK,QAAQ,OAAO,kBAAkB,OAAO;IACpD,QAAQ,KAAK,SAAS,OAAO,iBAAiB,OAAO;EACxD;AACJ;AAeD,IAAa,oBAAoB,CAAC,cAAc,eAAe;AAC3D,QAAMwB,KAAI,iBAAiB3B,WAAU,SAAA,CAAU;AAC/C,QAAM,cAAc,CAAE;AACtB,aAAW,YAAY,YAAY;AAC/B,UAAMI,KAAIuB,GAAE,QAAA;AACZ,QAAI,OAAOvB,OAAM,SACb,KAAIA,GAAE,SAAS,IAAI,EACf,aAAY,QAAA,IAAY,OAAO,WAAWA,GAAE,UAAU,GAAGA,GAAE,SAAS,CAAA,CAAE;QAGtE,OAAM,IAAI,MAAM,aAAa,OAAO,QAAA,CAAS,kCAAkCA,EAAA,EAAG;QAItF,OAAM,IAAI,MAAM,aAAa,OAAO,QAAA,CAAS,8BAA8B,OAAOA,EAAA,WAAYA,EAAA,EAAG;EAExG;AACD,SAAO;AACV;AAcD,IAAa,cAAc,CAAC,WAAWI,QAAO,aAAa;AACvD,QAAM,WAAW,WAAW,SAAA;AAC5B,MAAI,SAAS,WAAW,EACpB;AACJ,aAAW,WAAW,SAClB,KAAIA,OACA,SAAQ,UAAU,IAAI,QAAA;MAEtB,SAAQ,UAAU,OAAO,QAAA;AAEpC;AAaD,IAAa,eAAe,CAAC,WAAW,aAAa;AACjD,QAAM,WAAW,WAAW,SAAA;AAC5B,MAAI,SAAS,WAAW,EACpB;AACJ,aAAW,WAAW,SAClB,SAAQ,UAAU,OAAO,QAAA;AAEhC;AAYD,IAAa,gBAAgB,CAAC,WAAWA,WAAU;AAC/C,QAAM,WAAW,WAAW,SAAA;AAC5B,MAAI,SAAS,WAAW,EACpB;AACJ,aAAW,WAAW,SACjB,SAAS,MAAM,UAAUA;AAEjC;ACrGD,IAAa,cAAb,MAAyB;EACrB;;;;;EAKA,YAAY,UAAU,CAAE,GAAE;AACtB,UAAM,QAAQ,QAAQ,SAAS;AAC/B,UAAM,WAAW,SAAS,cAAc,oBAAoB;AAC5D,QAAI,aAAa,KACb,OAAM,IAAI,MAAM,yCAAyC;AAC7D,UAAM,YAAY,SAAS,cAAc,KAAK;AAC9C,cAAU,KAAK;AACf,cAAU,UAAU,IAAI,SAAS,KAAA,EAAO;AACxC,UAAM,MAAM,SAAS,cAAc,OAAO;AAC1C,QAAI,cAAc;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA4ClB,cAAU,MAAM,UAAU;AAC1B,aAAS,KAAK,OAAO,GAAA;AACrB,aAAS,KAAK,OAAO,SAAA;AACrB,SAAK,YAAYO,YAAW,WAAW,QAAW;MAC9C,iBAAiB;MACjB,GAAG;IACN,CAAA;EACJ;EACD,OAAO,MAAM;AACT,SAAK,UAAU,OAAO,IAAA;EACzB;AACJ;ACnFD,SAAgB,QAAQ,WAAWP,QAAO;AACtC,SAAO,YAAY,eAAe,WAAWA,MAAA;AAChD;AAYD,SAAgB,QAAQ,WAAWA,QAAO;AACtC,SAAO,YAAY,aAAa,WAAWA,MAAA;AAC9C;AAeD,SAAgB,YAAY,UAAU,WAAWA,QAAO;AACpD,MAAI,WAAW,CAAE;AACjB,QAAMwB,OAAM,CAAC5B,OAAM;AACf,UAAM,MAAM,OAAOA;AACnB,UAAM,KAAM,QAAQ,YAAY,QAAQ,YAAY,QAAQ,YAAaA,KACrE,KAAK,UAAUA,EAAA;AACnB,QAAI,SAAS,WAAW,EACpB,YAAW,WAAW,SAAA;AAE1B,eAAW,WAAW,SAClB,SAAQ,QAAA,IAAY;AAExB,WAAO;EACV;AACD,SAAOI,WAAU,SAAYwB,OAAMA,KAAIxB,MAAA;AAC1C;AC1BD,IAAa,KAAK,CAAC,cAAc;AAC7B,QAAM,WAAW,WAAW,SAAA;AAC5B,QAAMyB,QAAO,QAAQ,QAAA;AACrB,QAAM,OAAO,QAAQ,QAAA;AACrB,SAAO;IACH,MAAAA;IACA;IACA,YAAY,CAACzB,WAAU;AAAE,oBAAc,UAAUA,MAAA;IAAS;IAC1D,UAAU,CAACA,QAAO,aAAa;AAAE,kBAAY,UAAUA,QAAO,QAAA;IAAY;IAC1E,WAAW,CAAC,aAAa;AAAE,mBAAa,UAAU,QAAA;IAAY;IAC9D,IAAI,MAAM,SAAS,CAAA;IACnB,KAAK,MAAM;EACd;AACJ;AACD,IAAa,YAAY,CAAC,eAAe;EACrC,MAAM,CAACA,WAAU,QAAQ,WAAWA,MAAA;EACpC,MAAM,CAACA,WAAU,QAAQ,WAAWA,MAAA;EACpC,YAAY,CAACA,WAAU;AAAE,kBAAc,WAAWA,MAAA;EAAS;EAC3D,UAAU,CAACA,QAAO,aAAa;AAAE,gBAAY,WAAWA,QAAO,QAAA;EAAY;EAC3E,WAAW,CAAC,aAAa;AAAE,iBAAa,WAAW,QAAA;EAAY;EAC/D,IAAI,MAAMR,WAAU,SAAA;EACpB,KAAK,MAAM,WAAW,SAAA;AACzB;AC1CD,IAAakC,YAAW,CAAC,UAAUC,cAAa;AAC5C,MAAI;AACJ,QAAMC,MAAK,aAAaD,WAAU,GAAA;AAClC,SAAO,MAAM;AAET,QAAI,MACA,cAAa,KAAA;AACjB,YAAQ,WAAW,UAAUC,GAAA;EAChC;AACJ;ACSD,IAAa,eAAb,MAAaC,cAAa;EACtB;EACA;EACA;EACA;EACA;EACA,kBAAkB,CAAC,MAAMlC,SAAO;EAAG;EACnC;EACA;EACA,YAAY;EACZ;EACA,gBAAgB,OAAO,CAAE;EACzB,YAAY,WAAW,SAAS;AAC5B,SAAKmC,MAAMtC,WAAU,SAAA;AACrB,UAAM,YAAY,QAAQ;AAC1B,QAAI,cAAc,QAAQ,OAAO,cAAc,aAAa;AACxD,YAAMuC,MAAK,KAAKD,IAAI;AACpB,UAAIC,QAAO,KACP,MAAKC,eAAeD;WAEnB;AACD,cAAME,MAAK,KAAKH,IAAI;AACpB,YAAIG,QAAO,KACP,MAAKD,eAAeC;MAE3B;IACJ,WACQ,OAAO,cAAc,YAAY,OAAO,cAAc,SAC3D,MAAKD,eAAexC,WAAU,SAAA;AAGlC,SAAK0C,WAAW,QAAQ,WAAW;AACnC,SAAKC,kBAAkB,QAAQ;AAC/B,SAAKC,QAAAA;AACL,UAAM,aAAa,QAAQ;AAC3B,QAAI,OAAO,eAAe,YACtB,MAAKC,gBAAgBX,UAAS,MAAM;AAChC,iBAAW,KAAK,MAAM,KAAKI,GAAAA;IAC9B,GAAE,QAAQ,eAAA;AAEf,QAAI,cAAc,QAAQ;AAC1B,oBAAgB,KAAKA,IAAI,sBAAA;AACzB,SAAKQ,gBAAgB;AACrB,SAAKC,eAAe;AACpB,SAAK,eAAe,WAAA;AACpB,SAAKC,YAAAA;AACL,QAAI,KAAKR,iBAAiB,SAAS,KAC/B,MAAKS,YAAAA;QAGL,MAAKC,aAAAA;EAEZ;EACD,QAAQ,QAAQ;AACZ,QAAI,KAAKC,UACL;AACJ,SAAKA,YAAY;AACjB,QAAI,KAAKC,mBAAmB;AACxB,WAAKA,kBAAkB,WAAA;AACvB,WAAKA,oBAAoB;IAC5B;EACJ;EACD,OAAO,aAAa,sBAAsB,SAAS;AAC/C,UAAMjD,OAAKH,WAAU,oBAAA;AACrB,UAAMqD,MAAK,IAAIhB,cAAalC,MAAI;MAC5B,GAAG;MACH,eAAe,MAAMA,MAAI;AACrBA,aAAG,QAAQ,KAAK;AAChBA,aAAG,SAAS,KAAK;AACjB,YAAI,QAAQ,eACR,SAAQ,eAAe,MAAMA,IAAAA;MACpC;IACJ,CAAA;AACD,WAAOkD;EACV;EACD,OAAO,eAAe,sBAAsB,SAAS;AACjD,UAAMlD,OAAKH,WAAU,oBAAA;AACrBG,SAAG,MAAM,WAAW;AACpBA,SAAG,MAAM,UAAU,QAAQ,UAAU,GAAG,SAAA;AACxCA,SAAG,MAAM,OAAO;AAChBA,SAAG,MAAM,MAAM;AACf,UAAM,OAAO;MAAE,GAAG;MAAS,aAAa,SAAS;IAAM;AACvD,WAAO,KAAK,aAAa,sBAAsB,IAAA;EAClD;;;;;;EAMD,OAAO,YAAY,KAAK,WAAW;AAC/B,UAAMkD,MAAK,IAAIhB,cAAa,KAAK;MAC7B,aAAa,SAAS;MACtB,SAAS;MACT,eAAe,MAAM;AACjB,YAAI,aAAa,SAAS,KAAK,MAAM,SAAA,CAAU;AAC/C,YAAI,aAAa,UAAU,KAAK,OAAO,SAAA,CAAU;AACjD,YAAI,UACA,WAAU,IAAA;MACjB;IACJ,CAAA;AACD,WAAOgB;EACV;EACD,eAAe;AACX,UAAMC,KAAI,KAAKd;AACf,QAAI,CAACc,GACD,OAAM,IAAI,MAAM,sBAAsB;AAG1C,UAAMrD,KAAI,IAAI,eAAe,CAAC6B,aAAY;AACtC,WAAKyB,gBAAgBzB,QAAA;IACxB,CAAA;AACD,IAAA7B,GAAE,QAAQqD,EAAA;AAEV,UAAM,UAAU,KAAKE,0BAA0BF,GAAE,sBAAA,CAAuB;AACxE,SAAK,OAAO;AACZ,SAAKF,oBAAoBnD;EAC5B;EACD,cAAc;AACV,UAAMA,KAAI,IAAI,eAAe,CAAC6B,aAAY;AACtC,WAAK2B,kBAAAA;IACR,CAAA;AACD,IAAAxD,GAAE,QAAQ,SAAS,eAAA;AACnB,SAAKmD,oBAAoBnD;AACzB,SAAKwD,kBAAAA;EACR;EACD,oBAAoB;AAChB,SAAK,OAAO;MAAE,OAAO,OAAO;MAAY,QAAQ,OAAO;IAAa;AACpE,SAAKT,YAAY;MACb,GAAG;MAAG,GAAG;MACT,GAAG,KAAK;IACX;EACJ;;;;;;EAMD,eAAe,MAAM;AACjB,SAAKD,eAAe;AACpB,SAAKD,gBAAgB,KAAK,QAAQ,KAAK;EAC1C;EACD,IAAI,cAAc;AACd,WAAO,KAAKC;EACf;EACD,IAAI,WAAW;AACX,WAAO,KAAKC;EACf;EACD,0BAA0B,YAAY;AAClC,QAAI,EAAE,OAAO,QAAAU,QAAA,IAAW;AACxB,QAAI,UAAU,KAAKhB;AACnB,QAAI,YAAY,MACZ,WAAU,QAAQgB,UAAS,UAAU;aAEhC,YAAY,MACjB,WAAU,QAAQA,UAAS,UAAU;AAEzC,QAAI,YAAY,QACZ,CAAAA,UAAS,QAAQ,KAAKZ;aAEjB,YAAY,SACjB,SAAQY,UAAS,KAAKZ;AAG1B,QAAI,KAAKR,eAAe,aAAa;AACjC,YAAMqB,KAAI,kBAAkB,KAAKrB,KAAK,kBAAkB,mBAAmB,oBAAoB,mBAAmB;AAClH,eAAUqB,GAAE,kBAAkBA,GAAE;AAChC,MAAAD,WAAWC,GAAE,iBAAiBA,GAAE;IACnC;AACD,WAAO;MAAE;MAAO,QAAAD;IAAQ;EAC3B;EACD,gBAAgB,MAAM;AAClB,UAAM,MAAM,KAAK,CAAA,EAAG,eAAe,CAAA;AACnC,UAAM,aAAa;MAAE,OAAO,IAAI;MAAY,QAAQ,IAAI;IAAW;AACnE,SAAK,OAAO,KAAKF,0BAA0B,UAAA;AAC3C,SAAKR,YAAY;MACb,GAAG;MAAG,GAAG;MACT,OAAO,WAAW;MAClB,QAAQ,WAAW;IACtB;EACJ;EACD,IAAI,KAAK,MAAM;YACC,MAAM,MAAM;AACxB,SAAKJ,QAAQ;AACb,QAAI,KAAKD,gBACL,MAAKA,gBAAgB,MAAM,KAAKL,GAAAA;AAEpC,SAAKO,cAAAA;EACR;EACD,IAAI,OAAO;AACP,WAAO,KAAKD;EACf;AACJ;ACjMD,IAAa,sBAAsB,MAAM;AACrC,MAAI,UAAU;AACd,QAAM,YAAY,SAAS,cAAc,KAAK;AAC9C,YAAU,MAAM,QAAQ;AACxB,YAAU,MAAM,SAAS;AACzB,YAAU,MAAM,kBAAkB;AAClC,YAAU,MAAM,UAAU;AAC1B,YAAU,MAAM,UAAU;AAC1B,YAAU,MAAM,MAAM;AACtB,YAAU,MAAM,OAAO;AACvB,YAAU,MAAM,WAAW;AAC3B,YAAU,MAAM,aAAa;AAC7B,QAAM,iBAAiB,SAAS,cAAc,KAAK;AACnD,iBAAe,MAAM,WAAW;AAChC,iBAAe,MAAM,YAAY;AACjC,iBAAe,MAAM,YAAY;AACjC,YAAU,YAAY;AACtB,YAAU,OAAO,cAAA;AACjB,QAAM,cAAc,CAACe,OAAM;AACvB,IAAAA,GAAE,MAAM,UAAU;AAClB,IAAAA,GAAE,MAAM,YAAY;EACvB;AACD,QAAM,cAAc,SAAS,cAAc,QAAQ;AACnD,cAAY,cAAc;AAC1B,cAAY,iBAAiB,SAAS,MAAM;AACxC,SAAA;EACH,CAAA;AACD,QAAM,aAAa,SAAS,cAAc,QAAQ;AAClD,aAAW,cAAc;AACzB,aAAW,iBAAiB,SAAS,MAAM;AACvC,cAAU;AACV,SAAA;EACH,CAAA;AACD,cAAY,WAAA;AACZ,cAAY,UAAA;AACZ,YAAU,OAAO,WAAA;AACjB,YAAU,OAAO,UAAA;AACjB,WAAS,KAAK,OAAO,SAAA;AACrB,QAAM,OAAO,CAAC,OAAO;AACjB,cAAU,MAAM,UAAU;AAC1B,mBAAe,aAAa,GAAG,QAAQ,QAAQ,GAAG,KAAA,WAAgB,MAAMC,iBAAgB,EAAA,CAAG;EAC9F;AACD,QAAM,OAAO,MAAM;AACf,cAAU,MAAM,UAAU;EAC7B;AACD,SAAO,UAAU,CAAC,SAAS,KAAK,QAAQ,OAAO,UAAU;AACrD,QAAI,QACA,KAAI,OAAO;AACP,cAAQ,IAAI,KAAA;AACZ,WAAK,KAAA;IACR,OACI;AACD,cAAQ,IAAI,OAAA;AACZ,WAAK,OAAA;IACR;EAER;AACD,SAAO,iBAAiB,sBAAsB,CAACzC,WAAU;AACrD,YAAQ,IAAIA,OAAM,MAAA;AAClB,QAAI,QACA,MAAKA,OAAM,MAAA;EAElB,CAAA;AACD,SAAO;IAAE;IAAM;EAAM;AACxB;ACjFD,IAAa,eAAe,CAAC,UAAU,WAAW;AAC9C,QAAM,UAAU,SAAS,cAAc,OAAO;AAE9C,UAAQ,cAAc;AAEtB,MAAI;AACJ,MAAI,SAAS,YAAY;AACrB,iBAAa,SAAS;AAEtB,eAAW,YAAY;EAC1B,MAEG,cAAa,SAAS,aAAa,EAAE,MAAM,OAAQ,CAAA;AAEvD,aAAW,OAAO,OAAA;AAClB,SAAO;AACV;ACeD,IAAa,MAAM,CAAC,mBAAmB,OAAO,CAAE,MAAK;AACjD,QAAM,EAAE,WAAW,GAAG,aAAa,MAAM,WAAA0C,aAAY,OAAO,qBAAqB,MAAM,MAAM,GAAE,IAAK;AACpG,MAAI,QAAQ;AACZ,MAAI;AACJ,MAAI,iBAAiB;AACrB,QAAM,gBAAgB7D,WAAU,iBAAA;AAChC,QAAM,aAAa,aACb,wMACA;AACN,QAAM,aAAa,aAAa,eAAe;;mBAEhC,UAAA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;IAqCf,GAAA;GACD;AACC,QAAMG,OAAK,SAAS,cAAc,KAAK;AACvCA,OAAG,YAAY;AACf,aAAW,OAAOA,IAAAA;AAClB,QAAM,QAAQ,CAAC,mBAAmB;AAC9B,UAAM2D,QAAO,SAAS,cAAc,KAAK;AACzC,QAAI,OAAO,mBAAmB,SAC1B,CAAAA,MAAK,YAAY;aAEZ,0BAA0B,OAAO;AACtC,YAAM,QAAQ,eAAe;AAC7B,MAAAA,MAAK,YAAY,UAAU,SAAY,eAAe,SAAA,IAAa,MAAM,SAAA;IAC5E,MAEG,CAAAA,MAAK,YAAY;AAErB,IAAAA,MAAK,UAAU,IAAI,OAAO;AAC1B,WAAOA,KAAA;AACP,cAAU;AACV,qBAAiB;EACpB;AACD,MAAI,cAAc;AAClB,QAAM,OAAO,CAAC,YAAY,OAAO;AAC7B,UAAM,UAAUC,MAAI,SAAA;AACpB,QAAI,CAAC,QACD,QAAO;AACX,YAAQ,UAAU,IAAI,SAAS;AAC/B,WAAO;EACV;AACD,QAAMA,QAAM,CAAC,YAAY,OAAO;AAC5B,QAAI;AACJ,UAAM5B,YAAW,OAAO,YAAY,IAAA,IAAQ;AAC5C,QAAI,KAAK,iBAAiBA,YAAW,KAAK,cACtC;AACJ,kBAAc,OAAO,YAAY,IAAA;AACjC,QAAI,OAAO,cAAc,SACrB,WAAU,KAAK,UAAU,SAAA;aAEpB,cAAc,OACnB,WAAU;aAEL,cAAc,KACnB,WAAU;aAEL,OAAO,cAAc,UAAU;AACpC,UAAI,OAAO,MAAM,OAAA,EACb,WAAU;AACd,gBAAU,UAAU,SAAA;IACvB,MAEG,WAAU;AAEd,QAAI,QAAQ,WAAW,GAAG;AACtB,YAAM,OAAO,SAAS,cAAc,IAAI;AACxC,gBAAU;AACV,aAAO,IAAA;IACV,WACQ,YAAY,WAAW,oBAAoB;AAChD,YAAM,cAAchC,KAAG;AACvB,UAAI,YAAY,YAAY,cAAc,QAAQ;AAClD,UAAI,cAAc,MAAM;AACpB,oBAAY,SAAS,cAAc,KAAK;AACxC,kBAAU,YAAY;AACtB,oBAAY,sBAAsB,aAAa,SAAA;MAClD;AACD,UAAI,gBAAgB,KAChB,WAAU,eAAe,EAAE,gBAAgB,SAAA;AAE/C,aAAO;IACV,OACI;AACD,YAAM2D,QAAO,SAAS,cAAc,KAAK;AACzC,MAAAA,MAAK,cAAc;AACnB,aAAOA,KAAA;AACP,gBAAU;AACV,aAAOA;IACV;EACJ;AACD,QAAM,SAAS,CAACA,UAAS;AACrB,QAAID,YAAW;AACX,YAAM,UAAU,SAAS,cAAc,KAAK;AAC5C,YAAMA,cAAY,SAAS,cAAc,KAAK;AAC9CA,kBAAU,YAAY;AACtBA,kBAAU,eAAc,oBAAI,KAAA,GAAO,mBAAA;AACnC,cAAQ,OAAOA,aAAWC,KAAA;AAC1B,MAAAA,MAAK,UAAU,IAAI,KAAK;AACxB,cAAQ,UAAU,IAAI,MAAM;AAC5B,MAAAA,QAAO;IACV,MAEG,CAAAA,MAAK,UAAU,IAAI,QAAQ,KAAK;AAEpC,QAAI,KAAK,QACL3D,MAAG,OAAO2D,KAAA;QAGV3D,MAAG,aAAa2D,OAAM3D,KAAG,UAAA;AAE7B,QAAI,WAAW,KAAK,EAAE,QAAQ,WAAW,EACrC,QAAO,QAAQ,UAAU;AACrBA,WAAG,WAAW,OAAA;AACd;IACH;AAEL,QAAI,KAAK,QAELA,MAAG,YAAYA,KAAG;AAEtB,qBAAiB;EACpB;AACD,QAAM6D,UAAQ,MAAM;AAChB7D,SAAG,YAAY;AACf,cAAU;AACV,qBAAiB;AACjB,YAAQ;EACX;AACD,QAAM,UAAU,MAAM;AAClBA,SAAG,OAAA;EACN;AACD,SAAO;IACH;IACA,KAAA;IACA;IACA;IACA,OAAA;IACA;IACA,IAAI,UAAU;AACV,aAAO,UAAU;IACpB;EACJ;AACJ;ACjMD,IAAa,gBAAgB,CAAC,UAAU,CAAE,MAAK;AAC3C,QAAM,WAAW;IACb,KAAK,QAAQ;IACb,OAAO,QAAQ;IACf,MAAM,QAAQ;EACjB;AACD,QAAM,aAAa,QAAQ,cAAc;AACzC,QAAM,eAAe,QAAQ;AAC7B,MAAI;AACJ,MAAI,aACA,cAAaH,WAAU,YAAA;OAEtB;AACD,iBAAa,SAAS,cAAc,KAAK;AACzC,eAAW,KAAK;AAChB,aAAS,KAAK,QAAQ,UAAA;EACzB;AACD,MAAI,CAAC,YAAY;AACb,eAAW,MAAM,WAAW;AAC5B,eAAW,MAAM,OAAO;AACxB,eAAW,MAAM,MAAM;AACvB,eAAW,MAAM,gBAAgB;AACjC,eAAW,MAAM,UAAU;EAC9B;AACD,QAAMiE,UAAS,IAAI,YAAY,OAAA;AAC/B,QAAM,aAAa,CAAC,SAAS;AACzB,eAAW,MAAM,UAAU,OAAO,UAAU;EAC/C;AACD,UAAQ,QAAQ,CAAC,YAAY,uBAAuB;AAChD,IAAAA,QAAO,MAAM,OAAA;AACb,QAAI,mBAAmB,SAAS,EAC5B,CAAAA,QAAO,MAAM,kBAAA;AAEjB,aAAS,MAAM,SAAS,GAAG,kBAAA;AAC3B,eAAW,IAAA;EACd;AACD,UAAQ,OAAO,CAAC,YAAY,uBAAuB;AAC/C,IAAAA,QAAO,KAAK,OAAA;AACZ,QAAI,mBAAmB,SAAS,EAC5B,CAAAA,QAAO,KAAK,kBAAA;AAEhB,eAAW,IAAA;EACd;AACD,UAAQ,MAAM,CAAC,YAAY,uBAAuB;AAC9C,IAAAA,QAAO,IAAI,OAAA;AACX,QAAI,mBAAmB,SAAS,EAC5B,CAAAA,QAAO,IAAI,kBAAA;AAEf,aAAS,IAAI,SAAS,GAAG,kBAAA;AACzB,eAAW,IAAA;EACd;AACD,SAAO,UAAU,CAAC9C,QAAO,QAAQ,QAAQ,QAAQ,UAAU;AACvD,UAAM,oBAAoB,WAAW,SAAY,KAAK,WAAW,QAAQ,KAAK,EAAE,SAAS,KAAM,CAAA;AAC/F,UAAM,cAAcyC,iBAAgB,KAAA;AACpC,IAAAK,QAAO,MAAM,cAAc,KAAK,iBAAA,IAAqB,MAAA,GAAS;AAC9D,eAAW,IAAA;EACd;AACD,SAAO,iBAAiB,sBAAsB,SAAUC,IAAG;AACvD,IAAAD,QAAO,MAAMC,GAAE,MAAA;AACf,eAAW,IAAA;EACd,CAAA;AACJ;ACpED,gBAAuBrC,OAAM,gBAAgB,UAAU,CAAE,GAAE;AACvD,MAAI,OAAO,mBAAmB,SAC1B,QAAOA,OAAM,CAAC,cAAe,GAAE,OAAA;WAE1B,OAAO,mBAAmB,YAAY,cAAc,eACzD,QAAOA,OAAM,CAAC,cAAe,GAAE,OAAA;AAEnC,QAAM,eAAe,WAAW;AAChC,QAAM,WAAW,eAAe,gBAAA,IAAoB,CAACsC,OAAM;AAC3D,MAAI,MAAM,QAAQ,cAAA,GACd;eAAW,QAAQ,eACf,KAAI,OAAO,SAAS,SAChB,YAAW,WAAW,SAAS,iBAAiB,IAAA,GAAO;AACnD,YAAM,gBAAgB;AACtB,UAAI,SAAS,aAAA,EACT,OAAM;IAEb;aAGG,SAAS,IAAA,EACT,OAAM;EAGjB,MAGD,kBAAiB,QAAQ,eACrB,KAAI,OAAO,SAAS,UAChB;eAAW,WAAW,SAAS,iBAAiB,IAAA,EAC5C,KAAI,SAAS,OAAA,EACT,OAAM;EAEb,WAGG,SAAS,IAAA,EACT,OAAM;AAKzB;AClDD,IAAa,SAAS,CAAC,YAAY;AAC/B,QAAM,SAAS,QAAQ;AACvB,QAAM,cAAc,QAAQ,eAAe,OAAO,CAAA,EAAG;AACrD,QAAM,OAAO,UAAU,UAAA,CAAW;AAClC,QAAM,WAAWnE,WAAU,QAAQ,MAAA;AACnC,QAAM,WAAW;iCACY,IAAA;;MAE3B,OAAO,IAAI,CAAA0B,OAAK;AACd,UAAM,UAAU,GAAG,IAAA,IAAQA,GAAE,EAAA;AAC7B,WAAO,6BAA6B,IAAA,cAAkB,OAAA,kBAAyBA,GAAE,EAAA,iBAAmB,OAAA,KAAYA,GAAE,KAAA;EACrH,CAAA,EAAE,KAAK,EAAE,CAAC;;wCAEyB,IAAA;;;AAGpC,WAAS,YAAY;AAErB,QAAM,SAAS,SAAS,eAAe,GAAG,IAAA,OAAW;AAErD,QAAM,WAAW,SAAS,eAAe,IAAA;AACzC,WAAS,cAAc,UAAU,GAAG,iBAAiB,UAAU,CAAAP,WAAS;AACpE,UAAMhB,OAAKgB,OAAM;AAEjBiD,aAAOjE,KAAG,aAAa,aAAa,CAAC;EACxC,CAAA;AACD,MAAI;AACJ,QAAMiE,WAAS,CAAC,OAAO;AACnB,UAAM,WAAW,OAAO,KAAK,CAAA1C,OAAKA,GAAE,OAAO,EAAA;AAC3C,UAAM,aAAa;AACnB,QAAI,QAAQ,iBAAiB;AACzB,YAAM,QAAQ,QAAQ,gBAAgB,YAAY,QAAA;AAClD,UAAI,OAAO,UAAU,aAAa,CAAC,MAC/B;IACP;AACD,QAAI,WACA,YAAW,SAAA;AAEf,mBAAe;AACf,QAAI,UAAU;AACV,eAAS,MAAM,MAAA;AACf,YAAM,QAAQ,IAAI,IAAA,IAAQ,EAAA;AAC1B,YAAM,UAAU,SAAS,cAAc,KAAA;AACvC,UAAI,QACA,SAAQ,UAAU;UAGlB,SAAQ,KAAK,8CAA8C,EAAA,KAAO,KAAA,GAAQ;IAEjF;AACD,QAAI,QAAQ,cACR,SAAQ,cAAc,YAAY,QAAA;EACzC;AACD0C,WAAO,WAAA;AACP,MAAI,SAAS;AACb,QAAM,SAAS,CAAC,MAAM,SAAS;AAC3B,QAAI,CAAC,aACD;AACJ,QAAI,aAAa,OACb,cAAa,OAAO,MAAM,IAAA;aAErB,CAAC,QAAQ;AACd,eAAS;AACT,cAAQ,KAAK,6CAA6C,IAAA,sDAA0D;IACvH;EACJ;AACD,SAAO;IAAE,QAAA;IAAQ;IAAQ;IAAQ;IAAU;EAAQ;AACtD;;AC1BD,IAAa,cAAc,CAAC,YAAY,eAAe;AACnD,UAAQ,WAAR;IACI,KAAK;AACD,aAAO,CAACC,IAAGV,OAAM;AACb,cAAMW,MAAK,kBAAkBD,IAAGV,EAAA;AAChC,eAAO,OAAO,OAAO;UACjB,GAAGW,IAAG,IAAI,OAAO;UACjB,GAAGA,IAAG,IAAI,OAAO;QACpB,CAAA;MACJ;IAEL,KAAK;AACD,aAAO,CAACD,IAAGV,OAAM;AACb,cAAMW,MAAK,kBAAkBD,IAAGV,EAAA;AAChC,eAAO,OAAO,OAAO;UACjB,GAAGW,IAAG,IAAI,OAAO;UACjB,GAAGA,IAAG,IAAI,OAAO;QACpB,CAAA;MACJ;IAEL,KAAK;AACD,aAAO,CAACD,IAAGV,OAAM;AACb,cAAMW,MAAK,kBAAkBD,IAAGV,EAAA;AAChC,eAAO,OAAO,OAAO;UACjB,GAAGW,IAAG,IAAI,SAAS,KAAK;UACxB,GAAGA,IAAG,IAAI,SAAS,KAAK;QAC3B,CAAA;MACJ;IAEL;AACI,YAAM,IAAI,MAAM,kCAAkC,KAAK,UAAU,SAAA,CAAU,EAAE;EAEpF;AACJ;AA+DD,IAAa,aAAa,CAAC,cAAc,UAAU,CAAE,MAAK;AACtD,QAAM,cAAc,QAAQ,UAAU;AACtC,QAAMC,YAAW,QAAQ,YAAY;AACrC,QAAM,SAAS,QAAQ,UAAU;AACjC,QAAMpE,OAAKH,WAAU,YAAA;AACrB,QAAM,YAAY,gBAAgB,WAAA;AAClC,MAAIuE,WAAU;AACV,UAAM5C,KAAI,YAAY,WAAA;AACtB,WAAO,MAAMA,GAAE,UAAU,SAASxB,KAAG,sBAAA,GAAyB,MAAA,CAAO,CAAC;EACzE,MAEG,QAAO,MAAM,UAAU,SAASA,KAAG,sBAAA,GAAyB,MAAA,CAAO;AAE1E;AAWD,IAAa,mBAAmB,CAAC,cAAc,SAAS,SAAS;AAC7D,QAAMA,OAAKH,WAAU,YAAA;AACrB,SAAO,SAASG,KAAG,sBAAA,GAAyB,MAAA;AAC/C;AAaD,IAAa,mBAAmB,CAAC,cAAc,SAAS,eAAe;AACnE,QAAMqE,KAAI,WAAW,cAAc;IAAE,UAAU;IAAM;EAAQ,CAAA;AAC7D,SAAOA,GAAA;AACV;AAoBD,IAAa,kBAAkB,CAAC,cAAc,eAAe;AACzD,UAAQ,aAAR;IACI,KAAK;AACD,aAAO,CAACH,IAAGV,OAAM;AACb,cAAMW,MAAK,kBAAkBD,IAAGV,EAAA;AAChC,eAAO,OAAO,OAAO;UACjB,GAAGW,IAAG,IAAI,OAAO;UACjB,GAAGA,IAAG,IAAI,OAAO;QACpB,CAAA;MACJ;IAEL,KAAK;AACD,aAAO,CAACD,IAAGV,OAAM;AACb,cAAMW,MAAK,kBAAkBD,IAAGV,EAAA;AAChC,eAAO,OAAO,OAAO;UACjB,GAAGW,IAAG,IAAI,OAAO;UACjB,GAAGA,IAAG,IAAI,OAAO;QACpB,CAAA;MACJ;IAEL,KAAK;AACD,aAAO,CAACD,IAAGV,OAAM;AACb,cAAMW,MAAK,kBAAkBD,IAAGV,EAAA;AAChC,eAAO,OAAO,OAAO;UACjB,GAAGW,IAAG;UACN,GAAGA,IAAG;QACT,CAAA;MACJ;IAEL;AACI,YAAM,IAAI,MAAM,uCAAuC,WAAA,0CAAqD;EAEnH;AACJ;AAKD,IAAa,qBAAqB,CAAC,cAAc,aAAa,aAAa,aAAa;AACpF,MAAI,CAAC,aACD,OAAM,IAAI,MAAM,mCAAmC;AACvD,QAAMnE,OAAKH,WAAU,YAAA;AAErB,QAAM,cAAA,WAA8B,aAAa,OAAO,YAAY,OAAO,WAAA;AAC3E,QAAM,YAAYG,KAAG,sBAAA;AACrB,QAAM,YAAA,SAA4B,aAAa,UAAU,QAAQ,GAAG,UAAU,SAAS,CAAA;AAEvFA,OAAG,MAAM,YAAY,aAAa,UAAU,CAAA,OAAQ,UAAU,CAAA;AACjE;AAgBD,IAAa,gBAAgB,CAACA,MAAI,SAAS;AACvC,MAAIA,SAAO,QAAQ,CAACA,KAChB;AACJ,MAAI,CAAC,MAAM,QAAQ,IAAA,EACf,OAAM,IAAI,UAAU,oCAAoC;AAE5D,WAAS,QAAQ,GAAG,QAAQ,KAAK,QAAQ,QAErC,KAAIA,KAAG,UAAU,SAAS,KAAK,KAAA,CAAA,GAAS;AAEpCA,SAAG,UAAU,OAAO,KAAK,KAAA,CAAA;AACzB,QAAI,QAAQ,IAAI,KAAK,OAEjBA,MAAG,UAAU,IAAI,KAAK,QAAQ,CAAA,CAAA;QAI9BA,MAAG,UAAU,IAAI,KAAK,CAAA,CAAA;AAE1B;EACH;AAELA,OAAG,UAAU,IAAI,KAAK,CAAA,CAAA;AACzB;AAKD,IAAa,iBAAiB,CAAC,iBAAiB;AAG5C,QAAMA,OAAKH,WAAU,YAAA;AACrB,QAAM,QAAQ,OAAO,iBAAiBG,IAAAA;AACtC,QAAM,SAAS,MAAM;AAErB,MAAI,WAAW,UAAU,OAAO,WAAW,YACvC,QAAO;IACH,GAAG;IACH,GAAG;IACH,GAAG;EACN;AAGL,QAAM,aAAa,OAAO,SAAS,IAAI,IAAI,OAAO;AAGlD,QAAM,eAAgB,mBAAmB,KAAK,MAAA,EAAS,CAAA,EAAG,MAAM,IAAI;AAIpE,MAAI,eAAe,KACf,QAAO;IACH,GAAG,OAAO,WAAW,aAAa,CAAA,CAAA;IAClC,GAAG,OAAO,WAAW,aAAa,CAAA,CAAA;IAClC,GAAG;EACN;AAIL,MAAI,eAAe,KACf,QAAO;IACH,GAAG,OAAO,WAAW,aAAa,EAAA,CAAA;IAClC,GAAG,OAAO,WAAW,aAAa,EAAA,CAAA;IAClC,GAAG,OAAO,WAAW,aAAa,EAAA,CAAA;EACrC;AAEL,SAAO;IAAE,GAAG;IAAG,GAAG;IAAG,GAAG;EAAG;AAC9B;AAUD,IAAa,cAAc,CAAC,SAAS,YAAY;AAC7C,QAAMA,OAAK,SAAS,cAAc,OAAA;AAClC,UAAQ,eAAe,aAAaA,MAAI,QAAQ,WAAA;AAChD,SAAOA;AACV;AAUD,IAAa,WAAW,CAAC,QAAQ,YAAY;AACzC,QAAMA,OAAK,SAAS,cAAc,OAAA;AAClC,SAAO,OAAOA,IAAAA;AACd,SAAOA;AACV;AAKD,IAAa,QAAQ,CAAC,WAAW;AAC7B,MAAImD,KAAI,OAAO;AACf,SAAOA,IAAG;AACN,IAAAA,GAAE,OAAA;AACF,IAAAA,KAAI,OAAO;EACd;AACJ;AAMD,IAAa,kBAAkB,CAAC,WAAW;AACvC,QAAM5B,KAAI,IAAI,QAAQ,CAAC+C,UAAS,WAAW;AAEvC,UAAM,UAAUlE,YAAAA,QAAM,UAAU,MAAA;AAChC,cAAU,UAAU,UAAU,KAAK,UAAU,OAAA,CAAQ,EAAE,KAAK,MAAM;AAC9D,MAAAkE,SAAQ,IAAA;IACX,GAAE,CAAC,UAAU;AACV,cAAQ,KAAK,6BAA6B;AAC1C,cAAQ,IAAI,OAAA;AACZ,aAAO,IAAI,MAAM,KAAA,CAAA;IACpB,CAAA;EACJ,CAAA;AACD,SAAO/C;AACV;AAWD,IAAa,eAAe,CAAC,QAAQ,YAAY;AAC7C,QAAM,SAAS,QAAQ,aAAa,WAAW,KAAK;AACpD,MAAI;AACJ,MAAI;AACJ,aAAW4B,MAAK,OAAO,UAAU;AAC7B,UAAM,OAAOA,GAAE,aAAa,WAAW,KAAK;AAC5C,QAAI,UAAU,KACV,WAAUA;AACd,QAAI,UAAU,KACV,YAAWA;AACf,QAAI,YAAY,UAAa,aAAa,OACtC;EACP;AACD,MAAI,YAAY,OACZ,SAAQ,sBAAsB,YAAY,OAAA;WAErC,aAAa,OAClB,QAAO,OAAO,OAAA;MAGd,UAAS,sBAAsB,eAAe,OAAA;AAErD;AAYD,IAAa,oBAAoB,CAAC,UAAU,MAAM,iBAAiB;AAC/D,MAAI,OAAO,aAAa,YACpB,OAAM,IAAI,MAAM,+BAA+B;AACnD,MAAI,aAAa,KACb,OAAM,IAAI,MAAM,0BAA0B;AAC9C,QAAM,OAAO,oBAAI,IAAA;AACjB,aAAW,CAAC,KAAK9C,MAAA,KAAU,MAAM;AAC7B,UAAM,KAAK,KAAK,GAAA;AAChB,UAAML,OAAK,SAAS,cAAc,IAAI,EAAA,EAAI;AAC1C,UAAM,UAAU,aAAaK,QAAOL,IAAAA;AACpC,QAAIA,SAAO,SAAS;AAChB,cAAQ,KAAK;AACb,eAAS,OAAO,OAAA;IACnB;AACD,SAAK,IAAI,EAAA;EACZ;AACD,QAAM,QAAQ,CAAE;AAChB,aAAW,SAAS,SAAS,SACzB,KAAI,CAAC,KAAK,IAAI,MAAM,EAAA,EAChB,OAAM,KAAK,KAAA;AASnB,aAAWuB,MAAK,MACZ,CAAAA,GAAE,OAAA;AACT;AAOD,IAAa,OAAO,CAAC,OAAO;AACxB,QAAM,UAAU,SAAS,eAAe,EAAA;AACxC,MAAI,YAAY,KACZ,OAAM,IAAI,MAAM,yBAAyB,EAAA,aAAe;AAC5D,SAAO;AACV;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AE7cD,IAAM,OAAO,KAAK,KAAK;AAMvB,IAAa,aAAa,CAAC,gCAAgC;AACvD,MAAI,gCAAgC,KAChC,OAAM,IAAI,MAAM,yEAAyE;AAE7F,MAAI,gCAAgC,OAChC,OAAM,IAAI,MAAM,8EAA8E;AAElG,QAAM,MAAM,uCAAuC,2BAC7C,8BACA,uCAAuC,oBACnC,4BAA4B,WAAW,IAAI,IAC3C,OAAO,gCAAgC,WACnCgD,WAAU,2BAAA,EAA6B,WAAW,IAAI,IACtD;AACd,MAAI,QAAQ,KACR,OAAM,IAAI,MAAM,wCAAwC;AAC5D,SAAO;AACV;AAOD,IAAaC,eAAa,CAAC,eAAe,iBAAiB;AACvD,QAAM,MAAM,WAAW,aAAA;AACvB,SAAO;IACH;IACA,MAAM,aAAa,MAAM;AACrB,YAAM,KAAK,aAAa,IAAA;IAC3B;IACD,KAAK,YAAY,MAAM;AACnBC,aAAK,KAAK,YAAY,IAAA;IACzB;IACD,KAAK,aAAa,MAAM;AACpB,WAAK,KAAK,aAAa,IAAA;IAC1B;IACD,OAAO,cAAc,MAAM;AACvB,aAAO,KAAK,cAAc,IAAA;IAC7B;IACD,gBAAgB,cAAc,MAAM;AAChC,sBAAgB,KAAK,cAAc,IAAA;IACtC;IACD,YAAY,cAAc,MAAM;AAC5B,kBAAY,KAAK,cAAc,IAAA;IAClC;IACD,IAAI,aAAa,MAAM;AACnB,UAAI,KAAK,aAAa,IAAA;IACzB;IACD,OAAO,eAAe,MAAM;AACxBC,eAAO,KAAK,eAAe,IAAA;IAC9B;IACD,IAAI,YAAY,MAAM;AAClB,UAAI,KAAK,YAAY,IAAA;IACxB;IACD,UAAU,OAAO,MAAM;AACnB,UAAI,KAAK,WAAW,UAAa,iBAAiB,OAC9C,QAAO;QAAE,GAAG;QAAM,QAAQ;UAAE,GAAG;UAAc,GAAG;UAAG,GAAG;QAAG;MAAE;AAE/D,gBAAU,KAAK,OAAO,IAAA;IACzB;EACJ;AACJ;AAMD,IAAM,SAAS,CAAC,SAAS,WAAW,KAAK,aAAa,KAAK,SAAA;AAO3D,IAAMC,cAAY,CAAC,KAAK,OAAO,CAAE,MAAK,kBAAkB;AACpD,MAAI,QAAQ,OACR,OAAM,IAAI,MAAM,eAAe;AAEnC,QAAM,QAAQ,aAAa,GAAA,EAAK,KAAK,OAAO,IAAA,GAAO,GAAG,aAAA;AAEtD,QAAM,MAAA;AACN,SAAO;AACV;AAOD,IAAa,MAAM,CAAC,KAAK,MAAM,OAAO,CAAE,MAAK;AACzCA,cAAU,KAAK,IAAA;AACf,QAAM,OAAO,CAACC,UAAQ;AAClB,QAAI,UAAA;AACJ,QAAI,IAAIA,MAAI,GAAGA,MAAI,GAAGA,MAAI,QAAQA,MAAI,aAAaA,MAAI,SAAA;AACvD,QAAI,OAAA;EACP;AACD,QAAM,YAAY,MAAM,QAAQ,IAAA,IAAQ,OAAO,CAAC,IAAK;AACrD,aAAWA,SAAO,UACd,MAAKA,KAAAA;AAEZ;AAOD,IAAM,aAAa,CAAC,aAAa,cAAc;AAC3C,QAAMC,SAAQ,CAAC,QAAQ;AACnB,QAAI,UACA,KAAI,YAAY;AACpB,QAAI,YACA,KAAI,cAAc;EACzB;AACD,SAAOA;AACV;AACD,IAAM,SAAS,CAAC,WAAW,UAAU,YAAY;AAC7C,QAAMA,SAAQ,CAAC,QAAQ;AACnB,QAAI,UACA,KAAI,YAAY;AACpB,QAAI,SACA,KAAI,WAAW;AACnB,QAAI,QACA,KAAI,UAAU;EACrB;AACD,SAAOA;AACV;AAOD,IAAa,eAAe,CAAC,KAAK,QAAQ;AACtC,UAAQ,IAAIC,gBAAA;AACZ,QAAMC,QAAO,IAAI,QAAQ;AACrB,YAAQ,IAAID,gBAAA;AACZ,UAAME,KAAI,IAAI,KAAK,GAAG,GAAA;AACtB,eAAWC,MAAK,IACZ,CAAAA,GAAE,GAAA;AACN,WAAO,aAAa,KAAKD,EAAA;EAC5B;AACD,QAAME,OAAM,MAAM;AACd,UAAMF,KAAI,KAAK,IAAA;AACf,WAAO,aAAa,KAAKA,EAAA;EAC5B;AACD,QAAMH,SAAQ,MAAM;AAChB,QAAI,QAAQ,OACR,QAAO,aAAa,GAAA;AACxB,eAAW,MAAM,IAAI,KACjB,IAAG,GAAA;AACP,WAAO,aAAa,KAAK,GAAA;EAC5B;AACD,SAAO;IAAE,MAAAE;IAAM,KAAAG;IAAK,OAAAL;EAAO;AAC9B;AAOD,IAAa,oBAAoB,CAAC,KAAK,QAAQ,SAAS;AACpDF,cAAU,KAAK,IAAA;AAEf,MAAI,OAAO,OAAO,CAAA,EAAG,GAAG,OAAO,CAAA,EAAG,CAAA;AAClC,aAAW,CAAC,OAAOQ,EAAA,KAAM,OAAO,QAAA,GAAW;AACvC,QAAI,QAAQ,KAAK,OAAO,OACpB;AACJ,UAAM,QAAQ,OAAO,QAAQ,CAAA;AAC7B,UAAM,MAAM;MACR,IAAIA,GAAE,IAAI,MAAM,KAAK;MACrB,IAAIA,GAAE,IAAI,MAAM,KAAK;IACxB;AACD,UAAM,QAAQ,IAAI,IAAIA,GAAE,KAAK;AAC7B,UAAM,QAAQ,IAAI,IAAI,MAAM,KAAK;AACjC,QAAI,iBAAiB,MAAM,MAAM,GAAG,IAAI,GAAG,IAAI,CAAA;AAC/C,QAAI,iBAAiB,MAAM,MAAM,GAAG,MAAM,GAAG,MAAM,CAAA;EACtD;AACJ;AAmBD,IAAaT,WAAS,CAAC,KAAK,eAAe,OAAO,CAAE,MAAK;AACrDC,cAAU,KAAK,IAAA;AACf,QAAM,OAAO,CAACS,OAAM;AAChB,QAAI,UAAA;AACJ,QAAI,IAAIA,GAAE,GAAGA,GAAE,GAAGA,GAAE,QAAQ,GAAG,IAAA;AAC/B,QAAI,KAAK,YACL,KAAI,OAAA;AACR,QAAI,KAAK,UACL,KAAI,KAAA;EACX;AACD,MAAI,MAAM,QAAQ,aAAA,EACd,YAAWA,MAAK,cACZ,MAAKA,EAAA;MAGT,MAAK,aAAA;AAEZ;AAQD,IAAa,UAAU,CAAC,KAAK,gBAAgB,OAAO,CAAE,MAAK;AACvDT,cAAU,KAAK,IAAA;AACf,QAAM,OAAO,CAACU,cAAY;AACtB,QAAI,UAAA;AACJ,UAAM,WAAWA,UAAQ,YAAY;AACrC,UAAM,aAAaA,UAAQ,cAAc;AACzC,UAAM,WAAWA,UAAQ,YAAY;AACrC,QAAI,QAAQA,UAAQ,GAAGA,UAAQ,GAAGA,UAAQ,SAASA,UAAQ,SAAS,UAAU,YAAY,QAAA;AAC1F,QAAI,KAAK,YACL,KAAI,OAAA;AACR,QAAI,KAAK,UACL,KAAI,KAAA;EACX;AACD,QAAM,gBAAgB,MAAM,QAAQ,cAAA,IAAkB,iBAAiB,CAAC,cAAe;AACvF,aAAWA,aAAW,cAClB,MAAKA,SAAAA;AAEZ;AAQD,IAAa,QAAQ,CAAC,KAAK,aAAa,OAAO,CAAE,MAAK;AAClDV,cAAU,KAAK,IAAA;AACf,QAAM,OAAO,CAACW,WAAS;AAEnB,QAAA,kBAA8BA,MAAAA,EAC1B,iBAAgB,KAAKA,QAAM,IAAA;oBACTA,MAAAA,EAClBb,QAAK,KAAKa,QAAM,IAAA;QAEhB,OAAM,IAAI,MAAM,qBAAqB,KAAK,UAAUA,MAAAA,CAAK,EAAE;EAClE;AACD,MAAI,MAAM,QAAQ,WAAA,EACd,YAAWH,MAAK,YACZ,MAAKA,EAAA;MAGT,MAAK,WAAA;AAEZ;AAWD,IAAa,kBAAkB,CAAC,KAAK,KAAK,OAAO,CAAE,MAAK;AACpD,QAAM,aAAa,KAAK,QAAQ;AAChC,cAAY,UAAU,KAAK,KAAK,CAAC;AACjC,MAAI,IAAI,WAAW,EACf;AAEJ,aAAW,CAAC,OAAOI,GAAA,KAAO,IAAI,QAAA,EAAS,SACtBA,KAAI,SAAS,KAAA,EAAO;AACrCZ,cAAU,KAAK,IAAA;AAEf,MAAI,KAAK,UACL,KAAI,YAAY,KAAK;AACzB,MAAI,UAAA;AACJ,MAAI,OAAO,IAAI,CAAA,EAAG,GAAG,IAAI,CAAA,EAAG,CAAA;AAC5B,aAAWY,OAAM,IACb,KAAI,OAAOA,IAAG,GAAGA,IAAG,CAAA;AACxB,MAAI,WACA,KAAI,OAAO,IAAI,CAAA,EAAG,GAAG,IAAI,CAAA,EAAG,CAAA;AAEhC,MAAI,KAAK,eACJ,KAAK,gBAAgB,UAAa,KAAK,cAAc,OACtD,KAAI,OAAA;AAER,MAAI,KAAK,UACL,KAAI,KAAA;AAEX;AAQD,IAAa,cAAc,CAAC,KAAK,KAAK,OAAO,CAAE,GAAE,WAAW;AACxD,MAAI,IAAI,WAAW,EACf;AAEJ,aAAW,CAAC,OAAOA,GAAA,KAAO,IAAI,QAAA,EAAS,SACtBA,KAAI,SAAS,KAAA,EAAO;AACrCZ,cAAU,KAAK,IAAA;AACf,aAAW,CAAC,OAAOY,GAAA,KAAO,IAAI,QAAA,GAAW;AACrC,UAAM,QAAQ,WAAW,UAAa,QAAQ,OAAO,SAAS,OAAO,KAAA,IAAS,MAAM,SAAA;AACpF,QAAI,SAAS,MAAM,SAAA,GAAYA,IAAG,GAAGA,IAAG,CAAA;EAC3C;AACJ;AAOD,IAAa,iBAAiB,CAAC,KAAKC,WAAU;AAC1C,QAAMC,KAAI,IAAI,aAAA;AACd,SAAO;IACH,GAAGD,OAAM,IAAIC,GAAE,IAAID,OAAM,IAAIC,GAAE,IAAIA,GAAE;IACrC,GAAGD,OAAM,IAAIC,GAAE,IAAID,OAAM,IAAIC,GAAE,IAAIA,GAAE;EACxC;AACJ;AAaD,IAAa,YAAY,CAAC,aAAa;AACnC,QAAM,MAAM,SAAS,cAAc,KAAK;AACxC,MAAI,MAAM,SAAS,UAAU,YAAY;AACzC,SAAO;AACV;AAOD,IAAa,MAAM,CAAC,KAAK,KAAK,SAAS;AACnC,WAAS,CAAE;AACX,QAAM,SAAS,KAAK,UAAU;AAC9B,QAAM,YAAY,MAAM,QAAQ,GAAA,IAAO,MAAM,CAAC,GAAI;AAClD,QAAM,SAAS,KAAK,SAAS,KAAK,SAAS,KAAK,gBAAgB;AAChE,MAAI,SAAS,KAAK,SAAS,KAAK,SAAS,KAAK,cAAc;AAC5D,MAAI,CAAC,UAAU,CAAC,OACZ,UAAS;AACbd,cAAU,KAAK,IAAA;AACf,aAAWe,SAAO,WAAW;AACzB,QAAI,UAAA;AACJ,QAAI,YAAYA,MACZ,KAAI,IAAIA,MAAI,GAAGA,MAAI,GAAGA,MAAI,QAAQ,GAAG,IAAI,KAAK,EAAA;QAG9C,KAAI,IAAIA,MAAI,GAAGA,MAAI,GAAG,QAAQ,GAAG,IAAI,KAAK,EAAA;AAE9C,QAAI,OACA,KAAI,KAAA;AAER,QAAI,OACA,KAAI,OAAA;EAEX;AAsBJ;AAOD,IAAa,SAAS,CAAC,KAAK,cAAc,SAAS;AAC/C,MAAA,kBAA8B,YAAA,EAC1B,iBAAgB,KAAK,cAAc,IAAA;yBAER,YAAA,EAC3B,aAAY,KAAK,cAAc,IAAA;AAEtC;AACD,IAAM,cAAc,CAAC,KAAK,cAAc,OAAO,CAAE,MAAK;AAClD,MAAI,QAAQf,YAAU,KAAK,IAAA;AAC3B,QAAM,EAAE,GAAAgB,IAAG,GAAAC,IAAG,QAAQ,QAAAC,QAAA,IAAW;AACjC,QAAM,UAAU,KAAK,SAAS;AAC9B,MAAI,SAAS;EAKZ;AACD,MAAI,UAAA;AACJ,MAAI,OAAOF,GAAE,GAAGA,GAAE,CAAA;AAClB,MAAI,cAAc,OAAO,GAAG,OAAO,GAAGE,QAAO,GAAGA,QAAO,GAAGD,GAAE,GAAGA,GAAE,CAAA;AACjE,MAAI,OAAA;AACJ,MAAI,SAAS;AACT,YAAQ,MAAM,KAAK,OAAO;MACtB,GAAG;MACH,aAAA,gBAAoC,KAAK,eAAe,UAAU,GAAA;MAClE,WAAA,gBAAkC,KAAK,aAAa,UAAU,GAAA;IACjE,CAAA,CAAC;AACF,UAAM,MAAA;AACN,QAAI,OAAOD,GAAE,GAAGA,GAAE,CAAA;AAClB,QAAI,OAAO,OAAO,GAAG,OAAO,CAAA;AAC5B,QAAI,OAAA;AACJ,QAAI,OAAOC,GAAE,GAAGA,GAAE,CAAA;AAClB,QAAI,OAAOC,QAAO,GAAGA,QAAO,CAAA;AAC5B,QAAI,OAAA;AACJ,QAAI,SAAS,KAAKF,GAAE,IAAI,GAAGA,GAAE,CAAA;AAC7B,QAAI,SAAS,KAAKC,GAAE,IAAI,GAAGA,GAAE,CAAA;AAC7B,QAAI,SAAS,MAAM,OAAO,IAAI,GAAG,OAAO,CAAA;AACxC,QAAI,SAAS,MAAMC,QAAO,IAAI,GAAGA,QAAO,CAAA;AACxC,QAAI,KAAK,QAAQ,EAAE,QAAQ,EAAG,CAAA;AAC9B,QAAI,KAAKA,SAAQ,EAAE,QAAQ,EAAG,CAAA;AAC9B,QAAI,KAAKF,IAAG,EAAE,QAAQ,EAAG,CAAA;AACzB,QAAI,KAAKC,IAAG,EAAE,QAAQ,EAAG,CAAA;AACzB,YAAQ,MAAM,IAAA;AACd,UAAM,MAAA;EACT;AACJ;AACD,IAAM,kBAAkB,CAAC,KAAK,cAAc,OAAO,CAAE,MAAK;AACtD,QAAM,EAAE,GAAAD,IAAG,GAAAC,IAAG,WAAAE,WAAA,IAAc;AAC5B,QAAM,UAAU,KAAK,SAAS;AAC9B,MAAI,QAAQnB,YAAU,KAAK,IAAA;AAC3B,MAAI,UAAA;AACJ,MAAI,OAAOgB,GAAE,GAAGA,GAAE,CAAA;AAClB,MAAI,iBAAiBG,WAAU,GAAGA,WAAU,GAAGF,GAAE,GAAGA,GAAE,CAAA;AACtD,MAAI,OAAA;AACJ,MAAI,SAAS;AAOT,YAAQ,MAAM,KAAK,OAAO;MACtB,GAAG;MACH,aAAA,gBAAoC,KAAK,eAAe,UAAU,GAAA;MAClE,WAAA,gBAAkC,KAAK,aAAa,UAAU,GAAA;IACjE,CAAA,CAAC;AACF,oBAAgB,KAAK;MAACD;MAAGG;MAAWF;IAAE,CAAA;AACtC,QAAI,SAAS,KAAKD,GAAE,IAAI,GAAGA,GAAE,CAAA;AAC7B,QAAI,SAAS,KAAKC,GAAE,IAAI,GAAGA,GAAE,CAAA;AAC7B,QAAI,SAAS,KAAKE,WAAU,IAAI,GAAGA,WAAU,CAAA;AAC7C,QAAI,KAAKA,YAAW,EAAE,QAAQ,EAAG,CAAA;AACjC,QAAI,KAAKH,IAAG,EAAE,QAAQ,EAAG,CAAA;AACzB,QAAI,KAAKC,IAAG,EAAE,QAAQ,EAAG,CAAA;AAKzB,YAAQ,MAAM,IAAA;AACd,UAAM,MAAA;EACT;AACJ;AAYD,IAAanB,SAAO,CAAC,KAAK,QAAQ,OAAO,CAAE,MAAK;AAC5C,QAAM,UAAU,KAAK,SAAS;AAC9B,QAAMQ,KAAI,OAAO,KAAK,WAAW,KAAK,UAAU,KAAK,OAAA;AACrDN,cAAU,KAAK,MAAMM,EAAA;AACrB,QAAM,OAAO,CAACc,OAAM;AAChB,UAAM,EAAE,GAAAJ,IAAG,GAAAC,GAAA,IAAMG;AACjB,QAAI,UAAA;AACJ,QAAI,OAAOJ,GAAE,GAAGA,GAAE,CAAA;AAClB,QAAI,OAAOC,GAAE,GAAGA,GAAE,CAAA;AAClB,QAAI,SAAS;AACT,UAAI,SAAS,KAAKD,GAAE,GAAGA,GAAE,CAAA;AACzB,UAAI,SAAS,KAAKC,GAAE,GAAGA,GAAE,CAAA;AACzB,UAAI,KAAKD,IAAG;QAAE,QAAQ;QAAG,aAAa;MAAS,CAAA;AAC/C,UAAI,KAAKC,IAAG;QAAE,QAAQ;QAAG,aAAa;MAAS,CAAA;IAClD;AACD,QAAI,OAAA;EACP;AACD,MAAI,MAAM,QAAQ,MAAA,EACd,YAAWI,MAAK,OACZ,MAAKA,EAAA;MAGT,MAAK,MAAA;AAEZ;AAOD,IAAa,WAAW,CAAC,KAAK,QAAQ,OAAO,CAAE,MAAK;AAChDrB,cAAU,KAAK,IAAA;AACf,QAAM,OAAO,CAACqB,OAAM;AAChB,oBAAgB,KAAA,QAAuBA,EAAA,GAAI;MAAE,GAAG;MAAM,MAAM;IAAM,CAAA;AAClE,QAAI,KAAK,MACL,aAAY,KAAA,QAAuBA,EAAA,GAAI,QAAW;MAAC;MAAK;MAAK;IAAI,CAAA;EAExE;AACD,MAAI,MAAM,QAAQ,MAAA,EACd,YAAWA,MAAK,OACZ,MAAKA,EAAA;MAIT,MAAK,MAAA;AAEZ;AAQD,IAAa,OAAO,CAAC,KAAK,QAAQ,OAAO,CAAE,MAAK;AAC5CrB,cAAU,KAAK,IAAA;AACf,QAAM,SAAS,KAAK,WAAW,KAAK,cAAc,SAAY,QAAQ;AACtE,QAAM,SAAS,KAAK,WAAW,KAAK,gBAAgB,SAAY,QAAQ;AACxE,QAAM,OAAO,CAACoB,OAAM;AAChB,UAAME,KAAI,OAAOF,KAAIA,GAAE,IAAI;AAC3B,UAAMG,KAAI,OAAOH,KAAIA,GAAE,IAAI;AAC3B,QAAI,OACA,KAAI,SAASE,IAAGC,IAAGH,GAAE,OAAOA,GAAE,MAAA;AAClC,QAAI,QAAQ;AACR,UAAI,KAAK,YACL,KAAI,YAAY,KAAK;AAEzB,UAAI,WAAWE,IAAGC,IAAGH,GAAE,OAAOA,GAAE,MAAA;IACnC;AACD,QAAI,KAAK,SAAS;AACd,UAAI,UAAA;AACJ,UAAI,OAAOE,IAAGC,EAAA;AACd,UAAI,OAAOH,GAAE,OAAOA,GAAE,MAAA;AACtB,UAAI,OAAA;AACJ,UAAI,OAAO,GAAGA,GAAE,MAAA;AAChB,UAAI,OAAOA,GAAE,OAAO,CAAA;AACpB,UAAI,OAAA;IACP;AACD,QAAI,KAAK,MACL,aAAY,KAAA,UAAmBA,EAAA,GAAI,QAAW;MAAC;MAAM;MAAM;MAAM;IAAK,CAAA;EAE7E;AACD,MAAI,MAAM,QAAQ,MAAA,EACd,YAAWC,MAAK,OACZ,MAAKA,EAAA;MAIT,MAAK,MAAA;AAEZ;AASD,IAAa,YAAY,CAAC,KAAKG,QAAMC,WAAU,GAAG,kBAAkB;AAChE,QAAMC,SAAO,SAAS,KAAKF,QAAMC,UAAS,aAAA;AAC1C,SAAOC,OAAK;AACf;AACD,IAAa,WAAW,CAAC,KAAKF,QAAMC,WAAU,GAAG,kBAAkB;AAC/D,MAAID,WAAS,UAAaA,WAAS,QAAQA,OAAK,WAAW,EACvD,QAAA;AACJ,QAAMV,KAAI,IAAI,YAAYU,MAAAA;AAC1B,QAAM,QAAS,gBAAiB,cAAcV,GAAE,OAAO,aAAA,IAAiBW,WAAUX,GAAE,QAAQW;AAC5F,SAAO;IACI;IACP,QAAQX,GAAE,0BAA0BA,GAAE,2BAA2BW,WAAUA;EAC9E;AACJ;AACD,IAAa,aAAa,CAAC,KAAKD,QAAMC,WAAU,MAAM;AAClD,QAAMC,SAAO,SAAS,KAAKF,QAAMC,QAAA;AACjC,SAAOC,OAAK;AAIf;AAOD,IAAa,YAAY,CAAC,KAAK,OAAO,SAAS;AAC3C1B,cAAU,KAAK,IAAA;AACf,QAAM,gBAAgB,KAAK,iBAAiB;AAC5C,QAAM,QAAQ,KAAK,SAAS;AAC5B,QAAM,SAAS,KAAK;AACpB,QAAM,SAAS,KAAK,UAAU;IAAE,GAAG;IAAG,GAAG;IAAG,OAAO;IAAW,QAAQ;EAAW;AAEjF,QAAM,SAAS,MAAM,IAAI,CAAC2B,OAAM,IAAI,YAAYA,EAAA,CAAE;AAElD,QAAM,SAAS,OAAO,IAAI,CAAC,OAAO,GAAG,KAAA;AACrC,QAAM,UAAU,OAAO,IAAI,CAAC,OAAO,GAAG,0BAA0B,GAAG,2BAA2B,CAAA;AAE9F,QAAM,WAAW,KAAK,IAAI,GAAG,MAAA;AAC7B,QAAM,cAAc,QAAQ,OAAO,CAAC,aAAaC,WAAU,cAAcA,QAAO,CAAA;AAChF,MAAI,EAAE,GAAAN,IAAG,GAAAC,GAAA,IAAM;AACf,MAAI,OAAO,IAAI,WAAW,OAAO,MAC7B,CAAAD,KAAI,OAAO,SAAS,WAAW;MAG/B,CAAAA,MAAK;AACT,MAAIA,KAAI,OAAO,EACX,CAAAA,KAAI,OAAO,IAAI;AACnB,MAAI,OAAO,IAAI,cAAc,OAAO,OAChC,CAAAC,KAAI,OAAO,UAAU,cAAc;MAGnC,CAAAA,MAAK;AACT,MAAIA,KAAI,OAAO,EACX,CAAAA,KAAI,OAAO,IAAI;AACnB,MAAI,UAAU,MACV,KAAI,eAAe;MAGnB,KAAI,eAAe;AAEvB,aAAW,CAAC,OAAOzB,MAAAA,KAAS,MAAM,QAAA,GAAW;AACzC,QAAI,SAASA,QAAMwB,IAAGC,EAAA;AACtB,IAAAA,MAAK,QAAQ,KAAA;EAChB;AACJ;AAID,IAAa,mBAAmB,CAAC,KAAKC,QAAM,SAAS;AACjD,QAAM,EAAE,OAAA,IAAW;AACnB,QAAM,EAAE,QAAQ,QAAQ,OAAO,MAAK,IAAK;AACzC,QAAM,QAAQ,OAAOA,WAAS,WAAW,CAACA,MAAK,IAAGA;AAClDxB,cAAU,KAAK,IAAA;AACf,MAAI,KAAA;AACJ,MAAI,UAAU,OAAO,GAAG,OAAO,CAAA;AAC/B,MAAI,YAAY;AAChB,MAAI,eAAe;AACnB,QAAM,UAAU,OAAO,QAAQ;AAC/B,QAAM,UAAU,OAAO,SAAS;AAEhC,QAAM,SAAS,MAAM,IAAI,CAAC2B,OAAM,IAAI,YAAYA,EAAA,CAAE;AAClD,QAAM,UAAU,OAAO,IAAI,CAAC,OAAO,GAAG,0BAA0B,GAAG,wBAAA;AACnE,QAAM,cAAc,QAAQ,OAAO,CAAC,aAAaC,WAAU,cAAcA,QAAO,CAAA;AAChF,MAAIL,KAAI;AACR,MAAI,SAAS,SACT,CAAAA,KAAI,UAAU,cAAc;WACvB,SAAS,SACd,CAAAA,KAAI,OAAO,SAAS;AAExB,aAAW,CAAC,OAAOzB,MAAAA,KAAS,MAAM,QAAA,GAAW;AACzC,QAAIwB,KAAI;AACR,QAAI,UAAU,SACV,CAAAA,KAAI,UAAU,OAAO,KAAA,EAAO,QAAQ;aAC/B,UAAU,QACf,CAAAA,KAAI,OAAO,QAAQ,OAAO,KAAA,EAAO;AACrC,QAAI,SAASxB,QAAMwB,IAAGC,EAAA;AACtB,IAAAA,MAAK,QAAQ,KAAA;EAChB;AACD,MAAI,QAAA;AACP;ACxtBD,IAAIM,aAAY,OAAO;AACvB,IAAI,kBAAkB,CAAC,KAAK,KAAKD,WAAU,OAAO,MAAMC,WAAU,KAAK,KAAK;EAAE,YAAY;EAAM,cAAc;EAAM,UAAU;EAAM,OAAAD;AAAO,CAAA,IAAI,IAAI,GAAA,IAAOA;AAC1J,IAAIE,aAAW,CAAC,QAAQ,QAAQ;AAC9B,WAAS,SAAS,IAChB,CAAAD,WAAU,QAAQ,OAAO;IAAE,KAAK,IAAI,KAAA;IAAQ,YAAY;EAAM,CAAA;AACjE;AACD,IAAI,gBAAgB,CAAC,KAAK,KAAKD,WAAU,gBAAgB,KAAK,OAAO,QAAQ,WAAW,MAAM,KAAK,KAAKA,MAAA;AAGxG,SAAS,UAAU,WAAW,SAAS;AACrC,MAAI,UACF;AAGA,MAAI,YAAY,OACd,OAAM,IAAI,MAAM,8CAAA;AAGpB,QAAM,QAAQ,CAAC,UAAU,oBAAI,MAC3B,+HAAA,IACE,IAAI,MAAM,OAAA;AACd,QAAM,OAAO;AACb,QAAM;AACP;AAGD,IAAI,aAAa;EACf,KAAK;IAAC;IAAK;IAAK;EAAI;EACpB,OAAO;IAAC;IAAK;IAAK;EAAI;EACtB,OAAO;IAAC;IAAK;IAAK;EAAI;EACtB,KAAK;IAAC;IAAK;IAAK;EAAI;AACrB;AACD,IAAI,eAAe;EAAC;EAAO;EAAS;EAAS;AAAM;AACnD,IAAI,UAAU,KAAK,KAAK;AACxB,IAAI,aAAa;EACf,GAAG,CAAC,oBAAoB,kBAAmB;EAC3C,GAAG,CAAC,qBAAqB,mBAAoB;EAC7C,GAAG,CAAC,qBAAqB,mBAAoB;AAC9C;AACD,IAAI,cAAc;EAChB,GAAG;IAAC;IAAc;IAAc;EAAa;EAC7C,GAAG;IAAC;IAAc;IAAc;EAAa;EAC7C,GAAG;IAAC;IAAc;IAAc;EAAa;AAC9C;AACD,IAAI,aAAa;EACf,GAAG;IAAC;IAAc;IAAa;EAAa;EAC5C,GAAG;IAAC;IAAc;IAAa;EAAa;EAC5C,GAAG;IAAC;IAAc;IAAc;EAAY;AAC7C;AACD,IAAI,aAAa;EACf,GAAG;IAAC;IAAmB;IAAoB;EAAmB;EAC9D,GAAG;IAAC;IAAqB;IAAmB;EAAmB;EAC/D,GAAG;IAAC;IAAqB;IAAqB;EAAmB;AAClE;AAMD,IAAI,YAAY;AAChB,IAAI,UAAU,MAAM,KAAK;AACzB,IAAI,WAAW;EACb,OAAO;EACP,UAAU;EACV,OAAO;EACP,UAAU;EACV,aAAa;EACb,aAAa;EACb,SAAS;EACT,YAAY;EACZ,MAAM;EACN,gBAAgB;EAChB,SAAS;EACT,OAAO;EACP,WAAW;AACZ;AAGD,IAAI,YAAY;EACd,WAAW;EACX,cAAc;EACd,MAAM;EACN,YAAY;EACZ,OAAO;EACP,OAAO;EACP,QAAQ;EACR,OAAO;EACP,gBAAgB;EAChB,MAAM;EACN,YAAY;EACZ,OAAO;EACP,WAAW;EACX,WAAW;EACX,YAAY;EACZ,WAAW;EACX,OAAO;EACP,gBAAgB;EAChB,UAAU;EACV,SAAS;EACT,MAAM;EACN,UAAU;EACV,UAAU;EACV,eAAe;EACf,UAAU;EACV,WAAW;EACX,WAAW;EACX,aAAa;EACb,gBAAgB;EAChB,YAAY;EACZ,YAAY;EACZ,SAAS;EACT,YAAY;EACZ,cAAc;EACd,eAAe;EACf,eAAe;EACf,eAAe;EACf,eAAe;EACf,YAAY;EACZ,UAAU;EACV,aAAa;EACb,SAAS;EACT,SAAS;EACT,YAAY;EACZ,WAAW;EACX,aAAa;EACb,aAAa;EACb,SAAS;EACT,WAAW;EACX,YAAY;EACZ,MAAM;EACN,WAAW;EACX,MAAM;EACN,MAAM;EACN,OAAO;EACP,aAAa;EACb,UAAU;EACV,SAAS;EACT,WAAW;EACX,QAAQ;EACR,OAAO;EACP,OAAO;EACP,UAAU;EACV,eAAe;EACf,WAAW;EACX,cAAc;EACd,WAAW;EACX,YAAY;EACZ,WAAW;EACX,sBAAsB;EACtB,WAAW;EACX,YAAY;EACZ,WAAW;EACX,WAAW;EACX,aAAa;EACb,eAAe;EACf,cAAc;EACd,gBAAgB;EAChB,gBAAgB;EAChB,gBAAgB;EAChB,aAAa;EACb,MAAM;EACN,WAAW;EACX,OAAO;EACP,SAAS;EACT,QAAQ;EACR,kBAAkB;EAClB,YAAY;EACZ,cAAc;EACd,cAAc;EACd,gBAAgB;EAChB,iBAAiB;EACjB,mBAAmB;EACnB,iBAAiB;EACjB,iBAAiB;EACjB,cAAc;EACd,WAAW;EACX,WAAW;EACX,UAAU;EACV,aAAa;EACb,MAAM;EACN,SAAS;EACT,OAAO;EACP,WAAW;EACX,QAAQ;EACR,WAAW;EACX,QAAQ;EACR,eAAe;EACf,WAAW;EACX,eAAe;EACf,eAAe;EACf,YAAY;EACZ,WAAW;EACX,MAAM;EACN,MAAM;EACN,MAAM;EACN,YAAY;EACZ,QAAQ;EACR,eAAe;EACf,KAAK;EACL,WAAW;EACX,WAAW;EACX,aAAa;EACb,QAAQ;EACR,YAAY;EACZ,UAAU;EACV,UAAU;EACV,QAAQ;EACR,QAAQ;EACR,SAAS;EACT,WAAW;EACX,WAAW;EACX,WAAW;EACX,MAAM;EACN,aAAa;EACb,WAAW;EACX,KAAK;EACL,MAAM;EACN,SAAS;EACT,QAAQ;EACR,WAAW;EACX,QAAQ;EACR,OAAO;EACP,OAAO;EACP,YAAY;EACZ,QAAQ;EACR,aAAa;AACd;AAGD,SAAS,gBAAgB,OAAO;AAC9B,SAAO,MAAM,QAAQ,KAAA,KAAU,MAAM,WAAW;AACjD;AACD,SAAS,aAAa,OAAO;AAC3B,SAAO,SAAS,KAAA,KAAU,OAAO,KAAK,SAAA,EAAW,SAAS,MAAM,YAAA,CAAa;AAC9E;AACD,SAAS,SAAS,OAAO;AACvB,SAAO,OAAO,UAAU,YAAY,CAAC,OAAO,MAAM,KAAA;AACnD;AACD,SAAS,cAAc,OAAO;AAC5B,MAAI,CAAC,MACH,QAAO;AAET,QAAM,EAAE,UAAAG,UAAA,IAAa,OAAO;AAC5B,QAAM,YAAY,OAAO,eAAe,KAAA;AACxC,SAAOA,UAAS,KAAK,KAAA,MAAW,sBAAsB,cAAc,QAAQ,cAAc,OAAO,eAAe,CAAE,CAAA;AACnH;AACD,SAAS,SAAS,OAAO,WAAW,MAAM;AACxC,QAAMC,WAAU,OAAO,UAAU;AACjC,MAAI,SACF,QAAOA,YAAW,CAAC,CAAC,MAAM,KAAA,EAAO;AAEnC,SAAOA;AACR;AACD,SAAS,kBAAkB,OAAO;AAChC,SAAO,MAAM,KAAA,KAAU,MAAM,KAAA,KAAU,MAAM,KAAA,KAAU,MAAM,KAAA;AAC9D;AACD,SAAS,MAAM,OAAO;AACpB,MAAI,CAAC,SAAS,KAAA,EACZ,QAAO;AAET,SAAO,kCAAkC,KAAK,KAAA;AAC/C;AACD,SAAS,MAAM,OAAO;AACpB,MAAI,CAAC,cAAc,KAAA,EACjB,QAAO;AAET,QAAMC,WAAU,OAAO,QAAQ,KAAA;AAC/B,SAAO,CAAC,CAACA,SAAQ,UAAUA,SAAQ,MAAM,CAAC,CAAC,KAAKL,MAAA,MAAW;AACzD,QAAI,QAAQ,IACV,QAAOA,UAAS,KAAKA,UAAS;AAEhC,QAAI,QAAQ,QACV,QAAOA,UAAS,KAAKA,UAAS;AAEhC,WAAO,WAAW,IAAI,SAAS,GAAA,KAAQA,UAAS,KAAKA,UAAS;EAC/D,CAAA;AACF;AACD,SAAS,MAAM,OAAO;AACpB,MAAI,CAAC,cAAc,KAAA,EACjB,QAAO;AAET,QAAMK,WAAU,OAAO,QAAQ,KAAA;AAC/B,SAAO,CAAC,CAACA,SAAQ,UAAUA,SAAQ,MAAM,CAAC,CAAC,KAAKL,MAAA,MAAW;AACzD,QAAI,QAAQ,IACV,QAAOA,UAAS,KAAKA,UAAS;AAEhC,QAAI,QAAQ,QACV,QAAOA,UAAS,KAAKA,UAAS;AAEhC,WAAO,WAAW,MAAM,SAAS,GAAA,KAAQA,UAAS,MAAMA,UAAS;EAClE,CAAA;AACF;AACD,SAAS,MAAM,OAAO;AACpB,MAAI,CAAC,cAAc,KAAA,EACjB,QAAO;AAET,QAAMK,WAAU,OAAO,QAAQ,KAAA;AAC/B,SAAO,CAAC,CAACA,SAAQ,UAAUA,SAAQ,MAAM,CAAC,CAAC,KAAKL,MAAA,MAAW;AACzD,QAAI,QAAQ,IACV,QAAOA,UAAS,KAAKA,UAAS;AAEhC,QAAI,QAAQ,QACV,QAAOA,UAAS,KAAKA,UAAS;AAEhC,WAAO,WAAW,MAAM,SAAS,GAAA,KAAQA,UAAS,KAAKA,WAAU,QAAQ,MAAM,MAAM;EACtF,CAAA;AACF;AACD,SAAS,MAAM,OAAO;AACpB,MAAI,CAAC,cAAc,KAAA,EACjB,QAAO;AAET,QAAMK,WAAU,OAAO,QAAQ,KAAA;AAC/B,SAAO,CAAC,CAACA,SAAQ,UAAUA,SAAQ,MAAM,CAAC,CAAC,KAAKL,MAAA,MAAW;AACzD,QAAI,QAAQ,QACV,QAAOA,UAAS,KAAKA,UAAS;AAEhC,WAAO,WAAW,IAAI,SAAS,GAAA,KAAQA,UAAS,KAAKA,UAAS;EAC/D,CAAA;AACF;AAGD,SAAS,SAAS,OAAO,OAAO;AAC9B,YAAU,kBAAkB,KAAA,GAAQ,SAAS,OAAA;AAC7C,MAAIA,SAAQ;AACZ,MAAI,CAACA,OACH,QAAO;AAET,MAAIA,SAAQ,EACV,CAAAA,UAAS;AAEX,MAAIA,WAAU,EACZ,QAAO;AAET,SAAO;IAAE,GAAG;IAAO,OAAOA;EAAO;AAClC;AACD,SAASM,QAAMN,QAAOO,OAAM,GAAGC,OAAM,KAAK;AACxC,SAAO,KAAK,IAAI,KAAK,IAAIR,QAAOO,IAAA,GAAMC,IAAA;AACvC;AACD,SAAS,iBAAiB,OAAO,QAAQ;AACvC,YAAU,SAAS,KAAA,GAAQ,SAAS,WAAA;AACpC,MAAIR,SAAQ,QAAQ;AACpB,MAAIA,SAAQ,IACV,CAAAA,UAAS;AAEX,MAAIA,SAAQ,EACV,CAAAA,UAAS;AAEX,SAAO,KAAK,IAAIA,MAAA;AACjB;AACD,SAAS,MAAM,OAAO,OAAO,KAAK;AAChC,YAAU,SAAS,KAAA,GAAQ,uBAAA;AAC3B,YAAU,aAAa,SAAS,KAAA,GAAQ,gBAAgB,QAAQ,KAAK,KAAA,KAAU,EAAA,EAAI;AACnF,YAAU,WAAW,KAAA,EAAO,SAAS,GAAA,GAAM,cAAc,MAAM,KAAK,GAAA,KAAQ,EAAA,EAAI;AAChF,UAAQ,OAAR;IACE,KAAK,OAAO;AACV,gBAAU,WAAW,IAAI,SAAS,GAAA,GAAM,aAAA;AACxC,UAAI,CAAC,KAAK,GAAI,EAAC,SAAS,GAAA,EACtB,QAAOM,QAAM,KAAA;AAEf,aAAOA,QAAM,OAAO,GAAG,GAAA;IACxB;IACD,KAAK,OAAO;AACV,gBAAU,WAAW,IAAI,SAAS,GAAA,GAAM,aAAA;AACxC,aAAOA,QAAM,OAAO,GAAG,GAAA;IACxB;IAED;AACE,YAAM,IAAI,MAAM,gBAAA;EAEnB;AACF;AACD,SAAS,WAAW,OAAO,OAAO;AAChC,QAAM,OAAO,WAAW,KAAA;AACxB,QAAM,YAAY;IAChB,KAAK;IACL,OAAO;IACP,OAAO;IACP,KAAK;EACN;AACD,YAAU,cAAc,KAAA,KAAU,MAAM,QAAQ,KAAA,GAAQ,SAAS,OAAA;AACjE,QAAMN,SAAQ,MAAM,QAAQ,KAAA,IAAS;KAAG,KAAK,CAAA,CAAA,GAAK,MAAM,CAAA;KAAK,KAAK,CAAA,CAAA,GAAK,MAAM,CAAA;KAAK,KAAK,CAAA,CAAA,GAAK,MAAM,CAAA;EAAI,IAAG;AACzG,YAAU,UAAU,KAAA,EAAOA,MAAA,GAAQ,WAAW,KAAA,QAAa;AAC3D,SAAOA;AACR;AACD,SAAS,eAAe,OAAO,YAAY,WAAW,iBAAiB,MAAM;AAC3E,QAAM,SAAS,IAAI,IAAI,OAAO,QAAQ,KAAA,CAAM;AAC5C,aAAW,CAAC,KAAKA,MAAA,KAAU,OAAO,QAAA,EAChC,QAAO,IAAI,KAAKS,SAAMT,QAAO,WAAW,cAAA,CAAe;AAEzD,SAAO,OAAO,YAAY,MAAA;AAC3B;AACD,SAASS,SAAM,OAAO,YAAY,GAAG,iBAAiB,MAAM;AAC1D,MAAI,CAAC,SAAS,KAAA,KAAU,UAAU,EAChC,QAAO;AAET,MAAI,gBAAgB;AAClB,UAAM,UAAU,MAAM;AACtB,WAAO,KAAK,MAAM,QAAQ,OAAA,IAAW;EACtC;AACD,QAAM,WAAW,KAAK,IAAI,KAAA;AAC1B,MAAI,SAAS,KAAK,IAAI,KAAK,KAAK,KAAK,IAAI,QAAA,IAAY,KAAK,IAAA,CAAK;AAC/D,MAAI,WAAW,EACb,UAAS;WACA,SAAS,UAClB,UAAS;AAEX,MAAI,WAAW,aAAa,SAAS,IAAI,IAAI;AAC7C,MAAI,YAAY,KAAK,YAAY,EAC/B,YAAW;WACF,WAAW,aAAa,aAAa,EAC9C,YAAW;AAEb,QAAM,SAAS,MAAM;AACrB,SAAO,KAAK,MAAM,QAAQ,MAAA,IAAU;AACrC;AAGD,SAAS,cAAc,OAAO,OAAO;AACnC,YAAU,MAAM,KAAA,GAAQ,SAAS,QAAA;AACjC,YAAU,SAAS,KAAA,GAAQ,SAAS,WAAA;AACpC,MAAI,SAAS,EACX,QAAO,mBAAmB,KAAA;AAE5B,SAAO,GAAG,mBAAmB,KAAA,CAAM,GAAG,kBAAkB,KAAA,CAAM;AAC/D;AACD,SAAS,kBAAkB,OAAO;AAChC,YAAU,SAAS,KAAA,GAAQ,SAAS,WAAA;AACpC,MAAI,QAAQ;AACZ,MAAI,QAAQ,EACV,UAAS;AAEX,SAAO,KAAK,MAAM,QAAQ,GAAA,EAAK,SAAS,EAAA,EAAI,SAAS,GAAG,GAAA;AACzD;AACD,SAAS,oBAAoB,OAAO;AAClC,YAAU,MAAM,KAAA,GAAQ,SAAS,WAAA;AACjC,QAAM,QAAQ,MAAM,UAAU,GAAG,CAAA;AACjC,MAAI,CAAC,MACH,QAAO;AAET,SAAOA,SAAM,SAAS,OAAO,EAAA,IAAM,GAAA;AACpC;AAID,SAAS,mBAAmB,OAAO;AACjC,YAAU,MAAM,KAAA,GAAQ,SAAS,QAAA;AACjC,MAAI,MAAM,WAAW,EACnB,QAAO,MAAM,UAAU,GAAG,CAAA;AAE5B,SAAO,MAAM,UAAU,GAAG,CAAA;AAC3B;AAGD,IAAI,qBAAqB,CAAE;AAC3BP,WAAS,oBAAoB;EAC3B,SAAS,MAAM;EACf,WAAW,MAAM;EACjB,WAAW,MAAM;EACjB,SAAS,MAAM;EACf,SAAS,MAAM;EACf,WAAW,MAAM;EACjB,WAAW,MAAM;EACjB,SAAS,MAAM;EACf,WAAW,MAAM;EACjB,WAAW,MAAM;EACjB,aAAa,MAAM;EACnB,WAAW,MAAM;EACjB,WAAW,MAAM;EACjB,WAAW,MAAM;EACjB,aAAa,MAAM;EACnB,WAAW,MAAM;EACjB,SAAS,MAAM;EACf,SAAS,MAAM;EACf,WAAW,MAAM;EACjB,WAAW,MAAM;AAClB,CAAA;AAGD,SAAS,UAAU,OAAO;AACxB,YAAU,MAAM,KAAA,GAAQ,SAAS,QAAA;AACjC,MAAI,QAAQ,MAAM,QAAQ,KAAK,EAAA;AAC/B,MAAI,MAAM,WAAW,KAAK,MAAM,WAAW,GAAG;AAC5C,UAAMQ,UAAS,CAAC,GAAG,KAAM;AACzB,YAAQ;AACR,IAAAA,QAAO,QAAQ,CAAClB,OAAM;AACpB,eAAS,GAAGA,EAAA,GAAIA,EAAA;IACjB,CAAA;EACF;AACD,QAAM,MAAM,IAAI,KAAA;AAChB,YAAU,MAAM,GAAA,GAAM,aAAA;AACtB,SAAO;AACR;AAGD,SAAS,QAAQ,OAAO;AACtB,YAAU,MAAM,KAAA,GAAQ,SAAS,QAAA;AACjC,QAAM,MAAM,UAAU,KAAA,EAAO,MAAM,CAAA;AACnC,SAAO;IACL,GAAG,SAAS,IAAI,OAAO,CAAA,IAAK,IAAI,OAAO,CAAA,GAAI,EAAA;IAC3C,GAAG,SAAS,IAAI,OAAO,CAAA,IAAK,IAAI,OAAO,CAAA,GAAI,EAAA;IAC3C,GAAG,SAAS,IAAI,OAAO,CAAA,IAAK,IAAI,OAAO,CAAA,GAAI,EAAA;EAC5C;AACF;AAGD,SAAS,QAAQ,OAAO;AACtB,QAAMQ,SAAQ,WAAW,OAAO,KAAA;AAChC,QAAM,SAAS,MAAMA,OAAM,GAAG,OAAO,GAAA,IAAO;AAC5C,QAAM,SAAS,MAAMA,OAAM,GAAG,OAAO,GAAA,IAAO;AAC5C,QAAM,SAAS,MAAMA,OAAM,GAAG,OAAO,GAAA,IAAO;AAC5C,QAAMO,OAAM,KAAK,IAAI,QAAQ,QAAQ,MAAA;AACrC,QAAMC,OAAM,KAAK,IAAI,QAAQ,QAAQ,MAAA;AACrC,QAAM,QAAQA,OAAMD;AACpB,MAAII,KAAI;AACR,MAAIlC;AACJ,QAAMsB,MAAKS,OAAMD,QAAO;AACxB,MAAIK;AACJ,UAAQJ,MAAR;IACE,KAAK;AACH,MAAAI,QAAO,CAAC,QAAQ,KAAK,SAAS,UAAU;AACxC,MAAAD,KAAI,KAAKC;AACT;IACF,KAAK;AACH,MAAAA,SAAQ,SAAS,UAAU;AAC3B,MAAAD,KAAI,KAAKC,QAAO;AAChB;IACF,KAAK;AACH,MAAAA,SAAQ,SAAS,UAAU;AAC3B,MAAAD,KAAI,KAAKC,QAAO;AAChB;IAEF;AACE;EACH;AACD,MAAID,KAAI,EACN,CAAAA,KAAI,MAAMA;AAEZ,MAAIJ,SAAQC,KACV,CAAA/B,KAAI;MAEJ,CAAAA,KAAIsB,KAAI,MAAM,SAAS,IAAIA,MAAK,SAAS,IAAI,IAAIA;AAEnD,SAAO;IACL,GAAG,KAAK,IAAI,EAAEY,KAAI,KAAK,QAAQ,CAAA,CAAE;IACjC,GAAG,EAAElC,KAAI,KAAK,QAAQ,CAAA;IACtB,GAAG,EAAEsB,KAAI,KAAK,QAAQ,CAAA;EACvB;AACF;AAGD,SAAS,QAAQ,OAAO;AACtB,YAAU,MAAM,KAAA,GAAQ,SAAS,QAAA;AACjC,SAAO,QAAQ,QAAQ,KAAA,CAAM;AAC9B;AAGD,IAAI,EAAE,MAAM,KAAA,IAAS;AACrB,SAAS,SAAS,OAAO;AACvB,QAAMc,QAAO,KAAK,IAAI,KAAA;AACtB,MAAIA,QAAO,QACT,QAAO,QAAQ;AAEjB,UAAQ,KAAK,KAAA,KAAU,OAAOA,QAAO,SAAS,UAAU;AACzD;AACD,SAAS,UAAU,OAAO,YAAY,WAAW;AAC/C,QAAMb,SAAQ,WAAW,OAAO,KAAA;AAChC,QAAM,CAACc,KAAI,IAAI,EAAA,IAAM;IAAC,SAASd,OAAM,IAAI,GAAA;IAAM,SAASA,OAAM,IAAI,GAAA;IAAM,SAASA,OAAM,IAAI,GAAA;EAAK;AAChG,QAAMD,KAAI,KAAK,YAAY,EAAE,CAAA,IAAKe,MAAK,YAAY,EAAE,CAAA,IAAK,KAAK,YAAY,EAAE,CAAA,IAAK,EAAA;AAClF,QAAM5B,KAAI,KAAK,YAAY,EAAE,CAAA,IAAK4B,MAAK,YAAY,EAAE,CAAA,IAAK,KAAK,YAAY,EAAE,CAAA,IAAK,EAAA;AAClF,QAAMrC,KAAI,KAAK,YAAY,EAAE,CAAA,IAAKqC,MAAK,YAAY,EAAE,CAAA,IAAK,KAAK,YAAY,EAAE,CAAA,IAAK,EAAA;AAClF,QAAM,MAAM;IACV,GAAG,WAAW,EAAE,CAAA,IAAKf,KAAI,WAAW,EAAE,CAAA,IAAKb,KAAI,WAAW,EAAE,CAAA,IAAKT;IACjE,GAAG,WAAW,EAAE,CAAA,IAAKsB,KAAI,WAAW,EAAE,CAAA,IAAKb,KAAI,WAAW,EAAE,CAAA,IAAKT;IACjE,GAAG,WAAW,EAAE,CAAA,IAAKsB,KAAI,WAAW,EAAE,CAAA,IAAKb,KAAI,WAAW,EAAE,CAAA,IAAKT;EAClE;AACD,SAAO,eAAe,KAAK,SAAA;AAC5B;AAGD,SAAS,UAAU,OAAO,WAAW;AACnC,YAAU,MAAM,KAAA,GAAQ,SAAS,QAAA;AACjC,SAAO,UAAU,QAAQ,KAAA,GAAQ,SAAA;AAClC;AAGD,IAAI,EAAE,OAAAsC,QAAO,MAAAC,MAAA,IAAS;AACtB,SAAS,YAAY,OAAO,WAAW;AACrC,QAAM,EAAE,GAAAjB,IAAG,GAAAX,IAAG,GAAAC,GAAA,IAAM,eAAe,WAAW,OAAO,OAAA,CAAQ;AAC7D,QAAMR,KAAImC,MAAK5B,MAAK,IAAIC,MAAK,CAAA;AAC7B,MAAIsB,MAAKI,OAAM1B,IAAGD,EAAA,IAAK,UAAU,OAAO;AACxC,MAAIqB,SAAM5B,KAAI,GAAA,MAAS,EACrB,CAAA8B,KAAI;AAEN,SAAO,eAAe;IAAE,GAAAZ;IAAG,GAAAlB;IAAG,GAAA8B;EAAG,GAAE,SAAA;AACpC;AAGD,SAAS,UAAU,OAAO,WAAW;AACnC,QAAMX,SAAQ,WAAW,OAAO,KAAA;AAChC,SAAO,YAAY,UAAUA,QAAO,SAAA,GAAY,SAAA;AACjD;AAGD,SAAS,UAAU,OAAO,WAAW;AACnC,YAAU,MAAM,KAAA,GAAQ,SAAS,QAAA;AACjC,SAAO,UAAU,QAAQ,KAAA,GAAQ,SAAA;AAClC;AAGD,SAAS,QAAQf,QAAO,SAAS0B,IAAG;AAClC,YAAU,SAAS1B,MAAA,KAAU,SAAS,OAAA,KAAY,SAAS0B,EAAA,GAAI,kCAAA;AAC/D,MAAI,MAAMA;AACV,MAAI,MAAM,EACR,QAAO;AAET,MAAI,MAAM,EACR,QAAO;AAET,MAAI,MAAM,IAAI,EACZ,QAAOF,SAAMxB,UAAS,UAAUA,UAAS,IAAI,KAAK,CAAA;AAEpD,MAAI,MAAM,IAAI,EACZ,QAAOwB,SAAM,SAAS,CAAA;AAExB,MAAI,MAAM,IAAI,EACZ,QAAOA,SAAMxB,UAAS,UAAUA,WAAU,IAAI,IAAI,OAAO,GAAG,CAAA;AAE9D,SAAOwB,SAAMxB,QAAO,CAAA;AACrB;AAGD,SAAS,QAAQ,OAAO;AACtB,QAAMe,SAAQ,WAAW,OAAO,KAAA;AAChC,QAAMW,KAAIF,SAAMT,OAAM,CAAA,IAAK;AAC3B,QAAMvB,KAAIgC,SAAMT,OAAM,CAAA,IAAK;AAC3B,QAAMD,KAAIU,SAAMT,OAAM,CAAA,IAAK;AAC3B,MAAIiB;AACJ,MAAIC;AACJ,MAAI7B;AACJ,MAAIJ;AACJ,MAAI;AACJ,MAAIR,OAAM,GAAG;AACX,IAAAwC,KAAIlB;AACJ,IAAAmB,KAAInB;AACJ,IAAAV,KAAIU;EACL,OAAM;AACL,cAAUA,KAAI,MAAMA,MAAK,IAAItB,MAAKsB,KAAItB,KAAIsB,KAAItB;AAC9C,IAAAQ,SAAQ,IAAIc,KAAI;AAChB,IAAAkB,KAAI,QAAQhC,QAAO,SAAS0B,KAAI,IAAI,CAAA;AACpC,IAAAO,KAAI,QAAQjC,QAAO,SAAS0B,EAAA;AAC5B,IAAAtB,KAAI,QAAQJ,QAAO,SAAS0B,KAAI,IAAI,CAAA;EACrC;AACD,SAAO;IACL,GAAG,KAAK,MAAMM,KAAI,GAAA;IAClB,GAAG,KAAK,MAAMC,KAAI,GAAA;IAClB,GAAG,KAAK,MAAM7B,KAAI,GAAA;EACnB;AACF;AAGD,SAAS,QAAQ,OAAO;AACtB,QAAM,MAAM,WAAW,OAAO,KAAA;AAC9B,SAAO,IAAI,OAAO,OAAO,GAAA,EAAK,IAAI,CAACG,OAAM,IAAI,KAAK,MAAMA,EAAA,EAAG,SAAS,EAAA,CAAG,GAAG,MAAM,EAAA,CAAG,EAAE,KAAK,EAAA,CAAG;AAC9F;AAGD,SAAS,QAAQ,OAAO;AACtB,QAAMQ,SAAQ,WAAW,OAAO,KAAA;AAChC,SAAO,QAAQ,QAAQA,MAAA,CAAM;AAC9B;AAGD,SAAS,UAAU,OAAO,WAAW;AACnC,QAAMA,SAAQ,WAAW,OAAO,KAAA;AAChC,SAAO,UAAU,QAAQA,MAAA,GAAQ,SAAA;AAClC;AAGD,SAAS,UAAU,OAAO,WAAW;AACnC,QAAMA,SAAQ,WAAW,OAAO,KAAA;AAChC,SAAO,UAAU,QAAQA,MAAA,GAAQ,SAAA;AAClC;AAGD,IAAI,EAAE,KAAAmB,KAAA,IAAQ;AACd,SAAS,SAAS,OAAO;AACvB,QAAM,iBAAiBA,KAAI,KAAA;AAC3B,QAAM,QAAQ,QAAQ,IAAI,KAAK;AAC/B,MAAI,iBAAiB,SACnB,QAAO,SAAS,mBAAmB,IAAI,OAAO,QAAQ;AAExD,SAAO,QAAQ;AAChB;AACD,SAAS,UAAU,OAAO,YAAY,GAAG;AACvC,QAAM,EAAE,GAAGC,IAAG,GAAGC,IAAG,GAAGC,GAAA,IAAM,WAAW,OAAO,OAAA;AAC/C,QAAMvB,MAAKqB,KAAI,WAAW,EAAE,CAAA,IAAKC,KAAI,WAAW,EAAE,CAAA,IAAKC,OAAM;AAC7D,QAAMpC,MAAKkC,KAAI,WAAW,EAAE,CAAA,IAAKC,KAAI,WAAW,EAAE,CAAA,IAAKC,OAAM;AAC7D,QAAM7C,MAAK2C,KAAI,WAAW,EAAE,CAAA,IAAKC,KAAI,WAAW,EAAE,CAAA,IAAKC,OAAM;AAC7D,QAAML,KAAI,MAAM,SAAS,WAAW,EAAE,CAAA,IAAKlB,KAAI,WAAW,EAAE,CAAA,IAAKb,KAAI,WAAW,EAAE,CAAA,IAAKT,EAAA;AACvF,QAAMyC,KAAI,MAAM,SAAS,WAAW,EAAE,CAAA,IAAKnB,KAAI,WAAW,EAAE,CAAA,IAAKb,KAAI,WAAW,EAAE,CAAA,IAAKT,EAAA;AACvF,QAAMY,KAAI,MAAM,SAAS,WAAW,EAAE,CAAA,IAAKU,KAAI,WAAW,EAAE,CAAA,IAAKb,KAAI,WAAW,EAAE,CAAA,IAAKT,EAAA;AACvF,SAAO;IACL,GAAG6B,QAAMG,SAAMQ,IAAG,SAAA,GAAY,GAAG,GAAA;IACjC,GAAGX,QAAMG,SAAMS,IAAG,SAAA,GAAY,GAAG,GAAA;IACjC,GAAGZ,QAAMG,SAAMpB,IAAG,SAAA,GAAY,GAAG,GAAA;EAClC;AACF;AAGD,SAAS,UAAU,OAAO;AACxB,QAAMW,SAAQ,WAAW,OAAO,OAAA;AAChC,SAAO,QAAQ,UAAUA,MAAA,CAAM;AAChC;AAGD,SAAS,UAAU,OAAO;AACxB,QAAMA,SAAQ,WAAW,OAAO,OAAA;AAChC,SAAO,QAAQ,UAAUA,MAAA,CAAM;AAChC;AAGD,IAAI,EAAE,KAAAuB,MAAK,KAAAC,KAAA,IAAQ;AACnB,SAAS,YAAY,OAAO,WAAW;AACrC,MAAI,EAAE,GAAAzB,IAAG,GAAAlB,IAAG,GAAA8B,GAAA,IAAM,WAAW,OAAO,OAAA;AACpC,MAAI,OAAO,MAAMA,EAAA,KAAMA,KAAI,EACzB,CAAAA,KAAI;AAEN,SAAO,eAAe;IAAE,GAAAZ;IAAG,GAAGlB,KAAI2C,KAAIb,KAAI,OAAA;IAAU,GAAG9B,KAAI0C,KAAIZ,KAAI,OAAA;EAAU,GAAE,SAAA;AAChF;AAGD,SAAS,UAAU,OAAO,YAAY,GAAG;AACvC,QAAMX,SAAQ,WAAW,OAAO,OAAA;AAChC,SAAO,UAAU,YAAYA,MAAA,GAAQ,SAAA;AACtC;AAGD,SAAS,UAAU,OAAO;AACxB,QAAMA,SAAQ,WAAW,OAAO,OAAA;AAChC,SAAO,QAAQ,UAAUA,MAAA,CAAM;AAChC;AAGD,SAAS,UAAU,OAAO;AACxB,QAAMA,SAAQ,WAAW,OAAO,OAAA;AAChC,SAAO,QAAQ,UAAUA,MAAA,CAAM;AAChC;AAGD,SAAS,kBAAkB,OAAO;AAChC,YAAU,SAAS,KAAA,GAAQ,SAAS,WAAA;AACpC,MAAI,MAAM,KAAA,GAAQ;AAChB,UAAM,QAAQ,WAAW;AACzB,UAAM,EAAE,GAAAiB,IAAG,GAAAC,IAAG,GAAA7B,GAAA,IAAM,QAAQ,KAAA;AAC5B,UAAM,SAAS,oBAAoB,KAAA;AACnC,WAAO;MACL,OAAO;OACN,MAAM,CAAA,CAAA,GAAK4B;OACX,MAAM,CAAA,CAAA,GAAKC;OACX,MAAM,CAAA,CAAA,GAAK7B;MACZ,OAAO,SAAS,IAAI,SAAS;IAC9B;EACF;AACD,QAAM,aAAa;AACnB,QAAM,UAAU,WAAW,KAAK,KAAA;AAChC,YAAU,gBAAgB,OAAA,GAAU,SAAS,UAAA;AAC7C,QAAM,QAAQ,QAAQ,CAAA;AACtB,QAAM,OAAO,WAAW,KAAA;AACxB,MAAI,QAAQ,QAAQ,CAAA,IAAK,WAAW,QAAQ,CAAA,CAAA,IAAM;AAClD,MAAI,QAAQ,EACV,UAAS;AAEX,SAAO;IACL;KACC,KAAK,CAAA,CAAA,GAAK,WAAW,QAAQ,CAAA,CAAA;KAC7B,KAAK,CAAA,CAAA,GAAK,WAAW,QAAQ,CAAA,CAAA;KAC7B,KAAK,CAAA,CAAA,GAAK,WAAW,QAAQ,CAAA,CAAA;IAC9B,OAAO,QAAQ,IAAI,QAAQ;EAC5B;AACF;AAGD,SAAS,SAAS,OAAO,QAAQ;AAC/B,YAAU,SAAS,KAAA,GAAQ,SAAS,WAAA;AACpC,MAAI;AACJ,QAAMW,SAAQ,aAAa,KAAA,IAAS,UAAU,MAAM,YAAA,CAAa,IAAI;AACrE,QAAM,SAAS,WAAW,MAAMA,MAAA,IAAS,QAAQ,kBAAkBA,MAAA,EAAO;AAC1E,QAAM,cAAc,CAAC,WAAW,OAAO,OAAO,MAAA;AAC9C,MAAI,MAAMA,MAAA,GAAQ;AAChB,UAAM,QAAQ,oBAAoBA,MAAA;AAClC,YAAQ,QAAR;MACE,KAAK,OAAO;AACV,iBAAS,SAAS,QAAQA,MAAA,GAAQ,KAAA;AAClC;MACD;MACD,KAAK,SAAS;AACZ,iBAAS,SAAS,UAAUA,MAAA,GAAQ,KAAA;AACpC;MACD;MACD,KAAK,SAAS;AACZ,iBAAS,SAAS,UAAUA,MAAA,GAAQ,KAAA;AACpC;MACD;MACD,KAAK,OAAO;AACV,iBAAS,SAAS,QAAQA,MAAA,GAAQ,KAAA;AAClC;MACD;MACD,SAAS;AACP,iBAAS,GAAG,mBAAmBA,MAAA,CAAM,GAAG,UAAU,IAAI,kBAAkB,KAAA,IAAS,EAAA;AACjF;MACD;IACF;AACD,WAAO;EACR;AACD,UAAQ,QAAR;IACE,KAAK,OAAO;AACV,YAAM,EAAE,OAAO,OAAO,GAAG,MAAA,IAAU,kBAAkBA,MAAA;AACrD,UAAI,CAAC,SAAS,OAAQ,EAAC,SAAS,KAAA,KAAU,MAAM,IAAI,EAClD,OAAM,IAAIS,SAAM,MAAM,IAAI,KAAK,SAAA;AAEjC,eAAS,SACP,UAAU,QAAQ,QAAQ,mBAAmB,GAAG,KAAA,MAAW,EAAE,YAAY,KAAA,CAAM,GAC/E,KAAA;AAEF;IACD;IACD,KAAK,SAAS;AACZ,YAAM,EAAE,OAAO,OAAO,GAAG,MAAA,IAAU,kBAAkBT,MAAA;AACrD,UAAI,CAAC,SAAS,OAAQ,EAAC,SAAS,KAAA,KAAU,MAAM,IAAI,EAClD,OAAM,IAAIS,SAAM,MAAM,IAAI,KAAK,SAAA;AAEjC,eAAS,SACP,UAAU,UAAU,QAAQ,mBAAmB,GAAG,KAAA,QAAa,EAAE,YAAY,KAAA,CAAM,GACnF,KAAA;AAEF;IACD;IACD,KAAK,SAAS;AACZ,YAAM,EAAE,OAAO,OAAO,GAAG,MAAA,IAAU,kBAAkBT,MAAA;AACrD,UAAI,CAAC,SAAS,OAAQ,EAAC,SAAS,KAAA,KAAU,MAAM,IAAI,EAClD,OAAM,IAAIS,SAAM,MAAM,IAAI,KAAK,SAAA;AAEjC,eAAS,SACP,UAAU,UAAU,QAAQ,mBAAmB,GAAG,KAAA,QAAa,EAAE,YAAY,KAAA,CAAM,GACnF,KAAA;AAEF;IACD;IACD,KAAK,OAAO;AACV,YAAM,EAAE,OAAO,OAAO,GAAG,MAAA,IAAU,kBAAkBT,MAAA;AACrD,UAAI,CAAC,SAAS,OAAQ,EAAC,SAAS,KAAA,KAAU,MAAM,IAAI,EAClD,OAAM,KAAK;AAEb,eAAS,SACP,UAAU,QAAQ,QAAQ,mBAAmB,GAAG,KAAA,MAAW,EAAE,YAAY,KAAA,CAAM,GAC/E,KAAA;AAEF;IACD;IACD,KAAK;IACL,SAAS;AACP,YAAM,EAAE,OAAO,OAAO,GAAG,MAAA,IAAU,kBAAkBA,MAAA;AACrD,UAAI,cAAc;AAClB,UAAI,CAAC,SAAS,OAAQ,EAAC,SAAS,KAAA,KAAU,MAAM,IAAI,EAClD,OAAM,IAAIS,SAAM,MAAM,IAAI,KAAK,SAAA;AAEjC,UAAI,MACF,eAAc,kBAAkB,KAAA;AAElC,eAAS,GAAG,mBAAmB,GAAG,KAAA,MAAW,EAAE,YAAY,KAAA,CAAM,CAAC,GAAG,WAAA;AACrE;IACD;EACF;AACD,SAAO;AACR;AAGD,SAAS,WAAW,OAAO;AACzB,YAAU,CAAC,CAAC,OAAO,SAAS,KAAA;AAC5B,QAAM,SAAS,CAAE;AACjB,MAAI,SAAS,KAAA,GAAQ;AACnB,UAAM,EAAE,QAAQ,EAAA,IAAM,kBAAkB,KAAA;AACxC,UAAM,OAAO,MAAM,KAAA,IAAS,QAAQ,kBAAkB,KAAA,EAAO;AAC7D,WAAO,MAAM,cAAc,SAAS,OAAO,KAAA,GAAQ,KAAA;AACnD,WAAO,MAAM,SAAS,SAAS,OAAO,KAAA,GAAQ,KAAA;AAC9C,WAAO,QAAQ,SAAS,SAAS,OAAO,OAAA,GAAU,KAAA;AAClD,WAAO,QAAQ,SAAS,SAAS,OAAO,OAAA,GAAU,KAAA;AAClD,WAAO,MAAM,SAAS,SAAS,OAAO,KAAA,GAAQ,KAAA;AAC9C,WAAO,QAAQ;AACf,WAAO,OAAO;EACf,WAAU,cAAc,KAAA,GAAQ;AAC/B,UAAM,EAAE,QAAQ,EAAA,IAAM;AACtB,QAAI,MAAM,KAAA,GAAQ;AAChB,aAAO,MAAM;QACX,GAAG,MAAM,MAAM,GAAG,OAAO,GAAA;QACzB,GAAG,MAAM,MAAM,GAAG,OAAO,GAAA;QACzB,GAAG,MAAM,MAAM,GAAG,OAAO,GAAA;MAC1B;AACD,aAAO,MAAM,QAAQ,OAAO,GAAA;AAC5B,aAAO,QAAQ,UAAU,OAAO,GAAA;AAChC,aAAO,QAAQ,UAAU,OAAO,GAAA;AAChC,aAAO,OAAO;IACf,WAAU,MAAM,KAAA,GAAQ;AACvB,aAAO,MAAM,UAAU,KAAA;AACvB,aAAO,QAAQ;AACf,aAAO,QAAQ,YAAY,KAAA;AAC3B,aAAO,MAAM,UAAU,KAAA;AACvB,aAAO,OAAO;IACf,WAAU,MAAM,KAAA,GAAQ;AACvB,aAAO,MAAM,UAAU,KAAA;AACvB,aAAO,QAAQ,YAAY,KAAA;AAC3B,aAAO,QAAQ;AACf,aAAO,MAAM,UAAU,KAAA;AACvB,aAAO,OAAO;IACf,WAAU,MAAM,KAAA,GAAQ;AACvB,aAAO,MAAM;QACX,GAAG,MAAM,MAAM,GAAG,OAAO,GAAA;QACzB,GAAG,MAAM,MAAM,GAAG,OAAO,GAAA;QACzB,GAAG,MAAM,MAAM,GAAG,OAAO,GAAA;MAC1B;AACD,aAAO,MAAM,QAAQ,OAAO,GAAA;AAC5B,aAAO,QAAQ,UAAU,OAAO,GAAA;AAChC,aAAO,QAAQ,UAAU,OAAO,GAAA;AAChC,aAAO,OAAO;IACf,MACC,OAAM,IAAI,MAAM,eAAA;AAElB,WAAO,MAAM,cAAc,QAAQ,OAAO,GAAA,GAAM,KAAA;AAChD,WAAO,MAAM,SAAS,OAAO,KAAK,KAAA;AAClC,WAAO,QAAQ,SAAS,OAAO,OAAO,KAAA;AACtC,WAAO,QAAQ,SAAS,OAAO,OAAO,KAAA;AACtC,WAAO,MAAM,SAAS,OAAO,KAAK,KAAA;AAClC,WAAO,QAAQ;EAChB,MACC,OAAM,IAAI,MAAM,SAAS,KAAA;AAE3B,SAAO;AACR;AAGD,SAAS,qBAAqB,MAAM,OAAO,YAAY,WAAW;AAChE,YAAU,SAAS,IAAA,GAAO,SAAS,IAAA;AACnC,YAAU,SAAS,KAAA,GAAQ,SAAS,KAAA;AACpC,QAAM,UAAU,SAAS,MAAM,KAAA;AAC/B,QAAM,WAAW,SAAS,OAAO,KAAA;AACjC,QAAM,kBAAkB,QAAQ,IAAI,MAAM,QAAQ,IAAI,MAAM,QAAQ,IAAI,OAAO;AAC/E,QAAM,mBAAmB,SAAS,IAAI,MAAM,SAAS,IAAI,MAAM,SAAS,IAAI,OAAO;AACnF,SAAOA,SAAM,KAAK,IAAI,kBAAkB,cAAA,GAAiB,SAAA;AAC1D;AAGD,SAAS,OAAO,OAAO;AACrB,YAAU,SAAS,KAAA,GAAQ,SAAS,WAAA;AACpC,QAAM,EAAE,GAAAQ,IAAG,GAAAC,IAAG,GAAA7B,GAAA,IAAM,SAAS,OAAO,KAAA;AACpC,QAAMmB,OAAM,KAAK,IAAIS,IAAGC,IAAG7B,EAAA;AAC3B,QAAMkB,OAAM,KAAK,IAAIU,IAAGC,IAAG7B,EAAA;AAC3B,SAAOoB,UAAOD,OAAMD,QAAO,KAAK,CAAA;AACjC;AAGD,SAAS,gBAAgB,MAAM,OAAO;AACpC,YAAU,SAAS,IAAA,GAAO,SAAS,IAAA;AACnC,YAAU,SAAS,KAAA,GAAQ,SAAS,KAAA;AACpC,QAAM,UAAU,SAAS,MAAM,KAAA;AAC/B,QAAM,WAAW,SAAS,OAAO,KAAA;AACjC,SAAO,KAAK,IAAI,QAAQ,GAAG,SAAS,CAAA,IAAK,KAAK,IAAI,QAAQ,GAAG,SAAS,CAAA,KAAM,KAAK,IAAI,QAAQ,GAAG,SAAS,CAAA,IAAK,KAAK,IAAI,QAAQ,GAAG,SAAS,CAAA,MAAO,KAAK,IAAI,QAAQ,GAAG,SAAS,CAAA,IAAK,KAAK,IAAI,QAAQ,GAAG,SAAS,CAAA;AAClN;AAGD,SAAS,UAAU,OAAO;AACxB,YAAU,SAAS,KAAA,GAAQ,SAAS,WAAA;AACpC,QAAM,EAAE,GAAAU,IAAG,GAAAC,IAAG,GAAA7B,GAAA,IAAM,SAAS,OAAO,KAAA;AACpC,QAAM,MAAM;IAAC4B,KAAI;IAAKC,KAAI;IAAK7B,KAAI;EAAI;AACvC,WAAS,QAAQ,GAAG,QAAQ,IAAI,QAAQ,QACtC,KAAI,IAAI,KAAA,KAAU,QAChB,KAAI,KAAA,KAAU;MAEd,KAAI,KAAA,MAAW,IAAI,KAAA,IAAS,SAAS,UAAU;AAGnD,SAAOoB,SAAM,SAAS,IAAI,CAAA,IAAK,SAAS,IAAI,CAAA,IAAK,SAAS,IAAI,CAAA,GAAI,CAAA;AACnE;AAGD,SAAS,SAAS,MAAM,OAAO;AAC7B,YAAU,SAAS,IAAA,GAAO,SAAS,IAAA;AACnC,YAAU,SAAS,KAAA,GAAQ,SAAS,KAAA;AACpC,QAAM,gBAAgB,UAAU,IAAA;AAChC,QAAM,iBAAiB,UAAU,KAAA;AACjC,SAAOA,SACL,iBAAiB,kBAAkB,gBAAgB,SAAS,iBAAiB,SAAS,iBAAiB,SAAS,gBAAgB,KAAA;AAEnI;AAGD,SAASgB,SAAQ,MAAM,OAAO;AAC5B,YAAU,SAAS,IAAA,GAAO,SAAS,IAAA;AACnC,YAAU,SAAS,KAAA,GAAQ,SAAS,KAAA;AACpC,QAAM,iBAAiB;AACvB,QAAM,sBAAsB;AAC5B,QAAM,mBAAmB,gBAAgB,MAAM,KAAA;AAC/C,QAAM,YAAY,SAAS,MAAM,KAAA;AACjC,QAAM,wBAAwB,qBAAqB,MAAM,KAAA;AACzD,QAAM,WAAW,yBAAyB;AAC1C,QAAM,sBAAsB,oBAAoB;AAChD,MAAI,YAAY;AAChB,MAAI,YAAY,oBACd,aAAY;WACH,YAAY,oBACrB,aAAY;AAEd,SAAO;IACL,sBAAsB;IACtB,iBAAiB;IACjB;IACA,UAAU;IACV,SAAS,aAAa;IACtB,UAAU,aAAa;IACvB,UAAU,aAAa;IACvB,WAAW,aAAa;EACzB;AACF;AAGD,SAAS,cAAc,OAAO;AAC5B,MAAI,MAAM,KAAA,KAAU,aAAa,KAAA,EAC/B,QAAO;AAET,MAAI,SAAS,KAAA,EACX,QAAO,kBAAkB,KAAA,EAAO;WACvB,MAAM,KAAA,EACf,QAAO;WACE,MAAM,KAAA,EACf,QAAO;WACE,MAAM,KAAA,EACf,QAAO;WACE,MAAM,KAAA,EACf,QAAO;AAET,QAAM,IAAI,MAAM,SAAS,OAAA;AAC1B;AACD,SAAS,cAAc,OAAO,QAAQ;AACpC,QAAMzB,SAAQ,aAAa,KAAA,IAAS,UAAU,MAAM,YAAA,CAAa,IAAI;AACrE,QAAM0B,QAAO,cAAc1B,MAAA;AAC3B,MAAI0B,UAAS,OACX,QAAO1B;AAET,QAAM,eAAe,GAAG0B,KAAA,IAAQ,MAAA;AAChC,QAAM,YAAY,mBAAmB,YAAA;AACrC,MAAI,CAAC,UACH,OAAM,IAAI,MAAM,2BAA2BA,KAAA,OAAW,MAAA,EAAQ;AAEhE,UAAQA,OAAR;IACE,KAAK,OAAO;AACV,UAAI,WAAW,MACb,QAAO1B;AAET,aAAO,UAAUA,MAAA;IAClB;IACD,KAAK,OAAO;AACV,UAAI,WAAW,MACb,QAAOA;AAET,aAAO,UAAUA,MAAA;IAClB;IACD,KAAK,SAAS;AACZ,UAAI,WAAW,QACb,QAAOA;AAET,aAAO,UAAUA,MAAA;IAClB;IACD,KAAK,SAAS;AACZ,UAAI,WAAW,QACb,QAAOA;AAET,aAAO,UAAUA,MAAA;IAClB;IACD,SAAS;AACP,UAAI,WAAW,MACb,QAAOA;AAET,aAAO,UAAUA,MAAA;IAClB;EACF;AACF;AACD,SAAS,UAAU,OAAO,UAAU,CAAE,GAAE;AACtC,YAAU,MAAM,KAAA,KAAU,kBAAkB,KAAA,GAAQ,SAAS,OAAA;AAC7D,QAAM,EAAE,OAAO,SAAS,OAAO,YAAY,WAAW,WAAW,gBAAgB,IAAA,IAAQ;AACzF,QAAM,WAAW,SAAS,UAAU,IAAI,GAAGS,SAAM,QAAQ,GAAA,CAAI,MAAM;AACnE,MAAI,SAAS,CAAE;AACf,MAAI,YAAY;AAChB,UAAQ,QAAR;IACE,KAAK,OAAO;AACV,YAAM,EAAE,GAAAE,IAAG,GAAAlC,IAAG,GAAAsB,GAAA,IAAM,cAAc,OAAO,KAAA;AACzC,eAAS;QAACY;QAAG,GAAGlC,EAAA;QAAM,GAAGsB,EAAA;MAAK;AAC9B;IACD;IACD,KAAK,SAAS;AACZ,kBAAY;AACZ,YAAM,EAAE,GAAAA,IAAG,GAAAX,IAAG,GAAAC,GAAA,IAAM,eAAe,cAAc,OAAO,OAAA,GAAU,SAAA;AAClE,eAAS;QAAC,GAAGoB,SAAMV,KAAI,KAAK,SAAA,CAAU;QAAKX;QAAGC;MAAE;AAChD;IACD;IACD,KAAK,SAAS;AACZ,kBAAY;AACZ,YAAM,EAAE,GAAAU,IAAG,GAAAlB,IAAG,GAAA8B,GAAA,IAAM,eAAe,cAAc,OAAO,OAAA,GAAU,SAAA;AAClE,eAAS;QAAC,GAAGF,SAAMV,KAAI,KAAK,SAAA,CAAU;QAAKlB;QAAG8B;MAAE;AAChD;IACD;IACD,KAAK,OAAO;AACV,YAAM,EAAE,GAAAM,IAAG,GAAAC,IAAG,GAAA7B,GAAA,IAAM,cAAc,OAAO,KAAA;AACzC,eAAS;QAAC4B;QAAGC;QAAG7B;MAAE;AAClB;IACD;IACD,SAAS;AACP,YAAM,MAAM,mBAAmB,cAAc,OAAO,KAAA,CAAM;AAC1D,UAAI,SAAS,UAAU,EACrB,QAAO,GAAG,GAAA,GAAM,kBAAkB,KAAA,CAAM;AAE1C,aAAO;IACR;EACF;AACD,SAAO,GAAG,MAAA,IAAU,OAAO,KAAK,SAAA,CAAU,GAAG,WAAW,MAAM,QAAA,KAAa,EAAA;AAC5E;AAGD,SAAS,QAAQ,KAAK,UAAU,QAAQ;AACtC,SAAO,CAAC,OAAO,WAAW;AACxB,cAAU,SAAS,KAAA,GAAQ,SAAS,WAAA;AACpC,cAAU,SAAS,MAAA,GAAS,SAAS,KAAA;AACrC,UAAM,QAAQ,SAAS,OAAO,KAAA;AAC9B,UAAM,SAAS,MAAM,KAAA,KAAU,aAAa,KAAA,IAAS,QAAQ,kBAAkB,KAAA,EAAO;AACtF,WAAO,UACL;MACE,GAAG;OACF,GAAA,GAAMiB,QAAM,MAAM,GAAA,KAAQ,aAAa,MAAM,SAAS,CAAC,SAAS,GAAG,GAAA;IACrE,GACD,EAAE,QAAQ,UAAU,OAAQ,CAAA;EAE/B;AACF;AAGD,SAAS,OAAO,OAAO,QAAQ,QAAQ;AACrC,SAAO,QAAQ,KAAK,KAAK,MAAA,EAAQ,OAAO,MAAA;AACzC;AAGD,SAAS,WAAW,OAAO,QAAQ,QAAQ;AACzC,SAAO,QAAQ,KAAK,KAAK,MAAA,EAAQ,OAAO,MAAA;AACzC;AAGD,SAASqB,QAAO,OAAO,SAAS,QAAQ;AACtC,YAAU,SAAS,KAAA,GAAQ,SAAS,WAAA;AACpC,YAAU,SAAS,OAAA,GAAU,0BAAA;AAC7B,QAAM,QAAQ,SAAS,OAAO,KAAA;AAC9B,QAAM,SAAS,MAAM,KAAA,KAAU,aAAa,KAAA,IAAS,QAAQ,kBAAkB,KAAA,EAAO;AACtF,SAAO,UACL;IACE,GAAG;IACH,GAAG,iBAAiB,MAAM,GAAG,OAAA;EAC9B,GACD,EAAE,QAAQ,UAAU,OAAQ,CAAA;AAE/B;AAGD,SAASC,QAAO,OAAO;AACrB,YAAU,SAAS,KAAA,GAAQ,SAAS,WAAA;AACpC,QAAM,SAAS,MAAM,KAAA,KAAU,aAAa,KAAA,IAAS,QAAQ,kBAAkB,KAAA,EAAO;AACtF,QAAM,MAAM,SAAS,OAAO,KAAA;AAC5B,SAAO,UAAUD,QAAO,KAAK,GAAA,GAAM,EAAE,OAAQ,CAAA;AAC9C;AAGD,SAAS,QAAQ,OAAO,QAAQ,QAAQ;AACtC,SAAO,QAAQ,KAAK,KAAK,MAAA,EAAQ,OAAO,MAAA;AACzC;AAGD,SAAS,QAAQ,OAAO,OAAO,QAAQ;AACrC,YAAU,SAAS,KAAA,GAAQ,SAAS,WAAA;AACpC,YAAU,SAAS,KAAA,GAAQ,SAAS,KAAA;AACpC,QAAM,OAAO,MAAM,KAAA,KAAU,aAAa,KAAA,IAAS,QAAQ,kBAAkB,KAAA,EAAO;AACpF,QAAM,MAAM,SAAS,OAAO,KAAA;AAC5B,SAAO,UAAU,KAAK;IAAE,QAAQ,UAAU;IAAM;EAAO,CAAA;AACxD;AAGD,SAAS,QAAQ,OAAO;AACtB,YAAU,SAAS,KAAA,GAAQ,SAAS,WAAA;AACpC,MAAI,MAAM,KAAA,EACR,QAAO,oBAAoB,KAAA;WAClB,OAAO,KAAK,SAAA,EAAW,SAAS,KAAA,EACzC,QAAO;AAET,QAAM,EAAE,MAAA,IAAU,kBAAkB,KAAA;AACpC,MAAI,CAAC,MACH,QAAO;AAET,SAAO;AACR;AAGD,SAAS,SAAS,OAAO,QAAQ,QAAQ;AACvC,SAAO,QAAQ,KAAK,KAAK,MAAA,EAAQ,OAAO,MAAA;AACzC;AAGD,SAAS,UAAU,OAAO,UAAU,CAAE,GAAE;AACtC,QAAM,EAAE,YAAY,WAAW,aAAa,WAAW,YAAY,IAAA,IAAQ;AAC3E,YAAU,SAAS,KAAA,GAAQ,SAAS,WAAA;AACpC,YAAU,aAAa,KAAK,aAAa,KAAK,SAAS,SAAA;AACvD,MAAI;AACF,UAAM,EAAE,GAAAV,IAAG,GAAAC,IAAG,GAAA7B,GAAA,IAAM,QAAQ,SAAS,OAAO,KAAA,CAAM;AAClD,UAAM,OAAO4B,KAAI,MAAMC,KAAI,MAAM7B,KAAI,OAAO;AAC5C,WAAO,OAAO,YAAY,YAAY;EACvC,SAAQ,OAAO;AACd,YAAQ,KAAK,wBAAwB,KAAA,EAAO;AAC5C,YAAQ,KAAK,KAAA;AACb,WAAO;EACR;AACF;AAGD,SAAS,eAAe,OAAO,OAAO,QAAQ;AAC5C,YAAU,SAAS,KAAA,GAAQ,SAAS,WAAA;AACpC,YAAU,SAAS,KAAA,GAAQ,SAAS,KAAA;AACpC,YAAU,SAAS,MAAM,SAAS,GAAG,SAAS,KAAA;AAC9C,QAAM,QAAQ,SAAS,OAAO,OAAA;AAC9B,QAAMW,SAAQS,SAAMH,QAAM,QAAQ,KAAA,IAAS,OAAO,GAAG,CAAA,CAAE;AACvD,SAAO,UAAU,OAAO;IAAE;IAAQ,OAAON;EAAO,CAAA;AACjD;AAGD,IAAI,WAAW,MAAM;EACnB,YAAY,OAAO,UAAU,CAAE,GAAE;AAC/B,kBAAc,MAAM,OAAA;AACpB,kBAAc,MAAM,KAAA;AACpB,kBAAc,MAAM,KAAA;AACpB,kBAAc,MAAM,OAAA;AACpB,kBAAc,MAAM,OAAA;AACpB,kBAAc,MAAM,KAAA;AACpB,kBAAc,MAAM,MAAA;AACpB,cAAU,CAAC,CAAC,OAAO,mBAAA;AACnB,UAAM,EAAE,OAAO,KAAK,KAAK,OAAO,OAAO,KAAK,KAAA,IAAS,WAAW,KAAA;AAChE,SAAK,MAAM;AACX,SAAK,MAAM;AACX,SAAK,QAAQ;AACb,SAAK,QAAQ;AACb,SAAK,MAAM;AACX,SAAK,QAAQ;AACb,SAAK,OAAO,QAAQ,UAAU;EAC/B;;;;EAID,IAAI,MAAM;AACR,WAAO,KAAK;EACb;;;;EAID,IAAI,MAAM;AACR,WAAO,OAAO,KAAK,IAAI,CAAA;EACxB;;;;EAID,IAAI,QAAQ;AACV,WAAO,OAAO,KAAK,IAAI,CAAA;EACxB;;;;EAID,IAAI,OAAO;AACT,WAAO,OAAO,KAAK,IAAI,CAAA;EACxB;;;;EAID,IAAI,MAAM;AACR,WAAO,OAAO,KAAK,IAAI,CAAA;EACxB;;;;EAID,IAAI,aAAa;AACf,WAAO,OAAO,KAAK,IAAI,CAAA;EACxB;;;;EAID,IAAI,YAAY;AACd,WAAO,OAAO,KAAK,IAAI,CAAA;EACxB;;;;EAID,IAAI,YAAY;AACd,WAAO,UAAU,KAAK,aAAA;EACvB;;;;EAID,IAAI,SAAS;AACX,WAAO,OAAO,KAAK,aAAA;EACpB;EACD,IAAI,UAAU;AACZ,WAAO,QAAQ,KAAK,aAAA;EACrB;;;;EAID,IAAI,YAAY;AACd,WAAO,UAAU,KAAK,aAAA;EACvB;EACD,IAAI,gBAAgB;AAClB,WAAO,UAAU,KAAK,KAAK,IAAA,GAAO;MAAE,QAAQ,KAAK;MAAM,OAAO,KAAK;IAAO,CAAA;EAC3E;EACD,qBAAqB,OAAO;AAC1B,WAAO,qBAAqB,KAAK,eAAe,KAAA;EACjD;EACD,gBAAgB,OAAO;AACrB,WAAO,gBAAgB,KAAK,eAAe,KAAA;EAC5C;;;;EAID,QAAQ,OAAO;AACb,WAAOyB,SAAQ,KAAK,eAAe,KAAA;EACpC;EACD,SAAS,OAAO;AACd,WAAO,SAAS,KAAK,eAAe,KAAA;EACrC;EACD,OAAO,MAAM,WAAW;AACtB,WAAO,UAAU,KAAK,KAAK;MACzB,OAAO,KAAK;MACZ,QAAQ;MACR;IACD,CAAA;EACF;;;;EAID,QAAQ,QAAQ;AACd,WAAO,QAAQ,KAAK,eAAe,MAAA;EACpC;;;;EAID,OAAO,QAAQ;AACb,WAAO,OAAO,KAAK,eAAe,MAAA;EACnC;;;;EAID,SAAS,QAAQ;AACf,WAAO,SAAS,KAAK,eAAe,MAAA;EACrC;;;;EAID,WAAW,QAAQ;AACjB,WAAO,WAAW,KAAK,eAAe,MAAA;EACvC;;;;EAID,SAAS;AACP,WAAOG,QAAO,KAAK,aAAA;EACpB;;;;EAID,QAAQ,QAAQ,KAAK;AACnB,WAAO,QAAQ,KAAK,eAAe,OAAO,KAAK,IAAA;EAChD;;;;EAID,OAAO,SAAS;AACd,WAAOD,QAAO,KAAK,eAAe,OAAA;EACnC;;;;EAID,eAAe,QAAQ,KAAK;AAC1B,WAAO,eAAe,KAAK,eAAe,OAAO,KAAK,IAAA;EACvD;AACF;AAGD,SAASE,UAAQ,OAAO,QAAQ;AAC9B,QAAM7B,SAAQ,SAAS,OAAO,MAAA;AAC9B,SAAO,UAAUA,QAAO,EAAE,OAAQ,CAAA;AACnC;AAiOD,IAAI,gBAAgB;ACtlDpB,IAAa,QAAQ,CAAC8B,OAAM;AACxB,MAAI,OAAOA,OAAM,SACb,QAAO;AACX,MAAI,EAAE,OAAOA,IACT,QAAO;AACX,MAAI,EAAE,OAAOA,IACT,QAAO;AACX,MAAI,EAAE,OAAOA,IACT,QAAO;AACX,MAAI,EAAE,UAAUA,IACZ,QAAO;AACX,MAAI,EAAE,WAAWA,IACb,QAAO;AACX,MAAIA,GAAE,UAAU,MACZ,QAAO;AACX,SAAO;AACV;AACD,IAAa,QAAQ,CAACA,OAAM;AACxB,MAAI,OAAOA,OAAM,SACb,QAAO;AACX,MAAI,EAAE,OAAOA,IACT,QAAO;AACX,MAAI,EAAE,OAAOA,IACT,QAAO;AACX,MAAI,EAAE,OAAOA,IACT,QAAO;AACX,MAAI,EAAE,WAAWA,IACb,QAAO;AACX,MAAI,EAAE,UAAUA,IACZ,QAAO;AACX,MAAIA,GAAE,UAAU,OACZ,QAAO;AACX,SAAO;AACV;AAaD,IAAa,sBAAsB,CAACA,OAAM;AACtC,MAAI,OAAOA,OAAM,SACb,OAAM,IAAI,UAAU,+CAA+C,OAAOA,EAAA,EAAG;AACjF,MAAI,EAAE,OAAOA,MAAK,OAAOA,MAAK,OAAOA,IACjC;AACJ,MAAI,EAAE,UAAUA,IACZ,KAAIA,GAAE,KAAK,KAAKA,GAAE,KAAK,KAAKA,GAAE,KAAK,EAC/B,CAAAA,GAAE,OAAO;WAEJA,GAAE,IAAI,OAAOA,GAAE,KAAK,OAAOA,GAAE,KAAK,IACvC;MAGA,CAAAA,GAAE,OAAO;AAGjB,MAAI,EAAE,WAAWA,IACb,CAAAA,GAAE,QAAQ;AAEd,SAAOA;AACV;AACD,IAAa,sBAAsB,CAACA,OAAM;AACtC,MAAI,EAAE,OAAOA,MAAK,OAAOA,MAAK,OAAOA,IACjC;AACJ,MAAI,EAAE,UAAUA,IACZ,KAAIA,GAAE,KAAK,KAAKA,GAAE,KAAK,KAAKA,GAAE,KAAK,EAC/B,CAAAA,GAAE,OAAO;WAEJA,GAAE,IAAI,OAAOA,GAAE,KAAK,IACzB;MAGA,CAAAA,GAAE,OAAO;AAGjB,MAAI,EAAE,WAAWA,IACb,CAAAA,GAAE,QAAQ;AAEd,SAAOA;AACV;AACD,IAAa,UAAU,CAACA,OAAM;AAC1B,MAAI,OAAOA,OAAM,SACb,QAAO;AACX,MAAI,EAAE,OAAOA,IACT,QAAO;AACX,MAAI,EAAE,OAAOA,IACT,QAAO;AACX,MAAI,EAAE,OAAOA,IACT,QAAO;AACX,MAAI,EAAE,UAAUA,IACZ,QAAO;AACX,MAAI,EAAE,WAAWA,IACb,QAAO;AACX,MAAIA,GAAE,UAAU,MACZ,QAAO;AACX,MAAIA,GAAE,UAAU,QACZ,QAAO;AACX,SAAO;AACV;AACD,IAAa,cAAc,CAACA,OAAM;AAC9B,MAAI,OAAOA,OAAM,SACb,QAAO;AACX,MAAI,OAAOA,OAAM,SACb,QAAO;AACX,MAAI,MAAMA,EAAA,EACN,QAAO;AACX,MAAI,QAAQA,EAAA,EACR,QAAO;AACX,MAAI,MAAMA,EAAA,EACN,QAAO;AACX,SAAO;AACV;ACrHD,SAAgB,qBAAqB1C,IAAGC,IAAG0C,UAAQ,GAAG;AAClD,MAAI,OAAO;AACX,MAAI,QAAQ;AACZ,MAAI1C,KAAID,IAAG;AACP,WAAQC,KAAID;AACZ,YAAQ2C,WAAS3C,KAAIC;EACxB,OACI;AACD,WAAQA,KAAID;AACZ,YAAS,OAAQ2C;EACpB;AACD,QAAM,UAAU,QAAQ,IAAI,QAAQ;AACpC,QAAM,WAAW,QAAQ,IAAI,OAAO;AACpC,MAAI,KAAK,IAAI,IAAA,IAAQ,KAAK,IAAI,KAAA,GAAQ;AAClC,UAAMtC,KAAI;AACV,YAAQ;AACR,WAAOA;EACV;AACD,SAAO;IAAE;IAAM;IAAO;IAAS;EAAU;AAC5C;AACD,IAAa,wBAAwB,CAAC,QAAQ;AAC1C,QAAM,iBAAiB,CAACZ,OAAM;AAC1B,UAAM,MAAM,KAAK,MAAMA,EAAA,EAAG,SAAS,EAAA;AACnC,WAAO,IAAI,UAAU,IAAI,MAAM,MAAM;EACxC;AACD,MAAI,OAAO,IAAI,eAAe,IAAI,CAAA,CAAE,GAAG,eAAe,IAAI,CAAA,CAAE,GAAG,eAAe,IAAI,CAAA,CAAE;AACpF,MAAI,OAAO,IAAI,UAAU,eAAe,IAAI,UAAU,IAClD,SAAQ,eAAe,IAAI,KAAA;AAE/B,SAAO;AACV;AACD,SAAgB,cAAcmB,QAAO;AACjC,EAAAA,SAAQA,SAAQ;AAChB,MAAIA,SAAQ,EACR,SAAQ,IAAI,KAAK,IAAIA,MAAA,KAAU;AACnC,SAAOA;AACV;;;;;;;;;;;;;;;;;;;AClBD,IAAagC,gBAAc,CAAChC,QAAOiC,QAAO;AACtC,UAAQjC,OAAM,MAAd;IACI,KAAK;AACD,aAAO;QACH,GAAGA;QACH,SAASiC,KAAIjC,OAAM,WAAW,OAAO,KAAKA,MAAA,IAAS;MACtD;IACL,KAAK;AACD,aAAO;QACH,GAAGA;QACH,SAASiC,IAAIjC,OAAM,WAAW,GAAIA,MAAA;MACrC;EACR;AACJ;AAuBD,IAAakC,oBAAkB,CAAClC,QAAO,WAAW;AAC9C,MAAI,OAAO;AACX,MAAI,OAAO,OAAO,WAAW,YACzB,QAAOA,OAAM,IAAKA,OAAM,IAAI,OAAO;WAE9B,OAAO,OAAO,UAAU,YAC7B,QAAO,OAAO,QAAQA,OAAM;WAEvB,OAAO,OAAO,UAAU,aAAa;AAC1C,QAAI,OAAO,QAAQ,EACf,OAAM,IAAI,UAAU,wCAAwC;AAChE,WAAO,OAAO;EACjB,MAEG,OAAM,IAAI,UAAU,+DAA+D;AAEvF,SAAO;IACH,GAAGA;IACH,GAAG,cAAcA,QAAO,MAAM,GAAG;EACpC;AACJ;AACD,IAAM,gBAAgB,CAAC,KAAKA,QAAO,aAAa;AAC5C,MAAI,IAAI,SAAS,UAEb;QAAIA,SAAQ,EACR,CAAAA,SAAQ;aACHA,SAAQ,EACb,CAAAA,SAAQ;EAAE,WAIVA,SAAQ,IACR,CAAAA,SAAQ;WACHA,SAAQ,EACb,CAAAA,SAAQ;AAEhB,SAAOA;AACV;AACD,IAAM,iBAAiB,OAAO,OAAO;EACjC,GAAG;EAAG,GAAG;EAAG,GAAG;EAAG,SAAS;EAAG,MAAM;EAAY,OAAO;AAC1D,CAAA;AACD,SAAgBmC,gBAAc,WAAW,UAAU,CAAE,GAAE;AACnD,SAAOC,cAAAA,QAAsB,SAAA,GAAY,OAAA;AAC5C;AACD,SAAgBC,UAAQrC,QAAO,UAAU,CAAE,GAAE;AACzC,EAAAA,SAAQA,OAAM,YAAA;AACd,MAAIA,OAAM,WAAW,OAAO,EACxB,OAAM,IAAI,MAAM,sBAAsB;AAC1C,MAAIA,OAAM,WAAW,OAAO,EACxB,OAAM,IAAI,MAAM,sBAAsB;AAC1C,MAAIA,OAAM,WAAW,GAAG,EACpB,QAAOmC,gBAAcnC,QAAO,OAAA;AAEhC,MAAIA,OAAM,WAAW,IAAI,EACrB,KAAI;AACA,IAAAA,SAAQ,WAAWA,MAAA;EACtB,SACM,OAAO;AACV,QAAI,OAAO,QAAQ,mBAAmB,YAClC,CAAAA,SAAQ,QAAQ;AACpB,QAAI,OAAO,QAAQ,mBAAmB,YAClC,QAAO,QAAQ;AACnB,UAAM;EACT;AAEL,MAAIA,WAAU,cACV,QAAO;AACX,MAAI,OAAO,qBAAqBA,MAAA,MAAW,YACvC,QAAOmC,gBAAc,qBAAqBnC,MAAA,GAAQ,OAAA;AAEtD,MAAIA,OAAM,WAAW,MAAM,GAAG;AAC1B,UAAM,MAAMsC,aAAgBtC,MAAA;AAC5B,WAAOoC,cAAY,KAAK,OAAA;EAC3B;AACD,MAAI,CAACpC,OAAM,WAAW,MAAM,EACxB,KAAI;AACA,IAAAA,SAAA,UAAkBA,QAAO,KAAK;EACjC,SACM,OAAO;AACV,QAAI,QAAQ,eACR,CAAAA,SAAQ,QAAQ;QAGhB,OAAM;EAEb;AAEL,MAAI;AAEA,UAAM,MAAM,oBAAoBA,MAAA;AAChC,QAAI,QAAQ,OACR,QAAOuC,WAAS,GAAA;AACpB,WAAOC,aAAW,GAAA;EACrB,SACM,OAAO;AACV,QAAI,QAAQ,eACR,QAAO,QAAQ;AACnB,UAAM;EACT;AACJ;AACD,IAAa,cAAc,CAAC,QAAQ;AAChC,QAAMrB,SAAMqB,aAAW,GAAA;AACvB,MAAI,MAAM,OAAOrB,OAAI,CAAA,OAAQA,OAAI,CAAA,KAAMA,OAAI,CAAA;AAC3C,MAAI,aAAaA,UAAOA,OAAI,YAAY,UAAaA,OAAI,UAAU,IAC/D,QAAO,MAAMA,OAAI,OAAA;AAErB,SAAO;AACP,SAAO;AACV;AACD,IAAasB,gBAAc,CAAC,QAAQ;AAChC,QAAM,MAAM,aAAa,GAAA;AACzB,SAAO,sBAAsB,GAAA;AAChC;AAUD,SAASL,cAAY,KAAK,iBAAiB,CAAE,GAAE;AAC3C,MAAI,OAAO,QAAQ,eAAe,QAAQ,MACtC;QAAI,eAAe,eACf,QAAO,eAAe;EAAe;AAE7C,QAAM,YAAY,eAAe,UAAU;AAE3C,cAAY,yBAAyB,IAAI,GAAG,GAAG,KAAK,GAAG,GAAG,yBAAyB,IAAI,GAAG,GAAG,KAAK,GAAG,GAAG,yBAAyB,IAAI,GAAG,GAAG,KAAK,GAAG,GAAG,YAAa,IAAI,SAAS,GAAI,OAAO,CAAC;AAG5L,MAAI,UACA,QAAO,OAAO,IAAI,IAAI,KAAK,IAAI,IAAI,KAAK,IAAI,IAAI,KAAM,IAAI,SAAS,CAAA;MAGnE,QAAOM,WAAS,IAAI,GAAG,IAAI,GAAG,IAAI,IAAI,IAAI,SAAS,KAAK,GAAA;AAE/D;AACD,IAAaF,eAAa,CAAC,gBAAgB;AAIvC,MAAI,OAAO,gBAAgB,SACvB,QAAOH,UAAQ,aAAa,EAAE,QAAQ,MAAO,CAAA;AAQjD,MAAI,MAAM,WAAA,EACN,QAAOG,aAAWJ,cAAYE,aAAgB,WAAA,GAAc,EAAE,QAAQ,MAAO,CAAA,CAAC;AAElF,QAAM,MAAM;AACZK,EAAAA,SAAM,GAAA;AACN,MAAI,IAAI,SAAS,WACb,QAAO;AACX,SAAO;IACH,GAAG,IAAI,IAAI;IACX,GAAG,IAAI,IAAI;IACX,GAAG,IAAI,IAAI;IACX,UAAU,IAAI,WAAW,KAAK;IAC9B,MAAM;IACN,OAAO;EACV;AACJ;AAkBD,IAAaC,mBAAiB,CAAC,uBAAuB,aAAa,GAAGC,cAAY,KAAKC,YAAU,MAAM;AACnG,MAAI,OAAO,0BAA0B,UACjC;QAAI,sBAAsB,WAAW,IAAI,EACrC,yBAAwB,iBAAiB,SAAS,IAAA,EAAM,iBAAiB,qBAAA,EAAuB,KAAA;EACnG;AAEL,QAAM,MAAM,WAAW,qBAAA;AACvB,MAAI,aAAa,EACb,OAAM,IAAI,UAAU,yCAAyC;AACjE,MAAID,cAAY,EACZ,OAAM,IAAI,UAAU,wCAAwC;AAChE,MAAIC,YAAU,EACV,OAAM,IAAI,UAAU,sCAAsC;AAC9D,QAAM,SAAS,aAAa,KAAK,KAAK,EAAE,QAAQ;AAChD,SAAO;IACH,GAAG;IACH,GAAG;IACH,GAAGD;IACH,SAASC;IACT,MAAM;IACN,OAAO;EACV;AACJ;AAYD,IAAaP,aAAW,CAAC,gBAAgB;AACrC,MAAI,OAAO,gBAAgB,SACvB,QAAOF,UAAQ,aAAa,EAAE,QAAQ,KAAM,CAAA;AAQhD,MAAI,MAAM,WAAA,EACN,QAAOE,WAASH,cAAYE,aAAgB,WAAA,GAAc,EAAE,QAAQ,KAAM,CAAA,CAAC;AAE/E,QAAM,MAAM;AACZK,EAAAA,SAAM,GAAA;AACN,MAAI,IAAI,SAAS,SACb,QAAO;AACX,SAAO;IACH,GAAG,IAAI,IAAI;IACX,GAAG,IAAI,IAAI;IACX,GAAG,IAAI,IAAI;IACX,UAAU,IAAI,WAAW,KAAK;IAC9B,MAAM;IACN,OAAO;EACV;AACJ;AACD,IAAaA,WAAQ,CAAC,QAAQ;AAC1B,QAAM,EAAE,GAAAhC,IAAG,GAAAlC,IAAG,GAAAsB,IAAG,SAAA,WAAS,OAAO,KAAA,IAAS;AAC1C,MAAI,UAAU,MACV,OAAM,IAAI,MAAM,uCAAuC,KAAA,EAAO;AAClE,MAAI,SAAS,WACT,aAAY,WAAWY,IAAG,UAAU,GAAG,GAAG,yBAAyBlC,IAAG,GAAG,KAAK,GAAG,GAAG,yBAAyBsB,IAAG,GAAG,KAAK,GAAG,GAAG,MAAM;AAChI,QAAI,OAAO+C,cAAY,SACnB,QAAO,yBAAyBA,WAAS,GAAG,KAAK,SAAS;EAEjE,CAAA;WAEI,SAAS,SACd,aAAY,WAAWnC,IAAG,cAAc,GAAG,GAAG,WAAWlC,IAAG,cAAc,GAAG,GAAG,WAAWsB,IAAG,cAAc,GAAG,GAAG,MAAM;AACpH,QAAI,OAAO+C,cAAY,SACnB,QAAO,WAAWA,WAAS,cAAc,SAAS;EAEzD,CAAA;MAGD,OAAM,IAAI,MAAM,uDAAuD,IAAA,EAAM;AAEpF;AACD,IAAaC,iBAAe,CAAC3D,IAAGC,IAAG,YAAY,cAAc;AACzD,EAAAD,KAAImD,WAASnD,EAAA;AACb,EAAAC,KAAIkD,WAASlD,EAAA;AACb,QAAM,WAAWD,GAAE,WAAW;AAC9B,QAAM,eAAe,qBAAqBA,GAAE,GAAGC,GAAE,GAAG,CAAA;AACpD,QAAM,cAAc,cAAc,WAAW,aAAa,OAAO,aAAa;AAC9E,QAAM,cAAcA,GAAE,IAAID,GAAE;AAC5B,QAAM,gBAAgBC,GAAE,IAAID,GAAE;AAC9B,QAAM,mBAAmBC,GAAE,WAAW,KAAK;AAC3C,SAAO,CAAC,WAAW;AACf,aAAS,MAAM,MAAA;AACf,QAAIsB,KAAI,YAAY,QAAQ,GAAG,KAAK,IAAI,WAAA,CAAY;AACpD,QAAI,cAAc,EACd,CAAAA,KAAIvB,GAAE,IAAIuB;QAEV,CAAAA,KAAIvB,GAAE,IAAIuB;AACd,UAAMlC,KAAI,YAAY,QAAQ,GAAG,WAAA;AACjC,UAAMsB,KAAI,YAAY,QAAQ,GAAG,aAAA;AACjC,UAAMrB,KAAI,YAAY,QAAQ,GAAG,eAAA;AACjC,WAAO,OAAO,cAAciC,EAAA,GAAIlC,KAAIW,GAAE,GAAGW,KAAIX,GAAE,GAAGV,KAAI,QAAA;EACzD;AACJ;AASD,SAAgB,OAAO,MAAM,KAAK,MAAM,GAAGmE,cAAY,KAAKC,YAAU,GAAG;AACrE,QAAM,MAAM;IACR,MAAM;IACN,OAAO;IACP,GAAG;IACH,GAAG;IACH,GAAGD;IACH,SAASC;EACZ;AACDH,EAAAA,SAAM,GAAA;AACN,SAAO;AACV;AACD,SAAgBD,WAAS,MAAM,KAAK,MAAM,KAAKG,cAAY,IAAIC,YAAU,KAAK;AAC1E,QAAM,MAAM;IACR,MAAM;IACN,OAAO;IACP,GAAG;IACH,GAAG;IACH,GAAGD;IACH,SAASC;EACZ;AACDH,EAAAA,SAAM,GAAA;AACN,SAAO;AACV;AAKD,SAAgB,oBAAoB3C,QAAO;AACvC,MAAIA,OAAM,WAAW,MAAM,EACvB,OAAM,IAAI,MAAM,yBAAyB;AAC7C,MAAI,CAACA,OAAM,WAAW,MAAM,EACxB,OAAM,IAAI,MAAM,6BAA6B;AACjD,QAAM,QAAQA,OAAM,QAAQ,GAAA;AAC5B,QAAM,MAAMA,OAAM,QAAQ,GAAA;AAC1B,MAAI,MAAM,MACN,OAAM,IAAI,MAAM,sCAAsC;AAC1D,QAAM,OAAOA,OAAM,UAAU,QAAQ,GAAG,GAAA;AACxC,MAAI,QAAQ,KAAK,MAAM,QAAA;AACvB,MAAI,MAAM,SAAS,EACf,OAAM,IAAI,MAAM,+BAA+B,MAAM,MAAA,SAAe;AACxE,MAAI,iBAAiB;AACrB,MAAI,MAAM,CAAA,EAAG,SAAS,GAAG,EACrB,kBAAiB;AACrB,MAAI,MAAM,CAAA,EAAG,SAAS,GAAG,KAAK,MAAM,CAAA,EAAG,SAAS,GAAG,EAC/C,kBAAiB;AACrB,QAAM,gBAAgB,CAAC8B,IAAG,QAAQ;AAC9B,QAAIA,OAAM,OACN,QAAO;AACX,QAAIA,GAAE,SAAS,GAAG,EACd,QAAO,OAAO,WAAWA,GAAE,UAAU,GAAGA,GAAE,SAAS,CAAA,CAAE,IAAI;AAE7D,QAAIA,GAAE,SAAS,KAAK,KAAK,QAAQ,EAC7B,CAAAA,KAAIA,GAAE,UAAU,GAAGA,GAAE,SAAS,CAAA;AAElC,UAAM,KAAK,OAAO,WAAWA,EAAA;AAC7B,QAAI,QAAQ,EACR,QAAO,KAAK;AAChB,QAAI,QAAQ,EACR,QAAO;AACX,WAAO,KAAK;EACf;AACD,QAAM,aAAa,CAACA,IAAG,QAAQ;AAC3B,QAAIA,OAAM,OACN,QAAO;AACX,QAAIA,GAAE,SAAS,GAAG,GAAG;AACjB,YAAMkB,OAAK,OAAO,WAAWlB,GAAE,UAAU,GAAGA,GAAE,SAAS,CAAA,CAAE;AACzD,UAAI,QAAQ,EACR,QAAOkB,OAAK;AAChB,aAAOA;IACV;AACD,QAAIlB,GAAE,SAAS,KAAK,KAAK,QAAQ,EAC7B,QAAO,OAAO,WAAWA,GAAE,UAAU,GAAGA,GAAE,SAAS,CAAA,CAAE;AAEzD,UAAM,KAAK,OAAO,WAAWA,EAAA;AAC7B,WAAO;EACV;AAED,MAAI,MAAM,SAAS,GACf;QAAI,MAAM,CAAA,MAAO,IAEb,SAAQ;MAAC,MAAM,CAAA;MAAI,MAAM,CAAA;MAAI,MAAM,CAAA;MAAI,MAAM,CAAA;IAAG;EACnD;AAEL,MAAI,eACA,QAAO,OAAO,cAAc,MAAM,CAAA,GAAI,CAAA,GAAI,cAAc,MAAM,CAAA,GAAI,CAAA,GAAI,cAAc,MAAM,CAAA,GAAI,CAAA,GAAI,cAAc,MAAM,CAAA,KAAM,QAAQ,CAAA,CAAE;MAItI,QAAOY,WAAS,WAAW,MAAM,CAAA,GAAI,CAAA,GAAI,WAAW,MAAM,CAAA,GAAI,CAAA,GAAI,WAAW,MAAM,CAAA,GAAI,CAAA,GAAI,WAAW,MAAM,CAAA,KAAM,QAAQ,CAAA,CAAE;AAEnI;AAMD,SAAgB,aAAa,KAAK;AAC9B,MAAI,OAAO,QAAQ,UAAU;AACzB,UAAM,cAAcL,UAAQ,KAAK,EAAE,QAAQ,MAAO,CAAA;AAElD,WAAO,aAAa,WAAA;EACvB;AACD,QAAMG,aAAW,GAAA;AAEjB,QAAM,MAAA,QAAgB;IAAE,GAAG,IAAI;IAAG,GAAG,IAAI;IAAG,GAAG,IAAI;EAAG,CAAA;AACtD,SAAO;IAAE,GAAG;IAAK,QAAQ,IAAI,WAAW,OAAO,MAAM;EAAK;AAC7D;;;;;;;;;;;;;;;;;;ACncD,IAAa,mBAAmB;AAChC,IAAaG,WAAQ,CAAC,QAAQ;AAC1B,QAAM,EAAE,GAAA5C,IAAG,GAAAlB,IAAG,GAAA8B,IAAG,SAAA,WAAS,OAAO,KAAA,IAAS;AAC1C,MAAI,UAAU,QACV,OAAM,IAAI,MAAM,yCAAyC,KAAA,EAAO;AACpE,MAAI,SAAS,WACT,aAAY,YAAYZ,IAAG,GAAG,GAAG,MAAM;AACnC,QAAI,OAAOlB,OAAM,SACb,QAAO,yBAAyBA,IAAG,GAAG,kBAAkB,GAAG;EAElE,GAAE,MAAM;AACL,QAAI,OAAO8B,OAAM,SACb,QAAO,yBAAyB9B,IAAG,GAAG,KAAK,GAAG;EAErD,GAAE,YAAaiE,aAAW,GAAI,SAAS,CAAC;WAEpC,SAAS,SAEd,aAAY,YAAY/C,IAAG,GAAG,GAAG,YAAYlB,IAAG,GAAG,GAAG,YAAY8B,IAAG,GAAG,GAAG,YAAa,IAAI,WAAW,GAAI,SAAS,CAAC;MAGrH,OAAM,IAAI,MAAM,uDAAuD,IAAA,EAAM;AAEpF;AACD,SAAgByB,cAAY,KAAK,iBAAiB,CAAE,GAAE;AAClD,MAAI,OAAO,QAAQ,eAAe,QAAQ,MACtC;QAAI,eAAe,eACf,QAAO,eAAe;EAAe;AAE7C,QAAM,eAAe,eAAe,UAAU;AAE9C,cAAY,YAAY,IAAI,GAAG,GAAG,GAAG,YAAY,IAAI,GAAG,GAAG,GAAG,yBAAyB,IAAI,GAAG,GAAG,KAAK,GAAG,GAAG,YAAa,IAAI,SAAS,GAAI,OAAO,CAAC;AAClJ,MAAI,aACA,QAAOa,SAAO,IAAI,GAAG,IAAI,IAAI,kBAAkB,IAAI,IAAI,KAAM,IAAI,SAAS,CAAA;MAG1E,QAAO,SAAS,IAAI,GAAG,IAAI,GAAG,IAAI,GAAI,IAAI,SAAS,CAAA;AAE1D;AAOD,IAAad,kBAAgB,CAAC,WAAW,UAAU,CAAE,MAAK;AACtD,SAAOC,cAAAA,UAAwB,SAAA,GAAY,OAAA;AAC9C;AACD,IAAM,mBAAmB,OAAO,OAAO;EACnC,GAAG;EAAG,GAAG;EAAG,GAAG;EAAG,SAAS;EAAG,MAAM;EAAY,OAAO;AAC1D,CAAA;AACD,SAAgBC,UAAQrC,QAAO,UAAU,CAAE,GAAE;AACzC,EAAAA,SAAQA,OAAM,YAAA;AACd,MAAIA,OAAM,WAAW,GAAG,EACpB,QAAOmC,gBAAcnC,QAAO,OAAA;AAEhC,MAAIA,WAAU,cACV,QAAO;AACX,MAAI,OAAO,qBAAqBA,MAAA,MAAW,YACvC,QAAOmC,gBAAc,qBAAqBnC,MAAA,GAAQ,OAAA;AAEtD,MAAIA,OAAM,WAAW,MAAM,GAAG;AAC1B,UAAM,MAAMkD,OAAU,oBAAoBlD,MAAA,CAAM;AAChD,UAAMmD,QAAAA,UAAkB;MAAE,GAAG,IAAI;MAAG,GAAG,IAAI;MAAG,GAAG,IAAI;IAAG,CAAA;AACxD,WAAOf,cAAYe,OAAK,OAAA;EAC3B;AACD,MAAI,CAACnD,OAAM,WAAW,MAAM,KAAK,CAACA,OAAM,WAAW,QAAQ,EACvD,KAAI;AACA,UAAM,YAAA,UAAsBA,QAAO,OAAO;AAC1C,IAAAA,SAAQ;EACX,SACM,OAAO;AACV,QAAI,QAAQ,eACR,CAAAA,SAAQ,QAAQ;QAGhB,OAAM;EAEb;AAEL,QAAM,KAAK,IAAIoD,cAASpD,MAAA;AACxB,QAAM,MAAM,GAAG;AACf,SAAOoC,cAAY,KAAK,OAAA;AAC3B;AAYD,IAAaI,cAAa,CAAC,gBAAgB;AACvC,MAAI,OAAO,gBAAgB,SACvB,QAAOA,YAAWH,UAAQ,aAAa,EAAE,QAAQ,KAAM,CAAA,CAAC;AAE5DM,EAAAA,SAAM,WAAA;AACN,MAAI,YAAY,SAAS,WACrB,QAAO;AACX,SAAO;IACH,OAAO;IACP,MAAM;IACN,GAAG,YAAY;IACf,GAAG,YAAY,IAAI;IACnB,GAAG,YAAY,IAAI;IACnB,SAAS,YAAY;EACxB;AACJ;AACD,IAAaJ,aAAW,CAAC,gBAAgB;AACrC,MAAI,OAAO,gBAAgB,SACvB,QAAOA,WAASF,UAAQ,aAAa,EAAE,QAAQ,KAAM,CAAA,CAAC;AAE1D,QAAM,MAAM;AACZM,EAAAA,SAAM,GAAA;AAGN,MAAI,IAAI,SAAS,SACb,QAAO;AAEX,SAAO;IACH,GAAG,IAAI;IACP,GAAG,IAAI,IAAI;IACX,GAAG,IAAI,IAAI;IACX,SAAU,IAAI,WAAW;IACzB,MAAM;IACN,OAAO;EACV;AACJ;AACD,IAAMU,cAAY,CAAC,QAAQ;AACvB,QAAMlC,SAAMqB,YAAW,GAAA;AACvB,SAAO;IACH,GAAGrB,OAAI;IACP,GAAGA,OAAI;IACP,GAAGA,OAAI;IACP,OAAOA,OAAI;EACd;AACJ;AAkBD,IAAamC,gBAAc,CAAC,KAAK,YAAY,MAAM;AAC/CX,EAAAA,SAAM,GAAA;AACN,QAAM,EAAE,GAAA5C,IAAG,GAAAlB,IAAG,GAAA8B,IAAG,SAAA,UAAA,IAAY;AAC7B,MAAI,MAAM;AACV,UAAQ,IAAI,MAAZ;IACI,KAAK;AACD,YAAM,UAAUZ,KAAI,KAAK,QAAQ,SAAA,CAAU,KAAKlB,GAAE,QAAQ,SAAA,CAAU,IAAI8B,GAAE,QAAQ,SAAA,CAAU;AAC5F;IACJ,KAAK;AACD,YAAM,SAASZ,GAAE,QAAQ,SAAA,CAAU,KAAKlB,KAAI,kBAAkB,QAAQ,SAAA,CAAU,KAAK8B,KAAI,KAAK,QAAQ,SAAA,CAAU;AAChH;EACP;AACD,MAAI,OAAOmC,cAAY,eAAeA,cAAY,EAC9C,QAAO,MAAMA,UAAQ,QAAQ,SAAA,CAAU;AAE3C,SAAO;AACP,SAAO;AACV;AACD,IAAaL,gBAAc,CAAC,QAAQ;AAChC,QAAM,OAAOY,YAAU,GAAA;AACvB,QAAM,MAAA,UAAkB,IAAA;AACxB,SAAO,sBAAsB,GAAA;AAChC;AA6DD,IAAa,iBAAiB,CAAC,uBAAuBE,WAAS,GAAGV,cAAY,KAAKC,YAAU,MAAM;AAC/F,MAAI,OAAO,0BAA0B,UACjC;QAAI,sBAAsB,WAAW,IAAI,EACrC,yBAAwB,iBAAiB,SAAS,IAAA,EAAM,iBAAiB,qBAAA,EAAuB,KAAA;EACnG;AAEL,MAAID,cAAY,EACZ,OAAM,IAAI,UAAU,wCAAwC;AAChE,MAAIU,WAAS,EACT,OAAM,IAAI,UAAU,qCAAqC;AAC7D,QAAM,MAAM,WAAW,qBAAA;AACvB,QAAM,SAAS,aAAa,KAAK,KAAK,EAAE,QAAQ;AAChD,MAAIT,YAAU,EACV,OAAM,IAAI,UAAU,sCAAsC;AAC9D,SAAO;IACH,GAAGD;IACH,GAAGU;IACH,GAAG;IACH,SAAST;IACT,MAAM;IACN,OAAO;EACV;AACJ;AAUD,IAAad,gBAAc,CAAChC,QAAOiC,QAAO;AACtC,UAAQjC,OAAM,MAAd;IACI,KAAK;AACD,aAAO;QACH,GAAGA;QACH,SAASiC,KAAIjC,OAAM,WAAW,OAAO,KAAKA,MAAA,IAAS;MACtD;IACL,KAAK;AACD,aAAO;QACH,GAAGA;QACH,SAASiC,IAAIjC,OAAM,WAAW,GAAIA,MAAA;MACrC;EACR;AACJ;AACD,IAAa+C,iBAAe,CAAC3D,IAAGC,IAAG,YAAY,cAAc;AACzD,EAAAD,KAAImD,WAASnD,EAAA;AACb,EAAAC,KAAIkD,WAASlD,EAAA;AAGb,QAAM,WAAWD,GAAE,WAAW;AAC9B,QAAM,eAAe,qBAAqBA,GAAE,GAAGC,GAAE,GAAG,CAAA;AACpD,QAAM,cAAc,cAAc,WAAW,aAAa,OAAO,aAAa;AAC9E,QAAM,iBAAiBA,GAAE,IAAID,GAAE;AAC/B,QAAM,gBAAgBC,GAAE,IAAID,GAAE;AAC9B,QAAM,mBAAmBC,GAAE,WAAW,KAAK;AAG3C,SAAO,CAAC,WAAW;AACf,aAAS,MAAM,MAAA;AACf,QAAIsB,KAAI,YAAY,QAAQ,GAAG,KAAK,IAAI,WAAA,CAAY;AACpD,QAAI,cAAc,EACd,CAAAA,KAAIvB,GAAE,IAAIuB;QAEV,CAAAA,KAAIvB,GAAE,IAAIuB;AACd,UAAM9B,KAAI,YAAY,QAAQ,GAAG,cAAA;AACjC,UAAMkB,KAAI,YAAY,QAAQ,GAAG,aAAA;AACjC,UAAMrB,KAAI,YAAY,QAAQ,GAAG,eAAA;AAEjC,WAAOuE,SAAOlD,KAAIX,GAAE,GAAGP,KAAIO,GAAE,GAAG,cAAcuB,EAAA,GAAIjC,KAAI,QAAA;EACzD;AACJ;AACD,SAAgBuE,SAAOJ,cAAY,KAAKU,WAAS,KAAK,MAAM,KAAKT,YAAU,GAAG;AAC1E,QAAM,MAAM;IACR,MAAM;IACN,OAAO;IACP,GAAGD;IACH,GAAGU;IACH,GAAG;IACH,SAAST;EACZ;AACDH,EAAAA,SAAM,GAAA;AACN,SAAO;AACV;AASD,IAAa,WAAW,CAAC5C,IAAGlB,IAAG8B,IAAGmC,YAAU,MAAM;AAC9C,QAAM,MAAM;IACR,OAAO;IACP,MAAM;IACN,SAAA;IACA,GAAA/C;IAAG,GAAAlB;IAAG,GAAA8B;EACT;AACDgC,EAAAA,SAAM,GAAA;AACN,SAAO;AACV;AC3UD,IAAa,gBAAgB,CAAC,WAAW;AACrC,MAAI,OAAO,WAAW,GAAG,EACrB,QAAA,cAA+B,QAAQ,IAAA;AAE3C,MAAI,OAAO,qBAAqB,MAAA,MAAY,YACxC,QAAA,cAA+B,qBAAqB,MAAA,GAAS,IAAA;AAEjE,MAAI,OAAO,WAAW,IAAI,GAAG;AACzB,UAAMN,YAAU,iBAAiB,SAAS,IAAA,EAAM,iBAAiB,MAAA,EAAQ,KAAA;AACzE,QAAIA,UAAQ,WAAW,KAAKA,cAAY,KACpC,OAAM,IAAI,MAAM,qBAAqB,MAAA,EAAQ;AACjD,WAAO,cAAcA,SAAAA;EACxB;AACD,WAAS,OAAO,YAAA;AAChB,MAAI,OAAO,WAAW,MAAM,EACxB,QAAA,UAAwB,QAAQ,EAAE,QAAQ,KAAM,CAAA;AAEpD,MAAI,OAAO,WAAW,MAAM,EACxB,QAAA,QAAyB,QAAQ,EAAE,QAAQ,KAAM,CAAA;AAErD,MAAI,OAAO,WAAW,QAAQ,EAC1B,QAAA,UAA0B,QAAQ,EAAE,QAAQ,KAAM,CAAA;AAEtD,QAAM,IAAI,MAAM,oFAAoF,MAAA,GAAS;AAChH;AAaD,IAAa,aAAa,CAAC,QAAQ,aAAa;AAC5C,MAAI,OAAO,WAAW,IAAI,GAAG;AACzB,UAAMA,YAAU,iBAAiB,SAAS,IAAA,EAAM,iBAAiB,MAAA,EAAQ,KAAA;AACzE,QAAIA,UAAQ,WAAW,KAAKA,cAAY,MAAM;AAC1C,UAAI,OAAO,aAAa,YACpB,QAAO;AACX,YAAM,IAAI,MAAM,0BAA0B,MAAA,GAAS;IACtD;AACD,WAAO,WAAWA,SAAAA;EACrB;AACD,MAAI,OAAO,qBAAqB,MAAA,MAAY,YACxC,QAAO,qBAAqB,MAAA;AAEhC,SAAO;AACV;AACD,IAAa,uBAAuB;EAChC,aAAa;EACb,gBAAgB;EAChB,QAAQ;EACR,cAAc;EACd,SAAS;EACT,SAAS;EACT,UAAU;EACV,SAAS;EACT,kBAAkB;EAClB,QAAQ;EACR,cAAc;EACd,SAAS;EACT,aAAa;EACb,aAAa;EACb,cAAc;EACd,aAAa;EACb,SAAS;EACT,kBAAkB;EAClB,YAAY;EACZ,WAAW;EACX,QAAQ;EACR,YAAY;EACZ,YAAY;EACZ,iBAAiB;EACjB,YAAY;EACZ,aAAa;EACb,aAAa;EACb,eAAe;EACf,kBAAkB;EAClB,cAAc;EACd,cAAc;EACd,WAAW;EACX,cAAc;EACd,gBAAgB;EAChB,iBAAiB;EACjB,iBAAiB;EACjB,iBAAiB;EACjB,cAAc;EACd,YAAY;EACZ,eAAe;EACf,WAAW;EACX,cAAc;EACd,aAAa;EACb,eAAe;EACf,eAAe;EACf,WAAW;EACX,aAAa;EACb,cAAc;EACd,QAAQ;EACR,aAAa;EACb,QAAQ;EACR,SAAS;EACT,eAAe;EACf,YAAY;EACZ,WAAW;EACX,aAAa;EACb,UAAU;EACV,SAAS;EACT,SAAS;EACT,YAAY;EACZ,iBAAiB;EACjB,aAAa;EACb,gBAAgB;EAChB,aAAa;EACb,cAAc;EACd,aAAa;EACb,wBAAwB;EACxB,aAAa;EACb,cAAc;EACd,aAAa;EACb,eAAe;EACf,iBAAiB;EACjB,gBAAgB;EAChB,kBAAkB;EAClB,kBAAkB;EAClB,eAAe;EACf,QAAQ;EACR,aAAa;EACb,SAAS;EACT,WAAW;EACX,UAAU;EACV,oBAAoB;EACpB,cAAc;EACd,gBAAgB;EAChB,gBAAgB;EAChB,kBAAkB;EAClB,mBAAmB;EACnB,qBAAqB;EACrB,mBAAmB;EACnB,mBAAmB;EACnB,gBAAgB;EAChB,aAAa;EACb,aAAa;EACb,YAAY;EACZ,eAAe;EACf,QAAQ;EACR,WAAW;EACX,SAAS;EACT,aAAa;EACb,UAAU;EACV,aAAa;EACb,UAAU;EACV,iBAAiB;EACjB,aAAa;EACb,iBAAiB;EACjB,iBAAiB;EACjB,cAAc;EACd,aAAa;EACb,QAAQ;EACR,QAAQ;EACR,QAAQ;EACR,cAAc;EACd,UAAU;EACV,iBAAiB;EACjB,OAAO;EACP,aAAa;EACb,aAAa;EACb,eAAe;EACf,UAAU;EACV,cAAc;EACd,YAAY;EACZ,YAAY;EACZ,UAAU;EACV,UAAU;EACV,WAAW;EACX,aAAa;EACb,aAAa;EACb,QAAQ;EACR,eAAe;EACf,aAAa;EACb,OAAO;EACP,QAAQ;EACR,WAAW;EACX,UAAU;EACV,aAAa;EACb,UAAU;EACV,SAAS;EACT,SAAS;EACT,cAAc;EACd,UAAU;EACV,eAAe;EACf,eAAe;AAClB;;;;;;;;;;;;;;;;;;;AC7MD,IAAaL,gBAAc,CAAChC,QAAOiC,QAAO;AACtC,UAAQjC,OAAM,MAAd;IACI,KAAK;AACD,aAAO;QACH,GAAGA;QACH,SAASiC,KAAIjC,OAAM,WAAW,OAAO,KAAKA,MAAA,IAAS;MACtD;IACL,KAAK;AACD,aAAO;QACH,GAAGA;QACH,SAASiC,IAAIjC,OAAM,WAAW,GAAIA,MAAA;MACrC;EACR;AACJ;AACD,SAAgB,cAAc,WAAWiD,WAAS,MAAM;AACpD,SAAO,YAAA,QAAsB,SAAA,GAAY,EAAE,QAAA,SAAQ,CAAA;AACtD;AAED,IAAM,iBAAiB,OAAO,OAAO;EACjC,GAAG;EAAG,GAAG;EAAG,GAAG;EAAG,SAAS;EAAG,MAAM;EAAQ,OAAO;AACtD,CAAA;AAeD,SAAgB,QAAQjD,QAAO,UAAU,CAAE,GAAE;AACzC,EAAAA,SAAQA,OAAM,YAAA;AACd,MAAIA,OAAM,WAAW,OAAO,EACxB,OAAM,IAAI,MAAM,sBAAsB;AAC1C,MAAIA,OAAM,WAAW,OAAO,EACxB,OAAM,IAAI,MAAM,sBAAsB;AAC1C,QAAMiD,WAAS,QAAQ,UAAU;AAEjC,MAAIjD,OAAM,WAAW,GAAG,EACpB,QAAO,cAAcA,QAAOiD,QAAAA;AAEhC,MAAIjD,WAAU,cACV,QAAO;AAEX,MAAI,OAAO,qBAAqBA,MAAA,MAAW,YACvC,eAAc,qBAAqBA,MAAA,GAAQiD,QAAAA;AAC/C,MAAIjD,OAAM,WAAW,MAAM,GAAG;AAC1B,UAAM,MAAMwD,aAAgBxD,MAAA;AAC5B,WAAO,YAAY,KAAK,OAAA;EAC3B;AAOD,MAAI,CAACA,OAAM,WAAW,MAAM,EACxB,KAAI;AACA,IAAAA,SAAA,UAAkBA,QAAO,KAAK;EACjC,SACM,OAAO;AACV,QAAI,QAAQ,eACR,CAAAA,SAAQ,QAAQ;QAGhB,OAAM;EAEb;AAEL,MAAI;AAEA,UAAM,MAAM,oBAAoBA,MAAA;AAChC,QAAIiD,SACA,QAAOV,UAAS,GAAA;AACpB,WAAO,OAAO,GAAA;EACjB,SACM,OAAO;AACV,QAAI,QAAQ,eACR,QAAO,QAAQ;AACnB,UAAM;EACT;AACJ;AACD,IAAa,cAAc,CAAC,QAAQ;AAChC,QAAM,OAAO,UAAU,GAAA;AACvB,SAAO,sBAAsB,IAAA;AAChC;AACD,IAAae,gBAAc,CAAC,QAAQ;AAChCX,EAAAA,SAAM,GAAA;AACN,UAAQ,IAAI,MAAZ;IACI,KAAK;AACD,UAAI,IAAI,YAAY,UAAa,IAAI,YAAY,IAC7C,QAAO,OAAO,IAAI,CAAA,IAAK,IAAI,CAAA,IAAK,IAAI,CAAA;AAExC,aAAO,OAAO,IAAI,CAAA,IAAK,IAAI,CAAA,IAAK,IAAI,CAAA,OAAQ,IAAI,WAAW,OAAO,GAAA;IACtE,KAAK;AACD,UAAI,IAAI,YAAY,UAAa,IAAI,YAAY,EAC7C,QAAO,OAAO,IAAI,IAAI,GAAA,KAAQ,IAAI,IAAI,GAAA,KAAQ,IAAI,IAAI,GAAA;AAE1D,aAAO,OAAO,IAAI,IAAI,GAAA,KAAQ,IAAI,IAAI,GAAA,KAAQ,IAAI,IAAI,GAAA,QAAW,IAAI,WAAW,KAAK,GAAA;IACzF;AACI,YAAM,IAAI,MAAM,iBAAiB,IAAI,IAAA,EAAM;EAClD;AACJ;AACD,IAAM,YAAY,CAAC,QAAQ;AACvB,QAAMxB,SAAM,OAAO,GAAA;AACnB,SAAO;IACH,GAAGA,OAAI;IACP,GAAGA,OAAI;IACP,GAAGA,OAAI;IACP,OAAOA,OAAI;EACd;AACJ;AACD,SAAS,YAAY,KAAK,iBAAiB,CAAE,GAAE;AAC3C,MAAI,eAAe,OACf,QAAO;IACH,GAAG,IAAI,IAAI;IACX,GAAG,IAAI,IAAI;IACX,GAAG,IAAI,IAAI;IACX,SAAS,IAAI,SAAS;IACtB,MAAM;IACN,OAAO;EACV;MAGD,QAAO;IACH,GAAG,IAAI;IACP,GAAG,IAAI;IACP,GAAG,IAAI;IACP,SAAS,IAAI,SAAS;IACtB,MAAM;IACN,OAAO;EACV;AAER;AACD,IAAa,SAAS,CAAC,gBAAgB;AACnC,MAAI,OAAO,gBAAgB,SACvB,QAAO,QAAQ,aAAa,EAAE,QAAQ,MAAO,CAAA;AAEjD,MAAI,MAAM,WAAA,EACN,QAAO,OAAO,YAAYqC,aAAgB,WAAA,GAAc,EAAE,QAAQ,MAAO,CAAA,CAAC;AAE9Eb,EAAAA,SAAM,WAAA;AACN,MAAI,YAAY,SAAS,OACrB,QAAO;AACX,SAAO;IACH,GAAG,YAAY,IAAI;IACnB,GAAG,YAAY,IAAI;IACnB,GAAG,YAAY,IAAI;IACnB,UAAU,YAAY,WAAW,KAAK;IACtC,MAAM;IACN,OAAO;EACV;AACJ;AACD,IAAaJ,YAAW,CAAC,gBAAgB;AACrC,MAAI,OAAO,gBAAgB,SACvB,QAAO,QAAQ,aAAa,EAAE,QAAQ,KAAM,CAAA;AAEhD,MAAI,MAAM,WAAA,EACN,QAAOA,UAAS,YAAYiB,aAAgB,WAAA,GAAc,EAAE,QAAQ,KAAM,CAAA,CAAC;AAE/Eb,EAAAA,SAAM,WAAA;AACN,MAAI,YAAY,SAAS,SACrB,QAAO;AACX,SAAO;IACH,GAAG,YAAY,IAAI;IACnB,GAAG,YAAY,IAAI;IACnB,GAAG,YAAY,IAAI;IACnB,UAAU,YAAY,WAAW,KAAK;IACtC,MAAM;IACN,OAAO;EACV;AACJ;AACD,IAAaA,WAAQ,CAAC,QAAQ;AAC1B,QAAM,EAAE,GAAA1B,IAAG,GAAAC,IAAG,GAAA7B,IAAG,SAAA,WAAS,OAAO,KAAA,IAAS;AAC1C,MAAI,UAAU,OACV,OAAM,IAAI,MAAM,wCAAwC,KAAA,EAAO;AACnE,MAAI,SAAS,OACT,aAAY,yBAAyB4B,IAAG,GAAG,KAAK,GAAG,GAAG,yBAAyBC,IAAG,GAAG,KAAK,GAAG,GAAG,yBAAyB7B,IAAG,GAAG,KAAK,GAAG,GAAG,MAAM;AAC5I,QAAI,OAAOyD,cAAY,SACnB,QAAO,yBAAyBA,WAAS,GAAG,KAAK,SAAS;EAEjE,CAAA;WAEI,SAAS,SACd,aAAY,WAAW7B,IAAG,cAAc,GAAG,GAAG,WAAWC,IAAG,cAAc,GAAG,GAAG,WAAW7B,IAAG,cAAc,GAAG,GAAG,MAAM;AACpH,QAAI,OAAOyD,cAAY,SACnB,QAAO,WAAWA,WAAS,cAAc,SAAS;EAEzD,CAAA;MAGD,OAAM,IAAI,MAAM,mDAAmD,IAAA,EAAM;AAEhF;AAaD,IAAa,kBAAkB,CAAC,KAAK,WAAW;AAC5C,MAAI,OAAO;AACX,QAAMW,MAAK,IAAIL,cAASE,cAAY,GAAA,CAAI;AACxC,QAAM,aAAa,IAAI,SAAS;AAChC,MAAI,OAAO,OAAO,WAAW,YACzB,QAAOG,IAAG,MAAM,IAAKA,IAAG,MAAM,IAAI,OAAO;WAEpC,OAAO,OAAO,UAAU,YAC7B,QAAOA,IAAG,MAAM,IAAI,OAAO;WAEtB,OAAO,OAAO,UAAU,aAAa;AAC1C,QAAI,OAAO,QAAQ,EACf,OAAM,IAAI,UAAU,8CAA8C;AACtE,WAAO,OAAO;EACjB,MAEG,OAAM,IAAI,UAAU,+DAA+D;AAEvF,MAAI,OAAO,EACP,QAAO;WACF,OAAO,EACZ,QAAO;AACX,QAAM,YAAA,UAAwB;IAAE,GAAGA,IAAG,MAAM;IAAG,GAAGA,IAAG,MAAM;IAAG,GAAG;IAAM,OAAOA,IAAG,MAAM;EAAO,CAAA;AAC9F,SAAO,YAAY,WAAW,EAAE,QAAQ,WAAY,CAAA;AAEvD;AAQD,SAAgB,UAAU,KAAK;AAC3B,QAAMA,MAAK,IAAIL,cAASE,cAAY,GAAA,CAAI;AACxC,SAAOG,IAAG,MAAM;AACnB;AA0BD,SAAgB,SAAS,MAAM,KAAK,QAAQ,KAAK,OAAO,KAAKX,YAAU,KAAK;AACxE,QAAM,MAAM;IACR,MAAM;IACN,OAAO;IACP,GAAG;IACH,GAAG;IACH,GAAG;IACH,SAASA;EACZ;AACDH,EAAAA,SAAM,GAAA;AACN,SAAO;AACV;AASD,SAAgBM,SAAO,MAAM,KAAK,QAAQ,KAAK,OAAO,KAAKH,YAAU,GAAG;AACpE,QAAM,MAAM;IACR,MAAM;IACN,OAAO;IACP,GAAG;IACH,GAAG;IACH,GAAG;IACH,SAASA;EACZ;AACDH,EAAAA,SAAM,GAAA;AACN,SAAO;AACV;AAKD,SAAgB,oBAAoB3C,QAAO;AACvC,MAAIA,OAAM,WAAW,MAAM,EACvB,OAAM,IAAI,MAAM,uBAAuB;AAC3C,MAAI,CAACA,OAAM,WAAW,MAAM,EACxB,OAAM,IAAI,MAAM,6BAA6B;AACjD,QAAM,QAAQA,OAAM,QAAQ,GAAA;AAC5B,QAAM,MAAMA,OAAM,QAAQ,GAAA;AAC1B,MAAI,MAAM,MACN,OAAM,IAAI,MAAM,sCAAsC;AAC1D,QAAM,OAAOA,OAAM,UAAU,QAAQ,GAAG,GAAA;AACxC,MAAI,QAAQ,KAAK,MAAM,QAAA;AACvB,MAAI,MAAM,SAAS,EACf,OAAM,IAAI,MAAM,+BAA+B,MAAM,MAAA,SAAe;AACxE,MAAI,gBAAgB;AACpB,aAAWvB,MAAK,MACZ,KAAIA,GAAE,SAAS,GAAA,EACX;AAER,QAAM,gBAAgB,CAACqD,IAAG,QAAQ;AAC9B,QAAIA,GAAE,SAAS,GAAG,EACd,QAAO,OAAO,WAAWA,GAAE,UAAU,GAAGA,GAAE,SAAS,CAAA,CAAE,IAAI;AAE7D,QAAI,MAAM,EAEN,QAAO,OAAO,WAAWA,EAAA,IAAK;QAI9B,QAAO,OAAO,WAAWA,EAAA;EAEhC;AACD,QAAM,cAAc,CAACA,IAAG,QAAQ;AAC5B,QAAIA,GAAE,SAAS,GAAG,EACd,QAAO,OAAO,WAAWA,GAAE,UAAU,GAAGA,GAAE,SAAS,CAAA,CAAE,IAAI,MAAM;AAEnE,QAAI,MAAM,EAEN,QAAO,OAAO,WAAWA,EAAA;QAIzB,QAAO,OAAO,WAAWA,EAAA,IAAK;EAErC;AAED,MAAI,MAAM,SAAS,GACf;QAAI,MAAM,CAAA,MAAO,IAEb,SAAQ;MAAC,MAAM,CAAA;MAAI,MAAM,CAAA;MAAI,MAAM,CAAA;MAAI,MAAM,CAAA;IAAG;EACnD;AAEL,MAAI,gBAAgB,EAEhB,QAAOmB,SAAO,cAAc,MAAM,CAAA,GAAI,CAAA,GAAI,cAAc,MAAM,CAAA,GAAI,CAAA,GAAI,cAAc,MAAM,CAAA,GAAI,CAAA,GAAI,cAAc,MAAM,CAAA,KAAM,KAAK,CAAA,CAAE;MAInI,QAAO,SAAS,YAAY,MAAM,CAAA,GAAI,CAAA,GAAI,YAAY,MAAM,CAAA,GAAI,CAAA,GAAI,YAAY,MAAM,CAAA,GAAI,CAAA,GAAI,YAAY,MAAM,CAAA,KAAM,KAAK,CAAA,CAAE;AAEpI;AAaD,IAAaF,iBAAe,CAAC,SAAS,YAAY;AAC9C,QAAMW,MAAKnB,UAAS,OAAA;AACpB,QAAM,KAAKA,UAAS,OAAA;AACpB,QAAM,WAAWmB,IAAG,WAAW;AAC/B,QAAM,mBAAmB,GAAG,WAAW,KAAK;AAC5C,QAAMzC,KAAI,GAAG,IAAIyC,IAAG;AACpB,QAAMxC,KAAI,GAAG,IAAIwC,IAAG;AACpB,QAAMrE,KAAI,GAAG,IAAIqE,IAAG;AACpB,SAAO,CAAC,WAAW;AACf,aAAS,MAAM,MAAA;AACf,WAAOT,SAAOS,IAAG,IAAI,YAAY,QAAQ,GAAGzC,EAAA,GAAIyC,IAAG,IAAI,YAAY,QAAQ,GAAGxC,EAAA,GAAIwC,IAAG,IAAI,YAAY,QAAQ,GAAGrE,EAAA,GAAI,WAAW,YAAY,QAAQ,GAAG,eAAA,CAAgB;EACzK;AACJ;AAMD,SAAgB,aAAa,KAAK;AAC9B,MAAI,OAAO,QAAQ,UAAU;AACzB,UAAM,cAAc,QAAQ,KAAK,EAAE,QAAQ,MAAO,CAAA;AAClD,WAAO,aAAa,WAAA;EACvB;AACD,QAAM,OAAO,GAAA;AACb,QAAM,MAAA,QAAgB;IAAE,GAAG,IAAI;IAAG,GAAG,IAAI;IAAG,GAAG,IAAI;EAAG,CAAA;AACtD,SAAO;IAAE,GAAG;IAAK,QAAQ,IAAI,WAAW,OAAO;EAAK;AACvD;;;;;;;;;;ACxZD,IAAasE,SAAO,CAAC,UAAU;AAC3B,QAAMzC,KAAI;IAAE,MAAM,MAAM;IAAO,MAAM,MAAM;EAAQ;AACnD,SAAOA;AACV;AAsBD,IAAa0C,QAAO,CAAC,UAAU;AAC3B,SAAO;IACH,GAAGD,OAAK,KAAA;IACR,KAAK,SAAS,KAAA;IACd,KAAK,OAAO,KAAA;EACf;AACJ;AAMD,IAAa,WAAW,CAAC,UAAU;AAC/B,QAAMzC,KAAIyC,OAAK,KAAA;AACf,QAAM,OAAO,MAAM;AACnB,QAAM1B,MAAK,CAAC,MAAM,SAAS,gBAAgB;AACvC,UAAM,QAAA,cAA4Bf,IAAG,MAAM,MAAA;AAC3C,QAAI,UAAU,OACV;AACJ,UAAM,UAAU,QAAQ;AACxB,WAAO;MACH,GAAG,KAAK,OAAA;MACR,GAAG,KAAK,UAAU,CAAA;MAClB,GAAG,KAAK,UAAU,CAAA;MAClB,SAAS,KAAK,UAAU,CAAA;MACxB,MAAM;MACN,OAAO;IACV;EACJ;AACD,SAAOe;AACV;AAMD,IAAa,SAAS,CAAC,UAAU;AAC7B,QAAMf,KAAIyC,OAAK,KAAA;AACf,QAAM,OAAO,MAAM;AACnB,QAAM1B,MAAK,CAACjC,QAAO,MAAM,SAAS,gBAAgB;AAC9C,UAAM,QAAA,cAA4BkB,IAAG,MAAM,MAAA;AAC3C,QAAI,UAAU,OACV,OAAM,IAAI,MAAM,sBAAsB,KAAK,CAAA,IAAK,KAAK,CAAA,EAAG;AAC5D,UAAM,QAAA,OAAyBlB,MAAA;AAC/B,UAAM,UAAU,QAAQ;AACxB,SAAK,OAAA,IAAW,MAAM;AACtB,SAAK,UAAU,CAAA,IAAK,MAAM;AAC1B,SAAK,UAAU,CAAA,IAAK,MAAM;AAC1B,SAAK,UAAU,CAAA,IAAK,MAAM,WAAW;EACxC;AACD,SAAOiC;AACV;AAWD,UAAiB,MAAM,OAAO;AAC1B,QAAM7C,KAAI,SAAS,KAAA;AACnB,QAAM8B,KAAIyC,OAAK,KAAA;AACf,QAAM7B,KAAA,KAAkBZ,IAAG;IAAE,GAAG;IAAG,GAAG;EAAG,CAAA;AACzC,aAAW,OAAOY,IAAG;AACjB,UAAM,SAAS,IAAI,IAAI,CAAAlD,OAAKQ,GAAER,IAAG,WAAW,CAAC;AAC7C,UAAM;EACT;AACJ;AAKD,UAAiB,SAAS,OAAO;AAC7B,QAAMQ,KAAI,SAAS,KAAA;AACnB,QAAM8B,KAAIyC,OAAK,KAAA;AACf,WAASjE,KAAI,GAAGA,KAAIwB,GAAE,MAAMxB,MAAK;AAC7B,UAAM,MAAM,CAAE;AACd,aAASC,KAAI,GAAGA,KAAIuB,GAAE,MAAMvB,MAAK;AAC7B,YAAMf,KAAIQ,GAAE;QAAE,GAAAM;QAAG,GAAAC;MAAG,GAAE,WAAW;AACjC,UAAIf,GACA,KAAI,KAAKA,EAAA;IAChB;AACD,UAAM;EACT;AACJ;AClFD,IAAa,eAAb,cAAkC,mBAAmB;EACjD;EACA;EACA;EACA;EACA,YAAA;EACA,eAAA;EACA;EACA;EACA;EACA,YAAY;EACZ,YAAY,cAAc,OAAO,CAAE,GAAE;AACjC,UAAA;AACA,QAAI,CAAC,aACD,OAAM,IAAI,MAAM,qEAAqE;AACzF,SAAK,KAAKZ,WAAU,YAAA;AACpB,QAAI,KAAK,GAAG,aAAa,SACrB,OAAM,IAAI,MAAM,sCAAsC,KAAK,GAAG,QAAA,EAAU;AAE5E,UAAM,OAAO,KAAK,GAAG,sBAAA;AACrB,SAAK,OAAO;MACR,aAAa,KAAK,eAAe;MACjC,sBAAsB,KAAK,wBAAwB;MACnD,WAAW,KAAK,cAAc,OAAO,oBAAoB;MACzD,QAAQ,KAAK,UAAU,KAAK;MAC5B,OAAO,KAAK,SAAS,KAAK;MAC1B,QAAQ,KAAK,UAAU;MACvB,iBAAiB,KAAK,mBAAmB;MACzC,YAAY,KAAK;MACjB,WAAW,KAAK;MAChB,eAAe,KAAK,iBAAiB;MACrC,MAAM,KAAK;MACX,SAAS,KAAK,WAAW;MACzB,aAAa;IAChB;AACD,SAAK6F,UAAUC,QAAO,MAAM;AAC5B,SAAKC,cAAcD,QAAO,QAAQ,IAAA;AAClC,SAAKE,MAAAA;EACR;EACD,eAAe;AACX,WAAO;MACH,GAAG;MAAG,GAAG;MACT,GAAG,KAAKC;IACX;EACJ;EACD,QAAQ,QAAQ;AACZ,QAAI,KAAKC,UACL;AACJ,SAAKA,YAAY;AACjB,QAAI,KAAKC,UAAU;AACf,WAAKA,SAAS,QAAQ,0BAA0B,MAAA,GAAS,KAAA,CAAM;AAC/D,WAAKA,WAAW;IACnB;EACJ;EACD,YAAYC,SAAQ,OAAO;AACvB,QAAI,KAAKC,SAAS,UAAaD,QAAO;AAClC,YAAM,QAAQ,KAAK;AACnB,YAAMvF,KAAI,KAAK,GAAG,WAAW,IAAI;AACjC,UAAIA,OAAM,KACN,OAAM,IAAI,MAAM,kCAAkC;AACtD,WAAKwF,OAAOxF;AAEZ,MAAAA,GAAE,aAAa,GAAG,GAAG,GAAG,GAAG,GAAG,CAAA;AAC9B,MAAAA,GAAE,MAAM,OAAO,KAAA;IAClB;AACD,WAAO,KAAKwF;EACf;;;;;;EAOD,kBAAkB;AACd,WAAO;MACH,OAAO,KAAK,QAAQ,KAAK;MACzB,QAAQ,KAAK,SAAS,KAAK;IAC9B;EACJ;;;;;EAKD,gBAAgB;AACZ,QAAI,CAAC,KAAKC,YACN,MAAKA,cAAAA,aAAiC,KAAKC,YAAAA,GAAe;MACtD,OAAO,KAAK;MAAO,QAAQ,KAAK;IACnC,CAAA;EAER;EACD,eAAe,aAAa;YACZ,aAAa,aAAa;AACtC,UAAM,qBAAA,YAAuC,CAAAzC,OAAK,KAAK,MAAMA,EAAA,GAAI,WAAA;AACjE,UAAM,QAAQ,KAAK,KAAK;AAExB,SAAK+B,UAAUC,QAAO,KAAK,KAAK,iBAAiB,WAAA;AACjD,SAAKC,cAAcD,QAAO,QAAQ,WAAA;AAElC,UAAM,cAAA,iBAAmC,aAAa,KAAA;AAEtD,SAAK,GAAG,QAAQ,YAAY;AAC5B,SAAK,GAAG,SAAS,YAAY;AAE7B,SAAK,GAAG,MAAM,QAAQ,mBAAmB,MAAM,SAAA,IAAa;AAC5D,SAAK,GAAG,MAAM,SAAS,mBAAmB,OAAO,SAAA,IAAa;AAE9D,SAAKS,YAAY,IAAA;AACjB,QAAI,KAAK,KAAK,cACV,MAAK,IAAI,UAAU,GAAG,GAAG,KAAK,OAAO,KAAK,MAAA;AAE9C,SAAKN,eAAe;AAOpB,QAAI,KAAK,KAAK,WACV,MAAK,KAAK,WAAW,KAAK,KAAK,KAAK,MAAM,IAAA;AAE9C,SAAK,UAAU,UAAU;MAAE,KAAK,KAAK;MAAK,MAAM,KAAKA;MAAc,QAAQ;IAAM,CAAA;EACpF;EACD,QAAQ;AAGJ,UAAMzE,KAAI,KAAK,KAAK;AACpB,QAAIA,IAAG;AACH,YAAM,QAAQ,MAAM;AAChB,QAAAA,GAAE,KAAK,KAAK,KAAKyE,cAAc,IAAA;AAC/B,8BAAsB,KAAA;MACzB;AACD,iBAAW,MAAM;AAAE,cAAA;MAAU,GAAE,GAAA;IAClC;AACD,QAAI,CAAC,KAAK,KAAK,qBACX,MAAKO,cAAAA;AAET,UAAM,cAAc,KAAK,KAAK,eAAe;AAC7C,QAAI,gBAAgB,OAChB,MAAK,eAAe;MAAE,OAAO,KAAK,KAAK;MAAO,QAAQ,KAAK,KAAK;IAAQ,CAAA;SAEvE;AACD,YAAM,iBAAiB;QACnB,gBAAgB,CAAC,SAAS;AACtB,cAAA,UAAkB,KAAKP,cAAc,IAAA,EACjC;AACJ,eAAK,eAAe,IAAA;QACvB;QACD,YAAY,CAAC,MAAMQ,QAAO;AACtB,eAAKC,cAAc,IAAA;QACtB;QACD,aAAa,KAAK,KAAK;QACvB,aAAa;UAAE,OAAO,KAAK,KAAK;UAAO,QAAQ,KAAK,KAAK;QAAQ;QACjE,SAAS,KAAK,KAAK,eAAe;MACrC;AACD,WAAKP,WAAW,IAAI,aAAa,KAAK,IAAI,cAAA;IAC7C;AACD,SAAKI,YAAAA;EACR;EACD,cAAc,MAAM;AAChB,QAAI,KAAK,KAAK,UACV,MAAK,KAAK,UAAU,KAAK,KAAK,KAAK,MAAM,IAAA;AAC7C,SAAK,UAAU,WAAW;MAAE,KAAK,KAAK;MAAK,MAAM,KAAKN;MAAc,QAAQ;IAAM,CAAA;EACrF;EACD,gBAAgB;AACZ,UAAM,qBAAqB,CAACU,WAAU;AAClC,YAAM,EAAE,SAAS,QAAA,IAAYA;AAC7B,YAAM,YAAY,UAAU,KAAK;AACjC,YAAM,YAAY,UAAU,KAAK;AACjC,MAAAA,SAAQ,gBAAgBA,MAAA;AACxB,YAAM,YAAY;QACd;QAAW;QAEX,GAAGA;MACN;AACD,cAAQA,OAAM,MAAd;QACI,KAAK,aACD;AACI,eAAK,UAAU,aAAa,SAAA;AAC5B;QACH;QAGL,KAAK,eACD;AACI,eAAK,UAAU,eAAe,SAAA;AAC9B;QACH;QAGL,KAAK,eACD;AACI,eAAK,UAAU,aAAa,SAAA;AAC5B;QACH;MAGR;IAEJ;AACD,SAAK,GAAG,iBAAiB,eAAe,kBAAA;AACxC,SAAK,GAAG,iBAAiB,eAAe,kBAAA;AACxC,SAAK,GAAG,iBAAiB,aAAa,kBAAA;EACzC;;;;;;;EAOD,QAAQ;AACJ,QAAI,CAAC,KAAKN,KACN;AACJ,SAAKA,KAAK,UAAU,GAAG,GAAG,KAAK,OAAO,KAAK,MAAA;EAC9C;;;;;;;;;;;EAWD,KAAK,QAAQ;AACT,QAAI,CAAC,KAAKA,KACN;AACJ,QAAI,OACA,MAAKA,KAAK,YAAY;AAC1B,SAAKA,KAAK,SAAS,GAAG,GAAG,KAAK,OAAO,KAAK,MAAA;EAC7C;;;;EAID,IAAI,MAAM;AACN,QAAI,KAAKA,SAAS,OACd,OAAM,IAAI,MAAM,uBAAuB;AAC3C,WAAO,KAAKE,YAAAA;EACf;EACD,IAAI,WAAW;AACX,WAAO,KAAKK;EACf;;;;;EAKD,IAAI,QAAQ;AACR,WAAO,KAAKX,aAAa;EAC5B;;;;;EAKD,IAAI,SAAS;AACT,WAAO,KAAKA,aAAa;EAC5B;;;;;EAKD,IAAI,OAAO;AACP,WAAO,KAAKA;EACf;;;;;EAKD,IAAI,QAAQ;AACR,WAAO,OAAO,oBAAoB;EACrC;;;;EAID,IAAI,eAAe;AACf,WAAO,KAAK,IAAI,KAAK,OAAO,KAAK,MAAA;EACpC;;;;EAID,IAAI,eAAe;AACf,WAAO,KAAK,IAAI,KAAK,OAAO,KAAK,MAAA;EACpC;EACD,WAAW,cAAc,SAAS;AAC9B,UAAM,MAAM,KAAKM,YAAAA;SACJ,KAAK;MAAE,GAAG;MAAG,GAAG;MAAG,OAAO,KAAK;MAAO,QAAQ,KAAK;IAAQ,GAAE;MAAE,SAAS;MAAM;MAAa,aAAa;IAAG,CAAA;SAC3G,KAAK,KAAKK,WAAW;MAAE,SAAS;MAAM,aAAa;MAAU,aAAa;IAAG,CAAA;EAC7F;;;;;;;;;;;;;EAaD,IAAI,aAAa;AACb,WAAO,KAAKf,QAAQ;EACvB;;;;EAID,IAAI,kBAAkB;AAClB,WAAO,KAAKE,YAAY;EAC3B;;;;EAID,IAAI,kBAAkB;AAClB,WAAO,KAAKA,YAAY;EAC3B;EACD,IAAI,gBAAgB;AAChB,WAAO;MACH,GAAG,KAAKE,aAAa,QAAQ;MAC7B,GAAG,KAAKA,aAAa,SAAS;IACjC;EACJ;;;;;;;;;;;;;EAaD,IAAI,aAAa;AACb,WAAO,KAAKJ,QAAQ;EACvB;;;;EAID,IAAI,SAAS;AACT,WAAO;MAAE,GAAG,KAAK,QAAQ;MAAG,GAAG,KAAK,SAAS;IAAG;EACnD;;;;;;;EAOD,eAAe;AACX,UAAM,OAAO,KAAK,gBAAA;AAClB,UAAM,OAAO,KAAK,IAAI,aAAa,GAAG,GAAG,KAAK,OAAO,KAAK,QAAQ,EAAE,YAAY,KAAK,KAAK,YAAa,CAAA;AACvG,QAAI,SAAS,QAAQ,SAAS,OAC1B,OAAM,IAAI,MAAM,uCAAuC;AAC3D,WAAO;EACV;;;;;;;;;;;;;;;;;;;;;EAqBD,oBAAoB;AAChB,UAAM,MAAM,KAAK;AACjB,UAAM,OAAO,KAAK,aAAA;AAClB,UAAMF,SAAAA,OAA0B,IAAA;AAChC,UAAMkB,OAAA,SAA6B,IAAA;AACnC,UAAMC,OAAA,OAA2B,IAAA;AACjC,UAAMC,QAAO,MAAM;AACf,UAAI,aAAa,MAAM,GAAG,CAAA;IAC7B;AACD,WAAO;MAAE,MAAA;MAAM,KAAAF;MAAK,KAAAC;MAAK,MAAAC;IAAM;EAClC;AACJ;ACtaD,IAAaC,QAAO,KAAK,KAAK;ACQ9B,IAAa,eAAb,MAA0B;EACtB;EACA;EACA;EACA;EACA;EACA;EACA,WAAW,CAAE;EACb,YAAY,sBAAsB,YAAY,OAAO;AACjD,SAAKC,YAAYjH,WAAU,oBAAA;AAC3B,SAAKkH,aAAa;AAClB,SAAKC,gBAAgB,OAAO,oBAAoB;AAChD,SAAKC,cAAc,KAAKC,kBAAAA;AACxB,SAAKpB,eAAe,KAAK,eAAe;MAAE,OAAO,KAAKgB,UAAU;MAAO,QAAQ,KAAKA,UAAU;IAAQ,CAAA;EACzG;;;;;;EAMD,eAAe,MAAM;AACjB,SAAKhB,eAAe;AACpB,UAAMQ,MAAK,KAAKQ;AAChB,IAAAR,IAAG,QAAS,KAAK,QAAQ,KAAKU;AAC9B,IAAAV,IAAG,SAAU,KAAK,SAAS,KAAKU;AAChC,IAAAV,IAAG,MAAM,QAAQ,GAAI,KAAK,MAAO,SAAA,CAAU;AAC3C,IAAAA,IAAG,MAAM,SAAS,GAAI,KAAK,OAAQ,SAAA,CAAU;AAC7C,SAAKW,cAAc,KAAKC,kBAAAA;AACxB,SAAK,kBAAA;AACL,WAAO;EACV;EACD,oBAAoB;AAChB,QAAI,QAAQ;AACZ,YAAQ,KAAKH,YAAb;MACI,KAAK;AACD,gBAAQ,KAAK,IAAI,KAAKD,UAAU,OAAO,KAAKA,UAAU,MAAA;AACtD;MACJ,KAAK;AACD,gBAAQ,KAAK,IAAI,KAAKA,UAAU,OAAO,KAAKA,UAAU,MAAA;AACtD;IACP;AACD,UAAMxG,KAAI,aAAa,GAAG,OAAO,GAAG,CAAA;AACpC,WAAO;MACH,KAAKA,GAAE;MACP,KAAKA,GAAE;IACV;EACJ;;;;EAID,oBAAoB;AAChB,SAAK4F,OAAO;EACf;EACD,KAAK,QAAQ;AACT,QAAI,CAAC,OACD,OAAM,IAAI,MAAM,kCAAkC;AACtD,QAAI,KAAKiB,SAAS,SAAS,MAAA,EACvB,OAAM,IAAI,MAAM,uBAAuB;AAC3C,SAAKA,SAAS,KAAK,MAAA;AACnB,WAAO;EACV;;;;;;;EAOD,WAAWtG,KAAI,OAAO,eAAe;AACjC,QAAI,EAAE,GAAAU,IAAG,GAAAC,GAAA,IAAMX;AACf,YAAQ,MAAR;MACI,KAAK;AACD,QAAAU,MAAK,KAAK;AACV,QAAAC,MAAK,KAAK;IACjB;AACD,WAAO;MAAE,GAAAD;MAAG,GAAAC;IAAG;EAClB;;;;EAID,IAAI,SAAS;AACT,UAAMN,KAAI,KAAK4F,UAAU,sBAAA;AACzB,WAAO;MAAE,GAAG5F,GAAE;MAAM,GAAGA,GAAE;IAAK;EACjC;;;;;;;;;EASD,WAAWL,KAAI,QAAQ,OAAO,eAAe,UAAU,MAAM;AACzD,QAAI,EAAE,GAAAU,IAAG,GAAAC,GAAA,IAAMX;AACf,QAAI,WAAW,UAAU;AACrB,YAAMK,KAAI,KAAK4F,UAAU,sBAAA;AACzB,MAAAvF,MAAKL,GAAE;AACP,MAAAM,MAAKN,GAAE;IACV;AACD,YAAQ,MAAR;MACI,KAAK;AACD,QAAAK,MAAK,KAAK;AACV,QAAAC,MAAK,KAAK;AACV;MACJ,KAAK;AACD;IACP;AACD,QAAI,SAAS;AACT,MAAAD,KAAI,MAAMA,EAAA;AACV,MAAAC,KAAI,MAAMA,EAAA;IACb;AACD,WAAO;MAAE,GAAAD;MAAG,GAAAC;IAAG;EAClB;;;;;;;EAOD,UAAUG,QAAM,OAAO,eAAe;AAClC,QAAI,EAAE,OAAO,QAAAyF,QAAA,IAAWzF;AACxB,YAAQ,MAAR;MACI,KAAK;AACD,iBAAS,KAAK;AACd,QAAAyF,WAAU,KAAK;AACf,YAAA,iBAA2BzF,MAAAA,EACvB,QAAO;UACH,GAAG,KAAK,WAAWA,MAAAA;UACnB;UACA,QAAAyF;QACH;IAEZ;AACD,WAAO;MAAE;MAAO,QAAAA;IAAQ;EAC3B;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;EA8BD,aAAa,MAAM;AACf,UAAM,WAAW,KAAK,YAAY;AAClC,UAAM,YAAY,WAAW;AAC7B,QAAI,mBAAmB,MAAM;AACzB,YAAMzF,SAAAA,aAA0B,KAAK,eAAe,UAAU,QAAA;AAC9D,aAAO,KAAK0F,KAAK,IAAI,aAAa,MAAM,MAAM1F,MAAAA,CAAAA;IACjD;AACD,QAAI,wBAAwB,MAAM;AAC9B,UAAI;AACJ,YAAMA,SAAO,KAAK;AAClB,cAAQ,KAAK,OAAb;QACI,KAAK;AACD,oBAAU,CAAC,YAAY;YACnB,GAAIA,OAAK,IAAI,OAAO,QAAS;YAC7B,GAAIA,OAAK,IAAI,OAAO,SAAU;YAC9B,OAAQA,OAAK,QAAQ,OAAO,QAAS;YACrC,QAASA,OAAK,SAAS,OAAO,SAAU;UAC3C;AACD;QACJ;AACI,gBAAM,IAAI,MAAM,yBAAyB,KAAK,KAAA,GAAQ;MAC7D;AACD,aAAO,KAAK0F,KAAK,IAAI,aAAa,MAAM,OAAA,CAAA;IAC3C;AACD,QAAI,kBAAkB,MAAM;AACxB,UAAI;AACJ,YAAM1F,SAAO,KAAK;AAClB,YAAM,WAAW,KAAK;AACtB,cAAQ,KAAK,OAAb;QACI,KAAK;AACD,oBAAU,CAAC,WAAW;AAClB,kBAAM,QAASA,OAAK,QAAQ,OAAO,QAAS;AAC5C,kBAAMyF,UAAUzF,OAAK,SAAS,OAAO,SAAU;AAC/C,gBAAIJ,KAAI,OAAO,QAAQ,IAAI,QAAQ;AACnC,gBAAIC,KAAI,OAAO,SAAS,IAAI4F,UAAS;AACrC,oBAAQ,UAAR;cACI,KAAK;AACD,gBAAA5F,KAAI;AACJ;cACJ,KAAK;AACD,gBAAAA,KAAI,OAAO,SAAS4F;AACpB;cACJ;YAEH;AACD,YAAA7F,MAAK;AACL,YAAAC,MAAK;AACL,mBAAO;cAAE;cAAO,QAAA4F;cAAQ,GAAA7F;cAAG,GAAAC;YAAG;UACjC;AACD;QACJ;AACI,gBAAM,IAAI,MAAM,yBAAyB,KAAK,KAAA,GAAQ;MAC7D;AACD,aAAO,KAAK6F,KAAK,IAAI,aAAa,MAAM,OAAA,CAAA;IAC3C;AACD,QAAI,WAAW,MAAM;AACjB,YAAM,SAAS,kBAAkB,KAAK,KAAA;AACtC,UAAI,CAAC,OAAO,QACR,OAAM,IAAI,MAAM,oCAAoC,oBAAoB,MAAA,CAAO,EAAE;AAErF,YAAM,UAAU,CAAC,YAAY;AACzB,cAAM,SAAS,OAAO,MAAM,sBAAA;AAC5B,eAAO;UACH,GAAG,OAAO,IAAI;UACd,GAAG,OAAO,IAAI;UACd,OAAO,OAAO,QAAQ;UACtB,QAAQ,OAAO,SAAS;QAC3B;MACJ;AACD,aAAO,KAAKA,KAAK,IAAI,aAAa,MAAM,OAAA,CAAA;IAC3C;AACD,UAAM,IAAI,MAAM,yBAAyB;EAC5C;;;;EAID,QAAQ;AACJ,UAAM3G,KAAI,KAAK;AACf,IAAAA,GAAE,UAAU,GAAG,GAAG,KAAK,OAAO,KAAK,MAAA;EACtC;;;;EAID,IAAI,UAAU;AACV,QAAI,KAAKwF,KACL,QAAO,KAAKA;AAChB,UAAMxF,KAAI,KAAKoG,UAAU,WAAW,IAAI;AACxC,QAAI,CAACpG,GACD,OAAM,IAAI,MAAM,6BAA6B;AACjD,IAAAA,GAAE,aAAa,GAAG,GAAG,GAAG,GAAG,GAAG,CAAA;AAC9B,IAAAA,GAAE,MAAM,KAAKsG,eAAe,KAAKA,aAAAA;AACjC,SAAKd,OAAOxF;AACZ,eAAWoC,MAAK,KAAKqE,SACjB,CAAArE,GAAE,gBAAA;AAEN,WAAO,KAAKoD;EACf;;;;EAID,IAAI,aAAa;AACb,WAAO,KAAKe;EACf;;;;EAID,IAAI,QAAQ;AACR,WAAO,KAAKnB,aAAa;EAC5B;;;;EAID,IAAI,SAAS;AACT,WAAO,KAAKA,aAAa;EAC5B;AACJ;AAID,IAAa,eAAb,MAA0B;EACtB;EACA;EACA;;;;EAIA,YAAY,QAAQ,eAAe;AAC/B,SAAK,SAAS;AACd,SAAKwB,iBAAiB;AACtB,SAAKC,KAAK,cAAc,MAAA;EAC3B;;;;;EAKD,kBAAkB;AACd,SAAKA,KAAK,KAAKD,eAAe,KAAK,MAAA;EACtC;;;;;;;;;;;;EAYD,YAAY,WAAW,UAAU,QAAQ;AACrC,YAAQ,SAAR;MACI,KAAK;AACD,eAAO;UACH,GAAG,UAAU,IAAI,KAAKC,GAAG;UACzB,GAAG,UAAU,IAAI,KAAKA,GAAG;QAC5B;IAER;EACJ;;;;;;EAMD,kBAAkB9G,IAAG;AACjB,WAAO;MACH,GAAGA,GAAE,IAAI,KAAK8G,GAAG;MACjB,GAAG9G,GAAE,IAAI,KAAK8G,GAAG;IACpB;EACJ;;;;;;;;EAQD,4BAA4B,gBAAgB,aAAa,YAAY,GAAG;AACpE,UAAM,SAAS,eAAe,IAAI,CAAA9G,OAAK,KAAK,YAAYA,EAAA,CAAE;AAC1D,SAAK,oBAAoB,QAAQ,aAAa,SAAA;EACjD;;;;;;;;;;EAUD,oBAAoB,QAAQ,aAAa,YAAY,GAAG;AACpD,UAAMC,KAAI,KAAK;AACf,IAAAA,GAAE,KAAA;AACF,IAAAA,GAAE,UAAU,KAAK6G,GAAG,GAAG,KAAKA,GAAG,CAAA;AAC/B,IAAA7G,GAAE,UAAA;AACF,IAAAA,GAAE,cAAc;AAChB,IAAAA,GAAE,YAAY;AACd,aAAS,QAAQ,GAAG,QAAQ,OAAO,QAAQ,QACvC,KAAI,UAAU,EACV,CAAAA,GAAE,OAAO,OAAO,KAAA,EAAO,GAAG,OAAO,KAAA,EAAO,CAAA;QAGxC,CAAAA,GAAE,OAAO,OAAO,KAAA,EAAO,GAAG,OAAO,KAAA,EAAO,CAAA;AAGhD,IAAAA,GAAE,OAAA;AACF,IAAAA,GAAE,QAAA;EACL;;;;;;;;;EASD,iBAAiBe,QAAM,QAAQ,YAAY,SAAS,MAAM,WAAW,cAAc,QAAQ,SAAS;AAChG,UAAMX,SAAQ,KAAK,YAAY,MAAA;AAC/B,SAAK,iBAAiBW,QAAMX,QAAO,WAAW,MAAM,UAAU,KAAA;EACjE;;;;;;;;;EASD,SAASW,QAAMX,QAAO,YAAY,SAAS,MAAM,WAAW,cAAc,QAAQ,SAAS;AACvF,UAAMJ,KAAI,KAAK;AACf,IAAAA,GAAE,KAAA;AACF,IAAAA,GAAE,UAAU,KAAK6G,GAAG,GAAG,KAAKA,GAAG,CAAA;AAC/B,QAAI,KAAK,SAAS,EACd,CAAA7G,GAAE,OAAO;AAEb,IAAAA,GAAE,eAAe;AACjB,IAAAA,GAAE,YAAY;AACd,IAAAA,GAAE,YAAY;AACd,IAAAA,GAAE,SAASe,QAAMX,OAAM,GAAGA,OAAM,CAAA;AAChC,IAAAJ,GAAE,QAAA;EACL;EACD,YAAY,iBAAiB,WAAW,cAAc,IAAI,YAAY,GAAG;AACrE,UAAM,UAAU,gBAAgB,IAAI,CAAA,QAAK;AACrC,aAAO;QACH,GAAG,KAAK,YAAYA,GAAAA;QACpB,QAAQ,KAAK,OAAO,WAAW,IAAIA,IAAE,MAAA;MACxC;IACJ,CAAA;AACD,UAAMA,KAAI,KAAK;AACf,IAAAA,GAAE,KAAA;AACF,IAAAA,GAAE,UAAU,KAAK6G,GAAG,GAAG,KAAKA,GAAG,CAAA;AAC/B,IAAA7G,GAAE,YAAY;AACd,IAAAA,GAAE,cAAc;AAChB,IAAAA,GAAE,YAAY;AACd,eAAWV,YAAU,SAAS;AAC1B,MAAAU,GAAE,UAAA;AACF,MAAAA,GAAE,IAAIV,SAAO,GAAGA,SAAO,GAAGA,SAAO,QAAQ,GAAG6G,KAAA;AAC5C,MAAAnG,GAAE,UAAA;AACF,UAAI,UAAU,SAAS,EACnB,CAAAA,GAAE,KAAA;AAEN,UAAI,YAAY,SAAS,EACrB,CAAAA,GAAE,OAAA;IAET;AACD,IAAAA,GAAE,QAAA;EACL;;;;EAID,QAAQ;AACJ,UAAMA,KAAI,KAAK;AACf,IAAAA,GAAE,UAAU,KAAK6G,GAAG,GAAG,KAAKA,GAAG,GAAG,KAAKA,GAAG,OAAO,KAAKA,GAAG,MAAA;EAC5D;;;;;EAKD,KAAK,YAAY,SAAS;AACtB,UAAM7G,KAAI,KAAK;AACf,IAAAA,GAAE,YAAY;AACd,IAAAA,GAAE,SAAS,KAAK6G,GAAG,GAAG,KAAKA,GAAG,GAAG,KAAKA,GAAG,OAAO,KAAKA,GAAG,MAAA;EAC3D;;;;;;EAMD,WAAW,aAAa,YAAY,GAAG;AACnC,SAAK,4BAA4B;MAC7B;QAAE,GAAG;QAAG,GAAG;MAAG;MACd;QAAE,GAAG;QAAG,GAAG;MAAG;MACd;QAAE,GAAG;QAAG,GAAG;MAAG;MACd;QAAE,GAAG;QAAG,GAAG;MAAG;MACd;QAAE,GAAG;QAAG,GAAG;MAAG;IACjB,GAAE,aAAa,SAAA;AAChB,SAAK,4BAA4B,CAC7B;MAAE,GAAG;MAAG,GAAG;IAAG,GACd;MAAE,GAAG;MAAG,GAAG;IAAG,CACjB,GAAE,aAAa,SAAA;AAChB,SAAK,4BAA4B,CAC7B;MAAE,GAAG;MAAG,GAAG;IAAG,GACd;MAAE,GAAG;MAAG,GAAG;IAAG,CACjB,GAAE,aAAa,SAAA;EACnB;;;;;;;EAOD,WAAW1G,KAAI,SAAS,UAAU,OAAO,eAAe,UAAU,MAAM;AACpE,IAAAA,MAAK,KAAK,OAAO,WAAWA,KAAI,QAAQ,QAAQ,KAAA;AAChD,QAAI,EAAE,GAAAU,IAAG,GAAAC,GAAA,IAAMX;AACf,IAAAU,MAAK,KAAK;AACV,IAAAC,MAAK,KAAK;AACV,YAAQ,MAAR;MACI,KAAK;AACD,QAAAD,MAAK,KAAK;AACV,QAAAC,MAAK,KAAK;IACjB;AACD,QAAI,SAAS;AACT,MAAAD,KAAI,MAAMA,EAAA;AACV,MAAAC,KAAI,MAAMA,EAAA;IACb;AACD,WAAO;MAAE,GAAAD;MAAG,GAAAC;IAAG;EAClB;;;;;;;;EAQD,iBAAiBX,KAAI,QAAQ,SAAS;AAClC,QAAI,WAAW,SACX,CAAAA,MAAA,SAAqBA,KAAI,KAAK,OAAO,MAAA;AAEzC,QAAI,EAAE,GAAAU,IAAG,GAAAC,GAAA,IAAMX;AACf,IAAAU,MAAK,KAAK;AACV,IAAAC,MAAK,KAAK;AACV,QAAI,SAAS;AACT,UAAID,KAAI,EACJ,CAAAA,KAAI;AACR,UAAIC,KAAI,EACJ,CAAAA,KAAI;AACR,UAAID,KAAI,KAAK,QAAQ,KAAK,EACtB,CAAAA,KAAI,KAAK,IAAI,KAAK;AACtB,UAAIC,KAAI,KAAK,SAAS,KAAK,EACvB,CAAAA,KAAI,KAAK,IAAI,KAAK;IACzB;AACD,WAAO;MAAE,GAAAD;MAAG,GAAAC;IAAG;EAClB;;;;EAID,IAAI,SAAS;AACT,WAAA,SAAoB,KAAK+F,EAAAA;EAC5B;;;;EAID,IAAI,UAAU;AACV,WAAO,KAAK,OAAO;EACtB;;;;EAID,IAAI,OAAO1F,QAAO;AACd,SAAK0F,KAAK1F;EACb;;;;EAID,IAAI,SAAS;AACT,WAAO,KAAK0F;EACf;;;;EAID,IAAI,QAAQ;AACR,WAAO,KAAKA,GAAG;EAClB;;;;EAID,IAAI,SAAS;AACT,WAAO,KAAKA,GAAG;EAClB;;;;EAID,IAAI,IAAI;AACJ,WAAO,KAAKA,GAAG;EAClB;;;;EAID,IAAI,IAAI;AACJ,WAAO,KAAKA,GAAG;EAClB;;;;EAID,IAAI,eAAe;AACf,WAAO,KAAK,IAAI,KAAKA,GAAG,OAAO,KAAKA,GAAG,MAAA;EAC1C;AACJ;AC5jBD,IAAa,YAAY,CAAC,MAAM,SAAS;AACrC,MAAI,KAAK,UACL,MAAK,eAAe,MAAM,QAAQ,KAAK,SAAA;AAC3C,MAAI,KAAK,QACL,MAAK,eAAe,MAAM,WAAW,KAAK,QAAQ,SAAA,CAAU;AAEnE;ACND,IAAa,YAAY,CAAC,QAAQ;AAC9B,QAAMC,KAAI,IAAI,eAAe,MAAM,OAAO;AAC1C,QAAM,QAAQA,OAAM,OAAO,IAAI,OAAO,WAAWA,EAAA;AACjD,QAAMhF,KAAI,IAAI,eAAe,MAAM,QAAQ;AAC3C,QAAM4E,UAAS5E,OAAM,OAAO,IAAI,OAAO,WAAWA,EAAA;AAClD,SAAO;IAAE;IAAO,QAAA4E;EAAQ;AAC3B;AAMD,IAAa,YAAY,CAAC,KAAK,WAAW;AACtC,MAAI,eAAe,MAAM,SAAS,OAAO,MAAM,SAAA,CAAU;AACzD,MAAI,eAAe,MAAM,UAAU,OAAO,OAAO,SAAA,CAAU;AAC9D;ACfD,IAAa,WAAW,CAAC,MAAM,OAAO;AAClC,QAAMrG,KAAI,SAAS,gBAAgB,8BAA8B,IAAA;AACjE,MAAI,GACA,CAAAA,GAAE,KAAK;AAEX,SAAOA;AACV;AAqBD,IAAa,kBAAkB,CAAC,QAAQ,MAAM,iBAAiB,WAAW;AACtE,MAAI,WAAW;AACf,MAAI,oBAAoB,OACpB,YAAW,OAAO,oBAAoB,WAAW,OAAO,cAAc,eAAA,IAAmB;AAE7F,MAAI,aAAa,MAAM;AACnB,UAAMN,KAAI,SAAS,gBAAgB,8BAA8B,IAAA;AACjE,WAAO,OAAOA,EAAA;AACd,QAAI,mBAAmB,OAAO,oBAAoB,YAC9C,gBAAgB,WAAW,GAAG,EAC9B,CAAAA,GAAE,KAAK,WAAW,UAAa,CAAC,gBAAgB,SAAS,MAAA,IAAU,gBAAgB,MAAM,CAAA,IAAK,SAAS,gBAAgB,MAAM,CAAA;AAEjI,WAAOA;EACV;AACD,SAAO;AACV;AC9BD,IAAa,oBAAoB,CAAC,OAAO,aAAa,KAAKiE,cAAY,MAAM,QAAQ,MAAM;AACvF,cAAY,WAAW,OAAO,YAAY,OAAO,GAAG,WAAW,YAAY,cAAc,YAAY,GAAG,WAAWA,aAAW,cAAc,WAAW,GAAG,WAAW,OAAO,cAAc,OAAO,CAAC;AAElM,QAAM,SAAS,QAAQ;AACvB,QAAM,SAAU,SAAS,MAAO;AAChC,SAAO,YAAY+C,OAAU,QAAQ,YAAY/C,aAAW,KAAA,CAAM;AAErE;AAcD,IAAa,YAAY,CAAC,OAAO,KAAK,WAAW,KAAA,IAAS;ACpB1D,SAAgB,gBAAgB,WAAW,QAAQ;AAC/C,SAAO,YAAY,WAAW,CAAAnE,OAAK,MAAMA,KAAI,MAAA,CAAO;AACvD;AAQD,SAAgB,YAAY,WAAWuD,KAAI;AACvC,QAAM,SAAS,SAAS,SAAA;AACxB,MAAI;AACJ,UAAQ,OAAO,OAAf;IACI,KAAK;AACD,eAAA,cAA8B,QAAQA,GAAA;AACtC;IACJ,KAAK;AACD,eAAA,cAA+B,QAAQA,GAAA;AACvC;IACJ,KAAK;AACD,eAAA,cAAgC,QAAQA,GAAA;AACxC;IACJ;AACI,YAAM,IAAI,MAAM,mBAAmB,OAAO,KAAA,8BAAmC;EACpF;AACD,MAAI,CAAC,OACD,OAAM,IAAI,MAAM,4BAA4B;AAEhD,MAAI,OAAO,cAAc,SACrB,QAAO,YAAY,MAAA;AAEvB,SAAO;AACV;AAED,SAAgB,WAAW,WAAWa,WAAS;AAC3C,QAAM,SAAS,SAAS,SAAA;AACxB,SAAO,UAAUA;AACjB,MAAI,OAAO,cAAc,SACrB,QAAO,YAAY,MAAA;AAEvB,SAAO;AACV;ACzDD,SAAS,gBAAgB,SAAS,cAAc,OAAO;AACnD,MAAI,CAAC,MAAM,QAAQ,OAAA,EACf,OAAM,IAAI,MAAM,qDAAqD,OAAO,OAAA,EAAS;AACzF,MAAI,QAAQ,SAAS,EACjB,OAAM,IAAI,MAAM,0DAA0D,QAAQ,MAAA,EAAQ;AAC9F,QAAMjE,KAAI,QAAQ,IAAI,CAAA,WAAU,cAAc,QAAQ,WAAA,CAAY;AAClE,SAAO,CAAC,GAAG,SAASA,EAAA,CAAG;AAC1B;AASD,IAAa,oBAAoB,CAAC,YAAY;AAC1C,QAAMA,KAAI,QAAQ,IAAI,CAAA,QAAK,YAAYA,GAAAA,CAAE;AACzC,SAAO,6BAA6BA,GAAE,KAAK,IAAI,CAAC;AACnD;AAmBD,IAAakE,gBAAe,CAAC,SAAS,SAAS,UAAU,CAAE,MAAK;AAC5D,QAAM,QAAQ,QAAQ,SAAS;AAC/B,QAAM,YAAY,QAAQ,aAAa;AACvC,MAAI;AACJ,UAAQ,OAAR;IACI,KAAK;AACD,cAAA,eAA8B,QAAQ,SAAS,YAAY,GAAG,QAAQ,SAAS,YAAY,GAAG,SAAA;AAC9F;IACJ,KAAK;AACD,cAAA,eAA+B,QAAQ,SAAS,aAAa,GAAG,QAAQ,SAAS,aAAa,CAAC;AAC/F;IACJ;AACI,cAAA,eAAgC,QAAQ,SAAS,cAAc,GAAG,QAAQ,SAAS,cAAc,GAAG,SAAA;EAC3G;AACD,SAAO,CAAC,WAAW,YAAY,MAAM,MAAA,CAAO;AAC/C;AAoBD,IAAa8C,SAAQ,CAAC,SAAS,OAAO,CAAE,MAAK;AACzC,QAAM,YAAY,KAAK,aAAa;AACpC,QAAM,QAAQ,KAAK,SAAS;AAC5B,QAAM,SAAS,gBAAgB,SAAS,KAAA;AACxC,MAAI,eAAe;AACnB,MAAI,OAAO,KAAK,iBAAiB,UAAU;AACvC,mBAAe,KAAK;AACpB,QAAI,eAAe,EACf,OAAM,IAAI,MAAM,yCAAyC;EAChE,WACQ,OAAO,KAAK,eAAe,UAAU;AAC1C,QAAI,KAAK,cAAc,QAAQ,OAC3B,OAAM,IAAI,MAAM,4EAA4E,QAAQ,MAAA,eAAqB;AAC7H,UAAM,aAAa,KAAK,aAAa,QAAQ;AAC7C,mBAAe,KAAK,MAAM,aAAa,OAAO,MAAA;EACjD;AACD,QAAM,QAAQ,OAAO,IAAI,CAAC,UAAU;AAEhC,UAAM,aAAa,YAAY,MAAM,CAAA,GAAI,MAAM,CAAA,GAAI;MAAE,OAAO;MAAc;MAAO;MAAW,WAAW;IAAM,CAAA;AAE7G,eAAW,KAAK,MAAM,CAAA,CAAA;AACtB,WAAO;EACV,CAAA;AAED,QAAM,aAAa,OAAO,CAAA;AAC1B,QAAM,QAAQ,CAAC,WAAW,CAAA,CAAG,CAAA;AAC7B,SAAO,MAAM,KAAA,EAAO,IAAI,CAAAhH,OAAK,YAAYA,EAAA,CAAE;AAC9C;AACD,SAAgB,YAAYO,IAAGC,IAAG,UAAU,CAAE,GAAE;AAC5C,QAAM,YAAY,QAAQ,aAAa;AACvC,QAAM,QAAQ,QAAQ,SAAS;AAC/B,QAAM,QAAQ,QAAQ,SAAS;AAC/B,QAAM,YAAY,QAAQ,aAAa;AACvC,MAAI,CAAC,aAAa,QAAQ,EACtB,OAAM,IAAI,MAAM,8DAA8D;AAClF,MAAI,aAAa,QAAQ,EACrB,OAAM,IAAI,MAAM,4DAA4D;AAChF,QAAMqE,MAAK,cAActE,IAAG,KAAA;AAC5B,QAAM,KAAK,cAAcC,IAAG,KAAA;AAE5B,MAAI;AACJ,UAAQ,OAAR;IACI,KAAK;AACD,cAAA,eAA8BqE,KAAI,IAAI,SAAA;AACtC;IACJ,KAAK;AACD,cAAA,eAAgCA,KAAI,IAAI,SAAA;AACxC;IACJ,KAAK;AACD,cAAA,eAA+BA,KAAI,EAAA;AACnC;IACJ;AACI,YAAM,IAAI,MAAM,iBAAiB,KAAA,oCAAyC;EACjF;AACD,MAAI,CAAC,MACD,OAAM,IAAI,MAAM,4CAA4C,KAAA,EAAO;AACvE,MAAI,SAAS;AACb,MAAI,UAAU;AACd,MAAI,QAAQ;AACZ,MAAI,WAAW;AACX,aAAS,KAAK,QAAQ;AACtB,cAAU;AACV,YAAQ,IAAI;EACf,MAEG,UAAS,KAAK,QAAQ;AAE1B,QAAM,UAAU,CAAE;AAClB,WAAS,oBAAoB,SAAS,qBAAqB,OAAO,qBAAqB,OACnF,SAAQ,KAAK,MAAM,iBAAA,CAAkB;AAEzC,SAAO;AACV;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AErID,SAAgB,QAAQ,QAAQ,aAAa;AACzC,MAAI,gBAAgB,cAChB;QAAI,OAAO,WAAW,YAAY,MAAM,MAAA,KAAW,MAAM,MAAA,EACrD,QAAA,WAAyB,MAAA;EAC5B,WAEI,gBAAgB,gBACrB;QAAI,OAAO,WAAW,YAAY,MAAM,MAAA,EACpC,QAAA,aAA2B,MAAA;EAC9B,WAEI,gBAAgB,gBACrB;QAAI,OAAO,WAAW,YAAY,QAAQ,MAAA,EACtC,QAAA,WAA2B,MAAA;EAC9B,WAEI,gBAAgB,kBACrB;QAAI,OAAO,WAAW,YAAY,QAAQ,MAAA,EACtC,QAAAlB,YAA6B,MAAA;EAChC,WAEI,gBAAgB,aACrB;QAAI,OAAO,WAAW,YAAY,MAAM,MAAA,EACpC,QAAA,OAAwB,MAAA;EAC3B,WAEI,gBAAgB,eACrB;QAAI,OAAO,WAAW,YAAY,MAAM,MAAA,EACpC,QAAAD,UAA0B,MAAA;EAC7B,MAGD,OAAM,IAAI,MAAM,gBAAgB,WAAA,8BAAyC,KAAK,UAAU,MAAA,CAAO,EAAE;AAErG,SAAO,QAAQ,YAAY,MAAA,GAAS,WAAA;AACvC;AAOD,SAAgB,gBAAgB,QAAQ,aAAa;AACjD,QAAM1D,KAAI,QAAQ,QAAQ,WAAA;AAC1B,SAAO,YAAYA,EAAA;AACtB;AACD,SAAgB,cAAc,QAAQ,aAAa;AAC/C,MAAI,gBAAgB,QAChB,QAAO,QAAQ,QAAQ,cAAc;AACzC,MAAI,gBAAgB,OAChB,QAAO,QAAQ,QAAQ,aAAa;AACxC,MAAI,gBAAgB,MAChB,QAAO,QAAQ,QAAQ,YAAY;AACvC,QAAM,IAAI,MAAM,yBAAyB,WAAA,GAAc;AAC1D;AACD,IAAa,cAAc,CAAC,WAAW;AACnC,MAAI,OAAO,WAAW,SAClB,QAAO;AACX,MAAI,MAAM,MAAA,EACN,QAAA,YAA4B,MAAA;AAEhC,MAAI,MAAM,MAAA,EACN,QAAA,cAA6B,MAAA;AAEjC,MAAI,QAAQ,MAAA,EACR,QAAA,cAA8B,MAAA;AAElC,QAAM,QAAQ,oBAAoB,MAAA;AAClC,MAAI,MACA,QAAA,cAA6B,KAAA;AACjC,QAAM,QAAQ,oBAAoB,MAAA;AAClC,MAAI,MACA,QAAA,YAA4B,KAAA;AAChC,QAAM,IAAI,MAAM,2BAA2B,KAAK,UAAU,MAAA,CAAO,GAAG;AACvE;AACD,IAAa,cAAc,CAAC,WAAW;AACnC,MAAI,MAAM,MAAA,EACN,QAAA,cAA4B,MAAA;AAEhC,MAAI,MAAM,MAAA,EACN,QAAA,YAA6B,MAAA;AAEjC,MAAI,QAAQ,MAAA,EACR,QAAA,cAA8B,MAAA;AAElC,MAAI,OAAO,WAAW,UAAU;AAC5B,QAAI,OAAO,WAAW,GAAG,EACrB,QAAO;AACX,UAAMA,KAAI,QAAQ,QAAQ,WAAW;AACrC,WAAA,YAA6BA,EAAA;EAChC;AACD,QAAM,QAAQ,oBAAoB,MAAA;AAClC,MAAI,MACA,QAAA,YAA6B,KAAA;AACjC,QAAM,QAAQ,oBAAoB,MAAA;AAClC,MAAI,MACA,QAAA,cAA4B,KAAA;AAChC,QAAM,IAAI,MAAM,2BAA2B,KAAK,UAAU,MAAA,CAAO,GAAG;AACvE;AACD,IAAa,kBAAkB,CAAC,WAAW;AACvC,QAAM,QAAQ,YAAY,MAAA;AAC1B,SAAO,IAAIuE,cAAS,KAAA;AACvB;AAKD,IAAaT,WAAQ,CAAC,WAAW;AAC7B,UAAQ,OAAO,OAAf;IACI,KAAK;eACc,MAAA;AACf;IACJ,KAAK;eACe,MAAA;AAChB;IACJ,KAAK;eACgB,MAAA;AACjB;IACJ;AACI,YAAM,IAAI,MAAM,8BAA8B,OAAO,KAAA,GAAQ;EACpE;AACJ;AACD,IAAa,WAAW,CAAC,cAAc;AACnC,MAAI,CAAC,YAAY,SAAA,EACb,OAAM,IAAI,MAAM,qGAAqG,KAAK,UAAU,SAAA,CAAU,EAAE;AACpJ,MAAI9D;AACJ,MAAI,OAAO,cAAc,SACrB,CAAAA,KAAI,cAAc,SAAA;MAElB,CAAAA,KAAI;AACR,MAAIA,OAAM,OACN,OAAM,IAAI,MAAM,8FAA8F;AAClH8D,EAAAA,SAAM9D,EAAA;AACN,SAAOA;AACV;AAmBD,IAAa,gBAAgB,IAAI,YAAY;AACzC,aAAW,UAAU,SAAS;AAC1B,QAAI,WAAW,OACX;AACJ,QAAI,WAAW,KACX;AACJ,QAAI;AACA,YAAMA,KAAI,SAAS,MAAA;AACnB,aAAO,YAAYA,EAAA;IACtB,QACK;IAAe;EACxB;AACD,SAAO;AACV;AACD,SAAgB,SAAS,KAAK,cAAc;AAMxC,MAAI,EAAE,GAAAoC,IAAG,GAAAC,IAAG,GAAA7B,GAAA,IAAM;AAClB,QAAMyD,YAAU,IAAI,WAAW;AAC/B,MAAI,IAAI,SAAS,QAAQ;AACrB,IAAA7B,MAAK;AACL,IAAAC,MAAK;AACL,IAAA7B,MAAK;EACR;AACD,QAAMmB,OAAM,KAAK,IAAIS,IAAGC,IAAG7B,EAAA;AAC3B,QAAMkB,OAAM,KAAK,IAAIU,IAAGC,IAAG7B,EAAA;AAC3B,MAAIsB,MAAKH,OAAMD,QAAO;AACtB,MAAI9B,KAAIkC;AACR,QAAMZ,KAAIY;AACV,MAAIH,SAAQD,KAER,KAAI,aACA,QAAA,OAAuB,GAAG,GAAG,GAAGuC,SAAAA;MAGhC,QAAA,WAAyB,GAAG,GAAG,GAAGA,SAAAA;AAG1C,QAAMtD,KAAIgB,OAAMD;AAChB,EAAA9B,KAAIsB,MAAK,MAAMP,MAAK,KAAKgB,OAAMD,SAAQf,MAAKgB,OAAMD;AAClD,UAAQC,MAAR;IACI,KAAKS;AACD,MAAAN,OAAMO,KAAI7B,MAAKG,KAAI,KAAK;AACxB;IACJ,KAAK0B;AACD,MAAAP,OAAMtB,KAAI4B,MAAKzB,KAAI,KAAK;AACxB;IACJ,KAAKH;AACD,MAAAsB,OAAMM,KAAIC,MAAK1B,KAAI,KAAK;AACxB;EACP;AACD,MAAI,aACA,QAAA,OAAuBmB,KAAI,KAAKlC,IAAGsB,IAAG+C,SAAAA;MAGtC,QAAA,WAAyBnC,IAAGlC,KAAI,KAAKsB,KAAI,KAAK+C,SAAAA;AAErD;AC/ND,IAAa,kBAAkB,CAAC,MAAM,SAAS;AAC3C,MAAI,KAAK,YACL,MAAK,eAAe,MAAM,UAAU,KAAK,WAAA;AAC7C,MAAI,KAAK,YACL,MAAK,eAAe,MAAM,gBAAgB,KAAK,YAAY,SAAA,CAAU;AAEzE,MAAI,KAAK,WACL,MAAK,aAAa,oBAAoB,KAAK,UAAA;AAC/C,MAAI,KAAK,cACL,MAAK,aAAa,kBAAkB,KAAK,aAAA;AAEhD;ACfD,IAAa,eAAe,CAAC,IAAI,MAAM,iBAAiB;AACpD,QAAM5D,KAAI,SAAS,UAAU,EAAA;AAC7B,MAAI,KAAK,YACL,CAAAA,GAAE,aAAa,eAAe,KAAK,aAAa,SAAA,CAAU;AAE9D,MAAI,KAAK,aACL,CAAAA,GAAE,aAAa,gBAAgB,KAAK,cAAc,SAAA,CAAU;AAEhE,MAAI,KAAK,OACL,CAAAA,GAAE,aAAa,UAAU,KAAK,OAAO,SAAA,CAAU;MAE/C,CAAAA,GAAE,aAAa,UAAU,oBAAoB;AACjD,MAAI,KAAK,QACL,CAAAA,GAAE,aAAa,WAAW,KAAK,QAAQ,SAAA,CAAU;AACrD,MAAI,KAAK,KACL,CAAAA,GAAE,aAAa,QAAQ,KAAK,KAAK,SAAA,CAAU;AAC/C,MAAI,KAAK,KACL,CAAAA,GAAE,aAAa,QAAQ,KAAK,KAAK,SAAA,CAAU;AAC/C,MAAI,cAAc;AACd,UAAML,KAAI,aAAA;AACV,IAAAK,GAAE,YAAYL,EAAA;EACjB;AACD,SAAOK;AACV;AACD,IAAa,iBAAiB,CAAC,MAAM,MAAM,aAAa;AACpD,MAAI,SAAS,KACT,QAAO;AACX,QAAM,SAAS,KAAK;AACpB,MAAI,WAAW,KACX,OAAM,IAAI,MAAM,yBAAyB;AAC7C,QAAM,SAAS,gBAAgB,QAAQ,QAAQ,MAAM;AAErD,MAAI,QAAQ,OAAO,cAAc,IAAI,KAAK,EAAA,EAAI;AAC9C,MAAI,UAAU,KACV,QAAO,QAAQ,KAAK,EAAA;AAExB,MAAI,KAAK,OAAO,YAAY;AACxB,WAAO;MAAE,GAAG;MAAM,aAAa;IAAe;AAC9C,QAAI,CAAC,KAAK,aACN,QAAO;MAAE,GAAG;MAAM,cAAc;IAAG;AACvC,QAAI,CAAC,KAAK,YACN,QAAO;MAAE,GAAG;MAAM,aAAa;IAAG;AACtC,QAAI,CAAC,KAAK,KACN,QAAO;MAAE,GAAG;MAAM,MAAM,KAAK;IAAa;AAC9C,QAAI,CAAC,KAAK,KACN,QAAO;MAAE,GAAG;MAAM,MAAM,KAAK;IAAc;AAC/C,QAAI,CAAC,KAAK,aAAa,KAAK,cAAc,OACtC,QAAO;MAAE,GAAG;MAAM,WAAW;IAAS;AAE1C,QAAI,CAAC,KAAK,QACN,QAAO;MAAE,GAAG;MAAM,SAAS;IAAa;AAC5C,YAAQ,aAAa,KAAK,IAAI,MAAM,MAAM;AACtC,YAAM,MAAM,SAAS,MAAM;AAC3B,UAAI,aAAa,KAAK,uBAAuB;AAC7C,UAAI,KACA,WAAU,KAAK,IAAA;AACnB,aAAO;IACV,CAAA;EACJ,MAEG,OAAM,IAAI,MAAM,2BAA2B,KAAK,EAAA,EAAI;AAExD,QAAM,KAAK,KAAK;AAChB,SAAO,YAAY,KAAA;AACnB,SAAO,QAAQ,KAAK,EAAA;AACvB;AC5DD,IAAa,gBAAgB,CAAC,MAAM,SAAS;AACzC,MAAI,KAAK,UACL,MAAK,aAAa,cAAc,eAAe,MAAM,KAAK,WAAW,IAAA,CAAK;AAE9E,MAAI,KAAK,YACL,MAAK,aAAa,gBAAgB,eAAe,MAAM,KAAK,aAAa,IAAA,CAAK;AAElF,MAAI,KAAK,UACL,MAAK,aAAa,cAAc,eAAe,MAAM,KAAK,WAAW,IAAA,CAAK;AAEjF;;;;;;;;;;;;;;;;;;ACHD,IAAM,qBAAqB,CAAC4C,OAAM;AAC9B,MAAIA,MAAK,KAAKA,MAAK,EACf,QAAO,GAAGA,KAAI,GAAA;AAClB,SAAOA,GAAE,SAAA;AACZ;AAgBD,IAAa,OAAO,CAAC,YAAY,QAAQ,MAAM,oBAAoB;AAC/D,QAAM,OAAO,gBAAgB,QAAQ,QAAQ,eAAA;AAC7C,QAAM,MAAM,OAAO,eAAe,WAAW,aAAa,WAAW,KAAK;CAAI;AAC9E,OAAK,eAAe,MAAM,KAAK,GAAA;AAC/B,SAAO,OAAO,IAAA;AACd,SAAO,WAAW,MAAM,IAAA;AAC3B;AACD,IAAa,aAAa,CAAC,MAAM,SAAS;AACtC,MAAI,KACA,WAAU,MAAM,IAAA;AACpB,MAAI,KACA,iBAAgB,MAAM,IAAA;AAC1B,SAAO;AACV;AAQD,IAAa,eAAe,CAAC,MAAM3D,UAAQ,SAAS;AAChD,OAAK,eAAe,MAAM,MAAMA,SAAO,EAAE,SAAA,CAAU;AACnD,OAAK,eAAe,MAAM,MAAMA,SAAO,EAAE,SAAA,CAAU;AACnD,OAAK,eAAe,MAAM,KAAKA,SAAO,OAAO,SAAA,CAAU;AACvD,MAAI,KACA,WAAU,MAAM,IAAA;AACpB,MAAI,KACA,iBAAgB,MAAM,IAAA;AAC1B,SAAO;AACV;AAWD,IAAa,SAAS,CAACA,UAAQ,QAAQ,MAAM,oBAAoB;AAC7D,QAAMS,KAAI,gBAAgB,QAAQ,UAAU,eAAA;AAC5C,SAAO,aAAaA,IAAGT,UAAQ,IAAA;AAClC;AAUD,IAAa,QAAQ,CAAC2H,WAAU,QAAQ,oBAAoB;AACxD,QAAMlH,KAAI,gBAAgB,QAAQ,KAAK,eAAA;AACvC,SAAO,YAAYA,IAAGkH,SAAA;AACzB;AACD,IAAa,cAAc,CAAC,MAAMA,cAAa;AAC3C,aAAWjH,MAAKiH,UACZ,KAAIjH,GAAE,eAAe,KACjB,MAAK,OAAOA,EAAA;AAGpB,SAAO;AACV;AAUD,IAAa,OAAO,CAACX,QAAM,QAAQ,MAAM,oBAAoB;AACzD,QAAM,SAAS,gBAAgB,QAAQ,QAAQ,eAAA;AAC/C,SAAO,WAAW,QAAQA,QAAM,IAAA;AACnC;AAQD,IAAa,aAAa,CAAC,QAAQA,QAAM,SAAS;AAC9C,SAAO,eAAe,MAAM,MAAMA,OAAK,EAAE,EAAE,SAAA,CAAU;AACrD,SAAO,eAAe,MAAM,MAAMA,OAAK,EAAE,EAAE,SAAA,CAAU;AACrD,SAAO,eAAe,MAAM,MAAMA,OAAK,EAAE,EAAE,SAAA,CAAU;AACrD,SAAO,eAAe,MAAM,MAAMA,OAAK,EAAE,EAAE,SAAA,CAAU;AACrD,MAAI,KACA,WAAU,QAAQ,IAAA;AACtB,MAAI,KACA,eAAc,QAAQ,IAAA;AAC1B,MAAI,KACA,iBAAgB,QAAQ,IAAA;AAC5B,SAAO;AACV;AACD,IAAa,iBAAiB,CAAC,QAAQ,KAAK,SAAS;AACjD,QAAM6B,KAAA,cAA0B,GAAA;AAChC,SAAO,eAAe,MAAM,MAAMA,GAAE,EAAE,EAAE,SAAA,CAAU;AAClD,SAAO,eAAe,MAAM,MAAMA,GAAE,EAAE,EAAE,SAAA,CAAU;AAClD,SAAO,eAAe,MAAM,MAAMA,GAAE,EAAE,EAAE,SAAA,CAAU;AAClD,SAAO,eAAe,MAAM,MAAMA,GAAE,EAAE,EAAE,SAAA,CAAU;AAClD,MAAI,KACA,WAAU,QAAQ,IAAA;AACtB,MAAI,KACA,eAAc,QAAQ,IAAA;AAC1B,MAAI,KACA,iBAAgB,QAAQ,IAAA;AAC5B,SAAO;AACV;AAQD,IAAa,iBAAiB,CAAC0E,KAAI7E,QAAM,SAAS;AAC9C,MAAI,MAAM,OACN,CAAA6E,IAAG,eAAe,MAAM,UAAU,KAAK,MAAA;AAC3C,MAAI,MAAM,KACN,CAAAA,IAAG,eAAe,MAAM,QAAQ,KAAK,IAAA;AACzC,MAAI,MAAM,QACN,CAAAA,IAAG,eAAe,MAAM,WAAW,KAAK,OAAA;AAC5C,MAAI,MAAM,YACN,CAAAA,IAAG,eAAe,MAAM,eAAe,mBAAmB,KAAK,WAAA,CAAY;AAE/E,MAAI,MAAM,WACN,CAAAA,IAAG,eAAe,MAAM,cAAc,mBAAmB,KAAK,UAAA,CAAW;AAE7E,MAAI7E,OACA,CAAA6E,IAAG,cAAc7E;AAErB,MAAI,KACA,WAAU6E,KAAI,IAAA;AAClB,MAAI,KACA,iBAAgBA,KAAI,IAAA;AACxB,SAAOA;AACV;AAWD,IAAa,WAAW,CAAC,eAAe7E,QAAM,QAAQ,MAAM,qBAAqB,wBAAwB;AACrG,QAAM,SAAS,gBAAgB,QAAQ,QAAQ,qBAAqB,OAAO;AAE3E,aAAW,QAAQ,QAAW,QAAW,IAAA;AACzC,QAAMhB,KAAI,gBAAgB,QAAQ,YAAY,mBAAA;AAC9C,EAAAA,GAAE,eAAe,MAAM,QAAQ,aAAA;AAC/B,SAAO,eAAeA,IAAGgB,QAAM,IAAA;AAClC;AASD,IAAa,aAAa,CAAC6E,KAAI,KAAK7E,QAAM,SAAS;AAC/C,MAAI,KAAK;AACL,IAAA6E,IAAG,eAAe,MAAM,KAAK,IAAI,EAAE,SAAA,CAAU;AAC7C,IAAAA,IAAG,eAAe,MAAM,KAAK,IAAI,EAAE,SAAA,CAAU;EAChD;AACD,MAAI7E,OACA,CAAA6E,IAAG,cAAc7E;AAErB,MAAI,MAAM;AACN,cAAU6E,KAAI,IAAA;AACd,QAAI,KACA,iBAAgBA,KAAI,IAAA;AACxB,QAAI,KAAK,OACL,CAAAA,IAAG,eAAe,MAAM,eAAe,KAAK,MAAA;AAChD,QAAI,KAAK,MACL,CAAAA,IAAG,eAAe,MAAM,sBAAsB,KAAK,KAAA;AACvD,UAAM,aAAa,KAAK,cAAc;AACtC,QAAI,CAAC,WACD,CAAAA,IAAG,MAAM,aAAa;EAE7B;AACD,SAAOA;AACV;AAUD,IAAa,OAAO,CAAC7E,QAAM,QAAQ,KAAK,MAAM,oBAAoB;AAC9D,QAAMhB,KAAI,gBAAgB,QAAQ,QAAQ,eAAA;AAC1C,SAAO,WAAWA,IAAG,KAAKgB,QAAM,IAAA;AACnC;AAcD,IAAa,OAAO,CAAC,QAAQmG,WAAQ,SAAS,OAAOR,SAAQ,OAAO,CAAE,MAAK;AACvE,MAAI,CAAC,KAAK,YACN,QAAO;IAAE,GAAG;IAAM,aAAaS,cAAkB,UAAU,QAAQ;EAAG;AAE1E,MAAI,CAAC,KAAK,YACN,QAAO;IAAE,GAAG;IAAM,aAAa;EAAG;AACtC,QAAM9E,KAAI,SAAS,GAAG;AACtB,YAAUA,IAAG,IAAA;AACb,gBAAcA,IAAG,IAAA;AACjB,kBAAgBA,IAAG,IAAA;AAEnB,MAAIvB,KAAI;AACR,SAAOA,KAAI4F,SAAQ;AACf,UAAM,QAAA,cAA0B,GAAG5F,IAAG,OAAOA,EAAA;AAC7C,SAAK,OAAOuB,EAAA;AACZ,IAAAvB,MAAK;EACR;AAED,MAAID,KAAI;AACR,SAAOA,KAAI,OAAO;AACd,UAAM,OAAA,cAAyBA,IAAG,GAAGA,IAAG6F,OAAA;AACxC,SAAK,MAAMrE,EAAA;AACX,IAAAxB,MAAK;EACR;AACD,SAAO,OAAOwB,EAAA;AACd,SAAOA;AACV;AC5QD,IAAa,kBAAkB,CAACuD,QAAO;AACnC,MAAI,CAACA,IACD,OAAM,IAAI,MAAM,yBAAyB;AAC7C,QAAMrF,KAAI;IAAE,GAAGqF,IAAG,GAAG,QAAQ;IAAO,GAAGA,IAAG,GAAG,QAAQ;EAAO;AAC5D,QAAMpF,KAAI;IAAE,GAAGoF,IAAG,GAAG,QAAQ;IAAO,GAAGA,IAAG,GAAG,QAAQ;EAAO;AAC5D,SAAO;IAAE,GAAArF;IAAG,GAAAC;EAAG;AAClB;AACD,IAAa,sBAAsB,CAACoF,KAAI,WAAW;AAC/C,QAAM1E,KAAI,gBAAgB0E,GAAA;AAC1B,SAAA,SAA0B1E,IAAG,MAAA;AAChC;ACbD,IAAakG,UAAS,CAAC,QAAQ,oBAAoB;AAC/C,MAAI,OAAO,oBAAoB,UAAU;AACrC,UAAM,OAAO,OAAO,cAAc,eAAA;AAClC,QAAI,SAAS,KACT;AACJ,SAAK,OAAA;EACR,MAEG,iBAAgB,OAAA;AAEvB;AAKD,IAAaC,SAAQ,CAAC,WAAW;AAC7B,MAAIrH,KAAI,OAAO;AACf,SAAOA,IAAG;AACN,IAAAA,GAAE,OAAA;AACF,IAAAA,KAAI,OAAO;EACd;AACJ;ACjBD,IAAa,aAAa,CAAC,QAAQ,eAAe;AAC9C,MAAI,YAAY;AACZ,cAAU,QAAQ,UAAA;AAClB,oBAAgB,QAAQ,UAAA;EAC3B;AACD,QAAMH,KAAI;IACN,QAAQ,CAAC,oBAAoB;AAAE,MAAAuH,QAAO,QAAQ,eAAA;IAAmB;IACjE,MAAM,CAACrG,QAAM,KAAK,MAAM,oBAAA,KAAkCA,QAAM,QAAQ,KAAK,MAAM,eAAA;IACnF,UAAU,CAAC,eAAeA,QAAM,MAAM,qBAAqB,wBAAA,SAA0C,eAAeA,QAAM,QAAQ,MAAM,qBAAqB,mBAAA;IAC7J,MAAM,CAAC1B,QAAM,MAAM,oBAAA,KAAkCA,QAAM,QAAQ,MAAM,eAAA;IACzE,QAAQ,CAACC,UAAQ,MAAM,oBAAA,OAAoCA,UAAQ,QAAQ,MAAM,eAAA;IACjF,MAAM,CAAC,WAAW,MAAM,oBAAA,KAAkC,WAAW,QAAQ,MAAM,eAAA;IACnF,MAAM,CAAC4H,WAAQ,SAAS,OAAOR,SAAQ,SAAA,KAAuB,QAAQQ,WAAQ,SAAS,OAAOR,SAAQ,IAAA;IACtG,OAAO,CAAC,cAAc,OAAO,cAAc,SAAA;IAC3C,IAAI,QAAQ;AACR,YAAMI,KAAI,OAAO,eAAe,MAAM,OAAO;AAC7C,UAAIA,OAAM,KACN,QAAO;AACX,aAAO,OAAO,WAAWA,EAAA;IAC5B;IACD,IAAI,MAAM,OAAO;AACb,aAAO,eAAe,MAAM,SAAS,MAAM,SAAA,CAAU;IACxD;IACD,IAAI,SAAS;AACT,aAAO;IACV;IACD,IAAI,SAAS;AACT,YAAMA,KAAI,OAAO,eAAe,MAAM,QAAQ;AAC9C,UAAIA,OAAM,KACN,QAAO;AACX,aAAO,OAAO,WAAWA,EAAA;IAC5B;IACD,IAAI,OAAOJ,SAAQ;AACf,aAAO,eAAe,MAAM,UAAUA,QAAO,SAAA,CAAU;IAC1D;IACD,OAAO,MAAM;AACT,aAAO,OAAO,WACV,QAAO,UAAU,OAAA;IAExB;EACJ;AACD,SAAO7G;AACV;;;;;;;;;;;;;;;;;;;AE3BD,IAAa,mBAAmB,CAAC,WAAW,UAAU,CAAE,MAAK;AACzD,QAAM,cAAc,QAAQ,eAAe;AAC3C,QAAM,cAAc,QAAQ,eAAe;AAC3C,QAAM,QAAQ,QAAQ,SAAS;AAC/B,QAAM,MAAM,QAAQ,OAAO;AAC3B,QAAM,iBAAiB,QAAQ,GAAA;AAC/B,MAAI,aAAa;AACjB,QAAM+F,MAAKzG,WAAU,SAAA;AACrB,QAAM,UAAU,IAAI,cAAc,EAC9B,mBAAmB,MACtB,CAAA;AACD,QAAM,MAAM,SAAS,gBAAgB,8BAA8B,KAAK;AACxE,MAAI,KAAK;AACT,MAAI,MAAM,SAAS;AACnB,MAAI,MAAM,WAAW;AACrB,MAAI,MAAM,MAAM;AAChB,MAAI,MAAM,OAAO;AACjB,MAAI,MAAM,QAAQ;AAClB,MAAI,MAAM,SAAS;AACnB,MAAI,MAAM,YAAY;AACtB,MAAI,MAAM,SAAS;AACnB,MAAI,MAAM,gBAAgB;AAC1B,MAAI,MAAM,cAAc;AASxB,QAAMmI,MAAK,aAAa,YAAY,GAAA;AAEpC,MAAI,eAAe;AACnB,QAAM,cAAc,CAACxB,WAAU;AAC3B,UAAM,KAAKA,OAAM,UAAU,SAAA;AAC3B,YAAQ,OAAO,EAAA;AACf,iBAAa;AACb,QAAI,cAAc,aAAa,EAAA,EAAI,GAAG,OAAA;AACtC,aAAS,QAAQ,GAAG,QAAQ,eAAe,IAAI,QAC3C,KAAI,cAAc,gBAAgB,EAAA,IAAM,KAAA,EAAO,GAAG,OAAA;AAEtD,mBAAe;EAClB;AACD,QAAM,eAAe,OAAOA,WAAU;AAClC,UAAM,KAAKA,OAAM,UAAU,SAAA;AAC3B,UAAM3F,MAAK;MAAE,GAAG2F,OAAM;MAAG,GAAGA,OAAM;IAAG;AACrC,UAAM,OAAOA,OAAM;AACnB,QAAIA,OAAM,SAAS,iBAAiB,CAAC,QAAQ,IAAI,EAAA,EAC7C;AAEJ,UAAM,OAAQ,MAAM,QAAQ,KAAKA,OAAM,UAAU,SAAA,GAAY;MAAE,GAAGA,OAAM;MAAS,GAAGA,OAAM;IAAS,CAAA;AACnG,QAAI,KAAK,OAAO,WAAW,GAAG;AAC1B,YAAMF,OAAAA,OAAyB;QAC3B,GAAG,KAAK,OAAO,CAAA;QACf,QAAQ,SAAS,UAAU,cAAc;MAC5C,GAAE,KAAK,EACJ,WAAW,eACd,GAAE,aAAa,EAAA,EAAI;AACpBA,WAAG,MAAM,gBAAgB;AACzBA,WAAG,MAAM,cAAc;IAC1B;AACD,UAAM,YAAY,QAAQ,UAAA;AAC1B,UAAM2B,OAAA,OAA0B;MAAE,GAAGpH;MAAI,QAAQ,SAAS,UAAU,cAAc;IAAa,GAAE,KAAK,EAClG,UACH,GAAE,gBAAgB,EAAA,IAAM,KAAK,OAAO,MAAA,EAAQ;AAC7C,IAAAoH,KAAI,MAAM,gBAAgB;AAC1B,IAAAA,KAAI,MAAM,cAAc;AACxB,kBAAc;AACd,mBAAe,KAAK,OAAO;EAC9B;AACD,WAAS,KAAK,OAAO,GAAA;AACrB,EAAA3B,IAAG,iBAAiB,eAAe,YAAA;AACnC,EAAAA,IAAG,iBAAiB,eAAe,YAAA;AACnC,EAAAA,IAAG,iBAAiB,aAAa,WAAA;AACjC,EAAAA,IAAG,iBAAiB,gBAAgB,WAAA;AACpC,EAAAA,IAAG,iBAAiB,eAAe,CAACE,WAAU;AAC1C,IAAAA,OAAM,eAAA;EACT,CAAA;AACJ;;;;;;;;;;;;;;;;;AC/FD,IAAa0B,YAAW,CAAC,QAAQpD,aAAW;AACxC,QAAMqD,SAAO,OAAO;AACpB,QAAM,OAAO,OAAO,CAAA,EAAG;AACvB,QAAM,OAAO,CAAE;AACf,WAAS,MAAM,GAAG,MAAMA,QAAM,OAAO;AACjC,SAAK,GAAA,IAAO,CAAE;AACd,aAAS,MAAM,GAAG,MAAM,MAAM,MAC1B,MAAK,GAAA,EAAK,GAAA,IAAO,OAAO,GAAA,EAAK,GAAA,IAAOrD;EAE3C;AACD,SAAO;AACV;AACD,SAAgB,aAAa,MAAM,QAAQ,QAAQsD,SAAQ;AACvD,QAAM,oBAAoB,OAAO,IAAI,CAAA7H,OAAK;AAEtC,UAAM,MAAA,OAAmB,QAAQ,MAAMA,GAAE,MAAM,MAAM;AAErD,QAAI;AACJ,QAAI;AACJ,QAAI,KAAK;AACL,oBAAc,OAAO,IAAI,KAAK,WAAW;AACzC,oBAAcA,GAAE;IACnB;AAED,WAAO;MAAE,MAAMA,GAAE;MAAM,OAAO;MAAa,QAAQA,GAAE;IAAO;EAC/D,CAAA;AACD,SAAO6H,QAAO,iBAAA;AACjB;AAMD,UAAiB,cAAc,QAAQ,OAAO;AAE1C,QAAM,kBAAA3C,MAAqC,KAAA;AAC3C,SAAO,SAAS,QAAQ,iBAAA,MAAgC,eAAA,GAAkB,UAAA;AAC7E;AACD,UAAiB,SAAS,QAAQ,QAAQ,SAAS2C,SAAQ,QAAQ;AAC/D,MAAI,CAAC,QAAQ;AACT,UAAM,aAAa,OAAO;AAC1B,UAAM,aAAa,OAAO,CAAA,EAAG;AAC7B,aAAS;MAAE,GAAG,KAAK,MAAM,aAAa,CAAA;MAAI,GAAG,KAAK,MAAM,aAAa,CAAA;IAAI;EAC5E;AACD,QAAMC,WAAU,gBAAgB,QAAQ,MAAA;AAKxC,aAAW,QAAQ,SAAS;AACxB,UAAMxG,SAAQ,aAAa,MAAMwG,UAAS,QAAQD,OAAA;AAClD,UAAM;MAAE;MAAM,OAAAvG;IAAO;EACxB;AACJ;AAQD,IAAa,kBAAkB,CAAC,QAAQ,WAAW;AAC/C,QAAM,UAAU,CAAE;AAClB,QAAMsG,SAAO,OAAO;AACpB,QAAM,OAAO,OAAO,CAAA,EAAG;AACvB,MAAI,CAAC,OACD,UAAS;IACL,GAAG,KAAK,MAAMA,SAAO,CAAA;IACrB,GAAG,KAAK,MAAM,OAAO,CAAA;EACxB;AAEL,WAAS,KAAK,GAAG,KAAKA,QAAM,KACxB,UAAS,KAAK,GAAG,KAAK,MAAM,MAAM;AAC9B,UAAMxE,KAAI;MACN,MAAM;QAAE,GAAG,KAAK,OAAO;QAAG,GAAG,KAAK,OAAO;MAAG;MAC5C,OAAO,OAAO,EAAA,EAAI,EAAA;IACrB;AACD,YAAQ,KAAKA,EAAA;EAEhB;AAEL,SAAO;AACV;AACD,IAAa,aAAa,CAACpB,YAAW;AAClC,MAAIO,KAAI;AACR,MAAIC,KAAI;AACR,MAAI7B,KAAI;AACR,MAAIyD,YAAU;AACd,aAAW9C,UAASU,SAAQ;AACxB,UAAM,MAAMV,OAAM;AAClB,UAAM,cAAcA,OAAM;AAC1B,QAAI,CAAC,IACD;AACJ,QAAI,IAAI,YAAY,EAChB;AACJ,QAAI,gBAAgB,EAChB;AACJ,IAAAiB,MAAM,IAAI,IAAI;AACd,IAAAC,MAAM,IAAI,IAAI;AACd,IAAA7B,MAAM,IAAI,IAAI;AACdyD,kBAAa,IAAI,WAAW,KAAK;EACpC;AACD,QAAM,SAAS;IACX,GAAA7B;IAAG,GAAAC;IAAG,GAAA7B;IACN,MAAM;IACN,OAAO;IACP,SAAA;EACH;AACD,SAAO;AACV;AACD,IAAa,iBAAiB;EAC1B;IAAC;IAAG;IAAG;EAAE;EACT;IAAC;IAAG;IAAG;EAAE;EACT;IAAC;IAAG;IAAG;EAAE;AACZ;AACD,IAAa,sBAAsB;EAC/B;IAAC;IAAG;IAAI;EAAE;EACV;IAAC;IAAI;IAAG;EAAG;EACX;IAAC;IAAG;IAAI;EAAE;AACb;AACD,IAAa,gBAAgB;EACzB;IAAC;IAAG;IAAI;EAAE;EACV;IAAC;IAAI;IAAG;EAAG;EACX;IAAC;IAAG;IAAI;EAAE;AACb;AACD,IAAa,gBAAgBgH,UAAS;EAClC;IAAC;IAAG;IAAG;EAAE;EACT;IAAC;IAAG;IAAG;EAAE;EACT;IAAC;IAAG;IAAG;EAAE;AACZ,GAAE,IAAI,CAAA;AACP,IAAa,sBAAsBA,UAAS;EACxC;IAAC;IAAG;IAAG;EAAE;EACT;IAAC;IAAG;IAAG;EAAE;EACT;IAAC;IAAG;IAAG;EAAE;AACZ,GAAE,IAAI,EAAA;AACP,IAAa,sBAAsBA,UAAS;EACxC;IAAC;IAAG;IAAG;IAAG;IAAG;EAAE;EACf;IAAC;IAAG;IAAI;IAAI;IAAI;EAAE;EAClB;IAAC;IAAG;IAAI;IAAI;IAAI;EAAE;EAClB;IAAC;IAAG;IAAI;IAAI;IAAI;EAAE;EAClB;IAAC;IAAG;IAAG;IAAG;IAAG;EAAE;AAClB,GAAE,IAAI,GAAA;AACP,IAAa,wBAAwBA,UAAS;EAC1C;IAAC;IAAG;IAAG;IAAG;IAAG;EAAE;EACf;IAAC;IAAG;IAAI;IAAI;IAAI;EAAE;EAClB;IAAC;IAAG;IAAI;IAAM;IAAI;EAAE;EACpB;IAAC;IAAG;IAAI;IAAI;IAAI;EAAE;EAClB;IAAC;IAAG;IAAG;IAAG;IAAG;EAAE;AAClB,GAAE,KAAK,GAAA;;;AC7JR,IAAaI,UAAS,CAAC,cAAc,IAAI,uBAAuB,SAAA;AAChE,IAAM,yBAAN,MAA6B;EACzB,SAAS,oBAAI,IAAA;EACb,WAAW,oBAAI,IAAA;EACf;EACA,gBAAgB;EAChB;EACA,YAAY,WAAW;AACnB,QAAI,cAAc,OACd,MAAK,YAAY;QAEjB,MAAK,YAAY;MAAC;MAAO;MAAQ;MAAS;IAAS;AACvD,SAAKC,eAAe,SAAS;EAChC;EACD,eAAejC,KAAI;AACf,SAAKiC,eAAejC;EACvB;EACD,IAAI,KAAK,QAAQ;AACb,SAAKkC,OAAO,IAAI,KAAK,MAAA;EACxB;EACD,MAAMjF,OAAMkF,KAAI;AACZ,SAAKC,SAAS,IAAInF,OAAMkF,GAAA;EAC3B;EACD,IAAI,KAAK,UAAU;AACf,UAAM,QAAQ,KAAKC,SAAS,IAAI,GAAA;AAChC,QAAI,UAAU,OACV,OAAM;AACV,UAAMhI,KAAI,KAAK8H,OAAO,IAAI,GAAA;AAC1B,QAAI9H,OAAM,OACN,QAAOA;AACX,UAAM,eAAe,OAAO;AAC5B,QAAIwD,YAAU,iBAAiB,KAAKqE,YAAAA,EAC/B,iBAAiB,YAAA,EACjB,KAAA;AAEL,QAAIrE,cAAY,UAAaA,UAAQ,WAAW,GAAG;AAC/C,UAAI,aAAa,OACb,QAAO;AACXA,kBAAU,KAAK,UAAU,KAAKyE,aAAAA;AAC9B,WAAKA;AACL,UAAI,KAAKA,kBAAkB,KAAK,UAAU,OACtC,MAAKA,gBAAgB;IAC5B;AACD,WAAOzE;EACV;EACD,SAAS,KAAK,UAAU;AACpB,QAAI,KAAK,IAAI,GAAA,EACT,QAAO,KAAK,IAAI,GAAA;AACpB,UAAMxD,KAAI,KAAK,IAAI,KAAK,QAAA;AACxB,SAAK,IAAI,KAAKA,EAAA;AACd,WAAOA;EACV;EACD,IAAI,KAAK;AACL,WAAO,KAAK8H,OAAO,IAAI,GAAA;EAC1B;AACJ;;;;;;;AC5BD,gBAAuB,OAAO,eAAe,OAAO,CAAE,GAAE;AAGpD,QAAM,gBAAgB,KAAK,iBAAiB;AAC5C,QAAM,aAAa,KAAK,cAAc;AACtC,MAAI,WAAW,KAAK;AACpB,MAAIhB,IAAGhF;AACP,EAAAgF,KAAIhF,KAAI;AAER,MAAI,aAAa,QAAW;AACxB,eAAW,SAAS,cAAc,QAAQ;AAC1C,aAAS,UAAU,IAAI,aAAa;AACpC,QAAI,CAAC,WACD,UAAS,MAAM,UAAU;AAE7B,aAAS,KAAK,YAAY,QAAA;EAC7B;AAED,QAAM,aAAa,MAAM;AACrB,QAAI,aAAa,OACb;AACJ,IAAAgF,KAAI,cAAc;AAClB,IAAAhF,KAAI,cAAc;AAClB,aAAS,QAAQgF;AACjB,aAAS,SAAShF;EACrB;AACD,MAAI9B,KAAI;AACR,QAAM,SAAS,UAAU,aAAA;AACzB,mBAAiBkI,MAAK,QAAQ;AAE1B,QAAIpB,OAAM,KAAKhF,OAAM,EACjB,YAAA;AAEJ,QAAIgF,OAAM,KAAKhF,OAAM,EACjB;AAEJ,IAAA9B,OAAM,SAAS,WAAW,IAAI;AAC9B,QAAIA,OAAM,KACN;AACJ,IAAAA,GAAE,UAAU,eAAe,GAAG,GAAG8G,IAAGhF,EAAA;AAEpC,UAAM,SAAS9B,GAAE,aAAa,GAAG,GAAG8G,IAAGhF,EAAA;AACvC,UAAM;EACT;AACJ;AAsDD,IAAa,UAAU,CAAC,eAAe,OAAO,CAAE,MAAK;AACjD,QAAM,gBAAgB,KAAK,iBAAiB;AAC5C,QAAM,aAAa,KAAK,cAAc;AACtC,QAAM,UAAU,KAAK;AAErB,QAAMgF,KAAI,cAAc;AACxB,QAAMhF,KAAI,cAAc;AAExB,QAAM,WAAW,SAAS,cAAc,QAAQ;AAChD,WAAS,UAAU,IAAI,cAAc;AACrC,MAAI,CAAC,WACD,UAAS,MAAM,UAAU;AAE7B,WAAS,QAAQgF;AACjB,WAAS,SAAShF;AAClB,MAAI9B,KAAI;AACR,MAAI;AACJ,MAAI,KAAK,aACL,UAAS,IAAI,OAAO,KAAK,YAAA;AAG7B,QAAM,YAAY,UAAU;AAC5B,MAAI,CAAC,aAAa,CAAC,WACf,SAAQ,KAAK,yFAAyF;AAE1G,QAAM,OAAO,aAAa,MAAM;AAE5B,QAAIA,OAAM,KACN,CAAAA,KAAI,SAAS,WAAW,IAAI;AAChC,QAAIA,OAAM,KACN;AACJ,IAAAA,GAAE,UAAU,eAAe,GAAG,GAAG8G,IAAGhF,EAAA;AACpC,QAAI;AACJ,QAAI,UAEA,UAAS9B,GAAE,aAAa,GAAG,GAAG8G,IAAGhF,EAAA;AAErC,QAAI,OAEA,QAAO,YAAY;MACf,QAAQ,OAAO,KAAK;MACpB,OAAOgF;MACP,QAAQhF;MACR,UAAU;IACb,GAAE,CAAC,OAAO,KAAK,MAAO,CAAA;AAE3B,QAAI,QAEA,KAAI;AACA,cAAQ,MAAA;IACX,SACMqG,IAAG;AACN,cAAQ,MAAMA,EAAA;IACjB;EAER,GAAE,aAAA;AACH,SAAO;IACH,OAAO,MAAM;AAAE,WAAK,MAAA;IAAU;IAC9B,QAAQ,MAAM;AAAE,WAAK,OAAA;IAAW;IAChC;EACH;AACJ;AACD,IAAa,gBAAgB,CAAC,eAAe,OAAO,CAAE,MAAK;AACvD,QAAM,aAAa,KAAK,cAAc;AAEtC,QAAMrB,KAAI,cAAc;AACxB,QAAMhF,KAAI,cAAc;AAExB,QAAM,kBAAkB,KAAK,aAAa;AAC1C,MAAI,WAAW,KAAK;AACpB,MAAI,CAAC,UAAU;AACX,eAAW,SAAS,cAAc,QAAQ;AAC1C,aAAS,UAAU,IAAI,cAAc;AACrC,aAAS,KAAK,OAAO,QAAA;AACrB,QAAI,CAAC,WACD,UAAS,MAAM,UAAU;EAChC;AACD,WAAS,QAAQgF;AACjB,WAAS,SAAShF;AAClB,QAAMsG,YAAU,MAAM;AAClB,QAAIpI;AAEJ,QAAI,CAACA,IACDA,OAAI,SAAS,WAAW,MAAM,EAAE,oBAAoB,KAAM,CAAA;AAC9D,QAAI,CAACA,IACD,OAAM,IAAI,MAAM,mCAAmC;AACvDA,QAAE,UAAU,eAAe,GAAG,GAAG8G,IAAGhF,EAAA;AACpC,UAAM,SAAS9B,IAAE,aAAa,GAAG,GAAG8G,IAAGhF,EAAA;AACvC,WAAO,cAAc,cAAc;AACnC,QAAI,KAAK,gBACL,MAAK,gBAAgB9B,KAAG8G,IAAGhF,EAAA;AAC/B,WAAO;EACV;AACD,QAAM,UAAU,MAAM;AAClB,QAAI,gBACA;AACJ,QAAI;AACA,eAAS,OAAA;IACZ,SACMoG,IAAG;IAET;EACJ;AACD,QAAMlI,KAAI;IACN;IACA,SAAA;IACA;EACH;AACD,SAAOA;AACV;;;ACrOD,SAAS,oBAAoB4F,KAAI,MAAM,cAAc;AACjD,QAAMrF,KAAIqF,IAAG,aAAa,IAAA;AAC1B,MAAIrF,OAAM,KACN,QAAO;AACX,SAAO,OAAO,SAASA,EAAA;AAC1B;AAaD,IAAa8H,QAAO,CAAC,cAAc,UAAU,CAAE,MAAK;AAChD,QAAM,UAAU,SAAS,cAAc,YAAA;AACvC,MAAI,CAAC,QACD,OAAM,IAAI,MAAM,qCAAqC,YAAA,GAAe;AACxE,QAAM,SAAS,QAAQ,UAAU,CAAC,KAAK,GAAI;AAC3C,QAAM,iBAAiB,QAAQ,kBAAkB;AACjD,QAAM,gBAAgB,QAAQ,iBAAiB;AAC/C,QAAM,oBAAoB,QAAQ,qBAAqB;AAEvD,QAAM,eAAe,QAAQ,gBAAgB;AAC7C,QAAM,UAAU,QAAQ,WAAW;AACnC,QAAM,aAAa,QAAQ,cAAc;AACzC,QAAM,sBAAsB,QAAQ,uBAAuB;AAE3D,QAAM,aAAA,cAAkC,QAAQ,YAAY,QAAQ;AACpE,QAAM,WAAA,cAAgC,QAAQ,UAAU,OAAO;AAC/D,QAAM,gBAAA,cAAqC,QAAQ,eAAe,OAAO;AACzE,QAAM,YAAA,cAAiC,QAAQ,WAAW,QAAQ,eAAe,OAAO;AACxF,QAAM,cAAA,cAAmC,QAAQ,aAAa,QAAQ,YAAY,QAAQ;AAE1F,QAAM,YAAa,QAAQ,aAAa,IAAI,OAAO;AACnD,QAAM,YAAa,QAAQ,aAAa,IAAI,OAAO;AACnD,QAAM,MAAO,QAAQ,WAAW,KAAK,OAAO;AAC5C,QAAM,cAAe,QAAQ,eAAe,IAAI,OAAO;AACvD,QAAM,QAAS,QAAQ,SAAS,oBAAoB,SAAS,SAAS,GAAA,IAAO,OAAO;AACpF,QAAM3B,UAAU,QAAQ,UAAU,oBAAoB,SAAS,UAAU,GAAA,IAAO,OAAO;AACvF,MAAI;AACJ,MAAI,oBAAoB,EACpB,cAAa,IAAI4B,gBAAe;IAC5B,UAAU;IACV,eAAe;EAClB,CAAA;AAEL,UAAQ,QAAQ;AAChB,UAAQ,SAAS5B;AACjB,UAAQ,MAAM,QAAQ,GAAI,QAAQ,OAAO,gBAAA;AACzC,UAAQ,MAAM,SAAS,GAAIA,UAAS,OAAO,gBAAA;AAC3C,QAAM,OAAOA,UAAS;AACtB,QAAM,OAAO,QAAQ;AACrB,QAAM,MAAM,QAAQ,WAAW,IAAI;AACnC,MAAI,CAAC,IACD,OAAM,IAAI,MAAM,kCAAkC;AACtD,MAAI,OAAO,oBAAoB,EAC3B,KAAI,OAAO;AAEf,QAAM,mBAAmB,CAACzD,OAAM,GAAG,KAAK,MAAMA,KAAI,GAAA,CAAI;AACtD,QAAM,cAAc,CAACA,OAAMA,GAAE,QAAQ,cAAA;AACrC,QAAM,cAAc,gBAAgB,mBAAmB;AACvD,MAAI,YAAY;AACZ,WAAO,CAAA,IAAK,OAAO,CAAA,IAAK;AACxB,WAAO,CAAA,IAAK,OAAO,CAAA,IAAK;EAC3B,OACI;AACD,WAAO,CAAA,IAAK;AACZ,WAAO,CAAA,IAAK;EACf;AACD,QAAM,mBAAmB,QAAQ,qBAAqB,CAACsF,OAAKC,SAAO9B,cAAW;AAC1E,QAAI,QAAQ,aAAa,cACrB6B,OAAI,UAAU,GAAG,GAAGC,SAAO9B,SAAAA;SAE1B;AACD6B,YAAI,YAAY;AAChBA,YAAI,SAAS,GAAG,GAAGC,SAAO9B,SAAAA;IAC7B;EACJ;AACD,SAAO,CAAC7F,IAAGC,OAAM;AACb,IAAAD,KAAA,QAAkBA,EAAA;AAClB,IAAAC,KAAA,QAAkBA,EAAA;AAClB,qBAAiB,KAAK,OAAO4F,OAAA;AAE7B,QAAI,YAAY;AAChB,QAAI,eAAe;AACnB,QAAI,KAAA;AACJ,QAAI,UAAU,MAAM,IAAA;AACpB,QAAI,OAAO,CAAC,KAAK,KAAK,CAAA;AACtB,QAAI,UAAU,OAAO,CAAA,IAAK,MAAM,YAAY5F,EAAA,GAAI,KAAA,GAAQ,CAAC,OAAO,KAAK,CAAA;AACrE,QAAI,QAAA;AACJ,QAAI,UAAU,OAAO,CAAA,IAAK,MAAM,YAAYD,EAAA,GAAI,KAAA,GAAQ,KAAK,OAAO,CAAA;AACpE,QAAI,CAAC,oBACD,CAAAC,MAAK;AAET,QAAI,cAAc;AAClB,QAAI,YAAY;AAChB,QAAI,UAAA;AACJ,QAAI,OAAO,KAAK,IAAA;AAChB,QAAI,OAAO,QAAQ,KAAK,IAAA;AACxB,QAAI,OAAO,MAAM,GAAA;AACjB,QAAI,OAAO,MAAM4F,UAAS,GAAA;AAC1B,QAAI,OAAA;AACJ,QAAI,UAAA;AACJ,UAAM,MAAMA,UAAS,MAAM,OAAO,IAAI,CAAC5F;AACvC,UAAM,MAAM,QAAQ,MAAM,OAAO,IAAID;AACrC,UAAM,SAAS;MAAE,GAAG;MAAI,GAAG;MAAI,QAAQ;IAAW;AAClD,QAAI,WACA,cAAa,WAAW,QAAQ,MAAA;AAEpC,QAAI,KAAA;AACJ,QAAI,UAAU,MAAM,IAAA;AAEpB,QAAI,QACA,KAAI,YAAY;AACZ,YAAM,cAAc,IAAI,WAAW;AACnC,UAAIoD,YAAU;AACd,iBAAW,QAAQ,CAAAtD,OAAK;AACpB,cAAM,SAAA,gBAAgC,WAAWsD,SAAAA;iBAClC,KAAKtD,IAAG,EAAE,WAAW,OAAQ,CAAA;AAC5CsD,qBAAW;MACd,CAAA;IACJ,MAAA,UAEkB,KAAK,QAAQ,EAAE,WAAW,UAAW,CAAA;AAI5D,QAAI,cAAc;AACd,UAAI,cAAc;AAElB,UAAI,UAAA;AACJ,UAAI,OAAO,GAAG,KAAK,WAAA;AACnB,UAAI,OAAO,GAAG,KAAK,WAAA;AAEnB,UAAI,OAAO,KAAK,aAAa,CAAA;AAC7B,UAAI,OAAO,KAAK,aAAa,CAAA;AAC7B,UAAI,OAAA;AACJ,UAAI,UAAA;IACP;AAED,QAAI,QAAA;EACP;AACJ;ACvJD,IAAa,gBAAgB,CAAC,OAAO;AACjC,QAAMpD,KAAI,GAAG,IAAI,CAAAR,OAAKA,GAAE,CAAA;AACxB,QAAMS,KAAI,GAAG,IAAI,CAAAT,OAAKA,GAAE,CAAA;AACxB,QAAM,OAAO,KAAK,IAAI,GAAGQ,EAAA;AACzB,QAAM,OAAO,KAAK,IAAI,GAAGA,EAAA;AACzB,QAAM,OAAO,KAAK,IAAI,GAAGC,EAAA;AACzB,QAAM,OAAO,KAAK,IAAI,GAAGA,EAAA;AACzB,QAAM,QAAQ,OAAO;AACrB,QAAM4F,UAAS,OAAO;AACtB,SAAO;IACH,KAAK;MAAE,GAAG;MAAM,GAAG;IAAM;IACzB,KAAK;MAAE,GAAG;MAAM,GAAG;IAAM;IACzB;IAAO,QAAAA;IACP,QAAQ,KAAK,IAAI,OAAOA,OAAA;IACxB,QAAQ,KAAK,IAAI,OAAOA,OAAA;EAC3B;AACJ;AACD,IAAa,kBAAkB,CAAC,WAAW;AACvC,MAAI,CAAC,OAAO,SAAS,OAAO,MAAA,EACxB,QAAO,CAACtG,WAAUA;AAEtB,QAAM,SAAS,OAAO,OAAO,IAAI,GAAG,OAAO,IAAI,CAAA;AAC/C,QAAM,SAAS,OAAO,OAAO,IAAI,GAAG,OAAO,IAAI,CAAA;AAC/C,SAAO,CAACA,YAAW;IACf,GAAG,OAAOA,OAAM,CAAA;IAChB,GAAG,OAAOA,OAAM,CAAA;EACnB;AACJ;AACD,IAAa,kBAAkB,CAAC,WAAW;AACvC,QAAM,SAAS,OAAO,GAAG,GAAG,OAAO,IAAI,GAAG,OAAO,IAAI,CAAA;AACrD,QAAM,SAAS,OAAO,GAAG,GAAG,OAAO,IAAI,GAAG,OAAO,IAAI,CAAA;AACrD,SAAO,CAACA,YAAW;IACf,GAAG,OAAOA,OAAM,CAAA;IAChB,GAAG,OAAOA,OAAM,CAAA;EACnB;AACJ;AACD,IAAa,kBAAkB,CAAC,IAAI,YAAY,UAAU;AAEtD,QAAM,UAAU,CAAE;AAClB,MAAIqI,SAAQ;AACZ,WAAS5H,KAAI,GAAG,IAAI,GAAGA,KAAI,GAAG,IAAI,GAAGA,MAAK,YAAY;AAClD,UAAM,UAAU4H,SAAQ,UAAU;AAClC,YAAQ,KAAK;MAAE,GAAA5H;MAAG,GAAG;MAAG,OAAO;IAAS,CAAA;AACxC,IAAA4H;EACH;AAED,EAAAA,SAAQ;AACR,QAAM,UAAU,CAAE;AAClB,WAAS3H,KAAI,GAAG,IAAI,GAAGA,KAAI,GAAG,IAAI,GAAGA,MAAK,YAAY;AAClD,UAAM,UAAU2H,SAAQ,UAAU;AAClC,YAAQ,KAAK;MAAE,GAAG;MAAG,GAAA3H;MAAG,OAAO;IAAS,CAAA;AACxC,IAAA2H;EACH;AACD,SAAO;IAAE,GAAG;IAAS,GAAG;EAAS;AACpC;ACtDD,IAAa,UAAb,MAAqB;EACjB;EACA;EACA;EACA,cAAc;AACV,SAAK,aAAa,YAAY,IAAA;AAC9B,SAAKC,QAAQ,IAAIC,oBAAA;AACjB,SAAKC,QAAQ,oBAAI,IAAA;EACpB;EACD,IAAI,YAAY;AACZ,WAAO,KAAKA,MAAM;EACrB;EACD,QAAQ;AACJ,SAAKF,MAAM,MAAA;AACX,SAAK,aAAa,YAAY,IAAA;EACjC;EACD,IAAI,QAAQ,MAAM;AACd,SAAKA,MAAM,UAAU,QAAQ,IAAA;EAChC;EACD,eAAe,QAAQ;AACnB,UAAM,UAAU,KAAKA,MAAM,OAAO,MAAA;AAClC,QAAI,QACA,MAAK,aAAa,YAAY,IAAA;AAElC,WAAO;EACV;EACD,QAAQ,QAAQ,MAAM;AAClB,SAAKE,MAAM,IAAI,QAAQ,IAAA;EAC1B;EACD,QAAQ,QAAQ;AACZ,WAAO,KAAKA,MAAM,IAAI,MAAA;EACzB;EACD,QAAQ,QAAQ;AACZ,WAAO,KAAKA,MAAM,IAAI,MAAA;EACzB;EACD,CAAC,YAAY;AACT,WAAO,KAAKF,MAAM,WAAA;EACrB;EACD,CAAC,aAAa;AACV,WAAO,KAAKA,MAAM,QAAA;EACrB;EACD,CAAC,YAAY;AACT,WAAO,KAAKA,MAAM,OAAA;EACrB;EACD,IAAIvH,QAAO,SAAS,WAAW;AAC3B,SAAKuH,MAAM,eAAe,QAAQvH,MAAA;AAClC,SAAK,aAAa,YAAY,IAAA;EACjC;AACJ;ACxCD,IAAa,SAAS,CAAC,eAAe,UAAU,CAAE,MAAK;AACnD,QAAM,WAAY,cAAc,WAAW,SAAa,SAAS,OAAOhC,WAAU,cAAc,MAAA;AAChG,QAAM,WAAW,SAAS,cAAc,QAAQ;AAChD,WAAS,QAAQ,QAAA;AACjB,QAAM0J,MAAK,IAAI,QAAA;AACf,QAAM,SAAS,IAAI,aAAa,UAAU,KAAK;AAC/C,QAAM,OAAO,cAAc,UAAW,EAAE,oBAAoB;IAAE,GAAG;IAAG,GAAG;IAAG,OAAO;IAAG,QAAQ;EAAG,EAAE;AACjG,QAAM,SAAS,OAAO,aAAa,IAAA;AACnC,QAAM9I,KAAI,IAAI,oBAAoB,QAAQ8I,KAAI,OAAA;AAC9C,MAAI,cAAc,mBAAmB,WACjC,cAAa,eAAe,UAAU,EAClC,gBAAgB,CAAC,MAAM,QAAQ;AAC3B,WAAO,eAAe,IAAA;AACtB,IAAA9I,GAAE,gBAAA;AACF,IAAAA,GAAE,KAAA;EACL,EACJ,CAAA;MAID,cAAa,aAAa,UAAU,EAChC,gBAAgB,CAAC,MAAM,QAAQ;AAC3B,WAAO,eAAe,IAAA;AACtB,IAAAA,GAAE,gBAAA;AACF,IAAAA,GAAE,KAAA;EACL,EACJ,CAAA;AAEL,SAAOA;AACV;AA2CD,IAAa,sBAAb,MAAiC;EAC7B;EACA;EACA;EACA,kBAAA;EACA,eAAA;EACA;EACA;EACA,cAAc6B,OAAM,GAAG,IAAA;EACvB;;;;;EAKA,eAAe,CAAE;EACjB;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA,YAAYkH,KAAI,MAAM,UAAU,CAAE,GAAE;AAChC,QAAI,CAAC,KACD,OAAM,IAAI,UAAU,2BAA2B;AACnD,QAAI,OAAO,SAAS,SAChB,OAAM,IAAI,UAAU,uCAAuC,OAAO,IAAA,EAAM;AAC5E,SAAK,gBAAgB,QAAQ;AAC7B,SAAKJ,QAAQ;AACb,SAAKK,gBAAgBD;AACrB,SAAKE,kBAAkB;AACvB,SAAKC,eAAe,QAAQ,SAAS;AACrC,SAAKC,aAAa,QAAQ,SAAS;AACnC,SAAKC,cAAc,QAAQ,cAAc;AACzC,SAAKC,gBAAgB,QAAQ,gBAAgB;AAC7C,SAAK,gBAAgB,QAAQ,iBAAiB;AAC9C,SAAKC,iBAAiB,QAAQ,iBAAiB;AAC/C,SAAK,OAAO;MACR,MAAM;MACN,YAAY;MACZ,MAAM;MACN,UAAU;MACV,GAAG,QAAQ;IACd;AACD,SAAKC,aAAa;MACd,QAAQ;MACR,OAAO;MACP,GAAG,QAAQ;IACd;AACD,SAAKC,aAAa;MACd,QAAQ;MACR,MAAM;MACN,MAAM;MACN,GAAG,QAAQ;IACd;AACD,SAAKC,QAAQ;MACT,YAAY;MACZ,OAAO;MACP,QAAQ;MACR,OAAO;MACP,GAAG,QAAQ;IACd;EACJ;EACD,kBAAkB;AACd,QAAI,KAAKd,MAAM,eAAe,KAAKM,mBAAmB,KAAKS,cACvD,QAAO,KAAKA;AAChB,SAAKT,kBAAkB,KAAKN,MAAM;AAClC,UAAMtG,KAAI,KAAKsH,aAAAA;AACf,SAAKD,gBAAgBrH;AACrB,QAAI,KAAK,cACL,MAAK,cAAA;AACT,WAAOA;EACV;EACD,kBAAkB;AACd,SAAKqH,gBAAgB;EACxB;EACD,eAAe;AAEX,UAAM,QAAQ,KAAK,aAAA;AACnB,UAAM,oBAAA,gBAAyC,KAAA;AAC/C,UAAM,eAAA,gBAAoC,KAAA;AAC1C,UAAMX,MAAK,KAAKC;AAChB,UAAM/H,WAAU,KAAKqI;AAGrB,QAAI,UAAUP,IAAG,IAAI9H;AACrB,QAAI,UAAU8H,IAAG,IAAI9H;AACrB,UAAM,gBAAgB8H,IAAG,SAAU9H,WAAU;AAC7C,UAAM,eAAe8H,IAAG,QAAS9H,WAAU;AAC3C,UAAM,eAAe,KAAK,IAAI,eAAe,YAAA;AAE7C,QAAI,gBAAgB,cAEhB,YAAY,eAAe,IAAM,eAAe;QAIhD,YAAY,gBAAgB,IAAM,eAAe;AAErD,UAAM,kBAAkB,CAACb,QAAO;AAC5B,UAAI,EAAE,GAAAU,IAAG,GAAAC,GAAA,IAAMX;AACf,UAAIU,OAAM,OAAO,kBACb,CAAAA,KAAI;eACCA,OAAM,OAAO,kBAClB,CAAAA,KAAI;AACR,UAAIC,OAAM,OAAO,kBACb,CAAAA,KAAI;eACCA,OAAM,OAAO,kBAClB,CAAAA,KAAI;AACR,MAAAD,KAAIA,KAAI;AACR,MAAAC,MAAK,IAAIA,MAAK;AACd,MAAAD,MAAK;AACL,MAAAC,MAAK;AACL,aAAO;QAAE,GAAAD;QAAG,GAAAC;MAAG;IAClB;AACD,UAAM,kBAAkB,CAACX,QAAO;AAC5B,UAAI,EAAE,GAAAU,IAAG,GAAAC,GAAA,IAAMX;AACf,MAAAU,MAAK;AACL,MAAAC,MAAK;AACL,MAAAD,KAAIA,KAAI;AACR,MAAAC,KAAI,IAAKA,KAAI;AACb,aAAO;QAAE,GAAAD;QAAG,GAAAC;MAAG;IAClB;AAED,UAAM,wBAAwB,CAACX,QAAO;AAClC,UAAI,EAAE,GAAAU,IAAG,GAAAC,GAAA,IAAMX;AACf,MAAAU,KAAIA,KAAIiI,IAAG,IAAI,KAAKO;AACpB,MAAAvI,KAAK,eAAe,KAAKuI,iBAAkBvI;AAC3C,MAAAD,MAAK;AACL,MAAAC,KAAKA,KAAI;AACT,aAAO;QAAE,GAAAD;QAAG,GAAAC;MAAG;IAClB;AACD,WAAO;MACH;MAAmB;MAAiB;MAAiB;MAAuB;MAAc;IAC7F;EACJ;;;;;;;;EAQD,kBAAkB,MAAM,mBAAmB,KAAK,UAAU,iBAAiB;AACvE,UAAM8E,MAAKzG,WAAU,iBAAA;AACrB,QAAI,EAAE,GAAA0B,IAAG,GAAAC,GAAA,IAAM,KAAK,mBAAmB,IAAA;AAGvC,QAAI,OAAO,UAAU;AACjB,YAAM,SAAS8E,IAAG,sBAAA;AAClB,MAAA/E,MAAK,OAAO,QAAQ;AACpB,MAAAC,MAAK,OAAO,SAAS;IACxB,WACQ,OAAO,YAAY;IAE3B,MAEG,OAAM,IAAI,MAAM,mDAAmD;AACvE,QAAI,iBAAiB;AACjB,YAAM,aAAa3B,WAAU,eAAA;AAC7B,YAAM,SAAS,WAAW,sBAAA;AAE1B,MAAA0B,MAAK,OAAO;AACZ,MAAAC,MAAK,OAAO;IACf;AACD,IAAA8E,IAAG,MAAM,OAAO,GAAG/E,EAAA;AACnB,IAAA+E,IAAG,MAAM,MAAM,GAAG9E,EAAA;EACrB;;;;;;EAMD,eAAe;AACX,QAAI,KAAKoI,eAAe,OACpB,QAAA,cAA0B,CAAC,GAAG,KAAKR,MAAM,UAAA,CAAY,CAAA;SAEpD;AACD,UAAI,CAAC,KAAKiB,aACN,MAAKA,eAAAA,cAAkC,CAAC,KAAKT,WAAW,KAAK,KAAKA,WAAW,GAAI,CAAA;AAErF,aAAO,KAAKS;IACf;EACJ;EACD,mBAAmB,WAAW;AAC1B,UAAM,SAAS,KAAK,mBAAmB,SAAA;AACvC,UAAMC,WAAS,KAAK,aAAa;AACjC,UAAM,MAAM;MACR,GAAG,OAAO,IAAIA,SAAO;MACrB,GAAG,OAAO,IAAIA,SAAO;IACxB;AACD,WAAO;EACV;EACD,mBAAmB,WAAWC,SAAQ,OAAO;AACzC,UAAMhB,MAAK,KAAK,gBAAA;AAEhB,UAAM,MAAMA,IAAG,kBAAkB,SAAA;AAEjC,UAAM,SAASA,IAAG,gBAAgB,GAAA;AAClC,QAAIgB,OACA,SAAQ,IAAI,SAAS,UAAU,CAAA,IAAK,UAAU,CAAA,SAAU,IAAI,CAAA,IAAK,IAAI,CAAA,YAAa,OAAO,CAAA,IAAK,OAAO,CAAA,EAAG;AAC5G,WAAO;MACH,GAAG;MACH,GAAG,OAAO;MACV,GAAG,OAAO;IACb;EACJ;;;;;;;EAqBD,aAAazJ,QAAO,SAAS;AACzB,UAAMyI,MAAK,KAAK,gBAAA;AAEhB,UAAM,cAAA,SAA8BzI,QAAO,KAAK,aAAa,MAAA;AAC7D,UAAM6C,KAAI4F,IAAG,gBAAgB,WAAA;AAC7B,WAAOA,IAAG,aAAa5F,EAAA;EAC1B;;;;;;EA0BD,wBAAwB,QAAQ,QAAQ4G,SAAQ,OAAO;AACnD,aAAS,KAAK,mBAAmB,QAAQA,MAAA;AACzC,aAAS,KAAK,mBAAmB,QAAQA,MAAA;AACzC,WAAO;MAAE,GAAG;MAAQ,GAAG;IAAQ;EAClC;EACD,iBAAiB;AACb,WAAO;MACH,QAAQ,kBAAkB,KAAKnB,MAAM,SAAA;MACrC,WAAW;MACX,WAAW;IACd;EACJ;EACD,OAAO;AACH,QAAI,KAAKO,iBAAiB,SACtB,MAAKF,cAAc,MAAA;QAGnB,MAAK,aAAa,MAAA;AAKtB,SAAKe,SAAAA;AACL,QAAI,KAAK,KAAK,KACV,MAAKC,UAAAA;AAET,eAAW,CAACC,IAAG/G,EAAA,KAAM,KAAKyF,MAAM,WAAA,GAAc;AAC1C,UAAI,OAAO,KAAKA,MAAM,QAAQsB,EAAA;AAC9B,UAAI,CAAC,MAAM;AACP,eAAO,KAAK,eAAA;AACZ,aAAKtB,MAAM,QAAQsB,IAAG,IAAA;MACzB;AACD,WAAKC,YAAYD,IAAG/G,IAAG,IAAA;IAE1B;AAED,eAAW5D,UAAQ,KAAK,aACpB,MAAK,SAASA,QAAMA,OAAK,QAAQA,OAAK,KAAA;EAE7C;;;;;;;EAOD,SAASA,QAAM,QAAQ,OAAO;AAC1B,UAAM6B,KAAI,KAAKgJ,wBAAwB7K,OAAK,GAAGA,OAAK,CAAA;AACpD,SAAK8K,qBAAqBjJ,IAAG,QAAQ,KAAA;EACxC;EACD,QAAQ,QAAQ,MAAM;AAClB,SAAKwH,MAAM,QAAQ,QAAQ;MACvB,GAAG,KAAK,eAAA;MACR,GAAG;IACN,CAAA;EACJ;EACD,YAAY;AACR,UAAM,EAAE,QAAQ,MAAA,IAAU,KAAKY;AAE/B,UAAM,QAAQ,KAAKY,wBAAwB;MAAE,GAAG;MAAG,GAAG,OAAO;IAAmB,GAAE;MAAE,GAAG;MAAG,GAAG,OAAO;IAAmB,GAAE,KAAA;AACzH,UAAM,QAAQ,KAAKA,wBAAwB;MAAE,GAAG,OAAO;MAAmB,GAAG;IAAG,GAAE;MAAE,GAAG,OAAO;MAAmB,GAAG;IAAG,GAAE,KAAA;AAEzH,SAAKC,qBAAqB,OAAO,QAAQ,OAAO,KAAA;AAChD,SAAKA,qBAAqB,OAAO,QAAQ,OAAO,KAAA;EACnD;EACD,iBAAiB,SAAS;AAEtB,UAAM,MAAM,KAAKpB,cAAc;AAC/B,QAAI,OAAO,KAAKQ,WAAW,OAAO,MAAM,KAAKA,WAAW;AACxD,QAAI,YAAY,KAAKA,WAAW;AAChC,QAAI,eAAe;AACnB,eAAWxJ,MAAK,SAAS;AACrB,UAAIA,GAAE,MAAM,KAAKA,GAAE,MAAM,EACrB;AACJ,YAAM,MAAM,KAAK,mBAAmBA,IAAG,KAAA;AACvC,YAAMoB,SAAQ,KAAK,YAAYpB,GAAE,CAAA;AACjC,YAAM,QAAQoB,OAAM,SAAA;AACpB,YAAM,UAAU,IAAI,YAAY,KAAA;AAChC,YAAMN,KAAI,IAAI,IAAI,QAAQ,QAAS,KAAK,gBAAgB,IAAK;AAC7D,YAAMC,KAAI,IAAI;AACd,UAAI,SAAS,OAAOD,IAAGC,EAAA;IAC1B;EACJ;EACD,iBAAiB,SAAS;AAEtB,UAAM,MAAM,KAAKiI,cAAc;AAC/B,QAAI,OAAO,KAAKQ,WAAW,OAAO,MAAM,KAAKA,WAAW;AACxD,QAAI,YAAY,KAAKA,WAAW;AAChC,QAAI,eAAe;AACnB,eAAWxJ,MAAK,SAAS;AACrB,YAAM,MAAM,KAAK,mBAAmBA,IAAG,KAAA;AACvC,YAAMoB,SAAQ,KAAK,YAAYpB,GAAE,CAAA;AACjC,YAAM,QAAQoB,OAAM,SAAA;AACpB,YAAM,UAAU,IAAI,YAAY,KAAA;AAChC,YAAMN,KAAI,IAAI,IAAI,QAAQ,QAAQ;AAClC,YAAMC,KAAI,IAAI,IAAI,QAAQ,0BAA0B,QAAQ,2BAA4B,KAAK,gBAAgB;AAC7G,UAAI,SAAS,OAAOD,IAAGC,EAAA;IAC1B;EACJ;EACD,aAAaf,IAAG,UAAU;AACtB,UAAM,oBAAoB,KAAK,gBAAgB;AAC/C,UAAMkD,KAAI,WAAW;MAAE,GAAGlD,GAAE;MAAG,GAAG;IAAG,IAAG;MAAE,GAAGA,GAAE;MAAG,GAAG;IAAG;AACxD,UAAM,MAAM,KAAK,mBAAmBkD,IAAG,KAAA;AACvC,UAAM5D,SAAO,WAAW;MACpB,GAAG;QAAE,GAAG,IAAI;QAAG,GAAG,IAAI,IAAI;MAAmB;MAC7C,GAAG;QAAE,GAAG,IAAI;QAAG,GAAG,IAAI,IAAI;MAAmB;IAChD,IACG;MACI,GAAG;QAAE,GAAG,IAAI;QAAG,GAAG,IAAI,IAAI;MAAmB;MAC7C,GAAG;QAAE,GAAG,IAAI;QAAG,GAAG,IAAI,IAAI;MAAmB;IAChD;AACL,SAAK8K,qBAAqB9K,QAAM,KAAKiK,WAAW,QAAQ,KAAKA,WAAW,OAAO,KAAA;EAClF;EACD,cAAcvJ,IAAG,UAAU;AACvB,UAAMV,SAAO,WACT,KAAK6K,wBAAwB;MAAE,GAAGnK,GAAE;MAAG,GAAG,OAAO;IAAmB,GAAE;MAAE,GAAGA,GAAE;MAAG,GAAG,OAAO;IAAmB,CAAA,IAC7G,KAAKmK,wBAAwB;MAAE,GAAGnK,GAAE;MAAG,GAAG,OAAO;IAAmB,GAAE;MAAE,GAAGA,GAAE;MAAG,GAAG,OAAO;IAAmB,GAAE,KAAA;AACnH,SAAKoK,qBAAqB9K,QAAM,KAAKmK,MAAM,QAAQzJ,GAAE,QAAQ,KAAKyJ,MAAM,QAAQ,IAAI,KAAKA,MAAM,KAAA;EAClG;EACD,WAAW;AACP,UAAMnH,KAAI,KAAKmH;AACf,UAAM,WAAW,KAAK,KAAK;AAC3B,UAAM,eAAe,KAAK,KAAK;AAC/B,UAAM,aAAa,KAAK,KAAK;AAC7B,UAAM,KAAK,KAAK,gBAAA,EAAkB;AAClC,UAAM,EAAE,YAAY,MAAA,IAAUnH;AAE9B,UAAM,YAAA,gBAAiC,IAAI,YAAY,KAAA;AACvD,eAAWtC,MAAK,UAAU,GAAG;AACzB,UAAI,SACA,MAAKqK,cAAcrK,IAAG,IAAA;AAC1B,UAAI,gBAAgBA,GAAE,MAClB,MAAKsK,aAAatK,IAAG,IAAA;IAC5B;AAED,eAAWA,MAAK,UAAU,GAAG;AACzB,UAAI,SACA,MAAKqK,cAAcrK,IAAG,KAAA;AAC1B,UAAI,gBAAgBA,GAAE,MAClB,MAAKsK,aAAatK,IAAG,KAAA;IAC5B;AACD,QAAI,YAAY;AACZ,WAAKuK,iBAAiB,UAAU,EAAE,OAAO,CAAAvK,OAAKA,GAAE,KAAA,CAAM;AACtD,WAAKwK,iBAAiB,UAAU,EAAE,OAAO,CAAAxK,OAAKA,GAAE,KAAA,CAAM;IACzD;EACJ;EACD,YAAY,MAAM,QAAQ,MAAM;AAC5B,QAAI,KAAKqJ,kBAAkB,OACvB,MAAKoB,eAAe,QAAQ,KAAK,QAAQ,KAAK,SAAA;AAGlD,QAAI,KAAKrB,gBAAgB,MACrB,YAAWlG,MAAK,OACZ,MAAKwH,SAASxH,IAAG,KAAK,QAAQ,KAAK,SAAA;EAK9C;EACD,eAAe,MAAM,QAAQ,OAAO;AAChC,UAAM,MAAM,KAAK8F,cAAc;AAC/B,QAAI,UAAA;AACJ,eAAW,CAAC,OAAO,IAAA,KAAS,KAAK,QAAA,GAAW;AACxC,YAAM2B,QAAM,KAAK,mBAAmB,MAAM,KAAA;AAC1C,UAAI,UAAU,EACV,KAAI,OAAOA,MAAI,GAAGA,MAAI,CAAA;AAC1B,UAAI,OAAOA,MAAI,GAAGA,MAAI,CAAA;IACzB;AACD,QAAI,cAAcC,YAAe,MAAA;AACjC,QAAI,YAAY;AAChB,QAAI,OAAA;AACJ,QAAI,UAAA;EACP;EACD,SAAS,aAAa,gBAAgB,gBAAgB;AAClD,UAAM,SAASA,YAAe,YAAY,aAAa,cAAA;AACvD,UAAM,MAAM,KAAK,mBAAmB,WAAA;AACpC,UAAM,SAAS,YAAY,UAAU;AACrC,SAAK5B,cAAc,YAAY,CAC3B;MAAE,GAAG;MAAK;IAAQ,CACrB,GAAE,MAAA;EAUN;EACD,qBAAqB1J,QAAM,QAAQ,OAAOwK,SAAQ,OAAO;AACrD,QAAIA,OACA,SAAQ,IAAIxK,MAAAA;AAChB,UAAM,MAAM,KAAK0J,cAAc;AAC/B,aAAS4B,YAAe,MAAA;AAExB,QAAI,UAAA;AACJ,QAAI,OAAOtL,OAAK,EAAE,GAAGA,OAAK,EAAE,CAAA;AAC5B,QAAI,OAAOA,OAAK,EAAE,GAAGA,OAAK,EAAE,CAAA;AAC5B,QAAI,cAAcsL,YAAe,MAAA;AACjC,QAAI,YAAY;AAChB,QAAI,OAAA;AACJ,QAAI,UAAA;EACP;EACD,IAAI,UAAU;AACV,WAAO,KAAKjC;EACf;EACD,IAAI,eAAe;AACf,WAAO,KAAKK;EACf;EACD,IAAI,eAAe;AACf,WAAO,KAAKA,cAAc;EAC7B;AACJ;;;;;;;;;;;;;;;;;;;;;;;;;;AE5gBD,IAAI;AACA,MAAI,OAAO,WAAW,YAClB,QAAO,OAAO;IACV,GAAG,OAAO;IACV,SAAS;MACL,oBAAA;MACA,QAAA;MACA,OAAA;IACH;EACJ;AAER,QACK;AAEL;;;;;;;;;;;;;;;;;;;;;;;;;;;;AC1BD,IAAM6B,QAAO,KAAK,KAAK;AAavB,IAAaC,cAAa,CACxBC,gCAC6B;AAC7B,MAAI,gCAAgC,KAClC,OAAM,IAAI,MACR,yEAAyE;AAG7E,MAAI,gCAAgC,OAClC,OAAM,IAAI,MACR,8EAA8E;AAIlF,QAAM,MACJ,uCAAuC,2BACnC,8BACA,uCAAuC,oBACrC,4BAA4B,WAAW,IAAI,IAE3C,OAAO,gCAAgC,WACrCC,WAA6B,2BAAA,EAA6B,WAAW,IAAI,IACzE;AACV,MAAI,QAAQ,KAAM,OAAM,IAAI,MAAM,wCAAwC;AAC1E,SAAO;AACR;AASD,IAAaC,gBAAa,CACxBC,eACAC,iBACG;AACH,QAAM,MAAML,YAAW,aAAA;AACvB,SAAO;IACL;IACA,MAAMM,aAAmDC,MAA0B;AACjF,MAAAC,OAAM,KAAK,aAAa,IAAA;IACzB;IACD,KAAKC,YAAuCF,MAA0B;AACpEG,MAAAA,QAAK,KAAK,YAAY,IAAA;IACvB;IACD,KACEC,aACAC,MACM;AACN,MAAAC,MAAK,KAAK,aAAa,IAAA;IACxB;IACD,OACEC,cACAP,MACM;AACN,MAAAQ,QAAO,KAAK,cAAc,IAAA;IAC3B;IACD,gBACEC,cACAC,MACM;AACN,MAAAC,iBAAgB,KAAK,cAAc,IAAA;IACpC;IACD,YAAYF,cAA8BT,MAA0B;AAClE,MAAAY,aAAY,KAAK,cAAc,IAAA;IAChC;IACD,IACEC,aACAC,MACM;AACN,MAAAC,KAAI,KAAK,aAAa,IAAA;IACvB;IACD,OACEC,eACAC,MACM;AACNC,MAAAA,UAAO,KAAK,eAAe,IAAA;IAC5B;IACD,IACEC,YACAF,MACM;AACN,MAAAG,KAAI,KAAK,YAAY,IAAA;IACtB;IACD,UACEC,OACAC,MAKM;AACN,UAAI,KAAK,WAAW,UAAa,iBAAiB,OAChD,QAAO;QAAE,GAAG;QAAM,QAAQ;UAAE,GAAG;UAAc,GAAG;UAAG,GAAG;QAAG;MAAE;AAE7D,MAAAC,WAAU,KAAK,OAAO,IAAA;IACvB;EACF;AACF;AA+BD,IAAMC,UAAS,CAACP,SACdQ,YAAW,KAAK,aAAa,KAAK,SAAA;AAQpC,IAAMC,eAAY,CAChBC,KACAV,OAAoB,CAAE,MACnB,kBACc;AACjB,MAAI,QAAQ,OAAW,OAAM,IAAI,MAAM,eAAe;AAGtD,QAAM,QAAQW,cAAa,GAAA,EAAK,KAAKJ,QAAO,IAAA,GAAO,GAAG,aAAA;AAGtD,QAAM,MAAA;AACN,SAAO;AACR;AAQD,IAAaJ,OAAM,CACjBO,KACAE,MACAZ,OAAoB,CAAE,MACnB;AACHS,EAAAA,aAAU,KAAK,IAAA;AAEf,QAAM,OAAO,CAACI,UAA4B;AACxC,QAAI,UAAA;AACJ,QAAI,IAAIV,MAAI,GAAGA,MAAI,GAAGA,MAAI,QAAQA,MAAI,aAAaA,MAAI,SAAA;AACvD,QAAI,OAAA;EACL;AAED,QAAMW,YAAkC,MAAM,QAAQ,IAAA,IAAQ,OAAO,CAAE,IAAM;AAC7E,aAAWX,SAAO,UAChB,MAAKA,KAAAA;AAGR;AAkCD,IAAMK,cAAa,CACjBO,aACAC,cACY;AACZ,QAAMC,SAAQ,CAACP,QAAkC;AAC/C,QAAI,UAAW,KAAI,YAAY;AAC/B,QAAI,YAAa,KAAI,cAAc;EACpC;AACD,SAAOO;AACR;AAED,IAAMC,UAAS,CACbC,WACAC,UACAC,YACY;AACZ,QAAMJ,SAAQ,CAACP,QAAkC;AAC/C,QAAI,UAAW,KAAI,YAAY;AAC/B,QAAI,SAAU,KAAI,WAAW;AAC7B,QAAI,QAAS,KAAI,UAAU;EAC5B;AACD,SAAOO;AACR;AAQD,IAAaN,gBAAe,CAC1BD,KACAY,QACiB;AACjB,UAAQ,IAAIC,gBAAA;AAEZ,QAAMC,QAAO,IAAI,QAAiC;AAChD,YAAQ,IAAID,gBAAA;AACZ,UAAME,KAAI,IAAI,KAAK,GAAG,GAAA;AACtB,eAAWC,MAAK,IAAK,CAAAA,GAAE,GAAA;AACvB,WAAOf,cAAa,KAAKc,EAAA;EAC1B;AAED,QAAME,OAAM,MAAoB;AAC9B,UAAMF,KAAI,KAAK,IAAA;AACf,WAAOd,cAAa,KAAKc,EAAA;EAC1B;AAED,QAAMR,SAAQ,MAAoB;AAChC,QAAI,QAAQ,OAAW,QAAON,cAAa,GAAA;AAC3C,eAAW,MAAM,IAAI,KAAM,IAAG,GAAA;AAC9B,WAAOA,cAAa,KAAK,GAAA;EAC1B;AAED,SAAO;IAAE,MAAAa;IAAM,KAAAG;IAAK,OAAAV;EAAO;AAC5B;AAQD,IAAaW,qBAAoB,CAC/BlB,KACAmB,QACA9C,SACS;AACT0B,EAAAA,aAAU,KAAK,IAAA;AAGf,MAAI,OAAO,OAAQ,CAAA,EAAI,GAAG,OAAQ,CAAA,EAAI,CAAA;AAEtC,aAAW,CAAE,OAAOqB,EAAA,KAAO,OAAO,QAAA,GAAW;AAC3C,QAAI,QAAQ,KAAK,OAAO,OAAQ;AAChC,UAAM,QAAQ,OAAQ,QAAQ,CAAA;AAC9B,UAAM,MAAM;MACV,IAAIA,GAAE,IAAI,MAAM,KAAK;MACrB,IAAIA,GAAE,IAAI,MAAM,KAAK;IACtB;AACD,UAAM,QAAQ,IAAI,IAAIA,GAAE,KAAK;AAC7B,UAAM,QAAQ,IAAI,IAAI,MAAM,KAAK;AACjC,QAAI,iBAAiB,MAAM,MAAM,GAAG,IAAI,GAAG,IAAI,CAAA;AAC/C,QAAI,iBAAiB,MAAM,MAAM,GAAG,MAAM,GAAG,MAAM,CAAA;EACpD;AACF;AAoBD,IAAa7B,YAAS,CACpBS,KACAqB,eACA/B,OAAoB,CAAE,MACnB;AACHS,EAAAA,aAAU,KAAK,IAAA;AAEf,QAAM,OAAO,CAACuB,OAAgC;AAC5C,QAAI,UAAA;AACJ,QAAI,IAAIC,GAAE,GAAGA,GAAE,GAAGA,GAAE,QAAQ,GAAG1D,KAAA;AAC/B,QAAI,KAAK,YAAa,KAAI,OAAA;AAC1B,QAAI,KAAK,UAAW,KAAI,KAAA;EACzB;AAED,MAAI,MAAM,QAAQ,aAAA,EAChB,YAAW0D,MAAK,cAAe,MAAKA,EAAA;MAEpC,MAAK,aAAA;AAER;AASD,IAAaC,WAAU,CACrBxB,KACAyB,gBAGAnC,OAAoB,CAAE,MACnB;AACHS,EAAAA,aAAU,KAAK,IAAA;AAEf,QAAM,OAAO,CAAC2B,cAAwC;AACpD,QAAI,UAAA;AACJ,UAAM,WAAWF,UAAQ,YAAY;AACrC,UAAM,aAAaA,UAAQ,cAAc;AACzC,UAAM,WAAWA,UAAQ,YAAY3D;AACrC,QAAI,QAAQ2D,UAAQ,GAAGA,UAAQ,GAAGA,UAAQ,SAASA,UAAQ,SAAS,UAAU,YAAY,QAAA;AAC1F,QAAI,KAAK,YAAa,KAAI,OAAA;AAC1B,QAAI,KAAK,UAAW,KAAI,KAAA;EACzB;AAED,QAAM,gBAAgB,MAAM,QAAQ,cAAA,IAAkB,iBAAiB,CAAE,cAAgB;AACzF,aAAWA,aAAW,cACpB,MAAKA,SAAAA;AAER;AASD,IAAalD,SAAQ,CACnB0B,KACA2B,aACAC,OAAoE,CAAE,MACnE;AACH7B,EAAAA,aAAU,KAAK,IAAA;AAEf,QAAM,OAAO,CAAC8B,WAAqB;AAEjC,QAAA,kBAA8BC,MAAAA,EAAO,CAAAC,iBAAgB,KAAKD,QAAM,IAAA;oBAC1CA,MAAAA,EAAOtD,CAAAA,QAAK,KAAKsD,QAAM,IAAA;QACxC,OAAM,IAAI,MAAM,qBAAsB,KAAK,UAAUA,MAAAA,CAAK,EAAG;EACnE;AAED,MAAI,MAAM,QAAQ,WAAA,EAChB,YAAWV,MAAK,YAAa,MAAKA,EAAA;MAElC,MAAK,WAAA;AAER;AAkBD,IAAapC,mBAAkB,CAC7BgB,KACAgC,KACAC,OAAwC,CAAE,MACvC;AACH,QAAM,aAAa,KAAK,QAAQ;AAEhC,cAAY,UAAU,KAAK,KAAK,CAAC;AAEjC,MAAI,IAAI,WAAW,EAAG;AAGtB,aAAW,CAAE,OAAOC,GAAA,KAAQ,IAAI,QAAA,EAAS,SAAeA,KAAI,SAAU,KAAA,EAAQ;AAE9EnC,EAAAA,aAAU,KAAK,IAAA;AAGf,MAAI,KAAK,UAAW,KAAI,YAAY,KAAK;AACzC,MAAI,UAAA;AACJ,MAAI,OAAO,IAAK,CAAA,EAAI,GAAG,IAAK,CAAA,EAAI,CAAA;AAChC,aAAWmC,OAAM,IAAK,KAAI,OAAOA,IAAG,GAAGA,IAAG,CAAA;AAE1C,MAAI,WAAY,KAAI,OAAO,IAAK,CAAA,EAAI,GAAG,IAAK,CAAA,EAAI,CAAA;AAGhD,MACE,KAAK,eACJ,KAAK,gBAAgB,UAAa,KAAK,cAAc,OAEtD,KAAI,OAAA;AAEN,MAAI,KAAK,UACP,KAAI,KAAA;AAEP;AASD,IAAajD,eAAc,CACzBe,KACAgC,KACAG,OAAwC,CAAE,GAC1CC,WACG;AACH,MAAI,IAAI,WAAW,EAAG;AAGtB,aAAW,CAAE,OAAOF,GAAA,KAAQ,IAAI,QAAA,EAAS,SAAeA,KAAI,SAAU,KAAA,EAAQ;AAE9EnC,EAAAA,aAAU,KAAK,IAAA;AAEf,aAAW,CAAE,OAAOmC,GAAA,KAAQ,IAAI,QAAA,GAAW;AACzC,UAAM,QACJ,WAAW,UAAa,QAAQ,OAAO,SAAS,OAAQ,KAAA,IAAU,MAAM,SAAA;AAC1E,QAAI,SAAS,MAAM,SAAA,GAAYA,IAAG,GAAGA,IAAG,CAAA;EACzC;AACF;AAQD,IAAaG,kBAAiB,CAC5BrC,KACAsC,WACiB;AACjB,QAAMC,KAAI,IAAI,aAAA;AACd,SAAO;IACL,GAAGC,OAAM,IAAID,GAAE,IAAIC,OAAM,IAAID,GAAE,IAAIA,GAAE;IACrC,GAAGC,OAAM,IAAID,GAAE,IAAIC,OAAM,IAAID,GAAE,IAAIA,GAAE;EACtC;AACF;AAcD,IAAaE,aAAY,CAACC,aAAkD;AAC1E,QAAM,MAAM,SAAS,cAAc,KAAK;AACxC,MAAI,MAAM,SAAS,UAAU,YAAY;AACzC,SAAO;AACR;AAeD,IAAatD,OAAM,CACjBY,KACA2C,KACAxD,SACG;AACH,WAAS,CAAE;AACX,QAAM,SAAS,KAAK,UAAU;AAC9B,QAAM,YAAY,MAAM,QAAQ,GAAA,IAAO,MAAM,CAAE,GAAK;AACpD,QAAM,SAAS,KAAK,SAAS,KAAK,SAAS,KAAK,gBAAgB;AAChE,MAAI,SAAS,KAAK,SAAS,KAAK,SAAS,KAAK,cAAc;AAC5D,MAAI,CAAC,UAAU,CAAC,OAAQ,UAAS;AAEjCY,EAAAA,aAAU,KAAK,IAAA;AAEf,aAAW6C,SAAO,WAAW;AAC3B,QAAI,UAAA;AACJ,QAAI,YAAYA,MACd,KAAI,IAAIA,MAAI,GAAGA,MAAI,GAAGA,MAAI,QAAQ,GAAG,IAAI,KAAK,EAAA;QAE9C,KAAI,IAAIA,MAAI,GAAGA,MAAI,GAAG,QAAQ,GAAG,IAAI,KAAK,EAAA;AAE5C,QAAI,OACF,KAAI,KAAA;AAEN,QAAI,OACF,KAAI,OAAA;EAEP;AAwBF;AAQD,IAAa/D,UAAS,CACpBmB,KACApB,cACAP,SACG;AACH,MAAA,kBAA8B,YAAA,EAC5B,CAAA0D,iBAAgB,KAAK,cAAc,IAAA;yBACJ,YAAA,EAC/B,CAAAc,aAAY,KAAK,cAAc,IAAA;AAElC;AAED,IAAMA,eAAc,CAClB7C,KACA8C,cACAxD,OAAoB,CAAE,MACnB;AACH,MAAI,QAAQS,aAAU,KAAK,IAAA;AAE3B,QAAM,EAAE,GAAAgD,IAAG,GAAAC,IAAG,QAAQ,QAAAC,QAAA,IAAW;AACjC,QAAM,UAAU,KAAK,SAAS;AAE9B,MAAI,SAAS;EAKZ;AACD,MAAI,UAAA;AACJ,MAAI,OAAOF,GAAE,GAAGA,GAAE,CAAA;AAClB,MAAI,cAAc,OAAO,GAAG,OAAO,GAAGE,QAAO,GAAGA,QAAO,GAAGD,GAAE,GAAGA,GAAE,CAAA;AACjE,MAAI,OAAA;AAEJ,MAAI,SAAS;AACX,YAAQ,MAAM,KACZnD,QAAO;MACL,GAAG;MACH,aAAA,gBAAoC,KAAK,eAAe,UAAU,GAAA;MAClE,WAAA,gBAAkC,KAAK,aAAa,UAAU,GAAA;IAC/D,CAAA,CAAC;AAGJ,UAAM,MAAA;AACN,QAAI,OAAOkD,GAAE,GAAGA,GAAE,CAAA;AAClB,QAAI,OAAO,OAAO,GAAG,OAAO,CAAA;AAC5B,QAAI,OAAA;AACJ,QAAI,OAAOC,GAAE,GAAGA,GAAE,CAAA;AAClB,QAAI,OAAOC,QAAO,GAAGA,QAAO,CAAA;AAC5B,QAAI,OAAA;AAEJ,QAAI,SAAS,KAAKF,GAAE,IAAI,GAAGA,GAAE,CAAA;AAC7B,QAAI,SAAS,KAAKC,GAAE,IAAI,GAAGA,GAAE,CAAA;AAC7B,QAAI,SAAS,MAAM,OAAO,IAAI,GAAG,OAAO,CAAA;AACxC,QAAI,SAAS,MAAMC,QAAO,IAAI,GAAGA,QAAO,CAAA;AAExC,IAAA7D,KAAI,KAAK,QAAQ,EAAE,QAAQ,EAAG,CAAA;AAC9B,IAAAA,KAAI,KAAK6D,SAAQ,EAAE,QAAQ,EAAG,CAAA;AAC9B,IAAA7D,KAAI,KAAK2D,IAAG,EAAE,QAAQ,EAAG,CAAA;AACzB,IAAA3D,KAAI,KAAK4D,IAAG,EAAE,QAAQ,EAAG,CAAA;AACzB,YAAQ,MAAM,IAAA;AACd,UAAM,MAAA;EACP;AACF;AAED,IAAMjB,mBAAkB,CACtB/B,KACAkD,cACA5D,OAAoB,CAAE,MACnB;AACH,QAAM,EAAE,GAAAyD,IAAG,GAAAC,IAAG,WAAAG,WAAA,IAAc;AAC5B,QAAM,UAAU,KAAK,SAAS;AAC9B,MAAI,QAAQpD,aAAU,KAAK,IAAA;AAE3B,MAAI,UAAA;AACJ,MAAI,OAAOgD,GAAE,GAAGA,GAAE,CAAA;AAClB,MAAI,iBAAiBI,WAAU,GAAGA,WAAU,GAAGH,GAAE,GAAGA,GAAE,CAAA;AACtD,MAAI,OAAA;AAEJ,MAAI,SAAS;AAOX,YAAQ,MAAM,KACZnD,QAAO;MACL,GAAG;MACH,aAAA,gBAAoC,KAAK,eAAe,UAAU,GAAA;MAClE,WAAA,gBAAkC,KAAK,aAAa,UAAU,GAAA;IAC/D,CAAA,CAAC;AAEJ,IAAAb,iBAAgB,KAAK;MAAE+D;MAAGI;MAAWH;IAAG,CAAA;AAExC,QAAI,SAAS,KAAKD,GAAE,IAAI,GAAGA,GAAE,CAAA;AAC7B,QAAI,SAAS,KAAKC,GAAE,IAAI,GAAGA,GAAE,CAAA;AAC7B,QAAI,SAAS,KAAKG,WAAU,IAAI,GAAGA,WAAU,CAAA;AAC7C,IAAA/D,KAAI,KAAK+D,YAAW,EAAE,QAAQ,EAAG,CAAA;AACjC,IAAA/D,KAAI,KAAK2D,IAAG,EAAE,QAAQ,EAAG,CAAA;AACzB,IAAA3D,KAAI,KAAK4D,IAAG,EAAE,QAAQ,EAAG,CAAA;AAKzB,YAAQ,MAAM,IAAA;AACd,UAAM,MAAA;EACP;AACF;AAaD,IAAaxE,UAAO,CAClBwB,KACAoD,QACAC,OAA+B,CAAE,MAC9B;AACH,QAAM,UAAU,KAAK,SAAS;AAC9B,QAAMrC,KAAIR,QAAO,KAAK,WAAW,KAAK,UAAU,KAAK,OAAA;AACrDT,EAAAA,aAAU,KAAK,MAAMiB,EAAA;AAErB,QAAM,OAAO,CAACsC,OAAkB;AAC9B,UAAM,EAAE,GAAAP,IAAG,GAAAC,GAAA,IAAMO;AACjB,QAAI,UAAA;AACJ,QAAI,OAAOR,GAAE,GAAGA,GAAE,CAAA;AAClB,QAAI,OAAOC,GAAE,GAAGA,GAAE,CAAA;AAClB,QAAI,SAAS;AACX,UAAI,SAAS,KAAKD,GAAE,GAAGA,GAAE,CAAA;AACzB,UAAI,SAAS,KAAKC,GAAE,GAAGA,GAAE,CAAA;AACzB,MAAA5D,KAAI,KAAK2D,IAAG;QAAE,QAAQ;QAAG,aAAa;MAAS,CAAA;AAC/C,MAAA3D,KAAI,KAAK4D,IAAG;QAAE,QAAQ;QAAG,aAAa;MAAS,CAAA;IAChD;AACD,QAAI,OAAA;EACL;AAED,MAAI,MAAM,QAAQ,MAAA,EAChB,YAAWQ,MAAK,OAAQ,MAAKA,EAAA;MAE7B,MAAK,MAAA;AAER;AAQD,IAAaC,YAAW,CACtBzD,KACA0D,QACAC,OAAoD,CAAE,MACnD;AACH5D,EAAAA,aAAU,KAAK,IAAA;AAEf,QAAM,OAAO,CAAC6D,OAA0B;AACtC,IAAA5E,iBAAgB,KAAA,QAAuBwE,EAAA,GAAI;MAAE,GAAG;MAAM,MAAM;IAAM,CAAA;AAElE,QAAI,KAAK,MACP,CAAAvE,aAAY,KAAA,QAAuBuE,EAAA,GAAI,QAAW;MAAE;MAAK;MAAK;IAAK,CAAA;EAEtE;AAED,MAAI,MAAM,QAAQ,MAAA,EAChB,YAAWA,MAAK,OACd,MAAKA,EAAA;MAGP,MAAK,MAAA;AAER;AA6BD,IAAa7E,QAAO,CAClBqB,KACA6D,QACAC,OAAiB,CAAE,MAChB;AACH/D,EAAAA,aAAU,KAAK,IAAA;AAEf,QAAM,SAAS,KAAK,WAAW,KAAK,cAAc,SAAY,QAAQ;AACtE,QAAM,SAAS,KAAK,WAAW,KAAK,gBAAgB,SAAY,QAAQ;AACxE,QAAM,OAAO,CAACgE,OAAyC;AACrD,UAAMC,KAAI,OAAOT,KAAIA,GAAE,IAAI;AAC3B,UAAMU,KAAI,OAAOV,KAAIA,GAAE,IAAI;AAC3B,QAAI,OAAQ,KAAI,SAASS,IAAGC,IAAGV,GAAE,OAAOA,GAAE,MAAA;AAC1C,QAAI,QAAQ;AACV,UAAI,KAAK,YAAa,KAAI,YAAY,KAAK;AAE3C,UAAI,WAAWS,IAAGC,IAAGV,GAAE,OAAOA,GAAE,MAAA;IACjC;AACD,QAAI,KAAK,SAAS;AAChB,UAAI,UAAA;AACJ,UAAI,OAAOS,IAAGC,EAAA;AACd,UAAI,OAAOV,GAAE,OAAOA,GAAE,MAAA;AACtB,UAAI,OAAA;AACJ,UAAI,OAAO,GAAGA,GAAE,MAAA;AAChB,UAAI,OAAOA,GAAE,OAAO,CAAA;AACpB,UAAI,OAAA;IACL;AACD,QAAI,KAAK,MACP,CAAAtE,aAAY,KAAA,UAAmBsE,EAAA,GAAI,QAAW;MAAE;MAAM;MAAM;MAAM;IAAM,CAAA;EAE3E;AAED,MAAI,MAAM,QAAQ,MAAA,EAChB,YAAWC,MAAK,OACd,MAAKA,EAAA;MAGP,MAAK,MAAA;AAER;AAUD,IAAaU,aAAY,CACvBlE,KACAmE,QACAC,WAAU,GACVC,kBACW;AACX,QAAM1F,SAAO2F,UAAS,KAAKC,QAAMH,UAAS,aAAA;AAC1C,SAAOzF,OAAK;AACb;AAED,IAAa2F,YAAW,CAACtE,KACvBmE,QACAC,WAAU,GAAGC,kBAAuC;AACpD,MAAIE,WAAS,UAAaA,WAAS,QAAQA,OAAK,WAAW,EAAG,QAAA;AAC9D,QAAMhC,KAAI,IAAI,YAAYgC,MAAAA;AAE1B,QAAM,QAAS,gBAAiB,cAAchC,GAAE,OAAO,aAAA,IAAiB6B,WAAU7B,GAAE,QAAQ6B;AAE5F,SAAO;IACE;IACP,QAAQ7B,GAAE,0BAA0BA,GAAE,2BAA2B6B,WAAUA;EAC5E;AACF;AAED,IAAaI,cAAa,CACxBxE,KACAmE,QACAC,WAAU,MAAc;AACxB,QAAMzF,SAAO2F,UAAS,KAAKC,QAAMH,QAAA;AACjC,SAAOzF,OAAK;AAIb;AASD,IAAaiB,aAAY,CACvBI,KACAyE,OACAC,SAMG;AACH3E,EAAAA,aAAU,KAAK,IAAA;AACf,QAAM,gBAAgB,KAAK,iBAAiB;AAC5C,QAAM,QAAQ,KAAK,SAAS;AAC5B,QAAM,SAAS,KAAK;AACpB,QAAM,SAAS,KAAK,UAAU;IAAE,GAAG;IAAG,GAAG;IAAG,OAAO;IAAW,QAAQ;EAAW;AAGjF,QAAM,SAAS,MAAM,IAAI,CAAC4E,OAAM,IAAI,YAAYA,EAAA,CAAE;AAGlD,QAAM,SAAS,OAAO,IAAI,CAAC,OAAO,GAAG,KAAA;AACrC,QAAM,UAAU,OAAO,IACrB,CAAC,OAAO,GAAG,0BAA0B,GAAG,2BAA2B,CAAA;AAIrE,QAAM,WAAW,KAAK,IAAI,GAAG,MAAA;AAC7B,QAAM,cAAc,QAAQ,OAAO,CAAC,aAAaC,WAAU,cAAcA,QAAO,CAAA;AAEhF,MAAI,EAAE,GAAAZ,IAAG,GAAAC,GAAA,IAAM;AAEf,MAAI,OAAO,IAAI,WAAW,OAAO,MAC/B,CAAAD,KAAI,OAAO,SAAS,WAAW;MAC1B,CAAAA,MAAK;AAEZ,MAAIA,KAAI,OAAO,EAAG,CAAAA,KAAI,OAAO,IAAI;AAEjC,MAAI,OAAO,IAAI,cAAc,OAAO,OAClC,CAAAC,KAAI,OAAO,UAAU,cAAc;MAC9B,CAAAA,MAAK;AAEZ,MAAIA,KAAI,OAAO,EAAG,CAAAA,KAAI,OAAO,IAAI;AAEjC,MAAI,UAAU,MACZ,KAAI,eAAe;MAEnB,KAAI,eAAe;AAErB,aAAW,CAAE,OAAOzF,MAAAA,KAAU,MAAM,QAAA,GAAW;AAC7C,QAAI,SAASA,QAAMwF,IAAGC,EAAA;AACtB,IAAAA,MAAK,QAAS,KAAA;EACf;AACF;AAQD,IAAaY,oBAAmB,CAC9B7E,KACA8E,QACAC,SAKG;AACH,QAAM,EAAE,OAAA,IAAW;AACnB,QAAM,EAAE,QAAQ,QAAQ,OAAO,MAAK,IAAK;AAEzC,QAAM,QAAQ,OAAOR,WAAS,WAAW,CAAEA,MAAM,IAAGA;AAEpDxE,EAAAA,aAAU,KAAK,IAAA;AAEf,MAAI,KAAA;AACJ,MAAI,UAAU,OAAO,GAAG,OAAO,CAAA;AAC/B,MAAI,YAAY;AAChB,MAAI,eAAe;AACnB,QAAM,UAAU,OAAO,QAAQ;AAC/B,QAAM,UAAU,OAAO,SAAS;AAGhC,QAAM,SAAS,MAAM,IAAI,CAAC4E,OAAM,IAAI,YAAYA,EAAA,CAAE;AAClD,QAAM,UAAU,OAAO,IACrB,CAAC,OAAO,GAAG,0BAA0B,GAAG,wBAAA;AAE1C,QAAM,cAAc,QAAQ,OAAO,CAAC,aAAaC,WAAU,cAAcA,QAAO,CAAA;AAEhF,MAAIX,KAAI;AACR,MAAI,SAAS,SAAU,CAAAA,KAAI,UAAU,cAAc;WAC1C,SAAS,SAChB,CAAAA,KAAI,OAAO,SAAS;AAGtB,aAAW,CAAE,OAAOzF,MAAAA,KAAU,MAAM,QAAA,GAAW;AAC7C,QAAIwF,KAAI;AACR,QAAI,UAAU,SAAU,CAAAA,KAAI,UAAU,OAAQ,KAAA,EAAQ,QAAQ;aACrD,UAAU,QAAS,CAAAA,KAAI,OAAO,QAAQ,OAAQ,KAAA,EAAQ;AAC/D,QAAI,SAASxF,QAAMwF,IAAGC,EAAA;AACtB,IAAAA,MAAK,QAAS,KAAA;EACf;AAED,MAAI,QAAA;AACL;AC3/BD,IAAae,SAAQ,CAACC,OAAqB;AACzC,MAAI,OAAOC,OAAM,SAAU,QAAO;AAClC,MAAI,EAAE,OAAOA,IAAI,QAAO;AACxB,MAAI,EAAE,OAAOA,IAAI,QAAO;AACxB,MAAI,EAAE,OAAOA,IAAI,QAAO;AACxB,MAAI,EAAE,UAAUA,IAAI,QAAO;AAC3B,MAAI,EAAE,WAAWA,IAAI,QAAO;AAC5B,MAAIA,GAAE,UAAU,MAAO,QAAO;AAC9B,SAAO;AACR;AAED,IAAaC,SAAQ,CAACF,OAAqB;AACzC,MAAI,OAAOC,OAAM,SAAU,QAAO;AAClC,MAAI,EAAE,OAAOA,IAAI,QAAO;AACxB,MAAI,EAAE,OAAOA,IAAI,QAAO;AACxB,MAAI,EAAE,OAAOA,IAAI,QAAO;AACxB,MAAI,EAAE,WAAWA,IAAI,QAAO;AAC5B,MAAI,EAAE,UAAUA,IAAI,QAAO;AAC3B,MAAIA,GAAE,UAAU,OAAQ,QAAO;AAC/B,SAAO;AACR;AAeD,IAAaE,uBAAsB,CAACH,OAA4B;AAC9D,MAAI,OAAOC,OAAM,SAAU,OAAM,IAAI,UAAU,+CAAgD,OAAOA,EAAA,EAAI;AAC1G,MAAI,EAAE,OAAOA,MAAK,OAAOA,MAAK,OAAOA,IAAI;AACzC,MAAI,EAAE,UAAUA,IACd,KAAIA,GAAE,KAAK,KAAKA,GAAE,KAAK,KAAKA,GAAE,KAAK,EACjC,CAAAA,GAAE,OAAO;WACAA,GAAE,IAAI,OAAOA,GAAE,KAAK,OAAOA,GAAE,KAAK,IAC3C;MAEA,CAAAA,GAAE,OAAO;AAGb,MAAI,EAAE,WAAWA,IACf,CAAAA,GAAE,QAAQ;AAEZ,SAAOA;AACR;AAED,IAAaG,uBAAsB,CAACJ,OAA4B;AAC9D,MAAI,EAAE,OAAOC,MAAK,OAAOA,MAAK,OAAOA,IAAI;AACzC,MAAI,EAAE,UAAUA,IACd,KAAIA,GAAE,KAAK,KAAKA,GAAE,KAAK,KAAKA,GAAE,KAAK,EACjC,CAAAA,GAAE,OAAO;WACAA,GAAE,IAAI,OAAOA,GAAE,KAAK,IAC7B;MAEA,CAAAA,GAAE,OAAO;AAGb,MAAI,EAAE,WAAWA,IACf,CAAAA,GAAE,QAAQ;AAEZ,SAAOA;AACR;AAED,IAAaI,WAAU,CAACL,OAAuB;AAC7C,MAAI,OAAOC,OAAM,SAAU,QAAO;AAClC,MAAI,EAAE,OAAOA,IAAI,QAAO;AACxB,MAAI,EAAE,OAAOA,IAAI,QAAO;AACxB,MAAI,EAAE,OAAOA,IAAI,QAAO;AACxB,MAAI,EAAE,UAAUA,IAAI,QAAO;AAC3B,MAAI,EAAE,WAAWA,IAAI,QAAO;AAC5B,MAAIA,GAAE,UAAU,MAAO,QAAO;AAC9B,MAAIA,GAAE,UAAU,QAAS,QAAO;AAChC,SAAO;AACR;AAED,IAAaK,eAAc,CAACN,OAA2B;AACrD,MAAI,OAAOC,OAAM,SAAU,QAAO;AAClC,MAAI,OAAOA,OAAM,SAAU,QAAO;AAClC,MAAIF,OAAME,EAAA,EAAI,QAAO;AACrB,MAAII,SAAQJ,EAAA,EAAI,QAAO;AACvB,MAAIC,OAAMD,EAAA,EAAI,QAAO;AACrB,SAAO;AACR;ACzFD,SAAgBM,sBAAqBC,IAAWC,IAAWC,SAAQ,GAAG;AACpE,MAAI,OAAO;AACX,MAAI,QAAQ;AACZ,MAAI3C,KAAID,IAAG;AACT,WAAQC,KAAID;AACZ,YAAQ4C,UAAS5C,KAAIC;EACtB,OAAM;AACL,WAAQA,KAAID;AACZ,YAAS,OAAQ4C;EAClB;AACD,QAAM,UAAU,QAAQ,IAAI,QAAQ;AACpC,QAAM,WAAW,QAAQ,IAAI,OAAO;AACpC,MAAI,KAAK,IAAI,IAAA,IAAQ,KAAK,IAAI,KAAA,GAAQ;AACpC,UAAMnC,KAAI;AACV,YAAQ;AACR,WAAOA;EACR;AACD,SAAO;IAAE;IAAM;IAAO;IAAS;EAAU;AAC1C;AAED,IAAaoC,yBAAwB,CAACC,QAAqB;AACzD,QAAM,iBAAiB,CAACC,OAAc;AACpC,UAAM,MAAM,KAAK,MAAMvE,EAAA,EAAG,SAAS,EAAA;AACnC,WAAO,IAAI,UAAU,IAAI,MAAM,MAAM;EACtC;AAED,MAAI,OAAO,IAAK,eAAe,IAAI,CAAA,CAAE,GAAK,eAAe,IAAI,CAAA,CAAE,GAAK,eAAe,IAAI,CAAA,CAAE;AACzF,MAAI,OAAO,IAAI,UAAU,eAAe,IAAI,UAAU,IACpD,SAAQ,eAAe,IAAI,KAAA;AAE7B,SAAO;AACR;AAED,SAAgBwE,eAAcC,QAAe;AAC3C,EAAApB,SAAQA,SAAQ;AAChB,MAAIA,SAAQ,EAAG,SAAQ,IAAI,KAAK,IAAIA,MAAA,KAAU;AAC9C,SAAOA;AACR;;;;;;;;;;;;;;;;;;;ACnBD,IAAaqB,iBAAc,CAAgBC,QAAUC,QAAuD;AAC1G,UAAQvB,OAAM,MAAd;IACE,KAAK;AACH,aAAO;QACL,GAAGA;QACH,SAASwB,KAAIxB,OAAM,WAAW,OAAO,KAAKA,MAAA,IAAS;MACpD;IACH,KAAK;AACH,aAAO;QACL,GAAGA;QACH,SAASwB,IAAIxB,OAAM,WAAW,GAAIA,MAAA;MACnC;EACJ;AACF;AAwBD,IAAayB,qBAAkB,CAACC,QAAYC,WAA2E;AACrH,MAAI,OAAO;AACX,MAAI,OAAO,OAAO,WAAW,YAC3B,QAAO3B,OAAM,IAAKA,OAAM,IAAI,OAAO;WAC1B,OAAO,OAAO,UAAU,YACjC,QAAO,OAAO,QAAQA,OAAM;WACnB,OAAO,OAAO,UAAU,aAAa;AAC9C,QAAI,OAAO,QAAQ,EAAG,OAAM,IAAI,UAAU,wCAAwC;AAClF,WAAO,OAAO;EACf,MACC,OAAM,IAAI,UAAU,+DAA+D;AAErF,SAAO;IACL,GAAGA;IACH,GAAG4B,eAAc5B,QAAO,MAAM,GAAG;EAClC;AACF;AAED,IAAM4B,iBAAgB,CAACC,KAAUT,QAAeU,aAA8B;AAC5E,MAAI,IAAI,SAAS,UAEf;QAAI9B,SAAQ,EAAG,CAAAA,SAAQ;aACdA,SAAQ,EAAG,CAAAA,SAAQ;EAAE,WAG1BA,SAAQ,IAAK,CAAAA,SAAQ;WAChBA,SAAQ,EAAG,CAAAA,SAAQ;AAE9B,SAAOA;AACR;AAED,IAAM+B,kBAAiB,OAAO,OAAO;EACnC,GAAG;EAAG,GAAG;EAAG,GAAG;EAAG,SAAS;EAAG,MAAM;EAAY,OAAO;AACxD,CAAA;AAID,SAAgBC,iBAAcC,WAAmBC,UAA+B,CAAE,GAAO;AACvF,SAAOC,eAAAA,QAAsB,SAAA,GAAY,OAAA;AAC1C;AAGD,SAAgBC,WAAQC,QAAeC,UAAwC,CAAE,GAAO;AACtF,EAAAtC,SAAQA,OAAM,YAAA;AAEd,MAAIA,OAAM,WAAW,OAAO,EAAG,OAAM,IAAI,MAAM,sBAAsB;AACrE,MAAIA,OAAM,WAAW,OAAO,EAAG,OAAM,IAAI,MAAM,sBAAsB;AAErE,MAAIA,OAAM,WAAW,GAAG,EACtB,QAAOgC,iBAAchC,QAAO,OAAA;AAE9B,MAAIA,OAAM,WAAW,IAAI,EACvB,KAAI;AACF,IAAAA,SAAQuC,YAAWvC,MAAA;EACpB,SAAQ,OAAO;AACd,QAAI,OAAO,QAAQ,mBAAmB,YAAa,CAAAA,SAAQ,QAAQ;AACnE,QAAI,OAAO,QAAQ,mBAAmB,YAAa,QAAO,QAAQ;AAClE,UAAM;EACP;AAEH,MAAIA,WAAU,cAAe,QAAO+B;AACpC,MAAI,OAAOS,sBAAsBxC,MAAA,MAAY,YAC3C,QAAOgC,iBAAcQ,sBAAsBxC,MAAA,GAAmB,OAAA;AAGhE,MAAIA,OAAM,WAAW,MAAM,GAAG;AAC5B,UAAM,MAAMyC,cAAgBzC,MAAA;AAC5B,WAAOmC,eAAY,KAAK,OAAA;EACzB;AAED,MAAI,CAACnC,OAAM,WAAW,MAAM,EAC1B,KAAI;AACF,IAAAA,SAAA,UAAkBA,QAAO,KAAK;EAC/B,SAAQ,OAAO;AACd,QAAI,QAAQ,eACV,CAAAA,SAAQ,QAAQ;QAEhB,OAAM;EAET;AAGH,MAAI;AAEF,UAAM,MAAM0C,qBAAoB1C,MAAA;AAChC,QAAI,QAAQ,OAAQ,QAAO2C,YAAS,GAAA;AACpC,WAAOC,cAAW,GAAA;EACnB,SAAQ,OAAO;AACd,QAAI,QAAQ,eAAgB,QAAO,QAAQ;AAC3C,UAAM;EACP;AAEF;AAED,IAAaC,eAAc,CAAChB,QAAqB;AAC/C,QAAMiB,OAAMF,cAAW,GAAA;AACvB,MAAI,MAAM,OAAQE,KAAI,CAAA,OAAUA,KAAI,CAAA,KAAQA,KAAI,CAAA;AAChD,MAAI,aAAaA,QAAOA,KAAI,YAAY,UAAaA,KAAI,UAAU,IACjE,QAAO,MAAOA,KAAI,OAAA;AAEpB,SAAO;AACP,SAAO;AACR;AAED,IAAaC,iBAAc,CAAClB,QAAqB;AAC/C,QAAM,MAAMmB,cAAa,GAAA;AACzB,SAAOhC,uBAAsB,GAAA;AAC9B;AAaD,SAASmB,eAA2Bc,KAAYC,iBAAoC,CAAE,GAAK;AACzF,MAAI,OAAO,QAAQ,eAAe,QAAQ,MACxC;QAAI,eAAe,eAAgB,QAAO,eAAe;EAAe;AAE1E,QAAM,YAAY,eAAe,UAAU;AAG3C,cACE,yBAAyB,IAAI,GAAG,GAAG,KAAK,GAAG,GAC3C,yBAAyB,IAAI,GAAG,GAAG,KAAK,GAAG,GAC3C,yBAAyB,IAAI,GAAG,GAAG,KAAK,GAAG,GAC3C,YAAa,IAAI,SAAS,GAAI,OAAO,CAAC;AAGxC,MAAI,UACF,QAAOC,QAAO,IAAI,IAAI,KAAK,IAAI,IAAI,KAAK,IAAI,IAAI,KAAM,IAAI,SAAS,CAAA;MAEnE,QAAOC,YAAS,IAAI,GAAG,IAAI,GAAG,IAAI,IAAI,IAAI,SAAS,KAAK,GAAA;AAE3D;AAED,IAAaR,gBAAa,CAACS,gBAAiD;AAI1E,MAAI,OAAO,gBAAgB,SACzB,QAAOjB,WAAQ,aAAa,EAAE,QAAQ,MAAO,CAAA;AAQ/C,MAAI7B,OAAM,WAAA,EACR,QAAOqC,cAAWT,eAAYM,cAAgB,WAAA,GAAc,EAAE,QAAQ,MAAO,CAAA,CAAC;AAEhF,QAAM,MAAM;AACZa,EAAAA,SAAM,GAAA;AACN,MAAI,IAAI,SAAS,WAAY,QAAO;AACpC,SAAO;IACL,GAAG,IAAI,IAAI;IACX,GAAG,IAAI,IAAI;IACX,GAAG,IAAI,IAAI;IACX,UAAU,IAAI,WAAW,KAAK;IAC9B,MAAM;IACN,OAAO;EACR;AACF;AAmBD,IAAaC,oBAAiB,CAACC,uBAAgD,aAAa,GAAGC,cAAY,KAAKC,WAAU,MAAiB;AAEzI,MAAI,OAAO,0BAA0B,UACnC;QAAI,sBAAsB,WAAW,IAAI,EACvC,yBAAwB,iBAAiB,SAAS,IAAA,EAAM,iBAAiB,qBAAA,EAAuB,KAAA;EACjG;AAEH,QAAM,MAAM,WAAW,qBAAA;AACvB,MAAI,aAAa,EAAG,OAAM,IAAI,UAAU,yCAAyC;AACjF,MAAID,cAAY,EAAG,OAAM,IAAI,UAAU,wCAAwC;AAC/E,MAAIC,WAAU,EAAG,OAAM,IAAI,UAAU,sCAAsC;AAC3E,QAAM,SAAS,aAAa,KAAK,KAAK,EAAE,QAAQ;AAChD,SAAO;IACL,GAAG;IACH,GAAG;IACH,GAAGD;IACM,SAAAC;IACT,MAAM;IACN,OAAO;EACR;AACF;AAaD,IAAaf,cAAW,CAACgB,gBAA+C;AACtE,MAAI,OAAO,gBAAgB,SACzB,QAAOvB,WAAQ,aAAa,EAAE,QAAQ,KAAM,CAAA;AAQ9C,MAAI7B,OAAM,WAAA,EACR,QAAOoC,YAASR,eAAYM,cAAgB,WAAA,GAAc,EAAE,QAAQ,KAAM,CAAA,CAAC;AAG7E,QAAM,MAAM;AACZa,EAAAA,SAAM,GAAA;AACN,MAAI,IAAI,SAAS,SAAU,QAAO;AAClC,SAAO;IACL,GAAG,IAAI,IAAI;IACX,GAAG,IAAI,IAAI;IACX,GAAG,IAAI,IAAI;IACX,UAAU,IAAI,WAAW,KAAK;IAC9B,MAAM;IACN,OAAO;EACR;AACF;AAED,IAAaA,WAAQ,CAACzB,QAAa;AACjC,QAAM,EAAE,GAAA+B,IAAG,GAAAzH,IAAG,GAAA4D,IAAG,SAAA2D,UAAS,OAAO,KAAA,IAAS;AAC1C,MAAI,UAAU,MAAO,OAAM,IAAI,MAAM,uCAAwC,KAAA,EAAQ;AACrF,MAAI,SAAS,WACX,aACE,WAAWE,IAAG,UAAU,GAAG,GAC3B,yBAAyBzH,IAAG,GAAG,KAAK,GAAG,GACvC,yBAAyB4D,IAAG,GAAG,KAAK,GAAG,GACvC,MAAM;AACJ,QAAI,OAAO2D,aAAY,SACrB,QAAO,yBAAyBA,UAAS,GAAG,KAAK,SAAS;EAE7D,CAAA;WACM,SAAS,SAClB,aACE,WAAWE,IAAG,cAAc,GAAG,GAC/B,WAAWzH,IAAG,cAAc,GAAG,GAC/B,WAAW4D,IAAG,cAAc,GAAG,GAC/B,MAAM;AACJ,QAAI,OAAO2D,aAAY,SACrB,QAAO,WAAWA,UAAS,cAAc,SAAS;EAErD,CAAA;MAEH,OAAM,IAAI,MAAM,uDAAwD,IAAA,EAAO;AAElF;AAED,IAAaG,kBAAe,CAACC,IAAiBC,IAAiBC,YAAkC,cAAc;AAC7G,EAAA7F,KAAIwE,YAASxE,EAAA;AACb,EAAAC,KAAIuE,YAASvE,EAAA;AACb,QAAM,WAAWD,GAAE,WAAW;AAC9B,QAAM,eAAeyC,sBAAqBzC,GAAE,GAAGC,GAAE,GAAG,CAAA;AACpD,QAAM,cAAc,cAAc,WAAW,aAAa,OAAO,aAAa;AAC9E,QAAM,cAAcA,GAAE,IAAID,GAAE;AAC5B,QAAM,gBAAgBC,GAAE,IAAID,GAAE;AAC9B,QAAM,mBAAmBC,GAAE,WAAW,KAAK;AAE3C,SAAO,CAAC6F,WAA8B;AACpC,aAAS,MAAM,MAAA;AACf,QAAIL,KAAI,YAAY,QAAQ,GAAG,KAAK,IAAI,WAAA,CAAY;AACpD,QAAI,cAAc,EAAG,CAAAA,KAAIzF,GAAE,IAAIyF;QAC1B,CAAAA,KAAIzF,GAAE,IAAIyF;AAEf,UAAMzH,KAAI,YAAY,QAAQ,GAAG,WAAA;AACjC,UAAM4D,KAAI,YAAY,QAAQ,GAAG,aAAA;AACjC,UAAM3D,KAAI,YAAY,QAAQ,GAAG,eAAA;AACjC,WAAO+G,QAAOhC,eAAcyC,EAAA,GAAIzH,KAAIgC,GAAE,GAAG4B,KAAI5B,GAAE,GAAG/B,KAAI,QAAA;EACvD;AACF;AAUD,SAAgB+G,QAAO,MAAM,KAAK,MAAM,GAAGM,cAAY,KAAKC,WAAU,GAAc;AAClF,QAAMQ,MAAiB;IACrB,MAAM;IACN,OAAO;IACP,GAAG;IACH,GAAG;IACH,GAAGT;IACM,SAAAC;EACV;AACDJ,EAAAA,SAAM,GAAA;AACN,SAAO;AACR;AAED,SAAgBF,YAAS,MAAM,KAAK,MAAM,KAAKK,cAAY,IAAIC,WAAU,KAAkB;AACzF,QAAMS,MAAmB;IACvB,MAAM;IACN,OAAO;IACP,GAAG;IACH,GAAG;IACH,GAAGV;IACM,SAAAC;EACV;AACDJ,EAAAA,SAAM,GAAA;AACN,SAAO;AACR;AAMD,SAAgBZ,qBAAoBL,QAAoB;AACtD,MAAIrC,OAAM,WAAW,MAAM,EAAG,OAAM,IAAI,MAAM,yBAAyB;AACvE,MAAI,CAACA,OAAM,WAAW,MAAM,EAAG,OAAM,IAAI,MAAM,6BAA6B;AAE5E,QAAM,QAAQA,OAAM,QAAQ,GAAA;AAC5B,QAAM,MAAMA,OAAM,QAAQ,GAAA;AAC1B,MAAI,MAAM,MAAO,OAAM,IAAI,MAAM,sCAAsC;AAEvE,QAAM,OAAOA,OAAM,UAAU,QAAQ,GAAG,GAAA;AACxC,MAAI,QAAQ,KAAK,MAAM,QAAA;AACvB,MAAI,MAAM,SAAS,EAAG,OAAM,IAAI,MAAM,+BAAgC,MAAM,MAAA,SAAgB;AAE5F,MAAI,iBAAiB;AACrB,MAAI,MAAO,CAAA,EAAI,SAAS,GAAG,EAAG,kBAAiB;AAC/C,MAAI,MAAO,CAAA,EAAI,SAAS,GAAG,KAAK,MAAO,CAAA,EAAI,SAAS,GAAG,EAAG,kBAAiB;AAE3E,QAAM,gBAAgB,CAACoE,IAAWC,QAAgB;AAChD,QAAI/D,OAAM,OAAQ,QAAO;AACzB,QAAIA,GAAE,SAAS,GAAG,EAChB,QAAO,OAAO,WAAWA,GAAE,UAAU,GAAGA,GAAE,SAAS,CAAA,CAAE,IAAI;AAE3D,QAAIA,GAAE,SAAS,KAAK,KAAK,QAAQ,EAC/B,CAAAA,KAAIA,GAAE,UAAU,GAAGA,GAAE,SAAS,CAAA;AAGhC,UAAM,KAAK,OAAO,WAAWA,EAAA;AAC7B,QAAI,QAAQ,EAAG,QAAO,KAAK;AAC3B,QAAI,QAAQ,EAAG,QAAO;AACtB,WAAO,KAAK;EACb;AAED,QAAM,aAAa,CAAC8D,IAAWC,QAAgB;AAC7C,QAAI/D,OAAM,OAAQ,QAAO;AACzB,QAAIA,GAAE,SAAS,GAAG,GAAG;AACnB,YAAMgE,OAAK,OAAO,WAAWhE,GAAE,UAAU,GAAGA,GAAE,SAAS,CAAA,CAAE;AACzD,UAAI,QAAQ,EAAG,QAAOgE,OAAK;AAC3B,aAAOA;IACR;AACD,QAAIhE,GAAE,SAAS,KAAK,KAAK,QAAQ,EAC/B,QAAO,OAAO,WAAWA,GAAE,UAAU,GAAGA,GAAE,SAAS,CAAA,CAAE;AAEvD,UAAM,KAAK,OAAO,WAAWA,EAAA;AAC7B,WAAO;EACR;AAGD,MAAI,MAAM,SAAS,GACjB;QAAI,MAAO,CAAA,MAAQ,IAEjB,SAAQ;MAAE,MAAO,CAAA;MAAK,MAAO,CAAA;MAAK,MAAO,CAAA;MAAK,MAAO,CAAA;IAAK;EAC3D;AAEH,MAAI,eACF,QAAO6C,QACL,cAAc,MAAO,CAAA,GAAK,CAAA,GAC1B,cAAc,MAAO,CAAA,GAAK,CAAA,GAC1B,cAAc,MAAO,CAAA,GAAK,CAAA,GAC1B,cAAc,MAAO,CAAA,KAAO,QAAQ,CAAA,CAAE;MAIxC,QAAOC,YACL,WAAW,MAAO,CAAA,GAAK,CAAA,GACvB,WAAW,MAAO,CAAA,GAAK,CAAA,GACvB,WAAW,MAAO,CAAA,GAAK,CAAA,GACvB,WAAW,MAAO,CAAA,KAAO,QAAQ,CAAA,CAAE;AAGxC;AAOD,SAAgBJ,cAAauB,KAA0B;AACrD,MAAI,OAAO,QAAQ,UAAU;AAC3B,UAAM,cAAcnC,WAAQ,KAAK,EAAE,QAAQ,MAAO,CAAA;AAElD,WAAOY,cAAa,WAAA;EACrB;AACD,QAAMJ,cAAW,GAAA;AAEjB,QAAM,MAAA,QAAgB;IAAE,GAAG,IAAI;IAAG,GAAG,IAAI;IAAG,GAAG,IAAI;EAAG,CAAA;AACtD,SAAO;IAAE,GAAG;IAAK,QAAQ,IAAI,WAAW,OAAO,MAAM;EAAK;AAC3D;;;;;;;;;;;;;;;;;;ACrdD,IAAa4B,oBAAmB;AAEhC,IAAalB,WAAQ,CAACmB,QAAe;AACnC,QAAM,EAAE,GAAA1E,IAAG,GAAApD,IAAG,GAAAiH,IAAG,SAAAF,UAAS,OAAO,KAAA,IAAS;AAC1C,MAAI,UAAU,QAAS,OAAM,IAAI,MAAM,yCAA0C,KAAA,EAAQ;AAEzF,MAAI,SAAS,WACX,aACE,YAAY3D,IAAG,GAAG,GAClB,MAAM;AACJ,QAAI,OAAOpD,OAAM,SACf,QAAO,yBAAyBA,IAAG,GAAG6H,mBAAkB,GAAG;EAE9D,GACD,MAAM;AACJ,QAAI,OAAOZ,OAAM,SACf,QAAO,yBAAyBjH,IAAG,GAAG,KAAK,GAAG;EAEjD,GACD,YAAa+G,YAAW,GAAI,SAAS,CAAC;WAE/B,SAAS,SAElB,aACE,YAAY3D,IAAG,GAAG,GAClB,YAAYpD,IAAG,GAAG,GAClB,YAAYiH,IAAG,GAAG,GAClB,YAAa,IAAI,WAAW,GAAI,SAAS,CAAC;MAG5C,OAAM,IAAI,MAAM,uDAAwD,IAAA,EAAO;AAElF;AAmBD,SAAgBzB,eAAYuC,KAAYC,iBAAwC,CAAE,GAAS;AACzF,MAAI,OAAO,QAAQ,eAAe,QAAQ,MACxC;QAAI,eAAe,eAAgB,QAAO,eAAe;EAAe;AAG1E,QAAM,eAAe,eAAe,UAAU;AAG9C,cACE,YAAY,IAAI,GAAG,GAAG,GACtB,YAAY,IAAI,GAAG,GAAG,GACtB,yBAAyB,IAAI,GAAG,GAAG,KAAK,GAAG,GAC3C,YAAa,IAAI,SAAS,GAAI,OAAO,CAAC;AAGxC,MAAI,aACF,QAAOxB,UAAO,IAAI,GAAG,IAAI,IAAIqB,mBAAkB,IAAI,IAAI,KAAM,IAAI,SAAS,CAAA;MAE1E,QAAOpB,UAAS,IAAI,GAAG,IAAI,GAAG,IAAI,GAAI,IAAI,SAAS,CAAA;AAEtD;AAQD,IAAapB,mBAAgB,CAACC,WAAmB2C,UAAiC,CAAE,MAAY;AAC9F,SAAOzC,eAAAA,UAAwB,SAAA,GAAY,OAAA;AAC5C;AAED,IAAM0C,oBAAkC,OAAO,OAAO;EACpD,GAAG;EAAG,GAAG;EAAG,GAAG;EAAG,SAAS;EAAG,MAAM;EAAY,OAAO;AACxD,CAAA;AAkBD,SAAgBzC,WAAQC,QAAeuC,UAAiC,CAAE,GAAS;AACjF,EAAA5E,SAAQA,OAAM,YAAA;AACd,MAAIA,OAAM,WAAW,GAAG,EACtB,QAAOgC,iBAAchC,QAAO,OAAA;AAE9B,MAAIA,WAAU,cAAe,QAAO8E;AACpC,MAAI,OAAOtC,sBAAsBxC,MAAA,MAAY,YAC3C,QAAOgC,iBAAcQ,sBAAsBxC,MAAA,GAAmB,OAAA;AAGhE,MAAIA,OAAM,WAAW,MAAM,GAAG;AAC5B,UAAM,MAAM+E,QAAUC,qBAAoBhF,MAAA,CAAM;AAChD,UAAMiF,QAAAA,UAAkB;MAAE,GAAG,IAAI;MAAG,GAAG,IAAI;MAAG,GAAG,IAAI;IAAG,CAAA;AACxD,WAAO9C,eAAY8C,OAAK,OAAA;EACzB;AAED,MAAI,CAACjF,OAAM,WAAW,MAAM,KAAK,CAACA,OAAM,WAAW,QAAQ,EACzD,KAAI;AACF,UAAM,YAAA,UAAsBA,QAAO,OAAO;AAC1C,IAAAA,SAAQ;EACT,SAAQ,OAAO;AACd,QAAI,QAAQ,eACV,CAAAA,SAAQ,QAAQ;QAEhB,OAAM;EAET;AAEH,QAAM,KAAK,IAAIkF,cAASlF,MAAA;AACxB,QAAM,MAAM,GAAG;AACf,SAAOmC,eAAY,KAAK,OAAA;AACzB;AAcD,IAAaS,cAAa,CAACuC,gBAA+C;AACxE,MAAI,OAAO,gBAAgB,SACzB,QAAOvC,YAAWR,WAAQ,aAAa,EAAE,QAAQ,KAAM,CAAA,CAAC;AAE1DkB,EAAAA,SAAM,WAAA;AACN,MAAI,YAAY,SAAS,WAAY,QAAO;AAC5C,SAAO;IACL,OAAO;IACP,MAAM;IACN,GAAG,YAAY;IACf,GAAG,YAAY,IAAIkB;IACnB,GAAG,YAAY,IAAI;IACnB,SAAS,YAAY;EACtB;AACF;AAGD,IAAa7B,cAAW,CAACwC,gBAA6C;AACpE,MAAI,OAAO,gBAAgB,SACzB,QAAOxC,YAASP,WAAQ,aAAa,EAAE,QAAQ,KAAM,CAAA,CAAC;AAExD,QAAM,MAAM;AACZkB,EAAAA,SAAM,GAAA;AAIN,MAAI,IAAI,SAAS,SAAU,QAAO;AAGlC,SAAO;IACL,GAAG,IAAI;IACP,GAAG,IAAI,IAAIkB;IACX,GAAG,IAAI,IAAI;IACX,SAAU,IAAI,WAAW;IACzB,MAAM;IACN,OAAO;EACR;AACF;AAED,IAAMY,eAAY,CAACX,QAAsB;AACvC,QAAM3B,OAAMF,YAAW,GAAA;AACvB,SAAO;IACL,GAAGE,KAAI;IACP,GAAGA,KAAI;IACP,GAAGA,KAAI;IACP,OAAOA,KAAI;EACZ;AACF;AAoBD,IAAaD,iBAAc,CAAC4B,KAAY,YAAY,MAAc;AAChEnB,EAAAA,SAAM,GAAA;AACN,QAAM,EAAE,GAAAvD,IAAG,GAAApD,IAAG,GAAAiH,IAAG,SAAAF,SAAA,IAAY;AAC7B,MAAI,MAAM;AACV,UAAQ,IAAI,MAAZ;IACE,KAAK;AACH,YAAM,UAAW3D,KAAI,KAAK,QAAQ,SAAA,CAAU,KAAOpD,GAAE,QAAQ,SAAA,CAAU,IAAMiH,GAAE,QAAQ,SAAA,CAAU;AACjG;IACF,KAAK;AACH,YAAM,SAAU7D,GAAE,QAAQ,SAAA,CAAU,KAAOpD,KAAI6H,mBAAkB,QAAQ,SAAA,CAAU,KAAOZ,KAAI,KAAK,QAAQ,SAAA,CAAU;AACrH;EACH;AACD,MAAI,OAAOF,aAAY,eAAeA,aAAY,EAChD,QAAO,MAAOA,SAAQ,QAAQ,SAAA,CAAU;AAE1C,SAAO;AACP,SAAO;AACR;AAED,IAAaX,iBAAc,CAAC0B,QAAuB;AACjD,QAAM,OAAOW,aAAU,GAAA;AACvB,QAAM,MAAA,UAAkB,IAAA;AACxB,SAAOpE,uBAAsB,GAAA;AAC9B;AAoED,IAAauC,kBAAiB,CAACC,uBAAgD6B,UAAS,GAAG5B,cAAY,KAAKC,WAAU,MAAmB;AAEvI,MAAI,OAAO,0BAA0B,UACnC;QAAI,sBAAsB,WAAW,IAAI,EACvC,yBAAwB,iBAAiB,SAAS,IAAA,EAAM,iBAAiB,qBAAA,EAAuB,KAAA;EACjG;AAEH,MAAID,cAAY,EAAG,OAAM,IAAI,UAAU,wCAAwC;AAC/E,MAAI4B,UAAS,EAAG,OAAM,IAAI,UAAU,qCAAqC;AACzE,QAAM,MAAM,WAAW,qBAAA;AACvB,QAAM,SAAS,aAAa,KAAK,KAAK,EAAE,QAAQ;AAChD,MAAI3B,WAAU,EAAG,OAAM,IAAI,UAAU,sCAAsC;AAE3E,SAAO;IACL,GAAGD;IACH,GAAG4B;IACH,GAAG;IACM,SAAA3B;IACT,MAAM;IACN,OAAO;EACR;AACF;AAWD,IAAarC,iBAAc,CAAkBC,QAAUC,QAAuD;AAC5G,UAAQvB,OAAM,MAAd;IACE,KAAK;AACH,aAAO;QACL,GAAGA;QACH,SAASwB,KAAIxB,OAAM,WAAW,OAAO,KAAKA,MAAA,IAAS;MACpD;IACH,KAAK;AACH,aAAO;QACL,GAAGA;QACH,SAASwB,IAAIxB,OAAM,WAAW,GAAIA,MAAA;MACnC;EACJ;AACF;AAED,IAAa6D,kBAAe,CAACyB,IAAmBC,IAAmBvB,YAAkC,cAAc;AACjH,EAAA7F,KAAIwE,YAASxE,EAAA;AACb,EAAAC,KAAIuE,YAASvE,EAAA;AAIb,QAAM,WAAWD,GAAE,WAAW;AAC9B,QAAM,eAAeyC,sBAAqBzC,GAAE,GAAGC,GAAE,GAAG,CAAA;AACpD,QAAM,cAAc,cAAc,WAAW,aAAa,OAAO,aAAa;AAC9E,QAAM,iBAAiBA,GAAE,IAAID,GAAE;AAC/B,QAAM,gBAAgBC,GAAE,IAAID,GAAE;AAC9B,QAAM,mBAAmBC,GAAE,WAAW,KAAK;AAI3C,SAAO,CAAC6F,WAAgC;AACtC,aAAS,MAAM,MAAA;AACf,QAAIL,KAAI,YAAY,QAAQ,GAAG,KAAK,IAAI,WAAA,CAAY;AACpD,QAAI,cAAc,EAAG,CAAAA,KAAIzF,GAAE,IAAIyF;QAC1B,CAAAA,KAAIzF,GAAE,IAAIyF;AAEf,UAAMjH,KAAI,YAAY,QAAQ,GAAG,cAAA;AACjC,UAAMoD,KAAI,YAAY,QAAQ,GAAG,aAAA;AACjC,UAAM3D,KAAI,YAAY,QAAQ,GAAG,eAAA;AAEjC,WAAO+G,UAAOpD,KAAI5B,GAAE,GAAGxB,KAAIwB,GAAE,GAAGgD,eAAcyC,EAAA,GAAIxH,KAAI,QAAA;EACvD;AACF;AAED,SAAgB+G,UAAOM,cAAY,KAAK4B,UAAS,KAAK,MAAM,KAAK3B,WAAU,GAAgB;AACzF,QAAM8B,MAAmB;IACvB,MAAM;IACN,OAAO;IACP,GAAG/B;IACH,GAAG4B;IACH,GAAG;IACM,SAAA3B;EACV;AACDJ,EAAAA,SAAM,GAAA;AACN,SAAO;AACR;AAUD,IAAaF,YAAW,CAACqC,IAAWvE,IAAWwE,IAAWhC,WAAU,MAAqB;AACvF,QAAMiC,MAAqB;IACzB,OAAO;IACP,MAAM;IACN,SAAAjC;IACA,GAAA3D;IAAG,GAAApD;IAAG,GAAAiH;EACP;AACDN,EAAAA,SAAM,GAAA;AACN,SAAO;AACR;ACjZD,IAAasC,iBAAgB,CAACC,WAA2B;AACvD,MAAI,OAAO,WAAW,GAAG,EACvB,QAAA7D,eAA+B,QAAQ,IAAA;AAGzC,MAAI,OAAOQ,sBAAsB,MAAA,MAAa,YAC5C,QAAAR,eAA+BQ,sBAAsB,MAAA,GAAoB,IAAA;AAE3E,MAAI,OAAO,WAAW,IAAI,GAAG;AAC3B,UAAMJ,YAAU,iBAAiB,SAAS,IAAA,EAAM,iBAAiB,MAAA,EAAQ,KAAA;AACzE,QAAIA,UAAQ,WAAW,KAAKA,cAAY,KAAM,OAAM,IAAI,MAAM,qBAAsB,MAAA,EAAS;AAC7F,WAAOwD,eAAcxD,SAAAA;EACtB;AACD,WAAS,OAAO,YAAA;AAChB,MAAI,OAAO,WAAW,MAAM,EAC1B,QAAA0D,WAAwB,QAAQ,EAAE,QAAQ,KAAM,CAAA;AAElD,MAAI,OAAO,WAAW,MAAM,EAC1B,QAAA1D,SAAyB,QAAQ,EAAE,QAAQ,KAAM,CAAA;AAEnD,MAAI,OAAO,WAAW,QAAQ,EAC5B,QAAA2D,WAA0B,QAAQ,EAAE,QAAQ,KAAM,CAAA;AAGpD,QAAM,IAAI,MAAM,oFAAqF,MAAA,GAAU;AAChH;AAcD,IAAaxD,cAAa,CAACsD,QAAgBG,aAA8B;AACvE,MAAI,OAAO,WAAW,IAAI,GAAG;AAC3B,UAAM5D,YAAU,iBAAiB,SAAS,IAAA,EAAM,iBAAiB,MAAA,EAAQ,KAAA;AACzE,QAAIA,UAAQ,WAAW,KAAKA,cAAY,MAAM;AAC5C,UAAI,OAAO,aAAa,YAAa,QAAO;AAC5C,YAAM,IAAI,MAAM,0BAA2B,MAAA,GAAU;IACtD;AACD,WAAOG,YAAWH,SAAAA;EACnB;AACD,MAAI,OAAOI,sBAAsB,MAAA,MAAa,YAC5C,QAAOA,sBAAsB,MAAA;AAE/B,SAAO;AACR;AAED,IAAaA,wBAAuB;EAClC,aAAa;EACb,gBAAgB;EAChB,QAAQ;EACR,cAAc;EACd,SAAS;EACT,SAAS;EACT,UAAU;EACV,SAAS;EACT,kBAAkB;EAClB,QAAQ;EACR,cAAc;EACd,SAAS;EACT,aAAa;EACb,aAAa;EACb,cAAc;EACd,aAAa;EACb,SAAS;EACT,kBAAkB;EAClB,YAAY;EACZ,WAAW;EACX,QAAQ;EACR,YAAY;EACZ,YAAY;EACZ,iBAAiB;EACjB,YAAY;EACZ,aAAa;EACb,aAAa;EACb,eAAe;EACf,kBAAkB;EAClB,cAAc;EACd,cAAc;EACd,WAAW;EACX,cAAc;EACd,gBAAgB;EAChB,iBAAiB;EACjB,iBAAiB;EACjB,iBAAiB;EACjB,cAAc;EACd,YAAY;EACZ,eAAe;EACf,WAAW;EACX,cAAc;EACd,aAAa;EACb,eAAe;EACf,eAAe;EACf,WAAW;EACX,aAAa;EACb,cAAc;EACd,QAAQ;EACR,aAAa;EACb,QAAQ;EACR,SAAS;EACT,eAAe;EACf,YAAY;EACZ,WAAW;EACX,aAAa;EACb,UAAU;EACV,SAAS;EACT,SAAS;EACT,YAAY;EACZ,iBAAiB;EACjB,aAAa;EACb,gBAAgB;EAChB,aAAa;EACb,cAAc;EACd,aAAa;EACb,wBAAwB;EACxB,aAAa;EACb,cAAc;EACd,aAAa;EACb,eAAe;EACf,iBAAiB;EACjB,gBAAgB;EAChB,kBAAkB;EAClB,kBAAkB;EAClB,eAAe;EACf,QAAQ;EACR,aAAa;EACb,SAAS;EACT,WAAW;EACX,UAAU;EACV,oBAAoB;EACpB,cAAc;EACd,gBAAgB;EAChB,gBAAgB;EAChB,kBAAkB;EAClB,mBAAmB;EACnB,qBAAqB;EACrB,mBAAmB;EACnB,mBAAmB;EACnB,gBAAgB;EAChB,aAAa;EACb,aAAa;EACb,YAAY;EACZ,eAAe;EACf,QAAQ;EACR,WAAW;EACX,SAAS;EACT,aAAa;EACb,UAAU;EACV,aAAa;EACb,UAAU;EACV,iBAAiB;EACjB,aAAa;EACb,iBAAiB;EACjB,iBAAiB;EACjB,cAAc;EACd,aAAa;EACb,QAAQ;EACR,QAAQ;EACR,QAAQ;EACR,cAAc;EACd,UAAU;EACV,iBAAiB;EACjB,OAAO;EACP,aAAa;EACb,aAAa;EACb,eAAe;EACf,UAAU;EACV,cAAc;EACd,YAAY;EACZ,YAAY;EACZ,UAAU;EACV,UAAU;EACV,WAAW;EACX,aAAa;EACb,aAAa;EACb,QAAQ;EACR,eAAe;EACf,aAAa;EACb,OAAO;EACP,QAAQ;EACR,WAAW;EACX,UAAU;EACV,aAAa;EACb,UAAU;EACV,SAAS;EACT,SAAS;EACT,cAAc;EACd,UAAU;EACV,eAAe;EACf,eAAe;AAChB;;;;;;;;;;;;;;;;;;;AC9MD,IAAanB,iBAAc,CAAgBC,QAAUC,QAAuD;AAC1G,UAAQvB,OAAM,MAAd;IACE,KAAK;AACH,aAAO;QACL,GAAGA;QACH,SAASwB,KAAIxB,OAAM,WAAW,OAAO,KAAKA,MAAA,IAAS;MACpD;IACH,KAAK;AACH,aAAO;QACL,GAAGA;QACH,SAASwB,IAAIxB,OAAM,WAAW,GAAIA,MAAA;MACnC;EACJ;AACF;AAGD,SAAgBgC,eAAcC,WAAmBkB,WAAS,MAA2B;AACnF,SAAOhB,aAAA,QAAsB,SAAA,GAAY,EAAE,QAAA,SAAQ,CAAA;AACpD;AAED,IAAM8D,kBAA0B,OAAO,OAAO;EAC5C,GAAG;EAAG,GAAG;EAAG,GAAG;EAAG,SAAS;EAAG,MAAM;EAAQ,OAAO;AACpD,CAAA;AAkBD,SAAgB7D,SAAQC,QAAe6D,UAA+B,CAAE,GAAO;AAC7E,EAAAlG,SAAQA,OAAM,YAAA;AACd,MAAIA,OAAM,WAAW,OAAO,EAAG,OAAM,IAAI,MAAM,sBAAsB;AACrE,MAAIA,OAAM,WAAW,OAAO,EAAG,OAAM,IAAI,MAAM,sBAAsB;AAGrE,QAAMmD,WAAS,QAAQ,UAAU;AAGjC,MAAInD,OAAM,WAAW,GAAG,EAAG,QAAOgC,eAAchC,QAAOmD,QAAAA;AAEvD,MAAInD,WAAU,cAAe,QAAOmG;AAEpC,MAAI,OAAO3D,sBAAsBxC,MAAA,MAAY,YAAa,CAAAgC,eAAcQ,sBAAsBxC,MAAA,GAAmBmD,QAAAA;AAEjH,MAAInD,OAAM,WAAW,MAAM,GAAG;AAC5B,UAAM,MAAMoG,cAAgBpG,MAAA;AAC5B,WAAOmC,aAAY,KAAK,OAAA;EACzB;AAWD,MAAI,CAACnC,OAAM,WAAW,MAAM,EAC1B,KAAI;AACF,IAAAA,SAAA,UAAkBA,QAAO,KAAK;EAC/B,SAAQ,OAAO;AACd,QAAI,QAAQ,eACV,CAAAA,SAAQ,QAAQ;QAEhB,OAAM;EAET;AAGH,MAAI;AAEF,UAAM,MAAMgF,qBAAoBhF,MAAA;AAChC,QAAImD,SAAQ,QAAOR,UAAS,GAAA;AAC5B,WAAO0D,QAAO,GAAA;EACf,SAAQ,OAAO;AACd,QAAI,QAAQ,eAAgB,QAAO,QAAQ;AAC3C,UAAM;EACP;AACF;AAED,IAAatD,eAAc,CAACuD,QAAqB;AAC/C,QAAM,OAAOlB,WAAU,GAAA;AACvB,SAAOpE,uBAAsB,IAAA;AAC9B;AAED,IAAa6B,iBAAc,CAACyD,QAAqB;AAC/ChD,EAAAA,SAAM,GAAA;AACN,UAAQ,IAAI,MAAZ;IACE,KAAK;AACH,UAAI,IAAI,YAAY,UAAa,IAAI,YAAY,IAC/C,QAAO,OAAQ,IAAI,CAAA,IAAO,IAAI,CAAA,IAAO,IAAI,CAAA;AAE3C,aAAO,OAAQ,IAAI,CAAA,IAAO,IAAI,CAAA,IAAO,IAAI,CAAA,OAAU,IAAI,WAAW,OAAO,GAAA;IAC3E,KAAK;AACH,UAAI,IAAI,YAAY,UAAa,IAAI,YAAY,EAC/C,QAAO,OAAQ,IAAI,IAAI,GAAA,KAAU,IAAI,IAAI,GAAA,KAAU,IAAI,IAAI,GAAA;AAE7D,aAAO,OAAQ,IAAI,IAAI,GAAA,KAAU,IAAI,IAAI,GAAA,KAAU,IAAI,IAAI,GAAA,QAAa,IAAI,WAAW,KAAK,GAAA;IAC9F;AAEE,YAAM,IAAI,MAAM,iBAAmB,IAAY,IAAA,EAAO;EACzD;AACF;AAED,IAAM8B,aAAY,CAACkB,QAAoB;AACrC,QAAMxD,OAAMuD,QAAO,GAAA;AACnB,SAAO;IACL,GAAGvD,KAAI;IACP,GAAGA,KAAI;IACP,GAAGA,KAAI;IACP,OAAOA,KAAI;EACZ;AACF;AAKD,SAASX,aAAYoE,KAAYC,iBAAsC,CAAE,GAAuB;AAC9F,MAAI,eAAe,OACjB,QAAO;IACL,GAAG,IAAI,IAAI;IACX,GAAG,IAAI,IAAI;IACX,GAAG,IAAI,IAAI;IACX,SAAS,IAAI,SAAS;IACtB,MAAM;IACN,OAAO;EACR;MAED,QAAO;IACL,GAAG,IAAI;IACP,GAAG,IAAI;IACP,GAAG,IAAI;IACP,SAAS,IAAI,SAAS;IACtB,MAAM;IACN,OAAO;EACR;AAEJ;AAGD,IAAaH,UAAS,CAACI,gBAAuC;AAC5D,MAAI,OAAO,gBAAgB,SACzB,QAAOrE,SAAQ,aAAa,EAAE,QAAQ,MAAO,CAAA;AAE/C,MAAIhC,OAAM,WAAA,EACR,QAAOiG,QAAOlE,aAAYiE,cAAgB,WAAA,GAAc,EAAE,QAAQ,MAAO,CAAA,CAAC;AAE5E9C,EAAAA,SAAM,WAAA;AACN,MAAI,YAAY,SAAS,OAAQ,QAAO;AACxC,SAAO;IACL,GAAG,YAAY,IAAI;IACnB,GAAG,YAAY,IAAI;IACnB,GAAG,YAAY,IAAI;IACnB,UAAU,YAAY,WAAW,KAAK;IACtC,MAAM;IACN,OAAO;EACR;AACF;AAED,IAAaX,YAAW,CAAC+D,gBAA+C;AACtE,MAAI,OAAO,gBAAgB,SACzB,QAAOtE,SAAQ,aAAa,EAAE,QAAQ,KAAM,CAAA;AAE9C,MAAIhC,OAAM,WAAA,EACR,QAAOuC,UAASR,aAAYiE,cAAgB,WAAA,GAAc,EAAE,QAAQ,KAAM,CAAA,CAAC;AAE7E9C,EAAAA,SAAM,WAAA;AACN,MAAI,YAAY,SAAS,SAAU,QAAO;AAC1C,SAAO;IACL,GAAG,YAAY,IAAI;IACnB,GAAG,YAAY,IAAI;IACnB,GAAG,YAAY,IAAI;IACnB,UAAU,YAAY,WAAW,KAAK;IACtC,MAAM;IACN,OAAO;EACR;AACF;AAED,IAAaA,WAAQ,CAACgD,QAAa;AACjC,QAAM,EAAE,GAAAK,IAAG,GAAAC,IAAG,GAAAxI,IAAG,SAAAsF,UAAS,OAAO,KAAA,IAAS;AAC1C,MAAI,UAAU,OAAQ,OAAM,IAAI,MAAM,wCAAyC,KAAA,EAAQ;AACvF,MAAI,SAAS,OACX,aACE,yBAAyBiD,IAAG,GAAG,KAAK,GAAG,GACvC,yBAAyBC,IAAG,GAAG,KAAK,GAAG,GACvC,yBAAyBxI,IAAG,GAAG,KAAK,GAAG,GACvC,MAAM;AACJ,QAAI,OAAOsF,aAAY,SACrB,QAAO,yBAAyBA,UAAS,GAAG,KAAK,SAAS;EAE7D,CAAA;WAEM,SAAS,SAClB,aACE,WAAWiD,IAAG,cAAc,GAAG,GAC/B,WAAWC,IAAG,cAAc,GAAG,GAC/B,WAAWxI,IAAG,cAAc,GAAG,GAC/B,MAAM;AACJ,QAAI,OAAOsF,aAAY,SACrB,QAAO,WAAWA,UAAS,cAAc,SAAS;EAErD,CAAA;MAEH,OAAM,IAAI,MAAM,mDAAoD,IAAA,EAAO;AAE9E;AAcD,IAAajC,mBAAkB,CAAC6E,KAAU3E,WAA2E;AACnH,MAAI,OAAO;AACX,QAAMkF,MAAK,IAAI3B,cAASrC,eAAY,GAAA,CAAI;AACxC,QAAM,aAAa,IAAI,SAAS;AAChC,MAAI,OAAO,OAAO,WAAW,YAC3B,QAAOgE,IAAG,MAAM,IAAKA,IAAG,MAAM,IAAI,OAAO;WAChC,OAAO,OAAO,UAAU,YACjC,QAAOA,IAAG,MAAM,IAAI,OAAO;WAClB,OAAO,OAAO,UAAU,aAAa;AAC9C,QAAI,OAAO,QAAQ,EAAG,OAAM,IAAI,UAAU,8CAA8C;AACxF,WAAO,OAAO;EACf,MACC,OAAM,IAAI,UAAU,+DAA+D;AAErF,MAAI,OAAO,EAAG,QAAO;WACZ,OAAO,EAAG,QAAO;AAE1B,QAAM,YAAA,UAAwB;IAAE,GAAGA,IAAG,MAAM;IAAG,GAAGA,IAAG,MAAM;IAAG,GAAG;IAAM,OAAOA,IAAG,MAAM;EAAO,CAAA;AAC9F,SAAO1E,aAAY,WAAW,EAAE,QAAQ,WAAY,CAAA;AAErD;AASD,SAAgBsB,WAAU6C,KAAU;AAClC,QAAMO,MAAK,IAAI3B,cAASrC,eAAY,GAAA,CAAI;AACxC,SAAOgE,IAAG,MAAM;AACjB;AAuBD,SAAgBC,UAAS,MAAM,KAAK,QAAQ,KAAK,OAAO,KAAKpD,WAAU,KAAc;AACnF,QAAMqD,MAAe;IACnB,MAAM;IACN,OAAO;IACP,GAAG;IACH,GAAG;IACH,GAAG;IACM,SAAArD;EACV;AACDJ,EAAAA,SAAM,GAAA;AACN,SAAO;AACR;AAUD,SAAgBH,UAAO,MAAM,KAAK,QAAQ,KAAK,OAAO,KAAKO,WAAU,GAAc;AACjF,QAAMsD,MAAiB;IACrB,MAAM;IACN,OAAO;IACP,GAAG;IACH,GAAG;IACH,GAAG;IACM,SAAAtD;EACV;AACDJ,EAAAA,SAAM,GAAA;AACN,SAAO;AACR;AAOD,SAAgB0B,qBAAoB3C,QAAoB;AACtD,MAAIrC,OAAM,WAAW,MAAM,EAAG,OAAM,IAAI,MAAM,uBAAuB;AACrE,MAAI,CAACA,OAAM,WAAW,MAAM,EAAG,OAAM,IAAI,MAAM,6BAA6B;AAE5E,QAAM,QAAQA,OAAM,QAAQ,GAAA;AAC5B,QAAM,MAAMA,OAAM,QAAQ,GAAA;AAC1B,MAAI,MAAM,MAAO,OAAM,IAAI,MAAM,sCAAsC;AAEvE,QAAM,OAAOA,OAAM,UAAU,QAAQ,GAAG,GAAA;AACxC,MAAI,QAAQ,KAAK,MAAM,QAAA;AACvB,MAAI,MAAM,SAAS,EAAG,OAAM,IAAI,MAAM,+BAAgC,MAAM,MAAA,SAAgB;AAE5F,MAAI,gBAAgB;AACpB,aAAW7D,MAAK,MACd,KAAIA,GAAE,SAAS,GAAA,EAAM;AAGvB,QAAM,gBAAgB,CAACiI,IAAWC,QAAgB;AAChD,QAAI/D,GAAE,SAAS,GAAG,EAChB,QAAO,OAAO,WAAWA,GAAE,UAAU,GAAGA,GAAE,SAAS,CAAA,CAAE,IAAI;AAE3D,QAAI,MAAM,EAER,QAAO,OAAO,WAAWA,EAAA,IAAK;QAG9B,QAAO,OAAO,WAAWA,EAAA;EAE5B;AAED,QAAM,cAAc,CAAC8D,IAAWC,QAAgB;AAC9C,QAAI/D,GAAE,SAAS,GAAG,EAChB,QAAO,OAAO,WAAWA,GAAE,UAAU,GAAGA,GAAE,SAAS,CAAA,CAAE,IAAI,MAAM;AAEjE,QAAI,MAAM,EAER,QAAO,OAAO,WAAWA,EAAA;QAGzB,QAAO,OAAO,WAAWA,EAAA,IAAK;EAEjC;AAGD,MAAI,MAAM,SAAS,GACjB;QAAI,MAAO,CAAA,MAAQ,IAEjB,SAAQ;MAAE,MAAO,CAAA;MAAK,MAAO,CAAA;MAAK,MAAO,CAAA;MAAK,MAAO,CAAA;IAAK;EAC3D;AAEH,MAAI,gBAAgB,EAElB,QAAO6C,UACL,cAAc,MAAO,CAAA,GAAK,CAAA,GAC1B,cAAc,MAAO,CAAA,GAAK,CAAA,GAC1B,cAAc,MAAO,CAAA,GAAK,CAAA,GAC1B,cAAc,MAAO,CAAA,KAAO,KAAK,CAAA,CAAE;MAIrC,QAAO2D,UACL,YAAY,MAAO,CAAA,GAAK,CAAA,GACxB,YAAY,MAAO,CAAA,GAAK,CAAA,GACxB,YAAY,MAAO,CAAA,GAAK,CAAA,GACxB,YAAY,MAAO,CAAA,KAAO,KAAK,CAAA,CAAE;AAGtC;AAcD,IAAajD,kBAAe,CAACoD,SAAuBC,YAA0B;AAC5E,QAAMC,MAAKxE,UAAS,OAAA;AACpB,QAAM,KAAKA,UAAS,OAAA;AAEpB,QAAM,WAAWwE,IAAG,WAAW;AAC/B,QAAM,mBAAmB,GAAG,WAAW,KAAK;AAE5C,QAAMR,KAAI,GAAG,IAAIQ,IAAG;AACpB,QAAMP,KAAI,GAAG,IAAIO,IAAG;AACpB,QAAM/I,KAAI,GAAG,IAAI+I,IAAG;AAEpB,SAAO,CAAClD,WAA8B;AACpC,aAAS,MAAM,MAAA;AACf,WAAOd,UACLgE,IAAG,IAAI,YAAY,QAAQ,GAAGR,EAAA,GAC9BQ,IAAG,IAAI,YAAY,QAAQ,GAAGP,EAAA,GAC9BO,IAAG,IAAI,YAAY,QAAQ,GAAG/I,EAAA,GAC9B,WAAW,YAAY,QAAQ,GAAG,eAAA,CAAgB;EACrD;AACF;AAOD,SAAgBgJ,cAAaC,KAA0B;AACrD,MAAI,OAAO,QAAQ,UAAU;AAC3B,UAAM,cAAcjF,SAAQ,KAAK,EAAE,QAAQ,MAAO,CAAA;AAClD,WAAOgF,cAAa,WAAA;EACrB;AACD,QAAMf,QAAO,GAAA;AACb,QAAM,MAAA,QAAgB;IAAE,GAAG,IAAI;IAAG,GAAG,IAAI;IAAG,GAAG,IAAI;EAAG,CAAA;AACtD,SAAO;IAAE,GAAG;IAAK,QAAQ,IAAI,WAAW,OAAO;EAAK;AACrD;;;;;;;;;;AC1bD,IAAaiB,UAAO,CAACC,UAAiC;AACpD,QAAMX,KAAI;IAAE,MAAM,MAAM;IAAO,MAAM,MAAM;EAAQ;AACnD,SAAOA;AACR;AAuBD,IAAaY,QAAO,CAACD,UAAgF;AACnG,SAAO;IACL,GAAGD,QAAK,KAAA;IACR,KAAKG,UAAS,KAAA;IACd,KAAKC,QAAO,KAAA;EACb;AACF;AAOD,IAAaD,YAAW,CAACF,UAAsD;AAC7E,QAAMX,KAAIU,QAAK,KAAA;AACf,QAAM,OAAO,MAAM;AAEnB,QAAMK,MAAsC,CAACC,MAAsB,SAAS,gBAAgB;AAC1F,UAAM,QAAA,cAA4BhB,IAAG,MAAM,MAAA;AAC3C,QAAI,UAAU,OAAW;AACzB,UAAM,UAAU,QAAQ;AACxB,WAAO;MACL,GAAG,KAAM,OAAA;MACT,GAAG,KAAM,UAAU,CAAA;MACnB,GAAG,KAAM,UAAU,CAAA;MACnB,SAAS,KAAM,UAAU,CAAA;MACzB,MAAM;MACN,OAAO;IACR;EACF;AACD,SAAOpF;AACR;AAOD,IAAakG,UAAS,CAACH,UAAgD;AACrE,QAAMX,KAAIU,QAAK,KAAA;AACf,QAAM,OAAO,MAAM;AAEnB,QAAMO,MAAgC,CAACC,QAAYF,MAAsB,SAAS,gBAAgB;AAChG,UAAM,QAAA,cAA4BhB,IAAG,MAAM,MAAA;AAC3C,QAAI,UAAU,OAAW,OAAM,IAAI,MAAM,sBAAuB,KAAK,CAAA,IAAO,KAAK,CAAA,EAAI;AACrF,UAAM,QAAAP,QAAyBrG,MAAA;AAC/B,UAAM,UAAU,QAAQ;AACxB,SAAM,OAAA,IAAY,MAAM;AACxB,SAAM,UAAU,CAAA,IAAM,MAAM;AAC5B,SAAM,UAAU,CAAA,IAAM,MAAM;AAC5B,SAAM,UAAU,CAAA,IAAM,MAAM,WAAW;EACxC;AACD,SAAOwB;AACR;AAcD,UAAiBuG,OAAMR,OAAkB;AACvC,QAAMpJ,KAAIsJ,UAAS,KAAA;AACnB,QAAMb,KAAIU,QAAK,KAAA;AAEf,QAAMhH,KAAA,KAAkBsG,IAAG;IAAE,GAAG;IAAG,GAAG;EAAG,CAAA;AACzC,aAAW,OAAOtG,IAAG;AACnB,UAAM,SAAS,IAAI,IAAI,CAAA9D,OAAK2B,GAAE3B,IAAG,WAAW,CAAC;AAC7C,UAAM;EACP;AACF;AAMD,UAAiBwL,UAAST,OAAkB;AAC1C,QAAMpJ,KAAIsJ,UAAS,KAAA;AACnB,QAAMb,KAAIU,QAAK,KAAA;AAEf,WAASlI,KAAI,GAAGA,KAAIwH,GAAE,MAAMxH,MAAK;AAC/B,UAAM6I,MAAiB,CAAE;AACzB,aAAS5I,KAAI,GAAGA,KAAIuH,GAAE,MAAMvH,MAAK;AAC/B,YAAM7C,KAAI2B,GAAE;QAAE,GAAAiB;QAAG,GAAAC;MAAG,GAAE,WAAW;AACjC,UAAI7C,GAAG,KAAI,KAAKA,EAAA;IACjB;AACD,UAAM;EACP;AACF;AEjID,IAAa0L,QAAO,KAAK,KAAG;ACoC5B,IAAaC,gBAAb,MAA0B;EACxB;EACA;EACA;EACA;EACA;EACA;EAEA,WAA2B,CAAE;EAE7B,YAAYC,sBAAkDC,YAA2B,OAAO;AAC9F,SAAKC,YAAYC,WAA6B,oBAAA;AAC9C,SAAKC,aAAa;AAClB,SAAKC,gBAAgB,OAAO,oBAAoB;AAChD,SAAKC,cAAc,KAAKC,kBAAAA;AACxB,SAAKC,eAAe,KAAK,eAAe;MAAE,OAAO,KAAKN,UAAU;MAAO,QAAQ,KAAKA,UAAU;IAAQ,CAAA;EACvG;;;;;;EAQD,eAAeO,MAAY;AACzB,SAAKD,eAAe;AACpB,UAAME,MAAK,KAAKR;AAChB,IAAAQ,IAAG,QAAS,KAAK,QAAQ,KAAKL;AAC9B,IAAAK,IAAG,SAAU,KAAK,SAAS,KAAKL;AAEhC,IAAAK,IAAG,MAAM,QAAQ,GAAK,KAAK,MAAO,SAAA,CAAU;AAC5C,IAAAA,IAAG,MAAM,SAAS,GAAK,KAAK,OAAQ,SAAA,CAAU;AAC9C,SAAKJ,cAAc,KAAKC,kBAAAA;AACxB,SAAK,kBAAA;AACL,WAAO;EACR;EAGD,oBAAoB;AAClB,QAAI,QAAQ;AACZ,YAAQ,KAAKH,YAAb;MACE,KAAK;AACH,gBAAQ,KAAK,IAAI,KAAKF,UAAU,OAAO,KAAKA,UAAU,MAAA;AACtD;MACF,KAAK;AACH,gBAAQ,KAAK,IAAI,KAAKA,UAAU,OAAO,KAAKA,UAAU,MAAA;AACtD;IACH;AACD,UAAMS,KAAI,aAAa,GAAG,OAAO,GAAG,CAAA;AACpC,WAAO;MACL,KAAKA,GAAE;MACP,KAAKA,GAAE;IACR;EACF;;;;EAKD,oBAAoB;AAClB,SAAKC,OAAO;EACb;EAED,KAAKC,QAAsB;AACzB,QAAI,CAAC,OAAQ,OAAM,IAAI,MAAM,kCAAkC;AAC/D,QAAI,KAAKC,SAAS,SAAS,MAAA,EAAS,OAAM,IAAI,MAAM,uBAAuB;AAC3E,SAAKA,SAAS,KAAK,MAAA;AACnB,WAAO;EACR;;;;;;;EASD,WAAWC,KAAWC,OAAsB,eAAe;AACzD,QAAI,EAAE,GAAAC,IAAG,GAAAC,GAAA,IAAMC;AACf,YAAQ,MAAR;MACE,KAAK;AACH,QAAAF,MAAK,KAAK;AACV,QAAAC,MAAK,KAAK;IAEb;AACD,WAAO;MAAE,GAAAD;MAAG,GAAAC;IAAG;EAChB;;;;EAKD,IAAI,SAAS;AACX,UAAME,KAAI,KAAKlB,UAAU,sBAAA;AACzB,WAAO;MAAE,GAAGkB,GAAE;MAAM,GAAGA,GAAE;IAAK;EAC/B;;;;;;;;;EAUD,WAAWL,KAAWM,QAA6BC,OAA+B,eAAe,UAAU,MAAM;AAC/G,QAAI,EAAE,GAAAL,IAAG,GAAAC,GAAA,IAAMC;AACf,QAAI,WAAW,UAAU;AACvB,YAAMC,KAAI,KAAKlB,UAAU,sBAAA;AACzB,MAAAe,MAAKG,GAAE;AACP,MAAAF,MAAKE,GAAE;IACR;AACD,YAAQ,MAAR;MACE,KAAK;AACH,QAAAH,MAAK,KAAK;AACV,QAAAC,MAAK,KAAK;AACV;MACF,KAAK;AACH;IACH;AACD,QAAI,SAAS;AACX,MAAAD,KAAI,MAAMA,EAAA;AACV,MAAAC,KAAI,MAAMA,EAAA;IACX;AACD,WAAO;MAAE,GAAAD;MAAG,GAAAC;IAAG;EAChB;;;;;;;EAQD,UAAUK,QAA6BP,OAAsB,eAAe;AAC1E,QAAI,EAAE,OAAO,QAAAQ,QAAA,IAAWC;AACxB,YAAQ,MAAR;MACE,KAAK;AACH,iBAAS,KAAK;AACd,QAAAD,WAAU,KAAK;AACf,YAAA,iBAA2BC,MAAAA,EACzB,QAAO;UACL,GAAG,KAAK,WAAWA,MAAAA;UACnB;UACA,QAAAD;QACD;IAEN;AACD,WAAO;MAAE;MAAO,QAAAA;IAAQ;EACzB;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;EAgCD,aAAaE,MAAwB;AACnC,UAAM,WAAW,KAAK,YAAY;AAClC,UAAM,YAAY,WAAW;AAC7B,QAAI,mBAAmB,MAAM;AAC3B,YAAMD,SAAAA,aAA0B,KAAK,eAAe,UAAU,QAAA;AAC9D,aAAO,KAAKE,KAAK,IAAIC,cAAa,MAAM,MAAMH,MAAAA,CAAAA;IAC/C;AAED,QAAI,wBAAwB,MAAM;AAChC,UAAII;AACJ,YAAMJ,SAAO,KAAK;AAClB,cAAQ,KAAK,OAAb;QACE,KAAK;AACH,oBAAU,CAACK,YAA0C;YACnD,GAAIL,OAAK,IAAI,OAAO,QAAS;YAC7B,GAAIA,OAAK,IAAI,OAAO,SAAU;YAC9B,OAAQA,OAAK,QAAQ,OAAO,QAAS;YACrC,QAASA,OAAK,SAAS,OAAO,SAAU;UACzC;AACD;QACF;AACE,gBAAM,IAAI,MAAM,yBAA0B,KAAK,KAAA,GAAS;MAC3D;AACD,aAAO,KAAKE,KAAK,IAAIC,cAAa,MAAM,OAAA,CAAA;IACzC;AAED,QAAI,kBAAkB,MAAM;AAC1B,UAAIC;AACJ,YAAMJ,SAAO,KAAK;AAClB,YAAM,WAAW,KAAK;AAEtB,cAAQ,KAAK,OAAb;QACE,KAAK;AACH,oBAAU,CAACK,WAAyC;AAClD,kBAAM,QAASL,OAAK,QAAQ,OAAO,QAAS;AAC5C,kBAAMD,UAAUC,OAAK,SAAS,OAAO,SAAU;AAC/C,gBAAIR,KAAI,OAAO,QAAQ,IAAI,QAAQ;AACnC,gBAAIC,KAAI,OAAO,SAAS,IAAIM,UAAS;AACrC,oBAAQ,UAAR;cACE,KAAK;AACH,gBAAAN,KAAI;AACJ;cACF,KAAK;AACH,gBAAAA,KAAI,OAAO,SAASM;AACpB;cACF;YAED;AACD,YAAAP,MAAK;AACL,YAAAC,MAAK;AACL,mBAAO;cAAE;cAAO,QAAAM;cAAQ,GAAAP;cAAG,GAAAC;YAAG;UAC/B;AACD;QACF;AACE,gBAAM,IAAI,MAAM,yBAA0B,KAAK,KAAA,GAAS;MAC3D;AACD,aAAO,KAAKS,KAAK,IAAIC,cAAa,MAAM,OAAA,CAAA;IACzC;AAED,QAAI,WAAW,MAAM;AACnB,YAAM,SAAS,kBAAkB,KAAK,KAAA;AACtC,UAAI,CAAC,OAAO,QACV,OAAM,IAAI,MAAM,oCAAqC,oBAAoB,MAAA,CAAO,EAAG;AAErF,YAAM,UAAU,CAACG,YAA0C;AACzD,cAAM,SAAS,OAAO,MAAM,sBAAA;AAC5B,eAAO;UACL,GAAG,OAAO,IAAI;UACd,GAAG,OAAO,IAAI;UACd,OAAO,OAAO,QAAQ;UACtB,QAAQ,OAAO,SAAS;QACzB;MACF;AACD,aAAO,KAAKJ,KAAK,IAAIC,cAAa,MAAM,OAAA,CAAA;IACzC;AACD,UAAM,IAAI,MAAM,yBAAyB;EAC1C;;;;EAKD,QAAQ;AACN,UAAMI,KAAI,KAAK;AACf,IAAAA,GAAE,UAAU,GAAG,GAAG,KAAK,OAAO,KAAK,MAAA;EACpC;;;;EAKD,IAAI,UAAU;AACZ,QAAI,KAAKpB,KAAM,QAAO,KAAKA;AAC3B,UAAMoB,KAAI,KAAK9B,UAAU,WAAW,IAAI;AACxC,QAAI,CAAC8B,GAAG,OAAM,IAAI,MAAM,6BAA6B;AACrD,IAAAA,GAAE,aAAa,GAAG,GAAG,GAAG,GAAG,GAAG,CAAA;AAC9B,IAAAA,GAAE,MAAM,KAAK3B,eAAe,KAAKA,aAAAA;AAEjC,SAAKO,OAAOoB;AAEZ,eAAWC,MAAK,KAAKnB,SACnB,CAAAmB,GAAE,gBAAA;AAEJ,WAAO,KAAKrB;EACb;;;;EAKD,IAAI,aAAa;AACf,WAAO,KAAKN;EACb;;;;EAKD,IAAI,QAAQ;AACV,WAAO,KAAKE,aAAa;EAC1B;;;;EAKD,IAAI,SAAS;AACX,WAAO,KAAKA,aAAa;EAC1B;AACF;AAKD,IAAaoB,gBAAb,MAA0B;EACxB;EACA;EACA;;;;EAKA,YAAYE,QAAsBI,eAAyD;AACzF,SAAK,SAAS;AACd,SAAKC,iBAAiB;AACtB,SAAKC,KAAK,cAAc,MAAA;EACzB;;;;;EAMD,kBAAkB;AAChB,SAAKA,KAAK,KAAKD,eAAe,KAAK,MAAA;EACpC;;;;;;;;;;;;EAaD,YAAYE,WAAkBC,UAAkB,QAAQ;AACtD,YAAQ,SAAR;MACE,KAAK;AACH,eAAO;UACL,GAAG,UAAU,IAAI,KAAKF,GAAG;UACzB,GAAG,UAAU,IAAI,KAAKA,GAAG;QAC1B;IAEJ;EACF;;;;;;EAOD,kBAAkBG,IAAU;AAC1B,WAAO;MACL,GAAGC,GAAE,IAAI,KAAKJ,GAAG;MACjB,GAAGI,GAAE,IAAI,KAAKJ,GAAG;IAClB;EACF;;;;;;;;EASD,4BAA4BK,gBAAyBC,aAAqB,YAAY,GAAG;AACvF,UAAM,SAAS,eAAe,IAAI,CAAAF,OAAK,KAAK,YAAYA,EAAA,CAAE;AAC1D,SAAK,oBAAoB,QAAQ,aAAa,SAAA;EAC/C;;;;;;;;;;EAWD,oBAAoBG,QAAiBD,aAAqB,YAAY,GAAG;AACvE,UAAMV,KAAI,KAAK;AACf,IAAAA,GAAE,KAAA;AACF,IAAAA,GAAE,UAAU,KAAKI,GAAG,GAAG,KAAKA,GAAG,CAAA;AAC/B,IAAAJ,GAAE,UAAA;AACF,IAAAA,GAAE,cAAc;AAChB,IAAAA,GAAE,YAAY;AACd,aAAS,QAAQ,GAAG,QAAQ,OAAO,QAAQ,QACzC,KAAI,UAAU,EACZ,CAAAA,GAAE,OAAO,OAAQ,KAAA,EAAQ,GAAG,OAAQ,KAAA,EAAQ,CAAA;QAE5C,CAAAA,GAAE,OAAO,OAAQ,KAAA,EAAQ,GAAG,OAAQ,KAAA,EAAQ,CAAA;AAGhD,IAAAA,GAAE,OAAA;AACF,IAAAA,GAAE,QAAA;EACH;;;;;;;;;EAUD,iBAAiBY,QAAcC,QAAe,YAAY,SAASC,MAAcC,WAA+B,cAAcC,QAAyB,SAAS;AAC9J,UAAMC,SAAQ,KAAK,YAAY,MAAA;AAC/B,SAAK,iBAAiBC,QAAMD,QAAO,WAAW,MAAM,UAAU,KAAA;EAC/D;;;;;;;;;EAUD,SAASL,QAAcO,QAAc,YAAY,SAASL,MAAcC,WAA+B,cAAcC,QAAyB,SAAS;AACrJ,UAAMhB,KAAI,KAAK;AACf,IAAAA,GAAE,KAAA;AACF,IAAAA,GAAE,UAAU,KAAKI,GAAG,GAAG,KAAKA,GAAG,CAAA;AAC/B,QAAI,KAAK,SAAS,EAChB,CAAAJ,GAAE,OAAO;AAEX,IAAAA,GAAE,eAAe;AACjB,IAAAA,GAAE,YAAY;AACd,IAAAA,GAAE,YAAY;AACd,IAAAA,GAAE,SAASkB,QAAMD,OAAM,GAAGA,OAAM,CAAA;AAChC,IAAAjB,GAAE,QAAA;EACH;EAED,YAAYoB,iBAAqCC,WAAmB,cAAc,IAAI,YAAY,GAAG;AACnG,UAAM,UAAU,gBAAgB,IAAI,CAAA,QAAK;AACvC,aAAO;QACL,GAAG,KAAK,YAAYrB,GAAAA;QACpB,QAAQ,KAAK,OAAO,WAAW,IAAIA,IAAE,MAAA;MACtC;IACF,CAAA;AAED,UAAMA,KAAI,KAAK;AACf,IAAAA,GAAE,KAAA;AACF,IAAAA,GAAE,UAAU,KAAKI,GAAG,GAAG,KAAKA,GAAG,CAAA;AAC/B,IAAAJ,GAAE,YAAY;AACd,IAAAA,GAAE,cAAc;AAChB,IAAAA,GAAE,YAAY;AAEd,eAAWsB,YAAU,SAAS;AAC5B,MAAAtB,GAAE,UAAA;AACF,MAAAA,GAAE,IAAIsB,SAAO,GAAGA,SAAO,GAAGA,SAAO,QAAQ,GAAGxD,KAAA;AAC5C,MAAAkC,GAAE,UAAA;AACF,UAAI,UAAU,SAAS,EACrB,CAAAA,GAAE,KAAA;AAEJ,UAAI,YAAY,SAAS,EACvB,CAAAA,GAAE,OAAA;IAEL;AACD,IAAAA,GAAE,QAAA;EACH;;;;EAKD,QAAQ;AACN,UAAMA,KAAI,KAAK;AACf,IAAAA,GAAE,UAAU,KAAKI,GAAG,GAAG,KAAKA,GAAG,GAAG,KAAKA,GAAG,OAAO,KAAKA,GAAG,MAAA;EAC1D;;;;;EAMD,KAAK,YAAY,SAAS;AACxB,UAAMJ,KAAI,KAAK;AACf,IAAAA,GAAE,YAAY;AACd,IAAAA,GAAE,SAAS,KAAKI,GAAG,GAAG,KAAKA,GAAG,GAAG,KAAKA,GAAG,OAAO,KAAKA,GAAG,MAAA;EACzD;;;;;;EAOD,WAAWM,aAAqB,YAAY,GAAG;AAC7C,SAAK,4BAA4B;MAC/B;QAAE,GAAG;QAAG,GAAG;MAAG;MACd;QAAE,GAAG;QAAG,GAAG;MAAG;MACd;QAAE,GAAG;QAAG,GAAG;MAAG;MACd;QAAE,GAAG;QAAG,GAAG;MAAG;MACd;QAAE,GAAG;QAAG,GAAG;MAAG;IACf,GAAE,aAAa,SAAA;AAEhB,SAAK,4BAA4B,CAC/B;MAAE,GAAG;MAAG,GAAG;IAAG,GACd;MAAE,GAAG;MAAG,GAAG;IAAG,CACf,GAAE,aAAa,SAAA;AAChB,SAAK,4BAA4B,CAC/B;MAAE,GAAG;MAAG,GAAG;IAAG,GACd;MAAE,GAAG;MAAG,GAAG;IAAG,CACf,GAAE,aAAa,SAAA;EACjB;;;;;;;EAQD,WAAW3B,KAAWM,SAA8B,UAAUL,OAAsB,eAAe,UAAU,MAAM;AACjH,IAAAG,MAAK,KAAK,OAAO,WAAWA,KAAI,QAAQ,QAAQ,KAAA;AAChD,QAAI,EAAE,GAAAF,IAAG,GAAAC,GAAA,IAAMC;AACf,IAAAF,MAAK,KAAK;AACV,IAAAC,MAAK,KAAK;AAEV,YAAQ,MAAR;MACE,KAAK;AACH,QAAAD,MAAK,KAAK;AACV,QAAAC,MAAK,KAAK;IACb;AACD,QAAI,SAAS;AACX,MAAAD,KAAI,MAAMA,EAAA;AACV,MAAAC,KAAI,MAAMA,EAAA;IACX;AACD,WAAO;MAAE,GAAAD;MAAG,GAAAC;IAAG;EAChB;;;;;;;;EASD,iBAAiBH,KAAWwC,QAAkBC,SAAkB;AAC9D,QAAI,WAAW,SACb,CAAArC,MAAA,SAAqBA,KAAI,KAAK,OAAO,MAAA;AAGvC,QAAI,EAAE,GAAAF,IAAG,GAAAC,GAAA,IAAMC;AACf,IAAAF,MAAK,KAAK;AACV,IAAAC,MAAK,KAAK;AAEV,QAAI,SAAS;AACX,UAAID,KAAI,EAAG,CAAAA,KAAI;AACf,UAAIC,KAAI,EAAG,CAAAA,KAAI;AACf,UAAID,KAAI,KAAK,QAAQ,KAAK,EAAG,CAAAA,KAAI,KAAK,IAAI,KAAK;AAC/C,UAAIC,KAAI,KAAK,SAAS,KAAK,EAAG,CAAAA,KAAI,KAAK,IAAI,KAAK;IACjD;AACD,WAAO;MAAE,GAAAD;MAAG,GAAAC;IAAG;EAChB;;;;EAKD,IAAI,SAAS;AACX,WAAA,SAAoB,KAAKkB,EAAAA;EAC1B;;;;EAKD,IAAI,UAAU;AACZ,WAAO,KAAK,OAAO;EACpB;;;;EAKD,IAAI,OAAOqB,QAAuB;AAChC,SAAKrB,KAAKsB;EACX;;;;EAKD,IAAI,SAAS;AACX,WAAO,KAAKtB;EACb;;;;EAKD,IAAI,QAAQ;AACV,WAAO,KAAKA,GAAG;EAChB;;;;EAKD,IAAI,SAAS;AACX,WAAO,KAAKA,GAAG;EAChB;;;;EAKD,IAAI,IAAI;AACN,WAAO,KAAKA,GAAG;EAChB;;;;EAKD,IAAI,IAAI;AACN,WAAO,KAAKA,GAAG;EAChB;;;;EAKD,IAAI,eAAe;AACjB,WAAO,KAAK,IAAI,KAAKA,GAAG,OAAO,KAAKA,GAAG,MAAA;EACxC;AACF;ACvoBD,IAAauB,aAAY,CAACC,MAAkBC,SAAsB;AAChE,MAAI,KAAK,UAAW,MAAK,eAAe,MAAM,QAAQ,KAAK,SAAA;AAC3D,MAAI,KAAK,QACP,MAAK,eAAe,MAAM,WAAW,KAAK,QAAQ,SAAA,CAAU;AAG/D;ACRD,IAAaC,aAAY,CAACC,QAA0B;AAClD,QAAMC,KAAI,IAAI,eAAe,MAAM,OAAO;AAC1C,QAAM,QAAQA,OAAM,OAAO,IAAI,OAAO,WAAWA,EAAA;AACjD,QAAMC,KAAI,IAAI,eAAe,MAAM,QAAQ;AAC3C,QAAMzC,UAASyC,OAAM,OAAO,IAAI,OAAO,WAAWA,EAAA;AAClD,SAAO;IAAE;IAAO,QAAAzC;EAAQ;AACzB;AAOD,IAAa0C,aAAY,CAACH,KAAiBI,WAAuB;AAChE,MAAI,eAAe,MAAM,SAAS,OAAO,MAAM,SAAA,CAAU;AACzD,MAAI,eAAe,MAAM,UAAU,OAAO,OAAO,SAAA,CAAU;AAC5D;AChBD,IAAaC,YAAW,CACtBC,MACAC,OACM;AACN,QAAMC,KAAI,SAAS,gBAAgB,8BAA8B,IAAA;AACjE,MAAI,GACF,CAAAA,GAAE,KAAK;AAET,SAAOA;AACR;AAuBD,IAAaC,mBAAkB,CAC7BC,QACAJ,MACAK,iBACAC,WACM;AACN,MAAIC,WAAuC;AAC3C,MAAI,oBAAoB,OACtB,YAAW,OAAO,oBAAoB,WAAW,OAAO,cAAc,eAAA,IAAmB;AAE3F,MAAI,aAAa,MAAM;AACrB,UAAMpC,KAAI,SAAS,gBAAgB,8BAA8B,IAAA;AACjE,WAAO,OAAOA,EAAA;AACd,QAAI,mBAAmB,OAAO,oBAAoB,YAChD,gBAAgB,WAAW,GAAG,EAC9B,CAAAA,GAAE,KAAK,WAAW,UAAa,CAAC,gBAAgB,SAAS,MAAA,IAAU,gBAAgB,MAAM,CAAA,IAAK,SAAS,gBAAgB,MAAM,CAAA;AAE/H,WAAOA;EACR;AACD,SAAO;AACR;ACvCD,IAAaqC,qBAAoB,CAC/BC,OACA,aAAa,KACbC,cAAY,MACZ,QAAQ,MACL;AACH,cACE,WAAW,OAAO,YAAY,OAAO,GACrC,WAAW,YAAY,cAAc,YAAY,GACjD,WAAWA,aAAW,cAAc,WAAW,GAC/C,WAAW,OAAO,cAAc,OAAO,CAAC;AAG1C,QAAM,SAAS,QAAQ;AACvB,QAAM,SAAU,SAAS,MAAO;AAChC,SAAOC,aAAYC,QAAU,QAAQ,YAAYF,aAAW,KAAA,CAAM;AAEnE;AAeD,IAAaG,aAAY,CAACC,OAAqB,KAAK,WAAmB,KAAA,IAAS;ACxBhF,SAAgBC,kBAAgBC,WAAsBC,QAA2B;AAC/E,SAAOC,aAAY,WAAW,CAAAC,OAAK,MAAMA,KAAI,MAAA,CAAO;AACrD;AAoCD,SAAgBD,aAAYF,WAAsBI,KAAkD;AAClG,QAAM,SAASC,UAAS,SAAA;AACxB,MAAIC;AACJ,UAAQ,OAAO,OAAf;IACE,KAAK;AACH,eAAAC,eAA8B,QAAQC,GAAA;AACtC;IACF,KAAK;AACH,eAAAC,eAA+B,QAAQD,GAAA;AACvC;IACF,KAAK;AACH,eAAAE,eAAgC,QAAQF,GAAA;AACxC;IACF;AACE,YAAM,IAAI,MAAM,mBAAoB,OAAO,KAAA,8BAAoC;EAClF;AACD,MAAI,CAAC,OAAQ,OAAM,IAAI,MAAM,4BAA4B;AAGzD,MAAI,OAAO,cAAc,SACvB,QAAOG,aAAY,MAAA;AAErB,SAAO;AACR;AAQD,SAAgBC,YAAWZ,WAAsBa,UAA4B;AAC3E,QAAM,SAASR,UAAS,SAAA;AACxB,SAAO,UAAUS;AACjB,MAAI,OAAO,cAAc,SACvB,QAAOH,aAAY,MAAA;AAErB,SAAO;AACR;AC5BD,SAASI,iBAAgBC,SAAsBC,cAA4B,OAAkD;AAC3H,MAAI,CAAC,MAAM,QAAQ,OAAA,EAAU,OAAM,IAAI,MAAM,qDAAsD,OAAO,OAAA,EAAU;AACpH,MAAI,QAAQ,SAAS,EAAG,OAAM,IAAI,MAAM,0DAA2D,QAAQ,MAAA,EAAS;AAEpH,QAAMtE,KAAI,QAAQ,IAAI,CAAA,WAAUuE,eAAc,QAAQ,WAAA,CAAY;AAClE,SAAO,CAAE,GAAG,SAASvE,EAAA,CAAI;AAC1B;AAUD,IAAawE,qBAAoB,CAACH,YAAyB;AACzD,QAAMrE,KAAI,QAAQ,IAAI,CAAA,QAAKgE,aAAYhE,GAAAA,CAAE;AACzC,SAAO,6BAA8BA,GAAE,KAAK,IAAI,CAAC;AAClD;AAoBD,IAAayE,gBAAe,CAACC,SAAoBC,SAAoBC,UAA4C,CAAE,MAAK;AACtH,QAAM,QAAQ,QAAQ,SAAS;AAC/B,QAAM,YAAY,QAAQ,aAAa;AAEvC,MAAIC;AACJ,UAAQ,OAAR;IACE,KAAK;AACH,cAAAC,gBAA8BC,WAAQ,SAAS,YAAY,GAAGA,WAAQ,SAAS,YAAY,GAAG,SAAA;AAC9F;IACF,KAAK;AACH,cAAAC,gBAA+BD,WAAQ,SAAS,aAAa,GAAGA,WAAQ,SAAS,aAAa,CAAC;AAC/F;IACF;AACE,cAAAE,gBAAgCF,WAAQ,SAAS,cAAc,GAAGA,WAAQ,SAAS,cAAc,GAAG,SAAA;EACvG;AAED,SAAO,CAACzB,WAAmBU,aAAY,MAAM,MAAA,CAAO;AAErD;AAqBD,IAAakB,SAAQ,CAACb,SAAsBc,OAAgC,CAAE,MAAe;AAC3F,QAAM,YAAY,KAAK,aAAa;AACpC,QAAM,QAAQ,KAAK,SAAS;AAC5B,QAAM,SAASf,iBAAgB,SAAS,KAAA;AAExC,MAAI,eAAe;AACnB,MAAI,OAAO,KAAK,iBAAiB,UAAU;AACzC,mBAAe,KAAK;AACpB,QAAI,eAAe,EAAG,OAAM,IAAI,MAAM,yCAAyC;EAChF,WAAU,OAAO,KAAK,eAAe,UAAU;AAC9C,QAAI,KAAK,cAAc,QAAQ,OAAQ,OAAM,IAAI,MAAM,4EAA6E,QAAQ,MAAA,eAAsB;AAClK,UAAM,aAAa,KAAK,aAAa,QAAQ;AAC7C,mBAAe,KAAK,MAAM,aAAa,OAAO,MAAA;EAC/C;AAED,QAAM,QAAQ,OAAO,IAAI,CAACgB,UAAoB;AAE5C,UAAMC,aAAuBC,aAAY,MAAO,CAAA,GAAK,MAAO,CAAA,GAAK;MAAE,OAAO;MAAc;MAAO;MAAW,WAAW;IAAM,CAAA;AAG3H,eAAW,KAAK,MAAO,CAAA,CAAA;AACvB,WAAO;EACR,CAAA;AAGD,QAAM,aAAa,OAAQ,CAAA;AAC3B,QAAM,QAAQ,CAAE,WAAY,CAAA,CAAK,CAAA;AACjC,SAAO,MAAM,KAAA,EAAO,IAAI,CAAAtF,OAAKgE,aAAYhE,EAAA,CAAE;AAC5C;AA2BD,SAAgBsF,aAAYC,IAAuBC,IAAcC,UAA8B,CAAE,GAAY;AAC3G,QAAM,YAAY,QAAQ,aAAa;AACvC,QAAM,QAAQ,QAAQ,SAAS;AAC/B,QAAM,QAAQ,QAAQ,SAAS;AAC/B,QAAM,YAAY,QAAQ,aAAa;AAEvC,MAAI,CAAC,aAAa,QAAQ,EAAG,OAAM,IAAI,MAAM,8DAA8D;AAC3G,MAAI,aAAa,QAAQ,EAAG,OAAM,IAAI,MAAM,4DAA4D;AAExG,QAAMC,MAAKnB,eAAcoB,IAAG,KAAA;AAC5B,QAAM,KAAKpB,eAAcnF,IAAG,KAAA;AAG5B,MAAIyF;AACJ,UAAQ,OAAR;IACE,KAAK;AACH,cAAAC,gBAA8BY,KAAiB,IAAiB,SAAA;AAChE;IACF,KAAK;AACH,cAAAT,gBAAgCS,KAAmB,IAAmB,SAAA;AACtE;IACF,KAAK;AACH,cAAAV,gBAA+BU,KAAiB,EAAA;AAChD;IACF;AACE,YAAM,IAAI,MAAM,iBAAkB,KAAA,oCAA0C;EAC/E;AACD,MAAI,CAAC,MAAO,OAAM,IAAI,MAAM,4CAA6C,KAAA,EAAQ;AAEjF,MAAI,SAAS;AACb,MAAI,UAAU;AACd,MAAI,QAAQ;AACZ,MAAI,WAAW;AACb,aAAS,KAAK,QAAQ;AACtB,cAAU;AACV,YAAQ,IAAI;EACb,MACC,UAAS,KAAK,QAAQ;AAGxB,QAAME,UAAoB,CAAE;AAC5B,WAAS,oBAAoB,SAAS,qBAAqB,OAAO,qBAAqB,OACrF,SAAQ,KAAK,MAAM,iBAAA,CAAkB;AAGvC,SAAO;AACR;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AEnOD,SAAgBb,WAAQc,QAAmBC,aAAqD;AAC9F,MAAI,gBAAgB,cAClB;QAAI,OAAO,WAAW,YAAYC,OAAM,MAAA,KAAWC,OAAM,MAAA,EACvD,QAAAC,YAAyB,MAAA;EAC1B,WACQ,gBAAgB,gBACzB;QAAI,OAAO,WAAW,YAAYF,OAAM,MAAA,EACtC,QAAAG,cAA2B,MAAA;EAC5B,WACQ,gBAAgB,gBACzB;QAAI,OAAO,WAAW,YAAYC,SAAQ,MAAA,EACxC,QAAAC,YAA2B,MAAA;EAC5B,WACQ,gBAAgB,kBACzB;QAAI,OAAO,WAAW,YAAYD,SAAQ,MAAA,EACxC,QAAAE,YAA6B,MAAA;EAC9B,WACQ,gBAAgB,aACzB;QAAI,OAAO,WAAW,YAAYL,OAAM,MAAA,EACtC,QAAAM,QAAwB,MAAA;EACzB,WACQ,gBAAgB,eACzB;QAAI,OAAO,WAAW,YAAYN,OAAM,MAAA,EACtC,QAAAO,UAA0B,MAAA;EAC3B,MAED,OAAM,IAAI,MAAM,gBAAiB,WAAA,8BAA2C,KAAK,UAAU,MAAA,CAAO,EAAG;AAEvG,SAAOxB,WAAQf,aAAY,MAAA,GAAS,WAAA;AACrC;AAQD,SAAgBwC,iBAAgBX,QAAmBC,aAA0C;AAC3F,QAAM9F,KAAI+E,WAAQ,QAAQ,WAAA;AAC1B,SAAOf,aAAYhE,EAAA;AACpB;AAOD,SAAgBuE,eAAcsB,QAAmBvB,aAAgE;AAC/G,MAAI,gBAAgB,QAAS,QAAOS,WAAQ,QAAQ,cAAc;AAClE,MAAI,gBAAgB,OAAQ,QAAOA,WAAQ,QAAQ,aAAa;AAChE,MAAI,gBAAgB,MAAO,QAAOA,WAAQ,QAAQ,YAAY;AAC9D,QAAM,IAAI,MAAM,yBAA0B,WAAA,GAAe;AAC1D;AAED,IAAaf,eAAc,CAACyC,WAAuC;AACjE,MAAI,OAAO,WAAW,SAAU,QAAO;AAEvC,MAAIV,OAAM,MAAA,EACR,QAAA/C,aAA4B,MAAA;AAG9B,MAAIgD,OAAM,MAAA,EACR,QAAAU,eAA6B,MAAA;AAG/B,MAAIP,SAAQ,MAAA,EACV,QAAAQ,eAA8B,MAAA;AAEhC,QAAM,QAAQC,qBAAoB,MAAA;AAClC,MAAI,MAAO,QAAAF,eAA6B,KAAA;AAExC,QAAM,QAAQG,qBAAoB,MAAA;AAClC,MAAI,MAAO,QAAA7D,aAA4B,KAAA;AAEvC,QAAM,IAAI,MAAM,2BAA4B,KAAK,UAAU,MAAA,CAAO,GAAI;AACvE;AAED,IAAa8D,eAAc,CAACL,WAAuC;AAEjE,MAAIV,OAAM,MAAA,EACR,QAAAgB,eAA4B,MAAA;AAG9B,MAAIf,OAAM,MAAA,EACR,QAAAgB,aAA6B,MAAA;AAG/B,MAAIb,SAAQ,MAAA,EACV,QAAAc,eAA8B,MAAA;AAGhC,MAAI,OAAO,WAAW,UAAU;AAC9B,QAAI,OAAO,WAAW,GAAG,EAAG,QAAO;AACnC,UAAMjH,KAAI+E,WAAQ,QAAQ,WAAW;AACrC,WAAAiC,aAA6BhH,EAAA;EAC9B;AAED,QAAM,QAAQ4G,qBAAoB,MAAA;AAClC,MAAI,MAAO,QAAAI,aAA6B,KAAA;AAExC,QAAM,QAAQH,qBAAoB,MAAA;AAClC,MAAI,MAAO,QAAAE,eAA4B,KAAA;AAEvC,QAAM,IAAI,MAAM,2BAA4B,KAAK,UAAU,MAAA,CAAO,GAAI;AACvE;AAID,IAAaG,mBAAkB,CAACrB,WAAgC;AAC9D,QAAM,QAAQ7B,aAAY,MAAA;AAC1B,SAAO,IAAImD,cAAS,KAAA;AACrB;AAOD,IAAaC,WAAQ,CAACC,WAAmB;AACvC,UAAQ,OAAO,OAAf;IACE,KAAK;eACY,MAAA;AACf;IACF,KAAK;eACa,MAAA;AAChB;IACF,KAAK;eACc,MAAA;AACjB;IACF;AACE,YAAM,IAAI,MAAM,8BAA+B,OAAO,KAAA,GAAS;EAClE;AACF;AAED,IAAa3D,YAAW,CAAC4D,cAA2B;AAClD,MAAI,CAACC,aAAY,SAAA,EAAY,OAAM,IAAI,MAAM,qGAAsG,KAAK,UAAU,SAAA,CAAU,EAAG;AAC/K,MAAIC;AACJ,MAAI,OAAO,cAAc,SAAU,CAAAxH,KAAIyH,eAAc,SAAA;MAChD,CAAAzH,KAAI;AACT,MAAIA,OAAM,OAAW,OAAM,IAAI,MAAM,8FAA8F;AAEnIoH,EAAAA,SAAMpH,EAAA;AACN,SAAOA;AACR;AAoBD,IAAa0H,iBAAgB,IAAI,YAA+C;AAC9E,aAAW,UAAU,SAAS;AAC5B,QAAI,WAAW,OAAW;AAC1B,QAAI,WAAW,KAAM;AACrB,QAAI;AACF,YAAM1H,KAAI0D,UAAS,MAAA;AACnB,aAAOM,aAAYhE,EAAA;IACpB,QAAO;IAAe;EACxB;AACD,SAAO;AACR;AAKD,SAAgB2H,UAASC,KAAUC,cAA4B;AAO7D,MAAI,EAAE,GAAA5H,IAAG,GAAA6H,IAAG,GAAA1I,GAAA,IAAM;AAClB,QAAM+E,WAAU,IAAI,WAAW;AAC/B,MAAI,IAAI,SAAS,QAAQ;AACvB,IAAAlE,MAAK;AACL,IAAA6H,MAAK;AACL,IAAA1I,MAAK;EACN;AAED,QAAM2I,OAAM,KAAK,IAAI9H,IAAG6H,IAAG1I,EAAA;AAC3B,QAAM4I,OAAM,KAAK,IAAI/H,IAAG6H,IAAG1I,EAAA;AAE3B,MAAI6C,MAAK8F,OAAMC,QAAO;AACtB,MAAIrJ,KAAIsD;AACR,QAAMgG,KAAIhG;AAEV,MAAI8F,SAAQC,KAEV,KAAI,aACF,QAAAE,QAAuB,GAAG,GAAG,GAAG/D,QAAA;MAEhC,QAAAgE,YAAyB,GAAG,GAAG,GAAGhE,QAAA;AAItC,QAAMiE,KAAIL,OAAMC;AAChB,EAAArJ,KAAIsJ,MAAK,MAAMG,MAAK,KAAKL,OAAMC,SAAQI,MAAKL,OAAMC;AAClD,UAAQD,MAAR;IACE,KAAK9H;AACH,MAAAgC,OAAM6F,KAAI1I,MAAKgJ,KAAI,KAAK;AACxB;IACF,KAAKN;AACH,MAAA7F,OAAM7C,KAAIa,MAAKmI,KAAI,KAAK;AACxB;IACF,KAAKhJ;AACH,MAAA6C,OAAMhC,KAAI6H,MAAKM,KAAI,KAAK;AACxB;EACH;AAED,MAAI,aACF,QAAAF,QAAuBjG,KAAI,KAAKtD,IAAGsJ,IAAG9D,QAAA;MAEtC,QAAAgE,YAAyBlG,IAAGtD,KAAI,KAAKsJ,KAAI,KAAK9D,QAAA;AAEjD;ACvPD,IAAakE,mBAAkB,CAACzG,MAAkB0G,SAAqB;AACrE,MAAI,KAAK,YAAa,MAAK,eAAe,MAAM,UAAU,KAAK,WAAA;AAC/D,MAAI,KAAK,YACP,MAAK,eAAe,MAAM,gBAAgB,KAAK,YAAY,SAAA,CAAU;AAEvE,MAAI,KAAK,WAAY,MAAK,aAAa,oBAAoB,KAAK,UAAA;AAChE,MAAI,KAAK,cACP,MAAK,aAAa,kBAAkB,KAAK,aAAA;AAE5C;ACbD,IAAaC,gBAAe,CAC1BC,IACAC,MACAC,iBACqB;AACrB,QAAMnG,KAAIH,UAA2B,UAAU,EAAA;AAE/C,MAAI,KAAK,YACP,CAAAG,GAAE,aAAa,eAAe,KAAK,aAAa,SAAA,CAAU;AAE5D,MAAI,KAAK,aACP,CAAAA,GAAE,aAAa,gBAAgB,KAAK,cAAc,SAAA,CAAU;AAE9D,MAAI,KAAK,OAAQ,CAAAA,GAAE,aAAa,UAAU,KAAK,OAAO,SAAA,CAAU;MAC3D,CAAAA,GAAE,aAAa,UAAU,oBAAoB;AAElD,MAAI,KAAK,QAAS,CAAAA,GAAE,aAAa,WAAW,KAAK,QAAQ,SAAA,CAAU;AACnE,MAAI,KAAK,KAAM,CAAAA,GAAE,aAAa,QAAQ,KAAK,KAAK,SAAA,CAAU;AAC1D,MAAI,KAAK,KAAM,CAAAA,GAAE,aAAa,QAAQ,KAAK,KAAK,SAAA,CAAU;AAE1D,MAAI,cAAc;AAChB,UAAMvC,KAAI,aAAA;AACV,IAAAuC,GAAE,YAAYvC,EAAA;EACf;AACD,SAAOuC;AACR;AAED,IAAaoG,kBAAiB,CAC5BC,MACAH,MACAI,aACW;AACX,MAAI,SAAS,KAAM,QAAO;AAE1B,QAAM,SAAS,KAAK;AACpB,MAAI,WAAW,KAAM,OAAM,IAAI,MAAM,yBAAyB;AAC9D,QAAM,SAASrG,iBAAgC,QAAQ,QAAQ,MAAM;AAGrE,MAAI,QAAQ,OAAO,cAAc,IAAK,KAAK,EAAA,EAAK;AAEhD,MAAI,UAAU,KACZ,QAAO,QAAS,KAAK,EAAA;AAGvB,MAAI,KAAK,OAAO,YAAY;AAC1B,WAAO;MAAE,GAAG;MAAM,aAAa;IAAe;AAC9C,QAAI,CAAC,KAAK,aAAc,QAAO;MAAE,GAAG;MAAM,cAAc;IAAG;AAC3D,QAAI,CAAC,KAAK,YAAa,QAAO;MAAE,GAAG;MAAM,aAAa;IAAG;AACzD,QAAI,CAAC,KAAK,KAAM,QAAO;MAAE,GAAG;MAAM,MAAM,KAAK;IAAa;AAC1D,QAAI,CAAC,KAAK,KAAM,QAAO;MAAE,GAAG;MAAM,MAAM,KAAK;IAAc;AAC3D,QAAI,CAAC,KAAK,aAAa,KAAK,cAAc,OACxC,QAAO;MAAE,GAAG;MAAM,WAAW;IAAS;AAExC,QAAI,CAAC,KAAK,QAAS,QAAO;MAAE,GAAG;MAAM,SAAS;IAAa;AAE3D,YAAQ+F,cAAa,KAAK,IAAI,MAAM,MAAM;AACxC,YAAM,MAAMnG,UAAyB,MAAM;AAC3C,UAAI,aAAa,KAAK,uBAAuB;AAC7C,UAAI,KAAM,CAAAT,WAAU,KAAK,IAAA;AACzB,aAAO;IACR,CAAA;EACF,MAAM,OAAM,IAAI,MAAM,2BAA4B,KAAK,EAAA,EAAK;AAG7D,QAAM,KAAK,KAAK;AAChB,SAAO,YAAY,KAAA;AAEnB,SAAO,QAAS,KAAK,EAAA;AACtB;AC/DD,IAAamH,iBAAgB,CAAClH,MAAkBmH,SAA0B;AACxE,MAAI,KAAK,UACP,MAAK,aACH,cACAJ,gBAAe,MAAM,KAAK,WAAW,IAAA,CAAoB;AAG7D,MAAI,KAAK,YACP,MAAK,aACH,gBACAA,gBAAe,MAAM,KAAK,aAAa,IAAA,CAAoB;AAG/D,MAAI,KAAK,UACP,MAAK,aACH,cACAA,gBAAe,MAAM,KAAK,WAAW,IAAA,CAAoB;AAG9D;;;;;;;;;;;;;;;;;;ACRD,IAAMK,sBAAqB,CAACC,OAAsB;AAChD,MAAIC,MAAK,KAAKA,MAAK,EAAG,QAAO,GAAIA,KAAI,GAAA;AACrC,SAAOA,GAAE,SAAA;AACV;AAiBD,IAAaC,QAAO,CAClBC,YACA3G,QACA4G,MACAC,oBACmB;AACnB,QAAM,OAAO9G,iBACX,QACA,QACA,eAAA;AAEF,QAAM,MACJ,OAAO,eAAe,WAAW,aAAa,WAAW,KAAK;CAAI;AAEpE,OAAK,eAAe,MAAM,KAAK,GAAA;AAC/B,SAAO,OAAO,IAAA;AACd,SAAO+G,YAAW,MAAM,IAAA;AACzB;AAED,IAAaA,cAAa,CACxBC,MACAH,SACG;AACH,MAAI,KAAM,CAAA1H,WAAU,MAAM,IAAA;AAC1B,MAAI,KAAM,CAAA0G,iBAAgB,MAAM,IAAA;AAChC,SAAO;AACR;AASD,IAAaoB,gBAAe,CAC1BC,MACAC,UACAC,SACG;AACH,OAAK,eAAe,MAAM,MAAMtI,SAAO,EAAE,SAAA,CAAU;AACnD,OAAK,eAAe,MAAM,MAAMA,SAAO,EAAE,SAAA,CAAU;AACnD,OAAK,eAAe,MAAM,KAAKA,SAAO,OAAO,SAAA,CAAU;AACvD,MAAI,KAAM,CAAAK,WAAU,MAAM,IAAA;AAC1B,MAAI,KAAM,CAAA0G,iBAAgB,MAAM,IAAA;AAEhC,SAAO;AACR;AAYD,IAAa/G,UAAS,CACpBqI,UACAlH,QACAmH,MACAC,oBACqB;AACrB,QAAMrJ,KAAIgC,iBACR,QACA,UACA,eAAA;AAEF,SAAOiH,cAAajJ,IAAGc,UAAQ,IAAA;AAChC;AAWD,IAAawI,SAAQ,CACnBC,WACAtH,QACAuH,oBACgB;AAChB,QAAMxJ,KAAIgC,iBAA6B,QAAQ,KAAK,eAAA;AACpD,SAAOyH,aAAYzJ,IAAG0J,SAAA;AACvB;AAED,IAAaD,eAAc,CACzBE,MACAJ,cACG;AACH,aAAW/J,MAAKkK,UACd,KAAIlK,GAAE,eAAe,KACnB,MAAK,OAAOA,EAAA;AAIhB,SAAO;AACR;AAWD,IAAaoK,QAAO,CAClBC,QACA5H,QACA6H,MACAC,oBACmB;AACnB,QAAM,SAAS/H,iBACb,QACA,QACA,eAAA;AAEF,SAAOgI,YAAW,QAAQJ,QAAM,IAAA;AACjC;AASD,IAAaI,cAAa,CACxBC,QACAJ,QACAC,SACG;AACH,SAAO,eAAe,MAAM,MAAMF,OAAK,EAAE,EAAE,SAAA,CAAU;AACrD,SAAO,eAAe,MAAM,MAAMA,OAAK,EAAE,EAAE,SAAA,CAAU;AACrD,SAAO,eAAe,MAAM,MAAMA,OAAK,EAAE,EAAE,SAAA,CAAU;AACrD,SAAO,eAAe,MAAM,MAAMA,OAAK,EAAE,EAAE,SAAA,CAAU;AACrD,MAAI,KAAM,CAAAzI,WAAU,QAAQ,IAAA;AAC5B,MAAI,KAAM,CAAAmH,eAAc,QAAQ,IAAA;AAChC,MAAI,KAAM,CAAAT,iBAAgB,QAAQ,IAAA;AAClC,SAAO;AACR;AAED,IAAaqC,kBAAiB,CAACD,QAAwBE,KAAqBL,SAA2B;AACrG,QAAMrC,KAAA,cAA0B,GAAA;AAChC,SAAO,eAAe,MAAM,MAAMA,GAAE,EAAE,EAAE,SAAA,CAAU;AAClD,SAAO,eAAe,MAAM,MAAMA,GAAE,EAAE,EAAE,SAAA,CAAU;AAClD,SAAO,eAAe,MAAM,MAAMA,GAAE,EAAE,EAAE,SAAA,CAAU;AAClD,SAAO,eAAe,MAAM,MAAMA,GAAE,EAAE,EAAE,SAAA,CAAU;AAClD,MAAI,KAAM,CAAAtG,WAAU,QAAQ,IAAA;AAC5B,MAAI,KAAM,CAAAmH,eAAc,QAAQ,IAAA;AAChC,MAAI,KAAM,CAAAT,iBAAgB,QAAQ,IAAA;AAClC,SAAO;AACR;AASD,IAAauC,kBAAiB,CAC5BC,KACAC,QACAC,SACG;AACH,MAAI,MAAM,OAAQ,CAAArM,IAAG,eAAe,MAAM,UAAU,KAAK,MAAA;AACzD,MAAI,MAAM,KAAM,CAAAA,IAAG,eAAe,MAAM,QAAQ,KAAK,IAAA;AACrD,MAAI,MAAM,QAAS,CAAAA,IAAG,eAAe,MAAM,WAAW,KAAK,OAAA;AAC3D,MAAI,MAAM,YACR,CAAAA,IAAG,eAAe,MAAM,eAAesK,oBAAmB,KAAK,WAAA,CAAY;AAE7E,MAAI,MAAM,WACR,CAAAtK,IAAG,eAAe,MAAM,cAAcsK,oBAAmB,KAAK,UAAA,CAAW;AAG3E,MAAI9H,OACF,CAAAxC,IAAG,cAAcwC;AAEnB,MAAI,KAAM,CAAAS,WAAUjD,KAAI,IAAA;AACxB,MAAI,KAAM,CAAA2J,iBAAgB3J,KAAI,IAAA;AAC9B,SAAOA;AACR;AAYD,IAAasM,YAAW,CACtBC,eACArK,QACA6B,QACAsI,MACAG,qBACAC,wBACuB;AACvB,QAAM,SAAS3I,iBACb,QACA,QACA,qBAAqB,OAAO;AAG9B,EAAA4I,YAAW,QAAQ,QAAW,QAAW,IAAA;AAEzC,QAAM5K,KAAIgC,iBACR,QACA,YACA,mBAAA;AAEF,EAAAhC,GAAE,eAAe,MAAM,QAAQ,aAAA;AAC/B,SAAOoK,gBAAepK,IAAGU,QAAM,IAAA;AAChC;AAUD,IAAakK,cAAa,CACxBC,KACAC,KACAR,QACAS,SACG;AACH,MAAI,KAAK;AACP,IAAA7M,IAAG,eAAe,MAAM,KAAK,IAAI,EAAE,SAAA,CAAU;AAC7C,IAAAA,IAAG,eAAe,MAAM,KAAK,IAAI,EAAE,SAAA,CAAU;EAC9C;AACD,MAAIwC,OACF,CAAAxC,IAAG,cAAcwC;AAGnB,MAAI,MAAM;AACR,IAAAS,WAAUjD,KAAI,IAAA;AACd,QAAI,KAAM,CAAA2J,iBAAgB3J,KAAI,IAAA;AAE9B,QAAI,KAAK,OAAQ,CAAAA,IAAG,eAAe,MAAM,eAAe,KAAK,MAAA;AAC7D,QAAI,KAAK,MAAO,CAAAA,IAAG,eAAe,MAAM,sBAAsB,KAAK,KAAA;AAEnE,UAAM,aAAa,KAAK,cAAc;AAEtC,QAAI,CAAC,WACH,CAAAA,IAAG,MAAM,aAAa;EAEzB;AACD,SAAOA;AACR;AAWD,IAAawC,QAAO,CAClBN,QACA6B,QACA6I,KACAC,MACAC,oBACmB;AACnB,QAAMhL,KAAIgC,iBACR,QACA,QACA,eAAA;AAEF,SAAO4I,YAAW5K,IAAG,KAAKU,QAAM,IAAA;AACjC;AAeD,IAAauK,QAAO,CAClBhJ,QACAiJ,WACAC,SACAC,OACAC,SACAC,OAAwB,CAAE,MACvB;AACH,MAAI,CAAC,KAAK,YACR,QAAO;IAAE,GAAG;IAAM,aAAaC,eAAkB,UAAU,QAAQ;EAAG;AAExE,MAAI,CAAC,KAAK,YAAa,QAAO;IAAE,GAAG;IAAM,aAAa;EAAG;AAEzD,QAAMjE,KAAI1F,UAAsB,GAAG;AACnC,EAAAT,WAAUmG,IAAG,IAAA;AACb,EAAAgB,eAAchB,IAAG,IAAA;AACjB,EAAAO,iBAAgBP,IAAG,IAAA;AAGnB,MAAI5I,KAAI;AACR,SAAOA,KAAIM,SAAQ;AACjB,UAAM,QAAA,cAA0B,GAAGN,IAAG,OAAOA,EAAA;AAC7C,IAAAkL,MAAK,OAAOtC,EAAA;AACZ,IAAA5I,MAAK;EACN;AAGD,MAAID,KAAI;AACR,SAAOA,KAAI,OAAO;AAChB,UAAM,OAAA,cAAyBA,IAAG,GAAGA,IAAGO,OAAA;AACxC,IAAA4K,MAAK,MAAMtC,EAAA;AACX,IAAA7I,MAAK;EACN;AACD,SAAO,OAAO6I,EAAA;AACd,SAAOA;AACR;AC7WD,IAAakE,mBAAkB,CAACC,QAA6B;AAC3D,MAAI,CAACvN,IAAI,OAAM,IAAI,MAAM,yBAAyB;AAClD,QAAMiH,KAAI;IAAE,GAAGjH,IAAG,GAAG,QAAQ;IAAO,GAAGA,IAAG,GAAG,QAAQ;EAAO;AAC5D,QAAMU,KAAI;IAAE,GAAGV,IAAG,GAAG,QAAQ;IAAO,GAAGA,IAAG,GAAG,QAAQ;EAAO;AAC5D,SAAO;IAAE,GAAAiH;IAAG,GAAAvG;EAAG;AAChB;AAED,IAAa8M,uBAAsB,CAACD,KAAoBE,WAAkC;AACxF,QAAMlE,KAAI+D,iBAAgBtN,GAAA;AAC1B,SAAA,SAA0BuJ,IAAG,MAAA;AAC9B;AChBD,IAAamE,UAAS,CACpB3J,QACA4J,oBACG;AACH,MAAI,OAAO,oBAAoB,UAAU;AACvC,UAAM,OAAO,OAAO,cAAc,eAAA;AAClC,QAAI,SAAS,KAAM;AACnB,SAAK,OAAA;EACN,MACC,iBAAgB,OAAA;AAEnB;AAMD,IAAaC,SAAQ,CAAC7J,WAAuB;AAC3C,MAAIzC,KAAI,OAAO;AACf,SAAOA,IAAG;AACR,IAAAA,GAAE,OAAA;AACF,IAAAA,KAAI,OAAO;EACZ;AACF;ACiGD,IAAauM,cAAa,CACxB9J,QACA+J,eACc;AACd,MAAI,YAAY;AACd,IAAA7K,WAAU,QAAQ,UAAA;AAClB,IAAA0G,iBAAgB,QAAQ,UAAA;EACzB;AAED,QAAMoE,KAAe;IACnB,QAAQ,CAACC,oBAAyC;AAAE,MAAAN,QAAO,QAAQ,eAAA;IAAmB;IACtF,MAAM,CACJxL,QACA+L,KACApB,MACAC,oBAAAA,MACiBtK,QAAM,QAAQ,KAAK,MAAM,eAAA;IAC5C,UAAU,CACR+J,eACArK,QACA2K,MACAL,qBACAC,wBAAAA,UACqB,eAAejK,QAAM,QAAQ,MAAM,qBAAqB,mBAAA;IAC/E,MAAM,CACJmJ,QACAC,MACAC,oBAAAA,MACiBH,QAAM,QAAQ,MAAM,eAAA;IACvC,QAAQ,CACNT,UACAC,MACAC,oBAAAA,QACmBvI,UAAQ,QAAQ,MAAM,eAAA;IAC3C,MAAM,CACJsL,WACAvD,MACAC,oBAAAA,MACiB,WAAW,QAAQ,MAAM,eAAA;IAC5C,MAAM,CACJoC,WACAC,SACAC,OACAC,SACAvB,SAAAA,MACiB,QAAQuC,WAAQ,SAAS,OAAOrN,SAAQ,IAAA;IAC3D,OAAO,CAAuBsN,cAC5B,OAAO,cAAc,SAAA;IACvB,IAAI,QAAgB;AAClB,YAAM9K,KAAI,OAAO,eAAe,MAAM,OAAO;AAC7C,UAAIA,OAAM,KAAM,QAAO;AACvB,aAAO,OAAO,WAAWA,EAAA;IAC1B;IACD,IAAI,MAAM4J,OAAe;AACvB,aAAO,eAAe,MAAM,SAAS,MAAM,SAAA,CAAU;IACtD;IACD,IAAI,SAAqB;AACvB,aAAO;IACR;IACD,IAAI,SAAiB;AACnB,YAAM5J,KAAI,OAAO,eAAe,MAAM,QAAQ;AAC9C,UAAIA,OAAM,KAAM,QAAO;AACvB,aAAO,OAAO,WAAWA,EAAA;IAC1B;IACD,IAAI,OAAO6J,SAAgB;AACzB,aAAO,eAAe,MAAM,UAAUrM,QAAO,SAAA,CAAU;IACxD;IACD,OAAO,MAAM;AACX,aAAO,OAAO,WACX,QAAO,UAA0B,OAAA;IAErC;EACF;AACD,SAAOgE;AACR;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AGtLD,IAAauJ,YAAW,CAACC,QAAwBC,aAAmC;AAClF,QAAMC,SAAO,OAAO;AACpB,QAAM,OAAO,OAAQ,CAAA,EAAI;AACzB,QAAMC,OAAmB,CAAE;AAC3B,WAAS,MAAM,GAAG,MAAMD,QAAM,OAAO;AACnC,SAAM,GAAA,IAAQ,CAAE;AAChB,aAAS,MAAM,GAAG,MAAM,MAAM,MAC5B,MAAM,GAAA,EAAO,GAAA,IAAQ,OAAQ,GAAA,EAAO,GAAA,IAAQE;EAE/C;AACD,SAAO;AACR;AAGD,SAAgBC,cAA6BC,MAAsBC,QAAgCC,QAAmCC,SAAyD;AAC7L,QAAMC,oBAAuD,OAAO,IAAI,CAAAC,OAAK;AAE3E,UAAM,MAAA,OAAmB,QAAQ,MAAMA,GAAE,MAAM,MAAM;AAGrD,QAAIC;AACJ,QAAIC;AAEJ,QAAI,KAAK;AACP,oBAAc,OAAO,IAAI,KAAK,WAAW;AACzC,oBAAcF,GAAE;IACjB;AAED,WAAO;MAAE,MAAMA,GAAE;MAAM,OAAO;MAAa,QAAQA,GAAE;IAAO;EAC7D,CAAA;AACD,SAAOG,QAAO,iBAAA;AACf;AAOD,UAAiBC,eAAcf,QAAwBgB,OAAkB;AAEvE,QAAM,kBAAAC,MAAqC,KAAA;AAC3C,SAAOC,UAAS,QAAQ,iBAAA,MAAgC,eAAA,GAAkBC,WAAA;AAC3E;AAED,UAAiBD,UAAyBE,QAAyBZ,QAAmCa,SAAmCZ,SAAsCa,QAA0E;AACvP,MAAI,CAAC,QAAQ;AACX,UAAM,aAAa,OAAO;AAC1B,UAAM,aAAa,OAAQ,CAAA,EAAI;AAC/B,aAAS;MAAE,GAAG,KAAK,MAAM,aAAa,CAAA;MAAI,GAAG,KAAK,MAAM,aAAa,CAAA;IAAI;EAC1E;AAED,QAAMC,WAAUC,iBAAgB,QAAQ,MAAA;AAKxC,aAAW,QAAQ,SAAS;AAC1B,UAAMC,SAAQpB,cAA6B,MAAMkB,UAAS,QAAQT,OAAA;AAClE,UAAM;MAAE;MAAM,OAAAW;IAAO;EACtB;AACF;AAWD,IAAaD,mBAAkB,CAAIE,QAAmBJ,WAA8C;AAClG,QAAMK,UAA4B,CAAE;AACpC,QAAMzB,SAAO,OAAO;AACpB,QAAM,OAAO,OAAQ,CAAA,EAAI;AACzB,MAAI,CAAC,OACH,UAAS;IACP,GAAG,KAAK,MAAMA,SAAO,CAAA;IACrB,GAAG,KAAK,MAAM,OAAO,CAAA;EACtB;AAGH,WAAS,KAAK,GAAG,KAAKA,QAAM,KAC1B,UAAS,KAAK,GAAG,KAAK,MAAM,MAAM;AAChC,UAAM0B,KAA+B;MACnC,MAAM;QAAE,GAAG,KAAK,OAAO;QAAG,GAAG,KAAK,OAAO;MAAG;MAC5C,OAAO,OAAQ,EAAA,EAAM,EAAA;IACtB;AACD,YAAQ,KAAKC,EAAA;EAEd;AAEH,SAAO;AACR;AAED,IAAaC,cAA4C,CAACC,YAA+C;AACvG,MAAIC,KAAI;AACR,MAAIC,KAAI;AACR,MAAIC,KAAI;AACR,MAAIC,WAAU;AACd,aAAWV,UAASW,SAAQ;AAC1B,UAAM,MAAMX,OAAM;AAClB,UAAM,cAAcA,OAAM;AAC1B,QAAI,CAAC,IAAK;AACV,QAAI,IAAI,YAAY,EAAG;AACvB,QAAI,gBAAgB,EAAG;AACvB,IAAAO,MAAM,IAAI,IAAI;AACd,IAAAC,MAAM,IAAI,IAAI;AACd,IAAAC,MAAM,IAAI,IAAI;AACd,IAAAC,aAAa,IAAI,WAAW,KAAK;EAClC;AAED,QAAME,SAAkB;IACtB,GAAAL;IAAG,GAAAC;IAAG,GAAAC;IACN,MAAM;IACN,OAAO;IACP,SAAAC;EACD;AACD,SAAO;AACR;AACD,IAAaG,kBAAiB;EAC5B;IAAE;IAAG;IAAG;EAAG;EACX;IAAE;IAAG;IAAG;EAAG;EACX;IAAE;IAAG;IAAG;EAAG;AACZ;AAED,IAAaC,uBAAsB;EACjC;IAAE;IAAG;IAAI;EAAG;EACZ;IAAE;IAAI;IAAG;EAAI;EACb;IAAE;IAAG;IAAI;EAAG;AACb;AAED,IAAaC,iBAAgB;EAC3B;IAAE;IAAG;IAAI;EAAG;EACZ;IAAE;IAAI;IAAG;EAAI;EACb;IAAE;IAAG;IAAI;EAAG;AACb;AAED,IAAaC,iBAAgB1C,UAAS;EACpC;IAAE;IAAG;IAAG;EAAG;EACX;IAAE;IAAG;IAAG;EAAG;EACX;IAAE;IAAG;IAAG;EAAG;AACZ,GAAE,IAAI,CAAA;AAEP,IAAa2C,uBAAsB3C,UAAS;EAC1C;IAAE;IAAG;IAAG;EAAG;EACX;IAAE;IAAG;IAAG;EAAG;EACX;IAAE;IAAG;IAAG;EAAG;AACZ,GAAE,IAAI,EAAA;AAEP,IAAa4C,uBAAsB5C,UAAS;EAC1C;IAAE;IAAG;IAAG;IAAG;IAAG;EAAG;EACjB;IAAE;IAAG;IAAI;IAAI;IAAI;EAAG;EACpB;IAAE;IAAG;IAAI;IAAI;IAAI;EAAG;EACpB;IAAE;IAAG;IAAI;IAAI;IAAI;EAAG;EACpB;IAAE;IAAG;IAAG;IAAG;IAAG;EAAG;AAClB,GAAE,IAAI,GAAA;AAEP,IAAa6C,yBAAwB7C,UAAS;EAC5C;IAAE;IAAG;IAAG;IAAG;IAAG;EAAG;EACjB;IAAE;IAAG;IAAI;IAAI;IAAI;EAAG;EACpB;IAAE;IAAG;IAAI;IAAM;IAAI;EAAG;EACtB;IAAE;IAAG;IAAI;IAAI;IAAI;EAAG;EACpB;IAAE;IAAG;IAAG;IAAG;IAAG;EAAG;AAClB,GAAE,KAAK,GAAA;;;AC/IR,IAAa8C,UAAS,CAACC,cACrB,IAAIC,wBAAuB,SAAA;AAE7B,IAAMA,0BAAN,MAA6B;EAClBC,SAA8B,oBAAI,IAAA;EAClCC,WAAgC,oBAAI,IAAA;EAEpC;EACT,gBAAgB;EAEhB;EAEA,YAAYH,WAAmC;AAC7C,QAAI,cAAc,OAAW,MAAK,YAAY;QACzC,MAAK,YAAY;MAAE;MAAO;MAAQ;MAAS;IAAU;AAC1D,SAAKI,eAAe,SAAS;EAC9B;EAED,eAAeC,KAAa;AAC1B,SAAKD,eAAeE;EACrB;EAED,IAAIC,KAAaC,QAAgB;AAC/B,SAAKN,OAAO,IAAI,KAAK,MAAA;EACtB;EAED,MAAMO,OAAcC,KAAY;AAC9B,SAAKP,SAAS,IAAIQ,OAAMC,GAAA;EACzB;EAED,IAAIL,KAAaM,UAA2B;AAC1C,UAAM,QAAQ,KAAKV,SAAS,IAAI,GAAA;AAChC,QAAI,UAAU,OAAW,OAAM;AAE/B,UAAMW,KAAI,KAAKZ,OAAO,IAAI,GAAA;AAC1B,QAAIY,OAAM,OAAW,QAAOA;AAE5B,UAAM,eAAe,OAAO;AAC5B,QAAIC,YAAU,iBAAiB,KAAKX,YAAAA,EACjC,iBAAiB,YAAA,EACjB,KAAA;AAGH,QAAIW,cAAY,UAAaA,UAAQ,WAAW,GAAG;AACjD,UAAI,aAAa,OAAW,QAAO;AACnCA,kBAAU,KAAK,UAAW,KAAKC,aAAAA;AAC/B,WAAKA;AACL,UAAI,KAAKA,kBAAkB,KAAK,UAAU,OAAQ,MAAKA,gBAAgB;IACxE;AACD,WAAOD;EACR;EAED,SAASR,KAAaM,UAA2B;AAC/C,QAAI,KAAK,IAAI,GAAA,EAAM,QAAO,KAAK,IAAI,GAAA;AACnC,UAAMC,KAAI,KAAK,IAAI,KAAK,QAAA;AACxB,SAAK,IAAI,KAAKA,EAAA;AACd,WAAOA;EACR;EAED,IAAIP,KAAsB;AACxB,WAAO,KAAKL,OAAO,IAAI,GAAA;EACxB;AACF;;;;;;;ACHD,gBAAuBe,QACrBC,eACAC,OAAmB,CAAE,GACK;AAI1B,QAAM,gBAAgB,KAAK,iBAAiB;AAE5C,QAAM,aAAa,KAAK,cAAc;AACtC,MAAI,WAAW,KAAK;AACpB,MAAIC,IAAGC;AACP,EAAAD,KAAIC,KAAI;AAGR,MAAI,aAAa,QAAW;AAC1B,eAAW,SAAS,cAAc,QAAQ;AAC1C,aAAS,UAAU,IAAI,aAAa;AACpC,QAAI,CAAC,WACH,UAAS,MAAM,UAAU;AAE3B,aAAS,KAAK,YAAY,QAAA;EAC3B;AAGD,QAAM,aAAa,MAAM;AACvB,QAAI,aAAa,OAAW;AAC5B,IAAAD,KAAI,cAAc;AAClB,IAAAC,KAAI,cAAc;AAClB,aAAS,QAAQD;AACjB,aAAS,SAASC;EACnB;AAED,MAAIC,KAAqC;AAEzC,QAAM,SAAS,UAAU,aAAA;AACzB,mBAAiBC,MAAK,QAAQ;AAE5B,QAAIH,OAAM,KAAKC,OAAM,EAAG,YAAA;AAGxB,QAAID,OAAM,KAAKC,OAAM,EAAG;AAGxB,IAAAP,OAAM,SAAS,WAAW,IAAI;AAC9B,QAAIA,OAAM,KAAM;AAChB,IAAAA,GAAE,UAAU,eAAe,GAAG,GAAGM,IAAGC,EAAA;AAGpC,UAAM,SAASP,GAAE,aAAa,GAAG,GAAGM,IAAGC,EAAA;AACvC,UAAM;EACP;AACF;AAuDD,IAAaG,WAAU,CACrBN,eACAO,OAAoB,CAAE,MACT;AACb,QAAM,gBAAgB,KAAK,iBAAiB;AAC5C,QAAM,aAAa,KAAK,cAAc;AACtC,QAAM,UAAU,KAAK;AAGrB,QAAML,KAAI,cAAc;AACxB,QAAMC,KAAI,cAAc;AAGxB,QAAM,WAAW,SAAS,cAAc,QAAQ;AAChD,WAAS,UAAU,IAAI,cAAc;AAErC,MAAI,CAAC,WACH,UAAS,MAAM,UAAU;AAE3B,WAAS,QAAQD;AACjB,WAAS,SAASC;AAClB,MAAIC,KAAqC;AACzC,MAAII;AACJ,MAAI,KAAK,aACP,UAAS,IAAI,OAAO,KAAK,YAAA;AAI3B,QAAM,YAAY,UAAU;AAC5B,MAAI,CAAC,aAAa,CAAC,WACjB,SAAQ,KACN,yFAAyF;AAI7F,QAAM,OAAO,aAAa,MAAM;AAE9B,QAAIZ,OAAM,KAAM,CAAAA,KAAI,SAAS,WAAW,IAAI;AAC5C,QAAIA,OAAM,KAAM;AAChB,IAAAA,GAAE,UAAU,eAAe,GAAG,GAAGM,IAAGC,EAAA;AACpC,QAAIM;AAEJ,QAAI,UAEF,UAASb,GAAE,aAAa,GAAG,GAAGM,IAAGC,EAAA;AAGnC,QAAI,OAEF,QAAO,YACL;MACE,QAAQ,OAAQ,KAAK;MACrB,OAAOD;MACP,QAAQC;MACR,UAAU;IACX,GACD,CAAE,OAAQ,KAAK,MAAQ,CAAA;AAG3B,QAAI,QAEF,KAAI;AACF,cAAQ,MAAA;IACT,SAAQO,IAAG;AACV,cAAQ,MAAMA,EAAA;IACf;EAEJ,GAAE,aAAA;AAEH,SAAO;IACL,OAAO,MAAM;AAAE,WAAK,MAAA;IAAU;IAC9B,QAAQ,MAAM;AAAE,WAAK,OAAA;IAAW;IAChC;EACD;AACF;AAED,IAAaC,iBAAgB,CAC3BX,eACAY,OAA0B,CAAE,MACT;AACnB,QAAM,aAAa,KAAK,cAAc;AAGtC,QAAMV,KAAI,cAAc;AACxB,QAAMC,KAAI,cAAc;AAGxB,QAAM,kBAAkB,KAAK,aAAa;AAC1C,MAAI,WAAW,KAAK;AACpB,MAAI,CAAC,UAAU;AACb,eAAW,SAAS,cAAc,QAAQ;AAC1C,aAAS,UAAU,IAAI,cAAc;AACrC,aAAS,KAAK,OAAO,QAAA;AACrB,QAAI,CAAC,WAAY,UAAS,MAAM,UAAU;EAC3C;AAED,WAAS,QAAQD;AACjB,WAAS,SAASC;AAElB,QAAMG,YAAU,MAAiB;AAC/B,QAAIO;AAGJ,QAAI,CAACjB,IAAGA,OAAI,SAAS,WAAW,MAAM,EAAE,oBAAoB,KAAM,CAAA;AAClE,QAAI,CAACA,IAAG,OAAM,IAAI,MAAM,mCAAmC;AAC3DA,QAAE,UAAU,eAAe,GAAG,GAAGM,IAAGC,EAAA;AAEpC,UAAM,SAASP,IAAE,aAAa,GAAG,GAAGM,IAAGC,EAAA;AAEtC,WAAe,cAAc,cAAc;AAE5C,QAAI,KAAK,gBAAiB,MAAK,gBAAgBP,KAAGM,IAAGC,EAAA;AACrD,WAAO;EACR;AAED,QAAM,UAAU,MAAY;AAC1B,QAAI,gBAAiB;AACrB,QAAI;AACF,eAAS,OAAA;IACV,SAAQE,IAAG;IAEX;EACF;AAED,QAAMS,KAAoB;IACxB;IACA,SAAA;IACA;EACD;AACD,SAAOlB;AACR;;;ACpSD,SAASmB,qBAAoBC,KAAiBC,MAAcC,cAAsB;AAChF,QAAMC,KAAI/B,IAAG,aAAa,IAAA;AAC1B,MAAI+B,OAAM,KAAM,QAAO;AACvB,SAAO,OAAO,SAASA,EAAA;AACxB;AAoBD,IAAaC,QAAO,CAACC,cAAsBC,UAA8B,CAAE,MAAkB;AAC3F,QAAM,UAAU,SAAS,cAAiC,YAAA;AAC1D,MAAI,CAAC,QAAS,OAAM,IAAI,MAAM,qCAAsC,YAAA,GAAgB;AACpF,QAAM,SAAS,QAAQ,UAAU,CAAE,KAAK,GAAK;AAC7C,QAAM,iBAAiB,QAAQ,kBAAkB;AACjD,QAAM,gBAAgB,QAAQ,iBAAiB;AAC/C,QAAM,oBAAoB,QAAQ,qBAAqB;AAEvD,QAAM,eAAe,QAAQ,gBAAgB;AAC7C,QAAM,UAAU,QAAQ,WAAW;AACnC,QAAM,aAAa,QAAQ,cAAc;AACzC,QAAM,sBAAsB,QAAQ,uBAAuB;AAE3D,QAAM,aAAAC,eAAkC,QAAQ,YAAY,QAAQ;AACpE,QAAM,WAAAA,eAAgC,QAAQ,UAAU,OAAO;AAC/D,QAAM,gBAAAA,eAAqC,QAAQ,eAAe,OAAO;AACzE,QAAM,YAAAA,eAAiC,QAAQ,WAAW,QAAQ,eAAe,OAAO;AACxF,QAAM,cAAAA,eAAmC,QAAQ,aAAa,QAAQ,YAAY,QAAQ;AAG1F,QAAM,YAAa,QAAQ,aAAa,IAAI,OAAO;AACnD,QAAM,YAAa,QAAQ,aAAa,IAAI,OAAO;AACnD,QAAM,MAAO,QAAQ,WAAW,KAAK,OAAO;AAC5C,QAAM,cAAe,QAAQ,eAAe,IAAI,OAAO;AACvD,QAAM,QAAS,QAAQ,SAASR,qBAAoB,SAAS,SAAS,GAAA,IAAO,OAAO;AACpF,QAAMS,UAAU,QAAQ,UAAUT,qBAAoB,SAAS,UAAU,GAAA,IAAO,OAAO;AAEvF,MAAIU;AACJ,MAAI,oBAAoB,EACtB,cAAa,IAAIC,gBAAiC;IAChD,UAAU;IACV,eAAe;EAChB,CAAA;AAGH,UAAQ,QAAQ;AAChB,UAAQ,SAASF;AACjB,UAAQ,MAAM,QAAQ,GAAK,QAAQ,OAAO,gBAAA;AAC1C,UAAQ,MAAM,SAAS,GAAKA,UAAS,OAAO,gBAAA;AAE5C,QAAM,OAAOA,UAAS;AACtB,QAAM,OAAO,QAAQ;AACrB,QAAM,MAAM,QAAQ,WAAW,IAAI;AACnC,MAAI,CAAC,IAAK,OAAM,IAAI,MAAM,kCAAkC;AAE5D,MAAI,OAAO,oBAAoB,EAC7B,KAAI,OAAO;AAEb,QAAM,mBAAmB,CAACG,OAAc,GAAI,KAAK,MAAM9D,KAAI,GAAA,CAAI;AAC/D,QAAM,cAAc,CAAC8D,OAAc9D,GAAE,QAAQ,cAAA;AAE7C,QAAM,cAAc,gBAAgB,mBAAmB;AACvD,MAAI,YAAY;AACd,WAAQ,CAAA,IAAM,OAAQ,CAAA,IAAM;AAC5B,WAAQ,CAAA,IAAM,OAAQ,CAAA,IAAM;EAC7B,OAAM;AACL,WAAQ,CAAA,IAAM;AACd,WAAQ,CAAA,IAAM;EACf;AAED,QAAM+D,mBAA2B,QAAQ,qBAAqB,CAACC,OAAKC,SAAON,cAAiB;AAC1F,QAAI,QAAQ,aAAa,cACvBK,OAAI,UAAU,GAAG,GAAGC,SAAON,SAAAA;SACtB;AACLK,YAAI,YAAY;AAChBA,YAAI,SAAS,GAAG,GAAGC,SAAON,SAAAA;IAC3B;EACF;AAED,SAAO,CAACO,IAAWC,OAAc;AAC/B,IAAAC,KAAA,QAAkBA,EAAA;AAClB,IAAAC,KAAA,QAAkBA,EAAA;AAElB,qBAAiB,KAAK,OAAOV,OAAA;AAG7B,QAAI,YAAY;AAChB,QAAI,eAAe;AACnB,QAAI,KAAA;AACJ,QAAI,UAAU,MAAM,IAAA;AACpB,QAAI,OAAO,CAAC,KAAK,KAAK,CAAA;AACtB,QAAI,UAAU,OAAQ,CAAA,IAAM,MAAM,YAAYU,EAAA,GAAI,KAAA,GAAQ,CAAC,OAAO,KAAK,CAAA;AACvE,QAAI,QAAA;AACJ,QAAI,UAAU,OAAQ,CAAA,IAAM,MAAM,YAAYD,EAAA,GAAI,KAAA,GAAQ,KAAK,OAAO,CAAA;AAEtE,QAAI,CAAC,oBAAqB,CAAAC,MAAK;AAG/B,QAAI,cAAc;AAClB,QAAI,YAAY;AAChB,QAAI,UAAA;AACJ,QAAI,OAAO,KAAK,IAAA;AAChB,QAAI,OAAO,QAAQ,KAAK,IAAA;AACxB,QAAI,OAAO,MAAM,GAAA;AACjB,QAAI,OAAO,MAAMV,UAAS,GAAA;AAC1B,QAAI,OAAA;AACJ,QAAI,UAAA;AAEJ,UAAM,MAAMA,UAAS,MAAM,OAAO,IAAI,CAACU;AACvC,UAAM,MAAM,QAAQ,MAAM,OAAO,IAAID;AACrC,UAAM,SAAS;MAAE,GAAG;MAAI,GAAG;MAAI,QAAQ;IAAW;AAElD,QAAI,WACF,cAAa,WAAW,QAAQ,MAAA;AAElC,QAAI,KAAA;AACJ,QAAI,UAAU,MAAM,IAAA;AAGpB,QAAI,QACF,KAAI,YAAY;AACd,YAAM,cAAc,IAAI,WAAW;AACnC,UAAI9D,WAAU;AACd,iBAAW,QAAQ,CAAAgE,OAAK;AACtB,cAAM,SAAA,kBAAgC,WAAWhE,QAAA;kBAClC,KAAKgE,IAAG,EAAE,WAAW,OAAQ,CAAA;AAC5C,QAAAhE,YAAW;MACZ,CAAA;IACF,MAAA,CAAAiE,UACgB,KAAK,QAAQ,EAAE,WAAW,UAAW,CAAA;AAKxD,QAAI,cAAc;AAChB,UAAI,cAAc;AAGlB,UAAI,UAAA;AACJ,UAAI,OAAO,GAAG,KAAK,WAAA;AACnB,UAAI,OAAO,GAAG,KAAK,WAAA;AAGnB,UAAI,OAAO,KAAK,aAAa,CAAA;AAC7B,UAAI,OAAO,KAAK,aAAa,CAAA;AAC7B,UAAI,OAAA;AACJ,UAAI,UAAA;IACL;AAGD,QAAI,QAAA;EACL;AACF;AClID,IAAaC,iBAAgB,CAACC,OAA6B;AACzD,QAAML,KAAI,GAAG,IAAI,CAAAM,OAAKA,GAAE,CAAA;AACxB,QAAML,KAAI,GAAG,IAAI,CAAAK,OAAKA,GAAE,CAAA;AACxB,QAAM,OAAO,KAAK,IAAI,GAAGN,EAAA;AACzB,QAAM,OAAO,KAAK,IAAI,GAAGA,EAAA;AACzB,QAAM,OAAO,KAAK,IAAI,GAAGC,EAAA;AACzB,QAAM,OAAO,KAAK,IAAI,GAAGA,EAAA;AACzB,QAAM,QAAQ,OAAO;AACrB,QAAMV,UAAS,OAAO;AAEtB,SAAO;IACL,KAAK;MAAE,GAAG;MAAM,GAAG;IAAM;IACzB,KAAK;MAAE,GAAG;MAAM,GAAG;IAAM;IACzB;IAAO,QAAAA;IACP,QAAQ,KAAK,IAAI,OAAOA,OAAA;IACxB,QAAQ,KAAK,IAAI,OAAOA,OAAA;EACzB;AACF;AAED,IAAagB,mBAAkB,CAACC,WAAwB;AACtD,MAAI,CAAC,OAAO,SAAS,OAAO,MAAA,EAC1B,QAAO,CAACC,WAAiBC;AAE3B,QAAM,SAAS,OAAO,OAAO,IAAI,GAAG,OAAO,IAAI,CAAA;AAC/C,QAAM,SAAS,OAAO,OAAO,IAAI,GAAG,OAAO,IAAI,CAAA;AAC/C,SAAO,CAACD,YAAkB;IACxB,GAAG,OAAOC,OAAM,CAAA;IAChB,GAAG,OAAOA,OAAM,CAAA;EACjB;AACF;AAED,IAAaC,mBAAkB,CAACH,WAAwB;AACtD,QAAM,SAAS,OAAO,GAAG,GAAG,OAAO,IAAI,GAAG,OAAO,IAAI,CAAA;AACrD,QAAM,SAAS,OAAO,GAAG,GAAG,OAAO,IAAI,GAAG,OAAO,IAAI,CAAA;AACrD,SAAO,CAACC,YAAkB;IACxB,GAAG,OAAOC,OAAM,CAAA;IAChB,GAAG,OAAOA,OAAM,CAAA;EACjB;AACF;AAKD,IAAaE,mBAAkB,CAACC,IAAiBC,YAAoBC,UAAoD;AAEvH,QAAMC,UAAsB,CAAE;AAC9B,MAAIC,SAAQ;AAEZ,WAASjB,KAAI,GAAG,IAAI,GAAGA,KAAI,GAAG,IAAI,GAAGA,MAAK,YAAY;AACpD,UAAM,UAAUiB,SAAQ,UAAU;AAClC,YAAQ,KAAK;MAAE,GAAAjB;MAAG,GAAG;MAAG,OAAO;IAAS,CAAA;AACxC,IAAAiB;EACD;AAGD,EAAAA,SAAQ;AACR,QAAMC,UAAsB,CAAE;AAC9B,WAASjB,KAAI,GAAG,IAAI,GAAGA,KAAI,GAAG,IAAI,GAAGA,MAAK,YAAY;AACpD,UAAM,UAAUgB,SAAQ,UAAU;AAClC,YAAQ,KAAK;MAAE,GAAG;MAAG,GAAAhB;MAAG,OAAO;IAAS,CAAA;AACxC,IAAAgB;EACD;AACD,SAAO;IAAE,GAAG;IAAS,GAAG;EAAS;AAClC;AC5ID,IAAaE,WAAb,MAA0C;EACxC;EACA;EACA;EAEA,cAAc;AACZ,SAAK,aAAa,YAAY,IAAA;AAC9B,SAAKC,QAAQ,IAAIC,oBAAA;AAEjB,SAAKC,QAAQ,oBAAI,IAAA;EAClB;EAED,IAAI,YAAY;AACd,WAAO,KAAKA,MAAM;EACnB;EAED,QAAQ;AACN,SAAKF,MAAM,MAAA;AACX,SAAK,aAAa,YAAY,IAAA;EAC/B;EAED,IAAIG,QAAgBC,MAAgB;AAClC,SAAKJ,MAAM,UAAU,QAAQ,IAAA;EAC9B;EAED,eAAeG,QAAgB;AAC7B,UAAM,UAAU,KAAKH,MAAM,OAAO,MAAA;AAClC,QAAI,QACF,MAAK,aAAa,YAAY,IAAA;AAEhC,WAAO;EACR;EAED,QAAQG,QAAgBE,MAAmB;AACzC,SAAKH,MAAM,IAAI,QAAQ,IAAA;EACxB;EAED,QAAQC,QAAgB;AACtB,WAAO,KAAKD,MAAM,IAAI,MAAA;EACvB;EAED,QAAQC,QAAgB;AACtB,WAAO,KAAKD,MAAM,IAAI,MAAA;EACvB;EAED,CAAC,YAAY;AACX,WAAO,KAAKF,MAAM,WAAA;EACnB;EAED,CAAC,aAAa;AACZ,WAAO,KAAKA,MAAM,QAAA;EACnB;EAED,CAAC,YAAY;AACX,WAAO,KAAKA,MAAM,OAAA;EACnB;EAED,IAAIM,QAAe,SAAS,WAAW;AACrC,SAAKN,MAAM,eAAe,QAAQ5F,MAAA;AAClC,SAAK,aAAa,YAAY,IAAA;EAC/B;AACF;ACjCD,IAAamG,UAAS,CAACC,eAA8BC,UAAuD,CAAE,MAAK;AAEjH,QAAM,WAAY,cAAc,WAAW,SAAa,SAAS,OAAOC,WAAU,cAAc,MAAA;AAChG,QAAM,WAAW,SAAS,cAAc,QAAQ;AAChD,WAAS,QAAQ,QAAA;AAEjB,QAAMC,MAAK,IAAIZ,SAAA;AAEf,QAAM,SAAS,IAAIa,cAAa,UAAU,KAAK;AAC/C,QAAM,OAAO,cAAc,UAAW,EAAE,oBAAoB;IAAE,GAAG;IAAG,GAAG;IAAG,OAAO;IAAG,QAAQ;EAAG,EAAE;AACjG,QAAM,SAAS,OAAO,aAAa,IAAA;AACnC,QAAMC,KAAI,IAAIC,qBAAoB,QAAQH,KAAI,OAAA;AAE9C,MAAI,cAAc,mBAAmB,WACnC,cAAa,eAAe,UAAU,EACpC,gBAAgB,CAAC,MAAM,QAAQ;AAC7B,WAAO,eAAe,IAAA;AACtB,IAAAE,GAAE,gBAAA;AACF,IAAAA,GAAE,KAAA;EACH,EACF,CAAA;MAGD,cAAa,aAAa,UAAU,EAClC,gBAAgB,CAAC,MAAM,QAAQ;AAC7B,WAAO,eAAe,IAAA;AACtB,IAAAA,GAAE,gBAAA;AACF,IAAAA,GAAE,KAAA;EACH,EACF,CAAA;AAEH,SAAOA;AACR;AA6CD,IAAaC,uBAAb,MAAiC;EAC/B;EACA;EACA;EAEA,kBAAA;EACA,eAAA;EACA;EACA;EACA,cAAcC,OAAM,GAAG,IAAA;EACvB;;;;;EAMA,eAAqC,CAAE;EACvC;EACA;EAEA;EAEA;EACA;EACA;EACA;EACA;EACA;EACA;EAEA,YAAYC,KAAkBC,MAA2CR,UAAuD,CAAE,GAAE;AAClI,QAAI,CAAC,KAAM,OAAM,IAAI,UAAU,2BAA2B;AAC1D,QAAI,OAAO,SAAS,SAAU,OAAM,IAAI,UAAU,uCAAwC,OAAO,IAAA,EAAO;AACxG,SAAK,gBAAgB,QAAQ;AAC7B,SAAKT,QAAQ;AACb,SAAKkB,gBAAgBC;AACrB,SAAKC,kBAAkB;AACvB,SAAKC,eAAe,QAAQ,SAAS;AACrC,SAAKC,aAAa,QAAQ,SAAS;AACnC,SAAKC,cAAc,QAAQ,cAAc;AACzC,SAAKC,gBAAgB,QAAQ,gBAAgB;AAC7C,SAAK,gBAAgB,QAAQ,iBAAiB;AAC9C,SAAKC,iBAAiB,QAAQ,iBAAiB;AAC/C,SAAK,OAAO;MACV,MAAM;MACN,YAAY;MACZ,MAAM;MACN,UAAU;MACV,GAAG,QAAQ;IACZ;AAED,SAAKC,aAAa;MAChB,QAAQ;MACR,OAAO;MACP,GAAG,QAAQ;IACZ;AACD,SAAKC,aAAa;MAChB,QAAQ;MACR,MAAM;MACN,MAAM;MACN,GAAG,QAAQ;IACZ;AAED,SAAKC,QAAQ;MACX,YAAY;MACZ,OAAO;MACP,QAAQ;MACR,OAAO;MACP,GAAG,QAAQ;IACZ;EACF;EAED,kBAAkB;AAChB,QAAI,KAAK5B,MAAM,eAAe,KAAKoB,mBAAmB,KAAKS,cAAe,QAAO,KAAKA;AACtF,SAAKT,kBAAkB,KAAKpB,MAAM;AAClC,UAAMrF,KAAI,KAAKmH,aAAAA;AACf,SAAKD,gBAAgBlH;AACrB,QAAI,KAAK,cAAe,MAAK,cAAA;AAC7B,WAAOA;EACR;EAED,kBAAkB;AAChB,SAAKkH,gBAAgB;EACtB;EAED,eAAwC;AAEtC,UAAM,QAAQ,KAAK,aAAA;AAEnB,UAAM,oBAAA1C,iBAAyC,KAAA;AAC/C,UAAM,eAAAI,iBAAoC,KAAA;AAC1C,UAAM4B,MAAK,KAAKD;AAChB,UAAMa,WAAU,KAAKN;AAIrB,QAAI,UAAUN,IAAG,IAAIY;AACrB,QAAI,UAAUZ,IAAG,IAAIY;AAErB,UAAM,gBAAgBZ,IAAG,SAAUY,WAAU;AAC7C,UAAM,eAAeZ,IAAG,QAASY,WAAU;AAC3C,UAAM,eAAe,KAAK,IAAI,eAAe,YAAA;AAE7C,QAAI,gBAAgB,cAElB,YAAY,eAAe,IAAM,eAAe;QAGhD,YAAY,gBAAgB,IAAM,eAAe;AAGnD,UAAM,kBAAkB,CAACC,QAAc;AACrC,UAAI,EAAE,GAAApD,IAAG,GAAAC,GAAA,IAAMoD;AACf,UAAIrD,OAAM,OAAO,kBAAmB,CAAAA,KAAI;eAC/BA,OAAM,OAAO,kBAAmB,CAAAA,KAAI;AAC7C,UAAIC,OAAM,OAAO,kBAAmB,CAAAA,KAAI;eAC/BA,OAAM,OAAO,kBAAmB,CAAAA,KAAI;AAC7C,MAAAD,KAAIA,KAAI;AACR,MAAAC,MAAK,IAAIA,MAAK;AAEd,MAAAD,MAAK;AACL,MAAAC,MAAK;AAEL,aAAO;QAAE,GAAAD;QAAG,GAAAC;MAAG;IAChB;AAED,UAAM,kBAAkB,CAACmD,QAAc;AACrC,UAAI,EAAE,GAAApD,IAAG,GAAAC,GAAA,IAAMoD;AACf,MAAArD,MAAK;AACL,MAAAC,MAAK;AACL,MAAAD,KAAIA,KAAI;AACR,MAAAC,KAAI,IAAKA,KAAI;AACb,aAAO;QAAE,GAAAD;QAAG,GAAAC;MAAG;IAChB;AAGD,UAAM,wBAAwB,CAACmD,QAAc;AAC3C,UAAI,EAAE,GAAApD,IAAG,GAAAC,GAAA,IAAMoD;AACf,MAAArD,KAAIA,KAAIuC,IAAG,IAAI,KAAKM;AACpB,MAAA5C,KAAK,eAAe,KAAK4C,iBAAkB5C;AAC3C,MAAAD,MAAK;AACL,MAAAC,KAAKA,KAAI;AACT,aAAO;QAAE,GAAAD;QAAG,GAAAC;MAAG;IAChB;AAED,WAAO;MACL;MAAmB;MAAiB;MAAiB;MAAuB;MAAc;IAC3F;EACF;;;;;;;;EAUD,kBAAkBqD,MAAaC,mBAAyCC,KAA4B,UAAUC,iBAAwC;AACpJ,UAAMtG,MAAK2E,WAAU,iBAAA;AACrB,QAAI,EAAE,GAAA9B,IAAG,GAAAC,GAAA,IAAM,KAAK,mBAAmB,IAAA;AAGvC,QAAI,OAAO,UAAU;AACnB,YAAM,SAAS9C,IAAG,sBAAA;AAClB,MAAA6C,MAAK,OAAO,QAAQ;AACpB,MAAAC,MAAK,OAAO,SAAS;IACtB,WAAU,OAAO,YAAY;IAE7B,MAAM,OAAM,IAAI,MAAM,mDAAmD;AAC1E,QAAI,iBAAiB;AACnB,YAAM,aAAa6B,WAAU,eAAA;AAC7B,YAAM,SAAS,WAAW,sBAAA;AAG1B,MAAA9B,MAAK,OAAO;AACZ,MAAAC,MAAK,OAAO;IACb;AACD,IAAA9C,IAAG,MAAM,OAAO,GAAI6C,EAAA;AACpB,IAAA7C,IAAG,MAAM,MAAM,GAAI8C,EAAA;EACpB;;;;;;EAOD,eAAiC;AAC/B,QAAI,KAAKyC,eAAe,OACtB,QAAAtC,eAA0B,CAAE,GAAG,KAAKgB,MAAM,UAAA,CAAa,CAAA;SAClD;AACL,UAAI,CAAC,KAAKsC,aACR,MAAKA,eAAAA,eAAkC,CAAE,KAAKhB,WAAW,KAAK,KAAKA,WAAW,GAAK,CAAA;AAErF,aAAO,KAAKgB;IACb;EACF;EAED,mBAAmBC,WAAkB;AACnC,UAAM,SAAS,KAAK,mBAAmB,SAAA;AACvC,UAAMC,WAAS,KAAK,aAAa;AACjC,UAAM,MAAM;MACV,GAAG,OAAO,IAAIA,SAAO;MACrB,GAAG,OAAO,IAAIA,SAAO;IACtB;AACD,WAAO;EACR;EAED,mBAAmBC,WAAkBC,SAAQ,OAAO;AAClD,UAAM/B,MAAK,KAAK,gBAAA;AAGhB,UAAM,MAAMA,IAAG,kBAAkB,SAAA;AAGjC,UAAM,SAASA,IAAG,gBAAgB,GAAA;AAElC,QAAI+B,OAAO,SAAQ,IAAI,SAAU,UAAU,CAAA,IAAO,UAAU,CAAA,SAAY,IAAI,CAAA,IAAO,IAAI,CAAA,YAAe,OAAO,CAAA,IAAO,OAAO,CAAA,EAAI;AAC/H,WAAO;MACL,GAAG;MACH,GAAG,OAAO;MACV,GAAG,OAAO;IACX;EACF;;;;;;;EA0BD,aAAarD,QAAcsD,SAAmB;AAC5C,UAAMhC,MAAK,KAAK,gBAAA;AAGhB,UAAM,cAAA,SAA8BrB,QAAO,KAAK,aAAa,MAAA;AAE7D,UAAM9E,KAAImG,IAAG,gBAAgB,WAAA;AAC7B,WAAOA,IAAG,aAAanG,EAAA;EACxB;;;;;;EA6BD,wBAAwBoI,QAAeC,QAAeH,SAAQ,OAAa;AACzE,aAAS,KAAK,mBAAmB,QAAQA,MAAA;AACzC,aAAS,KAAK,mBAAmB,QAAQA,MAAA;AACzC,WAAO;MAAE,GAAG;MAAQ,GAAG;IAAQ;EAChC;EAED,iBAA6B;AAC3B,WAAO;MACL,QAAQI,mBAAkB,KAAK9C,MAAM,SAAA;MACrC,WAAW;MACX,WAAW;IACZ;EACF;EAED,OAAO;AACL,QAAI,KAAKqB,iBAAiB,SACxB,MAAKH,cAAc,MAAA;QAEnB,MAAK,aAAa,MAAA;AAOpB,SAAK6B,SAAAA;AACL,QAAI,KAAK,KAAK,KAAM,MAAKC,UAAAA;AAGzB,eAAW,CAAEC,IAAGzI,EAAA,KAAO,KAAKwF,MAAM,WAAA,GAAc;AAC9C,UAAI,OAAO,KAAKA,MAAM,QAAQiD,EAAA;AAC9B,UAAI,CAAC,MAAM;AACT,eAAO,KAAK,eAAA;AACZ,aAAKjD,MAAM,QAAQiD,IAAG,IAAA;MACvB;AACD,WAAKC,YAAYD,IAAGzI,IAAG,IAAA;IAExB;AAED,eAAW2I,UAAQ,KAAK,aACtB,MAAK,SAASA,QAAMA,OAAK,QAAQA,OAAK,KAAA;EAEzC;;;;;;;EAQD,SAASC,QAAYnH,QAAgBoH,OAAe;AAClD,UAAMC,KAAI,KAAKC,wBAAwBJ,OAAK,GAAGA,OAAK,CAAA;AACpD,SAAKK,qBAAqBF,IAAG,QAAQ,KAAA;EACtC;EAED,QAAQnD,QAAgBsD,MAA2B;AACjD,SAAKzD,MAAM,QAAQ,QAAQ;MACzB,GAAG,KAAK,eAAA;MACR,GAAG;IACJ,CAAA;EACF;EAED,YAAY;AACV,UAAM,EAAE,QAAQ,MAAA,IAAU,KAAK0B;AAE/B,UAAM,QAAQ,KAAK6B,wBAAwB;MAAE,GAAG;MAAG,GAAG,OAAO;IAAmB,GAAE;MAAE,GAAG;MAAG,GAAG,OAAO;IAAmB,GAAE,KAAA;AACzH,UAAM,QAAQ,KAAKA,wBAAwB;MAAE,GAAG,OAAO;MAAmB,GAAG;IAAG,GAAE;MAAE,GAAG,OAAO;MAAmB,GAAG;IAAG,GAAE,KAAA;AAGzH,SAAKC,qBAAqB,OAAO,QAAQ,OAAO,KAAA;AAChD,SAAKA,qBAAqB,OAAO,QAAQ,OAAO,KAAA;EACjD;EAGD,iBAAiBE,SAAkB;AAEjC,UAAM,MAAM,KAAKxC,cAAc;AAE/B,QAAI,OAAO,KAAKS,WAAW,OAAO,MAAM,KAAKA,WAAW;AACxD,QAAI,YAAY,KAAKA,WAAW;AAChC,QAAI,eAAe;AAGnB,eAAWd,MAAK,SAAS;AACvB,UAAIA,GAAE,MAAM,KAAKA,GAAE,MAAM,EAAG;AAC5B,YAAM,MAAM,KAAK,mBAAmBA,IAAG,KAAA;AACvC,YAAMzG,SAAQ,KAAK,YAAYyG,GAAE,CAAA;AACjC,YAAM,QAAQzG,OAAM,SAAA;AACpB,YAAM,UAAU,IAAI,YAAY,KAAA;AAChC,YAAMwE,KAAI,IAAI,IAAI,QAAQ,QAAS,KAAK,gBAAgB,IAAK;AAC7D,YAAMC,KAAI,IAAI;AACd,UAAI,SAAS,OAAOD,IAAGC,EAAA;IACxB;EACF;EAED,iBAAiB8E,SAAkB;AAEjC,UAAM,MAAM,KAAKzC,cAAc;AAC/B,QAAI,OAAO,KAAKS,WAAW,OAAO,MAAM,KAAKA,WAAW;AACxD,QAAI,YAAY,KAAKA,WAAW;AAChC,QAAI,eAAe;AACnB,eAAWd,MAAK,SAAS;AACvB,YAAM,MAAM,KAAK,mBAAmBA,IAAG,KAAA;AACvC,YAAMzG,SAAQ,KAAK,YAAYyG,GAAE,CAAA;AACjC,YAAM,QAAQzG,OAAM,SAAA;AACpB,YAAM,UAAU,IAAI,YAAY,KAAA;AAChC,YAAMwE,KAAI,IAAI,IAAI,QAAQ,QAAQ;AAClC,YAAMC,KAAI,IAAI,IAAI,QAAQ,0BAA0B,QAAQ,2BAA4B,KAAK,gBAAgB;AAC7G,UAAI,SAAS,OAAOD,IAAGC,EAAA;IACxB;EACF;EAED,aAAa+E,IAAkBC,UAAmB;AAChD,UAAM,oBAAoB,KAAK,gBAAgB;AAC/C,UAAMrJ,KAAI,WAAW;MAAE,GAAGqG,GAAE;MAAG,GAAG;IAAG,IAAG;MAAE,GAAGA,GAAE;MAAG,GAAG;IAAG;AACxD,UAAM,MAAM,KAAK,mBAAmBrG,IAAG,KAAA;AAEvC,UAAM2I,SAAO,WAAW;MACtB,GAAG;QAAE,GAAG,IAAI;QAAG,GAAG,IAAI,IAAI;MAAmB;MAC7C,GAAG;QAAE,GAAG,IAAI;QAAG,GAAG,IAAI,IAAI;MAAmB;IAC9C,IACC;MACE,GAAG;QAAE,GAAG,IAAI;QAAG,GAAG,IAAI,IAAI;MAAmB;MAC7C,GAAG;QAAE,GAAG,IAAI;QAAG,GAAG,IAAI,IAAI;MAAmB;IAC9C;AACH,SAAKK,qBAAqBL,QAAM,KAAKzB,WAAW,QAAQ,KAAKA,WAAW,OAAO,KAAA;EAChF;EAED,cAAckC,IAAkBC,UAAmB;AACjD,UAAMV,SAAO,WACX,KAAKI,wBAAwB;MAAE,GAAG1C,GAAE;MAAG,GAAG,OAAO;IAAmB,GAAE;MAAE,GAAGA,GAAE;MAAG,GAAG,OAAO;IAAmB,CAAA,IAC7G,KAAK0C,wBAAwB;MAAE,GAAG1C,GAAE;MAAG,GAAG,OAAO;IAAmB,GAAE;MAAE,GAAGA,GAAE;MAAG,GAAG,OAAO;IAAmB,GAAE,KAAA;AACjH,SAAK2C,qBAAqBL,QAAM,KAAKvB,MAAM,QAAQf,GAAE,QAAQ,KAAKe,MAAM,QAAQ,IAAI,KAAKA,MAAM,KAAA;EAChG;EAED,WAAW;AACT,UAAMhH,KAAI,KAAKgH;AACf,UAAM,WAAW,KAAK,KAAK;AAC3B,UAAM,eAAe,KAAK,KAAK;AAC/B,UAAM,aAAa,KAAK,KAAK;AAC7B,UAAM,KAAK,KAAK,gBAAA,EAAkB;AAClC,UAAM,EAAE,YAAY,MAAA,IAAUhH;AAG9B,UAAM,YAAA4E,iBAAiC,IAAI,YAAY,KAAA;AACvD,eAAWqB,MAAK,UAAU,GAAG;AAC3B,UAAI,SAAU,MAAKiD,cAAcjD,IAAG,IAAA;AACpC,UAAI,gBAAgBA,GAAE,MAAO,MAAKkD,aAAalD,IAAG,IAAA;IACnD;AAGD,eAAWA,MAAK,UAAU,GAAG;AAC3B,UAAI,SAAU,MAAKiD,cAAcjD,IAAG,KAAA;AACpC,UAAI,gBAAgBA,GAAE,MAAO,MAAKkD,aAAalD,IAAG,KAAA;IACnD;AAED,QAAI,YAAY;AACd,WAAKmD,iBAAiB,UAAU,EAAE,OAAO,CAAAnD,OAAKA,GAAE,KAAA,CAAM;AACtD,WAAKoD,iBAAiB,UAAU,EAAE,OAAO,CAAApD,OAAKA,GAAE,KAAA,CAAM;IACvD;EACF;EAED,YAAYjD,MAAcsG,QAA0BC,MAAkB;AACpE,QAAI,KAAK3C,kBAAkB,OACzB,MAAK4C,eAAe,QAAQ,KAAK,QAAQ,KAAK,SAAA;AAIhD,QAAI,KAAK7C,gBAAgB,MACvB,YAAW/G,MAAK,OACd,MAAK6J,SAAS7J,IAAG,KAAK,QAAQ,KAAK,SAAA;EAKxC;EAED,eAAe8J,MAAwBrI,QAAgBoH,OAAe;AACpE,UAAM,MAAM,KAAKnC,cAAc;AAC/B,QAAI,UAAA;AACJ,eAAW,CAAE,OAAO,IAAA,KAAU,KAAK,QAAA,GAAW;AAC5C,YAAMqD,QAAM,KAAK,mBAAmB,MAAM,KAAA;AAC1C,UAAI,UAAU,EAAG,KAAI,OAAOA,MAAI,GAAGA,MAAI,CAAA;AACvC,UAAI,OAAOA,MAAI,GAAGA,MAAI,CAAA;IACvB;AACD,QAAI,cAAcC,aAAe,MAAA;AACjC,QAAI,YAAY;AAChB,QAAI,OAAA;AACJ,QAAI,UAAA;EACL;EAED,SAASC,aAA6BC,gBAAwBC,gBAAwB;AACpF,UAAM,SAASH,aAAe,YAAY,aAAa,cAAA;AACvD,UAAM,MAAM,KAAK,mBAAmB,WAAA;AACpC,UAAM,SAAS,YAAY,UAAU;AACrC,SAAKtD,cAAc,YAAY,CAC7B;MAAE,GAAG;MAAK;IAAQ,CACnB,GAAE,MAAA;EAWJ;EAGD,qBAAqBkC,QAAYnH,QAAgBoH,OAAeX,SAAQ,OAAO;AAC7E,QAAIA,OAAO,SAAQ,IAAIS,MAAAA;AACvB,UAAM,MAAM,KAAKjC,cAAc;AAE/B,aAASsD,aAAe,MAAA;AAExB,QAAI,UAAA;AACJ,QAAI,OAAOrB,OAAK,EAAE,GAAGA,OAAK,EAAE,CAAA;AAC5B,QAAI,OAAOA,OAAK,EAAE,GAAGA,OAAK,EAAE,CAAA;AAC5B,QAAI,cAAcqB,aAAe,MAAA;AACjC,QAAI,YAAY;AAChB,QAAI,OAAA;AACJ,QAAI,UAAA;EACL;EAED,IAAI,UAAU;AACZ,WAAO,KAAKxE;EACb;EAED,IAAI,eAAe;AACjB,WAAO,KAAKkB;EACb;EAED,IAAI,eAAe;AACjB,WAAO,KAAKA,cAAc;EAC3B;AACF;;;;;;;;;;;;AEzkBD,IAAI;AACF,MAAI,OAAO,WAAW,YACnB,QAAe,OAAO;IACrB,GAAI,OAAe;IACnB,SAAS;MACP,oBAAA0D;MACA,QAAAC;MACA,OAAAC;IACD;EACF;AAEJ,QAAO;AAEP;;;AC1DD;AAYO,IAAM,iBAAN,cAA6BC,GAAW;AAAA,EAAxC;AAAA;AASL,oBAAmC,GAAU;AAC7C,iCAAW,IAAI,YAA4B;AAAA,MACzC,qBAAqB;AAAA,MACrB,kBAAkB;AAAA,IACpB,CAAC;AACD,mBAAU;AAEV,uBAAc;AAAA;AAAA,EAEL,SAAS;AAChB,WAAO;AAAA,gBACM,GAAI,KAAK,QAAQ,CAAE;AAAA;AAAA,EAElC;AAAA,EAEA,QAAQ,OAAeC,SAAgB;AACrC,UAAMC,MAAK,KAAK,SAAS;AACzB,QAAI,CAACA,IAAI;AACT,IAAAA,IAAG,QAAQ;AACX,IAAAA,IAAG,SAASD;AAAA,EACd;AAAA;AAAA,EAGA,KAAK,MAAsB,MAAY;AACrC,UAAMC,MAAK,KAAK,SAAS;AACzB,QAAI,CAACA,IAAI;AAET,UAAMC,QAAS,KAAKD,GAAE;AACtB,IAAAC,MAAK,MAAM;AAEX,QAAI,CAAC,KAAM;AAEX,YAAQ,MAAM;AAAA,MACZ,KAAK,QAAQ;AACX,aAAK,UAAUA,OAAM,IAA4B;AACjD;AAAA,MACF;AAAA,MACA,KAAK,WAAW;AACd,aAAK,YAAYA,OAAM,KAAK,UAAU;AACtC;AAAA,MACF;AAAA,MACA,KAAK,QAAQ;AACX,mBAAWC,MAAK,MAAM;AACpB,cAAI,YAAYA,IAAG;AACjB,kBAAM,OAAOA;AACb,iBAAK,SAASD,OAAM,IAAI;AAAA,UAE1B;AAAA,QACF;AACA,aAAK,cAAcA,OAAM,KAAK,SAAS;AACvC;AAAA,MACF;AAAA,MACA,KAAK,QAAQ;AACX,aAAK,UAAUA,OAAM,KAAK,UAAU;AACpC;AAAA,MACF;AAAA,IACF;AAAA,EACF;AAAA,EAGA,UAAUA,OAAiBC,IAAgB;AACzC,aAASC,KAAI,GAAGA,KAAID,GAAE,QAAQC,MAAK;AACjC,YAAMC,QAAOF,GAAGC,EAAE,EAAE;AACpB,YAAM,SAASE,gBAAO,kBAAkBF,EAAC;AACzC,eAASG,KAAI,GAAGA,KAAIJ,GAAGC,EAAE,EAAE,UAAU,QAAQG,MAAK;AAChD,cAAM,QAAQ,KAAK,cAAcA,GAAE,SAAS,IAAI;AAChD,QAAAL,MAAK,IAAIC,GAAGC,EAAE,EAAE,UAAWG,EAAE,GAAG,MAAM,QAAQ,KAAK;AAAA,MACrD;AAAA,IAEF;AAAA,EACF;AAAA,EAEA,UAAUL,OAAiB,SAA+B;AACxD,QAAI,QAAQ;AACZ,eAAW,QAAQ,QAAQ,WAAW;AACpC,YAAM,SAASI,gBAAO,kBAAkB,KAAK;AAC7C,WAAK,SAASJ,OAAM,MAAM,MAAM;AAChC,WAAK,sBAAsBA,OAAM,MAAM,MAAM,MAAM;AAEnD;AAAA,IACF;AAAA,EACF;AAAA,EAEA,SAASA,OAAiBM,IAAyB,QAAgB;AACjE,UAAM,QAAQ;AACd,IAAAN,MAAK,IAAI,cAAc;AACvB,IAAAA,MAAK,WAAW,OAAOM,GAAG,CAAE,GAAGA,GAAG,CAAE,GAAGA,GAAG,CAAE,GAAGA,GAAG,CAAE,GAAGA,GAAG,CAAE,CAAC;AAC7D,IAAAN,MAAK,WAAW,OAAOM,GAAG,CAAE,GAAGA,GAAG,CAAE,GAAGA,GAAG,CAAE,GAAGA,GAAG,CAAE,CAAC;AACrD,IAAAN,MAAK,WAAW,OAAOM,GAAG,CAAE,GAAGA,GAAG,EAAG,GAAGA,GAAG,EAAG,GAAGA,GAAG,EAAG,CAAC;AACxD,IAAAN,MAAK,WAAW,OAAOM,GAAG,EAAG,GAAGA,GAAG,EAAG,GAAGA,GAAG,EAAG,GAAGA,GAAG,EAAG,CAAC;AACzD,IAAAN,MAAK,WAAW,OAAOM,GAAG,EAAG,GAAGA,GAAG,EAAG,GAAGA,GAAG,EAAG,GAAGA,GAAG,EAAG,CAAC;AACzD,IAAAN,MAAK,WAAW,OAAOM,GAAG,CAAE,GAAGA,GAAG,CAAE,GAAGA,GAAG,EAAG,GAAGA,GAAG,EAAG,GAAGA,GAAG,CAAE,GAAGA,GAAG,CAAE,CAAC;AAAA,EACzE;AAAA,EAEA,YAAYN,OAAiB,MAAmB;AAC9C,UAAMO,cAAe,WAAWP,MAAK,KAAK,IAAI,GAAG;AAEjD,QAAI,QAAQ;AACZ,eAAWC,MAAK,MAAM;AAEpB,YAAM,SAASG,gBAAO,kBAAkB,KAAK;AAC7C,WAAK,yBAAyBJ,OAAMC,IAAgB,QAAQM,WAAU;AACtE;AAAA,IACF;AAAA,EACF;AAAA,EAEA,yBAAyBP,OAAiB,KAAgB,QAAgBO,aAA0B;AAClG,UAAM,MAAMP,MAAK;AACjB,UAAMG,QAAO,IAAI;AACjB,QAAIA,OAAM;AACR,WAAK,gBAAgB,KAAKA,OAAM,MAAM;AAAA,IACxC;AACA,QAAI,IAAI,YAAY;AAClB,iBAAWK,MAAK,IAAI,YAAY;AAC9B,QAAAD,YAAW,KAAK,GAAIC,GAAE,MAAM,YAAY,CAAC,CAAE,MAAOA,GAAE,YAAa,IAAI,MAAM;AAAA,MAC7E;AAAA,IACF;AAAA,EACF;AAAA,EAEA,gBAAgB,KAA+BL,OAAmB,QAAgB;AAChF,QAAI,KAAK;AACT,QAAI,UAAUA,MAAK,SAASA,MAAK,OAAO;AACxC,QAAI,OAAOA,MAAK,KAAK;AACrB,QAAI,YAAY;AAChB,QAAI,cAAc;AAClB,QAAI,WAAW,GAAG,GAAGA,MAAK,OAAOA,MAAK,MAAM;AAC5C,QAAI,QAAQ;AAAA,EACd;AAAA,EAEA,UAAU,IAAY;AACpB,QAAI,SAAS,mBAAK,UAAS,IAAI,EAAE;AACjC,uBAAK,UAAS,MAAM,EAAE;AACtB,QAAI,CAAC,QAAQ;AACX,WAAK,WAAY,KAAK,KAAK,OAAO;AAClC,UAAI,KAAK,UAAU,IAAK,MAAK,UAAU,KAAK,UAAU;AACtD,eAAS,OAAQ,KAAK,OAAQ;AAC9B,yBAAK,UAAS,IAAI,IAAI,MAAM;AAAA,IAC9B;AACA,WAAO;AAAA,EACT;AAAA,EAEA,cAAcH,OAAiB,OAA+B;AAC5D,QAAI,CAAC,MAAO;AACZ,QAAI,QAAQ;AACZ,eAAWM,MAAK,OAAO;AACrB,WAAK,sBAAsBN,OAAMM,IAAG,MAAM,KAAK,UAAU,MAAM,SAAS,CAAC,CAAC;AAC1E;AAAA,IACF;AAAA,EACF;AAAA,EAEA,sBAAsBN,OAAiBM,IAAyB,WAAmB,QAAgB;AACjG,QAAI,QAAQ;AACZ,eAAWG,MAAKH,IAAG;AACjB,UAAII,KAAI,KAAKD,GAAE;AACf,YAAME,KAAI,KAAK,IAAI,YAAY,GAAG,KAAK,IAAI,MAAQ,YAAa,YAAYD,KAAI,CAAE,CAAC;AACnF,YAAM,QAAQ,KAAK,cAAc,MAAM,SAAS,IAAI;AACpD,MAAAV,MAAK,IAAIS,IAAGE,IAAG,QAAQ,KAAK;AAC5B;AAAA,IACF;AAAA,EACF;AAAA,EAEA,SAASX,OAAiB,MAAgB;AACxC,UAAM,SAAS,KAAK,UAAU,KAAK,MAAM;AACzC,SAAK,cAAcA,OAAM,KAAK,WAAW,MAAM;AAC/C,QAAI,KAAK,aAAa;AACpB,WAAK,sBAAsBA,OAAM,KAAK,WAAW,MAAO,MAAM;AAAA,IAChE;AAAA,EACF;AAAA,EAEA,cAAcA,OAAiBM,IAAyB,QAAgB;AACtE,QAAI,QAAQ;AACZ,UAAM,QAAQ;AACd,IAAAN,MAAK,IAAI,cAAc;AAGvB,IAAAA,MAAK,WAAW,OAAOM,GAAG,EAAG,GAAGA,GAAG,EAAG,GAAGA,GAAG,EAAG,GAAGA,GAAG,EAAG,GAAGA,GAAG,EAAG,GAAGA,GAAG,EAAG,GAAGA,GAAG,EAAG,GAAGA,GAAG,EAAG,GAAGA,GAAG,EAAG,GAAGA,GAAG,EAAG,GAAGA,GAAG,EAAG,GAAGA,GAAG,EAAG,CAAC;AAEjI,IAAAN,MAAK,WAAW,OAAOM,GAAG,EAAG,GAAGA,GAAG,EAAG,GAAGA,GAAG,EAAG,GAAGA,GAAG,EAAG,GAAGA,GAAG,EAAG,GAAGA,GAAG,EAAG,GAAGA,GAAG,EAAG,GAAGA,GAAG,EAAG,GAAGA,GAAG,EAAG,GAAGA,GAAG,EAAG,GAAGA,GAAG,EAAG,GAAGA,GAAG,EAAG,CAAC;AAGjI,IAAAN,MAAK,WAAW,OAAOM,GAAG,EAAG,GAAGA,GAAG,EAAG,CAAC;AAGvC,IAAAN,MAAK,WAAW,OAAOM,GAAG,EAAG,GAAGA,GAAG,EAAG,CAAC;AAGvC,IAAAN,MAAK,WAAW,OAAOM,GAAG,EAAG,GAAGA,GAAG,CAAE,CAAC;AAGtC,IAAAN,MAAK,WAAW,OAAOM,GAAG,CAAE,GAAGA,GAAG,CAAE,GAAGA,GAAG,CAAE,GAAGA,GAAG,CAAE,GAAGA,GAAG,CAAE,GAAGA,GAAG,CAAE,GAAGA,GAAG,CAAE,GAAGA,GAAG,CAAE,GAAGA,GAAG,CAAE,CAAC;AAAA,EAC/F;AACF;AA9LE;AAVW,eACK,SAAS;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AADd,iBAAN;AAAA,EAFNM,GAAc,iBAAiB;AAAA,GAEnB;;;ACVN,IAAM,MAAN,MAAU;AAAA,EAIf,YAAY,QAAgB,WAA4B;AACtD,QAAI,OAAO,cAAc,UAAU;AACjC,WAAK,YAAY;AAAA,IACnB,OAAO;AACL,WAAK,YAAY,UAAU;AAAA,IAC7B;AACA,SAAK,SAAS;AAAA,EAChB;AAAA,EAEA,KAAK,KAAU;AACb,QAAI,KAAK,cAAc,SAAU;AACjC,YAAQ,IAAI,KAAK,QAAQ,GAAG;AAAA,EAC9B;AAAA,EAEA,MAAM,KAAU;AACd,QAAI,KAAK,cAAc,QAAS;AAChC,YAAQ,IAAI,KAAK,QAAQ,GAAG;AAAA,EAE9B;AACF;;;ACjBO,IAAM,WAAN,cAAuB,YAAY;AAAA,EASxC,YAAqB,YAAiC,YAAwB;AAC5E,UAAM;AADa;AAAiC;AARtD,kBAAyB;AAGzB,kBAAgB,CAAC;AACjB,yBAAwB;AAExB,eAAM,IAAI,IAAI,YAAY,MAAM;AAI9B,SAAK,cAAc,KAAK,OAAO,KAAK,IAAI;AAAA,EAC1C;AAAA,EAXA;AAAA,EACA;AAAA,EAYA,MAAM,eAAuB;AAC3B,SAAK,gBAAgB;AACrB,SAAK,UAAU,WAAW;AAC1B,SAAK,WAAW,iBAAiB,QAAQ,KAAK,WAAW;AAAA,EAC3D;AAAA,EAEA,IAAI,SAAS;AACX,WAAO,KAAK,OAAO;AAAA,EACrB;AAAA,EAEA,OAAOC,QAAc;AACnB,UAAM,SAAUA,OAAsB;AACtC,UAAM,OAAO,OAAO;AACpB,UAAM,OAAO,OAAO;AACpB,SAAK,QAAQ;AACb,SAAK,OAAO,KAAK,IAAI;AACrB,QAAI,KAAK,OAAO,SAAS,MAAM,GAAG;AAChC,WAAK,IAAI,KAAK,aAAc,KAAK,OAAO,MAAO,UAAU;AAAA,IAC3D;AAAA,EACF;AAAA,EAEA,OAAO;AACL,SAAK,UAAU,UAAU;AACzB,SAAK,WAAW,oBAAoB,QAAQ,KAAK,WAAW;AAE5D,UAAM,OAAO,KAAK,WAAW,WAAW;AACxC,QAAI,MAAM;AACR,YAAM,MAAqB;AAAA,QACzB,QAAQ,KAAK;AAAA,QACb,SAAS,KAAK;AAAA,QACd,MAAM,KAAK;AAAA,QACX;AAAA,MACF;AACA,WAAK,WAAW,IAAI,GAAG;AAAA,IACzB;AACA,SAAK,SAAS,CAAC;AAAA,EACjB;AAAA,EAEA,UAAU,OAAuB;AAC/B,UAAM,QAAQ,KAAK;AACnB,QAAI,UAAU,MAAO;AACrB,SAAK,SAAS;AACd,QAAI,UAAU,eAAe,UAAU,OAAQ,OAAM,IAAI,MAAM,qBAAsB,KAAM,QAAS,KAAM,EAAE;AAC5G,QAAI,UAAU,cAAc,UAAU,YAAa,OAAM,IAAI,MAAM,qBAAsB,KAAM,QAAS,KAAM,EAAE;AAChH,SAAK,IAAI,MAAM,GAAI,KAAM,OAAQ,KAAM,EAAE;AACzC,SAAK,cAAc,IAAI,YAAY,gBAAgB;AAAA,MACjD,QAAQ;AAAA,QACN,YAAY;AAAA,QACZ,UAAU;AAAA,MACZ;AAAA,IACF,CAAC,CAAC;AAAA,EACJ;AAAA,EAEA,IAAI,QAAQ;AACV,WAAO,KAAK;AAAA,EACd;AACF;;;AC9EA;AAaO,IAAM,gBAAN,cAA4BC,GAAW;AAAA,EAAvC;AAAA;AACL,2BAAsC,GAAU;AAChD,yBAAyC,GAAU;AACnD,qBAAiC,GAAU;AAC3C,sBAA4B,GAAU;AACtC,iBAAQ;AAER,qCAA6B,CAAC;AAC9B,wCAAgC,CAAC;AACjC;AACA;AAGA,oBAAkC;AAMlC,6BAAoB;AAAA;AAAA,EAEX,SAAS;AAChB,WAAO;AAAA;AAAA,mCAEyB,GAAI,KAAK,aAAa,CAAE,WAAY,KAAK,YAAa;AAAA,kCACvD,KAAK,cAAe,iBAAkB,GAAI,KAAK,SAAS,CAAE;AAAA;AAAA;AAAA,UAGlF,KAAK,oBACR,OACA;AAAA,iDAC0C,KAAK,aAAc;AAAA,2BAE/D;AAAA;AAAA,8BAEyB,KAAK,cAAe;AAAA;AAAA;AAAA;AAAA,kCAIhB,KAAK,aAAa,UAAU,SAAS,QAAS;AAAA,sBAC1D,mBAAK,YAAY;AAAA,uBAChB,mBAAK,aAAa,IAAK,GAAI,KAAK,eAAe,CAAE;AAAA,yBAC/C,KAAK,gBAAiB;AAAA,sBACzB,KAAK,qBAAsB;AAAA;AAAA,6BAEpB,KAAK,aAAa,cAAc,SAAS,QAAS;AAAA,0BACrD,mBAAK,gBAAgB;AAAA,yBACtB,KAAK,cAAe;AAAA,sBACvB,KAAK,mBAAoB;AAAA,8BACjB,KAAK,kBAAmB;AAAA,6BACzB,GAAI,KAAK,UAAU,CAAE;AAAA;AAAA;AAAA;AAAA,UAIxC,KAAK,eAAe,CAAE;AAAA;AAAA;AAAA;AAAA,EAI/B;AAAA,EAEA,cAAcC,QAAc;AAC1B,SAAK,cAAc,IAAI,YAAY,gBAAgB;AAAA,MACjD,QAASA,OAAsB;AAAA,IACjC,CAAC,CAAC;AAAA,EACJ;AAAA,EAEA,mBAAmBA,QAAc;AAC/B,UAAM,SAAUA,OAAsB;AACtC,SAAK,cAAc,IAAI,YAAY,yBAAyB,EAAE,OAAO,CAAC,CAAC;AAAA,EACzE;AAAA,EAEA,oBAAoBA,QAAc;AAChC,UAAM,SAAUA,OAAsB;AACtC,SAAK,cAAc,IAAI,YAAY,kBAAkB,EAAE,OAAO,CAAC,CAAC;AAAA,EAClE;AAAA;AAAA;AAAA;AAAA;AAAA,EAMA,sBAAsBA,QAAc;AAClC,UAAM,SAAUA,OAAsB;AACtC,SAAK,cAAc,IAAI,YAAY,kBAAkB,EAAE,OAAe,CAAC,CAAC;AAAA,EAC1E;AAAA,EAEA,eAAeA,QAAc;AAC3B,UAAM,SAAUA,OAAsB;AACtC,SAAK,cAAc,IAAI,YAAY,oBAAoB;AAAA,MACrD;AAAA,IACF,CAAC,CAAC;AAAA,EACJ;AAAA,EAEA,iBAAiBA,QAAc;AAC7B,UAAM,SAAUA,OAAsB;AACtC,SAAK,cAAc,IAAI,YAAY,oBAAoB;AAAA,MACrD;AAAA,IACF,CAAC,CAAC;AAAA,EACJ;AAAA,EAEA,iBAAiB;AACf,QAAI,CAAC,KAAK,SAAU,QAAO,oBAAuB,KAAK,gBAAiB;AACxE,UAAMC,KAAI,KAAK;AACf,YAAQA,GAAE,OAAO;AAAA,MACf,KAAK,aAAa;AAChB,eAAO,oBAAuB,KAAK,eAAgB;AAAA,MACrD;AAAA,MACA,KAAK,YAAY;AACf,eAAO;AAAA,MACT;AAAA,IACF;AAAA,EACF;AAAA,EAEA,kBAAkB;AAChB,UAAMA,KAAI,KAAK;AACf,QAAI,CAACA,GAAG;AACR,IAAAA,GAAE,KAAK;AACP,SAAK,WAAW;AAAA,EAClB;AAAA,EAEA,mBAAmB;AACjB,SAAK,cAAc,IAAI,YAAY,kBAAkB,CAAC;AAAA,EACxD;AAAA,EAEA,iBAAiB;AACf,SAAK,cAAc,OAAO,cAAc;AAAA,EAC1C;AAAA,EAEA,WAAW,SAAkB;AAC3B,uBAAK,cAAe;AAAA,EACtB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAOA,eAAeD,QAAc;AAC3B,UAAME,KAAIF,OAAM;AAChB,QAAI,CAACE,GAAG;AACR,QAAIA,GAAE,UAAU,SAAS;AACvB,WAAK,WAAW;AAAA,IAClB,WAAWA,GAAE,UAAU,aAAa;AAClC,WAAK,WAAW;AAAA,IAClB;AAAA,EACF;AAAA;AAAA;AAAA;AAAA;AAAA,EAMA,iBAAiB,SAAuB,YAA0B;AAChE,uBAAK,cAAe;AACpB,uBAAK,iBAAkB;AACvB,UAAMC,MAAK,KAAK,gBAAgB;AAChC,QAAIA,KAAI;AACN,MAAAA,IAAG,UAAU;AAAA,IACf;AAEA,UAAM,WAAW,KAAK,WAAW;AACjC,QAAI,UAAU;AACZ,eAAS,aAAa,mBAAK;AAAA,IAC7B,OAAO;AACL,cAAQ,KAAK,8CAA8C;AAAA,IAC7D;AAAA,EACF;AAAA,EAES,oBAA0B;AACjC,UAAM,kBAAkB;AACxB,WAAO,iBAAiB,UAAU,MAAM;AACtC,WAAK,eAAe;AAAA,IACtB,CAAC;AAAA,EACH;AAAA,EAEmB,aAAa,oBAA0C;AACxE,UAAM,UAAU,KAAK,UAAU;AAC/B,UAAM,OAAO,mBAAK,eAAc;AAChC,QAAI,WAAW,MAAM;AACnB,cAAQ,cAAc,KAAK;AAAA,IAC7B,OAAO;AACL,cAAQ,KAAK,uDAAuD;AAAA,IACtE;AAAA,EACF;AAAA,EAEA,iBAAiB;AACf,UAAMA,MAAK,KAAK,YAAY,eAAe,WAAW;AACtD,UAAM,WAAW,KAAK,WAAW,SAASA;AAC1C,QAAI,UAAU;AACZ,eAAS,aAAa,mBAAK;AAAA,IAC7B,OAAO;AACL,cAAQ,KAAK,8CAA8C;AAAA,IAC7D;AAAA,EACF;AAAA;AAAA;AAAA;AAAA;AAAA,EAMA,mBAAmB,QAAoB;AACrC,uBAAK,aAAc;AACnB,QAAIA,MAAK,KAAK,gBAAgB;AAC9B,QAAIA,KAAI;AACN,MAAAA,IAAG,SAAS;AAAA,IACd;AAAA,EACF;AAAA,EAEA,kBAAkB,OAAqB,QAAqB;AAC1D,QAAI,CAAC,QAAQ;AACX,WAAK,gBAAgB,OAAO,kBAAkB,KAAK;AACnD,WAAK,WAAW,OAAO,kBAAkB,KAAK;AAAA,IAChD,WAAW,OAAO,SAAS,YAAY,OAAO,SAAS,QAAQ;AAC7D,WAAK,gBAAgB,OAAO,kBAAkB,KAAK;AAAA,IACrD,WAAW,OAAO,SAAS,aAAa;AACtC,WAAK,WAAW,OAAO,kBAAkB,KAAK;AAAA,IAChD;AAAA,EACF;AAAA,EAEA,eAAe;AACb,SAAK,eAAe;AAAA,EACtB;AAAA,EAEA,iBAAiB;AACf,UAAM,UAAU,KAAK,UAAU;AAC/B,UAAMC,KAAI,KAAK,cAAc;AAE7B,QAAI,CAACA,MAAK,CAAC,QAAS;AAEpB,UAAM,YAAY,KAAK,sBAAsB;AAC7C,UAAM,YAAYA,GAAE,aAAa;AACjC,QAAI,CAAC,UAAW;AAEhB,QAAIC,KAAI,WAAW;AACnB,QAAIN,KAAI,WAAW;AAEnB,UAAM,mBAAmBM,MAAKN;AAC9B,UAAM,mBAAmBM,KAAIN;AAC7B,UAAM,mBAAmBA,KAAIM;AAC7B,UAAM,cAAcA,MAAKN;AAEzB,QAAI,uBAAuB,mBAAmB,UAAU;AACxD,QAAI,YAAa,wBAAuB;AAExC,QAAI,yBAAyB,SAAS;AACpC,MAAAM,KAAI,UAAU;AACd,MAAAN,KAAIM,KAAI;AAAA,IACV,OAAO;AACL,MAAAN,KAAI,UAAU;AACd,MAAAM,KAAIN,KAAI;AAAA,IACV;AAEA,UAAM,OAAO,UAAU,QAAQ,IAAIM,KAAI;AACvC,UAAM,MAAM,UAAU,SAAS,IAAIN,KAAI;AACvC,IAAAK,GAAE,MAAM,SAAS,QAAQ,MAAM,SAAS,GAAIL,EAAE;AAC9C,IAAAK,GAAE,MAAM,QAAQ,QAAQ,MAAM,QAAQ,GAAIC,EAAE;AAE5C,IAAAD,GAAE,MAAM,OAAO,QAAQ,MAAM,OAAO,GAAI,IAAK;AAC7C,IAAAA,GAAE,MAAM,MAAM,QAAQ,MAAM,MAAM,GAAI,GAAI;AAC1C,YAAQ,QAAQC,IAAGN,EAAC;AAAA,EACtB;AAAA,EAEA,eAAeC,QAAoB;AACjC,UAAMM,KAAIN,OAAM;AAEhB,SAAK,cAAc,IAAI,YAAY,iBAAiB;AAAA,MAClD,QAAQM;AAAA,IACV,CAAC,CAAC;AAAA,EACJ;AAAA,EAEA,eAAe,MAAsB,MAAW;AAC9C,UAAMH,MAAK,KAAK,UAAU;AAC1B,QAAI,CAACA,IAAI;AACT,IAAAA,IAAG,KAAK,MAAM,IAAI;AAAA,EACpB;AAAA,EAEA,iBAAiB;AACf,WAAO,KAAK,cAAc;AAAA,EAC5B;AAAA,EAEA,kBAAkB;AAChB,UAAM,MAAM,KAAK,eAAe;AAChC,QAAI,CAAC,IAAK;AACV,WAAO,IAAI,gBAAgB;AAAA,EAC7B;AAsCF;AAxTE;AACA;AACA;AACA;AAVW,cA2RK,SAAS;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AA9QzB;AAAA,EADCI,GAAS;AAAA,GAZC,cAaX;AAGA;AAAA,EADCA,GAAS;AAAA,GAfC,cAgBX;AAGA;AAAA,EADCA,GAAS;AAAA,GAlBC,cAmBX;AAnBW,gBAAN;AAAA,EADNL,GAAc,gBAAgB;AAAA,GAClB;;;ACHN,IAAM,WAAN,cAAuBM,GAAW;AAAA,EAAlC;AAAA;AAeL,sBAA2B,CAAC;AAG5B,mBAAU;AAEV,oBAAmC,GAAU;AAAA;AAAA,EAEpC,SAAS;AAChB,QAAI,KAAK,WAAW,WAAW,GAAG;AAChC,aAAO;AAAA,IACT;AAEA,QAAI,OAAO;AAAA,MAET,GAAG,KAAK;AAAA,IACV;AACA,WAAO;AAAA;AAAA;AAAA,yBAGe,KAAK,gBAAiB,IAAK,KAAK,UAAU,SAAS,MAAO;AAAA;AAAA,gBAEnE,GAAI,KAAK,QAAQ,CAAE,YAAa,KAAK,cAAe;AAAA,UAC1D,KAAK,WAAW,IAAI,CAAAC,OAAK,qBAAwBA,EAAE,IAAKA,GAAE,KAAM,WAAW,CAAE;AAAA;AAAA,uBAEhE,KAAK,aAAc;AAAA;AAAA;AAAA,EAGzC;AAAA,EAEA,mBAAmB;AACjB,UAAM,MAAM,KAAK,YAAY;AAC7B,QAAI,CAAC,KAAK;AACR,cAAQ,KAAK,wBAAwB;AACrC;AAAA,IACF;AACA,SAAK,cAAc,IAAI,YAAY,aAAa,EAAE,QAAQ,IAAI,CAAC,CAAC;AAAA,EAClE;AAAA,EAEA,eAAeC,QAAc;AAC3B,UAAM,SAASA,OAAM;AACrB,QAAI,CAAC,OAAQ;AACb,UAAM,OAAO,OAAO,KAAK,OAAO,aAAa;AAC7C,QAAI,CAAC,KAAM;AACX,UAAM,YAAa,KAAa;AAAA,EAElC;AAAA,EAEA,cAAsC;AACpC,UAAMC,MAAK,KAAK,SAAS;AACzB,QAAI,CAACA,IAAI;AACT,UAAM,OAAOA,IAAG,KAAKA,IAAG,aAAa;AACrC,QAAI,CAAC,KAAM;AACX,WAAQ,KAAa;AAAA,EACvB;AAAA,EAEA,gBAAgB;AACd,UAAM,MAAM,KAAK,YAAY;AAC7B,QAAI,CAAC,IAAK;AACV,SAAK,cAAc,IAAI,YAAY,kBAAkB,EAAE,QAAQ,IAAI,CAAC,CAAC;AAAA,EACvE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAmBA,kBAAkB,OAAqB;AACrC,SAAK,UAAU,UAAU;AAAA,EAC3B;AAAA;AAAA;AAAA;AAKF;AApGa,SACK,SAAS;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAczB;AAAA,EADCC,GAAS;AAAA,GAdC,SAeX;AAGA;AAAA,EADCA,GAAS;AAAA,GAjBC,SAkBX;AAlBW,WAAN;AAAA,EADNC,GAAc,WAAW;AAAA,GACb;;;ACVb;AAcO,IAAM,qBAAN,cAAiCC,GAAW;AAAA,EAA5C;AAAA;AAAA;AACL,mBAAiC,GAAU;AAK3C,eAAM,IAAI,IAAI,sBAAsB,QAAQ;AAC5C,+BAAS;AAGT,uBAAuB;AAAA;AAAA,EAEd,SAAS;AAChB,WAAO;AAAA,qBACW,KAAK,cAAc,SAAS,MAAO,WAAY,KAAK,OAAQ,oBAAqB,KAAK,gBAAiB,aAAc,KAAK,SAAU,WAAY,KAAK,OAAQ,sDAAuD,GAAI,KAAK,OAAO,CAAE;AAAA;AAAA,EAE1P;AAAA,EAEA,gBAAgB;AACd,SAAK,cAAc,CAAC,KAAK;AAAA,EAC3B;AAAA,EAEA,kBAAkB;AAChB,WAAO,KAAK,QAAQ;AAAA,EACtB;AAAA,EAEA,eAAe;AACb,UAAMC,MAAK,KAAK,QAAQ;AACxB,QAAI,CAACA,IAAI;AACT,WAAO;AAAA,MACL,OAAOA,IAAG;AAAA,MACV,QAAQA,IAAG;AAAA,IACb;AAAA,EACF;AAAA,EAEA,IAAI,YAAY;AACd,WAAO,mBAAK,YAAW;AAAA,EACzB;AAAA,EAEA,QAAQ;AACN,UAAMA,MAAK,KAAK,QAAQ;AACxB,QAAI,CAACA,KAAI;AACP,cAAQ,KAAK,kBAAkB;AAAA,IACjC,OAAO;AACL,MAAAA,IAAG,KAAK;AAAA,IACV;AAAA,EACF;AAAA,EAEA,OAAO;AACL,UAAMA,MAAK,KAAK,QAAQ;AACxB,QAAI,CAACA,KAAI;AACP,cAAQ,KAAK,kBAAkB;AAAA,IACjC,OAAO;AACL,MAAAA,IAAG,MAAM;AAAA,IACX;AAAA,EACF;AAAA,EAEA,mBAAmB;AACjB,UAAMA,MAAK,KAAK,QAAQ;AACxB,QAAI,CAACA,IAAI;AACT,SAAK,cAAc,IAAI;AAAA,MAAY;AAAA,MAAS;AAAA,QAC1C,QAAQ;AAAA,UACN,OAAOA,IAAG;AAAA,UACV,QAAQA,IAAG;AAAA,QACb;AAAA,MACF;AAAA,IACA,CAAC;AAAA,EACH;AAAA;AAAA;AAAA;AAAA,EAkBA,YAAY;AACV,0BAAK,4CAAL,WAAe;AAAA,EACjB;AAAA;AAAA;AAAA;AAAA,EAKA,UAAU;AACR,0BAAK,4CAAL,WAAe;AAAA,EACjB;AAAA;AAAA;AAAA;AAAA,EAKA,UAAU;AACR,0BAAK,4CAAL,WAAe;AAAA,EACjB;AAAA,EAEA,eAAe,QAAmD;AAChE,UAAMA,MAAK,KAAK,QAAQ;AAExB,QAAIA,KAAI;AACN,MAAAA,IAAG,UAAU,OAAO,MAAM;AAE1B,UAAI,OAAO,WAAW,UAAU;AAC9B,QAAAA,IAAG,YAAY;AACf,QAAAA,IAAG,MAAM;AAAA,MACX,OAAO;AACL,YAAI,CAAC,QAAQ;AACX,UAAAA,IAAG,MAAM;AACT,UAAAA,IAAG,UAAU,IAAI,MAAM;AAAA,QACzB;AACA,QAAAA,IAAG,YAAY,UAAU;AAAA,MAC3B;AAAA,IACF,OAAO;AACL,cAAQ,KAAK,2BAA2B;AAAA,IAC1C;AACA,QAAI,UAAUA,KAAI,QAAQ;AACxB,MAAAA,IAAG,KAAK;AAAA,IACV;AAAA,EACF;AAgBF;AAtIE;AAPK;AAqEL,cAAS,SAAC,OAA0B;AAClC,QAAM,QAAQ,mBAAK;AACnB,MAAI,UAAU,MAAO;AACrB,qBAAK,QAAS;AACd,OAAK,IAAI,MAAM,SAAU,KAAM,OAAQ,KAAM,EAAE;AAC/C,OAAK,cAAc,IAAI,YAAY,SAAS;AAAA,IAC1C,QAAQ;AAAA,MACN,YAAY;AAAA,MACZ,UAAU;AAAA,IACZ;AAAA,EACF,CAAC,CAAC;AACJ;AAhFW,mBAgIK,SAAS;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AA5HzB;AAAA,EADCC,GAAS;AAAA,GAHC,mBAIX;AAMA;AAAA,EADCA,GAAS;AAAA,GATC,mBAUX;AAVW,qBAAN;AAAA,EADNC,GAAc,cAAc;AAAA,GAChB;;;ACZN,IAAM,oBAAoB,MAAM,CAAE,QAAQ,WAAW,QAAQ,MAAO;AAEpE,IAAM,wBAAwB,CAACC,IAAQ,aAA8C;AAC1F,MAAI,OAAOA,OAAM,UAAU;AACzB,QAAIA,OAAM,OAAQ,QAAO;AACzB,QAAIA,OAAM,OAAQ,QAAO;AACzB,QAAIA,OAAM,OAAQ,QAAO;AACzB,QAAIA,OAAM,UAAW,QAAO;AAAA,EAC9B;AACA,MAAI,SAAU,QAAO;AACrB,QAAM,IAAI,MAAM,iBAAkBA,EAAE,eAAgB,kBAAkB,EAAE,KAAK,GAAG,CAAE,EAAE;AACtF;;;ACRO,IAAM,eAAN,cAA2BC,GAAW;AAAA,EASlC,SAAS;AAChB,UAAM,QAAQ,kBAAkB;AAEhC,WAAO;AAAA,wBACc,KAAK,cAAe;AAAA,QACpC,MAAM,IAAI,CAAAC,OAAK,aAAgBA,EAAE,WAAW,CAAE;AAAA;AAAA;AAAA,EAGrD;AAAA,EAEA,eAAeC,QAAc;AAC3B,UAAMC,SAASD,OAAM,OAA6B;AAElD,SAAK,cAAc,IAAI,YAAY,gBAAgB;AAAA,MACjD,QAAQ;AAAA,QACN,MAAM,sBAAsBC,MAAK;AAAA,MACnC;AAAA,IACF,CAAC,CAAC;AAAA,EACJ;AACF;AA5Ba,aACK,SAAS;AAAA;AAAA;AAAA;AAAA;AAAA;AADd,eAAN;AAAA,EADNC,GAAc,eAAe;AAAA,GACjB;;;ACLb,IAAaC,QAAO,KAAK,KAAK;ACgB9B,SAAgBC,gBAAeC,gBAAwE;AACrG,SAAO,MAAM,QAAQ,cAAA,IAAkB,eAAe,IAAI,CAAAC,OAAKA,MAAK,KAAK,KAAK,IAAA,IAAS,kBAA6B,KAAK,KAAK;AAC/H;AAOD,SAAgBC,cAAaC,gBAAwB;AACnD,UAAQ,iBAAiB,KAAK,OAAO,IAAI,KAAK;AAC/C;AAyCD,SAAgBC,gBAAeC,gBAAwE;AACrG,SAAO,MAAM,QAAQ,cAAA,IAAkB,eAAe,IAAI,CAAAC,OAAKA,KAAI,MAAM,KAAK,EAAA,IAAO,iBAA4B,MAAM,KAAK;AAC7H;AAoCD,IAAaC,cAAa,CAACC,OAAeC,QAAgB,YAAY,SAAS;AAC7E,MAAI,WAAW;AACb,QAAIC,KAAI,QAAQ;AAChB,QAAIA,MAAKC,MAAM,CAAAD,KAAIA,KAAIC;AACvB,WAAOD;EACR,OAAM;AACL,UAAMA,KAAI,QAAQ;AAClB,QAAIA,KAAI,EACN,QAAOC,QAAOD;AAEhB,WAAOA;EACR;AACF;AA2DD,IAAaE,aAAY,CAACC,OAAeC,KAAa,YAAY,SAAS;AACzE,MAAIC,KAAI;AACR,MAAI,MAAMA,IAAG;AACX,IAAAA,KAAI;AACJ,UAAMC,QAAO,QAAQ;EACtB;AACD,MAAIC,KAAI,MAAMF;AACd,MAAI,UAAW,CAAAE,KAAID,QAAOC;AAC1B,MAAIA,MAAKD,MAAM,QAAOC,KAAID;AAC1B,SAAOC;AACR;ACnLD,IAAaC,UAAS,CAACC,OAAa;AAClC,MAAIC,WAAUC,EAAA,GACZ;QAAIA,GAAE,MAAM,KAAM,QAAO;EAAM;AAEjC,SAAOA,GAAE,MAAM,QAAQA,GAAE,MAAM;AAChC;AAKD,IAAaC,WAAQ,CAACH,OAAa;AACjC,MAAIC,WAAUC,EAAA,GACZ;QAAI,CAAC,OAAO,MAAMA,GAAE,CAAA,EAAI,QAAO;EAAM;AAEvC,SAAO,OAAO,MAAMA,GAAE,CAAA,KAAM,OAAO,MAAMA,GAAE,CAAA;AAC5C;AAED,SAAgBE,MAAKJ,IAAU,OAAO,SAAS,YAAY,IAA2B;AACpF,MAAIE,OAAM,OACR,QAAO,YAAY,IAAK,IAAA,sCAA4C,KAAK,UAAUA,EAAA,CAAE,IAAK,SAAA;AAE5F,MAAIA,OAAM,KACR,QAAO,YACL,IAAK,IAAA,iCAAuC,KAAK,UAAUA,EAAA,CAAE,IAAK,SAAA;AAGtE,MAAI,OAAOA,OAAM,SAAU,QAAO,YAChC,IAAK,IAAA,cAAoB,OAAOA,EAAA,uBAAyB,SAAA;AAE3D,MAAIA,GAAE,MAAM,OACV,QAAO,YACL,IAAK,IAAA,wCAA8C,KAAK,UAAUA,EAAA,CAAE,IAAK,SAAA;AAG7E,MAAIA,GAAE,MAAM,OACV,QAAO,YACL,IAAK,IAAA,wCAA8C,KAAK,UAAUA,EAAA,CAAE,IAAK,SAAA;AAG7E,MAAI,OAAOA,GAAE,MAAM,SACjB,QAAO,YAAY,IAAK,IAAA,6BAAmC,OAAOA,GAAE,CAAA,IAAM,SAAA;AAE5E,MAAI,OAAOA,GAAE,MAAM,SACjB,QAAO,YAAY,IAAK,IAAA,6BAAmC,OAAOA,GAAE,CAAA,IAAM,SAAA;AAE5E,MAAIA,GAAE,MAAM,QAAW;AACrB,QAAI,OAAOA,GAAE,MAAM,SAAU,QAAO,YAAY,GAAI,IAAA,6BAAmC,OAAOA,GAAE,CAAA,IAAM,SAAA;AACtG,QAAI,OAAO,MAAMA,GAAE,CAAA,EAAI,QAAO,YAAY,IAAK,IAAA,oBAA0B,KAAK,UAAUA,EAAA,CAAE,IAAK,SAAA;EAChG;AAED,MAAIA,GAAE,MAAM,KAAM,QAAO,YAAY,IAAK,IAAA,eAAoB,SAAA;AAC9D,MAAIA,GAAE,MAAM,KAAM,QAAO,YAAY,IAAK,IAAA,eAAoB,SAAA;AAE9D,MAAI,OAAO,MAAMA,GAAE,CAAA,EAAI,QAAO,YAAY,IAAK,IAAA,cAAmB,SAAA;AAClE,MAAI,OAAO,MAAMA,GAAE,CAAA,EAAI,QAAO,YAAY,IAAK,IAAA,cAAmB,SAAA;AAElE,SAAO;IAAE,SAAS;IAAM,OAAOA;EAAG;AACnC;AAOD,SAAgBG,SAAML,IAAU,OAAO,SAASM,MAAe;AAC7D,cAAYF,MAAKF,IAAG,MAAM,IAAA,CAAK;AAuChC;AAOD,IAAaK,qBAAoB,CAACC,KAAqB,OAAO,SAAS;AACrEH,EAAAA,SAAMI,KAAI,IAAA;AACV,cACE,WAAWA,IAAG,GAAG,WAAW,GAAI,IAAA,IAAS,GACzC,WAAWA,IAAG,GAAG,WAAW,GAAI,IAAA,IAAS,GACzC,MAAM;AACJ,QAAI,OAAOA,IAAG,MAAM,YAClB,QAAO,WAAWA,IAAG,GAAG,WAAW,GAAI,IAAA,IAAS;EAEnD,CAAA;AAEH,SAAO;AACR;AAUD,SAAgBC,SAAQC,IAAiC;AACvD,MAAIT,OAAM,OAAW,QAAO;AAC5B,MAAIA,OAAM,KAAM,QAAO;AACvB,MAAKA,GAAY,MAAM,OAAW,QAAO;AACzC,MAAKA,GAAY,MAAM,OAAW,QAAO;AACzC,SAAO;AACR;AASD,IAAaD,aAAY,CAACW,OAAqC;AAC7D,MAAIV,OAAM,OAAW,QAAO;AAC5B,MAAIA,OAAM,KAAM,QAAO;AACvB,MAAKA,GAAc,MAAM,OAAW,QAAO;AAC3C,MAAKA,GAAc,MAAM,OAAW,QAAO;AAC3C,MAAKA,GAAc,MAAM,OAAW,QAAO;AAC3C,SAAO;AACR;AAQD,IAAaW,WAAU,CAACb,OAAa;AACnC,MAAIC,WAAUC,EAAA,GACZ;QAAIA,GAAE,MAAM,EAAG,QAAO;EAAM;AAE9B,SAAOA,GAAE,MAAM,KAAKA,GAAE,MAAM;AAE7B;AAUD,IAAaY,iBAAgB,CAACd,OAAa;AACzC,MAAIC,WAAUC,EAAA,GACZ;QAAI,CAAC,OAAO,MAAMA,GAAE,CAAA,EAAI,QAAO;EAAM;AAEvC,SAAO,OAAO,MAAMA,GAAE,CAAA,KAAM,OAAO,MAAMA,GAAE,CAAA;AAC5C;ACvLD,SAAgBa,uBAAsBC,IAA8BC,KAA+BC,KAAcC,KAAcC,KAAcC,KAAc;AACzJ,MAAIpB,WAAU,EAAA,KAAOA,WAAU,GAAA,EAAM,QAAO,CAAE,IAAI,GAAK;AACvD,MAAIS,SAAQ,EAAA,KAAOA,SAAQ,GAAA,EAAM,QAAO,CAAE,IAAI,GAAK;AACnD,MAAIT,WAAU,EAAA,GAAK;AACjB,UAAMqB,MAAI;MACR,GAAG;MACH,GAAG;MACH,GAAG;IACJ;AACD,QAAI,CAACrB,WAAUqB,GAAAA,EAAI,OAAM,IAAI,MAAM,8BAA8B;AACjE,WAAO,CAAE,IAAIA,GAAG;EACjB;AACD,MAAIZ,SAAQ,EAAA,GAAK;AACf,UAAMY,MAAI;MACR,GAAG;MACH,GAAG;IACJ;AACD,QAAI,CAACZ,SAAQY,GAAAA,EAAI,OAAM,IAAI,MAAM,2BAA2B;AAC5D,WAAO,CAAE,IAAIA,GAAG;EACjB;AAED,MAAI,OAAO,QAAQ,eAAe,OAAO,QAAQ,aAAa;AAC5D,UAAMC,MAAI;MACR,GAAG;MACH,GAAG;MACH,GAAG;IACJ;AACD,UAAMD,MAAI;MACR,GAAG;MACH,GAAG;MACH,GAAG;IACJ;AACD,QAAI,CAACrB,WAAUsB,GAAAA,EAAI,OAAM,IAAI,MAAM,gCAAgC;AACnE,QAAI,CAACtB,WAAUqB,GAAAA,EAAI,OAAM,IAAI,MAAM,iCAAiC;AACpE,WAAO,CAAEC,KAAGD,GAAG;EAChB;AAED,QAAMC,KAAI;IACR,GAAG;IACH,GAAG;EACJ;AACD,QAAMD,KAAI;IACR,GAAG;IACH,GAAG;EACJ;AACD,MAAI,CAACZ,SAAQa,EAAA,EAAI,OAAM,IAAI,MAAM,8BAA8B;AAC/D,MAAI,CAACb,SAAQY,EAAA,EAAI,OAAM,IAAI,MAAM,+BAA+B;AAChE,SAAO,CAAEC,IAAGD,EAAG;AAEhB;AAUD,SAAgBE,mBACdC,IACAC,IACAC,IACiB;AACjB,MAAIJ,OAAM,OAAW,QAAO;IAAE,GAAG;IAAG,GAAG;EAAG;AAE1C,MAAI,MAAM,QAAQA,EAAA,GAAI;AACpB,QAAIA,GAAE,WAAW,EAAG,QAAO,OAAO,OAAO;MAAE,GAAG;MAAG,GAAG;IAAG,CAAA;AACvD,QAAIA,GAAE,WAAW,EAAG,QAAO,OAAO,OAAO;MAAE,GAAGA,GAAG,CAAA;MAAK,GAAG;IAAG,CAAA;AAC5D,QAAIA,GAAE,WAAW,EAAG,QAAO,OAAO,OAAO;MAAE,GAAGA,GAAG,CAAA;MAAK,GAAGA,GAAG,CAAA;IAAK,CAAA;AACjE,QAAIA,GAAE,WAAW,EAAG,QAAO,OAAO,OAAO;MAAE,GAAGA,GAAG,CAAA;MAAK,GAAGA,GAAG,CAAA;MAAK,GAAGA,GAAG,CAAA;IAAK,CAAA;AAC5E,UAAM,IAAI,MACR,oDAAqDA,GAAE,MAAA,GAAU;EAEpE;AAED,MAAIb,SAAQa,EAAA,EACV,QAAOA;WACE,OAAOA,OAAM,YAAY,OAAOD,OAAM,SAC/C,OAAM,IAAI,UACR,gDAAiD,KAAK,UACpDC,EAAA,CACD,OAAS,KAAK,UAAUD,EAAA,CAAE,EAAG;AAKlC,MAAI,OAAOM,OAAM,SACf,QAAO,OAAO,OAAO;IAAE,GAAGL;IAAG,GAAGD;IAAG,GAAGM;EAAG,CAAA;AAG3C,SAAO,OAAO,OAAO;IAAE,GAAGL;IAAG,GAAGD;EAAG,CAAA;AACpC;ACtED,SAAgBO,UACdC,IACAC,MACAC,IACAC,IACQ;AACR,QAAMxB,MAAKe,mBAAkB,MAAMU,IAAGC,EAAA;AACtC9B,EAAAA,SAAMI,KAAI,GAAG;AACbJ,EAAAA,SAAMkB,IAAG,GAAG;AACZ,SAAOtB,WAAUQ,GAAA,KAAOR,WAAUsB,EAAA,IAAK,KAAK,MAAMd,IAAG,IAAIc,GAAE,GAAGd,IAAG,IAAIc,GAAE,GAAGd,IAAG,IAAIc,GAAE,CAAA,IAAK,KAAK,MAAMd,IAAG,IAAIc,GAAE,GAAGd,IAAG,IAAIc,GAAE,CAAA;AACzH;AAUD,SAAgBa,YACdC,IACAC,MACAN,IACQ;AACR,QAAMvB,MAAKe,mBAAkB,MAAMU,EAAA;AACnC7B,EAAAA,SAAMI,KAAI,GAAG;AACbJ,EAAAA,SAAMkB,IAAG,GAAG;AACZ,SAAO,KAAK,MAAMd,IAAG,IAAIc,GAAE,GAAGd,IAAG,IAAIc,GAAE,CAAA;AACxC;AC5BD,SAAgBgB,aACdC,aACG,QACa;AAChB,MAAI,OAAO,WAAW,EAAG,OAAM,IAAI,MAAM,oBAAoB;AAC7D,MAAIC,OAAM,OAAQ,CAAA;AAClB,aAAWvC,MAAK,OACd,KAAID,WAAUwC,IAAA,KAAQxC,WAAUC,EAAA,EAC9B,CAAAuC,OAAM,SAASA,MAAKvC,EAAA;MAEpB,CAAAuC,OAAM,SAASA,MAAYvC,EAAA;AAG/B,SAAOuC;AACR;AC/BD,IAAaC,kBAAiB,CAC5BC,SACAC,UACAC,aACAC,eACmB;AACnB,MAAI,QAAQ,IAAI,YAAY,EAC1B,OAAM,IAAI,MAAM,sCAAsC;AAExD,MAAI,QAAQ,IAAI,WAAW,EACzB,OAAM,IAAI,MAAM,qCAAqC;AAGvD,QAAM,KAAK,SAAS,IAAI,QAAQ;AAChC,QAAMC,MAAK,YAAY,IAAI,WAAW;AACtC,QAAM,KAAK,KAAK,IAAI,WAAW,IAAI,QAAQ,CAAA;AAC3C,QAAMC,MAAK,KAAK,IAAI,YAAY,IAAI,SAAS,CAAA;AAC7C,SAAO;IACL,GAAG,KAAK,IAAI,QAAQ,GAAG,WAAW,CAAA;IAClC,GAAG,KAAK,IAAI,SAAS,GAAG,QAAQ,CAAA;IAChC,OAAO,KAAK,IAAI,IAAID,GAAA;IACpB,QAAQ,KAAK,IAAI,IAAIC,GAAA;EACtB;AACF;AC7BD,IAAaC,UAAO,IAAI,WAAiD;AACvE,QAAM,WAAWV,aAAY,CAAChB,IAAGD,OAAM;AACrC,WAAOC,GAAE,IAAID,GAAE,IAAIC,KAAID;EACxB,GAAE,GAAG,MAAA;AACN,QAAM,YAAYiB,aAAY,CAAChB,IAAGD,OAAM;AACtC,WAAOC,GAAE,IAAID,GAAE,IAAIC,KAAID;EACxB,GAAE,GAAG,MAAA;AACN,QAAM,UAAUiB,aAAY,CAAChB,IAAGD,OAAM;AACpC,WAAOC,GAAE,IAAID,GAAE,IAAIC,KAAID;EACxB,GAAE,GAAG,MAAA;AACN,QAAM,aAAaiB,aAAY,CAAChB,IAAGD,OAAM;AACvC,WAAOC,GAAE,IAAID,GAAE,IAAIC,KAAID;EACxB,GAAE,GAAG,MAAA;AAEN,QAAM,UAAU;IAAE,GAAG,SAAS;IAAG,GAAG,QAAQ;EAAG;AAC/C,QAAM,WAAW;IAAE,GAAG,UAAU;IAAG,GAAG,QAAQ;EAAG;AACjD,QAAM,cAAc;IAAE,GAAG,UAAU;IAAG,GAAG,WAAW;EAAG;AACvD,QAAM,aAAa;IAAE,GAAG,SAAS;IAAG,GAAG,WAAW;EAAG;AACrD,SAAO4B,gBAAoB,SAAS,UAAU,aAAa,UAAA;AAC5D;AAED,IAAaC,UAAS,IAAI,WAAqD;AAC7E,QAAM,MAAMF,QAAK,GAAG,MAAA;AACpB,QAAM,OAAOV,aAAY,CAACa,IAAYC,OAAe;AACnD,WAAO9B,GAAE,IAAID,GAAE,IAAIC,KAAID;EACxB,GAAE,GAAG,MAAA;AACN,QAAM,OAAOiB,aAAY,CAACa,IAAYC,OAAe;AACnD,WAAO9B,GAAE,IAAID,GAAE,IAAIC,KAAID;EACxB,GAAE,GAAG,MAAA;AAEN,SAAO;IACL,GAAG;IACH,GAAG,KAAK;IACR,OAAO,KAAK,IAAI,KAAK;EACtB;AACF;ACrCD,IAAagC,gBAAe,CAACC,OAA2B;AACtD,MAAKrD,GAAY,aAAa,OAAW,QAAO;AAChD,MAAKA,GAAY,gBAAgB,OAAW,QAAO;AACnD,SAAO;AACR;AAOD,IAAaG,WAAQ,CAACmD,IAAU,OAAO,YAAY;AACjD,MAAItD,OAAM,OACR,OAAM,IAAI,MACR,IAAK,IAAA,wDAA8D,KAAK,UACtEA,EAAA,CACD,EAAG;AAGR,MAAIA,OAAM,KACR,OAAM,IAAI,MACR,IAAK,IAAA,mDAAyD,KAAK,UACjEA,EAAA,CACD,EAAG;AAGR,MAAIA,GAAE,gBAAgB,OACpB,OAAM,IAAI,MACR,IAAK,IAAA,oEAA0E,KAAK,UAClFA,EAAA,CACD,EAAG;AAGR,MAAIA,GAAE,aAAa,OACjB,OAAM,IAAI,MACR,IAAK,IAAA,iEAAuE,KAAK,UAC/EA,EAAA,CACD,EAAG;AAGR,MAAI,OAAOA,GAAE,gBAAgB,SAC3B,OAAM,IAAI,UAER,IAAK,IAAA,uCAA6CA,GAAE,WAAA,EAAc;AAGtE,MAAI,OAAOA,GAAE,aAAa,SAExB,OAAM,IAAI,UAAU,IAAK,IAAA,oCAA0CA,GAAE,QAAA,EAAW;AAGlF,MAAIA,GAAE,gBAAgB,KAAM,OAAM,IAAI,MAAM,IAAK,IAAA,uBAA4B;AAC7E,MAAIA,GAAE,aAAa,KAAM,OAAM,IAAI,MAAM,IAAK,IAAA,oBAAyB;AAEvE,MAAI,OAAO,MAAMA,GAAE,WAAA,EACjB,OAAM,IAAI,UAAU,IAAK,IAAA,sBAA2B;AAEtD,MAAI,OAAO,MAAMA,GAAE,QAAA,EAAW,OAAM,IAAI,MAAM,IAAK,IAAA,mBAAwB;AAC5E;ACvDD,IAAauD,YAAS,CAACC,IAAUC,iBAC/B,OAAO,OAAO;EACZ,GAAG/B;EACH,aAAaA,GAAE,cAAc;AAC9B,CAAA;AAOH,IAAagC,YAAS,CAACJ,OAAoB;AACzCnD,EAAAA,SAAMH,IAAG,GAAG;AACZ,SAAO,OAAO,OAAO;IACnB,GAAGA;IACH,aAAaA,GAAE,cAAc,KAAK;EACnC,CAAA;AACF;AAQD,IAAa2D,cAAa,CAACC,IAAUC,OAAsB;AACzD1D,EAAAA,SAAMkB,IAAG,GAAG;AACZlB,EAAAA,SAAMiB,IAAG,GAAG;AACZ,MAAIC,GAAE,aAAaD,GAAE,SAAU,QAAO;AACtC,SAAOC,GAAE,gBAAgB,CAACD,GAAE;AAC7B;AAQD,IAAa0C,cAAa,CAACF,IAAUC,OAAsB;AACzD1D,EAAAA,SAAMkB,IAAG,GAAG;AACZlB,EAAAA,SAAMiB,IAAG,GAAG;AACZ,SAAOC,GAAE,gBAAgBD,GAAE;AAC5B;AAQD,IAAa2C,kBAAiB,CAACH,IAAUC,OAAsB;AAC7D1D,EAAAA,SAAMkB,IAAG,GAAG;AACZlB,EAAAA,SAAMiB,IAAG,GAAG;AACZ,SAAOC,GAAE,gBAAgB,CAACD,GAAE;AAC7B;AAQD,IAAa4C,iBAAgB,CAACR,IAAUS,cACtC,OAAO,OAAO;EACZ,GAAGvC;EACH,aAAaA,GAAE,cAAcwC,gBAAe,SAAA;AAC7C,CAAA;ACnDH,SAAgBC,YACdrD,IAA8BC,KAA+BC,KAAcC,KAAcC,KAAcC,KACtF;AACjB,QAAM,CAAE,KAAK,GAAA,IAAQN,uBAAsB,IAAW,KAAY,KAAY,KAAY,KAAY,GAAA;AACtGV,EAAAA,SAAM,KAAK,GAAG;AACdA,EAAAA,SAAM,KAAK,GAAG;AACd,QAAMiE,MAAuB;IAC3B,GAAG,IAAI,IAAI,IAAI;IACf,GAAG,IAAI,IAAI,IAAI;EAChB;AACD,MAAIrE,WAAU,GAAA,KAAQA,WAAU,GAAA,EAC9B,CAAAQ,IAAG,KAAK,IAAI,KAAK,MAAM,IAAI,KAAK;AAElC,SAAO,OAAO,OAAOA,GAAA;AACtB;ACjCD,IAAa8D,SAAQ;EAAE,GAAG;EAAG,GAAG;AAAG;AAKnC,IAAaC,QAAO;EAAE,GAAG;EAAG,GAAG;AAAG;AAOlC,IAAaC,WAAU;EAAE,GAAG;EAAG,GAAG;EAAG,GAAG;AAAG;AAK3C,IAAaC,UAAS;EAAE,GAAG;EAAG,GAAG;EAAG,GAAG;AAAG;ACD1C,IAAaC,YAAS,CAACjB,IAAUkB,UAAiB;AAChD,QAAMtD,KAAIuD,aAAYjD,IAAG,KAAA;AACzB,SAAO;IAAE,GAAG;IAAO,GAAAN;EAAG;AACvB;AAwBD,IAAawD,eAAgC,CAC3CC,IACAC,IACAC,OACU;AACV,MAAI3B,cAAa/B,EAAA,GAAI;AACnB,QAAI,OAAOD,OAAM,YAAa,CAAAA,KAAI4D;AAClC,QAAIxE,SAAQY,EAAA,EACV,QAAO6D,kBAAiB5D,GAAE,UAAUA,GAAE,aAAaD,EAAA;AAErD,UAAM,IAAI,MACR,2DAA2D;EAE9D,WAAU,OAAOC,OAAM,SACtB,OAAM,IAAI,UACR,8CAA+C,KAAK,UAAUA,EAAA,CAAE,EAAG;WAGjE,OAAOA,OAAM,YAAY,OAAOD,OAAM,UAAU;AAClD,QAAI,OAAOM,OAAM,YAAa,CAAAA,KAAIsD;AAClC,QAAI,CAACxE,SAAQkB,EAAA,EACX,OAAM,IAAI,MACR,2DAA2D;AAG/D,WAAOuD,kBAAiB5D,IAAGD,IAAGM,EAAA;EAC/B,MACC,OAAM,IAAI,UACR,mDAAoD,OAAOL,EAAA,KAAQ,OAAOD,EAAA,KAAQ,OAAOM,EAAA,SAAY,KAAK,UACxGL,EAAA,CACD,EAAG;AAIX;AAgBD,IAAa6D,iBAAgB,CAC3BC,SACAC,WACU;AACV,MAAI,OAAOC,YAAU,YAAa,OAAM,IAAI,MAAM,0CAA0C;AAC5F,MAAI,OAAO,WAAW,YAAa,OAAM,IAAI,MAAM,2CAA2C;AAE9FA,YAAQC,YAAcD,SAAO,MAAA;AAE7B,QAAM,QAAQ,KAAK,MAAMA,QAAM,GAAGA,QAAM,CAAA;AACxC,QAAM1D,aAAW,KAAK,MAAM0D,QAAM,GAAGA,QAAM,CAAA;AAE3C,QAAM,QAAQ;IACZ,GAAGA;IACH,aAAa;IACb,UAAA;EACD;AACD,SAAQ,MAAc;AACtB,SAAQ,MAAc;AACtB,SAAO,OAAO,OAAO,KAAA;AACtB;AASD,IAAMJ,oBAAmB,CACvBM,YACAC,cACAJ,SAAgBJ,WACN;AACVS,EAAAA,SAAW,MAAA;AACX,SAAO,OAAO,OAAO;IACnB,GAAG,OAAO,IAAI9D,aAAW,KAAK,IAAI,YAAA;IAClC,GAAG,OAAO,IAAIA,aAAW,KAAK,IAAI,YAAA;EACnC,CAAA;AACF;AAQD,IAAa+D,cAAW,CAACpC,IAAUqC,WAA4B;AAC7D,MAAI3F,OAAM,OAAW,QAAO;AAC5B,MAAIA,OAAM,KAAM,QAAO;AAEvB,QAAM,WAAW4F,gBAAe5F,GAAE,WAAA;AAClC,QAAM6F,KAAI,SAAS7F,GAAE,SAAS,QAAQ,MAAA,IAAUA,GAAE;AAClD,QAAMqB,KAAI,SAAS,SAAS,QAAQ,MAAA,IAAU;AAC9C,SAAO,IAAKwE,EAAA,IAAOxE,EAAA;AACpB;AAED,IAAayE,WAAU,CAACC,IAAU,SAASf,WAAsB;AAC/D7E,EAAAA,SAAM6F,IAAG,GAAG;AACZ,SAAO,OAAO,OAAO;IACnB,GAAG,OAAO,IAAIA,GAAE,WAAW,KAAK,IAAIA,GAAE,WAAA;IACtC,GAAG,OAAO,IAAIA,GAAE,WAAW,KAAK,IAAIA,GAAE,WAAA;EACvC,CAAA;AACF;AC9JD,IAAaC,eAAY,CAACzC,OAAoB;AAE5C,MAAI9B,GAAE,aAAa,EAAG,OAAM,IAAI,MAAM,qCAAqC;AAC3E,SAAO,OAAO,OAAO;IACnB,GAAGA;IACH,UAAU;EACX,CAAA;AACF;AAWD,IAAawE,oBAAiB,CAACH,IAAUI,OAAM,GAAG5D,OAAM,MAAa;AACnE,MAAI,MAAMyD,GAAE;AACZ,MAAI,MAAMG,KAAK,OAAMA;AACrB,MAAI,MAAM5D,KAAK,OAAMA;AACrB,SAAO,OAAO,OAAO;IACnB,GAAGyD;IACH,UAAU;EACX,CAAA;AACF;AAaD,IAAaI,gBAAa,CAACxC,IAAUC,OAAqB;AACxD1D,EAAAA,SAAMkB,IAAG,GAAG;AACZlB,EAAAA,SAAMiB,IAAG,GAAG;AACZ,SAAOC,GAAE,WAAWD,GAAE,WAAW,KAAK,IAAIA,GAAE,cAAcC,GAAE,WAAA;AAC7D;AAUD,IAAagF,cAAW,CAACN,IAAUO,QAAuB;AACxDnG,EAAAA,SAAM6F,EAAA;AACN,cAAY,WAAW,KAAK,IAAI,KAAK,CAAC;AACtC,SAAO,OAAO,OAAO;IACnB,GAAGA;IACH,UAAUA,GAAE,WAAW;EACxB,CAAA;AACF;AASD,IAAaO,YAAS,CAACR,IAAUO,QAAuB;AACtDnG,EAAAA,SAAM6F,EAAA;AACN,cAAY,WAAW,KAAK,IAAI,KAAK,CAAC;AACtC,SAAO,OAAO,OAAO;IACnB,GAAGA;IACH,UAAUA,GAAE,WAAW;EACxB,CAAA;AACF;AC7DD,IAAaQ,iBAAc,OAAO,OAAO;EAAE,GAAG;EAAY,GAAG;AAAY,CAAA;AAOzE,IAAaC,iBAAgB,OAAO,OAAO;EAAE,GAAG;EAAY,GAAG;EAAY,GAAG;AAAY,CAAA;ACL1F,IAAaC,eAAc,CAACvE,IAAUwE,IAAW5B,OAAc;AAC7D5E,EAAAA,SAAMkB,IAAG,GAAG;AAEZ,MAAID,OAAM,OACR,QAAO,KAAK,MAAMC,GAAE,GAAGA,GAAE,CAAA;AAE3BlB,EAAAA,SAAMiB,IAAG,GAAG;AACZ,MAAIM,OAAM,OACR,QAAO,KAAK,MAAMN,GAAE,IAAIC,GAAE,GAAGD,GAAE,IAAIC,GAAE,CAAA;AAGvClB,EAAAA,SAAMuB,IAAG,GAAG;AACZ,SAAO,KAAK,MAAMN,GAAE,IAAIC,GAAE,GAAGD,GAAE,IAAIC,GAAE,CAAA,IAAK,KAAK,MAAMK,GAAE,IAAIL,GAAE,GAAGK,GAAE,IAAIL,GAAE,CAAA;AACzE;AAkBD,IAAauF,qBAAoB,CAACzE,IAAUwE,IAAW5B,OAAc;AACnE,QAAM,QAAQ2B,aAAYrF,IAAGD,IAAGM,EAAA;AAChC,MAAI,QAAQ,EAAG,QAAO,QAAQmF;AAC9B,SAAO;AACR;AAWD,IAAaC,yBAAwB,CAAC3E,IAAU4E,IAAUC,OAAa;AACrE,QAAM,KAAK,KAAK,KAAK,KAAK,IAAI5F,GAAE,IAAIC,GAAE,GAAG,CAAA,IAAK,KAAK,IAAID,GAAE,IAAIC,GAAE,GAAG,CAAA,CAAE;AACpE,QAAM,KAAK,KAAK,KAAK,KAAK,IAAID,GAAE,IAAIM,GAAE,GAAG,CAAA,IAAK,KAAK,IAAIN,GAAE,IAAIM,GAAE,GAAG,CAAA,CAAE;AACpE,QAAMuF,MAAK,KAAK,KAAK,KAAK,IAAIvF,GAAE,IAAIL,GAAE,GAAG,CAAA,IAAK,KAAK,IAAIK,GAAE,IAAIL,GAAE,GAAG,CAAA,CAAE;AACpE,SAAO,KAAK,MAAM,KAAK,KAAK,KAAK,KAAK4F,MAAKA,QAAO,IAAI,KAAK,GAAA;AAC5D;ACxDD,IAAaC,mBAAkB,CAC7BC,KACAC,UAAiC,KAAK,UAC5B;AACVjH,EAAAA,SAAMI,KAAI,IAAI;AACd,SAAO,OAAO,OAAO;IACnB,GAAG,QAAQA,IAAG,CAAA;IACd,GAAG,QAAQA,IAAG,CAAA;EACf,CAAA;AACF;AAQD,IAAa8G,QAAO,CAACF,QAAqB;AACxChH,EAAAA,SAAMI,KAAI,IAAI;AACd,MAAI,OAAO,EACT,GAAGA,IACJ;AACD,SAAO,KAAK;AACZ,SAAO,OAAO,OAAO,IAAA;AACtB;AASD,IAAa+G,QAAO,CAACH,KAAWI,KAAY,MAAe;AACzDpH,EAAAA,SAAMI,KAAI,IAAI;AACd,SAAO,OAAO,OAAO;IACnB,GAAGA;IACH,GAAA0B;EACD,CAAA;AACF;AAQD,SAAgByD,YAAS5F,IAAU6F,QAAyB;AAC1D,MAAI3F,OAAM,OAAW,QAAO;AAC5B,MAAIA,OAAM,KAAM,QAAO;AACvBG,EAAAA,SAAMH,IAAG,IAAI;AAEb,QAAMwH,KAAI,SAASxH,GAAE,EAAE,QAAQ,MAAA,IAAUA,GAAE;AAC3C,QAAMgC,KAAI,SAAShC,GAAE,EAAE,QAAQ,MAAA,IAAUA,GAAE;AAE3C,MAAIA,GAAE,MAAM,OACV,QAAO,IAAKwH,EAAA,IAAOxF,EAAA;OACd;AACL,UAAMC,KAAI,SAASjC,GAAE,EAAE,QAAQ,MAAA,IAAUA,GAAE;AAC3C,WAAO,IAAKwH,EAAA,IAAOxF,EAAA,IAAOC,EAAA;EAC3B;AACF;;;;;;;AC3DD,IAAa0C,iBAAc,CAAC8C,KAAeC,WAAyB;AAClE,QAAMC,KAAIC,WAAU,KAAK,MAAA;AACzB,QAAMvG,KAAI4D,aAAiB,IAAI,QAAQ,IAAI,aAAa0C,EAAA;AACxD,QAAMvG,KAAI6D,aAAiB,IAAI,SAAS,IAAI,QAAQ,IAAI,aAAa0C,EAAA;AACrE,SAAO;IAAE,GAAAtG;IAAG,GAAAD;EAAG;AAChB;AAED,IAAMwG,aAAY,CAACH,KAAeC,WAA0B;AAC1D,MAAI,WAAW,OAAW,QAAO;AACjC,MAAI,IAAI,WAAW,OAAW,QAAO,IAAI;AACzC,SAAO;IAAE,GAAG;IAAG,GAAG;EAAG;AACtB;AAwCD,IAAahC,cAAW,CAAC+B,QAA0B;AACjD,MAAI,QAAQ,mBAAoB,IAAI,WAAA,YAAyB,IAAI,MAAA,SAAiB,IAAI,MAAA;AACtF,MAAI,IAAI,OACN,UAAS,YAAaI,YAAc,IAAI,MAAA,CAAO;AAEjD,WAAS;AACT,SAAO;AACR;AAWD,IAAaC,YAAW,CAACC,OAAYL,WAA6B;AAChE,QAAMC,KAAI,UAAUK,MAAK;AACzB,SAAO;IACL,aAAatB,aAAYsB,MAAK,GAAGL,EAAA;IACjC,QAAQhG,UAASqG,MAAK,GAAGL,EAAA;IACzB,QAAQhG,UAASqG,MAAK,GAAGA,MAAK,CAAA;IAC9B,QAAQL;EACT;AACF;AC9ED,UAAiBM,QACfC,YACAC,MACqD;AACrD,MAAI,OAAO;AAEX,SAAO,MAAM;AACX,UAAM9G,KAAI,aAAa;AACvB,UAAM;MACJ,UAAU,OAAOA;MACjB,aAAaA;MACP;IACP;EACF;AACF;AASD,IAAa+G,aAAY,CACvBC,MACAH,YACAC,SACU;AACV,QAAM9G,KAAI,aAAa;AACvB,SAAO,OAAO,OAAO;IACnB,UAAU,OAAOA;IACjB,aAAaA;EACd,CAAA;AACF;;;;;;;;;;;;;;;;;;;;;;;;;AElCD,IAAaiH,gBAAa,CAACnG,IAAU4E,OAAmB;AACtDtB,EAAAA,SAAWpE,IAAG,GAAG;AACjBoE,EAAAA,SAAWrE,IAAG,GAAG;AACjB,EAAAC,KAAI,OAAO,OAAO,EAAE,GAAGA,GAAG,CAAA;AAC1B,EAAAD,KAAI,OAAO,OAAO,EAAE,GAAGA,GAAG,CAAA;AAC1B,SAAO,OAAO,OAAO;IAChB,GAAAC;IACA,GAAAD;EACJ,CAAA;AACF;;;;;;;;;;;;;;;;;;;;;ACJD,IAAamH,SAAQ,CAAClF,OAAyB,OAAQrD,GAAU,gBAAgB,eAAe,OAAQA,GAAU,cAAc,eAAe,OAAQA,GAAU,cAAc;AAO/K,IAAawI,kBAAe,CAACC,OAA+C,OAAQzI,GAAY,MAAM,eAAe,OAAQA,GAAY,MAAM;AAgC/I,SAAgB0I,eAAYC,QAAgBC,cAAsBC,YAAoBC,WAAoBpB,QAAqC;AAC7I,QAAMqB,KAAS;IACb;IACA,aAAa7E,gBAAe,YAAA;IAC5B,WAAWA,gBAAe,UAAA;IAC1B;EACD;AACD,MAAI1D,SAAQ,MAAA,GAAS;AACnBiF,IAAAA,SAAW,MAAA;AACX,UAAMuD,KAAoB;MACxB,GAAG3H;MACH,GAAG,OAAO;MACV,GAAG,OAAO;IACX;AACD,WAAO,OAAO,OAAO,EAAA;EACtB,MACC,QAAO,OAAO,OAAOA,EAAA;AAExB;AAQD,IAAaoD,UAAS,CAACwE,SAA6BC,cAClD7D,OAAM8D,MAAKA,KAAI,WAAA,GACf9D,OAAM8D,MAAKA,KAAI,SAAA,CAAU;AAc3B,IAAaC,eAAc,CAACC,MAA0B3B,WAAiD;AACrGvH,EAAAA,SAAMgJ,IAAA;AACN,QAAM,QAAQ9D,OAAM8D,MAAKA,KAAI,aAAa,MAAA;AAC1C,QAAM,MAAM9D,OAAM8D,MAAKA,KAAI,WAAW,MAAA;AACtC,SAAO,CAAE,OAAO,GAAK;AACtB;AAcD,IAAa9D,SAAQ,CAACiE,MAA0BC,eAAqB7B,WAA0B;AAE7F,MAAI,OAAO,WAAW,YACpB,UAASc,gBAAaW,IAAA,IAAOA,OAAM;IAAE,GAAG;IAAG,GAAG;EAAG;AAEnD,SAAO;IACL,GAAI,KAAK,IAAIzC,aAAAA,IAAeyC,KAAI,SAAU,OAAO;IACjD,GAAI,KAAK,IAAIzC,aAAAA,IAAeyC,KAAI,SAAU,OAAO;EAClD;AACF;AAMD,IAAahJ,WAAQ,CAACmJ,SAA6B;AACjD,MAAI,OAAOH,SAAQ,YAAa,OAAM,IAAI,UAAU,kBAAkB;AACtE,MAAIX,gBAAaW,IAAA,EACf1D,CAAAA,SAAW0D,MAAK,KAAK;AAEvB,MAAI,OAAOA,KAAI,WAAW,YAAa,OAAM,IAAI,UAAU,4BAA6B,KAAK,UAAUA,IAAA,CAAI,GAAI;AAC/G,MAAI,OAAOA,KAAI,WAAW,SAAU,OAAM,IAAI,UAAU,yBAAyB;AACjF,MAAI,OAAO,MAAMA,KAAI,MAAA,EAAS,OAAM,IAAI,UAAU,eAAe;AACjE,MAAIA,KAAI,UAAU,EAAG,OAAM,IAAI,UAAU,kCAAkC;AAE3E,MAAI,OAAOA,KAAI,gBAAgB,YAAa,OAAM,IAAI,UAAU,oCAAoC;AACpG,MAAI,OAAOA,KAAI,cAAc,YAAa,OAAM,IAAI,UAAU,oCAAoC;AAClG,MAAI,OAAO,MAAMA,KAAI,SAAA,EAAY,OAAM,IAAI,UAAU,sBAAsB;AAC3E,MAAI,OAAO,MAAMA,KAAI,WAAA,EAAc,OAAM,IAAI,UAAU,sBAAsB;AAE7E,MAAI,OAAOA,KAAI,cAAc,YAAa,OAAM,IAAI,UAAU,iCAAiC;AAC/F,MAAIA,KAAI,eAAeA,KAAI,UAAW,OAAM,IAAI,UAAU,kDAAkD;AAC7G;AAiBD,IAAaK,iBAA8B,CAACC,QAAgBJ,MAA0BK,eAAyBhC,WAA0B;AACvIvH,EAAAA,SAAMgJ,IAAA;AACN,QAAM,aAAa,iBAAiB;AACpC,MAAI,CAAC,YAAY;AACf,QAAI,SAAS,EAAG,OAAM,IAAI,MAAM,2DAA2D;AAC3F,QAAI,SAAS,EAAG,OAAM,IAAI,MAAM,uDAAuD;EACxF;AACD,QAAM,OAAOQ,aAAYR,IAAA;AACzB,QAAM,MAAM,OAAO;AACnB,QAAM,QAAQS,YAAWT,KAAI,aAAa,KAAKA,KAAI,SAAA;AAEnD,SAAO9D,OAAM8D,MAAK,OAAO,MAAA;AAE1B;AAOD,IAAaQ,eAAc,CAACE,SAAaC,WAAUX,KAAI,aAAaA,KAAI,WAAWA,KAAI,SAAA;AAOvF,IAAaY,YAAS,CAACd,SAA6B;AAClD9I,EAAAA,SAAMgJ,IAAA;AAEN,SAAO,OAAO,OAAO;IACnB,GAAGA;IACH,SAAS,CAACa,WAAkB;AAAE,YAAM,IAAI,MAAM,iBAAiB;IAAI;IACnE,aAAa,CAACP,WAAmBQ,eAAY,QAAQd,IAAA;IACrD,MAAM,MAAMpG,QAAKoG,IAAA;IACjB,QAAQ,MAAMe,UAAOf,IAAA;IACrB,aAAa,MAAMgB,SAAMhB,IAAA;IACzB,kBAAkB,CAACa,QAAeI,2BAAmC;AACnE,YAAM,IAAI,MAAM,iBAAiB;IAClC;IACD,iBAAiB,CAACJ,WAA0B;AAC1C,YAAM,IAAI,MAAM,iBAAiB;IAClC;IACD,MAAM;EACP,CAAA;AACF;AAWD,IAAaK,cAAa,CAACC,SAA0BC,aAAqBC,WAAmB,YAAY,SAAwB;AAC/H,QAAMC,KAAmB,OAAO,OAAO;IACrC,GAAGC;IACH;IACA;IACA;EACD,CAAA;AACD,SAAOrJ;AACR;AAWD,IAAasJ,oBAAmB,CAACL,SAA0BC,aAAqBK,YAAoB,YAAY,SAAwB;AACtI,QAAM,YAAYhB,YAAW,aAAa,YAAY,SAAA;AACtD,SAAOS,YAAWK,SAAQ,aAAa,SAAA;AACxC;AAQD,IAAaR,YAAS,CAACL,SAAqBhD,QAAOsC,KAAI,WAAWA,KAAI,cAAcA,KAAI,aAAatC;AAOrG,IAAa9D,UAAO,CAACsG,SAAoD;AACvE,MAAIb,gBAAaW,IAAA,GAAM;AACrB,UAAM,SAASc,eAAY,KAAKd,IAAA;AAChC,UAAM,SAAS1E,QAAO0E,IAAA;AACtB,WAAO0B,QAAW,QAAQ,OAAO,GAAG,OAAO,CAAA;EAC5C,MACC,QAAO;IACL,OAAO1B,KAAI,SAAS;IACpB,QAAQA,KAAI,SAAS;EACtB;AAEJ;AAWD,IAAa2B,WAAkB,CAACC,IAAgCC,IAAiCC,IAAyBC,IAAYC,OAAmB;AACvJ,MAAI5C,OAAMlH,EAAA,EACR,KAAImH,gBAAanH,EAAA,EACf,KAAIb,SAAQY,EAAA,EAEV,QAAOgK,aAAUhK,IAAGC,GAAE,QAAQA,GAAE,aAAaA,GAAE,WAAWK,EAAA;MAG1D,QAAO0J,aAAU/J,IAAGA,GAAE,QAAQA,GAAE,aAAaA,GAAE,WAAWD,EAAA;MAG5D,QAAOZ,SAAQY,EAAA,IAAKgK,aAAUhK,IAAGC,GAAE,QAAQA,GAAE,aAAaA,GAAE,WAAWK,EAAA,IAAmB0J,aAAU;IAAE,GAAG;IAAG,GAAG;EAAG,GAAE/J,GAAE,QAAQA,GAAE,aAAaA,GAAE,SAAA;OAE5I;AACL,QAAIK,OAAM,OAAW,OAAM,IAAI,MAAM,sBAAsB;AAC3D,QAAImE,OAAM,OAAW,OAAM,IAAI,MAAM,oBAAoB;AAEzD,QAAIrF,SAAQa,EAAA,EACV,KAAI,OAAOD,OAAM,YAAY,OAAOM,OAAM,YAAY,OAAOmE,OAAM,SACjE,QAAOuF,aAAU/J,IAAGD,IAAGM,IAAGmE,IAAGwF,EAAA;QAE7B,OAAM,IAAI,UAAU,mEAAmE;QAGzF,OAAM,IAAI,MAAM,gEAAgE;EAEnF;AACF;AAID,IAAMD,eAAY,CAAChG,QAAeuD,QAAgB4B,aAAqBC,WAAmBc,SAAyC;AAKjI,MAAI,SAAS,UAAa,OAAO,SAAS,SAAU,QAAO,CAAE;AAE7D,QAAM,eAAe,YAAY,gBAAgB;AACjD,QAAM,QAAQ3G,aAAY,QAAQ,YAAY,MAAM,MAAA;AACpD,QAAM,MAAMA,aAAY,QAAQ,aAAa,MAAA;AAE7C,QAAM,EAAE,WAAW,OAAO,QAAQ,MAAA,IAAU;AAE5C,QAAMkB,KAAI,CAAE;QACL,MAAM,CAAA,IAAO,MAAM,CAAA;QACnB,MAAA,IAAY,MAAA,MAAc,WAAW,MAAM,GAAG,IAAM,QAAQ,MAAM,GAAG,IAAM,IAAI,CAAA,IAAO,IAAI,CAAA;GAC/F;AAEF,MAAI,aAAc,CAAAA,GAAE,KAAK,GAAG;AAE5B,SAAOA;AACR;AAQD,IAAa0F,oBAAiB,CAACd,IAAkBe,OAA6BC,UAAepK,IAAGD,EAAA;AAehG,IAAasK,aAAU,CAACC,IAAwBC,OAAoC;AAClF,MAAIvK,GAAE,WAAWD,GAAE,OAAQ,QAAO;AAClC,MAAIC,GAAE,cAAcD,GAAE,UAAW,QAAO;AACxC,MAAIC,GAAE,gBAAgBD,GAAE,YAAa,QAAO;AAC5C,MAAIC,GAAE,cAAcD,GAAE,UAAW,QAAO;AAExC,MAAIoH,gBAAanH,EAAA,KAAMmH,gBAAapH,EAAA,GAAI;AACtC,QAAIC,GAAE,MAAMD,GAAE,EAAG,QAAO;AACxB,QAAIC,GAAE,MAAMD,GAAE,EAAG,QAAO;AACxB,QAAIC,GAAE,MAAMD,GAAE,EAAG,QAAO;EACzB,WAAU,CAACoH,gBAAanH,EAAA,KAAM,CAACmH,gBAAapH,EAAA,GAAI;EAEhD,MAAM,QAAO;AAEd,SAAO;AACR;AC5WD,IAAayK,UAAS,CAACC,OAAsB;AAC3C,MAAI9L,OAAM,OAAW,QAAO;AAC5B,MAAKA,GAAW,MAAM,OAAW,QAAO;AACxC,MAAKA,GAAW,MAAM,OAAW,QAAO;AACxC,MAAI,CAACQ,SAASR,GAAW,CAAA,EAAI,QAAO;AACpC,MAAI,CAACQ,SAASR,GAAW,CAAA,EAAI,QAAO;AACpC,SAAO;AACR;AASD,IAAa+L,cAAa,CAACD,OAA0B;AACnD,MAAI,CAAC,MAAM,QAAQ9L,EAAA,EAAI,QAAO;AAE9B,QAAM,QAAQ,CAACA,GAAE,KAAK,CAAAgG,OAAK,CAAC6F,QAAO7F,EAAA,CAAE;AACrC,SAAO;AACR;AAWD,IAAa7F,WAAQ,CAAC4H,OAAY,OAAO,WAAW;AAClD,MAAIC,UAAS,OAAW,OAAM,IAAI,MAAM,GAAI,IAAA,YAAiB;AAC7D,MAAIA,MAAK,MAAM,OAAW,OAAM,IAAI,MAAM,GAAI,IAAA,mDAAyD,KAAK,UAAUA,KAAA,CAAK,EAAG;AAC9H,MAAIA,MAAK,MAAM,OAAW,OAAM,IAAI,MAAM,GAAI,IAAA,kDAAwD,KAAK,UAAUA,KAAA,CAAK,EAAG;AAC9H;ACjCD,IAAa1G,uBAAoB,CAAC0K,SAAuBrF,OAAyC;AAEhG,MAAItF;AACJ,MAAIwK,QAAO,OAAA,GAAU;AACnB,IAAAzK,KAAI,QAAQ;AACZ,IAAAC,KAAI,QAAQ;EACb,OAAM;AACL,IAAAA,KAAI;AACJ,QAAID,OAAM,OAAW,OAAM,IAAI,MAAM,wEAAyE,KAAK,UAAUC,EAAA,CAAE,OAAS,KAAK,UAAUD,EAAA,CAAE,EAAG;EAC7J;AACDqE,EAAAA,SAAWpE,IAAG,GAAG;AACjBoE,EAAAA,SAAWpE,IAAG,GAAG;AAEjB,SAAO,CAAEA,IAAGD,EAAG;AAChB;ACQD,SAAgB8I,QAAO+B,SAAkCC,QAAwB;AAC/E,MAAIH,YAAW,OAAA,GAAU;AACvB,UAAMI,QAAM,QAAQ,OAAO,CAAC,aAAanG,OAAMkE,QAAOlE,EAAA,IAAK,aAAa,CAAA;AACxE,WAAOmG;EACR;AACD,MAAI,YAAY,OAAW,OAAM,IAAI,UAAU,kCAAkC;AACjF,QAAM,CAAE9K,IAAGD,EAAA,IAAME,qBAAkB,SAAS,MAAA;AAC5C,QAAMkG,KAAIpG,GAAE,IAAIC,GAAE;AAClB,QAAMW,KAAIZ,GAAE,IAAIC,GAAE;AAClB,MAAIA,GAAE,MAAM,UAAaD,GAAE,MAAM,QAAW;AAC1C,UAAMa,KAAIb,GAAE,IAAIC,GAAE;AAClB,WAAO,KAAK,MAAMmG,IAAGxF,IAAGC,EAAA;EACzB,MACC,QAAO,KAAK,MAAMuF,IAAGxF,EAAA;AAExB;ACrCD,SAAgBoK,SAAQrE,OAAkB;AACxC5H,EAAAA,SAAM6H,OAAM,MAAM;AAClB,SAAO;IAAE,GAAGA,MAAK;IAAG,GAAGA,MAAK;EAAG;AAChC;ACmCD,SAAgBiC,eAAYR,QAAgBuC,SAAuBK,uBAAyC3C,eAAgC;AAE1I,MAAI,OAAO,0BAA0B,WAAW;AAC9C,oBAAgB;AAChB,4BAAwB;EACzB;AAGD,MAAI,CAAC,cAAe,aAAY,YAAY,QAAQ,QAAQ,CAAC;MACxD,aAAY,WAAW,QAAQ,IAAI,QAAQ,CAAC;AAEjD,QAAM,CAAErI,IAAGD,EAAA,IAAME,qBAAkB,SAAS,qBAAA;AAE5C,QAAMuE,KAAIqE,QAAO7I,IAAGD,EAAA;AACpB,QAAMkL,MAAKzG,MAAK,IAAI;AAGpB,MAAIA,OAAM,KAAKyG,QAAO,EAAG,QAAO,OAAO,OAAO,EAAE,GAAGlL,GAAG,CAAA;AAEtD,QAAMoG,KAAIpG,GAAE,IAAKkL,OAAMlL,GAAE,IAAIC,GAAE,KAAKwE;AACpC,QAAM7D,KAAIZ,GAAE,IAAKkL,OAAMlL,GAAE,IAAIC,GAAE,KAAKwE;AAEpC,SAAO,OAAO,OAAO;IACnB,GAAGzE;IACA,GAAAoG;IACA,GAAAxF;EACJ,CAAA;AACF;AASD,SAAgBuK,iBAAgBxE,OAAYxC,YAAkBiH,UAAQ,MAAa;AACjF,MAAI,CAACA,QAAO,CAAAxE,QAAOoE,SAAQpE,KAAA;AAE3B,QAAM,KAAKA,MAAK,EAAE,IAAIA,MAAK,EAAE;AAC7B,QAAM,KAAKA,MAAK,EAAE,IAAIA,MAAK,EAAE;AAC7B,QAAM,QAAQ,KAAK,MAAM,IAAI,EAAA;AAC7B,QAAM,KAAKrG,aAAW,KAAK,IAAI,KAAA;AAC/B,QAAM,KAAKA,aAAW,KAAK,IAAI,KAAA;AAC/B,SAAO;IAAE,GAAG,KAAKqG,MAAK,EAAE;IAAG,GAAG,KAAKA,MAAK,EAAE;EAAG;AAC9C;ACxFD,IAAayE,YAAW,CAACC,IAAW,OAAO,gBAAgB;AACzD,MAAI7G,OAAM,OAAW,OAAM,IAAI,MAAM,GAAI,IAAA,eAAoB;AAC7D,MAAI,OAAO,MAAMA,EAAA,EAAI,OAAM,IAAI,MAAM,GAAI,IAAA,SAAc;AACvD,MAAIA,KAAI,EAAG,OAAM,IAAI,MAAM,GAAI,IAAA,qBAA0B;AAC1D;AAeD,IAAa1F,WAAQ,CAACwM,OAAY,OAAO,WAAW;AAClD,MAAIC,UAAS,OAAW,OAAM,IAAI,MAAM,mBAAmB;AAC3D,MAAIpE,cAAaoE,KAAA,EAAOC,CAAAA,SAAYD,OAAM,IAAA;AAC1C,EAAAH,UAASG,MAAK,OAAO,OAAO,QAAQ;AACpC,EAAAH,UAASG,MAAK,QAAQ,OAAO,SAAS;AACvC;AAqBD,IAAaE,qBAAoB,CAACC,OAA6BrF,WAAmC;AAChGvH,EAAAA,SAAMyM,KAAA;AACN,MAAIpE,cAAaoE,KAAA,KAAS,WAAW,OACnC,QAAOA;AAET,MAAI,WAAW,OAAW,OAAM,IAAI,MAAM,0CAA0C;AACpF,SAAO,OAAO,OAAO;IAAE,GAAGA;IAAM,GAAG;EAAQ,CAAA;AAE5C;AAQD,IAAaI,mBAAkB,CAACC,OAAsB,OAAO,WAAW;AACtE,MAAI,CAACzE,cAAaoE,KAAA,EAAO,OAAM,IAAI,MAAM,YAAa,IAAA,cAAmB;AACzEzM,EAAAA,SAAMyM,OAAM,IAAA;AACb;AAQD,IAAajM,aAAU,CAACgM,UACtBC,MAAK,UAAU,KAAKA,MAAK,WAAW;AAQtC,IAAahM,mBAAgB,CAAC+L,UAC5B,OAAO,MAAMC,MAAK,KAAA,KAAU,OAAO,MAAMA,MAAK,MAAA;AAOhD,IAAapE,gBAAe,CAC1B0E,UAECN,MAAe,MAAM,UAAcA,MAAe,MAAM;AAO3D,IAAaO,UAAS,CAACC,UAAgC;AACrD,MAAIR,UAAS,OAAW,QAAO;AAC/B,MAAKA,MAAc,UAAU,OAAW,QAAO;AAC/C,MAAKA,MAAc,WAAW,OAAW,QAAO;AAChD,SAAO;AACR;AAQD,IAAaS,oBAAmB,CAC9BC,UAC2BH,QAAOP,KAAA,KAASpE,cAAaoE,KAAA;AC1G1D,IAAaW,eAAc,CACzBnI,QACAoI,OACAC,aACmB;AACnB,EAAAhB,UAAS,OAAO,OAAO;AACvB,EAAAA,UAASiB,UAAQ,QAAQ;AACzBb,EAAAA,SAAY,QAAQ,QAAQ;AAE5B,SAAO;IAAE,GAAG,OAAO;IAAG,GAAG,OAAO;IAAU;IAAO,QAAQa;EAAQ;AAClE;ACxBD,IAAaC,qBAAoB,CAACC,UAAyEC,MAAyB,cAAc;AAElJ,IAAaC,iBAAgB,CAACC,UAAqEF,MAAqB,WAAW,UAAcA,MAAqB,WAAW;;;;;;;;;;;;ACuBjL,IAAaG,mBAAkB,CAACtJ,OAAcuJ,KAAY,OAAO,MAAuB;AACtF,MAAI,OAAO,MAAM,IAAA,EAAO,OAAM,IAAI,MAAM,aAAa;AACrD,MAAI,OAAO,MAAM,OAAO,EAAG,OAAM,IAAI,MAAM,+BAA+B;AAE1E,QAAM,SAASC,eAAiB,KAAK,OAAO,GAAA;AAC5C,MAAI,SAAS;AACb,MAAI,IAAI,IAAI,MAAM,EAEhB,UAAS,OAAO,IAAI;IAAE,GAAG,KAAK,IAAI,MAAM,GAAG,IAAI,CAAA;IAAI,GAAG,KAAK,IAAI,MAAM,GAAG,IAAI,CAAA;EAAI,IAC9E;IAAE,GAAG,KAAK,IAAI,MAAM,GAAG,IAAI,CAAA;IAAI,GAAG,KAAK,IAAI,MAAM,GAAG,IAAI,CAAA;EAAI;MAG9D,UAAS,OAAO,IAAI;IAAE,GAAG,KAAK,IAAI,MAAM,GAAG,IAAI,CAAA;IAAI,GAAG,KAAK,IAAI,MAAM,GAAG,IAAI,CAAA;EAAI,IAC9E;IAAE,GAAG,KAAK,IAAI,MAAM,GAAG,IAAI,CAAA;IAAI,GAAG,KAAK,IAAI,MAAM,GAAG,IAAI,CAAA;EAAI;AAGhE,QAAM,SAASA,eAAiB,KAAK,IAAI,IAAA,GAAO,QAAQ,MAAA;AACxD,SAAOC,WAAU,OAAO,KAAK,MAAA;AAC9B;AA2BD,IAAaC,gBAAe,CAACC,OAAgE;AAI3F,QAAM,MAAMP,eAAcQ,EAAA,IACxB,IAAIC,OAAcD,GAAE,EAAE,GAAGA,GAAE,EAAE,GAAGA,GAAE,OAAO,GAAGA,GAAE,OAAO,GAAGA,GAAE,OAAO,GAAGA,GAAE,OAAO,GAAGA,GAAE,EAAE,GAAGA,GAAE,EAAE,CAAA,IAC3F,IAAIC,OAAcD,GAAE,GAAGA,GAAE,WAAWA,GAAE,CAAA;AAExC,SAAO,CAAC7E,WAAmB,IAAI,QAAQ,MAAA;AACxC;AAGD,IAAa+E,wBAAuB,CAAC9J,OAAcuJ,KAAYQ,WAAyC,CAAE,KAAM,MAAM,CAAA,IAAO,MAAM,CAAA,MAAS,OAAO,CAAA,IAAO,OAAO,CAAA,IAAO,IAAI,CAAA,IAAO,IAAI,CAAA,EAAM;AAE7L,IAAa1E,YAAS,CAAC2E,qBAA2F;AAChH,MAAIZ,eAAc,gBAAA,EAChB,QAAOa,aAAY,gBAAA;WACVhB,mBAAkB,gBAAA,EAC3B,QAAOiB,iBAAgB,gBAAA;MAEvB,OAAM,IAAI,MAAM,qBAAqB;AAExC;AAED,IAAaC,SAAQ,CAACnK,OAAcuJ,KAAYa,QAAeC,aAC7D;EACE,GAAG,OAAO,OAAO,KAAA;EACjB,GAAG,OAAO,OAAO,GAAA;EACjB,QAAQ,OAAO,OAAO,MAAA;EACtB,QAAQ,OAAO,OAAOC,OAAA;AACvB;AAEH,IAAML,eAAc,CAACM,YAAwC;AAC3D,QAAM,EAAE,GAAA5N,IAAG,QAAQ,QAAA2N,SAAQ,GAAA5N,GAAA,IAAMyN;AAEjC,QAAM,MAAM,IAAIN,OAAclN,IAAG,QAAQ2N,SAAQ5N,EAAA;AACjD,SAAO,OAAO,OAAO;IACnB,GAAGyN;IACH,QAAQ,MAAM,IAAI,OAAA;IAClB,aAAa,CAACK,OAAc,IAAI,QAAQC,EAAA;IACxC,SAAS,CAACC,OAAa;AAAE,YAAM,IAAI,MAAM,iBAAiB;IAAI;IAC9D,MAAM,MAAM;AACV,YAAM,EAAE,GAAA5H,IAAG,GAAAxF,GAAA,IAAM,IAAI,KAAA;AACrB,YAAM,QAAQwF,GAAE;AAChB,YAAM,QAAQxF,GAAE;AAChB,UAAI,UAAU,OAAW,OAAM,IAAI,MAAM,uCAAuC;AAChF,UAAI,UAAU,OAAW,OAAM,IAAI,MAAM,uCAAuC;AAEhF,aAAOqN,aAAiB;QAAE,GAAG7H,GAAE;QAAK,GAAGxF,GAAE;MAAK,GAAE,OAAO,KAAA;IACxD;IACD,kBAAkB,CAACgI,QAAeI,2BAAmC;AACnE,YAAM,IAAI,MAAM,iBAAiB;IAClC;IACD,iBAAiB,CAACJ,WAA0B;AAC1C,YAAM,IAAI,MAAM,iBAAiB;IAClC;IACD,aAAa,MAAM,CAAE,OAAS;IAC9B,MAAM;EACP,CAAA;AACF;AAED,IAAamE,aAAY,CAACzJ,OAAcuJ,KAAYQ,YAAoC;EACtF,GAAG,OAAO,OAAO,KAAA;EACjB,GAAG,OAAO,OAAO,GAAA;EACjB,WAAW,OAAO,OAAO,MAAA;AAC1B;AAGD,IAAMG,mBAAkB,CAACU,qBAA0D;AACjF,QAAM,EAAE,GAAAjO,IAAG,GAAAD,IAAG,WAAA,YAAA,IAAcmO;AAC5B,QAAM,MAAM,IAAIhB,OAAclN,IAAG8M,aAAW/M,EAAA;AAC5C,SAAO,OAAO,OAAO;IACnB,GAAGmO;IACH,QAAQ,MAAM,IAAI,OAAA;IAClB,aAAa,CAACL,OAAc,IAAI,QAAQC,EAAA;IACxC,SAAS,CAACC,OAAa;AAAE,YAAM,IAAI,MAAM,iBAAiB;IAAI;IAC9D,MAAM,MAAM;AACV,YAAM,EAAE,GAAA5H,IAAG,GAAAxF,GAAA,IAAM,IAAI,KAAA;AACrB,YAAM,QAAQwF,GAAE;AAChB,YAAM,QAAQxF,GAAE;AAChB,UAAI,UAAU,OAAW,OAAM,IAAI,MAAM,uCAAuC;AAChF,UAAI,UAAU,OAAW,OAAM,IAAI,MAAM,uCAAuC;AAChF,aAAOqN,aAAiB;QAAE,GAAG7H,GAAE;QAAK,GAAGxF,GAAE;MAAK,GAAE,OAAO,KAAA;IACxD;IACD,iBAAiB,CAACgI,WAA0B;AAC1C,YAAM,IAAI,MAAM,iBAAiB;IAElC;IACD,kBAAkB,CAACA,QAAeI,2BAA2C;AAC3E,YAAM,IAAI,MAAM,iBAAiB;IAElC;IACD,UAAU,MAAM,IAAI,SAAA;IACpB,aAAa,MAAMoE,sBAAqBnN,IAAGD,IAAG+M,WAAAA;IAC9C,MAAM;EACP,CAAA;AACF;AChKD,IAAahO,WAAQ,CAACqP,SAAmC,gBAAgB,aAAa;AACpF,MAAIC,oBAAmB/E,OAAA,EACrBjF,CAAAA,SAAWiF,SAAQ,QAAQ;AAG7B,MAAI,OAAO,MAAMA,QAAO,MAAA,EAAS,OAAM,IAAI,MAAM,GAAI,aAAA,gBAA8B;AACnF,MAAIA,QAAO,UAAU,EAAG,OAAM,IAAI,MAAM,GAAI,aAAA,mCAAiD;AAC9F;AAQD,IAAasC,qBAAkB,CAAC1C,SAA0B,gBAAgB,aAAa;AACrF,MAAI,CAACmF,oBAAmB/E,OAAA,EAAS,OAAM,IAAI,MAAM,uCAAuC;AACxFvK,EAAAA,SAAMuK,SAAQ,aAAA;AACf;AAKD,IAAazK,SAAQ,CAACyP,OAA0C;AAC9D,MAAI,OAAO,MAAMrO,GAAE,MAAA,EAAS,QAAO;AACnC,MAAIoO,oBAAmBpO,EAAA,GAAI;AACzB,QAAI,OAAO,MAAMA,GAAE,CAAA,EAAI,QAAO;AAC9B,QAAI,OAAO,MAAMA,GAAE,CAAA,EAAI,QAAO;EAC/B;AACD,SAAO;AACR;AAgBD,IAAamH,kBAAe,CAACmH,OAAmC3P,GAAY,MAAM,UAAcA,GAAY,MAAM;AAElH,IAAa4P,YAAW,CAAC9D,OAAyB9L,GAAa,WAAW;AAE1E,IAAayP,sBAAqB,CAAC3D,OAAkC8D,UAAS5P,EAAA,KAAMwI,gBAAaxI,EAAA;ACnDjG,IAAa6P,UAAO,CAACC,YAAmB;AACtC3P,EAAAA,SAAMuK,OAAA;AACN,SAAO,KAAK,KAAKA,QAAO,SAASA,QAAO;AACzC;ACMD,IAAaqF,gBAAa,CACxB3K,QACAoI,OACAC,aACmB;AACnBZ,EAAAA,SAAY,QAAQ,QAAQ;AAE5B,EAAAJ,UAAS,OAAO,OAAO;AACvB,EAAAA,UAASiB,UAAQ,QAAQ;AAEzB,QAAM,QAAQ,QAAQ;AACtB,QAAM,QAAQA,WAAS;AACvB,SAAO;IACL,GAAG,OAAO,IAAI;IACd,GAAG,OAAO,IAAI;IACP;IACP,QAAQA;EACT;AACF;AC1BD,IAAa3K,UAAO,CAACyM,YAAsD;AACzE,SAAOC,oBAAmB/E,OAAA,IACxBsF,cAAgBtF,SAAQA,QAAO,SAAS,GAAGA,QAAO,SAAS,CAAA,IAC3D;IAAE,OAAOA,QAAO,SAAS;IAAG,QAAQA,QAAO,SAAS;IAAG,GAAG;IAAG,GAAG;EAAG;AACtE;ACOD,IAAauF,UAAS,CAACT,YAAsC;AAC3D,SAAOC,oBAAmB/E,OAAA,IAAU,OAAO,OAAO;IAAE,GAAGA,QAAO;IAAG,GAAGA,QAAO;EAAG,CAAA,IAAI,OAAO,OAAO;IAAE,GAAGA,QAAO;IAAQ,GAAGA,QAAO;EAAQ,CAAA;AACvI;ACJD,IAAaa,kBAAiB,CAAC2E,IAAqBC,OAAwC;AAC1FnD,EAAAA,mBAAgB3L,IAAG,GAAG;AACtB,MAAIoO,oBAAmBrO,EAAA,EACrB4L,CAAAA,mBAAgB5L,IAAG,GAAG;AAExB,SAAOqK,UAAepK,IAAGD,EAAA;AAC1B;ACLD,IAAagP,0BAAuB,CAACF,IAAqBC,OAAwC;AAChGnD,EAAAA,mBAAgB3L,IAAG,GAAG;AACtB,MAAIoO,oBAAmBrO,EAAA,EACrB,QAAO,KAAK,IAAI,GAAGmK,gBAAelK,IAAGD,EAAA,IAAKC,GAAE,SAASD,GAAE,MAAA;WAC9CiP,SAAcjP,EAAA,GAAI;AAC3B,UAAM,eAAekP,UAAejP,IAAGD,EAAA;AACvC,QAAI,eAAeC,GAAE,OAAQ,QAAO;AACpC,WAAO;EACR,MAAM,OAAM,IAAI,MAAM,+BAA+B;AACvD;ACXD,UAAiBkP,uBAAsBjG,SAAmD;AACxF,QAAM,EAAE,GAAA9C,IAAG,GAAAxF,IAAG,OAAA,IAAW0I;AAEzB,MAAI,KAAK;AACT,MAAI,KAAK;AACT,MAAI,cAAc,IAAIlD;AACtB,SAAO,MAAM,IAAI;AACf,UAAM;MAAE,GAAG,KAAKA;MAAG,GAAG,KAAKxF;IAAG;AAC9B,UAAM;MAAE,GAAG,KAAKwF;MAAG,GAAG,KAAKxF;IAAG;AAC9B,UAAM;MAAE,GAAG,CAAC,KAAKwF;MAAG,GAAG,KAAKxF;IAAG;AAC/B,UAAM;MAAE,GAAG,CAAC,KAAKwF;MAAG,GAAG,KAAKxF;IAAG;AAC/B,UAAM;MAAE,GAAG,CAAC,KAAKwF;MAAG,GAAG,CAAC,KAAKxF;IAAG;AAChC,UAAM;MAAE,GAAG,CAAC,KAAKwF;MAAG,GAAG,CAAC,KAAKxF;IAAG;AAChC,UAAM;MAAE,GAAG,KAAKwF;MAAG,GAAG,CAAC,KAAKxF;IAAG;AAC/B,UAAM;MAAE,GAAG,KAAKwF;MAAG,GAAG,CAAC,KAAKxF;IAAG;AAC/B;AACA,QAAI,cAAc,EAChB,gBAAe,IAAI,KAAK;SACnB;AACL;AACA,qBAAe,KAAK,KAAK,KAAK;IAC/B;EACF;AACF;ACzBD,UAAiBwO,uBAAsBlG,SAAmD;AACxF,QAAM,OAAOI,QAAO,IAAIA,QAAO;AAC/B,QAAM,OAAOA,QAAO,IAAIA,QAAO;AAC/B,QAAM,OAAOA,QAAO,IAAIA,QAAO;AAC/B,QAAM,OAAOA,QAAO,IAAIA,QAAO;AAC/B,WAASlD,KAAI,MAAMA,KAAI,MAAMA,KAC3B,UAASxF,KAAI,MAAMA,KAAI,MAAMA,MAAK;AAChC,UAAMyO,KAAI,KAAK,IAAI9O,UAAS+I,SAAQlD,IAAGxF,EAAA,CAAE;AACzC,QAAIyO,MAAK/F,QAAO,OAAQ,OAAM;MAAE,GAAAlD;MAAG,GAAAxF;IAAG;EACvC;AAEJ;ACrBD,IAAM6E,UAAO,KAAK,KAAK;AAcvB,IAAa6J,aAAU,CAACC,SAAwDxL,YAAwB;AACtG,QAAMyL,KAAI,CAACV,OAA+B;AACxC,UAAMW,KAAI,KAAK,KAAK,KAAK,IAAIxL,QAAM,IAAIhE,GAAE,GAAG,CAAA,IAAK,KAAK,IAAIgE,QAAM,IAAIhE,GAAE,GAAG,CAAA,CAAE;AAC3E,UAAMmG,KAAInG,GAAE,IAAKA,GAAE,WAAWgE,QAAM,IAAIhE,GAAE,KAAKwP;AAC/C,UAAM7O,KAAIX,GAAE,IAAKA,GAAE,WAAWgE,QAAM,IAAIhE,GAAE,KAAKwP;AAC/C,WAAO;MAAE,GAAArJ;MAAG,GAAAxF;IAAG;EAChB;AAED,MAAI,MAAM,QAAQ0I,OAAA,GAAS;AACzB,UAAM,MAAMA,QAAO,IAAI,CAAAmG,OAAKD,GAAEC,EAAA,CAAE;AAChC,UAAM,QAAQ,IAAI,IAAI,CAAA7Q,OAAKsQ,UAAetQ,IAAGqF,OAAAA,CAAM;AACnD,WAAO,OAAO,OAAc,IAAK,SAAS,GAAG,KAAA,CAAM,CAAA;EACpD,MACC,QAAO,OAAO,OAAcuL,GAAElG,OAAA,CAA2B;AAE5D;AAqBD,IAAaoG,oBAAmB,CAACC,SAAmCxH,eAAqB7B,WAA0B;AACjH,MAAI,WAAW,OACb,UAAS+H,oBAAmB/E,OAAA,IAAUA,UAAS;IAAE,GAAG;IAAG,GAAG;EAAG;AAE/D,SAAO;IACL,GAAI,KAAK,IAAI,CAAChE,aAAAA,IAAegE,QAAO,SAAU,OAAO;IACrD,GAAI,KAAK,IAAI,CAAChE,aAAAA,IAAegE,QAAO,SAAU,OAAO;EACtD;AACF;AAOD,IAAasG,iBAAgB,CAAClB,YAA2B;AACvD3P,EAAAA,SAAMuK,OAAA;AACN,SAAO7D,UAAO6D,QAAO;AACtB;AAOD,IAAaR,YAAS,CAAC4F,YAA2BkB,eAActG,OAAA;AC7EhE,IAAM7D,UAAO,KAAK,KAAK;AAevB,IAAaoD,iBAAc,CAACK,SAA0B4E,OAAqB4B,kBAAiBpG,SAAQyE,KAAItI,OAAAA;ACCxG,IAAa6E,aAAU,CAACuF,IAA8BC,OAA0C;AAC9F,MAAI7P,GAAE,WAAWD,GAAE,OAAQ,QAAO;AAElC,MAAIqO,oBAAmBpO,EAAA,KAAMoO,oBAAmBrO,EAAA,GAAI;AAClD,QAAIC,GAAE,MAAMD,GAAE,EAAG,QAAO;AACxB,QAAIC,GAAE,MAAMD,GAAE,EAAG,QAAO;AACxB,QAAIC,GAAE,MAAMD,GAAE,EAAG,QAAO;AACxB,WAAO;EACR,WAAU,CAACqO,oBAAmBpO,EAAA,KAAM,CAACoO,oBAAmBrO,EAAA,GAAI;EAE5D,MAAM,QAAO;AAEd,SAAO;AACR;ACPD,SAAgB+K,OACdrL,IAA8BC,KAA+BC,KAAcC,KAAcC,KAAcC,KACtF;AACjB,QAAM,CAAE,KAAK,GAAA,IAAQN,uBAAsB,IAAW,KAAY,KAAY,KAAY,KAAY,GAAA;AACtGV,EAAAA,SAAM,KAAK,GAAG;AACdA,EAAAA,SAAM,KAAK,GAAG;AACd,QAAMiE,MAAuB;IAC3B,GAAG,IAAI,IAAI,IAAI;IACf,GAAG,IAAI,IAAI,IAAI;EAChB;AACD,MAAIrE,WAAU,GAAA,KAAQA,WAAU,GAAA,EAC9B,CAAAQ,IAAG,KAAK,IAAI,KAAK,MAAM,IAAI,KAAK;AAElC,SAAO,OAAO,OAAOA,GAAA;AACtB;ACpBD,IAAa4Q,oBAAmB,CAAC7G,SAA0BvC,UAAiC;AAC1F,QAAM,KAAK;IACT,GAAGC,MAAK,EAAE,IAAIA,MAAK,EAAE;IACrB,GAAGA,MAAK,EAAE,IAAIA,MAAK,EAAE;EACtB;AACD,QAAMoJ,MAAK;IACT,GAAGpJ,MAAK,EAAE,IAAI0C,QAAO;IACrB,GAAG1C,MAAK,EAAE,IAAI0C,QAAO;EACtB;AAED,QAAMtJ,MAAK,GAAG,IAAIgQ,IAAG,IAAI,GAAG,IAAIA,IAAG,KAAK;AACxC,QAAM1P,KAAI,KAAK,GAAG,IAAI,GAAG,IAAI,GAAG,IAAI,GAAG;AAEvC,QAAMmE,KAAI,KAAK,KAAKzE,KAAIA,KAAI,IAAIM,MAAK0P,IAAG,IAAIA,IAAG,IAAIA,IAAG,IAAIA,IAAG,IAAI1G,QAAO,SAASA,QAAO,OAAA;AACxF,MAAI,OAAO,MAAM7E,EAAA,EAAI,QAAO,CAAE;AAE9B,QAAM,MAAMzE,KAAIyE,MAAKnE;AACrB,QAAM2P,OAAMjQ,KAAIyE,MAAKnE;AAErB,QAAM4P,cAAuB,CAAE;AAC/B,MAAI,MAAM,KAAK,MAAM,EACnB,aAAY,KAAK;IACf,GAAGtJ,MAAK,EAAE,IAAI,GAAG,IAAI;IACrB,GAAGA,MAAK,EAAE,IAAI,GAAG,IAAI;EACtB,CAAA;AAEH,MAAIqJ,OAAM,KAAKA,OAAM,EACnB,aAAY,KAAK;IACf,GAAGrJ,MAAK,EAAE,IAAI,GAAG,IAAIqJ;IACrB,GAAGrJ,MAAK,EAAE,IAAI,GAAG,IAAIqJ;EACtB,CAAA;AAEH,SAAO;AACR;AAaD,IAAaE,iBAAgB,CAACrB,IAAqBsB,OAA0C;AAC3F,QAAM,SAASC,YAAerQ,IAAGC,EAAA;AACjC,QAAM,UAAU,KAAK,MAAO,OAAO,GAAK,OAAO,CAAA;AAG/C,MAAI,UAAUA,GAAE,SAASD,GAAE,OAAQ,QAAO,CAAE;AAG5C,MAAI,UAAU,KAAK,IAAIC,GAAE,SAASD,GAAE,MAAA,EAAS,QAAO,CAAE;AAGtD,MAAIsK,WAAQrK,IAAGD,EAAA,EAAI,QAAO,CAAE;AAE5B,QAAM,aAAcC,GAAE,SAASA,GAAE,SAAWD,GAAE,SAASA,GAAE,SAAW,UAAU,YAAa,IAAI;AAC/F,QAAMsQ,aAAW;IACf,GAAGrQ,GAAE,IAAK,OAAO,IAAI,YAAY;IACjC,GAAGA,GAAE,IAAK,OAAO,IAAI,YAAY;EAClC;AAED,QAAM,wBAAwB,KAAK,KAAMA,GAAE,SAASA,GAAE,SAAW,YAAY,SAAA;AAE7E,QAAMsQ,gBAAe;IACnB,GAAG,CAAC,OAAO,KAAK,wBAAwB;IACxC,GAAG,OAAO,KAAK,wBAAwB;EACxC;AACD,SAAO,CACLC,OAAUF,YAAUC,aAAA,GACpBF,YAAeC,YAAUC,aAAA,CAC1B;AACF;AC1FD,IAAaE,cAAa,CAAC3B,IAAqB4B,OAAsB;AAEpE,QAAM,SAASzQ,GAAE,IAAI,KAAK,IAAID,GAAE,GAAG,KAAK,IAAIC,GAAE,GAAGD,GAAE,IAAIA,GAAE,KAAA,CAAM;AAC/D,QAAM,SAASC,GAAE,IAAI,KAAK,IAAID,GAAE,GAAG,KAAK,IAAIC,GAAE,GAAGD,GAAE,IAAIA,GAAE,MAAA,CAAO;AAChE,SAAQ,SAAS,SAAS,SAAS,SAAWC,GAAE,SAASA,GAAE;AAC5D;AAED,IAAa0Q,gBAAe,CAAC7B,IAAqBsB,OAAwBQ,eAAoB3Q,IAAGD,EAAA,EAAG,WAAW;ACa/G,IAAa6Q,iBAAgB,CAAC/B,IAAqBC,IAA6B1O,OAAwB;AACtG,QAAMoE,KAAI0F,gBAAelK,IAAGD,EAAA;AAC5B,MAAIwO,UAASxO,EAAA,EACX,QAAQyE,KAAI,KAAK,IAAIxE,GAAE,SAASD,GAAE,MAAA;WACzBZ,SAAQY,EAAA,EAEjB,KAAIM,OAAM,OACR,QAAOmE,MAAKxE,GAAE;MAGd,QAAQwE,KAAI,KAAK,IAAIxE,GAAE,SAASK,EAAA;MAE7B,OAAM,IAAI,MAAM,yDAAyD;AACjF;ACvBD,IAAagK,WAAU,IAAI1L,OAAqC;AAC9D,MAAIA,OAAM,OAAW,OAAM,IAAI,MAAM,4BAA4B;AACjE,MAAIA,GAAE,SAAS,EAAG,QAAO;AAEzB,WAAS,QAAQ,GAAG,QAAQA,GAAE,QAAQ,SAAS;AAC7C,QAAIA,GAAG,KAAA,EAAQ,MAAMA,GAAG,CAAA,EAAI,EAAG,QAAO;AACtC,QAAIA,GAAG,KAAA,EAAQ,MAAMA,GAAG,CAAA,EAAI,EAAG,QAAO;EACvC;AACD,SAAO;AACR;ACHD,IAAakS,kBAAiB,CAAChC,IAAqBiC,IAA8C1Q,OAAwB;AACxH,MAAI2Q,SAAc/Q,IAAGD,EAAA,EAAI,QAAO;AAChC,MAAI6Q,eAAc5Q,IAAGD,IAAGM,EAAA,EAAI,QAAO;AACnC,MAAIkO,UAASxO,EAAA,EACX,QAAA2Q,cAA+B1Q,IAAGD,EAAA;WACzBiM,kBAAiBjM,EAAA,EAC1B,QAAAyQ,YAA6BxQ,IAAGD,EAAA;WACvBZ,SAAQY,EAAA,KAAMM,OAAM,OAC7B,QAAAqQ,cAA+B1Q,IAAG;IAAE,GAAGD;IAAG,QAAQM;EAAG,CAAA;AAEvD,SAAO;AACR;ACND,SAAgB2E,YACdvF,IAA8BC,KAA+BC,KAAcC,KAAcC,KAAcC,KACtF;AACjB,QAAM,CAAE,KAAK,GAAA,IAAQN,uBAAsB,IAAW,KAAY,KAAY,KAAY,KAAY,GAAA;AACtGV,EAAAA,SAAM,KAAK,GAAG;AACdA,EAAAA,SAAM,KAAK,GAAG;AACd,QAAMiE,MAAuB;IAC3B,GAAG,IAAI,IAAI,IAAI;IACf,GAAG,IAAI,IAAI,IAAI;EAChB;AACD,MAAIrE,WAAU,GAAA,KAAQA,WAAU,GAAA,EAC9B,CAAAQ,IAAG,KAAK,IAAI,KAAK,MAAM,IAAI,KAAK;AAElC,SAAO,OAAO,OAAOA,GAAA;AACtB;AAcD,IAAa8R,oBAAiB,CAC5B/R,KACAgS,OACoB;AACpB,SAAOvS,WAAUQ,GAAA,IAAM,OAAO,OAAO;IACnC,GAAGA;IACH,GAAGA,IAAG,IAAIyF;IACV,GAAGzF,IAAG,IAAIyF;IACV,GAAGzF,IAAG,IAAIyF;EACX,CAAA,IAAI,OAAO,OAAO;IACjB,GAAGzF;IACH,GAAGA,IAAG,IAAIyF;IACV,GAAGzF,IAAG,IAAIyF;EACX,CAAA;AACF;ACjDD,SAAgBqM,kBAAe3C,IAA8B6C,QAA0C;AACrG,MAAI9C,oBAAmBpO,EAAA,GAAI;AACzB,UAAMd,MAAKiS,kBAAqBnR,IAAGoR,MAAA;AACnC,WAAO,OAAO,OAAO;MACnB,GAAGpR;MACH,GAAGd;MACH,QAAQc,GAAE,SAASoR;IACpB,CAAA;EACF,MACC,QAAO,OAAO,OAAO;IACnB,GAAGpR;IACH,QAAQA,GAAE,SAASoR;EACpB,CAAA;AAEJ;AC3BD,IAAM5L,UAAO,KAAK,KAAK;AAqBvB,IAAa6L,iBAAc,CAACC,QAAmCC,OAAuC,CAAE,MAAY;AAClH,QAAMC,WAAgBpD,oBAAmB,MAAA,IAAU,SAAS;IAAE,GAAG;IAAG,GAAG;EAAG;AAC1E,QAAM,WAAW,KAAK,YAAY;AAClC,QAAM,SAAS,KAAK,UAAU;AAC9B,QAAM,SAAS,OAAO,SAAS;AAC/B,QAAM,OAAO,KAAK,gBAAgB,KAAK;AACvC,UAAQ,UAAR;IACE,KAAK;AACH,aAAOmC,OAAUkB,UAAQC,aAAiB,KAAA,IAAS,QAAQ,KAAA,IAASlM,OAAAA,CAAK;IAE3E,KAAK;AACH,aAAO+K,OAAUkB,UAAQC,aAAiB,KAAK,KAAK,KAAA,CAAM,IAAI,QAAQ,KAAA,IAASlM,OAAAA,CAAK;IAEtF;AAEE,YAAM,IAAI,MAAM,qBAAsB,QAAA,iCAA0C;EAEnF;AACF;AC9BD,IAAamM,SAAqB,CAACC,IAAuCC,OAAgBxL,WAAsC;AAC9H,MAAIkI,UAASvO,EAAA,GAAI;AACf,QAAI,WAAW,OACb,QAAO+J,WAAU/J,GAAE,QAAQ,QAAQ,KAAA;AAErC,QAAIoO,oBAAmBpO,EAAA,EACrB,QAAO+J,WAAU/J,GAAE,QAAQA,IAAG,KAAA;QACzB,OAAM,IAAI,MAAM,mDAAmD;EAC3E,WACK,WAAW,OAAa,OAAM,IAAI,MAAM,yBAAyB;MACnE,QAAO+J,WAAU/J,IAAG,QAAQ,KAAA;AAGjC;AAED,IAAM+J,aAAY,CAACzC,QAAgBvD,QAAe8N,UAAsC;AAEtF,QAAM,EAAE,GAAA1L,IAAG,GAAAxF,GAAA,IAAM;AACjB,QAAMmR,KAAI,QAAQ,MAAM;AACxB,SAAO;QACA3L,EAAA,KAAQxF,EAAA;SACP,MAAA;QACD,MAAA,IAAY,MAAA,QAAgBmR,EAAA,IAAO,SAAS,CAAA;QAC5C,MAAA,IAAY,MAAA,QAAgBA,EAAA,KAAQ,SAAS,CAAA;IAClD,MAAM;CAAI;AACb;ACxBD,IAAapJ,YAAS,CAACO,YAA2C;AAChEnK,EAAAA,SAAMuK,OAAA;AAEN,SAAO;IACL,GAAGA;IACH,SAAS,CAACvF,YAAiBuL,WAAQhG,SAAQrF,OAAAA;IAM3C,aAAa,CAAC6J,OAAcjF,eAAYS,SAAQyE,EAAA;IAChD,MAAM,MAAMpM,QAAK2H,OAAA;IACjB,QAAQ,MAAMsG,eAActG,OAAA;IAC5B,aAAa,CAAC,QAAQ,SAASP,OAAMO,SAAQ,KAAA;IAC7C,kBAAkB,CAACV,QAAeI,2BAAmC;AACnE,YAAM,IAAI,MAAM,iBAAiB;IAClC;IACD,iBAAiB,CAACJ,WAA0B;AAC1C,YAAM,IAAI,MAAM,iBAAiB;IAClC;IACD,MAAM;EACP;AACF;ACvBD,IAAaoJ,gBAAe,CAACrC,SAAmCsC,oBAAqCvR,OAAiC;AACpI,MAAI2N,oBAAmB/E,OAAA,EAAS,QAAOA;AAGvC,QAAMnK,MAAKe,mBAAkB,oBAAoBU,EAAA;AACjD,SAAO,OAAO,OAAO;IACnB,GAAG0I;IACH,GAAGnK;EACJ,CAAA;AACF;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AEfD,IAAa+S,UAAS,CAACC,OAAYC,SAA4B;AAC7D,MAAI,KAAK,IAAI,KAAK,KAAK,IAAI,EAAG,QAAO;AACrC,MAAI,KAAK,KAAKC,MAAK,QAAQ,KAAK,KAAKA,MAAK,KAAM,QAAO;AACvD,SAAO;AACR;ACHD,IAAaC,UAAS,CAACC,SAAiD;AACtE,MAAI,SAAS,OAAW,QAAO;AAC/B,SAAO,OAAO,QAAQ,OAAO;AAC9B;AASD,IAAaC,aAAY,CACvBJ,MACA,gBAAgB,SAChBK,UACG;AACH,MAAI,SAAS,OACX,OAAM,IAAI,MAAM,gBAAgB,gCAAgC;AAElE,MAAI,KAAK,MAAM,OAAW,OAAM,IAAI,MAAM,gBAAgB,iBAAiB;AAC3E,MAAI,KAAK,MAAM,OAAW,OAAM,IAAI,MAAM,gBAAgB,iBAAiB;AAC3E,MAAI,OAAO,MAAM,KAAK,CAAA,EAAI,OAAM,IAAI,MAAM,gBAAgB,WAAW;AACrE,MAAI,OAAO,MAAM,KAAK,CAAA,EAAI,OAAM,IAAI,MAAM,gBAAgB,WAAW;AACrE,MAAI,CAAC,OAAO,UAAU,KAAK,CAAA,EACzB,OAAM,IAAI,UAAU,gBAAgB,mBAAmB;AAEzD,MAAI,CAAC,OAAO,UAAU,KAAK,CAAA,EACzB,OAAM,IAAI,UAAU,gBAAgB,mBAAmB;AAEzD,MAAIJ,UAAS,UAAa,CAACH,QAAOG,OAAM,IAAA,EACtC,OAAM,IAAI,MACR,GAAI,aAAA,8BAA6C,KAAK,CAAA,IAAO,KAAK,CAAA,UAAaA,MAAK,IAAA,KAAWA,MAAK,IAAA,EAAO;AAGhH;AAOD,IAAaK,aAAY,CAACP,OAAY,gBAAgB,YAAY;AAChE,MAAIE,UAAS,OACX,OAAM,IAAI,MAAM,GAAI,aAAA,gCAA8C;AAEpE,MAAI,EAAE,UAAUA,OAAO,OAAM,IAAI,MAAM,GAAI,aAAA,oBAAkC;AAC7E,MAAI,EAAE,UAAUA,OAAO,OAAM,IAAI,MAAM,GAAI,aAAA,oBAAkC;AAE7E,MAAI,CAAC,OAAO,UAAUA,MAAK,IAAA,EACzB,OAAM,IAAI,UAAU,GAAI,aAAA,yBAAuC;AAEjE,MAAI,CAAC,OAAO,UAAUA,MAAK,IAAA,EACzB,OAAM,IAAI,UAAU,GAAI,aAAA,yBAAuC;AAElE;ACrDD,IAAaM,eAAc,SACzBR,OACAC,MACAQ,SAAwB,aACF;AACtB,EAAAF,WAAUL,OAAM,MAAM;AACtB,EAAAG,WAAU,MAAM,MAAM;AAEtB,MAAIpM,KAAI,KAAK;AACb,MAAIxF,KAAI,KAAK;AACb,UAAQiS,QAAR;IACE,KAAK,QAAQ;AACX,MAAAzM,KAAIA,KAAIiM,MAAK;AACb,MAAAzR,KAAIA,KAAIyR,MAAK;AACb,UAAIjM,KAAI,EAAG,CAAAA,KAAIiM,MAAK,OAAOjM;eAClBA,MAAKiM,MAAK,KACjB,CAAAjM,MAAKiM,MAAK;AAEZ,UAAIzR,KAAI,EAAG,CAAAA,KAAIyR,MAAK,OAAOzR;eAClBA,MAAKyR,MAAK,KACjB,CAAAzR,MAAKyR,MAAK;AAEZ,MAAAjM,KAAI,KAAK,IAAIA,EAAA;AACb,MAAAxF,KAAI,KAAK,IAAIA,EAAA;AACb;IACD;IACD,KAAK,QAAQ;AACX,MAAAwF,KAAI,WAAWA,IAAGiM,MAAK,IAAA;AACvB,MAAAzR,KAAI,WAAWA,IAAGyR,MAAK,IAAA;AACvB;IACD;IACD,KAAK,aAAa;AAChB,UAAIjM,KAAI,KAAKxF,KAAI,EAAG;AACpB,UAAIwF,MAAKiM,MAAK,QAAQzR,MAAKyR,MAAK,KAAM;AACtC;IACD;IACD,KAAK;AACH;IAEF;AACE,YAAM,IAAI,MAAM,wBAAyBQ,MAAAA,iDAAsD;EAElG;AACD,SAAO,OAAO,OAAO;IAAE,GAAAzM;IAAG,GAAAxF;EAAG,CAAA;AAC9B;;;;;;;;;;;ACnCD,IAAakS,YAAS,CACpBC,QACAC,SACwB;AACxB,QAAMX,QAAOY,yBAAwBC,QAAO,IAAA;AAE5C,QAAMC,MAA0B,CAC9Bf,MACAQ,SAAwB,gBACNQ,kBAAef,OAAMa,QAAO,MAAML,MAAAA;AACtD,SAAOQ;AACR;AAED,IAAMD,oBAAiB,CAAIjB,OAAYmB,QAA2BlB,MAAgBQ,WAA0B;AAC1G,QAAM,QAAQW,eAAclB,OAAM,MAAMQ,MAAAA;AACxC,MAAI,UAAU,OAAW,QAAO;AAChC,SAAOK,OAAO,KAAA;AACf;AAwBD,IAAaM,eAAY,CACvBC,QACAT,SACsB;AACtB,QAAMX,QAAOY,yBAAwBC,QAAO,IAAA;AAC5C,SAAO,CAACQ,QAAUtB,MAAgBQ,SAAwB,gBAAgBe,qBAAkBtB,OAAMa,QAAO7B,QAAO,MAAMwB,MAAAA;AACvH;AAED,IAAMc,uBAAoB,CACxBxB,OACAsB,QACAC,QAAUtB,MAAgBQ,WACvB;AACH,QAAM,QAAQW,eAAclB,OAAM,MAAMQ,MAAAA;AACxC,MAAI,UAAU,OAAW,OAAM,IAAI,WAAW,SAAU,KAAK,CAAA,IAAO,KAAK,CAAA,mCAAsCR,MAAK,IAAA,UAAgBA,MAAK,IAAA,EAAO;AAChJ,EAAAa,OAAO,KAAA,IAAU7B;AACjB,SAAO6B;AACR;AAED,IAAaU,SAAM,CACjBb,QACAC,SACG;AACH,QAAMX,QAAOY,yBAAwBC,QAAO,IAAA;AAC5C,SAAO,CAACQ,QAAUtB,MAAgBQ,WAA0BiB,eAAYxB,OAAMa,QAAO7B,QAAO,MAAMwB,MAAAA;AACnG;AAED,IAAMgB,iBAAc,CAClB1B,OACAY,QACAW,QAAUtB,MAAgBQ,WACvB;AACH,QAAM,QAAQW,eAAclB,OAAM,MAAMQ,MAAAA;AACxC,MAAI,UAAU,OAAW,OAAM,IAAI,WAAW,SAAU,KAAK,CAAA,IAAO,KAAK,CAAA,mCAAsCR,MAAK,IAAA,UAAgBA,MAAK,IAAA,EAAO;AAChJ,QAAM,OAAO,CAAE,GAAGa,MAAO;AACzB,OAAM,KAAA,IAAU7B;AAChB,EAAA6B,SAAQ;AACR,SAAO;AACR;AAQD,IAAMD,2BAA0B,CAAIK,QAA2BN,SAAuB;AACpF,QAAMX,QAAO;IAAE;IAAM,MAAM,KAAK,KAAKa,OAAM,SAAS,IAAA;EAAO;AAC3D,SAAOb;AACR;AAoBD,IAAayB,iBAAc,CAAIC,QAAYf,SAAiC;AAC1E,QAAMX,QAAOY,yBAAwBC,QAAO,IAAA;AAC5C,SAAO;IACL,GAAGb;IACH,KAAKS,UAAOI,QAAO,IAAA;IACnB,KAAKM,aAAUN,QAAO,IAAA;IACtB,IAAI,QAAQ;AACV,aAAOA;IACR;EACF;AACF;AAyBD,IAAaL,UAAO,CAAIkB,QAAYf,SAAiC;AACnE,QAAMX,QAAOY,yBAAwBC,QAAO,IAAA;AAC5C,SAAO;IACL,GAAGb;IACH,KAAK,CAACD,MAAgB4B,cAA+B,gBAAgBZ,kBAAef,OAAMa,QAAO,MAAM,WAAA;IACvG,KAAK,CAACe,QAAU7B,MAAgB4B,cAA+B,gBAAgB;AAC7E,MAAAd,SAAQW,eAAYxB,OAAMa,QAAO7B,QAAO,MAAM,WAAA;AAC9C,aAAOwB,QAAKK,QAAO,IAAA;IACpB;IACD,IAAI,QAAQ;AACV,aAAOA;IACR;EACF;AACF;AAgBD,IAAagB,eAAc,CAAIC,cAAiBC,YAA2BC,cAA0B;AACnG,QAAMC,SAAO,OAAO,eAAe,WAAW,aAAa,WAAW;AACtE,QAAM,OAAO,OAAO,eAAe,WAAW,WAAW,OAAOC;AAChE,MAAI,CAAC,KAAM,OAAM,IAAI,MAAM,6BAA6B;AACxD,cACE,YAAYD,QAAM,aAAa,MAAM,GACrC,YAAY,MAAM,aAAa,MAAM,CAAC;AAGxC,QAAME,KAAS,CAAE;AACjB,QAAMC,SAAQH,SAAO;AACrB,WAAS,QAAQ,GAAG,QAAQG,QAAO,QACjC,CAAA1G,GAAG,KAAA,IAAU;AAEf,SAAOA;AACR;AAgBD,IAAa2G,iBAAgB,CAAIP,cAAiBC,YAA2BC,cAAqC;AAChH,QAAMC,SAAO,OAAO,eAAe,WAAW,aAAa,WAAW;AACtE,QAAM,OAAO,OAAO,eAAe,WAAW,WAAW,OAAOC;AAChE,MAAI,CAAC,KAAM,OAAM,IAAI,MAAM,6BAA6B;AACxD,QAAMrB,SAAQgB,aAAY,cAAcI,QAAM,IAAA;AAC9C,SAAOR,eAAYZ,QAAO,IAAA;AAC3B;;;;;;;;;;ACpND,IAAayB,YAAS,CAAIC,WAAiD;AACzE,MAAI,SAAS;AACb,aAAW,OAAO1B,OAChB,KAAI,OAAO,MAAM,MAAA,EACf,UAAS,IAAI;WAET,WAAW,IAAI,OAAQ,OAAM,IAAI,MAAM,2CAA2C;AAI1F,SAAO;IAAE,MAAMA,OAAM;IAAQ,MAAM;EAAQ;AAC5C;AAED,IAAaM,aAAY,CACvBqB,WACsB;AACtB,QAAMxC,QAAOsC,UAAOzB,MAAA;AACpB,SAAO,CAACQ,QAAUtB,MAAgBQ,SAAwB,gBAAgBe,mBAAkBtB,OAAMa,QAAO7B,QAAO,MAAMwB,MAAAA;AACvH;AAcD,IAAMc,qBAAoB,CACxBxB,OACA0C,QACAnB,QAAUtB,MAAgB0C,WACvB;AACH,MAAI,YAAYnC,aAAYN,OAAM,MAAM,MAAA;AACxC,MAAI,cAAc,OAAW,OAAM,IAAI,WAAW,SAAU,KAAK,CAAA,IAAO,KAAK,CAAA,mCAAsCA,MAAK,IAAA,UAAgBA,MAAK,IAAA,EAAO;AACpJ,EAAAa,OAAO,UAAU,CAAA,EAAK,UAAU,CAAA,IAAM7B;AACtC,SAAO6B;AACR;AAgBD,IAAaJ,UAAS,CACpBiC,WACwB;AACxB,QAAM1C,QAAOsC,UAAOzB,MAAA;AAEpB,QAAM8B,MAA0B,CAC9B5C,MACAQ,SAAwB,gBACNQ,gBAAef,OAAMa,QAAO,MAAML,MAAAA;AACtD,SAAOQ;AACR;AAED,IAAMD,kBAAiB,CAAIjB,OAAYyC,QAAwCxC,MAAgBQ,WAA0B;AACvH,MAAI,YAAYD,aAAYN,OAAM,MAAMQ,MAAAA;AACxC,MAAI,cAAc,OAAW,QAAO;AACpC,SAAOK,OAAO,UAAU,CAAA,EAAK,UAAU,CAAA;AACxC;AAED,IAAaY,eAAc,CAAImB,WAA+B;AAC5D,QAAM5C,QAAOsC,UAAOzB,MAAA;AACpB,SAAO;IACL,GAAGb;IACH,KAAKS,QAAOI,MAAA;IACZ,KAAKM,WAAUN,MAAA;IACf,IAAI,QAAQ;AACV,aAAOA;IACR;EACF;AACF;AAED,IAAaU,OAAM,CACjBsB,WACG;AACH,QAAM7C,QAAOsC,UAAOzB,MAAA;AACpB,SAAO,CAACQ,QAAUtB,MAAgBQ,WAA0BiB,aAAYxB,OAAMa,QAAO7B,QAAO,MAAMwB,MAAAA;AACnG;AAED,IAAMgB,eAAc,CAClB1B,OACA+C,QACAxB,QAAUtB,MAAgBQ,WACvB;AACH,MAAI,YAAYD,aAAYN,OAAM,MAAMQ,MAAAA;AACxC,MAAI,cAAc,OAAW,OAAM,IAAI,WAAW,SAAU,KAAK,CAAA,IAAO,KAAK,CAAA,mCAAsCR,MAAK,IAAA,UAAgBA,MAAK,IAAA,EAAO;AACpJ,MAAI,YAAY,CAAE,GAAGa,MAAO;AAC5B,MAAI,UAAU,CAAE,GAAG,UAAW,UAAU,CAAA,CAAK;AAC7C,UAAS,UAAU,CAAA,IAAM7B;AACzB,YAAW,UAAU,CAAA,IAAM;AAC3B,EAAA6B,SAAQ;AACR,SAAO;AACR;AAuBD,IAAaL,UAAO,CAAIoC,WAA+B;AACrD,QAAM5C,QAAOsC,UAAOzB,MAAA;AACpB,SAAO;IACL,GAAGb;IACH,KAAK,CAACD,MAAgB4B,cAA+B,gBAAgBZ,gBAAef,OAAMa,QAAO,MAAM,WAAA;IACvG,KAAK,CAACe,QAAU7B,MAAgB4B,cAA+B,gBAAgB;AAC7E,MAAAd,SAAQW,aAAYxB,OAAMa,QAAO7B,QAAO,MAAM,WAAA;AAC9C,aAAOwB,QAAKK,MAAA;IACb;IACD,IAAI,QAAQ;AACV,aAAOA;IACR;EACF;AACF;AC1ID,UAAiBiC,QAAUC,OAAuBC,MAAiD;AACjG,aAAW5Q,MAAK,KACd,KAAI,MAAM,QAAQA,EAAA,EAChB,OAAMA,GAAE,IAAI,CAAAG,OAAKyN,MAAK,IAAIzN,IAAG,WAAW,CAAC;MAEzC,OAAMyN,MAAK,IAAI5N,IAAG,WAAW;AAGlC;ACLD,UAAiB6Q,OAAMnD,OAAYoD,OAAkB1C,SAAO,MAAM;AAChE,MAAI,CAAC,MAAO,SAAQ;IAAE,GAAG;IAAG,GAAG;EAAG;AAElC,EAAAH,WAAUL,OAAM,MAAM;AACtB,EAAAG,WAAU,OAAO,SAASH,KAAA;AAE1B,MAAI,EAAE,GAAAjM,IAAG,GAAAxF,GAAA,IAAM;AACf,MAAI,UAAU;AACd,KAAG;AACD,UAAM;MAAE,GAAAwF;MAAG,GAAAxF;IAAG;AACd,IAAAwF;AACA,QAAIA,OAAMiM,MAAK,MAAM;AACnB,MAAAzR;AACA,MAAAwF,KAAI;IACL;AACD,QAAIxF,OAAMyR,MAAK,KACb,KAAIQ,QAAM;AACR,MAAAjS,KAAI;AACJ,MAAAwF,KAAI;IACL,MACC,WAAU;AAGd,QAAIA,OAAM,MAAM,KAAKxF,OAAM,MAAM,EAAG,WAAU;EAC/C,SAAQ;AACV;AAiBD,UAAiB4U,YAAcJ,OAAuBG,OAAkB1C,SAAO,MAAM;AACnF,SAAOsC,QAAO9C,OAAMiD,OAAMjD,OAAM,OAAOQ,MAAAA,CAAK;AAC7C;AAYD,UAAiB4C,gBAAkBL,OAAuBG,OAAkB1C,SAAO,MAAsC;AACvH,aAAW,QAAQyC,OAAMjD,OAAM,OAAOQ,MAAAA,EACpC,OAAM;IAAE;IAAM,OAAOR,MAAK,IAAI,IAAA;EAAO;AAExC;;;;;;AClED,IAAaiC,QAAO,WAAWnC,OAAYoD,OAAkB;AAC3D,MAAI,CAAC,MAAO,SAAQ;IAAE,GAAG;IAAG,GAAG;EAAG;AAClC,MAAI,MAAM,MAAM;AAChB,MAAIG,WAA4B,CAAE;AAElC,aAAWpV,MAAKgV,OAAMjD,OAAM,KAAA,EAC1B,KAAI/R,GAAE,MAAM,IACV,UAAS,KAAKA,EAAA;OACT;AACL,UAAM;AACN,eAAW,CAAEA,EAAG;AAChB,UAAMA,GAAE;EACT;AAEH,MAAI,SAAS,SAAS,EAAG,OAAM;AAChC;AAmBD,UAAiBiU,SAAQpC,OAAYoD,OAAkB;AACrD,MAAI,CAAC,MAAO,SAAQ;IAAE,GAAG;IAAG,GAAG;EAAG;AAClC,WAASnP,KAAI,MAAM,GAAGA,KAAIiM,MAAK,MAAMjM,MAAK;AACxC,QAAIuP,WAA4B,CAAE;AAClC,aAAS/U,KAAI,MAAM,GAAGA,KAAIyR,MAAK,MAAMzR,KACnC,UAAS,KAAK;MAAE,GAAAwF;MAAG,GAAAxF;IAAG,CAAA;AAExB,UAAM;EACP;AACF;AC9CD,IAAa8Q,UAAS,SACpBS,OACAyD,OACAC,QACAf,SAA0B,aACJ;AACtB,SAAOnC,aAAYN,OAAM;IACvB,GAAG,MAAM,IAAI,OAAO;IACpB,GAAG,MAAM,IAAI,OAAO;EACrB,GAAE,MAAA;AAgDJ;ACnED,IAAayD,iBAAgB,OAAO,OAAO;EACzC;EACA;EACA;EACA;EACA;EACA;EACA;EACA;AACD,CAAA;AAKD,IAAaC,mBAAkB,OAAO,OAAO;EAC3C;EACA;EACA;EACA;AACD,CAAA;AAWD,IAAaC,mBAAkB,CAC7B7D,OACAyD,OACAK,OACAnB,SAA0B,WACP;AACnB,EAAApC,WAAUL,OAAM,MAAM;AACtB,EAAAG,WAAU,OAAO,OAAO;AACxB,cAAY,YAAY,OAAO,aAAa,OAAO,CAAC;AAEpD,QAAM,aAAasD;AACnB,QAAM,UAAU,WAAW,IAAI,CAACrR,OAAMyR,uBAAsBzR,IAAG,KAAA,CAAM;AACrE,QAAM6Q,UAAQ,WAAW,IAAI,CAAC7Q,IAAG,UAC/BiN,QAAOW,OAAM,OAAO,QAAS,KAAA,GAAS,MAAA,CAAO;AAG/C,SAAO,YAAY,YAAYiD,OAAAA;AAChC;AAkBD,IAAaY,yBAAwB,CACnCC,YACA,aAAa,MACA;AACb,MAAIvR;AACJ,UAAQwR,YAAR;IACE,KAAK,KAAK;AACR,MAAAxR,KAAI;QAAE,GAAG;QAAG,GAAG,KAAK;MAAY;AAChC;IACD;IACD,KAAK,MAAM;AACT,MAAAA,KAAI;QAAE,GAAG,IAAI;QAAY,GAAG,KAAK;MAAY;AAC7C;IACD;IACD,KAAK,KAAK;AACR,MAAAA,KAAI;QAAE,GAAG,IAAI;QAAY,GAAG;MAAG;AAC/B;IACD;IACD,KAAK,MAAM;AACT,MAAAA,KAAI;QAAE,GAAG,IAAI;QAAY,GAAG,IAAI;MAAY;AAC5C;IACD;IACD,KAAK,KAAK;AACR,MAAAA,KAAI;QAAE,GAAG;QAAG,GAAG,IAAI;MAAY;AAC/B;IACD;IACD,KAAK,MAAM;AACT,MAAAA,KAAI;QAAE,GAAG,KAAK;QAAY,GAAG,IAAI;MAAY;AAC7C;IACD;IACD,KAAK,KAAK;AACR,MAAAA,KAAI;QAAE,GAAG,KAAK;QAAY,GAAG;MAAG;AAChC;IACD;IACD,KAAK,MAAM;AACT,MAAAA,KAAI;QAAE,GAAG,KAAK;QAAY,GAAG,KAAK;MAAY;AAC9C;IACD;IACD;AACE,MAAAA,KAAI;QAAE,GAAG;QAAG,GAAG;MAAG;EAErB;AACD,SAAO,OAAO,OAAOA,EAAA;AACtB;;;;;;;AErGD,IAAayR,WAAU,CAACT,OAAiBU,QAA2C;AAElF,EAAA9D,WAAU,KAAA;AACV,EAAAA,WAAU,GAAA;AAEV,MAAI,SAAS,MAAM;AACnB,MAAI,SAAS,MAAM;AACnB,QAAM,KAAK,KAAK,IAAI,IAAI,IAAI,MAAA;AAC5B,QAAM,KAAK,KAAK,IAAI,IAAI,IAAI,MAAA;AAC5B,QAAM,KAAK,SAAS,IAAI,IAAI,IAAI;AAChC,QAAM,KAAK,SAAS,IAAI,IAAI,IAAI;AAChC,MAAI,QAAQ,KAAK;AAEjB,QAAM+D,UAAmB,CAAE;AAE3B,SAAO,MAAM;AACXjB,YAAM,KAAK,OAAO,OAAO;MAAE,GAAG;MAAQ,GAAG;IAAQ,CAAA,CAAC;AAClD,QAAI,WAAW,IAAI,KAAK,WAAW,IAAI,EAAG;AAC1C,UAAM,SAAS,IAAI;AACnB,QAAI,SAAS,CAAC,IAAI;AAChB,eAAS;AACT,gBAAU;IACX;AACD,QAAI,SAAS,IAAI;AACf,eAAS;AACT,gBAAU;IACX;EACF;AACD,SAAOA;AACR;AAYD,IAAakB,cAAa,SACxBZ,OACAU,KACA,eAAe,OACU;AACzB,QAAMG,UAAyB,CAAE;AACjC,MAAI,MAAM,MAAM,IAAI,GAAG;AAErB,UAAM,QAAQ,eAAe,IAAI,IAAI,IAAI,IAAI;AAC7C,aAAS7V,KAAI,MAAM,GAAGA,KAAI,OAAOA,KAC/B0U,SAAM,KAAK;MAAE,GAAG,MAAM;MAAM,GAAA1U;IAAG,CAAA;EAElC,WAAU,MAAM,MAAM,IAAI,GAAG;AAE5B,UAAM,QAAQ,eAAe,IAAI,IAAI,IAAI,IAAI;AAC7C,aAASwF,KAAI,MAAM,GAAGA,KAAI,OAAOA,KAC/BkP,SAAM,KAAK;MAAK,GAAAlP;MAAG,GAAG,MAAM;IAAG,CAAA;EAElC,MACC,OAAM,IAAI,MACR,sCAAuC,MAAM,CAAA,IAAO,MAAM,CAAA,MAAS,IAAI,CAAA,IAAO,IAAI,CAAA,EAAI;AAG1F,SAAOkP;AACR;ACrDD,IAAa/B,iBAAgB,CAC3BpB,OACAC,MACAQ,WACuB;AACvB,EAAAF,WAAUL,OAAM,MAAM;AAEtB,MAAI,KAAK,IAAI,EACX,SAAQQ,QAAR;IACE,KAAK,QAAQ;AACX,aAAO;QAAE,GAAG;QAAM,GAAG;MAAG;AACxB;IACD;IACD,KAAK;AACH,YAAM,IAAI,MAAM,yBAAyB;IAE3C,KAAK;AACH,aAAO;IAET,KAAK,QAAQ;AAEX,aAAOnB,QAAOW,OAAM;QAAE,GAAG;QAAG,GAAG,KAAK;MAAG,GAAE;QAAE,GAAG,KAAK;QAAG,GAAG;MAAG,GAAE,MAAM;AACpE;IACD;EACF;AAEH,MAAI,KAAK,IAAI,EACX,SAAQQ,QAAR;IACE,KAAK,QAAQ;AACX,aAAO;QAAE,GAAG;QAAM,GAAG;MAAG;AACxB;IACD;IACD,KAAK;AACH,YAAM,IAAI,MAAM,yBAAyB;IAE3C,KAAK;AACH,aAAO;IAET,KAAK,QAAQ;AACX,aAAO;QAAE,GAAG;QAAM,GAAGR,MAAK,OAAO,KAAK;MAAG;AACzC;IACD;EACF;AAEH,MAAI,KAAK,KAAKA,MAAK,KACjB,SAAQQ,QAAR;IACE,KAAK,QAAQ;AACX,aAAO;QAAE,GAAG;QAAM,GAAGR,MAAK,OAAO;MAAG;AACpC;IACD;IACD,KAAK;AACH,YAAM,IAAI,MAAM,yBAAyB;IAE3C,KAAK;AACH,aAAO;IAET,KAAK,QAAQ;AACX,aAAO;QAAE,GAAG;QAAM,GAAG,KAAK,IAAIA,MAAK;MAAM;AACzC;IACD;EACF;AAEH,MAAI,KAAK,KAAKA,MAAK,KACjB,SAAQQ,QAAR;IACE,KAAK,QAAQ;AACX,aAAO;QAAE,GAAG;QAAM,GAAGR,MAAK,OAAO;MAAG;AACpC;IACD;IACD,KAAK;AACH,YAAM,IAAI,MAAM,yBAAyB;IAE3C,KAAK;AACH,aAAO;IAET,KAAK,QAAQ;AACX,aAAO;QAAE,GAAG;QAAM,GAAG,KAAK,IAAIA,MAAK;MAAM;AACzC;IACD;EACF;AAGH,QAAM,QAAQ,KAAK,IAAIA,MAAK,OAAO,KAAK;AAExC,SAAO;AACR;AAoBD,IAAaqE,iBAAgB,CAC3BC,YACAC,UACa;AACb,MAAI,OAAO;AACX,SAAO,OAAO,eAAe,WAAW,aAAa,WAAW;AAChE,cAAY,YAAY,MAAM,aAAa,YAAY,CAAC;AAExD,SAAO;IACL,GAAG,QAAQ;IACX,GAAG,KAAK,MAAM,QAAQ,IAAA;EACvB;AACF;ACtID,IAAatM,aAAU,CACrBuM,IACAC,OACY;AACZ,MAAI9W,OAAM,OAAW,QAAO;AAC5B,MAAIC,OAAM,OAAW,QAAO;AAC5B,MAAI,UAAUA,MAAK,UAAUA,GAC3B,KAAI,UAAUD,MAAK,UAAUA,IAC3B;QAAIC,GAAE,SAASD,GAAE,QAAQC,GAAE,SAASD,GAAE,KAAM,QAAO;EAAM,MACpD,QAAO;AAEhB,MAAI,UAAUC,GACZ,KAAI,UAAUD,IACZ;QAAIC,GAAE,SAASD,GAAE,KAAM,QAAO;EAAM,MAC/B,QAAO;AAEhB,SAAO;AACR;AAUD,IAAa+W,cAAa,CACxBC,IACAC,OACY;AACZ,MAAIjX,OAAM,OAAW,QAAO;AAC5B,MAAIC,OAAM,OAAW,QAAO;AAC5B,SAAOA,GAAE,MAAMD,GAAE,KAAKC,GAAE,MAAMD,GAAE;AACjC;ACtCD,IAAakX,mBAAkB,CAACC,SAAmCC,eAAc,IAAA;AAQjF,IAAMC,eAAc,CAClBC,OACuB;AACvB,MAAI9H,OAAM,OAAW,QAAO;AAC5B,MAAIA,GAAG,CAAA,MAAQ,OAAW,QAAO;AACjC,SAAO;AACR;AAmBD,IAAa+H,iBAAgB,CAC3BpF,OACAC,MACAoF,YACA1C,WAC6B;AAE7B,QAAM,iBAAiB2C,YAAWpF,OAAM,MAAM,QAAQ,UAAA;AAGtD,QAAMqF,WAAU,OAAO,QAAQ,cAAA;AAC/B,SAAQA,SAAiC,OAAO,CAAAlI,OAAK6H,aAAY7H,EAAA,CAAE;AACpE;AA8BD,IAAaiI,cAAa,CACxBtF,OACAC,MACA0C,SAA0B,aAC1B6C,eACmB;AACnB,QAAM,cAAc,cAAc7B;AAClC,QAAM,SAAS,YAAY,IAAI,CAACxV,OAC9BoR,QAAOW,OAAM,MAAM6D,uBAAsB5V,EAAA,GAAI,MAAA,CAAO;AAEtD,SAAO,YAAsB,aAAa,MAAA;AAC3C;ACtED,IAAasX,aAAY,CAAIzF,OAAY0F,iBAA4B;AACnE,QAAMC,cAAoB,CAAE;AAC5B,WAAS,MAAM,GAAG,MAAMzF,MAAK,MAAM,OAAO;AACxC,gBAAa,GAAA,IAAQ,MAAM,KAAQ,EAAE,QAAQA,MAAK,KAAM,CAAA;AACxD,QAAI,aACF,UAAS,MAAM,GAAG,MAAMA,MAAK,MAAM,MACjC,aAAa,GAAA,EAAO,GAAA,IAAQ;EAGjC;AACD,SAAO;AACR;ACpBD,IAAa0F,iBAAgB,CAACC,OAAwB,QAASpT,GAAE,CAAA,IAAOA,GAAE,CAAA;ACM1E,UAAiBqT,cACfC,OACkC;AAClC,aAAW5X,MAAKgV,OAAMjD,KAAA,EACpB,OAAM8F,kBAAiB9F,OAAM/R,EAAA;AAEhC;AAYD,IAAa8X,eAAc,CACzBF,OACAG,aACyB;AACzB,QAAM,OAAOhG,MAAK;AAClB,cAAY,WAAW,MAAM,YAAY,WAAW,CAAC;AACrD,MAAI,SAAS,IAAI,KAAK,SAAS,IAAI,EAAG;AACtC,QAAMjM,KAAI,KAAK,MAAM,SAAS,IAAI,IAAA;AAClC,QAAMxF,KAAI,KAAK,MAAM,SAAS,IAAI,IAAA;AAClC,MAAIwF,MAAKiM,MAAK,KAAM;AACpB,MAAIzR,MAAKyR,MAAK,KAAM;AACpB,SAAO;IAAE,GAAAjM;IAAG,GAAAxF;EAAG;AAChB;AAmBD,IAAauX,oBAAmB,CAC9BD,OACA9F,SACmB;AACnB,EAAAI,WAAU,IAAA;AACV,QAAM,OAAOH,MAAK;AAClB,QAAMjM,KAAI,KAAK,IAAI;AACnB,QAAMxF,KAAI,KAAK,IAAI;AACnB,QAAMyO,KAAIpB,aAAiB;IAAK,GAAA7H;IAAM,GAAAxF;EAAG,GAAE,MAAM,IAAA;AACjD,SAAOyO;AACR;AASD,IAAaiJ,cAAa,CAACJ,OAAkB9F,SAA0B;AACrE,EAAAI,WAAU,IAAA;AAEV,QAAM,OAAOH,MAAK;AAClB,QAAMjM,KAAI,KAAK,IAAI;AACnB,QAAMxF,KAAI,KAAK,IAAI;AACnB,SAAO,OAAO,OAAO;IAAE,GAAGwF,KAAI,OAAO;IAAG,GAAGxF,KAAI,OAAO;EAAG,CAAA;AAC1D;AC7ED,IAAa2X,gBAAe,MAAmC;AAC7D,SAAO,EACL,QAAQ,CAAC,SAAS,KAAM,CAAA,EACzB;AACF;ACFD,IAAaC,mBAAkB,MAAmC;AAChE,SAAO;IACL,QAAQ,CAACC,iBAAyC;AAChD,aAAOhB,aAAW,GAAG,CAAA;IACtB;IACD,eAAe,CAACpF,OAAM,SAAS;AAC7B,aAAOkF,eAAclF,OAAM,MAAMyD,gBAAe,WAAW;IAC5D;EACF;AACF;ACrBD,IAAa4C,eAAc,CAACC,OAAiC,CAAE,MAAkC;AAC/F,QAAM,WAAW,KAAK,YAAY;AAClC,SAAO;IACL,QAAQ,CAAC,SAAS,KAAK,KAAK,CAACnJ,OAAMA,GAAG,CAAA,OAAS,WAAW,MAAM,IAAG;IACnE,eAAe,CAAC6C,OAAM,SAAuC;AAC3D,UAAI,SAEF,KAAI,KAAK,IAAI,EAEX,QAAO;QAAE,GAAG,KAAK;QAAG,GAAG,KAAK,IAAI;MAAG;eAG/B,KAAK,MAAM,EAEb,QAAO;QAAE,GAAGA,MAAK,OAAO;QAAG,GAAGA,MAAK,OAAO;MAAG;UAE7C,QAAO;QAAE,GAAG,KAAK,IAAI;QAAG,GAAGA,MAAK,OAAO;MAAG;eAK1C,KAAK,IAAIA,MAAK,OAAO,EAEvB,QAAO;QAAE,GAAG,KAAK;QAAG,GAAG,KAAK,IAAI;MAAG;eAG/B,KAAK,IAAIA,MAAK,OAAO,EAEvB,QAAO;QAAE,GAAG,KAAK,IAAI;QAAG,GAAG;MAAG;UAG9B,QAAO;QAAE,GAAG;QAAG,GAAG;MAAG;AAI3B,aAAO,CAAE,CAAE,WAAW,MAAM,KAAK,IAAM,CAAE;IAC1C;EACF;AACF;ACjCD,IAAauG,cAAa,MAAmC;AAC3D,SAAO,EACL,QAAQ,CAAC,SAAS,KAAK,GAAG,EAAA,EAC3B;AACF;ACAD,IAAaC,eAAc,MAAmC;AAC5D,SAAO;IACL,eAAe,CAACxG,OAAM,SAAS;AAC7B,YAAMyG,KAA0B,CAAE;AAClC,iBAAWxY,MAAKgV,OAAMjD,OAAM,IAAA,EAC1B,CAAAtE,GAAE,KAAK,CAAE,KAAKzN,EAAG,CAAA;AAEnB,aAAOyN;IACR;IACD,QAAQmJ;EACT;AACF;ACbD,IAAa6B,yBAAwB,MAAmC;AACtE,SAAO,EACL,QAAQ7B,iBACT;AACF;ACXD,IAAa8B,YAAW,CAACL,OAAiC,CAAE,MAAkC;AAC5F,QAAM,WAAW,KAAK,YAAY;AAClC,SAAO;IACL,QAAQ,CAACM,SACP,KAAK,KAAK,CAACzJ,OAAMA,GAAG,CAAA,OAAS,WAAW,MAAM,IAAG;IACnD,eAAe,CACb2C,OACAC,SACiC;AACjC,UAAI,SAEF,KAAI,KAAK,IAAI,EAEX,QAAO;QAAE,GAAG,KAAK,IAAI;QAAG,GAAG,KAAK;MAAG;eAG/B,KAAK,IAAI,EAEX,QAAO;QAAE,GAAGC,MAAK,OAAO;QAAG,GAAG,KAAK,IAAI;MAAG;UAG1C,QAAO;QAAE,GAAGA,MAAK,OAAO;QAAG,GAAGA,MAAK,OAAO;MAAG;eAO7C,KAAK,IAAIA,MAAK,OAAO,EAEvB,QAAO;QAAE,GAAG,KAAK,IAAI;QAAG,GAAG,KAAK;MAAG;eAI/B,KAAK,IAAIA,MAAK,OAAO,EAEvB,QAAO;QAAE,GAAG;QAAG,GAAG,KAAK,IAAI;MAAG;UAG9B,QAAO;QAAE,GAAG;QAAG,GAAG;MAAG;AAI3B,aAAO,CAAE,CAAE,WAAW,MAAM,KAAK,IAAM,CAAE;IAC1C;EACF;AACF;ACRD,UAAiB6G,mBACfC,OACAhH,OACAwG,OAAiC,CAAE,GACd;AACrB,EAAAjG,WAAUL,OAAM,MAAM;AACtB,QAAM,QAAQ,KAAK,SAAS;IAAE,GAAG;IAAG,GAAG;EAAG;AAE1C,EAAAG,WAAU,OAAO,cAAcH,KAAA;AAE/B,QAAMzN,KAAI,KAAK,WAAWwU,WAAkBrB,cAAA;AAC5C,QAAM,qBAAqB,MAAM,kBAAkB,CAACsB,IAASC,OAAgB/B,eAAcgC,IAAGjZ,IAAGyV,kBAAiB,WAAW;AAE7H,MAAIyD,YAAwB,CAAE,KAAO;AACrC,MAAIC,YAA6B,CAAE;AACnC,MAAIC,UAAgC;AAEpC,SAAO,UAAU,SAAS,GAAG;AAC3B,QAAI,YAAY,QAAW;AACzB,YAAM,KAAK,UAAU,IAAA;AACrB,UAAI,OAAO,OACT;AAEF,gBAAU;IACX;AAED,QAAI,CAAC9U,GAAE,IAAI,OAAA,GAAU;AACnB,MAAAA,GAAE,IAAI,OAAA;AACN,YAAM;AAEN,YAAM,YAAY,mBAAmByN,OAAM,OAAA,EAAS,OAClD,CAAC,SAAS;AACR,YAAI,KAAM,CAAA,MAAQ,OAAW,QAAO;AACpC,eAAO,CAACzN,GAAE,IAAI,KAAM,CAAA,CAAA;MACrB,CAAA;AAGH,UAAI,UAAU,WAAW,GAEvB;YAAI,YAAY,OACd,aAAY,UAAU,OAAO,CAAC,OAAOmS,YAAW,IAAI,OAAA,CAAQ;MAC7D,MAED,YAAWvH,MAAK,WAAW;AACzB,YAAIA,OAAM,OAAW;AACrB,YAAIA,GAAG,CAAA,MAAQ,OAAW;AAC1B,kBAAU,KAAKA,EAAA;MAChB;IAEJ;AAGD,gBAAY,UAAU,OAAO,CAAC,SAAS,CAAC5K,GAAE,IAAI,KAAM,CAAA,CAAA,CAAI;AAExD,QAAI,UAAU,WAAW,EACvB,WAAU;SACL;AAEL,YAAM,YAAY,MAAM,OAAO,SAAA;AAC/B,UAAI,cAAc,QAAW;AAC3B,kBAAU,KAAK,UAAW,CAAA,CAAA;AAC1B,kBAAU,UAAW,CAAA;MACtB;IACF;EACF;AACF;ACxFD,IAAa+U,WAAU,CACrBxH,OACAyH,eACAhE,QAAkB;EAAE,GAAG;EAAG,GAAG;AAAG,GAChC,aAAa,MACV;AACH,EAAAlD,WAAUL,OAAM,MAAM;AACtB,EAAAG,WAAU,OAAO,OAAO;AACxB,cAAY,YAAY,YAAY,IAAI,YAAY,CAAC;AAGrD,QAAMqH,QAAoB,CAAE;AAC5B,MAAIC,SAAQ;AACZ,MAAI,WAAW;AACf,aAAWxZ,MAAK,cAAc+R,OAAM;IAAE;IAAO,YAAY;EAAa,CAAA,GAAG;AACvE,IAAAyH;AACA,QAAKA,SAAQ,eAAgB,EAAG;AAChC,UAAM,KAAKxZ,EAAA;EACZ;AAED,SAAO,CAAC2G,MAAc,YAAY,UAAU;AAC1C,gBAAY,YAAY,MAAM,IAAI,MAAM,CAAC;AACzC,QAAI,UAAW,YAAW;QACrB,aAAY;AAEjB,WAAO,MAAM,GAAG,WAAW,MAAM,MAAA;EAElC;AACF;;;;;;;;;;;;;;;ACfD,IAAa0N,UAAS,CAACoF,MAAoBpB,OAAiC,CAAE,MAAK;AACjF,UAAQ,MAAR;IACE,KAAK;AACH,aAAOqB,WAAUjB,uBAAA,GAAyB,IAAA;IAC5C,KAAK;AACH,aAAOiB,WAAUnB,aAAA,GAAe,IAAA;IAClC,KAAK;AACH,aAAOmB,WAAUpB,YAAA,GAAc,IAAA;IACjC,KAAK;AACH,aAAOoB,WAAUzB,cAAA,GAAgB,IAAA;IACnC,KAAK;AACH,aAAOyB,WAAUxB,iBAAA,GAAmB,IAAA;IACtC,KAAK;AACH,aAAOwB,WAAUhB,UAAS,IAAA,GAAO,IAAA;IACnC,KAAK;AACH,aAAOgB,WAAUtB,aAAY,IAAA,GAAO,IAAA;IACtC;AACE,YAAM,IAAI,UAAU,gCAAiC,IAAA,EAAO;EAC/D;AACF;AAED,IAAasB,aAAY,CAACb,OAAoCc,UAAoC,CAAE,MAAK;AACvG,SAAO,CAAC9H,OAAY+H,kBAA4C,CAAE,MAAK;AACrE,WAAOhB,mBAAkB,OAAO7G,OAAM;MAAE,GAAG;MAAS,GAAG;IAAiB,CAAA;EACzE;AACF;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AEKD,SAAgB8H,iBACdC,IACAC,IACAha,IACAyJ,IACO;AACP,MAAI1K,SAAQa,EAAA,GAAI;AACd,QAAI,OAAOD,OAAM,YAAYM,OAAM,OACjC,aACE,WAAWN,IAAG,YAAY,OAAO,GACjC,WAAWM,IAAG,YAAY,QAAQ,CAAC;SAEhC;AACL,UAAI,CAACyL,QAAO/L,EAAA,EACV,OAAM,IAAI,MAAM,wCAAwC;AAE1D,MAAAM,KAAIN,GAAE;AACN,MAAAA,KAAIA,GAAE;IACP;AACD,WAAO,OAAO,OAAO;MACnB,GAAGC,GAAE,IAAID;MACT,GAAGC,GAAE,IAAIK;IACV,CAAA;EACF,OAAM;AACL,gBAAY,WAAWL,IAAG,YAAY,GAAG,CAAC;AAC1C,QAAI,OAAOD,OAAM,SACf,OAAM,IAAI,UAAU,mDAAmD;AAEzE,QAAI,OAAOM,OAAM,SACf,OAAM,IAAI,UAAU,mDAAmD;AAGzE,gBAAY,WAAWN,IAAG,YAAY,GAAG,CAAC;AAC1C,gBAAY,WAAWM,IAAG,YAAY,OAAO,CAAC;AAC9C,QAAImE,OAAM,OAAW,OAAM,IAAI,MAAM,2BAA2B;AAChE,gBAAY,WAAWA,IAAG,YAAY,QAAQ,CAAC;AAC/C,WAAO,OAAO,OAAO;MACnB,GAAGxE,KAAIK;MACP,GAAGN,KAAIyE;IACR,CAAA;EACF;AACF;AC1FD,IAAa6K,WAAU,CAACgL,OAA8BvW,YAAwB;AAE5E,QAAMyL,KAAI,CAAC7I,YAAsB;AAC/B,UAAM,EAAE,GAAA1G,IAAG,GAAAD,GAAA,IAAM4G;AACjB,UAAM2T,QAAO;MAAE,GAAGva,GAAE,IAAIC,GAAE;MAAG,GAAGD,GAAE,IAAIC,GAAE;IAAG;AAC3C,UAAM,OAAO;MAAE,GAAGgE,QAAM,IAAIhE,GAAE;MAAG,GAAGgE,QAAM,IAAIhE,GAAE;IAAG;AACnD,UAAM6I,WAASyR,MAAK,IAAIA,MAAK,IAAIA,MAAK,IAAIA,MAAK;AAG/C,QAAIC,OAAM,KAAK,IAAID,MAAK,IAAI,KAAK,IAAIA,MAAK;AAC1C,UAAMxM,KAAI,KAAK,IAAI,GAAG,KAAK,IAAI,GAAGyM,OAAM1R,QAAAA,CAAO;AAC/C,IAAA0R,QAAOxa,GAAE,IAAIC,GAAE,MAAMgE,QAAM,IAAIhE,GAAE,MAAMD,GAAE,IAAIC,GAAE,MAAMgE,QAAM,IAAIhE,GAAE;AACjE,WAAO;MAAE,GAAGA,GAAE,IAAIsa,MAAK,IAAIxM;MAAG,GAAG9N,GAAE,IAAIsa,MAAK,IAAIxM;IAAG;EACpD;AAED,MAAI,MAAM,QAAQnH,KAAA,GAAO;AACvB,UAAM,MAAMA,MAAK,IAAI,CAAA6I,OAAKD,GAAEC,EAAA,CAAE;AAC9B,UAAM,QAAQ,IAAI,IAAI,CAAA7Q,OAAKsQ,UAAetQ,IAAGqF,OAAAA,CAAM;AACnD,WAAO,OAAO,OAAc,IAAK,SAAS,GAAG,KAAA,CAAM,CAAA;EACpD,MACC,QAAO,OAAO,OAAcuL,GAAE5I,KAAA,CAAa;AAE9C;ACtBD,IAAa6T,sBAAqB,CAAC9T,OAAY5C,YAAyB;AACtEhF,EAAAA,SAAM6H,OAAM,MAAM;AAClBvC,EAAAA,SAAWJ,SAAO,OAAO;AAEzB,MAAI6E,QAAOlC,KAAA,MAAU,EAEnB,QAAOkC,QAAOlC,MAAK,GAAG3C,OAAAA;AAGxB,QAAM,OAAOqL,SAAQ1I,OAAM3C,OAAAA;AAC3B,SAAO6E,QAAO,MAAM7E,OAAAA;AACrB;ACtBD,IAAMyW,mBAAkB,CAAC/T,WAAuB;EAC9C,GAAGC,MAAK,EAAE,IAAIA,MAAK,EAAE;EACrB,GAAGA,MAAK,EAAE,IAAIA,MAAK,EAAE;AACtB;AAID,IAAM+T,6BAA4B,CAAChU,UAAsB;AACvD,QAAM8I,KAAI3G,QAAOlC,KAAA;AACjB,QAAMhC,KAAI8V,iBAAgB9T,KAAA;AAC1B,SAAO;IACL,GAAGhC,GAAE,IAAI6K;IACT,GAAG7K,GAAE,IAAI6K;EACV;AACF;AAWD,IAAamL,YAAW,CAACjU,OAAYxC,eAA2B;AAC9D,QAAM,KAAKuW,iBAAgB9T,KAAA;AAC3B,QAAM,MAAM+T,2BAA0B/T,KAAA;AACtC,QAAM3G,KAAI;IACR,GAAG2G,MAAK,EAAE,IAAI,IAAI,IAAIrG;IACtB,GAAGqG,MAAK,EAAE,IAAI,IAAI,IAAIrG;EACvB;AACD,SAAO;IACL,GAAAN;IACA,GAAG;MACD,GAAGA,GAAE,IAAI,GAAG;MACZ,GAAGA,GAAE,IAAI,GAAG;IACb;EACF;AACF;AAaD,IAAa4a,sBAAqB,CAAClU,OAAYxC,YAAkB,SAAS,MAAM;AAC9E,QAAM,SAAS0E,eAAY,QAAQjC,KAAA;AACnC,QAAM,MAAM+T,2BAA0B/T,KAAA;AACtC,SAAO;IACL,GAAG,OAAO,IAAI,IAAI,IAAIrG;IACtB,GAAG,OAAO,IAAI,IAAI,IAAIA;EACvB;AACF;ACtDD,IAAaoB,UAAO,CAACgF,UAA+BmU,QAAWlU,MAAK,GAAGA,MAAK,CAAA;ACgB5E,SAAgBzB,UACdzF,IAA8BC,KAA+BC,KAAcC,KAAcC,KAAcC,KACtF;AACjB,QAAM,CAAE,KAAK,GAAA,IAAQN,uBAAsB,IAAW,KAAY,KAAY,KAAY,KAAY,GAAA;AACtGV,EAAAA,SAAM,KAAK,GAAG;AACdA,EAAAA,SAAM,KAAK,GAAG;AACd,MAAI,IAAI,MAAM,EAAG,OAAM,IAAI,UAAU,kCAAA;AACrC,MAAI,IAAI,MAAM,EAAG,OAAM,IAAI,UAAU,kCAAA;AAErC,QAAMiE,MAAuB;IAC3B,GAAG,IAAI,IAAI,IAAI;IACf,GAAG,IAAI,IAAI,IAAI;EAChB;AACD,MAAIrE,WAAU,GAAA,KAAQA,WAAU,GAAA,GAAM;AACpC,QAAI,IAAI,MAAM,EAAG,OAAM,IAAI,UAAU,kCAAA;AAErC,IAAAQ,IAAG,KAAK,IAAI,KAAK,MAAM,IAAI,KAAK;EACjC;AACD,SAAO,OAAO,OAAOA,GAAA;AACtB;AA+BD,SAAgB4b,SAAQC,IAAwCC,IAAY5a,IAAY;AACtF,QAAM,UAAUH,mBAAkBD,IAAGD,IAAGM,EAAA;AACxC,EAAArB,mBAAkB,SAAS,SAAS;AAEpC,SAAO,CACLic,KACAC,IACAC,OACU;AACV,UAAM,WAAWlb,mBAAkBmb,KAAI,IAAI,EAAA;AAE3C,WAAO,OAAO,SAAS,MAAM,cAAc,OAAO,OAAO;MACvD,GAAG,SAAS,IAAI,QAAQ;MACxB,GAAG,SAAS,IAAI,QAAQ;IACzB,CAAA,IAAI,OAAO,OAAO;MACjB,GAAG,SAAS,IAAI,QAAQ;MACxB,GAAG,SAAS,IAAI,QAAQ;MACxB,GAAG,SAAS,KAAK,QAAQ,KAAK;IAC/B,CAAA;EACF;AACF;AC/ED,IAAalW,YAAS,CAACwB,OAAY5C,YAAuB,OAAO,OAAO;EACtE,GAAG6C;EACH,GAAG0U,UAAY1U,MAAK,GAAG3C,OAAAA;EACvB,GAAGqX,UAAY1U,MAAK,GAAG3C,OAAAA;AACxB,CAAA;ACLD,IAAasX,iBAAc,CAACC,IAAYC,IAAYC,KAAYC,QAAqB;AACnF,MAAI,OAAO,MAAM,EAAA,EAAK,OAAM,IAAI,MAAM,WAAW;AACjD,MAAI,OAAO,MAAMC,GAAA,EAAK,OAAM,IAAI,MAAM,WAAW;AACjD,MAAI,OAAO,MAAM,EAAA,EAAK,OAAM,IAAI,MAAM,WAAW;AACjD,MAAI,OAAO,MAAMC,GAAA,EAAK,OAAM,IAAI,MAAM,WAAW;AAEjD,QAAM5b,KAAI;IAAE,GAAG;IAAI,GAAG;EAAI;AAC1B,QAAMD,KAAI;IAAE,GAAG4b;IAAI,GAAGC;EAAI;AAC1B,SAAO3U,cAAWjH,IAAGD,EAAA;AACtB;ACVD,IAAa8b,mBAAgB,CAACC,WAAmC;AAC/D,MAAI,CAAC,MAAM,QAAQ7I,MAAA,EAAQ,OAAM,IAAI,MAAM,+BAA+B;AAC1E,MAAIA,OAAM,WAAW,EAAG,OAAM,IAAI,MAAM,uCAAuC;AAC/E,SAAOqI,eAAYrI,OAAO,CAAA,GAAKA,OAAO,CAAA,GAAKA,OAAO,CAAA,GAAKA,OAAO,CAAA,CAAA;AAC/D;ACOD,IAAa8I,aAAY,CAAChY,SAAgB;EAAE,GAAG;EAAK,GAAG;AAAK,GAAEiY,WAAiB,GAAG9T,gBAAsB,GAAG+T,UAAkB,QAAQ;AACnI,QAAM,OAAOpT,WAAS;AACtB,QAAM,QAAQA,YAAU,IAAI;AAC5B,QAAM7I,KAAAsD,aAAsB,MAAM4Y,cAAa7W,aAAAA,GAAc,MAAA;AAC7D,QAAMtF,KAAAuD,aAAsB,OAAO+B,eAAa,MAAA;AAChD,SAAO,OAAO,OAAO;IACnB,GAAArF;IAAG,GAAAD;EACJ,CAAA;AACF;ACnBD,IAAaoc,YAAW,CAACxR,SAAuBE,WAA0B;AACxE,QAAM,CAAE7K,IAAGD,EAAA,IAAME,qBAAkB,SAAS,MAAA;AAC5C,SAAO2I,eAAY,KAAK5I,IAAGD,EAAA;AAC5B;ACRD,IAAaqc,sBAAmB,CAAC1V,OAAYZ,QAAsB;AACjE,QAAM,YAAYmJ,UAAetI,MAAK,GAAGzH,GAAA;AACzC,QAAMsV,SAAQ3L,QAAOlC,KAAA;AACrB,SAAO,YAAY6N;AACpB;ACGD,IAAa1J,SAAM,CAACpE,OAAY5C,YAAuB,OAAO,OAAO;EACnE,GAAG6C;EACH,GAAG4J,OAAU5J,MAAK,GAAG3C,OAAAA;EACrB,GAAGuM,OAAU5J,MAAK,GAAG3C,OAAAA;AACtB,CAAA;ACLD,SAAgBqY,KAAIvW,KAAkB;AACpC,MAAIpH,WAAUQ,GAAA,EACZ,QAAO,OAAO,OAAO;IACnB,GAAGA;IACH,GAAG,KAAK,IAAIA,IAAG,CAAA;IACf,GAAG,KAAK,IAAIA,IAAG,CAAA;IACf,GAAG,KAAK,IAAIA,IAAG,CAAA;EAChB,CAAA;WACQC,SAAQD,GAAA,EACjB,QAAO,OAAO,OAAO;IACnB,GAAGA;IACH,GAAG,KAAK,IAAIA,IAAG,CAAA;IACf,GAAG,KAAK,IAAIA,IAAG,CAAA;EAChB,CAAA;MACI,OAAM,IAAI,UAAU,2BAA2B;AACvD;ACED,SAAgBod,SACdxW,KACAyW,KACO;AACPzd,EAAAA,SAAMI,KAAI,IAAI;AACd,MAAIR,WAAUQ,GAAA,EACZ,QAAO,OAAO,OAAgB;IAC5B,GAAGA;IACH,GAAGkU,IAAGlU,IAAG,GAAG,GAAG;IACf,GAAGkU,IAAGlU,IAAG,GAAG,GAAG;IACf,GAAIkU,IAAsBlU,IAAG,GAAG,GAAG;EACpC,CAAA;AAEH,SAAO,OAAO,OAAc;IAC1B,GAAGA;IACH,GAAGkU,IAAGlU,IAAG,GAAG,GAAG;IACf,GAAGkU,IAAGlU,IAAG,GAAG,GAAG;EAChB,CAAA;AACF;ACrBD,SAAgBsd,UAASC,MAAyBC,OAAqC,CAAE,GAAiB;AACxG,MAAIC;AACJ,MAAIC;AACJ,MAAIC;AACJ,UAAQ,MAAR;IACE,KAAK,wBACH;AACE,YAAM,UAAU,KAAK,WAAW;AAChC,MAAA1W,KAAI2W,mBAAI,OAAA;AACR,MAAAnc,KAAImc,mBAAI,OAAA;AACR,MAAAlc,KAAIkc,mBAAI,OAAA;AACR;IACD;IACH;AACE,YAAM,IAAI,MAAM,2BAA4B,IAAA,qCAA0C;EACzF;AAED,SAAO,CAAChZ,YAAiB;AACvB,UAAM,KAAKqC,GAAEnC,QAAM,CAAA;AACnB,UAAM,KAAKrD,GAAEqD,QAAM,CAAA;AACnB,QAAItF,WAAUsF,OAAAA,GAAQ;AACpB,YAAM,KAAKpD,GAAEoD,QAAM,CAAA;AACnB,aAAO,OAAO,OAAO;QACnB,GAAG;QACH,GAAG;QACH,GAAG;MACJ,CAAA;IACF,MACC,QAAO,OAAO,OAAO;MACnB,GAAG;MACH,GAAG;IACJ,CAAA;EAEJ;AACF;AC/CD,IAAaqM,cAAW,IAAI,WAAkD;AAC5E,MAAI,CAAC,MAAM,QAAQ,MAAA,EAAS,OAAM,IAAI,MAAM,yBAAyB;AAErE,QAAMvF,QAAM,OAAO,OACjB,CAAC,UAAUnM,OAAM;AACf,QAAIA,OAAM,OAAW,QAAO;AAC5B,QAAI,MAAM,QAAQA,EAAA,EAChB,OAAM,IAAI,UACR,uEAAuE;AAG3E,QAAI,CAACQ,SAAQR,EAAA,EACX,OAAM,IAAI,MACR,qDAAsD,KAAK,UACzDA,EAAA,CACD,EAAG;AAGR,WAAO;MACL,GAAG,SAAS,IAAIA,GAAE;MAClB,GAAG,SAAS,IAAIA,GAAE;IACnB;EACF,GACD;IAAE,GAAG;IAAG,GAAG;EAAG,CAAA;AAGhB,SAAO,OAAO,OAAO;IACnB,GAAGmM,MAAI,IAAI,OAAO;IAClB,GAAGA,MAAI,IAAI,OAAO;EACnB,CAAA;AACF;AClCD,SAAgBiS,SACdjc,IACAI,OAAM,GACN4D,OAAM,GACC;AAEP,MAAIpG,WAAUsB,EAAA,EACZ,QAAO,OAAO,OAAO;IACnB,GAAGgd,MAAYhd,GAAE,GAAGkB,MAAK4D,IAAA;IACzB,GAAGkY,MAAYhd,GAAE,GAAGkB,MAAK4D,IAAA;IACzB,GAAGkY,MAAYhd,GAAE,GAAGkB,MAAK4D,IAAA;EAC1B,CAAA;MAED,QAAO,OAAO,OAAO;IACnB,GAAGkY,MAAYhd,GAAE,GAAGkB,MAAK4D,IAAA;IACzB,GAAGkY,MAAYhd,GAAE,GAAGkB,MAAK4D,IAAA;EAC1B,CAAA;AAEJ;ACjBD,IAAamY,WAAU,CAACnc,IAAU4E,OAAqB;AACrD,MAAI1F,GAAE,IAAID,GAAE,KAAKC,GAAE,IAAID,GAAE,EAAG,QAAO;AACnC,MAAIC,GAAE,IAAID,GAAE,KAAKC,GAAE,IAAID,GAAE,EAAG,QAAO;AACnC,MAAIC,GAAE,IAAID,GAAE,KAAKC,GAAE,IAAID,GAAE,EAAG,QAAO;AACnC,MAAIC,GAAE,IAAID,GAAE,KAAKC,GAAE,IAAID,GAAE,EAAG,QAAO;AACnC,MAAIC,GAAE,MAAMD,GAAE,KAAKC,GAAE,MAAMD,GAAE,EAAG,QAAO;AACvC,SAAO;AACR;AAmBD,IAAamd,cAAa,CAACpc,IAAU4E,OAAqB;AACxD,MAAI1F,GAAE,MAAMD,GAAE,EAAG,QAAO;AACxB,MAAIC,GAAE,IAAID,GAAE,EAAG,QAAO;AACtB,SAAO;AAGR;AAkBD,IAAaod,cAAa,CAACrc,IAAU4E,OAAqB;AACxD,MAAI1F,GAAE,MAAMD,GAAE,EAAG,QAAO;AACxB,MAAIC,GAAE,IAAID,GAAE,EAAG,QAAO;AACtB,SAAO;AACR;AAkBD,IAAaqd,cAAa,CAACvb,IAAYC,OAAuB;AAC5D,MAAI9B,GAAE,MAAMD,GAAE,EAAG,QAAO;AACxB,MAAIC,GAAE,IAAID,GAAE,EAAG,QAAO;AACtB,SAAO;AACR;AC9ED,IAAasd,cAAa,IAAI,QAAoD;AAChF,QAAM,SAAS,CAAE,GAAG,GAAK,EAAC,KAAKH,WAAA;AAC/B,MAAI,OAAO,WAAW,EAAG,QAAO;AAEhC,QAAM/W,KAAI,CAACmX,WAAyB;AAClC,UAAMC,KAAkB,CAAE;AAC1B,eAAW5e,MAAK,QAAQ;AACtB,aAAOgG,GAAE,UAAU,GAAG;AAEpB,cAAMsI,KAAItI,GAAE,GAAG,EAAA;AAEf,cAAMyK,KAAIzK,GAAE,GAAG,EAAA;AACf,aAAKsI,GAAE,IAAImC,GAAE,MAAMzQ,GAAE,IAAIyQ,GAAE,OAAOnC,GAAE,IAAImC,GAAE,MAAMzQ,GAAE,IAAIyQ,GAAE,GAEtD,CAAAzK,GAAE,IAAA;YACG;MACR;AAED,MAAAA,GAAE,KAAKhG,EAAA;IACR;AAED,IAAAgG,GAAE,IAAA;AACF,WAAOA;EACR;AAED,QAAM,QAAQwB,GAAE,MAAA;AAEhB,QAAM,QAAQA,GAAE,OAAO,QAAA,CAAS;AAEhC,MAAI,MAAM,WAAW,KAAK,MAAM,WAAW,KAAKkE,SAAQ,MAAO,CAAA,GAAK,MAAO,CAAA,CAAA,EACzE,QAAO;AAET,SAAO,CAAE,GAAG,OAAO,GAAG,KAAO;AAC9B;ACKD,SAAgBmT,iBACd9R,OACAyO,IACAa,IACS;AACTlc,EAAAA,SAAMyM,OAAM,MAAM;AAClB,MAAIpF,KAAI;AACR,MAAIxF,KAAI;AACR,MAAI,OAAOX,OAAM,UAAU;AACzB,QAAID,OAAM,OAAW,OAAM,IAAI,MAAM,2BAA2B;AAChE,IAAAoG,KAAInG;AACJ,IAAAW,KAAIZ;EACL,OAAM;AACL,IAAAoG,KAAInG,GAAE;AACN,IAAAW,KAAIX,GAAE;EACP;AACD,MAAImH,cAAaoE,KAAA,GAAO;AACtB,QAAIpF,KAAIoF,MAAK,IAAIA,MAAK,SAASpF,KAAIoF,MAAK,EAAG,QAAO;AAClD,QAAI5K,KAAI4K,MAAK,IAAIA,MAAK,UAAU5K,KAAI4K,MAAK,EAAG,QAAO;EACpD,OAAM;AAEL,QAAIpF,KAAIoF,MAAK,SAASpF,KAAI,EAAG,QAAO;AACpC,QAAIxF,KAAI4K,MAAK,UAAU5K,KAAI,EAAG,QAAO;EACtC;AACD,SAAO;AACR;AAOD,IAAakQ,oBAAiB,CAC5B4M,IAEA3O,OACY;AACZ,MAAI,CAAC9C,kBAAiBhM,EAAA,EACpB,OAAM,IAAI,MAAM,sCAAsC;AAGxD,MAAIoO,oBAAmBrO,EAAA,EACrB,QAAAyQ,YAA6BzQ,IAAGC,EAAA;WACvBb,SAAQY,EAAA,EACjB,QAAOyd,iBAAgBxd,IAAGD,EAAA;AAE5B,QAAM,IAAI,MAAM,wBAAyB,KAAK,UAAUA,EAAA,CAAE,EAAG;AAC9D;AChFD,IAAa6O,YAAS,CACpB8O,OACArX,WACU;AACVvH,EAAAA,SAAMyM,KAAA;AACN,MAAI,WAAW,UAAapM,SAAQoM,KAAA,EAAO,UAASA;WAC3C,WAAW,OAAW,UAAS;IAAE,GAAG;IAAG,GAAG;EAAG;AAEtD,QAAM6D,KAAI3D,mBAAkBF,OAAM,MAAA;AAClC,SAAO,OAAO,OAAO;IACnB,GAAG,OAAO,IAAIA,MAAK,QAAQ;IAC3B,GAAG,OAAO,IAAIA,MAAK,SAAS;EAC7B,CAAA;AACF;ACRD,IAAawD,wBAAuB,CAClCnD,OACA9F,QACW;AACX,EAAA6F,iBAAgBJ,OAAM,MAAM;AAC5BC,EAAAA,SAAYtM,KAAI,IAAI;AACpB,MAAIse,iBAAgBjS,OAAMrM,GAAA,EAAK,QAAO;AACtC,QAAM,KAAK,KAAK,IAAIqM,MAAK,IAAIrM,IAAG,GAAG,GAAGA,IAAG,IAAIqM,MAAK,IAAIA,MAAK,KAAA;AAC3D,QAAM,KAAK,KAAK,IAAIA,MAAK,IAAIrM,IAAG,GAAG,GAAGA,IAAG,IAAIqM,MAAK,IAAIA,MAAK,MAAA;AAC3D,SAAO,KAAK,MAAM,IAAI,EAAA;AACvB;AAaD,IAAaoS,sBAAqB,CAChC/R,OACA9F,QACWmJ,UAAeL,UAAOrD,KAAA,GAAOrM,GAAA;ACjC1C,IAAa0e,oBAAmB,CAC9B9c,IACA+c,UACW;AACX,MAAI7R,kBAAiB,KAAA,EACnB,QAAO8R,sBAAyB,OAAO9d,EAAA;AAEzC,MAAIoO,oBAAmB,KAAA,EACrB,QAAO2P,wBAA2B,OAAO/d,EAAA;AAE3C,MAAIb,SAAQ,KAAA,EAAQ,QAAOmB,UAASN,IAAG,KAAA;AACvC,QAAM,IAAI,MAAM,eAAe;AAChC;ACID,IAAage,sBAAqB,CAChCld,IACA+c,UACW;AACX,MAAI7R,kBAAiB,KAAA,EACnB,QAAO8R,sBAAyB,OAAO9d,EAAA;AAEzC,MAAIoO,oBAAmB,KAAA,EACrB,QAAO2P,wBAA2B,OAAO/d,EAAA;AAE3C,MAAIb,SAAQ,KAAA,EAAQ,QAAOmB,UAASN,IAAG,KAAA;AACvC,QAAM,IAAI,MAAM,eAAe;AAChC;AC9BD,IAAaie,aAAU,CAACxf,OAAoC,CAAEE,GAAE,GAAGA,GAAE,CAAG;ACTxE,IAAaoG,gBAAa,IAAI,QAAkC;AAC9D,QAAM/E,KAAI,IAAI,IAAI,CAAArB,OAAKsf,WAAQtf,EAAA,CAAE;AACjC,SAAOuf,WAAiBle,EAAA;AACzB;ACcD,SAAgBme,MACdC,UACA3d,IACAC,IACO;AACP,MAAI,MAAM,QAAQ,QAAA,EAChB,KAAI,SAAS,WAAW,EACtB,QAAO,OAAO,OAAO;IACnB,GAAG,SAAU,CAAA;IACb,GAAG,SAAU,CAAA;IACb,GAAG,SAAU,CAAA;EACd,CAAA;WACQ,SAAS,WAAW,EAC7B,QAAO,OAAO,OAAO;IACnB,GAAG,SAAU,CAAA;IACb,GAAG,SAAU,CAAA;EACd,CAAA;MAED,OAAM,IAAI,MAAM,8CAA+C,SAAS,MAAA,EAAS;OAE9E;AACL,QAAI,aAAa,OAAW,OAAM,IAAI,MAAM,uDAAuD;aAC1F,OAAO,MAAM,QAAA,EAAW,OAAM,IAAI,MAAM,UAAU;AAC3D,QAAIC,OAAM,OAAW,OAAM,IAAI,MAAM,sBAAsB;aAClD,OAAO,MAAMA,EAAA,EAAI,OAAM,IAAI,MAAM,UAAU;AACpD,QAAIC,OAAM,OACR,QAAO,OAAO,OAAO;MAAE,GAAG;MAAuB,GAAAD;IAAG,CAAA;QAEpD,QAAO,OAAO,OAAO;MAAE,GAAG;MAAoB,GAAAA;MAAG,GAAAC;IAAG,CAAA;EAEvD;AACF;AAgBD,IAAayd,cAAa,CAACC,YAA2B;AACpD,MAAI,OAAO,YAAY,SAAU,OAAM,IAAI,UAAU,0CAA2C,OAAO,OAAA,EAAU;AACjH,QAAM,QAAQ,QAAQ,QAAQ,GAAG;AACjC,QAAMnY,KAAI,OAAO,WAAW,QAAQ,UAAU,GAAG,KAAA,CAAM;AACvD,QAAM,YAAY,QAAQ,QAAQ,KAAK,QAAQ,CAAA;AAC/C,MAAI,YAAY,GAAG;AAEjB,UAAMxF,KAAI,OAAO,WAAW,QAAQ,UAAU,QAAQ,GAAG,YAAY,QAAQ,CAAA,CAAE;AAC/E,UAAMC,KAAI,OAAO,WAAW,QAAQ,UAAU,YAAY,CAAA,CAAE;AAC5D,WAAO;MAAE,GAAAuF;MAAG,GAAAxF;MAAG,GAAAC;IAAG;EACnB,OAAM;AACL,UAAMD,KAAI,OAAO,WAAW,QAAQ,UAAU,QAAQ,CAAA,CAAE;AACxD,WAAO;MAAE,GAAAwF;MAAG,GAAAxF;IAAG;EAChB;AACF;AAkBD,IAAa2a,eAAc,IACtB,WACkB;AACrB,QAAMiD,MAAe,CAAE;AAEvB,MAAI,MAAM,QAAQ,OAAQ,CAAA,CAAA,EAExB,YAAW,SAAU,QAAuB;AAC1C,QAAI,EAAE,MAAM,SAAS,MAAM,GACzB,OAAM,IAAI,MAAM,sCAAsC;AAExD,QAAI,KAAK,OAAO,OAAO;MAAE,GAAG,MAAO,CAAA;MAAK,GAAG,MAAO,CAAA;IAAK,CAAA,CAAC;EACzD;OACI;AAEL,QAAI,OAAO,SAAS,MAAM,EACxB,OAAM,IAAI,MAAM,gDAAgD;AAGlE,aAAS,QAAQ,GAAG,QAAQ,OAAO,QAAQ,SAAS,EAClD,KAAI,KACF,OAAO,OAAO;MAAE,GAAG,OAAQ,KAAA;MAAmB,GAAG,OAAQ,QAAQ,CAAA;IAAe,CAAA,CAAC;EAGtF;AACD,SAAO;AACR;AC5GD,IAAa3V,iBAAc,CACzBR,QACAtH,IACA4E,IACA,gBAAgB,UACN8Y,eAAgB,QAAQxe,IAAGD,IAAG,aAAA;ACV1C,IAAasC,UAAS,CACpBpD,KACAwf,OAAiC,WACvB;AACV,UAAQ,MAAR;IACE,KAAK;AACH,aAAO/f,WAAUQ,GAAA,IAAM,OAAO,OAAO;QACnC,GAAGA;QACH,GAAGA,IAAG,IAAI;QACV,GAAGA,IAAG,IAAI;QACV,GAAGA,IAAG,IAAI;MACX,CAAA,IAAI,OAAO,OAAO;QACjB,GAAGA;QACH,GAAGA,IAAG,IAAI;QACV,GAAGA,IAAG,IAAI;MACX,CAAA;IAEH,KAAK;AACH,aAAO,OAAO,OAAO;QACnB,GAAGA;QACH,GAAGA,IAAG,IAAI;MACX,CAAA;IAEH,KAAK;AACH,aAAO,OAAO,OAAO;QACnB,GAAGA;QACH,GAAGA,IAAG,IAAI;MACX,CAAA;IAEH,KAAK;AACH,UAAIR,WAAUQ,GAAA,EACZ,QAAO,OAAO,OAAO;QACnB,GAAGA;QACH,GAAGA,IAAG,IAAI;MACX,CAAA;UACI,OAAM,IAAI,MAAM,2BAA2B;IAEpD;AACE,YAAM,IAAI,MAAM,sDAAsD;EAEzE;AACF;AC1CD,IAAa2F,kBAAiB,CAACiB,KAAWhB,OAAM,GAAG5D,OAAM,MAAa;AACpE,QAAM2H,WAASvI,UAASpB,GAAA;AACxB,MAAI,QAAQ;AACZ,MAAI2J,WAAS/D,KACX,SAAQA,OAAM+D;WACLA,WAAS3H,KAClB,SAAQA,OAAM2H;AAEhB,SAAO,UAAU,IAAI3J,MAAK8F,YAAS9F,KAAI,OAAO,KAAA;AAC/C;ACJD,IAAawf,YAAW,IAAI,WAC1B1d,aAAY,CAAChB,IAAGD,OAAOC,GAAE,KAAKD,GAAE,IAAIC,KAAID,IAAI,GAAG,MAAA;AAgBjD,IAAa4e,aAAY,IAAI,WAC3B3d,aAAY,CAAChB,IAAGD,OAAOC,GAAE,KAAKD,GAAE,IAAIC,KAAID,IAAI,GAAG,MAAA;AC9BjD,IAAM8I,YAAS,CAAC+V,OAAuBne,OAAuB;AAC5D,MAAItB,SAAQ,KAAA,GAAQ;AAClB,IAAAwB,KAAI,MAAM;AACV,YAAQ,MAAM;EACf;AACD,MAAIA,OAAM,OAAW,OAAM,IAAI,MAAM,YAAY;AACjD,SAAO,KAAK,MAAM,OAAOA,EAAA;AAC1B;AAeD,IAAaiE,aAAY,CAACga,OAAuBne,OAAsB;AACrE,QAAMvB,MAAKe,mBAAkB,OAAOU,EAAA;AACpC,QAAM6O,KAAI3G,UAAO3J,GAAA;AACjB,MAAIsQ,OAAM,EAAG,QAAOxM;AACpB,SAAO,OAAO,OAAO;IACnB,GAAG9D;IACH,GAAGA,IAAG,IAAIsQ;IACV,GAAGtQ,IAAG,IAAIsQ;EACX,CAAA;AACF;ACtBD,IAAaqP,iBAAgB,CAC3B/a,YACG,gBACOgb,UAAS,GAAG,WAAA,EAAa9a,OAAAA;AAiBrC,IAAa8a,YACX,IAAIA,eACF,CAAChZ,QAECgZ,WAAS,OAAO,CAAC,UAAU,YAAY,QAAQ,QAAA,GAAW5f,GAAA;;;;;;;;;;;;;;;;;;;;ACpBhE,IAAM6f,kBAAiB,OAAO,OAAO;EAAE,GAAG;EAAG,GAAG;AAAG,CAAA;AAEnD,IAAMvZ,UAAO,KAAK,KAAK;AACvB,IAAMwZ,QAAK,KAAK;AAOhB,IAAaC,eAAc,CAACC,YAAoB;AAC9C,SAAO,OAAO,OAAO;IACnB,GAAG,KAAK,IAAI,OAAA;IACZ,GAAG,KAAK,IAAI,OAAA;EACb,CAAA;AACF;AAED,IAAaC,aAAY,CAACrb,YAAiB;AACzC,SAAO,KAAK,MAAME,QAAM,GAAGA,QAAM,CAAA;AAClC;AAWD,IAAaob,kBAAiB,CAC5BtZ,KACAuZ,qBAAkD,IAClDtb,SAAgBgb,oBACA;AAChB,EAAA7f,MAAKkR,YAAelR,KAAI,MAAA;AAExB,MAAI,YAAY,KAAK,MAAMA,IAAG,GAAGA,IAAG,CAAA;AACpC,MAAI,uBAAuB,cAAc,YAAY,EAAG,cAAasG;WAC5D,uBAAuB,WAC9B;QAAI,YAAYwZ,MAAI,cAAaxZ;aACxB,aAAa,CAACwZ,MAAI,cAAaxZ;EAAK;AAG/C,SAAO,OAAO,OAAO;IACnB,UAAUyJ,UAAe/P,GAAA;IACzB,aAAa;EACd,CAAA;AACF;AAOD,IAAaogB,qBAAoB,CAAC5Y,UAChC0J,YAAezJ,MAAK,GAAGA,MAAK,CAAA;AAO9B,IAAa4Y,iBAAgB,CAAC7Y,UAA4B;AACxD8Y,EAAAA,SAAW7Y,OAAM,MAAM;AACvB,QAAMzH,MAAKkR,YAAezJ,MAAK,GAAGA,MAAK,CAAA;AACvC,SAAOyY,gBAAelgB,GAAA;AACvB;AAED,IAAMugB,WAAU,CAACC,OAAgC;AAC/C,MAAA3d,cAAuB4C,EAAA,EAAI,QAAO;AAClC,SAAO;AACR;AAED,IAAMgb,eAAc,CAACD,OAA0B;AAC7C,MAAIvgB,SAAQwF,EAAA,EAAI,QAAO;AACvB,SAAO;AACR;AASD,IAAaC,eAAY,CAAC8a,OAAsB;AAC9C,MAAID,SAAQ9a,EAAA,EACV,QAAAib,aAAuBjb,EAAA;WACdgb,aAAYhb,EAAA,EACrB,QAAOkb,WAAgBlb,EAAA;AAGzB,QAAM,IAAI,MAAM,yCAA0CA,EAAA,EAAI;AAC/D;AAED,IAAamb,uBAAsB,CAACrhB,OAAqB;AACvD,MAAIE,GAAE,KAAK,KAAKA,GAAE,KAAK,EAAG,QAAO;AACjC,MAAIA,GAAE,IAAI,KAAKA,GAAE,KAAK,EAAG,QAAOqgB;AAChC,MAAIrgB,GAAE,IAAI,KAAKA,GAAE,IAAI,EAAG,QAAOqgB;AAC/B,SAAOxZ;AACR;AASD,IAAaua,WAAU,CAACL,IAAW,SAASM,WAA4B;AACtE,MAAIP,SAAQ9a,EAAA,EACV,QAAOA;WACEgb,aAAYhb,EAAA,EACrB,QAAAd,eAA2Bc,IAAG,MAAA;AAGhC,QAAM,IAAI,MAAM,yCAA0CA,EAAA,EAAI;AAC/D;AAQD,IAAarB,iBAAc,CAACoc,OAAqB;AAC/C,MAAID,SAAQ9a,EAAA,EACV,QAAAF,SAAqBE,EAAA;WACZgb,aAAYhb,EAAA,EACrB,QAAOA;AAGT,QAAM,IAAI,MAAM,yCAA0CA,EAAA,EAAI;AAC/D;AAQD,IAAaN,cAAW,CAACqb,IAAWpb,WAAoB;AACtD,MAAImb,SAAQ9a,EAAA,EACV,QAAAsb,YAAsBtb,IAAG,MAAA;WAChBgb,aAAYhb,EAAA,EACrB,QAAOub,YAAevb,IAAG,MAAA;AAG3B,QAAM,IAAI,MAAM,yCAA0CA,EAAA,EAAI;AAC/D;AAQD,IAAaI,gBAAa,CAACob,IAAWC,OAAc;AAClD,MAAIX,SAAQzf,EAAA,KAAMyf,SAAQ1f,EAAA,EACxB,QAAAsgB,cAAwBrgB,IAAGD,EAAA;WAClB4f,aAAY3f,EAAA,KAAM2f,aAAY5f,EAAA,EACvC,QAAOugB,cAAiBtgB,IAAGD,EAAA;AAE7B,QAAM,IAAI,MAAM,uCAAuC;AACxD;AASD,IAAa8E,oBAAiB,CAAC6a,IAAW5a,OAAM,GAAG5D,OAAM,MAAM;AAC7D,MAAIue,SAAQ9a,EAAA,EACV,QAAA4b,kBAA4B5b,IAAGG,MAAK5D,IAAA;WAC3Bye,aAAYhb,EAAA,EACrB,QAAO6b,gBAAqB7b,IAAGG,MAAK5D,IAAA;AAEtC,QAAM,IAAI,MAAM,2CAA2C;AAC5D;AAUD,IAAa4J,SAAM,CAACqV,IAAWC,OAAc;AAC3C,QAAM,QAAQX,SAAQzf,EAAA;AACtB,EAAAA,KAAIsD,eAAYtD,EAAA;AAChB,EAAAD,KAAIuD,eAAYvD,EAAA;AAChB,QAAMM,KAAIkQ,OAAUvQ,IAAGD,EAAA;AACvB,SAAO,QAAQggB,SAAQ1f,EAAA,IAAKA;AAC7B;AASD,IAAayC,cAAW,CAACqd,IAAWC,OAAc;AAChD,QAAM,QAAQX,SAAQzf,EAAA;AACtB,EAAAA,KAAIsD,eAAYtD,EAAA;AAChB,EAAAD,KAAIuD,eAAYvD,EAAA;AAChB,QAAMM,KAAI+P,YAAepQ,IAAGD,EAAA;AAC5B,SAAO,QAAQggB,SAAQ1f,EAAA,IAAKA;AAC7B;AASD,IAAa2E,cAAW,CAACmb,IAAWC,OAAc;AAChD,QAAM,QAAQX,SAAQzf,EAAA;AACtB,EAAAA,KAAIsD,eAAYtD,EAAA;AAChB,EAAAD,KAAIuD,eAAYvD,EAAA;AAChB,QAAMM,KAAIogB,YAAezgB,IAAGD,EAAA;AAC5B,SAAO,QAAQggB,SAAQ1f,EAAA,IAAKA;AAC7B;AASD,IAAa6E,YAAS,CAACib,IAAWC,OAAc;AAC9C,QAAM,QAAQX,SAAQzf,EAAA;AACtB,EAAAA,KAAIsD,eAAYtD,EAAA;AAChB,EAAAD,KAAIuD,eAAYvD,EAAA;AAChB,QAAMM,KAAIgb,UAAYrb,IAAGD,EAAA;AACzB,SAAO,QAAQggB,SAAQ1f,EAAA,IAAKA;AAC7B;ACpPD,IAAaqgB,qBAAoB,IAAI,WAAuC;AAC1E,QAAMC,QAAgB,CAAE;AAExB,MAAI,QAAQ,OAAQ,CAAA;AAEpB,WAAS,QAAQ,GAAG,QAAQ,OAAO,QAAQ,SAAS;AAClD,UAAM,KAAK1Z,cAAW,OAAO,OAAQ,KAAA,CAAA,CAAQ;AAC7C,YAAQ,OAAQ,KAAA;EACjB;AACD,SAAO;AACR;ACkBD,IAAa2Z,YAAW,CAACzG,IAAmBa,OAA8B;AACxE,QAAM,QAAQ/a,mBAAkBD,IAAGD,EAAA;AACnC,MAAI,SAAS;AACb,MAAI,SAAS;AACb,MAAI8Z,SAAQ;AACZ,MAAI,aAAa,YAAY,IAAA;AAC7B,MAAI,YAAY;AAChB,QAAM,SAAS,CAACgH,KAAoB3F,OAAgB;AAClD,UAAMvc,KAAIsB,mBAAkBmb,KAAI,EAAA;AAChC,cAAUzc,GAAE;AACZ,cAAUA,GAAE;AACZ,IAAAkb;AAEA,UAAM,oBAAoBvZ,UAAS3B,IAAG,KAAA;AACtC,UAAM,mBAAmB2B,UAAS3B,IAAG,SAAA;AAGrC,UAAM,MAAM,YAAY,IAAA;AACxB,UAAM,QAAQ,oBAAoB,MAAM;AACxC,iBAAa;AAEb,gBAAYA;AAEZ,WAAO,OAAO,OAAO;MACnB,OAAO0G,aAAY1G,IAAG,KAAA;MACtB;MACA;MACA;MACA,UAAU0R,YAAS1R,IAAG,KAAA;MACtB,SAAS;QACP,GAAG,SAASkb;QACZ,GAAG,SAASA;MACb;IACF,CAAA;EACF;AAED,SAAO;AACR;ACgCD,IAAaiH,gBAAb,cAAgE,cAA2C;EACzG;EACA;EACA;EAEA,YAAYC,OAAkB,CAAE,GAAE;AAChC,UAAM,IAAA;EACP;;;;;;EAOD,UAAUC,SAA2B;AAEnC,SAAK,kBAAkB;EACxB;;;;EAKD,UAAgB;AACd,UAAM,QAAA;AACN,SAAK,aAAa;AAClB,SAAK,kBAAkB;AACvB,SAAK,eAAe;EACrB;;;;;EAQD,OAAO;AACL,SAAK,eAAeJ,UAAS,KAAK,IAAA;EACnC;;;;;;;;;EAUD,eACEK,IACqB;AACrB,UAAM,cAAc,KAAK;AACzB,UAAM,eAAe,KAAK,OAAO,GAAG,EAAA;AAEpC,QAAI,KAAK,oBAAoB,UAAa,KAAK,QAG7C,MAAK,kBAAkBL,UAAS,KAAK,OAAA;aAC5B,KAAK,oBAAoB,OAElC,OAAM,IAAI,MAAM,wDAAwD;AAI1E,UAAM,eAAe,iBAAiB,SAAYA,UAAS,WAAA,IAAeA,UAAS,YAAA;AAGnF,UAAMM,aAAyB,KAAK,gBAAgB,WAAA;AAEpD,UAAMC,UAAmC,KAAK,iBAAiB,SAAa,KAAK,aAAa,WAAA,IAAe;AAE7G,UAAM,QAAQ,iBAAiB,SAAY,IAAIC,QAAW,cAAc,WAAA,KAAgB,YAAY,KAAK,aAAa;AAGtH,UAAMC,UAAsB;MAC1B,GAAG,aAAa,WAAA;MAChB;IACD;AAED,UAAMC,KAAyB;MAC7B,aAAa;MACb,UAAU;MACV,UAAU;MACV,QAAQ,CAAE,GAAG,KAAK,MAAQ;IAC3B;AACD,SAAK,aAAalS;AAClB,WAAOA;EACR;;;;;EAMD,IAAI,OAAiB;AACnB,QAAI,KAAK,OAAO,WAAW,EAAG,QAAO,CAAE;AACvC,WAAOsR,mBAAkB,GAAG,KAAK,MAAA;EAClC;;;;;EAMD,IAAI,cAA0B;AAC5B,WAAAnB,eAA6B,KAAK,YAAA;EACnC;;;;;EAMD,IAAI,kBAAyB;AAC3B,WAAAD,mBAAiC,KAAK,YAAA;EACvC;;;;;;EAOD,IAAI,eAAqB;AACvB,UAAM,UAAU,KAAK;AACrB,QAAI,KAAK,OAAO,SAAS,KAAK,CAAC,QAAS,QAAOiC;AAC/C,WAAO;MACL,GAAG;MACH,GAAG,KAAK;IACT;EACF;;;;;;;;;EAUD,oBAA4B;AAC1B,UAAM,UAAU,KAAK;AACrB,WAAO,KAAK,OAAO,UAAU,KAAK,YAAY,SAAYjhB,UAAS,SAAS,KAAK,IAAA,IAAQ;EAC1F;;;;;;;EAQD,iBAAyB;AACvB,UAAMkE,KAAI,KAAK;AACf,UAAMsJ,KAAI,KAAK;AACf,QAAI,OAAO,MAAMA,EAAA,EAAI,QAAO;AAC5B,QAAItJ,OAAM,EAAG,QAAO;AACpB,WAAO,KAAK,IAAIA,EAAA,IAAKsJ;EACtB;;;;;;;EAQD,aAA8B;AAC5B,UAAM,UAAU,KAAK;AACrB,WAAO,KAAK,OAAO,UAAU,KAAK,YAAY,SAAYhL,YAAS,KAAK,MAAM,OAAA,IAAW0e;EAC1F;;;;;;EAOD,iBAAqC;AACnC,UAAM,UAAU,KAAK;AACrB,QAAI,YAAY,UAAa,KAAK,OAAO,SAAS,EAChD,QAAOnc,aAAY,SAAS,KAAK,IAAA;EAEpC;;;;;EAMD,IAAI,SAAiB;AACnB,QAAI,KAAK,OAAO,WAAW,EAAG,QAAO;AACrC,UAAMmK,KAAI,KAAK;AACf,WAAO4R,QAAW5R,EAAA;EACnB;;;;EAKD,IAAI,IAAI;AACN,WAAO,KAAK,KAAK;EAClB;;;;EAKD,IAAI,IAAI;AACN,WAAO,KAAK,KAAK;EAClB;;;;EAKD,IAAI,IAAI;AACN,WAAO,KAAK,KAAK;EAClB;AACF;AAMD,IAAaiS,iBAAb,cAAiE,gBAI/D;EAEA,YAAYV,OAAkB,CAAE,GAAE;AAChC,UAAM,CAAC,KAAK,UAAU;AACpB,UAAI,UAAU,OAAW,OAAM,IAAI,MAAM,sBAAsB;AAC/D,YAAMpiB,KAAI,IAAImiB,cAAqB;QACjC,GAAG;QACH,IAAI;MACL,CAAA;AACD,MAAAniB,GAAE,KAAK,KAAA;AACP,aAAOA;IACR,CAAA;EACF;EAED,IAAI+iB,IAAY;AACd,UAAM/c,KAAI,MAAM,IAAI,EAAA;AACpB,WAAOA;EACR;AACF;AAED,IAAagd,sBAAb,cAAwCb,cAAa;;;;;;;EAOnD,UAAUc,IAAmD;AAC3D,QAAI,wBAAwBjjB,IAAG;AAC7B,YAAM,SAASA,GAAE,mBAAA;AACjB,YAAMkjB,aAAW,OAAO,IAAI,CAAAC,YAAU;QAAE,GAAGA,OAAM;QAAS,GAAGA,OAAM;MAAS,EAAA;AAC5E,aAAO,KAAK,KAAK,GAAGD,UAAAA;IACrB,MACC,QAAO,KAAK,KAAK;MAAE,GAAIljB,GAAG;MAAS,GAAIA,GAAG;IAAS,CAAA;EAEtD;AACF;AAED,IAAaojB,uBAAb,cAAyC,gBAIvC;EAEA,YAAYhB,OAAkB,CAAE,GAAE;AAChC,UAAM,CAAC,KAAK,UAAU;AACpB,UAAI,UAAU,OAAW,OAAM,IAAI,MAAM,sBAAsB;AAC/D,YAAMpiB,KAAI,IAAIgjB,oBAAmB;QAC/B,GAAG;QACH,IAAI;MACL,CAAA;AACD,MAAAhjB,GAAE,KAAK,KAAA;AACP,aAAOA;IACR,CAAA;EACF;EAED,IAAI+iB,IAAY;AACd,UAAM/c,KAAI,MAAM,IAAI,EAAA;AACpB,WAAOA;EACR;;;;;EAKD,UAAUqd,QAAqD;AAC7D,QAAI,wBAAwBF,QAAO;AACjC,YAAM,SAASA,OAAM,mBAAA;AACrB,YAAM,QAAQ,OAAO,IAAI,CAAA,aAAY,MAAM,KAAK,SAAS,UAAU,SAAA,GAAY,QAAA,CAAS;AACxF,aAAO,QAAQ,IAAI,KAAA;IACpB,MACC,QAAO,QAAQ,IAAI,CAAE,MAAM,KAAMA,OAAuB,UAAU,SAAA,GAAYA,MAAA,CAAQ,CAAA;EAEzF;AACF;ACrYD,IAAaG,mBAAkB,CAC7BC,UACAC,WACAC,cACG;AAGH,QAAMpiB,KAAI8C,YAAS,UAAU,SAAA;AAG7B,QAAM/C,KAAI+C,YAAS,WAAW,SAAA;AAE9B,SAAOpE,WAAUsB,EAAA,KAAMtB,WAAUqB,EAAA,KAC9BC,GAAE,IAAID,GAAE,IAAIC,GAAE,IAAID,GAAE,IAAIC,GAAE,IAAID,GAAE,MAAMA,GAAE,IAAIA,GAAE,IAAIA,GAAE,IAAIA,GAAE,IAAIA,GAAE,IAAIA,GAAE,MACpEC,GAAE,IAAID,GAAE,IAAIC,GAAE,IAAID,GAAE,MAAMA,GAAE,IAAIA,GAAE,IAAIA,GAAE,IAAIA,GAAE;AACpD;ACTD,IAAasiB,WAAU,CAACte,QAAeG,YAAkBoe,UAAkB;AACzE,QAAMnc,KAAI,KAAK,IAAI,KAAA,IAAS7F,aAAW,OAAO;AAC9C,QAAMK,KAAI,KAAK,IAAI,KAAA,IAASL,aAAW,OAAO;AAC9C,SAAO;IAAE,GAAA6F;IAAG,GAAAxF;EAAG;AAChB;ACVD,SAAgB4hB,iBAAczc,KAAW0c,MAAa,iBAAiB,MAAa;AAClF1jB,EAAAA,SAAMI,KAAI,IAAI;AACdJ,EAAAA,SAAM,MAAM,MAAM;AAClB,MAAIJ,WAAUQ,GAAA,GAAK;AACjB,QAAI,CAACR,WAAU,IAAA,EAAO,OAAM,IAAI,UAAU,mCAAmC;AAC7E,WAAO,OAAO,OAAO;MACnB,GAAG+jB,cAAoBvjB,IAAG,GAAG,KAAK,GAAG,cAAA;MACrC,GAAGujB,cAAoBvjB,IAAG,GAAG,KAAK,GAAG,cAAA;MACrC,GAAGujB,cAAoBvjB,IAAG,GAAG,KAAK,GAAG,cAAA;IACtC,CAAA;EACF;AAED,SAAO,OAAO,OAAO;IACnB,GAAGujB,cAAoBvjB,IAAG,GAAG,KAAK,GAAG,cAAA;IACrC,GAAGujB,cAAoBvjB,IAAG,GAAG,KAAK,GAAG,cAAA;EACtC,CAAA;AACF;ACXD,IAAawjB,YAAS,CAACC,UAAgC;AACrD,MAAI,OAAO,UAAU,YAAa,SAAQ,KAAK;AAE/C,SAAO,OAAO,OAAO;IACnB,GAAG,MAAA;IACH,GAAG,MAAA;EACJ,CAAA;AACF;AAkBD,IAAaC,YAAW,CAACD,UAAkC;AACzD,MAAI,OAAO,UAAU,YAAa,SAAQ,KAAK;AAE/C,SAAO,OAAO,OAAO;IACnB,GAAG,MAAA;IACH,GAAG,MAAA;IACH,GAAG,MAAA;EACJ,CAAA;AACF;ACpCD,IAAaE,UAAS,CACpBC,KACAC,KACAC,YACU;AACV,MAAI,YAAY,OAAW,WAAU;IAAE,GAAG;IAAG,GAAG;EAAG;AACnD,MAAI,cAAc;AAClB,aAAWrkB,MAAK,IACd,eAAcyU,IAAGzU,IAAG,WAAA;AAEtB,SAAO;AACR;ACFD,SAAgBuD,QACd+gB,KACA7gB,cACAiE,QAC0B;AAC1B,MAAI,OAAO,WAAW,YAAa,UAAS;IAAE,GAAG;IAAG,GAAG;EAAG;AAC1DvH,EAAAA,SAAM,QAAQ,QAAQ;AACtB,cAAY,WAAW,cAAc,IAAI,cAAc,CAAC;AACxD,QAAM,aAAa,MAAM,QAAQI,GAAA;AAGjC,MAAI,iBAAiB,EAAG,QAAOA;AAE/B,MAAI,CAAC,WACH,CAAAA,MAAK,CAAEA,GAAa;AAGtB,QAAM,OAAOA;AACb,aAAW,CAAE,OAAOP,EAAA,KAAO,KAAK,QAAA,EAAWG,CAAAA,SAAMH,IAAG,MAAO,KAAA,GAAS;AAEpE,QAAM,UAAU,KAAK,IAAI,CAACA,OAAMukB,eAAmBvkB,IAAG,MAAA,CAAO;AAC7D,QAAM,UAAU,QAAQ,IAAI,CAACA,OAAMwkB,UAAYxkB,IAAG,YAAA,CAAa;AAC/D,QAAM,eAAe,QAAQ,IAAI,CAACA,OAAM+S,aAAiB/S,IAAG,MAAA,CAAO;AACnE,SAAO,aAAa,eAAe,aAAc,CAAA;AAClD;AC/CD,IAAaykB,oBAAmB,CAC9BC,IACAjhB,iBACyB;AACzB,QAAM,MAAM,CACV,CAAE,KAAK,IAAI,YAAA,GAAe,CAAC,KAAK,IAAI,YAAA,CAAe,GACnD,CAAE,KAAK,IAAI,YAAA,GAAe,KAAK,IAAI,YAAA,CAAe,CACnD;AACD,QAAMkhB,SAAoB,CAAE;AAC5B,aAAW,CAAE,OAAO,OAAA,KAAa3e,GAAE,QAAA,EACjC,QAAQ,KAAA,IAAU,CAChB,IAAK,CAAA,EAAK,CAAA,IAAM,QAAS,CAAA,IAAM,IAAK,CAAA,EAAK,CAAA,IAAM,QAAS,CAAA,GACxD,IAAK,CAAA,EAAK,CAAA,IAAM,QAAS,CAAA,IAAM,IAAK,CAAA,EAAK,CAAA,IAAM,QAAS,CAAA,CACzD;AAEH,SAAO;AACR;ACPD,IAAa4e,WAAQ,CAAC3E,OAAuB4E,WAAoBlf,WAA2B;AAC1F,QAAMpF,MAAKe,mBAAkB,OAAO,SAAA;AACpC,WAAS,UAAU;AACnB,WAAS,UAAU;AACnB,SAAO,OAAO,OAAO;IACnB,GAAGf;IACH,GAAGukB,OAAY,QAAQvkB,IAAG,CAAA;IAC1B,GAAGukB,OAAY,QAAQvkB,IAAG,CAAA;EAC3B,CAAA;AACF;ACGD,IAAawkB,iBAAc,CACzB5iB,IACA4E,IACAie,aACY;AACZ7kB,EAAAA,SAAMkB,IAAG,GAAG;AACZlB,EAAAA,SAAMiB,IAAG,GAAG;AAEZ,MAAI,OAAO,aAAa,UAAU;AAChC,gBAAY,WAAW,UAAU,YAAY,UAAU,CAAC;AACxD,eAAW;MAAE,GAAG;MAAU,GAAG;IAAU;EACxC,MACCjB,CAAAA,SAAM,UAAU,UAAU;AAE5B,QAAMqH,KAAI,KAAK,IAAIpG,GAAE,IAAIC,GAAE,CAAA;AAC3B,QAAMW,KAAI,KAAK,IAAIZ,GAAE,IAAIC,GAAE,CAAA;AAC3B,SAAOmG,MAAK,SAAS,KAAKxF,MAAK,SAAS;AACzC;AChBD,IAAaiS,UAAO,CAClB9M,KACA8d,OACAC,UACU;AAEV,MAAI,UAAU,OAAW,SAAQ;IAAE,GAAG;IAAG,GAAG;EAAG;AAC/C,MAAI,UAAU,OAAW,SAAQ;IAAE,GAAG;IAAG,GAAG;EAAG;AAG/C/kB,EAAAA,SAAMI,KAAI,IAAI;AACdJ,EAAAA,SAAM,OAAO,OAAO;AACpBA,EAAAA,SAAM,OAAO,OAAO;AAEpB,SAAO,OAAO,OAAO;IACnB,GAAGglB,MAAW5kB,IAAG,GAAG,MAAM,GAAG,MAAM,CAAA;IACnC,GAAG4kB,MAAW5kB,IAAG,GAAG,MAAM,GAAG,MAAM,CAAA;EACpC,CAAA;AACF;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AEdD,IAAagD,YAAS,CAACwE,OAAYqd,cAAuBC,WAAkC;AAC1F,MAAI,OAAO,iBAAiB,eAAe,iBAAiB,EAAG,QAAOrd;AACtE,MAAI,OAAO,WAAW,YAAa,UAAS;AAC5C,MAAI,OAAO,WAAW,SACpB,UAASiC,eAAY,QAAQjC,MAAK,GAAGA,MAAK,CAAA;AAE5C,SAAO,OAAO,OAAO;IACnB,GAAGA;IACH,GAAGsd,QAAYtd,MAAK,GAAG,cAAc,MAAA;IACrC,GAAGsd,QAAYtd,MAAK,GAAG,cAAc,MAAA;EACtC,CAAA;AACF;ACrBD,IAAa0D,aAAU,CAAC6Z,IAASC,OAAqBpT,SAAc/Q,GAAE,GAAGD,GAAE,CAAA,KAAMgR,SAAc/Q,GAAE,GAAGD,GAAE,CAAA;ACFtG,IAAaiF,cAAW,CAAC0B,OAAY5C,YAAwB,OAAO,OAAO;EACzE,GAAG6C;EACH,GAAG8Z,YAAe9Z,MAAK,GAAG3C,OAAAA;EAC1B,GAAGyc,YAAe9Z,MAAK,GAAG3C,OAAAA;AAC3B,CAAA;ACJD,IAAalB,cAAW,CAAC4D,OAAY5C,YAAuB,OAAO,OAAO;EACxE,GAAG6C;EACH,GAAGyJ,YAAezJ,MAAK,GAAG3C,OAAAA;EAC1B,GAAGoM,YAAezJ,MAAK,GAAG3C,OAAAA;AAC3B,CAAA;ACWD,SAAgBK,YAAS+f,IAAiB9e,IAAmB;AAC3D,MAAIkF,QAAOxK,EAAA,GAAI;AACblB,IAAAA,SAAMkB,IAAG,GAAG;AACZ,IAAAD,KAAIC,GAAE;AACN,IAAAA,KAAIA,GAAE;EACP,WAAUD,OAAM,OAAW,OAAM,IAAI,MAAM,yCAAyC;AACrF,SAAOmgB,YAAelgB,EAAA,IAAK,MAAMkgB,YAAengB,EAAA;AACjD;ACGD,IAAa2I,UAAS,CAAChC,UAAyB;AAC9C,QAAM,EAAE,GAAA1G,IAAG,GAAAD,GAAA,IAAM4G;AACjB,SAAO,OAAO,OAAO;IACnB,GAAGA;IACH,QAAQ,MAAMkC,QAAO7I,IAAGD,EAAA;IACxB,aAAa,CAACqI,WAAmBQ,eAAY,QAAQ5I,IAAGD,EAAA;IACxD,kBAAkB,CAAC+D,YAAiBsY,oBAAiBzV,OAAM3C,OAAAA;IAC3D,MAAM,MAAMtC,QAAKiF,KAAA;IACjB,UAAU,MAAMtC,YAASrE,IAAGD,EAAA;IAC5B,aAAa,MAAMskB,eAAYrkB,IAAGD,EAAA;IAClC,aAAa,MAAMukB,eAAYtkB,IAAGD,EAAA;IAClC,UAAU,MAAM,CAAEC,IAAGD,EAAG;IACxB,QAAQ,CAACqC,cAAsB2B,WAAkB2E,QAAOxG,UAAOyE,OAAM,cAAc,MAAA,CAAO;IAC1F,SAAS,CAAC7C,YAAiBuL,SAAQ1I,OAAM3C,OAAAA;IACzC,KAAK,CAACF,YAAiB4E,QAAOoC,OAAInE,OAAM3C,OAAAA,CAAM;IAC9C,QAAQ,CAACF,YAAiB4E,QAAOxD,UAAOyB,OAAM3C,OAAAA,CAAM;IACpD,UAAU,CAACF,YAAiB4E,QAAO1D,YAAS2B,OAAM3C,OAAAA,CAAM;IACxD,UAAU,CAACF,YAAiB4E,QAAO5F,YAAS6D,OAAM3C,OAAAA,CAAM;IACxD,UAAU,MAAMmY,UAASnc,IAAGD,EAAA;IAC5B,iBAAiB,CAAC+D,YAAiB0W,oBAAmB7T,OAAM3C,OAAAA;IAC5D,UAAU,CAACE,eAAqByW,UAAShU,OAAMrG,UAAAA;IAC/C,oBAAoB,CAAC4D,YAAkBqgB,WAAoB3J,oBAAmBjU,OAAMrG,YAAU,MAAA;IAC9F,OAAO,MAAMkkB,OAAM7d,KAAA;IACnB,aAAa,CAAC7C,SAAc2gB,aAAqBf,aAAY/c,OAAM3C,SAAO,QAAA;IAC1E,SAAS,CAAC0gB,cAAoBra,WAAQ1D,OAAM,SAAA;IAC5C,OAAO,CAACge,QAAgCjc,QAAO4T,SAAM3V,OAAMyM,GAAA,CAAG;IAC9D,MAAM;EACP,CAAA;AACF;ACtDD,IAAawR,oBAAmB,CAAC9jB,IAAU4E,OAAuBgD,QAAOzB,cAAWjH,IAAGD,EAAA,CAAE;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACyBzF,IAAaiD,WAAQ,OAAO,OAAO;EACjC,GAAG,OAAO,OAAO;IAAE,GAAG;IAAG,GAAG;EAAG,CAAA;EAC/B,GAAG,OAAO,OAAO;IAAE,GAAG;IAAG,GAAG;EAAG,CAAA;AAChC,CAAA;AAGD,IAAamC,iBAAc,OAAO,OAAO;EACvC,GAAG,OAAO,OAAO;IAAE,GAAG;IAAY,GAAG;EAAY,CAAA;EACjD,GAAG,OAAO,OAAO;IAAE,GAAG;IAAY,GAAG;EAAY,CAAA;AAClD,CAAA;AAQD,IAAa7F,aAAU,CAACulB,OAAqBC,SAAatV,GAAE,CAAA,KAAMsV,SAAatV,GAAE,CAAA;AAEjF,IAAajQ,mBAAgB,CAACslB,OAAqBE,eAAmBvV,GAAE,CAAA,KAAMuV,eAAmBvV,GAAE,CAAA;AAyBnG,IAAa8M,WAAQ,CAAC5V,OAAYse,QAA4B,OAAO,OACnE;EACE,GAAGre;EACH,GAAGyM,IAAGzM,MAAK,CAAA;EACX,GAAGyM,IAAGzM,MAAK,CAAA;AACZ,CAAA;AAcH,IAAatB,iBAAc,CAAC4f,aAA2B3f,OAAsB;AAC3E,MAAIxE;AACJ,MAAI0J,QAAO,WAAA,GAAc;AACvB,IAAAxK,KAAI,YAAY;AAChB,IAAAD,KAAI,YAAY;EACjB,OAAM;AACL,IAAAC,KAAI;AACJ,QAAID,OAAM,OAAW,OAAM,IAAI,MAAM,0BAA0B;EAChE;AACD,SAAO,KAAK,MAAMA,GAAE,IAAIC,GAAE,GAAGD,GAAE,IAAIC,GAAE,CAAA;AACtC;AAkBD,IAAaka,qBAAkB,CAACxT,OAAYyF,OAAeC,aAAyB,OAAO,OAAO;EAChG,GAAGzF;EACH,GAAGue,iBAAsBve,MAAK,GAAG,OAAO0F,QAAAA;EACxC,GAAG6Y,iBAAsBve,MAAK,GAAG,OAAO0F,QAAAA;AACzC,CAAA;AAeD,IAAaqX,eAAc,CAAChd,OAAY5C,SAAc2gB,aAA8B;AAClF,QAAM,qBAAqBnkB,YAASqG,OAAM3C,OAAAA;AAC1C,SAAO,sBAAsB;AAC9B;AAeD,IAAawgB,SAAQ,CAACS,aAA2B3f,OAAsB;AAErE,MAAIxE;AACJ,MAAI0J,QAAO,WAAA,GAAc;AAEvB,IAAAxK,KAAI,YAAY;AAChB,IAAAD,KAAI,YAAY;EACjB,OAAM;AACL,IAAAC,KAAI;AACJ,QAAID,OAAM,OAAW,OAAM,IAAI,MAAM,sBAAsB;EAC5D;AACD,MAAIA,OAAM,OACR,OAAM,IAAI,UAAU,sBAAsB;MAE1C,SAAQA,GAAE,IAAIC,GAAE,MAAMD,GAAE,IAAIC,GAAE;AAEjC;AAgBD,IAAamlB,qBAAoB,CAACze,OAAY0e,WAAyB;AACrE,QAAMplB,KAAI4I,eAAY,SAAS,GAAGjC,KAAA;AAClC,QAAM5G,KAAI6I,eAAY,MAAM,SAAS,GAAGjC,KAAA;AACxC,SAAO;IAAE,GAAA3G;IAAG,GAAAD;EAAG;AAChB;AAOD,IAAaslB,YAAW,CAAC3e,OAAY4e,OAAqB;AACxD,QAAM3kB,KAAIgG,MAAK,EAAE,KAAKR,KAAIQ,MAAK,EAAE,KAAK6d,OAAM7d,KAAA;AAC5C,SAAO,OAAO,OAAO;IAAK,GAAAR;IAAG,GAAAxF;EAAG,CAAA;AACjC;AAaD,IAAa4kB,eAAc,CAAC7e,OAAYxC,eAA2B;AACjE,QAAM,mBAAmB2E,QAAOlC,KAAA;AAChC,SAAO,OAAO,OAAO;IACnB,GAAGA;IACH,GAAGA,MAAK;IACR,GAAG,OAAO,OAAO;MACf,GAAGA,MAAK,EAAE,KAAKA,MAAK,EAAE,IAAIA,MAAK,EAAE,KAAK,mBAAmBrG;MACzD,GAAGqG,MAAK,EAAE,KAAKA,MAAK,EAAE,IAAIA,MAAK,EAAE,KAAK,mBAAmBrG;IAC1D,CAAA;EACF,CAAA;AACF;AAoBD,UAAiBklB,UAAS9e,OAA8B;AAEtD,QAAM,EAAE,GAAA1G,IAAG,GAAAD,GAAA,IAAM4G;AACjB,MAAI,KAAK,KAAK,MAAM3G,GAAE,CAAA;AACtB,MAAI,KAAK,KAAK,MAAMA,GAAE,CAAA;AACtB,QAAM,KAAK,KAAK,MAAMD,GAAE,CAAA;AACxB,QAAM,KAAK,KAAK,MAAMA,GAAE,CAAA;AACxB,QAAM,KAAK,KAAK,IAAI,KAAK,EAAA;AACzB,QAAM,KAAK,CAAC,KAAK,IAAI,KAAK,EAAA;AAC1B,QAAM,KAAK,KAAK,KAAK,IAAI;AACzB,QAAM,KAAK,KAAK,KAAK,IAAI;AAEzB,MAAI,MAAM,KAAK;AAEf,SAAO,MAAM;AACX,UAAM;MAAE,GAAG;MAAI,GAAG;IAAI;AACtB,QAAI,OAAO,MAAM,OAAO,GAAI;AAE5B,UAAM0lB,MAAK,IAAI;AACf,QAAIA,OAAM,IAAI;AACZ,aAAO;AACP,YAAM;IACP;AACD,QAAIA,OAAM,IAAI;AACZ,aAAO;AACP,YAAM;IACP;EACF;AACF;AAeD,IAAanlB,cAAW,CAAC+Z,OAA8BvW,YAAyB;AAC9E,MAAI,MAAM,QAAQ6C,KAAA,GAAO;AACvB,UAAM,YAAYA,MAAK,IAAI,CAAA6I,OAAKgL,oBAAmBhL,IAAGxL,OAAAA,CAAM;AAC5D,WAAO,QAAQ,SAAA;EAChB,MACC,QAAOwW,oBAAmB7T,OAAc3C,OAAAA;AAE3C;AAeD,IAAaqgB,iBAAc,CAACD,IAAiB1e,OAAgC;AAC3E,MAAI8E,QAAOxK,EAAA,EACT,QAAO;IAAEA,GAAE,EAAE;IAAGA,GAAE,EAAE;IAAGA,GAAE,EAAE;IAAGA,GAAE,EAAE;EAAG;WAC5Bb,SAAQa,EAAA,KAAMb,SAAQY,EAAA,EAC/B,QAAO;IAAEC,GAAE;IAAGA,GAAE;IAAGD,GAAE;IAAGA,GAAE;EAAG;MAE7B,OAAM,IAAI,MAAM,mDAAmD;AAEtE;AAcD,UAAiB8hB,UAAS6D,OAAuB;AAC/C,aAAWlW,MAAK,OAAO;AACrB,UAAMA,GAAE;AACR,UAAMA,GAAE;EACT;AACF;AAWD,IAAa8U,iBAAc,CAACxjB,IAAU4E,OAAgC,CAAE,IAAK1F,GAAE,CAAA,IAAOA,GAAE,CAAA,MAASD,GAAE,CAAA,IAAOA,GAAE,CAAA,EAAM;ACtVlH,IAAa4lB,aAAU,CACrBjI,OACArX,WACqB;AACrB,QAAM+I,KAAI3D,mBAAkBF,OAAM,MAAA;AAClC,SAAO;IACL;MAAE,GAAG6D,GAAE;MAAG,GAAGA,GAAE;IAAG;IAClB;MAAE,GAAGA,GAAE,IAAIA,GAAE;MAAO,GAAGA,GAAE;IAAG;IAC5B;MAAE,GAAGA,GAAE,IAAIA,GAAE;MAAO,GAAGA,GAAE,IAAIA,GAAE;IAAQ;IACvC;MAAE,GAAGA,GAAE;MAAG,GAAGA,GAAE,IAAIA,GAAE;IAAQ;EAC9B;AACF;AClBD,IAAawW,YAAW,SAAUC,OAAmB;AACnD,MAAIvZ,mBAAkBE,KAAA,EAAO,QAAOA,MAAK;WAChChC,QAAOgC,KAAA,EAAO,QAAOA,MAAK;MAC9B,OAAM,IAAI,MAAM,qBAAsB,KAAK,UAAUA,KAAA,CAAK,EAAG;AACnE;AAQD,IAAasZ,UAAS,SAAUD,OAAmB;AACjD,MAAIvZ,mBAAkBE,KAAA,EAAO,QAAOA,MAAK;WAChChC,QAAOgC,KAAA,EAAO,QAAOA,MAAK;MAC9B,OAAM,IAAI,MAAM,qBAAsB,KAAK,UAAUA,KAAA,CAAK,EAAG;AACnE;;;;;;;;;;;;;;ACVD,IAAauZ,cAAa,CAACC,cAA4BrP,OAAekP,UAA6B;AACjG,QAAM,WAAW,CAAE,GAAG,aAAa,QAAU;AAE7C,WAAU,KAAA,IAAUrZ;AACpB,SAAOyZ,WAAU,GAAG,QAAA;AACrB;AAWD,IAAard,eAAc,CAACsd,QAAwBrY,IAAWsY,UAAoBC,eAA4B;AAC7G,MAAI,eAAe,OACjB,cAAaC,mBAAkBC,MAAA;AAIjC,QAAM,WAAWxY,MAAK,WAAW,WAAW,aAAa,WAAW;AACpE,MAAI,QAAQ;AAGZ,QAAM0B,KAAI,WAAW,WAAW,SAAS,WAAW;AACpD,aAAW,CAAE,OAAO,OAAA,KAAaA,GAAE,QAAA,EACjC,KAAI,QAAQ,WAAW,UAAU;AAC/B,UAAM+W,YAAW,WAAW;AAC5B,QAAI,MAAMA,YAAW;AACrB,QAAI,MAAM,EAAG,OAAM;AACnB,WAAOD,OAAO,KAAA,EAAQ,YAAY,GAAA;EACnC,MAAM,UAAS;AAElB,SAAO;IAAE,GAAG;IAAG,GAAG;EAAG;AACtB;AAQD,IAAaE,mBAAkB,CAACN,QAAwBpiB,YAAyB;AAC/E,MAAIwiB,OAAM,WAAW,EAAG,QAAO;AAC/B,MAAI,YAAYA,OAAM,IAAI,CAAC3nB,IAAG,WAAW;IAAE,MAAMA;IAAG;IAAO,UAAUA,GAAE,gBAAgBqF,OAAAA;EAAQ,EAAA;AAC/F,cAAY,sBAAsB,WAAW,UAAU;AACvD,MAAI,UAAU,WAAW,EAAG,OAAM,IAAI,MAAM,6BAA6B;AACzE,SAAO,UAAW,CAAA,EAAI;AACvB;AAUD,IAAaoY,oBAAmB,CAAC8J,QAAwBpiB,SAAc2iB,uBAA+BL,eAAoC;AACxI,MAAI,eAAe,OACjB,cAAaC,mBAAkBC,MAAA;AAEjC,MAAI,YAAYA,OAAM,IAAI,CAAC3nB,IAAG,WAAW;IAAE,MAAMA;IAAG;IAAO,UAAUA,GAAE,gBAAgBqF,OAAAA;EAAQ,EAAA;AAC/F,cAAY,sBAAsB,WAAW,UAAU;AACvD,MAAI,UAAU,SAAS,EAAG,OAAM,IAAI,MAAM,oCAAoC;AAC9E,QAAMQ,KAAI,UAAW,CAAA;AACrB,MAAIA,GAAE,WAAW,sBAAuB,OAAM,IAAI,MAAM,yDAA0DA,GAAE,QAAA,gBAA0B,qBAAA,EAAwB;AAEtK,QAAM,yBAAyBA,GAAE,KAAK,iBAAiBR,SAAO,qBAAA;AAG9D,MAAI,cAAc;AAClB,WAAS,QAAQ,GAAG,QAAQQ,GAAE,OAAO,QAEnC,gBAAe,WAAW,QAAS,KAAA;AAIrC,iBAAe,WAAW,QAASA,GAAE,KAAA,IAAU;AAC/C,QAAM,iBAAiB,cAAc,WAAW;AAChD,UAAQ,IAAI,QAAS,WAAA,SAAsB,cAAA,aAA6B,sBAAA,UAAkCA,GAAE,KAAA,EAAQ;AACpH,SAAO;AACR;AAQD,IAAa6hB,qBAAoB,CAACH,WAAuC;AACvE,QAAM,SAASI,OAAM,IAAI,CAAA9W,OAAKA,GAAE,KAAA,EAAO,KAAA;AACvC,QAAMkX,YAAUJ,OAAM,IAAI,CAAA9W,OAAKA,GAAE,OAAA,CAAQ;AACzC,MAAI,cAAc;AAClB,MAAI,aAAa;AACjB,aAAW3G,YAAU6d,UACnB,gBAAe7d;AAEjB,aAAW,SAAS,OAClB,eAAc;AAGhB,SAAO;IAAE;IAAa;IAAY;IAAQ,SAAA;EAAS;AACpD;AAQD,IAAanH,UAAO,CAACwkB,WAA2C;AAC9D,QAAM,QAAQI,OAAM,IAAI,CAAA3nB,OAAKA,GAAE,KAAA,CAAM;AACrC,QAAMgnB,YAAU,MAAM,QAAQ,CAAA5lB,OAAK4mB,WAAa5mB,EAAA,CAAE;AAElD,SAAO8a,QAAW,GAAG8K,SAAAA;AACtB;AAQD,IAAathB,YAAW,CAAC6hB,WAAmCI,OAAM,IAAI,CAAA3nB,OAAKA,GAAE,SAAA,CAAU,EAAE,KAAK,IAAI;AAOlG,IAAaioB,mBAAkB,CAACV,WAA2B;AACzD,MAAI,UAAUJ,QAAOQ,OAAO,CAAA,CAAA;AAC5B,WAAS,QAAQ,GAAG,QAAQA,OAAM,QAAQ,SAAS;AACjD,UAAM,QAAQV,UAASU,OAAO,KAAA,CAAA;AAC9B,QAAI,CAACvV,SAAc,OAAO,OAAA,EAAU,OAAM,IAAI,MAAM,cAAe,KAAA,6CAAoD,MAAM,CAAA,IAAO,MAAM,CAAA,cAAiB,QAAQ,CAAA,IAAO,QAAQ,CAAA,EAAI;AACtL,cAAU+U,QAAOQ,OAAO,KAAA,CAAA;EACzB;AACF;AAED,IAAahC,eAAc,CAAC4B,WAA8CI,OAAM,QAAQ,CAAA3nB,OAAKA,GAAE,YAAA,CAAa;AAS5G,IAAasnB,aAAY,IAAIK,WAAyC;AACpE,EAAAM,iBAAgBN,MAAA;AAChB,QAAM,OAAOD,mBAAkBC,MAAA;AAE/B,SAAO,OAAO,OAAO;IACnB,UAAUA;IACV,QAAQ,MAAM,KAAK;IACnB,SAAS,CAACvY,OAAa;AAAE,YAAM,IAAI,MAAM,iBAAiB;IAAI;IAC9D,aAAa,CAACF,IAAW,WAAW,UAAUjF,aAAY0d,QAAOxY,IAAG,UAAU,IAAA;IAC9E,kBAAkB,CAAChK,SAAc2iB,0BAAkCrK,kBAAiBkK,QAAOtiB,SAAO,uBAAuB,IAAA;IACzH,iBAAiB,CAACF,YAAiB0iB,iBAAgBF,QAAOtiB,OAAAA;IAC1D,MAAM,MAAMtC,QAAK4kB,MAAA;IACjB,UAAU,MAAMjiB,UAASiiB,MAAA;IACzB,aAAa,MAAMhC,aAAYgC,MAAA;IAC/B,MAAM;EACP,CAAA;AACF;;;;;;;;;;;;;;;;AE3KD,IAAa9X,UAAO,CAAClD,UAAuB;AAC1CxM,EAAAA,SAAMyM,KAAA;AACN,SAAOA,MAAK,SAASA,MAAK;AAC3B;ACeD,SAAgBsb,aAAYC,IAAkBC,aAA6CC,aAA6C;AACtI,MAAI,QAAS,OAAO,gBAAgB,WAAY,cAAc,YAAY;AAC1E,MAAI3a,WAAU,OAAO,gBAAgB,WAAY,cAAc,YAAY;AAC3E,MAAI,UAAU,OAAW,OAAM,IAAI,MAAM,yBAAyB;AAClE,MAAIA,aAAW,OAAW,OAAM,IAAI,MAAM,0BAA0B;AAEpE,UAAQ,GAAG,OAAO,OAAO;AACzBA,aAAS,GAAGA,UAAQ,QAAQ;AAE5B,MAAI,OAAO,gBAAgB,SACzB,KAAIlF,cAAa,WAAA,GAAc;AAC7B,UAAMhB,KAAI,GAAG,YAAY,GAAG,GAAG;AAC/B,UAAMxF,KAAI,GAAG,YAAY,GAAG,GAAG;AAC/B,WAAO;MAAE,GAAG;MAAa;MAAO,QAAA;MAAQ,GAAAwF;MAAG,GAAAxF;IAAG;EAC/C,MACC,QAAO;IACL,GAAG;IAAa;IAAO,QAAA;EACxB;AAGL,SAAO;IAAE;IAAO,QAAA;EAAQ;AACzB;AAwBD,SAAgBsmB,YACdC,IACAC,IACAC,IACAhnB,IACuB;AACvBtB,EAAAA,SAAMkB,IAAG,GAAG;AAEZ,MAAI8L,QAAO/L,EAAA,EAET,QAAOiM,kBAAiBhM,EAAA,IAAK,OAAO,OAAO;IACzC,GAAGA;IACH,GAAG,GAAGA,GAAE,GAAGD,GAAE,KAAA;IACb,GAAG,GAAGC,GAAE,GAAGD,GAAE,MAAA;IACb,OAAO,GAAGC,GAAE,OAAOD,GAAE,KAAA;IACrB,QAAQ,GAAGC,GAAE,QAAQD,GAAE,MAAA;EACxB,CAAA,IAAI,OAAO,OAAO;IACjB,GAAGC;IACH,OAAO,GAAGA,GAAE,OAAOD,GAAE,KAAA;IACrB,QAAQ,GAAGC,GAAE,QAAQD,GAAE,MAAA;EACxB,CAAA;OACI;AAEL,QAAI,OAAOA,OAAM,SACf,OAAM,IAAI,UACR,yDAA0D,KAAK,UAC7DA,EAAA,CACD,EAAG;AAGR,QAAI,OAAOM,OAAM,SAAU,OAAM,IAAI,MAAM,uCAAwC,KAAK,UAAUA,EAAA,CAAE,EAAG;AACvG,WAAO2L,kBAAiBhM,EAAA,IAAK,OAAO,OAAO;MACzC,GAAGA;MACH,GAAG,GAAGA,GAAE,GAAGD,EAAA;MACX,GAAG,GAAGC,GAAE,GAAGK,EAAA;MACX,OAAO,GAAGL,GAAE,OAAOD,EAAA;MACnB,QAAQ,GAAGC,GAAE,QAAQK,EAAA;IACtB,CAAA,IAAI,OAAO,OAAO;MACjB,GAAGL;MACH,OAAO,GAAGA,GAAE,OAAOD,EAAA;MACnB,QAAQ,GAAGC,GAAE,QAAQK,EAAA;IACtB,CAAA;EACF;AACF;AAuBD,SAAgBgnB,aACdH,IACAxb,OACA4b,WACuB;AACvB,SAAOngB,cAAaoE,KAAA,IAAQ,OAAO,OAAO;IACxC,GAAGA;IACH,GAAG,GAAGA,MAAK,GAAG,SAAA;IACd,GAAG,GAAGA,MAAK,GAAG,SAAA;IACd,OAAO,GAAGA,MAAK,OAAO,SAAA;IACtB,QAAQ,GAAGA,MAAK,QAAQ,SAAA;EACzB,CAAA,IAAI,OAAO,OAAO;IACjB,GAAGA;IACH,OAAO,GAAGA,MAAK,OAAO,SAAA;IACtB,QAAQ,GAAGA,MAAK,QAAQ,SAAA;EACzB,CAAA;AACF;AASD,SAAgBgc,UACdL,IACAxb,OACA4b,WACuB;AACvB,SAAO,OAAO,OAAO;IACnB,GAAG/b;IACH,OAAO,GAAGA,MAAK,OAAO,SAAA;IACtB,QAAQ,GAAGA,MAAK,QAAQ,SAAA;EACzB,CAAA;AACF;ACnKD,IAAa4K,YAAW,CACtBvK,OACA4b,SACU;AACV,QAAM,EAAE,GAAArhB,IAAG,GAAAxF,IAAG,OAAO,QAAA,SAAA,IAAW4K;AAChC,UAAQ,MAAR;IACE,KAAK;AACH,aAAO,OAAO,OAAO;QAAE,GAAApF;QAAG,GAAAxF;MAAG,CAAA;IAE/B,KAAK;AACH,aAAO,OAAO,OAAO;QACnB,GAAGwF,KAAI,QAAQ;QACf,GAAAxF;MACD,CAAA;IAEH,KAAK;AACH,aAAO,OAAO,OAAO;QACnB,GAAGwF,KAAI;QACP,GAAAxF;MACD,CAAA;IAEH,KAAK;AACH,aAAO,OAAO,OAAO;QAAE,GAAAwF;QAAG,GAAGxF,KAAI0L;MAAQ,CAAA;IAE3C,KAAK;AACH,aAAO,OAAO,OAAO;QACnB,GAAGlG,KAAI,QAAQ;QACf,GAAGxF,KAAI0L;MACR,CAAA;IAEH,KAAK;AACH,aAAO,OAAO,OAAO;QACnB,GAAGlG,KAAI;QACP,GAAGxF,KAAI0L;MACR,CAAA;IAEH,KAAK;AACH,aAAO,OAAO,OAAO;QAAE,GAAAlG;QAAG,GAAGxF,KAAI0L,WAAS;MAAG,CAAA;IAE/C,KAAK;AACH,aAAO,OAAO,OAAO;QAAE,GAAGlG,KAAI;QAAO,GAAGxF,KAAI0L,WAAS;MAAG,CAAA;IAE1D,KAAK;AACH,aAAO,OAAO,OAAO;QACnB,GAAGlG,KAAI,QAAQ;QACf,GAAGxF,KAAI0L,WAAS;MACjB,CAAA;IAEH;AAEE,YAAM,IAAI,MAAM,sBAAuB,IAAA,EAAO;EAEjD;AACF;ACrDD,IAAaob,gBAAe,CAACC,iBAAiC;AAC5D,QAAMrnB,KAAIuO,UAAO,YAAA;AACjB,QAAM+Y,KAAI,aAAa,QAAQ;AAC/B,QAAMC,KAAI,aAAa,SAAS;AAEhC,QAAM,qBAAqB,CAAC9jB,YAAiB;AAC3C,WAAO;MACL,GAAGE;MACH,GAAGA,QAAM,IAAI2jB,KAAItnB,GAAE;MACnB,GAAG2D,QAAM,IAAI4jB,KAAIvnB,GAAE;IACpB;EACF;AAED,QAAM,qBAAqB,CAACyD,YAAiB;AAC3C,WAAO;MACL,GAAGE;MACH,IAAKA,QAAM,IAAI,aAAa,KAAK2jB,KAAK;MACtC,IAAK3jB,QAAM,IAAI,aAAa,KAAK4jB,KAAK;IACvC;EACF;AAED,SAAO;IAAE;IAAoB;EAAoB;AAClD;ACjCD,IAAMC,YAAW,CAACC,IAAWC,OAAc/nB,KAAID;AA+D/C,SAAgBmF,QACdiiB,IACAC,IACAhnB,IACuB;AAEvB,SAAO6mB,YAAWY,WAAU7nB,IAAGD,IAAGM,EAAA;AACnC;AAwCD,SAAgB2nB,cACdtc,OACAtD,QACuB;AACvB,SAAOif,aAAYQ,WAAUtc,OAAM,MAAA;AACpC;AAED,SAAgB0c,WACdvc,OACAtD,QACuB;AACvB,SAAOmf,UAASM,WAAUtc,OAAM,MAAA;AACjC;ACtGD,IAAa2c,WAAQ,CACnBxK,OACArX,WACoB;AACpB,QAAMhG,KAAIslB,WAAQpa,OAAM,MAAA;AAGxB,SAAO4c,mBAAuB,GAAG9nB,IAAGA,GAAG,CAAA,CAAA;AACxC;AAiBD,IAAa+nB,YAAW,CACtB1K,OACA2K,SACW;AACXvpB,EAAAA,SAAMyM,KAAA;AACN,UAAQ,MAAR;IACE,KAAK;AACH,aAAOpM,SAAQoM,KAAA,IAAQA,MAAK,IAAI;IAElC,KAAK;AACH,aAAOpM,SAAQoM,KAAA,IAAQA,MAAK,IAAI;IAElC,KAAK;AACH,aAAOpM,SAAQoM,KAAA,IAAQA,MAAK,IAAI;IAElC,KAAK;AACH,aAAOpM,SAAQoM,KAAA,IAAQA,MAAK,IAAIA,MAAK,QAAQA,MAAK;EAErD;AACF;AAkBD,IAAa+c,YAAW,CACtB5K,OACA2K,SACW;AACXvpB,EAAAA,SAAMyM,KAAA;AACN,UAAQ,MAAR;IACE,KAAK;AACH,aAAQpM,SAAQoM,KAAA,IAAQA,MAAK,IAAI;IAEnC,KAAK;AACH,aAAOpM,SAAQoM,KAAA,IAAQA,MAAK,IAAIA,MAAK,SAASA,MAAK;IAErD,KAAK;AACH,aAAOpM,SAAQoM,KAAA,IAAQA,MAAK,IAAI;IAElC,KAAK;AACH,aAAOpM,SAAQoM,KAAA,IAAQA,MAAK,IAAI;EAEnC;AACF;ACxGD,IAAavI,WAAQ,OAAO,OAAO;EAAE,OAAO;EAAG,QAAQ;AAAG,CAAA;AAC1D,IAAaulB,mBAAkB,OAAO,OAAO;EAC3C,GAAG;EACH,GAAG;EACH,OAAO;EACP,QAAQ;AACT,CAAA;ACID,IAAaC,aAAY,CAAC5c,UAAyB,WAAoC;AACrF,QAAMzF,KAAI,OAAO,IAAI,CAAAxH,OAAKA,GAAE,CAAA;AAC5B,QAAMgC,KAAI,OAAO,IAAI,CAAAhC,OAAKA,GAAE,CAAA;AAE5B,MAAI,OAAO,KAAK,IAAI,GAAGwH,IAAGoF,MAAK,CAAA;AAC/B,MAAI,OAAO,KAAK,IAAI,GAAG5K,IAAG4K,MAAK,CAAA;AAC/B,MAAI,OAAO,KAAK,IAAI,GAAGpF,IAAGoF,MAAK,IAAIA,MAAK,KAAA;AACxC,MAAI,OAAO,KAAK,IAAI,GAAG5K,IAAG4K,MAAK,IAAIA,MAAK,MAAA;AAExC,MAAI,QAAQ,KAAK,IAAIA,MAAK,OAAO,OAAO,IAAA;AACxC,MAAI,QAAQ,KAAK,IAAIA,MAAK,QAAQ,OAAO,IAAA;AAEzC,SAAO,OAAO,OAAO;IACnB,GAAGA;IACH,GAAG;IACH,GAAG;IACH,OAAO;IACP,QAAQ;EACT,CAAA;AACF;AClBD,IAAakd,eAAc,CAACC,SAA2B;EACrD,OAAOC,IAAG;EACV,QAAQA,IAAG;AACZ;ACsDD,SAAgBrN,eACdsN,UACAC,WACAC,OACAC,UACuB;AACvB,MAAI,UAAU,UAAa1c,aAAW,QAAW;AAC/C,QAAI,OAAO,aAAa,SAAU,OAAM,IAAI,MAAM,wBAAwB;AAC1E,QAAI,OAAO,cAAc,SACvB,OAAM,IAAI,UAAU,yBAAyB;AAE/C,WAAO,OAAO,OAAO;MAAE,OAAO;MAAU,QAAQ;IAAW,CAAA;EAC5D;AACD,MAAI,OAAO,aAAa,SAAU,OAAM,IAAI,MAAM,oBAAoB;AACtE,MAAI,OAAO,cAAc,SAAU,OAAM,IAAI,MAAM,oBAAoB;AACvE,MAAI,OAAO,UAAU,SAAU,OAAM,IAAI,MAAM,wBAAwB;AACvE,MAAI,OAAOA,aAAW,SAAU,OAAM,IAAI,MAAM,yBAAyB;AAEzE,SAAO,OAAO,OAAO;IAAE,GAAG;IAAU,GAAG;IAAW;IAAO,QAAA;EAAQ,CAAA;AAClE;ACpED,SAAgB2c,4BAA2BC,IAA2CC,IAA2BC,IAAmBtf,IAA4B;AAC9J,MAAI,OAAO7J,OAAM,SACf,KAAI,OAAOD,OAAM,SACf,KAAI,OAAOM,OAAM,YAAY,OAAOmE,OAAM,SACxC,QAAO;IAAE,GAAGxE;IAAG,GAAGD;IAAG,OAAOM;IAAG,QAAQmE;EAAG;WACjCsH,QAAOzL,EAAA,EAChB,QAAO;IAAE,GAAGL;IAAG,GAAGD;IAAG,OAAOM,GAAE;IAAO,QAAQA,GAAE;EAAQ;MAEvD,OAAM,IAAI,UAAU,gFAAgF;MAGtG,OAAM,IAAI,UAAU,wEAAwE;WAErF2L,kBAAiBhM,EAAA,EAC1B,QAAOA;WACE8L,QAAO9L,EAAA,EAChB,KAAI,OAAOD,OAAM,YAAY,OAAOM,OAAM,SACxC,QAAO;IAAE,OAAOL,GAAE;IAAO,QAAQA,GAAE;IAAQ,GAAGD;IAAG,GAAGM;EAAG;WAC9ClB,SAAQY,EAAA,EACjB,QAAO;IAAE,OAAOC,GAAE;IAAO,QAAQA,GAAE;IAAQ,GAAGD,GAAE;IAAG,GAAGA,GAAE;EAAG;MAE3D,OAAM,IAAI,UAAU,gEAAgE;WAE7EZ,SAAQa,EAAA,EACjB,KAAI,OAAOD,OAAM,YAAY,OAAOM,OAAM,SACxC,QAAO;IAAE,GAAGL,GAAE;IAAG,GAAGA,GAAE;IAAG,OAAOD;IAAG,QAAQM;EAAG;WACrCyL,QAAO/L,EAAA,EAChB,QAAO;IAAE,GAAGC,GAAE;IAAG,GAAGA,GAAE;IAAG,OAAOD,GAAE;IAAO,QAAQA,GAAE;EAAQ;MAE3D,OAAM,IAAI,UAAU,kFAAkF;AAG1G,QAAM,IAAI,UAAU,+DAA+D;AACpF;AChCD,IAAaqpB,eAAc,CAACC,IAASC,OAAqB;AACxD,MAAItpB,OAAM,OAAW,OAAM,IAAI,MAAM,aAAa;AAClD,MAAID,OAAM,OAAW,OAAM,IAAI,MAAM,aAAa;AAClD,SAAOC,GAAE,UAAUD,GAAE,SAASC,GAAE,WAAWD,GAAE;AAC9C;AAoBD,IAAasK,aAAU,CACrBkf,IACAC,OACY;AACZ,MAAIriB,cAAanH,EAAA,KAAMmH,cAAapH,EAAA,GAAI;AACtC,QAAI,CAACgR,SAAc/Q,IAAGD,EAAA,EAAI,QAAO;AACjC,WAAOC,GAAE,UAAUD,GAAE,SAASC,GAAE,WAAWD,GAAE;EAC9C,WAAU,CAACoH,cAAanH,EAAA,KAAM,CAACmH,cAAapH,EAAA,EAC3C,QAAOC,GAAE,UAAUD,GAAE,SAASC,GAAE,WAAWD,GAAE;MAG7C,QAAO;AAEV;ACzCD,IAAa2mB,aAAU,CAAC9a,UAA4C;AAClE,EAAAD,iBAAgBJ,OAAM,MAAM;AAC5B,SAAO2c,SAAM3c,KAAA,EAAM,IAAI,CAACiE,OAAMia,QAAYja,EAAA,CAAE;AAC7C;AChBD,IAAMka,cAAa,CAAC5B,IAAWC,OAAc/nB,KAAID;AAqEjD,SAAgBiF,UACdmiB,IACAC,IACAhnB,IACuB;AAEvB,SAAO6mB,YAAWyC,aAAY1pB,IAAGD,IAAGM,EAAA;AACrC;AA0CD,SAAgB2Q,gBACdtF,OACAtD,QACuB;AACvB,SAAOif,aAAYqC,aAAYne,OAAM,MAAA;AAYtC;AAeD,SAAgBoe,aACdje,OACAtD,QACuB;AACvB,SAAOmf,UAASmC,aAAYne,OAAM,MAAA;AAYnC;AC7JD,IAAaqe,mBAAkB,CAAChe,OAAsBnN,OAAoB;AACxE,MAAI,EAAE,GAAA0H,IAAG,GAAAxF,GAAA,IAAMhC;AACf,MAAIwH,KAAIoF,MAAK,EAAG,CAAApF,KAAIoF,MAAK;WAChBpF,KAAIoF,MAAK,IAAIA,MAAK,MAAO,CAAApF,KAAIoF,MAAK,IAAIA,MAAK;AACpD,MAAI5K,KAAI4K,MAAK,EAAG,CAAA5K,KAAI4K,MAAK;WAChB5K,KAAI4K,MAAK,IAAIA,MAAK,OAAQ,CAAA5K,KAAI4K,MAAK,IAAIA,MAAK;AACrD,SAAO,OAAO,OAAO;IAAE,GAAG5M;IAAG,GAAAwH;IAAG,GAAAxF;EAAG,CAAA;AACpC;AClBD,IAAawE,eAAc,OAAO,OAAO;EACvC,OAAO;EACP,QAAQ;AACT,CAAA;AACD,IAAa0kB,yBAAwB,OAAO,OAAO;EACjD,GAAG;EACH,GAAG;EACH,OAAO;EACP,QAAQ;AACT,CAAA;ACGD,IAAaC,eAAY,CAACxe,UAAuB;AAC/CxM,EAAAA,SAAMyM,KAAA;AACN,SAAOA,MAAK,SAASA,MAAK,SAASA,MAAK,QAAQA,MAAK;AACtD;ACAD,IAAawe,6BAA4B,CAACze,UAAe;AACvD,QAAM,UAAU,KAAK,IAAIC,MAAK,OAAOA,MAAK,MAAA;AAC1C,SAAO,CAACye,WAA0B;AAChC,QAAI,OAAO5Y,WAAU,SACnB,QAAOA,SAAQ;aACN1S,WAAU0S,MAAA,EACnB,QAAO,OAAO,OAAO;MACnB,GAAGA;MACH,GAAGA,OAAM,IAAI;MACb,GAAGA,OAAM,IAAI;MACb,GAAGA,OAAM,IAAI;IACd,CAAA;aACQjS,SAAQiS,MAAA,EACjB,QAAO,OAAO,OAAO;MACnB,GAAGA;MACH,GAAGA,OAAM,IAAI;MACb,GAAGA,OAAM,IAAI;IACd,CAAA;QACI,OAAM,IAAI,MAAM,2CAA2C;EACnE;AACF;ACfD,IAAasR,YAAS,CAACC,UAAyC;AAC9D,YAAU,KAAK;AAEf,SAAO,OAAO,OAAO;IACnB,GAAG,MAAA;IACH,GAAG,MAAA;IACH,OAAO,MAAA;IACP,QAAQ,MAAA;EACT,CAAA;AACF;AAoBD,IAAatR,iBAAc,CACzB4Y,QACAC,UAA+B,CAAE,MACvB;AAGV,QAAM,OAAO,QAAQ,gBAAgB,KAAK;AAC1C,QAAM,SAAS,QAAQ,UAAU;IAAE,GAAG;IAAG,GAAG;EAAG;AAE/C,QAAM/jB,KAAI,KAAA,KAAU,OAAO,QAAQ,OAAO,IAAI,OAAO;AACrD,QAAMxF,KAAI,KAAA,KAAU,OAAO,SAAS,OAAO,IAAI,OAAO;AAEtD,QAAM,MAAM;IAAE,GAAGwF,KAAI,OAAO;IAAG,GAAGxF,KAAI,OAAO;EAAG;AAChD,SAAOwG,cAAa,MAAA,IAAUoJ,OAAU,KAAK,MAAA,IAAU,OAAO,OAAO,GAAA;AACtE;AC3DD,IAAM4Z,cAAa,CAACrC,IAAWC,OAAc/nB,KAAID;AAgDjD,SAAgB+C,UAASsnB,IAAqBC,IAAmCjqB,IAAkB;AAEjG,SAAO6mB,YAAWkD,aAAYnqB,IAAGD,IAAGM,EAAA;AACrC;AAiCD,SAAgBiqB,cAAaf,IAA0BnC,IAAkBhnB,IAAmC;AAC1G,QAAMunB,KAAI,OAAO5nB,OAAM,WAAWA,KAAIA,GAAE;AACxC,QAAM6nB,KAAI,OAAO7nB,OAAM,WAAWM,KAAIN,GAAE;AACxC,MAAI6nB,OAAM,OAAW,OAAM,IAAI,MAAM,oCAAoC;AACzE,QAAMxY,KAAI;IACR,GAAGpP;IACH,OAAOA,GAAE,QAAQ2nB;IACjB,QAAQ3nB,GAAE,SAAS4nB;EACpB;AACD,SAAOxY;AACR;AAgBD,SAAgBmb,gBAAepD,IAA0BqD,IAA0C;AACjG,MAAIrkB,KAAI;AACR,MAAIxF,KAAI;AACR,MAAIwG,cAAanH,EAAA,GAAI;AACnB,IAAAmG,KAAInG,GAAE;AACN,IAAAW,KAAIX,GAAE;EACP;AACD,MAAI,KAAK;AACT,MAAI,KAAK;AACT,MAAImH,cAAapH,EAAA,GAAI;AACnB,SAAKA,GAAE;AACP,SAAKA,GAAE;EACR;AACD,SAAO,OAAO,OAAO;IACnB,GAAGC;IACH,GAAGmG,KAAI;IACP,GAAGxF,KAAI;IACP,OAAOX,GAAE,QAAQD,GAAE;IACnB,QAAQC,GAAE,SAASD,GAAE;EACtB,CAAA;AACF;AClID,IAAM0qB,SAAQ,CAAC3C,IAAWC,OAAc/nB,KAAID;AA8E5C,SAAgB+K,KAAIue,IAASgB,IAAmCjqB,IAAkB;AAEhF,SAAO6mB,YAAWwD,QAAOzqB,IAAGD,IAAGM,EAAA;AAChC;AAaD,SAAgBqqB,WAAUvD,IAA0BqD,IAA0C;AAC5F,MAAIrkB,KAAI;AACR,MAAIxF,KAAI;AACR,MAAIwG,cAAanH,EAAA,GAAI;AACnB,IAAAmG,KAAInG,GAAE;AACN,IAAAW,KAAIX,GAAE;EACP;AACD,MAAI,KAAK;AACT,MAAI,KAAK;AACT,MAAImH,cAAapH,EAAA,GAAI;AACnB,SAAKA,GAAE;AACP,SAAKA,GAAE;EACR;AACD,SAAO,OAAO,OAAO;IACnB,GAAGC;IACH,GAAGmG,KAAI;IACP,GAAGxF,KAAI;IACP,OAAOX,GAAE,QAAQD,GAAE;IACnB,QAAQC,GAAE,SAASD,GAAE;EACtB,CAAA;AACF;ACxED,SAAgBke,SACdvS,OACiC;AACjC,MAAIvE,cAAaoE,KAAA,EACf,QAAO;IAAEA,MAAK;IAAGA,MAAK;IAAGA,MAAK;IAAOA,MAAK;EAAQ;WACzCO,QAAOP,KAAA,EAChB,QAAO,CAAEA,MAAK,OAAOA,MAAK,MAAQ;MAElC,OAAM,IAAI,MACR,yCAA0C,KAAK,UAAUA,KAAA,CAAK,EAAG;AAGtE;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AE/CD,IAAavI,WAAQ,OAAO,OAAO;EACjC,GAAG;IAAE,GAAG;IAAG,GAAG;EAAG;EACjB,GAAG;IAAE,GAAG;IAAG,GAAG;EAAG;EACjB,GAAG;IAAE,GAAG;IAAG,GAAG;EAAG;AAClB,CAAA;AAMD,IAAamC,iBAAc,OAAO,OAAO;EACvC,GAAG;IAAE,GAAG;IAAY,GAAG;EAAY;EACnC,GAAG;IAAE,GAAG;IAAY,GAAG;EAAY;EACnC,GAAG;IAAE,GAAG;IAAY,GAAG;EAAY;AACpC,CAAA;AAYD,IAAawlB,yBAAwB,CACnCtkB,QACAwC,WAAS,IACTX,gBAAsB,KAAK,KAAK,MACnB;AACb,MAAI,CAAC,OAAQ,UAAS,OAAO,OAAO;IAAE,GAAG;IAAG,GAAG;EAAG,CAAA;AAElD,QAAMlI,KAAI4qB,SAAc,QAAQ/hB,UAAQ,KAAK,KAAK,CAACxD,gBAAc,CAAA;AACjE,QAAMhF,KAAIuqB,SAAc,QAAQ/hB,UAAQ,KAAK,KAAKxD,gBAAc,CAAA;AAChE,SAAO;IAAE,GAAArF;IAAG,GAAG;IAAQ,GAAAK;EAAG;AAC3B;ACXD,IAAawqB,SAAQ,CACnB9mB,QACA+mB,QACAC,OAAkB,CAAE,MACK;AACzB,QAAM,aAAa,KAAK,cAAc;AACtC,QAAM,gBAAgB,KAAK,iBAAiB,KAAK,IAAI,aAAa,GAAG,CAAA;AACrE,QAAM1lB,gBAAc,KAAK,eAAe;AACxC,QAAM,YAAY,KAAK,aAAa,KAAK,IAAI,aAAa,GAAG,EAAA;AAE7D,QAAM,WAAW,KAAK,KAAK;AAE3B,MAAI2lB;AACJ,MAAIC;AAEJ,MAAI9M,WAAS,OAAO;AAClB,UAAMwM,uBAAsB,QAAQ,WAAW,QAAA;AAC/C,iBAAahE,WACX3Y,aACE;MAAE,GAAG,IAAI,EAAE,IAAI;MAAY,GAAG,OAAO,IAAI,gBAAgB;IAAG,GAC5D,YACA,aAAA,CACD;EAEJ,WAAUmQ,WAAS,UAAU;AAC5B,UAAM,OAAO,aAAa,YAAY;AACtC,UAAM,OAAO,gBAAgB;AAC7B,UAAMwM,uBACJ;MACE,GAAG,OAAO,IAAI,YAAY;MAC1B,GAAG,OAAO;IACX,GACD,WACA,QAAA;AAGF,iBAAahE,WACX3Y,aACE;MAAE,GAAG,OAAO,IAAI;MAAM,GAAG,OAAO,IAAI;IAAM,GAC1C,aAAa,WACb,aAAA,CACD;EAEJ,OAAM;AAEL,iBAAa2Y,WACX3Y,aACE;MAAE,GAAG,OAAO;MAAG,GAAG,OAAO,IAAI,gBAAgB;IAAG,GAChD,YACA,aAAA,CACD;AAEH,UAAM2c,uBACJ;MAAE,GAAG,OAAO,IAAI,aAAa,YAAY;MAAK,GAAG,OAAO;IAAG,GAC3D,WACA,QAAA;EAEH;AAED,QAAME,UAAQK,QACZ;IACE,WAAY,CAAA;IACZ,WAAY,CAAA;IACZ,IAAI;IACJ,IAAI;IACJ,IAAI;IACJ,WAAY,CAAA;IACZ,WAAY,CAAA;EACb,GACD7lB,eACA,MAAA;AAGF,SAAOwlB;AACR;ACrGD,IAAa/rB,SAAQ,CAACqsB,IAAa,OAAO,QAAQ;AAChD,MAAIrd,OAAM,OAAW,OAAM,IAAI,MAAM,mBAAmB;AACxDtC,EAAAA,SAAYsC,GAAE,GAAG,OAAO,IAAI;AAC5BtC,EAAAA,SAAYsC,GAAE,GAAG,OAAO,IAAI;AAC5BtC,EAAAA,SAAYsC,GAAE,GAAG,OAAO,IAAI;AAC7B;AAOD,IAAasd,cAAa,CAACppB,OAA8B;AACvD,MAAIrD,OAAM,OAAW,QAAO;AAC5B,QAAM,MAAMA;AACZ,MAAI,CAACQ,SAAQ,IAAI,CAAA,EAAI,QAAO;AAC5B,MAAI,CAACA,SAAQ,IAAI,CAAA,EAAI,QAAO;AAC5B,MAAI,CAACA,SAAQ,IAAI,CAAA,EAAI,QAAO;AAC5B,SAAO;AACR;AAQD,IAAaG,aAAU,CAAC6rB,OACtBE,SAAcvd,GAAE,CAAA,KAAMud,SAAcvd,GAAE,CAAA,KAAMud,SAAcvd,GAAE,CAAA;AAO9D,IAAavO,mBAAgB,CAAC4rB,OAC5BG,eAAoBxd,GAAE,CAAA,KACtBwd,eAAoBxd,GAAE,CAAA,KACtBwd,eAAoBxd,GAAE,CAAA;AAQxB,IAAazD,aAAU,CAACkhB,IAAaC,OACnCza,SAAc/Q,GAAE,GAAGD,GAAE,CAAA,KACrBgR,SAAc/Q,GAAE,GAAGD,GAAE,CAAA,KACrBgR,SAAc/Q,GAAE,GAAGD,GAAE,CAAA;AChDvB,IAAasQ,YAAW,CAAC8a,OAAuB;AAC9C,EAAArsB,OAAMgP,EAAA;AACN,QAAM0G,SAAQiX,QACZ;IAAE3d,GAAE;IAAGA,GAAE;IAAGA,GAAE;EAAG,GACjB,CAACrP,IAAUitB,iBAAwB;IACjC,GAAG/sB,GAAE,IAAI,YAAY;IACrB,GAAGA,GAAE,IAAI,YAAY;EACtB,EAAA;AAEH,QAAM,MAAM;IACV,GAAG6V,OAAM,IAAI;IACb,GAAGA,OAAM,IAAI;EACd;AACD,SAAO;AACR;ACED,IAAanD,eAAc,CACzBsa,OACAC,OAAsC,CAAE,MAC9B;AACV,MAAIxd,oBAAmB,KAAA,EACrB,QAAOyd,eAAkB,OAAO,IAAA;WACvB7f,kBAAiB,KAAA,EAC1B,QAAO8f,eAAgB,OAAO,IAAA;AAEhC,QAAM,IAAI,MAAM,wEAAwE;AACzF;AAcD,IAAald,YAAS,CACpBmd,UACU;AACV,MAAI,UAAU,OACZ,QAAO,OAAO,OAAO;IAAE,GAAG;IAAK,GAAG;EAAK,CAAA;WAC9BjgB,QAAO,KAAA,EAChB,QAAOkgB,UAAW,KAAA;WACTZ,YAAW,KAAA,EACpB,QAAOa,UAAiB,KAAA;WACf1d,UAAS,KAAA,EAClB,QAAO2d,QAAa,KAAA;MAEpB,OAAM,IAAI,MAAM,kBAAmB,KAAK,UAAU,KAAA,CAAM,EAAG;AAE9D;AClDD,IAAarb,oBAAiB,CAC5Bsb,IACAC,OACY;AACZ,MAAIhe,oBAAmBpO,EAAA,EACrB,QAAOqsB,gBAAsBrsB,IAAGD,EAAA;WACvBiM,kBAAiBhM,EAAA,EAC1B,QAAOssB,kBAAoBtsB,IAAGD,EAAA;AAEhC,QAAM,IAAI,MACR,iCAAkC,KAAK,UAAUC,EAAA,CAAE,OAAS,KAAK,UAAUD,EAAA,CAAE,EAAG;AAEnF;ACOD,IAAawsB,aAAY,CACvBC,aACA,SAAS,GACTC,aACA1oB,SAAgBic,QAChB0M,SACqB;AACrB,cAAY,YAAY,QAAQ,YAAY,QAAQ,CAAC;AACrD,QAAM,QAAS,KAAK,KAAK,IAAK;AAC9B,QAAM,YAAY,QAAQ;AAE1B,QAAM,eAAe,MAAM,sBAAsB,CAAC,KAAK,KAAK;AAC5D,MAAI,gBAAgB,OAAW,eAAc,cAAc;AAE3D,MAAI1sB,KAAI;AACR,QAAMue,MAAe,CAAE;AAEvB,WAAS,QAAQ,GAAG,QAAQ,QAAQ,SAAS;AAC3C,UAAM,OAAOjb,aAAY,aAAatD,IAAG,MAAA;AACzC,UAAM,OAAOsD,aAAY,aAAatD,KAAI,WAAW,MAAA;AACrD,UAAM,QAAQsD,aAAY,aAAatD,KAAI,WAAW,MAAA;AAEtD,QAAI,KAAK,MAAM,IAAA;AACf,QAAI,QAAQ,IAAI,OAAQ,KAAI,KAAK,KAAA;AACjC,IAAAA,MAAK;EACN;AACD,SAAO;AACR;;;;;;;;;;;;;;AEvCD,IAAaiH,gBAAa,CACxB0lB,WACAC,OAA8B,CAAE,MAC7B;AACH,QAAM,QAAQlM,mBAAkB,GAAG,SAAA;AACnC,SAAOmM,MACL,MAAM,IAAI,CAACrd,OAAM9G,QAAO8G,EAAA,CAAE,GAC1B,IAAA;AAEH;AAsDD,IAAaqd,QAAO,CAAC3G,QAAwB0G,OAA8B,CAAE,MAAgB;AAE3F,QAAM,sBAAsB,KAAK,uBAAuB;AAExD,QAAM,iBAAiB,CAAC9mB,QAAgC;AACtD,UAAM,UAAUwgB,OAAM,IAAI,CAAC3nB,IAAG,UAAU;AACtC,YAAM0Q,YAAU1Q,GAAE,QAAQO,GAAA;AAC1B,YAAMoB,aAAW2O,UAAe/P,KAAImQ,SAAAA;AAGpC,YAAMyd,oBAAmBnuB,GAAE,iBAAiB0Q,WAAS,mBAAA;AACrD,aAAO;QAAE,kBAAAyd;QAAkB,MAAMnuB;QAAG;QAAO,SAAA;QAAS,UAAA;QAAU,MAAM,OAAO;MAAkB;IAC9F,CAAA;AAED,UAAM,WAAW,QAAQ,OAAO,CAACgG,OAAMA,GAAE,YAAY,mBAAA;AACrD,UAAM,SAAS,sBAAsB,UAAU,UAAU;AAIzD,aAASooB,QAAO,GAAGA,QAAO,OAAO,QAAQA,QACvC,QAAQA,KAAA,EAAO,OAAOA;AAExB,WAAO;EACR;AAYD,SAAO;AACR;;;ACzGD,IAAarK,UAAS,CAACsK,SAA4BC,WAA4BC,OAAmB,CAAE,MAAK;AACvG,MAAI,CAAC,MAAM,QAAQ,OAAA,EAAU,OAAM,IAAI,MAAM,qCAAqC;AAClF,QAAM,WAAW,KAAK,YAAY;AAElC,QAAM,SAAS,sBAAsB,SAAS,QAAQ;AACtD,QAAMC,oBAAwC,CAAE;AAEhD,QAAM,UAAU,CAACznB,IAAU4B,WAAmB,kBAAkB,KAAK,CAAA3C,OAAK0nB,gBAAsB1nB,IAAG5E,IAAG,MAAA,CAAO;AAE7G,SAAO,OAAO,SAAS,GAAG;AAExB,UAAMsJ,UAAS,OAAO,IAAA;AACtB,QAAI,CAACA,QAAQ;AAEb,UAAM,kBAAkB;MAAE,GAAG;MAAM,QAAQ;QAAE,GAAGA,QAAO;QAAQ,GAAGA,QAAO;MAAQ;IAAE;AAGnF,aAAS,QAAQ,GAAG,QAAQ,UAAU,SAAS;AAC7C,YAAM,WAAW+jB,aAAkB,WAAW,eAAA;AAC9C,UAAI,CAAC,QAAQ,UAAU/jB,QAAO,MAAA,GAAS;AAErC,0BAAkB,KAAK,OAAO,OAAO;UAAE,GAAGA;UAAQ,GAAG;QAAU,CAAA,CAAC;AAChE;MACD;IACF;EACF;AAED,SAAO;AACR;;;;;AElBD,IAAahC,eAAc,CAACgmB,SAAiBC,SAAiB,cAAc,GAAG,gBAAgB,GAAG,cAAc,SAAkB;EAChI;EAAS;EACT,UAAUzqB,gBAAe,WAAA;EACzB,YAAYA,gBAAe,aAAA;EAC3B,UAAUA,gBAAe,WAAA;AAC1B;;;;;;ACTD,IAAa0qB,uBAAsB,CAACjQ,QAAsBkQ,WAAU,QAAsB;AACxF,QAAM,aAAa,OAAQ,CAAA;AAE3B,QAAM,YAAY,OAAO,GAAG,EAAA;AAC5B,MAAI,OAAO,SAAS,EAClB,QAAO;AAET,MAAI,QAAQ;AACZ,MAAI,eAAe;AACnB,WAAS,SAAS,GAAG,SAAS,OAAO,SAAS,GAAG,UAAU;AACzD,UAAM,gBAAgBC,yBAAwB,OAAQ,MAAA,GAAU,YAAY,SAAA;AAE5E,QAAI,gBAAgB,cAAc;AAChC,qBAAe;AACf,cAAQ;IACT;EACF;AACD,MAAI,eAAeD,UAAS;AAE1B,UAAM,KAAK,OAAO,MAAM,GAAG,QAAQ,CAAA;AACnC,UAAME,MAAK,OAAO,MAAM,KAAA;AACxB,UAAM,KAAKH,qBAAoB,IAAIC,QAAA;AACnC,UAAMG,MAAKJ,qBAAoBG,KAAIF,QAAA;AAEnC,UAAMI,MAAK,CAAE,GAAG,GAAG,MAAM,GAAG,EAAA,GAAM,GAAGD,GAAI;AACzC,WAAOC;EACR,MACC,QAAO,CAAE,YAAY,SAAW;AAEnC;AAqBD,IAAaC,4BAA2B,CAACvQ,QAAsBkQ,WAAU,QAAsB;AAC7F,QAAM,aAAa,OAAQ,CAAA;AAE3B,QAAM,YAAY,OAAO,GAAG,EAAA;AAC5B,MAAI,OAAO,SAAS,EAClB,QAAO;AAET,MAAI,QAAQ;AACZ,MAAI,eAAe;AACnB,WAAS,SAAS,GAAG,SAAS,OAAO,SAAS,GAAG,UAAU;AACzD,UAAM,gBAAgBM,2BAA0B,OAAQ,MAAA,GAAU,YAAY,SAAA;AAC9E,QAAI,gBAAgB,cAAc;AAChC,qBAAe;AACf,cAAQ;IACT;EACF;AACD,MAAI,eAAeN,UAAS;AAE1B,UAAM,KAAK,OAAO,MAAM,GAAG,QAAQ,CAAA;AACnC,UAAME,MAAK,OAAO,MAAM,KAAA;AACxB,UAAM,KAAKG,0BAAyB,IAAIL,QAAA;AACxC,UAAMG,MAAKE,0BAAyBH,KAAIF,QAAA;AAExC,UAAMI,MAAK,CAAE,GAAG,GAAG,MAAM,GAAG,EAAA,GAAM,GAAGD,GAAI;AACzC,WAAOC;EACR,MACC,QAAO,CAAE,YAAY,SAAW;AAEnC;AAGD,SAASE,2BAA0BrvB,IAAUsvB,IAAWC,KAAW;AAEjE,MAAI;AACJ,MAAIxJ;AACJ,MAAI;AACJ,MAAI,GAAG,KAAKyJ,IAAG,EACb,UAAS,KAAK,IAAItvB,GAAE,IAAI,GAAG,CAAA;OACtB;AACL6lB,eAASyJ,IAAG,IAAI,GAAG,MAAMA,IAAG,IAAI,GAAG;AACnC,gBAAY,GAAG,IAAKzJ,UAAQ,GAAG;AAC/B,aAAS,KAAK,IAAIA,UAAQ7lB,GAAE,IAAIA,GAAE,IAAI,SAAA,IAAa,KAAK,KAAK,KAAK,IAAI6lB,SAAO,CAAA,IAAK,CAAA;EACnF;AAED,SAAO;AACR;AAGD,IAAMiJ,2BAA0B,CAAChvB,IAAUyvB,OAAcC,WAAkB;AACzE,QAAM,aAAa7tB,UAAS,OAAO,MAAA;AACnC,MAAI,cAAc,EAChB,QAAOA,UAAS3B,IAAG,KAAA;AAErB,QAAMmP,OAAMnP,GAAE,IAAI,MAAM,MAAM,OAAO,IAAI,MAAM,MAAMA,GAAE,IAAI,MAAM,MAAM,OAAO,IAAI,MAAM,MAAM;AAK9F,MAAImP,KAAI,EACN,QAAOxN,UAAS3B,IAAG,KAAA;AAErB,MAAImP,KAAI,EACN,QAAOxN,UAAS3B,IAAG,MAAA;AAErB,SAAO2B,UAAS3B,IAAG;IAAE,GAAG,MAAM,IAAImP,MAAK,OAAO,IAAI,MAAM;IAAI,GAAG,MAAM,IAAIA,MAAK,OAAO,IAAI,MAAM;EAAI,CAAA;AACpG;;;;;;;AC/GD,IAAYsgB,aAAA,yBAAA,aAAL;;;;;;AAKN,EAAA,CAAA,CAAA;AAcD,IAAaC,YAAW,CAACC,QAAwBC,cAAuC,CAAE,GAAEC,OAA8B,CAAE,MAAmB;AAC7I,QAAMC,KAAkB;IACtB,UAAU,KAAK,YAAY;IAC3B,WAAW,KAAK,aAAa;EAC9B;AAED,QAAMlf,KAAI,IAAImf,cAAa,QAAW,QAAQ,GAAGpoB,EAAA;AACjD,aAAW9B,MAAK,YACd,CAAA+K,GAAE,IAAI/K,EAAA;AAER,SAAO+K;AACR;AAQD,IAAamf,gBAAb,MAAaA,cAAwD;EACnE,SAAyB,CAAE;EAC3B,YAA4B,CAAE;EAC9B;;;;;;;EAOA,YACEC,QACSC,UACAC,OACAC,MACT;AAHS,SAAA,WAAA;AACA,SAAA,QAAA;AACA,SAAA,OAAA;AAET,SAAKC,UAAU;EAChB;EAED,oBAA4B;AAC1B,WAAO,KAAKC,UAAU;EACvB;EAED,CAAC,UAA0C;AAEzC,QAAIC,KAA8B;AAClC,WAAO1f,GAAEwf,YAAY,QAAW;AAC9B,YAAMxf,GAAEwf;AACR,MAAAxf,KAAIA,GAAEwf;IACP;EACF;EAED,YAAY;AACV,WAAO,KAAKA;EACb;;;;EAKD,CAAC,WAA2C;AAC1C,eAAW1uB,MAAK,KAAK2uB,UACnB,OAAM3uB;EAET;;;;;EAMD,WAAW;AACT,WAAO,KAAK6uB;EACb;EAED,cAAc;AACZ,WAAO;EACR;;;;;;EAMD,UAAUC,IAAwC;AAChD,WAAO,KAAKH,UAAWxqB,EAAA;EACxB;;;;;;EAOD,IAAI4qB,IAA0B;AAC5B,QAAI,CAAAC,kBAAuB,KAAK,UAAU1wB,EAAA,EAAI,QAAO;AAErD,QAAI,KAAKqwB,UAAU,SAAS,GAAG;AAC7B,iBAAWxqB,MAAK,KAAKwqB,UAAY,CAAAxqB,GAAG,IAAI7F,EAAA;AACxC,aAAO;IACR;AAED,SAAKuwB,OAAO,KAAKvwB,EAAA;AAEjB,QACE,KAAKuwB,OAAO,SAAS,KAAK,KAAK,YAC/B,KAAK,QAAQ,KAAK,KAAK,WACvB;AACA,UAAI,KAAKF,UAAU,WAAW,EAC5B,MAAKM,WAAAA;AAIP,iBAAW,QAAQ,KAAKJ,OACtB,YAAW1qB,MAAK,KAAKwqB,UAAY,CAAAxqB,GAAG,IAAI,IAAA;AAG1C,WAAK0qB,SAAS,CAAE;IACjB;AACD,WAAO;EACR;;;;;;EAOD,UAAUzwB,IAAU;AAClB,WAAO8wB,iBAAqB,KAAK,UAAU5wB,EAAA;EAC5C;EAED,aAAa;AACX,UAAMgpB,KAAI,KAAK,SAAS,QAAQ;AAChC,UAAMC,KAAI,KAAK,SAAS,SAAS;AACjC,UAAMzhB,KAAI,KAAK,SAAS;AACxB,UAAMxF,KAAI,KAAK,SAAS;AAGxB,UAAM,SAAS6uB,aAAkBrpB,KAAIwhB,IAAGhnB,IAAGwF,IAAGxF,IAAGwF,IAAGxF,KAAIinB,IAAGzhB,KAAIwhB,IAAGhnB,KAAIinB,EAAA;AACtE,UAAM,QAAQ,OAAO,IAAI,CAACjpB,OAAMqP,aAAiBrP,IAAGgpB,IAAGC,EAAA,CAAE;AAIzD,SAAKoH,YAAY,MAAM,IACrB,CAAC5f,OAAM,IAAIsf,cAAa,MAAMtf,IAAG,KAAK,QAAQ,GAAG,KAAK,IAAA,CAAA;EAEzD;AACF;;;;;;;AEpLD,IAAMqgB,OAAM,KAAK;AACjB,IAAMC,OAAM,KAAK;AACjB,IAAMC,QAAO,KAAK;AAClB,IAAMC,QAAO,KAAK;AAClB,IAAMC,OAAM,KAAK;AACjB,IAAMC,MAAK,KAAK;AAChB,IAAMC,UAAO,KAAK,KAAK;AACvB,IAAMC,eAAcF,OAAM,IAAIF,MAAK,CAAA;AACnC,IAAMK,kBAAiB,IAAIL,MAAK,CAAA,KAAM;AA0DtC,UAAiBM,mBACfC,SACAC,OAAwB,CAAE,GACD;AACzB,QAAM,YAAY,KAAK,aAAa;AACpC,QAAM,UAAU,KAAK,WAAW;AAChC,QAAM,iBAAiB,KAAK,YAAY;AAExC,QAAMC,KAAIC,cAAmBC,WAAU;IAAE,QAAQ;IAAG,GAAG;IAAG,GAAG;EAAG,CAAA;AAChE,QAAMC,OAAMH,GAAE;AAEd,MAAI,UAAUA,GAAE,SAAS,MAAM,SAAS,GAAG,GAAG,KAAK,IAAA;AACnD,MAAI,KAAK,QAAS,WAAU,KAAK;AAGjC,MAAI,SAAS;AAEb,MAAII,SAAQ;AAEZ,MAAI,QAAQ;AACZ,SAAOA,SAAQ,aAAa,SAASD,MAAK;AACxC,aAAS,UAAUC,UAAS;AAC5B,YAAQ,iBAAkBA,SAAQ,IAAIX,MAAMG;AAC5C,UAAM,OAAO,OAAO;MAClB,GAAGI,GAAE,IAAI,SAASZ,KAAI,KAAA;MACtB,GAAGY,GAAE,IAAI,SAASX,KAAI,KAAA;IACvB,CAAA;AACD,IAAAe;EACD;AACF;AA2BD,UAAiBC,aACfC,SACAC,OAAwB,CAAE,GACD;AACzB,QAAM,QAAQ,KAAK,SAAS;AAC5B,QAAMP,KAAIC,cAAmBC,WAAU;IAAE,QAAQ;IAAG,GAAG;IAAG,GAAG;EAAG,CAAA;AAChE,QAAM,QAAQ,IAAI;AAClB,QAAM,iBAAiB,KAAK,YAAY;AAGxC,MAAI,YAAY;AAGhB,QAAM,OAAO,OAAO;IAAE,GAAGF,GAAE;IAAG,GAAGA,GAAE;EAAG,CAAA;AAGtC,WAASQ,KAAI,OAAOA,MAAK,GAAGA,MAAK,OAAO;AACtC,UAAMC,KAAI,KAAK,MAAMhB,MAAKH,MAAK,KAAK,IAAI,UAAA,CAAW;AACnD,eAAW,SAAS,YAAY,GAAGI,SAAMe,KAAI,CAAA,EAC3C,OAAM,OAAO,OAAO;MAClB,GAAGT,GAAE,IAAIQ,KAAIpB,KAAI,QAAQ,cAAA,IAAkBY,GAAE;MAC7C,GAAGA,GAAE,IAAIQ,KAAInB,KAAI,QAAQ,cAAA,IAAkBW,GAAE;IAC9C,CAAA;AAEH;EACD;AACF;AAuBD,UAAiBU,iBACf,UAAU,KACV,kBAAkB,GAClBC,QAC2B;AAC3B,QAAMC,WAAS,IAAI;AACnB,QAAMC,KAAI,UAAU;IAAE,GAAG;IAAG,GAAG;IAAG,GAAG;IAAG,QAAQ;EAAG;AAEnD,WAAS,QAAQ,GAAG,QAAQ,SAAS,SAAS;AAC5C,UAAMC,KAAI,QAAQF,WAAS,IAAIA,WAAS;AACxC,UAAMJ,KAAIjB,MAAK,IAAIC,KAAIsB,IAAG,CAAA,CAAE;AAC5B,UAAMC,MAAM,QAAQ,KAAK,UAAWpB,eAAc;AAClD,UAAMqB,KAAI5B,KAAI2B,EAAA,IAAKP;AACnB,UAAMS,KAAI5B,KAAI0B,EAAA,IAAKP;AAEnB,UAAM,OAAO,OAAO;MAClB,GAAGK,GAAE,IAAIG,KAAIH,GAAE;MACf,GAAGA,GAAE,IAAIC,KAAID,GAAE;MACf,GAAGA,GAAE,IAAII,KAAIJ,GAAE;IAChB,CAAA;EACF;AACF;AC5LD,IAAaK,UAAS,CAACC,OAAuC;AAC5D,EAAAC,OAAMC,EAAA;AACN,SAAO;IACLC,aAAkBD,GAAE,GAAGA,GAAE,CAAA;IACzBC,aAAkBD,GAAE,GAAGA,GAAE,CAAA;IACzBC,aAAkBD,GAAE,GAAGA,GAAE,CAAA;EAC1B;AACF;AAOD,IAAaE,iBAAgB,CAACJ,OAAuC;AACnE,EAAAC,OAAMC,EAAA;AACN,SAAOG,gBAAeN,QAAOG,EAAA,CAAE;AAChC;ACjBD,IAAaI,SAAQ,CAACN,OAA0B;AAC9C,EAAAC,OAAMC,EAAA;AACN,SAAOK,mBAAkBL,GAAE,GAAGA,GAAE,GAAGA,GAAE,GAAGA,GAAE,CAAA;AAC3C;ACHD,IAAaM,UAAO,CAACR,OAAwB;AAC3C,EAAAC,OAAMC,IAAG,GAAG;AAGZ,QAAMO,YAAUH,OAAMJ,EAAA,EAAG,IAAI,CAACQ,OAAMC,QAAYD,EAAA,CAAE;AAGlD,QAAME,MAAKH,UAAS,CAAA,IAAMA,UAAS,CAAA,IAAMA,UAAS,CAAA,KAAO;AACzD,SAAO,KAAK,KAAKG,MAAKA,KAAIH,UAAS,CAAA,MAAQG,KAAIH,UAAS,CAAA,MAAQG,KAAIH,UAAS,CAAA,EAAA;AAC9E;ACLD,IAAaI,oBAAmB,CAC9Bb,IACAc,IACAC,OACqB;AACrB,QAAMC,MAAKC,mBAAkBrB,IAAGsB,EAAA;AAEhC,QAAM,KAAK,CAACC,IAAWC,IAAWC,KAAWC,QAC1CC,IAAG,IAAI,GAAG,KAAK1B,MAAK,GAAG,IAAI0B,IAAG,KAAK5B,KAAI4B,IAAG,IAAI,GAAG,IAAI,GAAG,IAAIA,IAAG;AAElE,QAAM,QAAQ,GAAGP,IAAG,GAAGA,IAAG,GAAGd,GAAE,GAAGA,GAAE,CAAA,IAAK,GAAGA,GAAE,EAAE,GAAGA,GAAE,EAAE,GAAGA,GAAE,GAAGA,GAAE,CAAA;AACjE,QAAM,QAAQ,GAAGc,IAAG,GAAGA,IAAG,GAAGd,GAAE,GAAGA,GAAE,CAAA,IAAK,GAAGA,GAAE,EAAE,GAAGA,GAAE,EAAE,GAAGA,GAAE,GAAGA,GAAE,CAAA;AACjE,QAAM,QAAQ,GAAGc,IAAG,GAAGA,IAAG,GAAGd,GAAE,GAAGA,GAAE,CAAA,IAAK,GAAGA,GAAE,EAAE,GAAGA,GAAE,EAAE,GAAGA,GAAE,GAAGA,GAAE,CAAA;AAEjE,SAAO;IACL,GAAG;IACH,GAAG;IACH,GAAG;EACJ;AACF;AAQD,IAAasB,2BAA0B,CACrCxB,IACAyB,OACU;AACV,EAAAxB,OAAMC,EAAA;AACN,QAAM,EAAE,GAAAN,IAAG,GAAAsB,IAAG,GAAArC,GAAA,IAAMqB;AAEpB,QAAML,KAAID,GAAE,IAAI,GAAG,IAAIsB,GAAE,IAAI,GAAG,IAAIrC,GAAE,IAAI,GAAG;AAC7C,QAAMc,KAAIC,GAAE,IAAI,GAAG,IAAIsB,GAAE,IAAI,GAAG,IAAIrC,GAAE,IAAI,GAAG;AAE7C,MAAIe,GAAE,KAAKsB,GAAE,KAAKrC,GAAE,GAAG;AACrB,UAAMiB,KAAIF,GAAE,IAAI,GAAG,IAAIsB,GAAE,IAAI,GAAG,IAAIrC,GAAE,IAAI,GAAG;AAC7C,WAAO,OAAO,OAAO;MAAE,GAAAgB;MAAG,GAAAF;MAAG,GAAAG;IAAG,CAAA;EACjC,MACC,QAAO,OAAO,OAAO;IAAE,GAAAD;IAAG,GAAAF;EAAG,CAAA;AAEhC;AChDD,IAAa+B,QAAO,CAAC1B,IAAa,YAAY,MAAsB;AAClE,QAAM,EAAE,GAAAJ,IAAG,GAAAsB,IAAG,GAAArC,GAAA,IAAMqB;AACpB,QAAM,OAAO,KAAK,IAAIN,GAAE,GAAGsB,GAAE,GAAGrC,GAAE,CAAA,IAAK;AACvC,QAAM,OAAO,KAAK,IAAIe,GAAE,GAAGsB,GAAE,GAAGrC,GAAE,CAAA,IAAK;AACvC,QAAM,OAAO,KAAK,IAAIe,GAAE,GAAGsB,GAAE,GAAGrC,GAAE,CAAA,IAAK;AACvC,QAAM,OAAO,KAAK,IAAIe,GAAE,GAAGsB,GAAE,GAAGrC,GAAE,CAAA,IAAK;AAEvC,QAAM8C,KAAoB;IACxB,GAAG;IACH,GAAG;IACH,OAAO,OAAO;IACd,QAAQ,OAAO;EAChB;AACD,SAAOtC;AACR;ACdD,IAAauC,WAAU,CAAC5B,OAAsC;AAC5D,EAAAC,OAAMC,EAAA;AACN,SAAO;IAAEA,GAAE;IAAGA,GAAE;IAAGA,GAAE;EAAG;AACzB;ACWD,IAAa2B,cAAa,CACxBC,QACAC,QACAC,OAAiD,CAAE,MACtC;AACb,cAAY,WAAW,QAAQ,YAAY,QAAQ,CAAC;AACpDC,EAAAA,SAAW,QAAQ,QAAQ;AAE3B,QAAM,qBAAqB,KAAK,sBAAsB;AAEtD,QAAMlC,WAAS;IACb;IACA,qBAAsBxB,QAAO,IAAK;IAClC,qBAAsBA,QAAO,IAAK;EACnC;AACD,QAAM,SAASwB,SAAO,IAAI,CAACH,OAAMsC,aAAiB,QAAQtC,IAAG,MAAA,CAAO;AACpE,SAAOuC,YAAW,MAAA;AACnB;AASD,IAAaC,iBAAgB,CAACC,WAAwC;AACpE,MAAI,CAAC,MAAM,QAAQ,MAAA,EAAS,OAAM,IAAI,MAAM,0BAA0B;AACtE,MAAI,OAAO,WAAW,EACpB,OAAM,IAAI,MACR,8CAA+C,OAAO,MAAA,EAAS;AAGnE,SAAOF,YAAWG,aAAkB,GAAG,MAAA,CAAO;AAC/C;AAQD,IAAaH,cAAa,CAACI,WAAuC;AAChE,MAAI,CAAC,MAAM,QAAQ,MAAA,EAAS,OAAM,IAAI,MAAM,0BAA0B;AACtE,MAAI,OAAO,WAAW,EACpB,OAAM,IAAI,MACR,8CAA+C,OAAO,MAAA,EAAS;AAGnE,QAAMvC,KAAc;IAClB,GAAG,OAAQ,CAAA;IACX,GAAG,OAAQ,CAAA;IACX,GAAG,OAAQ,CAAA;EACZ;AACD,SAAOE;AACR;ACpED,IAAasC,eAAY,CAACxC,OAAwB;AAChD,EAAAC,OAAMC,EAAA;AACN,SAAOI,OAAMJ,EAAA,EAAG,OAAO,CAAC,aAAauC,OAAM,cAAc9B,QAAY8B,EAAA,GAAI,CAAA;AAC1E;ACHD,IAAaC,eAAc,CAAC1C,OAAkC;AAC5D,QAAMnB,KAAI8D,UAASzC,EAAA;AACnB,QAAMU,KAAI4B,aAAUtC,EAAA,IAAK;AACzB,QAAMN,KAAIY,QAAKN,EAAA;AACf,QAAM,SAASN,KAAIgB;AACnB,SAAO;IAAE;IAAQ,GAAG/B;EAAG;AACxB;ACHD,IAAa+D,qBAAkB,CAC7B5C,IACAc,IACAC,OACY;AACZ,QAAM,MAAMW,MAAKxB,EAAA;AAEjB,QAAMc,MAAKC,mBAAkBrB,IAAGsB,EAAA;AAGhC,MAAI,CAAC2B,iBAAqB,KAAK7B,GAAA,EAAK,QAAO;AAE3C,QAAM,KAAKH,kBAAiBX,IAAGc,GAAA;AAE/B,SACE,KAAK,GAAG,KAAK,GAAG,KAAK,KAAK,KAAK,GAAG,KAAK,GAAG,KAAK,KAAK,KAAK,GAAG,KAAK,GAAG,KAAK;AAE5E;ACtBD,IAAaP,WAAU,CAACT,OAAuC;AAC7D,EAAAC,OAAMC,EAAA;AACN,SAAO;IACL4C,UAAS5C,GAAE,GAAGA,GAAE,CAAA;IAChB4C,UAAS5C,GAAE,GAAGA,GAAE,CAAA;IAChB4C,UAAS5C,GAAE,GAAGA,GAAE,CAAA;EACjB;AACF;ACLD,IAAa6C,iBAAgB,CAAC/C,OAAyB;AACrD,EAAAC,OAAMC,EAAA;AACN,QAAM,CAAEN,IAAGsB,IAAGrC,EAAA,IAAM4B,SAAQP,EAAA;AAC5B,SAAON,OAAMsB,MAAKA,OAAMrC;AACzB;AAOD,IAAamE,eAAc,CAAChD,OAAyB;AACnD,QAAM,CAAEJ,IAAGsB,IAAGrC,EAAA,IAAM4B,SAAQP,EAAA;AAC5B,MAAIN,OAAMsB,GAAG,QAAO;AACpB,MAAIA,OAAMrC,GAAG,QAAO;AACpB,MAAIA,OAAMe,GAAG,QAAO;AACpB,SAAO;AACR;AAOD,IAAaqD,gBAAe,CAACjD,OAC3BD,QAAOG,EAAA,EAAG,SAAS,KAAK,KAAK,CAAA;AAO/B,IAAagD,aAAY,CAAClD,OAAyB,CAACiD,cAAa/C,EAAA;AAOjE,IAAaiD,WAAU,CAACnD,OACtB,CAACD,QAAOG,EAAA,EAAG,KAAK,CAACuC,OAAMA,MAAK,KAAK,KAAK,CAAA;AAOxC,IAAaW,YAAW,CAACpD,OACvBD,QAAOG,EAAA,EAAG,KAAK,CAACuC,OAAMA,KAAI,KAAK,KAAK,CAAA;ACtCtC,IAAaY,SAAQ,CACnBrD,IACAsD,QAEA,OAAO,OAAiB;EACtB,GAAGpD;EACH,GAAGqD,IAAGrD,GAAE,GAAG,GAAG;EACd,GAAGqD,IAAGrD,GAAE,GAAG,GAAG;EACd,GAAGqD,IAAGrD,GAAE,GAAG,GAAG;AACf,CAAA;AClBH,IAAasD,eAAc,CAACxD,OAAkC;AAC5D,QAAM,CAAEJ,IAAGsB,IAAGrC,EAAA,IAAMyB,OAAMJ,EAAA,EAAG,IAAI,CAACQ,OAAMC,QAAYD,EAAA,CAAE;AACtD,QAAM,OAAOiC,UAASzC,EAAA;AACtB,QAAM,SACHN,KAAIsB,KAAIrC,KACT,KAAK,MAAMe,KAAIsB,KAAIrC,OAAM,CAACe,KAAIsB,KAAIrC,OAAMe,KAAIsB,KAAIrC,OAAMe,KAAIsB,KAAIrC,GAAA;AAChE,SAAO;IACL;IACA,GAAG;EACJ;AACF;ACCD,IAAa4E,YAAS,CACpBC,WACAC,cACAC,WACa;AACb,MAAI,iBAAiB,UAAa,iBAAiB,EAAG,QAAOC;AAC7D,MAAI,WAAW,OAAW,UAASlB,UAASkB,SAAA;AAC5C,SAAO,OAAO,OAAO;IACnB,GAAGA;IACH,GAAGC,QAAaD,UAAS,GAAG,cAAc,MAAA;IAC1C,GAAGC,QAAaD,UAAS,GAAG,cAAc,MAAA;IAC1C,GAAGC,QAAaD,UAAS,GAAG,cAAc,MAAA;EAC3C,CAAA;AACF;AAeD,IAAaE,kBAAiB,CAC5BL,WACAM,cACAC,SAA0B,QACb;AACb,QAAM,SACJ,WAAW,MAAMJ,UAAS,IAAK,WAAW,MAAMA,UAAS,IAAIA,UAAS;AACxE,SAAO,OAAO,OAAO;IACnB,GAAGC,QAAaD,UAAS,GAAG,cAAc,MAAA;IAC1C,GAAGC,QAAaD,UAAS,GAAG,cAAc,MAAA;IAC1C,GAAGC,QAAaD,UAAS,GAAG,cAAc,MAAA;EAC3C,CAAA;AACF;ACrDD,IAAaK,eAAc,CAAClE,OAAmC;AAC7D,EAAAC,OAAMC,EAAA;AACN,SAAO;IAAEA,GAAE,EAAE;IAAGA,GAAE,EAAE;IAAGA,GAAE,EAAE;IAAGA,GAAE,EAAE;IAAGA,GAAE,EAAE;IAAGA,GAAE,EAAE;EAAG;AACpD;;;;;;;;;;;;;ACRD,IAAMiE,YAAY,KAAK,KAAK,IAAK;AACjC,IAAMC,YAAY,KAAK,KAAK,IAAK;AAQjC,IAAMC,iBAAgB,CAACC,OAAmC;AACxD,MAAI,OAAOpE,OAAM,SAAU,QAAOA;AAClC,SAAOA,GAAE;AACV;AAmBD,IAAaqE,gBAAa,CACxBD,IACAV,QACAY,gBACa;AACb,MAAI,CAAC,OAAQ,UAAS,OAAO,OAAO;IAAE,GAAG;IAAG,GAAG;EAAG,CAAA;AAElD,QAAMnF,KAAIgF,eAAcnE,EAAA,IAAK,KAAK,KAAK,CAAA;AACvC,QAAM,MAAM,eAAe,KAAK,KAAK;AACrC,QAAMgB,KAAI;IACR,GAAG7B,KAAI,KAAK,IAAI,GAAA,IAAO,OAAO;IAC9B,GAAGA,KAAI,KAAK,IAAI,GAAA,IAAO,OAAO;EAC/B;AACD,QAAMO,KAAI;IACR,GAAGP,KAAI,KAAK,IAAI,MAAM8E,SAAA,IAAY,OAAO;IACzC,GAAG9E,KAAI,KAAK,IAAI,MAAM8E,SAAA,IAAY,OAAO;EAC1C;AACD,QAAMtF,KAAI;IACR,GAAGQ,KAAI,KAAK,IAAI,MAAM+E,SAAA,IAAY,OAAO;IACzC,GAAG/E,KAAI,KAAK,IAAI,MAAM+E,SAAA,IAAY,OAAO;EAC1C;AAED,SAAO,OAAO,OAAO;IAAE,GAAAxE;IAAG,GAAAsB;IAAG,GAAArC;EAAG,CAAA;AACjC;AAQD,IAAa4F,eAAc,CACzBH,IACAI,QACU;AACV,MAAI,CAAC,IAAK,OAAM,OAAO,OAAO;IAAE,GAAG;IAAG,GAAG;EAAG,CAAA;AAE5C,QAAMrF,KAAIgF,eAAcnE,EAAA;AACxB,QAAM,EAAE,OAAA,IAAWyE,YAASzE,EAAA;AAC5B,SAAO;IACL,GAAG,IAAI,IAAIb,KAAI;IACf,GAAG,IAAI,IAAI;EACZ;AACF;AAQD,IAAauF,eAAc,CACzBN,IACAO,QACU;AACV,MAAI,CAAC,IAAK,OAAM,OAAO,OAAO;IAAE,GAAG;IAAG,GAAG;EAAG,CAAA;AAE5C,QAAM,EAAE,OAAA,IAAWF,YAASzE,EAAA;AAC5B,SAAO;IACL,GAAG,IAAI;IACP,GAAG,IAAI,IAAI,SAAS;EACrB;AACF;AAQD,IAAa4E,eAAc,CACzBR,IACAS,QACU;AACV,MAAI,CAAC,IAAK,OAAM,OAAO,OAAO;IAAE,GAAG;IAAG,GAAG;EAAG,CAAA;AAE5C,QAAM1F,KAAIgF,eAAcnE,EAAA;AACxB,QAAM,EAAE,OAAA,IAAWyE,YAASzE,EAAA;AAE5B,SAAO;IACL,GAAG,IAAI,IAAIb,KAAI;IACf,GAAG,IAAI,IAAI;EACZ;AACF;AAgBD,IAAa2F,YAAS,CAACV,OACpB,KAAK,KAAK,CAAA,IAAK,IAAKD,eAAcnE,EAAA;AAErC,IAAasC,eAAY,CAAC8B,OACxBD,eAAcnE,EAAA,IAAK;AAErB,IAAaM,UAAO,CAAC8D,OAClB,KAAK,IAAID,eAAcnE,EAAA,GAAI,CAAA,IAAK,KAAK,KAAK,CAAA,IAAM;AAMnD,IAAa+E,kBAAe,CAACX,QAAoC,EAC/D,QAAS,KAAK,KAAK,CAAA,IAAK,IAAKD,eAAcnE,EAAA,EAC5C;AAOD,IAAayE,cAAW,CAACL,QAAoC,EAC3D,QAAS,KAAK,KAAK,CAAA,IAAK,IAAKD,eAAcnE,EAAA,EAC5C;;;;;;;;;;;;;;;;;;;;;;;AChID,IAAagF,WAAQ,CACnBC,IACAvB,WACa;AACb,MAAI,CAAC,OAAQ,UAAS,OAAO,OAAO;IAAE,GAAG;IAAG,GAAG;EAAG,CAAA;AAClD,QAAMwB,MAAKC,gBAAenF,EAAA;AAC1B,QAAM,MAAMoF,oBAAmBpF,EAAA;AAC/B,QAAMqF,KAAIP,UAAO9E,EAAA;AACjB,QAAMN,KAAI;IAAE,GAAG,OAAO;IAAG,GAAG,OAAO;EAAG;AACtC,QAAMsB,KAAI;IAAE,GAAG,OAAO,IAAIkE,IAAG;IAAY,GAAG,OAAO;EAAG;AACtD,QAAMvG,KAAI;IAAE,GAAG,OAAO,IAAI,IAAK,CAAA;IAAK,GAAG,OAAO,IAAI0G;EAAG;AACrD,SAAO;IAAE,GAAA3F;IAAG,GAAAsB;IAAG,GAAArC;EAAG;AACnB;AAiBD,IAAa2G,WAAQ,CACnBL,IACAvB,WACa;AACb,MAAI,CAAC,OAAQ,UAAS,OAAO,OAAO;IAAE,GAAG;IAAG,GAAG;EAAG,CAAA;AAElD,QAAMwB,MAAKC,gBAAenF,EAAA;AAC1B,QAAM,MAAMoF,oBAAmBpF,EAAA;AAC/B,QAAMqF,KAAIP,UAAO9E,EAAA;AACjB,QAAMgB,KAAI;IAAE,GAAG,OAAO;IAAG,GAAG,OAAO;EAAG;AACtC,QAAMtB,KAAI;IAAE,GAAG,OAAO,IAAIwF,IAAG;IAAY,GAAG,OAAO;EAAG;AACtD,QAAMvG,KAAI;IAAE,GAAG,OAAO,IAAI,IAAK,CAAA;IAAK,GAAG,OAAO,IAAI0G;EAAG;AACrD,SAAO;IAAE,GAAA3F;IAAG,GAAAsB;IAAG,GAAArC;EAAG;AACnB;AAuBD,IAAa4G,WAAQ,CACnBN,IACAvB,WACa;AACb,MAAI,CAAC,OAAQ,UAAS,OAAO,OAAO;IAAE,GAAG;IAAG,GAAG;EAAG,CAAA;AAElD,QAAM,MAAM0B,oBAAmBpF,EAAA;AAC/B,QAAMqF,KAAIP,UAAO9E,EAAA;AACjB,QAAMrB,KAAI;IAAE,GAAG,OAAO;IAAG,GAAG,OAAO;EAAG;AACtC,QAAMe,KAAI;IAAE,GAAG,OAAO,IAAI,IAAK,CAAA;IAAK,GAAG,OAAO,IAAI2F;EAAG;AACrD,QAAMrE,KAAI;IAAE,GAAG,OAAO,IAAI,IAAK,CAAA;IAAK,GAAG,OAAO,IAAIqE;EAAG;AACrD,SAAO;IAAE,GAAA3F;IAAG,GAAAsB;IAAG,GAAArC;EAAG;AACnB;AAQD,IAAawG,kBAAiB,CAACF,OAA2B;AACxD,QAAMvF,KAAIM,GAAE;AACZ,QAAMwF,KAAIxF,GAAE;AACZ,QAAMqF,KAAIrF,GAAE;AAEZ,MAAIN,OAAM,UAAa8F,OAAM,OAC3B,QAAO;IACL,GAAGxF;IACH,UAAUN;IACV,UAAU8F;IACV,YAAY,KAAK,MAAM9F,IAAG8F,EAAA;EAC3B;WACQ9F,MAAK2F,GACd,QAAO;IACL,GAAGrF;IACH,UAAUN;IACV,YAAY2F;IACZ,UAAUA,KAAIA,KAAI3F,KAAIA;EACvB;WACQ8F,MAAKH,GACd,QAAO;IACL,GAAGrF;IACH,YAAYqF;IACZ,UAAUG;IACV,UAAUH,KAAIA,KAAIG,KAAIA;EACvB;WACQxF,GAAE,YAAYA,GAAE,cAAcA,GAAE,SACzC,QAAOA;AAET,QAAM,IAAI,MAAM,4BAA4B;AAC7C;AAOD,IAAa8E,YAAS,CAACG,OAAqB;AAC1C,QAAMC,MAAKC,gBAAenF,EAAA;AAC1B,QAAMU,KAAKwE,IAAG,WAAWA,IAAG,WAAYA,IAAG;AAC3C,QAAMO,KAAKP,IAAG,WAAWA,IAAG,WAAYA,IAAG;AAC3C,SAAO,KAAK,KAAKxE,KAAI+E,EAAA;AACtB;AAUD,IAAaL,sBAAqB,CAChCH,OACsC;AACtC,QAAMC,MAAKC,gBAAenF,EAAA;AAC1B,QAAMU,KAAKwE,IAAG,WAAWA,IAAG,WAAYA,IAAG;AAC3C,QAAMO,KAAKP,IAAG,WAAWA,IAAG,WAAYA,IAAG;AAC3C,SAAO,CAAExE,IAAG+E,EAAG;AAChB;AAED,IAAanD,eAAY,CAAC2C,OAAqB;AAC7C,QAAMC,MAAKC,gBAAenF,EAAA;AAC1B,SAAOkF,IAAG,WAAWA,IAAG,aAAaA,IAAG;AACzC;AAED,IAAa5E,UAAO,CAAC2E,OAAqB;AACxC,QAAMC,MAAKC,gBAAenF,EAAA;AAC1B,SAAQkF,IAAG,WAAWA,IAAG,WAAY;AACtC;AAOD,IAAaQ,iBAAgB,CAACT,OAAqB;AACjD,QAAMC,MAAKC,gBAAenF,EAAA;AAC1B,SAAO,KAAK,MACTkF,IAAG,WAAWA,IAAG,WAChBA,IAAG,aAAaA,IAAG,aACnBA,IAAG,WAAWA,IAAG,aAClB,IAAIA,IAAG,WAAWA,IAAG,WAAA;AAEzB;AAOD,IAAaS,iBAAgB,CAACV,OAAqB;AACjD,QAAMC,MAAKC,gBAAenF,EAAA;AAC1B,SAAO,KAAK,MACTkF,IAAG,WAAWA,IAAG,WAChBA,IAAG,aAAaA,IAAG,aACnBA,IAAG,WAAWA,IAAG,aAClB,IAAIA,IAAG,WAAWA,IAAG,WAAA;AAEzB;AAUD,IAAaU,aAAU,CACrBX,OACiD;AACjD,QAAMC,MAAKC,gBAAenF,EAAA;AAC1B,QAAMgB,KAAIkE,IAAG,WAAWA,IAAG;AAC3B,QAAMvG,KAAIuG,IAAG,aAAaA,IAAG;AAC7B,QAAMxF,KAAIwF,IAAG,WAAWA,IAAG;AAE3B,SAAO;IACL,KAAK,KAAK,KAAKlE,KAAIrC,MAAKe,EAAA,IAAK;IAC7B,KAAK,KAAK,KAAKf,KAAIe,MAAKsB,EAAA,IAAK;IAC7B,KAAK,KAAK,KAAKtB,KAAIsB,MAAKrC,EAAA,IAAK;EAC9B;AACF;AAOD,IAAaoG,kBAAe,CAACE,OAAqB;AAChD,QAAMC,MAAKC,gBAAenF,EAAA;AAC1B,SAAO,EAAE,QAAQkF,IAAG,aAAa,EAAG;AACrC;AAOD,IAAaT,cAAW,CAACQ,OAAqB;AAC5C,QAAMC,MAAKC,gBAAenF,EAAA;AAC1B,SAAO,EACL,SAASkF,IAAG,WAAWA,IAAG,WAAWA,IAAG,cAAc,EACvD;AACF;AAoBD,IAAaW,wBAAuB,CAClCC,UACAC,aACW,KAAK,IAAI,QAAA,IAAY;AAoBlC,IAAaC,0BAAyB,CACpCF,UACAG,eACW,KAAK,IAAI,QAAA,IAAY;AAmBlC,IAAaC,0BAAyB,CACpCC,eACAF,eACW,KAAK,IAAIG,aAAAA,IAAe;AAmBrC,IAAaC,wBAAuB,CAClCF,eACAG,aACW,WAAW,KAAK,IAAIF,aAAAA;AAqBjC,IAAaG,0BAAyB,CACpCJ,eACAG,aACW,WAAW,KAAK,IAAIF,aAAAA;AAqBjC,IAAaI,0BAAyB,CACpCL,eACAJ,aACW,WAAW,KAAK,IAAIK,aAAAA;;;;;;;;;;;;;;;;;ACpYjC,IAAaK,aAAY,CAACC,OACxB,KAAK,KAAK1G,GAAE,QAAQ,IAAIA,GAAE,KAAA;AAE5B,IAAa2G,aAAY,CAACD,OAAyB;AACjD,QAAME,MAAK5G,GAAE,OAAOA,GAAE;AACtB,QAAM,KAAKA,GAAE,OAAOA,GAAE;AACtB,SAAO,KAAK,MAAM,IAAI4G,MAAK,OAAO,IAAIA,IAAA;AACvC;AAED,IAAa9B,UAAS,CAAC4B,OAAyB;AAC9C,QAAME,MAAK5G,GAAE,OAAOA,GAAE;AACtB,QAAM,KAAKA,GAAE,OAAOA,GAAE;AACtB,SAAO,KAAK,MAAM,IAAI4G,MAAK,MAAM,CAAA;AAClC;AAED,IAAaC,cAAa,CAACH,OAAyB;AAClD,QAAM1F,KAAIyF,WAAUzG,EAAA;AACpB,SAAOA,GAAE,OAAO,KAAK,IAAIgB,EAAA;AAC1B;AAED,IAAasB,aAAY,CAACoE,OAAyB,IAAI1G,GAAE,OAAOA,GAAE;AAElE,IAAaM,QAAO,CAACoG,OAAyB;AAC5C,QAAMrB,KAAIP,QAAO9E,EAAA;AACjB,SAAQqF,KAAIrF,GAAE,OAAQ;AACvB;AAED,IAAa+E,gBAAe,CAAC2B,OAAyB;AACpD,QAAMrB,KAAIP,QAAO9E,EAAA;AACjB,QAAM8G,MAAKzB,KAAIA;AACf,QAAM,KAAKrF,GAAE,OAAOA,GAAE;AACtB,SAAO,EAAE,SAAS,IAAI8G,MAAK,OAAO,IAAIzB,IAAI;AAC3C;AAED,IAAaZ,YAAW,CAACiC,OAAyB;AAChD,QAAMrB,KAAIP,QAAO9E,EAAA;AACjB,SAAO,EAAE,QAASA,GAAE,OAAOqF,MAAM,IAAIrF,GAAE,OAAOA,GAAE,MAAO;AACxD;AAED,IAAa4F,WAAU,CACrBc,OACiD;AACjD,QAAME,MAAK5G,GAAE,OAAOA,GAAE;AACtB,QAAM,KAAKA,GAAE,OAAOA,GAAE;AACtB,QAAM,WAAW,KAAK,KAAK4G,MAAK,IAAI,EAAA,IAAM;AAC1C,QAAM,UAAU,KAAK,KAAK,IAAIA,MAAK,EAAA,IAAM;AACzC,SAAO;IAAE;IAAU;IAAU;EAAS;AACvC;AAWD,IAAavC,cAAa,CACxBqC,IACAhD,WACa;AACb,MAAI,CAAC,OAAQ,UAAS,OAAO,OAAO;IAAE,GAAG;IAAG,GAAG;EAAG,CAAA;AAClD,QAAM2B,KAAIP,QAAO9E,EAAA;AACjB,QAAM,YAAYyE,UAASzE,EAAA,EAAG;AAC9B,QAAM,iBAAiBqF,KAAI;AAE3B,QAAM3F,KAAI;IAAE,GAAG,OAAO,IAAIM,GAAE,OAAO;IAAG,GAAG,OAAO,IAAI;EAAW;AAC/D,QAAMgB,KAAI;IAAE,GAAG,OAAO,IAAIhB,GAAE,OAAO;IAAG,GAAG,OAAO,IAAI;EAAW;AAC/D,QAAMrB,KAAI;IAAE,GAAG,OAAO;IAAG,GAAG,OAAO,IAAI;EAAgB;AACvD,SAAO;IAAE,GAAAe;IAAG,GAAAsB;IAAG,GAAArC;EAAG;AACnB;AAED,IAAaqG,SAAQ,CACnB0B,IACAhD,WACa;AACb,MAAI,CAAC,OAAQ,UAAS,OAAO,OAAO;IAAE,GAAG;IAAG,GAAG;EAAG,CAAA;AAElD,QAAM2B,KAAIP,QAAO9E,EAAA;AACjB,QAAMN,KAAI;IAAE,GAAG,OAAO;IAAG,GAAG,OAAO;EAAG;AACtC,QAAMsB,KAAI;IAAE,GAAG,OAAO,IAAIhB,GAAE;IAAM,GAAG,OAAO;EAAG;AAC/C,QAAMrB,KAAI;IAAE,GAAG,OAAO,IAAIqB,GAAE,OAAO;IAAG,GAAG,OAAO,IAAIqF;EAAG;AACvD,SAAO;IAAE,GAAA3F;IAAG,GAAAsB;IAAG,GAAArC;EAAG;AACnB;AAED,IAAa2G,SAAQ,CACnBoB,IACAhD,WACa;AACb,MAAI,CAAC,OAAQ,UAAS,OAAO,OAAO;IAAE,GAAG;IAAG,GAAG;EAAG,CAAA;AAElD,QAAM2B,KAAIP,QAAO9E,EAAA;AACjB,QAAMgB,KAAI;IAAE,GAAG,OAAO;IAAG,GAAG,OAAO;EAAG;AACtC,QAAMtB,KAAI;IAAE,GAAG,OAAO,IAAIM,GAAE;IAAM,GAAG,OAAO;EAAG;AAC/C,QAAMrB,KAAI;IAAE,GAAG,OAAO,IAAIqB,GAAE,OAAO;IAAG,GAAG,OAAO,IAAIqF;EAAG;AACvD,SAAO;IAAE,GAAA3F;IAAG,GAAAsB;IAAG,GAAArC;EAAG;AACnB;AAED,IAAa4G,SAAQ,CACnBmB,IACAhD,WACa;AACb,MAAI,CAAC,OAAQ,UAAS,OAAO,OAAO;IAAE,GAAG;IAAG,GAAG;EAAG,CAAA;AAClD,QAAM2B,KAAIP,QAAO9E,EAAA;AACjB,QAAMrB,KAAI;IAAE,GAAG,OAAO;IAAG,GAAG,OAAO;EAAG;AACtC,QAAMe,KAAI;IAAE,GAAG,OAAO,IAAIM,GAAE,OAAO;IAAG,GAAG,OAAO,IAAIqF;EAAG;AACvD,QAAMrE,KAAI;IAAE,GAAG,OAAO,IAAIhB,GAAE,OAAO;IAAG,GAAG,OAAO,IAAIqF;EAAG;AACvD,SAAO;IAAE,GAAA3F;IAAG,GAAAsB;IAAG,GAAArC;EAAG;AACnB;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AQ5GD,IAAaoI,aAAY,CAACC,UAA+C,CAAE,MAAK;AAC9E,QAAM,SAAS,QAAQ,UAAU,KAAK;AAEtC,QAAM,YAAY,KAAK,MAAM,OAAA,IAAW,KAAA;AACxC,QAAM,aAAa,KAAK,MAAM,OAAA,IAAW,KAAA;AACzC,QAAM,kBAAkB,MAAO,UAAU,SAAS,EAAA,CAAG,GAAI,MAAM,EAAA;AAC/D,QAAM,mBAAmB,MAAO,WAAW,SAAS,EAAA,CAAG,GAAI,MAAM,EAAA;AACjE,SAAO,kBAAkB;AAC1B;;;ASZD,IAAM,cAAN,MAAkB;AAAA,EAKhB,cAAc;AAJd,oBAAkBC,eAAO;AACzB,qBAAoB,YAAY,IAAI;AACpC,oBAAmB,YAAY,IAAI;AACnC,cAAaC,WAAU;AAAA,EAGvB;AACF;AAIO,IAAM,YAAY,CAAI,MAAgBC,QAAyB;AACpE,QAAM,SAAS,KAAK,IAAI,CAAAC,OAAKD,IAAGC,EAAC,CAAC;AAClC,MAAI,QAAQ;AACZ,MAAI,QAAQ,OAAO;AACnB,WAASC,KAAI,GAAGA,KAAI,OAAO,QAAQA,MAAK;AACtC,QAAI,OAAQA,EAAE,IAAK,OAAO;AACxB,cAAQ,OAAQA,EAAE;AAClB,cAAQA;AAAA,IACV;AAAA,EACF;AACA,MAAI,UAAU,GAAI,QAAO;AACzB,SAAO,EAAE,MAAM,KAAM,KAAM,GAAG,MAAM;AACtC;AAEO,IAAM,cAAN,MAAkB;AAAA,EAOvB,YAAY,MAA0B;AANtC,mBAAyB,CAAC;AAG1B,qBAAY;AAIV,SAAK,oBAAoB,KAAK;AAC9B,SAAK,eAAe,KAAK;AACzB,SAAK,MAAM,IAAI,IAAI,eAAe,KAAK,SAAS;AAAA,EAClD;AAAA,EAEA,CAAC,QAAQ,OAAgC;AACvC,aAASA,KAAI,GAAGA,KAAI,MAAM,UAAU,QAAQA,MAAK;AAC/C,YAAM,KAAK,OAAO,MAAM,UAAWA,EAAE,GAAI,MAAM,eAAgBA,EAAE,CAAE;AAAA,IACrE;AAAA,EACF;AAAA,EAGA,OAAOC,IAA4BC,IAA4B;AAC7D,UAAMC,KAAIP,eAAO,SAASK,GAAG,EAAG,GAAGA,GAAG,EAAG,GAAGA,GAAG,EAAG,GAAGA,GAAG,EAAG,CAAC;AAE5D,UAAM,MAAM,YAAY,IAAI;AAC5B,QAAI,MAAM,KAAK,YAAY,KAAK,cAAc;AAE5C,UAAI,MAAM,KAAK,QAAQ;AACvB,WAAK,UAAU,KAAK,QAAQ,OAAO,CAAAF,OAAK;AACtC,cAAM,MAAO,MAAMA,GAAE;AACrB,YAAI,MAAM,KAAK,aAAc,QAAO;AACpC,eAAO;AAAA,MACT,CAAC;AACD,WAAK,YAAY;AACjB,UAAI,OAAO,KAAK,QAAQ;AACxB,UAAI,OAAO,KAAK;AACd,aAAK,IAAI,MAAM,WAAY,MAAM,IAAK,kBAAkB;AAAA,MAC1D;AAAA,IACF;AAEA,UAAM,UAAU,UAAU,KAAK,SAAS,CAAAA,OAAKH,eAAO,SAASG,GAAE,UAAUI,EAAC,CAAC;AAE3E,QAAI;AACJ,QAAI,CAAC,WAAW,QAAQ,QAAQ,KAAK,mBAAmB;AACtD,UAAI,SAAS;AACX,aAAK,IAAI,KAAK,2CAA4C,SAAS,KAAM,eAAgB,KAAK,iBAAkB,EAAE;AAAA,MACpH,OAAO;AACL,aAAK,IAAI,KAAK,UAAU;AAAA,MAC1B;AAEA,eAAS,IAAI,YAAY;AACzB,WAAK,QAAQ,KAAK,MAAM;AAAA,IAC1B,OAAO;AACL,eAAS,QAAQ;AAAA,IACnB;AACA,WAAO,WAAW;AAClB,WAAO,WAAWA;AAClB,WAAO;AAAA,MACL,QAAQ,OAAO;AAAA,MACf,WAAWF;AAAA,MACX,OAAOC;AAAA,IACT;AAAA,EACF;AAEF;;;AC/FO,IAAM,gBAAgB,CAAC,UAAkB,UAAkB,YAAoC;AACpG,MAAI,YAAY,SAAS;AACvB,UAAM,MAAM,QAAS,QAAS;AAC9B,YAAQ,IAAI,uBAAwB,QAAS,UAAW,GAAI,EAAE;AAC9D,WAAO;AAAA,EACT;AACA,MAAI,SAAS,WAAW,MAAM,EAAG,QAAO;AACxC,SAAO,WAAW;AACpB;;;ACDO,IAAM,eAAN,MAAM,cAA+B;AAAA,EAM1C,YAAqBE,IAAuB,OAAqC,CAAC,GAAG;AAAhE,aAAAA;AACnB,SAAK,OAAO;AAAA,MACV,GAAG,cAAa,SAAS;AAAA,MACzB,GAAG;AAAA,IACL;AACA,SAAK,MAAM,IAAI,IAAI,gBAAgB,KAAK,KAAK,SAAS;AACtD,SAAK,UAAU,IAAI,YAAY,KAAK,KAAK,OAAO;AAAA,EAClD;AAAA,EAEA,OAAO,WAAgC;AACrC,WAAO;AAAA,MACL,UAAU;AAAA,MACV,4BAA4B;AAAA,MAC5B,2BAA2B;AAAA,MAC3B,uBAAuB;AAAA,MACvB,yBAAyB;AAAA,MACzB,WAAW;AAAA,MACX,WAAW;AAAA,MACX,SAAS;AAAA,QACP,mBAAmB;AAAA,QACnB,UAAU;AAAA,QACV,WAAW;AAAA,MACb;AAAA,MACA,kBAAkB;AAAA,QAChB,MAAM;AAAA,QACN,MAAM;AAAA,QACN,OAAO;AAAA,MACT;AAAA,IACF;AAAA,EACF;AAAA,EACA,QAAQC,IAAmB,UAA2BC,YAAmB;AACvE,SAAK,IAAI,eAAeD,IAAGC,YAAW,WAAS;AAC7C,YAAM,UAAU,CAAE,GAAG,KAAK,QAAQ,QAAQ,KAAK,CAAE;AACjD,eAAS,OAAO;AAAA,IAClB,CAAC;AAAA,EACH;AAAA,EAEA,MAAM,OAAO;AACX,UAAMF,KAAI,KAAK;AACf,UAAMC,KAAI,MAAS,GAAgB,eAAeD,GAAE,QAAQ;AAC5D,UAAM,OAAO,KAAK;AAClB,UAAM,UAAU,KAAK,KAAK,oBAAoB,cAAa,SAAS,EAAE;AACtE,UAAM,SAAmC;AAAA,MACvC,aAAa;AAAA,QACX,gBAAgB,cAAcA,GAAE,YAAY,KAAK,WAAW,OAAO;AAAA,QACnE,UAAU;AAAA,MACZ;AAAA,MACA,aAAa;AAAA,MACb,UAAU,KAAK;AAAA,MACf,4BAA4B,KAAK;AAAA,MACjC,2BAA2B,KAAK;AAAA,MAChC,uBAAuB,KAAK;AAAA,MAC5B,yBAAyB,KAAK;AAAA,IAChC;AACA,SAAK,IAAI,KAAK,MAAM;AACpB,SAAK,KAAK,MAAS,GAAe,kBAAkBC,IAAG,MAAM;AAC7D,WAAO;AAAA,EACT;AAAA,EAEA,IAAI,2BAA2BE,QAAe;AAC5C,SAAK,OAAO;AAAA,MACV,GAAG,KAAK;AAAA,MACR,4BAA4BA;AAAA,IAC9B;AACA,SAAK,IAAI,WAAW,EAAE,4BAA4BA,OAAM,CAAC;AAAA,EAC3D;AAAA,EAEA,IAAI,6BAA6B;AAC/B,WAAO,KAAK,KAAK;AAAA,EACnB;AAAA,EAEA,IAAI,0BAA0BA,QAAe;AAC3C,SAAK,OAAO;AAAA,MACV,GAAG,KAAK;AAAA,MACR,2BAA2BA;AAAA,IAC7B;AACA,SAAK,IAAI,WAAW,EAAE,2BAA2BA,OAAM,CAAC;AAAA,EAC1D;AAAA,EAEA,IAAI,4BAA4B;AAC9B,WAAO,KAAK,KAAK;AAAA,EACnB;AAAA,EAEA,IAAI,sBAAsBA,QAAe;AACvC,SAAK,OAAO;AAAA,MACV,GAAG,KAAK;AAAA,MACR,uBAAuBA;AAAA,IACzB;AACA,SAAK,IAAI,WAAW,EAAE,uBAAuBA,OAAM,CAAC;AAAA,EACtD;AAAA,EAEA,IAAI,wBAAwB;AAC1B,WAAO,KAAK,KAAK;AAAA,EACnB;AAAA,EAEA,IAAI,SAASA,QAAe;AAC1B,SAAK,OAAO;AAAA,MACV,GAAG,KAAK;AAAA,MACR,UAAUA;AAAA,IACZ;AACA,SAAK,IAAI,WAAW,EAAE,UAAUA,OAAM,CAAC;AAAA,EACzC;AAAA,EAEA,IAAI,WAAW;AACb,WAAO,KAAK,KAAK;AAAA,EACnB;AAAA,EAEA,UAAU;AACR,SAAK,IAAI,MAAM;AACf,SAAK,KAAK;AAAA,EACZ;AACF;;;ACtHO,IAAM,iBAAN,MAAM,gBAAiC;AAAA,EAK5C,YAAqBC,IAAuB,UAA0C,CAAC,GAAG;AAArE,aAAAA;AACnB,SAAK,OAAO;AAAA,MACV,GAAG,gBAAe,SAAS;AAAA,MAC3B,GAAG;AAAA,IACL;AACA,SAAK,MAAM,IAAI,IAAI,kBAAkB,KAAK,KAAK,SAAS;AAAA,EAC1D;AAAA,EAGA,OAAO,WAAkC;AACvC,WAAO;AAAA,MACL,WAAW;AAAA,MACX,WAAW;AAAA,MACX,gBAAgB;AAAA,MAChB,kBAAkB;AAAA,QAChB,WAAW;AAAA,QACX,YAAY;AAAA,QACZ,YAAY;AAAA,QACZ,WAAW;AAAA,QACX,YAAY;AAAA,QACZ,YAAY;AAAA,QACZ,gBAAgB;AAAA,QAChB,iBAAiB;AAAA,MACnB;AAAA,IACF;AAAA,EACF;AAAA,EAEA,QAAQC,IAAgB,UAA2BC,YAAyB;AAC1E,UAAM,UAAU,KAAK,IAAI,eAAeD,IAAGC,UAAS;AACpD,aAAS,OAAO;AAAA,EAClB;AAAA,EAEA,UAAgB;AACd,SAAK,IAAI,MAAM;AACf,SAAK,KAAK;AAAA,EACZ;AAAA,EAEA,MAAM,OAAyB;AAC7B,UAAMF,KAAI,KAAK;AACf,UAAM,OAAO,KAAK;AAClB,UAAM,UAAU,KAAK,KAAK,oBAAoB,gBAAe,SAAS,EAAE;AAExE,UAAM,SAAS,MAAS,GAAgB,eAAeA,GAAE,QAAQ;AACjE,UAAM,SAAmC;AAAA,MACvC,aAAa;AAAA,QACX,gBAAgB,cAAcA,GAAE,YAAY,KAAK,KAAK,WAAW,OAAO;AAAA,MAC1E;AAAA,MACA,gBAAgB;AAAA,MAChB,aAAa;AAAA,IACf;AACA,SAAK,KAAK,MAAS,GAAe,kBAAkB,QAAQ,MAAM;AAElE,SAAK,IAAI,KAAK,MAAM;AACpB,WAAO;AAAA,EACT;AAEF;;;AC7DO,IAAM,eAAN,MAAM,cAA+B;AAAA,EAK1C,YAAqBG,IAAuB,UAAwC,CAAC,GAAG;AAAnE,aAAAA;AACnB,SAAK,OAAO;AAAA,MACV,GAAG,cAAa,SAAS;AAAA,MACzB,GAAG;AAAA,IACL;AACA,SAAK,MAAM,IAAI,IAAI,gBAAgB,KAAK,KAAK,SAAS;AAAA,EACxD;AAAA,EAEA,OAAO,WAAgC;AACrC,WAAO;AAAA,MACL,WAAW;AAAA,MACX,WAAW;AAAA,MACX,wBAAwB;AAAA,MACxB,wBAAwB;AAAA,MACxB,kBAAkB;AAAA,QAChB,YAAY;AAAA,MACd;AAAA,IACF;AAAA,EACF;AAAA,EAEA,QAAQC,IAAgB,UAA2BC,YAAyB;AAC1E,UAAM,UAAU,KAAK,IAAI,eAAeD,IAAGC,UAAS;AACpD,aAAS,OAAO;AAAA,EAClB;AAAA,EAEA,UAAgB;AACd,SAAK,IAAI,MAAM;AACf,SAAK,KAAK;AAAA,EACZ;AAAA,EAEA,MAAM,OAAyB;AAC7B,UAAM,OAAO,KAAK;AAClB,UAAM,UAAU,KAAK,KAAK,oBAAoB,cAAa,SAAS,EAAE;AACtE,UAAMF,KAAI,KAAK;AACf,UAAM,SAAS,MAAS,GAAgB,eAAeA,GAAE,QAAQ;AACjE,UAAM,SAAiC;AAAA,MACrC,aAAa;AAAA,QACX,gBAAgB,cAAcA,GAAE,YAAY,KAAK,KAAK,WAAW,OAAO;AAAA,MAC1E;AAAA,MACA,wBAAwB,KAAK;AAAA,MAC7B,yBAAyB,KAAK;AAAA,MAC9B,aAAa;AAAA,IACf;AACA,SAAK,IAAI,KAAK,MAAM;AACpB,SAAK,KAAK,MAAS,GAAa,kBAAkB,QAAQ,MAAM;AAChE,WAAO;AAAA,EACT;AAEF;;;ACrDO,IAAM,eAAN,MAAM,cAA+B;AAAA,EAK1C,YAAqBG,IAAuB,UAAwC,CAAC,GAAG;AAAnE,aAAAA;AACnB,SAAK,OAAO;AAAA,MACV,GAAG,cAAa,SAAS;AAAA,MACzB,GAAG;AAAA,IACL;AACA,SAAK,MAAM,IAAI,IAAI,gBAAgB,KAAK,KAAK,SAAS;AAAA,EACxD;AAAA,EAEA,OAAO,WAAgC;AACrC,WAAO;AAAA,MACL,WAAW;AAAA,MACX,UAAU;AAAA,MACV,WAAW;AAAA,MACX,4BAA4B;AAAA,MAC5B,2BAA2B;AAAA,MAC3B,uBAAuB;AAAA,MACvB,kBAAkB;AAAA,QAChB,MAAM;AAAA,MACR;AAAA,IACF;AAAA,EACF;AAAA,EAEA,QAAQC,IAAgB,UAA2BC,YAAyB;AAC1E,UAAM,UAAU,KAAK,IAAI,eAAeD,IAAGC,UAAS;AACpD,aAAS,OAAO;AAAA,EAClB;AAAA,EAEA,UAAgB;AACd,SAAK,IAAI,MAAM;AACf,SAAK,KAAK;AAAA,EACZ;AAAA,EAEA,MAAM,OAAyB;AAC7B,UAAM,OAAO,KAAK;AAClB,UAAM,UAAU,KAAK,KAAK,oBAAoB,cAAa,SAAS,EAAE;AACtE,UAAMF,KAAI,KAAK;AACf,UAAM,SAAS,MAAS,GAAgB,eAAeA,GAAE,QAAQ;AACjE,UAAM,SAAmC;AAAA,MACvC,aAAa;AAAA,QACX,gBAAgB,cAAcA,GAAE,YAAY,KAAK,KAAK,WAAW,OAAO;AAAA,MAC1E;AAAA,MACA,4BAA4B,KAAK;AAAA,MACjC,2BAA2B,KAAK;AAAA,MAChC,uBAAuB,KAAK;AAAA,MAC5B,UAAU,KAAK;AAAA,MACf,aAAa;AAAA,IACf;AACA,SAAK,KAAK,MAAS,GAAe,kBAAkB,QAAQ,MAAM;AAElE,SAAK,IAAI,KAAK,MAAM;AACpB,WAAO;AAAA,EACT;AAEF;;;ACrDO,IAAM,aAAN,cAAyB,YAAY;AAAA,EAmB1C,YAAqB,KAAe,MAAe;AACjD,UAAM;AADa;AAEnB,SAAK,eAAe,KAAK;AACzB,SAAK,WAAW,KAAK;AACrB,SAAK,aAAa,KAAK;AACvB,SAAK,MAAM,IAAI,IAAI,cAAc,KAAK,SAAS;AAC/C,SAAK,aAAa,IAAI;AACtB,SAAK,kBAAkB,KAAK,WAAW,aAAa,KAAK,KAAK,UAAU;AACxE,SAAK,gBAAgB,KAAK;AAC1B,SAAK,cAAc,KAAK,QAAQ,aAAa,SAAS;AACtD,SAAK,wBAAwB,KAAK,WAAW,eAAe,SAAS;AACrE,SAAK,sBAAsB,KAAK,QAAQ,aAAa,SAAS;AAC9D,SAAK,sBAAsB,KAAK,QAAQ,aAAa,SAAS;AAAA,EAChE;AAAA,EA/BA,SAA2B;AAAA;AAAA,EAE3B;AAAA,EACA;AAAA,EACA,eAA+B;AAAA,EAC/B;AAAA,EA4BA,OAAO;AACL,QAAI,KAAK,WAAW,cAAc,KAAK,WAAW,UAAW;AAC7D,SAAK,SAAS,UAAU;AACxB,SAAK,QAAQ,QAAQ;AACrB,SAAK,SAAS;AACd,SAAK,SAAS,SAAS;AAAA,EACzB;AAAA,EAEA,QAAQ,MAAsB;AAC5B,QAAI,SAAS,KAAK,YAAa;AAC/B,QAAI,OAAO,SAAS,SAAU,OAAM,IAAI,MAAM,yBAA0B,OAAO,IAAK,EAAE;AACtF,0BAAsB,IAAI;AAE1B,iBAAa,QAAQ,aAAa,IAAI;AACtC,UAAM,QAAQ,KAAK;AACnB,QAAI,CAAC,MAAO;AACZ,SAAK,KAAK;AACV,SAAK,eAAe;AACpB,SAAK,MAAM,KAAK;AAAA,EAClB;AAAA,EAEA,kBAAkB;AAChB,UAAM,YAAgC;AAAA,MACpC,UAAU,KAAK;AAAA,MACf,YAAY,KAAK;AAAA,IACnB;AACA,WAAO;AAAA,EACT;AAAA,EAEA,MAAM,MAAM,OAAyB;AACnC,SAAK,SAAS,UAAU;AACxB,SAAK,WAAW;AAChB,YAAQ,KAAK,cAAc;AAAA,MACzB,KAAK,QAAQ;AACX,aAAK,IAAI,KAAK,KAAK,WAAW;AAC9B,aAAK,SAAS,IAAI,aAAa,KAAK,gBAAgB,GAAG,KAAK,WAAW;AACvE;AAAA,MACF;AAAA,MACA,KAAK,WAAW;AACd,aAAK,IAAI,KAAK,KAAK,qBAAqB;AACxC,aAAK,SAAS,IAAI,eAAe,KAAK,gBAAgB,GAAG,KAAK,qBAAqB;AACnF;AAAA,MACF;AAAA,MACA,KAAK,QAAQ;AACX,aAAK,IAAI,KAAK,KAAK,mBAAmB;AACtC,aAAK,SAAS,IAAI,aAAa,KAAK,gBAAgB,GAAG,KAAK,mBAAmB;AAC/E;AAAA,MACF;AAAA,MACA,KAAK,QAAQ;AACX,aAAK,IAAI,KAAK,KAAK,mBAAmB;AACtC,aAAK,SAAS,IAAI,aAAa,KAAK,gBAAgB,GAAG,KAAK,mBAAmB;AAC/E;AAAA,MACF;AAAA,MACA,SAAS;AACP,cAAM,IAAI,MAAM,qBAAsB,KAAK,YAAa,kDAAkD;AAAA,MAC5G;AAAA,IACF;AACA,QAAI,KAAK,QAAQ;AACf,WAAK,OAAO,KAAK;AACjB,WAAK,SAAS,SAAS;AAAA,IACzB;AAAA,EACF;AAAA,EAEA,OAAO;AACL,UAAMG,KAAI,KAAK;AACf,QAAI,CAACA,IAAG;AACN,cAAQ,KAAK,kBAAkB;AAC/B;AAAA,IACF;AAEA,SAAK,QAAQ,QAAQA,IAAG,CAAC,SAAS,KAAK,WAAW,aAAa,KAAK,cAAc,IAAI,GAAG,YAAY,IAAI,CAAC;AAE1G,QAAI,KAAK,WAAW,WAAW;AAC7B,WAAK,eAAe,WAAW,MAAM,KAAK,KAAK,GAAG,KAAK,aAAa;AAAA,IACtE;AAAA,EACF;AAAA,EAEA,SAAS,OAAyB;AAChC,QAAI,KAAK,WAAW,MAAO;AAC3B,UAAM,QAAQ,KAAK;AAEnB,QAAI,UAAU,YAAY;AACxB,UAAI,UAAU,aAAa,UAAU,eAAgB,OAAM,IAAI,MAAM,+BAAgC,KAAM,EAAE;AAAA,IAC/G;AACA,QAAI,UAAU,WAAW;AACvB,UAAI,UAAU,WAAY,OAAM,IAAI,MAAM,yCAA0C,KAAM,EAAE;AAAA,IAC9F;AAEA,SAAK,SAAS;AAEd,QAAI,UAAU,WAAW;AACvB,WAAK,eAAe,WAAW,MAAM,KAAK,KAAK,GAAG,KAAK,aAAa;AAAA,IACtE,OAAO;AACL,UAAI,KAAK,cAAc;AACrB,qBAAa,KAAK,YAAY;AAAA,MAChC;AACA,WAAK,eAAe;AAAA,IACtB;AAEA,SAAK,IAAI,MAAM,SAAU,KAAM,OAAQ,KAAM,EAAE;AAC/C,SAAK,cAAc,IAAI,YAAY,SAAS;AAAA,MAC1C,QAAQ;AAAA,QACN,YAAY;AAAA,QACZ,UAAU;AAAA,MACZ;AAAA,IACF,CAAC,CAAC;AAAA,EACJ;AAAA,EAEA,IAAI,YAAY;AACd,WAAO,KAAK,WAAW;AAAA,EACzB;AAAA,EAEA,IAAI,QAAQ;AACV,WAAO,KAAK;AAAA,EACd;AAAA,EAEA,IAAI,cAAc;AAChB,WAAO,KAAK;AAAA,EACd;AAAA,EAEA,IAAI,eAAe;AACjB,WAAO,KAAK;AAAA,EACd;AAAA,EAEA,IAAI,2BAAyC;AAC3C,QAAI,KAAK,iBAAiB,QAAQ;AAChC,YAAM,IAAI,MAAM,+BAAgC,KAAK,YAAa,EAAE;AAAA,IACtE;AACA,WAAO,KAAK;AAAA,EACd;AAEF;;;AChLO,IAAM,aAAa,CAAC,OAAe,UAAkB;AAC1D,QAAM,MAAM,MAAM,QAAQ,KAAK;AAC/B,MAAI,OAAO,GAAG;AACZ,WAAO,MAAM,UAAU,GAAG,GAAG;AAAA,EAC/B;AACA,SAAO;AACT;;;ACFO,IAAM,gBAAN,MAAoB;AAAA,EAIzB,YAA6B,SAAkB;AAAlB;AAAA,EAE7B;AAAA,EALA,YAAY;AAAA,EACZ,WAAyB,CAAC;AAAA,EAM1B,OAAO;AACL,SAAK,cAAc;AAAA,EACrB;AAAA,EAEA,MAAM,gBAAgB;AACpB,QAAI,KAAK,UAAW;AACpB,QAAI,EAAE,kBAAkB,YAAY;AAClC,cAAQ,KAAK,sFAAsF;AACnG,WAAK,YAAY;AACjB;AAAA,IACF;AACA,QAAI,EAAE,kBAAkB,UAAU,eAAe;AAC/C,WAAK,YAAY;AACjB,cAAQ,KAAK,sFAAsF;AACnG;AAAA,IACF;AAEA,UAAM,UAAU,aAAa,aAAa,EAAE,OAAO,KAAK,CAAC;AACzD,UAAM,UAAU,MAAM,UAAU,aAAa,iBAAiB;AAE9D,SAAK,WAAW,QAAQ,OAAO,CAAAC,OAAKA,GAAE,SAAS,YAAY,EAAE,IAAI,CAAAA,QAAM;AAAA,MACrE,IAAIA,GAAE;AAAA,MACN,MAAM;AAAA,MACN,OAAO,WAAWA,GAAE,OAAO,GAAG,EAAE,KAAK;AAAA,IACvC,EAAE;AAEF,SAAK,QAAQ,oBAAoB,IAAI;AAAA,EACvC;AAAA,EAIA,IAAI,UAAU;AACZ,WAAO,KAAK;AAAA,EACd;AACF;;;AC1CO,IAAM,eAAN,MAAsC;AAAA,EAG3C,YAAqB,MAA8B,YAAwB;AAAtD;AAA8B;AAAA,EAEnD;AAAA,EAJA,SAAiB;AAAA,EAMjB,MAAM,QAAQ;AACZ,QAAI,MAAM;AACV,UAAM,OAAO,KAAK,KAAK;AACvB,UAAM,UAAU,KAAK,KAAK;AAE1B,SAAK,SAAS,YAAY,MAAM;AAE9B,WAAK,WAAW,aAAa,MAAM,QAAS,GAAI,CAAC;AACjD;AACA,UAAI,OAAO,KAAK,KAAK,QAAQ,OAAQ,OAAM;AAAA,IAC7C,GAAG,KAAK,KAAK,SAAS,CAAC;AACvB,WAAO;AAAA,EACT;AAAA,EAEA,OAAO;AACL,kBAAc,KAAK,MAAM;AAAA,EAC3B;AACF;;;ACzBO,IAAM,aAAN,MAAiB;AAAA,EAGtB,YAA6B,SAAkB;AAAlB;AAAA,EAE7B;AAAA,EAJA,SAA0B,CAAC;AAAA,EAM3B,OAAO,QAAoB;AACzB,UAAM,WAAW,KAAK,OAAO,OAAO,QAAM,GAAG,SAAS,OAAO,EAAE;AAC/D,QAAI,SAAS,WAAW,KAAK,OAAO,QAAQ;AAC1C,WAAK,SAAS;AACd,WAAK,KAAK;AAAA,IACZ;AAAA,EACF;AAAA,EAEA,aAA2B;AACzB,WAAO,KAAK,OAAO,IAAgB,CAAAC,QAAM;AAAA,MACvC,IAAIA,GAAE;AAAA,MACN,MAAM;AAAA,MACN,OAAOA,GAAE;AAAA,IACX,EAAE;AAAA,EACJ;AAAA,EAEA,aAAa,MAAc;AACzB,WAAO,KAAK,OAAO,KAAK,CAAAA,OAAKA,GAAE,SAAS,IAAI;AAAA,EAC9C;AAAA,EAEA,IAAI,MAAqB;AACvB,SAAK,OAAO,KAAK,IAAI;AACrB,SAAK,KAAK;AAAA,EACZ;AAAA,EAEA,OAAO;AACL,iBAAa,QAAQ,cAAc,KAAK,UAAU,KAAK,MAAM,CAAC;AAC9D,SAAK,QAAQ,oBAAoB,IAAI;AAAA,EACvC;AAAA,EAEA,OAAO;AACL,UAAMC,KAAI,aAAa,QAAQ,YAAY;AAC3C,QAAI,CAACA,GAAG;AACR,QAAI;AACF,YAAMC,KAAI,KAAK,MAAMD,EAAC;AACtB,iBAAWE,MAAKD,IAAG;AACjB,aAAK,OAAO,KAAKC,EAAC;AAAA,MACpB;AACA,WAAK,QAAQ,oBAAoB,IAAI;AAAA,IACvC,SAAS,OAAO;AACd,cAAQ,MAAM,KAAK;AAAA,IACrB;AAAA,EACF;AAAA,EAEA,aAAa;AACX,UAAM,aAAyC;AAAA,MAC7C,WAAW;AAAA,MACX,WAAW;AAAA,IACb;AACA,UAAM,cAAc,IAAI,KAAK,eAAe,SAAS,UAAU,EAAE,OAAO,KAAK,IAAI,CAAC,IAAI,gBAAgB,KAAK,OAAO,SAAS;AAE3H,UAAM,OAAO,OAAO,OAAO,sBAAsB,WAAW;AAC5D,WAAO;AAAA,EACT;AACF;;;AC7DO,IAAM,qBAAN,MAA4C;AAAA,EAGjD,YAAqB,KAAkC,MAA2B,QAAuB;AAApF;AAAkC;AAA2B;AAAA,EAElF;AAAA,EAEA,MAAM,QAA0B;AAC9B,QAAIC,UAA2C;AAC/C,YAAQ,KAAK,KAAK,MAAM;AAAA,MACtB,KAAK,UAAU;AACb,QAAAA,UAAS,MAAM,KAAK,eAAe;AACnC,aAAK,cAAcA;AACnB;AAAA,MACF;AAAA,MACA,KAAK,QAAQ;AACX,QAAAA,UAAS,KAAK,KAAK;AACnB;AAAA,MACF;AAAA,IACF;AACA,SAAK,IAAI,eAAeA,OAAM;AAC9B,QAAIA,SAAQ;AACV,WAAK,IAAI,MAAM;AACf,aAAO;AAAA,IACT,OAAO;AACL,WAAK,IAAI,KAAK;AACd,aAAO;AAAA,IACT;AAAA,EACF;AAAA,EAEA,OAAa;AACX,QAAI,KAAK,aAAa;AACpB,iBAAWC,OAAM,KAAK,YAAY,eAAe,GAAG;AAClD,QAAAA,IAAG,KAAK;AAAA,MACV;AAAA,IACF;AACA,SAAK,IAAI,KAAK;AAAA,EAChB;AAAA,EAEA,MAAM,iBAAiB;AACrB,QAAI,KAAK,KAAK,OAAO,IAAK,QAAO;AACjC,UAAMC,KAAI,eAAe,KAAK,MAAM,KAAK,MAAM;AAC/C,QAAI;AACF,YAAMF,UAAS,MAAM,UAAU,aAAa,aAAaE,EAAC;AAE1D,aAAOF;AAAA,IACT,SAAS,OAAgB;AACvB,UAAI,OAAO,UAAU,UAAU;AAE7B,cAAM,OAAQ,MAAc,QAAQ;AACpC,YAAI,SAAS,wBAAwB;AAEnC,kBAAQ,MAAM,0BAA4B,MAAc,UAAW,EAAE;AACrE,kBAAQ,MAAM,gBAAiB,KAAK,UAAUE,EAAC,CAAE,EAAE;AAAA,QACrD;AAAA,MACF;AACA,YAAM;AAAA,IACR;AAAA,EACF;AACF;AAEO,IAAM,iBAAiB,CAAC,QAAoB,YAA2B;AAC5E,QAAM,QAAwC,CAAC;AAC/C,MAAI,OAAO,GAAG,SAAS,GAAG;AACxB,UAAM,WAAW,EAAE,OAAO,OAAO,GAAG;AAAA,EACtC;AACA,MAAI,QAAQ,YAAY;AACtB,UAAM,aAAa,QAAQ;AAAA,EAC7B;AACA,MAAI,QAAQ,QAAQ;AAClB,UAAM,SAAS,EAAE,OAAO,QAAQ,OAAO;AAAA,EACzC;AACA,MAAI,QAAQ,OAAO;AACjB,UAAM,QAAQ,EAAE,OAAO,QAAQ,MAAM;AAAA,EACvC;AACA,QAAM,cAAsC;AAAA,IAC1C;AAAA,EACF;AACA,SAAO;AACT;;;AC/DO,IAAM,UAAN,cAAsB,YAAY;AAAA,EAUvC,YAAY,eAAuC,KAAe;AAChE,UAAM;AAD2C;AAEjD,SAAK,MAAM,IAAI,IAAI,WAAW,IAAI,GAAG;AACrC,SAAK,cAAc;AACnB,SAAK,UAAU,IAAI,cAAc,IAAI;AACrC,SAAK,cAAc,IAAI,WAAW,IAAI;AAAA,EACxC;AAAA,EAfA;AAAA,EACA;AAAA,EAEA,SAAuB;AAAA,EACvB;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EAUA,OAAO,QAAoB;AACzB,QAAI,OAAO,SAAS,YAAa,OAAM,IAAI,MAAM,uBAAwB,OAAO,IAAK,EAAE;AACvF,SAAK,YAAY,OAAO,MAAM;AAAA,EAChC;AAAA,EAEA,IAAI,YAAY;AACd,WAAO,KAAK,WAAW;AAAA,EACzB;AAAA,EAEA,iBAAiB;AACf,WAAO,IAAI,SAAS,KAAK,aAAa,KAAK,IAAI,UAAU;AAAA,EAC3D;AAAA,EAEA,YAAqB;AACnB,QAAI,KAAK,WAAW,WAAW;AAC7B,WAAK,MAAM;AACX,aAAO;AAAA,IACT,WAAW,KAAK,WAAW,WAAW;AACpC,WAAK,KAAK;AACV,aAAO;AAAA,IACT,OAAO;AACL,cAAQ,KAAK,+BAAgC,KAAK,MAAO,EAAE;AAC3D,aAAO;AAAA,IACT;AAAA,EACF;AAAA,EAEA,UAAU,MAAmB;AAC3B,QAAI,KAAK,cAAc;AACrB,UAAI,KAAK,aAAa,SAAS,KAAM,QAAO;AAAA,IAC9C;AACA,WAAO;AAAA,EACT;AAAA,EACA,MAAM,QAAQ;AACZ,SAAK,UAAU,UAAU;AAEzB,UAAM,aAAa,KAAK;AACxB,QAAI,CAAC,WAAY,OAAM,IAAI,MAAM,wCAAwC;AAGzE,QAAI;AACJ,QAAI,UAAU,KAAK;AACnB,QAAI,CAAC,SAAS;AACZ,gBAAU,KAAK,WAAW,KAAK,IAAI,GAAG,eAAe;AAAA,IACvD;AACA,YAAQ,WAAW,MAAM;AAAA,MACvB,KAAK,UAAU;AACb,YAAI,CAAC,QAAS,OAAM,IAAI,MAAM,kBAAkB;AAChD,iBAAS,IAAI,mBAAmB,SAAS,YAAY,KAAK,WAAW;AACrE;AAAA,MACF;AAAA,MACA,KAAK,QAAQ;AACX,YAAI,CAAC,QAAS,OAAM,IAAI,MAAM,kBAAkB;AAChD,iBAAS,IAAI,mBAAmB,SAAS,YAAY,KAAK,WAAW;AACrE;AAAA,MACF;AAAA,MACA,KAAK,aAAa;AAChB,cAAM,MAAM,KAAK,YAAY,aAAa,WAAW,EAAE;AACvD,YAAI,KAAK;AACP,mBAAS,IAAI,aAAa,KAAK,KAAK,IAAI,UAAU;AAAA,QACpD,OAAO;AACL,kBAAQ,KAAK,4BAA6B,WAAW,EAAG,EAAE;AAAA,QAC5D;AAAA,MACF;AAAA,IACF;AAEA,SAAK,WAAW;AAChB,QAAI,MAAM,QAAQ,MAAM,GAAG;AACzB,WAAK,UAAU,SAAS;AAAA,IAC1B,OAAO;AACL,WAAK,UAAU,SAAS;AAAA,IAC1B;AAAA,EACF;AAAA,EAEA,OAAO;AACL,UAAM,UAAU,KAAK;AACrB,QAAI,SAAS;AACX,UAAI;AACF,gBAAQ,KAAK;AACb,aAAK,WAAW;AAAA,MAClB,SAAS,OAAO;AACd,gBAAQ,MAAM,KAAK;AAAA,MACrB;AAAA,IACF;AACA,SAAK,UAAU,SAAS;AAAA,EAC1B;AAAA,EAEA,IAAI,UAAU;AACZ,WAAO,KAAK,QAAQ;AAAA,EACtB;AAAA,EAEA,IAAI,aAAa;AACf,WAAO,KAAK,YAAY,WAAW;AAAA,EACrC;AAAA,EAEA,OAAO;AACL,SAAK,QAAQ,KAAK;AAClB,SAAK,YAAY,KAAK;AAAA,EACxB;AAAA,EAEA,UAAU,YAAwB;AAChC,SAAK,IAAI,MAAM,cAAe,KAAK,UAAU,UAAU,CAAE,EAAE;AAC3D,SAAK,eAAe;AACpB,SAAK,cAAc,IAAI,YAAY,iBAAiB,EAAE,QAAQ,WAAW,CAAC,CAAC;AAAA,EAC7E;AAAA,EAEA,eAAe;AACb,QAAI,KAAK,aAAc,QAAO,KAAK,aAAa;AAChD,WAAO;AAAA,EACT;AAAA,EAEA,oBAAoB,QAAa;AAC/B,SAAK,cAAc,IAAI,YAAY,WAAW;AAAA,MAC5C,QAAQ;AAAA,IACV,CAAC,CAAC;AACF,QAAI,WAAW,KAAK,WAAW,CAAC,KAAK,UAAU;AAC7C,YAAMC,KAAI,KAAK,QAAQ,QAAS,CAAE;AAClC,UAAIA,IAAG;AACL,aAAK,UAAUA,EAAC;AAChB,aAAK,MAAM;AAAA,MACb;AAAA,IACF;AAAA,EACF;AAAA,EAEA,UAAU,OAAqB;AAC7B,UAAM,QAAQ,KAAK;AACnB,QAAI,UAAU,MAAO;AACrB,SAAK,SAAS;AACd,QAAI,UAAU,cAAc,UAAU,UAAW,OAAM,IAAI,MAAM,qBAAsB,KAAM,OAAQ,KAAM,EAAE;AAC7G,SAAK,IAAI,MAAM,SAAU,KAAM,OAAQ,KAAM,cAAe,KAAK,UAAU,KAAK,YAAY,CAAE,GAAG;AACjG,UAAM,OAA8B;AAAA,MAClC,YAAY;AAAA,MACZ,UAAU;AAAA,IACZ;AACA,SAAK,cAAc,IAAI,YAAY,gBAAgB,EAAE,QAAQ,KAAK,CAAC,CAAC;AAAA,EACtE;AAAA,EAEA,IAAI,oBAAoB;AACtB,WAAO,KAAK;AAAA,EACd;AAEF;;;AC3KO,IAAO,YAAY,MAAK;AAC7B,QAAM,YAAa,KAAK,OAAM,IAAK,QAAS;AAC5C,QAAM,aAAc,KAAK,OAAM,IAAK,QAAS;AAC7C,UAAQ,QAAQ,UAAU,SAAS,EAAE,GAAG,MAAM,EAAE,KAAK,QAAQ,WAAW,SAAS,EAAE,GAAG,MAAM,EAAE;AAChG;AAEO,IAAM,UAAU,CAACC,UAAsB;AAC5C,MAAIC,KAAI,KAAK,IAAG,IAAKD;AACrB,MAAIC,KAAI;AAAM,WAAO,GAAGA,EAAC;AACzB,EAAAA,MAAK;AACL,MAAIA,KAAI;AAAM,WAAO,GAAGA,EAAC;AACzB,EAAAA,MAAK;AACL,MAAIA,KAAI;AAAI,WAAO,GAAGA,EAAC;AACvB,EAAAA,MAAK;AACL,SAAO,GAAGA,EAAC;AACb;;;AClBM,IAAgB,kBAAhB,MAA+B;EAGd;EAAuB;EAA+B;EAFnE;EAER,YAAqB,OAAuB,YAA+B,MAAQ;AAA9D,SAAA,QAAA;AAAuB,SAAA,aAAA;AAA+B,SAAA,OAAA;AACzE,SAAK,SAAS;EAChB;EAEA,SAAS,UAAyB;AAChC,QAAI,YAAY,KAAK;AAAQ;AAC7B,UAAM,aAAa,KAAK;AACxB,SAAK,SAAS;AACd,SAAK,KAAK,QAAQ,aAAa,SAAS,QAAQ;AAChD,SAAK,WAAW,mBAAmB,YAAY,UAAU,IAAI;EAC/D;EAEA,IAAI,QAAK;AACP,WAAO,KAAK;EACd;EAKA,IAAI,OAAI;AACN,WAAO,KAAK;EACd;;;;ACzBI,IAAOC,OAAP,MAAO,KAAG;EAEO;EAAyB;EAA9C,YAAqB,SAAyB,SAAkB,SAAO;AAAlD,SAAA,UAAA;AAAyB,SAAA,SAAA;EAE9C;EAEA,OAAO,WAAW,MAAU,UAAiB,QAAa;AACxD,QAAIC,KAAI,KAAK,QAAQ;AACrB,QAAIA,OAAM,QAAW;AACnB,YAAMC,OAAM,KAAK;AACjB,UAAIA,SAAQ;AAAW,QAAAD,KAAIC,KAAI,QAAQ;IACzC;AAEA,QAAID,OAAM,YAAYA,OAAM,aAAa;AAAS,aAAO,IAAI,KAAI,QAAQA,EAAC;AAC1E,WAAO,IAAI,KAAI,MAAM;EACvB;EAEA,KAAK,KAAO;AACV,QAAI,KAAK,WAAW;AAAW;AAC/B,YAAQ,KAAK,KAAK,SAAS,GAAG;EAChC;EAEA,QAAQ,KAAO;AACb,QAAI,KAAK,WAAW;AAAW;AAC/B,YAAQ,IAAI,KAAK,SAAS,GAAG;EAC/B;EAEA,MAAM,KAAO;AACX,QAAI,KAAK,WAAW;AAAU;AAC9B,YAAQ,MAAM,KAAK,SAAS,GAAG;EACjC;;;;AC5BI,IAAO,cAAP,cAA2B,gBAAe;EACtC;EAER,YAAY,YAAoB;AAC9B,UAAM,MAAM,YAAYE,KAAI,WAAW,WAAW,SAAS,MAAM,MAAM,aAAa,CAAC;AACrF,SAAK,MAAM,IAAI,iBAAiB,QAAQ;AACxC,SAAK,IAAI,iBAAiB,WAAW,SAAM;AACzC,UAAI;AACF,cAAM,MAAM,KAAK,MAAM,IAAI,IAAI;AAC/B,aAAK,KAAK,QAAQ,GAAG;AACrB,aAAK,WAAW,UAAU,KAAK,IAAI;MACrC,SAASC,IAAG;AACV,gBAAQ,MAAMA,EAAC;MACjB;IACF,CAAC;AACD,eAAW,MAAK;AACd,WAAK,SAAS,MAAM;IACtB,GAAG,GAAG;EACR;EAEA,OAAO,cAAW;AAChB,WAAQ,sBAAsB;EAChC;EAGA,WAAQ;AACN,WAAO;EACT;EAEA,WAAQ;EACR;EAEA,KAAK,SAAW;AACd,cAAU,KAAK,WAAW,SAAS,iBAAiB,OAAO;AAC3D,YAAQ,WAAW;AACnB,SAAK,IAAI,YAAY,KAAK,UAAU,OAAO,CAAC;AAC5C,WAAO;EACT;;;;ACtBI,IAAO,YAAP,cAAyB,YAAW;EAInB;EAHb;EACA;EAER,YAAqB,UAAgB;AACnC,UAAK;AADc,SAAA,WAAA;AAEnB,SAAK,aAAa,CAAA;AAClB,SAAK,UAAU,SAAS;EAC1B;EAEA,gBAAa;AACX,YAAQ,MAAM,cAAc;AAC5B,eAAWC,MAAK,KAAK,YAAY;AAC/B,cAAQ,IAAIA,GAAE,OAAO,OAAOA,GAAE,QAAQ,GAAG;IAC3C;AACA,YAAQ,SAAQ;EAClB;EAEA,mBAAmB,YAA6B,UAA2B,QAAmB;AAC5F,SAAK,cAAc,IAAI,YAAkC,UAAU;MACjE,QAAQ,EAAE,YAAY,UAAU,OAAM;KACvC,CAAC;EACJ;EAEA,IAAIA,IAAc;AAChB,SAAK,WAAW,KAAKA,EAAC;EACxB;EAEA,KAAK,SAAW;AACd,cAAU,KAAK,SAAS,iBAAiB,OAAO;AAChD,SAAK,WAAW,QAAQ,CAAAA,OAAKA,GAAE,KAAK,OAAO,CAAC;EAC9C;EAEA,KAAK,KAAO;AACV,YAAQ,IAAI,aAAa,GAAG;EAC9B;EAEA,yBAAyB,MAAU,KAAyB,SAAsB;AAChF,QAAI,OAAO,SAAS;AAAU,YAAM,IAAI,MAAM,iBAAiB;AAC/D,UAAM,EAAC,KAAK,OAAO,MAAK,IAAI;AAC5B,QAAI,UAAU;AAAW,WAAK,SAAS,QAAQ,eAAe,OAAO,OAAO;AAC5E,QAAI,QAAQ,QAAW;AACrB,WAAK,KAAK,qDAAqD,KAAK,UAAU,IAAI,CAAC,EAAE;AACrF;IACF;AAEA,QAAI,CAAC,KAAK,SAAS,iBAAiB,IAAI;AAAG;AAE3C,SAAK,SAAS,kBAAkB,MAAM,GAAG;EAC3C;EAEA,UAAU,MAAU,KAAgB;AAClC,UAAM,EAAC,KAAK,OAAO,MAAK,IAAI;AAE5B,QAAI,UAAU,QAAW;AACvB,WAAK,SAAS,QAAQ,eAAe,OAAO,GAAG;IACjD;AAEA,QAAI,QAAQ,QAAW;AACrB,WAAK,KAAK,6CAA6C,KAAK,UAAU,IAAI,CAAC,EAAE;AAC7E;IACF;AAEA,QAAI,CAAC,KAAK,SAAS,iBAAiB,IAAI;AAAG;AAE3C,QAAI,UAAU,QAAW;AACvB,WAAK,SAAS,oBAAoB,MAAM,GAAG;AAC3C;IACF;AAEA,YAAQ,OAAO;MACb,KAAK;AACH,aAAK,SAAS,QAAQ,iBAAiB,MAAuB,GAAG;AACjE;MACF,KAAK;AACH,aAAK,SAAS,QAAQ,iBAAiB,MAAuB,GAAG;AACjE;MACF,KAAK;AACH,aAAK,SAAS,QAAQ,QAAQ,MAAM,GAAG;AACvC;MACF;AACE,aAAK,IAAI,yBAAyB,KAAK,EAAE;IAC7C;EACF;EAEA,WAAQ;AACN,UAAM,MAAM,CAAC,GAAG,KAAK,UAAU;AAC/B,QAAI,QAAQ,CAAAA,OAAKA,GAAE,SAAQ,CAAE;EAC/B;EAEA,IAAI,KAAU;AACZ,YAAQ,IAAI,2BAA2B,GAAG;EAC5C;;;;ACzGI,IAAO,cAAP,MAAkB;EAOF;EAAoB;EANhC;EACA;EACA;EACA,mBAAkB,KAAG;EACrB;EAER,YAAoB,KAAoB,UAAgB;AAApC,SAAA,MAAA;AAAoB,SAAA,WAAA;AACtC,SAAK,YAAY,CAAA;AACjB,SAAK,SAAS;AACd,SAAK,aAAa,KAAK,IAAG;AAC1B,SAAK,OAAO,IAAIC,KAAI,eAAe,GAAG,KAAK,SAAS,QAAQ,KAAK,cAA0B,OAAO;EACpG;EAMA,KAAK,MAAW;AACd,QAAI,KAAK;AAAQ,YAAM,IAAI,MAAM,gCAAgC;AACjE,eAAWC,MAAK,KAAK,WAAW;AAC9B,UAAIA,GAAE,UAAU,QAAQ;AACtB,gBAAQ,IAAI,YAAYA,GAAE,QAAQ,IAAI,EAAE;AACxC,QAAAA,GAAE,KAAK,IAAI;AACX,eAAO;MACT;IACF;AACA,WAAO;EACT;EAEA,SAAS,UAAyB;AAChC,QAAI,YAAY,KAAK;AAAQ;AAC7B,QAAI,KAAK;AAAQ,YAAM,IAAI,MAAM,0CAA0C;AAC3E,UAAM,aAAa,KAAK;AACxB,SAAK,SAAS;AACd,QAAI,aAAa;AAAQ,WAAK,aAAa,KAAK,IAAG;AACnD,SAAK,SAAS,mBAAmB,YAAY,UAAU,IAAI;EAC7D;EAEA,WAAW,aAAkB;AAC3B,WAAQ,KAAK,UAAU,KAAK,CAAAC,OAAMA,GAAE,QAAQ,SAAS,WAAY;EACnE;EAEA,qBAAqBD,IAAgB;AACnC,QAAI,KAAK;AAAQ,YAAM,IAAI,MAAM,+CAA+C;AAChF,SAAK,UAAU,KAAKA,EAAC;AACrB,SAAK,KAAK,QAAQ,4BAA4BA,GAAE,QAAQ,IAAI,QAAQA,GAAE,EAAE,KAAK,KAAK,UAAU,MAAM,YAAY;AAC9G,SAAK,SAAS,MAAM;EACtB;EAEA,OAAI;AACF,QAAIE,KAAI,CAAC,eAAe,KAAK,GAAG,GAAG;AACnC,SAAK,UAAU,QAAQ,CAAAF,OAAI;AACzB,MAAAE,GAAE,KAAK,QAAQF,GAAE,aAAY,CAAE;IACjC,CAAC;AAED,WAAOE,GAAE,KAAK,IAAI;EACpB;EAEA,eAAY;AACV,QAAIA,KAAI;AACR,SAAK,UAAU,QAAQ,CAAAF,OAAI;AACzB,MAAAE,MAAK,QAAQF,GAAE,QAAQ,MAAMA,GAAE,QAAQ,OAAO,eAAeA,GAAE,cAAa,IAAK;IACnF,CAAC;AACD,WAAOE,GAAE,KAAI;EACf;EAEA,WAAQ;AACN,QAAI,KAAK;AAAQ;AACjB,UAAM,WAAW,CAAC,GAAG,KAAK,SAAS;AACnC,eAAWF,MAAK,UAAU;AACxB,MAAAA,GAAE,SAAQ;IACZ;AAEA,UAAMG,UAAS,KAAK,UAAU;AAC9B,SAAK,YAAY,KAAK,UAAU,OAAO,CAAAH,OAAKA,GAAE,UAAU,MAAM;AAC9D,QAAI,KAAK,UAAU,WAAWG,SAAQ;AACpC,WAAK,KAAK,QAAQ,WAAWA,UAAS,KAAK,UAAU,MAAM,cAAc;IAC3E;AACA,QAAI,KAAK,SAAS,WAAW;AAAG,WAAK,SAAS,MAAM;AAEpD,QAAI,KAAK,WAAW,QAAQ;AAC1B,YAAMC,WAAU,KAAK,IAAG,IAAK,KAAK;AAClC,UAAIA,WAAU,KAAK;AAAkB,aAAK,SAAS,MAAM;IAC3D;EACF;EAEA,IAAI,KAAE;AACJ,WAAO,KAAK;EACd;EAEA,IAAI,WAAQ;AACV,WAAO,CAAC,GAAG,KAAK,SAAS;EAC3B;EAEA,IAAI,SAAM;AACR,WAAO,KAAK,WAAW;EACzB;EAEA,IAAI,QAAK;AACP,WAAO,KAAK;EACd;;;;ACjGI,IAAO,iBAAP,MAAO,wBAAuB,YAAW;EAIhB;EAAoB;EAA8B;EAA4B;EAAkC;EAA0B;EAH/J;EACC;EAET,YAA6B,IAAoB,aAA8B,YAA4B,SAAkC,IAA0B,SAAe;AACpL,UAAK;AADsB,SAAA,KAAA;AAAoB,SAAA,cAAA;AAA8B,SAAA,aAAA;AAA4B,SAAA,UAAA;AAAkC,SAAA,KAAA;AAA0B,SAAA,UAAA;AAErK,SAAK,SAAS;AACd,SAAK,aAAa,KAAK,IAAG;EAC5B;EAEA,kBAAkB,MAAa,KAAuB;AACpD,SAAK,QAAQ,UAAU,yBAAyB,MAAM,KAAK,IAAI;EACjE;EAEA,KAAK,MAAW;AACd,SAAK,cAAc,IAAI,YAAY,QAAQ,EAAC,QAAO,EAAE,GAAG,KAAI,EAAC,CAAC,CAAC;AAC/D,WAAO;EACT;EAEA,IAAI,OAAI;AACN,WAAO;EACT;EAEA,eAAY;AACV,WAAO,GAAG,KAAK,KAAK,IAAI,KAAK,QAAQ,IAAI,QAAQ,KAAK,EAAE,IAAI,KAAK,cAAc,UAAU,QAAQ,aAAkB,QAAQ,KAAK,UAAU,CAAC;EAC7I;EAEA,gBAAa;AACX,WAAY,QAAQ,KAAK,UAAU;EACrC;EAEQ,SAAS,UAA4B;AAC3C,QAAI,KAAK,WAAW;AAAU;AAC9B,UAAM,aAAa,KAAK;AACxB,SAAK,SAAS;AACd,SAAK,cAAc,IAAI,YAAY,UAAU,EAAC,QAAO,EAAC,YAAY,SAAQ,EAAC,CAAC,CAAC;EAC/E;EAEA,WAAQ;AACN,QAAI,KAAK,UAAU,aAAa,KAAK,UAAU,QAAQ;AACrD,UAAI,KAAK,IAAG,IAAK,KAAK,aAAa,KAAG,KAAM;AAC1C,aAAK,SAAS,SAAS;MACzB;IACF;EACF;EAEA,IAAI,QAAK;AACP,WAAO,KAAK;EACd;EAGA,SAAS,QAAa;AACpB,SAAK,QAAO;EACd;EAEA,WAAQ;AACN,SAAK,SAAS,MAAM;AACpB,SAAK,QAAQ,QAAQ,qBAAqB,IAAI;EAChD;EAEA,UAAO;AACL,SAAK,IAAI,SAAS;AAClB,SAAK,SAAS,QAAQ;AACtB,SAAK,cAAc,IAAI,MAAM,WAAW,CAAC;EAC3C;EAEA,OAAO,SAAS,YAAmB,SAAyB,IAAiB,SAAe;AAC1F,UAAM,KAAU,UAAS;AACzB,WAAO,IAAI,gBAAe,IAAI,MAAM,YAAY,SAAS,IAAI,OAAO;EACtE;EAEA,OAAO,OAAO,WAAkB,YAAmB,SAAyB,IAAiB,SAAe;AAC1G,WAAO,IAAI,gBAAe,WAAW,OAAO,YAAY,SAAS,IAAI,OAAO;EAC9E;EAEA,QAAK;AACH,QAAI,KAAK,UAAU;AAAQ,YAAM,IAAI,MAAM,2BAA2B;AACtE,SAAK,QAAQ,gBAAgB,KAAK,YAAY,IAAI;EACpD;EAEA,IAAI,KAAO;AACT,YAAQ,IAAI,kBAAkB,GAAG;EACnC;EAEA,QAAQC,IAAgB,IAAe;AAErC,SAAK,cAAc,IAAI,YAAY,SAAS,EAAC,QAAO,EAAC,OAAMA,IAAG,GAAE,EAAC,CAAC,CAAC;EACrE;EAEA,eAAe,MAAa,MAAQ;AAClC,WAAO;MACL,GAAG;MACH,OAAO;;AAET,SAAK,GAAG,KAAK,IAAI;EACnB;;;;ACpGI,IAAO,mBAAP,MAAuB;EAGN;EAFb;EAER,YAAqB,UAAe;AAAf,SAAA,WAAA;AACnB,SAAK,SAAS,oBAAI,IAAG;AACrB,eAAW,MAAI;AACb,WAAK,SAAQ;IACf,GAAG,KAAK,IAAI,UAAU,KAAG,GAAI,CAAC;EAChC;EAEA,IAAI,aAAU;AACZ,UAAM,OAAO,CAAC,GAAG,KAAK,OAAO,KAAI,CAAE;AACnC,WAAO,KAAK;EACd;EAEA,WAAQ;AACN,UAAMC,WAAU,CAAC,GAAG,KAAK,OAAO,QAAO,CAAE;AACzC,UAAM,MAAM,KAAK,IAAG;AACpB,IAAAA,SAAQ,QAAQ,CAAC,CAACC,IAAG,GAAG,MAAK;AAC3B,YAAM,IAAI,OAAO,CAAAC,OAAGA,GAAE,YAAY,GAAG;AACrC,UAAI,IAAI,UAAU,GAAG;AACnB,aAAK,OAAO,OAAOD,EAAC;MACtB,OAAO;AACL,aAAK,OAAO,IAAIA,IAAG,GAAG;MACxB;IACF,CAAC;EACH;EAEA,IAAI,KAAK;AACP,UAAME,KAAI,KAAK,OAAO,IAAI,GAAG;AAC7B,QAAGA,OAAM;AAAW,aAAO,CAAA;AAC3B,WAAOA,GAAE,IAAI,CAAAD,OAAGA,GAAE,IAAI;EACxB;EAEA,CAAC,aAAa,KAAK;AACjB,UAAMC,KAAI,KAAK,OAAO,IAAI,GAAG;AAC7B,QAAGA,OAAM;AAAW;AACpB,aAASC,KAAE,GAAGA,KAAED,GAAE,QAAOC,MAAK;AAC5B,YAAMD,GAAEC,EAAC;IACX;EACF;EAEA,CAAC,OAAI;AACH,WAAO,KAAK,OAAO,KAAI;EACzB;EAEA,CAAC,aAAU;AACT,WAAO,KAAK,OAAO,QAAO;EAC5B;EAEA,CAAC,UAAO;AACN,eAAWC,MAAK,KAAK,OAAO,QAAO,GAAI;AACrC,eAASD,KAAE,GAAEA,KAAEC,GAAE,CAAC,EAAE,QAAOD,MAAK;AAC9B,cAAM,CAACC,GAAE,CAAC,GAAGA,GAAE,CAAC,EAAED,EAAC,EAAE,IAAI;MAC3B;IACF;EACF;EAGA,OAAI;AACF,UAAM,MAAM,KAAK,IAAG;AAEpB,UAAME,SAAQ,CAACJ,OAAY;AACzB,UAAIG,KAAIH,KAAI;AACZ,UAAIG,KAAI;AAAM,eAAO,GAAGA,EAAC;AACzB,MAAAA,MAAK;AACL,UAAIA,KAAI;AAAM,eAAO,GAAG,KAAK,MAAMA,EAAC,CAAC;AACrC,MAAAA,MAAK;AACL,aAAO,GAAG,KAAK,MAAMA,EAAC,CAAC;IACzB;AAEA,QAAIE,KAAI;AACR,eAAW,CAACN,IAAEC,EAAC,KAAK,KAAK,OAAO,QAAO,GAAI;AACzC,MAAAK,MAAK,GAAGN,EAAC;AACT,eAASG,KAAE,GAAEA,KAAEF,GAAE,QAAOE,MAAK;AAC3B,QAAAG,MAAIL,GAAEE,EAAC,EAAE,OAAO,kBAAkBE,OAAMJ,GAAEE,EAAC,EAAE,SAAS,IAAI;MAC5D;IACF;AACA,QAAIG,GAAE,WAAW;AAAG,aAAO;;AACtB,aAAOA;EACd;EAEA,IAAI,KAAOC,QAAO;AAChB,QAAIL,KAAI,KAAK,OAAO,IAAI,GAAG;AAC3B,QAAIA,OAAM,QAAW;AACnB,MAAAA,KAAI,CAAA;AACJ,WAAK,OAAO,IAAI,KAAKA,EAAC;IACxB;AAEA,UAAM,WAAWA,GAAE,KAAK,CAAAD,OAAGA,GAAE,SAASM,MAAK;AAC3C,QAAI,aAAa,QAAW;AAC1B,MAAAL,GAAE,KAAK,EAAC,MAAKK,QAAO,WAAU,KAAK,IAAG,IAAK,KAAK,SAAQ,CAAC;IAC3D,OAAO;AACL,eAAS,YAAY,KAAK,IAAG,IAAK,KAAK;IACzC;EACF;;;;AC5DI,IAAO,UAAP,cAAuB,YAAW;EAMjB;EALb;EACA;EACA;EACA;EAER,YAAqB,SAAe;AAClC,UAAK;AADc,SAAA,UAAA;AAEnB,SAAK,OAAO,IAAIC,KAAI,WAAW,QAAQ,KAAK,cAA0B,QAAQ;AAC9E,SAAK,SAAS,oBAAI,IAAG;AACrB,SAAK,cAAc,CAAA;AACnB,SAAK,aAAa,IAAI,iBAAiB,KAAG,GAAI;EAChD;EAEA,aAAa,QAAa;AACxB,WAAO,KAAK,WAAW,IAAI,MAAM;EACnC;EAEA,eAAe,QAAa;AAC1B,WAAO,KAAK,OAAO,IAAI,MAAM;EAC/B;EAEA,mBAAmB,YAA6B,UAA2B,MAAgB;AACzF,SAAK,cAAc,IAAI,YAAoC,oBAAoB;MAC7E,QAAQ;QACN;QAAU;QAAY;;KAEzB,CAAC;EACJ;EAEA,WAAW,aAAkB;AAC3B,eAAWC,MAAK,KAAK,OAAO,OAAM,GAAI;AACpC,UAAIA,GAAE,WAAW,WAAW;AAAG,eAAO;IACxC;EACF;EAEA,gBAAa;AACX,YAAQ,MAAM,SAAS;AACvB,YAAQ,MAAM,cAAc;AAC5B,eAAWA,MAAK,KAAK,OAAO,OAAM,GAAI;AACpC,UAAIC,MAAKD,GAAE,KAAK,KAAKA,GAAE,KAAK;;AAC5B,YAAM,WAAWA,GAAE;AACnB,iBAAWE,MAAK,UAAU;AACxB,QAAAD,OAAM,QAASC,GAAE,QAAQ,OAAO,OAAOA,GAAE,QAAO,OAAOA,GAAE,KAAK;MAChE;AACA,cAAQ,IAAID,GAAE;IAChB;AACA,YAAQ,SAAQ;AAEhB,QAAI,KAAK,YAAY,SAAS,GAAG;AAC/B,cAAQ,MAAM,aAAa;AAC3B,iBAAWC,MAAK,KAAK,aAAa;AAChC,gBAAQ,IAAIA,GAAE,QAAQ,MAAMA,GAAE,QAAQ,OAAO,MAAMA,GAAE,KAAK,MAAMA,GAAE,cAAa,CAAE;MACnF;AACA,cAAQ,SAAQ;IAClB;AAEA,QAAI,KAAK,WAAW,aAAa,GAAG;AAClC,cAAQ,MAAM,WAAW;AACzB,cAAQ,IAAI,KAAK,WAAW,KAAI,CAAE;AAClC,cAAQ,SAAQ;IAClB;AAIA,YAAQ,SAAQ;EAClB;EAEA,qBAAqBA,IAAgB;AAEnC,UAAMF,KAAI,KAAK,YAAYE,GAAE,UAAU;AACvC,IAAAF,GAAE,qBAAqBE,EAAC;AACxB,SAAK,cAAc,KAAK,YAAY,OAAO,CAAAC,OAAGA,GAAE,OAAOD,GAAE,EAAE;EAC7D;EAEA,WAAQ;AACN,UAAM,KAAK,CAAC,GAAG,KAAK,WAAW;AAC/B,OAAG,QAAQ,CAAAE,OAAI;AACb,MAAAA,GAAE,SAAQ;IACZ,CAAC;AAED,SAAK,cAAc,KAAK,YAAY,OAAO,CAAAA,OACzCA,GAAE,UAAU,UACZA,GAAE,SAAS,UACXA,GAAE,UAAU,SAAS;AAEvB,UAAM,QAAQ,CAAC,GAAG,KAAK,OAAO,OAAM,CAAE;AACtC,UAAM,QAAQ,CAAAJ,OAAI;AAChB,MAAAA,GAAE,SAAQ;AAEV,UAAI,KAAK,QAAQ;AAAgB,gBAAQ,IAAIA,GAAE,KAAI,CAAE;IACvD,CAAC;AAED,UAAM,OAAO,MAAM,OAAO,CAAAA,OAAKA,GAAE,MAAM;AACvC,eAAWK,MAAK,MAAM;AACpB,WAAK,KAAK,QAAQ,uBAAuBA,GAAE,EAAE,EAAE;AAC/C,WAAK,cAAc,IAAI,YAA+B,sBAAsB;QAC1E,QAAQ;UACN,MAAMA;UACN,MAAM;;OAET,CAAC;AACF,WAAK,OAAO,OAAOA,GAAE,EAAE;IACzB;AAEA,QAAI,KAAK,QAAQ;AAAgB,cAAQ,IAAI,KAAK,WAAW,KAAI,CAAE;EACtE;EAEC,YAAY,IAAS;AACnB,QAAIL,KAAI,KAAK,OAAO,IAAI,EAAE;AAC1B,QAAIA,OAAM,QAAW;AACnB,MAAAA,KAAI,IAAI,YAAY,IAAI,IAAI;AAC5B,WAAK,OAAO,IAAI,IAAIA,EAAC;AACrB,WAAK,cAAc,IAAI,YAA+B,oBAAoB;QACxE,QAAQ;UACN,MAAMA;UACN,MAAM;;OAET,CAAC;IACJ;AACA,WAAOA;EACT;EAEA,mBAAmB,QAAe,SAAuB;AACvD,WAAO,KAAK,YAAY,KAAK,CAAAG,OAAKA,GAAE,eAAe,UAAUA,GAAE,YAAY,OAAO;EACpF;EAEA,uBAAuB,SAAc;AACnC,WAAO,KAAK,YAAY,KAAK,CAAAA,OAAKA,GAAE,OAAO,OAAO;EACpD;EAGA,2BAA2B,QAAa;AACtC,WAAO,KAAK,YAAY,KAAK,CAAAA,OAAKA,GAAE,eAAe,MAAM;EAC3D;EAEA,iBAAiBC,IAAiB,IAAe;AAC/C,QAAI;AACF,YAAM,UAAUA,GAAE;AAGlB,UAAI,YAAY,KAAK,QAAQ;AAAQ;AAErC,UAAI,KAAK,2BAA2BA,GAAE,OAAO,GAAG;AAC9C,aAAK,KAAK,4DAA4DA,GAAE,OAAO,aAAa,KAAK,QAAQ,MAAM,EAAE;AACjH;MACF;AAGA,WAAK,cAAcA,IAAG,EAAE;IAC1B,SAAS,IAAI;AACX,WAAK,KAAK,EAAE;IACd;EACF;EAEA,QAAQE,IAAgB,IAAe;AACrC,UAAMJ,KAAI,KAAK,uBAAuBI,GAAE,gBAAgB;AACxD,QAAIJ,OAAM,QAAW;AACnB,WAAK,KAAK,KAAK,+CAA+CI,GAAE,gBAAgB,EAAE;AAClF,WAAK,KAAK,KAAKA,EAAC;AAChB,WAAK,KAAK,KAAK,eAAe,KAAK,YAAY,IAAI,CAAAH,OAAKA,GAAE,EAAE,EAAE,KAAK,IAAI,CAAC;AACxE;IACF;AAEA,IAAAD,GAAE,QAAQI,IAAG,EAAE;EACjB;EAEA,cAAcF,IAAiB,IAAe;AAC5C,UAAM,UAAU,KAAK,MAAMA,GAAE,OAAO;AAEpC,UAAMG,MAAK,KAAK,QAAQ,kBAAkBH,GAAE,OAAO;AACnD,QAAIG,QAAO,QAAW;AACpB,WAAK,KAAK,mCAAmCH,GAAE,OAAO,4BAA4B;AAClF;IACF;AAEA,UAAMF,KAAI,eAAe,OAAOE,GAAE,kBAAkBA,GAAE,SAASG,KAAI,IAAI,KAAK,OAAO;AACnF,SAAK,YAAY,KAAKL,EAAC;AACvB,IAAAK,IAAG,iBAAiBH,IAAGF,IAAG,EAAE;EAC9B;EAEA,KAAK,KAAO;AACV,YAAQ,KAAK,kBAAkB,GAAG;EACpC;EAEA,eAAe,MAAa,IAA8B;AACxD,SAAK,WAAW,IAAI,MAAM,EAAE;EAC9B;EAEA,iBAAiBM,KAAkB,IAAe;AAChD,UAAMR,KAAI,KAAK,YAAYQ,IAAG,MAAM;AACpC,UAAM,WAAWA,IAAG,SAAS,MAAM,IAAI;AAGvC,SAAK,eAAeA,IAAG,QAAQ,EAAE;AAEjC,aAAS,QAAQ,CAAAC,OAAI;AACnB,UAAIA,GAAE,WAAW,KAAKA,OAAM;AAAW;AAGvC,YAAMF,MAAK,KAAK,QAAQ,kBAAkBE,EAAC;AAC3C,UAAIF,QAAO,QAAW;AAEpB;MACF;AAEA,UAAI,CAACP,GAAE,WAAWS,EAAC,GAAG;AAEpB,cAAM,aAAa,KAAK,mBAAmBD,IAAG,QAAQD,GAAE;AACxD,YAAI,YAAY;QAEhB,OAAO;AAEL,gBAAM,QAAQ,eAAe,SAAUC,IAAG,QAAQD,KAAI,IAAI,KAAK,OAAO;AACtE,eAAK,YAAY,KAAK,KAAK;AAC3B,gBAAM,MAAK;QACb;MACF;IAIF,CAAC;EACH;EAEA,kBAAe;AACb,WAAO,CAAC,GAAG,KAAK,OAAO,OAAM,CAAE;EACjC;;;;ACpQF,IAAM,oBAAN,MAAuB;EASA;EARrB;EACA;EACA;EAEA;EACA;EACA;EAEA,YAAqB,SAAsB;AAAtB,SAAA,UAAA;AACnB,SAAK,MAAM,IAAI,kBAAkB;MAC/B,YAAY;QACV,EAAC,MAAM,CAAC,gCAAgC,EAAC;QACzC,EAAC,MAAM,CAAC,8BAA8B,EAAC;;KAE1C;AACD,SAAK,OAAOG,KAAI,WAAW,QAAQ,QAAQ,MAAM,OAAO,mBAAmB;AAE3E,SAAK,gBAAgB,KAAK,YAAY,KAAK,IAAI;AAC/C,SAAK,YAAY,KAAK,QAAQ,KAAK,IAAI;AACvC,SAAK,WAAW,KAAK,OAAO,KAAK,IAAI;AAGrC,YAAQ,iBAAiB,SAAS,KAAK,SAAS;AAChD,YAAQ,iBAAiB,aAAY,KAAK,aAAa;AACvD,YAAQ,iBAAiB,QAAO,KAAK,QAAQ;EAC/C;EAMA,OAAO,KAAS;AACd,UAAM,OAAQ,IAAoB;AAClC,QAAI,KAAK,KAAK;AACZ,cAAQ,IAAI,eAAe,IAAI;AAC/B,WAAK,IAAI,KAAK,KAAK,UAAU,IAAI,CAAC;IACpC,OAAO;AACL,WAAK,KAAK,kCAAkC;IAC9C;EACF;EAEA,cAAW;AACT,SAAK,KAAK,QAAQ,aAAa;AAE/B,SAAK,QAAQ,oBAAoB,SAAS,KAAK,SAAS;AACxD,SAAK,QAAQ,oBAAoB,aAAY,KAAK,aAAa;EAEjE;EAEA,QAAQ,KAAe;AACrB,UAAM,EAAE,OAAO,GAAE,IAAI,IAAI;AACzB,UAAM,UAAU,MAAM;AACtB,YAAQ,SAAS;MACf,KAAK;AACH,YAAI;AACF,gBAAM,QAAQ,KAAK,MAAM,MAAM,OAAO;AACtC,eAAK,IAAI,qBAAqB,KAAK;QACrC,SAAS,IAAI;AACX,eAAK,KAAK,EAAE;QACd;AACA;MACF,KAAK;AACH,YAAI;AACJ,gBAAMC,KAAI,IAAI,gBAAgB;YAC5B,eAAgB,MAAc;YAC9B,WAAY,MAAc;WAC3B;AACD,eAAK,IAAI,gBAAgBA,EAAC;QAC1B,SAAS,IAAI;AACX,eAAK,KAAK,EAAE;AACZ,eAAK,KAAK,KAAK;QACjB;AACA;MACF;AACE,aAAK,KAAK,QAAQ,uBAAuB,OAAO,EAAE;IACtD;EACF;EAGA,KAAK,KAAO;AACV,YAAQ,KAAK,qBAAqB,GAAG;EACvC;EAEA,MAAM,QAAK;AAET,UAAMC,KAAK,KAAK;AAChB,UAAM,KAAK,KAAK,IAAI,kBAAkB,GAAG,KAAK,QAAQ,UAAU,EAAE;AAClE,SAAK,iBAAiB,EAAE;AACxB,IAAAA,GAAE,iBAAiB,gBAAgB,SAAM;AAEvC,YAAMD,KAAI,IAAI;AACd,UAAIA,OAAM;AAAM;AAChB,WAAK,QAAQ,eAAe,iBAAgB;QAC1C,KAAK;QACL,kBAAkB,KAAK,QAAQ;QAC/B,OAAOA,GAAE;QACT,IAAIA,GAAE;QACN,WAAWA,GAAE;OACd;IACH,CAAC;AACD,IAAAC,GAAE,iBAAiB,SAAS,SAAM;AAChC,WAAK,KAAK,QAAQ,eAAe;IACnC,CAAC;AACD,IAAAA,GAAE,iBAAiB,SAAS,SAAM;AAChC,WAAK,KAAK,QAAQ,eAAe;IACnC,CAAC;AACD,IAAAA,GAAE,iBAAiB,QAAQ,SAAM;AAC/B,WAAK,KAAK,QAAQ,cAAc;IAClC,CAAC;AACD,IAAAA,GAAE,iBAAiB,WAAW,SAAM;AAClC,WAAK,KAAK,QAAQ,oBAAoB,KAAK,UAAU,GAAG,CAAC,EAAE;IAI7D,CAAC;AAGD,SAAK,MAAMA;AAEX,UAAMC,KAAI,MAAMD,GAAE,YAAY,EAAC,qBAAqB,OAAO,qBAAqB,MAAK,CAAC;AACtF,UAAMA,GAAE,oBAAoBC,EAAC;AAC7B,UAAM,SAAuB;MAC3B,SAAS,KAAK,QAAQ;MACtB,SAAS,KAAK,QAAQ,QAAQ;MAC9B,SAAS;MACT,kBAAkB,KAAK,QAAQ;MAC/B,SAAS,KAAK,UAAUA,EAAC;;AAE3B,SAAK,QAAQ,eAAe,kBAAkB,MAAM;EACtD;EAEA,iBAAiB,IAAiB;AAChC,SAAK,MAAM;AACX,OAAG,iBAAiB,SAAS,SAAM;AACjC,WAAK,KAAK,QAAQ,UAAU;AAC5B,WAAK,QAAQ,SAAS,qBAAqB;IAC7C,CAAC;AAED,OAAG,iBAAiB,WAAW,SAAM;AACnC,WAAK,KAAK,QAAQ,YAAY;IAChC,CAAC;AAED,OAAG,iBAAiB,SAAS,SAAM;AACjC,WAAK,KAAK,QAAQ,UAAU;IAC9B,CAAC;AAED,OAAG,iBAAiB,WAAW,SAAM;AAEnC,UAAI;AACF,cAAMA,KAAI,KAAK,MAAM,IAAI,IAAI;AAC7B,aAAK,QAAQ,kBAAkBA,IAAG,IAAI;MACxC,SAAQC,IAAG;AACT,aAAK,KAAK,KAAK,oBAAoB,IAAI,IAAI,EAAE;MAC/C;IACF,CAAC;AAED,OAAG,iBAAiB,QAAQ,SAAM;AAChC,WAAK,KAAK,QAAQ,SAAS;AAC3B,WAAK,QAAQ,SAAQ;IACvB,CAAC;EACH;EACA,iBAAiBC,IAAgB;AAC/B,SAAK,KAAK,QAAQ,0BAA0BA,GAAE,OAAO,EAAE;AACvD,QAAI;AACF,YAAM,UAAU,KAAK,MAAMA,GAAE,OAAO;AACpC,YAAMH,KAAI,KAAK;AACf,MAAAA,GAAE,iBAAiB,eAAe,SAAM;AACtC,aAAK,KAAK,QAAQ,uBAAuB;AACzC,aAAK,iBAAiB,IAAI,OAAO;MACnC,CAAC;AACD,MAAAA,GAAE,qBAAqB,OAAO;AAC9B,MAAAA,GAAE,aAAY,EAAG,KAAK,WAAQ;AAC5B,QAAAA,GAAE,oBAAoB,KAAK;AAE3B,aAAK,QAAQ,eAAe,iBAAiB;UAC3C,SAASG,GAAE;UACX,KAAK;UACL,kBAAkB,KAAK,QAAQ;UAC/B,SAASA,GAAE;UACX,SAAS,KAAK,UAAU,KAAK;SAC9B;MACH,CAAC;IAEH,SAAS,IAAI;AACX,cAAQ,KAAK,EAAE;IACjB;EACF;;AAGI,IAAO,oBAAP,MAAwB;EAC5B,cAAA;EAEA;EAEA,IAAI,OAAI;AACN,WAAO;EACT;EAEA,WAAQ;EAER;EAEA,iBAAiBA,IAAkB,SAAwB,IAAgB;AACzE,UAAMC,KAAI,IAAI,kBAAkB,OAAO;AACvC,IAAAA,GAAE,iBAAiBD,EAAC;EACtB;EAEA,gBAAgB,UAAkB,SAAuB;AACvD,UAAMC,KAAI,IAAI,kBAAkB,OAAO;AACvC,IAAAA,GAAE,MAAK;EACT;;;;AChNI,IAAO,gBAAP,MAAoB;EAID;EAHrB;EACD;EAEC,YAAqB,SAAiB,OAAyB,CAAA,GAAE;AAA5C,SAAA,UAAA;AACnB,UAAM,iBAAiB,KAAK,kBAAkB;AAC9C,UAAM,eAAe,KAAK,gBAAgB;AAC1C,SAAK,MAAM,KAAK,OAAO;AAEvB,UAAMC,KAAI,KAAK,MAAM,SAAS,eAAe,eAAe;AAE5D,QAAIA,OAAM;AAAM;AAEhB,UAAM,kBAAkB,CAACC,QAAkB;AACzC,MAAAA,IAAG,MAAM,UAAU;AACnB,MAAAA,IAAG,MAAM,aAAa;IACxB;AAGA,UAAM,eAAe,SAAS,cAAc,KAAK;AAEjD,iBAAa,OACX,KAAK,gBAAgB,MAAM,YAAY,GACvC,KAAK,gBAAgB,MAAM,kBAAkB,CAAC;AAEhD,oBAAgB,YAAY;AAC5B,IAAAD,GAAE,OAAO,YAAY;AAGrB,UAAM,iBAAiB,SAAS,cAAc,KAAK;AAEnD,oBAAgB,cAAc;AAC9B,IAAAA,GAAE,OAAO,cAAc;AAEvB,IAAAA,GAAE,MAAM,aAAa,QAAQ,KAAK,GAAG;AACrC,IAAAA,GAAE,MAAM,QAAQ,OAAO,KAAK,GAAG;AAC/B,IAAAA,GAAE,MAAM,SAAS,kBAAkB,KAAK,GAAG;AAC3C,IAAAA,GAAE,MAAM,WAAW;AACnB,IAAAA,GAAE,MAAM,WAAW;AACnB,IAAAA,GAAE,MAAM,SAAS;AACjB,IAAAA,GAAE,MAAM,QAAQ;AAChB,IAAAA,GAAE,MAAM,UAAU;AAClB,IAAAA,GAAE,MAAM,UAAU,eAAe,SAAQ;AAEzC,IAAAA,GAAE,iBAAiB,eAAe,MAAK;AACrC,MAAAA,GAAE,MAAM,UAAU;IACpB,CAAC;AACD,IAAAA,GAAE,iBAAiB,cAAc,MAAK;AACpC,MAAAA,GAAE,MAAM,UAAS,eAAe,SAAQ;IAC1C,CAAC;AACD,IAAAA,GAAE,iBAAiB,SAAS,MAAK;AAC/B,cAAQ,KAAI;IACd,CAAC;AAED,YAAQ,UAAU,iBAAiB,UAAU,SAAO;AAClD,YAAM,EAAC,YAAY,UAAU,OAAM,IAAK,IAAoB;AAC5D,WAAK,aAAa,cAAc,OAAO,MAAM,aAAa,QAAQ,QAAQ;IAC5E,CAAC;AAED,YAAQ,QAAQ,iBAAiB,oBAAoB,SAAM;AACzD,YAAM,EAAC,YAAY,UAAU,KAAI,IAAK,IAAoB;AAC1D,WAAK,aAAa,gBAAgB,KAAK,IAAI,KAAK,UAAU,QAAQ,KAAK,aAAY,CAAE;IACvF,CAAC;AAED,YAAQ,QAAQ,iBAAiB,oBAAoB,SAAM;AACzD,YAAM,EAAC,MAAM,KAAI,IAAK,IAAoB;AAC1C,qBAAe,OAAO,KAAK,gBAAgB,KAAK,IAAI,MAAM,CAAC;IAC7D,CAAC;AAED,YAAQ,QAAQ,iBAAiB,sBAAsB,SAAM;AAC3D,YAAM,EAAC,MAAM,KAAI,IAAK,IAAoB;AAC1C,YAAME,KAAI,KAAK,aAAa,gBAAgB,KAAK,EAAE;AACnD,UAAIA,OAAK;AAAM,QAAAA,GAAE,OAAM;IACzB,CAAC;AAED,gBAAY,MAAK;AACf,YAAM,QAAQ,KAAK,QAAQ,QAAQ,gBAAe;AAClD,YAAM,OAAO,oBAAI,IAAG;AACpB,iBAAWC,MAAK,OAAO;AACrB,aAAK,IAAIA,GAAE,EAAE;AAEb,YAAI,WAAWA,GAAE,aAAY;AAC7B,cAAM,MAAM,KAAK,QAAQ,QAAQ,aAAaA,GAAE,EAAE;AAClD,mBAAWH,MAAK,KAAK;AACnB,sBAAY,gBAAgBA,GAAE,OAAO,OAAOA,GAAE,QAAQ;QACxD;AACA,aAAK,aAAa,gBAAgBG,GAAE,IAAIA,GAAE,UAAU,QAAQ,QAAQ;MACtE;AAEA,YAAM,aAAa,KAAK,cAAc,cAAc;AACpD,iBAAWD,MAAK,YAAY;AAC1B,YAAI,CAAC,KAAK,IAAIA,GAAE,aAAa,UAAU,CAAC,GAAG;AACzC,UAAAA,GAAE,OAAM;QACV;MACF;IACF,GAAG,YAAY;EACjB;EAEA,cAAc,QAAkB;AAC9B,WAAO,MAAM,KAAK,OAAO,iBAAiB,mBAAmB,CAAC;EAChE;EAEA,aAAa,QAAoB,OAAY;AAC3C,WAAO,OAAO,cAAc,cAAc,KAAK,IAAI;EACrD;EAEA,aAAa,QAAoB,OAAc,OAAe,gBAAuB,IAAE;AACrF,QAAID,MAAK,KAAK,aAAa,QAAQ,KAAK;AACxC,QAAIA,QAAO,MAAM;AACf,MAAAA,MAAK,KAAK,gBAAgB,OAAO,aAAa;AAC9C,aAAO,OAAOA,GAAE;AAEhB;IACF;AAEA,UAAM,QAAQA,IAAG,aAAa,YAAY,IAAI,MAAM;AACpD,IAAAA,IAAG,QAAQ;AACX,QAAI,OAAO;AACT,MAAAA,IAAG,MAAM,SAAS,kBAAkB,KAAK,GAAG;IAC9C,OAAO;AACL,MAAAA,IAAG,MAAM,SAAS;IACpB;EACF;EAEA,gBAAgB,OAAc,QAAe,IAAE;AAC7C,UAAM,MAAM,SAAS,cAAc,KAAK;AACxC,QAAI,YAAY;AAChB,QAAI,QAAQ;AACZ,QAAI,UAAU,IAAI,kBAAkB;AACpC,QAAI,aAAa,YAAY,KAAK;AAClC,QAAI,MAAM,UAAU;AACpB,QAAI,aAAa,cAAc,KAAK;AACpC,WAAO;EACT;;;;AC9IE,IAAOG,SAAP,MAAY;EACT;EACA;EACP,YAAY,MAAc,QAAW;AACnC,SAAK,SAAS;AACd,SAAK,OAAO;EACd;;AAGI,IAAO,aAAP,cAA0BA,OAAK;EAC5B;EACA;EACP,YAAY,OAAc,QAAW;AACnC,UAAM,SAAS,MAAM;AACrB,SAAK,UAAU,MAAM;AACrB,SAAK,QAAQ;EACf;;AAGI,IAAO,aAAP,cAA0BA,OAAK;EAC5B;EACA;EACA,WAAW;EAClB,YAAY,OAAO,KAAM,SAAS,IAAI,QAAW;AAC/C,UAAM,SAAS,MAAM;AACrB,SAAK,OAAO;AACZ,SAAK,SAAS;EAChB;;;;ACjBF,IAAM,qBAAqB,MAA4B;AACrD,MAAI,OAAO,cAAc,aAAa;AAEpC,WAAO;EACT;AACF;AAKA,IAAM,cAAc,CAACC,OAAW,OAAOA,OAAM,eAAe,CAAC,CAACA,MAAKA,GAAE,YAAY;AAmBjF,IAAM,UAAU;EACd,sBAAsB;EACtB,sBAAsB,MAAO,KAAK,OAAM,IAAK;EAC7C,WAAW;EACX,6BAA6B;EAC7B,mBAAmB;EACnB,YAAY;EACZ,qBAAqB;EACrB,aAAa;EACb,OAAO;;AAcT,IAAqB,wBAArB,MAAqB,uBAAqB;EAChC;EACA,aAA2B;IACjC,OAAO,CAAA;IACP,SAAS,CAAA;IACT,MAAM,CAAA;IACN,OAAO,CAAA;;EAED,cAAc;EACd;EACA;EACA,mBAAmB;EACnB,eAAe;EACf,cAA0B;EAC1B,eAAe;EACf,gBAA2B,CAAA;EAElB;EACA;EACA;EAEjB,YAAY,KAAkB,WAA+B,UAAmB,CAAA,GAAE;AAChF,SAAK,OAAO;AACZ,SAAK,aAAa;AAClB,SAAK,WAAW;AAChB,QAAI,KAAK,SAAS,aAAa;AAC7B,WAAK,mBAAmB;IAC1B;AACA,SAAK,SAAQ;EACf;EAEA,WAAW,aAAU;AACnB,WAAO;EACT;EACA,WAAW,OAAI;AACb,WAAO;EACT;EACA,WAAW,UAAO;AAChB,WAAO;EACT;EACA,WAAW,SAAM;AACf,WAAO;EACT;EAEA,IAAI,aAAU;AACZ,WAAO,uBAAsB;EAC/B;EACA,IAAI,OAAI;AACN,WAAO,uBAAsB;EAC/B;EACA,IAAI,UAAO;AACT,WAAO,uBAAsB;EAC/B;EACA,IAAI,SAAM;AACR,WAAO,uBAAsB;EAC/B;EAEA,IAAI,aAAU;AACZ,WAAO,KAAK,MAAM,KAAK,IAAI,aAAa,KAAK;EAC/C;EAEA,IAAI,WAAWC,QAAiB;AAC9B,SAAK,cAAcA;AACnB,QAAI,KAAK,KAAK;AACZ,WAAK,IAAI,aAAaA;IACxB;EACF;EAKA,IAAI,aAAU;AACZ,WAAO,KAAK,IAAI,KAAK,aAAa,CAAC;EACrC;EAQA,IAAI,iBAAc;AAChB,UAAM,QAAQ,KAAK,cAAc,OAAO,CAAC,KAAK,YAAW;AACvD,UAAI,OAAO,YAAY,UAAU;AAC/B,eAAO,QAAQ;MACjB,WAAW,mBAAmB,MAAM;AAClC,eAAO,QAAQ;MACjB,OAAO;AACL,eAAO,QAAQ;MACjB;AACA,aAAO;IACT,GAAG,CAAC;AACJ,WAAO,SAAS,KAAK,MAAM,KAAK,IAAI,iBAAiB;EACvD;EAMA,IAAI,aAAU;AACZ,WAAO,KAAK,MAAM,KAAK,IAAI,aAAa;EAC1C;EAOA,IAAI,WAAQ;AACV,WAAO,KAAK,MAAM,KAAK,IAAI,WAAW;EACxC;EAKA,IAAI,aAAU;AACZ,QAAI,KAAK,KAAK;AACZ,aAAO,KAAK,IAAI;IAClB;AACA,WAAO,KAAK,SAAS,cACjB,uBAAsB,SACtB,uBAAsB;EAC5B;EAKA,IAAI,MAAG;AACL,WAAO,KAAK,MAAM,KAAK,IAAI,MAAM;EACnC;EAKO,UAAuD;EAKvD,UAAuD;EAKvD,YAAoD;EAMpD,SAA0C;EAM1C,MAAM,OAAO,KAAM,QAAe;AACvC,SAAK,eAAe;AACpB,SAAK,mBAAmB;AACxB,SAAK,eAAc;AACnB,QAAI,CAAC,KAAK,KAAK;AACb,WAAK,OAAO,gCAAgC;AAC5C;IACF;AACA,QAAI,KAAK,IAAI,eAAe,KAAK,QAAQ;AACvC,WAAK,OAAO,uBAAuB;AACnC;IACF;AACA,SAAK,IAAI,MAAM,MAAM,MAAM;EAC7B;EAMO,UAAU,MAAe,QAAe;AAC7C,SAAK,mBAAmB;AACxB,SAAK,eAAe;AACpB,SAAK,cAAc;AACnB,QAAI,CAAC,KAAK,OAAO,KAAK,IAAI,eAAe,KAAK,QAAQ;AACpD,WAAK,SAAQ;IACf,OAAO;AACL,WAAK,YAAY,MAAM,MAAM;AAC7B,WAAK,SAAQ;IACf;EACF;EAEO,UAAO;AACZ,QAAI,KAAK,OAAO,KAAK,IAAI,eAAe,KAAK;AAC3C,aAAO;AACT,WAAO;EACT;EAKO,KAAK,MAAa;AACvB,QAAI,KAAK,OAAO,KAAK,IAAI,eAAe,KAAK,MAAM;AACjD,WAAK,OAAO,QAAQ,IAAI;AACxB,WAAK,IAAI,KAAK,IAAI;IACpB,OAAO;AACL,YAAM,EAAC,sBAAsB,QAAQ,oBAAmB,IAAI,KAAK;AACjE,UAAI,KAAK,cAAc,SAAS,qBAAqB;AACnD,aAAK,OAAO,WAAW,IAAI;AAC3B,aAAK,cAAc,KAAK,IAAI;MAC9B;IACF;EACF;EAKO,iBACL,MACA,UAA6C;AAE7C,QAAI,KAAK,WAAW,IAAI,GAAG;AAEzB,WAAK,WAAW,IAAI,EAAE,KAAK,QAAQ;IACrC;EACF;EAEO,cAAcC,QAAY;AAC/B,UAAM,YAAY,KAAK,WAAWA,OAAM,IAA8C;AACtF,QAAI,WAAW;AACb,iBAAW,YAAY,WAAW;AAChC,aAAK,mBAAmBA,QAAO,QAAQ;MACzC;IACF;AACA,WAAO;EACT;EAKO,oBACL,MACA,UAA6C;AAE7C,QAAI,KAAK,WAAW,IAAI,GAAG;AAEzB,WAAK,WAAW,IAAI,IAAI,KAAK,WAAW,IAAI,EAAE,OAAO,CAAAC,OAAKA,OAAM,QAAQ;IAC1E;EACF;EAEQ,UAAU,MAAW;AAC3B,QAAI,KAAK,SAAS,OAAO;AAGvB,cAAQ,IAAI,MAAM,SAAS,CAAC,QAAQ,GAAG,IAAI,CAAC;IAC9C;EACF;EAEQ,gBAAa;AACnB,UAAM,EACJ,8BAA8B,QAAQ,6BACtC,uBAAuB,QAAQ,sBAC/B,uBAAuB,QAAQ,qBAAoB,IACjD,KAAK;AACT,QAAIC,SAAQ;AACZ,QAAI,KAAK,cAAc,GAAG;AACxB,MAAAA,SACE,uBAAuB,KAAK,IAAI,6BAA6B,KAAK,cAAc,CAAC;AACnF,UAAIA,SAAQ,sBAAsB;AAChC,QAAAA,SAAQ;MACV;IACF;AACA,SAAK,OAAO,cAAcA,MAAK;AAC/B,WAAOA;EACT;EAEQ,QAAK;AACX,WAAO,IAAI,QAAQ,CAAAC,aAAU;AAC3B,iBAAWA,UAAS,KAAK,cAAa,CAAE;IAC1C,CAAC;EACH;EAEQ,YAAY,aAAwB;AAC1C,QAAI,OAAO,gBAAgB,UAAU;AACnC,aAAO,QAAQ,QAAQ,WAAW;IACpC;AACA,QAAI,OAAO,gBAAgB,YAAY;AACrC,YAAM,MAAM,YAAW;AACvB,UAAI,OAAO,QAAQ,UAAU;AAC3B,eAAO,QAAQ,QAAQ,GAAG;MAC5B;AAEA,UAAI,IAAI,MAAM;AACZ,eAAO;MACT;IACF;AACA,UAAM,MAAM,aAAa;EAC3B;EAEQ,WAAQ;AACd,QAAI,KAAK,gBAAgB,CAAC,KAAK,kBAAkB;AAC/C;IACF;AACA,SAAK,eAAe;AAEpB,UAAM,EACJ,aAAa,QAAQ,YACrB,oBAAoB,QAAQ,mBAC5B,WAAAC,aAAY,mBAAkB,EAAE,IAC9B,KAAK;AAET,QAAI,KAAK,eAAe,YAAY;AAClC,WAAK,OAAO,uBAAuB,KAAK,aAAa,MAAM,UAAU;AACrE;IACF;AAEA,SAAK;AAEL,SAAK,OAAO,WAAW,KAAK,WAAW;AACvC,SAAK,iBAAgB;AACrB,QAAI,CAAC,YAAYA,UAAS,GAAG;AAC3B,YAAM,MAAM,mCAAmC;IACjD;AACA,SAAK,MAAK,EACP,KAAK,MAAM,KAAK,YAAY,KAAK,IAAI,CAAC,EACtC,KAAK,SAAM;AAEV,UAAI,KAAK,cAAc;AACrB;MACF;AACA,WAAK,OAAO,WAAW,EAAC,KAAK,WAAW,KAAK,WAAU,CAAC;AACxD,WAAK,MAAM,KAAK,aACZ,IAAIA,WAAU,KAAK,KAAK,UAAU,IAClC,IAAIA,WAAU,GAAG;AACrB,WAAK,IAAK,aAAa,KAAK;AAC5B,WAAK,eAAe;AACpB,WAAK,cAAa;AAElB,WAAK,kBAAkB,WAAW,MAAM,KAAK,eAAc,GAAI,iBAAiB;IAClF,CAAC;EACL;EAEQ,iBAAc;AACpB,SAAK,OAAO,eAAe;AAC3B,SAAK,aAAa,IAAW,WAAW,MAAM,SAAS,GAAG,IAAI,CAAC;EACjE;EAEQ,YAAY,OAAO,KAAM,QAAe;AAC9C,SAAK,eAAc;AACnB,QAAI,CAAC,KAAK,KAAK;AACb;IACF;AACA,SAAK,iBAAgB;AACrB,QAAI;AACF,WAAK,IAAI,MAAM,MAAM,MAAM;AAC3B,WAAK,aAAa,IAAW,WAAW,MAAM,QAAQ,IAAI,CAAC;IAC7D,SAAS,OAAO;IAEhB;EACF;EAEQ,cAAW;AACjB,SAAK,OAAO,aAAa;AACzB,SAAK,cAAc;EACrB;EAEQ,mBACNJ,QACA,UAA6C;AAE7C,QAAI,iBAAiB,UAAU;AAE7B,eAAS,YAAYA,MAAK;IAC5B,OAAO;AAEL,eAASA,MAAK;IAChB;EACF;EAEQ,cAAc,CAACA,WAAgB;AACrC,SAAK,OAAO,YAAY;AACxB,UAAM,EAAC,YAAY,QAAQ,UAAS,IAAI,KAAK;AAE7C,iBAAa,KAAK,eAAe;AACjC,SAAK,iBAAiB,WAAW,MAAM,KAAK,YAAW,GAAI,SAAS;AAEpE,SAAK,IAAK,aAAa,KAAK;AAG5B,SAAK,cAAc,QAAQ,aAAW,KAAK,KAAK,KAAK,OAAO,CAAC;AAC7D,SAAK,gBAAgB,CAAA;AAErB,QAAI,KAAK,QAAQ;AACf,WAAK,OAAOA,MAAK;IACnB;AACA,SAAK,WAAW,KAAK,QAAQ,cAAY,KAAK,mBAAmBA,QAAO,QAAQ,CAAC;EACnF;EAEQ,iBAAiB,CAACA,WAAuB;AAC/C,SAAK,OAAO,eAAe;AAE3B,QAAI,KAAK,WAAW;AAClB,WAAK,UAAUA,MAAK;IACtB;AACA,SAAK,WAAW,QAAQ,QAAQ,cAAY,KAAK,mBAAmBA,QAAO,QAAQ,CAAC;EACtF;EAEQ,eAAe,CAACA,WAA4B;AAClD,SAAK,OAAO,eAAeA,OAAM,OAAO;AACxC,SAAK,YAAY,QAAWA,OAAM,YAAY,YAAY,YAAY,MAAS;AAE/E,QAAI,KAAK,SAAS;AAChB,WAAK,QAAQA,MAAK;IACpB;AACA,SAAK,OAAO,sBAAsB;AAClC,SAAK,WAAW,MAAM,QAAQ,cAAY,KAAK,mBAAmBA,QAAO,QAAQ,CAAC;AAElF,SAAK,SAAQ;EACf;EAEQ,eAAe,CAACA,WAA4B;AAClD,SAAK,OAAO,aAAa;AACzB,SAAK,eAAc;AAEnB,QAAI,KAAK,kBAAkB;AACzB,WAAK,SAAQ;IACf;AAEA,QAAI,KAAK,SAAS;AAChB,WAAK,QAAQA,MAAK;IACpB;AACA,SAAK,WAAW,MAAM,QAAQ,cAAY,KAAK,mBAAmBA,QAAO,QAAQ,CAAC;EACpF;EAEQ,mBAAgB;AACtB,QAAI,CAAC,KAAK,KAAK;AACb;IACF;AACA,SAAK,OAAO,iBAAiB;AAC7B,SAAK,IAAI,oBAAoB,QAAQ,KAAK,WAAW;AACrD,SAAK,IAAI,oBAAoB,SAAS,KAAK,YAAY;AACvD,SAAK,IAAI,oBAAoB,WAAW,KAAK,cAAc;AAE3D,SAAK,IAAI,oBAAoB,SAAS,KAAK,YAAY;EACzD;EAEQ,gBAAa;AACnB,QAAI,CAAC,KAAK,KAAK;AACb;IACF;AACA,SAAK,OAAO,cAAc;AAC1B,SAAK,IAAI,iBAAiB,QAAQ,KAAK,WAAW;AAClD,SAAK,IAAI,iBAAiB,SAAS,KAAK,YAAY;AACpD,SAAK,IAAI,iBAAiB,WAAW,KAAK,cAAc;AAExD,SAAK,IAAI,iBAAiB,SAAS,KAAK,YAAY;EACtD;EAEQ,iBAAc;AACpB,iBAAa,KAAK,eAAe;AACjC,iBAAa,KAAK,cAAc;EAClC;;;;AChgBI,IAAO,qBAAP,cAAkC,gBAAe;EAC7C;EAER,YAAY,WAAqB,WAAiB;AAChD,UAAM,MAAM,WAAWK,KAAI,WAAW,UAAU,SAAS,MAAM,MAAM,oBAAoB,CAAC;AAC1F,UAAM,MAAM,cAAc,SAAS,aAAa,UAAU,UAAU,YAAY,SAAS,OAAO;AAEhG,SAAK,MAAM,IAAI,sBAAsB,GAAG;AACxC,QAAI,2BAA2B;AAC/B,SAAK,IAAI,iBAAiB,SAAS,SAAM;AACvC,WAAK,KAAK,QAAQ,OAAO;AACzB,WAAK,SAAS,QAAQ;IACxB,CAAC;AAED,SAAK,IAAI,iBAAiB,SAAS,SAAM;AAEvC,UAAI,IAAI,YAAY,aAAa;AAA0B;AAE3D,WAAK,KAAK,KAAK,UAAU,GAAG,EAAE;AAC9B,iCAA2B;AAE3B,WAAK,SAAS,OAAO;IAEvB,CAAC;AAED,SAAK,IAAI,iBAAiB,WAAW,SAAM;AACzC,UAAI;AACF,cAAMC,KAAI,KAAK,MAAM,IAAI,IAAI;AAC7B,aAAK,WAAW,UAAUA,IAAG,IAAI;MACnC,SAASC,IAAG;AACV,aAAK,KAAK,KAAKA,EAAC;MAClB;IACF,CAAC;AAED,SAAK,IAAI,iBAAiB,QAAQ,SAAM;AACtC,iCAA2B;AAC3B,WAAK,SAAS,MAAM;AACpB,WAAK,KAAK,QAAQ,gBAAgB,GAAG,EAAE;IACzC,CAAC;EACH;EAGA,WAAQ;AACN,WAAO;EACT;EAEA,WAAQ;EAER;EAEA,KAAK,SAAW;AACd,cAAS,KAAK,WAAW,SAAS,iBAAiB,OAAO;AAC1D,YAAQ,WAAW;AACnB,SAAK,IAAI,KAAK,KAAK,UAAU,OAAO,CAAC;AACrC,WAAO;EACT;;;;ACpCI,IAAO,UAAP,cAAuB,YAAW;EAYjB;EAXJ;EACR;EACA;EACD;EACR;EACQ;EACA;EACA;EAEC;EAET,YAAqB,OAAgB,CAAA,GAAE;AACrC,UAAK;AADc,SAAA,OAAA;AAEnB,SAAK,WAAW,oBAAI,IAAG;AAEvB,SAAK,SAAS,KAAK,WAAU,oBAAI,KAAI,GAAG,gBAAe,IAAK,MAAM,KAAK,MAAM,KAAK,OAAM,IAAK,GAAG;AAChG,SAAK,gBAAgB,KAAK,gBAAgB;AAC1C,SAAK,iBAAiB,KAAK,iBAAiB;AAC5C,SAAK,cAAc,KAAK,cAAc;AACtC,QAAI,CAAC,KAAK;AAAK,WAAK,MAAM,CAAA;AAC1B,QAAI,CAAC,KAAK,IAAI;AAAK,WAAK,IAAI,MAAM,KAAK;AACvC,QAAI,CAAC,KAAK,IAAI;AAAI,WAAK,IAAI,KAAK,KAAK;AACrC,SAAK,IAAI,OAAQ,KAAK,MAAO,sBAAuB,KAAK,aAAc,EAAE;AAEzE,SAAK,UAAU,IAAI,QAAQ,IAAI;AAC/B,SAAK,YAAY,IAAI,UAAU,IAAI;AAEnC,SAAK,oBAAoB,CAAA;AACzB,SAAK,iBAAiB,IAAI,cAAc,IAAI;AAE5C,QAAI,KAAK,eAAe;AACtB,WAAK,UAAU,IAAI,IAAI,mBAAmB,KAAK,WAAW,KAAK,SAAS,CAAC;AACzE,WAAK,kBAAkB,IAAI,kBAAiB,CAAE;IAChD;AACA,QAAI,YAAY,YAAW,GAAI;AAC7B,WAAK,UAAU,IAAI,IAAI,YAAY,KAAK,SAAS,CAAC;IACpD,OAAO;AACL,WAAK,IAAI,gDAAgD;IAC3D;AAEA,UAAM,SAAS,KAAK,kBAAkB,KAAK,MAAQ,KAAK,MAAO,KAAK,OAAM;AAC1E,gBAAY,MAAK;AACf,WAAK,SAAQ;IACf,GAAG,MAAM;AAET,eAAW,MAAK;AACd,WAAK,UAAS;IAChB,GAAG,MAAO,KAAK,OAAM,CAAE;EACzB;EAEA,kBAAkB,MAAY;AAC5B,WAAO,KAAK,kBAAkB,KAAK,CAAAC,OAAKA,GAAE,SAAS,IAAI;EACzD;EAEA,kBAAkBA,IAAkB;AAClC,SAAK,kBAAkB,KAAKA,EAAC;EAC/B;EAEA,oBAAoB,MAAW,KAAiB;AAC9C,SAAK,cAAc,IAAI,YAAY,WAAW;MAC5C,QAAQ;KACT,CAAC;EACJ;EAEA,kBAAkB,MAAc,KAAwB;AACtD,SAAK,cAAc,IAAI,YAAY,WAAW;MAC5C,QAAQ;KACT,CAAC;EACJ;EAEA,KAAK,MAAWC,KAAW;AACzB,WAAO,KAAK,iBAAiB,IAAI;AAEjC,QAAIA,QAAO,UAAaA,IAAG,SAAS,GAAG;AACrC,WAAK,MAAMA;AACX,YAAMC,KAAI,KAAK,QAAQ,eAAeD,GAAE;AACxC,UAAIC,OAAM,QAAW;AAEnB,YAAIA,GAAE,KAAK,IAAI,GAAG;AAEhB;QACF;MACF;AAGA,YAAM,WAAW,KAAK,QAAQ,aAAaD,GAAE;AAC7C,iBAAWE,OAAM,UAAU;AACzB,YAAIA,IAAG,KAAK,IAAI,GAAG;AACjB,kBAAQ,IAAI,mBAAoBA,IAAG,IAAK,EAAE;AAC1C;QACF;MACF;IACF;AAIA,SAAK,UAAU,KAAK,IAAI;EAC1B;EAEA,YAAS;AAEP,QAAIC,KAAI,KAAK,kBAAkB,IAAI,CAAAA,OAAKA,GAAE,IAAI;AAE9C,UAAM,KAAK;MACT,OAAO;MACP,QAAQ,KAAK;MACb,UAAUA,GAAE,KAAK,IAAI;;AAIvB,SAAK,UAAU,KAAK,EAAE,GAAG,GAAE,CAAE;EAC/B;EAGA,iBAAiB,SAAY;AAC3B,UAAMC,KAAI,OAAO;AACjB,QAAIA,OAAM,YAAYA,OAAM,YAAYA,OAAM,WAAW;AACvD,gBAAU,EAAE,MAAM,QAAO;IAC3B,WAAW,MAAM,QAAQ,OAAO,GAAG;AACjC,gBAAU,EAAE,MAAM,QAAO;IAC3B,WAAWA,OAAM,YAAYA,OAAM,YAAY;AAC7C,YAAM,IAAI,MAAM,oBAAqBA,EAAE,EAAE;IAC3C;AAEA,QAAI,QAAQ,QAAQ,QAAW;AAC7B,YAAM,KAAU,UAAS;AACzB,cAAQ,MAAM;AACd,WAAK,SAAS,IAAI,EAAE;IACtB;AACA,YAAQ,QAAQ,KAAK;AACrB,WAAO;EACT;EAEA,iBAAiB,KAAQ;AACvB,QAAI,KAAK,SAAS,IAAI,IAAI,GAAG,GAAG;AAC9B,aAAO;IACT;AACA,SAAK,SAAS,IAAI,IAAI,GAAG;AACzB,WAAO;EACT;EAEQ,WAAQ;AACd,UAAM,OAAO,CAAE,GAAG,KAAK,SAAS,OAAM,CAAE;AACxC,SAAK,WAAW,IAAI,IAAI,KAAK,MAAM,KAAK,SAAS,CAAC,CAAC;AAEnD,SAAK,QAAQ,SAAQ;AACrB,SAAK,UAAU,SAAQ;AAEvB,UAAM,KAAK,CAAE,GAAG,KAAK,iBAAiB;AACtC,OAAG,QAAQ,CAAAL,OAAKA,GAAE,SAAQ,CAAE;AAE5B,SAAK,UAAS;EAChB;EAEA,OAAI;AACF,YAAQ,MAAM,QAAQ;AACtB,YAAQ,IAAI,mBAAoB,CAAE,GAAG,KAAK,SAAS,OAAM,CAAE,EAAG,MAAO,EAAE;AACvE,SAAK,QAAQ,cAAa;AAC1B,SAAK,UAAU,cAAa;AAC5B,YAAQ,SAAQ;EAClB;EAEA,IAAI,KAAW;AACb,YAAQ,IAAI,UAAU,GAAG;EAC3B;;;;AC1LI,IAAO,SAAP,MAAa;EACjB;EAEA,YAAY,MAAa;AACvB,SAAK,WAAW,IAAI,QAAQ,IAAI;AAChC,SAAK,SAAS,iBAAiB,WAAW,SAAM;AAE9C,YAAMM,KAAI,IAAI;AACd,aAAOA,GAAE;AACT,aAAOA,GAAE;AACT,WAAK,OAAOA,EAAC;IACf,CAAC;EACH;EAEA,IAAI,KAAE;AACJ,WAAO,KAAK,SAAS;EACvB;EAOA,KAAK,MAAWC,KAAW;AACzB,SAAK,SAAS,KAAK,MAAMA,GAAE;EAC7B;EAOA,UAAU,MAAS;AACjB,SAAK,SAAS,UAAU,KAAK,IAAI;EACnC;EAEA,OAAO,KAAQ;EAEf;;;;AClCK,IAAM,aAAN,cAAyB,YAAY;AAAA,EAC1C;AAAA,EAGA,YAAY,SAAkB;AAC5B,UAAM;AACN,SAAK,UAAU,IAAI,OAAO,QAAQ,MAAM;AAAA,EAC1C;AAAA,EAEA,aAAa,MAAsB,MAAW;AAC5C,QAAI,CAAC,KAAM;AACX,QAAI,KAAK,SAAS;AAChB,WAAK,QAAQ,KAAK,KAAK,UAAU,IAAI,CAAC;AAAA,IACxC;AAEA,QAAI,KAAK,OAAQ,MAAK,OAAO,MAAM,IAAI;AAEvC,UAAM,OAA2B,EAAE,MAAM,KAAK;AAC9C,SAAK,cAAc,IAAI,YAAY,QAAQ;AAAA,MACzC,QAAQ;AAAA,IACV,CAAC,CAAC;AAAA,EAEJ;AACF;;;AClBO,IAAM,WAAW,CAAC,SAAkC;AACzD,QAAM,OAAgB;AAAA,IACpB,SAAS;AAAA,MACP,OAAO;AAAA,MACP,MAAM;AAAA,IACR;AAAA,IACA,QAAQ;AAAA,MACN,YAAY;AAAA,IACd;AAAA,IACA,eAAe;AAAA,IACf;AAAA,IACA,QAAQ;AAAA,MACN,cAAc;AAAA,IAChB;AAAA,IACA,WAAW;AAAA,IACX,UAAU;AAAA,IACV,YAAY;AAAA,EACd;AACA,MAAI,SAAS,OAAQ,MAAK,OAAO,aAAa,SAAS;AAAA,WAC9C,SAAS,UAAW,MAAK,UAAU,eAAe,SAAS;AAAA,WAC3D,SAAS,OAAQ,MAAK,OAAO,aAAa,SAAS;AAC5D,SAAO;AACT;AAOO,IAAMC,YAAN,cAAuB,YAAY;AAAA,EAGxC;AAAA,EACA;AAAA,EAEA;AAAA,EAEA,YAAY,SAAiB,UAA4B,CAAC,GAAG;AAC3D,UAAM;AAEN,UAAM,WAAW,sBAAsB,aAAa,QAAQ,WAAW,GAAG,MAAM;AAChF,UAAM,OAAO,CAAC,UAAU,SAAS,QAA0B,IAAI;AAAA,MAC7D,GAAG,SAAS,QAAQ,QAAQ,QAAQ;AAAA,MACpC,GAAG;AAAA,IACL;AACA,SAAK,QAAQ;AACb,SAAK,MAAM,IAAI,IAAI,YAAY,KAAK,SAAS;AAC7C,UAAMC,MAAK,SAAS,cAAc,OAAO;AACzC,QAAI,CAACA,IAAI,OAAM,IAAI,MAAM,uCAAwC,OAAQ,EAAE;AAC3E,SAAK,KAAKA;AAEV,SAAK,UAAU,IAAI,QAAQ,KAAK,QAAQ,IAAI;AAC5C,SAAK,aAAa,IAAI,WAAW,IAAI;AACrC,SAAK,QAAQ,IAAI,WAAW,MAAM,IAAI;AACtC,SAAK,MAAM,iBAAiB,SAAS,CAAAC,WAAS;AAC5C,WAAK,cAAc,IAAI,YAAY,kBAAkB,EAAE,QAAQ,KAAK,MAAM,MAAM,CAAC,CAAC;AAAA,IACpF,CAAC;AAAA,EACH;AAAA,EAEA,IAAI,aAAa;AACf,WAAO,KAAK;AAAA,EACd;AAAA,EAEA,OAAO;AACL,UAAMD,MAAK,KAAK;AAChB,UAAM,OAAO,KAAK;AAClB,IAAAA,IAAG,WAAW,IAAI;AAClB,IAAAA,IAAG,iBAAiB,oBAAoB,CAACC,WAAU;AACjD,YAAM,SAAUA,OAAsB;AACtC,UAAI,OAAO,OAAO,KAAK,QAAQ,aAAa,GAAG;AAE7C,aAAK,IAAI,KAAK,yBAA0B,OAAO,EAAG,cAAe,KAAK,QAAQ,aAAa,CAAE,EAAE;AAC/F,aAAK,QAAQ,KAAK;AAClB,aAAK,QAAQ,UAAU,MAAM;AAAA,MAC/B;AACA,YAAM,UAAU,KAAK,QAAQ,UAAU;AAAA,IACzC,CAAC;AAGD,IAAAD,IAAG,iBAAiB,kBAAkB,CAAAC,WAAS;AAC7C,YAAM,SAAUA,OAAsB;AACtC,WAAK,QAAQ,KAAK;AAClB,WAAK,QAAQ,UAAU,MAAM;AAC7B,WAAK,QAAQ,MAAM;AAAA,IACrB,CAAC;AAED,IAAAD,IAAG,iBAAiB,oBAAoB,MAAM;AAC5C,YAAME,KAAI,KAAK,QAAQ,eAAe;AACtC,MAAAA,GAAE,MAAM,KAAK,MAAM,aAAa;AAChC,MAAAF,IAAG,WAAWE;AAAA,IAChB,CAAC;AAED,IAAAF,IAAG,iBAAiB,yBAAyB,CAAAC,WAAS;AACpD,YAAM,SAAUA,OAAsB;AACtC,WAAK,QAAQ,OAAO,MAAM;AAAA,IAC5B,CAAC;AAED,IAAAD,IAAG,iBAAiB,gBAAgB,CAAAC,WAAS;AAC3C,YAAM,MAAOA,OAAsB;AACnC,cAAQ,IAAI,GAAG;AACf,WAAK,MAAM,QAAQ,sBAAsB,IAAI,IAAI,CAAC;AAAA,IACpD,CAAC;AAED,SAAK,WAAW,iBAAiB,QAAQ,CAAAA,WAAS;AAChD,YAAM,OAAQA,OAAsB;AACpC,MAAAD,IAAG,eAAe,KAAK,MAAM,KAAK,IAAI;AAAA,IACxC,CAAC;AAED,SAAK,QAAQ,iBAAiB,WAAW,MAAM;AAC7C,MAAAA,IAAG,iBAAiB,KAAK,QAAQ,SAAS,KAAK,QAAQ,UAAU;AAAA,IACnE,CAAC;AAGD,SAAK,QAAQ,iBAAiB,iBAAiB,CAAAC,WAAS;AACtD,YAAM,SAAUA,OAAsB;AACtC,MAAAD,IAAG,mBAAmB,MAAM;AAAA,IAC9B,CAAC;AAGD,SAAK,QAAQ,iBAAiB,gBAAgB,CAACG,OAAM;AACnD,YAAM,EAAE,YAAY,SAAS,IAAKA,GAAkB;AACpD,WAAK,IAAI,MAAM,GAAI,UAAW,KAAM,QAAS,EAAE;AAC/C,UAAI,aAAa,WAAW;AAE1B,cAAM,QAAQH,IAAG,gBAAgB;AACjC,YAAI,OAAO;AACT,eAAK,MAAM,KAAK;AAChB,eAAK,MAAM,MAAM,KAAK;AAAA,QACxB,OAAO;AACL,kBAAQ,KAAK,+DAA+D;AAAA,QAC9E;AAAA,MACF,WAAW,aAAa,WAAW;AACjC,aAAK,MAAM,KAAK;AAAA,MAClB;AACA,MAAAA,IAAG,kBAAkB,UAAU,KAAK,QAAQ,iBAAiB;AAAA,IAE/D,CAAC;AAED,SAAK,QAAQ,KAAK;AAClB,QAAI,KAAK,kBAAmB,CAAAA,IAAG,oBAAoB,KAAK;AAAA,EAC1D;AAEF;;;ACvJO,IAAM,SAAN,cAAqB,YAAY;AAAA,EACtC;AAAA,EAGA,YAAY,UAAmB,CAAC,GAAG;AACjC,UAAM;AACN,cAAU;AAAA,MACR,cAAc;AAAA,MACd,GAAG;AAAA,IACL;AACA,SAAK,UAAU,IAAI,OAAO,OAAO;AACjC,SAAK,QAAQ,SAAU,CAAC,QAAiB;AACvC,YAAM,QAAQ,OAAO,QAAQ,WAAW,MAAM,KAAK,MAAM,GAAa;AACtE,UAAI,KAAK,OAAQ,MAAK,OAAO,KAAK;AAClC,WAAK,cAAc,IAAI,YAAY,WAAW;AAAA,QAC5C,QAAQ;AAAA,MACV,CAAC,CAAC;AAAA,IACJ;AAAA,EACF;AACF;;;ACvBO,IAAM,iBAAiB,CAAC,QAAiB;AAC9C,QAAM,SAAS,IAAI,IAAI,OAAO,SAAS,SAAS,SAAS,CAAC,EAAE;AAE5D,SAAO;AAAA,IACL;AAAA,IACA,KAAK,CAAC,MAAc,eAAuB,OAAO,QAAQ,kBAAkB,QAAQ,MAAM,YAAY;AAAA,IACtG,OAAO,CAAC,MAAc,eAAuB,OAAO,QAAQ,oBAAoB,QAAQ,MAAM,YAAY;AAAA,IAC1G,QAAQ,CAAC,MAAc,eAAuB,OAAO,qBAAqB,QAAQ,MAAM,YAAY;AAAA,IACpG,MAAM,CAAC,SAAiB,mBAAmB,QAAQ,IAAI;AAAA,EACzD;AACF;AAOA,SAAS,mBAAmB,QAAyB,MAAc;AACjE,QAAMI,KAAI,OAAO,IAAI,IAAI;AACzB,MAAIA,OAAM,KAAM,QAAO;AAEvB,MAAIA,OAAM,OAAQ,QAAO;AACzB,SAAO;AACT;AAMA,SAAS,kBAAkB,QAAyB,MAAc,cAAsB;AACtF,QAAMA,KAAI,OAAO,IAAI,IAAI;AACzB,MAAIA,OAAM,MAAM;AACd,UAAMC,KAAI,OAAO,SAASD,EAAC;AAC3B,WAAOC;AAAA,EACT;AACA,SAAO;AACT;AAMA,SAAS,oBAAoB,QAAyB,MAAc,cAAsB;AACxF,QAAMD,KAAI,OAAO,IAAI,IAAI;AACzB,MAAIA,OAAM,MAAM;AACd,UAAMC,KAAI,OAAO,WAAWD,EAAC;AAC7B,WAAOC;AAAA,EACT;AACA,SAAO;AACT;AAMA,SAAS,qBAAqB,QAAyB,MAAc,cAAsB;AACzF,QAAMD,KAAI,OAAO,IAAI,IAAI;AACzB,MAAIA,OAAM,MAAM;AACd,WAAOA;AAAA,EACT;AACA,SAAO;AACT;","names":["value","init","HTMLElement","customElements","global","globalThis","supportsAdoptingStyleSheets","ShadowRoot","ShadyCSS","nativeShadow","Document","prototype","CSSStyleSheet","constructionToken","Symbol","cssTagCache","WeakMap","CSSResult","cssText","strings","safeToken","this","Error","_strings","styleSheet","_styleSheet","cacheable","length","get","replaceSync","set","toString","unsafeCSS","value","String","css","values","reduce","acc","v","idx","adoptStyles","renderRoot","styles","adoptedStyleSheets","map","s","style","document","createElement","nonce","setAttribute","textContent","appendChild","getCompatibleStyle","sheet","rule","cssRules","is","defineProperty","getOwnPropertyDescriptor","getOwnPropertyNames","getOwnPropertySymbols","getPrototypeOf","Object","global","globalThis","customElements","trustedTypes","emptyStringForBooleanAttribute","emptyScript","polyfillSupport","reactiveElementPolyfillSupport","JSCompiler_renameProperty","prop","_obj","defaultConverter","value","type","Boolean","Array","JSON","stringify","fromValue","Number","parse","e","notEqual","old","defaultPropertyDeclaration","attribute","String","converter","reflect","hasChanged","Symbol","metadata","litPropertyMetadata","WeakMap","ReactiveElement","HTMLElement","initializer","this","__prepare","_initializers","push","observedAttributes","finalize","__attributeToPropertyMap","keys","name","options","state","elementProperties","set","noAccessor","key","descriptor","getPropertyDescriptor","prototype","get","v","call","oldValue","requestUpdate","configurable","enumerable","hasOwnProperty","superCtor","Map","finalized","props","properties","propKeys","p","createProperty","attr","__attributeNameForProperty","elementStyles","finalizeStyles","styles","isArray","Set","flat","Infinity","reverse","s","unshift","getCompatibleStyle","toLowerCase","constructor","super","__instanceProperties","isUpdatePending","hasUpdated","__reflectingProperty","__initialize","__updatePromise","Promise","res","enableUpdating","_$changedProperties","__saveInstanceProperties","forEach","i","controller","__controllers","add","renderRoot","isConnected","hostConnected","delete","instanceProperties","size","createRenderRoot","shadowRoot","attachShadow","shadowRootOptions","adoptStyles","connectedCallback","c","_requestedUpdate","disconnectedCallback","hostDisconnected","_old","_$attributeToProperty","attrValue","toAttribute","removeAttribute","setAttribute","ctor","propName","getPropertyOptions","fromAttribute","_$changeProperty","__enqueueUpdate","has","__reflectingProperties","reject","result","scheduleUpdate","performUpdate","wrapped","shouldUpdate","changedProperties","willUpdate","hostUpdate","update","__markUpdated","_$didUpdate","_changedProperties","hostUpdated","firstUpdated","updated","updateComplete","getUpdateComplete","__propertyToAttribute","mode","reactiveElementVersions","global","globalThis","trustedTypes","policy","createPolicy","createHTML","s","boundAttributeSuffix","marker","Math","random","toFixed","slice","markerMatch","nodeMarker","d","document","createTreeWalker","createMarker","createComment","isPrimitive","value","isArray","Array","isIterable","Symbol","iterator","SPACE_CHAR","textEndRegex","commentEndRegex","comment2EndRegex","tagEndRegex","RegExp","singleQuoteAttrEndRegex","doubleQuoteAttrEndRegex","rawTextElement","tag","type","strings","values","_$litType$","html","svg","mathml","noChange","for","nothing","templateCache","WeakMap","walker","trustFromTemplateString","tsa","stringFromTSA","hasOwnProperty","Error","getTemplateHtml","l","length","attrNames","rawTextEndRegex","regex","i","attrName","match","attrNameEndIndex","lastIndex","exec","test","end","startsWith","push","Template","constructor","options","node","this","parts","nodeIndex","attrNameIndex","partCount","el","createElement","currentNode","content","wrapper","firstChild","replaceWith","childNodes","nextNode","nodeType","hasAttributes","name","getAttributeNames","endsWith","realName","statics","getAttribute","split","m","index","ctor","PropertyPart","BooleanAttributePart","EventPart","AttributePart","removeAttribute","tagName","textContent","emptyScript","append","data","indexOf","_options","innerHTML","resolveDirective","part","parent","attributeIndex","currentDirective","__directives","__directive","nextDirectiveConstructor","_$initialize","_$resolve","TemplateInstance","template","_$parts","_$disconnectableChildren","_$template","_$parent","parentNode","_$isConnected","fragment","creationScope","importNode","partIndex","templatePart","ChildPart","nextSibling","ElementPart","_$setValue","__isConnected","startNode","endNode","_$committedValue","_$startNode","_$endNode","isConnected","directiveParent","_$clear","_commitText","_commitTemplateResult","_commitNode","_commitIterable","insertBefore","_insert","createTextNode","result","_$getTemplate","h","_update","instance","_clone","get","set","itemParts","itemPart","item","start","from","_$notifyConnectionChanged","n","remove","element","fill","String","valueIndex","noCommit","change","v","_commitValue","setAttribute","toggleAttribute","super","newListener","oldListener","shouldRemoveListener","capture","once","passive","shouldAddListener","removeEventListener","addEventListener","event","call","host","handleEvent","_$LH","_boundAttributeSuffix","_marker","_markerMatch","_HTML_RESULT","_getTemplateHtml","_TemplateInstance","_isIterable","_resolveDirective","_ChildPart","_AttributePart","_BooleanAttributePart","_EventPart","_PropertyPart","_ElementPart","polyfillSupport","litHtmlPolyfillSupport","litHtmlVersions","render","container","partOwnerNode","renderBefore","LitElement","ReactiveElement","constructor","this","renderOptions","host","__childPart","createRenderRoot","renderRoot","super","renderBefore","firstChild","changedProperties","value","render","hasUpdated","isConnected","update","connectedCallback","setConnected","disconnectedCallback","noChange","globalThis","litElementHydrateSupport","polyfillSupport","litElementPolyfillSupport","globalThis","litElementVersions","push","customElement","tagName","classOrTarget","context","addInitializer","customElements","define","defaultPropertyDeclaration","attribute","type","String","converter","defaultConverter","reflect","hasChanged","notEqual","standardProperty","options","target","context","kind","metadata","properties","globalThis","litPropertyMetadata","get","set","Map","name","v","oldValue","call","this","requestUpdate","_$changeProperty","value","Error","property","protoOrTarget","nameOrContext","proto","hasOwnProperty","constructor","createProperty","wrapped","Object","getOwnPropertyDescriptor","_ChildPart","ChildPart","_$LH","isSingleExpression","part","strings","PartType","ATTRIBUTE","CHILD","PROPERTY","BOOLEAN_ATTRIBUTE","EVENT","ELEMENT","directive","c","values","_$litDirective$","Directive","_partInfo","_$isConnected","this","_$parent","part","parent","attributeIndex","__part","__attributeIndex","props","update","_part","render","notifyChildrenConnectedChanged","parent","isConnected","children","_$disconnectableChildren","obj","removeDisconnectableFromParent","_$parent","delete","size","addDisconnectableToParent","Set","has","add","installDisconnectAPI","reparentDisconnectables","newParent","this","notifyChildPartConnectedChanged","isClearingValue","fromPartIndex","value","_$committedValue","Array","isArray","i","length","type","PartType","CHILD","_$notifyConnectionChanged","_$reparentDisconnectables","AsyncDirective","Directive","constructor","part","attributeIndex","super","_$initialize","_$isConnected","isClearingDirective","reconnected","disconnected","isSingleExpression","__part","_$setValue","newValues","__attributeIndex","createRef","Ref","lastElementForContextAndCallback","WeakMap","ref","directive","AsyncDirective","_ref","nothing","part","refChanged","this","_updateRefValue","undefined","_lastElementForRef","_element","_context","options","host","element","isConnected","context","globalThis","lastElementForCallback","get","set","call","value","disconnected","reconnected","h","first","d","el","event","s","t","value","n","i","point","el","pt","s","v","abs","dot","scale","clear","fill","line","a","b","text","x","y","m","r","t","e","n","r","i","s","o","a","h","c","u","l","d","f","p","g","m","y","_","v","E","w","T","b","k","x","S","F","R","M","P","O","I","U","D","B","N","G","j","V","z","K","Y","$","rt","q","Z","Q","et","st","lt","gt","mt","yt","_t","wt","bt","Kt","$t","qt","Zt","ke","Se","Re","Oe","ii","si","__defProp","__getOwnPropDesc","to","from","i","n","k","r","f","rr","x","v","value","a","b","aa","min","max","array","t","value","value","path","entries","value","s","a","b","a","b","a","b","p","v","interval","ms","a","b","x","y","x","y","offset","map","value","values","v","isEqual","m","f","a","b","entries","d","t","k","fn","interval","reset","ms","resolve","value","_","t","max","value","min","t","total","tally","r","next","value","select","toArray","array","toStringDefault","isEqualDefault","a","b","set","v","x","length","d","add","r","filter","fn","groupBy","group","map","t","contains","toString","values","lengths","mergeByKey","m","total","apply","o","p","average","min","max","offset","from","it","interval","round","test","relative","clamp","numberScale","scale","numberScaler","wrap","_a","#store","PiPi","count","q","smoothingFactor","timestamp","s","max$1","min$1","minDefault","maxDefault","c","every","reset","l","a","chunk","ba","m","v","slice","it","reduce","f","uniqueByValue","toString","asCallback","value","last","chunks","concat","dropWhile","until","_","r","equals","every","fill","forEach","fn","filter","find","flatten","map","max","gt","a","b","min","some","repeat","count","unique","iterable","zip","vs","fromIterable","toArray","fromArray","array","#store","values","#disposed","l","#listeners","interval","x","delay","ms","c","el","key","perValue","query","transform","limit","take","elapsed","duration","rate","debounce","tally","p","rank","rankArray","average","sum","total","chunk","drop","event","fromFunction","ts","AsyncToArray","asPromise","asValue","isDone","d","w","g","l2","go","r2","resolve","as","CircularArray","#capacity","#pointer","value: V","ca","value","opts: QueueOpts<any>","message: string","opts: QueueOpts<V>","queue: ReadonlyArray<V>","toAdd: ReadonlyArray<V>","t","QueueMutable","data: readonly V[]","index: number","v","length","result: readonly V[]","attemptedToAdd: readonly V[]","removed: readonly V[]","finalData: readonly V[]","predicate: (item: V) => boolean","mutable","options: QueueOpts<V>","opts: StackOpts","stack: ReadonlyArray<V>","peek","isEmpty","isFull","fn: (v: V) => void","fn","a: TraversableTree<T>","b: TraversableTree<T>","eq: IsEqual<T>","parent?: DiffNode<T>","a","b","diff: DiffAnnotation<T>","diffNode: DiffNode<T>","c","toString","vv: DiffAnnotation<any>","identical: [ a: TraversableTree<T>, b: TraversableTree<T> ][]","removed: TraversableTree<T>[]","d","n: TraversableTree<T>","n","n: DiffNode<T>","n: DiffAnnotation<T> | undefined","indent: number","t: string[]","line","compare","a: TreeNode<T>","b: TreeNode<T>","eq?: IsEqual<T>","treeCompare","asDynamicTraversable","node: TreeNode<T>","n: SimplifiedNode<T>","node: TreeNode<T> | WrappedNode<T>","wrap","n: TreeNode<T>","value: T","child: TreeNode<T> | WrappedNode<T>","child: TreeNode<T>","parent: WrappedNode<T> | TreeNode<T>","hasParent","hasAnyParent","child: WrappedNode<T> | TreeNode<T>","hasChild","hasAnyChild","remove","addValue","add","p","depthFirst","entry: TreeNode<T> | undefined","breadthFirst","root: TreeNode<T>","seen: TreeNode<T>[]","root","children","parents","node: TreeNode<any>","parent: TreeNode<T>","findChildByValue","prospectiveChild: TreeNode<T>","findAnyChildByValue","prospectiveParent: TreeNode<T>","value: T | undefined","value?: T","value: Record<string, any>","parent?: TreeNode<any>","seen: any[]","entries","parent?: TreeNode<T>","childrenLength","t: TraversableTree<T>","c: TreeNode<T>","children: TreeNode<T>[]","toStringDeep","followValue","continuePredicate: (nodeValue: T, depth: number) => boolean","entries: readonly TraverseObjectEntry[]","node: object","options: Partial<ChildrenOptions>","node: TreeNode<TraverseObjectEntry | TraverseObjectEntryStatic>","v: any","f","filter","isPrimitive","ancestors: string[]","name: string","path: string","options: TraverseObjectPathOpts","path","parent?: TraversableTree<TraverseObjectEntryStatic>","t: TraversableTree<TraverseObjectEntryStatic>","options: Partial<CreateOptions>","create","sourceValue: T","leafValue: T","r","pathOpts: Partial<PathOpts>","root: TreeNode<LabelledValue<T>> | undefined","prettyPrint","getRoot","node?: LabelledNode<T>","count","labelled: LabelledValue<T>","root: LabelledNode<T>","node: LabelledNode<T>","label: string","node: LabelledNode<T> | undefined","values","c: LabelledNode<T>","c: LabelledNode<T> | undefined","tree: TraversableTree<T>","child: T","possibleParent: T","possibleParentValue: TV","eq?: IsEqual<TV>","child: TraversableTree<TValue>","possibleParentValue: TValue","eq?: IsEqual<TValue>","eq: IsEqual<TV>","parent: TraversableTree<T>","prospectiveChild: TraversableTree<T>","eq: IsEqual<TraversableTree<T>>","parent: T","possibleChild: T","possibleChildValue: T","possibleValue: T","node: TraversableTree<T>","s","node: T","possibleValue: TV","root: T","entry: T | undefined","find","root: TraversableTree<T>","predicate: (node: TraversableTree<T>) => boolean","order: `breadth` | `depth`","predicate: (nodeValue: T) => boolean","type: string","node: TreeNode<T> | TraversableTree<T> | object","TreeNodeToTraversable","ObjectToTraversable","node: any","StackImmutable","data: ReadonlyArray<V>","immutable","options: StackOpts","keyString?: ToString<V>","keyString: ToString<V> | undefined","v: V","SetStringImmutable","map?: Map<string, V>","map","keyString: ToString<V>","MassiveSet","#depth","#maxDepth","x","set","value: string","#getChild","#dumpToArray","rr","r: Array<string>","create: boolean","k","opts: QueueOpts<PriorityItem<V>>","item: V","priority: number","priority","eq?: IsEqual<V>","toDelete: PriorityItem<V> | undefined","item","m","IterablesLast","IterablesMax","IterablesMin","QueueImmutable","#data","options: Opts","opts: Opts","#maintain","key: K","interval: Interval","property: `get` | `set` | `either`","prune: [ k: K, v: V ][]","interval","elapsed","key","existing","map: IWithEntries<K, Iterable<V>>","predicate: (value: V, key: K) => boolean","e","map: IMapOf<V>","largest: readonly [ string, number ]","isEqual: IsEqual<V>","isEqual","groupBy: (value: V) => string","valueEq: IsEqual<V>","initial: [ string, readonly V[] ][]","groupBy","key: string","eq: IsEqual<V>","values: readonly V[]","without","del","map: ReadonlyMap<K, V>","data: ArrayKeys<K, V>","data: ObjectKeys<K, V>","dataOrMap?: ReadonlyMap<K, V> | EitherKey<K, V>","data","#map","type: MultiValue<V, M>","opts: MapMultiOpts<V>","asArray","values: V[]","map: M","other: IMapOf<V>","options?: MapSetOpts<V>","a: V","b: V","t: MultiValue<V, ReadonlyMap<string, V>>","mapAddValue","mapFindValue","mapFilterValues","mapToArray","mapHasAnyValue","options: MapCircularOpts<V>","t: MultiValue<V, ICircularArray<V>>","ca: ICircularArray<V>","amount: number","options: MapArrayOpts<V>","convertToString","toStringFunction: IsEqual<V>","t: MultiValue<V, readonly V[]>","MapOfSimple","entries: [ key: string, value: readonly V[] ][]","_key: string","_value: V","groupBy: ToString<V>","l","r: (V | undefined)[][]","columnIndex: number","rowIndex: number","row: number | string","#getRowRaw","column: number | string","value: V | undefined","#getOrCreateRawRow","#getColumnRaw","index: number | undefined","row: TableRow<V>","length?: number","createVertex","id: string","graph: DirectedGraph","graph","toAdjacencyMatrix","i","ii","j","o","dumpGraph","graph: DirectedGraph | Iterable<Vertex>","debugGraphToArray","r: string[]","vertices","edge: Edge","g: DirectedGraph","g","adjacentVertices","context: Vertex | string | undefined","vertex: Vertex","outIdOrVertex: string | Vertex","vertex: string | Vertex","resolveVertex","getOrCreate","updateGraphVertex","gr","from: string | Vertex","to: string | Vertex","from","to","connectTo","from: string","to: string","weight?: number","weight","connect","options: ConnectOptions","connectWithEdges","edges: Edge[]","edges","edges$1","v: Vertex","stringForEdge","a: Vertex","b: Vertex","idOrVertex: string | Vertex","startIdOrVertex: string | Vertex","targetIdOrVertex?: string | Vertex","sourceOrId: Vertex | string","u","path: Edge[]","immutableMap","ic","topOrder: Vertex[]","vertices: Iterable<Vertex>","scc: Vertex[][]","vertex: TarjanVertex","stronglyConnected: Vertex[]","w: TarjanVertex | undefined","w","graph: Graph","a: string | Vertex","b: string | Vertex","aa","a: string","b: string","graphChanged: Graph","g: Graph","entries","a","b","c","r","convert","v","value","children","sum","m","prettyPrintEntries","t","d","filter","f","path","paths","p","reverse","values","s","a","b","set","value","fn","module","it","e","document","is","S","f","O","P","key","isFunction","toString","length","a","b","c","source","exports","pos","s","i","l","codePointAt","max","min","fromCodePoint","x","line","root","parse","text","key$1","sign","peek","token","u","string","p","buffer","count","push","pop","stringify","stack","v","list","v","getOrGenerateSync","map","fn","value","m","_","l","defaults","count","elapsed","getErrorMessage","CircularArray","#capacity","#pointer","value","ca","debug","trimQueue","t","enqueue","dequeue","peek","isEmpty","isFull","QueueMutable","v","length","mutable","trimStack","push","pop","StackMutable","fn","compare","a","b","valueOrIdentityEqual","compareChildren","c","hasChange","toString","d","toStringSingle","n","toStringDiff","line","treeCompare","asDynamicTraversable","stripParentage","unwrapped","wrapped","wrap","queryByValue","queryParentsValue","parentsValues","findParentsValue","hasParent","hasAnyParent","hasChild","hasAnyChild","remove","addValue","add","p","depthFirst","root","breadthFirst","treeTest","throwTreeTest","children","childrenValues","parents","nodeDepth","findChildByValue","findAnyChildByValue","getRoot","computeMaxDepth","computeMaxDepthImpl","throwAttemptedChild","createNode","fromPlainObject","entries","rootWrapped","childrenLength","setChildren","toStringDeep","followValue","prettyPrintEntries","prettyPrint","getNamedEntry","f","filter","isPrimitive","childByName","getByPath","path","traceByPath","createWrapped","create","createImpl","r","createSimplified","addValueByPath","toStringDeep$2","valueByPath","removeByPath","findChildByPath","valuesByPath","clearValuesByPath","count","findChildByLabel","getValuesFromNode","childrenLengthByPath","values","hasAnyParentValue","hasParentValue","findAnyParentByValue","findParentByValue","isTraversable","couldAddChild","hasAnyChildValue","hasChildValue","siblings","s","find","findByValue","toTraversable","isTreeNode","TreeNodeToTraversable","ObjectToTraversable","StackImmutable","immutable","SetStringMutable","SetStringImmutable","map","MassiveSet","#depth","#maxDepth","x","set","#getChild","#dumpToArray","rr","k","PriorityMutable","priority","item","m","IterablesLast","IterablesMax","IterablesMin","QueueImmutable","#data","ExpiringMap","#maintain","interval","elapsed","key","existing","firstEntry","e","lengthMax","firstEntryByValue","isEqual","MapOfSimpleBase","groupBy","MapOfSimpleMutable","without","del","ofSimpleMutable","addArray","addObjects","has","data","MapOfMutableImpl","#map","asArray","ofSetMutable","mapAddValue","mapFindValue","mapFilterValues","mapToArray","mapHasAnyValue","ofCircularMutable","NumberMap","ofArrayMutable","convertToString","MapOfSimple","ofSimple","Table","l","#getRowRaw","#getOrCreateRawRow","#getColumnRaw","createVertex","hasKey","graph","graphTest","get","toAdjacencyMatrix","i","ii","j","o","dumpGraph","debugGraphToArray","vertices","debugDumpVertex","distance","edges","g","adjacentVertices","vertexHasOut","hasNoOuts","hasOnlyOuts","resolveVertex","hasOut","getOrCreate","updateGraphVertex","getOrFail","gr","distanceDefault","disconnect","from","to","connectTo","weight","connect","connectWithEdges","edges$1","stringForEdge","areAdjacent","bfs","dfs","pathDijkstra","u","clone","immutableMap","ic","isAcyclic","getCycles","topologicalSort","graphFromVertices","w","transitiveReduction","hasConnection","getConnection","aa","edgesForVertex","delay","resolve","_","timeout","clear","it","debounce","#handlers","#counter","#id","run","at","event","average","#lastUsersChange","#resourcesWithoutUserExpireAfterMs","#capacityPerResource","#users","#state","pi","#allocateResource","repeat","#maintainLoop","#outgoing","#requestCallback","#requestAwait","log","getErrorMessage","#resolve","#promise","#reject","#initPromise","TaskQueueMutable","mutable$1","duration","total","frequency","#written","next","first","h","machineInit","machineReset","machineNext","machineTo","#debug","#sm","#smInitial","#isDone","#isDoneNeedsFiring","#setIsDone","#changedAt","total","v","randomIndex","array","randomElement","r","shuffle","p","a","b","resolve","x","max","min","u","count","offset","mt","mti","n2","y","i","float","integer","length","max$1","min$1","clamp","#store","#keyString","t","value","s","values","limit","last","#min","#max","#total","#resetAfterSamples","#sampleLimit","#resetTimer","#fromTime","#events","event","ts","aa","pi","d","l","sqrt","mt2","t2","c","f2","f3","f4","j","m","M","abs","z","sum","ds","de","te","d2","v2","o","dot","p2","point","n","x2","y2","bbox","s2","bbox2","intersections","a2","l2","line","cos","sin","reduce","m2","v1","pa","q","p3","q2","acos","k","b2","c2","arc","e","_","PolyBezier","Bezier","S","B","E","e2","A","C","ft","r2","R","pt","rc","ls","le","segments","tlen","alen","fs","fe","bs","be","p","isNaN","guard","pt","isEmpty","d","rect","isPositioned","PointsGuard","guardPositioned","isPlaceholder","area","height","x","y","a","b","c","center","r","w","h","point","Placeholder","corners","circle","guardPoint","isEqual","sum","line","v2","u2","PointsSubtract","centroid","intersection","PointsSum","circleIntersections","isIntersecting","distance","z","PointsDistance","divide","fromPoints","edges","LinesJoinPointsToLines","Empty","fromCenter","el","fromNumbers","PointsIsEqual","v","getPointParameter","lengths","l","LinesLength","w2","h2","multiply","multiplyScalar","perimeter","value","random","randomPoint","subtract","toArray","abs","piPi","ac","apply","fn","mal","min","bbox","RectsMaxFromCorners","clamp","max","clampNumber","compare","q","pointsDistance","distanceFromExterior","PointsIsPoint","rectDistanceFromExterior","circleDistanceFromExterior","aa","dotProduct","ArraysDotProduct","interpolate","d2","fromA","lineInterpolate","invert","length","pipeline","wrap","s","rotate","toLine","EmptyPoint","subtractPoint","toString","normalise","clampMagnitude","toCartesian","o","polarToCartesian","pointToString","pi","LinesGuard","PointsNormalise","PointEmpty","PointsToString","PointsDotProduct","PointsClampMagnitude","PointsMultiply","PointDivide","nearest","n","atob","dot","t","PointsBbox","x2","y2","fromFlatArray","array","angleRadian","relativePosition","total","PointRotate","toFlatArray","toSvgString","withinRange","PointIsEmpty","PointIsPlaceholder","normaliseByRect","PointsNormaliseByRect","e2","count","LineLength","LinesEmpty","PointsPlaceholder","asPoints","event","quantiseEvery","quantiseEveryNumber","reduce","PolarFromCartesian","PolarRotate","PolarToCartesian","round","roundNumber","wrapNumber","fromDegrees","arc","LinesFromPoints","toPath","toSvg","pointsBbox","e","toSvgFull","distanceCenter","path","LinesInterpolate","BezierLibrary","cubic2","cubic","_","RectsFromTopLeft","quadraticBezier","quadratic","RectsFromCenter","PointsMultiplyScalar","offset","grid","access","accessWithGrid","setMutate","setMutateWithGrid","set","setWithGrid","wrapMutable","columns","rows","create","cells","cardinal","randomElement","entries","neighbours","mutable$2","g","paths","relative","RectsCorners","PointsProject","from","arrow","PointsRotate","PointsIsEmpty","PointsIsPlaceholder","PointsReduce","circleRandomPoint","rectRandomPoint","rectCenter","triangleCentroid","circleCenter","CirclesIsIntersecting","RectsIsIntersecting","init","positionRelative","rank","ShapesRandomPoint","epsilon","l2","r2","rs","p2","slope","Direction","QuadTreeNode","#parent","#children","#items","#subdivide","RectsIntersectsPoint","PointsFromNumbers","scaler","PlaceholderRect","sh","cos","sin","sqrt","pow","circleToPositioned","PointsAngleRadian","pa","PointGuard","angles","intersectsPoint","triangle","incircle","circumcircle","tt","fromB","fromC","medians","hh","resolveEl","r","d","el","v","o","round","JSON5","value","fromList","resolveElement","remove","data","t","rows","fromObject","PointsPlaceholder","RectsPlaceholderPositioned","relativePosition","event","offset","x","y","RectsIsPlaceholder","PointsEmpty","PointsIsPlaceholder","p","s","w","query","entries","fromCss","set","text","debounce","interval","ms","ElementSizer","#el","pe","#containerEl","pn","#stretch","#onSizeChanging","#size","#sizeDebounce","#naturalRatio","#naturalSize","#viewport","#byViewport","#byContainer","#disposed","#resizeObservable","er","c","#onParentResize","#computeSizeBasedOnParent","#onViewportResize","height","b","getErrorMessage","timestamp","line","log","clear","logger","e","_","select","a","pt","relative","f","resolve","resolveEl","makeHelper","line","circle","applyOpts","arc","apply","StackImmutable","push","s","o","pop","p","c","ellipse","path","pt","point","m","pos","a","b","cubic2","quadratic","d","t","x","y","text","padding","rect","l","value","__defProp","__export","toString","isValid","entries","clamp","min","max","round","values","h","rate","abs2","lr","atan2","sqrt","r","g","abs","L","A","B","sin","cos","compare","from","rotate","invert","convert","v","limit","withOpacity","fn","changeLightness","fromHexString","fromLibrary","fromCss","rgbToLibraryHsl","toScalar","toAbsolute","toHexString","absolute","guard","generateScalar","lightness","opacity","interpolator","vf","scalar","rgbTo8bit","lch","Colorizr","toLibrary","toCssString","chroma","hslToLibraryRgb","co","aa","grid","wrap","#scaler","scaler","#scalerSize","#init","#logicalSize","#disposed","#resizer","reset","#ctx","#drawHelper","#getContext","#handleEvents","el","#onResizeDone","event","#viewport","get","set","flip","piPi","#canvasEl","#sizeBasis","#pixelScaling","#sizeScaler","#createSizeScaler","#regions","height","#add","#regionCompute","#r","w","hslScalar","scale","children","center","ColourStringFirst","remove","clear","er","el2","multiply","rows","reduce","asArray","create","#elementBase","#store","to","#aliases","#lastFallback","_","e","capture","init","QueueImmutable","ctx","width","count","#data","MapOfSimpleMutable","#meta","ds","cr","#canvasRegion","#lastDataChange","#visualClear","#rangeMode","#valueStyle","#connectStyle","#visualPadding","#axisStyle","#textStyle","#grid","#currentRange","#createRange","#rangeManual","offset","debug","#useGrid","#drawAxes","k","#drawSeries","#valueLineToCanvasSpace","#drawLineCanvasSpace","#drawGridline","#drawWhisker","#drawXAxisValues","#drawYAxisValues","#drawConnected","#drawDot","dot","ColourToString","PIPI","getContext","canvasElementContextOrQuery: CanvasContextQuery","resolveEl","makeHelper","ctxOrCanvasEl: CanvasContextQuery","canvasBounds?: Rects.Rect","pathsToDraw: Paths.Path[] | readonly Paths.Path[]","opts?: DrawingOpts","paths","lineToDraw: Lines.Line | Lines.Line[]","line","rectsToDraw: Rects.Rect | Rects.Rect[] | Rects.RectPositioned | Rects.RectPositioned[]","opts?: RectOpts","rect","bezierToDraw: Beziers.QuadraticBezier | Beziers.CubicBezier","bezier","pointsToDraw: Points.Point[]","opts?: DrawingOpts & Partial<ConnectedPointsOptions>","connectedPoints","pointLabels","dotPosition: Points.Point | Points.Point[]","opts?: DotOpts","dot","circlesToDraw: Circles.CirclePositioned | Circles.CirclePositioned[]","opts: DrawingOpts","circle","arcsToDraw: Arcs.ArcPositioned | Arcs.ArcPositioned[]","arc","lines: string[]","opts: DrawingOpts & {\n        anchor: Points.Point;\n        anchorPadding?: number;\n        bounds?: Rects.RectPositioned;\n      }","textBlock","optsOp","coloringOp","applyOpts","ctx: CanvasRenderingContext2D","drawingStack","arcs: Arcs.ArcPositioned | readonly Arcs.ArcPositioned[]","arc: Arcs.ArcPositioned","arcsArray: Arcs.ArcPositioned[]","strokeStyle: string | CanvasGradient | CanvasPattern | undefined","fillStyle: string | CanvasGradient | CanvasPattern | undefined","apply","lineOp","lineWidth: number | undefined","lineJoin: CanvasLineJoin | undefined","lineCap: CanvasLineCap | undefined","stk?: IStackImmutable<StackOp>","StackImmutable","push","s","o","pop","lineThroughPoints","points: readonly Points.Point[]","p","circlesToDraw: Circles.CirclePositioned | readonly Circles.CirclePositioned[]","c: Circles.CirclePositioned","c","ellipse","ellipsesToDraw:\n    | Ellipses.EllipsePositioned\n    | readonly Ellipses.EllipsePositioned[]","ellipse: Ellipses.EllipsePositioned","pathsToDraw: readonly Paths.Path[] | Paths.Path","opts: { readonly strokeStyle?: string; readonly debug?: boolean }","path: Paths.Path","path","quadraticBezier","pts: readonly Points.Point[]","opts: Partial<ConnectedPointsOptions>","pt","opts: { readonly fillStyle?: string }","labels?: readonly string[]","translatePoint","point: Points.Point","m","point","copyToImg","canvasEl: HTMLCanvasElement","pos: Points.Point | (Points.Point | Circles.CirclePositioned)[] | Circles.CirclePositioned","pos","cubicBezier","bezierToDraw: Beziers.CubicBezier","a","b","cubic2","bezierToDraw: Beziers.QuadraticBezier","quadratic","toDraw: Lines.Line | readonly Lines.Line[]","opts: LineOpts & DrawingOpts","d: Lines.Line","d","t","triangle","toDraw: Triangles.Triangle | readonly Triangles.Triangle[]","opts: DrawingOpts & { readonly filled?: boolean }","t: Triangles.Triangle","toDraw: Rects.Rect | Rects.Rect[] | Rects.RectPositioned | Rects.RectPositioned[]","opts: RectOpts","d: Rects.RectPositioned | Rects.Rect","x","y","textWidth","text?: string | null","padding","widthMultiple?: number","textRect","text","textHeight","lines: readonly string[]","opts: DrawingOpts & {\n    readonly anchor: Points.Point;\n    readonly align?: `top` | `center`\n    readonly anchorPadding?: number;\n    readonly bounds?: Rects.RectPositioned;\n  }","l","value","textBlockAligned","text: readonly string[] | string","opts: DrawingOpts & {\n    readonly bounds: Rects.RectPositioned;\n    readonly horiz?: HorizAlign;\n    readonly vert?: VertAlign;\n  }","isHsl","v: any","v","isRgb","tryParseObjectToRgb","tryParseObjectToHsl","isOkLch","isColourish","calculateHueDistance","a: number","b: number","limit","libraryRgbToHexString","rgb: RGB","c: number","wrapScalarHue","value: number","withOpacity","value: T","fn: (opacityScalar: number, value: T) => number","fn","changeLightness","value: Hsl","amount: Partial<{ pdelta: number, delta: number, fixed: number }>","scaleProperty","hsl: Hsl","property: `l` | `h` | `s`","hslTransparent","fromHexString","hexString: string","options: ParsingOptions<Hsl>","fromLibrary","fromCss","value: string","options: Partial<ParsingOptions<Hsl>>","resolveCss","cssDefinedHexColours","rgbToLibraryHsl","parseCssHslFunction","toScalar","toAbsolute","toCssString","abs","toHexString","toLibraryRgb","hsl: C.HSL","parsingOptions: ParsingOptions<T>","scalar","absolute","hslOrString: Hsl | Rgb | string","guard","generateScalar","absoluteHslOrVariable: string | number | Angle","lightness","opacity","hslOrString: Rgb | Hsl | string","h","interpolator","a: Hsl | string","b: Hsl | string","direction: `longer` | `shorter`","amount: number","hsl: HslScalar","hsl: HslAbsolute","v: string","pos: number","vf","hsl: Hsl | string","OKLCH_CHROMA_MAX","lch: OkLch","lch: C.LCH","parsingOptions: ParsingOptions<OkLch>","options: ParsingOptions<OkLch>","oklchTransparent: OkLchAbsolute","oklchTransparent","rgbTo8bit","parseCssRgbFunction","lch","Colorizr","lchOrString: OkLch | string","toLibrary","chroma","a: OkLch | string","b: OkLch | string","lch: OkLchScalar","l: number","h: number","lch: OkLchAbsolute","fromCssColour","colour: string","fromCss$2","fromCss$1","fallback?: string","srgbTansparent: Rgb8Bit","options: ParsingOptions<Rgb>","srgbTansparent","hslToLibraryRgb","to8bit","rgb: Rgb","rgb: C.RGB","parsingOptions: ParsingOptions<Rgb>","rgbOrString: Rgb | string","rgbOrString: Rgb | Hsl | string","r","g","co","eightBit","rgb: Rgb8Bit","rgb: RgbScalar","colourA: Rgb | string","colourB: Rgb | string","aa","toLibraryHsl","rgb: Rgb | string","grid","image: ImageData","wrap","accessor","setter","fn: Grids.GridCellAccessor<Rgb8Bit>","cell: Grids.GridCell","fn: Grids.GridCellSetter<Rgb>","value: Rgb","byRow","byColumn","col: Rgb8Bit[]","piPi","CanvasSource","canvasElementOrQuery: HTMLCanvasElement | string","sizeBasis: `min` | `max`","#canvasEl","resolveEl","#sizeBasis","#pixelScaling","#sizeScaler","#createSizeScaler","#logicalSize","size: Rect","el","s","#ctx","region: CanvasRegion","#regions","pt: Point","kind: `independent`","x","y","pt","b","source: `screen` | `source`","kind: `independent` | `skip`","rect: Rect | RectPositioned","height","rect","spec: CanvasRegionSpec","#add","CanvasRegion","compute: ((source: CanvasSource) => RectPositioned)","source: CanvasSource","_source: CanvasSource","c","r","regionCompute: (parent: CanvasSource) => RectPositioned","#regionCompute","#r","regionRel: Point","scaleBy: `both`","p: Point","p","relativePoints: Point[]","strokeStyle: string","points: Point[]","text: string","relPos: Point","font: string","baseline: CanvasTextBaseline","align: CanvasTextAlign","point","text","point: Point","relativeCircles: CirclePositioned[]","fillStyle: string","circle","source: `screen`","clamped: boolean","value: RectPositioned","value","applyOpts","elem: SVGElement","opts: DrawingOpts","getBounds","svg: SVGElement","w","h","setBounds","bounds: Rect","createEl","type: string","id?: string","m","createOrResolve","parent: SVGElement","queryOrExisting?: string | V","suffix?: string","existing:SVGElement|HTMLElement|null","goldenAngleColour","index: number","lightness","toCssString","hslScalar","randomHue","rand: RandomSource","multiplyOpacity","colourish: Colourish","amount: number","withOpacity","o","fn: (scalarOpacity: number) => number","toColour","result: Colour | undefined","withOpacity$3","fn","withOpacity$1","withOpacity$2","toCssColour","setOpacity","opacity: number","opacity","interpolateInit","colours: Colourish[]","destination: ColourSpaces","convertScalar","cssLinearGradient","interpolator","colourA: Colourish","colourB: Colourish","options: Partial<ColourInterpolationOpts>","inter: ColourInterpolator<Colour> | undefined","interpolator$3","convert","interpolator$1","interpolator$2","scale","opts: Partial<ColourStepOpts>","piece: Colour[]","pieceSteps: Colour[]","createSteps","a: Colourish | string","b: Colourish","options: CreateStepsOptions","aa","a","results: Colour[]","colour: Colourish","destination: ConvertDestinations","isHsl","isRgb","toScalar$2","toAbsolute$1","isOkLch","toScalar$1","toAbsolute","to8bit","toScalar","convertToString","colour: Colourish | object","toCssString$1","toCssString$2","tryParseObjectToRgb","tryParseObjectToHsl","toHexColour","toHexString$2","toHexString","toHexString$1","toLibraryColour","Colorizr","guard","colour: Colour","colourish: any","isColourish","c: Colour | undefined","fromCssColour","toStringFirst","rgbToHsl","rgb: Rgb","scalarResult: boolean","g","max","min","l","scalar","absolute$1","d","applyStrokeOpts","opts: StrokeOpts","createMarker","id: string","opts: MarkerOpts","childCreator?: () => SVGElement","markerPrebuilt","elem: SVGElement | null","_context: DrawingOpts","applyPathOpts","opts: PathDrawingOpts","numberOrPercentage","v: number","v","path","svgOrArray: string | readonly string[]","opts?: PathDrawingOpts","queryOrExisting?: string | SVGPathElement","pathUpdate","elem: SVGPathElement","circleUpdate","elem: SVGCircleElement","circle: CirclePositioned","opts?: CircleDrawingOpts","queryOrExisting?: string | SVGCircleElement","group","children: readonly SVGElement[]","queryOrExisting?: string | SVGGElement","groupUpdate","children","elem: SVGGElement","line","line: Line","opts?: LineDrawingOpts","queryOrExisting?: string | SVGLineElement","lineUpdate","lineEl: SVGLineElement","polarRayUpdate","ray: Polar.PolarRay","textPathUpdate","el: SVGTextPathElement","text?: string","opts?: TextPathDrawingOpts","textPath","pathReference: string","textQueryOrExisting?: string | SVGTextElement","pathQueryOrExisting?: string | SVGTextPathElement","textUpdate","el: SVGTextElement","pos?: Point","opts?: TextDrawingOpts","queryOrExisting?: string | SVGTextElement","grid","center: Point","spacing: number","width: number","height: number","opts: LineDrawingOpts","ColourStringFirst","lineFromSvgLine","el: SVGLineElement","polarRayFromSvgLine","origin: Point","remove","queryOrExisting: string | V","clear","makeHelper","parentOpts?: DrawingOpts & StrokeOpts","o: SvgHelper","queryOrExisting: string | SVGElement","pos: Point","svgString: string | readonly string[]","center","selectors: string","multiply","kernel: Kernel<number>","scalar: number","rows","copy: number[][]","scalar","convolveCell","cell: Grids.GridCell","kernel: Kernel2dArray<TKernel>","source: Grids.GridReadable<TCell>","reduce: KernelReduce<TCell, TKernel>","valuesAtKernelPos: CellValueScalar<TCell, TKernel>[]","o","kernelValue: TKernel | undefined","sourceValue: TCell | undefined","reduce","convolveImage","image: ImageData","wrap","convolve","rgbReducer","kernel: Kernel<TKernel>","visitor: Iterable<Grids.GridCell>","origin?: Grids.GridCell","asArray","kernel2dToArray","value","kernel: Kernel<T>","offsets: Kernel2dArray<T>","v: Grids.GridCellAndValue<T>","v","rgbReducer: KernelReduce<Rgb8Bit, number>","values: CellValueScalar<Rgb8Bit, number>[]","r","g","b","opacity","values","result: Rgb8Bit","identityKernel","edgeDetectionKernel","sharpenKernel","boxBlurKernel","gaussianBlur3Kernel","gaussianBlur5Kernel","unsharpMasking5Kernel","create","fallbacks?: ReadonlyArray<string>","NamedColourPaletteImpl","#store","#aliases","#elementBase","el: Element","el","key: string","colour: string","from: string","to: string","from","to","fallback?: string","c","fromCss","#lastFallback","frames","sourceVideoEl: HTMLVideoElement","opts: FramesOpts","w","h","c: CanvasRenderingContext2D | null","_","capture","opts: CaptureOpts","worker: Worker | undefined","pixels: ImageData | undefined","e","manualCapture","opts: ManualCaptureOpts","c: CanvasRenderingContext2D | undefined | null","c: ManualCapturer","getNumericAttribute","el: HTMLElement","name: string","defaultValue: number","a","init","elementQuery: string","options: BipolarViewOptions","toStringFirst","height","lastValues: IQueueImmutable<CirclePositioned> | undefined","QueueImmutable","v: number","renderBackground: Render","ctx","width","x: number","y: number","x","y","d","circle$1","computeMinMax","mm: Point[]","m","relativeCompute","minMax: PointMinMax","point: Point","point","absoluteCompute","computeAxisMark","mm: PointMinMax","increments: number","major: number","xValues: AxisMark[]","count","yValues: AxisMark[]","DataSet","#data","MapOfSimpleMutable","#meta","series: string","data: TValue[]","meta: TSeriesMeta","value: TValue","insert","insertOptions: InsertOptions","options: RecursivePartial<Cart.CartesianPlotOptions>","resolveEl","ds","CanvasSource","p","CartesianCanvasPlot","round","cr: CanvasRegion","data: DataSet<Cart.PlotPoint, SeriesMeta>","#canvasRegion","cr","#lastDataChange","#visualClear","#rangeMode","#valueStyle","#connectStyle","#visualPadding","#axisStyle","#textStyle","#grid","#currentRange","#createRange","padding","pt: Point","pt","data: Point","elementToPosition: HTMLElement | string","by: `middle` | `top-left`","relativeToQuery?: HTMLElement | string","#rangeManual","dataPoint: Point","offset","dataValue: Point","debug","_source: `screen`","valueA: Point","valueB: Point","goldenAngleColour","#useGrid","#drawAxes","k","#drawSeries","line","line: Line","width: number","l","#valueLineToCanvasSpace","#drawLineCanvasSpace","meta: Partial<SeriesMeta>","yPoints: Point[]","xPoints: Point[]","p: Cart.AxisMark","vertical: boolean","#drawGridline","#drawWhisker","#drawXAxisValues","#drawYAxisValues","series: Cart.PlotPoint[]","meta: SeriesMeta","#drawConnected","#drawDot","dots: Cart.PlotPoint[]","dot","ColourToString","originalDot: Cart.PlotPoint","fallbackColour: string","fallbackRadius: number","named_colour_palette_exports","colour_exports","video_exports","h","height","el","wrap","d","i","bbox","colour_exports","k","p","typewriter","c","l","z","r","t","event","h","event","r","t","el","v","w","d","n","h","r","event","el","n","t","h","el","n","t","a","h","m","event","value","t","piPi","degreeToRadian","angleInDegrees: number | readonly number[]","v","radianInvert","angleInRadians: number","radianToDegree","angleInRadians: number | readonly number[]","v","radiansSum","start: number","amount: number","x","piPi","radianArc","start: number","end: number","s","piPi","d","isNull","p: Point","isPoint3d","p","isNaN","test","guard","info?: string","guardNonZeroPoint","pt: Point | Point3d","pt","isPoint","p: number | unknown","p: Point | unknown","isEmpty","isPlaceholder","getTwoPointParameters","a1: Point | Point3d | number","ab2: Point | Point3d | number","ab3?: number","ab4?: number","ab5?: number","ab6?: number","b","a","getPointParameter","a?: Point3d | Point | number | Array<number> | ReadonlyArray<number>","b?: number | boolean","c?: number","c","distance","a: Point | Point3d","xOrB?: Point | Point3d | number","y?: number","z?: number","y","z","distance2d","a: Point","xOrB?: Point | number","findMinimum","comparer: ((a: Point, b: Point) => Point)|((a: Point3d, b: Point3d) => Point3d)","min","maxFromCorners","topLeft: Point","topRight: Point","bottomRight: Point","bottomLeft: Point","w2","h2","bbox","RectsMaxFromCorners","bbox3d","a: Point3d","b: Point3d","isPolarCoord","p: unknown","p: Coord","rotate","c: Coord","amountRadian: number","invert","isOpposite","a: Coord","b: Coord","isParallel","isAntiParallel","rotateDegrees","amountDeg: number","degreeToRadian","subtract","pt: Writeable<Point>","Empty","Unit","Empty3d","Unit3d","toLine","start: Point","toCartesian","toCartesian: PolarToCartesian","a: Coord | number","b?: Point | number","c?: Point","EmptyPoint","polarToCartesian","fromCartesian","point: Point","origin: Point","point","subtractPoint","distance: number","angleRadians: number","guardPoint","toString","digits?: number","radianToDegree","d","toPoint","v: Coord","v","normalise","clampMagnitude","max","dotProduct","multiply","amt: number","divide","Placeholder","Placeholder3d","angleRadian","b?: Point","angleRadianCircle","piPi","angleRadianThreePoint","b: Point","c: Point","ac","toIntegerValues","pt: Point","rounder: (x: number) => number","to2d","to3d","z: number","x","ray: PolarRay","origin?: Point","o","getOrigin","pointToString","fromLine","line: Line","line","spiral","smoothness: number","zoom: number","spiralRaw","step: number","fromPoints","isArc","isPositioned","p: Point | Arc | ArcPositioned","fromDegrees","radius: number","startDegrees: number","endDegrees: number","clockwise: boolean","a: Arc","ap: ArcPositioned","arc: ArcPositioned","LinesFromPoints","arc","getStartEnd","arc: ArcPositioned | Arc","arc: Arc | ArcPositioned","angleRadian: number","interpolate: ArcInterpolate","amount: number","allowOverflow?: boolean","angularSize","radiansSum","arc: Arc","radianArc","toPath","_point: Point","interpolate","length","toSvg","_intersectionThreshold: number","fromCircle","circle: CirclePositioned","startRadian: number","endRadian: number","a: ArcPositioned","circle","fromCircleAmount","sizeRadian: number","pointsBbox","toSvg: ArcToSvg","a: Point | Arc | ArcPositioned","b?: number | Point | ArcSvgOpts","c?: number | ArcSvgOpts","d?: number","e?: ArcSvgOpts","toSvgFull","e","opts?: ArcSvgOpts","distanceCenter","b: ArcPositioned","pointsDistance","isEqual","a: Arc | ArcPositioned","b: Arc | ArcPositioned","isLine","p: any","isPolyLine","aOrLine: Point | Line","aOrLine: Point | Line | PolyLine","pointB?: Point","sum","reverse","pointBOrAllowOverflow?: Point | boolean","d2","pointAtDistance","fromA","guardDim","d: number","rect: Rect","rect","PointsGuard","getRectPositioned","rect: Rect | RectPositioned","guardPositioned","rect: RectPositioned","rect: Point | Rect | RectPositioned","isRect","rect: unknown","isRectPositioned","rect: any","fromTopLeft","width: number","height: number","height","isQuadraticBezier","path: Path | QuadraticBezier | CubicBezier","path","isCubicBezier","path: Path | CubicBezier | QuadraticBezier","quadraticSimple","end: Point","LinesInterpolate","quadratic","interpolator","q: QuadraticBezier | CubicBezier","q","BezierLibrary","quadraticToSvgString","handle: Point","cubicOrQuadratic: CubicBezier | QuadraticBezier","cubicToPath","quadratictoPath","cubic","cubic1: Point","cubic2: Point","cubic2","cubic: CubicBezier","t: number","t","_: Point","RectsFromTopLeft","quadraticBezier: QuadraticBezier","quadraticBezier","circle: CirclePositioned | Circle","isCirclePositioned","a: Circle | CirclePositioned","p: Circle | Point","isCircle","area","circle: Circle","fromCenter","RectsFromCenter","center","a: CirclePositioned","b: CirclePositioned | Point","distanceFromExterior","PointsIsPoint","PointsDistance","exteriorIntegerPoints","interiorIntegerPoints","r","nearest","circle: CirclePositioned | readonly CirclePositioned[]","n","l","pointOnPerimeter","circle: Circle | CirclePositioned","circumference","a: CirclePositioned | Circle","b: CirclePositioned | Circle","intersectionLine","v2","u2","returnValue: Point[]","intersections","b: CirclePositioned","PointsSubtract","centroid","intersection","PointsSum","circleRect","b: RectPositioned","circleCircle","circleIntersections","isContainedBy","isIntersecting","b: CirclePositioned | Point | RectPositioned","PointsIsEqual","multiplyScalar","v: number","value: number","PointsMultiplyScalar","value","randomPoint","within: Circle | CirclePositioned","opts: Partial<CircleRandomPointOpts>","offset: Point","offset","PolarToCartesian","toSvg: CircleToSvg","a: CirclePositioned | number | Circle","sweep: boolean","s","toPositioned","defaultPositionOrX?: Point | number","inside","grid: Grid","cell: GridCell","grid","isCell","cell: GridCell | undefined","guardCell","grid?: Grid","guardGrid","applyBounds","wrap: GridBoundsLogic","wrap","access","array: readonly V[]","cols: number","gridFromArrayDimensions","array","fn: GridCellAccessor<V>","accessWithGrid","fn","array: readonly T[] | T[]","indexFromCell","setMutate","array: V[]","value: V","setMutateWithGrid","set","setWithGrid","wrapMutable","array: T[]","boundsLogic: GridBoundsLogic","value: T","createArray","initialValue: T","rowsOrGrid: number | Grid","columns?: number","rows","columns","t: T[]","total","createMutable","create","array: ReadonlyArray<T[]> | Array<T[]>","array: V[][]","bounds: GridBoundsLogic","array: ReadonlyArray<T[]>","fn: GridCellAccessor<T>","array: T[][]","array: readonly V[][]","values","grid: GridReadable<T>","iter: Iterable<GridCell> | Iterable<GridCell[]>","cells","start?: GridCell","cellValues","cellsAndValues","rowCells: Array<GridCell>","colCells: Array<GridCell>","start: GridCell","vector: GridCell","allDirections","crossDirections","offsetCardinals","steps: number","getVectorFromCardinal","cardinal: GridCardinalDirectionOptional","cardinal","getLine","end: GridCell","cells:GridCell[]","simpleLine","cells: Array<GridCell>","cellFromIndex","colsOrGrid: number | Grid","index: number","a: Grid | GridVisual","b: Grid | GridVisual","cellEquals","a: GridCell | undefined","b: GridCell | undefined","randomNeighbour","nbos: readonly GridNeighbour[]","randomElement","isNeighbour","n: GridNeighbour | GridNeighbourMaybe | undefined","neighbourList","directions: readonly GridCardinalDirection[]","neighbours","entries","directions?: readonly GridCardinalDirection[]","toArray2d","initialValue?: V","returnValue:V[][]","cellKeyString","v: GridCell","asRectangles","grid: GridVisual","rectangleForCell","cellAtPoint","position: Point","cellMiddle","breadthLogic","neighboursLogic","neighbours: readonly GridNeighbour[]","columnLogic","opts: Partial<GridVisitorOpts>","depthLogic","randomLogic","t: Array<GridNeighbour>","randomContiguousLogic","rowLogic","nbos: ReadonlyArray<GridNeighbour>","visitByNeighbours","logic: GridNeighbourSelectionLogic","mutable$2","g: Grid","c: GridCell","g","cellQueue: GridCell[]","moveQueue: GridNeighbour[]","current: GridCell | undefined","stepper","createVisitor: GridCreateVisitor","steps: GridCell[]","count","type: VisitorTypes","withLogic","options: Partial<GridVisitorOpts>","optionsOverride: Partial<GridVisitorOpts>","normaliseByRect","a: Point | number","b: number | Rect","line: Line | readonly Line[]","atob","dot","distanceSingleLine","directionVector","directionVectorNormalised","parallel","perpendicularPoint","PointsBbox","divider","a: Point3d | Point | number | number[]","b?: number","aa: Point3d | Point | number | number[]","bb?: number","cc?: number","aa","PointDivide","fromNumbers","x1: number","y1: number","x2: number","y2: number","x2","y2","fromFlatArray","array: readonly number[]","fromPivot","length: number","balance: number","radianInvert","midpoint","relativePosition","abs","apply","fn: Point3dApplyFn | PointApplyFn","averager","kind: PointAverageKinds","opts: Partial<{ scaling: number }>","x: (v: number) => number","y: (v: number) => number","z: (v: number) => number","mal","clamp","clampNumber","compare","compareByX","compareByY","compareByZ","convexHull","points: Array<Point>","v: Array<Point>","intersectsPoint","a: RectPositioned","rect: RectPositioned | Rect","distanceFromCenter","distanceToCenter","shape: PointCalculableShape","rectDistanceFromExterior","circleDistanceFromExterior","distanceToExterior","toArray","ArraysDotProduct","from","xOrArray?: number | readonly number[]","fromString","string_: string","pts: Point[]","lineInterpolate","what: `both` | `x` | `y` | `z`","leftmost","rightmost","ptOrX: Point | number","pipelineApply","pipeline","EmptyCartesian","pi","fromRadians","radians: number","toRadians","fromPointPolar","angleNormalisation: `` | `unipolar` | `bipolar`","fromLineCartesian","fromLinePolar","LinesGuard","isPolar","v: Vector","isCartesian","normalise$2","PointsNormalise","quadrantOffsetAngle","toPolar","PointEmpty","toString$5","PointsToString","a: Vector","b: Vector","dotProduct$3","PointsDotProduct","clampMagnitude$2","PointsClampMagnitude","PointsMultiply","joinPointsToLines","lines: Line[]","relation","aa: Point | number","PointTracker","opts: TrackOpts","_reason: TrimReason","_p: TimestampedObject<Point>[]","initialRel: PointTrack","markRel: PointTrack | undefined","LineLength","lastRel: PointTrack","r: PointTrackerResults","LinesEmpty","PointsPlaceholder","PointsTracker","id: string","UserPointerTracker","p: PointerEvent | MouseEvent","asPoints","event","UserPointersTracker","event: PointerEvent","progressBetween","position: Point | Point3d","waypointA: Point | Point3d","waypointB: Point | Point3d","project","angle: number","quantiseEvery","snap: Point","quantiseEveryNumber","random","rando?: RandomSource","random3d","reduce","pts: ReadonlyArray<Point>","fn: (p: Point, accumulated: Point) => Point","initial?: Point","pt: Point | readonly Point[]","PolarFromCartesian","PolarRotate","rotatePointArray","v: ReadonlyArray<ReadonlyArray<number>>","result:number[][]","round","yOrDigits?: number","roundNumber","withinRange","maxRange: Point | number","ptMax?: Point","ptMin?: Point","wrapNumber","amountRadian?: number","origin?: Point | number","PointRotate","a: Line","b: Line","a: Point | Line","toFlatArray","toSvgString","amount?: number","slope","maxRange: number","otherLine: Line","fn: (point: Point) => Point","fromPointsToPath","l: Line","PointIsEmpty","PointIsPlaceholder","fn: (p: Point) => Point","lineOrPoint: Line | Point","PointsNormaliseByRect","scaleFromMidpoint","factor: number","pointAtX","x: number","extendFromA","pointsOf","e2","lines: Iterable<Line>","corners","getStart","path: Path","getEnd","setSegment","compoundPath: CompoundPath","fromPaths","paths: readonly Path[]","useWidth?: boolean","dimensions?: Dimensions","computeDimensions","paths","relative","distanceToPoint","intersectionThreshold: number","lengths","RectsCorners","guardContinuous","applyFields","op: ApplyFieldOp","rectOrWidth: RectPositioned | Rect | number","heightValue?: number","applyMerge","op: ApplyMergeOp","a: RectPositioned | Rect","b: Rect | number","applyScalar","parameter: number","applyDim","card: GridCardinalDirection | `center`","centerOrigin","rectAbsolute: RectPositioned","w","h","divideOp","a: number","b: number","divideScalar","divideDim","edges","LinesJoinPointsToLines","getEdgeX","edge: `right` | `bottom` | `left` | `top`","getEdgeY","EmptyPositioned","encompass","fromElement","el: HTMLElement","el","xOrWidth: number","yOrHeight: number","width?: number","height?: number","getRectPositionedParameter","a: number | Point | Rect | RectPositioned","b?: Rect | number | Point","c?: number | Rect","isEqualSize","a: Rect","b: Rect","a: Rect | RectPositioned","b: Rect | RectPositioned","LinesLength","multiplyOp","multiplyDim","nearestInternal","PlaceholderPositioned","perimeter","dividerByLargestDimension","value: number | Point","within: Rect | RectPositioned","options: RectRandomPointOpts","subtractOp","a: Rect | undefined","b: RectPositioned | Rect | number","subtractSize","subtractOffset","b: RectPositioned | Rect","sumOp","sumOffset","equilateralFromVertex","PointsProject","arrow","from: `tip` | `tail` | `middle`","opts: ArrowOpts","tri: Triangle","tailPoints: ReadonlyArray<Point>","PointsRotate","t: Triangle","isTriangle","PointsIsEmpty","PointsIsPlaceholder","a: Triangle","b: Triangle","PointsReduce","accumulator: Point","shape: ShapePositioned","opts: Partial<ShapeRandomPointOpts>","circleRandomPoint","rectRandomPoint","shape?: Rect | Triangle | Circle","rectCenter","triangleCentroid","circleCenter","a: ShapePositioned","b: ShapePositioned | Point","CirclesIsIntersecting","RectsIsIntersecting","starburst","outerRadius: number","innerRadius?: number","opts?: { readonly initialAngleRadian?: number }","waypoints: readonly Point[]","opts: Partial<WaypointOpts>","init","positionRelative","rank","circles: readonly Circle[]","container: ShapePositioned","opts: RandomOpts","positionedCircles: CirclePositioned[]","ShapesRandomPoint","radiusX: number","radiusY: number","rdpShortestDistance","epsilon","distanceFromPointToLine","l2","r2","rs","rdpPerpendicularDistance","findPerpendicularDistance","p1: Point","p2: Point","p2","index: Point","index_: Point","Direction","quadTree","bounds: RectPositioned","initialData: readonly QuadTreeItem[]","opts: Partial<QuadTreeOpts>","o: QuadTreeOpts","QuadTreeNode","parent: QuadTreeNode | undefined","boundary: RectPositioned","level: number","opts: QuadTreeOpts","#parent","#children","n: QuadTreeNode | undefined","#items","d: Direction","p: QuadTreeItem","isIntersecting$2","#subdivide","RectsIntersectsPoint","PointsFromNumbers","cos","sin","asin","sqrt","pow","pi","piPi","goldenAngle","goldenSection","circleVogelSpiral","circle?: Circle","opts: VogelSpiralOpts","c","circleToPositioned","circle","max","count","circleRings","circle?: Circle | CirclePositioned","opts: CircleRingsOpts","r","n","sphereFibonacci","sphere?: Sphere","offset","s","y","a","x","z","angles","t: Triangle","guard","t","PointsAngleRadian","anglesDegrees","radianToDegree","edges","joinPointsToLines","area","lengths","l","LinesLength","p","barycentricCoord","a: Point | number","b?: number","pt","getPointParameter","b","x: number","y: number","pa: Point","pb: Point","pa","barycentricToCartestian","bc: BarycentricCoord","bbox","r: RectPositioned","corners","fromRadius","origin: Point","radius: number","opts: { readonly initialAngleRadian?: number }","PointGuard","PolarToCartesian","fromPoints","fromFlatArray","coords: readonly number[]","PointsFromNumbers","points: readonly Point[]","perimeter","v","innerCircle","centroid","intersectsPoint","RectsIntersectsPoint","distance","isEquilateral","isIsosceles","isRightAngle","isOblique","isAcute","isObtuse","apply","fn: (p: Point, label?: string) => Point","fn","outerCircle","rotate","triangle: Triangle","amountRadian?: number","origin?: Point","triangle","PointsRotate","rotateByVertex","amountRadian: number","vertex: `a` | `b` | `c`","toFlatArray","pi4over3","pi2over3","resolveLength","t: TriangleEquilateral","fromCenter","rotationRad?: number","centerFromA","ptA?: Point","incircle","centerFromB","ptB?: Point","centerFromC","ptC?: Point","height","circumcircle","fromA","t: Right","tt","resolveLengths","hypotenuseSegments","h","fromB","fromC","o","q","angleAtPointA","angleAtPointB","medians","oppositeFromAdjacent","angleRad: number","adjacent: number","oppositeFromHypotenuse","hypotenuse: number","adjacentFromHypotenuse","angleRadian: number","angleRadian","adjacentFromOpposite","opposite: number","hypotenuseFromOpposite","hypotenuseFromAdjacent","baseAngle","t: Isosceles","apexAngle","aa","legHeights","hh","shortGuid","options: Readonly<{ source?: RandomSource }>","point_exports","shortGuid","fn","d","i","n","l","c","p","v","timestamp","value","p","v","timestamp","p","v","timestamp","p","v","timestamp","v","d","r","s","o","d","stream","vt","c","c","from","e","Log","l","log","Log","e","b","Log","s","c","t","length","elapsed","r","entries","k","v","a","i","e","until","t","value","Log","n","ln","s","p","i","d","r","ch","pa","c","Log","c","p","o","e","i","s","e","el","i","n","Event","w","value","event","l","delay","resolve","WebSocket","Log","m","e","c","to","n","ch","f","t","d","to","MlVision","el","event","r","e","p","v"]}