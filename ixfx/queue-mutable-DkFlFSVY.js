import{Ct as e}from"./src-DdJCbM4z.js";import{t}from"./simple-event-emitter-DdjYDCSw.js";const n=(e,t)=>{e.debug&&console.log(`queue:${t}`)},r=(e,t,n)=>{let r=t.length+n.length,i=e.capacity??r,a=r-i,o=e.discardPolicy??`additions`;switch(o){case`additions`:return t.length===0?n.slice(0,n.length-a):t.length===e.capacity?t:[...t,...n.slice(0,a-1)];case`newer`:if(a>=t.length)return t.length===0?[...n.slice(0,i-1),n.at(-1)]:n.slice(Math.max(0,n.length-i),Math.min(n.length,i)+1);{let e=Math.max(1,n.length-t.length),r=n.slice(n.length-e,n.length);return[...t.slice(0,Math.min(t.length,i-1)),...r]}case`older`:return[...t,...n].slice(a);default:throw Error(`Unknown overflow policy ${o}`)}},i=(e,t,...n)=>{if(e===void 0)throw Error(`opts parameter undefined`);let i=t.length+n.length,a=e.capacity&&i>e.capacity,o=a?r(e,t,n):[...t,...n];if(e.capacity&&o.length!==e.capacity&&a)throw Error(`Bug! Expected return to be at capacity. Return len: ${o.length} capacity: ${e.capacity} opts: ${JSON.stringify(e)}`);if(!e.capacity&&o.length!==i)throw Error(`Bug! Return length not expected. Return len: ${o.length} expected: ${i} opts: ${JSON.stringify(e)}`);return o},a=(e,t)=>{if(t.length===0)throw Error(`Queue is empty`);return t.slice(1)},o=(e,t)=>t[0],s=(e,t)=>t.length===0,c=(e,t)=>e.capacity?t.length>=e.capacity:!1;var l=class extends t{options;data;eq;constructor(t={},n=[]){if(super(),t===void 0)throw Error(`opts parameter undefined`);this.options=t,this.data=n,this.eq=t.eq??e}clear(){let e=[...this.data];this.data=[],this.fireEvent(`removed`,{finalData:this.data,removed:e}),this.onClear()}onClear(){}at(e){if(e>=this.data.length)throw Error(`Index outside bounds of queue`);let t=this.data.at(e);if(t===void 0)throw Error(`Index appears to be outside range of queue`);return t}enqueue(...e){this.data=i(this.options,this.data,...e);let t=this.data.length;return this.onEnqueue(this.data,e),t}onEnqueue(e,t){this.fireEvent(`enqueue`,{added:t,finalData:e})}dequeue(){let e=o(this.options,this.data);if(e!==void 0)return this.data=a(this.options,this.data),this.fireEvent(`dequeue`,{removed:e,finalData:this.data}),this.onRemoved([e],this.data),e}onRemoved(e,t){this.fireEvent(`removed`,{removed:e,finalData:t})}removeWhere(e){let t=this.data.length,n=this.data.filter(t=>e(t));return n.length===0?0:(this.data=this.data.filter(t=>!e(t)),this.onRemoved(n,this.data),t-this.data.length)}toArray(){return[...this.data]}get isEmpty(){return s(this.options,this.data)}get isFull(){return c(this.options,this.data)}get length(){return this.data.length}get peek(){return o(this.options,this.data)}};function u(e={},...t){return new l({...e},[...t])}export{i as a,o as c,a as i,r as l,u as n,s as o,n as r,c as s,l as t};