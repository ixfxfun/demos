{"version":3,"file":"primitive-tracker-6IlHwPj3.js","names":["opts?: TrackedValueOpts","limit: number","reason: TrimReason","rawValues: V[]","last: TimestampedPrimitive<V>","values: TimestampedPrimitive<V>[]"],"sources":["../../../ixfx/packages/core/src/trackers/primitive-tracker.ts"],"sourcesContent":["import type { TrackedValueOpts } from \"./tracked-value.js\";\nimport { TrackerBase, type TrimReason } from \"./tracker-base.js\";\n\nexport type TimestampedPrimitive<V extends number | string> = {\n  at: number\n  value: V\n}\n\nexport abstract class PrimitiveTracker<\n  V extends number | string,\n  TResult\n> extends TrackerBase<V, TResult> {\n  values: V[];\n  timestamps: number[];\n\n  constructor(opts?: TrackedValueOpts) {\n    super(opts);\n    this.values = [];\n    this.timestamps = [];\n  }\n\n  /**\n   * Reduces size of value store to `limit`. Returns\n   * number of remaining items\n   * @param limit\n   */\n  trimStore(limit: number): number {\n    if (limit >= this.values.length) return this.values.length;\n    this.values = this.values.slice(-limit);\n    this.timestamps = this.timestamps.slice(-limit);\n    return this.values.length;\n  }\n\n  onTrimmed(reason: TrimReason) {\n    // no-op\n  }\n\n  get last(): V | undefined {\n    return this.values.at(-1);\n  }\n\n  get initial(): V | undefined {\n    return this.values.at(0);\n  }\n\n  /**\n   * Returns number of recorded values (this can include the initial value)\n   */\n  get size() {\n    return this.values.length;\n  }\n\n  /**\n   * Returns the elapsed time, in milliseconds since the instance was created\n   */\n  get elapsed(): number {\n    if (this.values.length < 0) throw new Error(`No values seen yet`);\n    return Date.now() - this.timestamps[ 0 ];\n  }\n\n  onReset() {\n    this.values = [];\n    this.timestamps = [];\n  }\n\n  /**\n   * Tracks a value\n   */\n  filterData(rawValues: V[]): TimestampedPrimitive<V>[] {\n    const lastValue = rawValues.at(-1);\n    const last: TimestampedPrimitive<V> = { value: lastValue as unknown as V, at: performance.now() };\n\n    const values: TimestampedPrimitive<V>[] = rawValues.map(value => ({\n      at: performance.now(),\n      value: value\n    }));\n\n    //const now = Date.now();\n    if (this.storeIntermediate) {\n      this.values.push(...rawValues);\n      this.timestamps.push(...values.map(v => v.at));\n    } else switch (this.values.length) {\n      case 0: {\n        // Add as initial value\n        this.values.push(last.value);\n        this.timestamps.push(last.at);\n        break;\n      }\n      case 2: {\n        // Replace last value\n        this.values[ 1 ] = last.value;\n        this.timestamps[ 1 ] = last.at;\n        break;\n      }\n      case 1: {\n        // Add last value\n        this.values.push(last.value);\n        this.timestamps.push(last.at);\n        break;\n      }\n      // No default\n    }\n\n    return values;\n  }\n}\n"],"mappings":";;;AAQA,IAAsB,mBAAtB,cAGU,YAAwB;CAChC;CACA;CAEA,YAAYA,MAAyB;AACnC,QAAM,KAAK;AACX,OAAK,SAAS,CAAE;AAChB,OAAK,aAAa,CAAE;CACrB;;;;;;CAOD,UAAUC,OAAuB;AAC/B,MAAI,SAAS,KAAK,OAAO,OAAQ,QAAO,KAAK,OAAO;AACpD,OAAK,SAAS,KAAK,OAAO,OAAO,MAAM;AACvC,OAAK,aAAa,KAAK,WAAW,OAAO,MAAM;AAC/C,SAAO,KAAK,OAAO;CACpB;CAED,UAAUC,QAAoB,CAE7B;CAED,IAAI,OAAsB;AACxB,SAAO,KAAK,OAAO,GAAG,GAAG;CAC1B;CAED,IAAI,UAAyB;AAC3B,SAAO,KAAK,OAAO,GAAG,EAAE;CACzB;;;;CAKD,IAAI,OAAO;AACT,SAAO,KAAK,OAAO;CACpB;;;;CAKD,IAAI,UAAkB;AACpB,MAAI,KAAK,OAAO,SAAS,EAAG,OAAM,IAAI,OAAO;AAC7C,SAAO,KAAK,KAAK,GAAG,KAAK,WAAY;CACtC;CAED,UAAU;AACR,OAAK,SAAS,CAAE;AAChB,OAAK,aAAa,CAAE;CACrB;;;;CAKD,WAAWC,WAA2C;EACpD,MAAM,YAAY,UAAU,GAAG,GAAG;EAClC,MAAMC,OAAgC;GAAE,OAAO;GAA2B,IAAI,YAAY,KAAK;EAAE;EAEjG,MAAMC,SAAoC,UAAU,IAAI,YAAU;GAChE,IAAI,YAAY,KAAK;GACd;EACR,GAAE;AAGH,MAAI,KAAK,mBAAmB;AAC1B,QAAK,OAAO,KAAK,GAAG,UAAU;AAC9B,QAAK,WAAW,KAAK,GAAG,OAAO,IAAI,OAAK,EAAE,GAAG,CAAC;EAC/C,MAAM,SAAQ,KAAK,OAAO,QAApB;GACL,KAAK,GAAG;AAEN,SAAK,OAAO,KAAK,KAAK,MAAM;AAC5B,SAAK,WAAW,KAAK,KAAK,GAAG;AAC7B;GACD;GACD,KAAK,GAAG;AAEN,SAAK,OAAQ,KAAM,KAAK;AACxB,SAAK,WAAY,KAAM,KAAK;AAC5B;GACD;GACD,KAAK,GAAG;AAEN,SAAK,OAAO,KAAK,KAAK,MAAM;AAC5B,SAAK,WAAW,KAAK,KAAK,GAAG;AAC7B;GACD;EAEF;AAED,SAAO;CACR;AACF"}