{"version":3,"file":"sleep-C2hKDgCi.js","names":[],"sources":["../../core/dist/src/sleep.js"],"sourcesContent":["import { numberTest, resultThrow } from '@ixfx/guards';\nimport { intervalToMs } from './interval-type.js';\nif (typeof window === `undefined` || !(`requestAnimationFrame` in window)) {\n    if (typeof window === `undefined`) {\n        // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n        // @ts-expect-error\n        globalThis.requestAnimationFrame = (callback) => {\n            setTimeout(callback, 1);\n        };\n    }\n}\n/**\n * Returns after timeout period.\n *\n * @example In an async function\n * ```js\n * console.log(`Hello`);\n * await sleep(1000);\n * console.log(`There`); // Prints one second after\n * ```\n *\n * @example As a promise\n * ```js\n * console.log(`Hello`);\n * sleep({ millis: 1000 })\n *  .then(() => console.log(`There`)); // Prints one second after\n * ```\n *\n * If a timeout of 0 is given, `requestAnimationFrame` is used instead of `setTimeout`.\n *\n * `Flow.delay()` and {@link sleep} are similar. `Flow.delay()` takes a parameter of what code to execute after the timeout, while `sleep()` just resolves after the timeout.\n *\n * A value can be provided, which is returned on awaking:\n * ```js\n * const v = await sleep({ seconds: 1, value: `hello`);\n * // v = `hello`\n * ```\n *\n * Provide an AbortSignal to cancel the sleep and throwing an exception\n * so code after the sleep doesn't happen.\n *\n * ```js\n * const ac = new AbortController();\n * setTimeout(() => { ac.abort(); }, 1000); // Abort after 1s\n *\n * // Sleep for 1min\n * await sleep({ minutes: 1, signal: ac.signal });\n * console.log(`Awake`); // This line doesn't get called because an exception is thrown when aborting\n * ```\n * @param optsOrMillis Milliseconds to sleep, or options\n * @return\n */\nexport const sleep = (optsOrMillis) => {\n    const timeoutMs = intervalToMs(optsOrMillis, 1);\n    const signal = optsOrMillis.signal;\n    const value = optsOrMillis.value;\n    resultThrow(numberTest(timeoutMs, `positive`, `timeoutMs`));\n    if (timeoutMs === 0) {\n        return new Promise((resolve) => requestAnimationFrame((_) => {\n            resolve(value);\n        }));\n    }\n    else {\n        return new Promise((resolve, reject) => {\n            const onAbortSignal = () => {\n                clearTimeout(t);\n                if (signal) {\n                    signal.removeEventListener(`abort`, onAbortSignal);\n                    reject(new Error(signal.reason));\n                }\n                else {\n                    reject(new Error(`Cancelled`));\n                }\n            };\n            if (signal) {\n                signal.addEventListener(`abort`, onAbortSignal);\n            }\n            const t = setTimeout(() => {\n                signal?.removeEventListener(`abort`, onAbortSignal);\n                if (signal?.aborted) {\n                    reject(new Error(signal.reason));\n                    return;\n                }\n                resolve(value);\n            }, timeoutMs);\n        });\n    }\n};\n/**\n * Delays until `predicate` returns true.\n * Can be useful for synchronising with other async activities.\n * ```js\n * // Delay until 'count' reaches 5\n * await sleepWhile(() => count >= 5, 100);\n * ```\n * @param predicate\n * @param checkInterval\n */\nexport const sleepWhile = async (predicate, checkInterval = 100) => {\n    while (predicate()) {\n        await sleep(checkInterval);\n    }\n};\n"],"mappings":";;;;AAEA,IAAI,OAAO,WAAW,CAAC,SAAS,CAAC,IAAI,EAAE,CAAC,qBAAqB,CAAC,IAAI,SAC9D;KAAI,OAAO,WAAW,CAAC,SAAS,CAAC,EAG7B,WAAW,wBAAwB,CAAC,aAAa;EAC7C,WAAW,UAAU,EAAE;CAC1B;AACJ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA2CL,MAAa,QAAQ,CAAC,iBAAiB;CACnC,MAAM,YAAY,aAAa,cAAc,EAAE;CAC/C,MAAM,SAAS,aAAa;CAC5B,MAAM,QAAQ,aAAa;CAC3B,YAAY,WAAW,WAAW,CAAC,QAAQ,CAAC,EAAE,CAAC,SAAS,CAAC,CAAC,CAAC;AAC3D,KAAI,cAAc,EACd,QAAO,IAAI,QAAQ,CAAC,YAAY,sBAAsB,CAAC,MAAM;EACzD,QAAQ,MAAM;CACjB,EAAC;KAGF,QAAO,IAAI,QAAQ,CAAC,SAAS,WAAW;EACpC,MAAM,gBAAgB,MAAM;GACxB,aAAa,EAAE;AACf,OAAI,QAAQ;IACR,OAAO,oBAAoB,CAAC,KAAK,CAAC,EAAE,cAAc;IAClD,OAAO,IAAI,MAAM,OAAO,QAAQ;GACnC,OAEG,uBAAO,IAAI,MAAM,CAAC,SAAS,CAAC,EAAE;EAErC;AACD,MAAI,QACA,OAAO,iBAAiB,CAAC,KAAK,CAAC,EAAE,cAAc;EAEnD,MAAM,IAAI,WAAW,MAAM;GACvB,QAAQ,oBAAoB,CAAC,KAAK,CAAC,EAAE,cAAc;AACnD,OAAI,QAAQ,SAAS;IACjB,OAAO,IAAI,MAAM,OAAO,QAAQ;AAChC;GACH;GACD,QAAQ,MAAM;EACjB,GAAE,UAAU;CAChB;AAER;;;;;;;;;;;AAWD,MAAa,aAAa,OAAO,WAAW,gBAAgB,QAAQ;AAChE,QAAO,WAAW,EACd,MAAM,MAAM,cAAc;AAEjC"}