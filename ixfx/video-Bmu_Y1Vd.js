import{n as e}from"./chunk-CVLEGGlw.js";import{z as t}from"./src-DdJCbM4z.js";import{n}from"./delay-Bc8RsQAS.js";var r=e({capture:()=>a,frames:()=>i,manualCapture:()=>o});async function*i(e,t={}){let r=t.maxIntervalMs??0,i=t.showCanvas??!1,a=t.canvasEl,o,s;o=s=0,a===void 0&&(a=document.createElement(`CANVAS`),a.classList.add(`ixfx-frames`),i||(a.style.display=`none`),document.body.appendChild(a));let c=()=>{a!==void 0&&(o=e.videoWidth,s=e.videoHeight,a.width=o,a.height=s)},l=null,u=n(r);for await(let t of u)if((o===0||s===0)&&c(),!(o===0||s===0)){if(l??=a.getContext(`2d`),l===null)return;l.drawImage(e,0,0,o,s),yield l.getImageData(0,0,o,s)}}const a=(e,n={})=>{let r=n.maxIntervalMs??0,i=n.showCanvas??!1,a=n.onFrame,o=e.videoWidth,s=e.videoHeight,c=document.createElement(`CANVAS`);c.classList.add(`ixfx-capture`),i||(c.style.display=`none`),c.width=o,c.height=s;let l=null,u;n.workerScript&&(u=new Worker(n.workerScript));let d=u||a;!d&&!i&&console.warn(`Video will be captured to hidden element without any processing. Is this what you want?`);let f=t(()=>{if(l===null&&(l=c.getContext(`2d`)),l===null)return;l.drawImage(e,0,0,o,s);let t;if(d&&(t=l.getImageData(0,0,o,s)),u&&u.postMessage({pixels:t.data.buffer,width:o,height:s,channels:4},[t.data.buffer]),a)try{a(t)}catch(e){console.error(e)}},r);return{start:()=>{f.start()},cancel:()=>{f.cancel()},canvasEl:c}},o=(e,t={})=>{let n=t.showCanvas??!1,r=e.videoWidth,i=e.videoHeight,a=t.canvasEl!==void 0,o=t.canvasEl;return o||(o=document.createElement(`CANVAS`),o.classList.add(`ixfx-capture`),document.body.append(o),n||(o.style.display=`none`)),o.width=r,o.height=i,{canvasEl:o,capture:()=>{let n;if(n||=o.getContext(`2d`,{willReadFrequently:!0}),!n)throw Error(`Could not create graphics context`);n.drawImage(e,0,0,r,i);let a=n.getImageData(0,0,r,i);return a.currentTime=e.currentTime,t.postCaptureDraw&&t.postCaptureDraw(n,r,i),a},dispose:()=>{if(!a)try{o.remove()}catch{}}}};export{r as n,o as t};