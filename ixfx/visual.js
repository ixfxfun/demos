import{n as e}from"./chunk-CVLEGGlw.js";import{Vt as t}from"./src-DdJCbM4z.js";import{h as n,y as r}from"./numbers-BlBexQl9.js";import{r as i}from"./arrays-BMWbmHtQ.js";import{t as a}from"./simple-event-emitter-DdjYDCSw.js";import{t as o,u as s}from"./map-of-simple-mutable-DrS2vpyB.js";import{t as c}from"./clamp-dSm2UU4N.js";import{n as l}from"./bipolar-B_WKH-ep.js";import{n as u,t as d}from"./quantise-BF6gOUEX.js";import{a as f,c as p}from"./scale-DsFpif2S.js";import{n as ee}from"./queue-WkPm9kWw.js";import{n as te,t as m}from"./resolve-el-BDflOSOS.js";import{A as ne}from"./angles-DwQpnVfp.js";import{X as h,et as re,lt as g,nt as _,z as v}from"./conversions-CmWd4trl.js";import{$ as y,D as b,F as x,M as S,N as C,Z as w,f as T,g as ie,h as ae,k as oe,o as se,w as ce}from"./point-BnPODnGO.js";import{t as E}from"./element-sizing-CXfn96pB.js";import{n as le,t as ue}from"./guard-CZZig1Fp.js";import{f as de,l as fe,m as pe,n as D,t as me,u as he}from"./corners-DSkNTQ9M.js";import{a as O,c as ge,n as k,o as A,r as _e,t as ve}from"./colour-DXakjc3Q.js";import{n as ye}from"./video-Bmu_Y1Vd.js";var be=e({arc:()=>Te,bezier:()=>Ne,circle:()=>N,connectedPoints:()=>P,copyToImg:()=>Me,dot:()=>I,drawingStack:()=>M,ellipse:()=>ke,getContext:()=>Se,line:()=>L,lineThroughPoints:()=>Oe,makeHelper:()=>Ce,paths:()=>Ae,pointLabels:()=>F,polarRay:()=>Ie,rect:()=>R,textBlock:()=>Be,textBlockAligned:()=>Ve,textHeight:()=>ze,textRect:()=>z,textWidth:()=>Re,translatePoint:()=>je,triangle:()=>Le});const xe=Math.PI*2,Se=e=>{if(e===null)throw Error(`canvasElCtxOrQuery null. Must be a 2d drawing context or Canvas element`);if(e===void 0)throw Error(`canvasElCtxOrQuery undefined. Must be a 2d drawing context or Canvas element`);let t=e instanceof CanvasRenderingContext2D?e:e instanceof HTMLCanvasElement?e.getContext(`2d`):typeof e==`string`?m(e).getContext(`2d`):e;if(t===null)throw Error(`Could not create 2d context for canvas`);return t},Ce=(e,t)=>{let n=Se(e);return{ctx:n,paths(e,t){Ae(n,e,t)},polarRay(e,t){Ie(n,e,t)},line(e,t){L(n,e,t)},rect(e,t){R(n,e,t)},bezier(e,t){Ne(n,e,t)},connectedPoints(e,t){P(n,e,t)},pointLabels(e,t){F(n,e,t)},dot(e,t){I(n,e,t)},circle(e,t){N(n,e,t)},arc(e,t){Te(n,e,t)},textBlock(e,r){r.bounds===void 0&&t!==void 0&&(r={...r,bounds:{...t,x:0,y:0}}),Be(n,e,r)}}},we=e=>Ee(e.strokeStyle,e.fillStyle),j=(e,t={},...n)=>{if(e===void 0)throw Error(`ctx undefined`);let r=M(e).push(we(t),...n);return r.apply(),r},Te=(e,t,n={})=>{j(e,n);let r=t=>{e.beginPath(),e.arc(t.x,t.y,t.radius,t.startRadian,t.endRadian),e.stroke()},i=Array.isArray(t)?t:[t];for(let e of i)r(e)},Ee=(e,t)=>n=>{t&&(n.fillStyle=t),e&&(n.strokeStyle=e)},De=(e,t,n)=>r=>{e&&(r.lineWidth=e),t&&(r.lineJoin=t),n&&(r.lineCap=n)},M=(e,t)=>(t??=new s,{push:(...n)=>{t??=new s;let r=t.push(...n);for(let t of n)t(e);return M(e,r)},pop:()=>{let n=t?.pop();return M(e,n)},apply:()=>{if(t===void 0)return M(e);for(let n of t.data)n(e);return M(e,t)}}),Oe=(e,t,n)=>{j(e,n),e.moveTo(t[0].x,t[0].y);for(let[n,r]of t.entries()){if(n+2>=t.length)continue;let i=t[n+1],a={x:(r.x+i.x)/2,y:(r.y+i.y)/2},o=(a.x+r.x)/2,s=(a.x+i.x)/2;e.quadraticCurveTo(o,i.y,a.x,a.y),e.quadraticCurveTo(s,i.y,i.x,i.y)}},N=(e,t,n={})=>{j(e,n);let r=t=>{e.beginPath(),e.arc(t.x,t.y,t.radius,0,xe),n.strokeStyle&&e.stroke(),n.fillStyle&&e.fill()};if(Array.isArray(t))for(let e of t)r(e);else r(t)},ke=(e,t,n={})=>{j(e,n);let r=t=>{e.beginPath();let r=t.rotation??0,i=t.startAngle??0,a=t.endAngle??xe;e.ellipse(t.x,t.y,t.radiusX,t.radiusY,r,i,a),n.strokeStyle&&e.stroke(),n.fillStyle&&e.fill()},i=Array.isArray(t)?t:[t];for(let e of i)r(e)},Ae=(e,t,n={})=>{j(e,n);let r=t=>{if(le(t))Fe(e,t,n);else if(v(t))L(e,t,n);else throw Error(`Unknown path type ${JSON.stringify(t)}`)};if(Array.isArray(t))for(let e of t)r(e);else r(t)},P=(e,t,n={})=>{let a=n.loop??!1;if(r(i(t,`pts`)),t.length!==0){for(let[e,n]of t.entries())ne(n,`Index ${e}`);j(e,n),n.lineWidth&&(e.lineWidth=n.lineWidth),e.beginPath(),e.moveTo(t[0].x,t[0].y);for(let n of t)e.lineTo(n.x,n.y);a&&e.lineTo(t[0].x,t[0].y),(n.strokeStyle||n.strokeStyle===void 0&&n.fillStyle===void 0)&&e.stroke(),n.fillStyle&&e.fill()}},F=(e,t,n={},r)=>{if(t.length!==0){for(let[e,n]of t.entries())ne(n,`Index ${e}`);j(e,n);for(let[n,i]of t.entries()){let t=r!==void 0&&n<r.length?r[n]:n.toString();e.fillText(t.toString(),i.x,i.y)}}},je=(e,t)=>{let n=e.getTransform();return{x:t.x*n.a+t.y*n.c+n.e,y:t.x*n.b+t.y*n.d+n.f}},Me=e=>{let t=document.createElement(`img`);return t.src=e.toDataURL(`image/jpeg`),t},I=(e,t,n)=>{n??={};let r=n.radius??10,i=Array.isArray(t)?t:[t],a=n.stroke??n.strokeStyle!==void 0,o=n.filled??n.fillStyle!==void 0;!a&&!o&&(o=!0),j(e,n);for(let t of i)e.beginPath(),`radius`in t?e.arc(t.x,t.y,t.radius,0,2*Math.PI):e.arc(t.x,t.y,r,0,2*Math.PI),o&&e.fill(),a&&e.stroke()},Ne=(e,t,n)=>{le(t)?Fe(e,t,n):ue(t)&&Pe(e,t,n)},Pe=(e,t,n={})=>{let r=j(e,n),{a:i,b:a,cubic1:o,cubic2:s}=t,c=n.debug??!1;e.beginPath(),e.moveTo(i.x,i.y),e.bezierCurveTo(o.x,o.y,s.x,s.y,a.x,a.y),e.stroke(),c&&(r=r.push(we({...n,strokeStyle:k(n.strokeStyle??`silver`,.6),fillStyle:k(n.fillStyle??`yellow`,.4)})),r.apply(),e.moveTo(i.x,i.y),e.lineTo(o.x,o.y),e.stroke(),e.moveTo(a.x,a.y),e.lineTo(s.x,s.y),e.stroke(),e.fillText(`a`,i.x+5,i.y),e.fillText(`b`,a.x+5,a.y),e.fillText(`c1`,o.x+5,o.y),e.fillText(`c2`,s.x+5,s.y),I(e,o,{radius:3}),I(e,s,{radius:3}),I(e,i,{radius:3}),I(e,a,{radius:3}),r=r.pop(),r.apply())},Fe=(e,t,n={})=>{let{a:r,b:i,quadratic:a}=t,o=n.debug??!1,s=j(e,n);e.beginPath(),e.moveTo(r.x,r.y),e.quadraticCurveTo(a.x,a.y,i.x,i.y),e.stroke(),o&&(s=s.push(we({...n,strokeStyle:k(n.strokeStyle??`silver`,.6),fillStyle:k(n.fillStyle??`yellow`,.4)})),P(e,[r,a,i]),e.fillText(`a`,r.x+5,r.y),e.fillText(`b`,i.x+5,i.y),e.fillText(`h`,a.x+5,a.y),I(e,a,{radius:3}),I(e,r,{radius:3}),I(e,i,{radius:3}),s=s.pop(),s.apply())},Ie=(e,t,n={})=>{L(e,ie(Array.isArray(t)?t:[t]),n)},L=(e,t,n={})=>{let r=n.debug??!1;j(e,n,De(n.lineWidth,n.lineJoin,n.lineCap));let i=t=>{let{a:n,b:i}=t;e.beginPath(),e.moveTo(n.x,n.y),e.lineTo(i.x,i.y),r&&(e.fillText(`a`,n.x,n.y),e.fillText(`b`,i.x,i.y),I(e,n,{radius:5,strokeStyle:`black`}),I(e,i,{radius:5,strokeStyle:`black`})),e.stroke()};if(Array.isArray(t))for(let e of t)i(e);else i(t)},Le=(e,t,n={})=>{j(e,n);let r=t=>{P(e,me(t),{...n,loop:!0}),n.debug&&F(e,me(t),void 0,[`a`,`b`,`c`])};if(Array.isArray(t))for(let e of t)r(e);else r(t)},R=(e,t,n={})=>{j(e,n);let r=n.filled??n.fillStyle!==void 0,i=n.stroke??n.strokeStyle!==void 0,a=t=>{let a=`x`in t?t.x:0,o=`y`in t?t.y:0;r&&e.fillRect(a,o,t.width,t.height),i&&(n.strokeWidth&&(e.lineWidth=n.strokeWidth),e.strokeRect(a,o,t.width,t.height)),n.crossed&&(e.beginPath(),e.moveTo(a,o),e.lineTo(t.width,t.height),e.stroke(),e.moveTo(0,t.height),e.lineTo(t.width,0),e.stroke()),n.debug&&F(e,re(t),void 0,[`NW`,`NE`,`SE`,`SW`])};if(Array.isArray(t))for(let e of t)a(e);else a(t)},Re=(e,t,n=0,r)=>z(e,t,n,r).width,z=(e,t,n=0,r)=>{if(t==null||t.length===0)return S;let i=e.measureText(t);return{width:r?d(i.width,r)+n:i.width+n,height:i.actualBoundingBoxAscent+i.actualBoundingBoxDescent+n+n}},ze=(e,t,n=0)=>z(e,t,n).height,Be=(e,t,n)=>{j(e,n);let r=n.anchorPadding??0,i=n.align??`top`,a=n.anchor,o=n.bounds??{x:0,y:0,width:1e6,height:1e6},s=t.map(t=>e.measureText(t)),c=s.map(e=>e.width),l=s.map(e=>e.actualBoundingBoxAscent+e.actualBoundingBoxDescent+3),u=Math.max(...c),d=l.reduce((e,t)=>e+t,0),{x:f,y:p}=a;a.x+u>o.width?f=o.width-(u+r):f-=r,f<o.x&&(f=o.x+r),a.y+d>o.height?p=o.height-(d+r):p-=r,p<o.y&&(p=o.y+r),i===`top`?e.textBaseline=`top`:e.textBaseline=`middle`;for(let[n,r]of t.entries())e.fillText(r,f,p),p+=l[n]},Ve=(e,t,n)=>{let{bounds:r}=n,{horiz:i=`left`,vert:a=`top`}=n,o=typeof t==`string`?[t]:t;j(e,n),e.save(),e.translate(r.x,r.y),e.textAlign=`left`,e.textBaseline=`top`;let s=r.width/2,c=r.height/2,l=o.map(t=>e.measureText(t)),u=l.map(e=>e.actualBoundingBoxAscent+e.actualBoundingBoxDescent),d=u.reduce((e,t)=>e+t,0),f=0;a===`center`?f=c-d/2:a===`bottom`&&(f=r.height-d);for(let[t,n]of o.entries()){let a=0;i===`center`?a=s-l[t].width/2:i===`right`&&(a=r.width-l[t].width),e.fillText(n,a,f),f+=u[t]}e.restore()};var He=e({accessor:()=>V,byColumn:()=>Ge,byRow:()=>We,grid:()=>B,setter:()=>H,wrap:()=>Ue});const B=e=>({rows:e.width,cols:e.height}),Ue=e=>({...B(e),get:V(e),set:H(e)}),V=e=>{let t=B(e),n=e.data;return(e,r=`undefined`)=>{let i=fe(t,e,r);if(i===void 0)return;let a=i*4;return{r:n[a],g:n[a+1],b:n[a+2],opacity:n[a+3],unit:`8bit`,space:`srgb`}}},H=e=>{let t=B(e),n=e.data;return(e,r,i=`undefined`)=>{let a=fe(t,r,i);if(a===void 0)throw Error(`Cell out of range. ${r.x},${r.y}`);let o=ge(e),s=a*4;n[s]=o.r,n[s+1]=o.g,n[s+2]=o.b,n[s+3]=o.opacity??255}};function*We(e){let t=V(e),n=de(B(e),{x:0,y:0});for(let e of n)yield e.map(e=>t(e,`undefined`))}function*Ge(e){let t=V(e),n=B(e);for(let e=0;e<n.cols;e++){let r=[];for(let i=0;i<n.rows;i++){let n=t({x:e,y:i},`undefined`);n&&r.push(n)}yield r}}var Ke=class extends a{el;opts;#e;#t;#n=C;#r=S;#i;#a;#o;#s=!1;constructor(e,t={}){if(super(),!e)throw Error(`Param 'domQueryOrEl' is null or undefined. Expected canvas element.`);if(this.el=m(e),this.el.nodeName!==`CANVAS`)throw Error(`Expected CANVAS HTML element. Got: ${this.el.nodeName}`);let n=this.el.getBoundingClientRect();this.opts={resizeLogic:t.resizeLogic??`none`,disablePointerEvents:t.disablePointerEvents??!1,pixelZoom:t.pixelZoom??(window.devicePixelRatio||1),height:t.height??n.height,width:t.width??n.width,zIndex:t.zIndex??-1,coordinateScale:t.coordinateScale??`both`,onResizing:t.onResizing,onResized:t.onResized,clearOnResize:t.clearOnResize??!0,draw:t.draw,skipCss:t.skipCss??!1,colourSpace:`srgb`},this.#e=D(`both`),this.#t=D(`both`,n),this.#l()}getRectangle(){return{x:0,y:0,...this.#r}}dispose(e){this.#s||(this.#s=!0,this.#o&&=(this.#o.dispose(`CanvasHelper disposing ${e}`.trim()),void 0))}#c(e=!1){if(this.#i===void 0||e){let e=this.ratio,t=this.el.getContext(`2d`);if(t===null)throw Error(`Could not create drawing context`);this.#i=t,t.setTransform(1,0,0,1,0,0),t.scale(e,e)}return this.#i}getPhysicalSize(){return{width:this.width*this.ratio,height:this.height*this.ratio}}getDrawHelper(){return this.#a||=Ce(this.#c(),{width:this.width,height:this.height}),this.#a}setLogicalSize(e){_(e,`logicalSize`);let t=y(e=>Math.floor(e),e),n=this.opts.pixelZoom;this.#e=D(this.opts.coordinateScale,e),this.#t=D(`both`,e);let r=b(e,n);this.el.width=r.width,this.el.height=r.height,this.el.style.width=t.width.toString()+`px`,this.el.style.height=t.height.toString()+`px`,this.#c(!0),this.opts.clearOnResize&&this.ctx.clearRect(0,0,this.width,this.height),this.#r=t,this.opts.onResizing&&this.opts.onResizing(this.ctx,this.size,this),this.fireEvent(`resize`,{ctx:this.ctx,size:this.#r,helper:this})}#l(){let e=this.opts.draw;if(e){let t=()=>{e(this.ctx,this.#r,this),requestAnimationFrame(t)};setTimeout(()=>{t()},100)}if(this.opts.disablePointerEvents||this.#d(),(this.opts.resizeLogic??`none`)===`none`)this.setLogicalSize({width:this.opts.width,height:this.opts.height});else{let e={onSizeChanging:e=>{oe(this.#r,e)||this.setLogicalSize(e)},onSizeDone:(e,t)=>{this.#u(e)},containerEl:this.opts.containerEl,naturalSize:{width:this.opts.width,height:this.opts.height},stretch:this.opts.resizeLogic??`none`};this.#o=new E(this.el,e)}this.#c()}#u(e){this.opts.onResized&&this.opts.onResized(this.ctx,this.size,this),this.fireEvent(`resized`,{ctx:this.ctx,size:this.#r,helper:this})}#d(){let e=e=>{let{offsetX:n,offsetY:r}=e,i=n*this.ratio,a=r*this.ratio;e=t(e);let o={physicalX:i,physicalY:a,...e};switch(e.type){case`pointerup`:this.fireEvent(`pointerup`,o);break;case`pointermove`:this.fireEvent(`pointermove`,o);break;case`pointerdown`:this.fireEvent(`pointerup`,o);break}};this.el.addEventListener(`pointermove`,e),this.el.addEventListener(`pointerdown`,e),this.el.addEventListener(`pointerup`,e)}clear(){this.#i&&this.#i.clearRect(0,0,this.width,this.height)}fill(e){this.#i&&(e&&(this.#i.fillStyle=e),this.#i.fillRect(0,0,this.width,this.height))}get ctx(){if(this.#i===void 0)throw Error(`Context not available`);return this.#c()}get viewport(){return this.#n}get width(){return this.#r.width}get height(){return this.#r.height}get size(){return this.#r}get ratio(){return window.devicePixelRatio||1}get dimensionMin(){return Math.min(this.width,this.height)}get dimensionMax(){return Math.max(this.width,this.height)}drawBounds(e=`green`){let t=this.#c();R(t,{x:0,y:0,width:this.width,height:this.height},{crossed:!0,strokeStyle:e,strokeWidth:1}),R(t,this.#n,{crossed:!0,strokeStyle:`silver`,strokeWidth:3})}get toRelative(){return this.#e.rel}get toAbsoluteFixed(){return this.#t.abs}get toRelativeFixed(){return this.#t.rel}get logicalCenter(){return{x:this.#r.width/2,y:this.#r.height/2}}get toAbsolute(){return this.#e.abs}get center(){return{x:this.width/2,y:this.height/2}}getImageData(){let e=this.getPhysicalSize(),t=this.ctx.getImageData(0,0,e.width,e.height,{colorSpace:this.opts.colourSpace});if(t==null)throw Error(`Could not get image data from context`);return t}getWritableBuffer(){let e=this.ctx,t=this.getImageData();return{grid:B(t),get:V(t),set:H(t),flip:()=>{e.putImageData(t,0,0)}}}};const qe=Math.PI*2;var U=class{#e;#t;#n;#r;#i;#a;#o=[];constructor(e,t=`min`){this.#e=m(e),this.#n=t,this.#a=window.devicePixelRatio||1,this.#r=this.#s(),this.#i=this.setLogicalSize({width:this.#e.width,height:this.#e.height})}setLogicalSize(e){this.#i=e;let t=this.#e;return t.width=e.width*this.#a,t.height=e.height*this.#a,t.style.width=`${e.width.toString()}px`,t.style.height=`${e.height.toString()}px`,this.#r=this.#s(),this.invalidateContext(),e}#s(){let e=1;switch(this.#n){case`min`:e=Math.min(this.#e.width,this.#e.height);break;case`max`:e=Math.max(this.#e.width,this.#e.height);break}let t=p(0,e,0,1);return{abs:t.in,rel:t.out}}invalidateContext(){this.#t=void 0}#c(e){if(!e)throw Error(`Param 'region' is undefined/null`);if(this.#o.includes(e))throw Error(`Region already exists`);return this.#o.push(e),e}toAbsPoint(e,t=`independent`){let{x:n,y:r}=e;switch(t){case`independent`:n*=this.width,r*=this.height}return{x:n,y:r}}get offset(){let e=this.#e.getBoundingClientRect();return{x:e.left,y:e.top}}toRelPoint(e,t,n=`independent`,r=!0){let{x:i,y:a}=e;if(t===`screen`){let e=this.#e.getBoundingClientRect();i-=e.x,a-=e.y}switch(n){case`independent`:i/=this.width,a/=this.height;break;case`skip`:break}return r&&(i=c(i),a=c(a)),{x:i,y:a}}toAbsRect(e,t=`independent`){let{width:n,height:r}=e;switch(t){case`independent`:if(n*=this.width,r*=this.height,g(e))return{...this.toAbsPoint(e),width:n,height:r}}return{width:n,height:r}}createRegion(e){let t=e.marginPx??0,r=t*2;if(`absPositioned`in e){let n=ce(e.absPositioned,t,t);return this.#c(new W(this,()=>n))}if(`relativePositioned`in e){let n,i=e.relativePositioned;switch(e.scale){case`independent`:n=e=>({x:i.x*e.width+t,y:i.y*e.height+t,width:i.width*e.width-r,height:i.height*e.height-r});break;default:throw Error(`Param 'kind' unknown (${e.scale})`)}return this.#c(new W(this,n))}if(`relativeSize`in e){let n,i=e.relativeSize,a=e.position;switch(e.scale){case`independent`:n=e=>{let n=i.width*e.width-r,o=i.height*e.height-r,s=e.width/2-n/2,c=e.height/2-o/2;switch(a){case`n`:c=0;break;case`s`:c=e.height-o;break;default:}return s+=t,c+=t,{width:n,height:o,x:s,y:c}};break;default:throw Error(`Param 'kind' unknown (${e.scale})`)}return this.#c(new W(this,n))}if(`match`in e){let i=te(e.match);if(!i.success)throw Error(`Could not resolve match element. ${n(i)}`);return this.#c(new W(this,e=>{let n=i.value.getBoundingClientRect();return{x:n.x+t,y:n.y+t,width:n.width-r,height:n.height-r}}))}throw Error(`Spec doesn't seem valid`)}clear(){this.context.clearRect(0,0,this.width,this.height)}get context(){if(this.#t)return this.#t;let e=this.#e.getContext(`2d`);if(!e)throw Error(`Could not create 2d context`);e.setTransform(1,0,0,1,0,0),e.scale(this.#a,this.#a),this.#t=e;for(let e of this.#o)e.recomputeRegion();return this.#t}get sizeScaler(){return this.#r}get width(){return this.#i.width}get height(){return this.#i.height}get element(){return this.#e}},W=class{source;#e;#t;constructor(e,t){this.source=e,this.#e=t,this.#t=t(e)}recomputeRegion(){this.#t=this.#e(this.source)}toAbsRegion(e,t=`both`){switch(t){case`both`:return{x:e.x*this.#t.width,y:e.y*this.#t.height}}}applyRegionOffset(e){return{x:e.x+this.#t.x,y:e.y+this.#t.y}}drawConnectedPointsRelative(e,t,n=1){let r=e.map(e=>this.toAbsRegion(e));this.drawConnectedPoints(r,t,n)}drawConnectedPoints(e,t,n=1){let r=this.context;r.save(),r.translate(this.#t.x,this.#t.y),r.beginPath(),r.strokeStyle=t,r.lineWidth=n;for(let t=0;t<e.length;t++)t===0?r.moveTo(e[t].x,e[t].y):r.lineTo(e[t].x,e[t].y);r.stroke(),r.restore()}fillTextRelative(e,t,n=`black`,r,i=`alphabetic`,a=`start`){let o=this.toAbsRegion(t);this.fillTextRelative(e,o,n,r,i,a)}fillText(e,t,n=`black`,r,i=`alphabetic`,a=`start`){let o=this.context;o.save(),o.translate(this.#t.x,this.#t.y),r.length>0&&(o.font=r),o.textBaseline=i,o.textAlign=a,o.fillStyle=n,o.fillText(e,t.x,t.y),o.restore()}drawCircles(e,t,n=``,r=1){let i=e.map(e=>({...this.toAbsRegion(e),radius:this.source.sizeScaler.abs(e.radius)})),a=this.context;a.save(),a.translate(this.#t.x,this.#t.y),a.fillStyle=t,a.strokeStyle=n,a.lineWidth=r;for(let e of i)a.beginPath(),a.arc(e.x,e.y,e.radius,0,qe),a.closePath(),t.length>0&&a.fill(),n.length>0&&a.stroke();a.restore()}clear(){this.context.clearRect(this.#t.x,this.#t.y,this.#t.width,this.#t.height)}fill(e=`white`){let t=this.context;t.fillStyle=e,t.fillRect(this.#t.x,this.#t.y,this.#t.width,this.#t.height)}drawBounds(e,t=1){this.drawConnectedPointsRelative([{x:0,y:0},{x:1,y:0},{x:1,y:1},{x:0,y:1},{x:0,y:0}],e,t),this.drawConnectedPointsRelative([{x:0,y:1},{x:1,y:0}],e,t),this.drawConnectedPointsRelative([{x:0,y:0},{x:1,y:1}],e,t)}toRelPoint(e,t=`screen`,n=`independent`,r=!0){e=this.source.toRelPoint(e,t,`skip`,!1);let{x:i,y:a}=e;switch(i-=this.x,a-=this.y,n){case`independent`:i/=this.width,a/=this.height}return r&&(i=c(i),a=c(a)),{x:i,y:a}}absToRegionPoint(e,t,n){t===`screen`&&(e=h(e,this.source.offset));let{x:r,y:i}=e;return r-=this.x,i-=this.y,n&&(r<0&&(r=0),i<0&&(i=0),r>this.width+this.x&&(r=this.x+this.width),i>this.height+this.y&&(i=this.y+this.height)),{x:r,y:i}}get center(){return w(this.#t)}get context(){return this.source.context}set region(e){this.#t=e}get region(){return this.#t}get width(){return this.#t.width}get height(){return this.#t.height}get x(){return this.#t.x}get y(){return this.#t.y}get dimensionMin(){return Math.min(this.#t.width,this.#t.height)}};const G=(e,t)=>{t.fillStyle&&e.setAttributeNS(null,`fill`,t.fillStyle),t.opacity&&e.setAttributeNS(null,`opacity`,t.opacity.toString())},Je=e=>{let t=e.getAttributeNS(null,`width`),n=t===null?0:Number.parseFloat(t),r=e.getAttributeNS(null,`height`);return{width:n,height:r===null?0:Number.parseFloat(r)}},Ye=(e,t)=>{e.setAttributeNS(null,`width`,t.width.toString()),e.setAttributeNS(null,`height`,t.height.toString())},K=(e,t)=>{let n=document.createElementNS(`http://www.w3.org/2000/svg`,e);return t&&(n.id=t),n},q=(e,t,n,r)=>{let i=null;if(n!==void 0&&(i=typeof n==`string`?e.querySelector(n):n),i===null){let i=document.createElementNS(`http://www.w3.org/2000/svg`,t);return e.append(i),n&&typeof n==`string`&&n.startsWith(`#`)&&(i.id=r!==void 0&&!n.endsWith(r)?n.slice(1)+r:n.slice(1)),i}return i},J=(e,t)=>{t.strokeStyle&&e.setAttributeNS(null,`stroke`,t.strokeStyle),t.strokeWidth&&e.setAttributeNS(null,`stroke-width`,t.strokeWidth.toString()),t.strokeDash&&e.setAttribute(`stroke-dasharray`,t.strokeDash),t.strokeLineCap&&e.setAttribute(`stroke-linecap`,t.strokeLineCap)},Xe=(e,t,n)=>{let r=K(`marker`,e);if(t.markerWidth&&r.setAttribute(`markerWidth`,t.markerWidth?.toString()),t.markerHeight&&r.setAttribute(`markerHeight`,t.markerHeight?.toString()),t.orient?r.setAttribute(`orient`,t.orient.toString()):r.setAttribute(`orient`,`auto-start-reverse`),t.viewBox&&r.setAttribute(`viewBox`,t.viewBox.toString()),t.refX&&r.setAttribute(`refX`,t.refX.toString()),t.refY&&r.setAttribute(`refY`,t.refY.toString()),n){let e=n();r.appendChild(e)}return r},Y=(e,t,n)=>{if(e===null)return`(elem null)`;let r=e.ownerSVGElement;if(r===null)throw Error(`parent for elem is null`);let i=q(r,`defs`,`defs`),a=i.querySelector(`#${t.id}`);if(a!==null)return`url(#${t.id})`;if(t.id===`triangle`)t={...t,strokeStyle:`transparent`},t.markerHeight||(t={...t,markerHeight:6}),t.markerWidth||(t={...t,markerWidth:6}),t.refX||(t={...t,refX:t.markerWidth}),t.refY||(t={...t,refY:t.markerHeight}),(!t.fillStyle||t.fillStyle===`none`)&&(t={...t,fillStyle:`black`}),t.viewBox||(t={...t,viewBox:`0 0 10 10`}),a=Xe(t.id,t,()=>{let e=K(`path`);return e.setAttribute(`d`,`M 0 0 L 10 5 L 0 10 z`),t&&G(e,t),e});else throw Error(`Do not know how to make ${t.id}`);return a.id=t.id,i.appendChild(a),`url(#${t.id})`},X=(e,t)=>{t.markerEnd&&e.setAttribute(`marker-end`,Y(e,t.markerEnd,t)),t.markerStart&&e.setAttribute(`marker-start`,Y(e,t.markerStart,t)),t.markerMid&&e.setAttribute(`marker-mid`,Y(e,t.markerMid,t))};var Ze=e({circle:()=>Z,circleUpdate:()=>tt,grid:()=>ut,group:()=>nt,groupUpdate:()=>rt,line:()=>Q,lineUpdate:()=>it,path:()=>$e,pathUpdate:()=>et,polarRayUpdate:()=>at,text:()=>lt,textPath:()=>st,textPathUpdate:()=>ot,textUpdate:()=>ct});const Qe=e=>e>=0&&e<=1?`${e*100}%`:e.toString(),$e=(e,t,n,r)=>{let i=q(t,`path`,r),a=typeof e==`string`?e:e.join(`
`);return i.setAttributeNS(null,`d`,a),t.append(i),et(i,n)},et=(e,t)=>(t&&G(e,t),t&&J(e,t),e),tt=(e,t,n)=>(e.setAttributeNS(null,`cx`,t.x.toString()),e.setAttributeNS(null,`cy`,t.y.toString()),e.setAttributeNS(null,`r`,t.radius.toString()),n&&G(e,n),n&&J(e,n),e),Z=(e,t,n,r)=>tt(q(t,`circle`,r),e,n),nt=(e,t,n)=>rt(q(t,`g`,n),e),rt=(e,t)=>{for(let n of t)n.parentNode!==e&&e.append(n);return e},Q=(e,t,n,r)=>it(q(t,`line`,r),e,n),it=(e,t,n)=>(e.setAttributeNS(null,`x1`,t.a.x.toString()),e.setAttributeNS(null,`y1`,t.a.y.toString()),e.setAttributeNS(null,`x2`,t.b.x.toString()),e.setAttributeNS(null,`y2`,t.b.y.toString()),n&&G(e,n),n&&X(e,n),n&&J(e,n),e),at=(e,t,n)=>{let r=ie(t);return e.setAttributeNS(null,`x1`,r.a.x.toString()),e.setAttributeNS(null,`y1`,r.a.y.toString()),e.setAttributeNS(null,`x2`,r.b.x.toString()),e.setAttributeNS(null,`y2`,r.b.y.toString()),n&&G(e,n),n&&X(e,n),n&&J(e,n),e},ot=(e,t,n)=>(n?.method&&e.setAttributeNS(null,`method`,n.method),n?.side&&e.setAttributeNS(null,`side`,n.side),n?.spacing&&e.setAttributeNS(null,`spacing`,n.spacing),n?.startOffset&&e.setAttributeNS(null,`startOffset`,Qe(n.startOffset)),n?.textLength&&e.setAttributeNS(null,`textLength`,Qe(n.textLength)),t&&(e.textContent=t),n&&G(e,n),n&&J(e,n),e),st=(e,t,n,r,i,a)=>{let o=q(n,`text`,i,`-text`);ct(o,void 0,void 0,r);let s=q(o,`textPath`,a);return s.setAttributeNS(null,`href`,e),ot(s,t,r)},ct=(e,t,n,r)=>(t&&(e.setAttributeNS(null,`x`,t.x.toString()),e.setAttributeNS(null,`y`,t.y.toString())),n&&(e.textContent=n),r&&(G(e,r),r&&J(e,r),r.anchor&&e.setAttributeNS(null,`text-anchor`,r.anchor),r.align&&e.setAttributeNS(null,`alignment-baseline`,r.align),(r.userSelect??!0)||(e.style.userSelect=`none`)),e),lt=(e,t,n,r,i)=>ct(q(t,`text`,i),n,e,r),ut=(e,t,n,r,i,a={})=>{a.strokeStyle||(a={...a,strokeStyle:A(`bg-dim`,`silver`)}),a.strokeWidth||(a={...a,strokeWidth:1});let o=K(`g`);G(o,a),X(o,a),J(o,a);let s=0;for(;s<i;)Q(T(0,s,r,s),o),s+=n;let c=0;for(;c<r;)Q(T(c,0,c,i),o),c+=n;return e.append(o),o},dt=e=>{if(!e)throw Error(`Param 'el' is undefined`);return{a:{x:e.x1.baseVal.value,y:e.y1.baseVal.value},b:{x:e.x2.baseVal.value,y:e.y2.baseVal.value}}},ft=(e,t)=>ae(dt(e),t),pt=(e,t)=>{if(typeof t==`string`){let n=e.querySelector(t);if(n===null)return;n.remove()}else t.remove()},mt=e=>{let t=e.lastElementChild;for(;t;)t.remove(),t=e.lastElementChild},ht=(e,t)=>(t&&(G(e,t),J(e,t)),{remove:t=>{pt(e,t)},text:(t,n,r,i)=>lt(t,e,n,r,i),textPath:(t,n,r,i,a)=>st(t,n,e,r,i,a),line:(t,n,r)=>Q(t,e,n,r),circle:(t,n,r)=>Z(t,e,n,r),path:(t,n,r)=>$e(t,e,n,r),grid:(t,n,r,i,a)=>ut(e,t,n,r,i,a),query:t=>e.querySelector(t),get width(){let t=e.getAttributeNS(null,`width`);return t===null?0:Number.parseFloat(t)},set width(t){e.setAttributeNS(null,`width`,t.toString())},get parent(){return e},get height(){let t=e.getAttributeNS(null,`height`);return t===null?0:Number.parseFloat(t)},set height(t){e.setAttributeNS(null,`height`,t.toString())},clear:()=>{for(;e.firstChild;)e.lastChild.remove()}});var gt=e({Elements:()=>Ze,applyOpts:()=>G,applyPathOpts:()=>X,applyStrokeOpts:()=>J,clear:()=>mt,createEl:()=>K,createMarker:()=>Xe,createOrResolve:()=>q,getBounds:()=>Je,lineFromSvgLine:()=>dt,makeHelper:()=>ht,markerPrebuilt:()=>Y,polarRayFromSvgLine:()=>ft,remove:()=>pt,setBounds:()=>Ye});const _t=(e,t={})=>{let n=t.touchRadius??45,r=t.touchRadius??20,i=t.trace??!1,a=t.hue??100,o=`hsla(${a}, 100%, 10%, 10%)`,s=a,c=m(e),l=new se({storeIntermediate:i}),u=document.createElementNS(`http://www.w3.org/2000/svg`,`svg`);u.id=`pointerVis`,u.style.zIndex=`-1000`,u.style.position=`fixed`,u.style.top=`0`,u.style.left=`0`,u.style.width=`100%`,u.style.height=`100%`,u.style.boxSizing=`border-box`,u.style.border=`3px solid red`,u.style.pointerEvents=`none`,u.style.touchAction=`none`,E.svgViewport(u);let d=0,f=e=>{let t=e.pointerId.toString();l.delete(t),s=a,u.querySelector(`#pv-start-${t}`)?.remove();for(let e=0;e<d+10;e++)u.querySelector(`#pv-progress-${t}-${e}`)?.remove();d=0},p=async e=>{let t=e.pointerId.toString(),i={x:e.x,y:e.y},a=e.pointerType;if(e.type===`pointermove`&&!l.has(t))return;let c=await l.seen(e.pointerId.toString(),{x:e.clientX,y:e.clientY});if(c.values.length===1){let e=Z({...c.values[0],radius:a===`touch`?n:r},u,{fillStyle:o},`#pv-start-${t}`);e.style.pointerEvents=`none`,e.style.touchAction=`none`}let f=`hsla(${s}, 100%, 50%, 50%)`,p=Z({...i,radius:a===`touch`?n:r},u,{fillStyle:f},`#pv-progress-${t}-${c.values.length}`);p.style.pointerEvents=`none`,p.style.touchAction=`none`,s+=1,d=c.values.length};document.body.append(u),c.addEventListener(`pointerdown`,p),c.addEventListener(`pointermove`,p),c.addEventListener(`pointerup`,f),c.addEventListener(`pointerleave`,f),c.addEventListener(`contextmenu`,e=>{e.preventDefault()})};var vt=e({boxBlurKernel:()=>Dt,convolve:()=>xt,convolveCell:()=>yt,convolveImage:()=>bt,edgeDetectionKernel:()=>Tt,gaussianBlur3Kernel:()=>Ot,gaussianBlur5Kernel:()=>kt,identityKernel:()=>wt,kernel2dToArray:()=>St,multiply:()=>$,rgbReducer:()=>Ct,sharpenKernel:()=>Et,unsharpMasking5Kernel:()=>At});const $=(e,t)=>{let n=e.length,r=e[0].length,i=[];for(let a=0;a<n;a++){i[a]=[];for(let n=0;n<r;n++)i[a][n]=e[a][n]*t}return i};function yt(e,t,n,r){return r(t.map(t=>{let r=he(n,e,t.cell,`stop`),i;return r&&(i=n.get(r,`undefined`),t.value),{cell:t.cell,value:i,kernel:t.value}}))}function*bt(e,t){let n=Ue(t);yield*xt(e,n,pe(n),Ct)}function*xt(e,t,n,r,i){if(!i){let t=e.length,n=e[0].length;i={x:Math.floor(t/2),y:Math.floor(n/2)}}let a=St(e,i);for(let e of n)yield{cell:e,value:yt(e,a,t,r)}}const St=(e,t)=>{let n=[],r=e.length,i=e[0].length;t||={x:Math.floor(r/2),y:Math.floor(i/2)};for(let a=0;a<r;a++)for(let r=0;r<i;r++){let i={cell:{x:a-t.x,y:r-t.y},value:e[a][r]};n.push(i)}return n},Ct=e=>{let t=0,n=0,r=0,i=0;for(let a of e){let e=a.value,o=a.kernel;e&&e.opacity!==0&&o!==0&&(t+=e.r*o,n+=e.g*o,r+=e.b*o,i+=(e.opacity??1)*o)}return{r:t,g:n,b:r,unit:`8bit`,space:`srgb`,opacity:i}},wt=[[0,0,0],[0,1,0],[0,0,0]],Tt=[[0,-1,0],[-1,4,-1],[0,-1,0]],Et=[[0,-1,0],[-1,5,-1],[0,-1,0]],Dt=$([[1,1,1],[1,1,1],[1,1,1]],1/9),Ot=$([[1,2,1],[2,4,2],[1,2,1]],1/16),kt=$([[1,4,6,4,1],[4,16,24,16,4],[6,24,36,24,6],[4,16,24,16,4],[1,4,6,4,1]],1/256),At=$([[1,4,6,4,1],[4,16,24,16,4],[6,24,-476,24,6],[4,16,24,16,4],[1,4,6,4,1]],-1/256);var jt=e({init:()=>Nt});function Mt(e,t,n){let r=e.getAttribute(t);return r===null?n:Number.parseInt(r)}const Nt=(e,t={})=>{let n=document.querySelector(e);if(!n)throw Error(`Element query could not be found (${e})`);let r=t.labels??[`x`,`y`],i=t.labelPrecision??2,a=t.asPercentages??!1,o=t.displayLastValues??0,s=t.showWhiskers??!0,c=t.showDot??!0,u=t.showLabels??!0,d=t.yAxisBottomNegative??!0,f=A(t.axisColour,`silver`),p=A(t.bgColour,`white`),te=A(t.whiskerColour,`black`),m=A(t.dotColour,t.whiskerColour,`black`),ne=A(t.labelColour,t.axisColour,`silver`),h=t.axisWidth??1*window.devicePixelRatio,re=t.dotRadius??5*window.devicePixelRatio,g=t.padding??10*window.devicePixelRatio,_=t.whiskerSize??5*window.devicePixelRatio,v=t.width??Mt(n,`width`,200)*window.devicePixelRatio,y=t.height??Mt(n,`height`,200)*window.devicePixelRatio,b;o>0&&(b=new ee({capacity:o,discardPolicy:`older`})),n.width=v,n.height=y,n.style.width=`${v/window.devicePixelRatio}px`,n.style.height=`${y/window.devicePixelRatio}px`;let x=y/2,S=v/2,C=n.getContext(`2d`);if(!C)throw Error(`Could not create drawing context`);window.devicePixelRatio>=2&&(C.font=`20px sans-serif`);let w=a?e=>`${Math.round(e*100)}%`:e=>e.toFixed(i);u?(r[0]+=`:`,r[1]+=`:`):(r[0]=``,r[1]=``);let T=t.renderBackground??((e,n,r)=>{t.bgColour===`transparent`?e.clearRect(0,0,n,r):(e.fillStyle=p,e.fillRect(0,0,n,r))});return(e,t)=>{e=l(e),t=l(t),T(C,v,y),C.fillStyle=ne,C.textBaseline=`top`,C.save(),C.translate(S,x),C.rotate(-Math.PI/2),C.fillText((r[1]+` `+w(t)).trim(),-S+g,1),C.restore(),C.fillText((r[0]+` `+w(e)).trim(),g,S+2),d||(t*=-1),C.strokeStyle=f,C.lineWidth=h,C.beginPath(),C.moveTo(g,x),C.lineTo(v-g,x),C.moveTo(S,g),C.lineTo(S,y-g),C.stroke(),C.closePath();let n=(y-g-g)/2*-t,i=(v-g-g)/2*e,a={x:i,y:n,radius:re};if(b&&=b.enqueue(a),C.save(),C.translate(S,x),c)if(b){let e=1/b.length,t=1;b.forEach(n=>{N(C,n,{fillStyle:k(m,t)}),t-=e})}else N(C,a,{fillStyle:m});s&&(C.strokeStyle=te,C.beginPath(),C.moveTo(0,n-_),C.lineTo(0,n+_),C.moveTo(i-_,0),C.lineTo(i+_,0),C.stroke(),C.closePath()),C.restore()}},Pt=e=>{let t=e.map(e=>e.x),n=e.map(e=>e.y),r=Math.min(...t),i=Math.max(...t),a=Math.min(...n),o=Math.max(...n),s=i-r,c=o-a;return{min:{x:r,y:a},max:{x:i,y:o},width:s,height:c,minDim:Math.min(s,c),maxDim:Math.max(s,c)}},Ft=e=>{if(!Number.isFinite(e.height))return e=>e;let t=f(e.min.x,e.max.x),n=f(e.min.y,e.max.y);return e=>({x:t(e.x),y:n(e.y)})},It=e=>{let t=f(0,1,e.min.x,e.max.x),n=f(0,1,e.min.y,e.max.y);return e=>({x:t(e.x),y:n(e.y)})},Lt=(e,t,n)=>{let r=[],i=0;for(let a=e.min.x;a<e.max.x;a+=t){let e=i%n===0;r.push({x:a,y:0,major:e}),i++}i=0;let a=[];for(let r=e.min.y;r<e.max.y;r+=t){let e=i%n===0;a.push({x:0,y:r,major:e}),i++}return{x:r,y:a}};var Rt=class{#e;#t;lastChange;constructor(){this.lastChange=performance.now(),this.#e=new o,this.#t=new Map}get metaCount(){return this.#t.size}clear(){this.#e.clear(),this.lastChange=performance.now()}set(e,t){this.#e.setValues(e,t)}deleteBySeries(e){let t=this.#e.delete(e);return t&&(this.lastChange=performance.now()),t}setMeta(e,t){this.#t.set(e,t)}hasMeta(e){return this.#t.has(e)}getMeta(e){return this.#t.get(e)}*getValues(){yield*this.#e.valuesFlat()}*getEntries(){yield*this.#e.entries()}*getSeries(){yield*this.#e.values()}add(e,t=`default`){this.#e.addKeyedValues(t,e),this.lastChange=performance.now()}};const zt=(e,t={})=>{let n=e.parent===void 0?document.body:m(e.parent),r=document.createElement(`canvas`);n.prepend(r);let i=new Rt,a=new U(r,`min`),o=e.region??{relativePositioned:{x:0,y:0,width:1,height:1}},s=new Bt(a.createRegion(o),i,t);return e.canvasResizeTo===`viewport`?E.canvasViewport(r,{onSizeChanging:(e,t)=>{a.setLogicalSize(e),s.invalidateRange(),s.draw()}}):E.canvasParent(r,{onSizeChanging:(e,t)=>{a.setLogicalSize(e),s.invalidateRange(),s.draw()}}),s};var Bt=class e{#e;#t;#n;actualDataRange=C;visibleRange=x;show;whiskerLength;axisRounder=u(1,!0);onInvalidated;overlayLines=[];#r;#i;#a;#o;#s;#c;#l;#u;#d;#f;constructor(e,t,n={}){if(!t)throw TypeError(`Param 'data' is undefined`);if(typeof t!=`object`)throw TypeError(`Param 'data' is not an object. Got: ${typeof t}`);this.onInvalidated=n.onInvalidated,this.#e=t,this.#n=e,this.#t=0,this.#f=n.clear??`region`,this.#i=n.range??`auto`,this.#s=n.valueStyle??`dot`,this.#c=n.connectStyle??``,this.whiskerLength=n.whiskerLength??5,this.#d=n.visualPadding??20,this.show={axes:!0,axisValues:!0,grid:!0,whiskers:!0,...n.show},this.#o={colour:`black`,width:2,...n.axisStyle},this.#u={colour:`black`,size:`1em`,font:`system-ui`,...n.textStyle},this.#r={increments:.1,major:5,colour:`whitesmoke`,width:1,...n.grid}}static fromCanvas(t,n,r={}){let i=new U(t,`min`),a=i.element.getBoundingClientRect();return new e(i.createRegion({absPositioned:{x:0,y:0,width:a.width,height:a.height},scale:`independent`}),n,r)}getCurrentRange(){if(this.#e.lastChange===this.#t&&this.#a)return this.#a;this.#t=this.#e.lastChange;let e=this.#p();return this.#a=e,this.onInvalidated&&this.onInvalidated(),e}invalidateRange(){this.#a=void 0}#p(){let e=this.getDataRange(),t=Ft(e),n=It(e),r=this.#n,i=this.#d,a=r.x+i,o=r.y+i,s=r.height-i*2,c=r.width-i*2,l=Math.min(s,c);return c>=s?a+=c/2-l/2:o+=s/2-l/2,{absDataToRelative:t,relDataToCanvas:e=>{let{x:t,y:n}=e;return t===-1/0?t=0:t===1/0&&(t=1),n===-1/0?n=0:n===1/0&&(n=1),t*=l,n=(1-n)*l,t+=a,n+=o,{x:t,y:n}},canvasToRelData:e=>{let{x:t,y:n}=e;return t-=a,n-=o,t/=l,n=1-n/l,{x:t,y:n}},regionSpaceToRelative:e=>{let{x:t,y:n}=e;return t=t-r.x+this.#d,n=l+this.#d-n,t/=l,n/=l,{x:t,y:n}},relDataToAbs:n,range:e}}positionElementAt(e,t,n=`middle`,r){let i=m(t),{x:a,y:o}=this.valueToScreenSpace(e);if(n===`middle`){let e=i.getBoundingClientRect();a-=e.width/2,o-=e.height/2}else if(n!==`top-left`)throw Error(`Param 'by' expected to be 'middle' or 'top-left'.`);if(r){let e=m(r).getBoundingClientRect();a-=e.x,o-=e.y}i.style.left=`${a}px`,i.style.top=`${o}px`}getDataRange(){return this.#i===`auto`?Pt([...this.#e.getValues()]):(this.#l||=Pt([this.#i.max,this.#i.min]),this.#l)}valueToScreenSpace(e){let t=this.valueToRegionSpace(e),n=this.canvasSource.offset;return{x:t.x+n.x,y:t.y+n.y}}valueToRegionSpace(e,t=!1){let n=this.getCurrentRange(),r=n.absDataToRelative(e),i=n.relDataToCanvas(r);return t&&console.log(`orig: ${e.x}x${e.y} rel: ${r.x}x${r.y} region: ${i.x}x${i.y}`),{...e,x:i.x,y:i.y}}pointToValue(e,t){let n=this.getCurrentRange(),r=h(e,this.canvasSource.offset),i=n.canvasToRelData(r);return n.relDataToAbs(i)}#m(e,t,n=!1){return e=this.valueToRegionSpace(e,n),t=this.valueToRegionSpace(t,n),{a:e,b:t}}getDefaultMeta(){return{colour:_e(this.#e.metaCount),lineWidth:2,dotRadius:5}}draw(){this.#f===`region`?this.#n.clear():this.canvasSource.clear(),this.#b(),this.show.axes&&this.#h();for(let[e,t]of this.#e.getEntries()){let n=this.#e.getMeta(e);n||(n=this.getDefaultMeta(),this.#e.setMeta(e,n)),this.#x(e,t,n)}for(let e of this.overlayLines)this.drawLine(e,e.colour,e.width)}drawLine(e,t,n){let r=this.#m(e.a,e.b);this.#w(r,t,n)}setMeta(e,t){this.#e.setMeta(e,{...this.getDefaultMeta(),...t})}#h(){let{colour:e,width:t}=this.#o,n=this.#m({x:0,y:-1/0},{x:0,y:1/0},!1),r=this.#m({x:-1/0,y:0},{x:1/0,y:0},!1);this.#w(r,e,t,!1),this.#w(n,e,t,!1)}#g(e){let t=this.#n.context;t.font=this.#u.size+` `+this.#u.font,t.fillStyle=this.#u.colour,t.textBaseline=`middle`;for(let n of e){if(n.x===0&&n.y===0)continue;let e=this.valueToRegionSpace(n,!1),r=this.axisRounder(n.y).toString(),i=t.measureText(r),a=e.x-i.width-this.whiskerLength/2-5,o=e.y;t.fillText(r,a,o)}}#_(e){let t=this.#n.context;t.font=this.#u.size+` `+this.#u.font,t.fillStyle=this.#u.colour,t.textBaseline=`top`;for(let n of e){let e=this.valueToRegionSpace(n,!1),r=this.axisRounder(n.x).toString(),i=t.measureText(r),a=e.x-i.width/2,o=e.y+i.actualBoundingBoxAscent+i.actualBoundingBoxDescent+this.whiskerLength/2;t.fillText(r,a,o)}}#v(e,t){let n=this.whiskerLength/2,r=t?{x:e.x,y:0}:{y:e.y,x:0},i=this.valueToRegionSpace(r,!1),a=t?{a:{x:i.x,y:i.y-n},b:{x:i.x,y:i.y+n}}:{a:{y:i.y,x:i.x-n},b:{y:i.y,x:i.x+n}};this.#w(a,this.#o.colour,this.#o.width,!1)}#y(e,t){let n=t?this.#m({x:e.x,y:-1/0},{x:e.x,y:1/0}):this.#m({y:e.y,x:-1/0},{y:e.y,x:1/0},!1);this.#w(n,this.#r.colour,e.major?this.#r.width*2:this.#r.width)}#b(){let e=this.#r,t=this.show.grid,n=this.show.whiskers,r=this.show.axisValues,i=this.getCurrentRange().range,{increments:a,major:o}=e,s=Lt(i,a,o);for(let e of s.x)t&&this.#y(e,!0),n&&e.major&&this.#v(e,!0);for(let e of s.y)t&&this.#y(e,!1),n&&e.major&&this.#v(e,!1);r&&(this.#_(s.x.filter(e=>e.major)),this.#g(s.y.filter(e=>e.major)))}#x(e,t,n){if(this.#c===`line`&&this.#S(t,n.colour,n.lineWidth),this.#s===`dot`)for(let e of t)this.#C(e,n.colour,n.dotRadius)}#S(e,t,n){let r=this.#n.context;r.beginPath();for(let[t,n]of e.entries()){let e=this.valueToRegionSpace(n,!1);t===0&&r.moveTo(e.x,e.y),r.lineTo(e.x,e.y)}r.strokeStyle=O(t),r.lineWidth=n,r.stroke(),r.closePath()}#C(e,t,n){let r=O(e.fillStyle??t),i=this.valueToRegionSpace(e),a=e.radius??n;this.#n.drawCircles([{...i,radius:a}],r)}#w(e,t,n,r=!1){r&&console.log(e);let i=this.#n.context;t=O(t),i.beginPath(),i.moveTo(e.a.x,e.a.y),i.lineTo(e.b.x,e.b.y),i.strokeStyle=O(t),i.lineWidth=n,i.stroke(),i.closePath()}get dataSet(){return this.#e}get canvasRegion(){return this.#n}get canvasSource(){return this.#n.source}},Vt=e({BipolarView:()=>jt,CartesianCanvasPlot:()=>Bt,DataSet:()=>Rt,absoluteCompute:()=>It,computeAxisMark:()=>Lt,computeMinMax:()=>Pt,insert:()=>zt,relativeCompute:()=>Ft});export{Ke as CanvasHelper,W as CanvasRegion,U as CanvasSource,ve as Colour,vt as Convolve2d,be as Drawing,He as ImageDataGrid,Vt as Plot,gt as Svg,ye as Video,_t as pointerVisualise};