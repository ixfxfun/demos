{"version":3,"sources":["../src/flow/RateMinimum.ts"],"sourcesContent":["import type { Interval } from \"./IntervalType.js\";\nimport { timeout } from \"./Timeout.js\";\n\n\nexport type RateMinimumOptions<TInput> = Readonly<{\n  whatToCall: (args: TInput) => void\n  fallback: () => TInput\n  interval: Interval\n  abort?: AbortSignal\n}>;\n\n/**\n * Ensures that `whatToCall` is executed with a given tempo.\n * \n * ```js\n * const rm = rateMinimum({\n *  fallback: () => {\n *    return Math.random();\n *  },\n *  whatToCall: (value:number) => {\n *    console.log(value);\n *  },\n *  interval: { secs: 10 }\n * });\n * \n * // Invokes `whatToCall`, resetting timeout\n * rm(10);\n * \n * // If we don't call rm() before 'interval' has elapsed,\n * // 'fallback' will be invoked\n * ``` \n * \n * A practical use for this is to update calculations based on firing of events\n * as well as when they don't fire. For example user input.\n * \n * ```js\n * // Average distances\n * const average = movingAverageLight();\n * const rm = rateMinimum({\n *  interval: { secs: 1 },\n *  whatToCall: (distance: number) => {\n *    average(distance);\n *  },\n *  // If there are no pointermove events, distance is 0\n *  fallback() {\n *    return 0;\n *  }\n * })\n * \n * // Report total movemeent\n * document.addEventListener(`pointermove`, event => {\n *  rm(event.movementX + event.movementY);\n * });\n * ```\n * \n * @param options \n * @returns \n */\nexport const rateMinimum = <TInput>(options: RateMinimumOptions<TInput>) => {\n  let disposed = false;\n\n  const t = timeout(() => {\n    if (disposed) return;\n    t.start();\n    options.whatToCall(options.fallback());\n  }, options.interval);\n\n\n  if (options.abort) {\n    options.abort.addEventListener(`abort`, _ => {\n      disposed = true;\n      t.cancel();\n    });\n  }\n  t.start();\n\n  return (args: TInput) => {\n    if (disposed) throw new Error(`AbortSignal has been fired`);\n    t.start();\n    options.whatToCall(args);\n  }\n}"],"mappings":";;;;;AA0DO,IAAM,cAAc,CAAS,YAAwC;AAC1E,MAAI,WAAW;AAEf,QAAM,IAAI,QAAQ,MAAM;AACtB,QAAI,SAAU;AACd,MAAE,MAAM;AACR,YAAQ,WAAW,QAAQ,SAAS,CAAC;AAAA,EACvC,GAAG,QAAQ,QAAQ;AAGnB,MAAI,QAAQ,OAAO;AACjB,YAAQ,MAAM,iBAAiB,SAAS,OAAK;AAC3C,iBAAW;AACX,QAAE,OAAO;AAAA,IACX,CAAC;AAAA,EACH;AACA,IAAE,MAAM;AAER,SAAO,CAAC,SAAiB;AACvB,QAAI,SAAU,OAAM,IAAI,MAAM,4BAA4B;AAC1D,MAAE,MAAM;AACR,YAAQ,WAAW,IAAI;AAAA,EACzB;AACF;","names":[]}