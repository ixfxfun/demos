import{n as e}from"./chunk-CVLEGGlw.js";import{A as t,Bt as n,H as r,K as i,N as a,St as o,U as s,bt as c,h as l,mt as u,n as d,wt as f,z as p,zt as m}from"./src-DdJCbM4z.js";import{_ as h,x as g}from"./numbers-BlBexQl9.js";import{n as _}from"./object-C3MekYVU.js";import{t as ee}from"./error-message-CFnyH0EB.js";import{r as v}from"./random-EejSd_WN.js";import{r as y,t as te}from"./remove-CtQN2QCw.js";import{U as b,W as ne,z as re}from"./src-kD5hEVnd.js";import{t as ie}from"./queue-mutable-DkFlFSVY.js";import{a as ae,i as oe,n as se,o as ce,r as le,t as ue}from"./basic-cEbPND7Y.js";import{t as de}from"./interpolate-Dc-oL9YV.js";import{n as fe,r as pe}from"./graph-CVtu0waB.js";import{t as me}from"./timeout-BnV_k5ts.js";import{t as he}from"./dispatch-list-Cg3WNfvI.js";import{i as x,r as ge}from"./state-machine-C0DUbIyp.js";import{n as _e}from"./set-property-Bqp3T_hu.js";function S(e){return e.value===void 0?`signal`in e&&e.signal!==void 0:!1}function C(e){return e.value===void 0?`signal`in e&&e.signal===`done`:!1}function w(e){return e.value!==void 0}const ve=e=>T(e)?`ping`in e:!1,ye=e=>T(e)?`last`in e&&e.last()!==void 0:!1,T=e=>typeof e!=`object`||!e?!1:`on`in e&&`onValue`in e,E=e=>T(e)?`set`in e:!1,be=e=>!(typeof e!=`object`||!(`source`in e)||!(`annotate`in e)),D=(e,...t)=>n=>e(n,...t),xe=e=>`value`in e,Se=e=>`fn`in e,O=e=>ne(e),Ce=e=>typeof e==`object`?!!(xe(e)||Se(e)||O(e)):!1;function we(e){if(xe(e))return[e.value,!1];if(Se(e)){let t=e.fn();return t===void 0?[void 0,!0]:[t,!1]}if(O(e)){let t=e.gen.next();return t.done?[void 0,!0]:[t.value,!1]}throw Error(`Invalid trigger. Missing 'value' or 'fn' fields`)}function Te(e,t={}){let n=t.maximumRepeats??2**53-1,r=t.closeOnError??!0,i=t.interval?l(t.interval):-1,a=t.manual??!1;if(t.interval===void 0&&t.manual===void 0&&(a=!0),a&&t.interval)throw Error(`If option 'manual' is set, option 'interval' cannot be used`);let o=l(t.predelay,0),s=t.lazy??`very`,c=t.signal,u=new AbortController,f=e=>{u.abort(e)},m=0,h=!1,g=e=>{y.dispose(e),h=!1,v&&v.cancel()},_=async()=>{if(!h)return!1;if(o&&await d(o),m>=n)return g(`Maximum repeats reached ${n.toString()}`),!1;try{if(c?.aborted)return g(`Signal (${c.aborted})`),!1;let t=await e(f);return m++,y.set(t),!0}catch(e){return r?(g(`Function error: ${ee(e)}`),!1):(y.signal(`warn`,ee(e)),!0)}},v=a?void 0:p(async()=>{if(!await _())return!1;if(u.signal.aborted)return g(`callback function aborted (${u.signal.reason})`),!1},i),y=N({lazy:s,onStart(){h=!0,v&&v.start()},onStop(){h=!1,v&&v.cancel()}});return s===`never`&&v&&v.start(),{...y,ping:_}}function k(e,t={}){let n=t.lazy??`very`,r=t.traceLifecycle?e=>{console.log(`Rx.From.iterator ${e}`)}:e=>{},i=l(t.readInterval,5),a=l(t.readTimeout,300*1e3),o=t.whenStopped??`continue`,s,c,u=ge({idle:[`wait_for_next`],wait_for_next:[`processing_result`,`stopping`,`disposed`],processing_result:[`queued`,`disposed`,`stopping`],queued:[`wait_for_next`,`disposed`,`stopping`],stopping:`idle`,disposed:null},`idle`),d=()=>{r(`onExternalSignal`),c?.abort(t.signal?.reason)};t.signal&&t.signal.addEventListener(`abort`,d,{once:!0});let f=async()=>{r(`read. State: ${u.value}`),c=new AbortController;try{u=x(u,`wait_for_next`);let e=await re(s,{signal:c.signal,millis:a});if(u=x(u,`processing_result`),c.abort(`nextWithTimeout completed`),e.done&&(r(`read v.done true`),p.dispose(`Generator complete`),u=x(u,`disposed`)),u.value===`stopping`){r(`read. sm.value = stopping`),u=x(u,`idle`);return}if(u.value===`disposed`){r(`read. sm.value = disposed`);return}p.set(e.value)}catch(e){p.dispose(`Generator error: ${e.toString()}`);return}u.value===`processing_result`?(u=x(u,`queued`),r(`scheduling read. State: ${u.value}`),setTimeout(f,i)):u=x(u,`idle`)},p=N({...t,lazy:n,onStart(){r(`onStart state: ${u.value} whenStopped: ${o}`),u.value===`idle`&&((u.value===`idle`&&o===`reset`||s===void 0)&&(s=b(e)?e[Symbol.asyncIterator]():e[Symbol.iterator]()),f())},onStop(){r(`onStop state: ${u.value} whenStopped: ${o}`),u=x(u,`stopping`),o===`reset`&&(r(`onStop reiniting iterator`),s=b(e)?e[Symbol.asyncIterator]():e[Symbol.iterator]())},onDispose(e){r(`onDispose (${e})`),c?.abort(`Rx.From.iterator disposed (${e})`),t.signal&&t.signal.removeEventListener(`abort`,d)}});return p}const A=(e,t={})=>{if(T(e))return e;let n=t.generator??{lazy:`initial`,interval:5},r=t.function??{lazy:`very`};if(Array.isArray(e))return k(e.values(),n);if(typeof e==`function`)return Te(e,r);if(typeof e==`object`){if(be(e))return e.source;if(ne(e)||b(e))return k(e,n)}throw TypeError(`Unable to resolve source. Supports: array, Reactive, Async/Iterable. Got type: ${typeof e}`)};function j(e,t){let n=t;return e.onValue(e=>{n=e}),{...e,last(){return n},resetCachedValue(){n=void 0}}}function M(e,t){let n=t.lazy??`initial`,r=t.disposeIfSourceDone??!0,i=t.onValue??(e=>{}),a=A(e),o,s=t.debugLabel?`[${t.debugLabel}]`:``,c=()=>{o!==void 0&&(o(),o=void 0,t.onStop&&t.onStop())},l=()=>{o===void 0&&(t.onStart&&t.onStart(),o=a.on(e=>{S(e)?e.signal===`done`?(c(),u.signal(e.signal,e.context),r&&u.dispose(`Upstream source ${s} has completed (${e.context??``})`)):u.signal(e.signal,e.context):w(e)&&i(e.value)}))},u=N({...t,lazy:n,onStart:l,onStop:c});return u}function Ee(e){return j(N(e),e.initialValue)}function N(e){let t=e.lazy??`initial`,n=e.onStop??(()=>{}),r=e.onStart??(()=>{});e.debugLabel&&`${e.debugLabel}`;let i=P({...e,onFirstSubscribe(){t!==`never`&&r()},onNoSubscribers(){t===`very`&&n()}});return t===`never`&&r(),i}function P(e={}){let t,n=!1,r=!1,i=!0,a=e.onFirstSubscribe??void 0,o=e.onNoSubscribers??void 0,s=e.debugLabel?`[${e.debugLabel}]`:``,c=()=>{t!==void 0&&t.isEmpty&&(i||(i=!0,r=!1,o&&o()))},l=e=>{if(n)throw Error(`Disposed, cannot subscribe ${s}`);t===void 0&&(t=new he);let o=t.add(e);return i=!1,r||(r=!0,a&&a()),()=>{t?.remove(o),c()}};return{dispose:r=>{n||(t?.notify({value:void 0,signal:`done`,context:`Disposed: ${r}`}),n=!0,e.onDispose&&e.onDispose(r))},isDisposed:()=>n,removeAllSubscribers:()=>{t?.clear(),c()},set:e=>{if(n)throw Error(`${s} Disposed, cannot set`);t?.notify({value:e})},signal:(e,r)=>{if(n)throw Error(`${s} Disposed, cannot signal`);t?.notify({signal:e,value:void 0,context:r})},on:e=>l(e),onValue:e=>l(t=>{w(t)&&e(t.value)})}}const De=(e,t)=>{let n,r;if(typeof t==`string`&&(r={query:t}),typeof t==`object`&&(r=`nodeName`in t?{el:t}:t),r===void 0)throw TypeError(`Missing element as second parameter or option`);if(`el`in r)n=r.el;else if(`query`in r)n=document.querySelector(r.query);else throw TypeError(`Options does not include 'el' or 'query' fields`);if(n==null)throw Error(`Element could not be resolved.`);let i=A(e),a=_e(r.asHtml?`innerHTML`:`textContent`,n);return i.onValue(e=>{a(e)})},F=e=>({on:e.on,dispose:e.dispose,isDisposed:e.isDisposed,onValue:e.onValue});function Oe(e,t,n={}){let r=M(e,{...n,onValue(e){let n=t(e);r.set({value:e,annotation:n})}});return F(r)}function I(e,t){let n=A(e);return Z({value:n,annotation:t(n)})}function L(e,t={}){let n=new ie,r=t.quantity??0,i=t.returnRemainder??!0,a=M(e,{...t,onStop(){if(i&&!n.isEmpty){let e=n.toArray();n.clear(),a.set(e)}},onValue(e){n.enqueue(e),r>0&&n.length>=r&&o(),s!==void 0&&s.runState===`idle`&&s.start()}}),o=()=>{if(n.isEmpty)return;s!==void 0&&s.start();let e=n.toArray();n.clear(),setTimeout(()=>{a.set(e)})},s=t.elapsed?me(o,t.elapsed):void 0;return F(a)}function R(e,t,n={}){let r=n.traceInput??!1,i=n.traceOutput??!1,a=M(e,{lazy:`initial`,...n,onValue(e){let n=t(e);r&&i?console.log(`Rx.Ops.transform input: ${JSON.stringify(e)} output: ${JSON.stringify(n)}`):r?console.log(`Rx.Ops.transform input: ${JSON.stringify(e)}`):i&&console.log(`Rx.Ops.transform output: ${JSON.stringify(n)}`),a.set(n)}});return F(a)}const ke=e=>R(e,e=>{let t=[];for(let n in e){let r=e[n];_(r)&&t.push([n,r])}return Object.fromEntries(t)});function z(e,t={}){let n=P(),r=t.onSourceDone??`break`,i=[],a=e.map(e=>A(e)),o=()=>{},s=a.map(e=>o),c=a.map(e=>!1),l=()=>{for(let e of s)e()};for(let[e,t]of a.entries())i[e]=void 0,s[e]=t.on(t=>{if(C(t)){if(c[e]=!0,s[e](),s[e]=o,r===`break`){l(),n.dispose(`Source has completed and 'break' is set`);return}c.includes(!1)||(l(),n.dispose(`All sources completed`))}else w(t)&&(i[e]=t.value,n.set([...i]))});return{dispose:n.dispose,isDisposed:n.isDisposed,on:n.on,onValue:n.onValue}}function B(e,n={}){let a=n.eq??o,c=P(),l=P(),u=[],d=e,f=!1,p=e=>{let t=[...r(d??{},e,{...n,includeMissingFromA:!0})];t.length!==0&&(d=e,c.set(e),l.set(t))},m=(e,t)=>{for(let[n,r,i]of u)n(e)&&i.notify({fieldName:e,pattern:r,value:t})},_={asPartial:!0,includeParents:!0};return{dispose:e=>{f||=(l.dispose(e),c.dispose(e),!0)},isDisposed(){return f},updateField:(e,t)=>{if(d===void 0)throw Error(`Cannot update value when it has not already been set`);let o=s(d,e);if(h(o))throw g(o);if(a(o.value,t,e))return;let u=[...r(o.value,t,{...n,includeMissingFromA:!0})];u=u.map(t=>t.path.length>0?{...t,path:e+`.`+t.path}:{...t,path:e});let f=i(d,e,t,!0);d=f,c.set(f),l.set(u),m(e,t)},last:()=>d,on:c.on,onValue:c.onValue,onDiff:l.onValue,onField(e,n){let r=t(e),i=new he;u.push([r,e,i]);let a=i.add(n);return()=>i.remove(a)},set:p,update:e=>{if(d===void 0){d=e,c.set(d);for(let[t,n]of Object.entries(e))m(t,n);return d}else{let t=[...r(d,e,_)];if(t.length===0)return d;d={...d,...e},c.set(d),l.set(t);for(let e of t)m(e.path,e.value);return d}}}}function V(e,t={}){let n=t.disposeSources??!0,r=B(void 0),i=t.onSourceDone??`break`,a=t.emitInitial??!0,o=!1,s=new Map;for(let[t,n]of Object.entries(e)){let e=`last`in n?n.last():void 0,r={source:A(n),done:!1,data:e,off:()=>{}};s.set(t,r)}let c=Object.fromEntries(Object.entries(s).map(e=>[e[0],e[1].source])),l=()=>u(s,e=>!e.done),d=()=>{for(let e of s.values())e.off()},f=()=>{let e={};for(let[t,n]of s)n.data!==void 0&&(e[t]=n.data);return e},p=()=>{o=!0;let e=f();r.set(e)},m=e=>{e.off=e.source.on(t=>{if(C(t)){if(e.done=!0,e.off(),e.off=()=>{},i===`break`){d(),r.dispose(`Source has completed and 'break' is behaviour`);return}l()||(d(),r.dispose(`All sources completed`))}else w(t)&&(e.data=t.value,p())})};for(let e of s.values())m(e);return!o&&a&&p(),{...r,hasSource(e){return s.has(e)},replaceSource(e,t){let n=s.get(e);if(n===void 0)throw Error(`Field does not exist: '${e}'`);n.off(),n.source=A(t),m(n)},setWith(e){let t={};for(let[n,r]of Object.entries(e)){let e=s.get(n);e!==void 0&&(E(e.source)&&(e.source.set(r),t[n]=r),e.data=r)}return t},sources:c,last(){return f()},dispose(e){if(d(),r.dispose(e),n)for(let e of s.values())e.source.dispose(`Part of disposed mergeToObject`)}}}function Ae(e,t){let n,r;ye(e)&&(r=n=e.last());let i=()=>{if(n===void 0&&r!==void 0)n=r,a.set(n);else if(n!==void 0&&r!==void 0){let e=t(n,r);n=e,a.set(e)}},a=M(e,{lazy:`very`,debugLabel:`computeWithPrevious`,onValue(e){r=e,i()}});return r&&i(),{...F(a),ping:()=>{r!==void 0&&i()}}}function je(e,t={}){let n=l(t.elapsed,50),r,i=me(()=>{let e=r;e&&(a.set(e),r=void 0)},n),a=M(e,{...t,onValue(e){r=e,i.start()}});return F(a)}function Me(e){return t=>je(t,e)}const Ne=e=>{let t=0;return R(e,e=>{let n=t===0?0:Date.now()-t;return t=Date.now(),n})};function H(e,t,n={}){let r=n.fallbackFieldValue,i=n.fallbackObject,a=M(e,{disposeIfSourceDone:!0,...n,onValue(e){let n;t in e?n=e[t]:i&&t in i&&(n=i[t]),n===void 0&&(n=r),n!==void 0&&a.set(n)}});return F(a)}function U(e,t,n){if(typeof t!=`function`)throw TypeError(`Param 'predicate' should be a function`);let r=M(e,{...n,onValue(e){t(e)&&r.set(e)}});return F(r)}function Pe(e,t,n){if(typeof t!=`function`)throw TypeError(`Param 'predicate' should be a function`);let r=M(e,{...n,onValue(e){t(e)||r.set(e)}});return F(r)}function Fe(e,t={}){let n=t.amount??.1,r=t.snapAt??.99,i=de(n,t);return Ae(e,(e,t)=>{let n=i(e,t);return t>e&&n/t>=r?t:n})}function W(e,t){return Y(se(),`max`,e,t)}function G(e,t){return Y(le(),`min`,e,t)}function K(e,t){return Y(ue(),`average`,e,t)}function q(e,t){return Y(ae(),`sum`,e,t)}function J(e,t={}){return Y(ce(t.countArrayItems??!0),`tally`,e,t)}function Ie(e,t,n){return Y(oe(t,n),`rank`,e,n)}function Y(e,t,n,r={}){let i=r.annotate,a,o=r.skipUndefined??!0,s=r.skipIdentical??!0,c=M(n,{...r,onValue(n){let r=e(n);if(!(r===void 0&&o)&&!(s&&r===a))if(a=r,i){let e={value:n};e[t]=r,c.set(e)}else c.set(r)}});return F(c)}const Le=(...e)=>{let t=P(),n=[],r=r=>{for(let t of e)t.isDisposed||t.dispose(r);for(let e of n)e();t.dispose(r)};for(let i=0;i<e.length;i++)n.push(e[i].on(n=>{let a=i===e.length-1;w(n)?a?t.set(n.value):e[i+1].set(n.value):C(n)&&r(`Upstream disposed`)}));return{on:t.on,onValue:t.onValue,dispose(e){r(e)},isDisposed(){return t.isDisposed()}}};function Re(e,t={}){let n=t.order??`default`;if(!t.at&&!t.predicate)throw Error(`Options must have 'predicate' or 'at' fields`);let r=e=>e;n===`random`?r=v:typeof n==`function`&&(r=e=>e.toSorted(n));let i=M(e,{onValue(e){if(e=r(e),t.predicate)for(let n of e)t.predicate(n)&&i.set(n);else t.at&&i.set(e.at(t.at))}});return i}const ze=(e,t={})=>{let n=t.quantity??2,r=[],i=A(e);for(let e=0;e<n;e++)r.push(M(i,{disposeIfSourceDone:!0,lazy:`initial`}));return r},Be=(e,t)=>{let n=A(e),r={};for(let e of t)r[e]=M(n,{lazy:`initial`,disposeIfSourceDone:!0});return r},Ve=(e,t,n={})=>{let r=n.match??`first`,i=A(e),a=!1,o={};for(let e of Object.keys(t))o[e]=P();let s=()=>{if(!a){c(),a=!0;for(let e of Object.values(o))e.dispose(`switcher source dispose`)}},c=i.on(e=>{if(w(e)){for(let[n,i]of Object.entries(t))if(i(e.value)&&(o[n].set(e.value),r===`first`))break}else C(e)&&s()});return o};function X(e,t={}){let n=t.onSourceDone??`break`,r=t.finalValue??`undefined`,i=l(t.maximumWait,2e3),a,o=[],s=e.map(e=>({finalData:void 0,done:!1,source:A(e),unsub:()=>{}})),c=()=>{for(let e of s)e.unsub(),e.unsub=()=>{}},u=()=>{for(let e=0;e<o.length;e++)if(!(n===`allow`&&s[e].done)&&o[e]===void 0)return!1;return!0},d=()=>s.some(e=>!e.done),f=()=>{for(let e=0;e<o.length;e++)r===`last`&&s[e].done||(o[e]=void 0)},p=()=>{m(`Sync timeout exceeded (${i.toString()})`)},m=e=>{a&&clearTimeout(a),c(),g.dispose(e)},h=()=>{a=setTimeout(p,i);for(let[e,t]of s.entries())o[e]=void 0,t.unsub=t.source.on(s=>{if(S(s)){if(s.signal===`done`){if(t.finalData=o[e],t.unsub(),t.done=!0,t.unsub=()=>{},r===`undefined`&&(o[e]=void 0),n===`break`){m(`Source '${e.toString()}' done, and onSourceDone:'break' is set`);return}if(!d()){m(`All sources done`);return}}return}o[e]=s.value,u()&&(g.set([...o]),f(),a&&clearTimeout(a),a=setTimeout(p,i))})},g=P({onFirstSubscribe(){c(),h()},onNoSubscribers(){a&&clearTimeout(a),c()}});return{dispose:g.dispose,isDisposed:g.isDisposed,on:g.on,onValue:g.onValue}}function Z(e,t={}){let n=Object.keys(e);return R(X(Object.values(e),t),e=>c(n,e))}function He(e,...t){let n=A(e),r=Process.flow(...t);return n.onValue(e=>{r(e)}),n}function Q(e,t){let n=A(e);return n.onValue(e=>{t.set(e)}),n}const Ue=(e,...t)=>{for(let n of t)e=n(e);return e};function We(e,t={}){let n=l(t.elapsed,0),r=performance.now(),i,a=M(e,{...t,onValue(e){i=e,o()}}),o=()=>{let e=performance.now();n>0&&e-r>n&&(r=e,i!==void 0&&a.set(i))};return F(a)}function Ge(e,t){let n,r=t.immediate??!0,i=t.repeat??!1,a=l(t.interval,1e3);if(!Ce(t))throw Error(`Param 'options' does not contain trigger 'value' or 'fn' fields`);let o=()=>{let[e,r]=we(t);if(r)s.dispose(`Trigger completed`);else{if(s.isDisposed())return;s.set(e),i&&(n=setTimeout(o,a))}},s=M(e,{disposeIfSourceDone:!0,onValue(e){n&&clearTimeout(n),n=setTimeout(o,a),s.set(e)},onDispose(){n&&clearTimeout(n)}});return r&&!n&&(n=setTimeout(o,a)),s}function Ke(e,t){let n,r=A(e),i=t.abort,a=l(t,1e3),o=()=>{if(i?.aborted||r.isDisposed()){c();return}ve(r)&&r.ping(),n=setTimeout(o,a)},s=()=>{n&&clearTimeout(n)},c=r.on(e=>{w(e)?(s(),n=setTimeout(o,a)):C(e)&&(c(),s())});return n=setTimeout(o,a),r}function qe(e,t){let n=t.initial,r=M(e,{...t,onValue(e){n=e,r.set(e)}});return{...F(r),last(){return n}}}const Je=(e,t={})=>{if(Array.isArray(e))return Ye(e,t)},Ye=(e,t={})=>{let n=t.lazy??`initial`,r=t.signal,i=t.whenStopped??`continue`,a=t.debugLifecycle??!1,o=[...e];if(n!==`very`&&i===`reset`)throw Error(`whenStopped:'reset' has no effect with 'lazy:${n}'. Use lazy:'very' instead.`);let s=l(t.interval,5),c=0,u=o[0],d=N({...t,lazy:n,onStart(){a&&console.log(`Rx.readFromArray:onStart`),f.start()},onStop(){a&&console.log(`Rx.readFromArray:onStop. whenStopped: ${i} index: ${c}`),f.cancel(),i===`reset`&&(c=0)}}),f=p(()=>{if(r?.aborted)return d.dispose(`Signalled (${r.reason})`),!1;if(u=o[c],c++,d.set(u),c===o.length)return d.dispose(`Source array complete`),!1},s);return n||f.start(),{dispose:d.dispose,isDisposed:d.isDisposed,isDone(){return c===o.length},last(){return u},on:d.on,onValue:d.onValue}};function Xe(e=[],t={}){let r=t.eq??f,i=P(),a=P(),o=e,s=!1;return{dispose:e=>{s||=(i.dispose(e),!0)},isDisposed(){return s},last:()=>o,on:i.on,onArray:a.on,onValue:i.onValue,setAt:(e,t)=>{o[e]=t,i.set([...o])},push:e=>{o=[...o,e],i.set([...o]);let t=[`add`,o.length-1,e];a.set([t])},deleteAt:e=>{let t=te(o,e);if(t.length===o.length)return;let s=n(o,t,r);o=t,i.set([...o]),a.set(s.summary)},deleteWhere:e=>{let t=o.filter(t=>!e(t)),s=o.length-t.length,c=n(o,t,r);return o=t,i.set([...o]),a.set(c.summary),s},insertAt:(e,t)=>{let s=y(o,e,t),c=n(o,s,r);o=s,i.set([...o]),a.set(c.summary)},set:e=>{n(o,e,r),o=e,i.set([...e])}}}function Ze(e){let t=e,n=P();return{dispose:n.dispose,isDisposed:n.isDisposed,last:()=>t,on:n.on,onValue:n.onValue,set:e=>{t=e,n.set(e)}}}function Qe(e={}){let t=e.lazy??`initial`,n=l(e.interval,1e3),r=e.amount??1,i=e.offset??0,a=0,o=i,s=e=>{u.dispose(e)},c=p(()=>{if(e.signal?.aborted)return s(`Aborted (${e.signal.reason})`),!1;if(u.set(o),o+=1,a++,a>=r)return s(`Limit reached`),!1},n),u=N({onStart(){c.start()},onStop(){c.cancel()},onDispose(){c.cancel()},lazy:t});return u}function $e(e,t,n={}){let r=n.ignoreIdentical??!0,i=n.eq??f,a=V(t),o=t=>{let n=s.last(),a=e(t);if(a!==void 0){if(r&&n!==void 0&&i(a,n))return a;s.set(a)}return a},s=j(M(a,{...n,onValue(e){o(e)}}),e(a.last()));return s}function et(e,t,n,r,i={}){let a={};return a[n]=r,H(tt(e,t,a,i),n,i)}function tt(e,t,n,r={}){let i;if(typeof e==`string`){if(i=document.querySelector(e),i===null)throw Error(`Target query did not resolve to an element. Query: '${e}'`)}else i=e;if(i===null)throw Error(`Param 'targetOrQuery' is null`);let a=r.debugLifecycle??!1,o=r.debugFiring??!1;r.diff;let s=r.lazy??!1;n===void 0&&(n={});let c=B(n,{deepEntries:!0}),l=!1,u=!1,d=e=>{o&&console.log(`Reactive.event '${t}' firing '${JSON.stringify(e)}`),c.set(e)},f=()=>{l&&(l=!1,i.removeEventListener(t,d),a&&console.log(`Rx.From.event remove '${t}'`))},p=()=>{l||(l=!0,i.addEventListener(t,d),a&&console.log(`Rx.From.event add '${t}'`))};return s||p(),{last:()=>(s&&p(),c.last()),dispose:e=>{u||(u=!0,f(),c.dispose(e))},isDisposed(){return u},on:e=>(s&&p(),c.on(e)),onValue:e=>(s&&p(),c.onValue(e))}}function nt(e,t,n={}){let r;if(typeof e==`string`){if(r=document.querySelector(e),r===null)throw Error(`Target query did not resolve to an element. Query: '${e}'`)}else r=e;if(r===null)throw Error(`Param 'targetOrQuery' is null`);let i=n.debugLifecycle??!1,o=n.debugFiring??!1,s=n.fireInitial??!1,c=0,l=a(),u=N({lazy:n.lazy??`very`,onStart(){r.addEventListener(t,d),i&&console.log(`Rx.From.eventTrigger add '${t}'`),s&&c===0&&((i||o)&&console.log(`Rx.From.eventTrigger: firing initial`),d())},onStop(){r.removeEventListener(t,d),i&&console.log(`Rx.From.eventTrigger remove '${t}'`)}}),d=e=>{o&&console.log(`Rx.From.eventTrigger '${t}' triggered'`),u.set({sinceLast:l(),total:++c})};return u}function rt(...e){return it(e)}function it(e,t={}){let n=[],r=N({...t,onStart(){for(let t of e)n.push(t.onValue(e=>{r.set(e)}))},onStop(){for(let e of n)e();n=[]}});return r}function at(e){let t=e,n=P();return{dispose:n.dispose,isDisposed:n.isDisposed,last:()=>t,on:n.on,onValue:n.onValue,set:e=>{t=e,n.set(e)}}}const ot=Symbol(`Rx`),st=e=>{let t=B(e);return{proxy:new Proxy(e,{set(e,n,r,i){let a=Array.isArray(e);if(a&&n===`length`)return!0;if(typeof n==`string`&&t.updateField(n,r),a&&typeof n==`string`){let t=Number.parseInt(n);if(!Number.isNaN(t))return e[t]=r,!0}return e[n]=r,!0}}),rx:t}},ct=e=>{let t=Xe(e);return{proxy:new Proxy(e,{set(e,n,r,i){if(n===`length`)return!0;if(typeof n!=`string`)throw Error(`Expected numeric index, got type: ${typeof n} value: ${JSON.stringify(n)}`);let a=Number.parseInt(n);if(Number.isNaN(a))throw Error(`Expected numeric index, got: '${n}'`);return t.setAt(a,r),e[a]=r,!0}}),rx:t}},lt=e=>{let{proxy:t,rx:n}=st(e),r=t;return r[ot]=n,r};function ut(e){let t=dt(e);return{dispose:t.dispose,isDisposed:t.isDisposed,on:t.on,onValue:t.onValue}}function dt(e){let t=()=>{},n=St({onFirstSubscribe(){t=e(n)},onNoSubscribers(){t&&t()}});return{...n,onValue:e=>n.on(t=>{w(t)&&e(t.value)})}}function ft(e){let t=e,n=P();return{dispose:n.dispose,isDisposed:n.isDisposed,last:()=>t,on:n.on,onValue:n.onValue,set:e=>{t=e,n.set(e)}}}var pt=e({array:()=>Ye,arrayObject:()=>Xe,arrayProxy:()=>ct,boolean:()=>Ze,count:()=>Qe,derived:()=>$e,event:()=>tt,eventField:()=>et,eventTrigger:()=>nt,func:()=>Te,iterator:()=>k,merged:()=>rt,mergedWithOptions:()=>it,number:()=>at,object:()=>B,objectProxy:()=>st,objectProxySymbol:()=>lt,observable:()=>ut,observableWritable:()=>dt,of:()=>Je,string:()=>ft});function mt(e){let t=St({onNoSubscribers(){e.removeEventListener(`removed`,n),e.removeEventListener(`enqueue`,r)},onFirstSubscribe(){e.addEventListener(`removed`,n),e.addEventListener(`enqueue`,r),t.set(e.toArray())}}),n=e=>{t.set(e.finalData)},r=e=>{t.set(e.finalData)},i=t=>{e.enqueue(...t)};return{...t,set:i}}var ht=e({asResponsive:()=>mt});function gt(e){let t=pe(),n=new Map,r=P(),i=(e,r)=>{for(let[a,o]of Object.entries(e)){let e=r+`.`+a;if(t=fe(t,{from:r,to:e}),T(o))n.set(e,{value:o,type:`rx`}),o.on(t=>{console.log(`Rx.prepare value: ${JSON.stringify(t)} path: ${e}`)});else{let t=typeof o;t===`bigint`||t===`boolean`||t===`number`||t===`string`?n.set(e,{type:`primitive`,value:o}):t===`object`?i(o,e):t===`function`&&console.log(`Rx.process - not handling functions`)}}};return{dispose:r.dispose,isDisposed:r.isDisposed,graph:t,on:r.on,onValue:r.onValue}}async function _t(e,t={}){let n=t.limit??2**53-1,r=l(t.maximumWait,10*1e3),i=t.underThreshold??`partial`,a=[],o=A(e);return new Promise((e,s)=>{let c=()=>{if(clearTimeout(l),u(),a.length<n&&i===`throw`){s(Error(`Threshold not reached. Wanted: ${n} got: ${a.length}. Maximum wait: ${r}`));return}if(a.length<n&&i===`fill`)for(let e=0;e<n;e++)a[e]===void 0&&(a[e]=t.fillValue);e(a)},l=setTimeout(()=>{c()},r),u=o.on(e=>{C(e)?c():w(e)&&(a.push(e.value),a.length===n&&c())})})}async function vt(e,t={}){let n=await _t(e,{limit:t.limit??2**53-1,maximumWait:t.maximumWait??5*1e3,underThreshold:`partial`});if(t.limit&&n.length<t.limit)throw Error(`Threshold not reached. Wanted: ${t.limit}, got ${n.length}`);return n}async function*yt(e){let t=A(e),n=e=>{},r=e=>{},i=()=>new Promise((e,t)=>{n=e,r=t}),a=i(),o=!0;for(t.on(e=>{w(e)?(n(e.value),a=i()):C(e)&&(o=!1,r(`Source has completed`))});o;)yield await a}function $(e){return{source:A(e),enacts:{setHtmlText:t=>De(e,t)},annotate:t=>$(Oe(e,t)),annotateWithOp:t=>$(I(e,t)),chunk:t=>$(L(e,t)),debounce:(t={})=>$(je(e,t)),field:(t,n={})=>$(H(e,t,n)),filter:(t,n)=>$(U(e,t,n)),combineLatestToArray:(t,n={})=>$(z([e,...t],n)),combineLatestToObject:(t,n)=>{let r=n.name??`source`,i={...t};return i[r]=e,$(V(i,n))},min:(t={})=>$(G(e,t)),max:(t={})=>$(W(e,t)),average:(t={})=>$(K(e,t)),sum:(t={})=>$(q(e,t)),tally:(t={})=>$(J(e,t)),split:(t={})=>ze(e,t).map(e=>$(e)),splitLabelled:(...t)=>m(Be(e,t),e=>$(e.value)),switcher:(t,n={})=>m(Ve(e,t,n),e=>$(e.value)),syncToArray:(t,n={})=>$(X([e,...t].map(e=>A(e)),n)),syncToObject:(t,n={})=>{let r=n.name??`source`,i={...t};return i[r]=e,$(Z(i,n))},tapProcess:(...t)=>(He(e,...t),$(e)),tapStream:t=>(Q(e,t),$(e)),tapOps:(e,...t)=>(Ue(e,...t),$(e)),throttle:(t={})=>$(We(e,t)),transform:(t,n={})=>$(R(e,t,n)),timeoutValue:t=>$(Ge(e,t)),timeoutPing:t=>$(Ke(e,t)),toArray:t=>_t(e,t),toArrayOrThrow:t=>vt(e,t),onValue:t=>{A(e).on(e=>{w(e)&&t(e.value)})}}}function bt(e,...t){let n=A(e);for(let e of t)n=e(n);return n}function xt(e,...t){let n=A(e),r=n;for(let e of t)n=e(n);return{...n,set(e){if(E(r))r.set(e);else throw Error(`Original source is not writable`)}}}function St(e={}){let t=P(e);return{dispose:t.dispose,isDisposed:t.isDisposed,set(e){t.set(e)},on:t.on,onValue:t.onValue}}const Ct={setHtmlText:e=>t=>{De(t,e)}},wt={annotate:e=>t=>Oe(t,e),annotateWithOp:e=>t=>I(t,e),chunk:e=>t=>L(t,e),cloneFromFields:()=>e=>ke(e),combineLatestToArray:(e={})=>t=>z(t,e),combineLatestToObject:(e={})=>t=>V(t,e),drop:(e,t={})=>n=>Pe(n,e,t),elapsed:()=>D(Ne),field:(e,t={})=>n=>H(n,e,t),filter:(e,t={})=>n=>U(n,e,t),interpolate:e=>t=>Fe(t,e),min:e=>D(G,e),max:e=>D(W,e),sum:e=>D(q,e),average:e=>D(K,e),tally:e=>D(J,e),rank:(e,t)=>D(Ie,e,t),pipe:(...e)=>t=>Le(A(t),...e),singleFromArray:(e={})=>t=>Re(t,e),split:(e={})=>t=>ze(t,e),splitLabelled:e=>t=>Be(t,e),switcher:(e,t={})=>n=>Ve(n,e,t),syncToArray:(e={})=>t=>X(t,e),syncToObject:(e={})=>t=>Z(t,e),tapProcess:e=>t=>He(t,e),tapStream:e=>t=>Q(t,e),tapOps:(...e)=>t=>Ue(t,...e),throttle:e=>D(We,e),timeoutValue:e=>t=>Ge(t,e),timeoutPing:e=>t=>Ke(t,e),transform:(e,t={})=>n=>R(n,e,t),withValue:e=>D(qe,e)};async function Tt(e,t=1e3){let n=A(e),r=()=>{},i;return new Promise((e,a)=>{r=n.on(t=>{i&&clearTimeout(i),w(t)?(r(),e(t.value)):C(t)&&(a(Error(`Source closed. ${t.context??``}`)),r())}),i=setTimeout(()=>{i=void 0,r(),a(Error(`Timeout waiting for value (${JSON.stringify(t)})`))},l(t))})}const Et=(e,t,n,r=!1)=>{let i=e.on(e=>{if(w(e)){let r=n?n(e.value):e.value;t.set(r)}else C(e)&&(i(),r&&t.dispose(`Source closed (${e.context??``})`))});return i};export{I as $,Be as A,Pe as B,Ue as C,X as D,Z as E,G as F,Ae as G,H,Ie as I,z as J,V as K,q as L,Le as M,K as N,Ve as O,W as P,Oe as Q,J as R,We as S,Q as T,Ne as U,U as V,Me as W,R as X,ke as Y,L as Z,tt as _,C as _t,Tt as a,j as at,Ke as b,we as bt,$ as c,ve as ct,vt as d,Se as dt,De as et,gt as f,O as ft,ot as g,w as gt,ut as h,E as ht,bt as i,M as it,Re as j,ze as k,yt as l,T as lt,pt as m,be as mt,Ct as n,Ee as nt,Et as o,A as ot,ht as p,xe as pt,B as q,St as r,P as rt,xt as s,ye as st,wt as t,N as tt,_t as u,Ce as ut,nt as v,S as vt,He as w,Ge as x,qe as y,D as yt,Fe as z};