{"version":3,"file":"resolve-core-cAVLLopl.js","names":[],"sources":["../../core/dist/src/reactive-core.js","../../core/dist/src/resolve-core.js"],"sourcesContent":["/**\n * Returns _true_ if `rx` is a Reactive\n * @param rx\n * @returns\n */\nexport const isReactive = (rx) => {\n    if (typeof rx !== `object`)\n        return false;\n    if (rx === null)\n        return false;\n    return (`on` in rx && `onValue` in rx);\n};\n/**\n * Returns _true_ if `rx` has a last value\n *\n * Judged seeing if `.last()` exists on `rx`.\n * @param rx Reactive\n * @returns\n */\nexport const hasLast = (rx) => {\n    if (!isReactive(rx))\n        return false;\n    if (`last` in rx) {\n        // eslint-disable-next-line @typescript-eslint/no-unsafe-call\n        const v = rx.last();\n        if (v !== undefined)\n            return true;\n    }\n    return false;\n};\n","import { getErrorMessage } from \"@ixfx/debug\";\nimport { hasLast, isReactive } from \"./reactive-core.js\";\n/**\n * Resolves `r` to a value, where `r` is:\n * * primitive value\n * * a/sync function\n * * a/sync generator/iterator\n * * ReactiveNonInitial\n * ```js\n * await resolve(10);       // 10\n * await resolve(() => 10); // 10\n * await resole(async () => {\n *  sleep(100);\n *  return 10;\n * });                // 10\n * ```\n *\n * To resolve an object's properties, use {@link resolveFields}.\n *\n * Resolve is not recursive. So if `r` is an object, it will be returned, even\n * though its properties may be resolvable.\n * @param r\n * @param args\n * @returns\n */\nexport async function resolve(r, ...args) {\n    if (typeof r === `object`) {\n        if (`next` in r) {\n            const tag = r[Symbol.toStringTag];\n            if (tag === `Generator` || tag == `Array Iterator`) {\n                const v = r.next();\n                if (`done` in v && `value` in v)\n                    return v.value;\n                return v;\n            }\n            else if (tag === `AsyncGenerator`) {\n                const v = await r.next();\n                //console.log(`  hasDone: ${ `done` in v } value:`, v);\n                if (`done` in v && `value` in v)\n                    return v.value;\n                return v;\n            }\n            else {\n                throw new Error(`Object has 'next' prop, but does not have 'AsyncGenerator', 'Generator' or 'Array Iterator' string tag symbol. Got: '${tag}'`);\n            }\n        }\n        else if (isReactive(r)) {\n            if (hasLast(r))\n                return r.last();\n            throw new Error(`Reactive does not have last value`);\n        }\n        else {\n            // Some regular object\n            return r;\n        }\n    }\n    else if (typeof r === `function`) {\n        const v = await r(args);\n        return v;\n    }\n    else {\n        // Primitive value?\n        return r;\n    }\n}\n/**\n * For a given input `r`, attempts to 'resolve' it. See {@link resolve} for details.\n * @param r\n * @param args\n * @returns\n */\nexport function resolveSync(r, ...args) {\n    if (typeof r === `object`) {\n        if (`next` in r) {\n            const tag = r[Symbol.toStringTag];\n            if (tag === `Generator` || tag == `Array Iterator`) {\n                const v = r.next();\n                if (`done` in v && `value` in v)\n                    return v.value;\n                return v;\n            }\n            else if (tag === `AsyncGenerator`) {\n                throw new Error(`resolveSync cannot work with an async generator`);\n            }\n            else {\n                throw new Error(`Object has 'next' prop, but does not have 'Generator' or 'Array Iterator' string tag symbol. Got: '${tag}'`);\n            }\n        }\n        else if (isReactive(r)) {\n            if (hasLast(r))\n                return r.last();\n            throw new Error(`Reactive does not have last value`);\n        }\n        else {\n            // Some regular object\n            return r;\n        }\n    }\n    else if (typeof r === `function`) {\n        return r(args);\n    }\n    else {\n        // Primitive value?\n        return r;\n    }\n}\n/**\n * Resolves a value as per {@link resolve}, however\n * If an error is thrown or the resolution results in _undefined_\n * or NaN, `fallbackValue` is returned instead.\n *\n * `null` is an allowed return value.\n *\n * ```js\n * // Function returns undefined 50% of the time or 0\n * const fn = () => {\n *  if (Math.random() >= 0.5) return; // undefined\n *  return 0;\n * }\n * const r = resolveWithFallback(fn, 1);\n * const value = r(); // Always 0 or 1\n * ```\n * @param p Thing to resolve\n * @param fallback Fallback value if an error happens, undefined or NaN\n * @param args\n * @returns\n */\nexport async function resolveWithFallback(p, fallback, ...args) {\n    let errored = false;\n    let fallbackValue = fallback.value;\n    const overrideWithLast = fallback.overrideWithLast ?? false;\n    if (fallbackValue === undefined)\n        throw new Error(`Needs a fallback value`);\n    try {\n        const r = await resolve(p, ...args);\n        if (typeof r === `undefined`)\n            return fallbackValue;\n        if (typeof r === `number` && Number.isNaN(r))\n            return fallbackValue;\n        if (overrideWithLast)\n            fallbackValue = r;\n        return r;\n    }\n    catch (error) {\n        if (!errored) {\n            errored = true;\n            console.warn(`resolveWithFallback swallowed an error. Additional errors not reported.`, getErrorMessage(error));\n        }\n        return fallbackValue;\n    }\n}\nexport function resolveWithFallbackSync(p, fallback, ...args) {\n    let errored = false;\n    let fallbackValue = fallback.value;\n    const overrideWithLast = fallback.overrideWithLast ?? false;\n    if (fallbackValue === undefined)\n        throw new Error(`Needs a fallback value`);\n    try {\n        const r = resolveSync(p, ...args);\n        if (typeof r === `undefined`)\n            return fallbackValue;\n        if (typeof r === `number` && Number.isNaN(r))\n            return fallbackValue;\n        if (overrideWithLast)\n            fallbackValue = r;\n        return r;\n    }\n    catch (error) {\n        if (!errored) {\n            errored = true;\n            console.warn(`resolveWithFallbackSync swallowed an error. Additional errors not reported.`, getErrorMessage(error));\n        }\n        return fallbackValue;\n    }\n}\n"],"mappings":"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"}